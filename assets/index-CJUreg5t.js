function yI(t,e){for(var r=0;r<e.length;r++){const i=e[r];if(typeof i!="string"&&!Array.isArray(i)){for(const n in i)if(n!=="default"&&!(n in t)){const l=Object.getOwnPropertyDescriptor(i,n);l&&Object.defineProperty(t,n,l.get?l:{enumerable:!0,get:()=>i[n]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const l of n)if(l.type==="childList")for(const c of l.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&i(c)}).observe(document,{childList:!0,subtree:!0});function r(n){const l={};return n.integrity&&(l.integrity=n.integrity),n.referrerPolicy&&(l.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?l.credentials="include":n.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function i(n){if(n.ep)return;n.ep=!0;const l=r(n);fetch(n.href,l)}})();function mE(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function tN(t){if(Object.prototype.hasOwnProperty.call(t,"__esModule"))return t;var e=t.default;if(typeof e=="function"){var r=function i(){return this instanceof i?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};r.prototype=e.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(t).forEach(function(i){var n=Object.getOwnPropertyDescriptor(t,i);Object.defineProperty(r,i,n.get?n:{enumerable:!0,get:function(){return t[i]}})}),r}var Ub={exports:{}},E_={},Vb={exports:{}},Hr={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var CS;function rN(){if(CS)return Hr;CS=1;var t=Symbol.for("react.element"),e=Symbol.for("react.portal"),r=Symbol.for("react.fragment"),i=Symbol.for("react.strict_mode"),n=Symbol.for("react.profiler"),l=Symbol.for("react.provider"),c=Symbol.for("react.context"),o=Symbol.for("react.forward_ref"),m=Symbol.for("react.suspense"),b=Symbol.for("react.memo"),A=Symbol.for("react.lazy"),R=Symbol.iterator;function M(ze){return ze===null||typeof ze!="object"?null:(ze=R&&ze[R]||ze["@@iterator"],typeof ze=="function"?ze:null)}var L={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},G=Object.assign,V={};function q(ze,ht,Ht){this.props=ze,this.context=ht,this.refs=V,this.updater=Ht||L}q.prototype.isReactComponent={},q.prototype.setState=function(ze,ht){if(typeof ze!="object"&&typeof ze!="function"&&ze!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,ze,ht,"setState")},q.prototype.forceUpdate=function(ze){this.updater.enqueueForceUpdate(this,ze,"forceUpdate")};function J(){}J.prototype=q.prototype;function ie(ze,ht,Ht){this.props=ze,this.context=ht,this.refs=V,this.updater=Ht||L}var ee=ie.prototype=new J;ee.constructor=ie,G(ee,q.prototype),ee.isPureReactComponent=!0;var me=Array.isArray,Se=Object.prototype.hasOwnProperty,Me={current:null},Ve={key:!0,ref:!0,__self:!0,__source:!0};function Be(ze,ht,Ht){var Jt,Pr={},yr=null,$t=null;if(ht!=null)for(Jt in ht.ref!==void 0&&($t=ht.ref),ht.key!==void 0&&(yr=""+ht.key),ht)Se.call(ht,Jt)&&!Ve.hasOwnProperty(Jt)&&(Pr[Jt]=ht[Jt]);var pr=arguments.length-2;if(pr===1)Pr.children=Ht;else if(1<pr){for(var Qt=Array(pr),Nr=0;Nr<pr;Nr++)Qt[Nr]=arguments[Nr+2];Pr.children=Qt}if(ze&&ze.defaultProps)for(Jt in pr=ze.defaultProps,pr)Pr[Jt]===void 0&&(Pr[Jt]=pr[Jt]);return{$$typeof:t,type:ze,key:yr,ref:$t,props:Pr,_owner:Me.current}}function $e(ze,ht){return{$$typeof:t,type:ze.type,key:ht,ref:ze.ref,props:ze.props,_owner:ze._owner}}function at(ze){return typeof ze=="object"&&ze!==null&&ze.$$typeof===t}function _t(ze){var ht={"=":"=0",":":"=2"};return"$"+ze.replace(/[=:]/g,function(Ht){return ht[Ht]})}var Nt=/\/+/g;function sr(ze,ht){return typeof ze=="object"&&ze!==null&&ze.key!=null?_t(""+ze.key):ht.toString(36)}function Ft(ze,ht,Ht,Jt,Pr){var yr=typeof ze;(yr==="undefined"||yr==="boolean")&&(ze=null);var $t=!1;if(ze===null)$t=!0;else switch(yr){case"string":case"number":$t=!0;break;case"object":switch(ze.$$typeof){case t:case e:$t=!0}}if($t)return $t=ze,Pr=Pr($t),ze=Jt===""?"."+sr($t,0):Jt,me(Pr)?(Ht="",ze!=null&&(Ht=ze.replace(Nt,"$&/")+"/"),Ft(Pr,ht,Ht,"",function(Nr){return Nr})):Pr!=null&&(at(Pr)&&(Pr=$e(Pr,Ht+(!Pr.key||$t&&$t.key===Pr.key?"":(""+Pr.key).replace(Nt,"$&/")+"/")+ze)),ht.push(Pr)),1;if($t=0,Jt=Jt===""?".":Jt+":",me(ze))for(var pr=0;pr<ze.length;pr++){yr=ze[pr];var Qt=Jt+sr(yr,pr);$t+=Ft(yr,ht,Ht,Qt,Pr)}else if(Qt=M(ze),typeof Qt=="function")for(ze=Qt.call(ze),pr=0;!(yr=ze.next()).done;)yr=yr.value,Qt=Jt+sr(yr,pr++),$t+=Ft(yr,ht,Ht,Qt,Pr);else if(yr==="object")throw ht=String(ze),Error("Objects are not valid as a React child (found: "+(ht==="[object Object]"?"object with keys {"+Object.keys(ze).join(", ")+"}":ht)+"). If you meant to render a collection of children, use an array instead.");return $t}function Ut(ze,ht,Ht){if(ze==null)return ze;var Jt=[],Pr=0;return Ft(ze,Jt,"","",function(yr){return ht.call(Ht,yr,Pr++)}),Jt}function Lt(ze){if(ze._status===-1){var ht=ze._result;ht=ht(),ht.then(function(Ht){(ze._status===0||ze._status===-1)&&(ze._status=1,ze._result=Ht)},function(Ht){(ze._status===0||ze._status===-1)&&(ze._status=2,ze._result=Ht)}),ze._status===-1&&(ze._status=0,ze._result=ht)}if(ze._status===1)return ze._result.default;throw ze._result}var At={current:null},Ke={transition:null},ft={ReactCurrentDispatcher:At,ReactCurrentBatchConfig:Ke,ReactCurrentOwner:Me};function Tt(){throw Error("act(...) is not supported in production builds of React.")}return Hr.Children={map:Ut,forEach:function(ze,ht,Ht){Ut(ze,function(){ht.apply(this,arguments)},Ht)},count:function(ze){var ht=0;return Ut(ze,function(){ht++}),ht},toArray:function(ze){return Ut(ze,function(ht){return ht})||[]},only:function(ze){if(!at(ze))throw Error("React.Children.only expected to receive a single React element child.");return ze}},Hr.Component=q,Hr.Fragment=r,Hr.Profiler=n,Hr.PureComponent=ie,Hr.StrictMode=i,Hr.Suspense=m,Hr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ft,Hr.act=Tt,Hr.cloneElement=function(ze,ht,Ht){if(ze==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+ze+".");var Jt=G({},ze.props),Pr=ze.key,yr=ze.ref,$t=ze._owner;if(ht!=null){if(ht.ref!==void 0&&(yr=ht.ref,$t=Me.current),ht.key!==void 0&&(Pr=""+ht.key),ze.type&&ze.type.defaultProps)var pr=ze.type.defaultProps;for(Qt in ht)Se.call(ht,Qt)&&!Ve.hasOwnProperty(Qt)&&(Jt[Qt]=ht[Qt]===void 0&&pr!==void 0?pr[Qt]:ht[Qt])}var Qt=arguments.length-2;if(Qt===1)Jt.children=Ht;else if(1<Qt){pr=Array(Qt);for(var Nr=0;Nr<Qt;Nr++)pr[Nr]=arguments[Nr+2];Jt.children=pr}return{$$typeof:t,type:ze.type,key:Pr,ref:yr,props:Jt,_owner:$t}},Hr.createContext=function(ze){return ze={$$typeof:c,_currentValue:ze,_currentValue2:ze,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},ze.Provider={$$typeof:l,_context:ze},ze.Consumer=ze},Hr.createElement=Be,Hr.createFactory=function(ze){var ht=Be.bind(null,ze);return ht.type=ze,ht},Hr.createRef=function(){return{current:null}},Hr.forwardRef=function(ze){return{$$typeof:o,render:ze}},Hr.isValidElement=at,Hr.lazy=function(ze){return{$$typeof:A,_payload:{_status:-1,_result:ze},_init:Lt}},Hr.memo=function(ze,ht){return{$$typeof:b,type:ze,compare:ht===void 0?null:ht}},Hr.startTransition=function(ze){var ht=Ke.transition;Ke.transition={};try{ze()}finally{Ke.transition=ht}},Hr.unstable_act=Tt,Hr.useCallback=function(ze,ht){return At.current.useCallback(ze,ht)},Hr.useContext=function(ze){return At.current.useContext(ze)},Hr.useDebugValue=function(){},Hr.useDeferredValue=function(ze){return At.current.useDeferredValue(ze)},Hr.useEffect=function(ze,ht){return At.current.useEffect(ze,ht)},Hr.useId=function(){return At.current.useId()},Hr.useImperativeHandle=function(ze,ht,Ht){return At.current.useImperativeHandle(ze,ht,Ht)},Hr.useInsertionEffect=function(ze,ht){return At.current.useInsertionEffect(ze,ht)},Hr.useLayoutEffect=function(ze,ht){return At.current.useLayoutEffect(ze,ht)},Hr.useMemo=function(ze,ht){return At.current.useMemo(ze,ht)},Hr.useReducer=function(ze,ht,Ht){return At.current.useReducer(ze,ht,Ht)},Hr.useRef=function(ze){return At.current.useRef(ze)},Hr.useState=function(ze){return At.current.useState(ze)},Hr.useSyncExternalStore=function(ze,ht,Ht){return At.current.useSyncExternalStore(ze,ht,Ht)},Hr.useTransition=function(){return At.current.useTransition()},Hr.version="18.3.1",Hr}var PS;function R1(){return PS||(PS=1,Vb.exports=rN()),Vb.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var RS;function iN(){if(RS)return E_;RS=1;var t=R1(),e=Symbol.for("react.element"),r=Symbol.for("react.fragment"),i=Object.prototype.hasOwnProperty,n=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function c(o,m,b){var A,R={},M=null,L=null;b!==void 0&&(M=""+b),m.key!==void 0&&(M=""+m.key),m.ref!==void 0&&(L=m.ref);for(A in m)i.call(m,A)&&!l.hasOwnProperty(A)&&(R[A]=m[A]);if(o&&o.defaultProps)for(A in m=o.defaultProps,m)R[A]===void 0&&(R[A]=m[A]);return{$$typeof:e,type:o,key:M,ref:L,props:R,_owner:n.current}}return E_.Fragment=r,E_.jsx=c,E_.jsxs=c,E_}var MS;function nN(){return MS||(MS=1,Ub.exports=iN()),Ub.exports}var j=nN(),L0={},Gb={exports:{}},pa={},Hb={exports:{}},$b={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var IS;function sN(){return IS||(IS=1,(function(t){function e(Ke,ft){var Tt=Ke.length;Ke.push(ft);e:for(;0<Tt;){var ze=Tt-1>>>1,ht=Ke[ze];if(0<n(ht,ft))Ke[ze]=ft,Ke[Tt]=ht,Tt=ze;else break e}}function r(Ke){return Ke.length===0?null:Ke[0]}function i(Ke){if(Ke.length===0)return null;var ft=Ke[0],Tt=Ke.pop();if(Tt!==ft){Ke[0]=Tt;e:for(var ze=0,ht=Ke.length,Ht=ht>>>1;ze<Ht;){var Jt=2*(ze+1)-1,Pr=Ke[Jt],yr=Jt+1,$t=Ke[yr];if(0>n(Pr,Tt))yr<ht&&0>n($t,Pr)?(Ke[ze]=$t,Ke[yr]=Tt,ze=yr):(Ke[ze]=Pr,Ke[Jt]=Tt,ze=Jt);else if(yr<ht&&0>n($t,Tt))Ke[ze]=$t,Ke[yr]=Tt,ze=yr;else break e}}return ft}function n(Ke,ft){var Tt=Ke.sortIndex-ft.sortIndex;return Tt!==0?Tt:Ke.id-ft.id}if(typeof performance=="object"&&typeof performance.now=="function"){var l=performance;t.unstable_now=function(){return l.now()}}else{var c=Date,o=c.now();t.unstable_now=function(){return c.now()-o}}var m=[],b=[],A=1,R=null,M=3,L=!1,G=!1,V=!1,q=typeof setTimeout=="function"?setTimeout:null,J=typeof clearTimeout=="function"?clearTimeout:null,ie=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function ee(Ke){for(var ft=r(b);ft!==null;){if(ft.callback===null)i(b);else if(ft.startTime<=Ke)i(b),ft.sortIndex=ft.expirationTime,e(m,ft);else break;ft=r(b)}}function me(Ke){if(V=!1,ee(Ke),!G)if(r(m)!==null)G=!0,Lt(Se);else{var ft=r(b);ft!==null&&At(me,ft.startTime-Ke)}}function Se(Ke,ft){G=!1,V&&(V=!1,J(Be),Be=-1),L=!0;var Tt=M;try{for(ee(ft),R=r(m);R!==null&&(!(R.expirationTime>ft)||Ke&&!_t());){var ze=R.callback;if(typeof ze=="function"){R.callback=null,M=R.priorityLevel;var ht=ze(R.expirationTime<=ft);ft=t.unstable_now(),typeof ht=="function"?R.callback=ht:R===r(m)&&i(m),ee(ft)}else i(m);R=r(m)}if(R!==null)var Ht=!0;else{var Jt=r(b);Jt!==null&&At(me,Jt.startTime-ft),Ht=!1}return Ht}finally{R=null,M=Tt,L=!1}}var Me=!1,Ve=null,Be=-1,$e=5,at=-1;function _t(){return!(t.unstable_now()-at<$e)}function Nt(){if(Ve!==null){var Ke=t.unstable_now();at=Ke;var ft=!0;try{ft=Ve(!0,Ke)}finally{ft?sr():(Me=!1,Ve=null)}}else Me=!1}var sr;if(typeof ie=="function")sr=function(){ie(Nt)};else if(typeof MessageChannel<"u"){var Ft=new MessageChannel,Ut=Ft.port2;Ft.port1.onmessage=Nt,sr=function(){Ut.postMessage(null)}}else sr=function(){q(Nt,0)};function Lt(Ke){Ve=Ke,Me||(Me=!0,sr())}function At(Ke,ft){Be=q(function(){Ke(t.unstable_now())},ft)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(Ke){Ke.callback=null},t.unstable_continueExecution=function(){G||L||(G=!0,Lt(Se))},t.unstable_forceFrameRate=function(Ke){0>Ke||125<Ke?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):$e=0<Ke?Math.floor(1e3/Ke):5},t.unstable_getCurrentPriorityLevel=function(){return M},t.unstable_getFirstCallbackNode=function(){return r(m)},t.unstable_next=function(Ke){switch(M){case 1:case 2:case 3:var ft=3;break;default:ft=M}var Tt=M;M=ft;try{return Ke()}finally{M=Tt}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(Ke,ft){switch(Ke){case 1:case 2:case 3:case 4:case 5:break;default:Ke=3}var Tt=M;M=Ke;try{return ft()}finally{M=Tt}},t.unstable_scheduleCallback=function(Ke,ft,Tt){var ze=t.unstable_now();switch(typeof Tt=="object"&&Tt!==null?(Tt=Tt.delay,Tt=typeof Tt=="number"&&0<Tt?ze+Tt:ze):Tt=ze,Ke){case 1:var ht=-1;break;case 2:ht=250;break;case 5:ht=1073741823;break;case 4:ht=1e4;break;default:ht=5e3}return ht=Tt+ht,Ke={id:A++,callback:ft,priorityLevel:Ke,startTime:Tt,expirationTime:ht,sortIndex:-1},Tt>ze?(Ke.sortIndex=Tt,e(b,Ke),r(m)===null&&Ke===r(b)&&(V?(J(Be),Be=-1):V=!0,At(me,Tt-ze))):(Ke.sortIndex=ht,e(m,Ke),G||L||(G=!0,Lt(Se))),Ke},t.unstable_shouldYield=_t,t.unstable_wrapCallback=function(Ke){var ft=M;return function(){var Tt=M;M=ft;try{return Ke.apply(this,arguments)}finally{M=Tt}}}})($b)),$b}var kS;function oN(){return kS||(kS=1,Hb.exports=sN()),Hb.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var BS;function aN(){if(BS)return pa;BS=1;var t=R1(),e=oN();function r(f){for(var _="https://reactjs.org/docs/error-decoder.html?invariant="+f,S=1;S<arguments.length;S++)_+="&args[]="+encodeURIComponent(arguments[S]);return"Minified React error #"+f+"; visit "+_+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var i=new Set,n={};function l(f,_){c(f,_),c(f+"Capture",_)}function c(f,_){for(n[f]=_,f=0;f<_.length;f++)i.add(_[f])}var o=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),m=Object.prototype.hasOwnProperty,b=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,A={},R={};function M(f){return m.call(R,f)?!0:m.call(A,f)?!1:b.test(f)?R[f]=!0:(A[f]=!0,!1)}function L(f,_,S,I){if(S!==null&&S.type===0)return!1;switch(typeof _){case"function":case"symbol":return!0;case"boolean":return I?!1:S!==null?!S.acceptsBooleans:(f=f.toLowerCase().slice(0,5),f!=="data-"&&f!=="aria-");default:return!1}}function G(f,_,S,I){if(_===null||typeof _>"u"||L(f,_,S,I))return!0;if(I)return!1;if(S!==null)switch(S.type){case 3:return!_;case 4:return _===!1;case 5:return isNaN(_);case 6:return isNaN(_)||1>_}return!1}function V(f,_,S,I,N,H,le){this.acceptsBooleans=_===2||_===3||_===4,this.attributeName=I,this.attributeNamespace=N,this.mustUseProperty=S,this.propertyName=f,this.type=_,this.sanitizeURL=H,this.removeEmptyString=le}var q={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(f){q[f]=new V(f,0,!1,f,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(f){var _=f[0];q[_]=new V(_,1,!1,f[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(f){q[f]=new V(f,2,!1,f.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(f){q[f]=new V(f,2,!1,f,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(f){q[f]=new V(f,3,!1,f.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(f){q[f]=new V(f,3,!0,f,null,!1,!1)}),["capture","download"].forEach(function(f){q[f]=new V(f,4,!1,f,null,!1,!1)}),["cols","rows","size","span"].forEach(function(f){q[f]=new V(f,6,!1,f,null,!1,!1)}),["rowSpan","start"].forEach(function(f){q[f]=new V(f,5,!1,f.toLowerCase(),null,!1,!1)});var J=/[\-:]([a-z])/g;function ie(f){return f[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(f){var _=f.replace(J,ie);q[_]=new V(_,1,!1,f,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(f){var _=f.replace(J,ie);q[_]=new V(_,1,!1,f,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(f){var _=f.replace(J,ie);q[_]=new V(_,1,!1,f,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(f){q[f]=new V(f,1,!1,f.toLowerCase(),null,!1,!1)}),q.xlinkHref=new V("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(f){q[f]=new V(f,1,!1,f.toLowerCase(),null,!0,!0)});function ee(f,_,S,I){var N=q.hasOwnProperty(_)?q[_]:null;(N!==null?N.type!==0:I||!(2<_.length)||_[0]!=="o"&&_[0]!=="O"||_[1]!=="n"&&_[1]!=="N")&&(G(_,S,N,I)&&(S=null),I||N===null?M(_)&&(S===null?f.removeAttribute(_):f.setAttribute(_,""+S)):N.mustUseProperty?f[N.propertyName]=S===null?N.type===3?!1:"":S:(_=N.attributeName,I=N.attributeNamespace,S===null?f.removeAttribute(_):(N=N.type,S=N===3||N===4&&S===!0?"":""+S,I?f.setAttributeNS(I,_,S):f.setAttribute(_,S))))}var me=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Se=Symbol.for("react.element"),Me=Symbol.for("react.portal"),Ve=Symbol.for("react.fragment"),Be=Symbol.for("react.strict_mode"),$e=Symbol.for("react.profiler"),at=Symbol.for("react.provider"),_t=Symbol.for("react.context"),Nt=Symbol.for("react.forward_ref"),sr=Symbol.for("react.suspense"),Ft=Symbol.for("react.suspense_list"),Ut=Symbol.for("react.memo"),Lt=Symbol.for("react.lazy"),At=Symbol.for("react.offscreen"),Ke=Symbol.iterator;function ft(f){return f===null||typeof f!="object"?null:(f=Ke&&f[Ke]||f["@@iterator"],typeof f=="function"?f:null)}var Tt=Object.assign,ze;function ht(f){if(ze===void 0)try{throw Error()}catch(S){var _=S.stack.trim().match(/\n( *(at )?)/);ze=_&&_[1]||""}return`
`+ze+f}var Ht=!1;function Jt(f,_){if(!f||Ht)return"";Ht=!0;var S=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(_)if(_=function(){throw Error()},Object.defineProperty(_.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(_,[])}catch(ot){var I=ot}Reflect.construct(f,[],_)}else{try{_.call()}catch(ot){I=ot}f.call(_.prototype)}else{try{throw Error()}catch(ot){I=ot}f()}}catch(ot){if(ot&&I&&typeof ot.stack=="string"){for(var N=ot.stack.split(`
`),H=I.stack.split(`
`),le=N.length-1,Ae=H.length-1;1<=le&&0<=Ae&&N[le]!==H[Ae];)Ae--;for(;1<=le&&0<=Ae;le--,Ae--)if(N[le]!==H[Ae]){if(le!==1||Ae!==1)do if(le--,Ae--,0>Ae||N[le]!==H[Ae]){var Le=`
`+N[le].replace(" at new "," at ");return f.displayName&&Le.includes("<anonymous>")&&(Le=Le.replace("<anonymous>",f.displayName)),Le}while(1<=le&&0<=Ae);break}}}finally{Ht=!1,Error.prepareStackTrace=S}return(f=f?f.displayName||f.name:"")?ht(f):""}function Pr(f){switch(f.tag){case 5:return ht(f.type);case 16:return ht("Lazy");case 13:return ht("Suspense");case 19:return ht("SuspenseList");case 0:case 2:case 15:return f=Jt(f.type,!1),f;case 11:return f=Jt(f.type.render,!1),f;case 1:return f=Jt(f.type,!0),f;default:return""}}function yr(f){if(f==null)return null;if(typeof f=="function")return f.displayName||f.name||null;if(typeof f=="string")return f;switch(f){case Ve:return"Fragment";case Me:return"Portal";case $e:return"Profiler";case Be:return"StrictMode";case sr:return"Suspense";case Ft:return"SuspenseList"}if(typeof f=="object")switch(f.$$typeof){case _t:return(f.displayName||"Context")+".Consumer";case at:return(f._context.displayName||"Context")+".Provider";case Nt:var _=f.render;return f=f.displayName,f||(f=_.displayName||_.name||"",f=f!==""?"ForwardRef("+f+")":"ForwardRef"),f;case Ut:return _=f.displayName||null,_!==null?_:yr(f.type)||"Memo";case Lt:_=f._payload,f=f._init;try{return yr(f(_))}catch{}}return null}function $t(f){var _=f.type;switch(f.tag){case 24:return"Cache";case 9:return(_.displayName||"Context")+".Consumer";case 10:return(_._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return f=_.render,f=f.displayName||f.name||"",_.displayName||(f!==""?"ForwardRef("+f+")":"ForwardRef");case 7:return"Fragment";case 5:return _;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return yr(_);case 8:return _===Be?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof _=="function")return _.displayName||_.name||null;if(typeof _=="string")return _}return null}function pr(f){switch(typeof f){case"boolean":case"number":case"string":case"undefined":return f;case"object":return f;default:return""}}function Qt(f){var _=f.type;return(f=f.nodeName)&&f.toLowerCase()==="input"&&(_==="checkbox"||_==="radio")}function Nr(f){var _=Qt(f)?"checked":"value",S=Object.getOwnPropertyDescriptor(f.constructor.prototype,_),I=""+f[_];if(!f.hasOwnProperty(_)&&typeof S<"u"&&typeof S.get=="function"&&typeof S.set=="function"){var N=S.get,H=S.set;return Object.defineProperty(f,_,{configurable:!0,get:function(){return N.call(this)},set:function(le){I=""+le,H.call(this,le)}}),Object.defineProperty(f,_,{enumerable:S.enumerable}),{getValue:function(){return I},setValue:function(le){I=""+le},stopTracking:function(){f._valueTracker=null,delete f[_]}}}}function An(f){f._valueTracker||(f._valueTracker=Nr(f))}function wi(f){if(!f)return!1;var _=f._valueTracker;if(!_)return!0;var S=_.getValue(),I="";return f&&(I=Qt(f)?f.checked?"true":"false":f.value),f=I,f!==S?(_.setValue(f),!0):!1}function Zr(f){if(f=f||(typeof document<"u"?document:void 0),typeof f>"u")return null;try{return f.activeElement||f.body}catch{return f.body}}function si(f,_){var S=_.checked;return Tt({},_,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:S??f._wrapperState.initialChecked})}function Tn(f,_){var S=_.defaultValue==null?"":_.defaultValue,I=_.checked!=null?_.checked:_.defaultChecked;S=pr(_.value!=null?_.value:S),f._wrapperState={initialChecked:I,initialValue:S,controlled:_.type==="checkbox"||_.type==="radio"?_.checked!=null:_.value!=null}}function zi(f,_){_=_.checked,_!=null&&ee(f,"checked",_,!1)}function Ln(f,_){zi(f,_);var S=pr(_.value),I=_.type;if(S!=null)I==="number"?(S===0&&f.value===""||f.value!=S)&&(f.value=""+S):f.value!==""+S&&(f.value=""+S);else if(I==="submit"||I==="reset"){f.removeAttribute("value");return}_.hasOwnProperty("value")?ns(f,_.type,S):_.hasOwnProperty("defaultValue")&&ns(f,_.type,pr(_.defaultValue)),_.checked==null&&_.defaultChecked!=null&&(f.defaultChecked=!!_.defaultChecked)}function Ps(f,_,S){if(_.hasOwnProperty("value")||_.hasOwnProperty("defaultValue")){var I=_.type;if(!(I!=="submit"&&I!=="reset"||_.value!==void 0&&_.value!==null))return;_=""+f._wrapperState.initialValue,S||_===f.value||(f.value=_),f.defaultValue=_}S=f.name,S!==""&&(f.name=""),f.defaultChecked=!!f._wrapperState.initialChecked,S!==""&&(f.name=S)}function ns(f,_,S){(_!=="number"||Zr(f.ownerDocument)!==f)&&(S==null?f.defaultValue=""+f._wrapperState.initialValue:f.defaultValue!==""+S&&(f.defaultValue=""+S))}var ss=Array.isArray;function vi(f,_,S,I){if(f=f.options,_){_={};for(var N=0;N<S.length;N++)_["$"+S[N]]=!0;for(S=0;S<f.length;S++)N=_.hasOwnProperty("$"+f[S].value),f[S].selected!==N&&(f[S].selected=N),N&&I&&(f[S].defaultSelected=!0)}else{for(S=""+pr(S),_=null,N=0;N<f.length;N++){if(f[N].value===S){f[N].selected=!0,I&&(f[N].defaultSelected=!0);return}_!==null||f[N].disabled||(_=f[N])}_!==null&&(_.selected=!0)}}function lo(f,_){if(_.dangerouslySetInnerHTML!=null)throw Error(r(91));return Tt({},_,{value:void 0,defaultValue:void 0,children:""+f._wrapperState.initialValue})}function Po(f,_){var S=_.value;if(S==null){if(S=_.children,_=_.defaultValue,S!=null){if(_!=null)throw Error(r(92));if(ss(S)){if(1<S.length)throw Error(r(93));S=S[0]}_=S}_==null&&(_=""),S=_}f._wrapperState={initialValue:pr(S)}}function ea(f,_){var S=pr(_.value),I=pr(_.defaultValue);S!=null&&(S=""+S,S!==f.value&&(f.value=S),_.defaultValue==null&&f.defaultValue!==S&&(f.defaultValue=S)),I!=null&&(f.defaultValue=""+I)}function Ro(f){var _=f.textContent;_===f._wrapperState.initialValue&&_!==""&&_!==null&&(f.value=_)}function Mo(f){switch(f){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Gs(f,_){return f==null||f==="http://www.w3.org/1999/xhtml"?Mo(_):f==="http://www.w3.org/2000/svg"&&_==="foreignObject"?"http://www.w3.org/1999/xhtml":f}var co,Oe=(function(f){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(_,S,I,N){MSApp.execUnsafeLocalFunction(function(){return f(_,S,I,N)})}:f})(function(f,_){if(f.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in f)f.innerHTML=_;else{for(co=co||document.createElement("div"),co.innerHTML="<svg>"+_.valueOf().toString()+"</svg>",_=co.firstChild;f.firstChild;)f.removeChild(f.firstChild);for(;_.firstChild;)f.appendChild(_.firstChild)}});function ne(f,_){if(_){var S=f.firstChild;if(S&&S===f.lastChild&&S.nodeType===3){S.nodeValue=_;return}}f.textContent=_}var se={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},ce=["Webkit","ms","Moz","O"];Object.keys(se).forEach(function(f){ce.forEach(function(_){_=_+f.charAt(0).toUpperCase()+f.substring(1),se[_]=se[f]})});function xe(f,_,S){return _==null||typeof _=="boolean"||_===""?"":S||typeof _!="number"||_===0||se.hasOwnProperty(f)&&se[f]?(""+_).trim():_+"px"}function Ce(f,_){f=f.style;for(var S in _)if(_.hasOwnProperty(S)){var I=S.indexOf("--")===0,N=xe(S,_[S],I);S==="float"&&(S="cssFloat"),I?f.setProperty(S,N):f[S]=N}}var je=Tt({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Ye(f,_){if(_){if(je[f]&&(_.children!=null||_.dangerouslySetInnerHTML!=null))throw Error(r(137,f));if(_.dangerouslySetInnerHTML!=null){if(_.children!=null)throw Error(r(60));if(typeof _.dangerouslySetInnerHTML!="object"||!("__html"in _.dangerouslySetInnerHTML))throw Error(r(61))}if(_.style!=null&&typeof _.style!="object")throw Error(r(62))}}function De(f,_){if(f.indexOf("-")===-1)return typeof _.is=="string";switch(f){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var nt=null;function dt(f){return f=f.target||f.srcElement||window,f.correspondingUseElement&&(f=f.correspondingUseElement),f.nodeType===3?f.parentNode:f}var lt=null,Dt=null,Ne=null;function ar(f){if(f=ru(f)){if(typeof lt!="function")throw Error(r(280));var _=f.stateNode;_&&(_=eh(_),lt(f.stateNode,f.type,_))}}function Rr(f){Dt?Ne?Ne.push(f):Ne=[f]:Dt=f}function Wt(){if(Dt){var f=Dt,_=Ne;if(Ne=Dt=null,ar(f),_)for(f=0;f<_.length;f++)ar(_[f])}}function vr(f,_){return f(_)}function Xr(){}var Ii=!1;function ji(f,_,S){if(Ii)return f(_,S);Ii=!0;try{return vr(f,_,S)}finally{Ii=!1,(Dt!==null||Ne!==null)&&(Xr(),Wt())}}function fi(f,_){var S=f.stateNode;if(S===null)return null;var I=eh(S);if(I===null)return null;S=I[_];e:switch(_){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(I=!I.disabled)||(f=f.type,I=!(f==="button"||f==="input"||f==="select"||f==="textarea")),f=!I;break e;default:f=!1}if(f)return null;if(S&&typeof S!="function")throw Error(r(231,_,typeof S));return S}var Tr=!1;if(o)try{var kr={};Object.defineProperty(kr,"passive",{get:function(){Tr=!0}}),window.addEventListener("test",kr,kr),window.removeEventListener("test",kr,kr)}catch{Tr=!1}function Ui(f,_,S,I,N,H,le,Ae,Le){var ot=Array.prototype.slice.call(arguments,3);try{_.apply(S,ot)}catch(xt){this.onError(xt)}}var yt=!1,ki=null,li=!1,Hs=null,nl={onError:function(f){yt=!0,ki=f}};function St(f,_,S,I,N,H,le,Ae,Le){yt=!1,ki=null,Ui.apply(nl,arguments)}function Mr(f,_,S,I,N,H,le,Ae,Le){if(St.apply(this,arguments),yt){if(yt){var ot=ki;yt=!1,ki=null}else throw Error(r(198));li||(li=!0,Hs=ot)}}function hr(f){var _=f,S=f;if(f.alternate)for(;_.return;)_=_.return;else{f=_;do _=f,(_.flags&4098)!==0&&(S=_.return),f=_.return;while(f)}return _.tag===3?S:null}function Ki(f){if(f.tag===13){var _=f.memoizedState;if(_===null&&(f=f.alternate,f!==null&&(_=f.memoizedState)),_!==null)return _.dehydrated}return null}function uo(f){if(hr(f)!==f)throw Error(r(188))}function Wn(f){var _=f.alternate;if(!_){if(_=hr(f),_===null)throw Error(r(188));return _!==f?null:f}for(var S=f,I=_;;){var N=S.return;if(N===null)break;var H=N.alternate;if(H===null){if(I=N.return,I!==null){S=I;continue}break}if(N.child===H.child){for(H=N.child;H;){if(H===S)return uo(N),f;if(H===I)return uo(N),_;H=H.sibling}throw Error(r(188))}if(S.return!==I.return)S=N,I=H;else{for(var le=!1,Ae=N.child;Ae;){if(Ae===S){le=!0,S=N,I=H;break}if(Ae===I){le=!0,I=N,S=H;break}Ae=Ae.sibling}if(!le){for(Ae=H.child;Ae;){if(Ae===S){le=!0,S=H,I=N;break}if(Ae===I){le=!0,I=H,S=N;break}Ae=Ae.sibling}if(!le)throw Error(r(189))}}if(S.alternate!==I)throw Error(r(190))}if(S.tag!==3)throw Error(r(188));return S.stateNode.current===S?f:_}function fr(f){return f=Wn(f),f!==null?Io(f):null}function Io(f){if(f.tag===5||f.tag===6)return f;for(f=f.child;f!==null;){var _=Io(f);if(_!==null)return _;f=f.sibling}return null}var Rs=e.unstable_scheduleCallback,wa=e.unstable_cancelCallback,ho=e.unstable_shouldYield,sl=e.unstable_requestPaint,wr=e.unstable_now,On=e.unstable_getCurrentPriorityLevel,Bi=e.unstable_ImmediatePriority,Fr=e.unstable_UserBlockingPriority,os=e.unstable_NormalPriority,ko=e.unstable_LowPriority,as=e.unstable_IdlePriority,Zi=null,sn=null;function Lc(f){if(sn&&typeof sn.onCommitFiberRoot=="function")try{sn.onCommitFiberRoot(Zi,f,void 0,(f.current.flags&128)===128)}catch{}}var Dn=Math.clz32?Math.clz32:Oc,Ms=Math.log,Bo=Math.LN2;function Oc(f){return f>>>=0,f===0?32:31-(Ms(f)/Bo|0)|0}var ol=64,al=4194304;function Ea(f){switch(f&-f){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return f&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return f&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return f}}function Lo(f,_){var S=f.pendingLanes;if(S===0)return 0;var I=0,N=f.suspendedLanes,H=f.pingedLanes,le=S&268435455;if(le!==0){var Ae=le&~N;Ae!==0?I=Ea(Ae):(H&=le,H!==0&&(I=Ea(H)))}else le=S&~N,le!==0?I=Ea(le):H!==0&&(I=Ea(H));if(I===0)return 0;if(_!==0&&_!==I&&(_&N)===0&&(N=I&-I,H=_&-_,N>=H||N===16&&(H&4194240)!==0))return _;if((I&4)!==0&&(I|=S&16),_=f.entangledLanes,_!==0)for(f=f.entanglements,_&=I;0<_;)S=31-Dn(_),N=1<<S,I|=f[S],_&=~N;return I}function ls(f,_){switch(f){case 1:case 2:case 4:return _+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return _+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Lu(f,_){for(var S=f.suspendedLanes,I=f.pingedLanes,N=f.expirationTimes,H=f.pendingLanes;0<H;){var le=31-Dn(H),Ae=1<<le,Le=N[le];Le===-1?((Ae&S)===0||(Ae&I)!==0)&&(N[le]=ls(Ae,_)):Le<=_&&(f.expiredLanes|=Ae),H&=~Ae}}function ll(f){return f=f.pendingLanes&-1073741825,f!==0?f:f&1073741824?1073741824:0}function Oo(){var f=ol;return ol<<=1,(ol&4194240)===0&&(ol=64),f}function cl(f){for(var _=[],S=0;31>S;S++)_.push(f);return _}function Aa(f,_,S){f.pendingLanes|=_,_!==536870912&&(f.suspendedLanes=0,f.pingedLanes=0),f=f.eventTimes,_=31-Dn(_),f[_]=S}function Zd(f,_){var S=f.pendingLanes&~_;f.pendingLanes=_,f.suspendedLanes=0,f.pingedLanes=0,f.expiredLanes&=_,f.mutableReadLanes&=_,f.entangledLanes&=_,_=f.entanglements;var I=f.eventTimes;for(f=f.expirationTimes;0<S;){var N=31-Dn(S),H=1<<N;_[N]=0,I[N]=-1,f[N]=-1,S&=~H}}function ae(f,_){var S=f.entangledLanes|=_;for(f=f.entanglements;S;){var I=31-Dn(S),N=1<<I;N&_|f[I]&_&&(f[I]|=_),S&=~N}}var he=0;function Pe(f){return f&=-f,1<f?4<f?(f&268435455)!==0?16:536870912:4:1}var We,mt,Zt,Er,Wr,lr=!1,Ti=[],Vi=null,Do=null,Gi=null,Hi=new Map,fn=new Map,pi=[],ci="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Xd(f,_){switch(f){case"focusin":case"focusout":Vi=null;break;case"dragenter":case"dragleave":Do=null;break;case"mouseover":case"mouseout":Gi=null;break;case"pointerover":case"pointerout":Hi.delete(_.pointerId);break;case"gotpointercapture":case"lostpointercapture":fn.delete(_.pointerId)}}function pn(f,_,S,I,N,H){return f===null||f.nativeEvent!==H?(f={blockedOn:_,domEventName:S,eventSystemFlags:I,nativeEvent:H,targetContainers:[N]},_!==null&&(_=ru(_),_!==null&&mt(_)),f):(f.eventSystemFlags|=I,_=f.targetContainers,N!==null&&_.indexOf(N)===-1&&_.push(N),f)}function $s(f,_,S,I,N){switch(_){case"focusin":return Vi=pn(Vi,f,_,S,I,N),!0;case"dragenter":return Do=pn(Do,f,_,S,I,N),!0;case"mouseover":return Gi=pn(Gi,f,_,S,I,N),!0;case"pointerover":var H=N.pointerId;return Hi.set(H,pn(Hi.get(H)||null,f,_,S,I,N)),!0;case"gotpointercapture":return H=N.pointerId,fn.set(H,pn(fn.get(H)||null,f,_,S,I,N)),!0}return!1}function Nn(f){var _=Oa(f.target);if(_!==null){var S=hr(_);if(S!==null){if(_=S.tag,_===13){if(_=Ki(S),_!==null){f.blockedOn=_,Wr(f.priority,function(){Zt(S)});return}}else if(_===3&&S.stateNode.current.memoizedState.isDehydrated){f.blockedOn=S.tag===3?S.stateNode.containerInfo:null;return}}}f.blockedOn=null}function oi(f){if(f.blockedOn!==null)return!1;for(var _=f.targetContainers;0<_.length;){var S=hl(f.domEventName,f.eventSystemFlags,_[0],f.nativeEvent);if(S===null){S=f.nativeEvent;var I=new S.constructor(S.type,S);nt=I,S.target.dispatchEvent(I),nt=null}else return _=ru(S),_!==null&&mt(_),f.blockedOn=S,!1;_.shift()}return!0}function ul(f,_,S){oi(f)&&S.delete(_)}function cr(){lr=!1,Vi!==null&&oi(Vi)&&(Vi=null),Do!==null&&oi(Do)&&(Do=null),Gi!==null&&oi(Gi)&&(Gi=null),Hi.forEach(ul),fn.forEach(ul)}function mr(f,_){f.blockedOn===_&&(f.blockedOn=null,lr||(lr=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,cr)))}function Ws(f){function _(N){return mr(N,f)}if(0<Ti.length){mr(Ti[0],f);for(var S=1;S<Ti.length;S++){var I=Ti[S];I.blockedOn===f&&(I.blockedOn=null)}}for(Vi!==null&&mr(Vi,f),Do!==null&&mr(Do,f),Gi!==null&&mr(Gi,f),Hi.forEach(_),fn.forEach(_),S=0;S<pi.length;S++)I=pi[S],I.blockedOn===f&&(I.blockedOn=null);for(;0<pi.length&&(S=pi[0],S.blockedOn===null);)Nn(S),S.blockedOn===null&&pi.shift()}var Br=me.ReactCurrentBatchConfig,qn=!0;function ta(f,_,S,I){var N=he,H=Br.transition;Br.transition=null;try{he=1,Dc(f,_,S,I)}finally{he=N,Br.transition=H}}function ra(f,_,S,I){var N=he,H=Br.transition;Br.transition=null;try{he=4,Dc(f,_,S,I)}finally{he=N,Br.transition=H}}function Dc(f,_,S,I){if(qn){var N=hl(f,_,S,I);if(N===null)Yl(f,_,I,Nc,S),Xd(f,I);else if($s(N,f,_,S,I))I.stopPropagation();else if(Xd(f,I),_&4&&-1<ci.indexOf(f)){for(;N!==null;){var H=ru(N);if(H!==null&&We(H),H=hl(f,_,S,I),H===null&&Yl(f,_,I,Nc,S),H===N)break;N=H}N!==null&&I.stopPropagation()}else Yl(f,_,I,null,S)}}var Nc=null;function hl(f,_,S,I){if(Nc=null,f=dt(I),f=Oa(f),f!==null)if(_=hr(f),_===null)f=null;else if(S=_.tag,S===13){if(f=Ki(_),f!==null)return f;f=null}else if(S===3){if(_.stateNode.current.memoizedState.isDehydrated)return _.tag===3?_.stateNode.containerInfo:null;f=null}else _!==f&&(f=null);return Nc=f,null}function Fc(f){switch(f){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(On()){case Bi:return 1;case Fr:return 4;case os:case ko:return 16;case as:return 536870912;default:return 16}default:return 16}}var No=null,zc=null,Hl=null;function fo(){if(Hl)return Hl;var f,_=zc,S=_.length,I,N="value"in No?No.value:No.textContent,H=N.length;for(f=0;f<S&&_[f]===N[f];f++);var le=S-f;for(I=1;I<=le&&_[S-I]===N[H-I];I++);return Hl=N.slice(f,1<I?1-I:void 0)}function Xi(f){var _=f.keyCode;return"charCode"in f?(f=f.charCode,f===0&&_===13&&(f=13)):f=_,f===10&&(f=13),32<=f||f===13?f:0}function Ta(){return!0}function jc(){return!1}function mn(f){function _(S,I,N,H,le){this._reactName=S,this._targetInst=N,this.type=I,this.nativeEvent=H,this.target=le,this.currentTarget=null;for(var Ae in f)f.hasOwnProperty(Ae)&&(S=f[Ae],this[Ae]=S?S(H):H[Ae]);return this.isDefaultPrevented=(H.defaultPrevented!=null?H.defaultPrevented:H.returnValue===!1)?Ta:jc,this.isPropagationStopped=jc,this}return Tt(_.prototype,{preventDefault:function(){this.defaultPrevented=!0;var S=this.nativeEvent;S&&(S.preventDefault?S.preventDefault():typeof S.returnValue!="unknown"&&(S.returnValue=!1),this.isDefaultPrevented=Ta)},stopPropagation:function(){var S=this.nativeEvent;S&&(S.stopPropagation?S.stopPropagation():typeof S.cancelBubble!="unknown"&&(S.cancelBubble=!0),this.isPropagationStopped=Ta)},persist:function(){},isPersistent:Ta}),_}var mi={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(f){return f.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Oh=mn(mi),Sa=Tt({},mi,{view:0,detail:0}),Yd=mn(Sa),Jd,dl,Yi,fl=Tt({},Sa,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Uc,button:0,buttons:0,relatedTarget:function(f){return f.relatedTarget===void 0?f.fromElement===f.srcElement?f.toElement:f.fromElement:f.relatedTarget},movementX:function(f){return"movementX"in f?f.movementX:(f!==Yi&&(Yi&&f.type==="mousemove"?(Jd=f.screenX-Yi.screenX,dl=f.screenY-Yi.screenY):dl=Jd=0,Yi=f),Jd)},movementY:function(f){return"movementY"in f?f.movementY:dl}}),Fo=mn(fl),Ou=Tt({},fl,{dataTransfer:0}),Du=mn(Ou),Nu=Tt({},Sa,{relatedTarget:0}),Sn=mn(Nu),Np=Tt({},mi,{animationName:0,elapsedTime:0,pseudoElement:0}),Dh=mn(Np),Og=Tt({},mi,{clipboardData:function(f){return"clipboardData"in f?f.clipboardData:window.clipboardData}}),Qd=mn(Og),Dg=Tt({},mi,{data:0}),Fp=mn(Dg),Nh={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},ef={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},$l={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function tf(f){var _=this.nativeEvent;return _.getModifierState?_.getModifierState(f):(f=$l[f])?!!_[f]:!1}function Uc(){return tf}var zo=Tt({},Sa,{key:function(f){if(f.key){var _=Nh[f.key]||f.key;if(_!=="Unidentified")return _}return f.type==="keypress"?(f=Xi(f),f===13?"Enter":String.fromCharCode(f)):f.type==="keydown"||f.type==="keyup"?ef[f.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Uc,charCode:function(f){return f.type==="keypress"?Xi(f):0},keyCode:function(f){return f.type==="keydown"||f.type==="keyup"?f.keyCode:0},which:function(f){return f.type==="keypress"?Xi(f):f.type==="keydown"||f.type==="keyup"?f.keyCode:0}}),Ng=mn(zo),Fh=Tt({},fl,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Vc=mn(Fh),Fu=Tt({},Sa,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Uc}),Fg=mn(Fu),zh=Tt({},mi,{propertyName:0,elapsedTime:0,pseudoElement:0}),zg=mn(zh),Wl=Tt({},fl,{deltaX:function(f){return"deltaX"in f?f.deltaX:"wheelDeltaX"in f?-f.wheelDeltaX:0},deltaY:function(f){return"deltaY"in f?f.deltaY:"wheelDeltaY"in f?-f.wheelDeltaY:"wheelDelta"in f?-f.wheelDelta:0},deltaZ:0,deltaMode:0}),zp=mn(Wl),rf=[9,13,27,32],nf=o&&"CompositionEvent"in window,Gc=null;o&&"documentMode"in document&&(Gc=document.documentMode);var sf=o&&"TextEvent"in window&&!Gc,of=o&&(!nf||Gc&&8<Gc&&11>=Gc),zu=" ",af=!1;function lf(f,_){switch(f){case"keyup":return rf.indexOf(_.keyCode)!==-1;case"keydown":return _.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function pl(f){return f=f.detail,typeof f=="object"&&"data"in f?f.data:null}var ml=!1;function cf(f,_){switch(f){case"compositionend":return pl(_);case"keypress":return _.which!==32?null:(af=!0,zu);case"textInput":return f=_.data,f===zu&&af?null:f;default:return null}}function ju(f,_){if(ml)return f==="compositionend"||!nf&&lf(f,_)?(f=fo(),Hl=zc=No=null,ml=!1,f):null;switch(f){case"paste":return null;case"keypress":if(!(_.ctrlKey||_.altKey||_.metaKey)||_.ctrlKey&&_.altKey){if(_.char&&1<_.char.length)return _.char;if(_.which)return String.fromCharCode(_.which)}return null;case"compositionend":return of&&_.locale!=="ko"?null:_.data;default:return null}}var jg={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Hc(f){var _=f&&f.nodeName&&f.nodeName.toLowerCase();return _==="input"?!!jg[f.type]:_==="textarea"}function uf(f,_,S,I){Rr(I),_=Zu(_,"onChange"),0<_.length&&(S=new Oh("onChange","change",null,S,I),f.push({event:S,listeners:_}))}var Uu=null,$c=null;function jp(f){Hp(f,0)}function Wc(f){var _=Ql(f);if(wi(_))return f}function hf(f,_){if(f==="change")return _}var df=!1;if(o){var qc;if(o){var jo="oninput"in document;if(!jo){var Ur=document.createElement("div");Ur.setAttribute("oninput","return;"),jo=typeof Ur.oninput=="function"}qc=jo}else qc=!1;df=qc&&(!document.documentMode||9<document.documentMode)}function jh(){Uu&&(Uu.detachEvent("onpropertychange",Uh),$c=Uu=null)}function Uh(f){if(f.propertyName==="value"&&Wc($c)){var _=[];uf(_,$c,f,dt(f)),ji(jp,_)}}function Up(f,_,S){f==="focusin"?(jh(),Uu=_,$c=S,Uu.attachEvent("onpropertychange",Uh)):f==="focusout"&&jh()}function ff(f){if(f==="selectionchange"||f==="keyup"||f==="keydown")return Wc($c)}function ql(f,_){if(f==="click")return Wc(_)}function pf(f,_){if(f==="input"||f==="change")return Wc(_)}function Ug(f,_){return f===_&&(f!==0||1/f===1/_)||f!==f&&_!==_}var Uo=typeof Object.is=="function"?Object.is:Ug;function Vu(f,_){if(Uo(f,_))return!0;if(typeof f!="object"||f===null||typeof _!="object"||_===null)return!1;var S=Object.keys(f),I=Object.keys(_);if(S.length!==I.length)return!1;for(I=0;I<S.length;I++){var N=S[I];if(!m.call(_,N)||!Uo(f[N],_[N]))return!1}return!0}function Vp(f){for(;f&&f.firstChild;)f=f.firstChild;return f}function mf(f,_){var S=Vp(f);f=0;for(var I;S;){if(S.nodeType===3){if(I=f+S.textContent.length,f<=_&&I>=_)return{node:S,offset:_-f};f=I}e:{for(;S;){if(S.nextSibling){S=S.nextSibling;break e}S=S.parentNode}S=void 0}S=Vp(S)}}function Gp(f,_){return f&&_?f===_?!0:f&&f.nodeType===3?!1:_&&_.nodeType===3?Gp(f,_.parentNode):"contains"in f?f.contains(_):f.compareDocumentPosition?!!(f.compareDocumentPosition(_)&16):!1:!1}function gf(){for(var f=window,_=Zr();_ instanceof f.HTMLIFrameElement;){try{var S=typeof _.contentWindow.location.href=="string"}catch{S=!1}if(S)f=_.contentWindow;else break;_=Zr(f.document)}return _}function Kc(f){var _=f&&f.nodeName&&f.nodeName.toLowerCase();return _&&(_==="input"&&(f.type==="text"||f.type==="search"||f.type==="tel"||f.type==="url"||f.type==="password")||_==="textarea"||f.contentEditable==="true")}function Vh(f){var _=gf(),S=f.focusedElem,I=f.selectionRange;if(_!==S&&S&&S.ownerDocument&&Gp(S.ownerDocument.documentElement,S)){if(I!==null&&Kc(S)){if(_=I.start,f=I.end,f===void 0&&(f=_),"selectionStart"in S)S.selectionStart=_,S.selectionEnd=Math.min(f,S.value.length);else if(f=(_=S.ownerDocument||document)&&_.defaultView||window,f.getSelection){f=f.getSelection();var N=S.textContent.length,H=Math.min(I.start,N);I=I.end===void 0?H:Math.min(I.end,N),!f.extend&&H>I&&(N=I,I=H,H=N),N=mf(S,H);var le=mf(S,I);N&&le&&(f.rangeCount!==1||f.anchorNode!==N.node||f.anchorOffset!==N.offset||f.focusNode!==le.node||f.focusOffset!==le.offset)&&(_=_.createRange(),_.setStart(N.node,N.offset),f.removeAllRanges(),H>I?(f.addRange(_),f.extend(le.node,le.offset)):(_.setEnd(le.node,le.offset),f.addRange(_)))}}for(_=[],f=S;f=f.parentNode;)f.nodeType===1&&_.push({element:f,left:f.scrollLeft,top:f.scrollTop});for(typeof S.focus=="function"&&S.focus(),S=0;S<_.length;S++)f=_[S],f.element.scrollLeft=f.left,f.element.scrollTop=f.top}}var Gh=o&&"documentMode"in document&&11>=document.documentMode,gl=null,Ca=null,Pa=null,_l=!1;function qs(f,_,S){var I=S.window===S?S.document:S.nodeType===9?S:S.ownerDocument;_l||gl==null||gl!==Zr(I)||(I=gl,"selectionStart"in I&&Kc(I)?I={start:I.selectionStart,end:I.selectionEnd}:(I=(I.ownerDocument&&I.ownerDocument.defaultView||window).getSelection(),I={anchorNode:I.anchorNode,anchorOffset:I.anchorOffset,focusNode:I.focusNode,focusOffset:I.focusOffset}),Pa&&Vu(Pa,I)||(Pa=I,I=Zu(Ca,"onSelect"),0<I.length&&(_=new Oh("onSelect","select",null,_,S),f.push({event:_,listeners:I}),_.target=gl)))}function Gu(f,_){var S={};return S[f.toLowerCase()]=_.toLowerCase(),S["Webkit"+f]="webkit"+_,S["Moz"+f]="moz"+_,S}var Kl={animationend:Gu("Animation","AnimationEnd"),animationiteration:Gu("Animation","AnimationIteration"),animationstart:Gu("Animation","AnimationStart"),transitionend:Gu("Transition","TransitionEnd")},Hu={},yl={};o&&(yl=document.createElement("div").style,"AnimationEvent"in window||(delete Kl.animationend.animation,delete Kl.animationiteration.animation,delete Kl.animationstart.animation),"TransitionEvent"in window||delete Kl.transitionend.transition);function Zl(f){if(Hu[f])return Hu[f];if(!Kl[f])return f;var _=Kl[f],S;for(S in _)if(_.hasOwnProperty(S)&&S in yl)return Hu[f]=_[S];return f}var $u=Zl("animationend"),Zc=Zl("animationiteration"),Wu=Zl("animationstart"),_f=Zl("transitionend"),Xl=new Map,Ra="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ma(f,_){Xl.set(f,_),l(_,[f])}for(var qu=0;qu<Ra.length;qu++){var Lr=Ra[qu],Ku=Lr.toLowerCase(),Vg=Lr[0].toUpperCase()+Lr.slice(1);Ma(Ku,"on"+Vg)}Ma($u,"onAnimationEnd"),Ma(Zc,"onAnimationIteration"),Ma(Wu,"onAnimationStart"),Ma("dblclick","onDoubleClick"),Ma("focusin","onFocus"),Ma("focusout","onBlur"),Ma(_f,"onTransitionEnd"),c("onMouseEnter",["mouseout","mouseover"]),c("onMouseLeave",["mouseout","mouseover"]),c("onPointerEnter",["pointerout","pointerover"]),c("onPointerLeave",["pointerout","pointerover"]),l("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),l("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),l("onBeforeInput",["compositionend","keypress","textInput","paste"]),l("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Xc="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),vl=new Set("cancel close invalid load scroll toggle".split(" ").concat(Xc));function yf(f,_,S){var I=f.type||"unknown-event";f.currentTarget=S,Mr(I,_,void 0,f),f.currentTarget=null}function Hp(f,_){_=(_&4)!==0;for(var S=0;S<f.length;S++){var I=f[S],N=I.event;I=I.listeners;e:{var H=void 0;if(_)for(var le=I.length-1;0<=le;le--){var Ae=I[le],Le=Ae.instance,ot=Ae.currentTarget;if(Ae=Ae.listener,Le!==H&&N.isPropagationStopped())break e;yf(N,Ae,ot),H=Le}else for(le=0;le<I.length;le++){if(Ae=I[le],Le=Ae.instance,ot=Ae.currentTarget,Ae=Ae.listener,Le!==H&&N.isPropagationStopped())break e;yf(N,Ae,ot),H=Le}}}if(li)throw f=Hs,li=!1,Hs=null,f}function bi(f,_){var S=_[Ba];S===void 0&&(S=_[Ba]=new Set);var I=f+"__bubble";S.has(I)||(Jc(_,f,2,!1),S.add(I))}function vf(f,_,S){var I=0;_&&(I|=4),Jc(S,f,I,_)}var Yc="_reactListening"+Math.random().toString(36).slice(2);function bl(f){if(!f[Yc]){f[Yc]=!0,i.forEach(function(S){S!=="selectionchange"&&(vl.has(S)||vf(S,!1,f),vf(S,!0,f))});var _=f.nodeType===9?f:f.ownerDocument;_===null||_[Yc]||(_[Yc]=!0,vf("selectionchange",!1,_))}}function Jc(f,_,S,I){switch(Fc(_)){case 1:var N=ta;break;case 4:N=ra;break;default:N=Dc}S=N.bind(null,_,S,f),N=void 0,!Tr||_!=="touchstart"&&_!=="touchmove"&&_!=="wheel"||(N=!0),I?N!==void 0?f.addEventListener(_,S,{capture:!0,passive:N}):f.addEventListener(_,S,!0):N!==void 0?f.addEventListener(_,S,{passive:N}):f.addEventListener(_,S,!1)}function Yl(f,_,S,I,N){var H=I;if((_&1)===0&&(_&2)===0&&I!==null)e:for(;;){if(I===null)return;var le=I.tag;if(le===3||le===4){var Ae=I.stateNode.containerInfo;if(Ae===N||Ae.nodeType===8&&Ae.parentNode===N)break;if(le===4)for(le=I.return;le!==null;){var Le=le.tag;if((Le===3||Le===4)&&(Le=le.stateNode.containerInfo,Le===N||Le.nodeType===8&&Le.parentNode===N))return;le=le.return}for(;Ae!==null;){if(le=Oa(Ae),le===null)return;if(Le=le.tag,Le===5||Le===6){I=H=le;continue e}Ae=Ae.parentNode}}I=I.return}ji(function(){var ot=H,xt=dt(S),vt=[];e:{var gt=Xl.get(f);if(gt!==void 0){var Vt=Oh,Kt=f;switch(f){case"keypress":if(Xi(S)===0)break e;case"keydown":case"keyup":Vt=Ng;break;case"focusin":Kt="focus",Vt=Sn;break;case"focusout":Kt="blur",Vt=Sn;break;case"beforeblur":case"afterblur":Vt=Sn;break;case"click":if(S.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Vt=Fo;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Vt=Du;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Vt=Fg;break;case $u:case Zc:case Wu:Vt=Dh;break;case _f:Vt=zg;break;case"scroll":Vt=Yd;break;case"wheel":Vt=zp;break;case"copy":case"cut":case"paste":Vt=Qd;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Vt=Vc}var tr=(_&4)!==0,$i=!tr&&f==="scroll",Qe=tr?gt!==null?gt+"Capture":null:gt;tr=[];for(var Ue=ot,it;Ue!==null;){it=Ue;var Rt=it.stateNode;if(it.tag===5&&Rt!==null&&(it=Rt,Qe!==null&&(Rt=fi(Ue,Qe),Rt!=null&&tr.push(Jl(Ue,Rt,it)))),$i)break;Ue=Ue.return}0<tr.length&&(gt=new Vt(gt,Kt,null,S,xt),vt.push({event:gt,listeners:tr}))}}if((_&7)===0){e:{if(gt=f==="mouseover"||f==="pointerover",Vt=f==="mouseout"||f==="pointerout",gt&&S!==nt&&(Kt=S.relatedTarget||S.fromElement)&&(Oa(Kt)||Kt[sa]))break e;if((Vt||gt)&&(gt=xt.window===xt?xt:(gt=xt.ownerDocument)?gt.defaultView||gt.parentWindow:window,Vt?(Kt=S.relatedTarget||S.toElement,Vt=ot,Kt=Kt?Oa(Kt):null,Kt!==null&&($i=hr(Kt),Kt!==$i||Kt.tag!==5&&Kt.tag!==6)&&(Kt=null)):(Vt=null,Kt=ot),Vt!==Kt)){if(tr=Fo,Rt="onMouseLeave",Qe="onMouseEnter",Ue="mouse",(f==="pointerout"||f==="pointerover")&&(tr=Vc,Rt="onPointerLeave",Qe="onPointerEnter",Ue="pointer"),$i=Vt==null?gt:Ql(Vt),it=Kt==null?gt:Ql(Kt),gt=new tr(Rt,Ue+"leave",Vt,S,xt),gt.target=$i,gt.relatedTarget=it,Rt=null,Oa(xt)===ot&&(tr=new tr(Qe,Ue+"enter",Kt,S,xt),tr.target=it,tr.relatedTarget=$i,Rt=tr),$i=Rt,Vt&&Kt)t:{for(tr=Vt,Qe=Kt,Ue=0,it=tr;it;it=ia(it))Ue++;for(it=0,Rt=Qe;Rt;Rt=ia(Rt))it++;for(;0<Ue-it;)tr=ia(tr),Ue--;for(;0<it-Ue;)Qe=ia(Qe),it--;for(;Ue--;){if(tr===Qe||Qe!==null&&tr===Qe.alternate)break t;tr=ia(tr),Qe=ia(Qe)}tr=null}else tr=null;Vt!==null&&Qc(vt,gt,Vt,tr,!1),Kt!==null&&$i!==null&&Qc(vt,$i,Kt,tr,!0)}}e:{if(gt=ot?Ql(ot):window,Vt=gt.nodeName&&gt.nodeName.toLowerCase(),Vt==="select"||Vt==="input"&&gt.type==="file")var Xt=hf;else if(Hc(gt))if(df)Xt=pf;else{Xt=ff;var gr=Up}else(Vt=gt.nodeName)&&Vt.toLowerCase()==="input"&&(gt.type==="checkbox"||gt.type==="radio")&&(Xt=ql);if(Xt&&(Xt=Xt(f,ot))){uf(vt,Xt,S,xt);break e}gr&&gr(f,gt,ot),f==="focusout"&&(gr=gt._wrapperState)&&gr.controlled&&gt.type==="number"&&ns(gt,"number",gt.value)}switch(gr=ot?Ql(ot):window,f){case"focusin":(Hc(gr)||gr.contentEditable==="true")&&(gl=gr,Ca=ot,Pa=null);break;case"focusout":Pa=Ca=gl=null;break;case"mousedown":_l=!0;break;case"contextmenu":case"mouseup":case"dragend":_l=!1,qs(vt,S,xt);break;case"selectionchange":if(Gh)break;case"keydown":case"keyup":qs(vt,S,xt)}var _r;if(nf)e:{switch(f){case"compositionstart":var Ar="onCompositionStart";break e;case"compositionend":Ar="onCompositionEnd";break e;case"compositionupdate":Ar="onCompositionUpdate";break e}Ar=void 0}else ml?lf(f,S)&&(Ar="onCompositionEnd"):f==="keydown"&&S.keyCode===229&&(Ar="onCompositionStart");Ar&&(of&&S.locale!=="ko"&&(ml||Ar!=="onCompositionStart"?Ar==="onCompositionEnd"&&ml&&(_r=fo()):(No=xt,zc="value"in No?No.value:No.textContent,ml=!0)),gr=Zu(ot,Ar),0<gr.length&&(Ar=new Fp(Ar,f,null,S,xt),vt.push({event:Ar,listeners:gr}),_r?Ar.data=_r:(_r=pl(S),_r!==null&&(Ar.data=_r)))),(_r=sf?cf(f,S):ju(f,S))&&(ot=Zu(ot,"onBeforeInput"),0<ot.length&&(xt=new Fp("onBeforeInput","beforeinput",null,S,xt),vt.push({event:xt,listeners:ot}),xt.data=_r))}Hp(vt,_)})}function Jl(f,_,S){return{instance:f,listener:_,currentTarget:S}}function Zu(f,_){for(var S=_+"Capture",I=[];f!==null;){var N=f,H=N.stateNode;N.tag===5&&H!==null&&(N=H,H=fi(f,S),H!=null&&I.unshift(Jl(f,H,N)),H=fi(f,_),H!=null&&I.push(Jl(f,H,N))),f=f.return}return I}function ia(f){if(f===null)return null;do f=f.return;while(f&&f.tag!==5);return f||null}function Qc(f,_,S,I,N){for(var H=_._reactName,le=[];S!==null&&S!==I;){var Ae=S,Le=Ae.alternate,ot=Ae.stateNode;if(Le!==null&&Le===I)break;Ae.tag===5&&ot!==null&&(Ae=ot,N?(Le=fi(S,H),Le!=null&&le.unshift(Jl(S,Le,Ae))):N||(Le=fi(S,H),Le!=null&&le.push(Jl(S,Le,Ae)))),S=S.return}le.length!==0&&f.push({event:_,listeners:le})}var Xu=/\r\n?/g,Hh=/\u0000|\uFFFD/g;function $h(f){return(typeof f=="string"?f:""+f).replace(Xu,`
`).replace(Hh,"")}function na(f,_,S){if(_=$h(_),$h(f)!==_&&S)throw Error(r(425))}function eu(){}var tu=null,Ia=null;function Yu(f,_){return f==="textarea"||f==="noscript"||typeof _.children=="string"||typeof _.children=="number"||typeof _.dangerouslySetInnerHTML=="object"&&_.dangerouslySetInnerHTML!==null&&_.dangerouslySetInnerHTML.__html!=null}var Wh=typeof setTimeout=="function"?setTimeout:void 0,$p=typeof clearTimeout=="function"?clearTimeout:void 0,Ju=typeof Promise=="function"?Promise:void 0,bf=typeof queueMicrotask=="function"?queueMicrotask:typeof Ju<"u"?function(f){return Ju.resolve(null).then(f).catch(Gg)}:Wh;function Gg(f){setTimeout(function(){throw f})}function Qu(f,_){var S=_,I=0;do{var N=S.nextSibling;if(f.removeChild(S),N&&N.nodeType===8)if(S=N.data,S==="/$"){if(I===0){f.removeChild(N),Ws(_);return}I--}else S!=="$"&&S!=="$?"&&S!=="$!"||I++;S=N}while(S);Ws(_)}function ei(f){for(;f!=null;f=f.nextSibling){var _=f.nodeType;if(_===1||_===3)break;if(_===8){if(_=f.data,_==="$"||_==="$!"||_==="$?")break;if(_==="/$")return null}}return f}function Vo(f){f=f.previousSibling;for(var _=0;f;){if(f.nodeType===8){var S=f.data;if(S==="$"||S==="$!"||S==="$?"){if(_===0)return f;_--}else S==="/$"&&_++}f=f.previousSibling}return null}var Fn=Math.random().toString(36).slice(2),Ks="__reactFiber$"+Fn,ka="__reactProps$"+Fn,sa="__reactContainer$"+Fn,Ba="__reactEvents$"+Fn,qh="__reactListeners$"+Fn,La="__reactHandles$"+Fn;function Oa(f){var _=f[Ks];if(_)return _;for(var S=f.parentNode;S;){if(_=S[sa]||S[Ks]){if(S=_.alternate,_.child!==null||S!==null&&S.child!==null)for(f=Vo(f);f!==null;){if(S=f[Ks])return S;f=Vo(f)}return _}f=S,S=f.parentNode}return null}function ru(f){return f=f[Ks]||f[sa],!f||f.tag!==5&&f.tag!==6&&f.tag!==13&&f.tag!==3?null:f}function Ql(f){if(f.tag===5||f.tag===6)return f.stateNode;throw Error(r(33))}function eh(f){return f[ka]||null}var Kh=[],ec=-1;function Cn(f){return{current:f}}function ti(f){0>ec||(f.current=Kh[ec],Kh[ec]=null,ec--)}function Dr(f,_){ec++,Kh[ec]=f.current,f.current=_}var Zs={},Pn=Cn(Zs),cs=Cn(!1),xl=Zs;function Go(f,_){var S=f.type.contextTypes;if(!S)return Zs;var I=f.stateNode;if(I&&I.__reactInternalMemoizedUnmaskedChildContext===_)return I.__reactInternalMemoizedMaskedChildContext;var N={},H;for(H in S)N[H]=_[H];return I&&(f=f.stateNode,f.__reactInternalMemoizedUnmaskedChildContext=_,f.__reactInternalMemoizedMaskedChildContext=N),N}function Kn(f){return f=f.childContextTypes,f!=null}function Da(){ti(cs),ti(Pn)}function xf(f,_,S){if(Pn.current!==Zs)throw Error(r(168));Dr(Pn,_),Dr(cs,S)}function us(f,_,S){var I=f.stateNode;if(_=_.childContextTypes,typeof I.getChildContext!="function")return S;I=I.getChildContext();for(var N in I)if(!(N in _))throw Error(r(108,$t(f)||"Unknown",N));return Tt({},S,I)}function Is(f){return f=(f=f.stateNode)&&f.__reactInternalMemoizedMergedChildContext||Zs,xl=Pn.current,Dr(Pn,f),Dr(cs,cs.current),!0}function tc(f,_,S){var I=f.stateNode;if(!I)throw Error(r(169));S?(f=us(f,_,xl),I.__reactInternalMemoizedMergedChildContext=f,ti(cs),ti(Pn),Dr(Pn,f)):ti(cs),Dr(cs,S)}var gn=null,Na=!1,wf=!1;function iu(f){gn===null?gn=[f]:gn.push(f)}function Hg(f){Na=!0,iu(f)}function wl(){if(!wf&&gn!==null){wf=!0;var f=0,_=he;try{var S=gn;for(he=1;f<S.length;f++){var I=S[f];do I=I(!0);while(I!==null)}gn=null,Na=!1}catch(N){throw gn!==null&&(gn=gn.slice(f+1)),Rs(Bi,wl),N}finally{he=_,wf=!1}}return null}var oa=[],aa=0,ks=null,Ot=0,Bs=[],hs=0,Fa=null,Ls=1,ds="";function la(f,_){oa[aa++]=Ot,oa[aa++]=ks,ks=f,Ot=_}function Or(f,_,S){Bs[hs++]=Ls,Bs[hs++]=ds,Bs[hs++]=Fa,Fa=f;var I=Ls;f=ds;var N=32-Dn(I)-1;I&=~(1<<N),S+=1;var H=32-Dn(_)+N;if(30<H){var le=N-N%5;H=(I&(1<<le)-1).toString(32),I>>=le,N-=le,Ls=1<<32-Dn(_)+N|S<<N|I,ds=H+f}else Ls=1<<H|S<<N|I,ds=f}function nu(f){f.return!==null&&(la(f,1),Or(f,1,0))}function Ef(f){for(;f===ks;)ks=oa[--aa],oa[aa]=null,Ot=oa[--aa],oa[aa]=null;for(;f===Fa;)Fa=Bs[--hs],Bs[hs]=null,ds=Bs[--hs],Bs[hs]=null,Ls=Bs[--hs],Bs[hs]=null}var Zn=null,Xs=null,Ei=!1,Ys=null;function Zh(f,_){var S=Xo(5,null,null,0);S.elementType="DELETED",S.stateNode=_,S.return=f,_=f.deletions,_===null?(f.deletions=[S],f.flags|=16):_.push(S)}function Af(f,_){switch(f.tag){case 5:var S=f.type;return _=_.nodeType!==1||S.toLowerCase()!==_.nodeName.toLowerCase()?null:_,_!==null?(f.stateNode=_,Zn=f,Xs=ei(_.firstChild),!0):!1;case 6:return _=f.pendingProps===""||_.nodeType!==3?null:_,_!==null?(f.stateNode=_,Zn=f,Xs=null,!0):!1;case 13:return _=_.nodeType!==8?null:_,_!==null?(S=Fa!==null?{id:Ls,overflow:ds}:null,f.memoizedState={dehydrated:_,treeContext:S,retryLane:1073741824},S=Xo(18,null,null,0),S.stateNode=_,S.return=f,f.child=S,Zn=f,Xs=null,!0):!1;default:return!1}}function Xh(f){return(f.mode&1)!==0&&(f.flags&128)===0}function th(f){if(Ei){var _=Xs;if(_){var S=_;if(!Af(f,_)){if(Xh(f))throw Error(r(418));_=ei(S.nextSibling);var I=Zn;_&&Af(f,_)?Zh(I,S):(f.flags=f.flags&-4097|2,Ei=!1,Zn=f)}}else{if(Xh(f))throw Error(r(418));f.flags=f.flags&-4097|2,Ei=!1,Zn=f}}}function Tf(f){for(f=f.return;f!==null&&f.tag!==5&&f.tag!==3&&f.tag!==13;)f=f.return;Zn=f}function rh(f){if(f!==Zn)return!1;if(!Ei)return Tf(f),Ei=!0,!1;var _;if((_=f.tag!==3)&&!(_=f.tag!==5)&&(_=f.type,_=_!=="head"&&_!=="body"&&!Yu(f.type,f.memoizedProps)),_&&(_=Xs)){if(Xh(f))throw po(),Error(r(418));for(;_;)Zh(f,_),_=ei(_.nextSibling)}if(Tf(f),f.tag===13){if(f=f.memoizedState,f=f!==null?f.dehydrated:null,!f)throw Error(r(317));e:{for(f=f.nextSibling,_=0;f;){if(f.nodeType===8){var S=f.data;if(S==="/$"){if(_===0){Xs=ei(f.nextSibling);break e}_--}else S!=="$"&&S!=="$!"&&S!=="$?"||_++}f=f.nextSibling}Xs=null}}else Xs=Zn?ei(f.stateNode.nextSibling):null;return!0}function po(){for(var f=Xs;f;)f=ei(f.nextSibling)}function ri(){Xs=Zn=null,Ei=!1}function El(f){Ys===null?Ys=[f]:Ys.push(f)}var Sf=me.ReactCurrentBatchConfig;function su(f,_,S){if(f=S.ref,f!==null&&typeof f!="function"&&typeof f!="object"){if(S._owner){if(S=S._owner,S){if(S.tag!==1)throw Error(r(309));var I=S.stateNode}if(!I)throw Error(r(147,f));var N=I,H=""+f;return _!==null&&_.ref!==null&&typeof _.ref=="function"&&_.ref._stringRef===H?_.ref:(_=function(le){var Ae=N.refs;le===null?delete Ae[H]:Ae[H]=le},_._stringRef=H,_)}if(typeof f!="string")throw Error(r(284));if(!S._owner)throw Error(r(290,f))}return f}function ou(f,_){throw f=Object.prototype.toString.call(_),Error(r(31,f==="[object Object]"?"object with keys {"+Object.keys(_).join(", ")+"}":f))}function Yh(f){var _=f._init;return _(f._payload)}function Cf(f){function _(Qe,Ue){if(f){var it=Qe.deletions;it===null?(Qe.deletions=[Ue],Qe.flags|=16):it.push(Ue)}}function S(Qe,Ue){if(!f)return null;for(;Ue!==null;)_(Qe,Ue),Ue=Ue.sibling;return null}function I(Qe,Ue){for(Qe=new Map;Ue!==null;)Ue.key!==null?Qe.set(Ue.key,Ue):Qe.set(Ue.index,Ue),Ue=Ue.sibling;return Qe}function N(Qe,Ue){return Qe=lc(Qe,Ue),Qe.index=0,Qe.sibling=null,Qe}function H(Qe,Ue,it){return Qe.index=it,f?(it=Qe.alternate,it!==null?(it=it.index,it<Ue?(Qe.flags|=2,Ue):it):(Qe.flags|=2,Ue)):(Qe.flags|=1048576,Ue)}function le(Qe){return f&&Qe.alternate===null&&(Qe.flags|=2),Qe}function Ae(Qe,Ue,it,Rt){return Ue===null||Ue.tag!==6?(Ue=m_(it,Qe.mode,Rt),Ue.return=Qe,Ue):(Ue=N(Ue,it),Ue.return=Qe,Ue)}function Le(Qe,Ue,it,Rt){var Xt=it.type;return Xt===Ve?xt(Qe,Ue,it.props.children,Rt,it.key):Ue!==null&&(Ue.elementType===Xt||typeof Xt=="object"&&Xt!==null&&Xt.$$typeof===Lt&&Yh(Xt)===Ue.type)?(Rt=N(Ue,it.props),Rt.ref=su(Qe,Ue,it),Rt.return=Qe,Rt):(Rt=im(it.type,it.key,it.props,null,Qe.mode,Rt),Rt.ref=su(Qe,Ue,it),Rt.return=Qe,Rt)}function ot(Qe,Ue,it,Rt){return Ue===null||Ue.tag!==4||Ue.stateNode.containerInfo!==it.containerInfo||Ue.stateNode.implementation!==it.implementation?(Ue=g_(it,Qe.mode,Rt),Ue.return=Qe,Ue):(Ue=N(Ue,it.children||[]),Ue.return=Qe,Ue)}function xt(Qe,Ue,it,Rt,Xt){return Ue===null||Ue.tag!==7?(Ue=ph(it,Qe.mode,Rt,Xt),Ue.return=Qe,Ue):(Ue=N(Ue,it),Ue.return=Qe,Ue)}function vt(Qe,Ue,it){if(typeof Ue=="string"&&Ue!==""||typeof Ue=="number")return Ue=m_(""+Ue,Qe.mode,it),Ue.return=Qe,Ue;if(typeof Ue=="object"&&Ue!==null){switch(Ue.$$typeof){case Se:return it=im(Ue.type,Ue.key,Ue.props,null,Qe.mode,it),it.ref=su(Qe,null,Ue),it.return=Qe,it;case Me:return Ue=g_(Ue,Qe.mode,it),Ue.return=Qe,Ue;case Lt:var Rt=Ue._init;return vt(Qe,Rt(Ue._payload),it)}if(ss(Ue)||ft(Ue))return Ue=ph(Ue,Qe.mode,it,null),Ue.return=Qe,Ue;ou(Qe,Ue)}return null}function gt(Qe,Ue,it,Rt){var Xt=Ue!==null?Ue.key:null;if(typeof it=="string"&&it!==""||typeof it=="number")return Xt!==null?null:Ae(Qe,Ue,""+it,Rt);if(typeof it=="object"&&it!==null){switch(it.$$typeof){case Se:return it.key===Xt?Le(Qe,Ue,it,Rt):null;case Me:return it.key===Xt?ot(Qe,Ue,it,Rt):null;case Lt:return Xt=it._init,gt(Qe,Ue,Xt(it._payload),Rt)}if(ss(it)||ft(it))return Xt!==null?null:xt(Qe,Ue,it,Rt,null);ou(Qe,it)}return null}function Vt(Qe,Ue,it,Rt,Xt){if(typeof Rt=="string"&&Rt!==""||typeof Rt=="number")return Qe=Qe.get(it)||null,Ae(Ue,Qe,""+Rt,Xt);if(typeof Rt=="object"&&Rt!==null){switch(Rt.$$typeof){case Se:return Qe=Qe.get(Rt.key===null?it:Rt.key)||null,Le(Ue,Qe,Rt,Xt);case Me:return Qe=Qe.get(Rt.key===null?it:Rt.key)||null,ot(Ue,Qe,Rt,Xt);case Lt:var gr=Rt._init;return Vt(Qe,Ue,it,gr(Rt._payload),Xt)}if(ss(Rt)||ft(Rt))return Qe=Qe.get(it)||null,xt(Ue,Qe,Rt,Xt,null);ou(Ue,Rt)}return null}function Kt(Qe,Ue,it,Rt){for(var Xt=null,gr=null,_r=Ue,Ar=Ue=0,Vn=null;_r!==null&&Ar<it.length;Ar++){_r.index>Ar?(Vn=_r,_r=null):Vn=_r.sibling;var $r=gt(Qe,_r,it[Ar],Rt);if($r===null){_r===null&&(_r=Vn);break}f&&_r&&$r.alternate===null&&_(Qe,_r),Ue=H($r,Ue,Ar),gr===null?Xt=$r:gr.sibling=$r,gr=$r,_r=Vn}if(Ar===it.length)return S(Qe,_r),Ei&&la(Qe,Ar),Xt;if(_r===null){for(;Ar<it.length;Ar++)_r=vt(Qe,it[Ar],Rt),_r!==null&&(Ue=H(_r,Ue,Ar),gr===null?Xt=_r:gr.sibling=_r,gr=_r);return Ei&&la(Qe,Ar),Xt}for(_r=I(Qe,_r);Ar<it.length;Ar++)Vn=Vt(_r,Qe,Ar,it[Ar],Rt),Vn!==null&&(f&&Vn.alternate!==null&&_r.delete(Vn.key===null?Ar:Vn.key),Ue=H(Vn,Ue,Ar),gr===null?Xt=Vn:gr.sibling=Vn,gr=Vn);return f&&_r.forEach(function(hc){return _(Qe,hc)}),Ei&&la(Qe,Ar),Xt}function tr(Qe,Ue,it,Rt){var Xt=ft(it);if(typeof Xt!="function")throw Error(r(150));if(it=Xt.call(it),it==null)throw Error(r(151));for(var gr=Xt=null,_r=Ue,Ar=Ue=0,Vn=null,$r=it.next();_r!==null&&!$r.done;Ar++,$r=it.next()){_r.index>Ar?(Vn=_r,_r=null):Vn=_r.sibling;var hc=gt(Qe,_r,$r.value,Rt);if(hc===null){_r===null&&(_r=Vn);break}f&&_r&&hc.alternate===null&&_(Qe,_r),Ue=H(hc,Ue,Ar),gr===null?Xt=hc:gr.sibling=hc,gr=hc,_r=Vn}if($r.done)return S(Qe,_r),Ei&&la(Qe,Ar),Xt;if(_r===null){for(;!$r.done;Ar++,$r=it.next())$r=vt(Qe,$r.value,Rt),$r!==null&&(Ue=H($r,Ue,Ar),gr===null?Xt=$r:gr.sibling=$r,gr=$r);return Ei&&la(Qe,Ar),Xt}for(_r=I(Qe,_r);!$r.done;Ar++,$r=it.next())$r=Vt(_r,Qe,Ar,$r.value,Rt),$r!==null&&(f&&$r.alternate!==null&&_r.delete($r.key===null?Ar:$r.key),Ue=H($r,Ue,Ar),gr===null?Xt=$r:gr.sibling=$r,gr=$r);return f&&_r.forEach(function(Sb){return _(Qe,Sb)}),Ei&&la(Qe,Ar),Xt}function $i(Qe,Ue,it,Rt){if(typeof it=="object"&&it!==null&&it.type===Ve&&it.key===null&&(it=it.props.children),typeof it=="object"&&it!==null){switch(it.$$typeof){case Se:e:{for(var Xt=it.key,gr=Ue;gr!==null;){if(gr.key===Xt){if(Xt=it.type,Xt===Ve){if(gr.tag===7){S(Qe,gr.sibling),Ue=N(gr,it.props.children),Ue.return=Qe,Qe=Ue;break e}}else if(gr.elementType===Xt||typeof Xt=="object"&&Xt!==null&&Xt.$$typeof===Lt&&Yh(Xt)===gr.type){S(Qe,gr.sibling),Ue=N(gr,it.props),Ue.ref=su(Qe,gr,it),Ue.return=Qe,Qe=Ue;break e}S(Qe,gr);break}else _(Qe,gr);gr=gr.sibling}it.type===Ve?(Ue=ph(it.props.children,Qe.mode,Rt,it.key),Ue.return=Qe,Qe=Ue):(Rt=im(it.type,it.key,it.props,null,Qe.mode,Rt),Rt.ref=su(Qe,Ue,it),Rt.return=Qe,Qe=Rt)}return le(Qe);case Me:e:{for(gr=it.key;Ue!==null;){if(Ue.key===gr)if(Ue.tag===4&&Ue.stateNode.containerInfo===it.containerInfo&&Ue.stateNode.implementation===it.implementation){S(Qe,Ue.sibling),Ue=N(Ue,it.children||[]),Ue.return=Qe,Qe=Ue;break e}else{S(Qe,Ue);break}else _(Qe,Ue);Ue=Ue.sibling}Ue=g_(it,Qe.mode,Rt),Ue.return=Qe,Qe=Ue}return le(Qe);case Lt:return gr=it._init,$i(Qe,Ue,gr(it._payload),Rt)}if(ss(it))return Kt(Qe,Ue,it,Rt);if(ft(it))return tr(Qe,Ue,it,Rt);ou(Qe,it)}return typeof it=="string"&&it!==""||typeof it=="number"?(it=""+it,Ue!==null&&Ue.tag===6?(S(Qe,Ue.sibling),Ue=N(Ue,it),Ue.return=Qe,Qe=Ue):(S(Qe,Ue),Ue=m_(it,Qe.mode,Rt),Ue.return=Qe,Qe=Ue),le(Qe)):S(Qe,Ue)}return $i}var fs=Cf(!0),ih=Cf(!1),zt=Cn(null),er=null,za=null,ca=null;function au(){ca=za=er=null}function zn(f){var _=zt.current;ti(zt),f._currentValue=_}function Jh(f,_,S){for(;f!==null;){var I=f.alternate;if((f.childLanes&_)!==_?(f.childLanes|=_,I!==null&&(I.childLanes|=_)):I!==null&&(I.childLanes&_)!==_&&(I.childLanes|=_),f===S)break;f=f.return}}function jn(f,_){er=f,ca=za=null,f=f.dependencies,f!==null&&f.firstContext!==null&&((f.lanes&_)!==0&&(yo=!0),f.firstContext=null)}function mo(f){var _=f._currentValue;if(ca!==f)if(f={context:f,memoizedValue:_,next:null},za===null){if(er===null)throw Error(r(308));za=f,er.dependencies={lanes:0,firstContext:f}}else za=za.next=f;return _}var Ho=null;function Yr(f){Ho===null?Ho=[f]:Ho.push(f)}function Li(f,_,S,I){var N=_.interleaved;return N===null?(S.next=S,Yr(_)):(S.next=N.next,N.next=S),_.interleaved=S,go(f,I)}function go(f,_){f.lanes|=_;var S=f.alternate;for(S!==null&&(S.lanes|=_),S=f,f=f.return;f!==null;)f.childLanes|=_,S=f.alternate,S!==null&&(S.childLanes|=_),S=f,f=f.return;return S.tag===3?S.stateNode:null}var Js=!1;function Al(f){f.updateQueue={baseState:f.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Qh(f,_){f=f.updateQueue,_.updateQueue===f&&(_.updateQueue={baseState:f.baseState,firstBaseUpdate:f.firstBaseUpdate,lastBaseUpdate:f.lastBaseUpdate,shared:f.shared,effects:f.effects})}function Os(f,_){return{eventTime:f,lane:_,tag:0,payload:null,callback:null,next:null}}function Ds(f,_,S){var I=f.updateQueue;if(I===null)return null;if(I=I.shared,(jr&2)!==0){var N=I.pending;return N===null?_.next=_:(_.next=N.next,N.next=_),I.pending=_,go(f,S)}return N=I.interleaved,N===null?(_.next=_,Yr(I)):(_.next=N.next,N.next=_),I.interleaved=_,go(f,S)}function Tl(f,_,S){if(_=_.updateQueue,_!==null&&(_=_.shared,(S&4194240)!==0)){var I=_.lanes;I&=f.pendingLanes,S|=I,_.lanes=S,ae(f,S)}}function nh(f,_){var S=f.updateQueue,I=f.alternate;if(I!==null&&(I=I.updateQueue,S===I)){var N=null,H=null;if(S=S.firstBaseUpdate,S!==null){do{var le={eventTime:S.eventTime,lane:S.lane,tag:S.tag,payload:S.payload,callback:S.callback,next:null};H===null?N=H=le:H=H.next=le,S=S.next}while(S!==null);H===null?N=H=_:H=H.next=_}else N=H=_;S={baseState:I.baseState,firstBaseUpdate:N,lastBaseUpdate:H,shared:I.shared,effects:I.effects},f.updateQueue=S;return}f=S.lastBaseUpdate,f===null?S.firstBaseUpdate=_:f.next=_,S.lastBaseUpdate=_}function ua(f,_,S,I){var N=f.updateQueue;Js=!1;var H=N.firstBaseUpdate,le=N.lastBaseUpdate,Ae=N.shared.pending;if(Ae!==null){N.shared.pending=null;var Le=Ae,ot=Le.next;Le.next=null,le===null?H=ot:le.next=ot,le=Le;var xt=f.alternate;xt!==null&&(xt=xt.updateQueue,Ae=xt.lastBaseUpdate,Ae!==le&&(Ae===null?xt.firstBaseUpdate=ot:Ae.next=ot,xt.lastBaseUpdate=Le))}if(H!==null){var vt=N.baseState;le=0,xt=ot=Le=null,Ae=H;do{var gt=Ae.lane,Vt=Ae.eventTime;if((I&gt)===gt){xt!==null&&(xt=xt.next={eventTime:Vt,lane:0,tag:Ae.tag,payload:Ae.payload,callback:Ae.callback,next:null});e:{var Kt=f,tr=Ae;switch(gt=_,Vt=S,tr.tag){case 1:if(Kt=tr.payload,typeof Kt=="function"){vt=Kt.call(Vt,vt,gt);break e}vt=Kt;break e;case 3:Kt.flags=Kt.flags&-65537|128;case 0:if(Kt=tr.payload,gt=typeof Kt=="function"?Kt.call(Vt,vt,gt):Kt,gt==null)break e;vt=Tt({},vt,gt);break e;case 2:Js=!0}}Ae.callback!==null&&Ae.lane!==0&&(f.flags|=64,gt=N.effects,gt===null?N.effects=[Ae]:gt.push(Ae))}else Vt={eventTime:Vt,lane:gt,tag:Ae.tag,payload:Ae.payload,callback:Ae.callback,next:null},xt===null?(ot=xt=Vt,Le=vt):xt=xt.next=Vt,le|=gt;if(Ae=Ae.next,Ae===null){if(Ae=N.shared.pending,Ae===null)break;gt=Ae,Ae=gt.next,gt.next=null,N.lastBaseUpdate=gt,N.shared.pending=null}}while(!0);if(xt===null&&(Le=vt),N.baseState=Le,N.firstBaseUpdate=ot,N.lastBaseUpdate=xt,_=N.shared.interleaved,_!==null){N=_;do le|=N.lane,N=N.next;while(N!==_)}else H===null&&(N.shared.lanes=0);uu|=le,f.lanes=le,f.memoizedState=vt}}function ed(f,_,S){if(f=_.effects,_.effects=null,f!==null)for(_=0;_<f.length;_++){var I=f[_],N=I.callback;if(N!==null){if(I.callback=null,I=S,typeof N!="function")throw Error(r(191,N));N.call(I)}}}var rc={},Qs=Cn(rc),ic=Cn(rc),x=Cn(rc);function s(f){if(f===rc)throw Error(r(174));return f}function d(f,_){switch(Dr(x,_),Dr(ic,f),Dr(Qs,rc),f=_.nodeType,f){case 9:case 11:_=(_=_.documentElement)?_.namespaceURI:Gs(null,"");break;default:f=f===8?_.parentNode:_,_=f.namespaceURI||null,f=f.tagName,_=Gs(_,f)}ti(Qs),Dr(Qs,_)}function g(){ti(Qs),ti(ic),ti(x)}function v(f){s(x.current);var _=s(Qs.current),S=Gs(_,f.type);_!==S&&(Dr(ic,f),Dr(Qs,S))}function w(f){ic.current===f&&(ti(Qs),ti(ic))}var C=Cn(0);function B(f){for(var _=f;_!==null;){if(_.tag===13){var S=_.memoizedState;if(S!==null&&(S=S.dehydrated,S===null||S.data==="$?"||S.data==="$!"))return _}else if(_.tag===19&&_.memoizedProps.revealOrder!==void 0){if((_.flags&128)!==0)return _}else if(_.child!==null){_.child.return=_,_=_.child;continue}if(_===f)break;for(;_.sibling===null;){if(_.return===null||_.return===f)return null;_=_.return}_.sibling.return=_.return,_=_.sibling}return null}var O=[];function F(){for(var f=0;f<O.length;f++)O[f]._workInProgressVersionPrimary=null;O.length=0}var U=me.ReactCurrentDispatcher,K=me.ReactCurrentBatchConfig,W=0,X=null,re=null,ue=null,fe=!1,pe=!1,_e=0,we=0;function ye(){throw Error(r(321))}function Te(f,_){if(_===null)return!1;for(var S=0;S<_.length&&S<f.length;S++)if(!Uo(f[S],_[S]))return!1;return!0}function Ie(f,_,S,I,N,H){if(W=H,X=_,_.memoizedState=null,_.updateQueue=null,_.lanes=0,U.current=f===null||f.memoizedState===null?ln:sh,f=S(I,N),pe){H=0;do{if(pe=!1,_e=0,25<=H)throw Error(r(301));H+=1,ue=re=null,_.updateQueue=null,U.current=lu,f=S(I,N)}while(pe)}if(U.current=_s,_=re!==null&&re.next!==null,W=0,ue=re=X=null,fe=!1,_)throw Error(r(300));return f}function be(){var f=_e!==0;return _e=0,f}function ke(){var f={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ue===null?X.memoizedState=ue=f:ue=ue.next=f,ue}function Xe(){if(re===null){var f=X.alternate;f=f!==null?f.memoizedState:null}else f=re.next;var _=ue===null?X.memoizedState:ue.next;if(_!==null)ue=_,re=f;else{if(f===null)throw Error(r(310));re=f,f={memoizedState:re.memoizedState,baseState:re.baseState,baseQueue:re.baseQueue,queue:re.queue,next:null},ue===null?X.memoizedState=ue=f:ue=ue.next=f}return ue}function qe(f,_){return typeof _=="function"?_(f):_}function Ze(f){var _=Xe(),S=_.queue;if(S===null)throw Error(r(311));S.lastRenderedReducer=f;var I=re,N=I.baseQueue,H=S.pending;if(H!==null){if(N!==null){var le=N.next;N.next=H.next,H.next=le}I.baseQueue=N=H,S.pending=null}if(N!==null){H=N.next,I=I.baseState;var Ae=le=null,Le=null,ot=H;do{var xt=ot.lane;if((W&xt)===xt)Le!==null&&(Le=Le.next={lane:0,action:ot.action,hasEagerState:ot.hasEagerState,eagerState:ot.eagerState,next:null}),I=ot.hasEagerState?ot.eagerState:f(I,ot.action);else{var vt={lane:xt,action:ot.action,hasEagerState:ot.hasEagerState,eagerState:ot.eagerState,next:null};Le===null?(Ae=Le=vt,le=I):Le=Le.next=vt,X.lanes|=xt,uu|=xt}ot=ot.next}while(ot!==null&&ot!==H);Le===null?le=I:Le.next=Ae,Uo(I,_.memoizedState)||(yo=!0),_.memoizedState=I,_.baseState=le,_.baseQueue=Le,S.lastRenderedState=I}if(f=S.interleaved,f!==null){N=f;do H=N.lane,X.lanes|=H,uu|=H,N=N.next;while(N!==f)}else N===null&&(S.lanes=0);return[_.memoizedState,S.dispatch]}function tt(f){var _=Xe(),S=_.queue;if(S===null)throw Error(r(311));S.lastRenderedReducer=f;var I=S.dispatch,N=S.pending,H=_.memoizedState;if(N!==null){S.pending=null;var le=N=N.next;do H=f(H,le.action),le=le.next;while(le!==N);Uo(H,_.memoizedState)||(yo=!0),_.memoizedState=H,_.baseQueue===null&&(_.baseState=H),S.lastRenderedState=H}return[H,I]}function bt(){}function wt(f,_){var S=X,I=Xe(),N=_(),H=!Uo(I.memoizedState,N);if(H&&(I.memoizedState=N,yo=!0),I=I.queue,on(Sr.bind(null,S,I,f),[f]),I.getSnapshot!==_||H||ue!==null&&ue.memoizedState.tag&1){if(S.flags|=2048,ui(9,jt.bind(null,S,I,N,_),void 0,null),vn===null)throw Error(r(349));(W&30)!==0||ut(S,_,N)}return N}function ut(f,_,S){f.flags|=16384,f={getSnapshot:_,value:S},_=X.updateQueue,_===null?(_={lastEffect:null,stores:null},X.updateQueue=_,_.stores=[f]):(S=_.stores,S===null?_.stores=[f]:S.push(f))}function jt(f,_,S,I){_.value=S,_.getSnapshot=I,Gr(_)&&ii(f)}function Sr(f,_,S){return S(function(){Gr(_)&&ii(f)})}function Gr(f){var _=f.getSnapshot;f=f.value;try{var S=_();return!Uo(f,S)}catch{return!0}}function ii(f){var _=go(f,1);_!==null&&$a(_,f,1,-1)}function Jr(f){var _=ke();return typeof f=="function"&&(f=f()),_.memoizedState=_.baseState=f,f={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:qe,lastRenderedState:f},_.queue=f,f=f.dispatch=gs.bind(null,X,f),[_.memoizedState,f]}function ui(f,_,S,I){return f={tag:f,create:_,destroy:S,deps:I,next:null},_=X.updateQueue,_===null?(_={lastEffect:null,stores:null},X.updateQueue=_,_.lastEffect=f.next=f):(S=_.lastEffect,S===null?_.lastEffect=f.next=f:(I=S.next,S.next=f,f.next=I,_.lastEffect=f)),f}function Si(){return Xe().memoizedState}function br(f,_,S,I){var N=ke();X.flags|=f,N.memoizedState=ui(1|_,S,void 0,I===void 0?null:I)}function qr(f,_,S,I){var N=Xe();I=I===void 0?null:I;var H=void 0;if(re!==null){var le=re.memoizedState;if(H=le.destroy,I!==null&&Te(I,le.deps)){N.memoizedState=ui(_,S,H,I);return}}X.flags|=f,N.memoizedState=ui(1|_,S,H,I)}function Ji(f,_){return br(8390656,8,f,_)}function on(f,_){return qr(2048,8,f,_)}function _n(f,_){return qr(4,2,f,_)}function ps(f,_){return qr(4,4,f,_)}function _o(f,_){if(typeof _=="function")return f=f(),_(f),function(){_(null)};if(_!=null)return f=f(),_.current=f,function(){_.current=null}}function ja(f,_,S){return S=S!=null?S.concat([f]):null,qr(4,4,_o.bind(null,_,f),S)}function ha(){}function nc(f,_){var S=Xe();_=_===void 0?null:_;var I=S.memoizedState;return I!==null&&_!==null&&Te(_,I[1])?I[0]:(S.memoizedState=[f,_],f)}function sc(f,_){var S=Xe();_=_===void 0?null:_;var I=S.memoizedState;return I!==null&&_!==null&&Te(_,I[1])?I[0]:(f=f(),S.memoizedState=[f,_],f)}function Sl(f,_,S){return(W&21)===0?(f.baseState&&(f.baseState=!1,yo=!0),f.memoizedState=S):(Uo(S,_)||(S=Oo(),X.lanes|=S,uu|=S,f.baseState=!0),_)}function oc(f,_){var S=he;he=S!==0&&4>S?S:4,f(!0);var I=K.transition;K.transition={};try{f(!1),_()}finally{he=S,K.transition=I}}function ms(){return Xe().memoizedState}function $o(f,_,S){var I=Rl(f);if(S={lane:I,action:S,hasEagerState:!1,eagerState:null,next:null},Ua(f))Qi(_,S);else if(S=Li(f,_,S,I),S!==null){var N=Un();$a(S,f,I,N),an(S,_,I)}}function gs(f,_,S){var I=Rl(f),N={lane:I,action:S,hasEagerState:!1,eagerState:null,next:null};if(Ua(f))Qi(_,N);else{var H=f.alternate;if(f.lanes===0&&(H===null||H.lanes===0)&&(H=_.lastRenderedReducer,H!==null))try{var le=_.lastRenderedState,Ae=H(le,S);if(N.hasEagerState=!0,N.eagerState=Ae,Uo(Ae,le)){var Le=_.interleaved;Le===null?(N.next=N,Yr(_)):(N.next=Le.next,Le.next=N),_.interleaved=N;return}}catch{}finally{}S=Li(f,_,N,I),S!==null&&(N=Un(),$a(S,f,I,N),an(S,_,I))}}function Ua(f){var _=f.alternate;return f===X||_!==null&&_===X}function Qi(f,_){pe=fe=!0;var S=f.pending;S===null?_.next=_:(_.next=S.next,S.next=_),f.pending=_}function an(f,_,S){if((S&4194240)!==0){var I=_.lanes;I&=f.pendingLanes,S|=I,_.lanes=S,ae(f,S)}}var _s={readContext:mo,useCallback:ye,useContext:ye,useEffect:ye,useImperativeHandle:ye,useInsertionEffect:ye,useLayoutEffect:ye,useMemo:ye,useReducer:ye,useRef:ye,useState:ye,useDebugValue:ye,useDeferredValue:ye,useTransition:ye,useMutableSource:ye,useSyncExternalStore:ye,useId:ye,unstable_isNewReconciler:!1},ln={readContext:mo,useCallback:function(f,_){return ke().memoizedState=[f,_===void 0?null:_],f},useContext:mo,useEffect:Ji,useImperativeHandle:function(f,_,S){return S=S!=null?S.concat([f]):null,br(4194308,4,_o.bind(null,_,f),S)},useLayoutEffect:function(f,_){return br(4194308,4,f,_)},useInsertionEffect:function(f,_){return br(4,2,f,_)},useMemo:function(f,_){var S=ke();return _=_===void 0?null:_,f=f(),S.memoizedState=[f,_],f},useReducer:function(f,_,S){var I=ke();return _=S!==void 0?S(_):_,I.memoizedState=I.baseState=_,f={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:f,lastRenderedState:_},I.queue=f,f=f.dispatch=$o.bind(null,X,f),[I.memoizedState,f]},useRef:function(f){var _=ke();return f={current:f},_.memoizedState=f},useState:Jr,useDebugValue:ha,useDeferredValue:function(f){return ke().memoizedState=f},useTransition:function(){var f=Jr(!1),_=f[0];return f=oc.bind(null,f[1]),ke().memoizedState=f,[_,f]},useMutableSource:function(){},useSyncExternalStore:function(f,_,S){var I=X,N=ke();if(Ei){if(S===void 0)throw Error(r(407));S=S()}else{if(S=_(),vn===null)throw Error(r(349));(W&30)!==0||ut(I,_,S)}N.memoizedState=S;var H={value:S,getSnapshot:_};return N.queue=H,Ji(Sr.bind(null,I,H,f),[f]),I.flags|=2048,ui(9,jt.bind(null,I,H,S,_),void 0,null),S},useId:function(){var f=ke(),_=vn.identifierPrefix;if(Ei){var S=ds,I=Ls;S=(I&~(1<<32-Dn(I)-1)).toString(32)+S,_=":"+_+"R"+S,S=_e++,0<S&&(_+="H"+S.toString(32)),_+=":"}else S=we++,_=":"+_+"r"+S.toString(32)+":";return f.memoizedState=_},unstable_isNewReconciler:!1},sh={readContext:mo,useCallback:nc,useContext:mo,useEffect:on,useImperativeHandle:ja,useInsertionEffect:_n,useLayoutEffect:ps,useMemo:sc,useReducer:Ze,useRef:Si,useState:function(){return Ze(qe)},useDebugValue:ha,useDeferredValue:function(f){var _=Xe();return Sl(_,re.memoizedState,f)},useTransition:function(){var f=Ze(qe)[0],_=Xe().memoizedState;return[f,_]},useMutableSource:bt,useSyncExternalStore:wt,useId:ms,unstable_isNewReconciler:!1},lu={readContext:mo,useCallback:nc,useContext:mo,useEffect:on,useImperativeHandle:ja,useInsertionEffect:_n,useLayoutEffect:ps,useMemo:sc,useReducer:tt,useRef:Si,useState:function(){return tt(qe)},useDebugValue:ha,useDeferredValue:function(f){var _=Xe();return re===null?_.memoizedState=f:Sl(_,re.memoizedState,f)},useTransition:function(){var f=tt(qe)[0],_=Xe().memoizedState;return[f,_]},useMutableSource:bt,useSyncExternalStore:wt,useId:ms,unstable_isNewReconciler:!1};function yn(f,_){if(f&&f.defaultProps){_=Tt({},_),f=f.defaultProps;for(var S in f)_[S]===void 0&&(_[S]=f[S]);return _}return _}function eo(f,_,S,I){_=f.memoizedState,S=S(I,_),S=S==null?_:Tt({},_,S),f.memoizedState=S,f.lanes===0&&(f.updateQueue.baseState=S)}var Wo={isMounted:function(f){return(f=f._reactInternals)?hr(f)===f:!1},enqueueSetState:function(f,_,S){f=f._reactInternals;var I=Un(),N=Rl(f),H=Os(I,N);H.payload=_,S!=null&&(H.callback=S),_=Ds(f,H,N),_!==null&&($a(_,f,N,I),Tl(_,f,N))},enqueueReplaceState:function(f,_,S){f=f._reactInternals;var I=Un(),N=Rl(f),H=Os(I,N);H.tag=1,H.payload=_,S!=null&&(H.callback=S),_=Ds(f,H,N),_!==null&&($a(_,f,N,I),Tl(_,f,N))},enqueueForceUpdate:function(f,_){f=f._reactInternals;var S=Un(),I=Rl(f),N=Os(S,I);N.tag=2,_!=null&&(N.callback=_),_=Ds(f,N,I),_!==null&&($a(_,f,I,S),Tl(_,f,I))}};function Pf(f,_,S,I,N,H,le){return f=f.stateNode,typeof f.shouldComponentUpdate=="function"?f.shouldComponentUpdate(I,H,le):_.prototype&&_.prototype.isPureReactComponent?!Vu(S,I)||!Vu(N,H):!0}function Ns(f,_,S){var I=!1,N=Zs,H=_.contextType;return typeof H=="object"&&H!==null?H=mo(H):(N=Kn(_)?xl:Pn.current,I=_.contextTypes,H=(I=I!=null)?Go(f,N):Zs),_=new _(S,H),f.memoizedState=_.state!==null&&_.state!==void 0?_.state:null,_.updater=Wo,f.stateNode=_,_._reactInternals=f,I&&(f=f.stateNode,f.__reactInternalMemoizedUnmaskedChildContext=N,f.__reactInternalMemoizedMaskedChildContext=H),_}function Rf(f,_,S,I){f=_.state,typeof _.componentWillReceiveProps=="function"&&_.componentWillReceiveProps(S,I),typeof _.UNSAFE_componentWillReceiveProps=="function"&&_.UNSAFE_componentWillReceiveProps(S,I),_.state!==f&&Wo.enqueueReplaceState(_,_.state,null)}function oh(f,_,S,I){var N=f.stateNode;N.props=S,N.state=f.memoizedState,N.refs={},Al(f);var H=_.contextType;typeof H=="object"&&H!==null?N.context=mo(H):(H=Kn(_)?xl:Pn.current,N.context=Go(f,H)),N.state=f.memoizedState,H=_.getDerivedStateFromProps,typeof H=="function"&&(eo(f,_,H,S),N.state=f.memoizedState),typeof _.getDerivedStateFromProps=="function"||typeof N.getSnapshotBeforeUpdate=="function"||typeof N.UNSAFE_componentWillMount!="function"&&typeof N.componentWillMount!="function"||(_=N.state,typeof N.componentWillMount=="function"&&N.componentWillMount(),typeof N.UNSAFE_componentWillMount=="function"&&N.UNSAFE_componentWillMount(),_!==N.state&&Wo.enqueueReplaceState(N,N.state,null),ua(f,S,N,I),N.state=f.memoizedState),typeof N.componentDidMount=="function"&&(f.flags|=4194308)}function Va(f,_){try{var S="",I=_;do S+=Pr(I),I=I.return;while(I);var N=S}catch(H){N=`
Error generating stack: `+H.message+`
`+H.stack}return{value:f,source:_,stack:N,digest:null}}function cu(f,_,S){return{value:f,source:null,stack:S??null,digest:_??null}}function da(f,_){try{console.error(_.value)}catch(S){setTimeout(function(){throw S})}}var Ga=typeof WeakMap=="function"?WeakMap:Map;function $g(f,_,S){S=Os(-1,S),S.tag=3,S.payload={element:null};var I=_.value;return S.callback=function(){Yp||(Yp=!0,l_=I),da(f,_)},S}function Yy(f,_,S){S=Os(-1,S),S.tag=3;var I=f.type.getDerivedStateFromError;if(typeof I=="function"){var N=_.value;S.payload=function(){return I(N)},S.callback=function(){da(f,_)}}var H=f.stateNode;return H!==null&&typeof H.componentDidCatch=="function"&&(S.callback=function(){da(f,_),typeof I!="function"&&(Zo===null?Zo=new Set([this]):Zo.add(this));var le=_.stack;this.componentDidCatch(_.value,{componentStack:le!==null?le:""})}),S}function Wp(f,_,S){var I=f.pingCache;if(I===null){I=f.pingCache=new Ga;var N=new Set;I.set(_,N)}else N=I.get(_),N===void 0&&(N=new Set,I.set(_,N));N.has(S)||(N.add(S),f=v0.bind(null,f,_,S),_.then(f,f))}function Wg(f){do{var _;if((_=f.tag===13)&&(_=f.memoizedState,_=_!==null?_.dehydrated!==null:!0),_)return f;f=f.return}while(f!==null);return null}function Jy(f,_,S,I,N){return(f.mode&1)===0?(f===_?f.flags|=65536:(f.flags|=128,S.flags|=131072,S.flags&=-52805,S.tag===1&&(S.alternate===null?S.tag=17:(_=Os(-1,1),_.tag=2,Ds(S,_,1))),S.lanes|=1),f):(f.flags|=65536,f.lanes=N,f)}var Qy=me.ReactCurrentOwner,yo=!1;function ys(f,_,S,I){_.child=f===null?ih(_,null,S,I):fs(_,f.child,S,I)}function e0(f,_,S,I,N){S=S.render;var H=_.ref;return jn(_,N),I=Ie(f,_,S,I,H,N),S=be(),f!==null&&!yo?(_.updateQueue=f.updateQueue,_.flags&=-2053,f.lanes&=~N,qo(f,_,N)):(Ei&&S&&nu(_),_.flags|=1,ys(f,_,I,N),_.child)}function qp(f,_,S,I,N){if(f===null){var H=S.type;return typeof H=="function"&&!Wf(H)&&H.defaultProps===void 0&&S.compare===null&&S.defaultProps===void 0?(_.tag=15,_.type=H,qg(f,_,H,I,N)):(f=im(S.type,null,I,_,_.mode,N),f.ref=_.ref,f.return=_,_.child=f)}if(H=f.child,(f.lanes&N)===0){var le=H.memoizedProps;if(S=S.compare,S=S!==null?S:Vu,S(le,I)&&f.ref===_.ref)return qo(f,_,N)}return _.flags|=1,f=lc(H,I),f.ref=_.ref,f.return=_,_.child=f}function qg(f,_,S,I,N){if(f!==null){var H=f.memoizedProps;if(Vu(H,I)&&f.ref===_.ref)if(yo=!1,_.pendingProps=I=H,(f.lanes&N)!==0)(f.flags&131072)!==0&&(yo=!0);else return _.lanes=f.lanes,qo(f,_,N)}return Zg(f,_,S,I,N)}function Kg(f,_,S){var I=_.pendingProps,N=I.children,H=f!==null?f.memoizedState:null;if(I.mode==="hidden")if((_.mode&1)===0)_.memoizedState={baseLanes:0,cachePool:null,transitions:null},Dr(uh,Ko),Ko|=S;else{if((S&1073741824)===0)return f=H!==null?H.baseLanes|S:S,_.lanes=_.childLanes=1073741824,_.memoizedState={baseLanes:f,cachePool:null,transitions:null},_.updateQueue=null,Dr(uh,Ko),Ko|=f,null;_.memoizedState={baseLanes:0,cachePool:null,transitions:null},I=H!==null?H.baseLanes:S,Dr(uh,Ko),Ko|=I}else H!==null?(I=H.baseLanes|S,_.memoizedState=null):I=S,Dr(uh,Ko),Ko|=I;return ys(f,_,N,S),_.child}function ah(f,_){var S=_.ref;(f===null&&S!==null||f!==null&&f.ref!==S)&&(_.flags|=512,_.flags|=2097152)}function Zg(f,_,S,I,N){var H=Kn(S)?xl:Pn.current;return H=Go(_,H),jn(_,N),S=Ie(f,_,S,I,H,N),I=be(),f!==null&&!yo?(_.updateQueue=f.updateQueue,_.flags&=-2053,f.lanes&=~N,qo(f,_,N)):(Ei&&I&&nu(_),_.flags|=1,ys(f,_,S,N),_.child)}function td(f,_,S,I,N){if(Kn(S)){var H=!0;Is(_)}else H=!1;if(jn(_,N),_.stateNode===null)id(f,_),Ns(_,S,I),oh(_,S,I,N),I=!0;else if(f===null){var le=_.stateNode,Ae=_.memoizedProps;le.props=Ae;var Le=le.context,ot=S.contextType;typeof ot=="object"&&ot!==null?ot=mo(ot):(ot=Kn(S)?xl:Pn.current,ot=Go(_,ot));var xt=S.getDerivedStateFromProps,vt=typeof xt=="function"||typeof le.getSnapshotBeforeUpdate=="function";vt||typeof le.UNSAFE_componentWillReceiveProps!="function"&&typeof le.componentWillReceiveProps!="function"||(Ae!==I||Le!==ot)&&Rf(_,le,I,ot),Js=!1;var gt=_.memoizedState;le.state=gt,ua(_,I,le,N),Le=_.memoizedState,Ae!==I||gt!==Le||cs.current||Js?(typeof xt=="function"&&(eo(_,S,xt,I),Le=_.memoizedState),(Ae=Js||Pf(_,S,Ae,I,gt,Le,ot))?(vt||typeof le.UNSAFE_componentWillMount!="function"&&typeof le.componentWillMount!="function"||(typeof le.componentWillMount=="function"&&le.componentWillMount(),typeof le.UNSAFE_componentWillMount=="function"&&le.UNSAFE_componentWillMount()),typeof le.componentDidMount=="function"&&(_.flags|=4194308)):(typeof le.componentDidMount=="function"&&(_.flags|=4194308),_.memoizedProps=I,_.memoizedState=Le),le.props=I,le.state=Le,le.context=ot,I=Ae):(typeof le.componentDidMount=="function"&&(_.flags|=4194308),I=!1)}else{le=_.stateNode,Qh(f,_),Ae=_.memoizedProps,ot=_.type===_.elementType?Ae:yn(_.type,Ae),le.props=ot,vt=_.pendingProps,gt=le.context,Le=S.contextType,typeof Le=="object"&&Le!==null?Le=mo(Le):(Le=Kn(S)?xl:Pn.current,Le=Go(_,Le));var Vt=S.getDerivedStateFromProps;(xt=typeof Vt=="function"||typeof le.getSnapshotBeforeUpdate=="function")||typeof le.UNSAFE_componentWillReceiveProps!="function"&&typeof le.componentWillReceiveProps!="function"||(Ae!==vt||gt!==Le)&&Rf(_,le,I,Le),Js=!1,gt=_.memoizedState,le.state=gt,ua(_,I,le,N);var Kt=_.memoizedState;Ae!==vt||gt!==Kt||cs.current||Js?(typeof Vt=="function"&&(eo(_,S,Vt,I),Kt=_.memoizedState),(ot=Js||Pf(_,S,ot,I,gt,Kt,Le)||!1)?(xt||typeof le.UNSAFE_componentWillUpdate!="function"&&typeof le.componentWillUpdate!="function"||(typeof le.componentWillUpdate=="function"&&le.componentWillUpdate(I,Kt,Le),typeof le.UNSAFE_componentWillUpdate=="function"&&le.UNSAFE_componentWillUpdate(I,Kt,Le)),typeof le.componentDidUpdate=="function"&&(_.flags|=4),typeof le.getSnapshotBeforeUpdate=="function"&&(_.flags|=1024)):(typeof le.componentDidUpdate!="function"||Ae===f.memoizedProps&&gt===f.memoizedState||(_.flags|=4),typeof le.getSnapshotBeforeUpdate!="function"||Ae===f.memoizedProps&&gt===f.memoizedState||(_.flags|=1024),_.memoizedProps=I,_.memoizedState=Kt),le.props=I,le.state=Kt,le.context=Le,I=ot):(typeof le.componentDidUpdate!="function"||Ae===f.memoizedProps&&gt===f.memoizedState||(_.flags|=4),typeof le.getSnapshotBeforeUpdate!="function"||Ae===f.memoizedProps&&gt===f.memoizedState||(_.flags|=1024),I=!1)}return rd(f,_,S,I,H,N)}function rd(f,_,S,I,N,H){ah(f,_);var le=(_.flags&128)!==0;if(!I&&!le)return N&&tc(_,S,!1),qo(f,_,H);I=_.stateNode,Qy.current=_;var Ae=le&&typeof S.getDerivedStateFromError!="function"?null:I.render();return _.flags|=1,f!==null&&le?(_.child=fs(_,f.child,null,H),_.child=fs(_,null,Ae,H)):ys(f,_,Ae,H),_.memoizedState=I.state,N&&tc(_,S,!0),_.child}function Mf(f){var _=f.stateNode;_.pendingContext?xf(f,_.pendingContext,_.pendingContext!==_.context):_.context&&xf(f,_.context,!1),d(f,_.containerInfo)}function Xg(f,_,S,I,N){return ri(),El(N),_.flags|=256,ys(f,_,S,I),_.child}var Kp={dehydrated:null,treeContext:null,retryLane:0};function Yg(f){return{baseLanes:f,cachePool:null,transitions:null}}function t0(f,_,S){var I=_.pendingProps,N=C.current,H=!1,le=(_.flags&128)!==0,Ae;if((Ae=le)||(Ae=f!==null&&f.memoizedState===null?!1:(N&2)!==0),Ae?(H=!0,_.flags&=-129):(f===null||f.memoizedState!==null)&&(N|=1),Dr(C,N&1),f===null)return th(_),f=_.memoizedState,f!==null&&(f=f.dehydrated,f!==null)?((_.mode&1)===0?_.lanes=1:f.data==="$!"?_.lanes=8:_.lanes=1073741824,null):(le=I.children,f=I.fallback,H?(I=_.mode,H=_.child,le={mode:"hidden",children:le},(I&1)===0&&H!==null?(H.childLanes=0,H.pendingProps=le):H=nm(le,I,0,null),f=ph(f,I,S,null),H.return=_,f.return=_,H.sibling=f,_.child=H,_.child.memoizedState=Yg(S),_.memoizedState=Kp,f):Zp(_,le));if(N=f.memoizedState,N!==null&&(Ae=N.dehydrated,Ae!==null))return r0(f,_,le,I,Ae,N,S);if(H){H=I.fallback,le=_.mode,N=f.child,Ae=N.sibling;var Le={mode:"hidden",children:I.children};return(le&1)===0&&_.child!==N?(I=_.child,I.childLanes=0,I.pendingProps=Le,_.deletions=null):(I=lc(N,Le),I.subtreeFlags=N.subtreeFlags&14680064),Ae!==null?H=lc(Ae,H):(H=ph(H,le,S,null),H.flags|=2),H.return=_,I.return=_,I.sibling=H,_.child=I,I=H,H=_.child,le=f.child.memoizedState,le=le===null?Yg(S):{baseLanes:le.baseLanes|S,cachePool:null,transitions:le.transitions},H.memoizedState=le,H.childLanes=f.childLanes&~S,_.memoizedState=Kp,I}return H=f.child,f=H.sibling,I=lc(H,{mode:"visible",children:I.children}),(_.mode&1)===0&&(I.lanes=S),I.return=_,I.sibling=null,f!==null&&(S=_.deletions,S===null?(_.deletions=[f],_.flags|=16):S.push(f)),_.child=I,_.memoizedState=null,I}function Zp(f,_){return _=nm({mode:"visible",children:_},f.mode,0,null),_.return=f,f.child=_}function If(f,_,S,I){return I!==null&&El(I),fs(_,f.child,null,S),f=Zp(_,_.pendingProps.children),f.flags|=2,_.memoizedState=null,f}function r0(f,_,S,I,N,H,le){if(S)return _.flags&256?(_.flags&=-257,I=cu(Error(r(422))),If(f,_,le,I)):_.memoizedState!==null?(_.child=f.child,_.flags|=128,null):(H=I.fallback,N=_.mode,I=nm({mode:"visible",children:I.children},N,0,null),H=ph(H,N,le,null),H.flags|=2,I.return=_,H.return=_,I.sibling=H,_.child=I,(_.mode&1)!==0&&fs(_,f.child,null,le),_.child.memoizedState=Yg(le),_.memoizedState=Kp,H);if((_.mode&1)===0)return If(f,_,le,null);if(N.data==="$!"){if(I=N.nextSibling&&N.nextSibling.dataset,I)var Ae=I.dgst;return I=Ae,H=Error(r(419)),I=cu(H,I,void 0),If(f,_,le,I)}if(Ae=(le&f.childLanes)!==0,yo||Ae){if(I=vn,I!==null){switch(le&-le){case 4:N=2;break;case 16:N=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:N=32;break;case 536870912:N=268435456;break;default:N=0}N=(N&(I.suspendedLanes|le))!==0?0:N,N!==0&&N!==H.retryLane&&(H.retryLane=N,go(f,N),$a(I,f,N,-1))}return Vf(),I=cu(Error(r(421))),If(f,_,le,I)}return N.data==="$?"?(_.flags|=128,_.child=f.child,_=xb.bind(null,f),N._reactRetry=_,null):(f=H.treeContext,Xs=ei(N.nextSibling),Zn=_,Ei=!0,Ys=null,f!==null&&(Bs[hs++]=Ls,Bs[hs++]=ds,Bs[hs++]=Fa,Ls=f.id,ds=f.overflow,Fa=_),_=Zp(_,I.children),_.flags|=4096,_)}function i0(f,_,S){f.lanes|=_;var I=f.alternate;I!==null&&(I.lanes|=_),Jh(f.return,_,S)}function kf(f,_,S,I,N){var H=f.memoizedState;H===null?f.memoizedState={isBackwards:_,rendering:null,renderingStartTime:0,last:I,tail:S,tailMode:N}:(H.isBackwards=_,H.rendering=null,H.renderingStartTime=0,H.last=I,H.tail=S,H.tailMode=N)}function Jg(f,_,S){var I=_.pendingProps,N=I.revealOrder,H=I.tail;if(ys(f,_,I.children,S),I=C.current,(I&2)!==0)I=I&1|2,_.flags|=128;else{if(f!==null&&(f.flags&128)!==0)e:for(f=_.child;f!==null;){if(f.tag===13)f.memoizedState!==null&&i0(f,S,_);else if(f.tag===19)i0(f,S,_);else if(f.child!==null){f.child.return=f,f=f.child;continue}if(f===_)break e;for(;f.sibling===null;){if(f.return===null||f.return===_)break e;f=f.return}f.sibling.return=f.return,f=f.sibling}I&=1}if(Dr(C,I),(_.mode&1)===0)_.memoizedState=null;else switch(N){case"forwards":for(S=_.child,N=null;S!==null;)f=S.alternate,f!==null&&B(f)===null&&(N=S),S=S.sibling;S=N,S===null?(N=_.child,_.child=null):(N=S.sibling,S.sibling=null),kf(_,!1,N,S,H);break;case"backwards":for(S=null,N=_.child,_.child=null;N!==null;){if(f=N.alternate,f!==null&&B(f)===null){_.child=N;break}f=N.sibling,N.sibling=S,S=N,N=f}kf(_,!0,S,null,H);break;case"together":kf(_,!1,null,null,void 0);break;default:_.memoizedState=null}return _.child}function id(f,_){(_.mode&1)===0&&f!==null&&(f.alternate=null,_.alternate=null,_.flags|=2)}function qo(f,_,S){if(f!==null&&(_.dependencies=f.dependencies),uu|=_.lanes,(S&_.childLanes)===0)return null;if(f!==null&&_.child!==f.child)throw Error(r(153));if(_.child!==null){for(f=_.child,S=lc(f,f.pendingProps),_.child=S,S.return=_;f.sibling!==null;)f=f.sibling,S=S.sibling=lc(f,f.pendingProps),S.return=_;S.sibling=null}return _.child}function to(f,_,S){switch(_.tag){case 3:Mf(_),ri();break;case 5:v(_);break;case 1:Kn(_.type)&&Is(_);break;case 4:d(_,_.stateNode.containerInfo);break;case 10:var I=_.type._context,N=_.memoizedProps.value;Dr(zt,I._currentValue),I._currentValue=N;break;case 13:if(I=_.memoizedState,I!==null)return I.dehydrated!==null?(Dr(C,C.current&1),_.flags|=128,null):(S&_.child.childLanes)!==0?t0(f,_,S):(Dr(C,C.current&1),f=qo(f,_,S),f!==null?f.sibling:null);Dr(C,C.current&1);break;case 19:if(I=(S&_.childLanes)!==0,(f.flags&128)!==0){if(I)return Jg(f,_,S);_.flags|=128}if(N=_.memoizedState,N!==null&&(N.rendering=null,N.tail=null,N.lastEffect=null),Dr(C,C.current),I)break;return null;case 22:case 23:return _.lanes=0,Kg(f,_,S)}return qo(f,_,S)}var Qg,Bf,n0,e_;Qg=function(f,_){for(var S=_.child;S!==null;){if(S.tag===5||S.tag===6)f.appendChild(S.stateNode);else if(S.tag!==4&&S.child!==null){S.child.return=S,S=S.child;continue}if(S===_)break;for(;S.sibling===null;){if(S.return===null||S.return===_)return;S=S.return}S.sibling.return=S.return,S=S.sibling}},Bf=function(){},n0=function(f,_,S,I){var N=f.memoizedProps;if(N!==I){f=_.stateNode,s(Qs.current);var H=null;switch(S){case"input":N=si(f,N),I=si(f,I),H=[];break;case"select":N=Tt({},N,{value:void 0}),I=Tt({},I,{value:void 0}),H=[];break;case"textarea":N=lo(f,N),I=lo(f,I),H=[];break;default:typeof N.onClick!="function"&&typeof I.onClick=="function"&&(f.onclick=eu)}Ye(S,I);var le;S=null;for(ot in N)if(!I.hasOwnProperty(ot)&&N.hasOwnProperty(ot)&&N[ot]!=null)if(ot==="style"){var Ae=N[ot];for(le in Ae)Ae.hasOwnProperty(le)&&(S||(S={}),S[le]="")}else ot!=="dangerouslySetInnerHTML"&&ot!=="children"&&ot!=="suppressContentEditableWarning"&&ot!=="suppressHydrationWarning"&&ot!=="autoFocus"&&(n.hasOwnProperty(ot)?H||(H=[]):(H=H||[]).push(ot,null));for(ot in I){var Le=I[ot];if(Ae=N?.[ot],I.hasOwnProperty(ot)&&Le!==Ae&&(Le!=null||Ae!=null))if(ot==="style")if(Ae){for(le in Ae)!Ae.hasOwnProperty(le)||Le&&Le.hasOwnProperty(le)||(S||(S={}),S[le]="");for(le in Le)Le.hasOwnProperty(le)&&Ae[le]!==Le[le]&&(S||(S={}),S[le]=Le[le])}else S||(H||(H=[]),H.push(ot,S)),S=Le;else ot==="dangerouslySetInnerHTML"?(Le=Le?Le.__html:void 0,Ae=Ae?Ae.__html:void 0,Le!=null&&Ae!==Le&&(H=H||[]).push(ot,Le)):ot==="children"?typeof Le!="string"&&typeof Le!="number"||(H=H||[]).push(ot,""+Le):ot!=="suppressContentEditableWarning"&&ot!=="suppressHydrationWarning"&&(n.hasOwnProperty(ot)?(Le!=null&&ot==="onScroll"&&bi("scroll",f),H||Ae===Le||(H=[])):(H=H||[]).push(ot,Le))}S&&(H=H||[]).push("style",S);var ot=H;(_.updateQueue=ot)&&(_.flags|=4)}},e_=function(f,_,S,I){S!==I&&(_.flags|=4)};function Lf(f,_){if(!Ei)switch(f.tailMode){case"hidden":_=f.tail;for(var S=null;_!==null;)_.alternate!==null&&(S=_),_=_.sibling;S===null?f.tail=null:S.sibling=null;break;case"collapsed":S=f.tail;for(var I=null;S!==null;)S.alternate!==null&&(I=S),S=S.sibling;I===null?_||f.tail===null?f.tail=null:f.tail.sibling=null:I.sibling=null}}function Fs(f){var _=f.alternate!==null&&f.alternate.child===f.child,S=0,I=0;if(_)for(var N=f.child;N!==null;)S|=N.lanes|N.childLanes,I|=N.subtreeFlags&14680064,I|=N.flags&14680064,N.return=f,N=N.sibling;else for(N=f.child;N!==null;)S|=N.lanes|N.childLanes,I|=N.subtreeFlags,I|=N.flags,N.return=f,N=N.sibling;return f.subtreeFlags|=I,f.childLanes=S,_}function s0(f,_,S){var I=_.pendingProps;switch(Ef(_),_.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Fs(_),null;case 1:return Kn(_.type)&&Da(),Fs(_),null;case 3:return I=_.stateNode,g(),ti(cs),ti(Pn),F(),I.pendingContext&&(I.context=I.pendingContext,I.pendingContext=null),(f===null||f.child===null)&&(rh(_)?_.flags|=4:f===null||f.memoizedState.isDehydrated&&(_.flags&256)===0||(_.flags|=1024,Ys!==null&&(u_(Ys),Ys=null))),Bf(f,_),Fs(_),null;case 5:w(_);var N=s(x.current);if(S=_.type,f!==null&&_.stateNode!=null)n0(f,_,S,I,N),f.ref!==_.ref&&(_.flags|=512,_.flags|=2097152);else{if(!I){if(_.stateNode===null)throw Error(r(166));return Fs(_),null}if(f=s(Qs.current),rh(_)){I=_.stateNode,S=_.type;var H=_.memoizedProps;switch(I[Ks]=_,I[ka]=H,f=(_.mode&1)!==0,S){case"dialog":bi("cancel",I),bi("close",I);break;case"iframe":case"object":case"embed":bi("load",I);break;case"video":case"audio":for(N=0;N<Xc.length;N++)bi(Xc[N],I);break;case"source":bi("error",I);break;case"img":case"image":case"link":bi("error",I),bi("load",I);break;case"details":bi("toggle",I);break;case"input":Tn(I,H),bi("invalid",I);break;case"select":I._wrapperState={wasMultiple:!!H.multiple},bi("invalid",I);break;case"textarea":Po(I,H),bi("invalid",I)}Ye(S,H),N=null;for(var le in H)if(H.hasOwnProperty(le)){var Ae=H[le];le==="children"?typeof Ae=="string"?I.textContent!==Ae&&(H.suppressHydrationWarning!==!0&&na(I.textContent,Ae,f),N=["children",Ae]):typeof Ae=="number"&&I.textContent!==""+Ae&&(H.suppressHydrationWarning!==!0&&na(I.textContent,Ae,f),N=["children",""+Ae]):n.hasOwnProperty(le)&&Ae!=null&&le==="onScroll"&&bi("scroll",I)}switch(S){case"input":An(I),Ps(I,H,!0);break;case"textarea":An(I),Ro(I);break;case"select":case"option":break;default:typeof H.onClick=="function"&&(I.onclick=eu)}I=N,_.updateQueue=I,I!==null&&(_.flags|=4)}else{le=N.nodeType===9?N:N.ownerDocument,f==="http://www.w3.org/1999/xhtml"&&(f=Mo(S)),f==="http://www.w3.org/1999/xhtml"?S==="script"?(f=le.createElement("div"),f.innerHTML="<script><\/script>",f=f.removeChild(f.firstChild)):typeof I.is=="string"?f=le.createElement(S,{is:I.is}):(f=le.createElement(S),S==="select"&&(le=f,I.multiple?le.multiple=!0:I.size&&(le.size=I.size))):f=le.createElementNS(f,S),f[Ks]=_,f[ka]=I,Qg(f,_,!1,!1),_.stateNode=f;e:{switch(le=De(S,I),S){case"dialog":bi("cancel",f),bi("close",f),N=I;break;case"iframe":case"object":case"embed":bi("load",f),N=I;break;case"video":case"audio":for(N=0;N<Xc.length;N++)bi(Xc[N],f);N=I;break;case"source":bi("error",f),N=I;break;case"img":case"image":case"link":bi("error",f),bi("load",f),N=I;break;case"details":bi("toggle",f),N=I;break;case"input":Tn(f,I),N=si(f,I),bi("invalid",f);break;case"option":N=I;break;case"select":f._wrapperState={wasMultiple:!!I.multiple},N=Tt({},I,{value:void 0}),bi("invalid",f);break;case"textarea":Po(f,I),N=lo(f,I),bi("invalid",f);break;default:N=I}Ye(S,N),Ae=N;for(H in Ae)if(Ae.hasOwnProperty(H)){var Le=Ae[H];H==="style"?Ce(f,Le):H==="dangerouslySetInnerHTML"?(Le=Le?Le.__html:void 0,Le!=null&&Oe(f,Le)):H==="children"?typeof Le=="string"?(S!=="textarea"||Le!=="")&&ne(f,Le):typeof Le=="number"&&ne(f,""+Le):H!=="suppressContentEditableWarning"&&H!=="suppressHydrationWarning"&&H!=="autoFocus"&&(n.hasOwnProperty(H)?Le!=null&&H==="onScroll"&&bi("scroll",f):Le!=null&&ee(f,H,Le,le))}switch(S){case"input":An(f),Ps(f,I,!1);break;case"textarea":An(f),Ro(f);break;case"option":I.value!=null&&f.setAttribute("value",""+pr(I.value));break;case"select":f.multiple=!!I.multiple,H=I.value,H!=null?vi(f,!!I.multiple,H,!1):I.defaultValue!=null&&vi(f,!!I.multiple,I.defaultValue,!0);break;default:typeof N.onClick=="function"&&(f.onclick=eu)}switch(S){case"button":case"input":case"select":case"textarea":I=!!I.autoFocus;break e;case"img":I=!0;break e;default:I=!1}}I&&(_.flags|=4)}_.ref!==null&&(_.flags|=512,_.flags|=2097152)}return Fs(_),null;case 6:if(f&&_.stateNode!=null)e_(f,_,f.memoizedProps,I);else{if(typeof I!="string"&&_.stateNode===null)throw Error(r(166));if(S=s(x.current),s(Qs.current),rh(_)){if(I=_.stateNode,S=_.memoizedProps,I[Ks]=_,(H=I.nodeValue!==S)&&(f=Zn,f!==null))switch(f.tag){case 3:na(I.nodeValue,S,(f.mode&1)!==0);break;case 5:f.memoizedProps.suppressHydrationWarning!==!0&&na(I.nodeValue,S,(f.mode&1)!==0)}H&&(_.flags|=4)}else I=(S.nodeType===9?S:S.ownerDocument).createTextNode(I),I[Ks]=_,_.stateNode=I}return Fs(_),null;case 13:if(ti(C),I=_.memoizedState,f===null||f.memoizedState!==null&&f.memoizedState.dehydrated!==null){if(Ei&&Xs!==null&&(_.mode&1)!==0&&(_.flags&128)===0)po(),ri(),_.flags|=98560,H=!1;else if(H=rh(_),I!==null&&I.dehydrated!==null){if(f===null){if(!H)throw Error(r(318));if(H=_.memoizedState,H=H!==null?H.dehydrated:null,!H)throw Error(r(317));H[Ks]=_}else ri(),(_.flags&128)===0&&(_.memoizedState=null),_.flags|=4;Fs(_),H=!1}else Ys!==null&&(u_(Ys),Ys=null),H=!0;if(!H)return _.flags&65536?_:null}return(_.flags&128)!==0?(_.lanes=S,_):(I=I!==null,I!==(f!==null&&f.memoizedState!==null)&&I&&(_.child.flags|=8192,(_.mode&1)!==0&&(f===null||(C.current&1)!==0?Di===0&&(Di=3):Vf())),_.updateQueue!==null&&(_.flags|=4),Fs(_),null);case 4:return g(),Bf(f,_),f===null&&bl(_.stateNode.containerInfo),Fs(_),null;case 10:return zn(_.type._context),Fs(_),null;case 17:return Kn(_.type)&&Da(),Fs(_),null;case 19:if(ti(C),H=_.memoizedState,H===null)return Fs(_),null;if(I=(_.flags&128)!==0,le=H.rendering,le===null)if(I)Lf(H,!1);else{if(Di!==0||f!==null&&(f.flags&128)!==0)for(f=_.child;f!==null;){if(le=B(f),le!==null){for(_.flags|=128,Lf(H,!1),I=le.updateQueue,I!==null&&(_.updateQueue=I,_.flags|=4),_.subtreeFlags=0,I=S,S=_.child;S!==null;)H=S,f=I,H.flags&=14680066,le=H.alternate,le===null?(H.childLanes=0,H.lanes=f,H.child=null,H.subtreeFlags=0,H.memoizedProps=null,H.memoizedState=null,H.updateQueue=null,H.dependencies=null,H.stateNode=null):(H.childLanes=le.childLanes,H.lanes=le.lanes,H.child=le.child,H.subtreeFlags=0,H.deletions=null,H.memoizedProps=le.memoizedProps,H.memoizedState=le.memoizedState,H.updateQueue=le.updateQueue,H.type=le.type,f=le.dependencies,H.dependencies=f===null?null:{lanes:f.lanes,firstContext:f.firstContext}),S=S.sibling;return Dr(C,C.current&1|2),_.child}f=f.sibling}H.tail!==null&&wr()>ud&&(_.flags|=128,I=!0,Lf(H,!1),_.lanes=4194304)}else{if(!I)if(f=B(le),f!==null){if(_.flags|=128,I=!0,S=f.updateQueue,S!==null&&(_.updateQueue=S,_.flags|=4),Lf(H,!0),H.tail===null&&H.tailMode==="hidden"&&!le.alternate&&!Ei)return Fs(_),null}else 2*wr()-H.renderingStartTime>ud&&S!==1073741824&&(_.flags|=128,I=!0,Lf(H,!1),_.lanes=4194304);H.isBackwards?(le.sibling=_.child,_.child=le):(S=H.last,S!==null?S.sibling=le:_.child=le,H.last=le)}return H.tail!==null?(_=H.tail,H.rendering=_,H.tail=_.sibling,H.renderingStartTime=wr(),_.sibling=null,S=C.current,Dr(C,I?S&1|2:S&1),_):(Fs(_),null);case 22:case 23:return f_(),I=_.memoizedState!==null,f!==null&&f.memoizedState!==null!==I&&(_.flags|=8192),I&&(_.mode&1)!==0?(Ko&1073741824)!==0&&(Fs(_),_.subtreeFlags&6&&(_.flags|=8192)):Fs(_),null;case 24:return null;case 25:return null}throw Error(r(156,_.tag))}function vb(f,_){switch(Ef(_),_.tag){case 1:return Kn(_.type)&&Da(),f=_.flags,f&65536?(_.flags=f&-65537|128,_):null;case 3:return g(),ti(cs),ti(Pn),F(),f=_.flags,(f&65536)!==0&&(f&128)===0?(_.flags=f&-65537|128,_):null;case 5:return w(_),null;case 13:if(ti(C),f=_.memoizedState,f!==null&&f.dehydrated!==null){if(_.alternate===null)throw Error(r(340));ri()}return f=_.flags,f&65536?(_.flags=f&-65537|128,_):null;case 19:return ti(C),null;case 4:return g(),null;case 10:return zn(_.type._context),null;case 22:case 23:return f_(),null;case 24:return null;default:return null}}var nd=!1,vs=!1,o0=typeof WeakSet=="function"?WeakSet:Set,qt=null;function sd(f,_){var S=f.ref;if(S!==null)if(typeof S=="function")try{S(null)}catch(I){cn(f,_,I)}else S.current=null}function t_(f,_,S){try{S()}catch(I){cn(f,_,I)}}var Xp=!1;function r_(f,_){if(tu=qn,f=gf(),Kc(f)){if("selectionStart"in f)var S={start:f.selectionStart,end:f.selectionEnd};else e:{S=(S=f.ownerDocument)&&S.defaultView||window;var I=S.getSelection&&S.getSelection();if(I&&I.rangeCount!==0){S=I.anchorNode;var N=I.anchorOffset,H=I.focusNode;I=I.focusOffset;try{S.nodeType,H.nodeType}catch{S=null;break e}var le=0,Ae=-1,Le=-1,ot=0,xt=0,vt=f,gt=null;t:for(;;){for(var Vt;vt!==S||N!==0&&vt.nodeType!==3||(Ae=le+N),vt!==H||I!==0&&vt.nodeType!==3||(Le=le+I),vt.nodeType===3&&(le+=vt.nodeValue.length),(Vt=vt.firstChild)!==null;)gt=vt,vt=Vt;for(;;){if(vt===f)break t;if(gt===S&&++ot===N&&(Ae=le),gt===H&&++xt===I&&(Le=le),(Vt=vt.nextSibling)!==null)break;vt=gt,gt=vt.parentNode}vt=Vt}S=Ae===-1||Le===-1?null:{start:Ae,end:Le}}else S=null}S=S||{start:0,end:0}}else S=null;for(Ia={focusedElem:f,selectionRange:S},qn=!1,qt=_;qt!==null;)if(_=qt,f=_.child,(_.subtreeFlags&1028)!==0&&f!==null)f.return=_,qt=f;else for(;qt!==null;){_=qt;try{var Kt=_.alternate;if((_.flags&1024)!==0)switch(_.tag){case 0:case 11:case 15:break;case 1:if(Kt!==null){var tr=Kt.memoizedProps,$i=Kt.memoizedState,Qe=_.stateNode,Ue=Qe.getSnapshotBeforeUpdate(_.elementType===_.type?tr:yn(_.type,tr),$i);Qe.__reactInternalSnapshotBeforeUpdate=Ue}break;case 3:var it=_.stateNode.containerInfo;it.nodeType===1?it.textContent="":it.nodeType===9&&it.documentElement&&it.removeChild(it.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(r(163))}}catch(Rt){cn(_,_.return,Rt)}if(f=_.sibling,f!==null){f.return=_.return,qt=f;break}qt=_.return}return Kt=Xp,Xp=!1,Kt}function od(f,_,S){var I=_.updateQueue;if(I=I!==null?I.lastEffect:null,I!==null){var N=I=I.next;do{if((N.tag&f)===f){var H=N.destroy;N.destroy=void 0,H!==void 0&&t_(_,S,H)}N=N.next}while(N!==I)}}function Cl(f,_){if(_=_.updateQueue,_=_!==null?_.lastEffect:null,_!==null){var S=_=_.next;do{if((S.tag&f)===f){var I=S.create;S.destroy=I()}S=S.next}while(S!==_)}}function lh(f){var _=f.ref;if(_!==null){var S=f.stateNode;switch(f.tag){case 5:f=S;break;default:f=S}typeof _=="function"?_(f):_.current=f}}function a0(f){var _=f.alternate;_!==null&&(f.alternate=null,a0(_)),f.child=null,f.deletions=null,f.sibling=null,f.tag===5&&(_=f.stateNode,_!==null&&(delete _[Ks],delete _[ka],delete _[Ba],delete _[qh],delete _[La])),f.stateNode=null,f.return=null,f.dependencies=null,f.memoizedProps=null,f.memoizedState=null,f.pendingProps=null,f.stateNode=null,f.updateQueue=null}function l0(f){return f.tag===5||f.tag===3||f.tag===4}function c0(f){e:for(;;){for(;f.sibling===null;){if(f.return===null||l0(f.return))return null;f=f.return}for(f.sibling.return=f.return,f=f.sibling;f.tag!==5&&f.tag!==6&&f.tag!==18;){if(f.flags&2||f.child===null||f.tag===4)continue e;f.child.return=f,f=f.child}if(!(f.flags&2))return f.stateNode}}function i_(f,_,S){var I=f.tag;if(I===5||I===6)f=f.stateNode,_?S.nodeType===8?S.parentNode.insertBefore(f,_):S.insertBefore(f,_):(S.nodeType===8?(_=S.parentNode,_.insertBefore(f,S)):(_=S,_.appendChild(f)),S=S._reactRootContainer,S!=null||_.onclick!==null||(_.onclick=eu));else if(I!==4&&(f=f.child,f!==null))for(i_(f,_,S),f=f.sibling;f!==null;)i_(f,_,S),f=f.sibling}function n_(f,_,S){var I=f.tag;if(I===5||I===6)f=f.stateNode,_?S.insertBefore(f,_):S.appendChild(f);else if(I!==4&&(f=f.child,f!==null))for(n_(f,_,S),f=f.sibling;f!==null;)n_(f,_,S),f=f.sibling}var bs=null,Ha=!1;function Pl(f,_,S){for(S=S.child;S!==null;)u0(f,_,S),S=S.sibling}function u0(f,_,S){if(sn&&typeof sn.onCommitFiberUnmount=="function")try{sn.onCommitFiberUnmount(Zi,S)}catch{}switch(S.tag){case 5:vs||sd(S,_);case 6:var I=bs,N=Ha;bs=null,Pl(f,_,S),bs=I,Ha=N,bs!==null&&(Ha?(f=bs,S=S.stateNode,f.nodeType===8?f.parentNode.removeChild(S):f.removeChild(S)):bs.removeChild(S.stateNode));break;case 18:bs!==null&&(Ha?(f=bs,S=S.stateNode,f.nodeType===8?Qu(f.parentNode,S):f.nodeType===1&&Qu(f,S),Ws(f)):Qu(bs,S.stateNode));break;case 4:I=bs,N=Ha,bs=S.stateNode.containerInfo,Ha=!0,Pl(f,_,S),bs=I,Ha=N;break;case 0:case 11:case 14:case 15:if(!vs&&(I=S.updateQueue,I!==null&&(I=I.lastEffect,I!==null))){N=I=I.next;do{var H=N,le=H.destroy;H=H.tag,le!==void 0&&((H&2)!==0||(H&4)!==0)&&t_(S,_,le),N=N.next}while(N!==I)}Pl(f,_,S);break;case 1:if(!vs&&(sd(S,_),I=S.stateNode,typeof I.componentWillUnmount=="function"))try{I.props=S.memoizedProps,I.state=S.memoizedState,I.componentWillUnmount()}catch(Ae){cn(S,_,Ae)}Pl(f,_,S);break;case 21:Pl(f,_,S);break;case 22:S.mode&1?(vs=(I=vs)||S.memoizedState!==null,Pl(f,_,S),vs=I):Pl(f,_,S);break;default:Pl(f,_,S)}}function s_(f){var _=f.updateQueue;if(_!==null){f.updateQueue=null;var S=f.stateNode;S===null&&(S=f.stateNode=new o0),_.forEach(function(I){var N=$f.bind(null,f,I);S.has(I)||(S.add(I),I.then(N,N))})}}function ro(f,_){var S=_.deletions;if(S!==null)for(var I=0;I<S.length;I++){var N=S[I];try{var H=f,le=_,Ae=le;e:for(;Ae!==null;){switch(Ae.tag){case 5:bs=Ae.stateNode,Ha=!1;break e;case 3:bs=Ae.stateNode.containerInfo,Ha=!0;break e;case 4:bs=Ae.stateNode.containerInfo,Ha=!0;break e}Ae=Ae.return}if(bs===null)throw Error(r(160));u0(H,le,N),bs=null,Ha=!1;var Le=N.alternate;Le!==null&&(Le.return=null),N.return=null}catch(ot){cn(N,_,ot)}}if(_.subtreeFlags&12854)for(_=_.child;_!==null;)h0(_,f),_=_.sibling}function h0(f,_){var S=f.alternate,I=f.flags;switch(f.tag){case 0:case 11:case 14:case 15:if(ro(_,f),ni(f),I&4){try{od(3,f,f.return),Cl(3,f)}catch(tr){cn(f,f.return,tr)}try{od(5,f,f.return)}catch(tr){cn(f,f.return,tr)}}break;case 1:ro(_,f),ni(f),I&512&&S!==null&&sd(S,S.return);break;case 5:if(ro(_,f),ni(f),I&512&&S!==null&&sd(S,S.return),f.flags&32){var N=f.stateNode;try{ne(N,"")}catch(tr){cn(f,f.return,tr)}}if(I&4&&(N=f.stateNode,N!=null)){var H=f.memoizedProps,le=S!==null?S.memoizedProps:H,Ae=f.type,Le=f.updateQueue;if(f.updateQueue=null,Le!==null)try{Ae==="input"&&H.type==="radio"&&H.name!=null&&zi(N,H),De(Ae,le);var ot=De(Ae,H);for(le=0;le<Le.length;le+=2){var xt=Le[le],vt=Le[le+1];xt==="style"?Ce(N,vt):xt==="dangerouslySetInnerHTML"?Oe(N,vt):xt==="children"?ne(N,vt):ee(N,xt,vt,ot)}switch(Ae){case"input":Ln(N,H);break;case"textarea":ea(N,H);break;case"select":var gt=N._wrapperState.wasMultiple;N._wrapperState.wasMultiple=!!H.multiple;var Vt=H.value;Vt!=null?vi(N,!!H.multiple,Vt,!1):gt!==!!H.multiple&&(H.defaultValue!=null?vi(N,!!H.multiple,H.defaultValue,!0):vi(N,!!H.multiple,H.multiple?[]:"",!1))}N[ka]=H}catch(tr){cn(f,f.return,tr)}}break;case 6:if(ro(_,f),ni(f),I&4){if(f.stateNode===null)throw Error(r(162));N=f.stateNode,H=f.memoizedProps;try{N.nodeValue=H}catch(tr){cn(f,f.return,tr)}}break;case 3:if(ro(_,f),ni(f),I&4&&S!==null&&S.memoizedState.isDehydrated)try{Ws(_.containerInfo)}catch(tr){cn(f,f.return,tr)}break;case 4:ro(_,f),ni(f);break;case 13:ro(_,f),ni(f),N=f.child,N.flags&8192&&(H=N.memoizedState!==null,N.stateNode.isHidden=H,!H||N.alternate!==null&&N.alternate.memoizedState!==null||(a_=wr())),I&4&&s_(f);break;case 22:if(xt=S!==null&&S.memoizedState!==null,f.mode&1?(vs=(ot=vs)||xt,ro(_,f),vs=ot):ro(_,f),ni(f),I&8192){if(ot=f.memoizedState!==null,(f.stateNode.isHidden=ot)&&!xt&&(f.mode&1)!==0)for(qt=f,xt=f.child;xt!==null;){for(vt=qt=xt;qt!==null;){switch(gt=qt,Vt=gt.child,gt.tag){case 0:case 11:case 14:case 15:od(4,gt,gt.return);break;case 1:sd(gt,gt.return);var Kt=gt.stateNode;if(typeof Kt.componentWillUnmount=="function"){I=gt,S=gt.return;try{_=I,Kt.props=_.memoizedProps,Kt.state=_.memoizedState,Kt.componentWillUnmount()}catch(tr){cn(I,S,tr)}}break;case 5:sd(gt,gt.return);break;case 22:if(gt.memoizedState!==null){Df(vt);continue}}Vt!==null?(Vt.return=gt,qt=Vt):Df(vt)}xt=xt.sibling}e:for(xt=null,vt=f;;){if(vt.tag===5){if(xt===null){xt=vt;try{N=vt.stateNode,ot?(H=N.style,typeof H.setProperty=="function"?H.setProperty("display","none","important"):H.display="none"):(Ae=vt.stateNode,Le=vt.memoizedProps.style,le=Le!=null&&Le.hasOwnProperty("display")?Le.display:null,Ae.style.display=xe("display",le))}catch(tr){cn(f,f.return,tr)}}}else if(vt.tag===6){if(xt===null)try{vt.stateNode.nodeValue=ot?"":vt.memoizedProps}catch(tr){cn(f,f.return,tr)}}else if((vt.tag!==22&&vt.tag!==23||vt.memoizedState===null||vt===f)&&vt.child!==null){vt.child.return=vt,vt=vt.child;continue}if(vt===f)break e;for(;vt.sibling===null;){if(vt.return===null||vt.return===f)break e;xt===vt&&(xt=null),vt=vt.return}xt===vt&&(xt=null),vt.sibling.return=vt.return,vt=vt.sibling}}break;case 19:ro(_,f),ni(f),I&4&&s_(f);break;case 21:break;default:ro(_,f),ni(f)}}function ni(f){var _=f.flags;if(_&2){try{e:{for(var S=f.return;S!==null;){if(l0(S)){var I=S;break e}S=S.return}throw Error(r(160))}switch(I.tag){case 5:var N=I.stateNode;I.flags&32&&(ne(N,""),I.flags&=-33);var H=c0(f);n_(f,H,N);break;case 3:case 4:var le=I.stateNode.containerInfo,Ae=c0(f);i_(f,Ae,le);break;default:throw Error(r(161))}}catch(Le){cn(f,f.return,Le)}f.flags&=-3}_&4096&&(f.flags&=-4097)}function ad(f,_,S){qt=f,o_(f)}function o_(f,_,S){for(var I=(f.mode&1)!==0;qt!==null;){var N=qt,H=N.child;if(N.tag===22&&I){var le=N.memoizedState!==null||nd;if(!le){var Ae=N.alternate,Le=Ae!==null&&Ae.memoizedState!==null||vs;Ae=nd;var ot=vs;if(nd=le,(vs=Le)&&!ot)for(qt=N;qt!==null;)le=qt,Le=le.child,le.tag===22&&le.memoizedState!==null?ld(N):Le!==null?(Le.return=le,qt=Le):ld(N);for(;H!==null;)qt=H,o_(H),H=H.sibling;qt=N,nd=Ae,vs=ot}Of(f)}else(N.subtreeFlags&8772)!==0&&H!==null?(H.return=N,qt=H):Of(f)}}function Of(f){for(;qt!==null;){var _=qt;if((_.flags&8772)!==0){var S=_.alternate;try{if((_.flags&8772)!==0)switch(_.tag){case 0:case 11:case 15:vs||Cl(5,_);break;case 1:var I=_.stateNode;if(_.flags&4&&!vs)if(S===null)I.componentDidMount();else{var N=_.elementType===_.type?S.memoizedProps:yn(_.type,S.memoizedProps);I.componentDidUpdate(N,S.memoizedState,I.__reactInternalSnapshotBeforeUpdate)}var H=_.updateQueue;H!==null&&ed(_,H,I);break;case 3:var le=_.updateQueue;if(le!==null){if(S=null,_.child!==null)switch(_.child.tag){case 5:S=_.child.stateNode;break;case 1:S=_.child.stateNode}ed(_,le,S)}break;case 5:var Ae=_.stateNode;if(S===null&&_.flags&4){S=Ae;var Le=_.memoizedProps;switch(_.type){case"button":case"input":case"select":case"textarea":Le.autoFocus&&S.focus();break;case"img":Le.src&&(S.src=Le.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(_.memoizedState===null){var ot=_.alternate;if(ot!==null){var xt=ot.memoizedState;if(xt!==null){var vt=xt.dehydrated;vt!==null&&Ws(vt)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(r(163))}vs||_.flags&512&&lh(_)}catch(gt){cn(_,_.return,gt)}}if(_===f){qt=null;break}if(S=_.sibling,S!==null){S.return=_.return,qt=S;break}qt=_.return}}function Df(f){for(;qt!==null;){var _=qt;if(_===f){qt=null;break}var S=_.sibling;if(S!==null){S.return=_.return,qt=S;break}qt=_.return}}function ld(f){for(;qt!==null;){var _=qt;try{switch(_.tag){case 0:case 11:case 15:var S=_.return;try{Cl(4,_)}catch(Le){cn(_,S,Le)}break;case 1:var I=_.stateNode;if(typeof I.componentDidMount=="function"){var N=_.return;try{I.componentDidMount()}catch(Le){cn(_,N,Le)}}var H=_.return;try{lh(_)}catch(Le){cn(_,H,Le)}break;case 5:var le=_.return;try{lh(_)}catch(Le){cn(_,le,Le)}}}catch(Le){cn(_,_.return,Le)}if(_===f){qt=null;break}var Ae=_.sibling;if(Ae!==null){Ae.return=_.return,qt=Ae;break}qt=_.return}}var d0=Math.ceil,Nf=me.ReactCurrentDispatcher,ch=me.ReactCurrentOwner,vo=me.ReactCurrentBatchConfig,jr=0,vn=null,Oi=null,bn=0,Ko=0,uh=Cn(0),Di=0,Ff=null,uu=0,hu=0,zf=0,cd=null,io=null,a_=0,ud=1/0,ac=null,Yp=!1,l_=null,Zo=null,Jp=!1,du=null,jf=0,Uf=0,Qp=null,em=-1,hd=0;function Un(){return(jr&6)!==0?wr():em!==-1?em:em=wr()}function Rl(f){return(f.mode&1)===0?1:(jr&2)!==0&&bn!==0?bn&-bn:Sf.transition!==null?(hd===0&&(hd=Oo()),hd):(f=he,f!==0||(f=window.event,f=f===void 0?16:Fc(f.type)),f)}function $a(f,_,S,I){if(50<Uf)throw Uf=0,Qp=null,Error(r(185));Aa(f,S,I),((jr&2)===0||f!==vn)&&(f===vn&&((jr&2)===0&&(hu|=S),Di===4&&fa(f,bn)),bo(f,I),S===1&&jr===0&&(_.mode&1)===0&&(ud=wr()+500,Na&&wl()))}function bo(f,_){var S=f.callbackNode;Lu(f,_);var I=Lo(f,f===vn?bn:0);if(I===0)S!==null&&wa(S),f.callbackNode=null,f.callbackPriority=0;else if(_=I&-I,f.callbackPriority!==_){if(S!=null&&wa(S),_===1)f.tag===0?Hg(h_.bind(null,f)):iu(h_.bind(null,f)),bf(function(){(jr&6)===0&&wl()}),S=null;else{switch(Pe(I)){case 1:S=Bi;break;case 4:S=Fr;break;case 16:S=os;break;case 536870912:S=as;break;default:S=os}S=rm(S,c_.bind(null,f))}f.callbackPriority=_,f.callbackNode=S}}function c_(f,_){if(em=-1,hd=0,(jr&6)!==0)throw Error(r(327));var S=f.callbackNode;if(dd()&&f.callbackNode!==S)return null;var I=Lo(f,f===vn?bn:0);if(I===0)return null;if((I&30)!==0||(I&f.expiredLanes)!==0||_)_=Gf(f,I);else{_=I;var N=jr;jr|=2;var H=p_();(vn!==f||bn!==_)&&(ac=null,ud=wr()+500,dh(f,_));do try{m0();break}catch(Ae){f0(f,Ae)}while(!0);au(),Nf.current=H,jr=N,Oi!==null?_=0:(vn=null,bn=0,_=Di)}if(_!==0){if(_===2&&(N=ll(f),N!==0&&(I=N,_=tm(f,N))),_===1)throw S=Ff,dh(f,0),fa(f,I),bo(f,wr()),S;if(_===6)fa(f,I);else{if(N=f.current.alternate,(I&30)===0&&!bb(N)&&(_=Gf(f,I),_===2&&(H=ll(f),H!==0&&(I=H,_=tm(f,H))),_===1))throw S=Ff,dh(f,0),fa(f,I),bo(f,wr()),S;switch(f.finishedWork=N,f.finishedLanes=I,_){case 0:case 1:throw Error(r(345));case 2:fh(f,io,ac);break;case 3:if(fa(f,I),(I&130023424)===I&&(_=a_+500-wr(),10<_)){if(Lo(f,0)!==0)break;if(N=f.suspendedLanes,(N&I)!==I){Un(),f.pingedLanes|=f.suspendedLanes&N;break}f.timeoutHandle=Wh(fh.bind(null,f,io,ac),_);break}fh(f,io,ac);break;case 4:if(fa(f,I),(I&4194240)===I)break;for(_=f.eventTimes,N=-1;0<I;){var le=31-Dn(I);H=1<<le,le=_[le],le>N&&(N=le),I&=~H}if(I=N,I=wr()-I,I=(120>I?120:480>I?480:1080>I?1080:1920>I?1920:3e3>I?3e3:4320>I?4320:1960*d0(I/1960))-I,10<I){f.timeoutHandle=Wh(fh.bind(null,f,io,ac),I);break}fh(f,io,ac);break;case 5:fh(f,io,ac);break;default:throw Error(r(329))}}}return bo(f,wr()),f.callbackNode===S?c_.bind(null,f):null}function tm(f,_){var S=cd;return f.current.memoizedState.isDehydrated&&(dh(f,_).flags|=256),f=Gf(f,_),f!==2&&(_=io,io=S,_!==null&&u_(_)),f}function u_(f){io===null?io=f:io.push.apply(io,f)}function bb(f){for(var _=f;;){if(_.flags&16384){var S=_.updateQueue;if(S!==null&&(S=S.stores,S!==null))for(var I=0;I<S.length;I++){var N=S[I],H=N.getSnapshot;N=N.value;try{if(!Uo(H(),N))return!1}catch{return!1}}}if(S=_.child,_.subtreeFlags&16384&&S!==null)S.return=_,_=S;else{if(_===f)break;for(;_.sibling===null;){if(_.return===null||_.return===f)return!0;_=_.return}_.sibling.return=_.return,_=_.sibling}}return!0}function fa(f,_){for(_&=~zf,_&=~hu,f.suspendedLanes|=_,f.pingedLanes&=~_,f=f.expirationTimes;0<_;){var S=31-Dn(_),I=1<<S;f[S]=-1,_&=~I}}function h_(f){if((jr&6)!==0)throw Error(r(327));dd();var _=Lo(f,0);if((_&1)===0)return bo(f,wr()),null;var S=Gf(f,_);if(f.tag!==0&&S===2){var I=ll(f);I!==0&&(_=I,S=tm(f,I))}if(S===1)throw S=Ff,dh(f,0),fa(f,_),bo(f,wr()),S;if(S===6)throw Error(r(345));return f.finishedWork=f.current.alternate,f.finishedLanes=_,fh(f,io,ac),bo(f,wr()),null}function d_(f,_){var S=jr;jr|=1;try{return f(_)}finally{jr=S,jr===0&&(ud=wr()+500,Na&&wl())}}function hh(f){du!==null&&du.tag===0&&(jr&6)===0&&dd();var _=jr;jr|=1;var S=vo.transition,I=he;try{if(vo.transition=null,he=1,f)return f()}finally{he=I,vo.transition=S,jr=_,(jr&6)===0&&wl()}}function f_(){Ko=uh.current,ti(uh)}function dh(f,_){f.finishedWork=null,f.finishedLanes=0;var S=f.timeoutHandle;if(S!==-1&&(f.timeoutHandle=-1,$p(S)),Oi!==null)for(S=Oi.return;S!==null;){var I=S;switch(Ef(I),I.tag){case 1:I=I.type.childContextTypes,I!=null&&Da();break;case 3:g(),ti(cs),ti(Pn),F();break;case 5:w(I);break;case 4:g();break;case 13:ti(C);break;case 19:ti(C);break;case 10:zn(I.type._context);break;case 22:case 23:f_()}S=S.return}if(vn=f,Oi=f=lc(f.current,null),bn=Ko=_,Di=0,Ff=null,zf=hu=uu=0,io=cd=null,Ho!==null){for(_=0;_<Ho.length;_++)if(S=Ho[_],I=S.interleaved,I!==null){S.interleaved=null;var N=I.next,H=S.pending;if(H!==null){var le=H.next;H.next=N,I.next=le}S.pending=I}Ho=null}return f}function f0(f,_){do{var S=Oi;try{if(au(),U.current=_s,fe){for(var I=X.memoizedState;I!==null;){var N=I.queue;N!==null&&(N.pending=null),I=I.next}fe=!1}if(W=0,ue=re=X=null,pe=!1,_e=0,ch.current=null,S===null||S.return===null){Di=1,Ff=_,Oi=null;break}e:{var H=f,le=S.return,Ae=S,Le=_;if(_=bn,Ae.flags|=32768,Le!==null&&typeof Le=="object"&&typeof Le.then=="function"){var ot=Le,xt=Ae,vt=xt.tag;if((xt.mode&1)===0&&(vt===0||vt===11||vt===15)){var gt=xt.alternate;gt?(xt.updateQueue=gt.updateQueue,xt.memoizedState=gt.memoizedState,xt.lanes=gt.lanes):(xt.updateQueue=null,xt.memoizedState=null)}var Vt=Wg(le);if(Vt!==null){Vt.flags&=-257,Jy(Vt,le,Ae,H,_),Vt.mode&1&&Wp(H,ot,_),_=Vt,Le=ot;var Kt=_.updateQueue;if(Kt===null){var tr=new Set;tr.add(Le),_.updateQueue=tr}else Kt.add(Le);break e}else{if((_&1)===0){Wp(H,ot,_),Vf();break e}Le=Error(r(426))}}else if(Ei&&Ae.mode&1){var $i=Wg(le);if($i!==null){($i.flags&65536)===0&&($i.flags|=256),Jy($i,le,Ae,H,_),El(Va(Le,Ae));break e}}H=Le=Va(Le,Ae),Di!==4&&(Di=2),cd===null?cd=[H]:cd.push(H),H=le;do{switch(H.tag){case 3:H.flags|=65536,_&=-_,H.lanes|=_;var Qe=$g(H,Le,_);nh(H,Qe);break e;case 1:Ae=Le;var Ue=H.type,it=H.stateNode;if((H.flags&128)===0&&(typeof Ue.getDerivedStateFromError=="function"||it!==null&&typeof it.componentDidCatch=="function"&&(Zo===null||!Zo.has(it)))){H.flags|=65536,_&=-_,H.lanes|=_;var Rt=Yy(H,Ae,_);nh(H,Rt);break e}}H=H.return}while(H!==null)}Hf(S)}catch(Xt){_=Xt,Oi===S&&S!==null&&(Oi=S=S.return);continue}break}while(!0)}function p_(){var f=Nf.current;return Nf.current=_s,f===null?_s:f}function Vf(){(Di===0||Di===3||Di===2)&&(Di=4),vn===null||(uu&268435455)===0&&(hu&268435455)===0||fa(vn,bn)}function Gf(f,_){var S=jr;jr|=2;var I=p_();(vn!==f||bn!==_)&&(ac=null,dh(f,_));do try{p0();break}catch(N){f0(f,N)}while(!0);if(au(),jr=S,Nf.current=I,Oi!==null)throw Error(r(261));return vn=null,bn=0,Di}function p0(){for(;Oi!==null;)g0(Oi)}function m0(){for(;Oi!==null&&!ho();)g0(Oi)}function g0(f){var _=xn(f.alternate,f,Ko);f.memoizedProps=f.pendingProps,_===null?Hf(f):Oi=_,ch.current=null}function Hf(f){var _=f;do{var S=_.alternate;if(f=_.return,(_.flags&32768)===0){if(S=s0(S,_,Ko),S!==null){Oi=S;return}}else{if(S=vb(S,_),S!==null){S.flags&=32767,Oi=S;return}if(f!==null)f.flags|=32768,f.subtreeFlags=0,f.deletions=null;else{Di=6,Oi=null;return}}if(_=_.sibling,_!==null){Oi=_;return}Oi=_=f}while(_!==null);Di===0&&(Di=5)}function fh(f,_,S){var I=he,N=vo.transition;try{vo.transition=null,he=1,_0(f,_,S,I)}finally{vo.transition=N,he=I}return null}function _0(f,_,S,I){do dd();while(du!==null);if((jr&6)!==0)throw Error(r(327));S=f.finishedWork;var N=f.finishedLanes;if(S===null)return null;if(f.finishedWork=null,f.finishedLanes=0,S===f.current)throw Error(r(177));f.callbackNode=null,f.callbackPriority=0;var H=S.lanes|S.childLanes;if(Zd(f,H),f===vn&&(Oi=vn=null,bn=0),(S.subtreeFlags&2064)===0&&(S.flags&2064)===0||Jp||(Jp=!0,rm(os,function(){return dd(),null})),H=(S.flags&15990)!==0,(S.subtreeFlags&15990)!==0||H){H=vo.transition,vo.transition=null;var le=he;he=1;var Ae=jr;jr|=4,ch.current=null,r_(f,S),h0(S,f),Vh(Ia),qn=!!tu,Ia=tu=null,f.current=S,ad(S),sl(),jr=Ae,he=le,vo.transition=H}else f.current=S;if(Jp&&(Jp=!1,du=f,jf=N),H=f.pendingLanes,H===0&&(Zo=null),Lc(S.stateNode),bo(f,wr()),_!==null)for(I=f.onRecoverableError,S=0;S<_.length;S++)N=_[S],I(N.value,{componentStack:N.stack,digest:N.digest});if(Yp)throw Yp=!1,f=l_,l_=null,f;return(jf&1)!==0&&f.tag!==0&&dd(),H=f.pendingLanes,(H&1)!==0?f===Qp?Uf++:(Uf=0,Qp=f):Uf=0,wl(),null}function dd(){if(du!==null){var f=Pe(jf),_=vo.transition,S=he;try{if(vo.transition=null,he=16>f?16:f,du===null)var I=!1;else{if(f=du,du=null,jf=0,(jr&6)!==0)throw Error(r(331));var N=jr;for(jr|=4,qt=f.current;qt!==null;){var H=qt,le=H.child;if((qt.flags&16)!==0){var Ae=H.deletions;if(Ae!==null){for(var Le=0;Le<Ae.length;Le++){var ot=Ae[Le];for(qt=ot;qt!==null;){var xt=qt;switch(xt.tag){case 0:case 11:case 15:od(8,xt,H)}var vt=xt.child;if(vt!==null)vt.return=xt,qt=vt;else for(;qt!==null;){xt=qt;var gt=xt.sibling,Vt=xt.return;if(a0(xt),xt===ot){qt=null;break}if(gt!==null){gt.return=Vt,qt=gt;break}qt=Vt}}}var Kt=H.alternate;if(Kt!==null){var tr=Kt.child;if(tr!==null){Kt.child=null;do{var $i=tr.sibling;tr.sibling=null,tr=$i}while(tr!==null)}}qt=H}}if((H.subtreeFlags&2064)!==0&&le!==null)le.return=H,qt=le;else e:for(;qt!==null;){if(H=qt,(H.flags&2048)!==0)switch(H.tag){case 0:case 11:case 15:od(9,H,H.return)}var Qe=H.sibling;if(Qe!==null){Qe.return=H.return,qt=Qe;break e}qt=H.return}}var Ue=f.current;for(qt=Ue;qt!==null;){le=qt;var it=le.child;if((le.subtreeFlags&2064)!==0&&it!==null)it.return=le,qt=it;else e:for(le=Ue;qt!==null;){if(Ae=qt,(Ae.flags&2048)!==0)try{switch(Ae.tag){case 0:case 11:case 15:Cl(9,Ae)}}catch(Xt){cn(Ae,Ae.return,Xt)}if(Ae===le){qt=null;break e}var Rt=Ae.sibling;if(Rt!==null){Rt.return=Ae.return,qt=Rt;break e}qt=Ae.return}}if(jr=N,wl(),sn&&typeof sn.onPostCommitFiberRoot=="function")try{sn.onPostCommitFiberRoot(Zi,f)}catch{}I=!0}return I}finally{he=S,vo.transition=_}}return!1}function y0(f,_,S){_=Va(S,_),_=$g(f,_,1),f=Ds(f,_,1),_=Un(),f!==null&&(Aa(f,1,_),bo(f,_))}function cn(f,_,S){if(f.tag===3)y0(f,f,S);else for(;_!==null;){if(_.tag===3){y0(_,f,S);break}else if(_.tag===1){var I=_.stateNode;if(typeof _.type.getDerivedStateFromError=="function"||typeof I.componentDidCatch=="function"&&(Zo===null||!Zo.has(I))){f=Va(S,f),f=Yy(_,f,1),_=Ds(_,f,1),f=Un(),_!==null&&(Aa(_,1,f),bo(_,f));break}}_=_.return}}function v0(f,_,S){var I=f.pingCache;I!==null&&I.delete(_),_=Un(),f.pingedLanes|=f.suspendedLanes&S,vn===f&&(bn&S)===S&&(Di===4||Di===3&&(bn&130023424)===bn&&500>wr()-a_?dh(f,0):zf|=S),bo(f,_)}function b0(f,_){_===0&&((f.mode&1)===0?_=1:(_=al,al<<=1,(al&130023424)===0&&(al=4194304)));var S=Un();f=go(f,_),f!==null&&(Aa(f,_,S),bo(f,S))}function xb(f){var _=f.memoizedState,S=0;_!==null&&(S=_.retryLane),b0(f,S)}function $f(f,_){var S=0;switch(f.tag){case 13:var I=f.stateNode,N=f.memoizedState;N!==null&&(S=N.retryLane);break;case 19:I=f.stateNode;break;default:throw Error(r(314))}I!==null&&I.delete(_),b0(f,S)}var xn;xn=function(f,_,S){if(f!==null)if(f.memoizedProps!==_.pendingProps||cs.current)yo=!0;else{if((f.lanes&S)===0&&(_.flags&128)===0)return yo=!1,to(f,_,S);yo=(f.flags&131072)!==0}else yo=!1,Ei&&(_.flags&1048576)!==0&&Or(_,Ot,_.index);switch(_.lanes=0,_.tag){case 2:var I=_.type;id(f,_),f=_.pendingProps;var N=Go(_,Pn.current);jn(_,S),N=Ie(null,_,I,f,N,S);var H=be();return _.flags|=1,typeof N=="object"&&N!==null&&typeof N.render=="function"&&N.$$typeof===void 0?(_.tag=1,_.memoizedState=null,_.updateQueue=null,Kn(I)?(H=!0,Is(_)):H=!1,_.memoizedState=N.state!==null&&N.state!==void 0?N.state:null,Al(_),N.updater=Wo,_.stateNode=N,N._reactInternals=_,oh(_,I,f,S),_=rd(null,_,I,!0,H,S)):(_.tag=0,Ei&&H&&nu(_),ys(null,_,N,S),_=_.child),_;case 16:I=_.elementType;e:{switch(id(f,_),f=_.pendingProps,N=I._init,I=N(I._payload),_.type=I,N=_.tag=wb(I),f=yn(I,f),N){case 0:_=Zg(null,_,I,f,S);break e;case 1:_=td(null,_,I,f,S);break e;case 11:_=e0(null,_,I,f,S);break e;case 14:_=qp(null,_,I,yn(I.type,f),S);break e}throw Error(r(306,I,""))}return _;case 0:return I=_.type,N=_.pendingProps,N=_.elementType===I?N:yn(I,N),Zg(f,_,I,N,S);case 1:return I=_.type,N=_.pendingProps,N=_.elementType===I?N:yn(I,N),td(f,_,I,N,S);case 3:e:{if(Mf(_),f===null)throw Error(r(387));I=_.pendingProps,H=_.memoizedState,N=H.element,Qh(f,_),ua(_,I,null,S);var le=_.memoizedState;if(I=le.element,H.isDehydrated)if(H={element:I,isDehydrated:!1,cache:le.cache,pendingSuspenseBoundaries:le.pendingSuspenseBoundaries,transitions:le.transitions},_.updateQueue.baseState=H,_.memoizedState=H,_.flags&256){N=Va(Error(r(423)),_),_=Xg(f,_,I,S,N);break e}else if(I!==N){N=Va(Error(r(424)),_),_=Xg(f,_,I,S,N);break e}else for(Xs=ei(_.stateNode.containerInfo.firstChild),Zn=_,Ei=!0,Ys=null,S=ih(_,null,I,S),_.child=S;S;)S.flags=S.flags&-3|4096,S=S.sibling;else{if(ri(),I===N){_=qo(f,_,S);break e}ys(f,_,I,S)}_=_.child}return _;case 5:return v(_),f===null&&th(_),I=_.type,N=_.pendingProps,H=f!==null?f.memoizedProps:null,le=N.children,Yu(I,N)?le=null:H!==null&&Yu(I,H)&&(_.flags|=32),ah(f,_),ys(f,_,le,S),_.child;case 6:return f===null&&th(_),null;case 13:return t0(f,_,S);case 4:return d(_,_.stateNode.containerInfo),I=_.pendingProps,f===null?_.child=fs(_,null,I,S):ys(f,_,I,S),_.child;case 11:return I=_.type,N=_.pendingProps,N=_.elementType===I?N:yn(I,N),e0(f,_,I,N,S);case 7:return ys(f,_,_.pendingProps,S),_.child;case 8:return ys(f,_,_.pendingProps.children,S),_.child;case 12:return ys(f,_,_.pendingProps.children,S),_.child;case 10:e:{if(I=_.type._context,N=_.pendingProps,H=_.memoizedProps,le=N.value,Dr(zt,I._currentValue),I._currentValue=le,H!==null)if(Uo(H.value,le)){if(H.children===N.children&&!cs.current){_=qo(f,_,S);break e}}else for(H=_.child,H!==null&&(H.return=_);H!==null;){var Ae=H.dependencies;if(Ae!==null){le=H.child;for(var Le=Ae.firstContext;Le!==null;){if(Le.context===I){if(H.tag===1){Le=Os(-1,S&-S),Le.tag=2;var ot=H.updateQueue;if(ot!==null){ot=ot.shared;var xt=ot.pending;xt===null?Le.next=Le:(Le.next=xt.next,xt.next=Le),ot.pending=Le}}H.lanes|=S,Le=H.alternate,Le!==null&&(Le.lanes|=S),Jh(H.return,S,_),Ae.lanes|=S;break}Le=Le.next}}else if(H.tag===10)le=H.type===_.type?null:H.child;else if(H.tag===18){if(le=H.return,le===null)throw Error(r(341));le.lanes|=S,Ae=le.alternate,Ae!==null&&(Ae.lanes|=S),Jh(le,S,_),le=H.sibling}else le=H.child;if(le!==null)le.return=H;else for(le=H;le!==null;){if(le===_){le=null;break}if(H=le.sibling,H!==null){H.return=le.return,le=H;break}le=le.return}H=le}ys(f,_,N.children,S),_=_.child}return _;case 9:return N=_.type,I=_.pendingProps.children,jn(_,S),N=mo(N),I=I(N),_.flags|=1,ys(f,_,I,S),_.child;case 14:return I=_.type,N=yn(I,_.pendingProps),N=yn(I.type,N),qp(f,_,I,N,S);case 15:return qg(f,_,_.type,_.pendingProps,S);case 17:return I=_.type,N=_.pendingProps,N=_.elementType===I?N:yn(I,N),id(f,_),_.tag=1,Kn(I)?(f=!0,Is(_)):f=!1,jn(_,S),Ns(_,I,N),oh(_,I,N,S),rd(null,_,I,!0,f,S);case 19:return Jg(f,_,S);case 22:return Kg(f,_,S)}throw Error(r(156,_.tag))};function rm(f,_){return Rs(f,_)}function x0(f,_,S,I){this.tag=f,this.key=S,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=_,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=I,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Xo(f,_,S,I){return new x0(f,_,S,I)}function Wf(f){return f=f.prototype,!(!f||!f.isReactComponent)}function wb(f){if(typeof f=="function")return Wf(f)?1:0;if(f!=null){if(f=f.$$typeof,f===Nt)return 11;if(f===Ut)return 14}return 2}function lc(f,_){var S=f.alternate;return S===null?(S=Xo(f.tag,_,f.key,f.mode),S.elementType=f.elementType,S.type=f.type,S.stateNode=f.stateNode,S.alternate=f,f.alternate=S):(S.pendingProps=_,S.type=f.type,S.flags=0,S.subtreeFlags=0,S.deletions=null),S.flags=f.flags&14680064,S.childLanes=f.childLanes,S.lanes=f.lanes,S.child=f.child,S.memoizedProps=f.memoizedProps,S.memoizedState=f.memoizedState,S.updateQueue=f.updateQueue,_=f.dependencies,S.dependencies=_===null?null:{lanes:_.lanes,firstContext:_.firstContext},S.sibling=f.sibling,S.index=f.index,S.ref=f.ref,S}function im(f,_,S,I,N,H){var le=2;if(I=f,typeof f=="function")Wf(f)&&(le=1);else if(typeof f=="string")le=5;else e:switch(f){case Ve:return ph(S.children,N,H,_);case Be:le=8,N|=8;break;case $e:return f=Xo(12,S,_,N|2),f.elementType=$e,f.lanes=H,f;case sr:return f=Xo(13,S,_,N),f.elementType=sr,f.lanes=H,f;case Ft:return f=Xo(19,S,_,N),f.elementType=Ft,f.lanes=H,f;case At:return nm(S,N,H,_);default:if(typeof f=="object"&&f!==null)switch(f.$$typeof){case at:le=10;break e;case _t:le=9;break e;case Nt:le=11;break e;case Ut:le=14;break e;case Lt:le=16,I=null;break e}throw Error(r(130,f==null?f:typeof f,""))}return _=Xo(le,S,_,N),_.elementType=f,_.type=I,_.lanes=H,_}function ph(f,_,S,I){return f=Xo(7,f,I,_),f.lanes=S,f}function nm(f,_,S,I){return f=Xo(22,f,I,_),f.elementType=At,f.lanes=S,f.stateNode={isHidden:!1},f}function m_(f,_,S){return f=Xo(6,f,null,_),f.lanes=S,f}function g_(f,_,S){return _=Xo(4,f.children!==null?f.children:[],f.key,_),_.lanes=S,_.stateNode={containerInfo:f.containerInfo,pendingChildren:null,implementation:f.implementation},_}function Eb(f,_,S,I,N){this.tag=_,this.containerInfo=f,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=cl(0),this.expirationTimes=cl(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=cl(0),this.identifierPrefix=I,this.onRecoverableError=N,this.mutableSourceEagerHydrationData=null}function __(f,_,S,I,N,H,le,Ae,Le){return f=new Eb(f,_,S,Ae,Le),_===1?(_=1,H===!0&&(_|=8)):_=0,H=Xo(3,null,null,_),f.current=H,H.stateNode=f,H.memoizedState={element:I,isDehydrated:S,cache:null,transitions:null,pendingSuspenseBoundaries:null},Al(H),f}function Ab(f,_,S){var I=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Me,key:I==null?null:""+I,children:f,containerInfo:_,implementation:S}}function w0(f){if(!f)return Zs;f=f._reactInternals;e:{if(hr(f)!==f||f.tag!==1)throw Error(r(170));var _=f;do{switch(_.tag){case 3:_=_.stateNode.context;break e;case 1:if(Kn(_.type)){_=_.stateNode.__reactInternalMemoizedMergedChildContext;break e}}_=_.return}while(_!==null);throw Error(r(171))}if(f.tag===1){var S=f.type;if(Kn(S))return us(f,S,_)}return _}function E0(f,_,S,I,N,H,le,Ae,Le){return f=__(S,I,!0,f,N,H,le,Ae,Le),f.context=w0(null),S=f.current,I=Un(),N=Rl(S),H=Os(I,N),H.callback=_??null,Ds(S,H,N),f.current.lanes=N,Aa(f,N,I),bo(f,I),f}function sm(f,_,S,I){var N=_.current,H=Un(),le=Rl(N);return S=w0(S),_.context===null?_.context=S:_.pendingContext=S,_=Os(H,le),_.payload={element:f},I=I===void 0?null:I,I!==null&&(_.callback=I),f=Ds(N,_,le),f!==null&&($a(f,N,le,H),Tl(f,N,le)),le}function om(f){if(f=f.current,!f.child)return null;switch(f.child.tag){case 5:return f.child.stateNode;default:return f.child.stateNode}}function y_(f,_){if(f=f.memoizedState,f!==null&&f.dehydrated!==null){var S=f.retryLane;f.retryLane=S!==0&&S<_?S:_}}function qf(f,_){y_(f,_),(f=f.alternate)&&y_(f,_)}function A0(){return null}var cc=typeof reportError=="function"?reportError:function(f){console.error(f)};function mh(f){this._internalRoot=f}uc.prototype.render=mh.prototype.render=function(f){var _=this._internalRoot;if(_===null)throw Error(r(409));sm(f,_,null,null)},uc.prototype.unmount=mh.prototype.unmount=function(){var f=this._internalRoot;if(f!==null){this._internalRoot=null;var _=f.containerInfo;hh(function(){sm(null,f,null,null)}),_[sa]=null}};function uc(f){this._internalRoot=f}uc.prototype.unstable_scheduleHydration=function(f){if(f){var _=Er();f={blockedOn:null,target:f,priority:_};for(var S=0;S<pi.length&&_!==0&&_<pi[S].priority;S++);pi.splice(S,0,f),S===0&&Nn(f)}};function fd(f){return!(!f||f.nodeType!==1&&f.nodeType!==9&&f.nodeType!==11)}function gh(f){return!(!f||f.nodeType!==1&&f.nodeType!==9&&f.nodeType!==11&&(f.nodeType!==8||f.nodeValue!==" react-mount-point-unstable "))}function T0(){}function Tb(f,_,S,I,N){if(N){if(typeof I=="function"){var H=I;I=function(){var ot=om(le);H.call(ot)}}var le=E0(_,I,f,0,null,!1,!1,"",T0);return f._reactRootContainer=le,f[sa]=le.current,bl(f.nodeType===8?f.parentNode:f),hh(),le}for(;N=f.lastChild;)f.removeChild(N);if(typeof I=="function"){var Ae=I;I=function(){var ot=om(Le);Ae.call(ot)}}var Le=__(f,0,!1,null,null,!1,!1,"",T0);return f._reactRootContainer=Le,f[sa]=Le.current,bl(f.nodeType===8?f.parentNode:f),hh(function(){sm(_,Le,S,I)}),Le}function Kf(f,_,S,I,N){var H=S._reactRootContainer;if(H){var le=H;if(typeof N=="function"){var Ae=N;N=function(){var Le=om(le);Ae.call(Le)}}sm(_,le,f,N)}else le=Tb(S,_,f,N,I);return om(le)}We=function(f){switch(f.tag){case 3:var _=f.stateNode;if(_.current.memoizedState.isDehydrated){var S=Ea(_.pendingLanes);S!==0&&(ae(_,S|1),bo(_,wr()),(jr&6)===0&&(ud=wr()+500,wl()))}break;case 13:hh(function(){var I=go(f,1);if(I!==null){var N=Un();$a(I,f,1,N)}}),qf(f,1)}},mt=function(f){if(f.tag===13){var _=go(f,134217728);if(_!==null){var S=Un();$a(_,f,134217728,S)}qf(f,134217728)}},Zt=function(f){if(f.tag===13){var _=Rl(f),S=go(f,_);if(S!==null){var I=Un();$a(S,f,_,I)}qf(f,_)}},Er=function(){return he},Wr=function(f,_){var S=he;try{return he=f,_()}finally{he=S}},lt=function(f,_,S){switch(_){case"input":if(Ln(f,S),_=S.name,S.type==="radio"&&_!=null){for(S=f;S.parentNode;)S=S.parentNode;for(S=S.querySelectorAll("input[name="+JSON.stringify(""+_)+'][type="radio"]'),_=0;_<S.length;_++){var I=S[_];if(I!==f&&I.form===f.form){var N=eh(I);if(!N)throw Error(r(90));wi(I),Ln(I,N)}}}break;case"textarea":ea(f,S);break;case"select":_=S.value,_!=null&&vi(f,!!S.multiple,_,!1)}},vr=d_,Xr=hh;var S0={usingClientEntryPoint:!1,Events:[ru,Ql,eh,Rr,Wt,d_]},Zf={findFiberByHostInstance:Oa,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},C0={bundleType:Zf.bundleType,version:Zf.version,rendererPackageName:Zf.rendererPackageName,rendererConfig:Zf.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:me.ReactCurrentDispatcher,findHostInstanceByFiber:function(f){return f=fr(f),f===null?null:f.stateNode},findFiberByHostInstance:Zf.findFiberByHostInstance||A0,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Xf=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Xf.isDisabled&&Xf.supportsFiber)try{Zi=Xf.inject(C0),sn=Xf}catch{}}return pa.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=S0,pa.createPortal=function(f,_){var S=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!fd(_))throw Error(r(200));return Ab(f,_,null,S)},pa.createRoot=function(f,_){if(!fd(f))throw Error(r(299));var S=!1,I="",N=cc;return _!=null&&(_.unstable_strictMode===!0&&(S=!0),_.identifierPrefix!==void 0&&(I=_.identifierPrefix),_.onRecoverableError!==void 0&&(N=_.onRecoverableError)),_=__(f,1,!1,null,null,S,!1,I,N),f[sa]=_.current,bl(f.nodeType===8?f.parentNode:f),new mh(_)},pa.findDOMNode=function(f){if(f==null)return null;if(f.nodeType===1)return f;var _=f._reactInternals;if(_===void 0)throw typeof f.render=="function"?Error(r(188)):(f=Object.keys(f).join(","),Error(r(268,f)));return f=fr(_),f=f===null?null:f.stateNode,f},pa.flushSync=function(f){return hh(f)},pa.hydrate=function(f,_,S){if(!gh(_))throw Error(r(200));return Kf(null,f,_,!0,S)},pa.hydrateRoot=function(f,_,S){if(!fd(f))throw Error(r(405));var I=S!=null&&S.hydratedSources||null,N=!1,H="",le=cc;if(S!=null&&(S.unstable_strictMode===!0&&(N=!0),S.identifierPrefix!==void 0&&(H=S.identifierPrefix),S.onRecoverableError!==void 0&&(le=S.onRecoverableError)),_=E0(_,null,f,1,S??null,N,!1,H,le),f[sa]=_.current,bl(f),I)for(f=0;f<I.length;f++)S=I[f],N=S._getVersion,N=N(S._source),_.mutableSourceEagerHydrationData==null?_.mutableSourceEagerHydrationData=[S,N]:_.mutableSourceEagerHydrationData.push(S,N);return new uc(_)},pa.render=function(f,_,S){if(!gh(_))throw Error(r(200));return Kf(null,f,_,!1,S)},pa.unmountComponentAtNode=function(f){if(!gh(f))throw Error(r(40));return f._reactRootContainer?(hh(function(){Kf(null,null,f,!1,function(){f._reactRootContainer=null,f[sa]=null})}),!0):!1},pa.unstable_batchedUpdates=d_,pa.unstable_renderSubtreeIntoContainer=function(f,_,S,I){if(!gh(S))throw Error(r(200));if(f==null||f._reactInternals===void 0)throw Error(r(38));return Kf(f,_,S,!1,I)},pa.version="18.3.1-next-f1338f8080-20240426",pa}var LS;function vI(){if(LS)return Gb.exports;LS=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}return t(),Gb.exports=aN(),Gb.exports}var OS;function lN(){if(OS)return L0;OS=1;var t=vI();return L0.createRoot=t.createRoot,L0.hydrateRoot=t.hydrateRoot,L0}var cN=lN(),Z=R1();const Ad=mE(Z),gE=yI({__proto__:null,default:Ad},[Z]);/**
 * react-router v7.9.6
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var DS="popstate";function uN(t={}){function e(i,n){let{pathname:l,search:c,hash:o}=i.location;return Lw("",{pathname:l,search:c,hash:o},n.state&&n.state.usr||null,n.state&&n.state.key||"default")}function r(i,n){return typeof n=="string"?n:uy(n)}return dN(e,r,null,t)}function hn(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function Vl(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function hN(){return Math.random().toString(36).substring(2,10)}function NS(t,e){return{usr:t.state,key:t.key,idx:e}}function Lw(t,e,r=null,i){return{pathname:typeof t=="string"?t:t.pathname,search:"",hash:"",...typeof e=="string"?bg(e):e,state:r,key:e&&e.key||i||hN()}}function uy({pathname:t="/",search:e="",hash:r=""}){return e&&e!=="?"&&(t+=e.charAt(0)==="?"?e:"?"+e),r&&r!=="#"&&(t+=r.charAt(0)==="#"?r:"#"+r),t}function bg(t){let e={};if(t){let r=t.indexOf("#");r>=0&&(e.hash=t.substring(r),t=t.substring(0,r));let i=t.indexOf("?");i>=0&&(e.search=t.substring(i),t=t.substring(0,i)),t&&(e.pathname=t)}return e}function dN(t,e,r,i={}){let{window:n=document.defaultView,v5Compat:l=!1}=i,c=n.history,o="POP",m=null,b=A();b==null&&(b=0,c.replaceState({...c.state,idx:b},""));function A(){return(c.state||{idx:null}).idx}function R(){o="POP";let q=A(),J=q==null?null:q-b;b=q,m&&m({action:o,location:V.location,delta:J})}function M(q,J){o="PUSH";let ie=Lw(V.location,q,J);b=A()+1;let ee=NS(ie,b),me=V.createHref(ie);try{c.pushState(ee,"",me)}catch(Se){if(Se instanceof DOMException&&Se.name==="DataCloneError")throw Se;n.location.assign(me)}l&&m&&m({action:o,location:V.location,delta:1})}function L(q,J){o="REPLACE";let ie=Lw(V.location,q,J);b=A();let ee=NS(ie,b),me=V.createHref(ie);c.replaceState(ee,"",me),l&&m&&m({action:o,location:V.location,delta:0})}function G(q){return fN(q)}let V={get action(){return o},get location(){return t(n,c)},listen(q){if(m)throw new Error("A history only accepts one active listener");return n.addEventListener(DS,R),m=q,()=>{n.removeEventListener(DS,R),m=null}},createHref(q){return e(n,q)},createURL:G,encodeLocation(q){let J=G(q);return{pathname:J.pathname,search:J.search,hash:J.hash}},push:M,replace:L,go(q){return c.go(q)}};return V}function fN(t,e=!1){let r="http://localhost";typeof window<"u"&&(r=window.location.origin!=="null"?window.location.origin:window.location.href),hn(r,"No window.location.(origin|href) available to create URL");let i=typeof t=="string"?t:uy(t);return i=i.replace(/ $/,"%20"),!e&&i.startsWith("//")&&(i=r+i),new URL(i,r)}function bI(t,e,r="/"){return pN(t,e,r,!1)}function pN(t,e,r,i){let n=typeof e=="string"?bg(e):e,l=Ch(n.pathname||"/",r);if(l==null)return null;let c=xI(t);mN(c);let o=null;for(let m=0;o==null&&m<c.length;++m){let b=SN(l);o=AN(c[m],b,i)}return o}function xI(t,e=[],r=[],i="",n=!1){let l=(c,o,m=n,b)=>{let A={relativePath:b===void 0?c.path||"":b,caseSensitive:c.caseSensitive===!0,childrenIndex:o,route:c};if(A.relativePath.startsWith("/")){if(!A.relativePath.startsWith(i)&&m)return;hn(A.relativePath.startsWith(i),`Absolute route path "${A.relativePath}" nested under path "${i}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),A.relativePath=A.relativePath.slice(i.length)}let R=Sh([i,A.relativePath]),M=r.concat(A);c.children&&c.children.length>0&&(hn(c.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${R}".`),xI(c.children,e,M,R,m)),!(c.path==null&&!c.index)&&e.push({path:R,score:wN(R,c.index),routesMeta:M})};return t.forEach((c,o)=>{if(c.path===""||!c.path?.includes("?"))l(c,o);else for(let m of wI(c.path))l(c,o,!0,m)}),e}function wI(t){let e=t.split("/");if(e.length===0)return[];let[r,...i]=e,n=r.endsWith("?"),l=r.replace(/\?$/,"");if(i.length===0)return n?[l,""]:[l];let c=wI(i.join("/")),o=[];return o.push(...c.map(m=>m===""?l:[l,m].join("/"))),n&&o.push(...c),o.map(m=>t.startsWith("/")&&m===""?"/":m)}function mN(t){t.sort((e,r)=>e.score!==r.score?r.score-e.score:EN(e.routesMeta.map(i=>i.childrenIndex),r.routesMeta.map(i=>i.childrenIndex)))}var gN=/^:[\w-]+$/,_N=3,yN=2,vN=1,bN=10,xN=-2,FS=t=>t==="*";function wN(t,e){let r=t.split("/"),i=r.length;return r.some(FS)&&(i+=xN),e&&(i+=yN),r.filter(n=>!FS(n)).reduce((n,l)=>n+(gN.test(l)?_N:l===""?vN:bN),i)}function EN(t,e){return t.length===e.length&&t.slice(0,-1).every((i,n)=>i===e[n])?t[t.length-1]-e[e.length-1]:0}function AN(t,e,r=!1){let{routesMeta:i}=t,n={},l="/",c=[];for(let o=0;o<i.length;++o){let m=i[o],b=o===i.length-1,A=l==="/"?e:e.slice(l.length)||"/",R=Zv({path:m.relativePath,caseSensitive:m.caseSensitive,end:b},A),M=m.route;if(!R&&b&&r&&!i[i.length-1].route.index&&(R=Zv({path:m.relativePath,caseSensitive:m.caseSensitive,end:!1},A)),!R)return null;Object.assign(n,R.params),c.push({params:n,pathname:Sh([l,R.pathname]),pathnameBase:IN(Sh([l,R.pathnameBase])),route:M}),R.pathnameBase!=="/"&&(l=Sh([l,R.pathnameBase]))}return c}function Zv(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[r,i]=TN(t.path,t.caseSensitive,t.end),n=e.match(r);if(!n)return null;let l=n[0],c=l.replace(/(.)\/+$/,"$1"),o=n.slice(1);return{params:i.reduce((b,{paramName:A,isOptional:R},M)=>{if(A==="*"){let G=o[M]||"";c=l.slice(0,l.length-G.length).replace(/(.)\/+$/,"$1")}const L=o[M];return R&&!L?b[A]=void 0:b[A]=(L||"").replace(/%2F/g,"/"),b},{}),pathname:l,pathnameBase:c,pattern:t}}function TN(t,e=!1,r=!0){Vl(t==="*"||!t.endsWith("*")||t.endsWith("/*"),`Route path "${t}" will be treated as if it were "${t.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${t.replace(/\*$/,"/*")}".`);let i=[],n="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(c,o,m)=>(i.push({paramName:o,isOptional:m!=null}),m?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return t.endsWith("*")?(i.push({paramName:"*"}),n+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):r?n+="\\/*$":t!==""&&t!=="/"&&(n+="(?:(?=\\/|$))"),[new RegExp(n,e?void 0:"i"),i]}function SN(t){try{return t.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return Vl(!1,`The URL path "${t}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),t}}function Ch(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let r=e.endsWith("/")?e.length-1:e.length,i=t.charAt(r);return i&&i!=="/"?null:t.slice(r)||"/"}var CN=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,PN=t=>CN.test(t);function RN(t,e="/"){let{pathname:r,search:i="",hash:n=""}=typeof t=="string"?bg(t):t,l;if(r)if(PN(r))l=r;else{if(r.includes("//")){let c=r;r=r.replace(/\/\/+/g,"/"),Vl(!1,`Pathnames cannot have embedded double slashes - normalizing ${c} -> ${r}`)}r.startsWith("/")?l=zS(r.substring(1),"/"):l=zS(r,e)}else l=e;return{pathname:l,search:kN(i),hash:BN(n)}}function zS(t,e){let r=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(n=>{n===".."?r.length>1&&r.pop():n!=="."&&r.push(n)}),r.length>1?r.join("/"):"/"}function Wb(t,e,r,i){return`Cannot include a '${t}' character in a manually specified \`to.${e}\` field [${JSON.stringify(i)}].  Please separate it out to the \`to.${r}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function MN(t){return t.filter((e,r)=>r===0||e.route.path&&e.route.path.length>0)}function _E(t){let e=MN(t);return e.map((r,i)=>i===e.length-1?r.pathname:r.pathnameBase)}function yE(t,e,r,i=!1){let n;typeof t=="string"?n=bg(t):(n={...t},hn(!n.pathname||!n.pathname.includes("?"),Wb("?","pathname","search",n)),hn(!n.pathname||!n.pathname.includes("#"),Wb("#","pathname","hash",n)),hn(!n.search||!n.search.includes("#"),Wb("#","search","hash",n)));let l=t===""||n.pathname==="",c=l?"/":n.pathname,o;if(c==null)o=r;else{let R=e.length-1;if(!i&&c.startsWith("..")){let M=c.split("/");for(;M[0]==="..";)M.shift(),R-=1;n.pathname=M.join("/")}o=R>=0?e[R]:"/"}let m=RN(n,o),b=c&&c!=="/"&&c.endsWith("/"),A=(l||c===".")&&r.endsWith("/");return!m.pathname.endsWith("/")&&(b||A)&&(m.pathname+="/"),m}var Sh=t=>t.join("/").replace(/\/\/+/g,"/"),IN=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),kN=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,BN=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t;function LN(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var EI=["POST","PUT","PATCH","DELETE"];new Set(EI);var ON=["GET",...EI];new Set(ON);var xg=Z.createContext(null);xg.displayName="DataRouter";var M1=Z.createContext(null);M1.displayName="DataRouterState";Z.createContext(!1);var AI=Z.createContext({isTransitioning:!1});AI.displayName="ViewTransition";var DN=Z.createContext(new Map);DN.displayName="Fetchers";var NN=Z.createContext(null);NN.displayName="Await";var Ic=Z.createContext(null);Ic.displayName="Navigation";var Iy=Z.createContext(null);Iy.displayName="Location";var Iu=Z.createContext({outlet:null,matches:[],isDataRoute:!1});Iu.displayName="Route";var vE=Z.createContext(null);vE.displayName="RouteError";function FN(t,{relative:e}={}){hn(wg(),"useHref() may be used only in the context of a <Router> component.");let{basename:r,navigator:i}=Z.useContext(Ic),{hash:n,pathname:l,search:c}=ky(t,{relative:e}),o=l;return r!=="/"&&(o=l==="/"?r:Sh([r,l])),i.createHref({pathname:o,search:c,hash:n})}function wg(){return Z.useContext(Iy)!=null}function Gd(){return hn(wg(),"useLocation() may be used only in the context of a <Router> component."),Z.useContext(Iy).location}var TI="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function SI(t){Z.useContext(Ic).static||Z.useLayoutEffect(t)}function I1(){let{isDataRoute:t}=Z.useContext(Iu);return t?YN():zN()}function zN(){hn(wg(),"useNavigate() may be used only in the context of a <Router> component.");let t=Z.useContext(xg),{basename:e,navigator:r}=Z.useContext(Ic),{matches:i}=Z.useContext(Iu),{pathname:n}=Gd(),l=JSON.stringify(_E(i)),c=Z.useRef(!1);return SI(()=>{c.current=!0}),Z.useCallback((m,b={})=>{if(Vl(c.current,TI),!c.current)return;if(typeof m=="number"){r.go(m);return}let A=yE(m,JSON.parse(l),n,b.relative==="path");t==null&&e!=="/"&&(A.pathname=A.pathname==="/"?e:Sh([e,A.pathname])),(b.replace?r.replace:r.push)(A,b.state,b)},[e,r,l,n,t])}Z.createContext(null);function ky(t,{relative:e}={}){let{matches:r}=Z.useContext(Iu),{pathname:i}=Gd(),n=JSON.stringify(_E(r));return Z.useMemo(()=>yE(t,JSON.parse(n),i,e==="path"),[t,n,i,e])}function jN(t,e){return CI(t,e)}function CI(t,e,r,i,n){hn(wg(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:l}=Z.useContext(Ic),{matches:c}=Z.useContext(Iu),o=c[c.length-1],m=o?o.params:{},b=o?o.pathname:"/",A=o?o.pathnameBase:"/",R=o&&o.route;{let ie=R&&R.path||"";PI(b,!R||ie.endsWith("*")||ie.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${b}" (under <Route path="${ie}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${ie}"> to <Route path="${ie==="/"?"*":`${ie}/*`}">.`)}let M=Gd(),L;if(e){let ie=typeof e=="string"?bg(e):e;hn(A==="/"||ie.pathname?.startsWith(A),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${A}" but pathname "${ie.pathname}" was given in the \`location\` prop.`),L=ie}else L=M;let G=L.pathname||"/",V=G;if(A!=="/"){let ie=A.replace(/^\//,"").split("/");V="/"+G.replace(/^\//,"").split("/").slice(ie.length).join("/")}let q=bI(t,{pathname:V});Vl(R||q!=null,`No routes matched location "${L.pathname}${L.search}${L.hash}" `),Vl(q==null||q[q.length-1].route.element!==void 0||q[q.length-1].route.Component!==void 0||q[q.length-1].route.lazy!==void 0,`Matched leaf route at location "${L.pathname}${L.search}${L.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let J=$N(q&&q.map(ie=>Object.assign({},ie,{params:Object.assign({},m,ie.params),pathname:Sh([A,l.encodeLocation?l.encodeLocation(ie.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:ie.pathname]),pathnameBase:ie.pathnameBase==="/"?A:Sh([A,l.encodeLocation?l.encodeLocation(ie.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:ie.pathnameBase])})),c,r,i,n);return e&&J?Z.createElement(Iy.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...L},navigationType:"POP"}},J):J}function UN(){let t=XN(),e=LN(t)?`${t.status} ${t.statusText}`:t instanceof Error?t.message:JSON.stringify(t),r=t instanceof Error?t.stack:null,i="rgba(200,200,200, 0.5)",n={padding:"0.5rem",backgroundColor:i},l={padding:"2px 4px",backgroundColor:i},c=null;return console.error("Error handled by React Router default ErrorBoundary:",t),c=Z.createElement(Z.Fragment,null,Z.createElement("p",null," Hey developer "),Z.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",Z.createElement("code",{style:l},"ErrorBoundary")," or"," ",Z.createElement("code",{style:l},"errorElement")," prop on your route.")),Z.createElement(Z.Fragment,null,Z.createElement("h2",null,"Unexpected Application Error!"),Z.createElement("h3",{style:{fontStyle:"italic"}},e),r?Z.createElement("pre",{style:n},r):null,c)}var VN=Z.createElement(UN,null),GN=class extends Z.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,e){return e.location!==t.location||e.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:e.error,location:e.location,revalidation:t.revalidation||e.revalidation}}componentDidCatch(t,e){this.props.onError?this.props.onError(t,e):console.error("React Router caught the following error during render",t)}render(){return this.state.error!==void 0?Z.createElement(Iu.Provider,{value:this.props.routeContext},Z.createElement(vE.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function HN({routeContext:t,match:e,children:r}){let i=Z.useContext(xg);return i&&i.static&&i.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(i.staticContext._deepestRenderedBoundaryId=e.route.id),Z.createElement(Iu.Provider,{value:t},r)}function $N(t,e=[],r=null,i=null,n=null){if(t==null){if(!r)return null;if(r.errors)t=r.matches;else if(e.length===0&&!r.initialized&&r.matches.length>0)t=r.matches;else return null}let l=t,c=r?.errors;if(c!=null){let A=l.findIndex(R=>R.route.id&&c?.[R.route.id]!==void 0);hn(A>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(c).join(",")}`),l=l.slice(0,Math.min(l.length,A+1))}let o=!1,m=-1;if(r)for(let A=0;A<l.length;A++){let R=l[A];if((R.route.HydrateFallback||R.route.hydrateFallbackElement)&&(m=A),R.route.id){let{loaderData:M,errors:L}=r,G=R.route.loader&&!M.hasOwnProperty(R.route.id)&&(!L||L[R.route.id]===void 0);if(R.route.lazy||G){o=!0,m>=0?l=l.slice(0,m+1):l=[l[0]];break}}}let b=r&&i?(A,R)=>{i(A,{location:r.location,params:r.matches?.[0]?.params??{},errorInfo:R})}:void 0;return l.reduceRight((A,R,M)=>{let L,G=!1,V=null,q=null;r&&(L=c&&R.route.id?c[R.route.id]:void 0,V=R.route.errorElement||VN,o&&(m<0&&M===0?(PI("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),G=!0,q=null):m===M&&(G=!0,q=R.route.hydrateFallbackElement||null)));let J=e.concat(l.slice(0,M+1)),ie=()=>{let ee;return L?ee=V:G?ee=q:R.route.Component?ee=Z.createElement(R.route.Component,null):R.route.element?ee=R.route.element:ee=A,Z.createElement(HN,{match:R,routeContext:{outlet:A,matches:J,isDataRoute:r!=null},children:ee})};return r&&(R.route.ErrorBoundary||R.route.errorElement||M===0)?Z.createElement(GN,{location:r.location,revalidation:r.revalidation,component:V,error:L,children:ie(),routeContext:{outlet:null,matches:J,isDataRoute:!0},onError:b}):ie()},null)}function bE(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function WN(t){let e=Z.useContext(xg);return hn(e,bE(t)),e}function qN(t){let e=Z.useContext(M1);return hn(e,bE(t)),e}function KN(t){let e=Z.useContext(Iu);return hn(e,bE(t)),e}function xE(t){let e=KN(t),r=e.matches[e.matches.length-1];return hn(r.route.id,`${t} can only be used on routes that contain a unique "id"`),r.route.id}function ZN(){return xE("useRouteId")}function XN(){let t=Z.useContext(vE),e=qN("useRouteError"),r=xE("useRouteError");return t!==void 0?t:e.errors?.[r]}function YN(){let{router:t}=WN("useNavigate"),e=xE("useNavigate"),r=Z.useRef(!1);return SI(()=>{r.current=!0}),Z.useCallback(async(n,l={})=>{Vl(r.current,TI),r.current&&(typeof n=="number"?t.navigate(n):await t.navigate(n,{fromRouteId:e,...l}))},[t,e])}var jS={};function PI(t,e,r){!e&&!jS[t]&&(jS[t]=!0,Vl(!1,r))}Z.memo(JN);function JN({routes:t,future:e,state:r,unstable_onError:i}){return CI(t,void 0,r,i,e)}function QN({to:t,replace:e,state:r,relative:i}){hn(wg(),"<Navigate> may be used only in the context of a <Router> component.");let{static:n}=Z.useContext(Ic);Vl(!n,"<Navigate> must not be used on the initial render in a <StaticRouter>. This is a no-op, but you should modify your code so the <Navigate> is only ever rendered in response to some user interaction or state change.");let{matches:l}=Z.useContext(Iu),{pathname:c}=Gd(),o=I1(),m=yE(t,_E(l),c,i==="path"),b=JSON.stringify(m);return Z.useEffect(()=>{o(JSON.parse(b),{replace:e,state:r,relative:i})},[o,b,i,e,r]),null}function kv(t){hn(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function eF({basename:t="/",children:e=null,location:r,navigationType:i="POP",navigator:n,static:l=!1}){hn(!wg(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let c=t.replace(/^\/*/,"/"),o=Z.useMemo(()=>({basename:c,navigator:n,static:l,future:{}}),[c,n,l]);typeof r=="string"&&(r=bg(r));let{pathname:m="/",search:b="",hash:A="",state:R=null,key:M="default"}=r,L=Z.useMemo(()=>{let G=Ch(m,c);return G==null?null:{location:{pathname:G,search:b,hash:A,state:R,key:M},navigationType:i}},[c,m,b,A,R,M,i]);return Vl(L!=null,`<Router basename="${c}"> is not able to match the URL "${m}${b}${A}" because it does not start with the basename, so the <Router> won't render anything.`),L==null?null:Z.createElement(Ic.Provider,{value:o},Z.createElement(Iy.Provider,{children:e,value:L}))}function tF({children:t,location:e}){return jN(Ow(t),e)}function Ow(t,e=[]){let r=[];return Z.Children.forEach(t,(i,n)=>{if(!Z.isValidElement(i))return;let l=[...e,n];if(i.type===Z.Fragment){r.push.apply(r,Ow(i.props.children,l));return}hn(i.type===kv,`[${typeof i.type=="string"?i.type:i.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),hn(!i.props.index||!i.props.children,"An index route cannot have child routes.");let c={id:i.props.id||l.join("-"),caseSensitive:i.props.caseSensitive,element:i.props.element,Component:i.props.Component,index:i.props.index,path:i.props.path,middleware:i.props.middleware,loader:i.props.loader,action:i.props.action,hydrateFallbackElement:i.props.hydrateFallbackElement,HydrateFallback:i.props.HydrateFallback,errorElement:i.props.errorElement,ErrorBoundary:i.props.ErrorBoundary,hasErrorBoundary:i.props.hasErrorBoundary===!0||i.props.ErrorBoundary!=null||i.props.errorElement!=null,shouldRevalidate:i.props.shouldRevalidate,handle:i.props.handle,lazy:i.props.lazy};i.props.children&&(c.children=Ow(i.props.children,l)),r.push(c)}),r}var Bv="get",Lv="application/x-www-form-urlencoded";function k1(t){return t!=null&&typeof t.tagName=="string"}function rF(t){return k1(t)&&t.tagName.toLowerCase()==="button"}function iF(t){return k1(t)&&t.tagName.toLowerCase()==="form"}function nF(t){return k1(t)&&t.tagName.toLowerCase()==="input"}function sF(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function oF(t,e){return t.button===0&&(!e||e==="_self")&&!sF(t)}var O0=null;function aF(){if(O0===null)try{new FormData(document.createElement("form"),0),O0=!1}catch{O0=!0}return O0}var lF=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function qb(t){return t!=null&&!lF.has(t)?(Vl(!1,`"${t}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${Lv}"`),null):t}function cF(t,e){let r,i,n,l,c;if(iF(t)){let o=t.getAttribute("action");i=o?Ch(o,e):null,r=t.getAttribute("method")||Bv,n=qb(t.getAttribute("enctype"))||Lv,l=new FormData(t)}else if(rF(t)||nF(t)&&(t.type==="submit"||t.type==="image")){let o=t.form;if(o==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let m=t.getAttribute("formaction")||o.getAttribute("action");if(i=m?Ch(m,e):null,r=t.getAttribute("formmethod")||o.getAttribute("method")||Bv,n=qb(t.getAttribute("formenctype"))||qb(o.getAttribute("enctype"))||Lv,l=new FormData(o,t),!aF()){let{name:b,type:A,value:R}=t;if(A==="image"){let M=b?`${b}.`:"";l.append(`${M}x`,"0"),l.append(`${M}y`,"0")}else b&&l.append(b,R)}}else{if(k1(t))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');r=Bv,i=null,n=Lv,c=t}return l&&n==="text/plain"&&(c=l,l=void 0),{action:i,method:r.toLowerCase(),encType:n,formData:l,body:c}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function wE(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function uF(t,e,r){let i=typeof t=="string"?new URL(t,typeof window>"u"?"server://singlefetch/":window.location.origin):t;return i.pathname==="/"?i.pathname=`_root.${r}`:e&&Ch(i.pathname,e)==="/"?i.pathname=`${e.replace(/\/$/,"")}/_root.${r}`:i.pathname=`${i.pathname.replace(/\/$/,"")}.${r}`,i}async function hF(t,e){if(t.id in e)return e[t.id];try{let r=await import(t.module);return e[t.id]=r,r}catch(r){return console.error(`Error loading route module \`${t.module}\`, reloading page...`),console.error(r),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function dF(t){return t==null?!1:t.href==null?t.rel==="preload"&&typeof t.imageSrcSet=="string"&&typeof t.imageSizes=="string":typeof t.rel=="string"&&typeof t.href=="string"}async function fF(t,e,r){let i=await Promise.all(t.map(async n=>{let l=e.routes[n.route.id];if(l){let c=await hF(l,r);return c.links?c.links():[]}return[]}));return _F(i.flat(1).filter(dF).filter(n=>n.rel==="stylesheet"||n.rel==="preload").map(n=>n.rel==="stylesheet"?{...n,rel:"prefetch",as:"style"}:{...n,rel:"prefetch"}))}function US(t,e,r,i,n,l){let c=(m,b)=>r[b]?m.route.id!==r[b].route.id:!0,o=(m,b)=>r[b].pathname!==m.pathname||r[b].route.path?.endsWith("*")&&r[b].params["*"]!==m.params["*"];return l==="assets"?e.filter((m,b)=>c(m,b)||o(m,b)):l==="data"?e.filter((m,b)=>{let A=i.routes[m.route.id];if(!A||!A.hasLoader)return!1;if(c(m,b)||o(m,b))return!0;if(m.route.shouldRevalidate){let R=m.route.shouldRevalidate({currentUrl:new URL(n.pathname+n.search+n.hash,window.origin),currentParams:r[0]?.params||{},nextUrl:new URL(t,window.origin),nextParams:m.params,defaultShouldRevalidate:!0});if(typeof R=="boolean")return R}return!0}):[]}function pF(t,e,{includeHydrateFallback:r}={}){return mF(t.map(i=>{let n=e.routes[i.route.id];if(!n)return[];let l=[n.module];return n.clientActionModule&&(l=l.concat(n.clientActionModule)),n.clientLoaderModule&&(l=l.concat(n.clientLoaderModule)),r&&n.hydrateFallbackModule&&(l=l.concat(n.hydrateFallbackModule)),n.imports&&(l=l.concat(n.imports)),l}).flat(1))}function mF(t){return[...new Set(t)]}function gF(t){let e={},r=Object.keys(t).sort();for(let i of r)e[i]=t[i];return e}function _F(t,e){let r=new Set;return new Set(e),t.reduce((i,n)=>{let l=JSON.stringify(gF(n));return r.has(l)||(r.add(l),i.push({key:l,link:n})),i},[])}function RI(){let t=Z.useContext(xg);return wE(t,"You must render this element inside a <DataRouterContext.Provider> element"),t}function yF(){let t=Z.useContext(M1);return wE(t,"You must render this element inside a <DataRouterStateContext.Provider> element"),t}var EE=Z.createContext(void 0);EE.displayName="FrameworkContext";function MI(){let t=Z.useContext(EE);return wE(t,"You must render this element inside a <HydratedRouter> element"),t}function vF(t,e){let r=Z.useContext(EE),[i,n]=Z.useState(!1),[l,c]=Z.useState(!1),{onFocus:o,onBlur:m,onMouseEnter:b,onMouseLeave:A,onTouchStart:R}=e,M=Z.useRef(null);Z.useEffect(()=>{if(t==="render"&&c(!0),t==="viewport"){let V=J=>{J.forEach(ie=>{c(ie.isIntersecting)})},q=new IntersectionObserver(V,{threshold:.5});return M.current&&q.observe(M.current),()=>{q.disconnect()}}},[t]),Z.useEffect(()=>{if(i){let V=setTimeout(()=>{c(!0)},100);return()=>{clearTimeout(V)}}},[i]);let L=()=>{n(!0)},G=()=>{n(!1),c(!1)};return r?t!=="intent"?[l,M,{}]:[l,M,{onFocus:A_(o,L),onBlur:A_(m,G),onMouseEnter:A_(b,L),onMouseLeave:A_(A,G),onTouchStart:A_(R,L)}]:[!1,M,{}]}function A_(t,e){return r=>{t&&t(r),r.defaultPrevented||e(r)}}function bF({page:t,...e}){let{router:r}=RI(),i=Z.useMemo(()=>bI(r.routes,t,r.basename),[r.routes,t,r.basename]);return i?Z.createElement(wF,{page:t,matches:i,...e}):null}function xF(t){let{manifest:e,routeModules:r}=MI(),[i,n]=Z.useState([]);return Z.useEffect(()=>{let l=!1;return fF(t,e,r).then(c=>{l||n(c)}),()=>{l=!0}},[t,e,r]),i}function wF({page:t,matches:e,...r}){let i=Gd(),{manifest:n,routeModules:l}=MI(),{basename:c}=RI(),{loaderData:o,matches:m}=yF(),b=Z.useMemo(()=>US(t,e,m,n,i,"data"),[t,e,m,n,i]),A=Z.useMemo(()=>US(t,e,m,n,i,"assets"),[t,e,m,n,i]),R=Z.useMemo(()=>{if(t===i.pathname+i.search+i.hash)return[];let G=new Set,V=!1;if(e.forEach(J=>{let ie=n.routes[J.route.id];!ie||!ie.hasLoader||(!b.some(ee=>ee.route.id===J.route.id)&&J.route.id in o&&l[J.route.id]?.shouldRevalidate||ie.hasClientLoader?V=!0:G.add(J.route.id))}),G.size===0)return[];let q=uF(t,c,"data");return V&&G.size>0&&q.searchParams.set("_routes",e.filter(J=>G.has(J.route.id)).map(J=>J.route.id).join(",")),[q.pathname+q.search]},[c,o,i,n,b,e,t,l]),M=Z.useMemo(()=>pF(A,n),[A,n]),L=xF(A);return Z.createElement(Z.Fragment,null,R.map(G=>Z.createElement("link",{key:G,rel:"prefetch",as:"fetch",href:G,...r})),M.map(G=>Z.createElement("link",{key:G,rel:"modulepreload",href:G,...r})),L.map(({key:G,link:V})=>Z.createElement("link",{key:G,nonce:r.nonce,...V})))}function EF(...t){return e=>{t.forEach(r=>{typeof r=="function"?r(e):r!=null&&(r.current=e)})}}var II=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{II&&(window.__reactRouterVersion="7.9.6")}catch{}function AF({basename:t,children:e,window:r}){let i=Z.useRef();i.current==null&&(i.current=uN({window:r,v5Compat:!0}));let n=i.current,[l,c]=Z.useState({action:n.action,location:n.location}),o=Z.useCallback(m=>{Z.startTransition(()=>c(m))},[c]);return Z.useLayoutEffect(()=>n.listen(o),[n,o]),Z.createElement(eF,{basename:t,children:e,location:l.location,navigationType:l.action,navigator:n})}var kI=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,B1=Z.forwardRef(function({onClick:e,discover:r="render",prefetch:i="none",relative:n,reloadDocument:l,replace:c,state:o,target:m,to:b,preventScrollReset:A,viewTransition:R,...M},L){let{basename:G}=Z.useContext(Ic),V=typeof b=="string"&&kI.test(b),q,J=!1;if(typeof b=="string"&&V&&(q=b,II))try{let $e=new URL(window.location.href),at=b.startsWith("//")?new URL($e.protocol+b):new URL(b),_t=Ch(at.pathname,G);at.origin===$e.origin&&_t!=null?b=_t+at.search+at.hash:J=!0}catch{Vl(!1,`<Link to="${b}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let ie=FN(b,{relative:n}),[ee,me,Se]=vF(i,M),Me=PF(b,{replace:c,state:o,target:m,preventScrollReset:A,relative:n,viewTransition:R});function Ve($e){e&&e($e),$e.defaultPrevented||Me($e)}let Be=Z.createElement("a",{...M,...Se,href:q||ie,onClick:J||l?e:Ve,ref:EF(L,me),target:m,"data-discover":!V&&r==="render"?"true":void 0});return ee&&!V?Z.createElement(Z.Fragment,null,Be,Z.createElement(bF,{page:ie})):Be});B1.displayName="Link";var TF=Z.forwardRef(function({"aria-current":e="page",caseSensitive:r=!1,className:i="",end:n=!1,style:l,to:c,viewTransition:o,children:m,...b},A){let R=ky(c,{relative:b.relative}),M=Gd(),L=Z.useContext(M1),{navigator:G,basename:V}=Z.useContext(Ic),q=L!=null&&BF(R)&&o===!0,J=G.encodeLocation?G.encodeLocation(R).pathname:R.pathname,ie=M.pathname,ee=L&&L.navigation&&L.navigation.location?L.navigation.location.pathname:null;r||(ie=ie.toLowerCase(),ee=ee?ee.toLowerCase():null,J=J.toLowerCase()),ee&&V&&(ee=Ch(ee,V)||ee);const me=J!=="/"&&J.endsWith("/")?J.length-1:J.length;let Se=ie===J||!n&&ie.startsWith(J)&&ie.charAt(me)==="/",Me=ee!=null&&(ee===J||!n&&ee.startsWith(J)&&ee.charAt(J.length)==="/"),Ve={isActive:Se,isPending:Me,isTransitioning:q},Be=Se?e:void 0,$e;typeof i=="function"?$e=i(Ve):$e=[i,Se?"active":null,Me?"pending":null,q?"transitioning":null].filter(Boolean).join(" ");let at=typeof l=="function"?l(Ve):l;return Z.createElement(B1,{...b,"aria-current":Be,className:$e,ref:A,style:at,to:c,viewTransition:o},typeof m=="function"?m(Ve):m)});TF.displayName="NavLink";var SF=Z.forwardRef(({discover:t="render",fetcherKey:e,navigate:r,reloadDocument:i,replace:n,state:l,method:c=Bv,action:o,onSubmit:m,relative:b,preventScrollReset:A,viewTransition:R,...M},L)=>{let G=IF(),V=kF(o,{relative:b}),q=c.toLowerCase()==="get"?"get":"post",J=typeof o=="string"&&kI.test(o),ie=ee=>{if(m&&m(ee),ee.defaultPrevented)return;ee.preventDefault();let me=ee.nativeEvent.submitter,Se=me?.getAttribute("formmethod")||c;G(me||ee.currentTarget,{fetcherKey:e,method:Se,navigate:r,replace:n,state:l,relative:b,preventScrollReset:A,viewTransition:R})};return Z.createElement("form",{ref:L,method:q,action:V,onSubmit:i?m:ie,...M,"data-discover":!J&&t==="render"?"true":void 0})});SF.displayName="Form";function CF(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function BI(t){let e=Z.useContext(xg);return hn(e,CF(t)),e}function PF(t,{target:e,replace:r,state:i,preventScrollReset:n,relative:l,viewTransition:c}={}){let o=I1(),m=Gd(),b=ky(t,{relative:l});return Z.useCallback(A=>{if(oF(A,e)){A.preventDefault();let R=r!==void 0?r:uy(m)===uy(b);o(t,{replace:R,state:i,preventScrollReset:n,relative:l,viewTransition:c})}},[m,o,b,r,i,e,t,n,l,c])}var RF=0,MF=()=>`__${String(++RF)}__`;function IF(){let{router:t}=BI("useSubmit"),{basename:e}=Z.useContext(Ic),r=ZN();return Z.useCallback(async(i,n={})=>{let{action:l,method:c,encType:o,formData:m,body:b}=cF(i,e);if(n.navigate===!1){let A=n.fetcherKey||MF();await t.fetch(A,r,n.action||l,{preventScrollReset:n.preventScrollReset,formData:m,body:b,formMethod:n.method||c,formEncType:n.encType||o,flushSync:n.flushSync})}else await t.navigate(n.action||l,{preventScrollReset:n.preventScrollReset,formData:m,body:b,formMethod:n.method||c,formEncType:n.encType||o,replace:n.replace,state:n.state,fromRouteId:r,flushSync:n.flushSync,viewTransition:n.viewTransition})},[t,e,r])}function kF(t,{relative:e}={}){let{basename:r}=Z.useContext(Ic),i=Z.useContext(Iu);hn(i,"useFormAction must be used inside a RouteContext");let[n]=i.matches.slice(-1),l={...ky(t||".",{relative:e})},c=Gd();if(t==null){l.search=c.search;let o=new URLSearchParams(l.search),m=o.getAll("index");if(m.some(A=>A==="")){o.delete("index"),m.filter(R=>R).forEach(R=>o.append("index",R));let A=o.toString();l.search=A?`?${A}`:""}}return(!t||t===".")&&n.route.index&&(l.search=l.search?l.search.replace(/^\?/,"?index&"):"?index"),r!=="/"&&(l.pathname=l.pathname==="/"?r:Sh([r,l.pathname])),uy(l)}function BF(t,{relative:e}={}){let r=Z.useContext(AI);hn(r!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:i}=BI("useViewTransitionState"),n=ky(t,{relative:e});if(!r.isTransitioning)return!1;let l=Ch(r.currentLocation.pathname,i)||r.currentLocation.pathname,c=Ch(r.nextLocation.pathname,i)||r.nextLocation.pathname;return Zv(n.pathname,c)!=null||Zv(n.pathname,l)!=null}var LI=vI();const LF=mE(LI);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const OF=t=>t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),DF=t=>t.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,r,i)=>i?i.toUpperCase():r.toLowerCase()),VS=t=>{const e=DF(t);return e.charAt(0).toUpperCase()+e.slice(1)},OI=(...t)=>t.filter((e,r,i)=>!!e&&e.trim()!==""&&i.indexOf(e)===r).join(" ").trim();/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var NF={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const FF=Z.forwardRef(({color:t="currentColor",size:e=24,strokeWidth:r=2,absoluteStrokeWidth:i,className:n="",children:l,iconNode:c,...o},m)=>Z.createElement("svg",{ref:m,...NF,width:e,height:e,stroke:t,strokeWidth:i?Number(r)*24/Number(e):r,className:OI("lucide",n),...o},[...c.map(([b,A])=>Z.createElement(b,A)),...Array.isArray(l)?l:[l]]));/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yi=(t,e)=>{const r=Z.forwardRef(({className:i,...n},l)=>Z.createElement(FF,{ref:l,iconNode:e,className:OI(`lucide-${OF(VS(t))}`,`lucide-${t}`,i),...n}));return r.displayName=VS(t),r};/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zF=[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]],DI=yi("building-2",zF);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jF=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],L1=yi("calendar",jF);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const UF=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["line",{x1:"21.17",x2:"12",y1:"8",y2:"8",key:"a0cw5f"}],["line",{x1:"3.95",x2:"8.54",y1:"6.06",y2:"14",key:"1kftof"}],["line",{x1:"10.88",x2:"15.46",y1:"21.94",y2:"14",key:"1ymyh8"}]],NI=yi("chrome",UF);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const VF=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],FI=yi("circle-check-big",VF);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const GF=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]],zI=yi("clock",GF);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const HF=[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]],$F=yi("credit-card",HF);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const WF=[["path",{d:"M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z",key:"96xj49"}]],qF=yi("flame",WF);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const KF=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"M15 3v18",key:"14nvp0"}]],ZF=yi("grid-3x3",KF);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const XF=[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]],YF=yi("heart",XF);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const JF=[["path",{d:"M6 3h12",key:"ggurg9"}],["path",{d:"M6 8h12",key:"6g4wlu"}],["path",{d:"m6 13 8.5 8",key:"u1kupk"}],["path",{d:"M6 13h3",key:"wdp6ag"}],["path",{d:"M9 13c6.667 0 6.667-10 0-10",key:"1nkvk2"}]],jI=yi("indian-rupee",JF);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const QF=[["rect",{width:"20",height:"20",x:"2",y:"2",rx:"5",ry:"5",key:"2e1cvw"}],["path",{d:"M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z",key:"9exkf1"}],["line",{x1:"17.5",x2:"17.51",y1:"6.5",y2:"6.5",key:"r4j83e"}]],UI=yi("instagram",QF);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const e8=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],O1=yi("loader-circle",e8);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const t8=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]],Dw=yi("lock",t8);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const r8=[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]],i8=yi("log-out",r8);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const n8=[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]],VI=yi("mail",n8);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const s8=[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]],Pp=yi("map-pin",s8);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const o8=[["path",{d:"M14.106 5.553a2 2 0 0 0 1.788 0l3.659-1.83A1 1 0 0 1 21 4.619v12.764a1 1 0 0 1-.553.894l-4.553 2.277a2 2 0 0 1-1.788 0l-4.212-2.106a2 2 0 0 0-1.788 0l-3.659 1.83A1 1 0 0 1 3 19.381V6.618a1 1 0 0 1 .553-.894l4.553-2.277a2 2 0 0 1 1.788 0z",key:"169xi5"}],["path",{d:"M15 5.764v15",key:"1pn4in"}],["path",{d:"M9 3.236v15",key:"1uimfh"}]],a8=yi("map",o8);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const l8=[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]],c8=yi("message-circle",l8);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const u8=[["path",{d:"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z",key:"a7tn18"}]],h8=yi("moon",u8);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const d8=[["polygon",{points:"3 11 22 2 13 21 11 13 3 11",key:"1ltx0t"}]],f8=yi("navigation",d8);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const p8=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],m8=yi("pen",p8);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const g8=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],_8=yi("plus",g8);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const y8=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]],v8=yi("search",y8);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const b8=[["path",{d:"M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z",key:"4pj2yx"}],["path",{d:"M20 3v4",key:"1olli1"}],["path",{d:"M22 5h-4",key:"1gvqau"}],["path",{d:"M4 17v2",key:"vumght"}],["path",{d:"M5 18H3",key:"zchphs"}]],AE=yi("sparkles",b8);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const x8=[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]],GI=yi("star",x8);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const w8=[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]],E8=yi("sun",w8);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const A8=[["path",{d:"M2 9a3 3 0 0 1 0 6v2a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-2a3 3 0 0 1 0-6V7a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2Z",key:"qn84l0"}],["path",{d:"M13 5v2",key:"dyzc3o"}],["path",{d:"M13 17v2",key:"1ont0d"}],["path",{d:"M13 11v2",key:"1wjjxi"}]],TE=yi("ticket",A8);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const T8=[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]],S8=yi("upload",T8);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const C8=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],HI=yi("user",C8);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const P8=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]],sg=yi("users",P8);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const R8=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],D1=yi("x",R8),SE=Z.createContext({});function CE(t){const e=Z.useRef(null);return e.current===null&&(e.current=t()),e.current}const PE=typeof window<"u",$I=PE?Z.useLayoutEffect:Z.useEffect,N1=Z.createContext(null);function RE(t,e){t.indexOf(e)===-1&&t.push(e)}function ME(t,e){const r=t.indexOf(e);r>-1&&t.splice(r,1)}const Ph=(t,e,r)=>r>e?e:r<t?t:r;let IE=()=>{};const Rh={},WI=t=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(t);function qI(t){return typeof t=="object"&&t!==null}const KI=t=>/^0[^.\s]+$/u.test(t);function kE(t){let e;return()=>(e===void 0&&(e=t()),e)}const zl=t=>t,M8=(t,e)=>r=>e(t(r)),By=(...t)=>t.reduce(M8),hy=(t,e,r)=>{const i=e-t;return i===0?1:(r-t)/i};class BE{constructor(){this.subscriptions=[]}add(e){return RE(this.subscriptions,e),()=>ME(this.subscriptions,e)}notify(e,r,i){const n=this.subscriptions.length;if(n)if(n===1)this.subscriptions[0](e,r,i);else for(let l=0;l<n;l++){const c=this.subscriptions[l];c&&c(e,r,i)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const Pu=t=>t*1e3,Ol=t=>t/1e3;function ZI(t,e){return e?t*(1e3/e):0}const XI=(t,e,r)=>(((1-3*r+3*e)*t+(3*r-6*e))*t+3*e)*t,I8=1e-7,k8=12;function B8(t,e,r,i,n){let l,c,o=0;do c=e+(r-e)/2,l=XI(c,i,n)-t,l>0?r=c:e=c;while(Math.abs(l)>I8&&++o<k8);return c}function Ly(t,e,r,i){if(t===e&&r===i)return zl;const n=l=>B8(l,0,1,t,r);return l=>l===0||l===1?l:XI(n(l),e,i)}const YI=t=>e=>e<=.5?t(2*e)/2:(2-t(2*(1-e)))/2,JI=t=>e=>1-t(1-e),QI=Ly(.33,1.53,.69,.99),LE=JI(QI),e5=YI(LE),t5=t=>(t*=2)<1?.5*LE(t):.5*(2-Math.pow(2,-10*(t-1))),OE=t=>1-Math.sin(Math.acos(t)),r5=JI(OE),i5=YI(OE),L8=Ly(.42,0,1,1),O8=Ly(0,0,.58,1),n5=Ly(.42,0,.58,1),D8=t=>Array.isArray(t)&&typeof t[0]!="number",s5=t=>Array.isArray(t)&&typeof t[0]=="number",N8={linear:zl,easeIn:L8,easeInOut:n5,easeOut:O8,circIn:OE,circInOut:i5,circOut:r5,backIn:LE,backInOut:e5,backOut:QI,anticipate:t5},F8=t=>typeof t=="string",GS=t=>{if(s5(t)){IE(t.length===4);const[e,r,i,n]=t;return Ly(e,r,i,n)}else if(F8(t))return N8[t];return t},D0=["setup","read","resolveKeyframes","preUpdate","update","preRender","render","postRender"];function z8(t,e){let r=new Set,i=new Set,n=!1,l=!1;const c=new WeakSet;let o={delta:0,timestamp:0,isProcessing:!1};function m(A){c.has(A)&&(b.schedule(A),t()),A(o)}const b={schedule:(A,R=!1,M=!1)=>{const G=M&&n?r:i;return R&&c.add(A),G.has(A)||G.add(A),A},cancel:A=>{i.delete(A),c.delete(A)},process:A=>{if(o=A,n){l=!0;return}n=!0,[r,i]=[i,r],r.forEach(m),r.clear(),n=!1,l&&(l=!1,b.process(A))}};return b}const j8=40;function o5(t,e){let r=!1,i=!0;const n={delta:0,timestamp:0,isProcessing:!1},l=()=>r=!0,c=D0.reduce((ee,me)=>(ee[me]=z8(l),ee),{}),{setup:o,read:m,resolveKeyframes:b,preUpdate:A,update:R,preRender:M,render:L,postRender:G}=c,V=()=>{const ee=Rh.useManualTiming?n.timestamp:performance.now();r=!1,Rh.useManualTiming||(n.delta=i?1e3/60:Math.max(Math.min(ee-n.timestamp,j8),1)),n.timestamp=ee,n.isProcessing=!0,o.process(n),m.process(n),b.process(n),A.process(n),R.process(n),M.process(n),L.process(n),G.process(n),n.isProcessing=!1,r&&e&&(i=!1,t(V))},q=()=>{r=!0,i=!0,n.isProcessing||t(V)};return{schedule:D0.reduce((ee,me)=>{const Se=c[me];return ee[me]=(Me,Ve=!1,Be=!1)=>(r||q(),Se.schedule(Me,Ve,Be)),ee},{}),cancel:ee=>{for(let me=0;me<D0.length;me++)c[D0[me]].cancel(ee)},state:n,steps:c}}const{schedule:un,cancel:Od,state:oo,steps:Kb}=o5(typeof requestAnimationFrame<"u"?requestAnimationFrame:zl,!0);let Ov;function U8(){Ov=void 0}const ba={now:()=>(Ov===void 0&&ba.set(oo.isProcessing||Rh.useManualTiming?oo.timestamp:performance.now()),Ov),set:t=>{Ov=t,queueMicrotask(U8)}},a5=t=>e=>typeof e=="string"&&e.startsWith(t),DE=a5("--"),V8=a5("var(--"),NE=t=>V8(t)?G8.test(t.split("/*")[0].trim()):!1,G8=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,Eg={test:t=>typeof t=="number",parse:parseFloat,transform:t=>t},dy={...Eg,transform:t=>Ph(0,1,t)},N0={...Eg,default:1},Z_=t=>Math.round(t*1e5)/1e5,FE=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function H8(t){return t==null}const $8=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,zE=(t,e)=>r=>!!(typeof r=="string"&&$8.test(r)&&r.startsWith(t)||e&&!H8(r)&&Object.prototype.hasOwnProperty.call(r,e)),l5=(t,e,r)=>i=>{if(typeof i!="string")return i;const[n,l,c,o]=i.match(FE);return{[t]:parseFloat(n),[e]:parseFloat(l),[r]:parseFloat(c),alpha:o!==void 0?parseFloat(o):1}},W8=t=>Ph(0,255,t),Zb={...Eg,transform:t=>Math.round(W8(t))},mp={test:zE("rgb","red"),parse:l5("red","green","blue"),transform:({red:t,green:e,blue:r,alpha:i=1})=>"rgba("+Zb.transform(t)+", "+Zb.transform(e)+", "+Zb.transform(r)+", "+Z_(dy.transform(i))+")"};function q8(t){let e="",r="",i="",n="";return t.length>5?(e=t.substring(1,3),r=t.substring(3,5),i=t.substring(5,7),n=t.substring(7,9)):(e=t.substring(1,2),r=t.substring(2,3),i=t.substring(3,4),n=t.substring(4,5),e+=e,r+=r,i+=i,n+=n),{red:parseInt(e,16),green:parseInt(r,16),blue:parseInt(i,16),alpha:n?parseInt(n,16)/255:1}}const Nw={test:zE("#"),parse:q8,transform:mp.transform},Oy=t=>({test:e=>typeof e=="string"&&e.endsWith(t)&&e.split(" ").length===1,parse:parseFloat,transform:e=>`${e}${t}`}),Td=Oy("deg"),Ru=Oy("%"),Ir=Oy("px"),K8=Oy("vh"),Z8=Oy("vw"),HS={...Ru,parse:t=>Ru.parse(t)/100,transform:t=>Ru.transform(t*100)},Dm={test:zE("hsl","hue"),parse:l5("hue","saturation","lightness"),transform:({hue:t,saturation:e,lightness:r,alpha:i=1})=>"hsla("+Math.round(t)+", "+Ru.transform(Z_(e))+", "+Ru.transform(Z_(r))+", "+Z_(dy.transform(i))+")"},rs={test:t=>mp.test(t)||Nw.test(t)||Dm.test(t),parse:t=>mp.test(t)?mp.parse(t):Dm.test(t)?Dm.parse(t):Nw.parse(t),transform:t=>typeof t=="string"?t:t.hasOwnProperty("red")?mp.transform(t):Dm.transform(t),getAnimatableNone:t=>{const e=rs.parse(t);return e.alpha=0,rs.transform(e)}},X8=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function Y8(t){return isNaN(t)&&typeof t=="string"&&(t.match(FE)?.length||0)+(t.match(X8)?.length||0)>0}const c5="number",u5="color",J8="var",Q8="var(",$S="${}",e9=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function fy(t){const e=t.toString(),r=[],i={color:[],number:[],var:[]},n=[];let l=0;const o=e.replace(e9,m=>(rs.test(m)?(i.color.push(l),n.push(u5),r.push(rs.parse(m))):m.startsWith(Q8)?(i.var.push(l),n.push(J8),r.push(m)):(i.number.push(l),n.push(c5),r.push(parseFloat(m))),++l,$S)).split($S);return{values:r,split:o,indexes:i,types:n}}function h5(t){return fy(t).values}function d5(t){const{split:e,types:r}=fy(t),i=e.length;return n=>{let l="";for(let c=0;c<i;c++)if(l+=e[c],n[c]!==void 0){const o=r[c];o===c5?l+=Z_(n[c]):o===u5?l+=rs.transform(n[c]):l+=n[c]}return l}}const t9=t=>typeof t=="number"?0:rs.test(t)?rs.getAnimatableNone(t):t;function r9(t){const e=h5(t);return d5(t)(e.map(t9))}const Dd={test:Y8,parse:h5,createTransformer:d5,getAnimatableNone:r9};function Xb(t,e,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?t+(e-t)*6*r:r<1/2?e:r<2/3?t+(e-t)*(2/3-r)*6:t}function i9({hue:t,saturation:e,lightness:r,alpha:i}){t/=360,e/=100,r/=100;let n=0,l=0,c=0;if(!e)n=l=c=r;else{const o=r<.5?r*(1+e):r+e-r*e,m=2*r-o;n=Xb(m,o,t+1/3),l=Xb(m,o,t),c=Xb(m,o,t-1/3)}return{red:Math.round(n*255),green:Math.round(l*255),blue:Math.round(c*255),alpha:i}}function Xv(t,e){return r=>r>0?e:t}const En=(t,e,r)=>t+(e-t)*r,Yb=(t,e,r)=>{const i=t*t,n=r*(e*e-i)+i;return n<0?0:Math.sqrt(n)},n9=[Nw,mp,Dm],s9=t=>n9.find(e=>e.test(t));function WS(t){const e=s9(t);if(!e)return!1;let r=e.parse(t);return e===Dm&&(r=i9(r)),r}const qS=(t,e)=>{const r=WS(t),i=WS(e);if(!r||!i)return Xv(t,e);const n={...r};return l=>(n.red=Yb(r.red,i.red,l),n.green=Yb(r.green,i.green,l),n.blue=Yb(r.blue,i.blue,l),n.alpha=En(r.alpha,i.alpha,l),mp.transform(n))},Fw=new Set(["none","hidden"]);function o9(t,e){return Fw.has(t)?r=>r<=0?t:e:r=>r>=1?e:t}function a9(t,e){return r=>En(t,e,r)}function jE(t){return typeof t=="number"?a9:typeof t=="string"?NE(t)?Xv:rs.test(t)?qS:u9:Array.isArray(t)?f5:typeof t=="object"?rs.test(t)?qS:l9:Xv}function f5(t,e){const r=[...t],i=r.length,n=t.map((l,c)=>jE(l)(l,e[c]));return l=>{for(let c=0;c<i;c++)r[c]=n[c](l);return r}}function l9(t,e){const r={...t,...e},i={};for(const n in r)t[n]!==void 0&&e[n]!==void 0&&(i[n]=jE(t[n])(t[n],e[n]));return n=>{for(const l in i)r[l]=i[l](n);return r}}function c9(t,e){const r=[],i={color:0,var:0,number:0};for(let n=0;n<e.values.length;n++){const l=e.types[n],c=t.indexes[l][i[l]],o=t.values[c]??0;r[n]=o,i[l]++}return r}const u9=(t,e)=>{const r=Dd.createTransformer(e),i=fy(t),n=fy(e);return i.indexes.var.length===n.indexes.var.length&&i.indexes.color.length===n.indexes.color.length&&i.indexes.number.length>=n.indexes.number.length?Fw.has(t)&&!n.values.length||Fw.has(e)&&!i.values.length?o9(t,e):By(f5(c9(i,n),n.values),r):Xv(t,e)};function p5(t,e,r){return typeof t=="number"&&typeof e=="number"&&typeof r=="number"?En(t,e,r):jE(t)(t,e)}const h9=t=>{const e=({timestamp:r})=>t(r);return{start:(r=!0)=>un.update(e,r),stop:()=>Od(e),now:()=>oo.isProcessing?oo.timestamp:ba.now()}},m5=(t,e,r=10)=>{let i="";const n=Math.max(Math.round(e/r),2);for(let l=0;l<n;l++)i+=Math.round(t(l/(n-1))*1e4)/1e4+", ";return`linear(${i.substring(0,i.length-2)})`},Yv=2e4;function UE(t){let e=0;const r=50;let i=t.next(e);for(;!i.done&&e<Yv;)e+=r,i=t.next(e);return e>=Yv?1/0:e}function d9(t,e=100,r){const i=r({...t,keyframes:[0,e]}),n=Math.min(UE(i),Yv);return{type:"keyframes",ease:l=>i.next(n*l).value/e,duration:Ol(n)}}const f9=5;function g5(t,e,r){const i=Math.max(e-f9,0);return ZI(r-t(i),e-i)}const In={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},Jb=.001;function p9({duration:t=In.duration,bounce:e=In.bounce,velocity:r=In.velocity,mass:i=In.mass}){let n,l,c=1-e;c=Ph(In.minDamping,In.maxDamping,c),t=Ph(In.minDuration,In.maxDuration,Ol(t)),c<1?(n=b=>{const A=b*c,R=A*t,M=A-r,L=zw(b,c),G=Math.exp(-R);return Jb-M/L*G},l=b=>{const R=b*c*t,M=R*r+r,L=Math.pow(c,2)*Math.pow(b,2)*t,G=Math.exp(-R),V=zw(Math.pow(b,2),c);return(-n(b)+Jb>0?-1:1)*((M-L)*G)/V}):(n=b=>{const A=Math.exp(-b*t),R=(b-r)*t+1;return-Jb+A*R},l=b=>{const A=Math.exp(-b*t),R=(r-b)*(t*t);return A*R});const o=5/t,m=g9(n,l,o);if(t=Pu(t),isNaN(m))return{stiffness:In.stiffness,damping:In.damping,duration:t};{const b=Math.pow(m,2)*i;return{stiffness:b,damping:c*2*Math.sqrt(i*b),duration:t}}}const m9=12;function g9(t,e,r){let i=r;for(let n=1;n<m9;n++)i=i-t(i)/e(i);return i}function zw(t,e){return t*Math.sqrt(1-e*e)}const _9=["duration","bounce"],y9=["stiffness","damping","mass"];function KS(t,e){return e.some(r=>t[r]!==void 0)}function v9(t){let e={velocity:In.velocity,stiffness:In.stiffness,damping:In.damping,mass:In.mass,isResolvedFromDuration:!1,...t};if(!KS(t,y9)&&KS(t,_9))if(t.visualDuration){const r=t.visualDuration,i=2*Math.PI/(r*1.2),n=i*i,l=2*Ph(.05,1,1-(t.bounce||0))*Math.sqrt(n);e={...e,mass:In.mass,stiffness:n,damping:l}}else{const r=p9(t);e={...e,...r,mass:In.mass},e.isResolvedFromDuration=!0}return e}function Jv(t=In.visualDuration,e=In.bounce){const r=typeof t!="object"?{visualDuration:t,keyframes:[0,1],bounce:e}:t;let{restSpeed:i,restDelta:n}=r;const l=r.keyframes[0],c=r.keyframes[r.keyframes.length-1],o={done:!1,value:l},{stiffness:m,damping:b,mass:A,duration:R,velocity:M,isResolvedFromDuration:L}=v9({...r,velocity:-Ol(r.velocity||0)}),G=M||0,V=b/(2*Math.sqrt(m*A)),q=c-l,J=Ol(Math.sqrt(m/A)),ie=Math.abs(q)<5;i||(i=ie?In.restSpeed.granular:In.restSpeed.default),n||(n=ie?In.restDelta.granular:In.restDelta.default);let ee;if(V<1){const Se=zw(J,V);ee=Me=>{const Ve=Math.exp(-V*J*Me);return c-Ve*((G+V*J*q)/Se*Math.sin(Se*Me)+q*Math.cos(Se*Me))}}else if(V===1)ee=Se=>c-Math.exp(-J*Se)*(q+(G+J*q)*Se);else{const Se=J*Math.sqrt(V*V-1);ee=Me=>{const Ve=Math.exp(-V*J*Me),Be=Math.min(Se*Me,300);return c-Ve*((G+V*J*q)*Math.sinh(Be)+Se*q*Math.cosh(Be))/Se}}const me={calculatedDuration:L&&R||null,next:Se=>{const Me=ee(Se);if(L)o.done=Se>=R;else{let Ve=Se===0?G:0;V<1&&(Ve=Se===0?Pu(G):g5(ee,Se,Me));const Be=Math.abs(Ve)<=i,$e=Math.abs(c-Me)<=n;o.done=Be&&$e}return o.value=o.done?c:Me,o},toString:()=>{const Se=Math.min(UE(me),Yv),Me=m5(Ve=>me.next(Se*Ve).value,Se,30);return Se+"ms "+Me},toTransition:()=>{}};return me}Jv.applyToOptions=t=>{const e=d9(t,100,Jv);return t.ease=e.ease,t.duration=Pu(e.duration),t.type="keyframes",t};function jw({keyframes:t,velocity:e=0,power:r=.8,timeConstant:i=325,bounceDamping:n=10,bounceStiffness:l=500,modifyTarget:c,min:o,max:m,restDelta:b=.5,restSpeed:A}){const R=t[0],M={done:!1,value:R},L=Be=>o!==void 0&&Be<o||m!==void 0&&Be>m,G=Be=>o===void 0?m:m===void 0||Math.abs(o-Be)<Math.abs(m-Be)?o:m;let V=r*e;const q=R+V,J=c===void 0?q:c(q);J!==q&&(V=J-R);const ie=Be=>-V*Math.exp(-Be/i),ee=Be=>J+ie(Be),me=Be=>{const $e=ie(Be),at=ee(Be);M.done=Math.abs($e)<=b,M.value=M.done?J:at};let Se,Me;const Ve=Be=>{L(M.value)&&(Se=Be,Me=Jv({keyframes:[M.value,G(M.value)],velocity:g5(ee,Be,M.value),damping:n,stiffness:l,restDelta:b,restSpeed:A}))};return Ve(0),{calculatedDuration:null,next:Be=>{let $e=!1;return!Me&&Se===void 0&&($e=!0,me(Be),Ve(Be)),Se!==void 0&&Be>=Se?Me.next(Be-Se):(!$e&&me(Be),M)}}}function b9(t,e,r){const i=[],n=r||Rh.mix||p5,l=t.length-1;for(let c=0;c<l;c++){let o=n(t[c],t[c+1]);if(e){const m=Array.isArray(e)?e[c]||zl:e;o=By(m,o)}i.push(o)}return i}function x9(t,e,{clamp:r=!0,ease:i,mixer:n}={}){const l=t.length;if(IE(l===e.length),l===1)return()=>e[0];if(l===2&&e[0]===e[1])return()=>e[1];const c=t[0]===t[1];t[0]>t[l-1]&&(t=[...t].reverse(),e=[...e].reverse());const o=b9(e,i,n),m=o.length,b=A=>{if(c&&A<t[0])return e[0];let R=0;if(m>1)for(;R<t.length-2&&!(A<t[R+1]);R++);const M=hy(t[R],t[R+1],A);return o[R](M)};return r?A=>b(Ph(t[0],t[l-1],A)):b}function w9(t,e){const r=t[t.length-1];for(let i=1;i<=e;i++){const n=hy(0,e,i);t.push(En(r,1,n))}}function E9(t){const e=[0];return w9(e,t.length-1),e}function A9(t,e){return t.map(r=>r*e)}function T9(t,e){return t.map(()=>e||n5).splice(0,t.length-1)}function X_({duration:t=300,keyframes:e,times:r,ease:i="easeInOut"}){const n=D8(i)?i.map(GS):GS(i),l={done:!1,value:e[0]},c=A9(r&&r.length===e.length?r:E9(e),t),o=x9(c,e,{ease:Array.isArray(n)?n:T9(e,n)});return{calculatedDuration:t,next:m=>(l.value=o(m),l.done=m>=t,l)}}const S9=t=>t!==null;function VE(t,{repeat:e,repeatType:r="loop"},i,n=1){const l=t.filter(S9),o=n<0||e&&r!=="loop"&&e%2===1?0:l.length-1;return!o||i===void 0?l[o]:i}const C9={decay:jw,inertia:jw,tween:X_,keyframes:X_,spring:Jv};function _5(t){typeof t.type=="string"&&(t.type=C9[t.type])}class GE{constructor(){this.updateFinished()}get finished(){return this._finished}updateFinished(){this._finished=new Promise(e=>{this.resolve=e})}notifyFinished(){this.resolve()}then(e,r){return this.finished.then(e,r)}}const P9=t=>t/100;class HE extends GE{constructor(e){super(),this.state="idle",this.startTime=null,this.isStopped=!1,this.currentTime=0,this.holdTime=null,this.playbackSpeed=1,this.stop=()=>{const{motionValue:r}=this.options;r&&r.updatedAt!==ba.now()&&this.tick(ba.now()),this.isStopped=!0,this.state!=="idle"&&(this.teardown(),this.options.onStop?.())},this.options=e,this.initAnimation(),this.play(),e.autoplay===!1&&this.pause()}initAnimation(){const{options:e}=this;_5(e);const{type:r=X_,repeat:i=0,repeatDelay:n=0,repeatType:l,velocity:c=0}=e;let{keyframes:o}=e;const m=r||X_;m!==X_&&typeof o[0]!="number"&&(this.mixKeyframes=By(P9,p5(o[0],o[1])),o=[0,100]);const b=m({...e,keyframes:o});l==="mirror"&&(this.mirroredGenerator=m({...e,keyframes:[...o].reverse(),velocity:-c})),b.calculatedDuration===null&&(b.calculatedDuration=UE(b));const{calculatedDuration:A}=b;this.calculatedDuration=A,this.resolvedDuration=A+n,this.totalDuration=this.resolvedDuration*(i+1)-n,this.generator=b}updateTime(e){const r=Math.round(e-this.startTime)*this.playbackSpeed;this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=r}tick(e,r=!1){const{generator:i,totalDuration:n,mixKeyframes:l,mirroredGenerator:c,resolvedDuration:o,calculatedDuration:m}=this;if(this.startTime===null)return i.next(0);const{delay:b=0,keyframes:A,repeat:R,repeatType:M,repeatDelay:L,type:G,onUpdate:V,finalKeyframe:q}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,e):this.speed<0&&(this.startTime=Math.min(e-n/this.speed,this.startTime)),r?this.currentTime=e:this.updateTime(e);const J=this.currentTime-b*(this.playbackSpeed>=0?1:-1),ie=this.playbackSpeed>=0?J<0:J>n;this.currentTime=Math.max(J,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=n);let ee=this.currentTime,me=i;if(R){const Be=Math.min(this.currentTime,n)/o;let $e=Math.floor(Be),at=Be%1;!at&&Be>=1&&(at=1),at===1&&$e--,$e=Math.min($e,R+1),!!($e%2)&&(M==="reverse"?(at=1-at,L&&(at-=L/o)):M==="mirror"&&(me=c)),ee=Ph(0,1,at)*o}const Se=ie?{done:!1,value:A[0]}:me.next(ee);l&&(Se.value=l(Se.value));let{done:Me}=Se;!ie&&m!==null&&(Me=this.playbackSpeed>=0?this.currentTime>=n:this.currentTime<=0);const Ve=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&Me);return Ve&&G!==jw&&(Se.value=VE(A,this.options,q,this.speed)),V&&V(Se.value),Ve&&this.finish(),Se}then(e,r){return this.finished.then(e,r)}get duration(){return Ol(this.calculatedDuration)}get iterationDuration(){const{delay:e=0}=this.options||{};return this.duration+Ol(e)}get time(){return Ol(this.currentTime)}set time(e){e=Pu(e),this.currentTime=e,this.startTime===null||this.holdTime!==null||this.playbackSpeed===0?this.holdTime=e:this.driver&&(this.startTime=this.driver.now()-e/this.playbackSpeed),this.driver?.start(!1)}get speed(){return this.playbackSpeed}set speed(e){this.updateTime(ba.now());const r=this.playbackSpeed!==e;this.playbackSpeed=e,r&&(this.time=Ol(this.currentTime))}play(){if(this.isStopped)return;const{driver:e=h9,startTime:r}=this.options;this.driver||(this.driver=e(n=>this.tick(n))),this.options.onPlay?.();const i=this.driver.now();this.state==="finished"?(this.updateFinished(),this.startTime=i):this.holdTime!==null?this.startTime=i-this.holdTime:this.startTime||(this.startTime=r??i),this.state==="finished"&&this.speed<0&&(this.startTime+=this.calculatedDuration),this.holdTime=null,this.state="running",this.driver.start()}pause(){this.state="paused",this.updateTime(ba.now()),this.holdTime=this.currentTime}complete(){this.state!=="running"&&this.play(),this.state="finished",this.holdTime=null}finish(){this.notifyFinished(),this.teardown(),this.state="finished",this.options.onComplete?.()}cancel(){this.holdTime=null,this.startTime=0,this.tick(0),this.teardown(),this.options.onCancel?.()}teardown(){this.state="idle",this.stopDriver(),this.startTime=this.holdTime=null}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(e){return this.startTime=0,this.tick(e,!0)}attachTimeline(e){return this.options.allowFlatten&&(this.options.type="keyframes",this.options.ease="linear",this.initAnimation()),this.driver?.stop(),e.observe(this)}}function R9(t){for(let e=1;e<t.length;e++)t[e]??(t[e]=t[e-1])}const gp=t=>t*180/Math.PI,Uw=t=>{const e=gp(Math.atan2(t[1],t[0]));return Vw(e)},M9={x:4,y:5,translateX:4,translateY:5,scaleX:0,scaleY:3,scale:t=>(Math.abs(t[0])+Math.abs(t[3]))/2,rotate:Uw,rotateZ:Uw,skewX:t=>gp(Math.atan(t[1])),skewY:t=>gp(Math.atan(t[2])),skew:t=>(Math.abs(t[1])+Math.abs(t[2]))/2},Vw=t=>(t=t%360,t<0&&(t+=360),t),ZS=Uw,XS=t=>Math.sqrt(t[0]*t[0]+t[1]*t[1]),YS=t=>Math.sqrt(t[4]*t[4]+t[5]*t[5]),I9={x:12,y:13,z:14,translateX:12,translateY:13,translateZ:14,scaleX:XS,scaleY:YS,scale:t=>(XS(t)+YS(t))/2,rotateX:t=>Vw(gp(Math.atan2(t[6],t[5]))),rotateY:t=>Vw(gp(Math.atan2(-t[2],t[0]))),rotateZ:ZS,rotate:ZS,skewX:t=>gp(Math.atan(t[4])),skewY:t=>gp(Math.atan(t[1])),skew:t=>(Math.abs(t[1])+Math.abs(t[4]))/2};function Gw(t){return t.includes("scale")?1:0}function Hw(t,e){if(!t||t==="none")return Gw(e);const r=t.match(/^matrix3d\(([-\d.e\s,]+)\)$/u);let i,n;if(r)i=I9,n=r;else{const o=t.match(/^matrix\(([-\d.e\s,]+)\)$/u);i=M9,n=o}if(!n)return Gw(e);const l=i[e],c=n[1].split(",").map(B9);return typeof l=="function"?l(c):c[l]}const k9=(t,e)=>{const{transform:r="none"}=getComputedStyle(t);return Hw(r,e)};function B9(t){return parseFloat(t.trim())}const Ag=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],Tg=new Set(Ag),JS=t=>t===Eg||t===Ir,L9=new Set(["x","y","z"]),O9=Ag.filter(t=>!L9.has(t));function D9(t){const e=[];return O9.forEach(r=>{const i=t.getValue(r);i!==void 0&&(e.push([r,i.get()]),i.set(r.startsWith("scale")?1:0))}),e}const Ep={width:({x:t},{paddingLeft:e="0",paddingRight:r="0"})=>t.max-t.min-parseFloat(e)-parseFloat(r),height:({y:t},{paddingTop:e="0",paddingBottom:r="0"})=>t.max-t.min-parseFloat(e)-parseFloat(r),top:(t,{top:e})=>parseFloat(e),left:(t,{left:e})=>parseFloat(e),bottom:({y:t},{top:e})=>parseFloat(e)+(t.max-t.min),right:({x:t},{left:e})=>parseFloat(e)+(t.max-t.min),x:(t,{transform:e})=>Hw(e,"x"),y:(t,{transform:e})=>Hw(e,"y")};Ep.translateX=Ep.x;Ep.translateY=Ep.y;const Ap=new Set;let $w=!1,Ww=!1,qw=!1;function y5(){if(Ww){const t=Array.from(Ap).filter(i=>i.needsMeasurement),e=new Set(t.map(i=>i.element)),r=new Map;e.forEach(i=>{const n=D9(i);n.length&&(r.set(i,n),i.render())}),t.forEach(i=>i.measureInitialState()),e.forEach(i=>{i.render();const n=r.get(i);n&&n.forEach(([l,c])=>{i.getValue(l)?.set(c)})}),t.forEach(i=>i.measureEndState()),t.forEach(i=>{i.suspendedScrollY!==void 0&&window.scrollTo(0,i.suspendedScrollY)})}Ww=!1,$w=!1,Ap.forEach(t=>t.complete(qw)),Ap.clear()}function v5(){Ap.forEach(t=>{t.readKeyframes(),t.needsMeasurement&&(Ww=!0)})}function N9(){qw=!0,v5(),y5(),qw=!1}class $E{constructor(e,r,i,n,l,c=!1){this.state="pending",this.isAsync=!1,this.needsMeasurement=!1,this.unresolvedKeyframes=[...e],this.onComplete=r,this.name=i,this.motionValue=n,this.element=l,this.isAsync=c}scheduleResolve(){this.state="scheduled",this.isAsync?(Ap.add(this),$w||($w=!0,un.read(v5),un.resolveKeyframes(y5))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:e,name:r,element:i,motionValue:n}=this;if(e[0]===null){const l=n?.get(),c=e[e.length-1];if(l!==void 0)e[0]=l;else if(i&&r){const o=i.readValue(r,c);o!=null&&(e[0]=o)}e[0]===void 0&&(e[0]=c),n&&l===void 0&&n.set(e[0])}R9(e)}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(e=!1){this.state="complete",this.onComplete(this.unresolvedKeyframes,this.finalKeyframe,e),Ap.delete(this)}cancel(){this.state==="scheduled"&&(Ap.delete(this),this.state="pending")}resume(){this.state==="pending"&&this.scheduleResolve()}}const F9=t=>t.startsWith("--");function z9(t,e,r){F9(e)?t.style.setProperty(e,r):t.style[e]=r}const j9=kE(()=>window.ScrollTimeline!==void 0),U9={};function V9(t,e){const r=kE(t);return()=>U9[e]??r()}const b5=V9(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),U_=([t,e,r,i])=>`cubic-bezier(${t}, ${e}, ${r}, ${i})`,QS={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:U_([0,.65,.55,1]),circOut:U_([.55,0,1,.45]),backIn:U_([.31,.01,.66,-.59]),backOut:U_([.33,1.53,.69,.99])};function x5(t,e){if(t)return typeof t=="function"?b5()?m5(t,e):"ease-out":s5(t)?U_(t):Array.isArray(t)?t.map(r=>x5(r,e)||QS.easeOut):QS[t]}function G9(t,e,r,{delay:i=0,duration:n=300,repeat:l=0,repeatType:c="loop",ease:o="easeOut",times:m}={},b=void 0){const A={[e]:r};m&&(A.offset=m);const R=x5(o,n);Array.isArray(R)&&(A.easing=R);const M={delay:i,duration:n,easing:Array.isArray(R)?"linear":R,fill:"both",iterations:l+1,direction:c==="reverse"?"alternate":"normal"};return b&&(M.pseudoElement=b),t.animate(A,M)}function w5(t){return typeof t=="function"&&"applyToOptions"in t}function H9({type:t,...e}){return w5(t)&&b5()?t.applyToOptions(e):(e.duration??(e.duration=300),e.ease??(e.ease="easeOut"),e)}class $9 extends GE{constructor(e){if(super(),this.finishedTime=null,this.isStopped=!1,!e)return;const{element:r,name:i,keyframes:n,pseudoElement:l,allowFlatten:c=!1,finalKeyframe:o,onComplete:m}=e;this.isPseudoElement=!!l,this.allowFlatten=c,this.options=e,IE(typeof e.type!="string");const b=H9(e);this.animation=G9(r,i,n,b,l),b.autoplay===!1&&this.animation.pause(),this.animation.onfinish=()=>{if(this.finishedTime=this.time,!l){const A=VE(n,this.options,o,this.speed);this.updateMotionValue?this.updateMotionValue(A):z9(r,i,A),this.animation.cancel()}m?.(),this.notifyFinished()}}play(){this.isStopped||(this.animation.play(),this.state==="finished"&&this.updateFinished())}pause(){this.animation.pause()}complete(){this.animation.finish?.()}cancel(){try{this.animation.cancel()}catch{}}stop(){if(this.isStopped)return;this.isStopped=!0;const{state:e}=this;e==="idle"||e==="finished"||(this.updateMotionValue?this.updateMotionValue():this.commitStyles(),this.isPseudoElement||this.cancel())}commitStyles(){this.isPseudoElement||this.animation.commitStyles?.()}get duration(){const e=this.animation.effect?.getComputedTiming?.().duration||0;return Ol(Number(e))}get iterationDuration(){const{delay:e=0}=this.options||{};return this.duration+Ol(e)}get time(){return Ol(Number(this.animation.currentTime)||0)}set time(e){this.finishedTime=null,this.animation.currentTime=Pu(e)}get speed(){return this.animation.playbackRate}set speed(e){e<0&&(this.finishedTime=null),this.animation.playbackRate=e}get state(){return this.finishedTime!==null?"finished":this.animation.playState}get startTime(){return Number(this.animation.startTime)}set startTime(e){this.animation.startTime=e}attachTimeline({timeline:e,observe:r}){return this.allowFlatten&&this.animation.effect?.updateTiming({easing:"linear"}),this.animation.onfinish=null,e&&j9()?(this.animation.timeline=e,zl):r(this)}}const E5={anticipate:t5,backInOut:e5,circInOut:i5};function W9(t){return t in E5}function q9(t){typeof t.ease=="string"&&W9(t.ease)&&(t.ease=E5[t.ease])}const e3=10;class K9 extends $9{constructor(e){q9(e),_5(e),super(e),e.startTime&&(this.startTime=e.startTime),this.options=e}updateMotionValue(e){const{motionValue:r,onUpdate:i,onComplete:n,element:l,...c}=this.options;if(!r)return;if(e!==void 0){r.set(e);return}const o=new HE({...c,autoplay:!1}),m=Pu(this.finishedTime??this.time);r.setWithVelocity(o.sample(m-e3).value,o.sample(m).value,e3),o.stop()}}const t3=(t,e)=>e==="zIndex"?!1:!!(typeof t=="number"||Array.isArray(t)||typeof t=="string"&&(Dd.test(t)||t==="0")&&!t.startsWith("url("));function Z9(t){const e=t[0];if(t.length===1)return!0;for(let r=0;r<t.length;r++)if(t[r]!==e)return!0}function X9(t,e,r,i){const n=t[0];if(n===null)return!1;if(e==="display"||e==="visibility")return!0;const l=t[t.length-1],c=t3(n,e),o=t3(l,e);return!c||!o?!1:Z9(t)||(r==="spring"||w5(r))&&i}function Kw(t){t.duration=0,t.type="keyframes"}const Y9=new Set(["opacity","clipPath","filter","transform"]),J9=kE(()=>Object.hasOwnProperty.call(Element.prototype,"animate"));function Q9(t){const{motionValue:e,name:r,repeatDelay:i,repeatType:n,damping:l,type:c}=t;if(!(e?.owner?.current instanceof HTMLElement))return!1;const{onUpdate:m,transformTemplate:b}=e.owner.getProps();return J9()&&r&&Y9.has(r)&&(r!=="transform"||!b)&&!m&&!i&&n!=="mirror"&&l!==0&&c!=="inertia"}const ez=40;class tz extends GE{constructor({autoplay:e=!0,delay:r=0,type:i="keyframes",repeat:n=0,repeatDelay:l=0,repeatType:c="loop",keyframes:o,name:m,motionValue:b,element:A,...R}){super(),this.stop=()=>{this._animation&&(this._animation.stop(),this.stopTimeline?.()),this.keyframeResolver?.cancel()},this.createdAt=ba.now();const M={autoplay:e,delay:r,type:i,repeat:n,repeatDelay:l,repeatType:c,name:m,motionValue:b,element:A,...R},L=A?.KeyframeResolver||$E;this.keyframeResolver=new L(o,(G,V,q)=>this.onKeyframesResolved(G,V,M,!q),m,b,A),this.keyframeResolver?.scheduleResolve()}onKeyframesResolved(e,r,i,n){this.keyframeResolver=void 0;const{name:l,type:c,velocity:o,delay:m,isHandoff:b,onUpdate:A}=i;this.resolvedAt=ba.now(),X9(e,l,c,o)||((Rh.instantAnimations||!m)&&A?.(VE(e,i,r)),e[0]=e[e.length-1],Kw(i),i.repeat=0);const M={startTime:n?this.resolvedAt?this.resolvedAt-this.createdAt>ez?this.resolvedAt:this.createdAt:this.createdAt:void 0,finalKeyframe:r,...i,keyframes:e},L=!b&&Q9(M)?new K9({...M,element:M.motionValue.owner.current}):new HE(M);L.finished.then(()=>this.notifyFinished()).catch(zl),this.pendingTimeline&&(this.stopTimeline=L.attachTimeline(this.pendingTimeline),this.pendingTimeline=void 0),this._animation=L}get finished(){return this._animation?this.animation.finished:this._finished}then(e,r){return this.finished.finally(e).then(()=>{})}get animation(){return this._animation||(this.keyframeResolver?.resume(),N9()),this._animation}get duration(){return this.animation.duration}get iterationDuration(){return this.animation.iterationDuration}get time(){return this.animation.time}set time(e){this.animation.time=e}get speed(){return this.animation.speed}get state(){return this.animation.state}set speed(e){this.animation.speed=e}get startTime(){return this.animation.startTime}attachTimeline(e){return this._animation?this.stopTimeline=this.animation.attachTimeline(e):this.pendingTimeline=e,()=>this.stop()}play(){this.animation.play()}pause(){this.animation.pause()}complete(){this.animation.complete()}cancel(){this._animation&&this.animation.cancel(),this.keyframeResolver?.cancel()}}const rz=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function iz(t){const e=rz.exec(t);if(!e)return[,];const[,r,i,n]=e;return[`--${r??i}`,n]}function A5(t,e,r=1){const[i,n]=iz(t);if(!i)return;const l=window.getComputedStyle(e).getPropertyValue(i);if(l){const c=l.trim();return WI(c)?parseFloat(c):c}return NE(n)?A5(n,e,r+1):n}function WE(t,e){return t?.[e]??t?.default??t}const T5=new Set(["width","height","top","left","right","bottom",...Ag]),nz={test:t=>t==="auto",parse:t=>t},S5=t=>e=>e.test(t),C5=[Eg,Ir,Ru,Td,Z8,K8,nz],r3=t=>C5.find(S5(t));function sz(t){return typeof t=="number"?t===0:t!==null?t==="none"||t==="0"||KI(t):!0}const oz=new Set(["brightness","contrast","saturate","opacity"]);function az(t){const[e,r]=t.slice(0,-1).split("(");if(e==="drop-shadow")return t;const[i]=r.match(FE)||[];if(!i)return t;const n=r.replace(i,"");let l=oz.has(e)?1:0;return i!==r&&(l*=100),e+"("+l+n+")"}const lz=/\b([a-z-]*)\(.*?\)/gu,Zw={...Dd,getAnimatableNone:t=>{const e=t.match(lz);return e?e.map(az).join(" "):t}},i3={...Eg,transform:Math.round},cz={rotate:Td,rotateX:Td,rotateY:Td,rotateZ:Td,scale:N0,scaleX:N0,scaleY:N0,scaleZ:N0,skew:Td,skewX:Td,skewY:Td,distance:Ir,translateX:Ir,translateY:Ir,translateZ:Ir,x:Ir,y:Ir,z:Ir,perspective:Ir,transformPerspective:Ir,opacity:dy,originX:HS,originY:HS,originZ:Ir},qE={borderWidth:Ir,borderTopWidth:Ir,borderRightWidth:Ir,borderBottomWidth:Ir,borderLeftWidth:Ir,borderRadius:Ir,radius:Ir,borderTopLeftRadius:Ir,borderTopRightRadius:Ir,borderBottomRightRadius:Ir,borderBottomLeftRadius:Ir,width:Ir,maxWidth:Ir,height:Ir,maxHeight:Ir,top:Ir,right:Ir,bottom:Ir,left:Ir,padding:Ir,paddingTop:Ir,paddingRight:Ir,paddingBottom:Ir,paddingLeft:Ir,margin:Ir,marginTop:Ir,marginRight:Ir,marginBottom:Ir,marginLeft:Ir,backgroundPositionX:Ir,backgroundPositionY:Ir,...cz,zIndex:i3,fillOpacity:dy,strokeOpacity:dy,numOctaves:i3},uz={...qE,color:rs,backgroundColor:rs,outlineColor:rs,fill:rs,stroke:rs,borderColor:rs,borderTopColor:rs,borderRightColor:rs,borderBottomColor:rs,borderLeftColor:rs,filter:Zw,WebkitFilter:Zw},P5=t=>uz[t];function R5(t,e){let r=P5(t);return r!==Zw&&(r=Dd),r.getAnimatableNone?r.getAnimatableNone(e):void 0}const hz=new Set(["auto","none","0"]);function dz(t,e,r){let i=0,n;for(;i<t.length&&!n;){const l=t[i];typeof l=="string"&&!hz.has(l)&&fy(l).values.length&&(n=t[i]),i++}if(n&&r)for(const l of e)t[l]=R5(r,n)}class fz extends $E{constructor(e,r,i,n,l){super(e,r,i,n,l,!0)}readKeyframes(){const{unresolvedKeyframes:e,element:r,name:i}=this;if(!r||!r.current)return;super.readKeyframes();for(let m=0;m<e.length;m++){let b=e[m];if(typeof b=="string"&&(b=b.trim(),NE(b))){const A=A5(b,r.current);A!==void 0&&(e[m]=A),m===e.length-1&&(this.finalKeyframe=b)}}if(this.resolveNoneKeyframes(),!T5.has(i)||e.length!==2)return;const[n,l]=e,c=r3(n),o=r3(l);if(c!==o)if(JS(c)&&JS(o))for(let m=0;m<e.length;m++){const b=e[m];typeof b=="string"&&(e[m]=parseFloat(b))}else Ep[i]&&(this.needsMeasurement=!0)}resolveNoneKeyframes(){const{unresolvedKeyframes:e,name:r}=this,i=[];for(let n=0;n<e.length;n++)(e[n]===null||sz(e[n]))&&i.push(n);i.length&&dz(e,i,r)}measureInitialState(){const{element:e,unresolvedKeyframes:r,name:i}=this;if(!e||!e.current)return;i==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=Ep[i](e.measureViewportBox(),window.getComputedStyle(e.current)),r[0]=this.measuredOrigin;const n=r[r.length-1];n!==void 0&&e.getValue(i,n).jump(n,!1)}measureEndState(){const{element:e,name:r,unresolvedKeyframes:i}=this;if(!e||!e.current)return;const n=e.getValue(r);n&&n.jump(this.measuredOrigin,!1);const l=i.length-1,c=i[l];i[l]=Ep[r](e.measureViewportBox(),window.getComputedStyle(e.current)),c!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=c),this.removedTransforms?.length&&this.removedTransforms.forEach(([o,m])=>{e.getValue(o).set(m)}),this.resolveNoneKeyframes()}}function pz(t,e,r){if(t instanceof EventTarget)return[t];if(typeof t=="string"){let i=document;const n=r?.[t]??i.querySelectorAll(t);return n?Array.from(n):[]}return Array.from(t)}const M5=(t,e)=>e&&typeof t=="number"?e.transform(t):t;function I5(t){return qI(t)&&"offsetHeight"in t}const n3=30,mz=t=>!isNaN(parseFloat(t));class gz{constructor(e,r={}){this.canTrackVelocity=null,this.events={},this.updateAndNotify=i=>{const n=ba.now();if(this.updatedAt!==n&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(i),this.current!==this.prev&&(this.events.change?.notify(this.current),this.dependents))for(const l of this.dependents)l.dirty()},this.hasAnimated=!1,this.setCurrent(e),this.owner=r.owner}setCurrent(e){this.current=e,this.updatedAt=ba.now(),this.canTrackVelocity===null&&e!==void 0&&(this.canTrackVelocity=mz(this.current))}setPrevFrameValue(e=this.current){this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt}onChange(e){return this.on("change",e)}on(e,r){this.events[e]||(this.events[e]=new BE);const i=this.events[e].add(r);return e==="change"?()=>{i(),un.read(()=>{this.events.change.getSize()||this.stop()})}:i}clearListeners(){for(const e in this.events)this.events[e].clear()}attach(e,r){this.passiveEffect=e,this.stopPassiveEffect=r}set(e){this.passiveEffect?this.passiveEffect(e,this.updateAndNotify):this.updateAndNotify(e)}setWithVelocity(e,r,i){this.set(r),this.prev=void 0,this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt-i}jump(e,r=!0){this.updateAndNotify(e),this.prev=e,this.prevUpdatedAt=this.prevFrameValue=void 0,r&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}dirty(){this.events.change?.notify(this.current)}addDependent(e){this.dependents||(this.dependents=new Set),this.dependents.add(e)}removeDependent(e){this.dependents&&this.dependents.delete(e)}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const e=ba.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||e-this.updatedAt>n3)return 0;const r=Math.min(this.updatedAt-this.prevUpdatedAt,n3);return ZI(parseFloat(this.current)-parseFloat(this.prevFrameValue),r)}start(e){return this.stop(),new Promise(r=>{this.hasAnimated=!0,this.animation=e(r),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.dependents?.clear(),this.events.destroy?.notify(),this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function og(t,e){return new gz(t,e)}const{schedule:KE}=o5(queueMicrotask,!1),_c={x:!1,y:!1};function k5(){return _c.x||_c.y}function _z(t){return t==="x"||t==="y"?_c[t]?null:(_c[t]=!0,()=>{_c[t]=!1}):_c.x||_c.y?null:(_c.x=_c.y=!0,()=>{_c.x=_c.y=!1})}function B5(t,e){const r=pz(t),i=new AbortController,n={passive:!0,...e,signal:i.signal};return[r,n,()=>i.abort()]}function s3(t){return!(t.pointerType==="touch"||k5())}function yz(t,e,r={}){const[i,n,l]=B5(t,r),c=o=>{if(!s3(o))return;const{target:m}=o,b=e(m,o);if(typeof b!="function"||!m)return;const A=R=>{s3(R)&&(b(R),m.removeEventListener("pointerleave",A))};m.addEventListener("pointerleave",A,n)};return i.forEach(o=>{o.addEventListener("pointerenter",c,n)}),l}const L5=(t,e)=>e?t===e?!0:L5(t,e.parentElement):!1,ZE=t=>t.pointerType==="mouse"?typeof t.button!="number"||t.button<=0:t.isPrimary!==!1,vz=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function bz(t){return vz.has(t.tagName)||t.tabIndex!==-1}const Dv=new WeakSet;function o3(t){return e=>{e.key==="Enter"&&t(e)}}function Qb(t,e){t.dispatchEvent(new PointerEvent("pointer"+e,{isPrimary:!0,bubbles:!0}))}const xz=(t,e)=>{const r=t.currentTarget;if(!r)return;const i=o3(()=>{if(Dv.has(r))return;Qb(r,"down");const n=o3(()=>{Qb(r,"up")}),l=()=>Qb(r,"cancel");r.addEventListener("keyup",n,e),r.addEventListener("blur",l,e)});r.addEventListener("keydown",i,e),r.addEventListener("blur",()=>r.removeEventListener("keydown",i),e)};function a3(t){return ZE(t)&&!k5()}function wz(t,e,r={}){const[i,n,l]=B5(t,r),c=o=>{const m=o.currentTarget;if(!a3(o))return;Dv.add(m);const b=e(m,o),A=(L,G)=>{window.removeEventListener("pointerup",R),window.removeEventListener("pointercancel",M),Dv.has(m)&&Dv.delete(m),a3(L)&&typeof b=="function"&&b(L,{success:G})},R=L=>{A(L,m===window||m===document||r.useGlobalTarget||L5(m,L.target))},M=L=>{A(L,!1)};window.addEventListener("pointerup",R,n),window.addEventListener("pointercancel",M,n)};return i.forEach(o=>{(r.useGlobalTarget?window:o).addEventListener("pointerdown",c,n),I5(o)&&(o.addEventListener("focus",b=>xz(b,n)),!bz(o)&&!o.hasAttribute("tabindex")&&(o.tabIndex=0))}),l}function O5(t){return qI(t)&&"ownerSVGElement"in t}function Ez(t){return O5(t)&&t.tagName==="svg"}const So=t=>!!(t&&t.getVelocity),Az=[...C5,rs,Dd],Tz=t=>Az.find(S5(t)),XE=Z.createContext({transformPagePoint:t=>t,isStatic:!1,reducedMotion:"never"});function l3(t,e){if(typeof t=="function")return t(e);t!=null&&(t.current=e)}function Sz(...t){return e=>{let r=!1;const i=t.map(n=>{const l=l3(n,e);return!r&&typeof l=="function"&&(r=!0),l});if(r)return()=>{for(let n=0;n<i.length;n++){const l=i[n];typeof l=="function"?l():l3(t[n],null)}}}}function Cz(...t){return Z.useCallback(Sz(...t),t)}class Pz extends Z.Component{getSnapshotBeforeUpdate(e){const r=this.props.childRef.current;if(r&&e.isPresent&&!this.props.isPresent){const i=r.offsetParent,n=I5(i)&&i.offsetWidth||0,l=this.props.sizeRef.current;l.height=r.offsetHeight||0,l.width=r.offsetWidth||0,l.top=r.offsetTop,l.left=r.offsetLeft,l.right=n-l.width-l.left}return null}componentDidUpdate(){}render(){return this.props.children}}function Rz({children:t,isPresent:e,anchorX:r,root:i}){const n=Z.useId(),l=Z.useRef(null),c=Z.useRef({width:0,height:0,top:0,left:0,right:0}),{nonce:o}=Z.useContext(XE),m=Cz(l,t?.ref);return Z.useInsertionEffect(()=>{const{width:b,height:A,top:R,left:M,right:L}=c.current;if(e||!l.current||!b||!A)return;const G=r==="left"?`left: ${M}`:`right: ${L}`;l.current.dataset.motionPopId=n;const V=document.createElement("style");o&&(V.nonce=o);const q=i??document.head;return q.appendChild(V),V.sheet&&V.sheet.insertRule(`
          [data-motion-pop-id="${n}"] {
            position: absolute !important;
            width: ${b}px !important;
            height: ${A}px !important;
            ${G}px !important;
            top: ${R}px !important;
          }
        `),()=>{q.contains(V)&&q.removeChild(V)}},[e]),j.jsx(Pz,{isPresent:e,childRef:l,sizeRef:c,children:Z.cloneElement(t,{ref:m})})}const Mz=({children:t,initial:e,isPresent:r,onExitComplete:i,custom:n,presenceAffectsLayout:l,mode:c,anchorX:o,root:m})=>{const b=CE(Iz),A=Z.useId();let R=!0,M=Z.useMemo(()=>(R=!1,{id:A,initial:e,isPresent:r,custom:n,onExitComplete:L=>{b.set(L,!0);for(const G of b.values())if(!G)return;i&&i()},register:L=>(b.set(L,!1),()=>b.delete(L))}),[r,b,i]);return l&&R&&(M={...M}),Z.useMemo(()=>{b.forEach((L,G)=>b.set(G,!1))},[r]),Z.useEffect(()=>{!r&&!b.size&&i&&i()},[r]),c==="popLayout"&&(t=j.jsx(Rz,{isPresent:r,anchorX:o,root:m,children:t})),j.jsx(N1.Provider,{value:M,children:t})};function Iz(){return new Map}function D5(t=!0){const e=Z.useContext(N1);if(e===null)return[!0,null];const{isPresent:r,onExitComplete:i,register:n}=e,l=Z.useId();Z.useEffect(()=>{if(t)return n(l)},[t]);const c=Z.useCallback(()=>t&&i&&i(l),[l,i,t]);return!r&&i?[!1,c]:[!0]}const F0=t=>t.key||"";function c3(t){const e=[];return Z.Children.forEach(t,r=>{Z.isValidElement(r)&&e.push(r)}),e}const kz=({children:t,custom:e,initial:r=!0,onExitComplete:i,presenceAffectsLayout:n=!0,mode:l="sync",propagate:c=!1,anchorX:o="left",root:m})=>{const[b,A]=D5(c),R=Z.useMemo(()=>c3(t),[t]),M=c&&!b?[]:R.map(F0),L=Z.useRef(!0),G=Z.useRef(R),V=CE(()=>new Map),[q,J]=Z.useState(R),[ie,ee]=Z.useState(R);$I(()=>{L.current=!1,G.current=R;for(let Me=0;Me<ie.length;Me++){const Ve=F0(ie[Me]);M.includes(Ve)?V.delete(Ve):V.get(Ve)!==!0&&V.set(Ve,!1)}},[ie,M.length,M.join("-")]);const me=[];if(R!==q){let Me=[...R];for(let Ve=0;Ve<ie.length;Ve++){const Be=ie[Ve],$e=F0(Be);M.includes($e)||(Me.splice(Ve,0,Be),me.push(Be))}return l==="wait"&&me.length&&(Me=me),ee(c3(Me)),J(R),null}const{forceRender:Se}=Z.useContext(SE);return j.jsx(j.Fragment,{children:ie.map(Me=>{const Ve=F0(Me),Be=c&&!b?!1:R===ie||M.includes(Ve),$e=()=>{if(V.has(Ve))V.set(Ve,!0);else return;let at=!0;V.forEach(_t=>{_t||(at=!1)}),at&&(Se?.(),ee(G.current),c&&A?.(),i&&i())};return j.jsx(Mz,{isPresent:Be,initial:!L.current||r?void 0:!1,custom:e,presenceAffectsLayout:n,mode:l,root:m,onExitComplete:Be?void 0:$e,anchorX:o,children:Me},Ve)})})},N5=Z.createContext({strict:!1}),u3={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},ag={};for(const t in u3)ag[t]={isEnabled:e=>u3[t].some(r=>!!e[r])};function Bz(t){for(const e in t)ag[e]={...ag[e],...t[e]}}const Lz=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function Qv(t){return t.startsWith("while")||t.startsWith("drag")&&t!=="draggable"||t.startsWith("layout")||t.startsWith("onTap")||t.startsWith("onPan")||t.startsWith("onLayout")||Lz.has(t)}let F5=t=>!Qv(t);function Oz(t){typeof t=="function"&&(F5=e=>e.startsWith("on")?!Qv(e):t(e))}try{Oz(require("@emotion/is-prop-valid").default)}catch{}function Dz(t,e,r){const i={};for(const n in t)n==="values"&&typeof t.values=="object"||(F5(n)||r===!0&&Qv(n)||!e&&!Qv(n)||t.draggable&&n.startsWith("onDrag"))&&(i[n]=t[n]);return i}const F1=Z.createContext({});function z1(t){return t!==null&&typeof t=="object"&&typeof t.start=="function"}function py(t){return typeof t=="string"||Array.isArray(t)}const YE=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],JE=["initial",...YE];function j1(t){return z1(t.animate)||JE.some(e=>py(t[e]))}function z5(t){return!!(j1(t)||t.variants)}function Nz(t,e){if(j1(t)){const{initial:r,animate:i}=t;return{initial:r===!1||py(r)?r:void 0,animate:py(i)?i:void 0}}return t.inherit!==!1?e:{}}function Fz(t){const{initial:e,animate:r}=Nz(t,Z.useContext(F1));return Z.useMemo(()=>({initial:e,animate:r}),[h3(e),h3(r)])}function h3(t){return Array.isArray(t)?t.join(" "):t}const my={};function zz(t){for(const e in t)my[e]=t[e],DE(e)&&(my[e].isCSSVariable=!0)}function j5(t,{layout:e,layoutId:r}){return Tg.has(t)||t.startsWith("origin")||(e||r!==void 0)&&(!!my[t]||t==="opacity")}const jz={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},Uz=Ag.length;function Vz(t,e,r){let i="",n=!0;for(let l=0;l<Uz;l++){const c=Ag[l],o=t[c];if(o===void 0)continue;let m=!0;if(typeof o=="number"?m=o===(c.startsWith("scale")?1:0):m=parseFloat(o)===0,!m||r){const b=M5(o,qE[c]);if(!m){n=!1;const A=jz[c]||c;i+=`${A}(${b}) `}r&&(e[c]=b)}}return i=i.trim(),r?i=r(e,n?"":i):n&&(i="none"),i}function QE(t,e,r){const{style:i,vars:n,transformOrigin:l}=t;let c=!1,o=!1;for(const m in e){const b=e[m];if(Tg.has(m)){c=!0;continue}else if(DE(m)){n[m]=b;continue}else{const A=M5(b,qE[m]);m.startsWith("origin")?(o=!0,l[m]=A):i[m]=A}}if(e.transform||(c||r?i.transform=Vz(e,t.transform,r):i.transform&&(i.transform="none")),o){const{originX:m="50%",originY:b="50%",originZ:A=0}=l;i.transformOrigin=`${m} ${b} ${A}`}}const eA=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function U5(t,e,r){for(const i in e)!So(e[i])&&!j5(i,r)&&(t[i]=e[i])}function Gz({transformTemplate:t},e){return Z.useMemo(()=>{const r=eA();return QE(r,e,t),Object.assign({},r.vars,r.style)},[e])}function Hz(t,e){const r=t.style||{},i={};return U5(i,r,t),Object.assign(i,Gz(t,e)),i}function $z(t,e){const r={},i=Hz(t,e);return t.drag&&t.dragListener!==!1&&(r.draggable=!1,i.userSelect=i.WebkitUserSelect=i.WebkitTouchCallout="none",i.touchAction=t.drag===!0?"none":`pan-${t.drag==="x"?"y":"x"}`),t.tabIndex===void 0&&(t.onTap||t.onTapStart||t.whileTap)&&(r.tabIndex=0),r.style=i,r}const Wz={offset:"stroke-dashoffset",array:"stroke-dasharray"},qz={offset:"strokeDashoffset",array:"strokeDasharray"};function Kz(t,e,r=1,i=0,n=!0){t.pathLength=1;const l=n?Wz:qz;t[l.offset]=Ir.transform(-i);const c=Ir.transform(e),o=Ir.transform(r);t[l.array]=`${c} ${o}`}function V5(t,{attrX:e,attrY:r,attrScale:i,pathLength:n,pathSpacing:l=1,pathOffset:c=0,...o},m,b,A){if(QE(t,o,b),m){t.style.viewBox&&(t.attrs.viewBox=t.style.viewBox);return}t.attrs=t.style,t.style={};const{attrs:R,style:M}=t;R.transform&&(M.transform=R.transform,delete R.transform),(M.transform||R.transformOrigin)&&(M.transformOrigin=R.transformOrigin??"50% 50%",delete R.transformOrigin),M.transform&&(M.transformBox=A?.transformBox??"fill-box",delete R.transformBox),e!==void 0&&(R.x=e),r!==void 0&&(R.y=r),i!==void 0&&(R.scale=i),n!==void 0&&Kz(R,n,l,c,!1)}const G5=()=>({...eA(),attrs:{}}),H5=t=>typeof t=="string"&&t.toLowerCase()==="svg";function Zz(t,e,r,i){const n=Z.useMemo(()=>{const l=G5();return V5(l,e,H5(i),t.transformTemplate,t.style),{...l.attrs,style:{...l.style}}},[e]);if(t.style){const l={};U5(l,t.style,t),n.style={...l,...n.style}}return n}const Xz=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function tA(t){return typeof t!="string"||t.includes("-")?!1:!!(Xz.indexOf(t)>-1||/[A-Z]/u.test(t))}function Yz(t,e,r,{latestValues:i},n,l=!1){const o=(tA(t)?Zz:$z)(e,i,n,t),m=Dz(e,typeof t=="string",l),b=t!==Z.Fragment?{...m,...o,ref:r}:{},{children:A}=e,R=Z.useMemo(()=>So(A)?A.get():A,[A]);return Z.createElement(t,{...b,children:R})}function d3(t){const e=[{},{}];return t?.values.forEach((r,i)=>{e[0][i]=r.get(),e[1][i]=r.getVelocity()}),e}function rA(t,e,r,i){if(typeof e=="function"){const[n,l]=d3(i);e=e(r!==void 0?r:t.custom,n,l)}if(typeof e=="string"&&(e=t.variants&&t.variants[e]),typeof e=="function"){const[n,l]=d3(i);e=e(r!==void 0?r:t.custom,n,l)}return e}function Nv(t){return So(t)?t.get():t}function Jz({scrapeMotionValuesFromProps:t,createRenderState:e},r,i,n){return{latestValues:Qz(r,i,n,t),renderState:e()}}function Qz(t,e,r,i){const n={},l=i(t,{});for(const M in l)n[M]=Nv(l[M]);let{initial:c,animate:o}=t;const m=j1(t),b=z5(t);e&&b&&!m&&t.inherit!==!1&&(c===void 0&&(c=e.initial),o===void 0&&(o=e.animate));let A=r?r.initial===!1:!1;A=A||c===!1;const R=A?o:c;if(R&&typeof R!="boolean"&&!z1(R)){const M=Array.isArray(R)?R:[R];for(let L=0;L<M.length;L++){const G=rA(t,M[L]);if(G){const{transitionEnd:V,transition:q,...J}=G;for(const ie in J){let ee=J[ie];if(Array.isArray(ee)){const me=A?ee.length-1:0;ee=ee[me]}ee!==null&&(n[ie]=ee)}for(const ie in V)n[ie]=V[ie]}}}return n}const $5=t=>(e,r)=>{const i=Z.useContext(F1),n=Z.useContext(N1),l=()=>Jz(t,e,i,n);return r?l():CE(l)};function iA(t,e,r){const{style:i}=t,n={};for(const l in i)(So(i[l])||e.style&&So(e.style[l])||j5(l,t)||r?.getValue(l)?.liveStyle!==void 0)&&(n[l]=i[l]);return n}const ej=$5({scrapeMotionValuesFromProps:iA,createRenderState:eA});function W5(t,e,r){const i=iA(t,e,r);for(const n in t)if(So(t[n])||So(e[n])){const l=Ag.indexOf(n)!==-1?"attr"+n.charAt(0).toUpperCase()+n.substring(1):n;i[l]=t[n]}return i}const tj=$5({scrapeMotionValuesFromProps:W5,createRenderState:G5}),rj=Symbol.for("motionComponentSymbol");function Nm(t){return t&&typeof t=="object"&&Object.prototype.hasOwnProperty.call(t,"current")}function ij(t,e,r){return Z.useCallback(i=>{i&&t.onMount&&t.onMount(i),e&&(i?e.mount(i):e.unmount()),r&&(typeof r=="function"?r(i):Nm(r)&&(r.current=i))},[e])}const nA=t=>t.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),nj="framerAppearId",q5="data-"+nA(nj),K5=Z.createContext({});function sj(t,e,r,i,n){const{visualElement:l}=Z.useContext(F1),c=Z.useContext(N5),o=Z.useContext(N1),m=Z.useContext(XE).reducedMotion,b=Z.useRef(null);i=i||c.renderer,!b.current&&i&&(b.current=i(t,{visualState:e,parent:l,props:r,presenceContext:o,blockInitialAnimation:o?o.initial===!1:!1,reducedMotionConfig:m}));const A=b.current,R=Z.useContext(K5);A&&!A.projection&&n&&(A.type==="html"||A.type==="svg")&&oj(b.current,r,n,R);const M=Z.useRef(!1);Z.useInsertionEffect(()=>{A&&M.current&&A.update(r,o)});const L=r[q5],G=Z.useRef(!!L&&!window.MotionHandoffIsComplete?.(L)&&window.MotionHasOptimisedAnimation?.(L));return $I(()=>{A&&(M.current=!0,window.MotionIsMounted=!0,A.updateFeatures(),A.scheduleRenderMicrotask(),G.current&&A.animationState&&A.animationState.animateChanges())}),Z.useEffect(()=>{A&&(!G.current&&A.animationState&&A.animationState.animateChanges(),G.current&&(queueMicrotask(()=>{window.MotionHandoffMarkAsComplete?.(L)}),G.current=!1),A.enteringChildren=void 0)}),A}function oj(t,e,r,i){const{layoutId:n,layout:l,drag:c,dragConstraints:o,layoutScroll:m,layoutRoot:b,layoutCrossfade:A}=e;t.projection=new r(t.latestValues,e["data-framer-portal-id"]?void 0:Z5(t.parent)),t.projection.setOptions({layoutId:n,layout:l,alwaysMeasureLayout:!!c||o&&Nm(o),visualElement:t,animationType:typeof l=="string"?l:"both",initialPromotionConfig:i,crossfade:A,layoutScroll:m,layoutRoot:b})}function Z5(t){if(t)return t.options.allowProjection!==!1?t.projection:Z5(t.parent)}function ex(t,{forwardMotionProps:e=!1}={},r,i){r&&Bz(r);const n=tA(t)?tj:ej;function l(o,m){let b;const A={...Z.useContext(XE),...o,layoutId:aj(o)},{isStatic:R}=A,M=Fz(o),L=n(o,R);if(!R&&PE){lj();const G=cj(A);b=G.MeasureLayout,M.visualElement=sj(t,L,A,i,G.ProjectionNode)}return j.jsxs(F1.Provider,{value:M,children:[b&&M.visualElement?j.jsx(b,{visualElement:M.visualElement,...A}):null,Yz(t,o,ij(L,M.visualElement,m),L,R,e)]})}l.displayName=`motion.${typeof t=="string"?t:`create(${t.displayName??t.name??""})`}`;const c=Z.forwardRef(l);return c[rj]=t,c}function aj({layoutId:t}){const e=Z.useContext(SE).id;return e&&t!==void 0?e+"-"+t:t}function lj(t,e){Z.useContext(N5).strict}function cj(t){const{drag:e,layout:r}=ag;if(!e&&!r)return{};const i={...e,...r};return{MeasureLayout:e?.isEnabled(t)||r?.isEnabled(t)?i.MeasureLayout:void 0,ProjectionNode:i.ProjectionNode}}function uj(t,e){if(typeof Proxy>"u")return ex;const r=new Map,i=(l,c)=>ex(l,c,t,e),n=(l,c)=>i(l,c);return new Proxy(n,{get:(l,c)=>c==="create"?i:(r.has(c)||r.set(c,ex(c,void 0,t,e)),r.get(c))})}function X5({top:t,left:e,right:r,bottom:i}){return{x:{min:e,max:r},y:{min:t,max:i}}}function hj({x:t,y:e}){return{top:e.min,right:t.max,bottom:e.max,left:t.min}}function dj(t,e){if(!e)return t;const r=e({x:t.left,y:t.top}),i=e({x:t.right,y:t.bottom});return{top:r.y,left:r.x,bottom:i.y,right:i.x}}function tx(t){return t===void 0||t===1}function Xw({scale:t,scaleX:e,scaleY:r}){return!tx(t)||!tx(e)||!tx(r)}function lp(t){return Xw(t)||Y5(t)||t.z||t.rotate||t.rotateX||t.rotateY||t.skewX||t.skewY}function Y5(t){return f3(t.x)||f3(t.y)}function f3(t){return t&&t!=="0%"}function e1(t,e,r){const i=t-r,n=e*i;return r+n}function p3(t,e,r,i,n){return n!==void 0&&(t=e1(t,n,i)),e1(t,r,i)+e}function Yw(t,e=0,r=1,i,n){t.min=p3(t.min,e,r,i,n),t.max=p3(t.max,e,r,i,n)}function J5(t,{x:e,y:r}){Yw(t.x,e.translate,e.scale,e.originPoint),Yw(t.y,r.translate,r.scale,r.originPoint)}const m3=.999999999999,g3=1.0000000000001;function fj(t,e,r,i=!1){const n=r.length;if(!n)return;e.x=e.y=1;let l,c;for(let o=0;o<n;o++){l=r[o],c=l.projectionDelta;const{visualElement:m}=l.options;m&&m.props.style&&m.props.style.display==="contents"||(i&&l.options.layoutScroll&&l.scroll&&l!==l.root&&zm(t,{x:-l.scroll.offset.x,y:-l.scroll.offset.y}),c&&(e.x*=c.x.scale,e.y*=c.y.scale,J5(t,c)),i&&lp(l.latestValues)&&zm(t,l.latestValues))}e.x<g3&&e.x>m3&&(e.x=1),e.y<g3&&e.y>m3&&(e.y=1)}function Fm(t,e){t.min=t.min+e,t.max=t.max+e}function _3(t,e,r,i,n=.5){const l=En(t.min,t.max,n);Yw(t,e,r,l,i)}function zm(t,e){_3(t.x,e.x,e.scaleX,e.scale,e.originX),_3(t.y,e.y,e.scaleY,e.scale,e.originY)}function Q5(t,e){return X5(dj(t.getBoundingClientRect(),e))}function pj(t,e,r){const i=Q5(t,r),{scroll:n}=e;return n&&(Fm(i.x,n.offset.x),Fm(i.y,n.offset.y)),i}const y3=()=>({translate:0,scale:1,origin:0,originPoint:0}),jm=()=>({x:y3(),y:y3()}),v3=()=>({min:0,max:0}),$n=()=>({x:v3(),y:v3()}),Jw={current:null},ek={current:!1};function mj(){if(ek.current=!0,!!PE)if(window.matchMedia){const t=window.matchMedia("(prefers-reduced-motion)"),e=()=>Jw.current=t.matches;t.addEventListener("change",e),e()}else Jw.current=!1}const gj=new WeakMap;function _j(t,e,r){for(const i in e){const n=e[i],l=r[i];if(So(n))t.addValue(i,n);else if(So(l))t.addValue(i,og(n,{owner:t}));else if(l!==n)if(t.hasValue(i)){const c=t.getValue(i);c.liveStyle===!0?c.jump(n):c.hasAnimated||c.set(n)}else{const c=t.getStaticValue(i);t.addValue(i,og(c!==void 0?c:n,{owner:t}))}}for(const i in r)e[i]===void 0&&t.removeValue(i);return e}const b3=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class yj{scrapeMotionValuesFromProps(e,r,i){return{}}constructor({parent:e,props:r,presenceContext:i,reducedMotionConfig:n,blockInitialAnimation:l,visualState:c},o={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=$E,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const M=ba.now();this.renderScheduledAt<M&&(this.renderScheduledAt=M,un.render(this.render,!1,!0))};const{latestValues:m,renderState:b}=c;this.latestValues=m,this.baseTarget={...m},this.initialValues=r.initial?{...m}:{},this.renderState=b,this.parent=e,this.props=r,this.presenceContext=i,this.depth=e?e.depth+1:0,this.reducedMotionConfig=n,this.options=o,this.blockInitialAnimation=!!l,this.isControllingVariants=j1(r),this.isVariantNode=z5(r),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(e&&e.current);const{willChange:A,...R}=this.scrapeMotionValuesFromProps(r,{},this);for(const M in R){const L=R[M];m[M]!==void 0&&So(L)&&L.set(m[M])}}mount(e){this.current=e,gj.set(e,this),this.projection&&!this.projection.instance&&this.projection.mount(e),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((r,i)=>this.bindToMotionValue(i,r)),ek.current||mj(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:Jw.current,this.parent?.addChild(this),this.update(this.props,this.presenceContext)}unmount(){this.projection&&this.projection.unmount(),Od(this.notifyUpdate),Od(this.render),this.valueSubscriptions.forEach(e=>e()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent?.removeChild(this);for(const e in this.events)this.events[e].clear();for(const e in this.features){const r=this.features[e];r&&(r.unmount(),r.isMounted=!1)}this.current=null}addChild(e){this.children.add(e),this.enteringChildren??(this.enteringChildren=new Set),this.enteringChildren.add(e)}removeChild(e){this.children.delete(e),this.enteringChildren&&this.enteringChildren.delete(e)}bindToMotionValue(e,r){this.valueSubscriptions.has(e)&&this.valueSubscriptions.get(e)();const i=Tg.has(e);i&&this.onBindTransform&&this.onBindTransform();const n=r.on("change",c=>{this.latestValues[e]=c,this.props.onUpdate&&un.preRender(this.notifyUpdate),i&&this.projection&&(this.projection.isTransformDirty=!0),this.scheduleRender()});let l;window.MotionCheckAppearSync&&(l=window.MotionCheckAppearSync(this,e,r)),this.valueSubscriptions.set(e,()=>{n(),l&&l(),r.owner&&r.stop()})}sortNodePosition(e){return!this.current||!this.sortInstanceNodePosition||this.type!==e.type?0:this.sortInstanceNodePosition(this.current,e.current)}updateFeatures(){let e="animation";for(e in ag){const r=ag[e];if(!r)continue;const{isEnabled:i,Feature:n}=r;if(!this.features[e]&&n&&i(this.props)&&(this.features[e]=new n(this)),this.features[e]){const l=this.features[e];l.isMounted?l.update():(l.mount(),l.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):$n()}getStaticValue(e){return this.latestValues[e]}setStaticValue(e,r){this.latestValues[e]=r}update(e,r){(e.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=e,this.prevPresenceContext=this.presenceContext,this.presenceContext=r;for(let i=0;i<b3.length;i++){const n=b3[i];this.propEventSubscriptions[n]&&(this.propEventSubscriptions[n](),delete this.propEventSubscriptions[n]);const l="on"+n,c=e[l];c&&(this.propEventSubscriptions[n]=this.on(n,c))}this.prevMotionValues=_j(this,this.scrapeMotionValuesFromProps(e,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(e){return this.props.variants?this.props.variants[e]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(e){const r=this.getClosestVariantNode();if(r)return r.variantChildren&&r.variantChildren.add(e),()=>r.variantChildren.delete(e)}addValue(e,r){const i=this.values.get(e);r!==i&&(i&&this.removeValue(e),this.bindToMotionValue(e,r),this.values.set(e,r),this.latestValues[e]=r.get())}removeValue(e){this.values.delete(e);const r=this.valueSubscriptions.get(e);r&&(r(),this.valueSubscriptions.delete(e)),delete this.latestValues[e],this.removeValueFromRenderState(e,this.renderState)}hasValue(e){return this.values.has(e)}getValue(e,r){if(this.props.values&&this.props.values[e])return this.props.values[e];let i=this.values.get(e);return i===void 0&&r!==void 0&&(i=og(r===null?void 0:r,{owner:this}),this.addValue(e,i)),i}readValue(e,r){let i=this.latestValues[e]!==void 0||!this.current?this.latestValues[e]:this.getBaseTargetFromProps(this.props,e)??this.readValueFromInstance(this.current,e,this.options);return i!=null&&(typeof i=="string"&&(WI(i)||KI(i))?i=parseFloat(i):!Tz(i)&&Dd.test(r)&&(i=R5(e,r)),this.setBaseTarget(e,So(i)?i.get():i)),So(i)?i.get():i}setBaseTarget(e,r){this.baseTarget[e]=r}getBaseTarget(e){const{initial:r}=this.props;let i;if(typeof r=="string"||typeof r=="object"){const l=rA(this.props,r,this.presenceContext?.custom);l&&(i=l[e])}if(r&&i!==void 0)return i;const n=this.getBaseTargetFromProps(this.props,e);return n!==void 0&&!So(n)?n:this.initialValues[e]!==void 0&&i===void 0?void 0:this.baseTarget[e]}on(e,r){return this.events[e]||(this.events[e]=new BE),this.events[e].add(r)}notify(e,...r){this.events[e]&&this.events[e].notify(...r)}scheduleRenderMicrotask(){KE.render(this.render)}}class tk extends yj{constructor(){super(...arguments),this.KeyframeResolver=fz}sortInstanceNodePosition(e,r){return e.compareDocumentPosition(r)&2?1:-1}getBaseTargetFromProps(e,r){return e.style?e.style[r]:void 0}removeValueFromRenderState(e,{vars:r,style:i}){delete r[e],delete i[e]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:e}=this.props;So(e)&&(this.childSubscription=e.on("change",r=>{this.current&&(this.current.textContent=`${r}`)}))}}function rk(t,{style:e,vars:r},i,n){const l=t.style;let c;for(c in e)l[c]=e[c];n?.applyProjectionStyles(l,i);for(c in r)l.setProperty(c,r[c])}function vj(t){return window.getComputedStyle(t)}class bj extends tk{constructor(){super(...arguments),this.type="html",this.renderInstance=rk}readValueFromInstance(e,r){if(Tg.has(r))return this.projection?.isProjecting?Gw(r):k9(e,r);{const i=vj(e),n=(DE(r)?i.getPropertyValue(r):i[r])||0;return typeof n=="string"?n.trim():n}}measureInstanceViewportBox(e,{transformPagePoint:r}){return Q5(e,r)}build(e,r,i){QE(e,r,i.transformTemplate)}scrapeMotionValuesFromProps(e,r,i){return iA(e,r,i)}}const ik=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function xj(t,e,r,i){rk(t,e,void 0,i);for(const n in e.attrs)t.setAttribute(ik.has(n)?n:nA(n),e.attrs[n])}class wj extends tk{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=$n}getBaseTargetFromProps(e,r){return e[r]}readValueFromInstance(e,r){if(Tg.has(r)){const i=P5(r);return i&&i.default||0}return r=ik.has(r)?r:nA(r),e.getAttribute(r)}scrapeMotionValuesFromProps(e,r,i){return W5(e,r,i)}build(e,r,i){V5(e,r,this.isSVGTag,i.transformTemplate,i.style)}renderInstance(e,r,i,n){xj(e,r,i,n)}mount(e){this.isSVGTag=H5(e.tagName),super.mount(e)}}const Ej=(t,e)=>tA(t)?new wj(e):new bj(e,{allowProjection:t!==Z.Fragment});function Zm(t,e,r){const i=t.getProps();return rA(i,e,r!==void 0?r:i.custom,t)}const Qw=t=>Array.isArray(t);function Aj(t,e,r){t.hasValue(e)?t.getValue(e).set(r):t.addValue(e,og(r))}function Tj(t){return Qw(t)?t[t.length-1]||0:t}function Sj(t,e){const r=Zm(t,e);let{transitionEnd:i={},transition:n={},...l}=r||{};l={...l,...i};for(const c in l){const o=Tj(l[c]);Aj(t,c,o)}}function Cj(t){return!!(So(t)&&t.add)}function e2(t,e){const r=t.getValue("willChange");if(Cj(r))return r.add(e);if(!r&&Rh.WillChange){const i=new Rh.WillChange("auto");t.addValue("willChange",i),i.add(e)}}function nk(t){return t.props[q5]}const Pj=t=>t!==null;function Rj(t,{repeat:e,repeatType:r="loop"},i){const n=t.filter(Pj),l=e&&r!=="loop"&&e%2===1?0:n.length-1;return n[l]}const Mj={type:"spring",stiffness:500,damping:25,restSpeed:10},Ij=t=>({type:"spring",stiffness:550,damping:t===0?2*Math.sqrt(550):30,restSpeed:10}),kj={type:"keyframes",duration:.8},Bj={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},Lj=(t,{keyframes:e})=>e.length>2?kj:Tg.has(t)?t.startsWith("scale")?Ij(e[1]):Mj:Bj;function Oj({when:t,delay:e,delayChildren:r,staggerChildren:i,staggerDirection:n,repeat:l,repeatType:c,repeatDelay:o,from:m,elapsed:b,...A}){return!!Object.keys(A).length}const sA=(t,e,r,i={},n,l)=>c=>{const o=WE(i,t)||{},m=o.delay||i.delay||0;let{elapsed:b=0}=i;b=b-Pu(m);const A={keyframes:Array.isArray(r)?r:[null,r],ease:"easeOut",velocity:e.getVelocity(),...o,delay:-b,onUpdate:M=>{e.set(M),o.onUpdate&&o.onUpdate(M)},onComplete:()=>{c(),o.onComplete&&o.onComplete()},name:t,motionValue:e,element:l?void 0:n};Oj(o)||Object.assign(A,Lj(t,A)),A.duration&&(A.duration=Pu(A.duration)),A.repeatDelay&&(A.repeatDelay=Pu(A.repeatDelay)),A.from!==void 0&&(A.keyframes[0]=A.from);let R=!1;if((A.type===!1||A.duration===0&&!A.repeatDelay)&&(Kw(A),A.delay===0&&(R=!0)),(Rh.instantAnimations||Rh.skipAnimations)&&(R=!0,Kw(A),A.delay=0),A.allowFlatten=!o.type&&!o.ease,R&&!l&&e.get()!==void 0){const M=Rj(A.keyframes,o);if(M!==void 0){un.update(()=>{A.onUpdate(M),A.onComplete()});return}}return o.isSync?new HE(A):new tz(A)};function Dj({protectedKeys:t,needsAnimating:e},r){const i=t.hasOwnProperty(r)&&e[r]!==!0;return e[r]=!1,i}function sk(t,e,{delay:r=0,transitionOverride:i,type:n}={}){let{transition:l=t.getDefaultTransition(),transitionEnd:c,...o}=e;i&&(l=i);const m=[],b=n&&t.animationState&&t.animationState.getState()[n];for(const A in o){const R=t.getValue(A,t.latestValues[A]??null),M=o[A];if(M===void 0||b&&Dj(b,A))continue;const L={delay:r,...WE(l||{},A)},G=R.get();if(G!==void 0&&!R.isAnimating&&!Array.isArray(M)&&M===G&&!L.velocity)continue;let V=!1;if(window.MotionHandoffAnimation){const J=nk(t);if(J){const ie=window.MotionHandoffAnimation(J,A,un);ie!==null&&(L.startTime=ie,V=!0)}}e2(t,A),R.start(sA(A,R,M,t.shouldReduceMotion&&T5.has(A)?{type:!1}:L,t,V));const q=R.animation;q&&m.push(q)}return c&&Promise.all(m).then(()=>{un.update(()=>{c&&Sj(t,c)})}),m}function ok(t,e,r,i=0,n=1){const l=Array.from(t).sort((b,A)=>b.sortNodePosition(A)).indexOf(e),c=t.size,o=(c-1)*i;return typeof r=="function"?r(l,c):n===1?l*i:o-l*i}function t2(t,e,r={}){const i=Zm(t,e,r.type==="exit"?t.presenceContext?.custom:void 0);let{transition:n=t.getDefaultTransition()||{}}=i||{};r.transitionOverride&&(n=r.transitionOverride);const l=i?()=>Promise.all(sk(t,i,r)):()=>Promise.resolve(),c=t.variantChildren&&t.variantChildren.size?(m=0)=>{const{delayChildren:b=0,staggerChildren:A,staggerDirection:R}=n;return Nj(t,e,m,b,A,R,r)}:()=>Promise.resolve(),{when:o}=n;if(o){const[m,b]=o==="beforeChildren"?[l,c]:[c,l];return m().then(()=>b())}else return Promise.all([l(),c(r.delay)])}function Nj(t,e,r=0,i=0,n=0,l=1,c){const o=[];for(const m of t.variantChildren)m.notify("AnimationStart",e),o.push(t2(m,e,{...c,delay:r+(typeof i=="function"?0:i)+ok(t.variantChildren,m,i,n,l)}).then(()=>m.notify("AnimationComplete",e)));return Promise.all(o)}function Fj(t,e,r={}){t.notify("AnimationStart",e);let i;if(Array.isArray(e)){const n=e.map(l=>t2(t,l,r));i=Promise.all(n)}else if(typeof e=="string")i=t2(t,e,r);else{const n=typeof e=="function"?Zm(t,e,r.custom):e;i=Promise.all(sk(t,n,r))}return i.then(()=>{t.notify("AnimationComplete",e)})}function ak(t,e){if(!Array.isArray(e))return!1;const r=e.length;if(r!==t.length)return!1;for(let i=0;i<r;i++)if(e[i]!==t[i])return!1;return!0}const zj=JE.length;function lk(t){if(!t)return;if(!t.isControllingVariants){const r=t.parent?lk(t.parent)||{}:{};return t.props.initial!==void 0&&(r.initial=t.props.initial),r}const e={};for(let r=0;r<zj;r++){const i=JE[r],n=t.props[i];(py(n)||n===!1)&&(e[i]=n)}return e}const jj=[...YE].reverse(),Uj=YE.length;function Vj(t){return e=>Promise.all(e.map(({animation:r,options:i})=>Fj(t,r,i)))}function Gj(t){let e=Vj(t),r=x3(),i=!0;const n=m=>(b,A)=>{const R=Zm(t,A,m==="exit"?t.presenceContext?.custom:void 0);if(R){const{transition:M,transitionEnd:L,...G}=R;b={...b,...G,...L}}return b};function l(m){e=m(t)}function c(m){const{props:b}=t,A=lk(t.parent)||{},R=[],M=new Set;let L={},G=1/0;for(let q=0;q<Uj;q++){const J=jj[q],ie=r[J],ee=b[J]!==void 0?b[J]:A[J],me=py(ee),Se=J===m?ie.isActive:null;Se===!1&&(G=q);let Me=ee===A[J]&&ee!==b[J]&&me;if(Me&&i&&t.manuallyAnimateOnMount&&(Me=!1),ie.protectedKeys={...L},!ie.isActive&&Se===null||!ee&&!ie.prevProp||z1(ee)||typeof ee=="boolean")continue;const Ve=Hj(ie.prevProp,ee);let Be=Ve||J===m&&ie.isActive&&!Me&&me||q>G&&me,$e=!1;const at=Array.isArray(ee)?ee:[ee];let _t=at.reduce(n(J),{});Se===!1&&(_t={});const{prevResolvedValues:Nt={}}=ie,sr={...Nt,..._t},Ft=At=>{Be=!0,M.has(At)&&($e=!0,M.delete(At)),ie.needsAnimating[At]=!0;const Ke=t.getValue(At);Ke&&(Ke.liveStyle=!1)};for(const At in sr){const Ke=_t[At],ft=Nt[At];if(L.hasOwnProperty(At))continue;let Tt=!1;Qw(Ke)&&Qw(ft)?Tt=!ak(Ke,ft):Tt=Ke!==ft,Tt?Ke!=null?Ft(At):M.add(At):Ke!==void 0&&M.has(At)?Ft(At):ie.protectedKeys[At]=!0}ie.prevProp=ee,ie.prevResolvedValues=_t,ie.isActive&&(L={...L,..._t}),i&&t.blockInitialAnimation&&(Be=!1);const Ut=Me&&Ve;Be&&(!Ut||$e)&&R.push(...at.map(At=>{const Ke={type:J};if(typeof At=="string"&&i&&!Ut&&t.manuallyAnimateOnMount&&t.parent){const{parent:ft}=t,Tt=Zm(ft,At);if(ft.enteringChildren&&Tt){const{delayChildren:ze}=Tt.transition||{};Ke.delay=ok(ft.enteringChildren,t,ze)}}return{animation:At,options:Ke}}))}if(M.size){const q={};if(typeof b.initial!="boolean"){const J=Zm(t,Array.isArray(b.initial)?b.initial[0]:b.initial);J&&J.transition&&(q.transition=J.transition)}M.forEach(J=>{const ie=t.getBaseTarget(J),ee=t.getValue(J);ee&&(ee.liveStyle=!0),q[J]=ie??null}),R.push({animation:q})}let V=!!R.length;return i&&(b.initial===!1||b.initial===b.animate)&&!t.manuallyAnimateOnMount&&(V=!1),i=!1,V?e(R):Promise.resolve()}function o(m,b){if(r[m].isActive===b)return Promise.resolve();t.variantChildren?.forEach(R=>R.animationState?.setActive(m,b)),r[m].isActive=b;const A=c(m);for(const R in r)r[R].protectedKeys={};return A}return{animateChanges:c,setActive:o,setAnimateFunction:l,getState:()=>r,reset:()=>{r=x3()}}}function Hj(t,e){return typeof e=="string"?e!==t:Array.isArray(e)?!ak(e,t):!1}function tp(t=!1){return{isActive:t,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function x3(){return{animate:tp(!0),whileInView:tp(),whileHover:tp(),whileTap:tp(),whileDrag:tp(),whileFocus:tp(),exit:tp()}}class Hd{constructor(e){this.isMounted=!1,this.node=e}update(){}}class $j extends Hd{constructor(e){super(e),e.animationState||(e.animationState=Gj(e))}updateAnimationControlsSubscription(){const{animate:e}=this.node.getProps();z1(e)&&(this.unmountControls=e.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:e}=this.node.getProps(),{animate:r}=this.node.prevProps||{};e!==r&&this.updateAnimationControlsSubscription()}unmount(){this.node.animationState.reset(),this.unmountControls?.()}}let Wj=0;class qj extends Hd{constructor(){super(...arguments),this.id=Wj++}update(){if(!this.node.presenceContext)return;const{isPresent:e,onExitComplete:r}=this.node.presenceContext,{isPresent:i}=this.node.prevPresenceContext||{};if(!this.node.animationState||e===i)return;const n=this.node.animationState.setActive("exit",!e);r&&!e&&n.then(()=>{r(this.id)})}mount(){const{register:e,onExitComplete:r}=this.node.presenceContext||{};r&&r(this.id),e&&(this.unmount=e(this.id))}unmount(){}}const Kj={animation:{Feature:$j},exit:{Feature:qj}};function gy(t,e,r,i={passive:!0}){return t.addEventListener(e,r,i),()=>t.removeEventListener(e,r)}function Dy(t){return{point:{x:t.pageX,y:t.pageY}}}const Zj=t=>e=>ZE(e)&&t(e,Dy(e));function Y_(t,e,r,i){return gy(t,e,Zj(r),i)}const ck=1e-4,Xj=1-ck,Yj=1+ck,uk=.01,Jj=0-uk,Qj=0+uk;function Qo(t){return t.max-t.min}function eU(t,e,r){return Math.abs(t-e)<=r}function w3(t,e,r,i=.5){t.origin=i,t.originPoint=En(e.min,e.max,t.origin),t.scale=Qo(r)/Qo(e),t.translate=En(r.min,r.max,t.origin)-t.originPoint,(t.scale>=Xj&&t.scale<=Yj||isNaN(t.scale))&&(t.scale=1),(t.translate>=Jj&&t.translate<=Qj||isNaN(t.translate))&&(t.translate=0)}function J_(t,e,r,i){w3(t.x,e.x,r.x,i?i.originX:void 0),w3(t.y,e.y,r.y,i?i.originY:void 0)}function E3(t,e,r){t.min=r.min+e.min,t.max=t.min+Qo(e)}function tU(t,e,r){E3(t.x,e.x,r.x),E3(t.y,e.y,r.y)}function A3(t,e,r){t.min=e.min-r.min,t.max=t.min+Qo(e)}function Q_(t,e,r){A3(t.x,e.x,r.x),A3(t.y,e.y,r.y)}function kl(t){return[t("x"),t("y")]}const hk=({current:t})=>t?t.ownerDocument.defaultView:null,T3=(t,e)=>Math.abs(t-e);function rU(t,e){const r=T3(t.x,e.x),i=T3(t.y,e.y);return Math.sqrt(r**2+i**2)}class dk{constructor(e,r,{transformPagePoint:i,contextWindow:n=window,dragSnapToOrigin:l=!1,distanceThreshold:c=3}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const M=ix(this.lastMoveEventInfo,this.history),L=this.startEvent!==null,G=rU(M.offset,{x:0,y:0})>=this.distanceThreshold;if(!L&&!G)return;const{point:V}=M,{timestamp:q}=oo;this.history.push({...V,timestamp:q});const{onStart:J,onMove:ie}=this.handlers;L||(J&&J(this.lastMoveEvent,M),this.startEvent=this.lastMoveEvent),ie&&ie(this.lastMoveEvent,M)},this.handlePointerMove=(M,L)=>{this.lastMoveEvent=M,this.lastMoveEventInfo=rx(L,this.transformPagePoint),un.update(this.updatePoint,!0)},this.handlePointerUp=(M,L)=>{this.end();const{onEnd:G,onSessionEnd:V,resumeAnimation:q}=this.handlers;if(this.dragSnapToOrigin&&q&&q(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const J=ix(M.type==="pointercancel"?this.lastMoveEventInfo:rx(L,this.transformPagePoint),this.history);this.startEvent&&G&&G(M,J),V&&V(M,J)},!ZE(e))return;this.dragSnapToOrigin=l,this.handlers=r,this.transformPagePoint=i,this.distanceThreshold=c,this.contextWindow=n||window;const o=Dy(e),m=rx(o,this.transformPagePoint),{point:b}=m,{timestamp:A}=oo;this.history=[{...b,timestamp:A}];const{onSessionStart:R}=r;R&&R(e,ix(m,this.history)),this.removeListeners=By(Y_(this.contextWindow,"pointermove",this.handlePointerMove),Y_(this.contextWindow,"pointerup",this.handlePointerUp),Y_(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(e){this.handlers=e}end(){this.removeListeners&&this.removeListeners(),Od(this.updatePoint)}}function rx(t,e){return e?{point:e(t.point)}:t}function S3(t,e){return{x:t.x-e.x,y:t.y-e.y}}function ix({point:t},e){return{point:t,delta:S3(t,fk(e)),offset:S3(t,iU(e)),velocity:nU(e,.1)}}function iU(t){return t[0]}function fk(t){return t[t.length-1]}function nU(t,e){if(t.length<2)return{x:0,y:0};let r=t.length-1,i=null;const n=fk(t);for(;r>=0&&(i=t[r],!(n.timestamp-i.timestamp>Pu(e)));)r--;if(!i)return{x:0,y:0};const l=Ol(n.timestamp-i.timestamp);if(l===0)return{x:0,y:0};const c={x:(n.x-i.x)/l,y:(n.y-i.y)/l};return c.x===1/0&&(c.x=0),c.y===1/0&&(c.y=0),c}function sU(t,{min:e,max:r},i){return e!==void 0&&t<e?t=i?En(e,t,i.min):Math.max(t,e):r!==void 0&&t>r&&(t=i?En(r,t,i.max):Math.min(t,r)),t}function C3(t,e,r){return{min:e!==void 0?t.min+e:void 0,max:r!==void 0?t.max+r-(t.max-t.min):void 0}}function oU(t,{top:e,left:r,bottom:i,right:n}){return{x:C3(t.x,r,n),y:C3(t.y,e,i)}}function P3(t,e){let r=e.min-t.min,i=e.max-t.max;return e.max-e.min<t.max-t.min&&([r,i]=[i,r]),{min:r,max:i}}function aU(t,e){return{x:P3(t.x,e.x),y:P3(t.y,e.y)}}function lU(t,e){let r=.5;const i=Qo(t),n=Qo(e);return n>i?r=hy(e.min,e.max-i,t.min):i>n&&(r=hy(t.min,t.max-n,e.min)),Ph(0,1,r)}function cU(t,e){const r={};return e.min!==void 0&&(r.min=e.min-t.min),e.max!==void 0&&(r.max=e.max-t.min),r}const r2=.35;function uU(t=r2){return t===!1?t=0:t===!0&&(t=r2),{x:R3(t,"left","right"),y:R3(t,"top","bottom")}}function R3(t,e,r){return{min:M3(t,e),max:M3(t,r)}}function M3(t,e){return typeof t=="number"?t:t[e]||0}const hU=new WeakMap;class dU{constructor(e){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=$n(),this.latestPointerEvent=null,this.latestPanInfo=null,this.visualElement=e}start(e,{snapToCursor:r=!1,distanceThreshold:i}={}){const{presenceContext:n}=this.visualElement;if(n&&n.isPresent===!1)return;const l=R=>{const{dragSnapToOrigin:M}=this.getProps();M?this.pauseAnimation():this.stopAnimation(),r&&this.snapToCursor(Dy(R).point)},c=(R,M)=>{const{drag:L,dragPropagation:G,onDragStart:V}=this.getProps();if(L&&!G&&(this.openDragLock&&this.openDragLock(),this.openDragLock=_z(L),!this.openDragLock))return;this.latestPointerEvent=R,this.latestPanInfo=M,this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),kl(J=>{let ie=this.getAxisMotionValue(J).get()||0;if(Ru.test(ie)){const{projection:ee}=this.visualElement;if(ee&&ee.layout){const me=ee.layout.layoutBox[J];me&&(ie=Qo(me)*(parseFloat(ie)/100))}}this.originPoint[J]=ie}),V&&un.postRender(()=>V(R,M)),e2(this.visualElement,"transform");const{animationState:q}=this.visualElement;q&&q.setActive("whileDrag",!0)},o=(R,M)=>{this.latestPointerEvent=R,this.latestPanInfo=M;const{dragPropagation:L,dragDirectionLock:G,onDirectionLock:V,onDrag:q}=this.getProps();if(!L&&!this.openDragLock)return;const{offset:J}=M;if(G&&this.currentDirection===null){this.currentDirection=fU(J),this.currentDirection!==null&&V&&V(this.currentDirection);return}this.updateAxis("x",M.point,J),this.updateAxis("y",M.point,J),this.visualElement.render(),q&&q(R,M)},m=(R,M)=>{this.latestPointerEvent=R,this.latestPanInfo=M,this.stop(R,M),this.latestPointerEvent=null,this.latestPanInfo=null},b=()=>kl(R=>this.getAnimationState(R)==="paused"&&this.getAxisMotionValue(R).animation?.play()),{dragSnapToOrigin:A}=this.getProps();this.panSession=new dk(e,{onSessionStart:l,onStart:c,onMove:o,onSessionEnd:m,resumeAnimation:b},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:A,distanceThreshold:i,contextWindow:hk(this.visualElement)})}stop(e,r){const i=e||this.latestPointerEvent,n=r||this.latestPanInfo,l=this.isDragging;if(this.cancel(),!l||!n||!i)return;const{velocity:c}=n;this.startAnimation(c);const{onDragEnd:o}=this.getProps();o&&un.postRender(()=>o(i,n))}cancel(){this.isDragging=!1;const{projection:e,animationState:r}=this.visualElement;e&&(e.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:i}=this.getProps();!i&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),r&&r.setActive("whileDrag",!1)}updateAxis(e,r,i){const{drag:n}=this.getProps();if(!i||!z0(e,n,this.currentDirection))return;const l=this.getAxisMotionValue(e);let c=this.originPoint[e]+i[e];this.constraints&&this.constraints[e]&&(c=sU(c,this.constraints[e],this.elastic[e])),l.set(c)}resolveConstraints(){const{dragConstraints:e,dragElastic:r}=this.getProps(),i=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):this.visualElement.projection?.layout,n=this.constraints;e&&Nm(e)?this.constraints||(this.constraints=this.resolveRefConstraints()):e&&i?this.constraints=oU(i.layoutBox,e):this.constraints=!1,this.elastic=uU(r),n!==this.constraints&&i&&this.constraints&&!this.hasMutatedConstraints&&kl(l=>{this.constraints!==!1&&this.getAxisMotionValue(l)&&(this.constraints[l]=cU(i.layoutBox[l],this.constraints[l]))})}resolveRefConstraints(){const{dragConstraints:e,onMeasureDragConstraints:r}=this.getProps();if(!e||!Nm(e))return!1;const i=e.current,{projection:n}=this.visualElement;if(!n||!n.layout)return!1;const l=pj(i,n.root,this.visualElement.getTransformPagePoint());let c=aU(n.layout.layoutBox,l);if(r){const o=r(hj(c));this.hasMutatedConstraints=!!o,o&&(c=X5(o))}return c}startAnimation(e){const{drag:r,dragMomentum:i,dragElastic:n,dragTransition:l,dragSnapToOrigin:c,onDragTransitionEnd:o}=this.getProps(),m=this.constraints||{},b=kl(A=>{if(!z0(A,r,this.currentDirection))return;let R=m&&m[A]||{};c&&(R={min:0,max:0});const M=n?200:1e6,L=n?40:1e7,G={type:"inertia",velocity:i?e[A]:0,bounceStiffness:M,bounceDamping:L,timeConstant:750,restDelta:1,restSpeed:10,...l,...R};return this.startAxisValueAnimation(A,G)});return Promise.all(b).then(o)}startAxisValueAnimation(e,r){const i=this.getAxisMotionValue(e);return e2(this.visualElement,e),i.start(sA(e,i,0,r,this.visualElement,!1))}stopAnimation(){kl(e=>this.getAxisMotionValue(e).stop())}pauseAnimation(){kl(e=>this.getAxisMotionValue(e).animation?.pause())}getAnimationState(e){return this.getAxisMotionValue(e).animation?.state}getAxisMotionValue(e){const r=`_drag${e.toUpperCase()}`,i=this.visualElement.getProps(),n=i[r];return n||this.visualElement.getValue(e,(i.initial?i.initial[e]:void 0)||0)}snapToCursor(e){kl(r=>{const{drag:i}=this.getProps();if(!z0(r,i,this.currentDirection))return;const{projection:n}=this.visualElement,l=this.getAxisMotionValue(r);if(n&&n.layout){const{min:c,max:o}=n.layout.layoutBox[r];l.set(e[r]-En(c,o,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:e,dragConstraints:r}=this.getProps(),{projection:i}=this.visualElement;if(!Nm(r)||!i||!this.constraints)return;this.stopAnimation();const n={x:0,y:0};kl(c=>{const o=this.getAxisMotionValue(c);if(o&&this.constraints!==!1){const m=o.get();n[c]=lU({min:m,max:m},this.constraints[c])}});const{transformTemplate:l}=this.visualElement.getProps();this.visualElement.current.style.transform=l?l({},""):"none",i.root&&i.root.updateScroll(),i.updateLayout(),this.resolveConstraints(),kl(c=>{if(!z0(c,e,null))return;const o=this.getAxisMotionValue(c),{min:m,max:b}=this.constraints[c];o.set(En(m,b,n[c]))})}addListeners(){if(!this.visualElement.current)return;hU.set(this.visualElement,this);const e=this.visualElement.current,r=Y_(e,"pointerdown",m=>{const{drag:b,dragListener:A=!0}=this.getProps();b&&A&&this.start(m)}),i=()=>{const{dragConstraints:m}=this.getProps();Nm(m)&&m.current&&(this.constraints=this.resolveRefConstraints())},{projection:n}=this.visualElement,l=n.addEventListener("measure",i);n&&!n.layout&&(n.root&&n.root.updateScroll(),n.updateLayout()),un.read(i);const c=gy(window,"resize",()=>this.scalePositionWithinConstraints()),o=n.addEventListener("didUpdate",(({delta:m,hasLayoutChanged:b})=>{this.isDragging&&b&&(kl(A=>{const R=this.getAxisMotionValue(A);R&&(this.originPoint[A]+=m[A].translate,R.set(R.get()+m[A].translate))}),this.visualElement.render())}));return()=>{c(),r(),l(),o&&o()}}getProps(){const e=this.visualElement.getProps(),{drag:r=!1,dragDirectionLock:i=!1,dragPropagation:n=!1,dragConstraints:l=!1,dragElastic:c=r2,dragMomentum:o=!0}=e;return{...e,drag:r,dragDirectionLock:i,dragPropagation:n,dragConstraints:l,dragElastic:c,dragMomentum:o}}}function z0(t,e,r){return(e===!0||e===t)&&(r===null||r===t)}function fU(t,e=10){let r=null;return Math.abs(t.y)>e?r="y":Math.abs(t.x)>e&&(r="x"),r}class pU extends Hd{constructor(e){super(e),this.removeGroupControls=zl,this.removeListeners=zl,this.controls=new dU(e)}mount(){const{dragControls:e}=this.node.getProps();e&&(this.removeGroupControls=e.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||zl}unmount(){this.removeGroupControls(),this.removeListeners()}}const I3=t=>(e,r)=>{t&&un.postRender(()=>t(e,r))};class mU extends Hd{constructor(){super(...arguments),this.removePointerDownListener=zl}onPointerDown(e){this.session=new dk(e,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:hk(this.node)})}createPanHandlers(){const{onPanSessionStart:e,onPanStart:r,onPan:i,onPanEnd:n}=this.node.getProps();return{onSessionStart:I3(e),onStart:I3(r),onMove:i,onEnd:(l,c)=>{delete this.session,n&&un.postRender(()=>n(l,c))}}}mount(){this.removePointerDownListener=Y_(this.node.current,"pointerdown",e=>this.onPointerDown(e))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const Fv={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function k3(t,e){return e.max===e.min?0:t/(e.max-e.min)*100}const T_={correct:(t,e)=>{if(!e.target)return t;if(typeof t=="string")if(Ir.test(t))t=parseFloat(t);else return t;const r=k3(t,e.target.x),i=k3(t,e.target.y);return`${r}% ${i}%`}},gU={correct:(t,{treeScale:e,projectionDelta:r})=>{const i=t,n=Dd.parse(t);if(n.length>5)return i;const l=Dd.createTransformer(t),c=typeof n[0]!="number"?1:0,o=r.x.scale*e.x,m=r.y.scale*e.y;n[0+c]/=o,n[1+c]/=m;const b=En(o,m,.5);return typeof n[2+c]=="number"&&(n[2+c]/=b),typeof n[3+c]=="number"&&(n[3+c]/=b),l(n)}};let nx=!1;class _U extends Z.Component{componentDidMount(){const{visualElement:e,layoutGroup:r,switchLayoutGroup:i,layoutId:n}=this.props,{projection:l}=e;zz(yU),l&&(r.group&&r.group.add(l),i&&i.register&&n&&i.register(l),nx&&l.root.didUpdate(),l.addEventListener("animationComplete",()=>{this.safeToRemove()}),l.setOptions({...l.options,onExitComplete:()=>this.safeToRemove()})),Fv.hasEverUpdated=!0}getSnapshotBeforeUpdate(e){const{layoutDependency:r,visualElement:i,drag:n,isPresent:l}=this.props,{projection:c}=i;return c&&(c.isPresent=l,nx=!0,n||e.layoutDependency!==r||r===void 0||e.isPresent!==l?c.willUpdate():this.safeToRemove(),e.isPresent!==l&&(l?c.promote():c.relegate()||un.postRender(()=>{const o=c.getStack();(!o||!o.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:e}=this.props.visualElement;e&&(e.root.didUpdate(),KE.postRender(()=>{!e.currentAnimation&&e.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:e,layoutGroup:r,switchLayoutGroup:i}=this.props,{projection:n}=e;nx=!0,n&&(n.scheduleCheckAfterUnmount(),r&&r.group&&r.group.remove(n),i&&i.deregister&&i.deregister(n))}safeToRemove(){const{safeToRemove:e}=this.props;e&&e()}render(){return null}}function pk(t){const[e,r]=D5(),i=Z.useContext(SE);return j.jsx(_U,{...t,layoutGroup:i,switchLayoutGroup:Z.useContext(K5),isPresent:e,safeToRemove:r})}const yU={borderRadius:{...T_,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:T_,borderTopRightRadius:T_,borderBottomLeftRadius:T_,borderBottomRightRadius:T_,boxShadow:gU};function vU(t,e,r){const i=So(t)?t:og(t);return i.start(sA("",i,e,r)),i.animation}const bU=(t,e)=>t.depth-e.depth;class xU{constructor(){this.children=[],this.isDirty=!1}add(e){RE(this.children,e),this.isDirty=!0}remove(e){ME(this.children,e),this.isDirty=!0}forEach(e){this.isDirty&&this.children.sort(bU),this.isDirty=!1,this.children.forEach(e)}}function wU(t,e){const r=ba.now(),i=({timestamp:n})=>{const l=n-r;l>=e&&(Od(i),t(l-e))};return un.setup(i,!0),()=>Od(i)}const mk=["TopLeft","TopRight","BottomLeft","BottomRight"],EU=mk.length,B3=t=>typeof t=="string"?parseFloat(t):t,L3=t=>typeof t=="number"||Ir.test(t);function AU(t,e,r,i,n,l){n?(t.opacity=En(0,r.opacity??1,TU(i)),t.opacityExit=En(e.opacity??1,0,SU(i))):l&&(t.opacity=En(e.opacity??1,r.opacity??1,i));for(let c=0;c<EU;c++){const o=`border${mk[c]}Radius`;let m=O3(e,o),b=O3(r,o);if(m===void 0&&b===void 0)continue;m||(m=0),b||(b=0),m===0||b===0||L3(m)===L3(b)?(t[o]=Math.max(En(B3(m),B3(b),i),0),(Ru.test(b)||Ru.test(m))&&(t[o]+="%")):t[o]=b}(e.rotate||r.rotate)&&(t.rotate=En(e.rotate||0,r.rotate||0,i))}function O3(t,e){return t[e]!==void 0?t[e]:t.borderRadius}const TU=gk(0,.5,r5),SU=gk(.5,.95,zl);function gk(t,e,r){return i=>i<t?0:i>e?1:r(hy(t,e,i))}function D3(t,e){t.min=e.min,t.max=e.max}function Il(t,e){D3(t.x,e.x),D3(t.y,e.y)}function N3(t,e){t.translate=e.translate,t.scale=e.scale,t.originPoint=e.originPoint,t.origin=e.origin}function F3(t,e,r,i,n){return t-=e,t=e1(t,1/r,i),n!==void 0&&(t=e1(t,1/n,i)),t}function CU(t,e=0,r=1,i=.5,n,l=t,c=t){if(Ru.test(e)&&(e=parseFloat(e),e=En(c.min,c.max,e/100)-c.min),typeof e!="number")return;let o=En(l.min,l.max,i);t===l&&(o-=e),t.min=F3(t.min,e,r,o,n),t.max=F3(t.max,e,r,o,n)}function z3(t,e,[r,i,n],l,c){CU(t,e[r],e[i],e[n],e.scale,l,c)}const PU=["x","scaleX","originX"],RU=["y","scaleY","originY"];function j3(t,e,r,i){z3(t.x,e,PU,r?r.x:void 0,i?i.x:void 0),z3(t.y,e,RU,r?r.y:void 0,i?i.y:void 0)}function U3(t){return t.translate===0&&t.scale===1}function _k(t){return U3(t.x)&&U3(t.y)}function V3(t,e){return t.min===e.min&&t.max===e.max}function MU(t,e){return V3(t.x,e.x)&&V3(t.y,e.y)}function G3(t,e){return Math.round(t.min)===Math.round(e.min)&&Math.round(t.max)===Math.round(e.max)}function yk(t,e){return G3(t.x,e.x)&&G3(t.y,e.y)}function H3(t){return Qo(t.x)/Qo(t.y)}function $3(t,e){return t.translate===e.translate&&t.scale===e.scale&&t.originPoint===e.originPoint}class IU{constructor(){this.members=[]}add(e){RE(this.members,e),e.scheduleRender()}remove(e){if(ME(this.members,e),e===this.prevLead&&(this.prevLead=void 0),e===this.lead){const r=this.members[this.members.length-1];r&&this.promote(r)}}relegate(e){const r=this.members.findIndex(n=>e===n);if(r===0)return!1;let i;for(let n=r;n>=0;n--){const l=this.members[n];if(l.isPresent!==!1){i=l;break}}return i?(this.promote(i),!0):!1}promote(e,r){const i=this.lead;if(e!==i&&(this.prevLead=i,this.lead=e,e.show(),i)){i.instance&&i.scheduleRender(),e.scheduleRender(),e.resumeFrom=i,r&&(e.resumeFrom.preserveOpacity=!0),i.snapshot&&(e.snapshot=i.snapshot,e.snapshot.latestValues=i.animationValues||i.latestValues),e.root&&e.root.isUpdating&&(e.isLayoutDirty=!0);const{crossfade:n}=e.options;n===!1&&i.hide()}}exitAnimationComplete(){this.members.forEach(e=>{const{options:r,resumingFrom:i}=e;r.onExitComplete&&r.onExitComplete(),i&&i.options.onExitComplete&&i.options.onExitComplete()})}scheduleRender(){this.members.forEach(e=>{e.instance&&e.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function kU(t,e,r){let i="";const n=t.x.translate/e.x,l=t.y.translate/e.y,c=r?.z||0;if((n||l||c)&&(i=`translate3d(${n}px, ${l}px, ${c}px) `),(e.x!==1||e.y!==1)&&(i+=`scale(${1/e.x}, ${1/e.y}) `),r){const{transformPerspective:b,rotate:A,rotateX:R,rotateY:M,skewX:L,skewY:G}=r;b&&(i=`perspective(${b}px) ${i}`),A&&(i+=`rotate(${A}deg) `),R&&(i+=`rotateX(${R}deg) `),M&&(i+=`rotateY(${M}deg) `),L&&(i+=`skewX(${L}deg) `),G&&(i+=`skewY(${G}deg) `)}const o=t.x.scale*e.x,m=t.y.scale*e.y;return(o!==1||m!==1)&&(i+=`scale(${o}, ${m})`),i||"none"}const sx=["","X","Y","Z"],BU=1e3;let LU=0;function ox(t,e,r,i){const{latestValues:n}=e;n[t]&&(r[t]=n[t],e.setStaticValue(t,0),i&&(i[t]=0))}function vk(t){if(t.hasCheckedOptimisedAppear=!0,t.root===t)return;const{visualElement:e}=t.options;if(!e)return;const r=nk(e);if(window.MotionHasOptimisedAnimation(r,"transform")){const{layout:n,layoutId:l}=t.options;window.MotionCancelOptimisedAnimation(r,"transform",un,!(n||l))}const{parent:i}=t;i&&!i.hasCheckedOptimisedAppear&&vk(i)}function bk({attachResizeListener:t,defaultParent:e,measureScroll:r,checkIsScrollRoot:i,resetTransform:n}){return class{constructor(c={},o=e?.()){this.id=LU++,this.animationId=0,this.animationCommitId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,this.nodes.forEach(NU),this.nodes.forEach(UU),this.nodes.forEach(VU),this.nodes.forEach(FU)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=c,this.root=o?o.root||o:this,this.path=o?[...o.path,o]:[],this.parent=o,this.depth=o?o.depth+1:0;for(let m=0;m<this.path.length;m++)this.path[m].shouldResetTransform=!0;this.root===this&&(this.nodes=new xU)}addEventListener(c,o){return this.eventHandlers.has(c)||this.eventHandlers.set(c,new BE),this.eventHandlers.get(c).add(o)}notifyListeners(c,...o){const m=this.eventHandlers.get(c);m&&m.notify(...o)}hasListeners(c){return this.eventHandlers.has(c)}mount(c){if(this.instance)return;this.isSVG=O5(c)&&!Ez(c),this.instance=c;const{layoutId:o,layout:m,visualElement:b}=this.options;if(b&&!b.current&&b.mount(c),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),this.root.hasTreeAnimated&&(m||o)&&(this.isLayoutDirty=!0),t){let A,R=0;const M=()=>this.root.updateBlockedByResize=!1;un.read(()=>{R=window.innerWidth}),t(c,()=>{const L=window.innerWidth;L!==R&&(R=L,this.root.updateBlockedByResize=!0,A&&A(),A=wU(M,250),Fv.hasAnimatedSinceResize&&(Fv.hasAnimatedSinceResize=!1,this.nodes.forEach(K3)))})}o&&this.root.registerSharedNode(o,this),this.options.animate!==!1&&b&&(o||m)&&this.addEventListener("didUpdate",({delta:A,hasLayoutChanged:R,hasRelativeLayoutChanged:M,layout:L})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const G=this.options.transition||b.getDefaultTransition()||qU,{onLayoutAnimationStart:V,onLayoutAnimationComplete:q}=b.getProps(),J=!this.targetLayout||!yk(this.targetLayout,L),ie=!R&&M;if(this.options.layoutRoot||this.resumeFrom||ie||R&&(J||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0);const ee={...WE(G,"layout"),onPlay:V,onComplete:q};(b.shouldReduceMotion||this.options.layoutRoot)&&(ee.delay=0,ee.type=!1),this.startAnimation(ee),this.setAnimationOrigin(A,ie)}else R||K3(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=L})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const c=this.getStack();c&&c.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,this.eventHandlers.clear(),Od(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(GU),this.animationId++)}getTransformTemplate(){const{visualElement:c}=this.options;return c&&c.getProps().transformTemplate}willUpdate(c=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&vk(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let A=0;A<this.path.length;A++){const R=this.path[A];R.shouldResetTransform=!0,R.updateScroll("snapshot"),R.options.layoutRoot&&R.willUpdate(!1)}const{layoutId:o,layout:m}=this.options;if(o===void 0&&!m)return;const b=this.getTransformTemplate();this.prevTransformTemplateValue=b?b(this.latestValues,""):void 0,this.updateSnapshot(),c&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(W3);return}if(this.animationId<=this.animationCommitId){this.nodes.forEach(q3);return}this.animationCommitId=this.animationId,this.isUpdating?(this.isUpdating=!1,this.nodes.forEach(jU),this.nodes.forEach(OU),this.nodes.forEach(DU)):this.nodes.forEach(q3),this.clearAllSnapshots();const o=ba.now();oo.delta=Ph(0,1e3/60,o-oo.timestamp),oo.timestamp=o,oo.isProcessing=!0,Kb.update.process(oo),Kb.preRender.process(oo),Kb.render.process(oo),oo.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,KE.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(zU),this.sharedNodes.forEach(HU)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,un.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){un.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure(),this.snapshot&&!Qo(this.snapshot.measuredBox.x)&&!Qo(this.snapshot.measuredBox.y)&&(this.snapshot=void 0))}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let m=0;m<this.path.length;m++)this.path[m].updateScroll();const c=this.layout;this.layout=this.measure(!1),this.layoutCorrected=$n(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:o}=this.options;o&&o.notify("LayoutMeasure",this.layout.layoutBox,c?c.layoutBox:void 0)}updateScroll(c="measure"){let o=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===c&&(o=!1),o&&this.instance){const m=i(this.instance);this.scroll={animationId:this.root.animationId,phase:c,isRoot:m,offset:r(this.instance),wasRoot:this.scroll?this.scroll.isRoot:m}}}resetTransform(){if(!n)return;const c=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,o=this.projectionDelta&&!_k(this.projectionDelta),m=this.getTransformTemplate(),b=m?m(this.latestValues,""):void 0,A=b!==this.prevTransformTemplateValue;c&&this.instance&&(o||lp(this.latestValues)||A)&&(n(this.instance,b),this.shouldResetTransform=!1,this.scheduleRender())}measure(c=!0){const o=this.measurePageBox();let m=this.removeElementScroll(o);return c&&(m=this.removeTransform(m)),KU(m),{animationId:this.root.animationId,measuredBox:o,layoutBox:m,latestValues:{},source:this.id}}measurePageBox(){const{visualElement:c}=this.options;if(!c)return $n();const o=c.measureViewportBox();if(!(this.scroll?.wasRoot||this.path.some(ZU))){const{scroll:b}=this.root;b&&(Fm(o.x,b.offset.x),Fm(o.y,b.offset.y))}return o}removeElementScroll(c){const o=$n();if(Il(o,c),this.scroll?.wasRoot)return o;for(let m=0;m<this.path.length;m++){const b=this.path[m],{scroll:A,options:R}=b;b!==this.root&&A&&R.layoutScroll&&(A.wasRoot&&Il(o,c),Fm(o.x,A.offset.x),Fm(o.y,A.offset.y))}return o}applyTransform(c,o=!1){const m=$n();Il(m,c);for(let b=0;b<this.path.length;b++){const A=this.path[b];!o&&A.options.layoutScroll&&A.scroll&&A!==A.root&&zm(m,{x:-A.scroll.offset.x,y:-A.scroll.offset.y}),lp(A.latestValues)&&zm(m,A.latestValues)}return lp(this.latestValues)&&zm(m,this.latestValues),m}removeTransform(c){const o=$n();Il(o,c);for(let m=0;m<this.path.length;m++){const b=this.path[m];if(!b.instance||!lp(b.latestValues))continue;Xw(b.latestValues)&&b.updateSnapshot();const A=$n(),R=b.measurePageBox();Il(A,R),j3(o,b.latestValues,b.snapshot?b.snapshot.layoutBox:void 0,A)}return lp(this.latestValues)&&j3(o,this.latestValues),o}setTargetDelta(c){this.targetDelta=c,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(c){this.options={...this.options,...c,crossfade:c.crossfade!==void 0?c.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==oo.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(c=!1){const o=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=o.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=o.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=o.isSharedProjectionDirty);const m=!!this.resumingFrom||this!==o;if(!(c||m&&this.isSharedProjectionDirty||this.isProjectionDirty||this.parent?.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:A,layoutId:R}=this.options;if(!(!this.layout||!(A||R))){if(this.resolvedRelativeTargetAt=oo.timestamp,!this.targetDelta&&!this.relativeTarget){const M=this.getClosestProjectingParent();M&&M.layout&&this.animationProgress!==1?(this.relativeParent=M,this.forceRelativeParentToResolveTarget(),this.relativeTarget=$n(),this.relativeTargetOrigin=$n(),Q_(this.relativeTargetOrigin,this.layout.layoutBox,M.layout.layoutBox),Il(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)&&(this.target||(this.target=$n(),this.targetWithTransforms=$n()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),tU(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):Il(this.target,this.layout.layoutBox),J5(this.target,this.targetDelta)):Il(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget)){this.attemptToResolveRelativeTarget=!1;const M=this.getClosestProjectingParent();M&&!!M.resumingFrom==!!this.resumingFrom&&!M.options.layoutScroll&&M.target&&this.animationProgress!==1?(this.relativeParent=M,this.forceRelativeParentToResolveTarget(),this.relativeTarget=$n(),this.relativeTargetOrigin=$n(),Q_(this.relativeTargetOrigin,this.target,M.target),Il(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}}}getClosestProjectingParent(){if(!(!this.parent||Xw(this.parent.latestValues)||Y5(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){const c=this.getLead(),o=!!this.resumingFrom||this!==c;let m=!0;if((this.isProjectionDirty||this.parent?.isProjectionDirty)&&(m=!1),o&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(m=!1),this.resolvedRelativeTargetAt===oo.timestamp&&(m=!1),m)return;const{layout:b,layoutId:A}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(b||A))return;Il(this.layoutCorrected,this.layout.layoutBox);const R=this.treeScale.x,M=this.treeScale.y;fj(this.layoutCorrected,this.treeScale,this.path,o),c.layout&&!c.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(c.target=c.layout.layoutBox,c.targetWithTransforms=$n());const{target:L}=c;if(!L){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(N3(this.prevProjectionDelta.x,this.projectionDelta.x),N3(this.prevProjectionDelta.y,this.projectionDelta.y)),J_(this.projectionDelta,this.layoutCorrected,L,this.latestValues),(this.treeScale.x!==R||this.treeScale.y!==M||!$3(this.projectionDelta.x,this.prevProjectionDelta.x)||!$3(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",L))}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(c=!0){if(this.options.visualElement?.scheduleRender(),c){const o=this.getStack();o&&o.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=jm(),this.projectionDelta=jm(),this.projectionDeltaWithTransform=jm()}setAnimationOrigin(c,o=!1){const m=this.snapshot,b=m?m.latestValues:{},A={...this.latestValues},R=jm();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!o;const M=$n(),L=m?m.source:void 0,G=this.layout?this.layout.source:void 0,V=L!==G,q=this.getStack(),J=!q||q.members.length<=1,ie=!!(V&&!J&&this.options.crossfade===!0&&!this.path.some(WU));this.animationProgress=0;let ee;this.mixTargetDelta=me=>{const Se=me/1e3;Z3(R.x,c.x,Se),Z3(R.y,c.y,Se),this.setTargetDelta(R),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(Q_(M,this.layout.layoutBox,this.relativeParent.layout.layoutBox),$U(this.relativeTarget,this.relativeTargetOrigin,M,Se),ee&&MU(this.relativeTarget,ee)&&(this.isProjectionDirty=!1),ee||(ee=$n()),Il(ee,this.relativeTarget)),V&&(this.animationValues=A,AU(A,b,this.latestValues,Se,ie,J)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=Se},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(c){this.notifyListeners("animationStart"),this.currentAnimation?.stop(),this.resumingFrom?.currentAnimation?.stop(),this.pendingAnimation&&(Od(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=un.update(()=>{Fv.hasAnimatedSinceResize=!0,this.motionValue||(this.motionValue=og(0)),this.currentAnimation=vU(this.motionValue,[0,1e3],{...c,velocity:0,isSync:!0,onUpdate:o=>{this.mixTargetDelta(o),c.onUpdate&&c.onUpdate(o)},onStop:()=>{},onComplete:()=>{c.onComplete&&c.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const c=this.getStack();c&&c.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(BU),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const c=this.getLead();let{targetWithTransforms:o,target:m,layout:b,latestValues:A}=c;if(!(!o||!m||!b)){if(this!==c&&this.layout&&b&&xk(this.options.animationType,this.layout.layoutBox,b.layoutBox)){m=this.target||$n();const R=Qo(this.layout.layoutBox.x);m.x.min=c.target.x.min,m.x.max=m.x.min+R;const M=Qo(this.layout.layoutBox.y);m.y.min=c.target.y.min,m.y.max=m.y.min+M}Il(o,m),zm(o,A),J_(this.projectionDeltaWithTransform,this.layoutCorrected,o,A)}}registerSharedNode(c,o){this.sharedNodes.has(c)||this.sharedNodes.set(c,new IU),this.sharedNodes.get(c).add(o);const b=o.options.initialPromotionConfig;o.promote({transition:b?b.transition:void 0,preserveFollowOpacity:b&&b.shouldPreserveFollowOpacity?b.shouldPreserveFollowOpacity(o):void 0})}isLead(){const c=this.getStack();return c?c.lead===this:!0}getLead(){const{layoutId:c}=this.options;return c?this.getStack()?.lead||this:this}getPrevLead(){const{layoutId:c}=this.options;return c?this.getStack()?.prevLead:void 0}getStack(){const{layoutId:c}=this.options;if(c)return this.root.sharedNodes.get(c)}promote({needsReset:c,transition:o,preserveFollowOpacity:m}={}){const b=this.getStack();b&&b.promote(this,m),c&&(this.projectionDelta=void 0,this.needsReset=!0),o&&this.setOptions({transition:o})}relegate(){const c=this.getStack();return c?c.relegate(this):!1}resetSkewAndRotation(){const{visualElement:c}=this.options;if(!c)return;let o=!1;const{latestValues:m}=c;if((m.z||m.rotate||m.rotateX||m.rotateY||m.rotateZ||m.skewX||m.skewY)&&(o=!0),!o)return;const b={};m.z&&ox("z",c,b,this.animationValues);for(let A=0;A<sx.length;A++)ox(`rotate${sx[A]}`,c,b,this.animationValues),ox(`skew${sx[A]}`,c,b,this.animationValues);c.render();for(const A in b)c.setStaticValue(A,b[A]),this.animationValues&&(this.animationValues[A]=b[A]);c.scheduleRender()}applyProjectionStyles(c,o){if(!this.instance||this.isSVG)return;if(!this.isVisible){c.visibility="hidden";return}const m=this.getTransformTemplate();if(this.needsReset){this.needsReset=!1,c.visibility="",c.opacity="",c.pointerEvents=Nv(o?.pointerEvents)||"",c.transform=m?m(this.latestValues,""):"none";return}const b=this.getLead();if(!this.projectionDelta||!this.layout||!b.target){this.options.layoutId&&(c.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,c.pointerEvents=Nv(o?.pointerEvents)||""),this.hasProjected&&!lp(this.latestValues)&&(c.transform=m?m({},""):"none",this.hasProjected=!1);return}c.visibility="";const A=b.animationValues||b.latestValues;this.applyTransformsToTarget();let R=kU(this.projectionDeltaWithTransform,this.treeScale,A);m&&(R=m(A,R)),c.transform=R;const{x:M,y:L}=this.projectionDelta;c.transformOrigin=`${M.origin*100}% ${L.origin*100}% 0`,b.animationValues?c.opacity=b===this?A.opacity??this.latestValues.opacity??1:this.preserveOpacity?this.latestValues.opacity:A.opacityExit:c.opacity=b===this?A.opacity!==void 0?A.opacity:"":A.opacityExit!==void 0?A.opacityExit:0;for(const G in my){if(A[G]===void 0)continue;const{correct:V,applyTo:q,isCSSVariable:J}=my[G],ie=R==="none"?A[G]:V(A[G],b);if(q){const ee=q.length;for(let me=0;me<ee;me++)c[q[me]]=ie}else J?this.options.visualElement.renderState.vars[G]=ie:c[G]=ie}this.options.layoutId&&(c.pointerEvents=b===this?Nv(o?.pointerEvents)||"":"none")}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(c=>c.currentAnimation?.stop()),this.root.nodes.forEach(W3),this.root.sharedNodes.clear()}}}function OU(t){t.updateLayout()}function DU(t){const e=t.resumeFrom?.snapshot||t.snapshot;if(t.isLead()&&t.layout&&e&&t.hasListeners("didUpdate")){const{layoutBox:r,measuredBox:i}=t.layout,{animationType:n}=t.options,l=e.source!==t.layout.source;n==="size"?kl(A=>{const R=l?e.measuredBox[A]:e.layoutBox[A],M=Qo(R);R.min=r[A].min,R.max=R.min+M}):xk(n,e.layoutBox,r)&&kl(A=>{const R=l?e.measuredBox[A]:e.layoutBox[A],M=Qo(r[A]);R.max=R.min+M,t.relativeTarget&&!t.currentAnimation&&(t.isProjectionDirty=!0,t.relativeTarget[A].max=t.relativeTarget[A].min+M)});const c=jm();J_(c,r,e.layoutBox);const o=jm();l?J_(o,t.applyTransform(i,!0),e.measuredBox):J_(o,r,e.layoutBox);const m=!_k(c);let b=!1;if(!t.resumeFrom){const A=t.getClosestProjectingParent();if(A&&!A.resumeFrom){const{snapshot:R,layout:M}=A;if(R&&M){const L=$n();Q_(L,e.layoutBox,R.layoutBox);const G=$n();Q_(G,r,M.layoutBox),yk(L,G)||(b=!0),A.options.layoutRoot&&(t.relativeTarget=G,t.relativeTargetOrigin=L,t.relativeParent=A)}}}t.notifyListeners("didUpdate",{layout:r,snapshot:e,delta:o,layoutDelta:c,hasLayoutChanged:m,hasRelativeLayoutChanged:b})}else if(t.isLead()){const{onExitComplete:r}=t.options;r&&r()}t.options.transition=void 0}function NU(t){t.parent&&(t.isProjecting()||(t.isProjectionDirty=t.parent.isProjectionDirty),t.isSharedProjectionDirty||(t.isSharedProjectionDirty=!!(t.isProjectionDirty||t.parent.isProjectionDirty||t.parent.isSharedProjectionDirty)),t.isTransformDirty||(t.isTransformDirty=t.parent.isTransformDirty))}function FU(t){t.isProjectionDirty=t.isSharedProjectionDirty=t.isTransformDirty=!1}function zU(t){t.clearSnapshot()}function W3(t){t.clearMeasurements()}function q3(t){t.isLayoutDirty=!1}function jU(t){const{visualElement:e}=t.options;e&&e.getProps().onBeforeLayoutMeasure&&e.notify("BeforeLayoutMeasure"),t.resetTransform()}function K3(t){t.finishAnimation(),t.targetDelta=t.relativeTarget=t.target=void 0,t.isProjectionDirty=!0}function UU(t){t.resolveTargetDelta()}function VU(t){t.calcProjection()}function GU(t){t.resetSkewAndRotation()}function HU(t){t.removeLeadSnapshot()}function Z3(t,e,r){t.translate=En(e.translate,0,r),t.scale=En(e.scale,1,r),t.origin=e.origin,t.originPoint=e.originPoint}function X3(t,e,r,i){t.min=En(e.min,r.min,i),t.max=En(e.max,r.max,i)}function $U(t,e,r,i){X3(t.x,e.x,r.x,i),X3(t.y,e.y,r.y,i)}function WU(t){return t.animationValues&&t.animationValues.opacityExit!==void 0}const qU={duration:.45,ease:[.4,0,.1,1]},Y3=t=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(t),J3=Y3("applewebkit/")&&!Y3("chrome/")?Math.round:zl;function Q3(t){t.min=J3(t.min),t.max=J3(t.max)}function KU(t){Q3(t.x),Q3(t.y)}function xk(t,e,r){return t==="position"||t==="preserve-aspect"&&!eU(H3(e),H3(r),.2)}function ZU(t){return t!==t.root&&t.scroll?.wasRoot}const XU=bk({attachResizeListener:(t,e)=>gy(t,"resize",e),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),ax={current:void 0},wk=bk({measureScroll:t=>({x:t.scrollLeft,y:t.scrollTop}),defaultParent:()=>{if(!ax.current){const t=new XU({});t.mount(window),t.setOptions({layoutScroll:!0}),ax.current=t}return ax.current},resetTransform:(t,e)=>{t.style.transform=e!==void 0?e:"none"},checkIsScrollRoot:t=>window.getComputedStyle(t).position==="fixed"}),YU={pan:{Feature:mU},drag:{Feature:pU,ProjectionNode:wk,MeasureLayout:pk}};function eC(t,e,r){const{props:i}=t;t.animationState&&i.whileHover&&t.animationState.setActive("whileHover",r==="Start");const n="onHover"+r,l=i[n];l&&un.postRender(()=>l(e,Dy(e)))}class JU extends Hd{mount(){const{current:e}=this.node;e&&(this.unmount=yz(e,(r,i)=>(eC(this.node,i,"Start"),n=>eC(this.node,n,"End"))))}unmount(){}}class QU extends Hd{constructor(){super(...arguments),this.isActive=!1}onFocus(){let e=!1;try{e=this.node.current.matches(":focus-visible")}catch{e=!0}!e||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=By(gy(this.node.current,"focus",()=>this.onFocus()),gy(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function tC(t,e,r){const{props:i}=t;if(t.current instanceof HTMLButtonElement&&t.current.disabled)return;t.animationState&&i.whileTap&&t.animationState.setActive("whileTap",r==="Start");const n="onTap"+(r==="End"?"":r),l=i[n];l&&un.postRender(()=>l(e,Dy(e)))}class e7 extends Hd{mount(){const{current:e}=this.node;e&&(this.unmount=wz(e,(r,i)=>(tC(this.node,i,"Start"),(n,{success:l})=>tC(this.node,n,l?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const i2=new WeakMap,lx=new WeakMap,t7=t=>{const e=i2.get(t.target);e&&e(t)},r7=t=>{t.forEach(t7)};function i7({root:t,...e}){const r=t||document;lx.has(r)||lx.set(r,{});const i=lx.get(r),n=JSON.stringify(e);return i[n]||(i[n]=new IntersectionObserver(r7,{root:t,...e})),i[n]}function n7(t,e,r){const i=i7(e);return i2.set(t,r),i.observe(t),()=>{i2.delete(t),i.unobserve(t)}}const s7={some:0,all:1};class o7 extends Hd{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:e={}}=this.node.getProps(),{root:r,margin:i,amount:n="some",once:l}=e,c={root:r?r.current:void 0,rootMargin:i,threshold:typeof n=="number"?n:s7[n]},o=m=>{const{isIntersecting:b}=m;if(this.isInView===b||(this.isInView=b,l&&!b&&this.hasEnteredView))return;b&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",b);const{onViewportEnter:A,onViewportLeave:R}=this.node.getProps(),M=b?A:R;M&&M(m)};return n7(this.node.current,c,o)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:e,prevProps:r}=this.node;["amount","margin","root"].some(a7(e,r))&&this.startObserver()}unmount(){}}function a7({viewport:t={}},{viewport:e={}}={}){return r=>t[r]!==e[r]}const l7={inView:{Feature:o7},tap:{Feature:e7},focus:{Feature:QU},hover:{Feature:JU}},c7={layout:{ProjectionNode:wk,MeasureLayout:pk}},u7={...Kj,...l7,...YU,...c7},U1=uj(u7,Ej);function xi(t,e,{checkForDefaultPrevented:r=!0}={}){return function(n){if(t?.(n),r===!1||!n.defaultPrevented)return e?.(n)}}function h7(t,e){const r=Z.createContext(e),i=l=>{const{children:c,...o}=l,m=Z.useMemo(()=>o,Object.values(o));return j.jsx(r.Provider,{value:m,children:c})};i.displayName=t+"Provider";function n(l){const c=Z.useContext(r);if(c)return c;if(e!==void 0)return e;throw new Error(`\`${l}\` must be used within \`${t}\``)}return[i,n]}function Sg(t,e=[]){let r=[];function i(l,c){const o=Z.createContext(c),m=r.length;r=[...r,c];const b=R=>{const{scope:M,children:L,...G}=R,V=M?.[t]?.[m]||o,q=Z.useMemo(()=>G,Object.values(G));return j.jsx(V.Provider,{value:q,children:L})};b.displayName=l+"Provider";function A(R,M){const L=M?.[t]?.[m]||o,G=Z.useContext(L);if(G)return G;if(c!==void 0)return c;throw new Error(`\`${R}\` must be used within \`${l}\``)}return[b,A]}const n=()=>{const l=r.map(c=>Z.createContext(c));return function(o){const m=o?.[t]||l;return Z.useMemo(()=>({[`__scope${t}`]:{...o,[t]:m}}),[o,m])}};return n.scopeName=t,[i,d7(n,...e)]}function d7(...t){const e=t[0];if(t.length===1)return e;const r=()=>{const i=t.map(n=>({useScope:n(),scopeName:n.scopeName}));return function(l){const c=i.reduce((o,{useScope:m,scopeName:b})=>{const R=m(l)[`__scope${b}`];return{...o,...R}},{});return Z.useMemo(()=>({[`__scope${e.scopeName}`]:c}),[c])}};return r.scopeName=e.scopeName,r}function rC(t,e){if(typeof t=="function")return t(e);t!=null&&(t.current=e)}function Ny(...t){return e=>{let r=!1;const i=t.map(n=>{const l=rC(n,e);return!r&&typeof l=="function"&&(r=!0),l});if(r)return()=>{for(let n=0;n<i.length;n++){const l=i[n];typeof l=="function"?l():rC(t[n],null)}}}}function Bn(...t){return Z.useCallback(Ny(...t),t)}function iC(t){const e=f7(t),r=Z.forwardRef((i,n)=>{const{children:l,...c}=i,o=Z.Children.toArray(l),m=o.find(m7);if(m){const b=m.props.children,A=o.map(R=>R===m?Z.Children.count(b)>1?Z.Children.only(null):Z.isValidElement(b)?b.props.children:null:R);return j.jsx(e,{...c,ref:n,children:Z.isValidElement(b)?Z.cloneElement(b,void 0,A):null})}return j.jsx(e,{...c,ref:n,children:l})});return r.displayName=`${t}.Slot`,r}function f7(t){const e=Z.forwardRef((r,i)=>{const{children:n,...l}=r;if(Z.isValidElement(n)){const c=_7(n),o=g7(l,n.props);return n.type!==Z.Fragment&&(o.ref=i?Ny(i,c):c),Z.cloneElement(n,o)}return Z.Children.count(n)>1?Z.Children.only(null):null});return e.displayName=`${t}.SlotClone`,e}var p7=Symbol("radix.slottable");function m7(t){return Z.isValidElement(t)&&typeof t.type=="function"&&"__radixId"in t.type&&t.type.__radixId===p7}function g7(t,e){const r={...e};for(const i in e){const n=t[i],l=e[i];/^on[A-Z]/.test(i)?n&&l?r[i]=(...o)=>{const m=l(...o);return n(...o),m}:n&&(r[i]=n):i==="style"?r[i]={...n,...l}:i==="className"&&(r[i]=[n,l].filter(Boolean).join(" "))}return{...t,...r}}function _7(t){let e=Object.getOwnPropertyDescriptor(t.props,"ref")?.get,r=e&&"isReactWarning"in e&&e.isReactWarning;return r?t.ref:(e=Object.getOwnPropertyDescriptor(t,"ref")?.get,r=e&&"isReactWarning"in e&&e.isReactWarning,r?t.props.ref:t.props.ref||t.ref)}function Ek(t){const e=t+"CollectionProvider",[r,i]=Sg(e),[n,l]=r(e,{collectionRef:{current:null},itemMap:new Map}),c=V=>{const{scope:q,children:J}=V,ie=Ad.useRef(null),ee=Ad.useRef(new Map).current;return j.jsx(n,{scope:q,itemMap:ee,collectionRef:ie,children:J})};c.displayName=e;const o=t+"CollectionSlot",m=iC(o),b=Ad.forwardRef((V,q)=>{const{scope:J,children:ie}=V,ee=l(o,J),me=Bn(q,ee.collectionRef);return j.jsx(m,{ref:me,children:ie})});b.displayName=o;const A=t+"CollectionItemSlot",R="data-radix-collection-item",M=iC(A),L=Ad.forwardRef((V,q)=>{const{scope:J,children:ie,...ee}=V,me=Ad.useRef(null),Se=Bn(q,me),Me=l(A,J);return Ad.useEffect(()=>(Me.itemMap.set(me,{ref:me,...ee}),()=>void Me.itemMap.delete(me))),j.jsx(M,{[R]:"",ref:Se,children:ie})});L.displayName=A;function G(V){const q=l(t+"CollectionConsumer",V);return Ad.useCallback(()=>{const ie=q.collectionRef.current;if(!ie)return[];const ee=Array.from(ie.querySelectorAll(`[${R}]`));return Array.from(q.itemMap.values()).sort((Me,Ve)=>ee.indexOf(Me.ref.current)-ee.indexOf(Ve.ref.current))},[q.collectionRef,q.itemMap])}return[{Provider:c,Slot:b,ItemSlot:L},G,i]}var Mu=globalThis?.document?Z.useLayoutEffect:()=>{},y7=gE[" useId ".trim().toString()]||(()=>{}),v7=0;function ey(t){const[e,r]=Z.useState(y7());return Mu(()=>{r(i=>i??String(v7++))},[t]),t||(e?`radix-${e}`:"")}function b7(t){const e=x7(t),r=Z.forwardRef((i,n)=>{const{children:l,...c}=i,o=Z.Children.toArray(l),m=o.find(E7);if(m){const b=m.props.children,A=o.map(R=>R===m?Z.Children.count(b)>1?Z.Children.only(null):Z.isValidElement(b)?b.props.children:null:R);return j.jsx(e,{...c,ref:n,children:Z.isValidElement(b)?Z.cloneElement(b,void 0,A):null})}return j.jsx(e,{...c,ref:n,children:l})});return r.displayName=`${t}.Slot`,r}function x7(t){const e=Z.forwardRef((r,i)=>{const{children:n,...l}=r;if(Z.isValidElement(n)){const c=T7(n),o=A7(l,n.props);return n.type!==Z.Fragment&&(o.ref=i?Ny(i,c):c),Z.cloneElement(n,o)}return Z.Children.count(n)>1?Z.Children.only(null):null});return e.displayName=`${t}.SlotClone`,e}var w7=Symbol("radix.slottable");function E7(t){return Z.isValidElement(t)&&typeof t.type=="function"&&"__radixId"in t.type&&t.type.__radixId===w7}function A7(t,e){const r={...e};for(const i in e){const n=t[i],l=e[i];/^on[A-Z]/.test(i)?n&&l?r[i]=(...o)=>{const m=l(...o);return n(...o),m}:n&&(r[i]=n):i==="style"?r[i]={...n,...l}:i==="className"&&(r[i]=[n,l].filter(Boolean).join(" "))}return{...t,...r}}function T7(t){let e=Object.getOwnPropertyDescriptor(t.props,"ref")?.get,r=e&&"isReactWarning"in e&&e.isReactWarning;return r?t.ref:(e=Object.getOwnPropertyDescriptor(t,"ref")?.get,r=e&&"isReactWarning"in e&&e.isReactWarning,r?t.props.ref:t.props.ref||t.ref)}var S7=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],nn=S7.reduce((t,e)=>{const r=b7(`Primitive.${e}`),i=Z.forwardRef((n,l)=>{const{asChild:c,...o}=n,m=c?r:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),j.jsx(m,{...o,ref:l})});return i.displayName=`Primitive.${e}`,{...t,[e]:i}},{});function C7(t,e){t&&LI.flushSync(()=>t.dispatchEvent(e))}function va(t){const e=Z.useRef(t);return Z.useEffect(()=>{e.current=t}),Z.useMemo(()=>(...r)=>e.current?.(...r),[])}var P7=gE[" useInsertionEffect ".trim().toString()]||Mu;function V1({prop:t,defaultProp:e,onChange:r=()=>{},caller:i}){const[n,l,c]=R7({defaultProp:e,onChange:r}),o=t!==void 0,m=o?t:n;{const A=Z.useRef(t!==void 0);Z.useEffect(()=>{const R=A.current;R!==o&&console.warn(`${i} is changing from ${R?"controlled":"uncontrolled"} to ${o?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),A.current=o},[o,i])}const b=Z.useCallback(A=>{if(o){const R=M7(A)?A(t):A;R!==t&&c.current?.(R)}else l(A)},[o,t,l,c]);return[m,b]}function R7({defaultProp:t,onChange:e}){const[r,i]=Z.useState(t),n=Z.useRef(r),l=Z.useRef(e);return P7(()=>{l.current=e},[e]),Z.useEffect(()=>{n.current!==r&&(l.current?.(r),n.current=r)},[r,n]),[r,i,l]}function M7(t){return typeof t=="function"}var I7=Z.createContext(void 0);function G1(t){const e=Z.useContext(I7);return t||e||"ltr"}var cx="rovingFocusGroup.onEntryFocus",k7={bubbles:!1,cancelable:!0},Fy="RovingFocusGroup",[n2,Ak,B7]=Ek(Fy),[L7,Tk]=Sg(Fy,[B7]),[O7,D7]=L7(Fy),Sk=Z.forwardRef((t,e)=>j.jsx(n2.Provider,{scope:t.__scopeRovingFocusGroup,children:j.jsx(n2.Slot,{scope:t.__scopeRovingFocusGroup,children:j.jsx(N7,{...t,ref:e})})}));Sk.displayName=Fy;var N7=Z.forwardRef((t,e)=>{const{__scopeRovingFocusGroup:r,orientation:i,loop:n=!1,dir:l,currentTabStopId:c,defaultCurrentTabStopId:o,onCurrentTabStopIdChange:m,onEntryFocus:b,preventScrollOnEntryFocus:A=!1,...R}=t,M=Z.useRef(null),L=Bn(e,M),G=G1(l),[V,q]=V1({prop:c,defaultProp:o??null,onChange:m,caller:Fy}),[J,ie]=Z.useState(!1),ee=va(b),me=Ak(r),Se=Z.useRef(!1),[Me,Ve]=Z.useState(0);return Z.useEffect(()=>{const Be=M.current;if(Be)return Be.addEventListener(cx,ee),()=>Be.removeEventListener(cx,ee)},[ee]),j.jsx(O7,{scope:r,orientation:i,dir:G,loop:n,currentTabStopId:V,onItemFocus:Z.useCallback(Be=>q(Be),[q]),onItemShiftTab:Z.useCallback(()=>ie(!0),[]),onFocusableItemAdd:Z.useCallback(()=>Ve(Be=>Be+1),[]),onFocusableItemRemove:Z.useCallback(()=>Ve(Be=>Be-1),[]),children:j.jsx(nn.div,{tabIndex:J||Me===0?-1:0,"data-orientation":i,...R,ref:L,style:{outline:"none",...t.style},onMouseDown:xi(t.onMouseDown,()=>{Se.current=!0}),onFocus:xi(t.onFocus,Be=>{const $e=!Se.current;if(Be.target===Be.currentTarget&&$e&&!J){const at=new CustomEvent(cx,k7);if(Be.currentTarget.dispatchEvent(at),!at.defaultPrevented){const _t=me().filter(Lt=>Lt.focusable),Nt=_t.find(Lt=>Lt.active),sr=_t.find(Lt=>Lt.id===V),Ut=[Nt,sr,..._t].filter(Boolean).map(Lt=>Lt.ref.current);Rk(Ut,A)}}Se.current=!1}),onBlur:xi(t.onBlur,()=>ie(!1))})})}),Ck="RovingFocusGroupItem",Pk=Z.forwardRef((t,e)=>{const{__scopeRovingFocusGroup:r,focusable:i=!0,active:n=!1,tabStopId:l,children:c,...o}=t,m=ey(),b=l||m,A=D7(Ck,r),R=A.currentTabStopId===b,M=Ak(r),{onFocusableItemAdd:L,onFocusableItemRemove:G,currentTabStopId:V}=A;return Z.useEffect(()=>{if(i)return L(),()=>G()},[i,L,G]),j.jsx(n2.ItemSlot,{scope:r,id:b,focusable:i,active:n,children:j.jsx(nn.span,{tabIndex:R?0:-1,"data-orientation":A.orientation,...o,ref:e,onMouseDown:xi(t.onMouseDown,q=>{i?A.onItemFocus(b):q.preventDefault()}),onFocus:xi(t.onFocus,()=>A.onItemFocus(b)),onKeyDown:xi(t.onKeyDown,q=>{if(q.key==="Tab"&&q.shiftKey){A.onItemShiftTab();return}if(q.target!==q.currentTarget)return;const J=j7(q,A.orientation,A.dir);if(J!==void 0){if(q.metaKey||q.ctrlKey||q.altKey||q.shiftKey)return;q.preventDefault();let ee=M().filter(me=>me.focusable).map(me=>me.ref.current);if(J==="last")ee.reverse();else if(J==="prev"||J==="next"){J==="prev"&&ee.reverse();const me=ee.indexOf(q.currentTarget);ee=A.loop?U7(ee,me+1):ee.slice(me+1)}setTimeout(()=>Rk(ee))}}),children:typeof c=="function"?c({isCurrentTabStop:R,hasTabStop:V!=null}):c})})});Pk.displayName=Ck;var F7={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function z7(t,e){return e!=="rtl"?t:t==="ArrowLeft"?"ArrowRight":t==="ArrowRight"?"ArrowLeft":t}function j7(t,e,r){const i=z7(t.key,r);if(!(e==="vertical"&&["ArrowLeft","ArrowRight"].includes(i))&&!(e==="horizontal"&&["ArrowUp","ArrowDown"].includes(i)))return F7[i]}function Rk(t,e=!1){const r=document.activeElement;for(const i of t)if(i===r||(i.focus({preventScroll:e}),document.activeElement!==r))return}function U7(t,e){return t.map((r,i)=>t[(e+i)%t.length])}var V7=Sk,G7=Pk;function H7(t,e){return Z.useReducer((r,i)=>e[r][i]??r,t)}var Bh=t=>{const{present:e,children:r}=t,i=$7(e),n=typeof r=="function"?r({present:i.isPresent}):Z.Children.only(r),l=Bn(i.ref,W7(n));return typeof r=="function"||i.isPresent?Z.cloneElement(n,{ref:l}):null};Bh.displayName="Presence";function $7(t){const[e,r]=Z.useState(),i=Z.useRef(null),n=Z.useRef(t),l=Z.useRef("none"),c=t?"mounted":"unmounted",[o,m]=H7(c,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return Z.useEffect(()=>{const b=j0(i.current);l.current=o==="mounted"?b:"none"},[o]),Mu(()=>{const b=i.current,A=n.current;if(A!==t){const M=l.current,L=j0(b);t?m("MOUNT"):L==="none"||b?.display==="none"?m("UNMOUNT"):m(A&&M!==L?"ANIMATION_OUT":"UNMOUNT"),n.current=t}},[t,m]),Mu(()=>{if(e){let b;const A=e.ownerDocument.defaultView??window,R=L=>{const V=j0(i.current).includes(CSS.escape(L.animationName));if(L.target===e&&V&&(m("ANIMATION_END"),!n.current)){const q=e.style.animationFillMode;e.style.animationFillMode="forwards",b=A.setTimeout(()=>{e.style.animationFillMode==="forwards"&&(e.style.animationFillMode=q)})}},M=L=>{L.target===e&&(l.current=j0(i.current))};return e.addEventListener("animationstart",M),e.addEventListener("animationcancel",R),e.addEventListener("animationend",R),()=>{A.clearTimeout(b),e.removeEventListener("animationstart",M),e.removeEventListener("animationcancel",R),e.removeEventListener("animationend",R)}}else m("ANIMATION_END")},[e,m]),{isPresent:["mounted","unmountSuspended"].includes(o),ref:Z.useCallback(b=>{i.current=b?getComputedStyle(b):null,r(b)},[])}}function j0(t){return t?.animationName||"none"}function W7(t){let e=Object.getOwnPropertyDescriptor(t.props,"ref")?.get,r=e&&"isReactWarning"in e&&e.isReactWarning;return r?t.ref:(e=Object.getOwnPropertyDescriptor(t,"ref")?.get,r=e&&"isReactWarning"in e&&e.isReactWarning,r?t.props.ref:t.props.ref||t.ref)}var H1="Tabs",[q7]=Sg(H1,[Tk]),Mk=Tk(),[K7,oA]=q7(H1),Ik=Z.forwardRef((t,e)=>{const{__scopeTabs:r,value:i,onValueChange:n,defaultValue:l,orientation:c="horizontal",dir:o,activationMode:m="automatic",...b}=t,A=G1(o),[R,M]=V1({prop:i,onChange:n,defaultProp:l??"",caller:H1});return j.jsx(K7,{scope:r,baseId:ey(),value:R,onValueChange:M,orientation:c,dir:A,activationMode:m,children:j.jsx(nn.div,{dir:A,"data-orientation":c,...b,ref:e})})});Ik.displayName=H1;var kk="TabsList",Bk=Z.forwardRef((t,e)=>{const{__scopeTabs:r,loop:i=!0,...n}=t,l=oA(kk,r),c=Mk(r);return j.jsx(V7,{asChild:!0,...c,orientation:l.orientation,dir:l.dir,loop:i,children:j.jsx(nn.div,{role:"tablist","aria-orientation":l.orientation,...n,ref:e})})});Bk.displayName=kk;var Lk="TabsTrigger",Ok=Z.forwardRef((t,e)=>{const{__scopeTabs:r,value:i,disabled:n=!1,...l}=t,c=oA(Lk,r),o=Mk(r),m=Fk(c.baseId,i),b=zk(c.baseId,i),A=i===c.value;return j.jsx(G7,{asChild:!0,...o,focusable:!n,active:A,children:j.jsx(nn.button,{type:"button",role:"tab","aria-selected":A,"aria-controls":b,"data-state":A?"active":"inactive","data-disabled":n?"":void 0,disabled:n,id:m,...l,ref:e,onMouseDown:xi(t.onMouseDown,R=>{!n&&R.button===0&&R.ctrlKey===!1?c.onValueChange(i):R.preventDefault()}),onKeyDown:xi(t.onKeyDown,R=>{[" ","Enter"].includes(R.key)&&c.onValueChange(i)}),onFocus:xi(t.onFocus,()=>{const R=c.activationMode!=="manual";!A&&!n&&R&&c.onValueChange(i)})})})});Ok.displayName=Lk;var Dk="TabsContent",Nk=Z.forwardRef((t,e)=>{const{__scopeTabs:r,value:i,forceMount:n,children:l,...c}=t,o=oA(Dk,r),m=Fk(o.baseId,i),b=zk(o.baseId,i),A=i===o.value,R=Z.useRef(A);return Z.useEffect(()=>{const M=requestAnimationFrame(()=>R.current=!1);return()=>cancelAnimationFrame(M)},[]),j.jsx(Bh,{present:n||A,children:({present:M})=>j.jsx(nn.div,{"data-state":A?"active":"inactive","data-orientation":o.orientation,role:"tabpanel","aria-labelledby":m,hidden:!M,id:b,tabIndex:0,...c,ref:e,style:{...t.style,animationDuration:R.current?"0s":void 0},children:M&&l})})});Nk.displayName=Dk;function Fk(t,e){return`${t}-trigger-${e}`}function zk(t,e){return`${t}-content-${e}`}var Z7=Ik,X7=Bk,Y7=Ok,J7=Nk;function jk(t){var e,r,i="";if(typeof t=="string"||typeof t=="number")i+=t;else if(typeof t=="object")if(Array.isArray(t)){var n=t.length;for(e=0;e<n;e++)t[e]&&(r=jk(t[e]))&&(i&&(i+=" "),i+=r)}else for(r in t)t[r]&&(i&&(i+=" "),i+=r);return i}function Uk(){for(var t,e,r=0,i="",n=arguments.length;r<n;r++)(t=arguments[r])&&(e=jk(t))&&(i&&(i+=" "),i+=e);return i}const Q7=(t,e)=>{const r=new Array(t.length+e.length);for(let i=0;i<t.length;i++)r[i]=t[i];for(let i=0;i<e.length;i++)r[t.length+i]=e[i];return r},eV=(t,e)=>({classGroupId:t,validator:e}),Vk=(t=new Map,e=null,r)=>({nextPart:t,validators:e,classGroupId:r}),t1="-",nC=[],tV="arbitrary..",rV=t=>{const e=nV(t),{conflictingClassGroups:r,conflictingClassGroupModifiers:i}=t;return{getClassGroupId:c=>{if(c.startsWith("[")&&c.endsWith("]"))return iV(c);const o=c.split(t1),m=o[0]===""&&o.length>1?1:0;return Gk(o,m,e)},getConflictingClassGroupIds:(c,o)=>{if(o){const m=i[c],b=r[c];return m?b?Q7(b,m):m:b||nC}return r[c]||nC}}},Gk=(t,e,r)=>{if(t.length-e===0)return r.classGroupId;const n=t[e],l=r.nextPart.get(n);if(l){const b=Gk(t,e+1,l);if(b)return b}const c=r.validators;if(c===null)return;const o=e===0?t.join(t1):t.slice(e).join(t1),m=c.length;for(let b=0;b<m;b++){const A=c[b];if(A.validator(o))return A.classGroupId}},iV=t=>t.slice(1,-1).indexOf(":")===-1?void 0:(()=>{const e=t.slice(1,-1),r=e.indexOf(":"),i=e.slice(0,r);return i?tV+i:void 0})(),nV=t=>{const{theme:e,classGroups:r}=t;return sV(r,e)},sV=(t,e)=>{const r=Vk();for(const i in t){const n=t[i];aA(n,r,i,e)}return r},aA=(t,e,r,i)=>{const n=t.length;for(let l=0;l<n;l++){const c=t[l];oV(c,e,r,i)}},oV=(t,e,r,i)=>{if(typeof t=="string"){aV(t,e,r);return}if(typeof t=="function"){lV(t,e,r,i);return}cV(t,e,r,i)},aV=(t,e,r)=>{const i=t===""?e:Hk(e,t);i.classGroupId=r},lV=(t,e,r,i)=>{if(uV(t)){aA(t(i),e,r,i);return}e.validators===null&&(e.validators=[]),e.validators.push(eV(r,t))},cV=(t,e,r,i)=>{const n=Object.entries(t),l=n.length;for(let c=0;c<l;c++){const[o,m]=n[c];aA(m,Hk(e,o),r,i)}},Hk=(t,e)=>{let r=t;const i=e.split(t1),n=i.length;for(let l=0;l<n;l++){const c=i[l];let o=r.nextPart.get(c);o||(o=Vk(),r.nextPart.set(c,o)),r=o}return r},uV=t=>"isThemeGetter"in t&&t.isThemeGetter===!0,hV=t=>{if(t<1)return{get:()=>{},set:()=>{}};let e=0,r=Object.create(null),i=Object.create(null);const n=(l,c)=>{r[l]=c,e++,e>t&&(e=0,i=r,r=Object.create(null))};return{get(l){let c=r[l];if(c!==void 0)return c;if((c=i[l])!==void 0)return n(l,c),c},set(l,c){l in r?r[l]=c:n(l,c)}}},s2="!",sC=":",dV=[],oC=(t,e,r,i,n)=>({modifiers:t,hasImportantModifier:e,baseClassName:r,maybePostfixModifierPosition:i,isExternal:n}),fV=t=>{const{prefix:e,experimentalParseClassName:r}=t;let i=n=>{const l=[];let c=0,o=0,m=0,b;const A=n.length;for(let V=0;V<A;V++){const q=n[V];if(c===0&&o===0){if(q===sC){l.push(n.slice(m,V)),m=V+1;continue}if(q==="/"){b=V;continue}}q==="["?c++:q==="]"?c--:q==="("?o++:q===")"&&o--}const R=l.length===0?n:n.slice(m);let M=R,L=!1;R.endsWith(s2)?(M=R.slice(0,-1),L=!0):R.startsWith(s2)&&(M=R.slice(1),L=!0);const G=b&&b>m?b-m:void 0;return oC(l,L,M,G)};if(e){const n=e+sC,l=i;i=c=>c.startsWith(n)?l(c.slice(n.length)):oC(dV,!1,c,void 0,!0)}if(r){const n=i;i=l=>r({className:l,parseClassName:n})}return i},pV=t=>{const e=new Map;return t.orderSensitiveModifiers.forEach((r,i)=>{e.set(r,1e6+i)}),r=>{const i=[];let n=[];for(let l=0;l<r.length;l++){const c=r[l],o=c[0]==="[",m=e.has(c);o||m?(n.length>0&&(n.sort(),i.push(...n),n=[]),i.push(c)):n.push(c)}return n.length>0&&(n.sort(),i.push(...n)),i}},mV=t=>({cache:hV(t.cacheSize),parseClassName:fV(t),sortModifiers:pV(t),...rV(t)}),gV=/\s+/,_V=(t,e)=>{const{parseClassName:r,getClassGroupId:i,getConflictingClassGroupIds:n,sortModifiers:l}=e,c=[],o=t.trim().split(gV);let m="";for(let b=o.length-1;b>=0;b-=1){const A=o[b],{isExternal:R,modifiers:M,hasImportantModifier:L,baseClassName:G,maybePostfixModifierPosition:V}=r(A);if(R){m=A+(m.length>0?" "+m:m);continue}let q=!!V,J=i(q?G.substring(0,V):G);if(!J){if(!q){m=A+(m.length>0?" "+m:m);continue}if(J=i(G),!J){m=A+(m.length>0?" "+m:m);continue}q=!1}const ie=M.length===0?"":M.length===1?M[0]:l(M).join(":"),ee=L?ie+s2:ie,me=ee+J;if(c.indexOf(me)>-1)continue;c.push(me);const Se=n(J,q);for(let Me=0;Me<Se.length;++Me){const Ve=Se[Me];c.push(ee+Ve)}m=A+(m.length>0?" "+m:m)}return m},yV=(...t)=>{let e=0,r,i,n="";for(;e<t.length;)(r=t[e++])&&(i=$k(r))&&(n&&(n+=" "),n+=i);return n},$k=t=>{if(typeof t=="string")return t;let e,r="";for(let i=0;i<t.length;i++)t[i]&&(e=$k(t[i]))&&(r&&(r+=" "),r+=e);return r},vV=(t,...e)=>{let r,i,n,l;const c=m=>{const b=e.reduce((A,R)=>R(A),t());return r=mV(b),i=r.cache.get,n=r.cache.set,l=o,o(m)},o=m=>{const b=i(m);if(b)return b;const A=_V(m,r);return n(m,A),A};return l=c,(...m)=>l(yV(...m))},bV=[],As=t=>{const e=r=>r[t]||bV;return e.isThemeGetter=!0,e},Wk=/^\[(?:(\w[\w-]*):)?(.+)\]$/i,qk=/^\((?:(\w[\w-]*):)?(.+)\)$/i,xV=/^\d+\/\d+$/,wV=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,EV=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,AV=/^(rgba?|hsla?|hwb|(ok)?(lab|lch)|color-mix)\(.+\)$/,TV=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,SV=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,pm=t=>xV.test(t),Vr=t=>!!t&&!Number.isNaN(Number(t)),gd=t=>!!t&&Number.isInteger(Number(t)),ux=t=>t.endsWith("%")&&Vr(t.slice(0,-1)),yh=t=>wV.test(t),CV=()=>!0,PV=t=>EV.test(t)&&!AV.test(t),Kk=()=>!1,RV=t=>TV.test(t),MV=t=>SV.test(t),IV=t=>!rr(t)&&!ir(t),kV=t=>Cg(t,Yk,Kk),rr=t=>Wk.test(t),rp=t=>Cg(t,Jk,PV),hx=t=>Cg(t,NV,Vr),aC=t=>Cg(t,Zk,Kk),BV=t=>Cg(t,Xk,MV),U0=t=>Cg(t,Qk,RV),ir=t=>qk.test(t),S_=t=>Pg(t,Jk),LV=t=>Pg(t,FV),lC=t=>Pg(t,Zk),OV=t=>Pg(t,Yk),DV=t=>Pg(t,Xk),V0=t=>Pg(t,Qk,!0),Cg=(t,e,r)=>{const i=Wk.exec(t);return i?i[1]?e(i[1]):r(i[2]):!1},Pg=(t,e,r=!1)=>{const i=qk.exec(t);return i?i[1]?e(i[1]):r:!1},Zk=t=>t==="position"||t==="percentage",Xk=t=>t==="image"||t==="url",Yk=t=>t==="length"||t==="size"||t==="bg-size",Jk=t=>t==="length",NV=t=>t==="number",FV=t=>t==="family-name",Qk=t=>t==="shadow",zV=()=>{const t=As("color"),e=As("font"),r=As("text"),i=As("font-weight"),n=As("tracking"),l=As("leading"),c=As("breakpoint"),o=As("container"),m=As("spacing"),b=As("radius"),A=As("shadow"),R=As("inset-shadow"),M=As("text-shadow"),L=As("drop-shadow"),G=As("blur"),V=As("perspective"),q=As("aspect"),J=As("ease"),ie=As("animate"),ee=()=>["auto","avoid","all","avoid-page","page","left","right","column"],me=()=>["center","top","bottom","left","right","top-left","left-top","top-right","right-top","bottom-right","right-bottom","bottom-left","left-bottom"],Se=()=>[...me(),ir,rr],Me=()=>["auto","hidden","clip","visible","scroll"],Ve=()=>["auto","contain","none"],Be=()=>[ir,rr,m],$e=()=>[pm,"full","auto",...Be()],at=()=>[gd,"none","subgrid",ir,rr],_t=()=>["auto",{span:["full",gd,ir,rr]},gd,ir,rr],Nt=()=>[gd,"auto",ir,rr],sr=()=>["auto","min","max","fr",ir,rr],Ft=()=>["start","end","center","between","around","evenly","stretch","baseline","center-safe","end-safe"],Ut=()=>["start","end","center","stretch","center-safe","end-safe"],Lt=()=>["auto",...Be()],At=()=>[pm,"auto","full","dvw","dvh","lvw","lvh","svw","svh","min","max","fit",...Be()],Ke=()=>[t,ir,rr],ft=()=>[...me(),lC,aC,{position:[ir,rr]}],Tt=()=>["no-repeat",{repeat:["","x","y","space","round"]}],ze=()=>["auto","cover","contain",OV,kV,{size:[ir,rr]}],ht=()=>[ux,S_,rp],Ht=()=>["","none","full",b,ir,rr],Jt=()=>["",Vr,S_,rp],Pr=()=>["solid","dashed","dotted","double"],yr=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],$t=()=>[Vr,ux,lC,aC],pr=()=>["","none",G,ir,rr],Qt=()=>["none",Vr,ir,rr],Nr=()=>["none",Vr,ir,rr],An=()=>[Vr,ir,rr],wi=()=>[pm,"full",...Be()];return{cacheSize:500,theme:{animate:["spin","ping","pulse","bounce"],aspect:["video"],blur:[yh],breakpoint:[yh],color:[CV],container:[yh],"drop-shadow":[yh],ease:["in","out","in-out"],font:[IV],"font-weight":["thin","extralight","light","normal","medium","semibold","bold","extrabold","black"],"inset-shadow":[yh],leading:["none","tight","snug","normal","relaxed","loose"],perspective:["dramatic","near","normal","midrange","distant","none"],radius:[yh],shadow:[yh],spacing:["px",Vr],text:[yh],"text-shadow":[yh],tracking:["tighter","tight","normal","wide","wider","widest"]},classGroups:{aspect:[{aspect:["auto","square",pm,rr,ir,q]}],container:["container"],columns:[{columns:[Vr,rr,ir,o]}],"break-after":[{"break-after":ee()}],"break-before":[{"break-before":ee()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],sr:["sr-only","not-sr-only"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:Se()}],overflow:[{overflow:Me()}],"overflow-x":[{"overflow-x":Me()}],"overflow-y":[{"overflow-y":Me()}],overscroll:[{overscroll:Ve()}],"overscroll-x":[{"overscroll-x":Ve()}],"overscroll-y":[{"overscroll-y":Ve()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:$e()}],"inset-x":[{"inset-x":$e()}],"inset-y":[{"inset-y":$e()}],start:[{start:$e()}],end:[{end:$e()}],top:[{top:$e()}],right:[{right:$e()}],bottom:[{bottom:$e()}],left:[{left:$e()}],visibility:["visible","invisible","collapse"],z:[{z:[gd,"auto",ir,rr]}],basis:[{basis:[pm,"full","auto",o,...Be()]}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["nowrap","wrap","wrap-reverse"]}],flex:[{flex:[Vr,pm,"auto","initial","none",rr]}],grow:[{grow:["",Vr,ir,rr]}],shrink:[{shrink:["",Vr,ir,rr]}],order:[{order:[gd,"first","last","none",ir,rr]}],"grid-cols":[{"grid-cols":at()}],"col-start-end":[{col:_t()}],"col-start":[{"col-start":Nt()}],"col-end":[{"col-end":Nt()}],"grid-rows":[{"grid-rows":at()}],"row-start-end":[{row:_t()}],"row-start":[{"row-start":Nt()}],"row-end":[{"row-end":Nt()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":sr()}],"auto-rows":[{"auto-rows":sr()}],gap:[{gap:Be()}],"gap-x":[{"gap-x":Be()}],"gap-y":[{"gap-y":Be()}],"justify-content":[{justify:[...Ft(),"normal"]}],"justify-items":[{"justify-items":[...Ut(),"normal"]}],"justify-self":[{"justify-self":["auto",...Ut()]}],"align-content":[{content:["normal",...Ft()]}],"align-items":[{items:[...Ut(),{baseline:["","last"]}]}],"align-self":[{self:["auto",...Ut(),{baseline:["","last"]}]}],"place-content":[{"place-content":Ft()}],"place-items":[{"place-items":[...Ut(),"baseline"]}],"place-self":[{"place-self":["auto",...Ut()]}],p:[{p:Be()}],px:[{px:Be()}],py:[{py:Be()}],ps:[{ps:Be()}],pe:[{pe:Be()}],pt:[{pt:Be()}],pr:[{pr:Be()}],pb:[{pb:Be()}],pl:[{pl:Be()}],m:[{m:Lt()}],mx:[{mx:Lt()}],my:[{my:Lt()}],ms:[{ms:Lt()}],me:[{me:Lt()}],mt:[{mt:Lt()}],mr:[{mr:Lt()}],mb:[{mb:Lt()}],ml:[{ml:Lt()}],"space-x":[{"space-x":Be()}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":Be()}],"space-y-reverse":["space-y-reverse"],size:[{size:At()}],w:[{w:[o,"screen",...At()]}],"min-w":[{"min-w":[o,"screen","none",...At()]}],"max-w":[{"max-w":[o,"screen","none","prose",{screen:[c]},...At()]}],h:[{h:["screen","lh",...At()]}],"min-h":[{"min-h":["screen","lh","none",...At()]}],"max-h":[{"max-h":["screen","lh",...At()]}],"font-size":[{text:["base",r,S_,rp]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:[i,ir,hx]}],"font-stretch":[{"font-stretch":["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded",ux,rr]}],"font-family":[{font:[LV,rr,e]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:[n,ir,rr]}],"line-clamp":[{"line-clamp":[Vr,"none",ir,hx]}],leading:[{leading:[l,...Be()]}],"list-image":[{"list-image":["none",ir,rr]}],"list-style-position":[{list:["inside","outside"]}],"list-style-type":[{list:["disc","decimal","none",ir,rr]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"placeholder-color":[{placeholder:Ke()}],"text-color":[{text:Ke()}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...Pr(),"wavy"]}],"text-decoration-thickness":[{decoration:[Vr,"from-font","auto",ir,rp]}],"text-decoration-color":[{decoration:Ke()}],"underline-offset":[{"underline-offset":[Vr,"auto",ir,rr]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:Be()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",ir,rr]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],wrap:[{wrap:["break-word","anywhere","normal"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",ir,rr]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:ft()}],"bg-repeat":[{bg:Tt()}],"bg-size":[{bg:ze()}],"bg-image":[{bg:["none",{linear:[{to:["t","tr","r","br","b","bl","l","tl"]},gd,ir,rr],radial:["",ir,rr],conic:[gd,ir,rr]},DV,BV]}],"bg-color":[{bg:Ke()}],"gradient-from-pos":[{from:ht()}],"gradient-via-pos":[{via:ht()}],"gradient-to-pos":[{to:ht()}],"gradient-from":[{from:Ke()}],"gradient-via":[{via:Ke()}],"gradient-to":[{to:Ke()}],rounded:[{rounded:Ht()}],"rounded-s":[{"rounded-s":Ht()}],"rounded-e":[{"rounded-e":Ht()}],"rounded-t":[{"rounded-t":Ht()}],"rounded-r":[{"rounded-r":Ht()}],"rounded-b":[{"rounded-b":Ht()}],"rounded-l":[{"rounded-l":Ht()}],"rounded-ss":[{"rounded-ss":Ht()}],"rounded-se":[{"rounded-se":Ht()}],"rounded-ee":[{"rounded-ee":Ht()}],"rounded-es":[{"rounded-es":Ht()}],"rounded-tl":[{"rounded-tl":Ht()}],"rounded-tr":[{"rounded-tr":Ht()}],"rounded-br":[{"rounded-br":Ht()}],"rounded-bl":[{"rounded-bl":Ht()}],"border-w":[{border:Jt()}],"border-w-x":[{"border-x":Jt()}],"border-w-y":[{"border-y":Jt()}],"border-w-s":[{"border-s":Jt()}],"border-w-e":[{"border-e":Jt()}],"border-w-t":[{"border-t":Jt()}],"border-w-r":[{"border-r":Jt()}],"border-w-b":[{"border-b":Jt()}],"border-w-l":[{"border-l":Jt()}],"divide-x":[{"divide-x":Jt()}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":Jt()}],"divide-y-reverse":["divide-y-reverse"],"border-style":[{border:[...Pr(),"hidden","none"]}],"divide-style":[{divide:[...Pr(),"hidden","none"]}],"border-color":[{border:Ke()}],"border-color-x":[{"border-x":Ke()}],"border-color-y":[{"border-y":Ke()}],"border-color-s":[{"border-s":Ke()}],"border-color-e":[{"border-e":Ke()}],"border-color-t":[{"border-t":Ke()}],"border-color-r":[{"border-r":Ke()}],"border-color-b":[{"border-b":Ke()}],"border-color-l":[{"border-l":Ke()}],"divide-color":[{divide:Ke()}],"outline-style":[{outline:[...Pr(),"none","hidden"]}],"outline-offset":[{"outline-offset":[Vr,ir,rr]}],"outline-w":[{outline:["",Vr,S_,rp]}],"outline-color":[{outline:Ke()}],shadow:[{shadow:["","none",A,V0,U0]}],"shadow-color":[{shadow:Ke()}],"inset-shadow":[{"inset-shadow":["none",R,V0,U0]}],"inset-shadow-color":[{"inset-shadow":Ke()}],"ring-w":[{ring:Jt()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:Ke()}],"ring-offset-w":[{"ring-offset":[Vr,rp]}],"ring-offset-color":[{"ring-offset":Ke()}],"inset-ring-w":[{"inset-ring":Jt()}],"inset-ring-color":[{"inset-ring":Ke()}],"text-shadow":[{"text-shadow":["none",M,V0,U0]}],"text-shadow-color":[{"text-shadow":Ke()}],opacity:[{opacity:[Vr,ir,rr]}],"mix-blend":[{"mix-blend":[...yr(),"plus-darker","plus-lighter"]}],"bg-blend":[{"bg-blend":yr()}],"mask-clip":[{"mask-clip":["border","padding","content","fill","stroke","view"]},"mask-no-clip"],"mask-composite":[{mask:["add","subtract","intersect","exclude"]}],"mask-image-linear-pos":[{"mask-linear":[Vr]}],"mask-image-linear-from-pos":[{"mask-linear-from":$t()}],"mask-image-linear-to-pos":[{"mask-linear-to":$t()}],"mask-image-linear-from-color":[{"mask-linear-from":Ke()}],"mask-image-linear-to-color":[{"mask-linear-to":Ke()}],"mask-image-t-from-pos":[{"mask-t-from":$t()}],"mask-image-t-to-pos":[{"mask-t-to":$t()}],"mask-image-t-from-color":[{"mask-t-from":Ke()}],"mask-image-t-to-color":[{"mask-t-to":Ke()}],"mask-image-r-from-pos":[{"mask-r-from":$t()}],"mask-image-r-to-pos":[{"mask-r-to":$t()}],"mask-image-r-from-color":[{"mask-r-from":Ke()}],"mask-image-r-to-color":[{"mask-r-to":Ke()}],"mask-image-b-from-pos":[{"mask-b-from":$t()}],"mask-image-b-to-pos":[{"mask-b-to":$t()}],"mask-image-b-from-color":[{"mask-b-from":Ke()}],"mask-image-b-to-color":[{"mask-b-to":Ke()}],"mask-image-l-from-pos":[{"mask-l-from":$t()}],"mask-image-l-to-pos":[{"mask-l-to":$t()}],"mask-image-l-from-color":[{"mask-l-from":Ke()}],"mask-image-l-to-color":[{"mask-l-to":Ke()}],"mask-image-x-from-pos":[{"mask-x-from":$t()}],"mask-image-x-to-pos":[{"mask-x-to":$t()}],"mask-image-x-from-color":[{"mask-x-from":Ke()}],"mask-image-x-to-color":[{"mask-x-to":Ke()}],"mask-image-y-from-pos":[{"mask-y-from":$t()}],"mask-image-y-to-pos":[{"mask-y-to":$t()}],"mask-image-y-from-color":[{"mask-y-from":Ke()}],"mask-image-y-to-color":[{"mask-y-to":Ke()}],"mask-image-radial":[{"mask-radial":[ir,rr]}],"mask-image-radial-from-pos":[{"mask-radial-from":$t()}],"mask-image-radial-to-pos":[{"mask-radial-to":$t()}],"mask-image-radial-from-color":[{"mask-radial-from":Ke()}],"mask-image-radial-to-color":[{"mask-radial-to":Ke()}],"mask-image-radial-shape":[{"mask-radial":["circle","ellipse"]}],"mask-image-radial-size":[{"mask-radial":[{closest:["side","corner"],farthest:["side","corner"]}]}],"mask-image-radial-pos":[{"mask-radial-at":me()}],"mask-image-conic-pos":[{"mask-conic":[Vr]}],"mask-image-conic-from-pos":[{"mask-conic-from":$t()}],"mask-image-conic-to-pos":[{"mask-conic-to":$t()}],"mask-image-conic-from-color":[{"mask-conic-from":Ke()}],"mask-image-conic-to-color":[{"mask-conic-to":Ke()}],"mask-mode":[{mask:["alpha","luminance","match"]}],"mask-origin":[{"mask-origin":["border","padding","content","fill","stroke","view"]}],"mask-position":[{mask:ft()}],"mask-repeat":[{mask:Tt()}],"mask-size":[{mask:ze()}],"mask-type":[{"mask-type":["alpha","luminance"]}],"mask-image":[{mask:["none",ir,rr]}],filter:[{filter:["","none",ir,rr]}],blur:[{blur:pr()}],brightness:[{brightness:[Vr,ir,rr]}],contrast:[{contrast:[Vr,ir,rr]}],"drop-shadow":[{"drop-shadow":["","none",L,V0,U0]}],"drop-shadow-color":[{"drop-shadow":Ke()}],grayscale:[{grayscale:["",Vr,ir,rr]}],"hue-rotate":[{"hue-rotate":[Vr,ir,rr]}],invert:[{invert:["",Vr,ir,rr]}],saturate:[{saturate:[Vr,ir,rr]}],sepia:[{sepia:["",Vr,ir,rr]}],"backdrop-filter":[{"backdrop-filter":["","none",ir,rr]}],"backdrop-blur":[{"backdrop-blur":pr()}],"backdrop-brightness":[{"backdrop-brightness":[Vr,ir,rr]}],"backdrop-contrast":[{"backdrop-contrast":[Vr,ir,rr]}],"backdrop-grayscale":[{"backdrop-grayscale":["",Vr,ir,rr]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[Vr,ir,rr]}],"backdrop-invert":[{"backdrop-invert":["",Vr,ir,rr]}],"backdrop-opacity":[{"backdrop-opacity":[Vr,ir,rr]}],"backdrop-saturate":[{"backdrop-saturate":[Vr,ir,rr]}],"backdrop-sepia":[{"backdrop-sepia":["",Vr,ir,rr]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":Be()}],"border-spacing-x":[{"border-spacing-x":Be()}],"border-spacing-y":[{"border-spacing-y":Be()}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["","all","colors","opacity","shadow","transform","none",ir,rr]}],"transition-behavior":[{transition:["normal","discrete"]}],duration:[{duration:[Vr,"initial",ir,rr]}],ease:[{ease:["linear","initial",J,ir,rr]}],delay:[{delay:[Vr,ir,rr]}],animate:[{animate:["none",ie,ir,rr]}],backface:[{backface:["hidden","visible"]}],perspective:[{perspective:[V,ir,rr]}],"perspective-origin":[{"perspective-origin":Se()}],rotate:[{rotate:Qt()}],"rotate-x":[{"rotate-x":Qt()}],"rotate-y":[{"rotate-y":Qt()}],"rotate-z":[{"rotate-z":Qt()}],scale:[{scale:Nr()}],"scale-x":[{"scale-x":Nr()}],"scale-y":[{"scale-y":Nr()}],"scale-z":[{"scale-z":Nr()}],"scale-3d":["scale-3d"],skew:[{skew:An()}],"skew-x":[{"skew-x":An()}],"skew-y":[{"skew-y":An()}],transform:[{transform:[ir,rr,"","none","gpu","cpu"]}],"transform-origin":[{origin:Se()}],"transform-style":[{transform:["3d","flat"]}],translate:[{translate:wi()}],"translate-x":[{"translate-x":wi()}],"translate-y":[{"translate-y":wi()}],"translate-z":[{"translate-z":wi()}],"translate-none":["translate-none"],accent:[{accent:Ke()}],appearance:[{appearance:["none","auto"]}],"caret-color":[{caret:Ke()}],"color-scheme":[{scheme:["normal","dark","light","light-dark","only-dark","only-light"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",ir,rr]}],"field-sizing":[{"field-sizing":["fixed","content"]}],"pointer-events":[{"pointer-events":["auto","none"]}],resize:[{resize:["none","","y","x"]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":Be()}],"scroll-mx":[{"scroll-mx":Be()}],"scroll-my":[{"scroll-my":Be()}],"scroll-ms":[{"scroll-ms":Be()}],"scroll-me":[{"scroll-me":Be()}],"scroll-mt":[{"scroll-mt":Be()}],"scroll-mr":[{"scroll-mr":Be()}],"scroll-mb":[{"scroll-mb":Be()}],"scroll-ml":[{"scroll-ml":Be()}],"scroll-p":[{"scroll-p":Be()}],"scroll-px":[{"scroll-px":Be()}],"scroll-py":[{"scroll-py":Be()}],"scroll-ps":[{"scroll-ps":Be()}],"scroll-pe":[{"scroll-pe":Be()}],"scroll-pt":[{"scroll-pt":Be()}],"scroll-pr":[{"scroll-pr":Be()}],"scroll-pb":[{"scroll-pb":Be()}],"scroll-pl":[{"scroll-pl":Be()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",ir,rr]}],fill:[{fill:["none",...Ke()]}],"stroke-w":[{stroke:[Vr,S_,rp,hx]}],stroke:[{stroke:["none",...Ke()]}],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-x","border-w-y","border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-x","border-color-y","border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],translate:["translate-x","translate-y","translate-none"],"translate-none":["translate","translate-x","translate-y","translate-z"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]},orderSensitiveModifiers:["*","**","after","backdrop","before","details-content","file","first-letter","first-line","marker","placeholder","selection"]}},jV=vV(zV);function Ri(...t){return jV(Uk(t))}function UV({className:t,...e}){return j.jsx(Z7,{"data-slot":"tabs",className:Ri("flex flex-col gap-2",t),...e})}function VV({className:t,...e}){return j.jsx(X7,{"data-slot":"tabs-list",className:Ri("bg-muted text-muted-foreground inline-flex h-9 w-fit items-center justify-center rounded-xl p-[3px] flex",t),...e})}function C_({className:t,...e}){return j.jsx(Y7,{"data-slot":"tabs-trigger",className:Ri("data-[state=active]:bg-card dark:data-[state=active]:text-foreground focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:outline-ring dark:data-[state=active]:border-input dark:data-[state=active]:bg-input/30 text-foreground dark:text-muted-foreground inline-flex h-[calc(100%-1px)] flex-1 items-center justify-center gap-1.5 rounded-xl border border-transparent px-2 py-1 text-sm font-medium whitespace-nowrap transition-[color,box-shadow] focus-visible:ring-[3px] focus-visible:outline-1 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",t),...e})}function P_({className:t,...e}){return j.jsx(J7,{"data-slot":"tabs-content",className:Ri("flex-1 outline-none",t),...e})}var GV=Symbol.for("react.lazy"),r1=gE[" use ".trim().toString()];function HV(t){return typeof t=="object"&&t!==null&&"then"in t}function e4(t){return t!=null&&typeof t=="object"&&"$$typeof"in t&&t.$$typeof===GV&&"_payload"in t&&HV(t._payload)}function lA(t){const e=$V(t),r=Z.forwardRef((i,n)=>{let{children:l,...c}=i;e4(l)&&typeof r1=="function"&&(l=r1(l._payload));const o=Z.Children.toArray(l),m=o.find(qV);if(m){const b=m.props.children,A=o.map(R=>R===m?Z.Children.count(b)>1?Z.Children.only(null):Z.isValidElement(b)?b.props.children:null:R);return j.jsx(e,{...c,ref:n,children:Z.isValidElement(b)?Z.cloneElement(b,void 0,A):null})}return j.jsx(e,{...c,ref:n,children:l})});return r.displayName=`${t}.Slot`,r}var t4=lA("Slot");function $V(t){const e=Z.forwardRef((r,i)=>{let{children:n,...l}=r;if(e4(n)&&typeof r1=="function"&&(n=r1(n._payload)),Z.isValidElement(n)){const c=ZV(n),o=KV(l,n.props);return n.type!==Z.Fragment&&(o.ref=i?Ny(i,c):c),Z.cloneElement(n,o)}return Z.Children.count(n)>1?Z.Children.only(null):null});return e.displayName=`${t}.SlotClone`,e}var WV=Symbol("radix.slottable");function qV(t){return Z.isValidElement(t)&&typeof t.type=="function"&&"__radixId"in t.type&&t.type.__radixId===WV}function KV(t,e){const r={...e};for(const i in e){const n=t[i],l=e[i];/^on[A-Z]/.test(i)?n&&l?r[i]=(...o)=>{const m=l(...o);return n(...o),m}:n&&(r[i]=n):i==="style"?r[i]={...n,...l}:i==="className"&&(r[i]=[n,l].filter(Boolean).join(" "))}return{...t,...r}}function ZV(t){let e=Object.getOwnPropertyDescriptor(t.props,"ref")?.get,r=e&&"isReactWarning"in e&&e.isReactWarning;return r?t.ref:(e=Object.getOwnPropertyDescriptor(t,"ref")?.get,r=e&&"isReactWarning"in e&&e.isReactWarning,r?t.props.ref:t.props.ref||t.ref)}const cC=t=>typeof t=="boolean"?`${t}`:t===0?"0":t,uC=Uk,r4=(t,e)=>r=>{var i;if(e?.variants==null)return uC(t,r?.class,r?.className);const{variants:n,defaultVariants:l}=e,c=Object.keys(n).map(b=>{const A=r?.[b],R=l?.[b];if(A===null)return null;const M=cC(A)||cC(R);return n[b][M]}),o=r&&Object.entries(r).reduce((b,A)=>{let[R,M]=A;return M===void 0||(b[R]=M),b},{}),m=e==null||(i=e.compoundVariants)===null||i===void 0?void 0:i.reduce((b,A)=>{let{class:R,className:M,...L}=A;return Object.entries(L).every(G=>{let[V,q]=G;return Array.isArray(q)?q.includes({...l,...o}[V]):{...l,...o}[V]===q})?[...b,R,M]:b},[]);return uC(t,c,m,r?.class,r?.className)},XV=r4("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all duration-300 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:scale-[1.02] active:scale-[0.98]",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90 hover:shadow-[0_0_20px_rgba(120,119,198,0.4)]",destructive:"bg-destructive text-white hover:bg-destructive/90 hover:shadow-[0_0_20px_rgba(239,68,68,0.4)] focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background text-foreground hover:bg-accent hover:text-accent-foreground hover:border-white/20 dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9 rounded-md"}},defaultVariants:{variant:"default",size:"default"}});function ao({className:t,variant:e,size:r,asChild:i=!1,...n}){const l=i?t4:"button";return j.jsx(l,{"data-slot":"button",className:Ri(XV({variant:e,size:r,className:t})),...n})}function Tu({className:t,type:e,...r}){return j.jsx("input",{type:e,"data-slot":"input",className:Ri("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border px-3 py-1 text-base bg-input-background transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",t),...r})}var o2=function(t,e){return o2=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(r[n]=i[n])},o2(t,e)};function i4(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");o2(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}var Ll=function(){return Ll=Object.assign||function(e){for(var r,i=1,n=arguments.length;i<n;i++){r=arguments[i];for(var l in r)Object.prototype.hasOwnProperty.call(r,l)&&(e[l]=r[l])}return e},Ll.apply(this,arguments)};function $d(t,e){var r={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(r[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,i=Object.getOwnPropertySymbols(t);n<i.length;n++)e.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(t,i[n])&&(r[i[n]]=t[i[n]]);return r}function n4(t,e,r,i){var n=arguments.length,l=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i,c;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(t,e,r,i);else for(var o=t.length-1;o>=0;o--)(c=t[o])&&(l=(n<3?c(l):n>3?c(e,r,l):c(e,r))||l);return n>3&&l&&Object.defineProperty(e,r,l),l}function s4(t,e){return function(r,i){e(r,i,t)}}function o4(t,e,r,i,n,l){function c(J){if(J!==void 0&&typeof J!="function")throw new TypeError("Function expected");return J}for(var o=i.kind,m=o==="getter"?"get":o==="setter"?"set":"value",b=!e&&t?i.static?t:t.prototype:null,A=e||(b?Object.getOwnPropertyDescriptor(b,i.name):{}),R,M=!1,L=r.length-1;L>=0;L--){var G={};for(var V in i)G[V]=V==="access"?{}:i[V];for(var V in i.access)G.access[V]=i.access[V];G.addInitializer=function(J){if(M)throw new TypeError("Cannot add initializers after decoration has completed");l.push(c(J||null))};var q=(0,r[L])(o==="accessor"?{get:A.get,set:A.set}:A[m],G);if(o==="accessor"){if(q===void 0)continue;if(q===null||typeof q!="object")throw new TypeError("Object expected");(R=c(q.get))&&(A.get=R),(R=c(q.set))&&(A.set=R),(R=c(q.init))&&n.unshift(R)}else(R=c(q))&&(o==="field"?n.unshift(R):A[m]=R)}b&&Object.defineProperty(b,i.name,A),M=!0}function a4(t,e,r){for(var i=arguments.length>2,n=0;n<e.length;n++)r=i?e[n].call(t,r):e[n].call(t);return i?r:void 0}function l4(t){return typeof t=="symbol"?t:"".concat(t)}function c4(t,e,r){return typeof e=="symbol"&&(e=e.description?"[".concat(e.description,"]"):""),Object.defineProperty(t,"name",{configurable:!0,value:r?"".concat(r," ",e):e})}function u4(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)}function or(t,e,r,i){function n(l){return l instanceof r?l:new r(function(c){c(l)})}return new(r||(r=Promise))(function(l,c){function o(A){try{b(i.next(A))}catch(R){c(R)}}function m(A){try{b(i.throw(A))}catch(R){c(R)}}function b(A){A.done?l(A.value):n(A.value).then(o,m)}b((i=i.apply(t,e||[])).next())})}function h4(t,e){var r={label:0,sent:function(){if(l[0]&1)throw l[1];return l[1]},trys:[],ops:[]},i,n,l,c=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return c.next=o(0),c.throw=o(1),c.return=o(2),typeof Symbol=="function"&&(c[Symbol.iterator]=function(){return this}),c;function o(b){return function(A){return m([b,A])}}function m(b){if(i)throw new TypeError("Generator is already executing.");for(;c&&(c=0,b[0]&&(r=0)),r;)try{if(i=1,n&&(l=b[0]&2?n.return:b[0]?n.throw||((l=n.return)&&l.call(n),0):n.next)&&!(l=l.call(n,b[1])).done)return l;switch(n=0,l&&(b=[b[0]&2,l.value]),b[0]){case 0:case 1:l=b;break;case 4:return r.label++,{value:b[1],done:!1};case 5:r.label++,n=b[1],b=[0];continue;case 7:b=r.ops.pop(),r.trys.pop();continue;default:if(l=r.trys,!(l=l.length>0&&l[l.length-1])&&(b[0]===6||b[0]===2)){r=0;continue}if(b[0]===3&&(!l||b[1]>l[0]&&b[1]<l[3])){r.label=b[1];break}if(b[0]===6&&r.label<l[1]){r.label=l[1],l=b;break}if(l&&r.label<l[2]){r.label=l[2],r.ops.push(b);break}l[2]&&r.ops.pop(),r.trys.pop();continue}b=e.call(t,r)}catch(A){b=[6,A],n=0}finally{i=l=0}if(b[0]&5)throw b[1];return{value:b[0]?b[1]:void 0,done:!0}}}var $1=Object.create?(function(t,e,r,i){i===void 0&&(i=r);var n=Object.getOwnPropertyDescriptor(e,r);(!n||("get"in n?!e.__esModule:n.writable||n.configurable))&&(n={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,i,n)}):(function(t,e,r,i){i===void 0&&(i=r),t[i]=e[r]});function d4(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&$1(e,t,r)}function i1(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],i=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function cA(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var i=r.call(t),n,l=[],c;try{for(;(e===void 0||e-- >0)&&!(n=i.next()).done;)l.push(n.value)}catch(o){c={error:o}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(c)throw c.error}}return l}function f4(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(cA(arguments[e]));return t}function p4(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;for(var i=Array(t),n=0,e=0;e<r;e++)for(var l=arguments[e],c=0,o=l.length;c<o;c++,n++)i[n]=l[c];return i}function uA(t,e,r){if(r||arguments.length===2)for(var i=0,n=e.length,l;i<n;i++)(l||!(i in e))&&(l||(l=Array.prototype.slice.call(e,0,i)),l[i]=e[i]);return t.concat(l||Array.prototype.slice.call(e))}function lg(t){return this instanceof lg?(this.v=t,this):new lg(t)}function m4(t,e,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=r.apply(t,e||[]),n,l=[];return n=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),o("next"),o("throw"),o("return",c),n[Symbol.asyncIterator]=function(){return this},n;function c(L){return function(G){return Promise.resolve(G).then(L,R)}}function o(L,G){i[L]&&(n[L]=function(V){return new Promise(function(q,J){l.push([L,V,q,J])>1||m(L,V)})},G&&(n[L]=G(n[L])))}function m(L,G){try{b(i[L](G))}catch(V){M(l[0][3],V)}}function b(L){L.value instanceof lg?Promise.resolve(L.value.v).then(A,R):M(l[0][2],L)}function A(L){m("next",L)}function R(L){m("throw",L)}function M(L,G){L(G),l.shift(),l.length&&m(l[0][0],l[0][1])}}function g4(t){var e,r;return e={},i("next"),i("throw",function(n){throw n}),i("return"),e[Symbol.iterator]=function(){return this},e;function i(n,l){e[n]=t[n]?function(c){return(r=!r)?{value:lg(t[n](c)),done:!1}:l?l(c):c}:l}}function _4(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],r;return e?e.call(t):(t=typeof i1=="function"?i1(t):t[Symbol.iterator](),r={},i("next"),i("throw"),i("return"),r[Symbol.asyncIterator]=function(){return this},r);function i(l){r[l]=t[l]&&function(c){return new Promise(function(o,m){c=t[l](c),n(o,m,c.done,c.value)})}}function n(l,c,o,m){Promise.resolve(m).then(function(b){l({value:b,done:o})},c)}}function y4(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}var YV=Object.create?(function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}):function(t,e){t.default=e},a2=function(t){return a2=Object.getOwnPropertyNames||function(e){var r=[];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[r.length]=i);return r},a2(t)};function v4(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var r=a2(t),i=0;i<r.length;i++)r[i]!=="default"&&$1(e,t,r[i]);return YV(e,t),e}function b4(t){return t&&t.__esModule?t:{default:t}}function x4(t,e,r,i){if(r==="a"&&!i)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!i:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?i:r==="a"?i.call(t):i?i.value:e.get(t)}function w4(t,e,r,i,n){if(i==="m")throw new TypeError("Private method is not writable");if(i==="a"&&!n)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!n:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return i==="a"?n.call(t,r):n?n.value=r:e.set(t,r),r}function E4(t,e){if(e===null||typeof e!="object"&&typeof e!="function")throw new TypeError("Cannot use 'in' operator on non-object");return typeof t=="function"?e===t:t.has(e)}function A4(t,e,r){if(e!=null){if(typeof e!="object"&&typeof e!="function")throw new TypeError("Object expected.");var i,n;if(r){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");i=e[Symbol.asyncDispose]}if(i===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");i=e[Symbol.dispose],r&&(n=i)}if(typeof i!="function")throw new TypeError("Object not disposable.");n&&(i=function(){try{n.call(this)}catch(l){return Promise.reject(l)}}),t.stack.push({value:e,dispose:i,async:r})}else r&&t.stack.push({async:!0});return e}var JV=typeof SuppressedError=="function"?SuppressedError:function(t,e,r){var i=new Error(r);return i.name="SuppressedError",i.error=t,i.suppressed=e,i};function T4(t){function e(l){t.error=t.hasError?new JV(l,t.error,"An error was suppressed during disposal."):l,t.hasError=!0}var r,i=0;function n(){for(;r=t.stack.pop();)try{if(!r.async&&i===1)return i=0,t.stack.push(r),Promise.resolve().then(n);if(r.dispose){var l=r.dispose.call(r.value);if(r.async)return i|=2,Promise.resolve(l).then(n,function(c){return e(c),n()})}else i|=1}catch(c){e(c)}if(i===1)return t.hasError?Promise.reject(t.error):Promise.resolve();if(t.hasError)throw t.error}return n()}function S4(t,e){return typeof t=="string"&&/^\.\.?\//.test(t)?t.replace(/\.(tsx)$|((?:\.d)?)((?:\.[^./]+?)?)\.([cm]?)ts$/i,function(r,i,n,l,c){return i?e?".jsx":".js":n&&(!l||!c)?r:n+l+"."+c.toLowerCase()+"js"}):t}const QV={__extends:i4,__assign:Ll,__rest:$d,__decorate:n4,__param:s4,__esDecorate:o4,__runInitializers:a4,__propKey:l4,__setFunctionName:c4,__metadata:u4,__awaiter:or,__generator:h4,__createBinding:$1,__exportStar:d4,__values:i1,__read:cA,__spread:f4,__spreadArrays:p4,__spreadArray:uA,__await:lg,__asyncGenerator:m4,__asyncDelegator:g4,__asyncValues:_4,__makeTemplateObject:y4,__importStar:v4,__importDefault:b4,__classPrivateFieldGet:x4,__classPrivateFieldSet:w4,__classPrivateFieldIn:E4,__addDisposableResource:A4,__disposeResources:T4,__rewriteRelativeImportExtension:S4},eG=Object.freeze(Object.defineProperty({__proto__:null,__addDisposableResource:A4,get __assign(){return Ll},__asyncDelegator:g4,__asyncGenerator:m4,__asyncValues:_4,__await:lg,__awaiter:or,__classPrivateFieldGet:x4,__classPrivateFieldIn:E4,__classPrivateFieldSet:w4,__createBinding:$1,__decorate:n4,__disposeResources:T4,__esDecorate:o4,__exportStar:d4,__extends:i4,__generator:h4,__importDefault:b4,__importStar:v4,__makeTemplateObject:y4,__metadata:u4,__param:s4,__propKey:l4,__read:cA,__rest:$d,__rewriteRelativeImportExtension:S4,__runInitializers:a4,__setFunctionName:c4,__spread:f4,__spreadArray:uA,__spreadArrays:p4,__values:i1,default:QV},Symbol.toStringTag,{value:"Module"})),tG=t=>t?(...e)=>t(...e):(...e)=>fetch(...e);class hA extends Error{constructor(e,r="FunctionsError",i){super(e),this.name=r,this.context=i}}class rG extends hA{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class hC extends hA{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class dC extends hA{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var l2;(function(t){t.Any="any",t.ApNortheast1="ap-northeast-1",t.ApNortheast2="ap-northeast-2",t.ApSouth1="ap-south-1",t.ApSoutheast1="ap-southeast-1",t.ApSoutheast2="ap-southeast-2",t.CaCentral1="ca-central-1",t.EuCentral1="eu-central-1",t.EuWest1="eu-west-1",t.EuWest2="eu-west-2",t.EuWest3="eu-west-3",t.SaEast1="sa-east-1",t.UsEast1="us-east-1",t.UsWest1="us-west-1",t.UsWest2="us-west-2"})(l2||(l2={}));class iG{constructor(e,{headers:r={},customFetch:i,region:n=l2.Any}={}){this.url=e,this.headers=r,this.region=n,this.fetch=tG(i)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e){return or(this,arguments,void 0,function*(r,i={}){var n;let l,c;try{const{headers:o,method:m,body:b,signal:A,timeout:R}=i;let M={},{region:L}=i;L||(L=this.region);const G=new URL(`${this.url}/${r}`);L&&L!=="any"&&(M["x-region"]=L,G.searchParams.set("forceFunctionRegion",L));let V;b&&(o&&!Object.prototype.hasOwnProperty.call(o,"Content-Type")||!o)?typeof Blob<"u"&&b instanceof Blob||b instanceof ArrayBuffer?(M["Content-Type"]="application/octet-stream",V=b):typeof b=="string"?(M["Content-Type"]="text/plain",V=b):typeof FormData<"u"&&b instanceof FormData?V=b:(M["Content-Type"]="application/json",V=JSON.stringify(b)):V=b;let q=A;R&&(c=new AbortController,l=setTimeout(()=>c.abort(),R),A?(q=c.signal,A.addEventListener("abort",()=>c.abort())):q=c.signal);const J=yield this.fetch(G.toString(),{method:m||"POST",headers:Object.assign(Object.assign(Object.assign({},M),this.headers),o),body:V,signal:q}).catch(Se=>{throw new rG(Se)}),ie=J.headers.get("x-relay-error");if(ie&&ie==="true")throw new hC(J);if(!J.ok)throw new dC(J);let ee=((n=J.headers.get("Content-Type"))!==null&&n!==void 0?n:"text/plain").split(";")[0].trim(),me;return ee==="application/json"?me=yield J.json():ee==="application/octet-stream"||ee==="application/pdf"?me=yield J.blob():ee==="text/event-stream"?me=J:ee==="multipart/form-data"?me=yield J.formData():me=yield J.text(),{data:me,error:null,response:J}}catch(o){return{data:null,error:o,response:o instanceof dC||o instanceof hC?o.context:void 0}}finally{l&&clearTimeout(l)}})}}var wo={};const Rg=tN(eG);var G0={},H0={},$0={},W0={},q0={},K0={},fC;function C4(){if(fC)return K0;fC=1,Object.defineProperty(K0,"__esModule",{value:!0});class t extends Error{constructor(r){super(r.message),this.name="PostgrestError",this.details=r.details,this.hint=r.hint,this.code=r.code}}return K0.default=t,K0}var pC;function P4(){if(pC)return q0;pC=1,Object.defineProperty(q0,"__esModule",{value:!0});const e=Rg.__importDefault(C4());class r{constructor(n){var l,c;this.shouldThrowOnError=!1,this.method=n.method,this.url=n.url,this.headers=new Headers(n.headers),this.schema=n.schema,this.body=n.body,this.shouldThrowOnError=(l=n.shouldThrowOnError)!==null&&l!==void 0?l:!1,this.signal=n.signal,this.isMaybeSingle=(c=n.isMaybeSingle)!==null&&c!==void 0?c:!1,n.fetch?this.fetch=n.fetch:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(n,l){return this.headers=new Headers(this.headers),this.headers.set(n,l),this}then(n,l){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const c=this.fetch;let o=c(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async m=>{var b,A,R,M;let L=null,G=null,V=null,q=m.status,J=m.statusText;if(m.ok){if(this.method!=="HEAD"){const Se=await m.text();Se===""||(this.headers.get("Accept")==="text/csv"||this.headers.get("Accept")&&(!((b=this.headers.get("Accept"))===null||b===void 0)&&b.includes("application/vnd.pgrst.plan+text"))?G=Se:G=JSON.parse(Se))}const ee=(A=this.headers.get("Prefer"))===null||A===void 0?void 0:A.match(/count=(exact|planned|estimated)/),me=(R=m.headers.get("content-range"))===null||R===void 0?void 0:R.split("/");ee&&me&&me.length>1&&(V=parseInt(me[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(G)&&(G.length>1?(L={code:"PGRST116",details:`Results contain ${G.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},G=null,V=null,q=406,J="Not Acceptable"):G.length===1?G=G[0]:G=null)}else{const ee=await m.text();try{L=JSON.parse(ee),Array.isArray(L)&&m.status===404&&(G=[],L=null,q=200,J="OK")}catch{m.status===404&&ee===""?(q=204,J="No Content"):L={message:ee}}if(L&&this.isMaybeSingle&&(!((M=L?.details)===null||M===void 0)&&M.includes("0 rows"))&&(L=null,q=200,J="OK"),L&&this.shouldThrowOnError)throw new e.default(L)}return{error:L,data:G,count:V,status:q,statusText:J}});return this.shouldThrowOnError||(o=o.catch(m=>{var b,A,R,M,L,G;let V="";const q=m?.cause;if(q){const J=(b=q?.message)!==null&&b!==void 0?b:"",ie=(A=q?.code)!==null&&A!==void 0?A:"";V=`${(R=m?.name)!==null&&R!==void 0?R:"FetchError"}: ${m?.message}`,V+=`

Caused by: ${(M=q?.name)!==null&&M!==void 0?M:"Error"}: ${J}`,ie&&(V+=` (${ie})`),q?.stack&&(V+=`
${q.stack}`)}else V=(L=m?.stack)!==null&&L!==void 0?L:"";return{error:{message:`${(G=m?.name)!==null&&G!==void 0?G:"FetchError"}: ${m?.message}`,details:V,hint:"",code:""},data:null,count:null,status:0,statusText:""}})),o.then(n,l)}returns(){return this}overrideTypes(){return this}}return q0.default=r,q0}var mC;function R4(){if(mC)return W0;mC=1,Object.defineProperty(W0,"__esModule",{value:!0});const e=Rg.__importDefault(P4());class r extends e.default{select(n){let l=!1;const c=(n??"*").split("").map(o=>/\s/.test(o)&&!l?"":(o==='"'&&(l=!l),o)).join("");return this.url.searchParams.set("select",c),this.headers.append("Prefer","return=representation"),this}order(n,{ascending:l=!0,nullsFirst:c,foreignTable:o,referencedTable:m=o}={}){const b=m?`${m}.order`:"order",A=this.url.searchParams.get(b);return this.url.searchParams.set(b,`${A?`${A},`:""}${n}.${l?"asc":"desc"}${c===void 0?"":c?".nullsfirst":".nullslast"}`),this}limit(n,{foreignTable:l,referencedTable:c=l}={}){const o=typeof c>"u"?"limit":`${c}.limit`;return this.url.searchParams.set(o,`${n}`),this}range(n,l,{foreignTable:c,referencedTable:o=c}={}){const m=typeof o>"u"?"offset":`${o}.offset`,b=typeof o>"u"?"limit":`${o}.limit`;return this.url.searchParams.set(m,`${n}`),this.url.searchParams.set(b,`${l-n+1}`),this}abortSignal(n){return this.signal=n,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:n=!1,verbose:l=!1,settings:c=!1,buffers:o=!1,wal:m=!1,format:b="text"}={}){var A;const R=[n?"analyze":null,l?"verbose":null,c?"settings":null,o?"buffers":null,m?"wal":null].filter(Boolean).join("|"),M=(A=this.headers.get("Accept"))!==null&&A!==void 0?A:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${b}; for="${M}"; options=${R};`),b==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(n){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${n}`),this}}return W0.default=r,W0}var gC;function dA(){if(gC)return $0;gC=1,Object.defineProperty($0,"__esModule",{value:!0});const e=Rg.__importDefault(R4()),r=new RegExp("[,()]");class i extends e.default{eq(l,c){return this.url.searchParams.append(l,`eq.${c}`),this}neq(l,c){return this.url.searchParams.append(l,`neq.${c}`),this}gt(l,c){return this.url.searchParams.append(l,`gt.${c}`),this}gte(l,c){return this.url.searchParams.append(l,`gte.${c}`),this}lt(l,c){return this.url.searchParams.append(l,`lt.${c}`),this}lte(l,c){return this.url.searchParams.append(l,`lte.${c}`),this}like(l,c){return this.url.searchParams.append(l,`like.${c}`),this}likeAllOf(l,c){return this.url.searchParams.append(l,`like(all).{${c.join(",")}}`),this}likeAnyOf(l,c){return this.url.searchParams.append(l,`like(any).{${c.join(",")}}`),this}ilike(l,c){return this.url.searchParams.append(l,`ilike.${c}`),this}ilikeAllOf(l,c){return this.url.searchParams.append(l,`ilike(all).{${c.join(",")}}`),this}ilikeAnyOf(l,c){return this.url.searchParams.append(l,`ilike(any).{${c.join(",")}}`),this}regexMatch(l,c){return this.url.searchParams.append(l,`match.${c}`),this}regexIMatch(l,c){return this.url.searchParams.append(l,`imatch.${c}`),this}is(l,c){return this.url.searchParams.append(l,`is.${c}`),this}isDistinct(l,c){return this.url.searchParams.append(l,`isdistinct.${c}`),this}in(l,c){const o=Array.from(new Set(c)).map(m=>typeof m=="string"&&r.test(m)?`"${m}"`:`${m}`).join(",");return this.url.searchParams.append(l,`in.(${o})`),this}contains(l,c){return typeof c=="string"?this.url.searchParams.append(l,`cs.${c}`):Array.isArray(c)?this.url.searchParams.append(l,`cs.{${c.join(",")}}`):this.url.searchParams.append(l,`cs.${JSON.stringify(c)}`),this}containedBy(l,c){return typeof c=="string"?this.url.searchParams.append(l,`cd.${c}`):Array.isArray(c)?this.url.searchParams.append(l,`cd.{${c.join(",")}}`):this.url.searchParams.append(l,`cd.${JSON.stringify(c)}`),this}rangeGt(l,c){return this.url.searchParams.append(l,`sr.${c}`),this}rangeGte(l,c){return this.url.searchParams.append(l,`nxl.${c}`),this}rangeLt(l,c){return this.url.searchParams.append(l,`sl.${c}`),this}rangeLte(l,c){return this.url.searchParams.append(l,`nxr.${c}`),this}rangeAdjacent(l,c){return this.url.searchParams.append(l,`adj.${c}`),this}overlaps(l,c){return typeof c=="string"?this.url.searchParams.append(l,`ov.${c}`):this.url.searchParams.append(l,`ov.{${c.join(",")}}`),this}textSearch(l,c,{config:o,type:m}={}){let b="";m==="plain"?b="pl":m==="phrase"?b="ph":m==="websearch"&&(b="w");const A=o===void 0?"":`(${o})`;return this.url.searchParams.append(l,`${b}fts${A}.${c}`),this}match(l){return Object.entries(l).forEach(([c,o])=>{this.url.searchParams.append(c,`eq.${o}`)}),this}not(l,c,o){return this.url.searchParams.append(l,`not.${c}.${o}`),this}or(l,{foreignTable:c,referencedTable:o=c}={}){const m=o?`${o}.or`:"or";return this.url.searchParams.append(m,`(${l})`),this}filter(l,c,o){return this.url.searchParams.append(l,`${c}.${o}`),this}}return $0.default=i,$0}var _C;function M4(){if(_C)return H0;_C=1,Object.defineProperty(H0,"__esModule",{value:!0});const e=Rg.__importDefault(dA());class r{constructor(n,{headers:l={},schema:c,fetch:o}){this.url=n,this.headers=new Headers(l),this.schema=c,this.fetch=o}select(n,l){const{head:c=!1,count:o}=l??{},m=c?"HEAD":"GET";let b=!1;const A=(n??"*").split("").map(R=>/\s/.test(R)&&!b?"":(R==='"'&&(b=!b),R)).join("");return this.url.searchParams.set("select",A),o&&this.headers.append("Prefer",`count=${o}`),new e.default({method:m,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(n,{count:l,defaultToNull:c=!0}={}){var o;const m="POST";if(l&&this.headers.append("Prefer",`count=${l}`),c||this.headers.append("Prefer","missing=default"),Array.isArray(n)){const b=n.reduce((A,R)=>A.concat(Object.keys(R)),[]);if(b.length>0){const A=[...new Set(b)].map(R=>`"${R}"`);this.url.searchParams.set("columns",A.join(","))}}return new e.default({method:m,url:this.url,headers:this.headers,schema:this.schema,body:n,fetch:(o=this.fetch)!==null&&o!==void 0?o:fetch})}upsert(n,{onConflict:l,ignoreDuplicates:c=!1,count:o,defaultToNull:m=!0}={}){var b;const A="POST";if(this.headers.append("Prefer",`resolution=${c?"ignore":"merge"}-duplicates`),l!==void 0&&this.url.searchParams.set("on_conflict",l),o&&this.headers.append("Prefer",`count=${o}`),m||this.headers.append("Prefer","missing=default"),Array.isArray(n)){const R=n.reduce((M,L)=>M.concat(Object.keys(L)),[]);if(R.length>0){const M=[...new Set(R)].map(L=>`"${L}"`);this.url.searchParams.set("columns",M.join(","))}}return new e.default({method:A,url:this.url,headers:this.headers,schema:this.schema,body:n,fetch:(b=this.fetch)!==null&&b!==void 0?b:fetch})}update(n,{count:l}={}){var c;const o="PATCH";return l&&this.headers.append("Prefer",`count=${l}`),new e.default({method:o,url:this.url,headers:this.headers,schema:this.schema,body:n,fetch:(c=this.fetch)!==null&&c!==void 0?c:fetch})}delete({count:n}={}){var l;const c="DELETE";return n&&this.headers.append("Prefer",`count=${n}`),new e.default({method:c,url:this.url,headers:this.headers,schema:this.schema,fetch:(l=this.fetch)!==null&&l!==void 0?l:fetch})}}return H0.default=r,H0}var yC;function nG(){if(yC)return G0;yC=1,Object.defineProperty(G0,"__esModule",{value:!0});const t=Rg,e=t.__importDefault(M4()),r=t.__importDefault(dA());class i{constructor(l,{headers:c={},schema:o,fetch:m}={}){this.url=l,this.headers=new Headers(c),this.schemaName=o,this.fetch=m}from(l){if(!l||typeof l!="string"||l.trim()==="")throw new Error("Invalid relation name: relation must be a non-empty string.");const c=new URL(`${this.url}/${l}`);return new e.default(c,{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(l){return new i(this.url,{headers:this.headers,schema:l,fetch:this.fetch})}rpc(l,c={},{head:o=!1,get:m=!1,count:b}={}){var A;let R;const M=new URL(`${this.url}/rpc/${l}`);let L;o||m?(R=o?"HEAD":"GET",Object.entries(c).filter(([V,q])=>q!==void 0).map(([V,q])=>[V,Array.isArray(q)?`{${q.join(",")}}`:`${q}`]).forEach(([V,q])=>{M.searchParams.append(V,q)})):(R="POST",L=c);const G=new Headers(this.headers);return b&&G.set("Prefer",`count=${b}`),new r.default({method:R,url:M,headers:G,schema:this.schemaName,body:L,fetch:(A=this.fetch)!==null&&A!==void 0?A:fetch})}}return G0.default=i,G0}var vC;function sG(){if(vC)return wo;vC=1,Object.defineProperty(wo,"__esModule",{value:!0}),wo.PostgrestError=wo.PostgrestBuilder=wo.PostgrestTransformBuilder=wo.PostgrestFilterBuilder=wo.PostgrestQueryBuilder=wo.PostgrestClient=void 0;const t=Rg,e=t.__importDefault(nG());wo.PostgrestClient=e.default;const r=t.__importDefault(M4());wo.PostgrestQueryBuilder=r.default;const i=t.__importDefault(dA());wo.PostgrestFilterBuilder=i.default;const n=t.__importDefault(R4());wo.PostgrestTransformBuilder=n.default;const l=t.__importDefault(P4());wo.PostgrestBuilder=l.default;const c=t.__importDefault(C4());return wo.PostgrestError=c.default,wo.default={PostgrestClient:e.default,PostgrestQueryBuilder:r.default,PostgrestFilterBuilder:i.default,PostgrestTransformBuilder:n.default,PostgrestBuilder:l.default,PostgrestError:c.default},wo}var I4=sG();const k4=mE(I4),oG=yI({__proto__:null,default:k4},[I4]),{PostgrestClient:aG,PostgrestQueryBuilder:Vpe,PostgrestFilterBuilder:Gpe,PostgrestTransformBuilder:Hpe,PostgrestBuilder:$pe,PostgrestError:Wpe}=k4||oG;class lG{constructor(){}static detectEnvironment(){var e;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((e=navigator.userAgent)===null||e===void 0)&&e.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process<"u"){const r=process.versions;if(r&&r.node){const i=r.node,n=parseInt(i.replace(/^v/,"").split(".")[0]);return n>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${n} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${n} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const e=this.detectEnvironment();if(e.constructor)return e.constructor;let r=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(r+=`

Suggested solution: ${e.workaround}`),new Error(r)}static createWebSocket(e,r){const i=this.getWebSocketConstructor();return new i(e,r)}static isWebSocketSupported(){try{const e=this.detectEnvironment();return e.type==="native"||e.type==="ws"}catch{return!1}}}const cG="2.84.0",uG=`realtime-js/${cG}`,B4="1.0.0",hG="2.0.0",bC=B4,c2=1e4,dG=1e3,fG=100;var hp;(function(t){t[t.connecting=0]="connecting",t[t.open=1]="open",t[t.closing=2]="closing",t[t.closed=3]="closed"})(hp||(hp={}));var Ts;(function(t){t.closed="closed",t.errored="errored",t.joined="joined",t.joining="joining",t.leaving="leaving"})(Ts||(Ts={}));var vc;(function(t){t.close="phx_close",t.error="phx_error",t.join="phx_join",t.reply="phx_reply",t.leave="phx_leave",t.access_token="access_token"})(vc||(vc={}));var u2;(function(t){t.websocket="websocket"})(u2||(u2={}));var dp;(function(t){t.Connecting="connecting",t.Open="open",t.Closing="closing",t.Closed="closed"})(dp||(dp={}));class pG{constructor(){this.HEADER_LENGTH=1,this.META_LENGTH=4,this.USER_BROADCAST_PUSH_META_LENGTH=5,this.KINDS={userBroadcastPush:3,userBroadcast:4},this.BINARY_ENCODING=0,this.JSON_ENCODING=1,this.BROADCAST_EVENT="broadcast"}encode(e,r){if(e.event===this.BROADCAST_EVENT&&!(e.payload instanceof ArrayBuffer)&&typeof e.payload.event=="string")return r(this._binaryEncodeUserBroadcastPush(e));let i=[e.join_ref,e.ref,e.topic,e.event,e.payload];return r(JSON.stringify(i))}_binaryEncodeUserBroadcastPush(e){var r;return this._isArrayBuffer((r=e.payload)===null||r===void 0?void 0:r.payload)?this._encodeBinaryUserBroadcastPush(e):this._encodeJsonUserBroadcastPush(e)}_encodeBinaryUserBroadcastPush(e){var r,i,n,l;const c=e.topic,o=(r=e.ref)!==null&&r!==void 0?r:"",m=(i=e.join_ref)!==null&&i!==void 0?i:"",b=e.payload.event,A=(l=(n=e.payload)===null||n===void 0?void 0:n.payload)!==null&&l!==void 0?l:new ArrayBuffer(0),R=this.USER_BROADCAST_PUSH_META_LENGTH+m.length+o.length+c.length+b.length,M=new ArrayBuffer(this.HEADER_LENGTH+R);let L=new DataView(M),G=0;L.setUint8(G++,this.KINDS.userBroadcastPush),L.setUint8(G++,m.length),L.setUint8(G++,o.length),L.setUint8(G++,c.length),L.setUint8(G++,b.length),L.setUint8(G++,this.BINARY_ENCODING),Array.from(m,q=>L.setUint8(G++,q.charCodeAt(0))),Array.from(o,q=>L.setUint8(G++,q.charCodeAt(0))),Array.from(c,q=>L.setUint8(G++,q.charCodeAt(0))),Array.from(b,q=>L.setUint8(G++,q.charCodeAt(0)));var V=new Uint8Array(M.byteLength+A.byteLength);return V.set(new Uint8Array(M),0),V.set(new Uint8Array(A),M.byteLength),V.buffer}_encodeJsonUserBroadcastPush(e){var r,i,n,l;const c=e.topic,o=(r=e.ref)!==null&&r!==void 0?r:"",m=(i=e.join_ref)!==null&&i!==void 0?i:"",b=e.payload.event,A=(l=(n=e.payload)===null||n===void 0?void 0:n.payload)!==null&&l!==void 0?l:{},M=new TextEncoder().encode(JSON.stringify(A)).buffer,L=this.USER_BROADCAST_PUSH_META_LENGTH+m.length+o.length+c.length+b.length,G=new ArrayBuffer(this.HEADER_LENGTH+L);let V=new DataView(G),q=0;V.setUint8(q++,this.KINDS.userBroadcastPush),V.setUint8(q++,m.length),V.setUint8(q++,o.length),V.setUint8(q++,c.length),V.setUint8(q++,b.length),V.setUint8(q++,this.JSON_ENCODING),Array.from(m,ie=>V.setUint8(q++,ie.charCodeAt(0))),Array.from(o,ie=>V.setUint8(q++,ie.charCodeAt(0))),Array.from(c,ie=>V.setUint8(q++,ie.charCodeAt(0))),Array.from(b,ie=>V.setUint8(q++,ie.charCodeAt(0)));var J=new Uint8Array(G.byteLength+M.byteLength);return J.set(new Uint8Array(G),0),J.set(new Uint8Array(M),G.byteLength),J.buffer}decode(e,r){if(this._isArrayBuffer(e)){let i=this._binaryDecode(e);return r(i)}if(typeof e=="string"){const i=JSON.parse(e),[n,l,c,o,m]=i;return r({join_ref:n,ref:l,topic:c,event:o,payload:m})}return r({})}_binaryDecode(e){const r=new DataView(e),i=r.getUint8(0),n=new TextDecoder;switch(i){case this.KINDS.userBroadcast:return this._decodeUserBroadcast(e,r,n)}}_decodeUserBroadcast(e,r,i){const n=r.getUint8(1),l=r.getUint8(2),c=r.getUint8(3),o=r.getUint8(4);let m=this.HEADER_LENGTH+4;const b=i.decode(e.slice(m,m+n));m=m+n;const A=i.decode(e.slice(m,m+l));m=m+l;const R=i.decode(e.slice(m,m+c));m=m+c;const M=e.slice(m,e.byteLength),L=o===this.JSON_ENCODING?JSON.parse(i.decode(M)):M,G={type:this.BROADCAST_EVENT,event:A,payload:L};return c>0&&(G.meta=JSON.parse(R)),{join_ref:null,ref:null,topic:b,event:this.BROADCAST_EVENT,payload:G}}_isArrayBuffer(e){var r;return e instanceof ArrayBuffer||((r=e?.constructor)===null||r===void 0?void 0:r.name)==="ArrayBuffer"}}class L4{constructor(e,r){this.callback=e,this.timerCalc=r,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=r}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var qi;(function(t){t.abstime="abstime",t.bool="bool",t.date="date",t.daterange="daterange",t.float4="float4",t.float8="float8",t.int2="int2",t.int4="int4",t.int4range="int4range",t.int8="int8",t.int8range="int8range",t.json="json",t.jsonb="jsonb",t.money="money",t.numeric="numeric",t.oid="oid",t.reltime="reltime",t.text="text",t.time="time",t.timestamp="timestamp",t.timestamptz="timestamptz",t.timetz="timetz",t.tsrange="tsrange",t.tstzrange="tstzrange"})(qi||(qi={}));const xC=(t,e,r={})=>{var i;const n=(i=r.skipTypes)!==null&&i!==void 0?i:[];return e?Object.keys(e).reduce((l,c)=>(l[c]=mG(c,t,e,n),l),{}):{}},mG=(t,e,r,i)=>{const n=e.find(o=>o.name===t),l=n?.type,c=r[t];return l&&!i.includes(l)?O4(l,c):h2(c)},O4=(t,e)=>{if(t.charAt(0)==="_"){const r=t.slice(1,t.length);return vG(e,r)}switch(t){case qi.bool:return gG(e);case qi.float4:case qi.float8:case qi.int2:case qi.int4:case qi.int8:case qi.numeric:case qi.oid:return _G(e);case qi.json:case qi.jsonb:return yG(e);case qi.timestamp:return bG(e);case qi.abstime:case qi.date:case qi.daterange:case qi.int4range:case qi.int8range:case qi.money:case qi.reltime:case qi.text:case qi.time:case qi.timestamptz:case qi.timetz:case qi.tsrange:case qi.tstzrange:return h2(e);default:return h2(e)}},h2=t=>t,gG=t=>{switch(t){case"t":return!0;case"f":return!1;default:return t}},_G=t=>{if(typeof t=="string"){const e=parseFloat(t);if(!Number.isNaN(e))return e}return t},yG=t=>{if(typeof t=="string")try{return JSON.parse(t)}catch(e){return console.log(`JSON parse error: ${e}`),t}return t},vG=(t,e)=>{if(typeof t!="string")return t;const r=t.length-1,i=t[r];if(t[0]==="{"&&i==="}"){let l;const c=t.slice(1,r);try{l=JSON.parse("["+c+"]")}catch{l=c?c.split(","):[]}return l.map(o=>O4(e,o))}return t},bG=t=>typeof t=="string"?t.replace(" ","T"):t,D4=t=>{const e=new URL(t);return e.protocol=e.protocol.replace(/^ws/i,"http"),e.pathname=e.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),e.pathname===""||e.pathname==="/"?e.pathname="/api/broadcast":e.pathname=e.pathname+"/api/broadcast",e.href};class dx{constructor(e,r,i={},n=c2){this.channel=e,this.event=r,this.payload=i,this.timeout=n,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,r){var i;return this._hasReceived(e)&&r((i=this.receivedResp)===null||i===void 0?void 0:i.response),this.recHooks.push({status:e,callback:r}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=r=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=r,this._matchReceive(r)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,r){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:r})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:r}){this.recHooks.filter(i=>i.status===e).forEach(i=>i.callback(r))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var wC;(function(t){t.SYNC="sync",t.JOIN="join",t.LEAVE="leave"})(wC||(wC={}));class ty{constructor(e,r){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const i=r?.events||{state:"presence_state",diff:"presence_diff"};this.channel._on(i.state,{},n=>{const{onJoin:l,onLeave:c,onSync:o}=this.caller;this.joinRef=this.channel._joinRef(),this.state=ty.syncState(this.state,n,l,c),this.pendingDiffs.forEach(m=>{this.state=ty.syncDiff(this.state,m,l,c)}),this.pendingDiffs=[],o()}),this.channel._on(i.diff,{},n=>{const{onJoin:l,onLeave:c,onSync:o}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(n):(this.state=ty.syncDiff(this.state,n,l,c),o())}),this.onJoin((n,l,c)=>{this.channel._trigger("presence",{event:"join",key:n,currentPresences:l,newPresences:c})}),this.onLeave((n,l,c)=>{this.channel._trigger("presence",{event:"leave",key:n,currentPresences:l,leftPresences:c})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,r,i,n){const l=this.cloneDeep(e),c=this.transformState(r),o={},m={};return this.map(l,(b,A)=>{c[b]||(m[b]=A)}),this.map(c,(b,A)=>{const R=l[b];if(R){const M=A.map(q=>q.presence_ref),L=R.map(q=>q.presence_ref),G=A.filter(q=>L.indexOf(q.presence_ref)<0),V=R.filter(q=>M.indexOf(q.presence_ref)<0);G.length>0&&(o[b]=G),V.length>0&&(m[b]=V)}else o[b]=A}),this.syncDiff(l,{joins:o,leaves:m},i,n)}static syncDiff(e,r,i,n){const{joins:l,leaves:c}={joins:this.transformState(r.joins),leaves:this.transformState(r.leaves)};return i||(i=()=>{}),n||(n=()=>{}),this.map(l,(o,m)=>{var b;const A=(b=e[o])!==null&&b!==void 0?b:[];if(e[o]=this.cloneDeep(m),A.length>0){const R=e[o].map(L=>L.presence_ref),M=A.filter(L=>R.indexOf(L.presence_ref)<0);e[o].unshift(...M)}i(o,A,m)}),this.map(c,(o,m)=>{let b=e[o];if(!b)return;const A=m.map(R=>R.presence_ref);b=b.filter(R=>A.indexOf(R.presence_ref)<0),e[o]=b,n(o,b,m),b.length===0&&delete e[o]}),e}static map(e,r){return Object.getOwnPropertyNames(e).map(i=>r(i,e[i]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((r,i)=>{const n=e[i];return"metas"in n?r[i]=n.metas.map(l=>(l.presence_ref=l.phx_ref,delete l.phx_ref,delete l.phx_ref_prev,l)):r[i]=n,r},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var EC;(function(t){t.ALL="*",t.INSERT="INSERT",t.UPDATE="UPDATE",t.DELETE="DELETE"})(EC||(EC={}));var ry;(function(t){t.BROADCAST="broadcast",t.PRESENCE="presence",t.POSTGRES_CHANGES="postgres_changes",t.SYSTEM="system"})(ry||(ry={}));var bh;(function(t){t.SUBSCRIBED="SUBSCRIBED",t.TIMED_OUT="TIMED_OUT",t.CLOSED="CLOSED",t.CHANNEL_ERROR="CHANNEL_ERROR"})(bh||(bh={}));class fA{constructor(e,r={config:{}},i){var n,l;if(this.topic=e,this.params=r,this.socket=i,this.bindings={},this.state=Ts.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},r.config),this.timeout=this.socket.timeout,this.joinPush=new dx(this,vc.join,this.params,this.timeout),this.rejoinTimer=new L4(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=Ts.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(c=>c.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=Ts.closed,this.socket._remove(this)}),this._onError(c=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,c),this.state=Ts.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=Ts.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",c=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,c),this.state=Ts.errored,this.rejoinTimer.scheduleTimeout())}),this._on(vc.reply,{},(c,o)=>{this._trigger(this._replyEventName(o),c)}),this.presence=new ty(this),this.broadcastEndpointURL=D4(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(!((l=(n=this.params.config)===null||n===void 0?void 0:n.broadcast)===null||l===void 0)&&l.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(e,r=this.timeout){var i,n,l;if(this.socket.isConnected()||this.socket.connect(),this.state==Ts.closed){const{config:{broadcast:c,presence:o,private:m}}=this.params,b=(n=(i=this.bindings.postgres_changes)===null||i===void 0?void 0:i.map(L=>L.filter))!==null&&n!==void 0?n:[],A=!!this.bindings[ry.PRESENCE]&&this.bindings[ry.PRESENCE].length>0||((l=this.params.config.presence)===null||l===void 0?void 0:l.enabled)===!0,R={},M={broadcast:c,presence:Object.assign(Object.assign({},o),{enabled:A}),postgres_changes:b,private:m};this.socket.accessTokenValue&&(R.access_token=this.socket.accessTokenValue),this._onError(L=>e?.(bh.CHANNEL_ERROR,L)),this._onClose(()=>e?.(bh.CLOSED)),this.updateJoinPayload(Object.assign({config:M},R)),this.joinedOnce=!0,this._rejoin(r),this.joinPush.receive("ok",async({postgres_changes:L})=>{var G;if(this.socket.setAuth(),L===void 0){e?.(bh.SUBSCRIBED);return}else{const V=this.bindings.postgres_changes,q=(G=V?.length)!==null&&G!==void 0?G:0,J=[];for(let ie=0;ie<q;ie++){const ee=V[ie],{filter:{event:me,schema:Se,table:Me,filter:Ve}}=ee,Be=L&&L[ie];if(Be&&Be.event===me&&Be.schema===Se&&Be.table===Me&&Be.filter===Ve)J.push(Object.assign(Object.assign({},ee),{id:Be.id}));else{this.unsubscribe(),this.state=Ts.errored,e?.(bh.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=J,e&&e(bh.SUBSCRIBED);return}}).receive("error",L=>{this.state=Ts.errored,e?.(bh.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(L).join(", ")||"error")))}).receive("timeout",()=>{e?.(bh.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,r={}){return await this.send({type:"presence",event:"track",payload:e},r.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,r,i){return this.state===Ts.joined&&e===ry.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(()=>this.subscribe())),this._on(e,r,i)}async httpSend(e,r,i={}){var n;const l=this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"";if(r==null)return Promise.reject("Payload is required for httpSend()");const c={method:"POST",headers:{Authorization:l,apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:e,payload:r,private:this.private}]})},o=await this._fetchWithTimeout(this.broadcastEndpointURL,c,(n=i.timeout)!==null&&n!==void 0?n:this.timeout);if(o.status===202)return{success:!0};let m=o.statusText;try{const b=await o.json();m=b.error||b.message||m}catch{}return Promise.reject(new Error(m))}async send(e,r={}){var i,n;if(!this._canPush()&&e.type==="broadcast"){console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");const{event:l,payload:c}=e,m={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:l,payload:c,private:this.private}]})};try{const b=await this._fetchWithTimeout(this.broadcastEndpointURL,m,(i=r.timeout)!==null&&i!==void 0?i:this.timeout);return await((n=b.body)===null||n===void 0?void 0:n.cancel()),b.ok?"ok":"error"}catch(b){return b.name==="AbortError"?"timed out":"error"}}else return new Promise(l=>{var c,o,m;const b=this._push(e.type,e,r.timeout||this.timeout);e.type==="broadcast"&&!(!((m=(o=(c=this.params)===null||c===void 0?void 0:c.config)===null||o===void 0?void 0:o.broadcast)===null||m===void 0)&&m.ack)&&l("ok"),b.receive("ok",()=>l("ok")),b.receive("error",()=>l("error")),b.receive("timeout",()=>l("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=Ts.leaving;const r=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(vc.close,"leave",this._joinRef())};this.joinPush.destroy();let i=null;return new Promise(n=>{i=new dx(this,vc.leave,{},e),i.receive("ok",()=>{r(),n("ok")}).receive("timeout",()=>{r(),n("timed out")}).receive("error",()=>{n("error")}),i.send(),this._canPush()||i.trigger("ok",{})}).finally(()=>{i?.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=Ts.closed,this.bindings={}}async _fetchWithTimeout(e,r,i){const n=new AbortController,l=setTimeout(()=>n.abort(),i),c=await this.socket.fetch(e,Object.assign(Object.assign({},r),{signal:n.signal}));return clearTimeout(l),c}_push(e,r,i=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let n=new dx(this,e,r,i);return this._canPush()?n.send():this._addToPushBuffer(n),n}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>fG){const r=this.pushBuffer.shift();r&&(r.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${r.event}`,r.payload))}}_onMessage(e,r,i){return r}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,r,i){var n,l;const c=e.toLocaleLowerCase(),{close:o,error:m,leave:b,join:A}=vc;if(i&&[o,m,b,A].indexOf(c)>=0&&i!==this._joinRef())return;let M=this._onMessage(c,r,i);if(r&&!M)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(c)?(n=this.bindings.postgres_changes)===null||n===void 0||n.filter(L=>{var G,V,q;return((G=L.filter)===null||G===void 0?void 0:G.event)==="*"||((q=(V=L.filter)===null||V===void 0?void 0:V.event)===null||q===void 0?void 0:q.toLocaleLowerCase())===c}).map(L=>L.callback(M,i)):(l=this.bindings[c])===null||l===void 0||l.filter(L=>{var G,V,q,J,ie,ee;if(["broadcast","presence","postgres_changes"].includes(c))if("id"in L){const me=L.id,Se=(G=L.filter)===null||G===void 0?void 0:G.event;return me&&((V=r.ids)===null||V===void 0?void 0:V.includes(me))&&(Se==="*"||Se?.toLocaleLowerCase()===((q=r.data)===null||q===void 0?void 0:q.type.toLocaleLowerCase()))}else{const me=(ie=(J=L?.filter)===null||J===void 0?void 0:J.event)===null||ie===void 0?void 0:ie.toLocaleLowerCase();return me==="*"||me===((ee=r?.event)===null||ee===void 0?void 0:ee.toLocaleLowerCase())}else return L.type.toLocaleLowerCase()===c}).map(L=>{if(typeof M=="object"&&"ids"in M){const G=M.data,{schema:V,table:q,commit_timestamp:J,type:ie,errors:ee}=G;M=Object.assign(Object.assign({},{schema:V,table:q,commit_timestamp:J,eventType:ie,new:{},old:{},errors:ee}),this._getPayloadRecords(G))}L.callback(M,i)})}_isClosed(){return this.state===Ts.closed}_isJoined(){return this.state===Ts.joined}_isJoining(){return this.state===Ts.joining}_isLeaving(){return this.state===Ts.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,r,i){const n=e.toLocaleLowerCase(),l={type:n,filter:r,callback:i};return this.bindings[n]?this.bindings[n].push(l):this.bindings[n]=[l],this}_off(e,r){const i=e.toLocaleLowerCase();return this.bindings[i]&&(this.bindings[i]=this.bindings[i].filter(n=>{var l;return!(((l=n.type)===null||l===void 0?void 0:l.toLocaleLowerCase())===i&&fA.isEqual(n.filter,r))})),this}static isEqual(e,r){if(Object.keys(e).length!==Object.keys(r).length)return!1;for(const i in e)if(e[i]!==r[i])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(vc.close,{},e)}_onError(e){this._on(vc.error,{},r=>e(r))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=Ts.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const r={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(r.new=xC(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(r.old=xC(e.columns,e.old_record)),r}}const fx=()=>{},Z0={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},xG=[1e3,2e3,5e3,1e4],wG=1e4,EG=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class AG{constructor(e,r){var i;if(this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=c2,this.transport=null,this.heartbeatIntervalMs=Z0.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=fx,this.ref=0,this.reconnectTimer=null,this.vsn=bC,this.logger=fx,this.conn=null,this.sendBuffer=[],this.serializer=new pG,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=n=>n?(...l)=>n(...l):(...l)=>fetch(...l),!(!((i=r?.params)===null||i===void 0)&&i.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=r.params.apikey,this.endPoint=`${e}/${u2.websocket}`,this.httpEndpoint=D4(e),this._initializeOptions(r),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(r?.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this.accessToken&&!this._authPromise&&this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=lG.createWebSocket(this.endpointURL())}catch(e){this._setConnectionState("disconnected");const r=e.message;throw r.includes("Node.js")?new Error(`${r}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${r}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:this.vsn}))}disconnect(e,r){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const i=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(i),this._setConnectionState("disconnected")},typeof this.conn.close=="function"&&(e?this.conn.close(e,r??""):this.conn.close()),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(e){const r=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),r}async removeAllChannels(){const e=await Promise.all(this.channels.map(r=>r.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,r,i){this.logger(e,r,i)}connectionState(){switch(this.conn&&this.conn.readyState){case hp.connecting:return dp.Connecting;case hp.open:return dp.Open;case hp.closing:return dp.Closing;default:return dp.Closed}}isConnected(){return this.connectionState()===dp.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(e,r={config:{}}){const i=`realtime:${e}`,n=this.getChannels().find(l=>l.topic===i);if(n)return n;{const l=new fA(`realtime:${e}`,r,this);return this.channels.push(l),l}}push(e){const{topic:r,event:i,payload:n,ref:l}=e,c=()=>{this.encode(e,o=>{var m;(m=this.conn)===null||m===void 0||m.send(o)})};this.log("push",`${r} ${i} (${l})`,n),this.isConnected()?c():this.sendBuffer.push(c)}async setAuth(e=null){this._authPromise=this._performAuth(e);try{await this._authPromise}finally{this._authPromise=null}}async sendHeartbeat(){var e;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(r){this.log("error","error in heartbeat callback",r)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(r){this.log("error","error in heartbeat callback",r)}this._wasManualDisconnect=!1,(e=this.conn)===null||e===void 0||e.close(dG,"heartbeat timeout"),setTimeout(()=>{var r;this.isConnected()||(r=this.reconnectTimer)===null||r===void 0||r.scheduleTimeout()},Z0.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(r){this.log("error","error in heartbeat callback",r)}this._setAuthSafely("heartbeat")}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let r=this.channels.find(i=>i.topic===e&&(i._isJoined()||i._isJoining()));r&&(this.log("transport",`leaving duplicate topic "${e}"`),r.unsubscribe())}_remove(e){this.channels=this.channels.filter(r=>r.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,r=>{if(r.topic==="phoenix"&&r.event==="phx_reply")try{this.heartbeatCallback(r.payload.status==="ok"?"ok":"error")}catch(b){this.log("error","error in heartbeat callback",b)}r.ref&&r.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:i,event:n,payload:l,ref:c}=r,o=c?`(${c})`:"",m=l.status||"";this.log("receive",`${m} ${i} ${n} ${o}`.trim(),l),this.channels.filter(b=>b._isMember(i)).forEach(b=>b._trigger(n,l,c)),this._triggerStateCallbacks("message",r)})}_clearTimer(e){var r;e==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):e==="reconnect"&&((r=this.reconnectTimer)===null||r===void 0||r.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_teardownConnection(){if(this.conn){if(this.conn.readyState===hp.open||this.conn.readyState===hp.connecting)try{this.conn.close()}catch(e){this.log("error","Error closing connection",e)}this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null}this._clearAllTimers(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),(this._authPromise||(this.accessToken&&!this.accessTokenValue?this.setAuth():Promise.resolve())).then(()=>{this.flushSendBuffer()}).catch(r=>{this.log("error","error waiting for auth on connect",r),this.flushSendBuffer()}),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=r=>{this.log("worker","worker error",r.message),this.workerRef.terminate()},this.workerRef.onmessage=r=>{r.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(e){var r;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(r=this.reconnectTimer)===null||r===void 0||r.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport",`${e}`),this._triggerChanError(),this._triggerStateCallbacks("error",e)}_triggerChanError(){this.channels.forEach(e=>e._trigger(vc.error))}_appendParams(e,r){if(Object.keys(r).length===0)return e;const i=e.match(/\?/)?"&":"?",n=new URLSearchParams(r);return`${e}${i}${n}`}_workerObjectUrl(e){let r;if(e)r=e;else{const i=new Blob([EG],{type:"application/javascript"});r=URL.createObjectURL(i)}return r}_setConnectionState(e,r=!1){this._connectionState=e,e==="connecting"?this._wasManualDisconnect=!1:e==="disconnecting"&&(this._wasManualDisconnect=r)}async _performAuth(e=null){let r;e?r=e:this.accessToken?r=await this.accessToken():r=this.accessTokenValue,this.accessTokenValue!=r&&(this.accessTokenValue=r,this.channels.forEach(i=>{const n={access_token:r,version:uG};r&&i.updateJoinPayload(n),i.joinedOnce&&i._isJoined()&&i._push(vc.access_token,{access_token:r})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(e="general"){this.setAuth().catch(r=>{this.log("error",`error setting auth in ${e}`,r)})}_triggerStateCallbacks(e,r){try{this.stateChangeCallbacks[e].forEach(i=>{try{i(r)}catch(n){this.log("error",`error in ${e} callback`,n)}})}catch(i){this.log("error",`error triggering ${e} callbacks`,i)}}_setupReconnectionTimer(){this.reconnectTimer=new L4(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},Z0.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(e){var r,i,n,l,c,o,m,b,A,R,M,L;switch(this.transport=(r=e?.transport)!==null&&r!==void 0?r:null,this.timeout=(i=e?.timeout)!==null&&i!==void 0?i:c2,this.heartbeatIntervalMs=(n=e?.heartbeatIntervalMs)!==null&&n!==void 0?n:Z0.HEARTBEAT_INTERVAL,this.worker=(l=e?.worker)!==null&&l!==void 0?l:!1,this.accessToken=(c=e?.accessToken)!==null&&c!==void 0?c:null,this.heartbeatCallback=(o=e?.heartbeatCallback)!==null&&o!==void 0?o:fx,this.vsn=(m=e?.vsn)!==null&&m!==void 0?m:bC,e?.params&&(this.params=e.params),e?.logger&&(this.logger=e.logger),(e?.logLevel||e?.log_level)&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(b=e?.reconnectAfterMs)!==null&&b!==void 0?b:(G=>xG[G-1]||wG),this.vsn){case B4:this.encode=(A=e?.encode)!==null&&A!==void 0?A:((G,V)=>V(JSON.stringify(G))),this.decode=(R=e?.decode)!==null&&R!==void 0?R:((G,V)=>V(JSON.parse(G)));break;case hG:this.encode=(M=e?.encode)!==null&&M!==void 0?M:this.serializer.encode.bind(this.serializer),this.decode=(L=e?.decode)!==null&&L!==void 0?L:this.serializer.decode.bind(this.serializer);break;default:throw new Error(`Unsupported serializer version: ${this.vsn}`)}if(this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=e?.workerUrl}}}class pA extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function wn(t){return typeof t=="object"&&t!==null&&"__isStorageError"in t}class TG extends pA{constructor(e,r,i){super(e),this.name="StorageApiError",this.status=r,this.statusCode=i}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class d2 extends pA{constructor(e,r){super(e),this.name="StorageUnknownError",this.originalError=r}}const mA=t=>t?(...e)=>t(...e):(...e)=>fetch(...e),SG=()=>Response,f2=t=>{if(Array.isArray(t))return t.map(r=>f2(r));if(typeof t=="function"||t!==Object(t))return t;const e={};return Object.entries(t).forEach(([r,i])=>{const n=r.replace(/([-_][a-z])/gi,l=>l.toUpperCase().replace(/[-_]/g,""));e[n]=f2(i)}),e},CG=t=>{if(typeof t!="object"||t===null)return!1;const e=Object.getPrototypeOf(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)},px=t=>{var e;return t.msg||t.message||t.error_description||(typeof t.error=="string"?t.error:(e=t.error)===null||e===void 0?void 0:e.message)||JSON.stringify(t)},PG=(t,e,r)=>or(void 0,void 0,void 0,function*(){const i=yield SG();t instanceof i&&!r?.noResolveJson?t.json().then(n=>{const l=t.status||500,c=n?.statusCode||l+"";e(new TG(px(n),l,c))}).catch(n=>{e(new d2(px(n),n))}):e(new d2(px(t),t))}),RG=(t,e,r,i)=>{const n={method:t,headers:e?.headers||{}};return t==="GET"||!i?n:(CG(i)?(n.headers=Object.assign({"Content-Type":"application/json"},e?.headers),n.body=JSON.stringify(i)):n.body=i,e?.duplex&&(n.duplex=e.duplex),Object.assign(Object.assign({},n),r))};function zy(t,e,r,i,n,l){return or(this,void 0,void 0,function*(){return new Promise((c,o)=>{t(r,RG(e,i,n,l)).then(m=>{if(!m.ok)throw m;return i?.noResolveJson?m:m.json()}).then(m=>c(m)).catch(m=>PG(m,o,i))})})}function _y(t,e,r,i){return or(this,void 0,void 0,function*(){return zy(t,"GET",e,r,i)})}function yc(t,e,r,i,n){return or(this,void 0,void 0,function*(){return zy(t,"POST",e,i,n,r)})}function p2(t,e,r,i,n){return or(this,void 0,void 0,function*(){return zy(t,"PUT",e,i,n,r)})}function MG(t,e,r,i){return or(this,void 0,void 0,function*(){return zy(t,"HEAD",e,Object.assign(Object.assign({},r),{noResolveJson:!0}),i)})}function gA(t,e,r,i,n){return or(this,void 0,void 0,function*(){return zy(t,"DELETE",e,i,n,r)})}class IG{constructor(e,r){this.downloadFn=e,this.shouldThrowOnError=r}then(e,r){return this.execute().then(e,r)}execute(){return or(this,void 0,void 0,function*(){try{return{data:(yield this.downloadFn()).body,error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(wn(e))return{data:null,error:e};throw e}})}}var N4;class kG{constructor(e,r){this.downloadFn=e,this.shouldThrowOnError=r,this[N4]="BlobDownloadBuilder",this.promise=null}asStream(){return new IG(this.downloadFn,this.shouldThrowOnError)}then(e,r){return this.getPromise().then(e,r)}catch(e){return this.getPromise().catch(e)}finally(e){return this.getPromise().finally(e)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}execute(){return or(this,void 0,void 0,function*(){try{return{data:yield(yield this.downloadFn()).blob(),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(wn(e))return{data:null,error:e};throw e}})}}N4=Symbol.toStringTag;const BG={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},AC={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class LG{constructor(e,r={},i,n){this.shouldThrowOnError=!1,this.url=e,this.headers=r,this.bucketId=i,this.fetch=mA(n)}throwOnError(){return this.shouldThrowOnError=!0,this}uploadOrUpdate(e,r,i,n){return or(this,void 0,void 0,function*(){try{let l;const c=Object.assign(Object.assign({},AC),n);let o=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(c.upsert)});const m=c.metadata;typeof Blob<"u"&&i instanceof Blob?(l=new FormData,l.append("cacheControl",c.cacheControl),m&&l.append("metadata",this.encodeMetadata(m)),l.append("",i)):typeof FormData<"u"&&i instanceof FormData?(l=i,l.has("cacheControl")||l.append("cacheControl",c.cacheControl),m&&!l.has("metadata")&&l.append("metadata",this.encodeMetadata(m))):(l=i,o["cache-control"]=`max-age=${c.cacheControl}`,o["content-type"]=c.contentType,m&&(o["x-metadata"]=this.toBase64(this.encodeMetadata(m))),(typeof ReadableStream<"u"&&l instanceof ReadableStream||l&&typeof l=="object"&&"pipe"in l&&typeof l.pipe=="function")&&!c.duplex&&(c.duplex="half")),n?.headers&&(o=Object.assign(Object.assign({},o),n.headers));const b=this._removeEmptyFolders(r),A=this._getFinalPath(b),R=yield(e=="PUT"?p2:yc)(this.fetch,`${this.url}/object/${A}`,l,Object.assign({headers:o},c?.duplex?{duplex:c.duplex}:{}));return{data:{path:b,id:R.Id,fullPath:R.Key},error:null}}catch(l){if(this.shouldThrowOnError)throw l;if(wn(l))return{data:null,error:l};throw l}})}upload(e,r,i){return or(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,r,i)})}uploadToSignedUrl(e,r,i,n){return or(this,void 0,void 0,function*(){const l=this._removeEmptyFolders(e),c=this._getFinalPath(l),o=new URL(this.url+`/object/upload/sign/${c}`);o.searchParams.set("token",r);try{let m;const b=Object.assign({upsert:AC.upsert},n),A=Object.assign(Object.assign({},this.headers),{"x-upsert":String(b.upsert)});typeof Blob<"u"&&i instanceof Blob?(m=new FormData,m.append("cacheControl",b.cacheControl),m.append("",i)):typeof FormData<"u"&&i instanceof FormData?(m=i,m.append("cacheControl",b.cacheControl)):(m=i,A["cache-control"]=`max-age=${b.cacheControl}`,A["content-type"]=b.contentType);const R=yield p2(this.fetch,o.toString(),m,{headers:A});return{data:{path:l,fullPath:R.Key},error:null}}catch(m){if(this.shouldThrowOnError)throw m;if(wn(m))return{data:null,error:m};throw m}})}createSignedUploadUrl(e,r){return or(this,void 0,void 0,function*(){try{let i=this._getFinalPath(e);const n=Object.assign({},this.headers);r?.upsert&&(n["x-upsert"]="true");const l=yield yc(this.fetch,`${this.url}/object/upload/sign/${i}`,{},{headers:n}),c=new URL(this.url+l.url),o=c.searchParams.get("token");if(!o)throw new pA("No token returned by API");return{data:{signedUrl:c.toString(),path:e,token:o},error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(wn(i))return{data:null,error:i};throw i}})}update(e,r,i){return or(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,r,i)})}move(e,r,i){return or(this,void 0,void 0,function*(){try{return{data:yield yc(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:r,destinationBucket:i?.destinationBucket},{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(wn(n))return{data:null,error:n};throw n}})}copy(e,r,i){return or(this,void 0,void 0,function*(){try{return{data:{path:(yield yc(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:r,destinationBucket:i?.destinationBucket},{headers:this.headers})).Key},error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(wn(n))return{data:null,error:n};throw n}})}createSignedUrl(e,r,i){return or(this,void 0,void 0,function*(){try{let n=this._getFinalPath(e),l=yield yc(this.fetch,`${this.url}/object/sign/${n}`,Object.assign({expiresIn:r},i?.transform?{transform:i.transform}:{}),{headers:this.headers});const c=i?.download?`&download=${i.download===!0?"":i.download}`:"";return l={signedUrl:encodeURI(`${this.url}${l.signedURL}${c}`)},{data:l,error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(wn(n))return{data:null,error:n};throw n}})}createSignedUrls(e,r,i){return or(this,void 0,void 0,function*(){try{const n=yield yc(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:r,paths:e},{headers:this.headers}),l=i?.download?`&download=${i.download===!0?"":i.download}`:"";return{data:n.map(c=>Object.assign(Object.assign({},c),{signedUrl:c.signedURL?encodeURI(`${this.url}${c.signedURL}${l}`):null})),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(wn(n))return{data:null,error:n};throw n}})}download(e,r){const n=typeof r?.transform<"u"?"render/image/authenticated":"object",l=this.transformOptsToQueryString(r?.transform||{}),c=l?`?${l}`:"",o=this._getFinalPath(e),m=()=>_y(this.fetch,`${this.url}/${n}/${o}${c}`,{headers:this.headers,noResolveJson:!0});return new kG(m,this.shouldThrowOnError)}info(e){return or(this,void 0,void 0,function*(){const r=this._getFinalPath(e);try{const i=yield _y(this.fetch,`${this.url}/object/info/${r}`,{headers:this.headers});return{data:f2(i),error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(wn(i))return{data:null,error:i};throw i}})}exists(e){return or(this,void 0,void 0,function*(){const r=this._getFinalPath(e);try{return yield MG(this.fetch,`${this.url}/object/${r}`,{headers:this.headers}),{data:!0,error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(wn(i)&&i instanceof d2){const n=i.originalError;if([400,404].includes(n?.status))return{data:!1,error:i}}throw i}})}getPublicUrl(e,r){const i=this._getFinalPath(e),n=[],l=r?.download?`download=${r.download===!0?"":r.download}`:"";l!==""&&n.push(l);const o=typeof r?.transform<"u"?"render/image":"object",m=this.transformOptsToQueryString(r?.transform||{});m!==""&&n.push(m);let b=n.join("&");return b!==""&&(b=`?${b}`),{data:{publicUrl:encodeURI(`${this.url}/${o}/public/${i}${b}`)}}}remove(e){return or(this,void 0,void 0,function*(){try{return{data:yield gA(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(wn(r))return{data:null,error:r};throw r}})}list(e,r,i){return or(this,void 0,void 0,function*(){try{const n=Object.assign(Object.assign(Object.assign({},BG),r),{prefix:e||""});return{data:yield yc(this.fetch,`${this.url}/object/list/${this.bucketId}`,n,{headers:this.headers},i),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(wn(n))return{data:null,error:n};throw n}})}listV2(e,r){return or(this,void 0,void 0,function*(){try{const i=Object.assign({},e);return{data:yield yc(this.fetch,`${this.url}/object/list-v2/${this.bucketId}`,i,{headers:this.headers},r),error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(wn(i))return{data:null,error:i};throw i}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e.replace(/^\/+/,"")}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const r=[];return e.width&&r.push(`width=${e.width}`),e.height&&r.push(`height=${e.height}`),e.resize&&r.push(`resize=${e.resize}`),e.format&&r.push(`format=${e.format}`),e.quality&&r.push(`quality=${e.quality}`),r.join("&")}}const F4="2.84.0",z4={"X-Client-Info":`storage-js/${F4}`};class OG{constructor(e,r={},i,n){this.shouldThrowOnError=!1;const l=new URL(e);n?.useNewHostname&&/supabase\.(co|in|red)$/.test(l.hostname)&&!l.hostname.includes("storage.supabase.")&&(l.hostname=l.hostname.replace("supabase.","storage.supabase.")),this.url=l.href.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},z4),r),this.fetch=mA(i)}throwOnError(){return this.shouldThrowOnError=!0,this}listBuckets(e){return or(this,void 0,void 0,function*(){try{const r=this.listBucketOptionsToQueryString(e);return{data:yield _y(this.fetch,`${this.url}/bucket${r}`,{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(wn(r))return{data:null,error:r};throw r}})}getBucket(e){return or(this,void 0,void 0,function*(){try{return{data:yield _y(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(wn(r))return{data:null,error:r};throw r}})}createBucket(e){return or(this,arguments,void 0,function*(r,i={public:!1}){try{return{data:yield yc(this.fetch,`${this.url}/bucket`,{id:r,name:r,type:i.type,public:i.public,file_size_limit:i.fileSizeLimit,allowed_mime_types:i.allowedMimeTypes},{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(wn(n))return{data:null,error:n};throw n}})}updateBucket(e,r){return or(this,void 0,void 0,function*(){try{return{data:yield p2(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:r.public,file_size_limit:r.fileSizeLimit,allowed_mime_types:r.allowedMimeTypes},{headers:this.headers}),error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(wn(i))return{data:null,error:i};throw i}})}emptyBucket(e){return or(this,void 0,void 0,function*(){try{return{data:yield yc(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(wn(r))return{data:null,error:r};throw r}})}deleteBucket(e){return or(this,void 0,void 0,function*(){try{return{data:yield gA(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(wn(r))return{data:null,error:r};throw r}})}listBucketOptionsToQueryString(e){const r={};return e&&("limit"in e&&(r.limit=String(e.limit)),"offset"in e&&(r.offset=String(e.offset)),e.search&&(r.search=e.search),e.sortColumn&&(r.sortColumn=e.sortColumn),e.sortOrder&&(r.sortOrder=e.sortOrder)),Object.keys(r).length>0?"?"+new URLSearchParams(r).toString():""}}class DG{constructor(e,r={},i){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},z4),r),this.fetch=mA(i)}throwOnError(){return this.shouldThrowOnError=!0,this}createBucket(e){return or(this,void 0,void 0,function*(){try{return{data:yield yc(this.fetch,`${this.url}/bucket`,{name:e},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(wn(r))return{data:null,error:r};throw r}})}listBuckets(e){return or(this,void 0,void 0,function*(){try{const r=new URLSearchParams;e?.limit!==void 0&&r.set("limit",e.limit.toString()),e?.offset!==void 0&&r.set("offset",e.offset.toString()),e?.sortColumn&&r.set("sortColumn",e.sortColumn),e?.sortOrder&&r.set("sortOrder",e.sortOrder),e?.search&&r.set("search",e.search);const i=r.toString(),n=i?`${this.url}/bucket?${i}`:`${this.url}/bucket`;return{data:yield _y(this.fetch,n,{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(wn(r))return{data:null,error:r};throw r}})}deleteBucket(e){return or(this,void 0,void 0,function*(){try{return{data:yield gA(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(wn(r))return{data:null,error:r};throw r}})}}const _A={"X-Client-Info":`storage-js/${F4}`,"Content-Type":"application/json"};class j4 extends Error{constructor(e){super(e),this.__isStorageVectorsError=!0,this.name="StorageVectorsError"}}function el(t){return typeof t=="object"&&t!==null&&"__isStorageVectorsError"in t}class mx extends j4{constructor(e,r,i){super(e),this.name="StorageVectorsApiError",this.status=r,this.statusCode=i}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class NG extends j4{constructor(e,r){super(e),this.name="StorageVectorsUnknownError",this.originalError=r}}var TC;(function(t){t.InternalError="InternalError",t.S3VectorConflictException="S3VectorConflictException",t.S3VectorNotFoundException="S3VectorNotFoundException",t.S3VectorBucketNotEmpty="S3VectorBucketNotEmpty",t.S3VectorMaxBucketsExceeded="S3VectorMaxBucketsExceeded",t.S3VectorMaxIndexesExceeded="S3VectorMaxIndexesExceeded"})(TC||(TC={}));const yA=t=>t?(...e)=>t(...e):(...e)=>fetch(...e),FG=t=>{if(typeof t!="object"||t===null)return!1;const e=Object.getPrototypeOf(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)},SC=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),zG=(t,e,r)=>or(void 0,void 0,void 0,function*(){if(t&&typeof t=="object"&&"status"in t&&"ok"in t&&typeof t.status=="number"&&!r?.noResolveJson){const n=t.status||500,l=t;if(typeof l.json=="function")l.json().then(c=>{const o=c?.statusCode||c?.code||n+"";e(new mx(SC(c),n,o))}).catch(()=>{const c=n+"",o=l.statusText||`HTTP ${n} error`;e(new mx(o,n,c))});else{const c=n+"",o=l.statusText||`HTTP ${n} error`;e(new mx(o,n,c))}}else e(new NG(SC(t),t))}),jG=(t,e,r,i)=>{const n={method:t,headers:e?.headers||{}};return i?(FG(i)?(n.headers=Object.assign({"Content-Type":"application/json"},e?.headers),n.body=JSON.stringify(i)):n.body=i,Object.assign(Object.assign({},n),r)):n};function UG(t,e,r,i,n,l){return or(this,void 0,void 0,function*(){return new Promise((c,o)=>{t(r,jG(e,i,n,l)).then(m=>{if(!m.ok)throw m;if(i?.noResolveJson)return m;const b=m.headers.get("content-type");return!b||!b.includes("application/json")?{}:m.json()}).then(m=>c(m)).catch(m=>zG(m,o,i))})})}function tl(t,e,r,i,n){return or(this,void 0,void 0,function*(){return UG(t,"POST",e,i,n,r)})}class VG{constructor(e,r={},i){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},_A),r),this.fetch=yA(i)}throwOnError(){return this.shouldThrowOnError=!0,this}createIndex(e){return or(this,void 0,void 0,function*(){try{return{data:(yield tl(this.fetch,`${this.url}/CreateIndex`,e,{headers:this.headers}))||{},error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(el(r))return{data:null,error:r};throw r}})}getIndex(e,r){return or(this,void 0,void 0,function*(){try{return{data:yield tl(this.fetch,`${this.url}/GetIndex`,{vectorBucketName:e,indexName:r},{headers:this.headers}),error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(el(i))return{data:null,error:i};throw i}})}listIndexes(e){return or(this,void 0,void 0,function*(){try{return{data:yield tl(this.fetch,`${this.url}/ListIndexes`,e,{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(el(r))return{data:null,error:r};throw r}})}deleteIndex(e,r){return or(this,void 0,void 0,function*(){try{return{data:(yield tl(this.fetch,`${this.url}/DeleteIndex`,{vectorBucketName:e,indexName:r},{headers:this.headers}))||{},error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(el(i))return{data:null,error:i};throw i}})}}class GG{constructor(e,r={},i){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},_A),r),this.fetch=yA(i)}throwOnError(){return this.shouldThrowOnError=!0,this}putVectors(e){return or(this,void 0,void 0,function*(){try{if(e.vectors.length<1||e.vectors.length>500)throw new Error("Vector batch size must be between 1 and 500 items");return{data:(yield tl(this.fetch,`${this.url}/PutVectors`,e,{headers:this.headers}))||{},error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(el(r))return{data:null,error:r};throw r}})}getVectors(e){return or(this,void 0,void 0,function*(){try{return{data:yield tl(this.fetch,`${this.url}/GetVectors`,e,{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(el(r))return{data:null,error:r};throw r}})}listVectors(e){return or(this,void 0,void 0,function*(){try{if(e.segmentCount!==void 0){if(e.segmentCount<1||e.segmentCount>16)throw new Error("segmentCount must be between 1 and 16");if(e.segmentIndex!==void 0&&(e.segmentIndex<0||e.segmentIndex>=e.segmentCount))throw new Error(`segmentIndex must be between 0 and ${e.segmentCount-1}`)}return{data:yield tl(this.fetch,`${this.url}/ListVectors`,e,{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(el(r))return{data:null,error:r};throw r}})}queryVectors(e){return or(this,void 0,void 0,function*(){try{return{data:yield tl(this.fetch,`${this.url}/QueryVectors`,e,{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(el(r))return{data:null,error:r};throw r}})}deleteVectors(e){return or(this,void 0,void 0,function*(){try{if(e.keys.length<1||e.keys.length>500)throw new Error("Keys batch size must be between 1 and 500 items");return{data:(yield tl(this.fetch,`${this.url}/DeleteVectors`,e,{headers:this.headers}))||{},error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(el(r))return{data:null,error:r};throw r}})}}class HG{constructor(e,r={},i){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},_A),r),this.fetch=yA(i)}throwOnError(){return this.shouldThrowOnError=!0,this}createBucket(e){return or(this,void 0,void 0,function*(){try{return{data:(yield tl(this.fetch,`${this.url}/CreateVectorBucket`,{vectorBucketName:e},{headers:this.headers}))||{},error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(el(r))return{data:null,error:r};throw r}})}getBucket(e){return or(this,void 0,void 0,function*(){try{return{data:yield tl(this.fetch,`${this.url}/GetVectorBucket`,{vectorBucketName:e},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(el(r))return{data:null,error:r};throw r}})}listBuckets(){return or(this,arguments,void 0,function*(e={}){try{return{data:yield tl(this.fetch,`${this.url}/ListVectorBuckets`,e,{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(el(r))return{data:null,error:r};throw r}})}deleteBucket(e){return or(this,void 0,void 0,function*(){try{return{data:(yield tl(this.fetch,`${this.url}/DeleteVectorBucket`,{vectorBucketName:e},{headers:this.headers}))||{},error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(el(r))return{data:null,error:r};throw r}})}}class $G extends HG{constructor(e,r={}){super(e,r.headers||{},r.fetch)}from(e){return new WG(this.url,this.headers,e,this.fetch)}}class WG extends VG{constructor(e,r,i,n){super(e,r,n),this.vectorBucketName=i}createIndex(e){const r=Object.create(null,{createIndex:{get:()=>super.createIndex}});return or(this,void 0,void 0,function*(){return r.createIndex.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName}))})}listIndexes(){const e=Object.create(null,{listIndexes:{get:()=>super.listIndexes}});return or(this,arguments,void 0,function*(r={}){return e.listIndexes.call(this,Object.assign(Object.assign({},r),{vectorBucketName:this.vectorBucketName}))})}getIndex(e){const r=Object.create(null,{getIndex:{get:()=>super.getIndex}});return or(this,void 0,void 0,function*(){return r.getIndex.call(this,this.vectorBucketName,e)})}deleteIndex(e){const r=Object.create(null,{deleteIndex:{get:()=>super.deleteIndex}});return or(this,void 0,void 0,function*(){return r.deleteIndex.call(this,this.vectorBucketName,e)})}index(e){return new qG(this.url,this.headers,this.vectorBucketName,e,this.fetch)}}class qG extends GG{constructor(e,r,i,n,l){super(e,r,l),this.vectorBucketName=i,this.indexName=n}putVectors(e){const r=Object.create(null,{putVectors:{get:()=>super.putVectors}});return or(this,void 0,void 0,function*(){return r.putVectors.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}getVectors(e){const r=Object.create(null,{getVectors:{get:()=>super.getVectors}});return or(this,void 0,void 0,function*(){return r.getVectors.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}listVectors(){const e=Object.create(null,{listVectors:{get:()=>super.listVectors}});return or(this,arguments,void 0,function*(r={}){return e.listVectors.call(this,Object.assign(Object.assign({},r),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}queryVectors(e){const r=Object.create(null,{queryVectors:{get:()=>super.queryVectors}});return or(this,void 0,void 0,function*(){return r.queryVectors.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}deleteVectors(e){const r=Object.create(null,{deleteVectors:{get:()=>super.deleteVectors}});return or(this,void 0,void 0,function*(){return r.deleteVectors.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}}class KG extends OG{constructor(e,r={},i,n){super(e,r,i,n)}from(e){return new LG(this.url,this.headers,e,this.fetch)}get vectors(){return new $G(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new DG(this.url+"/iceberg",this.headers,this.fetch)}}const ZG="2.84.0";let V_="";typeof Deno<"u"?V_="deno":typeof document<"u"?V_="web":typeof navigator<"u"&&navigator.product==="ReactNative"?V_="react-native":V_="node";const XG={"X-Client-Info":`supabase-js-${V_}/${ZG}`},YG={headers:XG},JG={schema:"public"},QG={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},eH={},tH=t=>t?(...e)=>t(...e):(...e)=>fetch(...e),rH=()=>Headers,iH=(t,e,r)=>{const i=tH(r),n=rH();return async(l,c)=>{var o;const m=(o=await e())!==null&&o!==void 0?o:t;let b=new n(c?.headers);return b.has("apikey")||b.set("apikey",t),b.has("Authorization")||b.set("Authorization",`Bearer ${m}`),i(l,Object.assign(Object.assign({},c),{headers:b}))}};function nH(t){return t.endsWith("/")?t:t+"/"}function sH(t,e){var r,i;const{db:n,auth:l,realtime:c,global:o}=t,{db:m,auth:b,realtime:A,global:R}=e,M={db:Object.assign(Object.assign({},m),n),auth:Object.assign(Object.assign({},b),l),realtime:Object.assign(Object.assign({},A),c),storage:{},global:Object.assign(Object.assign(Object.assign({},R),o),{headers:Object.assign(Object.assign({},(r=R?.headers)!==null&&r!==void 0?r:{}),(i=o?.headers)!==null&&i!==void 0?i:{})}),accessToken:async()=>""};return t.accessToken?M.accessToken=t.accessToken:delete M.accessToken,M}function oH(t){const e=t?.trim();if(!e)throw new Error("supabaseUrl is required.");if(!e.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(nH(e))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}const U4="2.84.0",km=30*1e3,m2=3,gx=m2*km,aH="http://localhost:9999",lH="supabase.auth.token",cH={"X-Client-Info":`gotrue-js/${U4}`},g2="X-Supabase-Api-Version",V4={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},uH=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,hH=600*1e3;class yy extends Error{constructor(e,r,i){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=r,this.code=i}}function ur(t){return typeof t=="object"&&t!==null&&"__isAuthError"in t}class dH extends yy{constructor(e,r,i){super(e,r,i),this.name="AuthApiError",this.status=r,this.code=i}}function fH(t){return ur(t)&&t.name==="AuthApiError"}class fp extends yy{constructor(e,r){super(e),this.name="AuthUnknownError",this.originalError=r}}class Wd extends yy{constructor(e,r,i,n){super(e,i,n),this.name=r,this.status=i}}class Ja extends Wd{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function pH(t){return ur(t)&&t.name==="AuthSessionMissingError"}class mm extends Wd{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class X0 extends Wd{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class Y0 extends Wd{constructor(e,r=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=r}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function mH(t){return ur(t)&&t.name==="AuthImplicitGrantRedirectError"}class CC extends Wd{constructor(e,r=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=r}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class _2 extends Wd{constructor(e,r){super(e,"AuthRetryableFetchError",r,void 0)}}function _x(t){return ur(t)&&t.name==="AuthRetryableFetchError"}class PC extends Wd{constructor(e,r,i){super(e,"AuthWeakPasswordError",r,"weak_password"),this.reasons=i}}class y2 extends Wd{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const n1="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),RC=` 	
\r=`.split(""),gH=(()=>{const t=new Array(128);for(let e=0;e<t.length;e+=1)t[e]=-1;for(let e=0;e<RC.length;e+=1)t[RC[e].charCodeAt(0)]=-2;for(let e=0;e<n1.length;e+=1)t[n1[e].charCodeAt(0)]=e;return t})();function MC(t,e,r){if(t!==null)for(e.queue=e.queue<<8|t,e.queuedBits+=8;e.queuedBits>=6;){const i=e.queue>>e.queuedBits-6&63;r(n1[i]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const i=e.queue>>e.queuedBits-6&63;r(n1[i]),e.queuedBits-=6}}function G4(t,e,r){const i=gH[t];if(i>-1)for(e.queue=e.queue<<6|i,e.queuedBits+=6;e.queuedBits>=8;)r(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(i===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(t)}"`)}}function IC(t){const e=[],r=c=>{e.push(String.fromCodePoint(c))},i={utf8seq:0,codepoint:0},n={queue:0,queuedBits:0},l=c=>{vH(c,i,r)};for(let c=0;c<t.length;c+=1)G4(t.charCodeAt(c),n,l);return e.join("")}function _H(t,e){if(t<=127){e(t);return}else if(t<=2047){e(192|t>>6),e(128|t&63);return}else if(t<=65535){e(224|t>>12),e(128|t>>6&63),e(128|t&63);return}else if(t<=1114111){e(240|t>>18),e(128|t>>12&63),e(128|t>>6&63),e(128|t&63);return}throw new Error(`Unrecognized Unicode codepoint: ${t.toString(16)}`)}function yH(t,e){for(let r=0;r<t.length;r+=1){let i=t.charCodeAt(r);if(i>55295&&i<=56319){const n=(i-55296)*1024&65535;i=(t.charCodeAt(r+1)-56320&65535|n)+65536,r+=1}_H(i,e)}}function vH(t,e,r){if(e.utf8seq===0){if(t<=127){r(t);return}for(let i=1;i<6;i+=1)if((t>>7-i&1)===0){e.utf8seq=i;break}if(e.utf8seq===2)e.codepoint=t&31;else if(e.utf8seq===3)e.codepoint=t&15;else if(e.utf8seq===4)e.codepoint=t&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(t<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|t&63,e.utf8seq-=1,e.utf8seq===0&&r(e.codepoint)}}function Xm(t){const e=[],r={queue:0,queuedBits:0},i=n=>{e.push(n)};for(let n=0;n<t.length;n+=1)G4(t.charCodeAt(n),r,i);return new Uint8Array(e)}function bH(t){const e=[];return yH(t,r=>e.push(r)),new Uint8Array(e)}function _p(t){const e=[],r={queue:0,queuedBits:0},i=n=>{e.push(n)};return t.forEach(n=>MC(n,r,i)),MC(null,r,i),e.join("")}function xH(t){return Math.round(Date.now()/1e3)+t}function wH(){return Symbol("auth-callback")}const so=()=>typeof window<"u"&&typeof document<"u",ip={tested:!1,writable:!1},H4=()=>{if(!so())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(ip.tested)return ip.writable;const t=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(t,t),globalThis.localStorage.removeItem(t),ip.tested=!0,ip.writable=!0}catch{ip.tested=!0,ip.writable=!1}return ip.writable};function EH(t){const e={},r=new URL(t);if(r.hash&&r.hash[0]==="#")try{new URLSearchParams(r.hash.substring(1)).forEach((n,l)=>{e[l]=n})}catch{}return r.searchParams.forEach((i,n)=>{e[n]=i}),e}const $4=t=>t?(...e)=>t(...e):(...e)=>fetch(...e),AH=t=>typeof t=="object"&&t!==null&&"status"in t&&"ok"in t&&"json"in t&&typeof t.json=="function",Bm=async(t,e,r)=>{await t.setItem(e,JSON.stringify(r))},np=async(t,e)=>{const r=await t.getItem(e);if(!r)return null;try{return JSON.parse(r)}catch{return r}},_d=async(t,e)=>{await t.removeItem(e)};class W1{constructor(){this.promise=new W1.promiseConstructor((e,r)=>{this.resolve=e,this.reject=r})}}W1.promiseConstructor=Promise;function yx(t){const e=t.split(".");if(e.length!==3)throw new y2("Invalid JWT structure");for(let i=0;i<e.length;i++)if(!uH.test(e[i]))throw new y2("JWT not in base64url format");return{header:JSON.parse(IC(e[0])),payload:JSON.parse(IC(e[1])),signature:Xm(e[2]),raw:{header:e[0],payload:e[1]}}}async function TH(t){return await new Promise(e=>{setTimeout(()=>e(null),t)})}function SH(t,e){return new Promise((i,n)=>{(async()=>{for(let l=0;l<1/0;l++)try{const c=await t(l);if(!e(l,null,c)){i(c);return}}catch(c){if(!e(l,c)){n(c);return}}})()})}function CH(t){return("0"+t.toString(16)).substr(-2)}function PH(){const e=new Uint32Array(56);if(typeof crypto>"u"){const r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",i=r.length;let n="";for(let l=0;l<56;l++)n+=r.charAt(Math.floor(Math.random()*i));return n}return crypto.getRandomValues(e),Array.from(e,CH).join("")}async function RH(t){const r=new TextEncoder().encode(t),i=await crypto.subtle.digest("SHA-256",r),n=new Uint8Array(i);return Array.from(n).map(l=>String.fromCharCode(l)).join("")}async function MH(t){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),t;const r=await RH(t);return btoa(r).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function gm(t,e,r=!1){const i=PH();let n=i;r&&(n+="/PASSWORD_RECOVERY"),await Bm(t,`${e}-code-verifier`,n);const l=await MH(i);return[l,i===l?"plain":"s256"]}const IH=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function kH(t){const e=t.headers.get(g2);if(!e||!e.match(IH))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function BH(t){if(!t)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(t<=e)throw new Error("JWT has expired")}function LH(t){switch(t){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const OH=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function _m(t){if(!OH.test(t))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function vx(){const t={};return new Proxy(t,{get:(e,r)=>{if(r==="__isUserNotAvailableProxy")return!0;if(typeof r=="symbol"){const i=r.toString();if(i==="Symbol(Symbol.toPrimitive)"||i==="Symbol(Symbol.toStringTag)"||i==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${r}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,r)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${r}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,r)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${r}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function DH(t,e){return new Proxy(t,{get:(r,i,n)=>{if(i==="__isInsecureUserWarningProxy")return!0;if(typeof i=="symbol"){const l=i.toString();if(l==="Symbol(Symbol.toPrimitive)"||l==="Symbol(Symbol.toStringTag)"||l==="Symbol(util.inspect.custom)"||l==="Symbol(nodejs.util.inspect.custom)")return Reflect.get(r,i,n)}return!e.value&&typeof i=="string"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),e.value=!0),Reflect.get(r,i,n)}})}function kC(t){return JSON.parse(JSON.stringify(t))}const cp=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),NH=[502,503,504];async function BC(t){var e;if(!AH(t))throw new _2(cp(t),0);if(NH.includes(t.status))throw new _2(cp(t),t.status);let r;try{r=await t.json()}catch(l){throw new fp(cp(l),l)}let i;const n=kH(t);if(n&&n.getTime()>=V4["2024-01-01"].timestamp&&typeof r=="object"&&r&&typeof r.code=="string"?i=r.code:typeof r=="object"&&r&&typeof r.error_code=="string"&&(i=r.error_code),i){if(i==="weak_password")throw new PC(cp(r),t.status,((e=r.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(i==="session_not_found")throw new Ja}else if(typeof r=="object"&&r&&typeof r.weak_password=="object"&&r.weak_password&&Array.isArray(r.weak_password.reasons)&&r.weak_password.reasons.length&&r.weak_password.reasons.reduce((l,c)=>l&&typeof c=="string",!0))throw new PC(cp(r),t.status,r.weak_password.reasons);throw new dH(cp(r),t.status||500,i)}const FH=(t,e,r,i)=>{const n={method:t,headers:e?.headers||{}};return t==="GET"?n:(n.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e?.headers),n.body=JSON.stringify(i),Object.assign(Object.assign({},n),r))};async function Cr(t,e,r,i){var n;const l=Object.assign({},i?.headers);l[g2]||(l[g2]=V4["2024-01-01"].name),i?.jwt&&(l.Authorization=`Bearer ${i.jwt}`);const c=(n=i?.query)!==null&&n!==void 0?n:{};i?.redirectTo&&(c.redirect_to=i.redirectTo);const o=Object.keys(c).length?"?"+new URLSearchParams(c).toString():"",m=await zH(t,e,r+o,{headers:l,noResolveJson:i?.noResolveJson},{},i?.body);return i?.xform?i?.xform(m):{data:Object.assign({},m),error:null}}async function zH(t,e,r,i,n,l){const c=FH(e,i,n,l);let o;try{o=await t(r,Object.assign({},c))}catch(m){throw console.error(m),new _2(cp(m),0)}if(o.ok||await BC(o),i?.noResolveJson)return o;try{return await o.json()}catch(m){await BC(m)}}function gc(t){var e;let r=null;VH(t)&&(r=Object.assign({},t),t.expires_at||(r.expires_at=xH(t.expires_in)));const i=(e=t.user)!==null&&e!==void 0?e:t;return{data:{session:r,user:i},error:null}}function LC(t){const e=gc(t);return!e.error&&t.weak_password&&typeof t.weak_password=="object"&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.message&&typeof t.weak_password.message=="string"&&t.weak_password.reasons.reduce((r,i)=>r&&typeof i=="string",!0)&&(e.data.weak_password=t.weak_password),e}function Pd(t){var e;return{data:{user:(e=t.user)!==null&&e!==void 0?e:t},error:null}}function jH(t){return{data:t,error:null}}function UH(t){const{action_link:e,email_otp:r,hashed_token:i,redirect_to:n,verification_type:l}=t,c=$d(t,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),o={action_link:e,email_otp:r,hashed_token:i,redirect_to:n,verification_type:l},m=Object.assign({},c);return{data:{properties:o,user:m},error:null}}function OC(t){return t}function VH(t){return t.access_token&&t.refresh_token&&t.expires_in}const bx=["global","local","others"];class GH{constructor({url:e="",headers:r={},fetch:i}){this.url=e,this.headers=r,this.fetch=$4(i),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),updateClient:this._updateOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(e,r=bx[0]){if(bx.indexOf(r)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${bx.join(", ")}`);try{return await Cr(this.fetch,"POST",`${this.url}/logout?scope=${r}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(i){if(ur(i))return{data:null,error:i};throw i}}async inviteUserByEmail(e,r={}){try{return await Cr(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:r.data},headers:this.headers,redirectTo:r.redirectTo,xform:Pd})}catch(i){if(ur(i))return{data:{user:null},error:i};throw i}}async generateLink(e){try{const{options:r}=e,i=$d(e,["options"]),n=Object.assign(Object.assign({},i),r);return"newEmail"in i&&(n.new_email=i?.newEmail,delete n.newEmail),await Cr(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:n,headers:this.headers,xform:UH,redirectTo:r?.redirectTo})}catch(r){if(ur(r))return{data:{properties:null,user:null},error:r};throw r}}async createUser(e){try{return await Cr(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:Pd})}catch(r){if(ur(r))return{data:{user:null},error:r};throw r}}async listUsers(e){var r,i,n,l,c,o,m;try{const b={nextPage:null,lastPage:0,total:0},A=await Cr(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(i=(r=e?.page)===null||r===void 0?void 0:r.toString())!==null&&i!==void 0?i:"",per_page:(l=(n=e?.perPage)===null||n===void 0?void 0:n.toString())!==null&&l!==void 0?l:""},xform:OC});if(A.error)throw A.error;const R=await A.json(),M=(c=A.headers.get("x-total-count"))!==null&&c!==void 0?c:0,L=(m=(o=A.headers.get("link"))===null||o===void 0?void 0:o.split(","))!==null&&m!==void 0?m:[];return L.length>0&&(L.forEach(G=>{const V=parseInt(G.split(";")[0].split("=")[1].substring(0,1)),q=JSON.parse(G.split(";")[1].split("=")[1]);b[`${q}Page`]=V}),b.total=parseInt(M)),{data:Object.assign(Object.assign({},R),b),error:null}}catch(b){if(ur(b))return{data:{users:[]},error:b};throw b}}async getUserById(e){_m(e);try{return await Cr(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:Pd})}catch(r){if(ur(r))return{data:{user:null},error:r};throw r}}async updateUserById(e,r){_m(e);try{return await Cr(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:r,headers:this.headers,xform:Pd})}catch(i){if(ur(i))return{data:{user:null},error:i};throw i}}async deleteUser(e,r=!1){_m(e);try{return await Cr(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:r},xform:Pd})}catch(i){if(ur(i))return{data:{user:null},error:i};throw i}}async _listFactors(e){_m(e.userId);try{const{data:r,error:i}=await Cr(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:n=>({data:{factors:n},error:null})});return{data:r,error:i}}catch(r){if(ur(r))return{data:null,error:r};throw r}}async _deleteFactor(e){_m(e.userId),_m(e.id);try{return{data:await Cr(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(r){if(ur(r))return{data:null,error:r};throw r}}async _listOAuthClients(e){var r,i,n,l,c,o,m;try{const b={nextPage:null,lastPage:0,total:0},A=await Cr(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:(i=(r=e?.page)===null||r===void 0?void 0:r.toString())!==null&&i!==void 0?i:"",per_page:(l=(n=e?.perPage)===null||n===void 0?void 0:n.toString())!==null&&l!==void 0?l:""},xform:OC});if(A.error)throw A.error;const R=await A.json(),M=(c=A.headers.get("x-total-count"))!==null&&c!==void 0?c:0,L=(m=(o=A.headers.get("link"))===null||o===void 0?void 0:o.split(","))!==null&&m!==void 0?m:[];return L.length>0&&(L.forEach(G=>{const V=parseInt(G.split(";")[0].split("=")[1].substring(0,1)),q=JSON.parse(G.split(";")[1].split("=")[1]);b[`${q}Page`]=V}),b.total=parseInt(M)),{data:Object.assign(Object.assign({},R),b),error:null}}catch(b){if(ur(b))return{data:{clients:[]},error:b};throw b}}async _createOAuthClient(e){try{return await Cr(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:e,headers:this.headers,xform:r=>({data:r,error:null})})}catch(r){if(ur(r))return{data:null,error:r};throw r}}async _getOAuthClient(e){try{return await Cr(this.fetch,"GET",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,xform:r=>({data:r,error:null})})}catch(r){if(ur(r))return{data:null,error:r};throw r}}async _updateOAuthClient(e,r){try{return await Cr(this.fetch,"PUT",`${this.url}/admin/oauth/clients/${e}`,{body:r,headers:this.headers,xform:i=>({data:i,error:null})})}catch(i){if(ur(i))return{data:null,error:i};throw i}}async _deleteOAuthClient(e){try{return await Cr(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(r){if(ur(r))return{data:null,error:r};throw r}}async _regenerateOAuthClientSecret(e){try{return await Cr(this.fetch,"POST",`${this.url}/admin/oauth/clients/${e}/regenerate_secret`,{headers:this.headers,xform:r=>({data:r,error:null})})}catch(r){if(ur(r))return{data:null,error:r};throw r}}}function DC(t={}){return{getItem:e=>t[e]||null,setItem:(e,r)=>{t[e]=r},removeItem:e=>{delete t[e]}}}const ym={debug:!!(globalThis&&H4()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class W4 extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class HH extends W4{}async function $H(t,e,r){ym.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",t,e);const i=new globalThis.AbortController;return e>0&&setTimeout(()=>{i.abort(),ym.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",t)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(t,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:i.signal},async n=>{if(n){ym.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",t,n.name);try{return await r()}finally{ym.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",t,n.name)}}else{if(e===0)throw ym.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",t),new HH(`Acquiring an exclusive Navigator LockManager lock "${t}" immediately failed`);if(ym.debug)try{const l=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(l,null,"  "))}catch(l){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",l)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await r()}}))}function WH(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}function q4(t){if(!/^0x[a-fA-F0-9]{40}$/.test(t))throw new Error(`@supabase/auth-js: Address "${t}" is invalid.`);return t.toLowerCase()}function qH(t){return parseInt(t,16)}function KH(t){const e=new TextEncoder().encode(t);return"0x"+Array.from(e,i=>i.toString(16).padStart(2,"0")).join("")}function ZH(t){var e;const{chainId:r,domain:i,expirationTime:n,issuedAt:l=new Date,nonce:c,notBefore:o,requestId:m,resources:b,scheme:A,uri:R,version:M}=t;{if(!Number.isInteger(r))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${r}`);if(!i)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(c&&c.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${c}`);if(!R)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(M!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${M}`);if(!((e=t.statement)===null||e===void 0)&&e.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${t.statement}`)}const L=q4(t.address),G=A?`${A}://${i}`:i,V=t.statement?`${t.statement}
`:"",q=`${G} wants you to sign in with your Ethereum account:
${L}

${V}`;let J=`URI: ${R}
Version: ${M}
Chain ID: ${r}${c?`
Nonce: ${c}`:""}
Issued At: ${l.toISOString()}`;if(n&&(J+=`
Expiration Time: ${n.toISOString()}`),o&&(J+=`
Not Before: ${o.toISOString()}`),m&&(J+=`
Request ID: ${m}`),b){let ie=`
Resources:`;for(const ee of b){if(!ee||typeof ee!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${ee}`);ie+=`
- ${ee}`}J+=ie}return`${q}
${J}`}class ts extends Error{constructor({message:e,code:r,cause:i,name:n}){var l;super(e,{cause:i}),this.__isWebAuthnError=!0,this.name=(l=n??(i instanceof Error?i.name:void 0))!==null&&l!==void 0?l:"Unknown Error",this.code=r}}class s1 extends ts{constructor(e,r){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:r,message:e}),this.name="WebAuthnUnknownError",this.originalError=r}}function XH({error:t,options:e}){var r,i,n;const{publicKey:l}=e;if(!l)throw Error("options was missing required publicKey property");if(t.name==="AbortError"){if(e.signal instanceof AbortSignal)return new ts({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:t})}else if(t.name==="ConstraintError"){if(((r=l.authenticatorSelection)===null||r===void 0?void 0:r.requireResidentKey)===!0)return new ts({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:t});if(e.mediation==="conditional"&&((i=l.authenticatorSelection)===null||i===void 0?void 0:i.userVerification)==="required")return new ts({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:t});if(((n=l.authenticatorSelection)===null||n===void 0?void 0:n.userVerification)==="required")return new ts({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:t})}else{if(t.name==="InvalidStateError")return new ts({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:t});if(t.name==="NotAllowedError")return new ts({message:t.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t});if(t.name==="NotSupportedError")return l.pubKeyCredParams.filter(o=>o.type==="public-key").length===0?new ts({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:t}):new ts({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:t});if(t.name==="SecurityError"){const c=window.location.hostname;if(K4(c)){if(l.rp.id!==c)return new ts({message:`The RP ID "${l.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:t})}else return new ts({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:t})}else if(t.name==="TypeError"){if(l.user.id.byteLength<1||l.user.id.byteLength>64)return new ts({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:t})}else if(t.name==="UnknownError")return new ts({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:t})}return new ts({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t})}function YH({error:t,options:e}){const{publicKey:r}=e;if(!r)throw Error("options was missing required publicKey property");if(t.name==="AbortError"){if(e.signal instanceof AbortSignal)return new ts({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:t})}else{if(t.name==="NotAllowedError")return new ts({message:t.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t});if(t.name==="SecurityError"){const i=window.location.hostname;if(K4(i)){if(r.rpId!==i)return new ts({message:`The RP ID "${r.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:t})}else return new ts({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:t})}else if(t.name==="UnknownError")return new ts({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:t})}return new ts({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t})}class JH{createNewAbortSignal(){if(this.controller){const r=new Error("Cancelling existing WebAuthn API call for new one");r.name="AbortError",this.controller.abort(r)}const e=new AbortController;return this.controller=e,e.signal}cancelCeremony(){if(this.controller){const e=new Error("Manually cancelling existing WebAuthn API call");e.name="AbortError",this.controller.abort(e),this.controller=void 0}}}const QH=new JH;function e$(t){if(!t)throw new Error("Credential creation options are required");if(typeof PublicKeyCredential<"u"&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseCreationOptionsFromJSON=="function")return PublicKeyCredential.parseCreationOptionsFromJSON(t);const{challenge:e,user:r,excludeCredentials:i}=t,n=$d(t,["challenge","user","excludeCredentials"]),l=Xm(e).buffer,c=Object.assign(Object.assign({},r),{id:Xm(r.id).buffer}),o=Object.assign(Object.assign({},n),{challenge:l,user:c});if(i&&i.length>0){o.excludeCredentials=new Array(i.length);for(let m=0;m<i.length;m++){const b=i[m];o.excludeCredentials[m]=Object.assign(Object.assign({},b),{id:Xm(b.id).buffer,type:b.type||"public-key",transports:b.transports})}}return o}function t$(t){if(!t)throw new Error("Credential request options are required");if(typeof PublicKeyCredential<"u"&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseRequestOptionsFromJSON=="function")return PublicKeyCredential.parseRequestOptionsFromJSON(t);const{challenge:e,allowCredentials:r}=t,i=$d(t,["challenge","allowCredentials"]),n=Xm(e).buffer,l=Object.assign(Object.assign({},i),{challenge:n});if(r&&r.length>0){l.allowCredentials=new Array(r.length);for(let c=0;c<r.length;c++){const o=r[c];l.allowCredentials[c]=Object.assign(Object.assign({},o),{id:Xm(o.id).buffer,type:o.type||"public-key",transports:o.transports})}}return l}function r$(t){var e;if("toJSON"in t&&typeof t.toJSON=="function")return t.toJSON();const r=t;return{id:t.id,rawId:t.id,response:{attestationObject:_p(new Uint8Array(t.response.attestationObject)),clientDataJSON:_p(new Uint8Array(t.response.clientDataJSON))},type:"public-key",clientExtensionResults:t.getClientExtensionResults(),authenticatorAttachment:(e=r.authenticatorAttachment)!==null&&e!==void 0?e:void 0}}function i$(t){var e;if("toJSON"in t&&typeof t.toJSON=="function")return t.toJSON();const r=t,i=t.getClientExtensionResults(),n=t.response;return{id:t.id,rawId:t.id,response:{authenticatorData:_p(new Uint8Array(n.authenticatorData)),clientDataJSON:_p(new Uint8Array(n.clientDataJSON)),signature:_p(new Uint8Array(n.signature)),userHandle:n.userHandle?_p(new Uint8Array(n.userHandle)):void 0},type:"public-key",clientExtensionResults:i,authenticatorAttachment:(e=r.authenticatorAttachment)!==null&&e!==void 0?e:void 0}}function K4(t){return t==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(t)}function NC(){var t,e;return!!(so()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&typeof((t=navigator?.credentials)===null||t===void 0?void 0:t.create)=="function"&&typeof((e=navigator?.credentials)===null||e===void 0?void 0:e.get)=="function")}async function n$(t){try{const e=await navigator.credentials.create(t);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new s1("Browser returned unexpected credential type",e)}:{data:null,error:new s1("Empty credential response",e)}}catch(e){return{data:null,error:XH({error:e,options:t})}}}async function s$(t){try{const e=await navigator.credentials.get(t);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new s1("Browser returned unexpected credential type",e)}:{data:null,error:new s1("Empty credential response",e)}}catch(e){return{data:null,error:YH({error:e,options:t})}}}const o$={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"direct"},a$={userVerification:"preferred",hints:["security-key"],attestation:"direct"};function o1(...t){const e=n=>n!==null&&typeof n=="object"&&!Array.isArray(n),r=n=>n instanceof ArrayBuffer||ArrayBuffer.isView(n),i={};for(const n of t)if(n)for(const l in n){const c=n[l];if(c!==void 0)if(Array.isArray(c))i[l]=c;else if(r(c))i[l]=c;else if(e(c)){const o=i[l];e(o)?i[l]=o1(o,c):i[l]=o1(c)}else i[l]=c}return i}function l$(t,e){return o1(o$,t,e||{})}function c$(t,e){return o1(a$,t,e||{})}class u${constructor(e){this.client=e,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(e){return this.client.mfa.enroll(Object.assign(Object.assign({},e),{factorType:"webauthn"}))}async _challenge({factorId:e,webauthn:r,friendlyName:i,signal:n},l){try{const{data:c,error:o}=await this.client.mfa.challenge({factorId:e,webauthn:r});if(!c)return{data:null,error:o};const m=n??QH.createNewAbortSignal();if(c.webauthn.type==="create"){const{user:b}=c.webauthn.credential_options.publicKey;b.name||(b.name=`${b.id}:${i}`),b.displayName||(b.displayName=b.name)}switch(c.webauthn.type){case"create":{const b=l$(c.webauthn.credential_options.publicKey,l?.create),{data:A,error:R}=await n$({publicKey:b,signal:m});return A?{data:{factorId:e,challengeId:c.id,webauthn:{type:c.webauthn.type,credential_response:A}},error:null}:{data:null,error:R}}case"request":{const b=c$(c.webauthn.credential_options.publicKey,l?.request),{data:A,error:R}=await s$(Object.assign(Object.assign({},c.webauthn.credential_options),{publicKey:b,signal:m}));return A?{data:{factorId:e,challengeId:c.id,webauthn:{type:c.webauthn.type,credential_response:A}},error:null}:{data:null,error:R}}}}catch(c){return ur(c)?{data:null,error:c}:{data:null,error:new fp("Unexpected error in challenge",c)}}}async _verify({challengeId:e,factorId:r,webauthn:i}){return this.client.mfa.verify({factorId:r,challengeId:e,webauthn:i})}async _authenticate({factorId:e,webauthn:{rpId:r=typeof window<"u"?window.location.hostname:void 0,rpOrigins:i=typeof window<"u"?[window.location.origin]:void 0,signal:n}={}},l){if(!r)return{data:null,error:new yy("rpId is required for WebAuthn authentication")};try{if(!NC())return{data:null,error:new fp("Browser does not support WebAuthn",null)};const{data:c,error:o}=await this.challenge({factorId:e,webauthn:{rpId:r,rpOrigins:i},signal:n},{request:l});if(!c)return{data:null,error:o};const{webauthn:m}=c;return this._verify({factorId:e,challengeId:c.challengeId,webauthn:{type:m.type,rpId:r,rpOrigins:i,credential_response:m.credential_response}})}catch(c){return ur(c)?{data:null,error:c}:{data:null,error:new fp("Unexpected error in authenticate",c)}}}async _register({friendlyName:e,webauthn:{rpId:r=typeof window<"u"?window.location.hostname:void 0,rpOrigins:i=typeof window<"u"?[window.location.origin]:void 0,signal:n}={}},l){if(!r)return{data:null,error:new yy("rpId is required for WebAuthn registration")};try{if(!NC())return{data:null,error:new fp("Browser does not support WebAuthn",null)};const{data:c,error:o}=await this._enroll({friendlyName:e});if(!c)return await this.client.mfa.listFactors().then(A=>{var R;return(R=A.data)===null||R===void 0?void 0:R.all.find(M=>M.factor_type==="webauthn"&&M.friendly_name===e&&M.status!=="unverified")}).then(A=>A?this.client.mfa.unenroll({factorId:A?.id}):void 0),{data:null,error:o};const{data:m,error:b}=await this._challenge({factorId:c.id,friendlyName:c.friendly_name,webauthn:{rpId:r,rpOrigins:i},signal:n},{create:l});return m?this._verify({factorId:c.id,challengeId:m.challengeId,webauthn:{rpId:r,rpOrigins:i,type:m.webauthn.type,credential_response:m.webauthn.credential_response}}):{data:null,error:b}}catch(c){return ur(c)?{data:null,error:c}:{data:null,error:new fp("Unexpected error in register",c)}}}}WH();const h$={url:aH,storageKey:lH,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:cH,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1,throwOnError:!1};async function FC(t,e,r){return await r()}const vm={};class vy{get jwks(){var e,r;return(r=(e=vm[this.storageKey])===null||e===void 0?void 0:e.jwks)!==null&&r!==void 0?r:{keys:[]}}set jwks(e){vm[this.storageKey]=Object.assign(Object.assign({},vm[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,r;return(r=(e=vm[this.storageKey])===null||e===void 0?void 0:e.cachedAt)!==null&&r!==void 0?r:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){vm[this.storageKey]=Object.assign(Object.assign({},vm[this.storageKey]),{cachedAt:e})}constructor(e){var r,i,n;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log;const l=Object.assign(Object.assign({},h$),e);if(this.storageKey=l.storageKey,this.instanceID=(r=vy.nextInstanceID[this.storageKey])!==null&&r!==void 0?r:0,vy.nextInstanceID[this.storageKey]=this.instanceID+1,this.logDebugMessages=!!l.debug,typeof l.debug=="function"&&(this.logger=l.debug),this.instanceID>0&&so()){const c=`${this._logPrefix()} Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.`;console.warn(c),this.logDebugMessages&&console.trace(c)}if(this.persistSession=l.persistSession,this.autoRefreshToken=l.autoRefreshToken,this.admin=new GH({url:l.url,headers:l.headers,fetch:l.fetch}),this.url=l.url,this.headers=l.headers,this.fetch=$4(l.fetch),this.lock=l.lock||FC,this.detectSessionInUrl=l.detectSessionInUrl,this.flowType=l.flowType,this.hasCustomAuthorizationHeader=l.hasCustomAuthorizationHeader,this.throwOnError=l.throwOnError,l.lock?this.lock=l.lock:so()&&(!((i=globalThis?.navigator)===null||i===void 0)&&i.locks)?this.lock=$H:this.lock=FC,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new u$(this)},this.oauth={getAuthorizationDetails:this._getAuthorizationDetails.bind(this),approveAuthorization:this._approveAuthorization.bind(this),denyAuthorization:this._denyAuthorization.bind(this),listGrants:this._listOAuthGrants.bind(this),revokeGrant:this._revokeOAuthGrant.bind(this)},this.persistSession?(l.storage?this.storage=l.storage:H4()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=DC(this.memoryStorage)),l.userStorage&&(this.userStorage=l.userStorage)):(this.memoryStorage={},this.storage=DC(this.memoryStorage)),so()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(c){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",c)}(n=this.broadcastChannel)===null||n===void 0||n.addEventListener("message",async c=>{this._debug("received broadcast notification from other tab or client",c),await this._notifyAllSubscribers(c.data.event,c.data.session,!1)})}this.initialize()}isThrowOnErrorEnabled(){return this.throwOnError}_returnResult(e){if(this.throwOnError&&e&&e.error)throw e.error;return e}_logPrefix(){return`GoTrueClient@${this.storageKey}:${this.instanceID} (${U4}) ${new Date().toISOString()}`}_debug(...e){return this.logDebugMessages&&this.logger(this._logPrefix(),...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{let r={},i="none";if(so()&&(r=EH(window.location.href),this._isImplicitGrantCallback(r)?i="implicit":await this._isPKCECallback(r)&&(i="pkce")),so()&&this.detectSessionInUrl&&i!=="none"){const{data:n,error:l}=await this._getSessionFromURL(r,i);if(l){if(this._debug("#_initialize()","error detecting session from URL",l),mH(l)){const m=(e=l.details)===null||e===void 0?void 0:e.code;if(m==="identity_already_exists"||m==="identity_not_found"||m==="single_identity_not_deletable")return{error:l}}return await this._removeSession(),{error:l}}const{session:c,redirectType:o}=n;return this._debug("#_initialize()","detected session in URL",c,"redirect type",o),await this._saveSession(c),setTimeout(async()=>{o==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",c):await this._notifyAllSubscribers("SIGNED_IN",c)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(r){return ur(r)?this._returnResult({error:r}):this._returnResult({error:new fp("Unexpected error during initialization",r)})}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var r,i,n;try{const l=await Cr(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(i=(r=e?.options)===null||r===void 0?void 0:r.data)!==null&&i!==void 0?i:{},gotrue_meta_security:{captcha_token:(n=e?.options)===null||n===void 0?void 0:n.captchaToken}},xform:gc}),{data:c,error:o}=l;if(o||!c)return this._returnResult({data:{user:null,session:null},error:o});const m=c.session,b=c.user;return c.session&&(await this._saveSession(c.session),await this._notifyAllSubscribers("SIGNED_IN",m)),this._returnResult({data:{user:b,session:m},error:null})}catch(l){if(ur(l))return this._returnResult({data:{user:null,session:null},error:l});throw l}}async signUp(e){var r,i,n;try{let l;if("email"in e){const{email:A,password:R,options:M}=e;let L=null,G=null;this.flowType==="pkce"&&([L,G]=await gm(this.storage,this.storageKey)),l=await Cr(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:M?.emailRedirectTo,body:{email:A,password:R,data:(r=M?.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:M?.captchaToken},code_challenge:L,code_challenge_method:G},xform:gc})}else if("phone"in e){const{phone:A,password:R,options:M}=e;l=await Cr(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:A,password:R,data:(i=M?.data)!==null&&i!==void 0?i:{},channel:(n=M?.channel)!==null&&n!==void 0?n:"sms",gotrue_meta_security:{captcha_token:M?.captchaToken}},xform:gc})}else throw new X0("You must provide either an email or phone number and a password");const{data:c,error:o}=l;if(o||!c)return this._returnResult({data:{user:null,session:null},error:o});const m=c.session,b=c.user;return c.session&&(await this._saveSession(c.session),await this._notifyAllSubscribers("SIGNED_IN",m)),this._returnResult({data:{user:b,session:m},error:null})}catch(l){if(ur(l))return this._returnResult({data:{user:null,session:null},error:l});throw l}}async signInWithPassword(e){try{let r;if("email"in e){const{email:l,password:c,options:o}=e;r=await Cr(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:l,password:c,gotrue_meta_security:{captcha_token:o?.captchaToken}},xform:LC})}else if("phone"in e){const{phone:l,password:c,options:o}=e;r=await Cr(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:l,password:c,gotrue_meta_security:{captcha_token:o?.captchaToken}},xform:LC})}else throw new X0("You must provide either an email or phone number and a password");const{data:i,error:n}=r;if(n)return this._returnResult({data:{user:null,session:null},error:n});if(!i||!i.session||!i.user){const l=new mm;return this._returnResult({data:{user:null,session:null},error:l})}return i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",i.session)),this._returnResult({data:Object.assign({user:i.user,session:i.session},i.weak_password?{weakPassword:i.weak_password}:null),error:n})}catch(r){if(ur(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}}async signInWithOAuth(e){var r,i,n,l;return await this._handleProviderSignIn(e.provider,{redirectTo:(r=e.options)===null||r===void 0?void 0:r.redirectTo,scopes:(i=e.options)===null||i===void 0?void 0:i.scopes,queryParams:(n=e.options)===null||n===void 0?void 0:n.queryParams,skipBrowserRedirect:(l=e.options)===null||l===void 0?void 0:l.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:r}=e;switch(r){case"ethereum":return await this.signInWithEthereum(e);case"solana":return await this.signInWithSolana(e);default:throw new Error(`@supabase/auth-js: Unsupported chain "${r}"`)}}async signInWithEthereum(e){var r,i,n,l,c,o,m,b,A,R,M;let L,G;if("message"in e)L=e.message,G=e.signature;else{const{chain:V,wallet:q,statement:J,options:ie}=e;let ee;if(so())if(typeof q=="object")ee=q;else{const $e=window;if("ethereum"in $e&&typeof $e.ethereum=="object"&&"request"in $e.ethereum&&typeof $e.ethereum.request=="function")ee=$e.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof q!="object"||!ie?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");ee=q}const me=new URL((r=ie?.url)!==null&&r!==void 0?r:window.location.href),Se=await ee.request({method:"eth_requestAccounts"}).then($e=>$e).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!Se||Se.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const Me=q4(Se[0]);let Ve=(i=ie?.signInWithEthereum)===null||i===void 0?void 0:i.chainId;if(!Ve){const $e=await ee.request({method:"eth_chainId"});Ve=qH($e)}const Be={domain:me.host,address:Me,statement:J,uri:me.href,version:"1",chainId:Ve,nonce:(n=ie?.signInWithEthereum)===null||n===void 0?void 0:n.nonce,issuedAt:(c=(l=ie?.signInWithEthereum)===null||l===void 0?void 0:l.issuedAt)!==null&&c!==void 0?c:new Date,expirationTime:(o=ie?.signInWithEthereum)===null||o===void 0?void 0:o.expirationTime,notBefore:(m=ie?.signInWithEthereum)===null||m===void 0?void 0:m.notBefore,requestId:(b=ie?.signInWithEthereum)===null||b===void 0?void 0:b.requestId,resources:(A=ie?.signInWithEthereum)===null||A===void 0?void 0:A.resources};L=ZH(Be),G=await ee.request({method:"personal_sign",params:[KH(L),Me]})}try{const{data:V,error:q}=await Cr(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:L,signature:G},!((R=e.options)===null||R===void 0)&&R.captchaToken?{gotrue_meta_security:{captcha_token:(M=e.options)===null||M===void 0?void 0:M.captchaToken}}:null),xform:gc});if(q)throw q;if(!V||!V.session||!V.user){const J=new mm;return this._returnResult({data:{user:null,session:null},error:J})}return V.session&&(await this._saveSession(V.session),await this._notifyAllSubscribers("SIGNED_IN",V.session)),this._returnResult({data:Object.assign({},V),error:q})}catch(V){if(ur(V))return this._returnResult({data:{user:null,session:null},error:V});throw V}}async signInWithSolana(e){var r,i,n,l,c,o,m,b,A,R,M,L;let G,V;if("message"in e)G=e.message,V=e.signature;else{const{chain:q,wallet:J,statement:ie,options:ee}=e;let me;if(so())if(typeof J=="object")me=J;else{const Me=window;if("solana"in Me&&typeof Me.solana=="object"&&("signIn"in Me.solana&&typeof Me.solana.signIn=="function"||"signMessage"in Me.solana&&typeof Me.solana.signMessage=="function"))me=Me.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof J!="object"||!ee?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");me=J}const Se=new URL((r=ee?.url)!==null&&r!==void 0?r:window.location.href);if("signIn"in me&&me.signIn){const Me=await me.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},ee?.signInWithSolana),{version:"1",domain:Se.host,uri:Se.href}),ie?{statement:ie}:null));let Ve;if(Array.isArray(Me)&&Me[0]&&typeof Me[0]=="object")Ve=Me[0];else if(Me&&typeof Me=="object"&&"signedMessage"in Me&&"signature"in Me)Ve=Me;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in Ve&&"signature"in Ve&&(typeof Ve.signedMessage=="string"||Ve.signedMessage instanceof Uint8Array)&&Ve.signature instanceof Uint8Array)G=typeof Ve.signedMessage=="string"?Ve.signedMessage:new TextDecoder().decode(Ve.signedMessage),V=Ve.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in me)||typeof me.signMessage!="function"||!("publicKey"in me)||typeof me!="object"||!me.publicKey||!("toBase58"in me.publicKey)||typeof me.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");G=[`${Se.host} wants you to sign in with your Solana account:`,me.publicKey.toBase58(),...ie?["",ie,""]:[""],"Version: 1",`URI: ${Se.href}`,`Issued At: ${(n=(i=ee?.signInWithSolana)===null||i===void 0?void 0:i.issuedAt)!==null&&n!==void 0?n:new Date().toISOString()}`,...!((l=ee?.signInWithSolana)===null||l===void 0)&&l.notBefore?[`Not Before: ${ee.signInWithSolana.notBefore}`]:[],...!((c=ee?.signInWithSolana)===null||c===void 0)&&c.expirationTime?[`Expiration Time: ${ee.signInWithSolana.expirationTime}`]:[],...!((o=ee?.signInWithSolana)===null||o===void 0)&&o.chainId?[`Chain ID: ${ee.signInWithSolana.chainId}`]:[],...!((m=ee?.signInWithSolana)===null||m===void 0)&&m.nonce?[`Nonce: ${ee.signInWithSolana.nonce}`]:[],...!((b=ee?.signInWithSolana)===null||b===void 0)&&b.requestId?[`Request ID: ${ee.signInWithSolana.requestId}`]:[],...!((R=(A=ee?.signInWithSolana)===null||A===void 0?void 0:A.resources)===null||R===void 0)&&R.length?["Resources",...ee.signInWithSolana.resources.map(Ve=>`- ${Ve}`)]:[]].join(`
`);const Me=await me.signMessage(new TextEncoder().encode(G),"utf8");if(!Me||!(Me instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");V=Me}}try{const{data:q,error:J}=await Cr(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:G,signature:_p(V)},!((M=e.options)===null||M===void 0)&&M.captchaToken?{gotrue_meta_security:{captcha_token:(L=e.options)===null||L===void 0?void 0:L.captchaToken}}:null),xform:gc});if(J)throw J;if(!q||!q.session||!q.user){const ie=new mm;return this._returnResult({data:{user:null,session:null},error:ie})}return q.session&&(await this._saveSession(q.session),await this._notifyAllSubscribers("SIGNED_IN",q.session)),this._returnResult({data:Object.assign({},q),error:J})}catch(q){if(ur(q))return this._returnResult({data:{user:null,session:null},error:q});throw q}}async _exchangeCodeForSession(e){const r=await np(this.storage,`${this.storageKey}-code-verifier`),[i,n]=(r??"").split("/");try{const{data:l,error:c}=await Cr(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:i},xform:gc});if(await _d(this.storage,`${this.storageKey}-code-verifier`),c)throw c;if(!l||!l.session||!l.user){const o=new mm;return this._returnResult({data:{user:null,session:null,redirectType:null},error:o})}return l.session&&(await this._saveSession(l.session),await this._notifyAllSubscribers("SIGNED_IN",l.session)),this._returnResult({data:Object.assign(Object.assign({},l),{redirectType:n??null}),error:c})}catch(l){if(ur(l))return this._returnResult({data:{user:null,session:null,redirectType:null},error:l});throw l}}async signInWithIdToken(e){try{const{options:r,provider:i,token:n,access_token:l,nonce:c}=e,o=await Cr(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:i,id_token:n,access_token:l,nonce:c,gotrue_meta_security:{captcha_token:r?.captchaToken}},xform:gc}),{data:m,error:b}=o;if(b)return this._returnResult({data:{user:null,session:null},error:b});if(!m||!m.session||!m.user){const A=new mm;return this._returnResult({data:{user:null,session:null},error:A})}return m.session&&(await this._saveSession(m.session),await this._notifyAllSubscribers("SIGNED_IN",m.session)),this._returnResult({data:m,error:b})}catch(r){if(ur(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}}async signInWithOtp(e){var r,i,n,l,c;try{if("email"in e){const{email:o,options:m}=e;let b=null,A=null;this.flowType==="pkce"&&([b,A]=await gm(this.storage,this.storageKey));const{error:R}=await Cr(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:o,data:(r=m?.data)!==null&&r!==void 0?r:{},create_user:(i=m?.shouldCreateUser)!==null&&i!==void 0?i:!0,gotrue_meta_security:{captcha_token:m?.captchaToken},code_challenge:b,code_challenge_method:A},redirectTo:m?.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:R})}if("phone"in e){const{phone:o,options:m}=e,{data:b,error:A}=await Cr(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:o,data:(n=m?.data)!==null&&n!==void 0?n:{},create_user:(l=m?.shouldCreateUser)!==null&&l!==void 0?l:!0,gotrue_meta_security:{captcha_token:m?.captchaToken},channel:(c=m?.channel)!==null&&c!==void 0?c:"sms"}});return this._returnResult({data:{user:null,session:null,messageId:b?.message_id},error:A})}throw new X0("You must provide either an email or phone number.")}catch(o){if(ur(o))return this._returnResult({data:{user:null,session:null},error:o});throw o}}async verifyOtp(e){var r,i;try{let n,l;"options"in e&&(n=(r=e.options)===null||r===void 0?void 0:r.redirectTo,l=(i=e.options)===null||i===void 0?void 0:i.captchaToken);const{data:c,error:o}=await Cr(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:l}}),redirectTo:n,xform:gc});if(o)throw o;if(!c)throw new Error("An error occurred on token verification.");const m=c.session,b=c.user;return m?.access_token&&(await this._saveSession(m),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",m)),this._returnResult({data:{user:b,session:m},error:null})}catch(n){if(ur(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async signInWithSSO(e){var r,i,n,l,c;try{let o=null,m=null;this.flowType==="pkce"&&([o,m]=await gm(this.storage,this.storageKey));const b=await Cr(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(i=(r=e.options)===null||r===void 0?void 0:r.redirectTo)!==null&&i!==void 0?i:void 0}),!((n=e?.options)===null||n===void 0)&&n.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:o,code_challenge_method:m}),headers:this.headers,xform:jH});return!((l=b.data)===null||l===void 0)&&l.url&&so()&&!(!((c=e.options)===null||c===void 0)&&c.skipBrowserRedirect)&&window.location.assign(b.data.url),this._returnResult(b)}catch(o){if(ur(o))return this._returnResult({data:null,error:o});throw o}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:r},error:i}=e;if(i)throw i;if(!r)throw new Ja;const{error:n}=await Cr(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:r.access_token});return this._returnResult({data:{user:null,session:null},error:n})})}catch(e){if(ur(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async resend(e){try{const r=`${this.url}/resend`;if("email"in e){const{email:i,type:n,options:l}=e,{error:c}=await Cr(this.fetch,"POST",r,{headers:this.headers,body:{email:i,type:n,gotrue_meta_security:{captcha_token:l?.captchaToken}},redirectTo:l?.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:c})}else if("phone"in e){const{phone:i,type:n,options:l}=e,{data:c,error:o}=await Cr(this.fetch,"POST",r,{headers:this.headers,body:{phone:i,type:n,gotrue_meta_security:{captcha_token:l?.captchaToken}}});return this._returnResult({data:{user:null,session:null,messageId:c?.message_id},error:o})}throw new X0("You must provide either an email or phone number and a type")}catch(r){if(ur(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async r=>r))}async _acquireLock(e,r){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const i=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),n=(async()=>(await i,await r()))();return this.pendingInLock.push((async()=>{try{await n}catch{}})()),n}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const i=r();for(this.pendingInLock.push((async()=>{try{await i}catch{}})()),await i;this.pendingInLock.length;){const n=[...this.pendingInLock];await Promise.all(n),this.pendingInLock.splice(0,n.length)}return await i}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const r=await this.__loadSession();return await e(r)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const r=await np(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",r),r!==null&&(this._isValidSession(r)?e=r:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const i=e.expires_at?e.expires_at*1e3-Date.now()<gx:!1;if(this._debug("#__loadSession()",`session has${i?"":" not"} expired`,"expires_at",e.expires_at),!i){if(this.userStorage){const c=await np(this.userStorage,this.storageKey+"-user");c?.user?e.user=c.user:e.user=vx()}if(this.storage.isServer&&e.user&&!e.user.__isUserNotAvailableProxy){const c={value:this.suppressGetSessionWarning};e.user=DH(e.user,c),c.value&&(this.suppressGetSessionWarning=!0)}return{data:{session:e},error:null}}const{data:n,error:l}=await this._callRefreshToken(e.refresh_token);return l?this._returnResult({data:{session:null},error:l}):this._returnResult({data:{session:n},error:null})}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await Cr(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:Pd}):await this._useSession(async r=>{var i,n,l;const{data:c,error:o}=r;if(o)throw o;return!(!((i=c.session)===null||i===void 0)&&i.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new Ja}:await Cr(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(l=(n=c.session)===null||n===void 0?void 0:n.access_token)!==null&&l!==void 0?l:void 0,xform:Pd})})}catch(r){if(ur(r))return pH(r)&&(await this._removeSession(),await _d(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({data:{user:null},error:r});throw r}}async updateUser(e,r={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,r))}async _updateUser(e,r={}){try{return await this._useSession(async i=>{const{data:n,error:l}=i;if(l)throw l;if(!n.session)throw new Ja;const c=n.session;let o=null,m=null;this.flowType==="pkce"&&e.email!=null&&([o,m]=await gm(this.storage,this.storageKey));const{data:b,error:A}=await Cr(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:r?.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:o,code_challenge_method:m}),jwt:c.access_token,xform:Pd});if(A)throw A;return c.user=b.user,await this._saveSession(c),await this._notifyAllSubscribers("USER_UPDATED",c),this._returnResult({data:{user:c.user},error:null})})}catch(i){if(ur(i))return this._returnResult({data:{user:null},error:i});throw i}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new Ja;const r=Date.now()/1e3;let i=r,n=!0,l=null;const{payload:c}=yx(e.access_token);if(c.exp&&(i=c.exp,n=i<=r),n){const{data:o,error:m}=await this._callRefreshToken(e.refresh_token);if(m)return this._returnResult({data:{user:null,session:null},error:m});if(!o)return{data:{user:null,session:null},error:null};l=o}else{const{data:o,error:m}=await this._getUser(e.access_token);if(m)throw m;l={access_token:e.access_token,refresh_token:e.refresh_token,user:o.user,token_type:"bearer",expires_in:i-r,expires_at:i},await this._saveSession(l),await this._notifyAllSubscribers("SIGNED_IN",l)}return this._returnResult({data:{user:l.user,session:l},error:null})}catch(r){if(ur(r))return this._returnResult({data:{session:null,user:null},error:r});throw r}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async r=>{var i;if(!e){const{data:c,error:o}=r;if(o)throw o;e=(i=c.session)!==null&&i!==void 0?i:void 0}if(!e?.refresh_token)throw new Ja;const{data:n,error:l}=await this._callRefreshToken(e.refresh_token);return l?this._returnResult({data:{user:null,session:null},error:l}):n?this._returnResult({data:{user:n.user,session:n},error:null}):this._returnResult({data:{user:null,session:null},error:null})})}catch(r){if(ur(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}}async _getSessionFromURL(e,r){try{if(!so())throw new Y0("No browser detected.");if(e.error||e.error_description||e.error_code)throw new Y0(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(r){case"implicit":if(this.flowType==="pkce")throw new CC("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new Y0("Not a valid implicit grant flow url.");break;default:}if(r==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new CC("No code detected.");const{data:ie,error:ee}=await this._exchangeCodeForSession(e.code);if(ee)throw ee;const me=new URL(window.location.href);return me.searchParams.delete("code"),window.history.replaceState(window.history.state,"",me.toString()),{data:{session:ie.session,redirectType:null},error:null}}const{provider_token:i,provider_refresh_token:n,access_token:l,refresh_token:c,expires_in:o,expires_at:m,token_type:b}=e;if(!l||!o||!c||!b)throw new Y0("No session defined in URL");const A=Math.round(Date.now()/1e3),R=parseInt(o);let M=A+R;m&&(M=parseInt(m));const L=M-A;L*1e3<=km&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${L}s, should have been closer to ${R}s`);const G=M-R;A-G>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",G,M,A):A-G<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",G,M,A);const{data:V,error:q}=await this._getUser(l);if(q)throw q;const J={provider_token:i,provider_refresh_token:n,access_token:l,expires_in:R,expires_at:M,refresh_token:c,token_type:b,user:V.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),this._returnResult({data:{session:J,redirectType:e.type},error:null})}catch(i){if(ur(i))return this._returnResult({data:{session:null,redirectType:null},error:i});throw i}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){const r=await np(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&r)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async r=>{var i;const{data:n,error:l}=r;if(l)return this._returnResult({error:l});const c=(i=n.session)===null||i===void 0?void 0:i.access_token;if(c){const{error:o}=await this.admin.signOut(c,e);if(o&&!(fH(o)&&(o.status===404||o.status===401||o.status===403)))return this._returnResult({error:o})}return e!=="others"&&(await this._removeSession(),await _d(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({error:null})})}onAuthStateChange(e){const r=wH(),i={id:r,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",r),this.stateChangeEmitters.delete(r)}};return this._debug("#onAuthStateChange()","registered callback with id",r),this.stateChangeEmitters.set(r,i),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(r)})))(),{data:{subscription:i}}}async _emitInitialSession(e){return await this._useSession(async r=>{var i,n;try{const{data:{session:l},error:c}=r;if(c)throw c;await((i=this.stateChangeEmitters.get(e))===null||i===void 0?void 0:i.callback("INITIAL_SESSION",l)),this._debug("INITIAL_SESSION","callback id",e,"session",l)}catch(l){await((n=this.stateChangeEmitters.get(e))===null||n===void 0?void 0:n.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",l),console.error(l)}})}async resetPasswordForEmail(e,r={}){let i=null,n=null;this.flowType==="pkce"&&([i,n]=await gm(this.storage,this.storageKey,!0));try{return await Cr(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:i,code_challenge_method:n,gotrue_meta_security:{captcha_token:r.captchaToken}},headers:this.headers,redirectTo:r.redirectTo})}catch(l){if(ur(l))return this._returnResult({data:null,error:l});throw l}}async getUserIdentities(){var e;try{const{data:r,error:i}=await this.getUser();if(i)throw i;return this._returnResult({data:{identities:(e=r.user.identities)!==null&&e!==void 0?e:[]},error:null})}catch(r){if(ur(r))return this._returnResult({data:null,error:r});throw r}}async linkIdentity(e){return"token"in e?this.linkIdentityIdToken(e):this.linkIdentityOAuth(e)}async linkIdentityOAuth(e){var r;try{const{data:i,error:n}=await this._useSession(async l=>{var c,o,m,b,A;const{data:R,error:M}=l;if(M)throw M;const L=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(c=e.options)===null||c===void 0?void 0:c.redirectTo,scopes:(o=e.options)===null||o===void 0?void 0:o.scopes,queryParams:(m=e.options)===null||m===void 0?void 0:m.queryParams,skipBrowserRedirect:!0});return await Cr(this.fetch,"GET",L,{headers:this.headers,jwt:(A=(b=R.session)===null||b===void 0?void 0:b.access_token)!==null&&A!==void 0?A:void 0})});if(n)throw n;return so()&&!(!((r=e.options)===null||r===void 0)&&r.skipBrowserRedirect)&&window.location.assign(i?.url),this._returnResult({data:{provider:e.provider,url:i?.url},error:null})}catch(i){if(ur(i))return this._returnResult({data:{provider:e.provider,url:null},error:i});throw i}}async linkIdentityIdToken(e){return await this._useSession(async r=>{var i;try{const{error:n,data:{session:l}}=r;if(n)throw n;const{options:c,provider:o,token:m,access_token:b,nonce:A}=e,R=await Cr(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:(i=l?.access_token)!==null&&i!==void 0?i:void 0,body:{provider:o,id_token:m,access_token:b,nonce:A,link_identity:!0,gotrue_meta_security:{captcha_token:c?.captchaToken}},xform:gc}),{data:M,error:L}=R;return L?this._returnResult({data:{user:null,session:null},error:L}):!M||!M.session||!M.user?this._returnResult({data:{user:null,session:null},error:new mm}):(M.session&&(await this._saveSession(M.session),await this._notifyAllSubscribers("USER_UPDATED",M.session)),this._returnResult({data:M,error:L}))}catch(n){if(ur(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}})}async unlinkIdentity(e){try{return await this._useSession(async r=>{var i,n;const{data:l,error:c}=r;if(c)throw c;return await Cr(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(n=(i=l.session)===null||i===void 0?void 0:i.access_token)!==null&&n!==void 0?n:void 0})})}catch(r){if(ur(r))return this._returnResult({data:null,error:r});throw r}}async _refreshAccessToken(e){const r=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(r,"begin");try{const i=Date.now();return await SH(async n=>(n>0&&await TH(200*Math.pow(2,n-1)),this._debug(r,"refreshing attempt",n),await Cr(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:gc})),(n,l)=>{const c=200*Math.pow(2,n);return l&&_x(l)&&Date.now()+c-i<km})}catch(i){if(this._debug(r,"error",i),ur(i))return this._returnResult({data:{session:null,user:null},error:i});throw i}finally{this._debug(r,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,r){const i=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:r.redirectTo,scopes:r.scopes,queryParams:r.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",r,"url",i),so()&&!r.skipBrowserRedirect&&window.location.assign(i),{data:{provider:e,url:i},error:null}}async _recoverAndRefresh(){var e,r;const i="#_recoverAndRefresh()";this._debug(i,"begin");try{const n=await np(this.storage,this.storageKey);if(n&&this.userStorage){let c=await np(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!c&&(c={user:n.user},await Bm(this.userStorage,this.storageKey+"-user",c)),n.user=(e=c?.user)!==null&&e!==void 0?e:vx()}else if(n&&!n.user&&!n.user){const c=await np(this.storage,this.storageKey+"-user");c&&c?.user?(n.user=c.user,await _d(this.storage,this.storageKey+"-user"),await Bm(this.storage,this.storageKey,n)):n.user=vx()}if(this._debug(i,"session from storage",n),!this._isValidSession(n)){this._debug(i,"session is not valid"),n!==null&&await this._removeSession();return}const l=((r=n.expires_at)!==null&&r!==void 0?r:1/0)*1e3-Date.now()<gx;if(this._debug(i,`session has${l?"":" not"} expired with margin of ${gx}s`),l){if(this.autoRefreshToken&&n.refresh_token){const{error:c}=await this._callRefreshToken(n.refresh_token);c&&(console.error(c),_x(c)||(this._debug(i,"refresh failed with a non-retryable error, removing the session",c),await this._removeSession()))}}else if(n.user&&n.user.__isUserNotAvailableProxy===!0)try{const{data:c,error:o}=await this._getUser(n.access_token);!o&&c?.user?(n.user=c.user,await this._saveSession(n),await this._notifyAllSubscribers("SIGNED_IN",n)):this._debug(i,"could not get user data, skipping SIGNED_IN notification")}catch(c){console.error("Error getting user data:",c),this._debug(i,"error getting user data, skipping SIGNED_IN notification",c)}else await this._notifyAllSubscribers("SIGNED_IN",n)}catch(n){this._debug(i,"error",n),console.error(n);return}finally{this._debug(i,"end")}}async _callRefreshToken(e){var r,i;if(!e)throw new Ja;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const n=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(n,"begin");try{this.refreshingDeferred=new W1;const{data:l,error:c}=await this._refreshAccessToken(e);if(c)throw c;if(!l.session)throw new Ja;await this._saveSession(l.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",l.session);const o={data:l.session,error:null};return this.refreshingDeferred.resolve(o),o}catch(l){if(this._debug(n,"error",l),ur(l)){const c={data:null,error:l};return _x(l)||await this._removeSession(),(r=this.refreshingDeferred)===null||r===void 0||r.resolve(c),c}throw(i=this.refreshingDeferred)===null||i===void 0||i.reject(l),l}finally{this.refreshingDeferred=null,this._debug(n,"end")}}async _notifyAllSubscribers(e,r,i=!0){const n=`#_notifyAllSubscribers(${e})`;this._debug(n,"begin",r,`broadcast = ${i}`);try{this.broadcastChannel&&i&&this.broadcastChannel.postMessage({event:e,session:r});const l=[],c=Array.from(this.stateChangeEmitters.values()).map(async o=>{try{await o.callback(e,r)}catch(m){l.push(m)}});if(await Promise.all(c),l.length>0){for(let o=0;o<l.length;o+=1)console.error(l[o]);throw l[0]}}finally{this._debug(n,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0;const r=Object.assign({},e),i=r.user&&r.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!i&&r.user&&await Bm(this.userStorage,this.storageKey+"-user",{user:r.user});const n=Object.assign({},r);delete n.user;const l=kC(n);await Bm(this.storage,this.storageKey,l)}else{const n=kC(r);await Bm(this.storage,this.storageKey,n)}}async _removeSession(){this._debug("#_removeSession()"),await _d(this.storage,this.storageKey),await _d(this.storage,this.storageKey+"-code-verifier"),await _d(this.storage,this.storageKey+"-user"),this.userStorage&&await _d(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&so()&&window?.removeEventListener&&window.removeEventListener("visibilitychange",e)}catch(r){console.error("removing visibilitychange callback failed",r)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),km);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async r=>{const{data:{session:i}}=r;if(!i||!i.refresh_token||!i.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const n=Math.floor((i.expires_at*1e3-e)/km);this._debug("#_autoRefreshTokenTick()",`access token expires in ${n} ticks, a tick lasts ${km}ms, refresh threshold is ${m2} ticks`),n<=m2&&await this._callRefreshToken(i.refresh_token)})}catch(r){console.error("Auto refresh tick failed with error. This is likely a transient error.",r)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof W4)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!so()||!window?.addEventListener)return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window?.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const r=`#_onVisibilityChanged(${e})`;this._debug(r,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(r,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,r,i){const n=[`provider=${encodeURIComponent(r)}`];if(i?.redirectTo&&n.push(`redirect_to=${encodeURIComponent(i.redirectTo)}`),i?.scopes&&n.push(`scopes=${encodeURIComponent(i.scopes)}`),this.flowType==="pkce"){const[l,c]=await gm(this.storage,this.storageKey),o=new URLSearchParams({code_challenge:`${encodeURIComponent(l)}`,code_challenge_method:`${encodeURIComponent(c)}`});n.push(o.toString())}if(i?.queryParams){const l=new URLSearchParams(i.queryParams);n.push(l.toString())}return i?.skipBrowserRedirect&&n.push(`skip_http_redirect=${i.skipBrowserRedirect}`),`${e}?${n.join("&")}`}async _unenroll(e){try{return await this._useSession(async r=>{var i;const{data:n,error:l}=r;return l?this._returnResult({data:null,error:l}):await Cr(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(i=n?.session)===null||i===void 0?void 0:i.access_token})})}catch(r){if(ur(r))return this._returnResult({data:null,error:r});throw r}}async _enroll(e){try{return await this._useSession(async r=>{var i,n;const{data:l,error:c}=r;if(c)return this._returnResult({data:null,error:c});const o=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:e.factorType==="totp"?{issuer:e.issuer}:{}),{data:m,error:b}=await Cr(this.fetch,"POST",`${this.url}/factors`,{body:o,headers:this.headers,jwt:(i=l?.session)===null||i===void 0?void 0:i.access_token});return b?this._returnResult({data:null,error:b}):(e.factorType==="totp"&&m.type==="totp"&&(!((n=m?.totp)===null||n===void 0)&&n.qr_code)&&(m.totp.qr_code=`data:image/svg+xml;utf-8,${m.totp.qr_code}`),this._returnResult({data:m,error:null}))})}catch(r){if(ur(r))return this._returnResult({data:null,error:r});throw r}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async r=>{var i;const{data:n,error:l}=r;if(l)return this._returnResult({data:null,error:l});const c=Object.assign({challenge_id:e.challengeId},"webauthn"in e?{webauthn:Object.assign(Object.assign({},e.webauthn),{credential_response:e.webauthn.type==="create"?r$(e.webauthn.credential_response):i$(e.webauthn.credential_response)})}:{code:e.code}),{data:o,error:m}=await Cr(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:c,headers:this.headers,jwt:(i=n?.session)===null||i===void 0?void 0:i.access_token});return m?this._returnResult({data:null,error:m}):(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+o.expires_in},o)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",o),this._returnResult({data:o,error:m}))})}catch(r){if(ur(r))return this._returnResult({data:null,error:r});throw r}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async r=>{var i;const{data:n,error:l}=r;if(l)return this._returnResult({data:null,error:l});const c=await Cr(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:e,headers:this.headers,jwt:(i=n?.session)===null||i===void 0?void 0:i.access_token});if(c.error)return c;const{data:o}=c;if(o.type!=="webauthn")return{data:o,error:null};switch(o.webauthn.type){case"create":return{data:Object.assign(Object.assign({},o),{webauthn:Object.assign(Object.assign({},o.webauthn),{credential_options:Object.assign(Object.assign({},o.webauthn.credential_options),{publicKey:e$(o.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},o),{webauthn:Object.assign(Object.assign({},o.webauthn),{credential_options:Object.assign(Object.assign({},o.webauthn.credential_options),{publicKey:t$(o.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(r){if(ur(r))return this._returnResult({data:null,error:r});throw r}})}async _challengeAndVerify(e){const{data:r,error:i}=await this._challenge({factorId:e.factorId});return i?this._returnResult({data:null,error:i}):await this._verify({factorId:e.factorId,challengeId:r.id,code:e.code})}async _listFactors(){var e;const{data:{user:r},error:i}=await this.getUser();if(i)return{data:null,error:i};const n={all:[],phone:[],totp:[],webauthn:[]};for(const l of(e=r?.factors)!==null&&e!==void 0?e:[])n.all.push(l),l.status==="verified"&&n[l.factor_type].push(l);return{data:n,error:null}}async _getAuthenticatorAssuranceLevel(){var e,r;const{data:{session:i},error:n}=await this.getSession();if(n)return this._returnResult({data:null,error:n});if(!i)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:l}=yx(i.access_token);let c=null;l.aal&&(c=l.aal);let o=c;((r=(e=i.user.factors)===null||e===void 0?void 0:e.filter(A=>A.status==="verified"))!==null&&r!==void 0?r:[]).length>0&&(o="aal2");const b=l.amr||[];return{data:{currentLevel:c,nextLevel:o,currentAuthenticationMethods:b},error:null}}async _getAuthorizationDetails(e){try{return await this._useSession(async r=>{const{data:{session:i},error:n}=r;return n?this._returnResult({data:null,error:n}):i?await Cr(this.fetch,"GET",`${this.url}/oauth/authorizations/${e}`,{headers:this.headers,jwt:i.access_token,xform:l=>({data:l,error:null})}):this._returnResult({data:null,error:new Ja})})}catch(r){if(ur(r))return this._returnResult({data:null,error:r});throw r}}async _approveAuthorization(e,r){try{return await this._useSession(async i=>{const{data:{session:n},error:l}=i;if(l)return this._returnResult({data:null,error:l});if(!n)return this._returnResult({data:null,error:new Ja});const c=await Cr(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:n.access_token,body:{action:"approve"},xform:o=>({data:o,error:null})});return c.data&&c.data.redirect_url&&so()&&!r?.skipBrowserRedirect&&window.location.assign(c.data.redirect_url),c})}catch(i){if(ur(i))return this._returnResult({data:null,error:i});throw i}}async _denyAuthorization(e,r){try{return await this._useSession(async i=>{const{data:{session:n},error:l}=i;if(l)return this._returnResult({data:null,error:l});if(!n)return this._returnResult({data:null,error:new Ja});const c=await Cr(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:n.access_token,body:{action:"deny"},xform:o=>({data:o,error:null})});return c.data&&c.data.redirect_url&&so()&&!r?.skipBrowserRedirect&&window.location.assign(c.data.redirect_url),c})}catch(i){if(ur(i))return this._returnResult({data:null,error:i});throw i}}async _listOAuthGrants(){try{return await this._useSession(async e=>{const{data:{session:r},error:i}=e;return i?this._returnResult({data:null,error:i}):r?await Cr(this.fetch,"GET",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:r.access_token,xform:n=>({data:n,error:null})}):this._returnResult({data:null,error:new Ja})})}catch(e){if(ur(e))return this._returnResult({data:null,error:e});throw e}}async _revokeOAuthGrant(e){try{return await this._useSession(async r=>{const{data:{session:i},error:n}=r;return n?this._returnResult({data:null,error:n}):i?await Cr(this.fetch,"DELETE",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:i.access_token,query:{client_id:e.clientId},xform:()=>({data:{},error:null})}):this._returnResult({data:null,error:new Ja})})}catch(r){if(ur(r))return this._returnResult({data:null,error:r});throw r}}async fetchJwk(e,r={keys:[]}){let i=r.keys.find(o=>o.kid===e);if(i)return i;const n=Date.now();if(i=this.jwks.keys.find(o=>o.kid===e),i&&this.jwks_cached_at+hH>n)return i;const{data:l,error:c}=await Cr(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(c)throw c;return!l.keys||l.keys.length===0||(this.jwks=l,this.jwks_cached_at=n,i=l.keys.find(o=>o.kid===e),!i)?null:i}async getClaims(e,r={}){try{let i=e;if(!i){const{data:L,error:G}=await this.getSession();if(G||!L.session)return this._returnResult({data:null,error:G});i=L.session.access_token}const{header:n,payload:l,signature:c,raw:{header:o,payload:m}}=yx(i);r?.allowExpired||BH(l.exp);const b=!n.alg||n.alg.startsWith("HS")||!n.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(n.kid,r?.keys?{keys:r.keys}:r?.jwks);if(!b){const{error:L}=await this.getUser(i);if(L)throw L;return{data:{claims:l,header:n,signature:c},error:null}}const A=LH(n.alg),R=await crypto.subtle.importKey("jwk",b,A,!0,["verify"]);if(!await crypto.subtle.verify(A,R,c,bH(`${o}.${m}`)))throw new y2("Invalid JWT signature");return{data:{claims:l,header:n,signature:c},error:null}}catch(i){if(ur(i))return this._returnResult({data:null,error:i});throw i}}}vy.nextInstanceID={};const d$=vy;class f$ extends d${constructor(e){super(e)}}class p${constructor(e,r,i){var n,l,c;this.supabaseUrl=e,this.supabaseKey=r;const o=oH(e);if(!r)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",o),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",o),this.storageUrl=new URL("storage/v1",o),this.functionsUrl=new URL("functions/v1",o);const m=`sb-${o.hostname.split(".")[0]}-auth-token`,b={db:JG,realtime:eH,auth:Object.assign(Object.assign({},QG),{storageKey:m}),global:YG},A=sH(i??{},b);this.storageKey=(n=A.auth.storageKey)!==null&&n!==void 0?n:"",this.headers=(l=A.global.headers)!==null&&l!==void 0?l:{},A.accessToken?(this.accessToken=A.accessToken,this.auth=new Proxy({},{get:(R,M)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(M)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((c=A.auth)!==null&&c!==void 0?c:{},this.headers,A.global.fetch),this.fetch=iH(r,this._getAccessToken.bind(this),A.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},A.realtime)),this.accessToken&&this.accessToken().then(R=>this.realtime.setAuth(R)).catch(R=>console.warn("Failed to set initial Realtime auth token:",R)),this.rest=new aG(new URL("rest/v1",o).href,{headers:this.headers,schema:A.db.schema,fetch:this.fetch}),this.storage=new KG(this.storageUrl.href,this.headers,this.fetch,i?.storage),A.accessToken||this._listenForAuthEvents()}get functions(){return new iG(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,r={},i={head:!1,get:!1,count:void 0}){return this.rest.rpc(e,r,i)}channel(e,r={config:{}}){return this.realtime.channel(e,r)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var e,r;if(this.accessToken)return await this.accessToken();const{data:i}=await this.auth.getSession();return(r=(e=i.session)===null||e===void 0?void 0:e.access_token)!==null&&r!==void 0?r:this.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:r,detectSessionInUrl:i,storage:n,userStorage:l,storageKey:c,flowType:o,lock:m,debug:b,throwOnError:A},R,M){const L={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new f$({url:this.authUrl.href,headers:Object.assign(Object.assign({},L),R),storageKey:c,autoRefreshToken:e,persistSession:r,detectSessionInUrl:i,storage:n,userStorage:l,flowType:o,lock:m,debug:b,throwOnError:A,fetch:M,hasCustomAuthorizationHeader:Object.keys(this.headers).some(G=>G.toLowerCase()==="authorization")})}_initRealtimeClient(e){return new AG(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((r,i)=>{this._handleTokenChanged(r,"CLIENT",i?.access_token)})}_handleTokenChanged(e,r,i){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==i?(this.changedAccessToken=i,this.realtime.setAuth(i)):e==="SIGNED_OUT"&&(this.realtime.setAuth(),r=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const m$=(t,e,r)=>new p$(t,e,r);function g$(){if(typeof window<"u"||typeof process>"u")return!1;const t=process.version;if(t==null)return!1;const e=t.match(/^v(\d+)\./);return e?parseInt(e[1],10)<=18:!1}g$()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const _$="https://jquckoniyjkxuafntdlt.supabase.co",y$="sb_publishable_FLrSD7D8vzZdcAJRcKFWQA_ylWkuFAr",xu=m$(_$,y$,{auth:{persistSession:!0,autoRefreshToken:!0}});async function v$(){const{data:t,error:e}=await xu.from("events").select(`
      *,
      profiles:host_id (
        full_name,
        avatar_url,
        username
      )
    `).order("date",{ascending:!0});return e?(console.error("Error fetching events:",e),[]):t.map(r=>({id:r.id,title:r.title,startTime:r.date,location:{lat:r.latitude,lng:r.longitude,name:r.location_name},imageUrl:r.image_url||"https://images.unsplash.com/photo-1492684223066-81342ee5ff30",host:{id:r.host_id,name:r.profiles?.full_name||r.profiles?.username||"Unknown Host",avatar:r.profiles?.avatar_url||"https://github.com/shadcn.png",instagram:r.profiles?.username},attendees:Math.floor(Math.random()*50)+10,mood:r.mood||"Chill",description:r.description||"",price:r.price,capacity:r.capacity,category:r.category}))}async function b$(t){const{data:e,error:r}=await xu.from("events").insert([t]).select().single();if(r)throw r;return e}async function x$(t){const e=t.name.split(".").pop(),i=`${`${Math.random()}.${e}`}`,{error:n}=await xu.storage.from("event-images").upload(i,t);if(n)throw n;const{data:l}=xu.storage.from("event-images").getPublicUrl(i);return l.publicUrl}function vA(t,[e,r]){return Math.min(r,Math.max(e,t))}function w$(t){const e=Z.useRef({value:t,previous:t});return Z.useMemo(()=>(e.current.value!==t&&(e.current.previous=e.current.value,e.current.value=t),e.current.previous),[t])}function E$(t){const[e,r]=Z.useState(void 0);return Mu(()=>{if(t){r({width:t.offsetWidth,height:t.offsetHeight});const i=new ResizeObserver(n=>{if(!Array.isArray(n)||!n.length)return;const l=n[0];let c,o;if("borderBoxSize"in l){const m=l.borderBoxSize,b=Array.isArray(m)?m[0]:m;c=b.inlineSize,o=b.blockSize}else c=t.offsetWidth,o=t.offsetHeight;r({width:c,height:o})});return i.observe(t,{box:"border-box"}),()=>i.unobserve(t)}else r(void 0)},[t]),e}var Z4=["PageUp","PageDown"],X4=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],Y4={"from-left":["Home","PageDown","ArrowDown","ArrowLeft"],"from-right":["Home","PageDown","ArrowDown","ArrowRight"],"from-bottom":["Home","PageDown","ArrowDown","ArrowLeft"],"from-top":["Home","PageDown","ArrowUp","ArrowLeft"]},Mg="Slider",[v2,A$,T$]=Ek(Mg),[J4]=Sg(Mg,[T$]),[S$,q1]=J4(Mg),Q4=Z.forwardRef((t,e)=>{const{name:r,min:i=0,max:n=100,step:l=1,orientation:c="horizontal",disabled:o=!1,minStepsBetweenThumbs:m=0,defaultValue:b=[i],value:A,onValueChange:R=()=>{},onValueCommit:M=()=>{},inverted:L=!1,form:G,...V}=t,q=Z.useRef(new Set),J=Z.useRef(0),ee=c==="horizontal"?C$:P$,[me=[],Se]=V1({prop:A,defaultProp:b,onChange:_t=>{[...q.current][J.current]?.focus(),R(_t)}}),Me=Z.useRef(me);function Ve(_t){const Nt=B$(me,_t);at(_t,Nt)}function Be(_t){at(_t,J.current)}function $e(){const _t=Me.current[J.current];me[J.current]!==_t&&M(me)}function at(_t,Nt,{commit:sr}={commit:!1}){const Ft=N$(l),Ut=F$(Math.round((_t-i)/l)*l+i,Ft),Lt=vA(Ut,[i,n]);Se((At=[])=>{const Ke=I$(At,Lt,Nt);if(D$(Ke,m*l)){J.current=Ke.indexOf(Lt);const ft=String(Ke)!==String(At);return ft&&sr&&M(Ke),ft?Ke:At}else return At})}return j.jsx(S$,{scope:t.__scopeSlider,name:r,disabled:o,min:i,max:n,valueIndexToChangeRef:J,thumbs:q.current,values:me,orientation:c,form:G,children:j.jsx(v2.Provider,{scope:t.__scopeSlider,children:j.jsx(v2.Slot,{scope:t.__scopeSlider,children:j.jsx(ee,{"aria-disabled":o,"data-disabled":o?"":void 0,...V,ref:e,onPointerDown:xi(V.onPointerDown,()=>{o||(Me.current=me)}),min:i,max:n,inverted:L,onSlideStart:o?void 0:Ve,onSlideMove:o?void 0:Be,onSlideEnd:o?void 0:$e,onHomeKeyDown:()=>!o&&at(i,0,{commit:!0}),onEndKeyDown:()=>!o&&at(n,me.length-1,{commit:!0}),onStepKeyDown:({event:_t,direction:Nt})=>{if(!o){const Ut=Z4.includes(_t.key)||_t.shiftKey&&X4.includes(_t.key)?10:1,Lt=J.current,At=me[Lt],Ke=l*Ut*Nt;at(At+Ke,Lt,{commit:!0})}}})})})})});Q4.displayName=Mg;var[eB,tB]=J4(Mg,{startEdge:"left",endEdge:"right",size:"width",direction:1}),C$=Z.forwardRef((t,e)=>{const{min:r,max:i,dir:n,inverted:l,onSlideStart:c,onSlideMove:o,onSlideEnd:m,onStepKeyDown:b,...A}=t,[R,M]=Z.useState(null),L=Bn(e,ee=>M(ee)),G=Z.useRef(void 0),V=G1(n),q=V==="ltr",J=q&&!l||!q&&l;function ie(ee){const me=G.current||R.getBoundingClientRect(),Se=[0,me.width],Ve=bA(Se,J?[r,i]:[i,r]);return G.current=me,Ve(ee-me.left)}return j.jsx(eB,{scope:t.__scopeSlider,startEdge:J?"left":"right",endEdge:J?"right":"left",direction:J?1:-1,size:"width",children:j.jsx(rB,{dir:V,"data-orientation":"horizontal",...A,ref:L,style:{...A.style,"--radix-slider-thumb-transform":"translateX(-50%)"},onSlideStart:ee=>{const me=ie(ee.clientX);c?.(me)},onSlideMove:ee=>{const me=ie(ee.clientX);o?.(me)},onSlideEnd:()=>{G.current=void 0,m?.()},onStepKeyDown:ee=>{const Se=Y4[J?"from-left":"from-right"].includes(ee.key);b?.({event:ee,direction:Se?-1:1})}})})}),P$=Z.forwardRef((t,e)=>{const{min:r,max:i,inverted:n,onSlideStart:l,onSlideMove:c,onSlideEnd:o,onStepKeyDown:m,...b}=t,A=Z.useRef(null),R=Bn(e,A),M=Z.useRef(void 0),L=!n;function G(V){const q=M.current||A.current.getBoundingClientRect(),J=[0,q.height],ee=bA(J,L?[i,r]:[r,i]);return M.current=q,ee(V-q.top)}return j.jsx(eB,{scope:t.__scopeSlider,startEdge:L?"bottom":"top",endEdge:L?"top":"bottom",size:"height",direction:L?1:-1,children:j.jsx(rB,{"data-orientation":"vertical",...b,ref:R,style:{...b.style,"--radix-slider-thumb-transform":"translateY(50%)"},onSlideStart:V=>{const q=G(V.clientY);l?.(q)},onSlideMove:V=>{const q=G(V.clientY);c?.(q)},onSlideEnd:()=>{M.current=void 0,o?.()},onStepKeyDown:V=>{const J=Y4[L?"from-bottom":"from-top"].includes(V.key);m?.({event:V,direction:J?-1:1})}})})}),rB=Z.forwardRef((t,e)=>{const{__scopeSlider:r,onSlideStart:i,onSlideMove:n,onSlideEnd:l,onHomeKeyDown:c,onEndKeyDown:o,onStepKeyDown:m,...b}=t,A=q1(Mg,r);return j.jsx(nn.span,{...b,ref:e,onKeyDown:xi(t.onKeyDown,R=>{R.key==="Home"?(c(R),R.preventDefault()):R.key==="End"?(o(R),R.preventDefault()):Z4.concat(X4).includes(R.key)&&(m(R),R.preventDefault())}),onPointerDown:xi(t.onPointerDown,R=>{const M=R.target;M.setPointerCapture(R.pointerId),R.preventDefault(),A.thumbs.has(M)?M.focus():i(R)}),onPointerMove:xi(t.onPointerMove,R=>{R.target.hasPointerCapture(R.pointerId)&&n(R)}),onPointerUp:xi(t.onPointerUp,R=>{const M=R.target;M.hasPointerCapture(R.pointerId)&&(M.releasePointerCapture(R.pointerId),l(R))})})}),iB="SliderTrack",nB=Z.forwardRef((t,e)=>{const{__scopeSlider:r,...i}=t,n=q1(iB,r);return j.jsx(nn.span,{"data-disabled":n.disabled?"":void 0,"data-orientation":n.orientation,...i,ref:e})});nB.displayName=iB;var b2="SliderRange",sB=Z.forwardRef((t,e)=>{const{__scopeSlider:r,...i}=t,n=q1(b2,r),l=tB(b2,r),c=Z.useRef(null),o=Bn(e,c),m=n.values.length,b=n.values.map(M=>lB(M,n.min,n.max)),A=m>1?Math.min(...b):0,R=100-Math.max(...b);return j.jsx(nn.span,{"data-orientation":n.orientation,"data-disabled":n.disabled?"":void 0,...i,ref:o,style:{...t.style,[l.startEdge]:A+"%",[l.endEdge]:R+"%"}})});sB.displayName=b2;var x2="SliderThumb",oB=Z.forwardRef((t,e)=>{const r=A$(t.__scopeSlider),[i,n]=Z.useState(null),l=Bn(e,o=>n(o)),c=Z.useMemo(()=>i?r().findIndex(o=>o.ref.current===i):-1,[r,i]);return j.jsx(R$,{...t,ref:l,index:c})}),R$=Z.forwardRef((t,e)=>{const{__scopeSlider:r,index:i,name:n,...l}=t,c=q1(x2,r),o=tB(x2,r),[m,b]=Z.useState(null),A=Bn(e,ie=>b(ie)),R=m?c.form||!!m.closest("form"):!0,M=E$(m),L=c.values[i],G=L===void 0?0:lB(L,c.min,c.max),V=k$(i,c.values.length),q=M?.[o.size],J=q?L$(q,G,o.direction):0;return Z.useEffect(()=>{if(m)return c.thumbs.add(m),()=>{c.thumbs.delete(m)}},[m,c.thumbs]),j.jsxs("span",{style:{transform:"var(--radix-slider-thumb-transform)",position:"absolute",[o.startEdge]:`calc(${G}% + ${J}px)`},children:[j.jsx(v2.ItemSlot,{scope:t.__scopeSlider,children:j.jsx(nn.span,{role:"slider","aria-label":t["aria-label"]||V,"aria-valuemin":c.min,"aria-valuenow":L,"aria-valuemax":c.max,"aria-orientation":c.orientation,"data-orientation":c.orientation,"data-disabled":c.disabled?"":void 0,tabIndex:c.disabled?void 0:0,...l,ref:A,style:L===void 0?{display:"none"}:t.style,onFocus:xi(t.onFocus,()=>{c.valueIndexToChangeRef.current=i})})}),R&&j.jsx(aB,{name:n??(c.name?c.name+(c.values.length>1?"[]":""):void 0),form:c.form,value:L},i)]})});oB.displayName=x2;var M$="RadioBubbleInput",aB=Z.forwardRef(({__scopeSlider:t,value:e,...r},i)=>{const n=Z.useRef(null),l=Bn(n,i),c=w$(e);return Z.useEffect(()=>{const o=n.current;if(!o)return;const m=window.HTMLInputElement.prototype,A=Object.getOwnPropertyDescriptor(m,"value").set;if(c!==e&&A){const R=new Event("input",{bubbles:!0});A.call(o,e),o.dispatchEvent(R)}},[c,e]),j.jsx(nn.input,{style:{display:"none"},...r,ref:l,defaultValue:e})});aB.displayName=M$;function I$(t=[],e,r){const i=[...t];return i[r]=e,i.sort((n,l)=>n-l)}function lB(t,e,r){const l=100/(r-e)*(t-e);return vA(l,[0,100])}function k$(t,e){return e>2?`Value ${t+1} of ${e}`:e===2?["Minimum","Maximum"][t]:void 0}function B$(t,e){if(t.length===1)return 0;const r=t.map(n=>Math.abs(n-e)),i=Math.min(...r);return r.indexOf(i)}function L$(t,e,r){const i=t/2,l=bA([0,50],[0,i]);return(i-l(e)*r)*r}function O$(t){return t.slice(0,-1).map((e,r)=>t[r+1]-e)}function D$(t,e){if(e>0){const r=O$(t);return Math.min(...r)>=e}return!0}function bA(t,e){return r=>{if(t[0]===t[1]||e[0]===e[1])return e[0];const i=(e[1]-e[0])/(t[1]-t[0]);return e[0]+i*(r-t[0])}}function N$(t){return(String(t).split(".")[1]||"").length}function F$(t,e){const r=Math.pow(10,e);return Math.round(t*r)/r}var z$=Q4,j$=nB,U$=sB,V$=oB;function G$({className:t,defaultValue:e,value:r,min:i=0,max:n=100,...l}){const c=Z.useMemo(()=>Array.isArray(r)?r:Array.isArray(e)?e:[i,n],[r,e,i,n]);return j.jsxs(z$,{"data-slot":"slider",defaultValue:e,value:r,min:i,max:n,className:Ri("relative flex w-full touch-none items-center select-none data-[disabled]:opacity-50 data-[orientation=vertical]:h-full data-[orientation=vertical]:min-h-44 data-[orientation=vertical]:w-auto data-[orientation=vertical]:flex-col",t),...l,children:[j.jsx(j$,{"data-slot":"slider-track",className:Ri("bg-muted relative grow overflow-hidden rounded-full data-[orientation=horizontal]:h-4 data-[orientation=horizontal]:w-full data-[orientation=vertical]:h-full data-[orientation=vertical]:w-1.5"),children:j.jsx(U$,{"data-slot":"slider-range",className:Ri("bg-primary absolute data-[orientation=horizontal]:h-full data-[orientation=vertical]:w-full")})}),Array.from({length:c.length},(o,m)=>j.jsx(V$,{"data-slot":"slider-thumb",className:"border-primary bg-background ring-ring/50 block size-4 shrink-0 rounded-full border shadow-sm transition-[color,box-shadow] hover:ring-4 focus-visible:ring-4 focus-visible:outline-hidden disabled:pointer-events-none disabled:opacity-50"},m))]})}const H$=({isActive:t,onToggle:e,radius:r,onRadiusChange:i})=>j.jsxs("div",{className:"flex flex-col items-end gap-4",children:[j.jsxs("button",{onClick:e,className:Ri("relative group flex items-center justify-center w-12 h-12 rounded-full transition-all duration-300 shadow-lg backdrop-blur-md border border-white/20",t?"bg-primary text-primary-foreground shadow-[0_0_20px_rgba(249,115,22,0.5)]":"bg-background/80 text-muted-foreground hover:bg-background"),children:[j.jsx(qF,{className:Ri("w-6 h-6 transition-all",t&&"animate-pulse")}),j.jsx("span",{className:"absolute right-full mr-3 px-2 py-1 rounded-md bg-background/90 text-xs font-medium opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap pointer-events-none",children:"Torch Mode"})]}),t&&j.jsxs(U1.div,{initial:{opacity:0,y:-10,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:-10,scale:.95},className:"bg-background/90 backdrop-blur-md p-4 rounded-2xl border border-white/10 shadow-xl w-64",children:[j.jsxs("div",{className:"flex justify-between items-center mb-3",children:[j.jsx("span",{className:"text-sm font-medium",children:"Search Radius"}),j.jsxs("span",{className:"text-xs text-muted-foreground",children:[r," km"]})]}),j.jsx(G$,{value:[r],onValueChange:n=>i(n[0]),max:20,step:1,className:"w-full"})]})]}),$$=r4("inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function Mh({className:t,variant:e,asChild:r=!1,...i}){const n=r?t4:"span";return j.jsx(n,{"data-slot":"badge",className:Ri($$({variant:e}),t),...i})}const W$=[{id:"Chill",label:"Chill",color:"bg-blue-500/20 text-blue-300 border-blue-500/50"},{id:"Energetic",label:"Energetic",color:"bg-orange-500/20 text-orange-300 border-orange-500/50"},{id:"Creative",label:"Creative",color:"bg-purple-500/20 text-purple-300 border-purple-500/50"},{id:"Romantic",label:"Romantic",color:"bg-pink-500/20 text-pink-300 border-pink-500/50"},{id:"Intellectual",label:"Intellectual",color:"bg-emerald-500/20 text-emerald-300 border-emerald-500/50"}],q$=({selectedMood:t,onSelectMood:e})=>j.jsxs("div",{className:"flex gap-2 overflow-x-auto pb-2 scrollbar-hide mask-linear-fade",children:[j.jsx(Mh,{variant:"outline",className:Ri("cursor-pointer transition-all hover:bg-white/10 px-4 py-1.5 h-8",t?"bg-black/40 border-white/10 text-muted-foreground":"bg-white/20 border-white/40"),onClick:()=>e(null),children:"All"}),W$.map(r=>j.jsx(Mh,{variant:"outline",className:Ri("cursor-pointer transition-all hover:bg-white/10 px-4 py-1.5 h-8 border",t===r.id?r.color:"bg-black/40 border-white/10 text-muted-foreground"),onClick:()=>e(r.id===t?null:r.id),children:r.label},r.id))]});function K$(t,e=[]){let r=[];function i(l,c){const o=Z.createContext(c);o.displayName=l+"Context";const m=r.length;r=[...r,c];const b=R=>{const{scope:M,children:L,...G}=R,V=M?.[t]?.[m]||o,q=Z.useMemo(()=>G,Object.values(G));return j.jsx(V.Provider,{value:q,children:L})};b.displayName=l+"Provider";function A(R,M){const L=M?.[t]?.[m]||o,G=Z.useContext(L);if(G)return G;if(c!==void 0)return c;throw new Error(`\`${R}\` must be used within \`${l}\``)}return[b,A]}const n=()=>{const l=r.map(c=>Z.createContext(c));return function(o){const m=o?.[t]||l;return Z.useMemo(()=>({[`__scope${t}`]:{...o,[t]:m}}),[o,m])}};return n.scopeName=t,[i,Z$(n,...e)]}function Z$(...t){const e=t[0];if(t.length===1)return e;const r=()=>{const i=t.map(n=>({useScope:n(),scopeName:n.scopeName}));return function(l){const c=i.reduce((o,{useScope:m,scopeName:b})=>{const R=m(l)[`__scope${b}`];return{...o,...R}},{});return Z.useMemo(()=>({[`__scope${e.scopeName}`]:c}),[c])}};return r.scopeName=e.scopeName,r}var X$=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],xA=X$.reduce((t,e)=>{const r=lA(`Primitive.${e}`),i=Z.forwardRef((n,l)=>{const{asChild:c,...o}=n,m=c?r:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),j.jsx(m,{...o,ref:l})});return i.displayName=`Primitive.${e}`,{...t,[e]:i}},{}),xx={exports:{}},wx={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var zC;function Y$(){if(zC)return wx;zC=1;var t=R1();function e(R,M){return R===M&&(R!==0||1/R===1/M)||R!==R&&M!==M}var r=typeof Object.is=="function"?Object.is:e,i=t.useState,n=t.useEffect,l=t.useLayoutEffect,c=t.useDebugValue;function o(R,M){var L=M(),G=i({inst:{value:L,getSnapshot:M}}),V=G[0].inst,q=G[1];return l(function(){V.value=L,V.getSnapshot=M,m(V)&&q({inst:V})},[R,L,M]),n(function(){return m(V)&&q({inst:V}),R(function(){m(V)&&q({inst:V})})},[R]),c(L),L}function m(R){var M=R.getSnapshot;R=R.value;try{var L=M();return!r(R,L)}catch{return!0}}function b(R,M){return M()}var A=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?b:o;return wx.useSyncExternalStore=t.useSyncExternalStore!==void 0?t.useSyncExternalStore:A,wx}var jC;function J$(){return jC||(jC=1,xx.exports=Y$()),xx.exports}var Q$=J$();function eW(){return Q$.useSyncExternalStore(tW,()=>!0,()=>!1)}function tW(){return()=>{}}var wA="Avatar",[rW]=K$(wA),[iW,cB]=rW(wA),uB=Z.forwardRef((t,e)=>{const{__scopeAvatar:r,...i}=t,[n,l]=Z.useState("idle");return j.jsx(iW,{scope:r,imageLoadingStatus:n,onImageLoadingStatusChange:l,children:j.jsx(xA.span,{...i,ref:e})})});uB.displayName=wA;var hB="AvatarImage",dB=Z.forwardRef((t,e)=>{const{__scopeAvatar:r,src:i,onLoadingStatusChange:n=()=>{},...l}=t,c=cB(hB,r),o=nW(i,l),m=va(b=>{n(b),c.onImageLoadingStatusChange(b)});return Mu(()=>{o!=="idle"&&m(o)},[o,m]),o==="loaded"?j.jsx(xA.img,{...l,ref:e,src:i}):null});dB.displayName=hB;var fB="AvatarFallback",pB=Z.forwardRef((t,e)=>{const{__scopeAvatar:r,delayMs:i,...n}=t,l=cB(fB,r),[c,o]=Z.useState(i===void 0);return Z.useEffect(()=>{if(i!==void 0){const m=window.setTimeout(()=>o(!0),i);return()=>window.clearTimeout(m)}},[i]),c&&l.imageLoadingStatus!=="loaded"?j.jsx(xA.span,{...n,ref:e}):null});pB.displayName=fB;function UC(t,e){return t?e?(t.src!==e&&(t.src=e),t.complete&&t.naturalWidth>0?"loaded":"loading"):"error":"idle"}function nW(t,{referrerPolicy:e,crossOrigin:r}){const i=eW(),n=Z.useRef(null),l=i?(n.current||(n.current=new window.Image),n.current):null,[c,o]=Z.useState(()=>UC(l,t));return Mu(()=>{o(UC(l,t))},[l,t]),Mu(()=>{const m=R=>()=>{o(R)};if(!l)return;const b=m("loaded"),A=m("error");return l.addEventListener("load",b),l.addEventListener("error",A),e&&(l.referrerPolicy=e),typeof r=="string"&&(l.crossOrigin=r),()=>{l.removeEventListener("load",b),l.removeEventListener("error",A)}},[l,r,e]),c}var sW=uB,oW=dB,aW=pB;function EA({className:t,...e}){return j.jsx(sW,{"data-slot":"avatar",className:Ri("relative flex size-10 shrink-0 overflow-hidden rounded-full",t),...e})}function AA({className:t,...e}){return j.jsx(oW,{"data-slot":"avatar-image",className:Ri("aspect-square size-full",t),...e})}function TA({className:t,...e}){return j.jsx(aW,{"data-slot":"avatar-fallback",className:Ri("bg-muted flex size-full items-center justify-center rounded-full",t),...e})}const lW="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODgiIGhlaWdodD0iODgiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjMDAwIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBvcGFjaXR5PSIuMyIgZmlsbD0ibm9uZSIgc3Ryb2tlLXdpZHRoPSIzLjciPjxyZWN0IHg9IjE2IiB5PSIxNiIgd2lkdGg9IjU2IiBoZWlnaHQ9IjU2IiByeD0iNiIvPjxwYXRoIGQ9Im0xNiA1OCAxNi0xOCAzMiAzMiIvPjxjaXJjbGUgY3g9IjUzIiBjeT0iMzUiIHI9IjciLz48L3N2Zz4KCg==";function Nd(t){const[e,r]=Z.useState(!1),i=()=>{r(!0)},{src:n,alt:l,style:c,className:o,...m}=t;return e?j.jsx("div",{className:`inline-block bg-gray-100 text-center align-middle ${o??""}`,style:c,children:j.jsx("div",{className:"flex items-center justify-center w-full h-full",children:j.jsx("img",{src:lW,alt:"Error loading image",...m,"data-original-url":n})})}):j.jsx("img",{src:n,alt:l,className:o,style:c,...m,onError:i})}function mB({event:t,open:e,onClose:r}){return!t||!e?null:j.jsxs(j.Fragment,{children:[j.jsx("div",{className:"fixed inset-0 bg-black/50 z-40 animate-in fade-in",onClick:r}),j.jsxs("div",{className:"fixed bottom-0 left-0 right-0 z-50 bg-card rounded-t-3xl border-t border-border animate-in slide-in-from-bottom duration-300 max-w-lg mx-auto",children:[j.jsxs("div",{className:"relative h-48 rounded-t-3xl overflow-hidden",children:[j.jsx(Nd,{src:t.imageUrl,alt:t.title,className:"w-full h-full object-cover"}),j.jsx(ao,{size:"icon",variant:"ghost",className:"absolute top-4 right-4 bg-black/50 hover:bg-black/70 text-white rounded-full",onClick:r,children:j.jsx(D1,{className:"h-5 w-5"})}),j.jsx(Mh,{variant:"outline",className:"absolute top-4 left-4 bg-primary/20 text-primary border-primary/50",children:t.mood})]}),j.jsxs("div",{className:"p-6 space-y-4",children:[j.jsx("h2",{className:"text-foreground text-2xl",children:t.title}),j.jsxs("div",{className:"flex items-center gap-4 text-muted-foreground text-sm",children:[j.jsxs("div",{className:"flex items-center gap-1.5",children:[j.jsx(zI,{className:"h-4 w-4"}),j.jsx("span",{children:t.startTime})]}),j.jsxs("div",{className:"flex items-center gap-1.5",children:[j.jsx(Pp,{className:"h-4 w-4"}),j.jsx("span",{children:t.location.name})]})]}),t.description&&j.jsx("p",{className:"text-muted-foreground text-sm",children:t.description}),j.jsxs("div",{className:"flex items-center justify-between py-3 border-t border-b border-border",children:[j.jsxs("div",{className:"flex items-center gap-3",children:[j.jsxs(EA,{className:"h-10 w-10",children:[j.jsx(AA,{src:t.host.avatar,alt:t.host.name}),j.jsx(TA,{children:t.host.name[0]})]}),j.jsxs("div",{children:[j.jsx("div",{className:"text-foreground text-sm",children:"Hosted by"}),j.jsx("div",{className:"text-foreground",children:t.host.name})]})]}),t.host.instagram&&j.jsxs(ao,{variant:"ghost",size:"sm",className:"text-primary hover:text-primary/80",children:[j.jsx(UI,{className:"h-4 w-4 mr-1"}),t.host.instagram]})]}),j.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[j.jsx(sg,{className:"h-5 w-5"}),j.jsxs("span",{className:"text-sm",children:[j.jsx("span",{className:"text-foreground",children:t.attendees})," people attending"]})]}),j.jsx(ao,{className:"w-full bg-primary hover:bg-primary/90 text-primary-foreground py-6",children:"RSVP to Event"})]})]})]})}function cW(t,e=globalThis?.document){const r=va(t);Z.useEffect(()=>{const i=n=>{n.key==="Escape"&&r(n)};return e.addEventListener("keydown",i,{capture:!0}),()=>e.removeEventListener("keydown",i,{capture:!0})},[r,e])}var uW="DismissableLayer",w2="dismissableLayer.update",hW="dismissableLayer.pointerDownOutside",dW="dismissableLayer.focusOutside",VC,gB=Z.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),_B=Z.forwardRef((t,e)=>{const{disableOutsidePointerEvents:r=!1,onEscapeKeyDown:i,onPointerDownOutside:n,onFocusOutside:l,onInteractOutside:c,onDismiss:o,...m}=t,b=Z.useContext(gB),[A,R]=Z.useState(null),M=A?.ownerDocument??globalThis?.document,[,L]=Z.useState({}),G=Bn(e,Ve=>R(Ve)),V=Array.from(b.layers),[q]=[...b.layersWithOutsidePointerEventsDisabled].slice(-1),J=V.indexOf(q),ie=A?V.indexOf(A):-1,ee=b.layersWithOutsidePointerEventsDisabled.size>0,me=ie>=J,Se=mW(Ve=>{const Be=Ve.target,$e=[...b.branches].some(at=>at.contains(Be));!me||$e||(n?.(Ve),c?.(Ve),Ve.defaultPrevented||o?.())},M),Me=gW(Ve=>{const Be=Ve.target;[...b.branches].some(at=>at.contains(Be))||(l?.(Ve),c?.(Ve),Ve.defaultPrevented||o?.())},M);return cW(Ve=>{ie===b.layers.size-1&&(i?.(Ve),!Ve.defaultPrevented&&o&&(Ve.preventDefault(),o()))},M),Z.useEffect(()=>{if(A)return r&&(b.layersWithOutsidePointerEventsDisabled.size===0&&(VC=M.body.style.pointerEvents,M.body.style.pointerEvents="none"),b.layersWithOutsidePointerEventsDisabled.add(A)),b.layers.add(A),GC(),()=>{r&&b.layersWithOutsidePointerEventsDisabled.size===1&&(M.body.style.pointerEvents=VC)}},[A,M,r,b]),Z.useEffect(()=>()=>{A&&(b.layers.delete(A),b.layersWithOutsidePointerEventsDisabled.delete(A),GC())},[A,b]),Z.useEffect(()=>{const Ve=()=>L({});return document.addEventListener(w2,Ve),()=>document.removeEventListener(w2,Ve)},[]),j.jsx(nn.div,{...m,ref:G,style:{pointerEvents:ee?me?"auto":"none":void 0,...t.style},onFocusCapture:xi(t.onFocusCapture,Me.onFocusCapture),onBlurCapture:xi(t.onBlurCapture,Me.onBlurCapture),onPointerDownCapture:xi(t.onPointerDownCapture,Se.onPointerDownCapture)})});_B.displayName=uW;var fW="DismissableLayerBranch",pW=Z.forwardRef((t,e)=>{const r=Z.useContext(gB),i=Z.useRef(null),n=Bn(e,i);return Z.useEffect(()=>{const l=i.current;if(l)return r.branches.add(l),()=>{r.branches.delete(l)}},[r.branches]),j.jsx(nn.div,{...t,ref:n})});pW.displayName=fW;function mW(t,e=globalThis?.document){const r=va(t),i=Z.useRef(!1),n=Z.useRef(()=>{});return Z.useEffect(()=>{const l=o=>{if(o.target&&!i.current){let m=function(){yB(hW,r,b,{discrete:!0})};const b={originalEvent:o};o.pointerType==="touch"?(e.removeEventListener("click",n.current),n.current=m,e.addEventListener("click",n.current,{once:!0})):m()}else e.removeEventListener("click",n.current);i.current=!1},c=window.setTimeout(()=>{e.addEventListener("pointerdown",l)},0);return()=>{window.clearTimeout(c),e.removeEventListener("pointerdown",l),e.removeEventListener("click",n.current)}},[e,r]),{onPointerDownCapture:()=>i.current=!0}}function gW(t,e=globalThis?.document){const r=va(t),i=Z.useRef(!1);return Z.useEffect(()=>{const n=l=>{l.target&&!i.current&&yB(dW,r,{originalEvent:l},{discrete:!1})};return e.addEventListener("focusin",n),()=>e.removeEventListener("focusin",n)},[e,r]),{onFocusCapture:()=>i.current=!0,onBlurCapture:()=>i.current=!1}}function GC(){const t=new CustomEvent(w2);document.dispatchEvent(t)}function yB(t,e,r,{discrete:i}){const n=r.originalEvent.target,l=new CustomEvent(t,{bubbles:!1,cancelable:!0,detail:r});e&&n.addEventListener(t,e,{once:!0}),i?C7(n,l):n.dispatchEvent(l)}var Ex="focusScope.autoFocusOnMount",Ax="focusScope.autoFocusOnUnmount",HC={bubbles:!1,cancelable:!0},_W="FocusScope",vB=Z.forwardRef((t,e)=>{const{loop:r=!1,trapped:i=!1,onMountAutoFocus:n,onUnmountAutoFocus:l,...c}=t,[o,m]=Z.useState(null),b=va(n),A=va(l),R=Z.useRef(null),M=Bn(e,V=>m(V)),L=Z.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;Z.useEffect(()=>{if(i){let V=function(ee){if(L.paused||!o)return;const me=ee.target;o.contains(me)?R.current=me:Sd(R.current,{select:!0})},q=function(ee){if(L.paused||!o)return;const me=ee.relatedTarget;me!==null&&(o.contains(me)||Sd(R.current,{select:!0}))},J=function(ee){if(document.activeElement===document.body)for(const Se of ee)Se.removedNodes.length>0&&Sd(o)};document.addEventListener("focusin",V),document.addEventListener("focusout",q);const ie=new MutationObserver(J);return o&&ie.observe(o,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",V),document.removeEventListener("focusout",q),ie.disconnect()}}},[i,o,L.paused]),Z.useEffect(()=>{if(o){WC.add(L);const V=document.activeElement;if(!o.contains(V)){const J=new CustomEvent(Ex,HC);o.addEventListener(Ex,b),o.dispatchEvent(J),J.defaultPrevented||(yW(EW(bB(o)),{select:!0}),document.activeElement===V&&Sd(o))}return()=>{o.removeEventListener(Ex,b),setTimeout(()=>{const J=new CustomEvent(Ax,HC);o.addEventListener(Ax,A),o.dispatchEvent(J),J.defaultPrevented||Sd(V??document.body,{select:!0}),o.removeEventListener(Ax,A),WC.remove(L)},0)}}},[o,b,A,L]);const G=Z.useCallback(V=>{if(!r&&!i||L.paused)return;const q=V.key==="Tab"&&!V.altKey&&!V.ctrlKey&&!V.metaKey,J=document.activeElement;if(q&&J){const ie=V.currentTarget,[ee,me]=vW(ie);ee&&me?!V.shiftKey&&J===me?(V.preventDefault(),r&&Sd(ee,{select:!0})):V.shiftKey&&J===ee&&(V.preventDefault(),r&&Sd(me,{select:!0})):J===ie&&V.preventDefault()}},[r,i,L.paused]);return j.jsx(nn.div,{tabIndex:-1,...c,ref:M,onKeyDown:G})});vB.displayName=_W;function yW(t,{select:e=!1}={}){const r=document.activeElement;for(const i of t)if(Sd(i,{select:e}),document.activeElement!==r)return}function vW(t){const e=bB(t),r=$C(e,t),i=$C(e.reverse(),t);return[r,i]}function bB(t){const e=[],r=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT,{acceptNode:i=>{const n=i.tagName==="INPUT"&&i.type==="hidden";return i.disabled||i.hidden||n?NodeFilter.FILTER_SKIP:i.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;r.nextNode();)e.push(r.currentNode);return e}function $C(t,e){for(const r of t)if(!bW(r,{upTo:e}))return r}function bW(t,{upTo:e}){if(getComputedStyle(t).visibility==="hidden")return!0;for(;t;){if(e!==void 0&&t===e)return!1;if(getComputedStyle(t).display==="none")return!0;t=t.parentElement}return!1}function xW(t){return t instanceof HTMLInputElement&&"select"in t}function Sd(t,{select:e=!1}={}){if(t&&t.focus){const r=document.activeElement;t.focus({preventScroll:!0}),t!==r&&xW(t)&&e&&t.select()}}var WC=wW();function wW(){let t=[];return{add(e){const r=t[0];e!==r&&r?.pause(),t=qC(t,e),t.unshift(e)},remove(e){t=qC(t,e),t[0]?.resume()}}}function qC(t,e){const r=[...t],i=r.indexOf(e);return i!==-1&&r.splice(i,1),r}function EW(t){return t.filter(e=>e.tagName!=="A")}var AW="Portal",xB=Z.forwardRef((t,e)=>{const{container:r,...i}=t,[n,l]=Z.useState(!1);Mu(()=>l(!0),[]);const c=r||n&&globalThis?.document?.body;return c?LF.createPortal(j.jsx(nn.div,{...i,ref:e}),c):null});xB.displayName=AW;var Tx=0;function TW(){Z.useEffect(()=>{const t=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",t[0]??KC()),document.body.insertAdjacentElement("beforeend",t[1]??KC()),Tx++,()=>{Tx===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(e=>e.remove()),Tx--}},[])}function KC(){const t=document.createElement("span");return t.setAttribute("data-radix-focus-guard",""),t.tabIndex=0,t.style.outline="none",t.style.opacity="0",t.style.position="fixed",t.style.pointerEvents="none",t}var zv="right-scroll-bar-position",jv="width-before-scroll-bar",SW="with-scroll-bars-hidden",CW="--removed-body-scroll-bar-size";function Sx(t,e){return typeof t=="function"?t(e):t&&(t.current=e),t}function PW(t,e){var r=Z.useState(function(){return{value:t,callback:e,facade:{get current(){return r.value},set current(i){var n=r.value;n!==i&&(r.value=i,r.callback(i,n))}}}})[0];return r.callback=e,r.facade}var RW=typeof window<"u"?Z.useLayoutEffect:Z.useEffect,ZC=new WeakMap;function MW(t,e){var r=PW(null,function(i){return t.forEach(function(n){return Sx(n,i)})});return RW(function(){var i=ZC.get(r);if(i){var n=new Set(i),l=new Set(t),c=r.current;n.forEach(function(o){l.has(o)||Sx(o,null)}),l.forEach(function(o){n.has(o)||Sx(o,c)})}ZC.set(r,t)},[t]),r}function IW(t){return t}function kW(t,e){e===void 0&&(e=IW);var r=[],i=!1,n={read:function(){if(i)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return r.length?r[r.length-1]:t},useMedium:function(l){var c=e(l,i);return r.push(c),function(){r=r.filter(function(o){return o!==c})}},assignSyncMedium:function(l){for(i=!0;r.length;){var c=r;r=[],c.forEach(l)}r={push:function(o){return l(o)},filter:function(){return r}}},assignMedium:function(l){i=!0;var c=[];if(r.length){var o=r;r=[],o.forEach(l),c=r}var m=function(){var A=c;c=[],A.forEach(l)},b=function(){return Promise.resolve().then(m)};b(),r={push:function(A){c.push(A),b()},filter:function(A){return c=c.filter(A),r}}}};return n}function BW(t){t===void 0&&(t={});var e=kW(null);return e.options=Ll({async:!0,ssr:!1},t),e}var wB=function(t){var e=t.sideCar,r=$d(t,["sideCar"]);if(!e)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var i=e.read();if(!i)throw new Error("Sidecar medium not found");return Z.createElement(i,Ll({},r))};wB.isSideCarExport=!0;function LW(t,e){return t.useMedium(e),wB}var EB=BW(),Cx=function(){},K1=Z.forwardRef(function(t,e){var r=Z.useRef(null),i=Z.useState({onScrollCapture:Cx,onWheelCapture:Cx,onTouchMoveCapture:Cx}),n=i[0],l=i[1],c=t.forwardProps,o=t.children,m=t.className,b=t.removeScrollBar,A=t.enabled,R=t.shards,M=t.sideCar,L=t.noRelative,G=t.noIsolation,V=t.inert,q=t.allowPinchZoom,J=t.as,ie=J===void 0?"div":J,ee=t.gapMode,me=$d(t,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noRelative","noIsolation","inert","allowPinchZoom","as","gapMode"]),Se=M,Me=MW([r,e]),Ve=Ll(Ll({},me),n);return Z.createElement(Z.Fragment,null,A&&Z.createElement(Se,{sideCar:EB,removeScrollBar:b,shards:R,noRelative:L,noIsolation:G,inert:V,setCallbacks:l,allowPinchZoom:!!q,lockRef:r,gapMode:ee}),c?Z.cloneElement(Z.Children.only(o),Ll(Ll({},Ve),{ref:Me})):Z.createElement(ie,Ll({},Ve,{className:m,ref:Me}),o))});K1.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};K1.classNames={fullWidth:jv,zeroRight:zv};var OW=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function DW(){if(!document)return null;var t=document.createElement("style");t.type="text/css";var e=OW();return e&&t.setAttribute("nonce",e),t}function NW(t,e){t.styleSheet?t.styleSheet.cssText=e:t.appendChild(document.createTextNode(e))}function FW(t){var e=document.head||document.getElementsByTagName("head")[0];e.appendChild(t)}var zW=function(){var t=0,e=null;return{add:function(r){t==0&&(e=DW())&&(NW(e,r),FW(e)),t++},remove:function(){t--,!t&&e&&(e.parentNode&&e.parentNode.removeChild(e),e=null)}}},jW=function(){var t=zW();return function(e,r){Z.useEffect(function(){return t.add(e),function(){t.remove()}},[e&&r])}},AB=function(){var t=jW(),e=function(r){var i=r.styles,n=r.dynamic;return t(i,n),null};return e},UW={left:0,top:0,right:0,gap:0},Px=function(t){return parseInt(t||"",10)||0},VW=function(t){var e=window.getComputedStyle(document.body),r=e[t==="padding"?"paddingLeft":"marginLeft"],i=e[t==="padding"?"paddingTop":"marginTop"],n=e[t==="padding"?"paddingRight":"marginRight"];return[Px(r),Px(i),Px(n)]},GW=function(t){if(t===void 0&&(t="margin"),typeof window>"u")return UW;var e=VW(t),r=document.documentElement.clientWidth,i=window.innerWidth;return{left:e[0],top:e[1],right:e[2],gap:Math.max(0,i-r+e[2]-e[0])}},HW=AB(),Ym="data-scroll-locked",$W=function(t,e,r,i){var n=t.left,l=t.top,c=t.right,o=t.gap;return r===void 0&&(r="margin"),`
  .`.concat(SW,` {
   overflow: hidden `).concat(i,`;
   padding-right: `).concat(o,"px ").concat(i,`;
  }
  body[`).concat(Ym,`] {
    overflow: hidden `).concat(i,`;
    overscroll-behavior: contain;
    `).concat([e&&"position: relative ".concat(i,";"),r==="margin"&&`
    padding-left: `.concat(n,`px;
    padding-top: `).concat(l,`px;
    padding-right: `).concat(c,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(o,"px ").concat(i,`;
    `),r==="padding"&&"padding-right: ".concat(o,"px ").concat(i,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(zv,` {
    right: `).concat(o,"px ").concat(i,`;
  }
  
  .`).concat(jv,` {
    margin-right: `).concat(o,"px ").concat(i,`;
  }
  
  .`).concat(zv," .").concat(zv,` {
    right: 0 `).concat(i,`;
  }
  
  .`).concat(jv," .").concat(jv,` {
    margin-right: 0 `).concat(i,`;
  }
  
  body[`).concat(Ym,`] {
    `).concat(CW,": ").concat(o,`px;
  }
`)},XC=function(){var t=parseInt(document.body.getAttribute(Ym)||"0",10);return isFinite(t)?t:0},WW=function(){Z.useEffect(function(){return document.body.setAttribute(Ym,(XC()+1).toString()),function(){var t=XC()-1;t<=0?document.body.removeAttribute(Ym):document.body.setAttribute(Ym,t.toString())}},[])},qW=function(t){var e=t.noRelative,r=t.noImportant,i=t.gapMode,n=i===void 0?"margin":i;WW();var l=Z.useMemo(function(){return GW(n)},[n]);return Z.createElement(HW,{styles:$W(l,!e,n,r?"":"!important")})},E2=!1;if(typeof window<"u")try{var J0=Object.defineProperty({},"passive",{get:function(){return E2=!0,!0}});window.addEventListener("test",J0,J0),window.removeEventListener("test",J0,J0)}catch{E2=!1}var bm=E2?{passive:!1}:!1,KW=function(t){return t.tagName==="TEXTAREA"},TB=function(t,e){if(!(t instanceof Element))return!1;var r=window.getComputedStyle(t);return r[e]!=="hidden"&&!(r.overflowY===r.overflowX&&!KW(t)&&r[e]==="visible")},ZW=function(t){return TB(t,"overflowY")},XW=function(t){return TB(t,"overflowX")},YC=function(t,e){var r=e.ownerDocument,i=e;do{typeof ShadowRoot<"u"&&i instanceof ShadowRoot&&(i=i.host);var n=SB(t,i);if(n){var l=CB(t,i),c=l[1],o=l[2];if(c>o)return!0}i=i.parentNode}while(i&&i!==r.body);return!1},YW=function(t){var e=t.scrollTop,r=t.scrollHeight,i=t.clientHeight;return[e,r,i]},JW=function(t){var e=t.scrollLeft,r=t.scrollWidth,i=t.clientWidth;return[e,r,i]},SB=function(t,e){return t==="v"?ZW(e):XW(e)},CB=function(t,e){return t==="v"?YW(e):JW(e)},QW=function(t,e){return t==="h"&&e==="rtl"?-1:1},eq=function(t,e,r,i,n){var l=QW(t,window.getComputedStyle(e).direction),c=l*i,o=r.target,m=e.contains(o),b=!1,A=c>0,R=0,M=0;do{if(!o)break;var L=CB(t,o),G=L[0],V=L[1],q=L[2],J=V-q-l*G;(G||J)&&SB(t,o)&&(R+=J,M+=G);var ie=o.parentNode;o=ie&&ie.nodeType===Node.DOCUMENT_FRAGMENT_NODE?ie.host:ie}while(!m&&o!==document.body||m&&(e.contains(o)||e===o));return(A&&Math.abs(R)<1||!A&&Math.abs(M)<1)&&(b=!0),b},Q0=function(t){return"changedTouches"in t?[t.changedTouches[0].clientX,t.changedTouches[0].clientY]:[0,0]},JC=function(t){return[t.deltaX,t.deltaY]},QC=function(t){return t&&"current"in t?t.current:t},tq=function(t,e){return t[0]===e[0]&&t[1]===e[1]},rq=function(t){return`
  .block-interactivity-`.concat(t,` {pointer-events: none;}
  .allow-interactivity-`).concat(t,` {pointer-events: all;}
`)},iq=0,xm=[];function nq(t){var e=Z.useRef([]),r=Z.useRef([0,0]),i=Z.useRef(),n=Z.useState(iq++)[0],l=Z.useState(AB)[0],c=Z.useRef(t);Z.useEffect(function(){c.current=t},[t]),Z.useEffect(function(){if(t.inert){document.body.classList.add("block-interactivity-".concat(n));var V=uA([t.lockRef.current],(t.shards||[]).map(QC),!0).filter(Boolean);return V.forEach(function(q){return q.classList.add("allow-interactivity-".concat(n))}),function(){document.body.classList.remove("block-interactivity-".concat(n)),V.forEach(function(q){return q.classList.remove("allow-interactivity-".concat(n))})}}},[t.inert,t.lockRef.current,t.shards]);var o=Z.useCallback(function(V,q){if("touches"in V&&V.touches.length===2||V.type==="wheel"&&V.ctrlKey)return!c.current.allowPinchZoom;var J=Q0(V),ie=r.current,ee="deltaX"in V?V.deltaX:ie[0]-J[0],me="deltaY"in V?V.deltaY:ie[1]-J[1],Se,Me=V.target,Ve=Math.abs(ee)>Math.abs(me)?"h":"v";if("touches"in V&&Ve==="h"&&Me.type==="range")return!1;var Be=YC(Ve,Me);if(!Be)return!0;if(Be?Se=Ve:(Se=Ve==="v"?"h":"v",Be=YC(Ve,Me)),!Be)return!1;if(!i.current&&"changedTouches"in V&&(ee||me)&&(i.current=Se),!Se)return!0;var $e=i.current||Se;return eq($e,q,V,$e==="h"?ee:me)},[]),m=Z.useCallback(function(V){var q=V;if(!(!xm.length||xm[xm.length-1]!==l)){var J="deltaY"in q?JC(q):Q0(q),ie=e.current.filter(function(Se){return Se.name===q.type&&(Se.target===q.target||q.target===Se.shadowParent)&&tq(Se.delta,J)})[0];if(ie&&ie.should){q.cancelable&&q.preventDefault();return}if(!ie){var ee=(c.current.shards||[]).map(QC).filter(Boolean).filter(function(Se){return Se.contains(q.target)}),me=ee.length>0?o(q,ee[0]):!c.current.noIsolation;me&&q.cancelable&&q.preventDefault()}}},[]),b=Z.useCallback(function(V,q,J,ie){var ee={name:V,delta:q,target:J,should:ie,shadowParent:sq(J)};e.current.push(ee),setTimeout(function(){e.current=e.current.filter(function(me){return me!==ee})},1)},[]),A=Z.useCallback(function(V){r.current=Q0(V),i.current=void 0},[]),R=Z.useCallback(function(V){b(V.type,JC(V),V.target,o(V,t.lockRef.current))},[]),M=Z.useCallback(function(V){b(V.type,Q0(V),V.target,o(V,t.lockRef.current))},[]);Z.useEffect(function(){return xm.push(l),t.setCallbacks({onScrollCapture:R,onWheelCapture:R,onTouchMoveCapture:M}),document.addEventListener("wheel",m,bm),document.addEventListener("touchmove",m,bm),document.addEventListener("touchstart",A,bm),function(){xm=xm.filter(function(V){return V!==l}),document.removeEventListener("wheel",m,bm),document.removeEventListener("touchmove",m,bm),document.removeEventListener("touchstart",A,bm)}},[]);var L=t.removeScrollBar,G=t.inert;return Z.createElement(Z.Fragment,null,G?Z.createElement(l,{styles:rq(n)}):null,L?Z.createElement(qW,{noRelative:t.noRelative,gapMode:t.gapMode}):null)}function sq(t){for(var e=null;t!==null;)t instanceof ShadowRoot&&(e=t.host,t=t.host),t=t.parentNode;return e}const oq=LW(EB,nq);var PB=Z.forwardRef(function(t,e){return Z.createElement(K1,Ll({},t,{ref:e,sideCar:oq}))});PB.classNames=K1.classNames;var aq=function(t){if(typeof document>"u")return null;var e=Array.isArray(t)?t[0]:t;return e.ownerDocument.body},wm=new WeakMap,ev=new WeakMap,tv={},Rx=0,RB=function(t){return t&&(t.host||RB(t.parentNode))},lq=function(t,e){return e.map(function(r){if(t.contains(r))return r;var i=RB(r);return i&&t.contains(i)?i:(console.error("aria-hidden",r,"in not contained inside",t,". Doing nothing"),null)}).filter(function(r){return!!r})},cq=function(t,e,r,i){var n=lq(e,Array.isArray(t)?t:[t]);tv[r]||(tv[r]=new WeakMap);var l=tv[r],c=[],o=new Set,m=new Set(n),b=function(R){!R||o.has(R)||(o.add(R),b(R.parentNode))};n.forEach(b);var A=function(R){!R||m.has(R)||Array.prototype.forEach.call(R.children,function(M){if(o.has(M))A(M);else try{var L=M.getAttribute(i),G=L!==null&&L!=="false",V=(wm.get(M)||0)+1,q=(l.get(M)||0)+1;wm.set(M,V),l.set(M,q),c.push(M),V===1&&G&&ev.set(M,!0),q===1&&M.setAttribute(r,"true"),G||M.setAttribute(i,"true")}catch(J){console.error("aria-hidden: cannot operate on ",M,J)}})};return A(e),o.clear(),Rx++,function(){c.forEach(function(R){var M=wm.get(R)-1,L=l.get(R)-1;wm.set(R,M),l.set(R,L),M||(ev.has(R)||R.removeAttribute(i),ev.delete(R)),L||R.removeAttribute(r)}),Rx--,Rx||(wm=new WeakMap,wm=new WeakMap,ev=new WeakMap,tv={})}},uq=function(t,e,r){r===void 0&&(r="data-aria-hidden");var i=Array.from(Array.isArray(t)?t:[t]),n=aq(t);return n?(i.push.apply(i,Array.from(n.querySelectorAll("[aria-live], script"))),cq(i,n,r,"aria-hidden")):function(){return null}};function hq(t){const e=dq(t),r=Z.forwardRef((i,n)=>{const{children:l,...c}=i,o=Z.Children.toArray(l),m=o.find(pq);if(m){const b=m.props.children,A=o.map(R=>R===m?Z.Children.count(b)>1?Z.Children.only(null):Z.isValidElement(b)?b.props.children:null:R);return j.jsx(e,{...c,ref:n,children:Z.isValidElement(b)?Z.cloneElement(b,void 0,A):null})}return j.jsx(e,{...c,ref:n,children:l})});return r.displayName=`${t}.Slot`,r}function dq(t){const e=Z.forwardRef((r,i)=>{const{children:n,...l}=r;if(Z.isValidElement(n)){const c=gq(n),o=mq(l,n.props);return n.type!==Z.Fragment&&(o.ref=i?Ny(i,c):c),Z.cloneElement(n,o)}return Z.Children.count(n)>1?Z.Children.only(null):null});return e.displayName=`${t}.SlotClone`,e}var fq=Symbol("radix.slottable");function pq(t){return Z.isValidElement(t)&&typeof t.type=="function"&&"__radixId"in t.type&&t.type.__radixId===fq}function mq(t,e){const r={...e};for(const i in e){const n=t[i],l=e[i];/^on[A-Z]/.test(i)?n&&l?r[i]=(...o)=>{const m=l(...o);return n(...o),m}:n&&(r[i]=n):i==="style"?r[i]={...n,...l}:i==="className"&&(r[i]=[n,l].filter(Boolean).join(" "))}return{...t,...r}}function gq(t){let e=Object.getOwnPropertyDescriptor(t.props,"ref")?.get,r=e&&"isReactWarning"in e&&e.isReactWarning;return r?t.ref:(e=Object.getOwnPropertyDescriptor(t,"ref")?.get,r=e&&"isReactWarning"in e&&e.isReactWarning,r?t.props.ref:t.props.ref||t.ref)}var Z1="Dialog",[MB]=Sg(Z1),[_q,kc]=MB(Z1),IB=t=>{const{__scopeDialog:e,children:r,open:i,defaultOpen:n,onOpenChange:l,modal:c=!0}=t,o=Z.useRef(null),m=Z.useRef(null),[b,A]=V1({prop:i,defaultProp:n??!1,onChange:l,caller:Z1});return j.jsx(_q,{scope:e,triggerRef:o,contentRef:m,contentId:ey(),titleId:ey(),descriptionId:ey(),open:b,onOpenChange:A,onOpenToggle:Z.useCallback(()=>A(R=>!R),[A]),modal:c,children:r})};IB.displayName=Z1;var kB="DialogTrigger",BB=Z.forwardRef((t,e)=>{const{__scopeDialog:r,...i}=t,n=kc(kB,r),l=Bn(e,n.triggerRef);return j.jsx(nn.button,{type:"button","aria-haspopup":"dialog","aria-expanded":n.open,"aria-controls":n.contentId,"data-state":PA(n.open),...i,ref:l,onClick:xi(t.onClick,n.onOpenToggle)})});BB.displayName=kB;var SA="DialogPortal",[yq,LB]=MB(SA,{forceMount:void 0}),OB=t=>{const{__scopeDialog:e,forceMount:r,children:i,container:n}=t,l=kc(SA,e);return j.jsx(yq,{scope:e,forceMount:r,children:Z.Children.map(i,c=>j.jsx(Bh,{present:r||l.open,children:j.jsx(xB,{asChild:!0,container:n,children:c})}))})};OB.displayName=SA;var a1="DialogOverlay",DB=Z.forwardRef((t,e)=>{const r=LB(a1,t.__scopeDialog),{forceMount:i=r.forceMount,...n}=t,l=kc(a1,t.__scopeDialog);return l.modal?j.jsx(Bh,{present:i||l.open,children:j.jsx(bq,{...n,ref:e})}):null});DB.displayName=a1;var vq=hq("DialogOverlay.RemoveScroll"),bq=Z.forwardRef((t,e)=>{const{__scopeDialog:r,...i}=t,n=kc(a1,r);return j.jsx(PB,{as:vq,allowPinchZoom:!0,shards:[n.contentRef],children:j.jsx(nn.div,{"data-state":PA(n.open),...i,ref:e,style:{pointerEvents:"auto",...i.style}})})}),Rp="DialogContent",NB=Z.forwardRef((t,e)=>{const r=LB(Rp,t.__scopeDialog),{forceMount:i=r.forceMount,...n}=t,l=kc(Rp,t.__scopeDialog);return j.jsx(Bh,{present:i||l.open,children:l.modal?j.jsx(xq,{...n,ref:e}):j.jsx(wq,{...n,ref:e})})});NB.displayName=Rp;var xq=Z.forwardRef((t,e)=>{const r=kc(Rp,t.__scopeDialog),i=Z.useRef(null),n=Bn(e,r.contentRef,i);return Z.useEffect(()=>{const l=i.current;if(l)return uq(l)},[]),j.jsx(FB,{...t,ref:n,trapFocus:r.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:xi(t.onCloseAutoFocus,l=>{l.preventDefault(),r.triggerRef.current?.focus()}),onPointerDownOutside:xi(t.onPointerDownOutside,l=>{const c=l.detail.originalEvent,o=c.button===0&&c.ctrlKey===!0;(c.button===2||o)&&l.preventDefault()}),onFocusOutside:xi(t.onFocusOutside,l=>l.preventDefault())})}),wq=Z.forwardRef((t,e)=>{const r=kc(Rp,t.__scopeDialog),i=Z.useRef(!1),n=Z.useRef(!1);return j.jsx(FB,{...t,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:l=>{t.onCloseAutoFocus?.(l),l.defaultPrevented||(i.current||r.triggerRef.current?.focus(),l.preventDefault()),i.current=!1,n.current=!1},onInteractOutside:l=>{t.onInteractOutside?.(l),l.defaultPrevented||(i.current=!0,l.detail.originalEvent.type==="pointerdown"&&(n.current=!0));const c=l.target;r.triggerRef.current?.contains(c)&&l.preventDefault(),l.detail.originalEvent.type==="focusin"&&n.current&&l.preventDefault()}})}),FB=Z.forwardRef((t,e)=>{const{__scopeDialog:r,trapFocus:i,onOpenAutoFocus:n,onCloseAutoFocus:l,...c}=t,o=kc(Rp,r),m=Z.useRef(null),b=Bn(e,m);return TW(),j.jsxs(j.Fragment,{children:[j.jsx(vB,{asChild:!0,loop:!0,trapped:i,onMountAutoFocus:n,onUnmountAutoFocus:l,children:j.jsx(_B,{role:"dialog",id:o.contentId,"aria-describedby":o.descriptionId,"aria-labelledby":o.titleId,"data-state":PA(o.open),...c,ref:b,onDismiss:()=>o.onOpenChange(!1)})}),j.jsxs(j.Fragment,{children:[j.jsx(Eq,{titleId:o.titleId}),j.jsx(Tq,{contentRef:m,descriptionId:o.descriptionId})]})]})}),CA="DialogTitle",zB=Z.forwardRef((t,e)=>{const{__scopeDialog:r,...i}=t,n=kc(CA,r);return j.jsx(nn.h2,{id:n.titleId,...i,ref:e})});zB.displayName=CA;var jB="DialogDescription",UB=Z.forwardRef((t,e)=>{const{__scopeDialog:r,...i}=t,n=kc(jB,r);return j.jsx(nn.p,{id:n.descriptionId,...i,ref:e})});UB.displayName=jB;var VB="DialogClose",GB=Z.forwardRef((t,e)=>{const{__scopeDialog:r,...i}=t,n=kc(VB,r);return j.jsx(nn.button,{type:"button",...i,ref:e,onClick:xi(t.onClick,()=>n.onOpenChange(!1))})});GB.displayName=VB;function PA(t){return t?"open":"closed"}var HB="DialogTitleWarning",[qpe,$B]=h7(HB,{contentName:Rp,titleName:CA,docsSlug:"dialog"}),Eq=({titleId:t})=>{const e=$B(HB),r=`\`${e.contentName}\` requires a \`${e.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${e.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${e.docsSlug}`;return Z.useEffect(()=>{t&&(document.getElementById(t)||console.error(r))},[r,t]),null},Aq="DialogDescriptionWarning",Tq=({contentRef:t,descriptionId:e})=>{const i=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${$B(Aq).contentName}}.`;return Z.useEffect(()=>{const n=t.current?.getAttribute("aria-describedby");e&&n&&(document.getElementById(e)||console.warn(i))},[i,t,e]),null},Sq=IB,Cq=BB,Pq=OB,Rq=DB,Mq=NB,Iq=zB,kq=UB,Bq=GB;function RA({...t}){return j.jsx(Sq,{"data-slot":"dialog",...t})}function Lq({...t}){return j.jsx(Cq,{"data-slot":"dialog-trigger",...t})}function Oq({...t}){return j.jsx(Pq,{"data-slot":"dialog-portal",...t})}function Dq({className:t,...e}){return j.jsx(Rq,{"data-slot":"dialog-overlay",className:Ri("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",t),...e})}function MA({className:t,children:e,...r}){return j.jsxs(Oq,{"data-slot":"dialog-portal",children:[j.jsx(Dq,{}),j.jsxs(Mq,{"data-slot":"dialog-content",className:Ri("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",t),...r,children:[e,j.jsxs(Bq,{className:"ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",children:[j.jsx(D1,{}),j.jsx("span",{className:"sr-only",children:"Close"})]})]})]})}function IA({className:t,...e}){return j.jsx("div",{"data-slot":"dialog-header",className:Ri("flex flex-col gap-2 text-center sm:text-left",t),...e})}function kA({className:t,...e}){return j.jsx(Iq,{"data-slot":"dialog-title",className:Ri("text-lg leading-none font-semibold",t),...e})}function BA({className:t,...e}){return j.jsx(kq,{"data-slot":"dialog-description",className:Ri("text-muted-foreground text-sm",t),...e})}var Nq=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],Fq=Nq.reduce((t,e)=>{const r=lA(`Primitive.${e}`),i=Z.forwardRef((n,l)=>{const{asChild:c,...o}=n,m=c?r:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),j.jsx(m,{...o,ref:l})});return i.displayName=`Primitive.${e}`,{...t,[e]:i}},{}),zq="Label",WB=Z.forwardRef((t,e)=>j.jsx(Fq.label,{...t,ref:e,onMouseDown:r=>{r.target.closest("button, input, select, textarea")||(t.onMouseDown?.(r),!r.defaultPrevented&&r.detail>1&&r.preventDefault())}}));WB.displayName=zq;var jq=WB;function xc({className:t,...e}){return j.jsx(jq,{"data-slot":"label",className:Ri("flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",t),...e})}function Uq({className:t,...e}){return j.jsx("textarea",{"data-slot":"textarea",className:Ri("resize-none border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-input-background px-3 py-2 text-base transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),...e})}const qB=Z.createContext(void 0);function Vq({children:t}){const[e,r]=Z.useState(null),[i,n]=Z.useState(null),[l,c]=Z.useState(!0);Z.useEffect(()=>{xu.auth.getSession().then(({data:{session:G}})=>{n(G),r(G?.user??null),c(!1)});const{data:{subscription:L}}=xu.auth.onAuthStateChange((G,V)=>{n(V),r(V?.user??null)});return()=>L.unsubscribe()},[]);const o=async(L,G,V)=>{const{error:q}=await xu.auth.signUp({email:L,password:G,options:{data:{full_name:V}}});return{error:q}},m=async(L,G)=>{const{error:V}=await xu.auth.signInWithPassword({email:L,password:G});return{error:V}},b=()=>"https://a6an.github.io/Events_App",M={user:e,session:i,loading:l,signUp:o,signIn:m,signInWithGoogle:async()=>{const{error:L}=await xu.auth.signInWithOAuth({provider:"google",options:{redirectTo:b()}});return{error:L}},signOut:async()=>{await xu.auth.signOut()}};return j.jsx(qB.Provider,{value:M,children:t})}function jy(){const t=Z.useContext(qB);if(t===void 0)throw new Error("useAuth must be used within an AuthProvider");return t}const Gq=({onImageSelected:t,className:e})=>{const[r,i]=Z.useState(null),n=Z.useRef(null),[l,c]=Z.useState(!1),o=L=>{if(L.target.files&&L.target.files[0]){const G=L.target.files[0];m(G)}},m=L=>{if(!L.type.startsWith("image/")){alert("Please upload an image file");return}if(L.size>5*1024*1024){alert("File size should be less than 5MB");return}const G=URL.createObjectURL(L);i(G),t(L)},b=L=>{L.preventDefault(),c(!0)},A=L=>{L.preventDefault(),c(!1)},R=L=>{L.preventDefault(),c(!1),L.dataTransfer.files&&L.dataTransfer.files[0]&&m(L.dataTransfer.files[0])},M=()=>{i(null),n.current&&(n.current.value="")};return j.jsxs("div",{className:Ri("w-full",e),children:[j.jsx("input",{type:"file",ref:n,onChange:o,accept:"image/*",className:"hidden"}),r?j.jsxs("div",{className:"relative aspect-video w-full rounded-lg overflow-hidden border border-white/10 group",children:[j.jsx("img",{src:r,alt:"Preview",className:"w-full h-full object-cover"}),j.jsx("div",{className:"absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center",children:j.jsx(ao,{variant:"destructive",size:"icon",onClick:M,className:"rounded-full",children:j.jsx(D1,{className:"h-4 w-4"})})})]}):j.jsxs("div",{onClick:()=>n.current?.click(),onDragOver:b,onDragLeave:A,onDrop:R,className:Ri("border-2 border-dashed rounded-lg p-8 flex flex-col items-center justify-center cursor-pointer transition-colors",l?"border-primary bg-primary/10":"border-white/20 hover:border-white/40 hover:bg-white/5"),children:[j.jsx("div",{className:"bg-white/10 p-3 rounded-full mb-3",children:j.jsx(S8,{className:"h-6 w-6 text-muted-foreground"})}),j.jsx("p",{className:"text-sm font-medium text-foreground mb-1",children:"Click to upload or drag and drop"}),j.jsx("p",{className:"text-xs text-muted-foreground",children:"SVG, PNG, JPG or GIF (max. 5MB)"})]})]})},Hq=()=>{const{user:t}=jy(),[e,r]=Z.useState(!1),[i,n]=Z.useState(!1),[l,c]=Z.useState(null),[o,m]=Z.useState({title:"",description:"",date:"",time:"",location_name:"New Delhi",latitude:28.6139,longitude:77.209,price:0,category:"Social",mood:"Chill"}),b=async A=>{if(A.preventDefault(),!!t){n(!0);try{let R=null;l&&(R=await x$(l));const M=new Date(`${o.date}T${o.time}`);await b$({title:o.title,description:o.description,date:M.toISOString(),location_name:o.location_name,latitude:o.latitude,longitude:o.longitude,price:o.price,capacity:100,image_url:R,host_id:t.id,category:o.category,mood:o.mood}),r(!1),m({title:"",description:"",date:"",time:"",location_name:"New Delhi",latitude:28.6139,longitude:77.209,price:0,category:"Social",mood:"Chill"}),c(null),window.location.reload()}catch(R){console.error("Error creating event:",R)}finally{n(!1)}}};return j.jsxs(RA,{open:e,onOpenChange:r,children:[j.jsx(Lq,{asChild:!0,children:j.jsx(ao,{size:"icon",className:"h-14 w-14 rounded-full bg-primary hover:bg-primary/90 shadow-[0_0_20px_rgba(249,115,22,0.4)] border border-white/20",children:j.jsx(_8,{className:"h-6 w-6"})})}),j.jsxs(MA,{className:"sm:max-w-[425px] bg-background/95 backdrop-blur-xl border-white/10 max-h-[90vh] overflow-y-auto",children:[j.jsxs(IA,{children:[j.jsx(kA,{children:"Host an Event"}),j.jsx(BA,{children:"Create a new event to gather people."})]}),j.jsxs("form",{onSubmit:b,className:"grid gap-4 py-4",children:[j.jsxs("div",{className:"grid gap-2",children:[j.jsx(xc,{children:"Event Image"}),j.jsx(Gq,{onImageSelected:c})]}),j.jsxs("div",{className:"grid gap-2",children:[j.jsx(xc,{htmlFor:"name",children:"Event Name"}),j.jsx(Tu,{id:"name",placeholder:"e.g., Sunset Yoga",className:"bg-white/5 border-white/10",value:o.title,onChange:A=>m({...o,title:A.target.value}),required:!0})]}),j.jsxs("div",{className:"grid gap-2",children:[j.jsx(xc,{htmlFor:"description",children:"Description"}),j.jsx(Uq,{id:"description",placeholder:"What's the vibe?",className:"bg-white/5 border-white/10",value:o.description,onChange:A=>m({...o,description:A.target.value})})]}),j.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[j.jsxs("div",{className:"grid gap-2",children:[j.jsx(xc,{htmlFor:"date",children:"Date"}),j.jsx(Tu,{id:"date",type:"date",className:"bg-white/5 border-white/10",value:o.date,onChange:A=>m({...o,date:A.target.value}),required:!0})]}),j.jsxs("div",{className:"grid gap-2",children:[j.jsx(xc,{htmlFor:"time",children:"Time"}),j.jsx(Tu,{id:"time",type:"time",className:"bg-white/5 border-white/10",value:o.time,onChange:A=>m({...o,time:A.target.value}),required:!0})]})]}),j.jsx("div",{className:"flex justify-end",children:j.jsx(ao,{type:"submit",disabled:i,children:i?j.jsxs(j.Fragment,{children:[j.jsx(O1,{className:"mr-2 h-4 w-4 animate-spin"}),"Creating..."]}):"Create Event"})})]})]})]})};(function(){try{if(typeof document<"u"){var t=document.createElement("style");t.appendChild(document.createTextNode(`.maplibregl-map{font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif;overflow:hidden;position:relative;-webkit-tap-highlight-color:rgb(0,0,0,0)}.maplibregl-canvas{left:0;position:absolute;top:0}.maplibregl-map:fullscreen{height:100%;width:100%}.maplibregl-ctrl-group button.maplibregl-ctrl-compass{touch-action:none}.maplibregl-canvas-container.maplibregl-interactive,.maplibregl-ctrl-group button.maplibregl-ctrl-compass{cursor:grab;-webkit-user-select:none;-moz-user-select:none;user-select:none}.maplibregl-canvas-container.maplibregl-interactive.maplibregl-track-pointer{cursor:pointer}.maplibregl-canvas-container.maplibregl-interactive:active,.maplibregl-ctrl-group button.maplibregl-ctrl-compass:active{cursor:grabbing}.maplibregl-canvas-container.maplibregl-touch-zoom-rotate,.maplibregl-canvas-container.maplibregl-touch-zoom-rotate .maplibregl-canvas{touch-action:pan-x pan-y}.maplibregl-canvas-container.maplibregl-touch-drag-pan,.maplibregl-canvas-container.maplibregl-touch-drag-pan .maplibregl-canvas{touch-action:pinch-zoom}.maplibregl-canvas-container.maplibregl-touch-zoom-rotate.maplibregl-touch-drag-pan,.maplibregl-canvas-container.maplibregl-touch-zoom-rotate.maplibregl-touch-drag-pan .maplibregl-canvas{touch-action:none}.maplibregl-canvas-container.maplibregl-touch-drag-pan.maplibregl-cooperative-gestures,.maplibregl-canvas-container.maplibregl-touch-drag-pan.maplibregl-cooperative-gestures .maplibregl-canvas{touch-action:pan-x pan-y}.maplibregl-ctrl-bottom-left,.maplibregl-ctrl-bottom-right,.maplibregl-ctrl-top-left,.maplibregl-ctrl-top-right{pointer-events:none;position:absolute;z-index:2}.maplibregl-ctrl-top-left{left:0;top:0}.maplibregl-ctrl-top-right{right:0;top:0}.maplibregl-ctrl-bottom-left{bottom:0;left:0}.maplibregl-ctrl-bottom-right{bottom:0;right:0}.maplibregl-ctrl{clear:both;pointer-events:auto;transform:translate(0)}.maplibregl-ctrl-top-left .maplibregl-ctrl{float:left;margin:10px 0 0 10px}.maplibregl-ctrl-top-right .maplibregl-ctrl{float:right;margin:10px 10px 0 0}.maplibregl-ctrl-bottom-left .maplibregl-ctrl{float:left;margin:0 0 10px 10px}.maplibregl-ctrl-bottom-right .maplibregl-ctrl{float:right;margin:0 10px 10px 0}.maplibregl-ctrl-group{background:#fff;border-radius:4px}.maplibregl-ctrl-group:not(:empty){box-shadow:0 0 0 2px #0000001a}@media (forced-colors:active){.maplibregl-ctrl-group:not(:empty){box-shadow:0 0 0 2px ButtonText}}.maplibregl-ctrl-group button{background-color:transparent;border:0;box-sizing:border-box;cursor:pointer;display:block;height:29px;outline:none;padding:0;width:29px}.maplibregl-ctrl-group button+button{border-top:1px solid #ddd}.maplibregl-ctrl button .maplibregl-ctrl-icon{background-position:50%;background-repeat:no-repeat;display:block;height:100%;width:100%}@media (forced-colors:active){.maplibregl-ctrl-icon{background-color:transparent}.maplibregl-ctrl-group button+button{border-top:1px solid ButtonText}}.maplibregl-ctrl button::-moz-focus-inner{border:0;padding:0}.maplibregl-ctrl-attrib-button:focus,.maplibregl-ctrl-group button:focus{box-shadow:0 0 2px 2px #0096ff}.maplibregl-ctrl button:disabled{cursor:not-allowed}.maplibregl-ctrl button:disabled .maplibregl-ctrl-icon{opacity:.25}@media (hover:hover){.maplibregl-ctrl button:not(:disabled):hover{background-color:#0000000d}}.maplibregl-ctrl button:not(:disabled):active{background-color:#0000000d}.maplibregl-ctrl-group button:focus:focus-visible{box-shadow:0 0 2px 2px #0096ff}.maplibregl-ctrl-group button:focus:not(:focus-visible){box-shadow:none}.maplibregl-ctrl-group button:focus:first-child{border-radius:4px 4px 0 0}.maplibregl-ctrl-group button:focus:last-child{border-radius:0 0 4px 4px}.maplibregl-ctrl-group button:focus:only-child{border-radius:inherit}.maplibregl-ctrl button.maplibregl-ctrl-zoom-out .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23333' viewBox='0 0 29 29'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-zoom-in .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23333' viewBox='0 0 29 29'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5'/%3E%3C/svg%3E")}@media (forced-colors:active){.maplibregl-ctrl button.maplibregl-ctrl-zoom-out .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23fff' viewBox='0 0 29 29'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-zoom-in .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23fff' viewBox='0 0 29 29'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5'/%3E%3C/svg%3E")}}@media (forced-colors:active) and (prefers-color-scheme:light){.maplibregl-ctrl button.maplibregl-ctrl-zoom-out .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 29 29'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-zoom-in .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 29 29'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5'/%3E%3C/svg%3E")}}.maplibregl-ctrl button.maplibregl-ctrl-fullscreen .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23333' viewBox='0 0 29 29'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-shrink .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 29 29'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1z'/%3E%3C/svg%3E")}@media (forced-colors:active){.maplibregl-ctrl button.maplibregl-ctrl-fullscreen .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23fff' viewBox='0 0 29 29'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-shrink .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23fff' viewBox='0 0 29 29'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1z'/%3E%3C/svg%3E")}}@media (forced-colors:active) and (prefers-color-scheme:light){.maplibregl-ctrl button.maplibregl-ctrl-fullscreen .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 29 29'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-shrink .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 29 29'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1z'/%3E%3C/svg%3E")}}.maplibregl-ctrl button.maplibregl-ctrl-compass .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23333' viewBox='0 0 29 29'%3E%3Cpath d='m10.5 14 4-8 4 8z'/%3E%3Cpath fill='%23ccc' d='m10.5 16 4 8 4-8z'/%3E%3C/svg%3E")}@media (forced-colors:active){.maplibregl-ctrl button.maplibregl-ctrl-compass .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23fff' viewBox='0 0 29 29'%3E%3Cpath d='m10.5 14 4-8 4 8z'/%3E%3Cpath fill='%23ccc' d='m10.5 16 4 8 4-8z'/%3E%3C/svg%3E")}}@media (forced-colors:active) and (prefers-color-scheme:light){.maplibregl-ctrl button.maplibregl-ctrl-compass .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 29 29'%3E%3Cpath d='m10.5 14 4-8 4 8z'/%3E%3Cpath fill='%23ccc' d='m10.5 16 4 8 4-8z'/%3E%3C/svg%3E")}}.maplibregl-ctrl button.maplibregl-ctrl-globe .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='22' height='22' fill='none' stroke='%23333' viewBox='0 0 22 22'%3E%3Ccircle cx='11' cy='11' r='8.5'/%3E%3Cpath d='M17.5 11c0 4.819-3.02 8.5-6.5 8.5S4.5 15.819 4.5 11 7.52 2.5 11 2.5s6.5 3.681 6.5 8.5Z'/%3E%3Cpath d='M13.5 11c0 2.447-.331 4.64-.853 6.206-.262.785-.562 1.384-.872 1.777-.314.399-.58.517-.775.517s-.461-.118-.775-.517c-.31-.393-.61-.992-.872-1.777C8.831 15.64 8.5 13.446 8.5 11s.331-4.64.853-6.206c.262-.785.562-1.384.872-1.777.314-.399.58-.517.775-.517s.461.118.775.517c.31.393.61.992.872 1.777.522 1.565.853 3.76.853 6.206Z'/%3E%3Cpath d='M11 7.5c-1.909 0-3.622-.166-4.845-.428-.616-.132-1.08-.283-1.379-.434a1.3 1.3 0 0 1-.224-.138q.07-.058.224-.138c.299-.151.763-.302 1.379-.434C7.378 5.666 9.091 5.5 11 5.5s3.622.166 4.845.428c.616.132 1.08.283 1.379.434.105.053.177.1.224.138q-.07.058-.224.138c-.299.151-.763.302-1.379.434-1.223.262-2.936.428-4.845.428ZM4.486 6.436ZM11 16.5c-1.909 0-3.622-.166-4.845-.428-.616-.132-1.08-.283-1.379-.434a1.3 1.3 0 0 1-.224-.138 1.3 1.3 0 0 1 .224-.138c.299-.151.763-.302 1.379-.434C7.378 14.666 9.091 14.5 11 14.5s3.622.166 4.845.428c.616.132 1.08.283 1.379.434.105.053.177.1.224.138a1.3 1.3 0 0 1-.224.138c-.299.151-.763.302-1.379.434-1.223.262-2.936.428-4.845.428Zm-6.514-1.064ZM11 12.5c-2.46 0-4.672-.222-6.255-.574-.796-.177-1.406-.38-1.805-.59a1.5 1.5 0 0 1-.39-.272.3.3 0 0 1-.047-.064.3.3 0 0 1 .048-.064c.066-.073.189-.167.389-.272.399-.21 1.009-.413 1.805-.59C6.328 9.722 8.54 9.5 11 9.5s4.672.222 6.256.574c.795.177 1.405.38 1.804.59.2.105.323.2.39.272a.3.3 0 0 1 .047.064.3.3 0 0 1-.048.064 1.4 1.4 0 0 1-.389.272c-.399.21-1.009.413-1.804.59-1.584.352-3.796.574-6.256.574Zm-8.501-1.51v.002zm0 .018v.002zm17.002.002v-.002zm0-.018v-.002z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-globe-enabled .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='22' height='22' fill='none' stroke='%2333b5e5' viewBox='0 0 22 22'%3E%3Ccircle cx='11' cy='11' r='8.5'/%3E%3Cpath d='M17.5 11c0 4.819-3.02 8.5-6.5 8.5S4.5 15.819 4.5 11 7.52 2.5 11 2.5s6.5 3.681 6.5 8.5Z'/%3E%3Cpath d='M13.5 11c0 2.447-.331 4.64-.853 6.206-.262.785-.562 1.384-.872 1.777-.314.399-.58.517-.775.517s-.461-.118-.775-.517c-.31-.393-.61-.992-.872-1.777C8.831 15.64 8.5 13.446 8.5 11s.331-4.64.853-6.206c.262-.785.562-1.384.872-1.777.314-.399.58-.517.775-.517s.461.118.775.517c.31.393.61.992.872 1.777.522 1.565.853 3.76.853 6.206Z'/%3E%3Cpath d='M11 7.5c-1.909 0-3.622-.166-4.845-.428-.616-.132-1.08-.283-1.379-.434a1.3 1.3 0 0 1-.224-.138q.07-.058.224-.138c.299-.151.763-.302 1.379-.434C7.378 5.666 9.091 5.5 11 5.5s3.622.166 4.845.428c.616.132 1.08.283 1.379.434.105.053.177.1.224.138q-.07.058-.224.138c-.299.151-.763.302-1.379.434-1.223.262-2.936.428-4.845.428ZM4.486 6.436ZM11 16.5c-1.909 0-3.622-.166-4.845-.428-.616-.132-1.08-.283-1.379-.434a1.3 1.3 0 0 1-.224-.138 1.3 1.3 0 0 1 .224-.138c.299-.151.763-.302 1.379-.434C7.378 14.666 9.091 14.5 11 14.5s3.622.166 4.845.428c.616.132 1.08.283 1.379.434.105.053.177.1.224.138a1.3 1.3 0 0 1-.224.138c-.299.151-.763.302-1.379.434-1.223.262-2.936.428-4.845.428Zm-6.514-1.064ZM11 12.5c-2.46 0-4.672-.222-6.255-.574-.796-.177-1.406-.38-1.805-.59a1.5 1.5 0 0 1-.39-.272.3.3 0 0 1-.047-.064.3.3 0 0 1 .048-.064c.066-.073.189-.167.389-.272.399-.21 1.009-.413 1.805-.59C6.328 9.722 8.54 9.5 11 9.5s4.672.222 6.256.574c.795.177 1.405.38 1.804.59.2.105.323.2.39.272a.3.3 0 0 1 .047.064.3.3 0 0 1-.048.064 1.4 1.4 0 0 1-.389.272c-.399.21-1.009.413-1.804.59-1.584.352-3.796.574-6.256.574Zm-8.501-1.51v.002zm0 .018v.002zm17.002.002v-.002zm0-.018v-.002z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-terrain .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='22' height='22' fill='%23333' viewBox='0 0 22 22'%3E%3Cpath d='m1.754 13.406 4.453-4.851 3.09 3.09 3.281 3.277.969-.969-3.309-3.312 3.844-4.121 6.148 6.886h1.082v-.855l-7.207-8.07-4.84 5.187L6.169 6.57l-5.48 5.965v.871ZM.688 16.844h20.625v1.375H.688Zm0 0'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-terrain-enabled .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='22' height='22' fill='%2333b5e5' viewBox='0 0 22 22'%3E%3Cpath d='m1.754 13.406 4.453-4.851 3.09 3.09 3.281 3.277.969-.969-3.309-3.312 3.844-4.121 6.148 6.886h1.082v-.855l-7.207-8.07-4.84 5.187L6.169 6.57l-5.48 5.965v.871ZM.688 16.844h20.625v1.375H.688Zm0 0'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23333' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate:disabled .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23aaa' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath fill='red' d='m14 5 1 1-9 9-1-1z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-active .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%2333b5e5' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-active-error .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23e58978' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-background .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%2333b5e5' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-background-error .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23e54e33' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-waiting .maplibregl-ctrl-icon{animation:maplibregl-spin 2s linear infinite}@media (forced-colors:active){.maplibregl-ctrl button.maplibregl-ctrl-geolocate .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23fff' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate:disabled .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23999' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath fill='red' d='m14 5 1 1-9 9-1-1z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-active .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%2333b5e5' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-active-error .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23e58978' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-background .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%2333b5e5' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-background-error .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23e54e33' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3C/svg%3E")}}@media (forced-colors:active) and (prefers-color-scheme:light){.maplibregl-ctrl button.maplibregl-ctrl-geolocate .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate:disabled .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23666' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath fill='red' d='m14 5 1 1-9 9-1-1z'/%3E%3C/svg%3E")}}@keyframes maplibregl-spin{0%{transform:rotate(0)}to{transform:rotate(1turn)}}a.maplibregl-ctrl-logo{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='88' height='23' fill='none'%3E%3Cpath fill='%23000' fill-opacity='.4' fill-rule='evenodd' d='M17.408 16.796h-1.827l2.501-12.095h.198l3.324 6.533.988 2.19.988-2.19 3.258-6.533h.181l2.6 12.095h-1.81l-1.218-5.644-.362-1.71-.658 1.71-2.929 5.644h-.098l-2.914-5.644-.757-1.71-.345 1.71zm1.958-3.42-.726 3.663a1.255 1.255 0 0 1-1.232 1.011h-1.827a1.255 1.255 0 0 1-1.229-1.509l2.501-12.095a1.255 1.255 0 0 1 1.23-1.001h.197a1.25 1.25 0 0 1 1.12.685l3.19 6.273 3.125-6.263a1.25 1.25 0 0 1 1.123-.695h.181a1.255 1.255 0 0 1 1.227.991l1.443 6.71a5 5 0 0 1 .314-.787l.009-.016a4.6 4.6 0 0 1 1.777-1.887c.782-.46 1.668-.667 2.611-.667a4.6 4.6 0 0 1 1.7.32l.306.134c.21-.16.474-.256.759-.256h1.694a1.255 1.255 0 0 1 1.212.925 1.255 1.255 0 0 1 1.212-.925h1.711c.284 0 .545.094.755.252.613-.3 1.312-.45 2.075-.45 1.356 0 2.557.445 3.482 1.4q.47.48.763 1.064V4.701a1.255 1.255 0 0 1 1.255-1.255h1.86A1.255 1.255 0 0 1 54.44 4.7v9.194h2.217c.19 0 .37.043.532.118v-4.77c0-.356.147-.678.385-.906a2.42 2.42 0 0 1-.682-1.71c0-.665.267-1.253.735-1.7a2.45 2.45 0 0 1 1.722-.674 2.43 2.43 0 0 1 1.705.675q.318.302.504.683V4.7a1.255 1.255 0 0 1 1.255-1.255h1.744A1.255 1.255 0 0 1 65.812 4.7v3.335a4.8 4.8 0 0 1 1.526-.246c.938 0 1.817.214 2.59.69a4.47 4.47 0 0 1 1.67 1.743v-.98a1.255 1.255 0 0 1 1.256-1.256h1.777c.233 0 .451.064.639.174a3.4 3.4 0 0 1 1.567-.372c.346 0 .861.02 1.285.232a1.25 1.25 0 0 1 .689 1.004 4.7 4.7 0 0 1 .853-.588c.795-.44 1.675-.647 2.61-.647 1.385 0 2.65.39 3.525 1.396.836.938 1.168 2.173 1.168 3.528q-.001.515-.056 1.051a1.255 1.255 0 0 1-.947 1.09l.408.952a1.255 1.255 0 0 1-.477 1.552c-.418.268-.92.463-1.458.612-.613.171-1.304.244-2.049.244-1.06 0-2.043-.207-2.886-.698l-.015-.008c-.798-.48-1.419-1.135-1.818-1.963l-.004-.008a5.8 5.8 0 0 1-.548-2.512q0-.429.053-.843a1.3 1.3 0 0 1-.333-.086l-.166-.004c-.223 0-.426.062-.643.228-.03.024-.142.139-.142.59v3.883a1.255 1.255 0 0 1-1.256 1.256h-1.777a1.255 1.255 0 0 1-1.256-1.256V15.69l-.032.057a4.8 4.8 0 0 1-1.86 1.833 5.04 5.04 0 0 1-2.484.634 4.5 4.5 0 0 1-1.935-.424 1.25 1.25 0 0 1-.764.258h-1.71a1.255 1.255 0 0 1-1.256-1.255V7.687a2.4 2.4 0 0 1-.428.625c.253.23.412.561.412.93v7.553a1.255 1.255 0 0 1-1.256 1.255h-1.843a1.25 1.25 0 0 1-.894-.373c-.228.23-.544.373-.894.373H51.32a1.255 1.255 0 0 1-1.256-1.255v-1.251l-.061.117a4.7 4.7 0 0 1-1.782 1.884 4.77 4.77 0 0 1-2.485.67 5.6 5.6 0 0 1-1.485-.188l.009 2.764a1.255 1.255 0 0 1-1.255 1.259h-1.729a1.255 1.255 0 0 1-1.255-1.255v-3.537a1.255 1.255 0 0 1-1.167.793h-1.679a1.25 1.25 0 0 1-.77-.263 4.5 4.5 0 0 1-1.945.429c-.885 0-1.724-.21-2.495-.632l-.017-.01a5 5 0 0 1-1.081-.836 1.255 1.255 0 0 1-1.254 1.312h-1.81a1.255 1.255 0 0 1-1.228-.99l-.782-3.625-2.044 3.939a1.25 1.25 0 0 1-1.115.676h-.098a1.25 1.25 0 0 1-1.116-.68l-2.061-3.994zM35.92 16.63l.207-.114.223-.15q.493-.356.735-.785l.061-.118.033 1.332h1.678V9.242h-1.694l-.033 1.267q-.133-.329-.526-.658l-.032-.028a3.2 3.2 0 0 0-.668-.428l-.27-.12a3.3 3.3 0 0 0-1.235-.23q-1.136-.001-1.974.493a3.36 3.36 0 0 0-1.3 1.382q-.445.89-.444 2.074 0 1.2.51 2.107a3.8 3.8 0 0 0 1.382 1.381 3.9 3.9 0 0 0 1.893.477q.795 0 1.455-.33zm-2.789-5.38q-.576.675-.575 1.762 0 1.102.559 1.794.576.675 1.645.675a2.25 2.25 0 0 0 .934-.19 2.2 2.2 0 0 0 .468-.29l.178-.161a2.2 2.2 0 0 0 .397-.561q.244-.5.244-1.15v-.115q0-.708-.296-1.267l-.043-.077a2.2 2.2 0 0 0-.633-.709l-.13-.086-.047-.028a2.1 2.1 0 0 0-1.073-.285q-1.052 0-1.629.692zm2.316 2.706c.163-.17.28-.407.28-.83v-.114c0-.292-.06-.508-.15-.68a.96.96 0 0 0-.353-.389.85.85 0 0 0-.464-.127c-.4 0-.56.114-.664.239l-.01.012c-.148.174-.275.45-.275.945 0 .506.122.801.27.99.097.11.266.224.68.224.303 0 .504-.09.687-.269zm7.545 1.705a2.6 2.6 0 0 0 .331.423q.319.33.755.548l.173.074q.65.255 1.49.255 1.02 0 1.844-.493a3.45 3.45 0 0 0 1.316-1.4q.493-.904.493-2.089 0-1.909-.988-2.913-.988-1.02-2.584-1.02-.898 0-1.575.347a3 3 0 0 0-.415.262l-.199.166a3.4 3.4 0 0 0-.64.82V9.242h-1.712v11.553h1.729l-.017-5.134zm.53-1.138q.206.29.48.5l.155.11.053.034q.51.296 1.119.297 1.07 0 1.645-.675.577-.69.576-1.762 0-1.119-.576-1.777-.558-.675-1.645-.675-.435 0-.835.16a2 2 0 0 0-.284.136 2 2 0 0 0-.363.254 2.2 2.2 0 0 0-.46.569l-.082.162a2.6 2.6 0 0 0-.213 1.072v.115q0 .707.296 1.267l.135.211zm.964-.818a1.1 1.1 0 0 0 .367.385.94.94 0 0 0 .476.118c.423 0 .59-.117.687-.23.159-.194.28-.478.28-.95 0-.53-.133-.8-.266-.952l-.021-.025c-.078-.094-.231-.221-.68-.221a1 1 0 0 0-.503.135l-.012.007a.86.86 0 0 0-.335.343c-.073.133-.132.324-.132.614v.115a1.4 1.4 0 0 0 .14.66zm15.7-6.222q.347-.346.346-.856a1.05 1.05 0 0 0-.345-.79 1.18 1.18 0 0 0-.84-.329q-.51 0-.855.33a1.05 1.05 0 0 0-.346.79q0 .51.346.855.345.346.856.346.51 0 .839-.346zm4.337 9.314.033-1.332q.191.403.59.747l.098.081a4 4 0 0 0 .316.224l.223.122a3.2 3.2 0 0 0 1.44.322 3.8 3.8 0 0 0 1.875-.477 3.5 3.5 0 0 0 1.382-1.366q.527-.89.526-2.09 0-1.184-.444-2.073a3.24 3.24 0 0 0-1.283-1.399q-.823-.51-1.942-.51a3.5 3.5 0 0 0-1.527.344l-.086.043-.165.09a3 3 0 0 0-.33.214q-.432.315-.656.707a2 2 0 0 0-.099.198l.082-1.283V4.701h-1.744v12.095zm.473-2.509a2.5 2.5 0 0 0 .566.7q.117.098.245.18l.144.08a2.1 2.1 0 0 0 .975.232q1.07 0 1.645-.675.576-.69.576-1.778 0-1.102-.576-1.777-.56-.691-1.645-.692a2.2 2.2 0 0 0-1.015.235q-.22.113-.415.282l-.15.142a2.1 2.1 0 0 0-.42.594q-.223.479-.223 1.1v.115q0 .705.293 1.26zm2.616-.293c.157-.191.28-.479.28-.967 0-.51-.13-.79-.276-.961l-.021-.026c-.082-.1-.232-.225-.67-.225a.87.87 0 0 0-.681.279l-.012.011c-.154.155-.274.38-.274.807v.115c0 .285.057.499.144.669a1.1 1.1 0 0 0 .367.405c.137.082.28.123.455.123.423 0 .59-.118.686-.23zm8.266-3.013q.345-.13.724-.14l.069-.002q.493 0 .642.099l.247-1.794q-.196-.099-.717-.099a2.3 2.3 0 0 0-.545.063 2 2 0 0 0-.411.148 2.2 2.2 0 0 0-.4.249 2.5 2.5 0 0 0-.485.499 2.7 2.7 0 0 0-.32.581l-.05.137v-1.48h-1.778v7.553h1.777v-3.884q0-.546.159-.943a1.5 1.5 0 0 1 .466-.636 2.5 2.5 0 0 1 .399-.253 2 2 0 0 1 .224-.099zm9.784 2.656.05-.922q0-1.743-.856-2.698-.838-.97-2.584-.97-1.119-.001-2.007.493a3.46 3.46 0 0 0-1.4 1.382q-.493.906-.493 2.106 0 1.07.428 1.975.428.89 1.332 1.432.906.526 2.255.526.973 0 1.668-.185l.044-.012.135-.04q.613-.184.984-.421l-.542-1.267q-.3.162-.642.274l-.297.087q-.51.131-1.3.131-.954 0-1.497-.444a1.6 1.6 0 0 1-.192-.193q-.366-.44-.512-1.234l-.004-.021zm-5.427-1.256-.003.022h3.752v-.138q-.011-.727-.288-1.118a1 1 0 0 0-.156-.176q-.46-.428-1.316-.428-.986 0-1.494.604-.379.45-.494 1.234zm-27.053 2.77V4.7h-1.86v12.095h5.333V15.15zm7.103-5.908v7.553h-1.843V9.242h1.843z'/%3E%3Cpath fill='%23fff' d='m19.63 11.151-.757-1.71-.345 1.71-1.12 5.644h-1.827L18.083 4.7h.197l3.325 6.533.988 2.19.988-2.19L26.839 4.7h.181l2.6 12.095h-1.81l-1.218-5.644-.362-1.71-.658 1.71-2.93 5.644h-.098l-2.913-5.644zm14.836 5.81q-1.02 0-1.893-.478a3.8 3.8 0 0 1-1.381-1.382q-.51-.906-.51-2.106 0-1.185.444-2.074a3.36 3.36 0 0 1 1.3-1.382q.839-.494 1.974-.494a3.3 3.3 0 0 1 1.234.231 3.3 3.3 0 0 1 .97.575q.396.33.527.659l.033-1.267h1.694v7.553H37.18l-.033-1.332q-.279.593-1.02 1.053a3.17 3.17 0 0 1-1.662.444zm.296-1.482q.938 0 1.58-.642.642-.66.642-1.711v-.115q0-.708-.296-1.267a2.2 2.2 0 0 0-.807-.872 2.1 2.1 0 0 0-1.119-.313q-1.053 0-1.629.692-.575.675-.575 1.76 0 1.103.559 1.795.577.675 1.645.675zm6.521-6.237h1.711v1.4q.906-1.597 2.83-1.597 1.596 0 2.584 1.02.988 1.005.988 2.914 0 1.185-.493 2.09a3.46 3.46 0 0 1-1.316 1.399 3.5 3.5 0 0 1-1.844.493q-.954 0-1.662-.329a2.67 2.67 0 0 1-1.086-.97l.017 5.134h-1.728zm4.048 6.22q1.07 0 1.645-.674.577-.69.576-1.762 0-1.119-.576-1.777-.558-.675-1.645-.675-.592 0-1.12.296-.51.28-.822.823-.296.527-.296 1.234v.115q0 .708.296 1.267.313.543.823.855.51.296 1.119.297z'/%3E%3Cpath fill='%23e1e3e9' d='M51.325 4.7h1.86v10.45h3.473v1.646h-5.333zm7.12 4.542h1.843v7.553h-1.843zm.905-1.415a1.16 1.16 0 0 1-.856-.346 1.17 1.17 0 0 1-.346-.856 1.05 1.05 0 0 1 .346-.79q.346-.329.856-.329.494 0 .839.33a1.05 1.05 0 0 1 .345.79 1.16 1.16 0 0 1-.345.855q-.33.346-.84.346zm7.875 9.133a3.17 3.17 0 0 1-1.662-.444q-.723-.46-1.004-1.053l-.033 1.332h-1.71V4.701h1.743v4.657l-.082 1.283q.279-.658 1.086-1.119a3.5 3.5 0 0 1 1.778-.477q1.119 0 1.942.51a3.24 3.24 0 0 1 1.283 1.4q.445.888.444 2.072 0 1.201-.526 2.09a3.5 3.5 0 0 1-1.382 1.366 3.8 3.8 0 0 1-1.876.477zm-.296-1.481q1.069 0 1.645-.675.577-.69.577-1.778 0-1.102-.577-1.776-.56-.691-1.645-.692a2.12 2.12 0 0 0-1.58.659q-.642.641-.642 1.694v.115q0 .71.296 1.267a2.4 2.4 0 0 0 .807.872 2.1 2.1 0 0 0 1.119.313zm5.927-6.237h1.777v1.481q.263-.757.856-1.217a2.14 2.14 0 0 1 1.349-.46q.527 0 .724.098l-.247 1.794q-.149-.099-.642-.099-.774 0-1.416.494-.626.493-.626 1.58v3.883h-1.777V9.242zm9.534 7.718q-1.35 0-2.255-.526-.904-.543-1.332-1.432a4.6 4.6 0 0 1-.428-1.975q0-1.2.493-2.106a3.46 3.46 0 0 1 1.4-1.382q.889-.495 2.007-.494 1.744 0 2.584.97.855.956.856 2.7 0 .444-.05.92h-5.43q.18 1.005.708 1.45.542.443 1.497.443.79 0 1.3-.131a4 4 0 0 0 .938-.362l.542 1.267q-.411.263-1.119.46-.708.198-1.711.197zm1.596-4.558q.016-1.02-.444-1.432-.46-.428-1.316-.428-1.728 0-1.991 1.86z'/%3E%3Cpath d='M5.074 15.948a.484.657 0 0 0-.486.659v1.84a.484.657 0 0 0 .486.659h4.101a.484.657 0 0 0 .486-.659v-1.84a.484.657 0 0 0-.486-.659zm3.56 1.16H5.617v.838h3.017z' style='fill:%23fff;fill-rule:evenodd;stroke-width:1.03600001'/%3E%3Cg style='stroke-width:1.12603545'%3E%3Cpath d='M-9.408-1.416c-3.833-.025-7.056 2.912-7.08 6.615-.02 3.08 1.653 4.832 3.107 6.268.903.892 1.721 1.74 2.32 2.902l-.525-.004c-.543-.003-.992.304-1.24.639a1.87 1.87 0 0 0-.362 1.121l-.011 1.877c-.003.402.104.787.347 1.125.244.338.688.653 1.23.656l4.142.028c.542.003.99-.306 1.238-.641a1.87 1.87 0 0 0 .363-1.121l.012-1.875a1.87 1.87 0 0 0-.348-1.127c-.243-.338-.688-.653-1.23-.656l-.518-.004c.597-1.145 1.425-1.983 2.348-2.87 1.473-1.414 3.18-3.149 3.2-6.226-.016-3.59-2.923-6.684-6.993-6.707m-.006 1.1v.002c3.274.02 5.92 2.532 5.9 5.6-.017 2.706-1.39 4.026-2.863 5.44-1.034.994-2.118 2.033-2.814 3.633-.018.041-.052.055-.075.065q-.013.004-.02.01a.34.34 0 0 1-.226.084.34.34 0 0 1-.224-.086l-.092-.077c-.699-1.615-1.768-2.669-2.781-3.67-1.454-1.435-2.797-2.762-2.78-5.478.02-3.067 2.7-5.545 5.975-5.523m-.02 2.826c-1.62-.01-2.944 1.315-2.955 2.96-.01 1.646 1.295 2.988 2.916 2.999h.002c1.621.01 2.943-1.316 2.953-2.961.011-1.646-1.294-2.988-2.916-2.998m-.005 1.1c1.017.006 1.829.83 1.822 1.89s-.83 1.874-1.848 1.867c-1.018-.006-1.829-.83-1.822-1.89s.83-1.874 1.848-1.868m-2.155 11.857 4.14.025c.271.002.49.305.487.676l-.013 1.875c-.003.37-.224.67-.495.668l-4.14-.025c-.27-.002-.487-.306-.485-.676l.012-1.875c.003-.37.224-.67.494-.668' style='color:%23000;font-style:normal;font-variant:normal;font-weight:400;font-stretch:normal;font-size:medium;line-height:normal;font-family:sans-serif;font-variant-ligatures:normal;font-variant-position:normal;font-variant-caps:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-feature-settings:normal;text-indent:0;text-align:start;text-decoration:none;text-decoration-line:none;text-decoration-style:solid;text-decoration-color:%23000;letter-spacing:normal;word-spacing:normal;text-transform:none;writing-mode:lr-tb;direction:ltr;text-orientation:mixed;dominant-baseline:auto;baseline-shift:baseline;text-anchor:start;white-space:normal;shape-padding:0;clip-rule:evenodd;display:inline;overflow:visible;visibility:visible;opacity:1;isolation:auto;mix-blend-mode:normal;color-interpolation:sRGB;color-interpolation-filters:linearRGB;solid-color:%23000;solid-opacity:1;vector-effect:none;fill:%23000;fill-opacity:.4;fill-rule:evenodd;stroke:none;stroke-width:2.47727823;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;color-rendering:auto;image-rendering:auto;shape-rendering:auto;text-rendering:auto' transform='translate(15.553 2.85)scale(.88807)'/%3E%3Cpath d='M-9.415-.316C-12.69-.338-15.37 2.14-15.39 5.207c-.017 2.716 1.326 4.041 2.78 5.477 1.013 1 2.081 2.055 2.78 3.67l.092.076a.34.34 0 0 0 .225.086.34.34 0 0 0 .227-.083l.019-.01c.022-.009.057-.024.074-.064.697-1.6 1.78-2.64 2.814-3.634 1.473-1.414 2.847-2.733 2.864-5.44.02-3.067-2.627-5.58-5.901-5.601m-.057 8.784c1.621.011 2.944-1.315 2.955-2.96.01-1.646-1.295-2.988-2.916-2.999-1.622-.01-2.945 1.315-2.955 2.96s1.295 2.989 2.916 3' style='clip-rule:evenodd;fill:%23e1e3e9;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:2.47727823;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:.4' transform='translate(15.553 2.85)scale(.88807)'/%3E%3Cpath d='M-11.594 15.465c-.27-.002-.492.297-.494.668l-.012 1.876c-.003.371.214.673.485.675l4.14.027c.271.002.492-.298.495-.668l.012-1.877c.003-.37-.215-.672-.485-.674z' style='clip-rule:evenodd;fill:%23fff;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:2.47727823;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:.4' transform='translate(15.553 2.85)scale(.88807)'/%3E%3C/g%3E%3C/svg%3E");background-repeat:no-repeat;cursor:pointer;display:block;height:23px;margin:0 0 -4px -4px;overflow:hidden;width:88px}a.maplibregl-ctrl-logo.maplibregl-compact{width:14px}@media (forced-colors:active){a.maplibregl-ctrl-logo{background-color:transparent;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='88' height='23' fill='none'%3E%3Cpath fill='%23000' fill-opacity='.4' fill-rule='evenodd' d='M17.408 16.796h-1.827l2.501-12.095h.198l3.324 6.533.988 2.19.988-2.19 3.258-6.533h.181l2.6 12.095h-1.81l-1.218-5.644-.362-1.71-.658 1.71-2.929 5.644h-.098l-2.914-5.644-.757-1.71-.345 1.71zm1.958-3.42-.726 3.663a1.255 1.255 0 0 1-1.232 1.011h-1.827a1.255 1.255 0 0 1-1.229-1.509l2.501-12.095a1.255 1.255 0 0 1 1.23-1.001h.197a1.25 1.25 0 0 1 1.12.685l3.19 6.273 3.125-6.263a1.25 1.25 0 0 1 1.123-.695h.181a1.255 1.255 0 0 1 1.227.991l1.443 6.71a5 5 0 0 1 .314-.787l.009-.016a4.6 4.6 0 0 1 1.777-1.887c.782-.46 1.668-.667 2.611-.667a4.6 4.6 0 0 1 1.7.32l.306.134c.21-.16.474-.256.759-.256h1.694a1.255 1.255 0 0 1 1.212.925 1.255 1.255 0 0 1 1.212-.925h1.711c.284 0 .545.094.755.252.613-.3 1.312-.45 2.075-.45 1.356 0 2.557.445 3.482 1.4q.47.48.763 1.064V4.701a1.255 1.255 0 0 1 1.255-1.255h1.86A1.255 1.255 0 0 1 54.44 4.7v9.194h2.217c.19 0 .37.043.532.118v-4.77c0-.356.147-.678.385-.906a2.42 2.42 0 0 1-.682-1.71c0-.665.267-1.253.735-1.7a2.45 2.45 0 0 1 1.722-.674 2.43 2.43 0 0 1 1.705.675q.318.302.504.683V4.7a1.255 1.255 0 0 1 1.255-1.255h1.744A1.255 1.255 0 0 1 65.812 4.7v3.335a4.8 4.8 0 0 1 1.526-.246c.938 0 1.817.214 2.59.69a4.47 4.47 0 0 1 1.67 1.743v-.98a1.255 1.255 0 0 1 1.256-1.256h1.777c.233 0 .451.064.639.174a3.4 3.4 0 0 1 1.567-.372c.346 0 .861.02 1.285.232a1.25 1.25 0 0 1 .689 1.004 4.7 4.7 0 0 1 .853-.588c.795-.44 1.675-.647 2.61-.647 1.385 0 2.65.39 3.525 1.396.836.938 1.168 2.173 1.168 3.528q-.001.515-.056 1.051a1.255 1.255 0 0 1-.947 1.09l.408.952a1.255 1.255 0 0 1-.477 1.552c-.418.268-.92.463-1.458.612-.613.171-1.304.244-2.049.244-1.06 0-2.043-.207-2.886-.698l-.015-.008c-.798-.48-1.419-1.135-1.818-1.963l-.004-.008a5.8 5.8 0 0 1-.548-2.512q0-.429.053-.843a1.3 1.3 0 0 1-.333-.086l-.166-.004c-.223 0-.426.062-.643.228-.03.024-.142.139-.142.59v3.883a1.255 1.255 0 0 1-1.256 1.256h-1.777a1.255 1.255 0 0 1-1.256-1.256V15.69l-.032.057a4.8 4.8 0 0 1-1.86 1.833 5.04 5.04 0 0 1-2.484.634 4.5 4.5 0 0 1-1.935-.424 1.25 1.25 0 0 1-.764.258h-1.71a1.255 1.255 0 0 1-1.256-1.255V7.687a2.4 2.4 0 0 1-.428.625c.253.23.412.561.412.93v7.553a1.255 1.255 0 0 1-1.256 1.255h-1.843a1.25 1.25 0 0 1-.894-.373c-.228.23-.544.373-.894.373H51.32a1.255 1.255 0 0 1-1.256-1.255v-1.251l-.061.117a4.7 4.7 0 0 1-1.782 1.884 4.77 4.77 0 0 1-2.485.67 5.6 5.6 0 0 1-1.485-.188l.009 2.764a1.255 1.255 0 0 1-1.255 1.259h-1.729a1.255 1.255 0 0 1-1.255-1.255v-3.537a1.255 1.255 0 0 1-1.167.793h-1.679a1.25 1.25 0 0 1-.77-.263 4.5 4.5 0 0 1-1.945.429c-.885 0-1.724-.21-2.495-.632l-.017-.01a5 5 0 0 1-1.081-.836 1.255 1.255 0 0 1-1.254 1.312h-1.81a1.255 1.255 0 0 1-1.228-.99l-.782-3.625-2.044 3.939a1.25 1.25 0 0 1-1.115.676h-.098a1.25 1.25 0 0 1-1.116-.68l-2.061-3.994zM35.92 16.63l.207-.114.223-.15q.493-.356.735-.785l.061-.118.033 1.332h1.678V9.242h-1.694l-.033 1.267q-.133-.329-.526-.658l-.032-.028a3.2 3.2 0 0 0-.668-.428l-.27-.12a3.3 3.3 0 0 0-1.235-.23q-1.136-.001-1.974.493a3.36 3.36 0 0 0-1.3 1.382q-.445.89-.444 2.074 0 1.2.51 2.107a3.8 3.8 0 0 0 1.382 1.381 3.9 3.9 0 0 0 1.893.477q.795 0 1.455-.33zm-2.789-5.38q-.576.675-.575 1.762 0 1.102.559 1.794.576.675 1.645.675a2.25 2.25 0 0 0 .934-.19 2.2 2.2 0 0 0 .468-.29l.178-.161a2.2 2.2 0 0 0 .397-.561q.244-.5.244-1.15v-.115q0-.708-.296-1.267l-.043-.077a2.2 2.2 0 0 0-.633-.709l-.13-.086-.047-.028a2.1 2.1 0 0 0-1.073-.285q-1.052 0-1.629.692zm2.316 2.706c.163-.17.28-.407.28-.83v-.114c0-.292-.06-.508-.15-.68a.96.96 0 0 0-.353-.389.85.85 0 0 0-.464-.127c-.4 0-.56.114-.664.239l-.01.012c-.148.174-.275.45-.275.945 0 .506.122.801.27.99.097.11.266.224.68.224.303 0 .504-.09.687-.269zm7.545 1.705a2.6 2.6 0 0 0 .331.423q.319.33.755.548l.173.074q.65.255 1.49.255 1.02 0 1.844-.493a3.45 3.45 0 0 0 1.316-1.4q.493-.904.493-2.089 0-1.909-.988-2.913-.988-1.02-2.584-1.02-.898 0-1.575.347a3 3 0 0 0-.415.262l-.199.166a3.4 3.4 0 0 0-.64.82V9.242h-1.712v11.553h1.729l-.017-5.134zm.53-1.138q.206.29.48.5l.155.11.053.034q.51.296 1.119.297 1.07 0 1.645-.675.577-.69.576-1.762 0-1.119-.576-1.777-.558-.675-1.645-.675-.435 0-.835.16a2 2 0 0 0-.284.136 2 2 0 0 0-.363.254 2.2 2.2 0 0 0-.46.569l-.082.162a2.6 2.6 0 0 0-.213 1.072v.115q0 .707.296 1.267l.135.211zm.964-.818a1.1 1.1 0 0 0 .367.385.94.94 0 0 0 .476.118c.423 0 .59-.117.687-.23.159-.194.28-.478.28-.95 0-.53-.133-.8-.266-.952l-.021-.025c-.078-.094-.231-.221-.68-.221a1 1 0 0 0-.503.135l-.012.007a.86.86 0 0 0-.335.343c-.073.133-.132.324-.132.614v.115a1.4 1.4 0 0 0 .14.66zm15.7-6.222q.347-.346.346-.856a1.05 1.05 0 0 0-.345-.79 1.18 1.18 0 0 0-.84-.329q-.51 0-.855.33a1.05 1.05 0 0 0-.346.79q0 .51.346.855.345.346.856.346.51 0 .839-.346zm4.337 9.314.033-1.332q.191.403.59.747l.098.081a4 4 0 0 0 .316.224l.223.122a3.2 3.2 0 0 0 1.44.322 3.8 3.8 0 0 0 1.875-.477 3.5 3.5 0 0 0 1.382-1.366q.527-.89.526-2.09 0-1.184-.444-2.073a3.24 3.24 0 0 0-1.283-1.399q-.823-.51-1.942-.51a3.5 3.5 0 0 0-1.527.344l-.086.043-.165.09a3 3 0 0 0-.33.214q-.432.315-.656.707a2 2 0 0 0-.099.198l.082-1.283V4.701h-1.744v12.095zm.473-2.509a2.5 2.5 0 0 0 .566.7q.117.098.245.18l.144.08a2.1 2.1 0 0 0 .975.232q1.07 0 1.645-.675.576-.69.576-1.778 0-1.102-.576-1.777-.56-.691-1.645-.692a2.2 2.2 0 0 0-1.015.235q-.22.113-.415.282l-.15.142a2.1 2.1 0 0 0-.42.594q-.223.479-.223 1.1v.115q0 .705.293 1.26zm2.616-.293c.157-.191.28-.479.28-.967 0-.51-.13-.79-.276-.961l-.021-.026c-.082-.1-.232-.225-.67-.225a.87.87 0 0 0-.681.279l-.012.011c-.154.155-.274.38-.274.807v.115c0 .285.057.499.144.669a1.1 1.1 0 0 0 .367.405c.137.082.28.123.455.123.423 0 .59-.118.686-.23zm8.266-3.013q.345-.13.724-.14l.069-.002q.493 0 .642.099l.247-1.794q-.196-.099-.717-.099a2.3 2.3 0 0 0-.545.063 2 2 0 0 0-.411.148 2.2 2.2 0 0 0-.4.249 2.5 2.5 0 0 0-.485.499 2.7 2.7 0 0 0-.32.581l-.05.137v-1.48h-1.778v7.553h1.777v-3.884q0-.546.159-.943a1.5 1.5 0 0 1 .466-.636 2.5 2.5 0 0 1 .399-.253 2 2 0 0 1 .224-.099zm9.784 2.656.05-.922q0-1.743-.856-2.698-.838-.97-2.584-.97-1.119-.001-2.007.493a3.46 3.46 0 0 0-1.4 1.382q-.493.906-.493 2.106 0 1.07.428 1.975.428.89 1.332 1.432.906.526 2.255.526.973 0 1.668-.185l.044-.012.135-.04q.613-.184.984-.421l-.542-1.267q-.3.162-.642.274l-.297.087q-.51.131-1.3.131-.954 0-1.497-.444a1.6 1.6 0 0 1-.192-.193q-.366-.44-.512-1.234l-.004-.021zm-5.427-1.256-.003.022h3.752v-.138q-.011-.727-.288-1.118a1 1 0 0 0-.156-.176q-.46-.428-1.316-.428-.986 0-1.494.604-.379.45-.494 1.234zm-27.053 2.77V4.7h-1.86v12.095h5.333V15.15zm7.103-5.908v7.553h-1.843V9.242h1.843z'/%3E%3Cpath fill='%23fff' d='m19.63 11.151-.757-1.71-.345 1.71-1.12 5.644h-1.827L18.083 4.7h.197l3.325 6.533.988 2.19.988-2.19L26.839 4.7h.181l2.6 12.095h-1.81l-1.218-5.644-.362-1.71-.658 1.71-2.93 5.644h-.098l-2.913-5.644zm14.836 5.81q-1.02 0-1.893-.478a3.8 3.8 0 0 1-1.381-1.382q-.51-.906-.51-2.106 0-1.185.444-2.074a3.36 3.36 0 0 1 1.3-1.382q.839-.494 1.974-.494a3.3 3.3 0 0 1 1.234.231 3.3 3.3 0 0 1 .97.575q.396.33.527.659l.033-1.267h1.694v7.553H37.18l-.033-1.332q-.279.593-1.02 1.053a3.17 3.17 0 0 1-1.662.444zm.296-1.482q.938 0 1.58-.642.642-.66.642-1.711v-.115q0-.708-.296-1.267a2.2 2.2 0 0 0-.807-.872 2.1 2.1 0 0 0-1.119-.313q-1.053 0-1.629.692-.575.675-.575 1.76 0 1.103.559 1.795.577.675 1.645.675zm6.521-6.237h1.711v1.4q.906-1.597 2.83-1.597 1.596 0 2.584 1.02.988 1.005.988 2.914 0 1.185-.493 2.09a3.46 3.46 0 0 1-1.316 1.399 3.5 3.5 0 0 1-1.844.493q-.954 0-1.662-.329a2.67 2.67 0 0 1-1.086-.97l.017 5.134h-1.728zm4.048 6.22q1.07 0 1.645-.674.577-.69.576-1.762 0-1.119-.576-1.777-.558-.675-1.645-.675-.592 0-1.12.296-.51.28-.822.823-.296.527-.296 1.234v.115q0 .708.296 1.267.313.543.823.855.51.296 1.119.297z'/%3E%3Cpath fill='%23e1e3e9' d='M51.325 4.7h1.86v10.45h3.473v1.646h-5.333zm7.12 4.542h1.843v7.553h-1.843zm.905-1.415a1.16 1.16 0 0 1-.856-.346 1.17 1.17 0 0 1-.346-.856 1.05 1.05 0 0 1 .346-.79q.346-.329.856-.329.494 0 .839.33a1.05 1.05 0 0 1 .345.79 1.16 1.16 0 0 1-.345.855q-.33.346-.84.346zm7.875 9.133a3.17 3.17 0 0 1-1.662-.444q-.723-.46-1.004-1.053l-.033 1.332h-1.71V4.701h1.743v4.657l-.082 1.283q.279-.658 1.086-1.119a3.5 3.5 0 0 1 1.778-.477q1.119 0 1.942.51a3.24 3.24 0 0 1 1.283 1.4q.445.888.444 2.072 0 1.201-.526 2.09a3.5 3.5 0 0 1-1.382 1.366 3.8 3.8 0 0 1-1.876.477zm-.296-1.481q1.069 0 1.645-.675.577-.69.577-1.778 0-1.102-.577-1.776-.56-.691-1.645-.692a2.12 2.12 0 0 0-1.58.659q-.642.641-.642 1.694v.115q0 .71.296 1.267a2.4 2.4 0 0 0 .807.872 2.1 2.1 0 0 0 1.119.313zm5.927-6.237h1.777v1.481q.263-.757.856-1.217a2.14 2.14 0 0 1 1.349-.46q.527 0 .724.098l-.247 1.794q-.149-.099-.642-.099-.774 0-1.416.494-.626.493-.626 1.58v3.883h-1.777V9.242zm9.534 7.718q-1.35 0-2.255-.526-.904-.543-1.332-1.432a4.6 4.6 0 0 1-.428-1.975q0-1.2.493-2.106a3.46 3.46 0 0 1 1.4-1.382q.889-.495 2.007-.494 1.744 0 2.584.97.855.956.856 2.7 0 .444-.05.92h-5.43q.18 1.005.708 1.45.542.443 1.497.443.79 0 1.3-.131a4 4 0 0 0 .938-.362l.542 1.267q-.411.263-1.119.46-.708.198-1.711.197zm1.596-4.558q.016-1.02-.444-1.432-.46-.428-1.316-.428-1.728 0-1.991 1.86z'/%3E%3Cpath d='M5.074 15.948a.484.657 0 0 0-.486.659v1.84a.484.657 0 0 0 .486.659h4.101a.484.657 0 0 0 .486-.659v-1.84a.484.657 0 0 0-.486-.659zm3.56 1.16H5.617v.838h3.017z' style='fill:%23fff;fill-rule:evenodd;stroke-width:1.03600001'/%3E%3Cg style='stroke-width:1.12603545'%3E%3Cpath d='M-9.408-1.416c-3.833-.025-7.056 2.912-7.08 6.615-.02 3.08 1.653 4.832 3.107 6.268.903.892 1.721 1.74 2.32 2.902l-.525-.004c-.543-.003-.992.304-1.24.639a1.87 1.87 0 0 0-.362 1.121l-.011 1.877c-.003.402.104.787.347 1.125.244.338.688.653 1.23.656l4.142.028c.542.003.99-.306 1.238-.641a1.87 1.87 0 0 0 .363-1.121l.012-1.875a1.87 1.87 0 0 0-.348-1.127c-.243-.338-.688-.653-1.23-.656l-.518-.004c.597-1.145 1.425-1.983 2.348-2.87 1.473-1.414 3.18-3.149 3.2-6.226-.016-3.59-2.923-6.684-6.993-6.707m-.006 1.1v.002c3.274.02 5.92 2.532 5.9 5.6-.017 2.706-1.39 4.026-2.863 5.44-1.034.994-2.118 2.033-2.814 3.633-.018.041-.052.055-.075.065q-.013.004-.02.01a.34.34 0 0 1-.226.084.34.34 0 0 1-.224-.086l-.092-.077c-.699-1.615-1.768-2.669-2.781-3.67-1.454-1.435-2.797-2.762-2.78-5.478.02-3.067 2.7-5.545 5.975-5.523m-.02 2.826c-1.62-.01-2.944 1.315-2.955 2.96-.01 1.646 1.295 2.988 2.916 2.999h.002c1.621.01 2.943-1.316 2.953-2.961.011-1.646-1.294-2.988-2.916-2.998m-.005 1.1c1.017.006 1.829.83 1.822 1.89s-.83 1.874-1.848 1.867c-1.018-.006-1.829-.83-1.822-1.89s.83-1.874 1.848-1.868m-2.155 11.857 4.14.025c.271.002.49.305.487.676l-.013 1.875c-.003.37-.224.67-.495.668l-4.14-.025c-.27-.002-.487-.306-.485-.676l.012-1.875c.003-.37.224-.67.494-.668' style='color:%23000;font-style:normal;font-variant:normal;font-weight:400;font-stretch:normal;font-size:medium;line-height:normal;font-family:sans-serif;font-variant-ligatures:normal;font-variant-position:normal;font-variant-caps:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-feature-settings:normal;text-indent:0;text-align:start;text-decoration:none;text-decoration-line:none;text-decoration-style:solid;text-decoration-color:%23000;letter-spacing:normal;word-spacing:normal;text-transform:none;writing-mode:lr-tb;direction:ltr;text-orientation:mixed;dominant-baseline:auto;baseline-shift:baseline;text-anchor:start;white-space:normal;shape-padding:0;clip-rule:evenodd;display:inline;overflow:visible;visibility:visible;opacity:1;isolation:auto;mix-blend-mode:normal;color-interpolation:sRGB;color-interpolation-filters:linearRGB;solid-color:%23000;solid-opacity:1;vector-effect:none;fill:%23000;fill-opacity:.4;fill-rule:evenodd;stroke:none;stroke-width:2.47727823;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;color-rendering:auto;image-rendering:auto;shape-rendering:auto;text-rendering:auto' transform='translate(15.553 2.85)scale(.88807)'/%3E%3Cpath d='M-9.415-.316C-12.69-.338-15.37 2.14-15.39 5.207c-.017 2.716 1.326 4.041 2.78 5.477 1.013 1 2.081 2.055 2.78 3.67l.092.076a.34.34 0 0 0 .225.086.34.34 0 0 0 .227-.083l.019-.01c.022-.009.057-.024.074-.064.697-1.6 1.78-2.64 2.814-3.634 1.473-1.414 2.847-2.733 2.864-5.44.02-3.067-2.627-5.58-5.901-5.601m-.057 8.784c1.621.011 2.944-1.315 2.955-2.96.01-1.646-1.295-2.988-2.916-2.999-1.622-.01-2.945 1.315-2.955 2.96s1.295 2.989 2.916 3' style='clip-rule:evenodd;fill:%23e1e3e9;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:2.47727823;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:.4' transform='translate(15.553 2.85)scale(.88807)'/%3E%3Cpath d='M-11.594 15.465c-.27-.002-.492.297-.494.668l-.012 1.876c-.003.371.214.673.485.675l4.14.027c.271.002.492-.298.495-.668l.012-1.877c.003-.37-.215-.672-.485-.674z' style='clip-rule:evenodd;fill:%23fff;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:2.47727823;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:.4' transform='translate(15.553 2.85)scale(.88807)'/%3E%3C/g%3E%3C/svg%3E")}}@media (forced-colors:active) and (prefers-color-scheme:light){a.maplibregl-ctrl-logo{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='88' height='23' fill='none'%3E%3Cpath fill='%23000' fill-opacity='.4' fill-rule='evenodd' d='M17.408 16.796h-1.827l2.501-12.095h.198l3.324 6.533.988 2.19.988-2.19 3.258-6.533h.181l2.6 12.095h-1.81l-1.218-5.644-.362-1.71-.658 1.71-2.929 5.644h-.098l-2.914-5.644-.757-1.71-.345 1.71zm1.958-3.42-.726 3.663a1.255 1.255 0 0 1-1.232 1.011h-1.827a1.255 1.255 0 0 1-1.229-1.509l2.501-12.095a1.255 1.255 0 0 1 1.23-1.001h.197a1.25 1.25 0 0 1 1.12.685l3.19 6.273 3.125-6.263a1.25 1.25 0 0 1 1.123-.695h.181a1.255 1.255 0 0 1 1.227.991l1.443 6.71a5 5 0 0 1 .314-.787l.009-.016a4.6 4.6 0 0 1 1.777-1.887c.782-.46 1.668-.667 2.611-.667a4.6 4.6 0 0 1 1.7.32l.306.134c.21-.16.474-.256.759-.256h1.694a1.255 1.255 0 0 1 1.212.925 1.255 1.255 0 0 1 1.212-.925h1.711c.284 0 .545.094.755.252.613-.3 1.312-.45 2.075-.45 1.356 0 2.557.445 3.482 1.4q.47.48.763 1.064V4.701a1.255 1.255 0 0 1 1.255-1.255h1.86A1.255 1.255 0 0 1 54.44 4.7v9.194h2.217c.19 0 .37.043.532.118v-4.77c0-.356.147-.678.385-.906a2.42 2.42 0 0 1-.682-1.71c0-.665.267-1.253.735-1.7a2.45 2.45 0 0 1 1.722-.674 2.43 2.43 0 0 1 1.705.675q.318.302.504.683V4.7a1.255 1.255 0 0 1 1.255-1.255h1.744A1.255 1.255 0 0 1 65.812 4.7v3.335a4.8 4.8 0 0 1 1.526-.246c.938 0 1.817.214 2.59.69a4.47 4.47 0 0 1 1.67 1.743v-.98a1.255 1.255 0 0 1 1.256-1.256h1.777c.233 0 .451.064.639.174a3.4 3.4 0 0 1 1.567-.372c.346 0 .861.02 1.285.232a1.25 1.25 0 0 1 .689 1.004 4.7 4.7 0 0 1 .853-.588c.795-.44 1.675-.647 2.61-.647 1.385 0 2.65.39 3.525 1.396.836.938 1.168 2.173 1.168 3.528q-.001.515-.056 1.051a1.255 1.255 0 0 1-.947 1.09l.408.952a1.255 1.255 0 0 1-.477 1.552c-.418.268-.92.463-1.458.612-.613.171-1.304.244-2.049.244-1.06 0-2.043-.207-2.886-.698l-.015-.008c-.798-.48-1.419-1.135-1.818-1.963l-.004-.008a5.8 5.8 0 0 1-.548-2.512q0-.429.053-.843a1.3 1.3 0 0 1-.333-.086l-.166-.004c-.223 0-.426.062-.643.228-.03.024-.142.139-.142.59v3.883a1.255 1.255 0 0 1-1.256 1.256h-1.777a1.255 1.255 0 0 1-1.256-1.256V15.69l-.032.057a4.8 4.8 0 0 1-1.86 1.833 5.04 5.04 0 0 1-2.484.634 4.5 4.5 0 0 1-1.935-.424 1.25 1.25 0 0 1-.764.258h-1.71a1.255 1.255 0 0 1-1.256-1.255V7.687a2.4 2.4 0 0 1-.428.625c.253.23.412.561.412.93v7.553a1.255 1.255 0 0 1-1.256 1.255h-1.843a1.25 1.25 0 0 1-.894-.373c-.228.23-.544.373-.894.373H51.32a1.255 1.255 0 0 1-1.256-1.255v-1.251l-.061.117a4.7 4.7 0 0 1-1.782 1.884 4.77 4.77 0 0 1-2.485.67 5.6 5.6 0 0 1-1.485-.188l.009 2.764a1.255 1.255 0 0 1-1.255 1.259h-1.729a1.255 1.255 0 0 1-1.255-1.255v-3.537a1.255 1.255 0 0 1-1.167.793h-1.679a1.25 1.25 0 0 1-.77-.263 4.5 4.5 0 0 1-1.945.429c-.885 0-1.724-.21-2.495-.632l-.017-.01a5 5 0 0 1-1.081-.836 1.255 1.255 0 0 1-1.254 1.312h-1.81a1.255 1.255 0 0 1-1.228-.99l-.782-3.625-2.044 3.939a1.25 1.25 0 0 1-1.115.676h-.098a1.25 1.25 0 0 1-1.116-.68l-2.061-3.994zM35.92 16.63l.207-.114.223-.15q.493-.356.735-.785l.061-.118.033 1.332h1.678V9.242h-1.694l-.033 1.267q-.133-.329-.526-.658l-.032-.028a3.2 3.2 0 0 0-.668-.428l-.27-.12a3.3 3.3 0 0 0-1.235-.23q-1.136-.001-1.974.493a3.36 3.36 0 0 0-1.3 1.382q-.445.89-.444 2.074 0 1.2.51 2.107a3.8 3.8 0 0 0 1.382 1.381 3.9 3.9 0 0 0 1.893.477q.795 0 1.455-.33zm-2.789-5.38q-.576.675-.575 1.762 0 1.102.559 1.794.576.675 1.645.675a2.25 2.25 0 0 0 .934-.19 2.2 2.2 0 0 0 .468-.29l.178-.161a2.2 2.2 0 0 0 .397-.561q.244-.5.244-1.15v-.115q0-.708-.296-1.267l-.043-.077a2.2 2.2 0 0 0-.633-.709l-.13-.086-.047-.028a2.1 2.1 0 0 0-1.073-.285q-1.052 0-1.629.692zm2.316 2.706c.163-.17.28-.407.28-.83v-.114c0-.292-.06-.508-.15-.68a.96.96 0 0 0-.353-.389.85.85 0 0 0-.464-.127c-.4 0-.56.114-.664.239l-.01.012c-.148.174-.275.45-.275.945 0 .506.122.801.27.99.097.11.266.224.68.224.303 0 .504-.09.687-.269zm7.545 1.705a2.6 2.6 0 0 0 .331.423q.319.33.755.548l.173.074q.65.255 1.49.255 1.02 0 1.844-.493a3.45 3.45 0 0 0 1.316-1.4q.493-.904.493-2.089 0-1.909-.988-2.913-.988-1.02-2.584-1.02-.898 0-1.575.347a3 3 0 0 0-.415.262l-.199.166a3.4 3.4 0 0 0-.64.82V9.242h-1.712v11.553h1.729l-.017-5.134zm.53-1.138q.206.29.48.5l.155.11.053.034q.51.296 1.119.297 1.07 0 1.645-.675.577-.69.576-1.762 0-1.119-.576-1.777-.558-.675-1.645-.675-.435 0-.835.16a2 2 0 0 0-.284.136 2 2 0 0 0-.363.254 2.2 2.2 0 0 0-.46.569l-.082.162a2.6 2.6 0 0 0-.213 1.072v.115q0 .707.296 1.267l.135.211zm.964-.818a1.1 1.1 0 0 0 .367.385.94.94 0 0 0 .476.118c.423 0 .59-.117.687-.23.159-.194.28-.478.28-.95 0-.53-.133-.8-.266-.952l-.021-.025c-.078-.094-.231-.221-.68-.221a1 1 0 0 0-.503.135l-.012.007a.86.86 0 0 0-.335.343c-.073.133-.132.324-.132.614v.115a1.4 1.4 0 0 0 .14.66zm15.7-6.222q.347-.346.346-.856a1.05 1.05 0 0 0-.345-.79 1.18 1.18 0 0 0-.84-.329q-.51 0-.855.33a1.05 1.05 0 0 0-.346.79q0 .51.346.855.345.346.856.346.51 0 .839-.346zm4.337 9.314.033-1.332q.191.403.59.747l.098.081a4 4 0 0 0 .316.224l.223.122a3.2 3.2 0 0 0 1.44.322 3.8 3.8 0 0 0 1.875-.477 3.5 3.5 0 0 0 1.382-1.366q.527-.89.526-2.09 0-1.184-.444-2.073a3.24 3.24 0 0 0-1.283-1.399q-.823-.51-1.942-.51a3.5 3.5 0 0 0-1.527.344l-.086.043-.165.09a3 3 0 0 0-.33.214q-.432.315-.656.707a2 2 0 0 0-.099.198l.082-1.283V4.701h-1.744v12.095zm.473-2.509a2.5 2.5 0 0 0 .566.7q.117.098.245.18l.144.08a2.1 2.1 0 0 0 .975.232q1.07 0 1.645-.675.576-.69.576-1.778 0-1.102-.576-1.777-.56-.691-1.645-.692a2.2 2.2 0 0 0-1.015.235q-.22.113-.415.282l-.15.142a2.1 2.1 0 0 0-.42.594q-.223.479-.223 1.1v.115q0 .705.293 1.26zm2.616-.293c.157-.191.28-.479.28-.967 0-.51-.13-.79-.276-.961l-.021-.026c-.082-.1-.232-.225-.67-.225a.87.87 0 0 0-.681.279l-.012.011c-.154.155-.274.38-.274.807v.115c0 .285.057.499.144.669a1.1 1.1 0 0 0 .367.405c.137.082.28.123.455.123.423 0 .59-.118.686-.23zm8.266-3.013q.345-.13.724-.14l.069-.002q.493 0 .642.099l.247-1.794q-.196-.099-.717-.099a2.3 2.3 0 0 0-.545.063 2 2 0 0 0-.411.148 2.2 2.2 0 0 0-.4.249 2.5 2.5 0 0 0-.485.499 2.7 2.7 0 0 0-.32.581l-.05.137v-1.48h-1.778v7.553h1.777v-3.884q0-.546.159-.943a1.5 1.5 0 0 1 .466-.636 2.5 2.5 0 0 1 .399-.253 2 2 0 0 1 .224-.099zm9.784 2.656.05-.922q0-1.743-.856-2.698-.838-.97-2.584-.97-1.119-.001-2.007.493a3.46 3.46 0 0 0-1.4 1.382q-.493.906-.493 2.106 0 1.07.428 1.975.428.89 1.332 1.432.906.526 2.255.526.973 0 1.668-.185l.044-.012.135-.04q.613-.184.984-.421l-.542-1.267q-.3.162-.642.274l-.297.087q-.51.131-1.3.131-.954 0-1.497-.444a1.6 1.6 0 0 1-.192-.193q-.366-.44-.512-1.234l-.004-.021zm-5.427-1.256-.003.022h3.752v-.138q-.011-.727-.288-1.118a1 1 0 0 0-.156-.176q-.46-.428-1.316-.428-.986 0-1.494.604-.379.45-.494 1.234zm-27.053 2.77V4.7h-1.86v12.095h5.333V15.15zm7.103-5.908v7.553h-1.843V9.242h1.843z'/%3E%3Cpath fill='%23fff' d='m19.63 11.151-.757-1.71-.345 1.71-1.12 5.644h-1.827L18.083 4.7h.197l3.325 6.533.988 2.19.988-2.19L26.839 4.7h.181l2.6 12.095h-1.81l-1.218-5.644-.362-1.71-.658 1.71-2.93 5.644h-.098l-2.913-5.644zm14.836 5.81q-1.02 0-1.893-.478a3.8 3.8 0 0 1-1.381-1.382q-.51-.906-.51-2.106 0-1.185.444-2.074a3.36 3.36 0 0 1 1.3-1.382q.839-.494 1.974-.494a3.3 3.3 0 0 1 1.234.231 3.3 3.3 0 0 1 .97.575q.396.33.527.659l.033-1.267h1.694v7.553H37.18l-.033-1.332q-.279.593-1.02 1.053a3.17 3.17 0 0 1-1.662.444zm.296-1.482q.938 0 1.58-.642.642-.66.642-1.711v-.115q0-.708-.296-1.267a2.2 2.2 0 0 0-.807-.872 2.1 2.1 0 0 0-1.119-.313q-1.053 0-1.629.692-.575.675-.575 1.76 0 1.103.559 1.795.577.675 1.645.675zm6.521-6.237h1.711v1.4q.906-1.597 2.83-1.597 1.596 0 2.584 1.02.988 1.005.988 2.914 0 1.185-.493 2.09a3.46 3.46 0 0 1-1.316 1.399 3.5 3.5 0 0 1-1.844.493q-.954 0-1.662-.329a2.67 2.67 0 0 1-1.086-.97l.017 5.134h-1.728zm4.048 6.22q1.07 0 1.645-.674.577-.69.576-1.762 0-1.119-.576-1.777-.558-.675-1.645-.675-.592 0-1.12.296-.51.28-.822.823-.296.527-.296 1.234v.115q0 .708.296 1.267.313.543.823.855.51.296 1.119.297z'/%3E%3Cpath fill='%23e1e3e9' d='M51.325 4.7h1.86v10.45h3.473v1.646h-5.333zm7.12 4.542h1.843v7.553h-1.843zm.905-1.415a1.16 1.16 0 0 1-.856-.346 1.17 1.17 0 0 1-.346-.856 1.05 1.05 0 0 1 .346-.79q.346-.329.856-.329.494 0 .839.33a1.05 1.05 0 0 1 .345.79 1.16 1.16 0 0 1-.345.855q-.33.346-.84.346zm7.875 9.133a3.17 3.17 0 0 1-1.662-.444q-.723-.46-1.004-1.053l-.033 1.332h-1.71V4.701h1.743v4.657l-.082 1.283q.279-.658 1.086-1.119a3.5 3.5 0 0 1 1.778-.477q1.119 0 1.942.51a3.24 3.24 0 0 1 1.283 1.4q.445.888.444 2.072 0 1.201-.526 2.09a3.5 3.5 0 0 1-1.382 1.366 3.8 3.8 0 0 1-1.876.477zm-.296-1.481q1.069 0 1.645-.675.577-.69.577-1.778 0-1.102-.577-1.776-.56-.691-1.645-.692a2.12 2.12 0 0 0-1.58.659q-.642.641-.642 1.694v.115q0 .71.296 1.267a2.4 2.4 0 0 0 .807.872 2.1 2.1 0 0 0 1.119.313zm5.927-6.237h1.777v1.481q.263-.757.856-1.217a2.14 2.14 0 0 1 1.349-.46q.527 0 .724.098l-.247 1.794q-.149-.099-.642-.099-.774 0-1.416.494-.626.493-.626 1.58v3.883h-1.777V9.242zm9.534 7.718q-1.35 0-2.255-.526-.904-.543-1.332-1.432a4.6 4.6 0 0 1-.428-1.975q0-1.2.493-2.106a3.46 3.46 0 0 1 1.4-1.382q.889-.495 2.007-.494 1.744 0 2.584.97.855.956.856 2.7 0 .444-.05.92h-5.43q.18 1.005.708 1.45.542.443 1.497.443.79 0 1.3-.131a4 4 0 0 0 .938-.362l.542 1.267q-.411.263-1.119.46-.708.198-1.711.197zm1.596-4.558q.016-1.02-.444-1.432-.46-.428-1.316-.428-1.728 0-1.991 1.86z'/%3E%3Cpath d='M5.074 15.948a.484.657 0 0 0-.486.659v1.84a.484.657 0 0 0 .486.659h4.101a.484.657 0 0 0 .486-.659v-1.84a.484.657 0 0 0-.486-.659zm3.56 1.16H5.617v.838h3.017z' style='fill:%23fff;fill-rule:evenodd;stroke-width:1.03600001'/%3E%3Cg style='stroke-width:1.12603545'%3E%3Cpath d='M-9.408-1.416c-3.833-.025-7.056 2.912-7.08 6.615-.02 3.08 1.653 4.832 3.107 6.268.903.892 1.721 1.74 2.32 2.902l-.525-.004c-.543-.003-.992.304-1.24.639a1.87 1.87 0 0 0-.362 1.121l-.011 1.877c-.003.402.104.787.347 1.125.244.338.688.653 1.23.656l4.142.028c.542.003.99-.306 1.238-.641a1.87 1.87 0 0 0 .363-1.121l.012-1.875a1.87 1.87 0 0 0-.348-1.127c-.243-.338-.688-.653-1.23-.656l-.518-.004c.597-1.145 1.425-1.983 2.348-2.87 1.473-1.414 3.18-3.149 3.2-6.226-.016-3.59-2.923-6.684-6.993-6.707m-.006 1.1v.002c3.274.02 5.92 2.532 5.9 5.6-.017 2.706-1.39 4.026-2.863 5.44-1.034.994-2.118 2.033-2.814 3.633-.018.041-.052.055-.075.065q-.013.004-.02.01a.34.34 0 0 1-.226.084.34.34 0 0 1-.224-.086l-.092-.077c-.699-1.615-1.768-2.669-2.781-3.67-1.454-1.435-2.797-2.762-2.78-5.478.02-3.067 2.7-5.545 5.975-5.523m-.02 2.826c-1.62-.01-2.944 1.315-2.955 2.96-.01 1.646 1.295 2.988 2.916 2.999h.002c1.621.01 2.943-1.316 2.953-2.961.011-1.646-1.294-2.988-2.916-2.998m-.005 1.1c1.017.006 1.829.83 1.822 1.89s-.83 1.874-1.848 1.867c-1.018-.006-1.829-.83-1.822-1.89s.83-1.874 1.848-1.868m-2.155 11.857 4.14.025c.271.002.49.305.487.676l-.013 1.875c-.003.37-.224.67-.495.668l-4.14-.025c-.27-.002-.487-.306-.485-.676l.012-1.875c.003-.37.224-.67.494-.668' style='color:%23000;font-style:normal;font-variant:normal;font-weight:400;font-stretch:normal;font-size:medium;line-height:normal;font-family:sans-serif;font-variant-ligatures:normal;font-variant-position:normal;font-variant-caps:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-feature-settings:normal;text-indent:0;text-align:start;text-decoration:none;text-decoration-line:none;text-decoration-style:solid;text-decoration-color:%23000;letter-spacing:normal;word-spacing:normal;text-transform:none;writing-mode:lr-tb;direction:ltr;text-orientation:mixed;dominant-baseline:auto;baseline-shift:baseline;text-anchor:start;white-space:normal;shape-padding:0;clip-rule:evenodd;display:inline;overflow:visible;visibility:visible;opacity:1;isolation:auto;mix-blend-mode:normal;color-interpolation:sRGB;color-interpolation-filters:linearRGB;solid-color:%23000;solid-opacity:1;vector-effect:none;fill:%23000;fill-opacity:.4;fill-rule:evenodd;stroke:none;stroke-width:2.47727823;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;color-rendering:auto;image-rendering:auto;shape-rendering:auto;text-rendering:auto' transform='translate(15.553 2.85)scale(.88807)'/%3E%3Cpath d='M-9.415-.316C-12.69-.338-15.37 2.14-15.39 5.207c-.017 2.716 1.326 4.041 2.78 5.477 1.013 1 2.081 2.055 2.78 3.67l.092.076a.34.34 0 0 0 .225.086.34.34 0 0 0 .227-.083l.019-.01c.022-.009.057-.024.074-.064.697-1.6 1.78-2.64 2.814-3.634 1.473-1.414 2.847-2.733 2.864-5.44.02-3.067-2.627-5.58-5.901-5.601m-.057 8.784c1.621.011 2.944-1.315 2.955-2.96.01-1.646-1.295-2.988-2.916-2.999-1.622-.01-2.945 1.315-2.955 2.96s1.295 2.989 2.916 3' style='clip-rule:evenodd;fill:%23e1e3e9;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:2.47727823;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:.4' transform='translate(15.553 2.85)scale(.88807)'/%3E%3Cpath d='M-11.594 15.465c-.27-.002-.492.297-.494.668l-.012 1.876c-.003.371.214.673.485.675l4.14.027c.271.002.492-.298.495-.668l.012-1.877c.003-.37-.215-.672-.485-.674z' style='clip-rule:evenodd;fill:%23fff;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:2.47727823;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:.4' transform='translate(15.553 2.85)scale(.88807)'/%3E%3C/g%3E%3C/svg%3E")}}.maplibregl-ctrl.maplibregl-ctrl-attrib{background-color:#ffffff80;margin:0;padding:0 5px}@media screen{.maplibregl-ctrl-attrib.maplibregl-compact{background-color:#fff;border-radius:12px;box-sizing:content-box;color:#000;margin:10px;min-height:20px;padding:2px 24px 2px 0;position:relative}.maplibregl-ctrl-attrib.maplibregl-compact-show{padding:2px 28px 2px 8px;visibility:visible}.maplibregl-ctrl-bottom-left>.maplibregl-ctrl-attrib.maplibregl-compact-show,.maplibregl-ctrl-top-left>.maplibregl-ctrl-attrib.maplibregl-compact-show{border-radius:12px;padding:2px 8px 2px 28px}.maplibregl-ctrl-attrib.maplibregl-compact .maplibregl-ctrl-attrib-inner{display:none}.maplibregl-ctrl-attrib-button{background-color:#ffffff80;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' fill-rule='evenodd' viewBox='0 0 20 20'%3E%3Cpath d='M4 10a6 6 0 1 0 12 0 6 6 0 1 0-12 0m5-3a1 1 0 1 0 2 0 1 1 0 1 0-2 0m0 3a1 1 0 1 1 2 0v3a1 1 0 1 1-2 0'/%3E%3C/svg%3E");border:0;border-radius:12px;box-sizing:border-box;cursor:pointer;display:none;height:24px;outline:none;position:absolute;right:0;top:0;width:24px}.maplibregl-ctrl-attrib summary.maplibregl-ctrl-attrib-button{-webkit-appearance:none;-moz-appearance:none;appearance:none;list-style:none}.maplibregl-ctrl-attrib summary.maplibregl-ctrl-attrib-button::-webkit-details-marker{display:none}.maplibregl-ctrl-bottom-left .maplibregl-ctrl-attrib-button,.maplibregl-ctrl-top-left .maplibregl-ctrl-attrib-button{left:0}.maplibregl-ctrl-attrib.maplibregl-compact .maplibregl-ctrl-attrib-button,.maplibregl-ctrl-attrib.maplibregl-compact-show .maplibregl-ctrl-attrib-inner{display:block}.maplibregl-ctrl-attrib.maplibregl-compact-show .maplibregl-ctrl-attrib-button{background-color:#0000000d}.maplibregl-ctrl-bottom-right>.maplibregl-ctrl-attrib.maplibregl-compact:after{bottom:0;right:0}.maplibregl-ctrl-top-right>.maplibregl-ctrl-attrib.maplibregl-compact:after{right:0;top:0}.maplibregl-ctrl-top-left>.maplibregl-ctrl-attrib.maplibregl-compact:after{left:0;top:0}.maplibregl-ctrl-bottom-left>.maplibregl-ctrl-attrib.maplibregl-compact:after{bottom:0;left:0}}@media screen and (forced-colors:active){.maplibregl-ctrl-attrib.maplibregl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' fill='%23fff' fill-rule='evenodd' viewBox='0 0 20 20'%3E%3Cpath d='M4 10a6 6 0 1 0 12 0 6 6 0 1 0-12 0m5-3a1 1 0 1 0 2 0 1 1 0 1 0-2 0m0 3a1 1 0 1 1 2 0v3a1 1 0 1 1-2 0'/%3E%3C/svg%3E")}}@media screen and (forced-colors:active) and (prefers-color-scheme:light){.maplibregl-ctrl-attrib.maplibregl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' fill-rule='evenodd' viewBox='0 0 20 20'%3E%3Cpath d='M4 10a6 6 0 1 0 12 0 6 6 0 1 0-12 0m5-3a1 1 0 1 0 2 0 1 1 0 1 0-2 0m0 3a1 1 0 1 1 2 0v3a1 1 0 1 1-2 0'/%3E%3C/svg%3E")}}.maplibregl-ctrl-attrib a{color:#000000bf;text-decoration:none}.maplibregl-ctrl-attrib a:hover{color:inherit;text-decoration:underline}.maplibregl-attrib-empty{display:none}.maplibregl-ctrl-scale{background-color:#ffffffbf;border:2px solid #333;border-top:#333;box-sizing:border-box;color:#333;font-size:10px;padding:0 5px}.maplibregl-popup{display:flex;left:0;pointer-events:none;position:absolute;top:0;will-change:transform}.maplibregl-popup-anchor-top,.maplibregl-popup-anchor-top-left,.maplibregl-popup-anchor-top-right{flex-direction:column}.maplibregl-popup-anchor-bottom,.maplibregl-popup-anchor-bottom-left,.maplibregl-popup-anchor-bottom-right{flex-direction:column-reverse}.maplibregl-popup-anchor-left{flex-direction:row}.maplibregl-popup-anchor-right{flex-direction:row-reverse}.maplibregl-popup-tip{border:10px solid transparent;height:0;width:0;z-index:1}.maplibregl-popup-anchor-top .maplibregl-popup-tip{align-self:center;border-bottom-color:#fff;border-top:none}.maplibregl-popup-anchor-top-left .maplibregl-popup-tip{align-self:flex-start;border-bottom-color:#fff;border-left:none;border-top:none}.maplibregl-popup-anchor-top-right .maplibregl-popup-tip{align-self:flex-end;border-bottom-color:#fff;border-right:none;border-top:none}.maplibregl-popup-anchor-bottom .maplibregl-popup-tip{align-self:center;border-bottom:none;border-top-color:#fff}.maplibregl-popup-anchor-bottom-left .maplibregl-popup-tip{align-self:flex-start;border-bottom:none;border-left:none;border-top-color:#fff}.maplibregl-popup-anchor-bottom-right .maplibregl-popup-tip{align-self:flex-end;border-bottom:none;border-right:none;border-top-color:#fff}.maplibregl-popup-anchor-left .maplibregl-popup-tip{align-self:center;border-left:none;border-right-color:#fff}.maplibregl-popup-anchor-right .maplibregl-popup-tip{align-self:center;border-left-color:#fff;border-right:none}.maplibregl-popup-close-button{background-color:transparent;border:0;border-radius:0 3px 0 0;cursor:pointer;position:absolute;right:0;top:0}.maplibregl-popup-close-button:hover{background-color:#0000000d}.maplibregl-popup-content{background:#fff;border-radius:3px;box-shadow:0 1px 2px #0000001a;padding:15px 10px;pointer-events:auto;position:relative}.maplibregl-popup-anchor-top-left .maplibregl-popup-content{border-top-left-radius:0}.maplibregl-popup-anchor-top-right .maplibregl-popup-content{border-top-right-radius:0}.maplibregl-popup-anchor-bottom-left .maplibregl-popup-content{border-bottom-left-radius:0}.maplibregl-popup-anchor-bottom-right .maplibregl-popup-content{border-bottom-right-radius:0}.maplibregl-popup-track-pointer{display:none}.maplibregl-popup-track-pointer *{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.maplibregl-map:hover .maplibregl-popup-track-pointer{display:flex}.maplibregl-map:active .maplibregl-popup-track-pointer{display:none}.maplibregl-marker{left:0;position:absolute;top:0;transition:opacity .2s;will-change:transform}.maplibregl-user-location-dot,.maplibregl-user-location-dot:before{background-color:#1da1f2;border-radius:50%;height:15px;width:15px}.maplibregl-user-location-dot:before{animation:maplibregl-user-location-dot-pulse 2s infinite;content:"";position:absolute}.maplibregl-user-location-dot:after{border:2px solid #fff;border-radius:50%;box-shadow:0 0 3px #00000059;box-sizing:border-box;content:"";height:19px;left:-2px;position:absolute;top:-2px;width:19px}@keyframes maplibregl-user-location-dot-pulse{0%{opacity:1;transform:scale(1)}70%{opacity:0;transform:scale(3)}to{opacity:0;transform:scale(1)}}.maplibregl-user-location-dot-stale{background-color:#aaa}.maplibregl-user-location-dot-stale:after{display:none}.maplibregl-user-location-accuracy-circle{background-color:#1da1f233;border-radius:100%;height:1px;width:1px}.maplibregl-crosshair,.maplibregl-crosshair .maplibregl-interactive,.maplibregl-crosshair .maplibregl-interactive:active{cursor:crosshair}.maplibregl-boxzoom{background:#fff;border:2px dotted #202020;height:0;left:0;opacity:.5;position:absolute;top:0;width:0}.maplibregl-cooperative-gesture-screen{align-items:center;background:#0006;color:#fff;display:flex;font-size:1.4em;inset:0;justify-content:center;line-height:1.2;opacity:0;padding:1rem;pointer-events:none;position:absolute;transition:opacity 1s ease 1s;z-index:99999}.maplibregl-cooperative-gesture-screen.maplibregl-show{opacity:1;transition:opacity .05s}.maplibregl-cooperative-gesture-screen .maplibregl-mobile-message{display:none}@media (hover:none),(pointer:coarse){.maplibregl-cooperative-gesture-screen .maplibregl-desktop-message{display:none}.maplibregl-cooperative-gesture-screen .maplibregl-mobile-message{display:block}}.maplibregl-pseudo-fullscreen{height:100%!important;left:0!important;position:fixed!important;top:0!important;width:100%!important;z-index:99999}.psv-navbar{display:none!important}`)),document.head.appendChild(t)}}catch(e){console.error("vite-plugin-css-injected-by-js",e)}})();function KB(t,e){for(var r=0;r<e.length;r++){const i=e[r];if(typeof i!="string"&&!Array.isArray(i)){for(const n in i)if(n!=="default"&&!(n in t)){const l=Object.getOwnPropertyDescriptor(i,n);l&&Object.defineProperty(t,n,l.get?l:{enumerable:!0,get:()=>i[n]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}function ZB(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var A2={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v5.6.2/LICENSE.txt
 */var $q=A2.exports,eP;function Wq(){return eP||(eP=1,(function(t,e){(function(r,i){t.exports=i()})($q,(function(){var r={},i={};function n(c,o,m){if(i[c]=m,c==="index"){var b="var sharedModule = {}; ("+i.shared+")(sharedModule); ("+i.worker+")(sharedModule);",A={};return i.shared(A),i.index(r,A),typeof window<"u"&&r.setWorkerUrl(window.URL.createObjectURL(new Blob([b],{type:"text/javascript"}))),r}}n("shared",["exports"],(function(c){function o(h,a,u,p){return new(u||(u=Promise))((function(y,E){function T(D){try{k(p.next(D))}catch(z){E(z)}}function P(D){try{k(p.throw(D))}catch(z){E(z)}}function k(D){var z;D.done?y(D.value):(z=D.value,z instanceof u?z:new u((function($){$(z)}))).then(T,P)}k((p=p.apply(h,a||[])).next())}))}function m(h,a){this.x=h,this.y=a}function b(h){return h&&h.__esModule&&Object.prototype.hasOwnProperty.call(h,"default")?h.default:h}var A,R;typeof SuppressedError=="function"&&SuppressedError,m.prototype={clone(){return new m(this.x,this.y)},add(h){return this.clone()._add(h)},sub(h){return this.clone()._sub(h)},multByPoint(h){return this.clone()._multByPoint(h)},divByPoint(h){return this.clone()._divByPoint(h)},mult(h){return this.clone()._mult(h)},div(h){return this.clone()._div(h)},rotate(h){return this.clone()._rotate(h)},rotateAround(h,a){return this.clone()._rotateAround(h,a)},matMult(h){return this.clone()._matMult(h)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(h){return this.x===h.x&&this.y===h.y},dist(h){return Math.sqrt(this.distSqr(h))},distSqr(h){const a=h.x-this.x,u=h.y-this.y;return a*a+u*u},angle(){return Math.atan2(this.y,this.x)},angleTo(h){return Math.atan2(this.y-h.y,this.x-h.x)},angleWith(h){return this.angleWithSep(h.x,h.y)},angleWithSep(h,a){return Math.atan2(this.x*a-this.y*h,this.x*h+this.y*a)},_matMult(h){const a=h[2]*this.x+h[3]*this.y;return this.x=h[0]*this.x+h[1]*this.y,this.y=a,this},_add(h){return this.x+=h.x,this.y+=h.y,this},_sub(h){return this.x-=h.x,this.y-=h.y,this},_mult(h){return this.x*=h,this.y*=h,this},_div(h){return this.x/=h,this.y/=h,this},_multByPoint(h){return this.x*=h.x,this.y*=h.y,this},_divByPoint(h){return this.x/=h.x,this.y/=h.y,this},_unit(){return this._div(this.mag()),this},_perp(){const h=this.y;return this.y=this.x,this.x=-h,this},_rotate(h){const a=Math.cos(h),u=Math.sin(h),p=u*this.x+a*this.y;return this.x=a*this.x-u*this.y,this.y=p,this},_rotateAround(h,a){const u=Math.cos(h),p=Math.sin(h),y=a.y+p*(this.x-a.x)+u*(this.y-a.y);return this.x=a.x+u*(this.x-a.x)-p*(this.y-a.y),this.y=y,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:m},m.convert=function(h){if(h instanceof m)return h;if(Array.isArray(h))return new m(+h[0],+h[1]);if(h.x!==void 0&&h.y!==void 0)return new m(+h.x,+h.y);throw new Error("Expected [x, y] or {x, y} point format")};var M=(function(){if(R)return A;function h(a,u,p,y){this.cx=3*a,this.bx=3*(p-a)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*u,this.by=3*(y-u)-this.cy,this.ay=1-this.cy-this.by,this.p1x=a,this.p1y=u,this.p2x=p,this.p2y=y}return R=1,A=h,h.prototype={sampleCurveX:function(a){return((this.ax*a+this.bx)*a+this.cx)*a},sampleCurveY:function(a){return((this.ay*a+this.by)*a+this.cy)*a},sampleCurveDerivativeX:function(a){return(3*this.ax*a+2*this.bx)*a+this.cx},solveCurveX:function(a,u){if(u===void 0&&(u=1e-6),a<0)return 0;if(a>1)return 1;for(var p=a,y=0;y<8;y++){var E=this.sampleCurveX(p)-a;if(Math.abs(E)<u)return p;var T=this.sampleCurveDerivativeX(p);if(Math.abs(T)<1e-6)break;p-=E/T}var P=0,k=1;for(p=a,y=0;y<20&&(E=this.sampleCurveX(p),!(Math.abs(E-a)<u));y++)a>E?P=p:k=p,p=.5*(k-P)+P;return p},solve:function(a,u){return this.sampleCurveY(this.solveCurveX(a,u))}},A})(),L=b(M);let G,V;function q(){return G==null&&(G=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),G}function J(){if(V==null&&(V=!1,q())){const h=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(h){for(let u=0;u<25;u++){const p=4*u;h.fillStyle=`rgb(${p},${p+1},${p+2})`,h.fillRect(u%5,Math.floor(u/5),1,1)}const a=h.getImageData(0,0,5,5).data;for(let u=0;u<100;u++)if(u%4!=3&&a[u]!==u){V=!0;break}}}return V||!1}var ie=1e-6,ee=typeof Float32Array<"u"?Float32Array:Array;function me(){var h=new ee(9);return ee!=Float32Array&&(h[1]=0,h[2]=0,h[3]=0,h[5]=0,h[6]=0,h[7]=0),h[0]=1,h[4]=1,h[8]=1,h}function Se(h){return h[0]=1,h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[5]=1,h[6]=0,h[7]=0,h[8]=0,h[9]=0,h[10]=1,h[11]=0,h[12]=0,h[13]=0,h[14]=0,h[15]=1,h}function Me(){var h=new ee(3);return ee!=Float32Array&&(h[0]=0,h[1]=0,h[2]=0),h}function Ve(h){return Math.hypot(h[0],h[1],h[2])}function Be(h,a,u){var p=new ee(3);return p[0]=h,p[1]=a,p[2]=u,p}function $e(h,a,u){return h[0]=a[0]+u[0],h[1]=a[1]+u[1],h[2]=a[2]+u[2],h}function at(h,a,u){return h[0]=a[0]*u,h[1]=a[1]*u,h[2]=a[2]*u,h}function _t(h,a,u){var p=a[0],y=a[1],E=a[2],T=u[0],P=u[1],k=u[2];return h[0]=y*k-E*P,h[1]=E*T-p*k,h[2]=p*P-y*T,h}Math.hypot||(Math.hypot=function(){for(var h=0,a=arguments.length;a--;)h+=arguments[a]*arguments[a];return Math.sqrt(h)});var Nt,sr=Ve;function Ft(h,a,u){var p=a[0],y=a[1],E=a[2],T=a[3];return h[0]=u[0]*p+u[4]*y+u[8]*E+u[12]*T,h[1]=u[1]*p+u[5]*y+u[9]*E+u[13]*T,h[2]=u[2]*p+u[6]*y+u[10]*E+u[14]*T,h[3]=u[3]*p+u[7]*y+u[11]*E+u[15]*T,h}function Ut(){var h=new ee(4);return ee!=Float32Array&&(h[0]=0,h[1]=0,h[2]=0),h[3]=1,h}function Lt(h,a,u,p){var y=.5*Math.PI/180;a*=y,u*=y,p*=y;var E=Math.sin(a),T=Math.cos(a),P=Math.sin(u),k=Math.cos(u),D=Math.sin(p),z=Math.cos(p);return h[0]=E*k*z-T*P*D,h[1]=T*P*z+E*k*D,h[2]=T*k*D-E*P*z,h[3]=T*k*z+E*P*D,h}function At(){var h=new ee(2);return ee!=Float32Array&&(h[0]=0,h[1]=0),h}function Ke(h,a){var u=new ee(2);return u[0]=h,u[1]=a,u}Me(),Nt=new ee(4),ee!=Float32Array&&(Nt[0]=0,Nt[1]=0,Nt[2]=0,Nt[3]=0),Me(),Be(1,0,0),Be(0,1,0),Ut(),Ut(),me(),At();const ft=8192;function Tt(h,a,u){return a*(ft/(h.tileSize*Math.pow(2,u-h.tileID.overscaledZ)))}function ze(h,a){return(h%a+a)%a}function ht(h,a,u){return h*(1-u)+a*u}function Ht(h){if(h<=0)return 0;if(h>=1)return 1;const a=h*h,u=a*h;return 4*(h<.5?u:3*(h-a)+u-.75)}function Jt(h,a,u,p){const y=new L(h,a,u,p);return E=>y.solve(E)}const Pr=Jt(.25,.1,.25,1);function yr(h,a,u){return Math.min(u,Math.max(a,h))}function $t(h,a,u){const p=u-a,y=((h-a)%p+p)%p+a;return y===a?u:y}function pr(h,...a){for(const u of a)for(const p in u)h[p]=u[p];return h}let Qt=1;function Nr(h,a,u){const p={};for(const y in h)p[y]=a.call(this,h[y],y,h);return p}function An(h,a,u){const p={};for(const y in h)a.call(this,h[y],y,h)&&(p[y]=h[y]);return p}function wi(h){return Array.isArray(h)?h.map(wi):typeof h=="object"&&h?Nr(h,wi):h}const Zr={};function si(h){Zr[h]||(typeof console<"u"&&console.warn(h),Zr[h]=!0)}function Tn(h,a,u){return(u.y-h.y)*(a.x-h.x)>(a.y-h.y)*(u.x-h.x)}function zi(h){return typeof WorkerGlobalScope<"u"&&h!==void 0&&h instanceof WorkerGlobalScope}let Ln=null;function Ps(h){return typeof ImageBitmap<"u"&&h instanceof ImageBitmap}const ns="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function ss(h,a,u,p,y){return o(this,void 0,void 0,(function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const E=new VideoFrame(h,{timestamp:0});try{const T=E?.format;if(!T||!T.startsWith("BGR")&&!T.startsWith("RGB"))throw new Error(`Unrecognized format ${T}`);const P=T.startsWith("BGR"),k=new Uint8ClampedArray(p*y*4);if(yield E.copyTo(k,(function(D,z,$,Y,Q){const te=4*Math.max(-z,0),oe=(Math.max(0,$)-$)*Y*4+te,de=4*Y,ve=Math.max(0,z),Fe=Math.max(0,$);return{rect:{x:ve,y:Fe,width:Math.min(D.width,z+Y)-ve,height:Math.min(D.height,$+Q)-Fe},layout:[{offset:oe,stride:de}]}})(h,a,u,p,y)),P)for(let D=0;D<k.length;D+=4){const z=k[D];k[D]=k[D+2],k[D+2]=z}return k}finally{E.close()}}))}let vi,lo;function Po(h,a,u,p){return h.addEventListener(a,u,p),{unsubscribe:()=>{h.removeEventListener(a,u,p)}}}function ea(h){return h*Math.PI/180}function Ro(h){return h/Math.PI*180}const Mo={touchstart:!0,touchmove:!0,touchmoveWindow:!0,touchend:!0,touchcancel:!0},Gs={dblclick:!0,click:!0,mouseover:!0,mouseout:!0,mousedown:!0,mousemove:!0,mousemoveWindow:!0,mouseup:!0,mouseupWindow:!0,contextmenu:!0,wheel:!0},co="AbortError";function Oe(){return new Error(co)}const ne={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function se(h){return ne.REGISTERED_PROTOCOLS[h.substring(0,h.indexOf("://"))]}const ce="global-dispatcher";class xe extends Error{constructor(a,u,p,y){super(`AJAXError: ${u} (${a}): ${p}`),this.status=a,this.statusText=u,this.url=p,this.body=y}}const Ce=()=>zi(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,je=function(h,a){if(/:\/\//.test(h.url)&&!/^https?:|^file:/.test(h.url)){const p=se(h.url);if(p)return p(h,a);if(zi(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:h,targetMapId:ce},a)}if(!(/^file:/.test(u=h.url)||/^file:/.test(Ce())&&!/^\w+:/.test(u))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return(function(p,y){return o(this,void 0,void 0,(function*(){const E=new Request(p.url,{method:p.method||"GET",body:p.body,credentials:p.credentials,headers:p.headers,cache:p.cache,referrer:Ce(),signal:y.signal});let T,P;p.type!=="json"||E.headers.has("Accept")||E.headers.set("Accept","application/json");try{T=yield fetch(E)}catch(D){throw new xe(0,D.message,p.url,new Blob)}if(!T.ok){const D=yield T.blob();throw new xe(T.status,T.statusText,p.url,D)}P=p.type==="arrayBuffer"||p.type==="image"?T.arrayBuffer():p.type==="json"?T.json():T.text();const k=yield P;if(y.signal.aborted)throw Oe();return{data:k,cacheControl:T.headers.get("Cache-Control"),expires:T.headers.get("Expires")}}))})(h,a);if(zi(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:h,mustQueue:!0,targetMapId:ce},a)}var u;return(function(p,y){return new Promise(((E,T)=>{var P;const k=new XMLHttpRequest;k.open(p.method||"GET",p.url,!0),p.type!=="arrayBuffer"&&p.type!=="image"||(k.responseType="arraybuffer");for(const D in p.headers)k.setRequestHeader(D,p.headers[D]);p.type==="json"&&(k.responseType="text",!((P=p.headers)===null||P===void 0)&&P.Accept||k.setRequestHeader("Accept","application/json")),k.withCredentials=p.credentials==="include",k.onerror=()=>{T(new Error(k.statusText))},k.onload=()=>{if(!y.signal.aborted)if((k.status>=200&&k.status<300||k.status===0)&&k.response!==null){let D=k.response;if(p.type==="json")try{D=JSON.parse(k.response)}catch(z){return void T(z)}E({data:D,cacheControl:k.getResponseHeader("Cache-Control"),expires:k.getResponseHeader("Expires")})}else{const D=new Blob([k.response],{type:k.getResponseHeader("Content-Type")});T(new xe(k.status,k.statusText,p.url,D))}},y.signal.addEventListener("abort",(()=>{k.abort(),T(Oe())})),k.send(p.body)}))})(h,a)};function Ye(h){if(!h||h.indexOf("://")<=0||h.indexOf("data:image/")===0||h.indexOf("blob:")===0)return!0;const a=new URL(h),u=window.location;return a.protocol===u.protocol&&a.host===u.host}function De(h,a,u){u[h]&&u[h].indexOf(a)!==-1||(u[h]=u[h]||[],u[h].push(a))}function nt(h,a,u){if(u&&u[h]){const p=u[h].indexOf(a);p!==-1&&u[h].splice(p,1)}}class dt{constructor(a,u={}){pr(this,u),this.type=a}}class lt extends dt{constructor(a,u={}){super("error",pr({error:a},u))}}class Dt{on(a,u){return this._listeners=this._listeners||{},De(a,u,this._listeners),{unsubscribe:()=>{this.off(a,u)}}}off(a,u){return nt(a,u,this._listeners),nt(a,u,this._oneTimeListeners),this}once(a,u){return u?(this._oneTimeListeners=this._oneTimeListeners||{},De(a,u,this._oneTimeListeners),this):new Promise((p=>this.once(a,p)))}fire(a,u){typeof a=="string"&&(a=new dt(a,u||{}));const p=a.type;if(this.listens(p)){a.target=this;const y=this._listeners&&this._listeners[p]?this._listeners[p].slice():[];for(const P of y)P.call(this,a);const E=this._oneTimeListeners&&this._oneTimeListeners[p]?this._oneTimeListeners[p].slice():[];for(const P of E)nt(p,P,this._oneTimeListeners),P.call(this,a);const T=this._eventedParent;T&&(pr(a,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),T.fire(a))}else a instanceof lt&&console.error(a.error);return this}listens(a){return this._listeners&&this._listeners[a]&&this._listeners[a].length>0||this._oneTimeListeners&&this._oneTimeListeners[a]&&this._oneTimeListeners[a].length>0||this._eventedParent&&this._eventedParent.listens(a)}setEventedParent(a,u){return this._eventedParent=a,this._eventedParentData=u,this}}var Ne={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const ar=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Rr(h,a){const u={};for(const p in h)p!=="ref"&&(u[p]=h[p]);return ar.forEach((p=>{p in a&&(u[p]=a[p])})),u}function Wt(h,a){if(Array.isArray(h)){if(!Array.isArray(a)||h.length!==a.length)return!1;for(let u=0;u<h.length;u++)if(!Wt(h[u],a[u]))return!1;return!0}if(typeof h=="object"&&h!==null&&a!==null){if(typeof a!="object"||Object.keys(h).length!==Object.keys(a).length)return!1;for(const u in h)if(!Wt(h[u],a[u]))return!1;return!0}return h===a}function vr(h,a){h.push(a)}function Xr(h,a,u){vr(u,{command:"addSource",args:[h,a[h]]})}function Ii(h,a,u){vr(a,{command:"removeSource",args:[h]}),u[h]=!0}function ji(h,a,u,p){Ii(h,u,p),Xr(h,a,u)}function fi(h,a,u){let p;for(p in h[u])if(Object.prototype.hasOwnProperty.call(h[u],p)&&p!=="data"&&!Wt(h[u][p],a[u][p]))return!1;for(p in a[u])if(Object.prototype.hasOwnProperty.call(a[u],p)&&p!=="data"&&!Wt(h[u][p],a[u][p]))return!1;return!0}function Tr(h,a,u,p,y,E){h=h||{},a=a||{};for(const T in h)Object.prototype.hasOwnProperty.call(h,T)&&(Wt(h[T],a[T])||u.push({command:E,args:[p,T,a[T],y]}));for(const T in a)Object.prototype.hasOwnProperty.call(a,T)&&!Object.prototype.hasOwnProperty.call(h,T)&&(Wt(h[T],a[T])||u.push({command:E,args:[p,T,a[T],y]}))}function kr(h){return h.id}function Ui(h,a){return h[a.id]=a,h}class yt{constructor(a,u,p,y){this.message=(a?`${a}: `:"")+p,y&&(this.identifier=y),u!=null&&u.__line__&&(this.line=u.__line__)}}function ki(h,...a){for(const u of a)for(const p in u)h[p]=u[p];return h}class li extends Error{constructor(a,u){super(u),this.message=u,this.key=a}}class Hs{constructor(a,u=[]){this.parent=a,this.bindings={};for(const[p,y]of u)this.bindings[p]=y}concat(a){return new Hs(this,a)}get(a){if(this.bindings[a])return this.bindings[a];if(this.parent)return this.parent.get(a);throw new Error(`${a} not found in scope.`)}has(a){return!!this.bindings[a]||!!this.parent&&this.parent.has(a)}}const nl={kind:"null"},St={kind:"number"},Mr={kind:"string"},hr={kind:"boolean"},Ki={kind:"color"},uo={kind:"projectionDefinition"},Wn={kind:"object"},fr={kind:"value"},Io={kind:"collator"},Rs={kind:"formatted"},wa={kind:"padding"},ho={kind:"colorArray"},sl={kind:"numberArray"},wr={kind:"resolvedImage"},On={kind:"variableAnchorOffsetCollection"};function Bi(h,a){return{kind:"array",itemType:h,N:a}}function Fr(h){if(h.kind==="array"){const a=Fr(h.itemType);return typeof h.N=="number"?`array<${a}, ${h.N}>`:h.itemType.kind==="value"?"array":`array<${a}>`}return h.kind}const os=[nl,St,Mr,hr,Ki,uo,Rs,Wn,Bi(fr),wa,sl,ho,wr,On];function ko(h,a){if(a.kind==="error")return null;if(h.kind==="array"){if(a.kind==="array"&&(a.N===0&&a.itemType.kind==="value"||!ko(h.itemType,a.itemType))&&(typeof h.N!="number"||h.N===a.N))return null}else{if(h.kind===a.kind)return null;if(h.kind==="value"){for(const u of os)if(!ko(u,a))return null}}return`Expected ${Fr(h)} but found ${Fr(a)} instead.`}function as(h,a){return a.some((u=>u.kind===h.kind))}function Zi(h,a){return a.some((u=>u==="null"?h===null:u==="array"?Array.isArray(h):u==="object"?h&&!Array.isArray(h)&&typeof h=="object":u===typeof h))}function sn(h,a){return h.kind==="array"&&a.kind==="array"?h.itemType.kind===a.itemType.kind&&typeof h.N=="number":h.kind===a.kind}const Lc=.96422,Dn=.82521,Ms=4/29,Bo=6/29,Oc=3*Bo*Bo,ol=Bo*Bo*Bo,al=Math.PI/180,Ea=180/Math.PI;function Lo(h){return(h%=360)<0&&(h+=360),h}function ls([h,a,u,p]){let y,E;const T=ll((.2225045*(h=Lu(h))+.7168786*(a=Lu(a))+.0606169*(u=Lu(u)))/1);h===a&&a===u?y=E=T:(y=ll((.4360747*h+.3850649*a+.1430804*u)/Lc),E=ll((.0139322*h+.0971045*a+.7141733*u)/Dn));const P=116*T-16;return[P<0?0:P,500*(y-T),200*(T-E),p]}function Lu(h){return h<=.04045?h/12.92:Math.pow((h+.055)/1.055,2.4)}function ll(h){return h>ol?Math.pow(h,1/3):h/Oc+Ms}function Oo([h,a,u,p]){let y=(h+16)/116,E=isNaN(a)?y:y+a/500,T=isNaN(u)?y:y-u/200;return y=1*Aa(y),E=Lc*Aa(E),T=Dn*Aa(T),[cl(3.1338561*E-1.6168667*y-.4906146*T),cl(-.9787684*E+1.9161415*y+.033454*T),cl(.0719453*E-.2289914*y+1.4052427*T),p]}function cl(h){return(h=h<=.00304?12.92*h:1.055*Math.pow(h,1/2.4)-.055)<0?0:h>1?1:h}function Aa(h){return h>Bo?h*h*h:Oc*(h-Ms)}const Zd=Object.hasOwn||function(h,a){return Object.prototype.hasOwnProperty.call(h,a)};function ae(h,a){return Zd(h,a)?h[a]:void 0}function he(h){return parseInt(h.padEnd(2,h),16)/255}function Pe(h,a){return We(a?h/100:h,0,1)}function We(h,a,u){return Math.min(Math.max(a,h),u)}function mt(h){return!h.some(Number.isNaN)}const Zt={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function Er(h,a,u){return h+u*(a-h)}function Wr(h,a,u){return h.map(((p,y)=>Er(p,a[y],u)))}class lr{constructor(a,u,p,y=1,E=!0){this.r=a,this.g=u,this.b=p,this.a=y,E||(this.r*=y,this.g*=y,this.b*=y,y||this.overwriteGetter("rgb",[a,u,p,y]))}static parse(a){if(a instanceof lr)return a;if(typeof a!="string")return;const u=(function(p){if((p=p.toLowerCase().trim())==="transparent")return[0,0,0,0];const y=ae(Zt,p);if(y){const[T,P,k]=y;return[T/255,P/255,k/255,1]}if(p.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(p)){const T=p.length<6?1:2;let P=1;return[he(p.slice(P,P+=T)),he(p.slice(P,P+=T)),he(p.slice(P,P+=T)),he(p.slice(P,P+T)||"ff")]}if(p.startsWith("rgb")){const T=p.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(T){const[P,k,D,z,$,Y,Q,te,oe,de,ve,Fe]=T,Ee=[z||" ",Q||" ",de].join("");if(Ee==="  "||Ee==="  /"||Ee===",,"||Ee===",,,"){const Re=[D,Y,oe].join(""),Je=Re==="%%%"?100:Re===""?255:0;if(Je){const st=[We(+k/Je,0,1),We(+$/Je,0,1),We(+te/Je,0,1),ve?Pe(+ve,Fe):1];if(mt(st))return st}}return}}const E=p.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(E){const[T,P,k,D,z,$,Y,Q,te]=E,oe=[k||" ",z||" ",Y].join("");if(oe==="  "||oe==="  /"||oe===",,"||oe===",,,"){const de=[+P,We(+D,0,100),We(+$,0,100),Q?Pe(+Q,te):1];if(mt(de))return(function([ve,Fe,Ee,Re]){function Je(st){const pt=(st+ve/30)%12,kt=Fe*Math.min(Ee,1-Ee);return Ee-kt*Math.max(-1,Math.min(pt-3,9-pt,1))}return ve=Lo(ve),Fe/=100,Ee/=100,[Je(0),Je(8),Je(4),Re]})(de)}}})(a);return u?new lr(...u,!1):void 0}get rgb(){const{r:a,g:u,b:p,a:y}=this,E=y||1/0;return this.overwriteGetter("rgb",[a/E,u/E,p/E,y])}get hcl(){return this.overwriteGetter("hcl",(function(a){const[u,p,y,E]=ls(a),T=Math.sqrt(p*p+y*y);return[Math.round(1e4*T)?Lo(Math.atan2(y,p)*Ea):NaN,T,u,E]})(this.rgb))}get lab(){return this.overwriteGetter("lab",ls(this.rgb))}overwriteGetter(a,u){return Object.defineProperty(this,a,{value:u}),u}toString(){const[a,u,p,y]=this.rgb;return`rgba(${[a,u,p].map((E=>Math.round(255*E))).join(",")},${y})`}static interpolate(a,u,p,y="rgb"){switch(y){case"rgb":{const[E,T,P,k]=Wr(a.rgb,u.rgb,p);return new lr(E,T,P,k,!1)}case"hcl":{const[E,T,P,k]=a.hcl,[D,z,$,Y]=u.hcl;let Q,te;if(isNaN(E)||isNaN(D))isNaN(E)?isNaN(D)?Q=NaN:(Q=D,P!==1&&P!==0||(te=z)):(Q=E,$!==1&&$!==0||(te=T));else{let Ee=D-E;D>E&&Ee>180?Ee-=360:D<E&&E-D>180&&(Ee+=360),Q=E+p*Ee}const[oe,de,ve,Fe]=(function([Ee,Re,Je,st]){return Ee=isNaN(Ee)?0:Ee*al,Oo([Je,Math.cos(Ee)*Re,Math.sin(Ee)*Re,st])})([Q,te??Er(T,z,p),Er(P,$,p),Er(k,Y,p)]);return new lr(oe,de,ve,Fe,!1)}case"lab":{const[E,T,P,k]=Oo(Wr(a.lab,u.lab,p));return new lr(E,T,P,k,!1)}}}}lr.black=new lr(0,0,0,1),lr.white=new lr(1,1,1,1),lr.transparent=new lr(0,0,0,0),lr.red=new lr(1,0,0,1);class Ti{constructor(a,u,p){this.sensitivity=a?u?"variant":"case":u?"accent":"base",this.locale=p,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(a,u){return this.collator.compare(a,u)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const Vi=["bottom","center","top"];class Do{constructor(a,u,p,y,E,T){this.text=a,this.image=u,this.scale=p,this.fontStack=y,this.textColor=E,this.verticalAlign=T}}class Gi{constructor(a){this.sections=a}static fromString(a){return new Gi([new Do(a,null,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some((a=>a.text.length!==0||a.image&&a.image.name.length!==0))}static factory(a){return a instanceof Gi?a:Gi.fromString(a)}toString(){return this.sections.length===0?"":this.sections.map((a=>a.text)).join("")}}class Hi{constructor(a){this.values=a.slice()}static parse(a){if(a instanceof Hi)return a;if(typeof a=="number")return new Hi([a,a,a,a]);if(Array.isArray(a)&&!(a.length<1||a.length>4)){for(const u of a)if(typeof u!="number")return;switch(a.length){case 1:a=[a[0],a[0],a[0],a[0]];break;case 2:a=[a[0],a[1],a[0],a[1]];break;case 3:a=[a[0],a[1],a[2],a[1]]}return new Hi(a)}}toString(){return JSON.stringify(this.values)}static interpolate(a,u,p){return new Hi(Wr(a.values,u.values,p))}}class fn{constructor(a){this.values=a.slice()}static parse(a){if(a instanceof fn)return a;if(typeof a=="number")return new fn([a]);if(Array.isArray(a)){for(const u of a)if(typeof u!="number")return;return new fn(a)}}toString(){return JSON.stringify(this.values)}static interpolate(a,u,p){return new fn(Wr(a.values,u.values,p))}}class pi{constructor(a){this.values=a.slice()}static parse(a){if(a instanceof pi)return a;if(typeof a=="string"){const p=lr.parse(a);return p?new pi([p]):void 0}if(!Array.isArray(a))return;const u=[];for(const p of a){if(typeof p!="string")return;const y=lr.parse(p);if(!y)return;u.push(y)}return new pi(u)}toString(){return JSON.stringify(this.values)}static interpolate(a,u,p,y="rgb"){const E=[];if(a.values.length!=u.values.length)throw new Error(`colorArray: Arrays have mismatched length (${a.values.length} vs. ${u.values.length}), cannot interpolate.`);for(let T=0;T<a.values.length;T++)E.push(lr.interpolate(a.values[T],u.values[T],p,y));return new pi(E)}}class ci extends Error{constructor(a){super(a),this.name="RuntimeError"}toJSON(){return this.message}}const Xd=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class pn{constructor(a){this.values=a.slice()}static parse(a){if(a instanceof pn)return a;if(Array.isArray(a)&&!(a.length<1)&&a.length%2==0){for(let u=0;u<a.length;u+=2){const p=a[u],y=a[u+1];if(typeof p!="string"||!Xd.has(p)||!Array.isArray(y)||y.length!==2||typeof y[0]!="number"||typeof y[1]!="number")return}return new pn(a)}}toString(){return JSON.stringify(this.values)}static interpolate(a,u,p){const y=a.values,E=u.values;if(y.length!==E.length)throw new ci(`Cannot interpolate values of different length. from: ${a.toString()}, to: ${u.toString()}`);const T=[];for(let P=0;P<y.length;P+=2){if(y[P]!==E[P])throw new ci(`Cannot interpolate values containing mismatched anchors. from[${P}]: ${y[P]}, to[${P}]: ${E[P]}`);T.push(y[P]);const[k,D]=y[P+1],[z,$]=E[P+1];T.push([Er(k,z,p),Er(D,$,p)])}return new pn(T)}}class $s{constructor(a){this.name=a.name,this.available=a.available}toString(){return this.name}static fromString(a){return a?new $s({name:a,available:!1}):null}}class Nn{constructor(a,u,p){this.from=a,this.to=u,this.transition=p}static interpolate(a,u,p){return new Nn(a,u,p)}static parse(a){return a instanceof Nn?a:Array.isArray(a)&&a.length===3&&typeof a[0]=="string"&&typeof a[1]=="string"&&typeof a[2]=="number"?new Nn(a[0],a[1],a[2]):typeof a=="object"&&typeof a.from=="string"&&typeof a.to=="string"&&typeof a.transition=="number"?new Nn(a.from,a.to,a.transition):typeof a=="string"?new Nn(a,a,1):void 0}}function oi(h,a,u,p){return typeof h=="number"&&h>=0&&h<=255&&typeof a=="number"&&a>=0&&a<=255&&typeof u=="number"&&u>=0&&u<=255?p===void 0||typeof p=="number"&&p>=0&&p<=1?null:`Invalid rgba value [${[h,a,u,p].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof p=="number"?[h,a,u,p]:[h,a,u]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function ul(h){if(h===null||typeof h=="string"||typeof h=="boolean"||typeof h=="number"||h instanceof Nn||h instanceof lr||h instanceof Ti||h instanceof Gi||h instanceof Hi||h instanceof fn||h instanceof pi||h instanceof pn||h instanceof $s)return!0;if(Array.isArray(h)){for(const a of h)if(!ul(a))return!1;return!0}if(typeof h=="object"){for(const a in h)if(!ul(h[a]))return!1;return!0}return!1}function cr(h){if(h===null)return nl;if(typeof h=="string")return Mr;if(typeof h=="boolean")return hr;if(typeof h=="number")return St;if(h instanceof lr)return Ki;if(h instanceof Nn)return uo;if(h instanceof Ti)return Io;if(h instanceof Gi)return Rs;if(h instanceof Hi)return wa;if(h instanceof fn)return sl;if(h instanceof pi)return ho;if(h instanceof pn)return On;if(h instanceof $s)return wr;if(Array.isArray(h)){const a=h.length;let u;for(const p of h){const y=cr(p);if(u){if(u===y)continue;u=fr;break}u=y}return Bi(u||fr,a)}return Wn}function mr(h){const a=typeof h;return h===null?"":a==="string"||a==="number"||a==="boolean"?String(h):h instanceof lr||h instanceof Nn||h instanceof Gi||h instanceof Hi||h instanceof fn||h instanceof pi||h instanceof pn||h instanceof $s?h.toString():JSON.stringify(h)}class Ws{constructor(a,u){this.type=a,this.value=u}static parse(a,u){if(a.length!==2)return u.error(`'literal' expression requires exactly one argument, but found ${a.length-1} instead.`);if(!ul(a[1]))return u.error("invalid value");const p=a[1];let y=cr(p);const E=u.expectedType;return y.kind!=="array"||y.N!==0||!E||E.kind!=="array"||typeof E.N=="number"&&E.N!==0||(y=E),new Ws(y,p)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const Br={string:Mr,number:St,boolean:hr,object:Wn};class qn{constructor(a,u){this.type=a,this.args=u}static parse(a,u){if(a.length<2)return u.error("Expected at least one argument.");let p,y=1;const E=a[0];if(E==="array"){let P,k;if(a.length>2){const D=a[1];if(typeof D!="string"||!(D in Br)||D==="object")return u.error('The item type argument of "array" must be one of string, number, boolean',1);P=Br[D],y++}else P=fr;if(a.length>3){if(a[2]!==null&&(typeof a[2]!="number"||a[2]<0||a[2]!==Math.floor(a[2])))return u.error('The length argument to "array" must be a positive integer literal',2);k=a[2],y++}p=Bi(P,k)}else{if(!Br[E])throw new Error(`Types doesn't contain name = ${E}`);p=Br[E]}const T=[];for(;y<a.length;y++){const P=u.parse(a[y],y,fr);if(!P)return null;T.push(P)}return new qn(p,T)}evaluate(a){for(let u=0;u<this.args.length;u++){const p=this.args[u].evaluate(a);if(!ko(this.type,cr(p)))return p;if(u===this.args.length-1)throw new ci(`Expected value to be of type ${Fr(this.type)}, but found ${Fr(cr(p))} instead.`)}throw new Error}eachChild(a){this.args.forEach(a)}outputDefined(){return this.args.every((a=>a.outputDefined()))}}const ta={"to-boolean":hr,"to-color":Ki,"to-number":St,"to-string":Mr};class ra{constructor(a,u){this.type=a,this.args=u}static parse(a,u){if(a.length<2)return u.error("Expected at least one argument.");const p=a[0];if(!ta[p])throw new Error(`Can't parse ${p} as it is not part of the known types`);if((p==="to-boolean"||p==="to-string")&&a.length!==2)return u.error("Expected one argument.");const y=ta[p],E=[];for(let T=1;T<a.length;T++){const P=u.parse(a[T],T,fr);if(!P)return null;E.push(P)}return new ra(y,E)}evaluate(a){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(a);case"color":{let u,p;for(const y of this.args){if(u=y.evaluate(a),p=null,u instanceof lr)return u;if(typeof u=="string"){const E=a.parseColor(u);if(E)return E}else if(Array.isArray(u)&&(p=u.length<3||u.length>4?`Invalid rgba value ${JSON.stringify(u)}: expected an array containing either three or four numeric values.`:oi(u[0],u[1],u[2],u[3]),!p))return new lr(u[0]/255,u[1]/255,u[2]/255,u[3])}throw new ci(p||`Could not parse color from value '${typeof u=="string"?u:JSON.stringify(u)}'`)}case"padding":{let u;for(const p of this.args){u=p.evaluate(a);const y=Hi.parse(u);if(y)return y}throw new ci(`Could not parse padding from value '${typeof u=="string"?u:JSON.stringify(u)}'`)}case"numberArray":{let u;for(const p of this.args){u=p.evaluate(a);const y=fn.parse(u);if(y)return y}throw new ci(`Could not parse numberArray from value '${typeof u=="string"?u:JSON.stringify(u)}'`)}case"colorArray":{let u;for(const p of this.args){u=p.evaluate(a);const y=pi.parse(u);if(y)return y}throw new ci(`Could not parse colorArray from value '${typeof u=="string"?u:JSON.stringify(u)}'`)}case"variableAnchorOffsetCollection":{let u;for(const p of this.args){u=p.evaluate(a);const y=pn.parse(u);if(y)return y}throw new ci(`Could not parse variableAnchorOffsetCollection from value '${typeof u=="string"?u:JSON.stringify(u)}'`)}case"number":{let u=null;for(const p of this.args){if(u=p.evaluate(a),u===null)return 0;const y=Number(u);if(!isNaN(y))return y}throw new ci(`Could not convert ${JSON.stringify(u)} to number.`)}case"formatted":return Gi.fromString(mr(this.args[0].evaluate(a)));case"resolvedImage":return $s.fromString(mr(this.args[0].evaluate(a)));case"projectionDefinition":return this.args[0].evaluate(a);default:return mr(this.args[0].evaluate(a))}}eachChild(a){this.args.forEach(a)}outputDefined(){return this.args.every((a=>a.outputDefined()))}}const Dc=["Unknown","Point","LineString","Polygon"];class Nc{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Dc[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(a){let u=this._parseColorCache.get(a);return u||(u=lr.parse(a),this._parseColorCache.set(a,u)),u}}class hl{constructor(a,u,p=[],y,E=new Hs,T=[]){this.registry=a,this.path=p,this.key=p.map((P=>`[${P}]`)).join(""),this.scope=E,this.errors=T,this.expectedType=y,this._isConstant=u}parse(a,u,p,y,E={}){return u?this.concat(u,p,y)._parse(a,E):this._parse(a,E)}_parse(a,u){function p(y,E,T){return T==="assert"?new qn(E,[y]):T==="coerce"?new ra(E,[y]):y}if(a!==null&&typeof a!="string"&&typeof a!="boolean"&&typeof a!="number"||(a=["literal",a]),Array.isArray(a)){if(a.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const y=a[0];if(typeof y!="string")return this.error(`Expression name must be a string, but found ${typeof y} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const E=this.registry[y];if(E){let T=E.parse(a,this);if(!T)return null;if(this.expectedType){const P=this.expectedType,k=T.type;if(P.kind!=="string"&&P.kind!=="number"&&P.kind!=="boolean"&&P.kind!=="object"&&P.kind!=="array"||k.kind!=="value"){if(P.kind==="projectionDefinition"&&["string","array"].includes(k.kind)||["color","formatted","resolvedImage"].includes(P.kind)&&["value","string"].includes(k.kind)||["padding","numberArray"].includes(P.kind)&&["value","number","array"].includes(k.kind)||P.kind==="colorArray"&&["value","string","array"].includes(k.kind)||P.kind==="variableAnchorOffsetCollection"&&["value","array"].includes(k.kind))T=p(T,P,u.typeAnnotation||"coerce");else if(this.checkSubtype(P,k))return null}else T=p(T,P,u.typeAnnotation||"assert")}if(!(T instanceof Ws)&&T.type.kind!=="resolvedImage"&&this._isConstant(T)){const P=new Nc;try{T=new Ws(T.type,T.evaluate(P))}catch(k){return this.error(k.message),null}}return T}return this.error(`Unknown expression "${y}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(a===void 0?"'undefined' value invalid. Use null instead.":typeof a=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof a} instead.`)}concat(a,u,p){const y=typeof a=="number"?this.path.concat(a):this.path,E=p?this.scope.concat(p):this.scope;return new hl(this.registry,this._isConstant,y,u||null,E,this.errors)}error(a,...u){const p=`${this.key}${u.map((y=>`[${y}]`)).join("")}`;this.errors.push(new li(p,a))}checkSubtype(a,u){const p=ko(a,u);return p&&this.error(p),p}}class Fc{constructor(a,u){this.type=u.type,this.bindings=[].concat(a),this.result=u}evaluate(a){return this.result.evaluate(a)}eachChild(a){for(const u of this.bindings)a(u[1]);a(this.result)}static parse(a,u){if(a.length<4)return u.error(`Expected at least 3 arguments, but found ${a.length-1} instead.`);const p=[];for(let E=1;E<a.length-1;E+=2){const T=a[E];if(typeof T!="string")return u.error(`Expected string, but found ${typeof T} instead.`,E);if(/[^a-zA-Z0-9_]/.test(T))return u.error("Variable names must contain only alphanumeric characters or '_'.",E);const P=u.parse(a[E+1],E+1);if(!P)return null;p.push([T,P])}const y=u.parse(a[a.length-1],a.length-1,u.expectedType,p);return y?new Fc(p,y):null}outputDefined(){return this.result.outputDefined()}}class No{constructor(a,u){this.type=u.type,this.name=a,this.boundExpression=u}static parse(a,u){if(a.length!==2||typeof a[1]!="string")return u.error("'var' expression requires exactly one string literal argument.");const p=a[1];return u.scope.has(p)?new No(p,u.scope.get(p)):u.error(`Unknown variable "${p}". Make sure "${p}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(a){return this.boundExpression.evaluate(a)}eachChild(){}outputDefined(){return!1}}class zc{constructor(a,u,p){this.type=a,this.index=u,this.input=p}static parse(a,u){if(a.length!==3)return u.error(`Expected 2 arguments, but found ${a.length-1} instead.`);const p=u.parse(a[1],1,St),y=u.parse(a[2],2,Bi(u.expectedType||fr));return p&&y?new zc(y.type.itemType,p,y):null}evaluate(a){const u=this.index.evaluate(a),p=this.input.evaluate(a);if(u<0)throw new ci(`Array index out of bounds: ${u} < 0.`);if(u>=p.length)throw new ci(`Array index out of bounds: ${u} > ${p.length-1}.`);if(u!==Math.floor(u))throw new ci(`Array index must be an integer, but found ${u} instead.`);return p[u]}eachChild(a){a(this.index),a(this.input)}outputDefined(){return!1}}class Hl{constructor(a,u){this.type=hr,this.needle=a,this.haystack=u}static parse(a,u){if(a.length!==3)return u.error(`Expected 2 arguments, but found ${a.length-1} instead.`);const p=u.parse(a[1],1,fr),y=u.parse(a[2],2,fr);return p&&y?as(p.type,[hr,Mr,St,nl,fr])?new Hl(p,y):u.error(`Expected first argument to be of type boolean, string, number or null, but found ${Fr(p.type)} instead`):null}evaluate(a){const u=this.needle.evaluate(a),p=this.haystack.evaluate(a);if(!p)return!1;if(!Zi(u,["boolean","string","number","null"]))throw new ci(`Expected first argument to be of type boolean, string, number or null, but found ${Fr(cr(u))} instead.`);if(!Zi(p,["string","array"]))throw new ci(`Expected second argument to be of type array or string, but found ${Fr(cr(p))} instead.`);return p.indexOf(u)>=0}eachChild(a){a(this.needle),a(this.haystack)}outputDefined(){return!0}}class fo{constructor(a,u,p){this.type=St,this.needle=a,this.haystack=u,this.fromIndex=p}static parse(a,u){if(a.length<=2||a.length>=5)return u.error(`Expected 3 or 4 arguments, but found ${a.length-1} instead.`);const p=u.parse(a[1],1,fr),y=u.parse(a[2],2,fr);if(!p||!y)return null;if(!as(p.type,[hr,Mr,St,nl,fr]))return u.error(`Expected first argument to be of type boolean, string, number or null, but found ${Fr(p.type)} instead`);if(a.length===4){const E=u.parse(a[3],3,St);return E?new fo(p,y,E):null}return new fo(p,y)}evaluate(a){const u=this.needle.evaluate(a),p=this.haystack.evaluate(a);if(!Zi(u,["boolean","string","number","null"]))throw new ci(`Expected first argument to be of type boolean, string, number or null, but found ${Fr(cr(u))} instead.`);let y;if(this.fromIndex&&(y=this.fromIndex.evaluate(a)),Zi(p,["string"])){const E=p.indexOf(u,y);return E===-1?-1:[...p.slice(0,E)].length}if(Zi(p,["array"]))return p.indexOf(u,y);throw new ci(`Expected second argument to be of type array or string, but found ${Fr(cr(p))} instead.`)}eachChild(a){a(this.needle),a(this.haystack),this.fromIndex&&a(this.fromIndex)}outputDefined(){return!1}}class Xi{constructor(a,u,p,y,E,T){this.inputType=a,this.type=u,this.input=p,this.cases=y,this.outputs=E,this.otherwise=T}static parse(a,u){if(a.length<5)return u.error(`Expected at least 4 arguments, but found only ${a.length-1}.`);if(a.length%2!=1)return u.error("Expected an even number of arguments.");let p,y;u.expectedType&&u.expectedType.kind!=="value"&&(y=u.expectedType);const E={},T=[];for(let D=2;D<a.length-1;D+=2){let z=a[D];const $=a[D+1];Array.isArray(z)||(z=[z]);const Y=u.concat(D);if(z.length===0)return Y.error("Expected at least one branch label.");for(const te of z){if(typeof te!="number"&&typeof te!="string")return Y.error("Branch labels must be numbers or strings.");if(typeof te=="number"&&Math.abs(te)>Number.MAX_SAFE_INTEGER)return Y.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof te=="number"&&Math.floor(te)!==te)return Y.error("Numeric branch labels must be integer values.");if(p){if(Y.checkSubtype(p,cr(te)))return null}else p=cr(te);if(E[String(te)]!==void 0)return Y.error("Branch labels must be unique.");E[String(te)]=T.length}const Q=u.parse($,D,y);if(!Q)return null;y=y||Q.type,T.push(Q)}const P=u.parse(a[1],1,fr);if(!P)return null;const k=u.parse(a[a.length-1],a.length-1,y);return k?P.type.kind!=="value"&&u.concat(1).checkSubtype(p,P.type)?null:new Xi(p,y,P,E,T,k):null}evaluate(a){const u=this.input.evaluate(a);return(cr(u)===this.inputType&&this.outputs[this.cases[u]]||this.otherwise).evaluate(a)}eachChild(a){a(this.input),this.outputs.forEach(a),a(this.otherwise)}outputDefined(){return this.outputs.every((a=>a.outputDefined()))&&this.otherwise.outputDefined()}}class Ta{constructor(a,u,p){this.type=a,this.branches=u,this.otherwise=p}static parse(a,u){if(a.length<4)return u.error(`Expected at least 3 arguments, but found only ${a.length-1}.`);if(a.length%2!=0)return u.error("Expected an odd number of arguments.");let p;u.expectedType&&u.expectedType.kind!=="value"&&(p=u.expectedType);const y=[];for(let T=1;T<a.length-1;T+=2){const P=u.parse(a[T],T,hr);if(!P)return null;const k=u.parse(a[T+1],T+1,p);if(!k)return null;y.push([P,k]),p=p||k.type}const E=u.parse(a[a.length-1],a.length-1,p);if(!E)return null;if(!p)throw new Error("Can't infer output type");return new Ta(p,y,E)}evaluate(a){for(const[u,p]of this.branches)if(u.evaluate(a))return p.evaluate(a);return this.otherwise.evaluate(a)}eachChild(a){for(const[u,p]of this.branches)a(u),a(p);a(this.otherwise)}outputDefined(){return this.branches.every((([a,u])=>u.outputDefined()))&&this.otherwise.outputDefined()}}class jc{constructor(a,u,p,y){this.type=a,this.input=u,this.beginIndex=p,this.endIndex=y}static parse(a,u){if(a.length<=2||a.length>=5)return u.error(`Expected 3 or 4 arguments, but found ${a.length-1} instead.`);const p=u.parse(a[1],1,fr),y=u.parse(a[2],2,St);if(!p||!y)return null;if(!as(p.type,[Bi(fr),Mr,fr]))return u.error(`Expected first argument to be of type array or string, but found ${Fr(p.type)} instead`);if(a.length===4){const E=u.parse(a[3],3,St);return E?new jc(p.type,p,y,E):null}return new jc(p.type,p,y)}evaluate(a){const u=this.input.evaluate(a),p=this.beginIndex.evaluate(a);let y;if(this.endIndex&&(y=this.endIndex.evaluate(a)),Zi(u,["string"]))return[...u].slice(p,y).join("");if(Zi(u,["array"]))return u.slice(p,y);throw new ci(`Expected first argument to be of type array or string, but found ${Fr(cr(u))} instead.`)}eachChild(a){a(this.input),a(this.beginIndex),this.endIndex&&a(this.endIndex)}outputDefined(){return!1}}function mn(h,a){const u=h.length-1;let p,y,E=0,T=u,P=0;for(;E<=T;)if(P=Math.floor((E+T)/2),p=h[P],y=h[P+1],p<=a){if(P===u||a<y)return P;E=P+1}else{if(!(p>a))throw new ci("Input is not a number.");T=P-1}return 0}class mi{constructor(a,u,p){this.type=a,this.input=u,this.labels=[],this.outputs=[];for(const[y,E]of p)this.labels.push(y),this.outputs.push(E)}static parse(a,u){if(a.length-1<4)return u.error(`Expected at least 4 arguments, but found only ${a.length-1}.`);if((a.length-1)%2!=0)return u.error("Expected an even number of arguments.");const p=u.parse(a[1],1,St);if(!p)return null;const y=[];let E=null;u.expectedType&&u.expectedType.kind!=="value"&&(E=u.expectedType);for(let T=1;T<a.length;T+=2){const P=T===1?-1/0:a[T],k=a[T+1],D=T,z=T+1;if(typeof P!="number")return u.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',D);if(y.length&&y[y.length-1][0]>=P)return u.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',D);const $=u.parse(k,z,E);if(!$)return null;E=E||$.type,y.push([P,$])}return new mi(E,p,y)}evaluate(a){const u=this.labels,p=this.outputs;if(u.length===1)return p[0].evaluate(a);const y=this.input.evaluate(a);if(y<=u[0])return p[0].evaluate(a);const E=u.length;return y>=u[E-1]?p[E-1].evaluate(a):p[mn(u,y)].evaluate(a)}eachChild(a){a(this.input);for(const u of this.outputs)a(u)}outputDefined(){return this.outputs.every((a=>a.outputDefined()))}}function Oh(h){return h&&h.__esModule&&Object.prototype.hasOwnProperty.call(h,"default")?h.default:h}var Sa,Yd,Jd=(function(){if(Yd)return Sa;function h(a,u,p,y){this.cx=3*a,this.bx=3*(p-a)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*u,this.by=3*(y-u)-this.cy,this.ay=1-this.cy-this.by,this.p1x=a,this.p1y=u,this.p2x=p,this.p2y=y}return Yd=1,Sa=h,h.prototype={sampleCurveX:function(a){return((this.ax*a+this.bx)*a+this.cx)*a},sampleCurveY:function(a){return((this.ay*a+this.by)*a+this.cy)*a},sampleCurveDerivativeX:function(a){return(3*this.ax*a+2*this.bx)*a+this.cx},solveCurveX:function(a,u){if(u===void 0&&(u=1e-6),a<0)return 0;if(a>1)return 1;for(var p=a,y=0;y<8;y++){var E=this.sampleCurveX(p)-a;if(Math.abs(E)<u)return p;var T=this.sampleCurveDerivativeX(p);if(Math.abs(T)<1e-6)break;p-=E/T}var P=0,k=1;for(p=a,y=0;y<20&&(E=this.sampleCurveX(p),!(Math.abs(E-a)<u));y++)a>E?P=p:k=p,p=.5*(k-P)+P;return p},solve:function(a,u){return this.sampleCurveY(this.solveCurveX(a,u))}},Sa})(),dl=Oh(Jd);class Yi{constructor(a,u,p,y,E){this.type=a,this.operator=u,this.interpolation=p,this.input=y,this.labels=[],this.outputs=[];for(const[T,P]of E)this.labels.push(T),this.outputs.push(P)}static interpolationFactor(a,u,p,y){let E=0;if(a.name==="exponential")E=fl(u,a.base,p,y);else if(a.name==="linear")E=fl(u,1,p,y);else if(a.name==="cubic-bezier"){const T=a.controlPoints;E=new dl(T[0],T[1],T[2],T[3]).solve(fl(u,1,p,y))}return E}static parse(a,u){let[p,y,E,...T]=a;if(!Array.isArray(y)||y.length===0)return u.error("Expected an interpolation type expression.",1);if(y[0]==="linear")y={name:"linear"};else if(y[0]==="exponential"){const D=y[1];if(typeof D!="number")return u.error("Exponential interpolation requires a numeric base.",1,1);y={name:"exponential",base:D}}else{if(y[0]!=="cubic-bezier")return u.error(`Unknown interpolation type ${String(y[0])}`,1,0);{const D=y.slice(1);if(D.length!==4||D.some((z=>typeof z!="number"||z<0||z>1)))return u.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);y={name:"cubic-bezier",controlPoints:D}}}if(a.length-1<4)return u.error(`Expected at least 4 arguments, but found only ${a.length-1}.`);if((a.length-1)%2!=0)return u.error("Expected an even number of arguments.");if(E=u.parse(E,2,St),!E)return null;const P=[];let k=null;p!=="interpolate-hcl"&&p!=="interpolate-lab"||u.expectedType==ho?u.expectedType&&u.expectedType.kind!=="value"&&(k=u.expectedType):k=Ki;for(let D=0;D<T.length;D+=2){const z=T[D],$=T[D+1],Y=D+3,Q=D+4;if(typeof z!="number")return u.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',Y);if(P.length&&P[P.length-1][0]>=z)return u.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',Y);const te=u.parse($,Q,k);if(!te)return null;k=k||te.type,P.push([z,te])}return sn(k,St)||sn(k,uo)||sn(k,Ki)||sn(k,wa)||sn(k,sl)||sn(k,ho)||sn(k,On)||sn(k,Bi(St))?new Yi(k,p,y,E,P):u.error(`Type ${Fr(k)} is not interpolatable.`)}evaluate(a){const u=this.labels,p=this.outputs;if(u.length===1)return p[0].evaluate(a);const y=this.input.evaluate(a);if(y<=u[0])return p[0].evaluate(a);const E=u.length;if(y>=u[E-1])return p[E-1].evaluate(a);const T=mn(u,y),P=Yi.interpolationFactor(this.interpolation,y,u[T],u[T+1]),k=p[T].evaluate(a),D=p[T+1].evaluate(a);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return Er(k,D,P);case"color":return lr.interpolate(k,D,P);case"padding":return Hi.interpolate(k,D,P);case"colorArray":return pi.interpolate(k,D,P);case"numberArray":return fn.interpolate(k,D,P);case"variableAnchorOffsetCollection":return pn.interpolate(k,D,P);case"array":return Wr(k,D,P);case"projectionDefinition":return Nn.interpolate(k,D,P)}case"interpolate-hcl":switch(this.type.kind){case"color":return lr.interpolate(k,D,P,"hcl");case"colorArray":return pi.interpolate(k,D,P,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return lr.interpolate(k,D,P,"lab");case"colorArray":return pi.interpolate(k,D,P,"lab")}}}eachChild(a){a(this.input);for(const u of this.outputs)a(u)}outputDefined(){return this.outputs.every((a=>a.outputDefined()))}}function fl(h,a,u,p){const y=p-u,E=h-u;return y===0?0:a===1?E/y:(Math.pow(a,E)-1)/(Math.pow(a,y)-1)}const Fo={color:lr.interpolate,number:Er,padding:Hi.interpolate,numberArray:fn.interpolate,colorArray:pi.interpolate,variableAnchorOffsetCollection:pn.interpolate,array:Wr};class Ou{constructor(a,u){this.type=a,this.args=u}static parse(a,u){if(a.length<2)return u.error("Expected at least one argument.");let p=null;const y=u.expectedType;y&&y.kind!=="value"&&(p=y);const E=[];for(const P of a.slice(1)){const k=u.parse(P,1+E.length,p,void 0,{typeAnnotation:"omit"});if(!k)return null;p=p||k.type,E.push(k)}if(!p)throw new Error("No output type");const T=y&&E.some((P=>ko(y,P.type)));return new Ou(T?fr:p,E)}evaluate(a){let u,p=null,y=0;for(const E of this.args)if(y++,p=E.evaluate(a),p&&p instanceof $s&&!p.available&&(u||(u=p.name),p=null,y===this.args.length&&(p=u)),p!==null)break;return p}eachChild(a){this.args.forEach(a)}outputDefined(){return this.args.every((a=>a.outputDefined()))}}function Du(h,a){return h==="=="||h==="!="?a.kind==="boolean"||a.kind==="string"||a.kind==="number"||a.kind==="null"||a.kind==="value":a.kind==="string"||a.kind==="number"||a.kind==="value"}function Nu(h,a,u,p){return p.compare(a,u)===0}function Sn(h,a,u){const p=h!=="=="&&h!=="!=";return class XB{constructor(E,T,P){this.type=hr,this.lhs=E,this.rhs=T,this.collator=P,this.hasUntypedArgument=E.type.kind==="value"||T.type.kind==="value"}static parse(E,T){if(E.length!==3&&E.length!==4)return T.error("Expected two or three arguments.");const P=E[0];let k=T.parse(E[1],1,fr);if(!k)return null;if(!Du(P,k.type))return T.concat(1).error(`"${P}" comparisons are not supported for type '${Fr(k.type)}'.`);let D=T.parse(E[2],2,fr);if(!D)return null;if(!Du(P,D.type))return T.concat(2).error(`"${P}" comparisons are not supported for type '${Fr(D.type)}'.`);if(k.type.kind!==D.type.kind&&k.type.kind!=="value"&&D.type.kind!=="value")return T.error(`Cannot compare types '${Fr(k.type)}' and '${Fr(D.type)}'.`);p&&(k.type.kind==="value"&&D.type.kind!=="value"?k=new qn(D.type,[k]):k.type.kind!=="value"&&D.type.kind==="value"&&(D=new qn(k.type,[D])));let z=null;if(E.length===4){if(k.type.kind!=="string"&&D.type.kind!=="string"&&k.type.kind!=="value"&&D.type.kind!=="value")return T.error("Cannot use collator to compare non-string types.");if(z=T.parse(E[3],3,Io),!z)return null}return new XB(k,D,z)}evaluate(E){const T=this.lhs.evaluate(E),P=this.rhs.evaluate(E);if(p&&this.hasUntypedArgument){const k=cr(T),D=cr(P);if(k.kind!==D.kind||k.kind!=="string"&&k.kind!=="number")throw new ci(`Expected arguments for "${h}" to be (string, string) or (number, number), but found (${k.kind}, ${D.kind}) instead.`)}if(this.collator&&!p&&this.hasUntypedArgument){const k=cr(T),D=cr(P);if(k.kind!=="string"||D.kind!=="string")return a(E,T,P)}return this.collator?u(E,T,P,this.collator.evaluate(E)):a(E,T,P)}eachChild(E){E(this.lhs),E(this.rhs),this.collator&&E(this.collator)}outputDefined(){return!0}}}const Np=Sn("==",(function(h,a,u){return a===u}),Nu),Dh=Sn("!=",(function(h,a,u){return a!==u}),(function(h,a,u,p){return!Nu(0,a,u,p)})),Og=Sn("<",(function(h,a,u){return a<u}),(function(h,a,u,p){return p.compare(a,u)<0})),Qd=Sn(">",(function(h,a,u){return a>u}),(function(h,a,u,p){return p.compare(a,u)>0})),Dg=Sn("<=",(function(h,a,u){return a<=u}),(function(h,a,u,p){return p.compare(a,u)<=0})),Fp=Sn(">=",(function(h,a,u){return a>=u}),(function(h,a,u,p){return p.compare(a,u)>=0}));class Nh{constructor(a,u,p){this.type=Io,this.locale=p,this.caseSensitive=a,this.diacriticSensitive=u}static parse(a,u){if(a.length!==2)return u.error("Expected one argument.");const p=a[1];if(typeof p!="object"||Array.isArray(p))return u.error("Collator options argument must be an object.");const y=u.parse(p["case-sensitive"]!==void 0&&p["case-sensitive"],1,hr);if(!y)return null;const E=u.parse(p["diacritic-sensitive"]!==void 0&&p["diacritic-sensitive"],1,hr);if(!E)return null;let T=null;return p.locale&&(T=u.parse(p.locale,1,Mr),!T)?null:new Nh(y,E,T)}evaluate(a){return new Ti(this.caseSensitive.evaluate(a),this.diacriticSensitive.evaluate(a),this.locale?this.locale.evaluate(a):null)}eachChild(a){a(this.caseSensitive),a(this.diacriticSensitive),this.locale&&a(this.locale)}outputDefined(){return!1}}class ef{constructor(a,u,p,y,E){this.type=Mr,this.number=a,this.locale=u,this.currency=p,this.minFractionDigits=y,this.maxFractionDigits=E}static parse(a,u){if(a.length!==3)return u.error("Expected two arguments.");const p=u.parse(a[1],1,St);if(!p)return null;const y=a[2];if(typeof y!="object"||Array.isArray(y))return u.error("NumberFormat options argument must be an object.");let E=null;if(y.locale&&(E=u.parse(y.locale,1,Mr),!E))return null;let T=null;if(y.currency&&(T=u.parse(y.currency,1,Mr),!T))return null;let P=null;if(y["min-fraction-digits"]&&(P=u.parse(y["min-fraction-digits"],1,St),!P))return null;let k=null;return y["max-fraction-digits"]&&(k=u.parse(y["max-fraction-digits"],1,St),!k)?null:new ef(p,E,T,P,k)}evaluate(a){return new Intl.NumberFormat(this.locale?this.locale.evaluate(a):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(a):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(a):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(a):void 0}).format(this.number.evaluate(a))}eachChild(a){a(this.number),this.locale&&a(this.locale),this.currency&&a(this.currency),this.minFractionDigits&&a(this.minFractionDigits),this.maxFractionDigits&&a(this.maxFractionDigits)}outputDefined(){return!1}}class $l{constructor(a){this.type=Rs,this.sections=a}static parse(a,u){if(a.length<2)return u.error("Expected at least one argument.");const p=a[1];if(!Array.isArray(p)&&typeof p=="object")return u.error("First argument must be an image or text section.");const y=[];let E=!1;for(let T=1;T<=a.length-1;++T){const P=a[T];if(E&&typeof P=="object"&&!Array.isArray(P)){E=!1;let k=null;if(P["font-scale"]&&(k=u.parse(P["font-scale"],1,St),!k))return null;let D=null;if(P["text-font"]&&(D=u.parse(P["text-font"],1,Bi(Mr)),!D))return null;let z=null;if(P["text-color"]&&(z=u.parse(P["text-color"],1,Ki),!z))return null;let $=null;if(P["vertical-align"]){if(typeof P["vertical-align"]=="string"&&!Vi.includes(P["vertical-align"]))return u.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${P["vertical-align"]}' instead.`);if($=u.parse(P["vertical-align"],1,Mr),!$)return null}const Y=y[y.length-1];Y.scale=k,Y.font=D,Y.textColor=z,Y.verticalAlign=$}else{const k=u.parse(a[T],1,fr);if(!k)return null;const D=k.type.kind;if(D!=="string"&&D!=="value"&&D!=="null"&&D!=="resolvedImage")return u.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");E=!0,y.push({content:k,scale:null,font:null,textColor:null,verticalAlign:null})}}return new $l(y)}evaluate(a){return new Gi(this.sections.map((u=>{const p=u.content.evaluate(a);return cr(p)===wr?new Do("",p,null,null,null,u.verticalAlign?u.verticalAlign.evaluate(a):null):new Do(mr(p),null,u.scale?u.scale.evaluate(a):null,u.font?u.font.evaluate(a).join(","):null,u.textColor?u.textColor.evaluate(a):null,u.verticalAlign?u.verticalAlign.evaluate(a):null)})))}eachChild(a){for(const u of this.sections)a(u.content),u.scale&&a(u.scale),u.font&&a(u.font),u.textColor&&a(u.textColor),u.verticalAlign&&a(u.verticalAlign)}outputDefined(){return!1}}class tf{constructor(a){this.type=wr,this.input=a}static parse(a,u){if(a.length!==2)return u.error("Expected two arguments.");const p=u.parse(a[1],1,Mr);return p?new tf(p):u.error("No image name provided.")}evaluate(a){const u=this.input.evaluate(a),p=$s.fromString(u);return p&&a.availableImages&&(p.available=a.availableImages.indexOf(u)>-1),p}eachChild(a){a(this.input)}outputDefined(){return!1}}class Uc{constructor(a){this.type=St,this.input=a}static parse(a,u){if(a.length!==2)return u.error(`Expected 1 argument, but found ${a.length-1} instead.`);const p=u.parse(a[1],1);return p?p.type.kind!=="array"&&p.type.kind!=="string"&&p.type.kind!=="value"?u.error(`Expected argument of type string or array, but found ${Fr(p.type)} instead.`):new Uc(p):null}evaluate(a){const u=this.input.evaluate(a);if(typeof u=="string")return[...u].length;if(Array.isArray(u))return u.length;throw new ci(`Expected value to be of type string or array, but found ${Fr(cr(u))} instead.`)}eachChild(a){a(this.input)}outputDefined(){return!1}}const zo=8192;function Ng(h,a){const u=(180+h[0])/360,p=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+h[1]*Math.PI/360)))/360,y=Math.pow(2,a.z);return[Math.round(u*y*zo),Math.round(p*y*zo)]}function Fh(h,a){const u=Math.pow(2,a.z);return[(y=(h[0]/zo+a.x)/u,360*y-180),(p=(h[1]/zo+a.y)/u,360/Math.PI*Math.atan(Math.exp((180-360*p)*Math.PI/180))-90)];var p,y}function Vc(h,a){h[0]=Math.min(h[0],a[0]),h[1]=Math.min(h[1],a[1]),h[2]=Math.max(h[2],a[0]),h[3]=Math.max(h[3],a[1])}function Fu(h,a){return!(h[0]<=a[0]||h[2]>=a[2]||h[1]<=a[1]||h[3]>=a[3])}function Fg(h,a,u){const p=h[0]-a[0],y=h[1]-a[1],E=h[0]-u[0],T=h[1]-u[1];return p*T-E*y==0&&p*E<=0&&y*T<=0}function zh(h,a,u,p){return(y=[p[0]-u[0],p[1]-u[1]])[0]*(E=[a[0]-h[0],a[1]-h[1]])[1]-y[1]*E[0]!=0&&!(!Gc(h,a,u,p)||!Gc(u,p,h,a));var y,E}function zg(h,a,u){for(const p of u)for(let y=0;y<p.length-1;++y)if(zh(h,a,p[y],p[y+1]))return!0;return!1}function Wl(h,a,u=!1){let p=!1;for(const P of a)for(let k=0;k<P.length-1;k++){if(Fg(h,P[k],P[k+1]))return u;(E=P[k])[1]>(y=h)[1]!=(T=P[k+1])[1]>y[1]&&y[0]<(T[0]-E[0])*(y[1]-E[1])/(T[1]-E[1])+E[0]&&(p=!p)}var y,E,T;return p}function zp(h,a){for(const u of a)if(Wl(h,u))return!0;return!1}function rf(h,a){for(const u of h)if(!Wl(u,a))return!1;for(let u=0;u<h.length-1;++u)if(zg(h[u],h[u+1],a))return!1;return!0}function nf(h,a){for(const u of a)if(rf(h,u))return!0;return!1}function Gc(h,a,u,p){const y=p[0]-u[0],E=p[1]-u[1],T=(h[0]-u[0])*E-y*(h[1]-u[1]),P=(a[0]-u[0])*E-y*(a[1]-u[1]);return T>0&&P<0||T<0&&P>0}function sf(h,a,u){const p=[];for(let y=0;y<h.length;y++){const E=[];for(let T=0;T<h[y].length;T++){const P=Ng(h[y][T],u);Vc(a,P),E.push(P)}p.push(E)}return p}function of(h,a,u){const p=[];for(let y=0;y<h.length;y++){const E=sf(h[y],a,u);p.push(E)}return p}function zu(h,a,u,p){if(h[0]<u[0]||h[0]>u[2]){const y=.5*p;let E=h[0]-u[0]>y?-p:u[0]-h[0]>y?p:0;E===0&&(E=h[0]-u[2]>y?-p:u[2]-h[0]>y?p:0),h[0]+=E}Vc(a,h)}function af(h,a,u,p){const y=Math.pow(2,p.z)*zo,E=[p.x*zo,p.y*zo],T=[];for(const P of h)for(const k of P){const D=[k.x+E[0],k.y+E[1]];zu(D,a,u,y),T.push(D)}return T}function lf(h,a,u,p){const y=Math.pow(2,p.z)*zo,E=[p.x*zo,p.y*zo],T=[];for(const k of h){const D=[];for(const z of k){const $=[z.x+E[0],z.y+E[1]];Vc(a,$),D.push($)}T.push(D)}if(a[2]-a[0]<=y/2){(P=a)[0]=P[1]=1/0,P[2]=P[3]=-1/0;for(const k of T)for(const D of k)zu(D,a,u,y)}var P;return T}class pl{constructor(a,u){this.type=hr,this.geojson=a,this.geometries=u}static parse(a,u){if(a.length!==2)return u.error(`'within' expression requires exactly one argument, but found ${a.length-1} instead.`);if(ul(a[1])){const p=a[1];if(p.type==="FeatureCollection"){const y=[];for(const E of p.features){const{type:T,coordinates:P}=E.geometry;T==="Polygon"&&y.push(P),T==="MultiPolygon"&&y.push(...P)}if(y.length)return new pl(p,{type:"MultiPolygon",coordinates:y})}else if(p.type==="Feature"){const y=p.geometry.type;if(y==="Polygon"||y==="MultiPolygon")return new pl(p,p.geometry)}else if(p.type==="Polygon"||p.type==="MultiPolygon")return new pl(p,p)}return u.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(a){if(a.geometry()!=null&&a.canonicalID()!=null){if(a.geometryType()==="Point")return(function(u,p){const y=[1/0,1/0,-1/0,-1/0],E=[1/0,1/0,-1/0,-1/0],T=u.canonicalID();if(p.type==="Polygon"){const P=sf(p.coordinates,E,T),k=af(u.geometry(),y,E,T);if(!Fu(y,E))return!1;for(const D of k)if(!Wl(D,P))return!1}if(p.type==="MultiPolygon"){const P=of(p.coordinates,E,T),k=af(u.geometry(),y,E,T);if(!Fu(y,E))return!1;for(const D of k)if(!zp(D,P))return!1}return!0})(a,this.geometries);if(a.geometryType()==="LineString")return(function(u,p){const y=[1/0,1/0,-1/0,-1/0],E=[1/0,1/0,-1/0,-1/0],T=u.canonicalID();if(p.type==="Polygon"){const P=sf(p.coordinates,E,T),k=lf(u.geometry(),y,E,T);if(!Fu(y,E))return!1;for(const D of k)if(!rf(D,P))return!1}if(p.type==="MultiPolygon"){const P=of(p.coordinates,E,T),k=lf(u.geometry(),y,E,T);if(!Fu(y,E))return!1;for(const D of k)if(!nf(D,P))return!1}return!0})(a,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let ml=class{constructor(h=[],a=(u,p)=>u<p?-1:u>p?1:0){if(this.data=h,this.length=this.data.length,this.compare=a,this.length>0)for(let u=(this.length>>1)-1;u>=0;u--)this._down(u)}push(h){this.data.push(h),this._up(this.length++)}pop(){if(this.length===0)return;const h=this.data[0],a=this.data.pop();return--this.length>0&&(this.data[0]=a,this._down(0)),h}peek(){return this.data[0]}_up(h){const{data:a,compare:u}=this,p=a[h];for(;h>0;){const y=h-1>>1,E=a[y];if(u(p,E)>=0)break;a[h]=E,h=y}a[h]=p}_down(h){const{data:a,compare:u}=this,p=this.length>>1,y=a[h];for(;h<p;){let E=1+(h<<1);const T=E+1;if(T<this.length&&u(a[T],a[E])<0&&(E=T),u(a[E],y)>=0)break;a[h]=a[E],h=E}a[h]=y}};function cf(h,a,u=0,p=h.length-1,y=jg){for(;p>u;){if(p-u>600){const k=p-u+1,D=a-u+1,z=Math.log(k),$=.5*Math.exp(2*z/3),Y=.5*Math.sqrt(z*$*(k-$)/k)*(D-k/2<0?-1:1);cf(h,a,Math.max(u,Math.floor(a-D*$/k+Y)),Math.min(p,Math.floor(a+(k-D)*$/k+Y)),y)}const E=h[a];let T=u,P=p;for(ju(h,u,a),y(h[p],E)>0&&ju(h,u,p);T<P;){for(ju(h,T,P),T++,P--;y(h[T],E)<0;)T++;for(;y(h[P],E)>0;)P--}y(h[u],E)===0?ju(h,u,P):(P++,ju(h,P,p)),P<=a&&(u=P+1),a<=P&&(p=P-1)}}function ju(h,a,u){const p=h[a];h[a]=h[u],h[u]=p}function jg(h,a){return h<a?-1:h>a?1:0}function Hc(h,a){if(h.length<=1)return[h];const u=[];let p,y;for(const E of h){const T=Uu(E);T!==0&&(E.area=Math.abs(T),y===void 0&&(y=T<0),y===T<0?(p&&u.push(p),p=[E]):p.push(E))}if(p&&u.push(p),a>1)for(let E=0;E<u.length;E++)u[E].length<=a||(cf(u[E],a,1,u[E].length-1,uf),u[E]=u[E].slice(0,a));return u}function uf(h,a){return a.area-h.area}function Uu(h){let a=0;for(let u,p,y=0,E=h.length,T=E-1;y<E;T=y++)u=h[y],p=h[T],a+=(p.x-u.x)*(u.y+p.y);return a}const $c=1/298.257223563,jp=$c*(2-$c),Wc=Math.PI/180;class hf{constructor(a){const u=6378.137*Wc*1e3,p=Math.cos(a*Wc),y=1/(1-jp*(1-p*p)),E=Math.sqrt(y);this.kx=u*E*p,this.ky=u*E*y*(1-jp)}distance(a,u){const p=this.wrap(a[0]-u[0])*this.kx,y=(a[1]-u[1])*this.ky;return Math.sqrt(p*p+y*y)}pointOnLine(a,u){let p,y,E,T,P=1/0;for(let k=0;k<a.length-1;k++){let D=a[k][0],z=a[k][1],$=this.wrap(a[k+1][0]-D)*this.kx,Y=(a[k+1][1]-z)*this.ky,Q=0;$===0&&Y===0||(Q=(this.wrap(u[0]-D)*this.kx*$+(u[1]-z)*this.ky*Y)/($*$+Y*Y),Q>1?(D=a[k+1][0],z=a[k+1][1]):Q>0&&(D+=$/this.kx*Q,z+=Y/this.ky*Q)),$=this.wrap(u[0]-D)*this.kx,Y=(u[1]-z)*this.ky;const te=$*$+Y*Y;te<P&&(P=te,p=D,y=z,E=k,T=Q)}return{point:[p,y],index:E,t:Math.max(0,Math.min(1,T))}}wrap(a){for(;a<-180;)a+=360;for(;a>180;)a-=360;return a}}function df(h,a){return a[0]-h[0]}function qc(h){return h[1]-h[0]+1}function jo(h,a){return h[1]>=h[0]&&h[1]<a}function Ur(h,a){if(h[0]>h[1])return[null,null];const u=qc(h);if(a){if(u===2)return[h,null];const y=Math.floor(u/2);return[[h[0],h[0]+y],[h[0]+y,h[1]]]}if(u===1)return[h,null];const p=Math.floor(u/2)-1;return[[h[0],h[0]+p],[h[0]+p+1,h[1]]]}function jh(h,a){if(!jo(a,h.length))return[1/0,1/0,-1/0,-1/0];const u=[1/0,1/0,-1/0,-1/0];for(let p=a[0];p<=a[1];++p)Vc(u,h[p]);return u}function Uh(h){const a=[1/0,1/0,-1/0,-1/0];for(const u of h)for(const p of u)Vc(a,p);return a}function Up(h){return h[0]!==-1/0&&h[1]!==-1/0&&h[2]!==1/0&&h[3]!==1/0}function ff(h,a,u){if(!Up(h)||!Up(a))return NaN;let p=0,y=0;return h[2]<a[0]&&(p=a[0]-h[2]),h[0]>a[2]&&(p=h[0]-a[2]),h[1]>a[3]&&(y=h[1]-a[3]),h[3]<a[1]&&(y=a[1]-h[3]),u.distance([0,0],[p,y])}function ql(h,a,u){const p=u.pointOnLine(a,h);return u.distance(h,p.point)}function pf(h,a,u,p,y){const E=Math.min(ql(h,[u,p],y),ql(a,[u,p],y)),T=Math.min(ql(u,[h,a],y),ql(p,[h,a],y));return Math.min(E,T)}function Ug(h,a,u,p,y){if(!jo(a,h.length)||!jo(p,u.length))return 1/0;let E=1/0;for(let T=a[0];T<a[1];++T){const P=h[T],k=h[T+1];for(let D=p[0];D<p[1];++D){const z=u[D],$=u[D+1];if(zh(P,k,z,$))return 0;E=Math.min(E,pf(P,k,z,$,y))}}return E}function Uo(h,a,u,p,y){if(!jo(a,h.length)||!jo(p,u.length))return NaN;let E=1/0;for(let T=a[0];T<=a[1];++T)for(let P=p[0];P<=p[1];++P)if(E=Math.min(E,y.distance(h[T],u[P])),E===0)return E;return E}function Vu(h,a,u){if(Wl(h,a,!0))return 0;let p=1/0;for(const y of a){const E=y[0],T=y[y.length-1];if(E!==T&&(p=Math.min(p,ql(h,[T,E],u)),p===0))return p;const P=u.pointOnLine(y,h);if(p=Math.min(p,u.distance(h,P.point)),p===0)return p}return p}function Vp(h,a,u,p){if(!jo(a,h.length))return NaN;for(let E=a[0];E<=a[1];++E)if(Wl(h[E],u,!0))return 0;let y=1/0;for(let E=a[0];E<a[1];++E){const T=h[E],P=h[E+1];for(const k of u)for(let D=0,z=k.length,$=z-1;D<z;$=D++){const Y=k[$],Q=k[D];if(zh(T,P,Y,Q))return 0;y=Math.min(y,pf(T,P,Y,Q,p))}}return y}function mf(h,a){for(const u of h)for(const p of u)if(Wl(p,a,!0))return!0;return!1}function Gp(h,a,u,p=1/0){const y=Uh(h),E=Uh(a);if(p!==1/0&&ff(y,E,u)>=p)return p;if(Fu(y,E)){if(mf(h,a))return 0}else if(mf(a,h))return 0;let T=1/0;for(const P of h)for(let k=0,D=P.length,z=D-1;k<D;z=k++){const $=P[z],Y=P[k];for(const Q of a)for(let te=0,oe=Q.length,de=oe-1;te<oe;de=te++){const ve=Q[de],Fe=Q[te];if(zh($,Y,ve,Fe))return 0;T=Math.min(T,pf($,Y,ve,Fe,u))}}return T}function gf(h,a,u,p,y,E){if(!E)return;const T=ff(jh(p,E),y,u);T<a&&h.push([T,E,[0,0]])}function Kc(h,a,u,p,y,E,T){if(!E||!T)return;const P=ff(jh(p,E),jh(y,T),u);P<a&&h.push([P,E,T])}function Vh(h,a,u,p,y=1/0){let E=Math.min(p.distance(h[0],u[0][0]),y);if(E===0)return E;const T=new ml([[0,[0,h.length-1],[0,0]]],df),P=Uh(u);for(;T.length>0;){const k=T.pop();if(k[0]>=E)continue;const D=k[1],z=a?50:100;if(qc(D)<=z){if(!jo(D,h.length))return NaN;if(a){const $=Vp(h,D,u,p);if(isNaN($)||$===0)return $;E=Math.min(E,$)}else for(let $=D[0];$<=D[1];++$){const Y=Vu(h[$],u,p);if(E=Math.min(E,Y),E===0)return 0}}else{const $=Ur(D,a);gf(T,E,p,h,P,$[0]),gf(T,E,p,h,P,$[1])}}return E}function Gh(h,a,u,p,y,E=1/0){let T=Math.min(E,y.distance(h[0],u[0]));if(T===0)return T;const P=new ml([[0,[0,h.length-1],[0,u.length-1]]],df);for(;P.length>0;){const k=P.pop();if(k[0]>=T)continue;const D=k[1],z=k[2],$=a?50:100,Y=p?50:100;if(qc(D)<=$&&qc(z)<=Y){if(!jo(D,h.length)&&jo(z,u.length))return NaN;let Q;if(a&&p)Q=Ug(h,D,u,z,y),T=Math.min(T,Q);else if(a&&!p){const te=h.slice(D[0],D[1]+1);for(let oe=z[0];oe<=z[1];++oe)if(Q=ql(u[oe],te,y),T=Math.min(T,Q),T===0)return T}else if(!a&&p){const te=u.slice(z[0],z[1]+1);for(let oe=D[0];oe<=D[1];++oe)if(Q=ql(h[oe],te,y),T=Math.min(T,Q),T===0)return T}else Q=Uo(h,D,u,z,y),T=Math.min(T,Q)}else{const Q=Ur(D,a),te=Ur(z,p);Kc(P,T,y,h,u,Q[0],te[0]),Kc(P,T,y,h,u,Q[0],te[1]),Kc(P,T,y,h,u,Q[1],te[0]),Kc(P,T,y,h,u,Q[1],te[1])}}return T}function gl(h){return h.type==="MultiPolygon"?h.coordinates.map((a=>({type:"Polygon",coordinates:a}))):h.type==="MultiLineString"?h.coordinates.map((a=>({type:"LineString",coordinates:a}))):h.type==="MultiPoint"?h.coordinates.map((a=>({type:"Point",coordinates:a}))):[h]}class Ca{constructor(a,u){this.type=St,this.geojson=a,this.geometries=u}static parse(a,u){if(a.length!==2)return u.error(`'distance' expression requires exactly one argument, but found ${a.length-1} instead.`);if(ul(a[1])){const p=a[1];if(p.type==="FeatureCollection")return new Ca(p,p.features.map((y=>gl(y.geometry))).flat());if(p.type==="Feature")return new Ca(p,gl(p.geometry));if("type"in p&&"coordinates"in p)return new Ca(p,gl(p))}return u.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(a){if(a.geometry()!=null&&a.canonicalID()!=null){if(a.geometryType()==="Point")return(function(u,p){const y=u.geometry(),E=y.flat().map((k=>Fh([k.x,k.y],u.canonical)));if(y.length===0)return NaN;const T=new hf(E[0][1]);let P=1/0;for(const k of p){switch(k.type){case"Point":P=Math.min(P,Gh(E,!1,[k.coordinates],!1,T,P));break;case"LineString":P=Math.min(P,Gh(E,!1,k.coordinates,!0,T,P));break;case"Polygon":P=Math.min(P,Vh(E,!1,k.coordinates,T,P))}if(P===0)return P}return P})(a,this.geometries);if(a.geometryType()==="LineString")return(function(u,p){const y=u.geometry(),E=y.flat().map((k=>Fh([k.x,k.y],u.canonical)));if(y.length===0)return NaN;const T=new hf(E[0][1]);let P=1/0;for(const k of p){switch(k.type){case"Point":P=Math.min(P,Gh(E,!0,[k.coordinates],!1,T,P));break;case"LineString":P=Math.min(P,Gh(E,!0,k.coordinates,!0,T,P));break;case"Polygon":P=Math.min(P,Vh(E,!0,k.coordinates,T,P))}if(P===0)return P}return P})(a,this.geometries);if(a.geometryType()==="Polygon")return(function(u,p){const y=u.geometry();if(y.length===0||y[0].length===0)return NaN;const E=Hc(y,0).map((k=>k.map((D=>D.map((z=>Fh([z.x,z.y],u.canonical))))))),T=new hf(E[0][0][0][1]);let P=1/0;for(const k of p)for(const D of E){switch(k.type){case"Point":P=Math.min(P,Vh([k.coordinates],!1,D,T,P));break;case"LineString":P=Math.min(P,Vh(k.coordinates,!0,D,T,P));break;case"Polygon":P=Math.min(P,Gp(D,k.coordinates,T,P))}if(P===0)return P}return P})(a,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class Pa{constructor(a){this.type=fr,this.key=a}static parse(a,u){if(a.length!==2)return u.error(`Expected 1 argument, but found ${a.length-1} instead.`);const p=a[1];return p==null?u.error("Global state property must be defined."):typeof p!="string"?u.error(`Global state property must be string, but found ${typeof a[1]} instead.`):new Pa(p)}evaluate(a){var u;const p=(u=a.globals)===null||u===void 0?void 0:u.globalState;return p&&Object.keys(p).length!==0?ae(p,this.key):null}eachChild(){}outputDefined(){return!1}}const _l={"==":Np,"!=":Dh,">":Qd,"<":Og,">=":Fp,"<=":Dg,array:qn,at:zc,boolean:qn,case:Ta,coalesce:Ou,collator:Nh,format:$l,image:tf,in:Hl,"index-of":fo,interpolate:Yi,"interpolate-hcl":Yi,"interpolate-lab":Yi,length:Uc,let:Fc,literal:Ws,match:Xi,number:qn,"number-format":ef,object:qn,slice:jc,step:mi,string:qn,"to-boolean":ra,"to-color":ra,"to-number":ra,"to-string":ra,var:No,within:pl,distance:Ca,"global-state":Pa};class qs{constructor(a,u,p,y){this.name=a,this.type=u,this._evaluate=p,this.args=y}evaluate(a){return this._evaluate(a,this.args)}eachChild(a){this.args.forEach(a)}outputDefined(){return!1}static parse(a,u){const p=a[0],y=qs.definitions[p];if(!y)return u.error(`Unknown expression "${p}". If you wanted a literal array, use ["literal", [...]].`,0);const E=Array.isArray(y)?y[0]:y.type,T=Array.isArray(y)?[[y[1],y[2]]]:y.overloads,P=T.filter((([D])=>!Array.isArray(D)||D.length===a.length-1));let k=null;for(const[D,z]of P){k=new hl(u.registry,Zl,u.path,null,u.scope);const $=[];let Y=!1;for(let Q=1;Q<a.length;Q++){const te=a[Q],oe=Array.isArray(D)?D[Q-1]:D.type,de=k.parse(te,1+$.length,oe);if(!de){Y=!0;break}$.push(de)}if(!Y)if(Array.isArray(D)&&D.length!==$.length)k.error(`Expected ${D.length} arguments, but found ${$.length} instead.`);else{for(let Q=0;Q<$.length;Q++){const te=Array.isArray(D)?D[Q]:D.type,oe=$[Q];k.concat(Q+1).checkSubtype(te,oe.type)}if(k.errors.length===0)return new qs(p,E,z,$)}}if(P.length===1)u.errors.push(...k.errors);else{const D=(P.length?P:T).map((([$])=>{return Y=$,Array.isArray(Y)?`(${Y.map(Fr).join(", ")})`:`(${Fr(Y.type)}...)`;var Y})).join(" | "),z=[];for(let $=1;$<a.length;$++){const Y=u.parse(a[$],1+z.length);if(!Y)return null;z.push(Fr(Y.type))}u.error(`Expected arguments of type ${D}, but found (${z.join(", ")}) instead.`)}return null}static register(a,u){qs.definitions=u;for(const p in u)a[p]=qs}}function Gu(h,[a,u,p,y]){a=a.evaluate(h),u=u.evaluate(h),p=p.evaluate(h);const E=y?y.evaluate(h):1,T=oi(a,u,p,E);if(T)throw new ci(T);return new lr(a/255,u/255,p/255,E,!1)}function Kl(h,a){return h in a}function Hu(h,a){const u=a[h];return u===void 0?null:u}function yl(h){return{type:h}}function Zl(h){if(h instanceof No)return Zl(h.boundExpression);if(h instanceof qs&&h.name==="error"||h instanceof Nh||h instanceof pl||h instanceof Ca||h instanceof Pa)return!1;const a=h instanceof ra||h instanceof qn;let u=!0;return h.eachChild((p=>{u=a?u&&Zl(p):u&&p instanceof Ws})),!!u&&$u(h)&&Wu(h,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"])}function $u(h){if(h instanceof qs&&(h.name==="get"&&h.args.length===1||h.name==="feature-state"||h.name==="has"&&h.args.length===1||h.name==="properties"||h.name==="geometry-type"||h.name==="id"||/^filter-/.test(h.name))||h instanceof pl||h instanceof Ca)return!1;let a=!0;return h.eachChild((u=>{a&&!$u(u)&&(a=!1)})),a}function Zc(h){if(h instanceof qs&&h.name==="feature-state")return!1;let a=!0;return h.eachChild((u=>{a&&!Zc(u)&&(a=!1)})),a}function Wu(h,a){if(h instanceof qs&&a.indexOf(h.name)>=0)return!1;let u=!0;return h.eachChild((p=>{u&&!Wu(p,a)&&(u=!1)})),u}function _f(h){return{result:"success",value:h}}function Xl(h){return{result:"error",value:h}}function Ra(h){return h["property-type"]==="data-driven"||h["property-type"]==="cross-faded-data-driven"}function Ma(h){return!!h.expression&&h.expression.parameters.indexOf("zoom")>-1}function qu(h){return!!h.expression&&h.expression.interpolated}function Lr(h){return h instanceof Number?"number":h instanceof String?"string":h instanceof Boolean?"boolean":Array.isArray(h)?"array":h===null?"null":typeof h}function Ku(h){return typeof h=="object"&&h!==null&&!Array.isArray(h)&&cr(h)===Wn}function Vg(h){return h}function Xc(h,a){const u=h.stops&&typeof h.stops[0][0]=="object",p=u||!(u||h.property!==void 0),y=h.type||(qu(a)?"exponential":"interval"),E=(function(z){switch(z.type){case"color":return lr.parse;case"padding":return Hi.parse;case"numberArray":return fn.parse;case"colorArray":return pi.parse;default:return null}})(a);if(E&&((h=ki({},h)).stops&&(h.stops=h.stops.map((z=>[z[0],E(z[1])]))),h.default=E(h.default?h.default:a.default)),h.colorSpace&&(T=h.colorSpace)!=="rgb"&&T!=="hcl"&&T!=="lab")throw new Error(`Unknown color space: "${h.colorSpace}"`);var T;const P=(function(z){switch(z){case"exponential":return bi;case"interval":return Hp;case"categorical":return yf;case"identity":return vf;default:throw new Error(`Unknown function type "${z}"`)}})(y);let k,D;if(y==="categorical"){k=Object.create(null);for(const z of h.stops)k[z[0]]=z[1];D=typeof h.stops[0][0]}if(u){const z={},$=[];for(let te=0;te<h.stops.length;te++){const oe=h.stops[te],de=oe[0].zoom;z[de]===void 0&&(z[de]={zoom:de,type:h.type,property:h.property,default:h.default,stops:[]},$.push(de)),z[de].stops.push([oe[0].value,oe[1]])}const Y=[];for(const te of $)Y.push([z[te].zoom,Xc(z[te],a)]);const Q={name:"linear"};return{kind:"composite",interpolationType:Q,interpolationFactor:Yi.interpolationFactor.bind(void 0,Q),zoomStops:Y.map((te=>te[0])),evaluate:({zoom:te},oe)=>bi({stops:Y,base:h.base},a,te).evaluate(te,oe)}}if(p){const z=y==="exponential"?{name:"exponential",base:h.base!==void 0?h.base:1}:null;return{kind:"camera",interpolationType:z,interpolationFactor:Yi.interpolationFactor.bind(void 0,z),zoomStops:h.stops.map(($=>$[0])),evaluate:({zoom:$})=>P(h,a,$,k,D)}}return{kind:"source",evaluate(z,$){const Y=$&&$.properties?$.properties[h.property]:void 0;return Y===void 0?vl(h.default,a.default):P(h,a,Y,k,D)}}}function vl(h,a,u){return h!==void 0?h:a!==void 0?a:u!==void 0?u:void 0}function yf(h,a,u,p,y){return vl(typeof u===y?p[u]:void 0,h.default,a.default)}function Hp(h,a,u){if(Lr(u)!=="number")return vl(h.default,a.default);const p=h.stops.length;if(p===1||u<=h.stops[0][0])return h.stops[0][1];if(u>=h.stops[p-1][0])return h.stops[p-1][1];const y=mn(h.stops.map((E=>E[0])),u);return h.stops[y][1]}function bi(h,a,u){const p=h.base!==void 0?h.base:1;if(Lr(u)!=="number")return vl(h.default,a.default);const y=h.stops.length;if(y===1||u<=h.stops[0][0])return h.stops[0][1];if(u>=h.stops[y-1][0])return h.stops[y-1][1];const E=mn(h.stops.map((z=>z[0])),u),T=(function(z,$,Y,Q){const te=Q-Y,oe=z-Y;return te===0?0:$===1?oe/te:(Math.pow($,oe)-1)/(Math.pow($,te)-1)})(u,p,h.stops[E][0],h.stops[E+1][0]),P=h.stops[E][1],k=h.stops[E+1][1],D=Fo[a.type]||Vg;return typeof P.evaluate=="function"?{evaluate(...z){const $=P.evaluate.apply(void 0,z),Y=k.evaluate.apply(void 0,z);if($!==void 0&&Y!==void 0)return D($,Y,T,h.colorSpace)}}:D(P,k,T,h.colorSpace)}function vf(h,a,u){switch(a.type){case"color":u=lr.parse(u);break;case"formatted":u=Gi.fromString(u.toString());break;case"resolvedImage":u=$s.fromString(u.toString());break;case"padding":u=Hi.parse(u);break;case"colorArray":u=pi.parse(u);break;case"numberArray":u=fn.parse(u);break;default:Lr(u)===a.type||a.type==="enum"&&a.values[u]||(u=void 0)}return vl(u,h.default,a.default)}qs.register(_l,{error:[{kind:"error"},[Mr],(h,[a])=>{throw new ci(a.evaluate(h))}],typeof:[Mr,[fr],(h,[a])=>Fr(cr(a.evaluate(h)))],"to-rgba":[Bi(St,4),[Ki],(h,[a])=>{const[u,p,y,E]=a.evaluate(h).rgb;return[255*u,255*p,255*y,E]}],rgb:[Ki,[St,St,St],Gu],rgba:[Ki,[St,St,St,St],Gu],has:{type:hr,overloads:[[[Mr],(h,[a])=>Kl(a.evaluate(h),h.properties())],[[Mr,Wn],(h,[a,u])=>Kl(a.evaluate(h),u.evaluate(h))]]},get:{type:fr,overloads:[[[Mr],(h,[a])=>Hu(a.evaluate(h),h.properties())],[[Mr,Wn],(h,[a,u])=>Hu(a.evaluate(h),u.evaluate(h))]]},"feature-state":[fr,[Mr],(h,[a])=>Hu(a.evaluate(h),h.featureState||{})],properties:[Wn,[],h=>h.properties()],"geometry-type":[Mr,[],h=>h.geometryType()],id:[fr,[],h=>h.id()],zoom:[St,[],h=>h.globals.zoom],"heatmap-density":[St,[],h=>h.globals.heatmapDensity||0],elevation:[St,[],h=>h.globals.elevation||0],"line-progress":[St,[],h=>h.globals.lineProgress||0],accumulated:[fr,[],h=>h.globals.accumulated===void 0?null:h.globals.accumulated],"+":[St,yl(St),(h,a)=>{let u=0;for(const p of a)u+=p.evaluate(h);return u}],"*":[St,yl(St),(h,a)=>{let u=1;for(const p of a)u*=p.evaluate(h);return u}],"-":{type:St,overloads:[[[St,St],(h,[a,u])=>a.evaluate(h)-u.evaluate(h)],[[St],(h,[a])=>-a.evaluate(h)]]},"/":[St,[St,St],(h,[a,u])=>a.evaluate(h)/u.evaluate(h)],"%":[St,[St,St],(h,[a,u])=>a.evaluate(h)%u.evaluate(h)],ln2:[St,[],()=>Math.LN2],pi:[St,[],()=>Math.PI],e:[St,[],()=>Math.E],"^":[St,[St,St],(h,[a,u])=>Math.pow(a.evaluate(h),u.evaluate(h))],sqrt:[St,[St],(h,[a])=>Math.sqrt(a.evaluate(h))],log10:[St,[St],(h,[a])=>Math.log(a.evaluate(h))/Math.LN10],ln:[St,[St],(h,[a])=>Math.log(a.evaluate(h))],log2:[St,[St],(h,[a])=>Math.log(a.evaluate(h))/Math.LN2],sin:[St,[St],(h,[a])=>Math.sin(a.evaluate(h))],cos:[St,[St],(h,[a])=>Math.cos(a.evaluate(h))],tan:[St,[St],(h,[a])=>Math.tan(a.evaluate(h))],asin:[St,[St],(h,[a])=>Math.asin(a.evaluate(h))],acos:[St,[St],(h,[a])=>Math.acos(a.evaluate(h))],atan:[St,[St],(h,[a])=>Math.atan(a.evaluate(h))],min:[St,yl(St),(h,a)=>Math.min(...a.map((u=>u.evaluate(h))))],max:[St,yl(St),(h,a)=>Math.max(...a.map((u=>u.evaluate(h))))],abs:[St,[St],(h,[a])=>Math.abs(a.evaluate(h))],round:[St,[St],(h,[a])=>{const u=a.evaluate(h);return u<0?-Math.round(-u):Math.round(u)}],floor:[St,[St],(h,[a])=>Math.floor(a.evaluate(h))],ceil:[St,[St],(h,[a])=>Math.ceil(a.evaluate(h))],"filter-==":[hr,[Mr,fr],(h,[a,u])=>h.properties()[a.value]===u.value],"filter-id-==":[hr,[fr],(h,[a])=>h.id()===a.value],"filter-type-==":[hr,[Mr],(h,[a])=>h.geometryType()===a.value],"filter-<":[hr,[Mr,fr],(h,[a,u])=>{const p=h.properties()[a.value],y=u.value;return typeof p==typeof y&&p<y}],"filter-id-<":[hr,[fr],(h,[a])=>{const u=h.id(),p=a.value;return typeof u==typeof p&&u<p}],"filter->":[hr,[Mr,fr],(h,[a,u])=>{const p=h.properties()[a.value],y=u.value;return typeof p==typeof y&&p>y}],"filter-id->":[hr,[fr],(h,[a])=>{const u=h.id(),p=a.value;return typeof u==typeof p&&u>p}],"filter-<=":[hr,[Mr,fr],(h,[a,u])=>{const p=h.properties()[a.value],y=u.value;return typeof p==typeof y&&p<=y}],"filter-id-<=":[hr,[fr],(h,[a])=>{const u=h.id(),p=a.value;return typeof u==typeof p&&u<=p}],"filter->=":[hr,[Mr,fr],(h,[a,u])=>{const p=h.properties()[a.value],y=u.value;return typeof p==typeof y&&p>=y}],"filter-id->=":[hr,[fr],(h,[a])=>{const u=h.id(),p=a.value;return typeof u==typeof p&&u>=p}],"filter-has":[hr,[fr],(h,[a])=>a.value in h.properties()],"filter-has-id":[hr,[],h=>h.id()!==null&&h.id()!==void 0],"filter-type-in":[hr,[Bi(Mr)],(h,[a])=>a.value.indexOf(h.geometryType())>=0],"filter-id-in":[hr,[Bi(fr)],(h,[a])=>a.value.indexOf(h.id())>=0],"filter-in-small":[hr,[Mr,Bi(fr)],(h,[a,u])=>u.value.indexOf(h.properties()[a.value])>=0],"filter-in-large":[hr,[Mr,Bi(fr)],(h,[a,u])=>(function(p,y,E,T){for(;E<=T;){const P=E+T>>1;if(y[P]===p)return!0;y[P]>p?T=P-1:E=P+1}return!1})(h.properties()[a.value],u.value,0,u.value.length-1)],all:{type:hr,overloads:[[[hr,hr],(h,[a,u])=>a.evaluate(h)&&u.evaluate(h)],[yl(hr),(h,a)=>{for(const u of a)if(!u.evaluate(h))return!1;return!0}]]},any:{type:hr,overloads:[[[hr,hr],(h,[a,u])=>a.evaluate(h)||u.evaluate(h)],[yl(hr),(h,a)=>{for(const u of a)if(u.evaluate(h))return!0;return!1}]]},"!":[hr,[hr],(h,[a])=>!a.evaluate(h)],"is-supported-script":[hr,[Mr],(h,[a])=>{const u=h.globals&&h.globals.isSupportedScript;return!u||u(a.evaluate(h))}],upcase:[Mr,[Mr],(h,[a])=>a.evaluate(h).toUpperCase()],downcase:[Mr,[Mr],(h,[a])=>a.evaluate(h).toLowerCase()],concat:[Mr,yl(fr),(h,a)=>a.map((u=>mr(u.evaluate(h)))).join("")],"resolved-locale":[Mr,[Io],(h,[a])=>a.evaluate(h).resolvedLocale()]});class Yc{constructor(a,u){this.expression=a,this._warningHistory={},this._evaluator=new Nc,this._defaultValue=u?(function(p){if(p.type==="color"&&Ku(p.default))return new lr(0,0,0,0);switch(p.type){case"color":return lr.parse(p.default)||null;case"padding":return Hi.parse(p.default)||null;case"numberArray":return fn.parse(p.default)||null;case"colorArray":return pi.parse(p.default)||null;case"variableAnchorOffsetCollection":return pn.parse(p.default)||null;case"projectionDefinition":return Nn.parse(p.default)||null;default:return p.default===void 0?null:p.default}})(u):null,this._enumValues=u&&u.type==="enum"?u.values:null}evaluateWithoutErrorHandling(a,u,p,y,E,T){return this._evaluator.globals=a,this._evaluator.feature=u,this._evaluator.featureState=p,this._evaluator.canonical=y,this._evaluator.availableImages=E||null,this._evaluator.formattedSection=T,this.expression.evaluate(this._evaluator)}evaluate(a,u,p,y,E,T){this._evaluator.globals=a,this._evaluator.feature=u||null,this._evaluator.featureState=p||null,this._evaluator.canonical=y,this._evaluator.availableImages=E||null,this._evaluator.formattedSection=T||null;try{const P=this.expression.evaluate(this._evaluator);if(P==null||typeof P=="number"&&P!=P)return this._defaultValue;if(this._enumValues&&!(P in this._enumValues))throw new ci(`Expected value to be one of ${Object.keys(this._enumValues).map((k=>JSON.stringify(k))).join(", ")}, but found ${JSON.stringify(P)} instead.`);return P}catch(P){return this._warningHistory[P.message]||(this._warningHistory[P.message]=!0,typeof console<"u"&&console.warn(P.message)),this._defaultValue}}}function bl(h){return Array.isArray(h)&&h.length>0&&typeof h[0]=="string"&&h[0]in _l}function Jc(h,a){const u=new hl(_l,Zl,[],a?(function(y){const E={color:Ki,string:Mr,number:St,enum:Mr,boolean:hr,formatted:Rs,padding:wa,numberArray:sl,colorArray:ho,projectionDefinition:uo,resolvedImage:wr,variableAnchorOffsetCollection:On};return y.type==="array"?Bi(E[y.value]||fr,y.length):E[y.type]})(a):void 0),p=u.parse(h,void 0,void 0,void 0,a&&a.type==="string"?{typeAnnotation:"coerce"}:void 0);return p?_f(new Yc(p,a)):Xl(u.errors)}class Yl{constructor(a,u){this.kind=a,this._styleExpression=u,this.isStateDependent=a!=="constant"&&!Zc(u.expression),this.globalStateRefs=Xu(u.expression)}evaluateWithoutErrorHandling(a,u,p,y,E,T){return this._styleExpression.evaluateWithoutErrorHandling(a,u,p,y,E,T)}evaluate(a,u,p,y,E,T){return this._styleExpression.evaluate(a,u,p,y,E,T)}}class Jl{constructor(a,u,p,y){this.kind=a,this.zoomStops=p,this._styleExpression=u,this.isStateDependent=a!=="camera"&&!Zc(u.expression),this.globalStateRefs=Xu(u.expression),this.interpolationType=y}evaluateWithoutErrorHandling(a,u,p,y,E,T){return this._styleExpression.evaluateWithoutErrorHandling(a,u,p,y,E,T)}evaluate(a,u,p,y,E,T){return this._styleExpression.evaluate(a,u,p,y,E,T)}interpolationFactor(a,u,p){return this.interpolationType?Yi.interpolationFactor(this.interpolationType,a,u,p):0}}function Zu(h,a){const u=Jc(h,a);if(u.result==="error")return u;const p=u.value.expression,y=$u(p);if(!y&&!Ra(a))return Xl([new li("","data expressions not supported")]);const E=Wu(p,["zoom"]);if(!E&&!Ma(a))return Xl([new li("","zoom expressions not supported")]);const T=Qc(p);return T||E?T instanceof li?Xl([T]):T instanceof Yi&&!qu(a)?Xl([new li("",'"interpolate" expressions cannot be used with this property')]):_f(T?new Jl(y?"camera":"composite",u.value,T.labels,T instanceof Yi?T.interpolation:void 0):new Yl(y?"constant":"source",u.value)):Xl([new li("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class ia{constructor(a,u){this._parameters=a,this._specification=u,ki(this,Xc(this._parameters,this._specification))}static deserialize(a){return new ia(a._parameters,a._specification)}static serialize(a){return{_parameters:a._parameters,_specification:a._specification}}}function Qc(h){let a=null;if(h instanceof Fc)a=Qc(h.result);else if(h instanceof Ou){for(const u of h.args)if(a=Qc(u),a)break}else(h instanceof mi||h instanceof Yi)&&h.input instanceof qs&&h.input.name==="zoom"&&(a=h);return a instanceof li||h.eachChild((u=>{const p=Qc(u);p instanceof li?a=p:!a&&p?a=new li("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):a&&p&&a!==p&&(a=new li("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),a}function Xu(h,a=new Set){return h instanceof Pa&&a.add(h.key),h.eachChild((u=>{Xu(u,a)})),a}function Hh(h){if(h===!0||h===!1)return!0;if(!Array.isArray(h)||h.length===0)return!1;switch(h[0]){case"has":return h.length>=2&&h[1]!=="$id"&&h[1]!=="$type";case"in":return h.length>=3&&(typeof h[1]!="string"||Array.isArray(h[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return h.length!==3||Array.isArray(h[1])||Array.isArray(h[2]);case"any":case"all":for(const a of h.slice(1))if(!Hh(a)&&typeof a!="boolean")return!1;return!0;default:return!0}}const $h={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function na(h){if(h==null)return{filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set};Hh(h)||(h=Ia(h));const a=Jc(h,$h);if(a.result==="error")throw new Error(a.value.map((u=>`${u.key}: ${u.message}`)).join(", "));return{filter:(u,p,y)=>a.value.evaluate(u,p,{},y),needGeometry:tu(h),getGlobalStateRefs:()=>Xu(a.value.expression)}}function eu(h,a){return h<a?-1:h>a?1:0}function tu(h){if(!Array.isArray(h))return!1;if(h[0]==="within"||h[0]==="distance")return!0;for(let a=1;a<h.length;a++)if(tu(h[a]))return!0;return!1}function Ia(h){if(!h)return!0;const a=h[0];return h.length<=1?a!=="any":a==="=="?Yu(h[1],h[2],"=="):a==="!="?Ju(Yu(h[1],h[2],"==")):a==="<"||a===">"||a==="<="||a===">="?Yu(h[1],h[2],a):a==="any"?(u=h.slice(1),["any"].concat(u.map(Ia))):a==="all"?["all"].concat(h.slice(1).map(Ia)):a==="none"?["all"].concat(h.slice(1).map(Ia).map(Ju)):a==="in"?Wh(h[1],h.slice(2)):a==="!in"?Ju(Wh(h[1],h.slice(2))):a==="has"?$p(h[1]):a!=="!has"||Ju($p(h[1]));var u}function Yu(h,a,u){switch(h){case"$type":return[`filter-type-${u}`,a];case"$id":return[`filter-id-${u}`,a];default:return[`filter-${u}`,h,a]}}function Wh(h,a){if(a.length===0)return!1;switch(h){case"$type":return["filter-type-in",["literal",a]];case"$id":return["filter-id-in",["literal",a]];default:return a.length>200&&!a.some((u=>typeof u!=typeof a[0]))?["filter-in-large",h,["literal",a.sort(eu)]]:["filter-in-small",h,["literal",a]]}}function $p(h){switch(h){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",h]}}function Ju(h){return["!",h]}function bf(h){const a=typeof h;if(a==="number"||a==="boolean"||a==="string"||h==null)return JSON.stringify(h);if(Array.isArray(h)){let y="[";for(const E of h)y+=`${bf(E)},`;return`${y}]`}const u=Object.keys(h).sort();let p="{";for(let y=0;y<u.length;y++)p+=`${JSON.stringify(u[y])}:${bf(h[u[y]])},`;return`${p}}`}function Gg(h){let a="";for(const u of ar)a+=`/${bf(h[u])}`;return a}function Qu(h){const a=h.value;return a?[new yt(h.key,a,"constants have been deprecated as of v8")]:[]}function ei(h){return h instanceof Number||h instanceof String||h instanceof Boolean?h.valueOf():h}function Vo(h){if(Array.isArray(h))return h.map(Vo);if(h instanceof Object&&!(h instanceof Number||h instanceof String||h instanceof Boolean)){const a={};for(const u in h)a[u]=Vo(h[u]);return a}return ei(h)}function Fn(h){const a=h.key,u=h.value,p=h.valueSpec||{},y=h.objectElementValidators||{},E=h.style,T=h.styleSpec,P=h.validateSpec;let k=[];const D=Lr(u);if(D!=="object")return[new yt(a,u,`object expected, ${D} found`)];for(const z in u){const $=z.split(".")[0],Y=ae(p,$)||p["*"];let Q;if(ae(y,$))Q=y[$];else if(ae(p,$))Q=P;else if(y["*"])Q=y["*"];else{if(!p["*"]){k.push(new yt(a,u[z],`unknown property "${z}"`));continue}Q=P}k=k.concat(Q({key:(a&&`${a}.`)+z,value:u[z],valueSpec:Y,style:E,styleSpec:T,object:u,objectKey:z,validateSpec:P},u))}for(const z in p)y[z]||p[z].required&&p[z].default===void 0&&u[z]===void 0&&k.push(new yt(a,u,`missing required property "${z}"`));return k}function Ks(h){const a=h.value,u=h.valueSpec,p=h.style,y=h.styleSpec,E=h.key,T=h.arrayElementValidator||h.validateSpec;if(Lr(a)!=="array")return[new yt(E,a,`array expected, ${Lr(a)} found`)];if(u.length&&a.length!==u.length)return[new yt(E,a,`array length ${u.length} expected, length ${a.length} found`)];if(u["min-length"]&&a.length<u["min-length"])return[new yt(E,a,`array length at least ${u["min-length"]} expected, length ${a.length} found`)];let P={type:u.value,values:u.values};y.$version<7&&(P.function=u.function),Lr(u.value)==="object"&&(P=u.value);let k=[];for(let D=0;D<a.length;D++)k=k.concat(T({array:a,arrayIndex:D,value:a[D],valueSpec:P,validateSpec:h.validateSpec,style:p,styleSpec:y,key:`${E}[${D}]`}));return k}function ka(h){const a=h.key,u=h.value,p=h.valueSpec;let y=Lr(u);return y==="number"&&u!=u&&(y="NaN"),y!=="number"?[new yt(a,u,`number expected, ${y} found`)]:"minimum"in p&&u<p.minimum?[new yt(a,u,`${u} is less than the minimum value ${p.minimum}`)]:"maximum"in p&&u>p.maximum?[new yt(a,u,`${u} is greater than the maximum value ${p.maximum}`)]:[]}function sa(h){const a=h.valueSpec,u=ei(h.value.type);let p,y,E,T={};const P=u!=="categorical"&&h.value.property===void 0,k=!P,D=Lr(h.value.stops)==="array"&&Lr(h.value.stops[0])==="array"&&Lr(h.value.stops[0][0])==="object",z=Fn({key:h.key,value:h.value,valueSpec:h.styleSpec.function,validateSpec:h.validateSpec,style:h.style,styleSpec:h.styleSpec,objectElementValidators:{stops:function(Q){if(u==="identity")return[new yt(Q.key,Q.value,'identity function may not have a "stops" property')];let te=[];const oe=Q.value;return te=te.concat(Ks({key:Q.key,value:oe,valueSpec:Q.valueSpec,validateSpec:Q.validateSpec,style:Q.style,styleSpec:Q.styleSpec,arrayElementValidator:$})),Lr(oe)==="array"&&oe.length===0&&te.push(new yt(Q.key,oe,"array must have at least one stop")),te},default:function(Q){return Q.validateSpec({key:Q.key,value:Q.value,valueSpec:a,validateSpec:Q.validateSpec,style:Q.style,styleSpec:Q.styleSpec})}}});return u==="identity"&&P&&z.push(new yt(h.key,h.value,'missing required property "property"')),u==="identity"||h.value.stops||z.push(new yt(h.key,h.value,'missing required property "stops"')),u==="exponential"&&h.valueSpec.expression&&!qu(h.valueSpec)&&z.push(new yt(h.key,h.value,"exponential functions not supported")),h.styleSpec.$version>=8&&(k&&!Ra(h.valueSpec)?z.push(new yt(h.key,h.value,"property functions not supported")):P&&!Ma(h.valueSpec)&&z.push(new yt(h.key,h.value,"zoom functions not supported"))),u!=="categorical"&&!D||h.value.property!==void 0||z.push(new yt(h.key,h.value,'"property" property is required')),z;function $(Q){let te=[];const oe=Q.value,de=Q.key;if(Lr(oe)!=="array")return[new yt(de,oe,`array expected, ${Lr(oe)} found`)];if(oe.length!==2)return[new yt(de,oe,`array length 2 expected, length ${oe.length} found`)];if(D){if(Lr(oe[0])!=="object")return[new yt(de,oe,`object expected, ${Lr(oe[0])} found`)];if(oe[0].zoom===void 0)return[new yt(de,oe,"object stop key must have zoom")];if(oe[0].value===void 0)return[new yt(de,oe,"object stop key must have value")];if(E&&E>ei(oe[0].zoom))return[new yt(de,oe[0].zoom,"stop zoom values must appear in ascending order")];ei(oe[0].zoom)!==E&&(E=ei(oe[0].zoom),y=void 0,T={}),te=te.concat(Fn({key:`${de}[0]`,value:oe[0],valueSpec:{zoom:{}},validateSpec:Q.validateSpec,style:Q.style,styleSpec:Q.styleSpec,objectElementValidators:{zoom:ka,value:Y}}))}else te=te.concat(Y({key:`${de}[0]`,value:oe[0],validateSpec:Q.validateSpec,style:Q.style,styleSpec:Q.styleSpec},oe));return bl(Vo(oe[1]))?te.concat([new yt(`${de}[1]`,oe[1],"expressions are not allowed in function stops.")]):te.concat(Q.validateSpec({key:`${de}[1]`,value:oe[1],valueSpec:a,validateSpec:Q.validateSpec,style:Q.style,styleSpec:Q.styleSpec}))}function Y(Q,te){const oe=Lr(Q.value),de=ei(Q.value),ve=Q.value!==null?Q.value:te;if(p){if(oe!==p)return[new yt(Q.key,ve,`${oe} stop domain type must match previous stop domain type ${p}`)]}else p=oe;if(oe!=="number"&&oe!=="string"&&oe!=="boolean")return[new yt(Q.key,ve,"stop domain value must be a number, string, or boolean")];if(oe!=="number"&&u!=="categorical"){let Fe=`number expected, ${oe} found`;return Ra(a)&&u===void 0&&(Fe+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new yt(Q.key,ve,Fe)]}return u!=="categorical"||oe!=="number"||isFinite(de)&&Math.floor(de)===de?u!=="categorical"&&oe==="number"&&y!==void 0&&de<y?[new yt(Q.key,ve,"stop domain values must appear in ascending order")]:(y=de,u==="categorical"&&de in T?[new yt(Q.key,ve,"stop domain values must be unique")]:(T[de]=!0,[])):[new yt(Q.key,ve,`integer expected, found ${de}`)]}}function Ba(h){const a=(h.expressionContext==="property"?Zu:Jc)(Vo(h.value),h.valueSpec);if(a.result==="error")return a.value.map((p=>new yt(`${h.key}${p.key}`,h.value,p.message)));const u=a.value.expression||a.value._styleExpression.expression;if(h.expressionContext==="property"&&h.propertyKey==="text-font"&&!u.outputDefined())return[new yt(h.key,h.value,`Invalid data expression for "${h.propertyKey}". Output values must be contained as literals within the expression.`)];if(h.expressionContext==="property"&&h.propertyType==="layout"&&!Zc(u))return[new yt(h.key,h.value,'"feature-state" data expressions are not supported with layout properties.')];if(h.expressionContext==="filter"&&!Zc(u))return[new yt(h.key,h.value,'"feature-state" data expressions are not supported with filters.')];if(h.expressionContext&&h.expressionContext.indexOf("cluster")===0){if(!Wu(u,["zoom","feature-state"]))return[new yt(h.key,h.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(h.expressionContext==="cluster-initial"&&!$u(u))return[new yt(h.key,h.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function qh(h){const a=h.key,u=h.value,p=Lr(u);return p!=="string"?[new yt(a,u,`color expected, ${p} found`)]:lr.parse(String(u))?[]:[new yt(a,u,`color expected, "${u}" found`)]}function La(h){const a=h.key,u=h.value,p=h.valueSpec,y=[];return Array.isArray(p.values)?p.values.indexOf(ei(u))===-1&&y.push(new yt(a,u,`expected one of [${p.values.join(", ")}], ${JSON.stringify(u)} found`)):Object.keys(p.values).indexOf(ei(u))===-1&&y.push(new yt(a,u,`expected one of [${Object.keys(p.values).join(", ")}], ${JSON.stringify(u)} found`)),y}function Oa(h){return Hh(Vo(h.value))?Ba(ki({},h,{expressionContext:"filter",valueSpec:{value:"boolean"}})):ru(h)}function ru(h){const a=h.value,u=h.key;if(Lr(a)!=="array")return[new yt(u,a,`array expected, ${Lr(a)} found`)];const p=h.styleSpec;let y,E=[];if(a.length<1)return[new yt(u,a,"filter array must have at least 1 element")];switch(E=E.concat(La({key:`${u}[0]`,value:a[0],valueSpec:p.filter_operator,style:h.style,styleSpec:h.styleSpec})),ei(a[0])){case"<":case"<=":case">":case">=":a.length>=2&&ei(a[1])==="$type"&&E.push(new yt(u,a,`"$type" cannot be use with operator "${a[0]}"`));case"==":case"!=":a.length!==3&&E.push(new yt(u,a,`filter array for operator "${a[0]}" must have 3 elements`));case"in":case"!in":a.length>=2&&(y=Lr(a[1]),y!=="string"&&E.push(new yt(`${u}[1]`,a[1],`string expected, ${y} found`)));for(let T=2;T<a.length;T++)y=Lr(a[T]),ei(a[1])==="$type"?E=E.concat(La({key:`${u}[${T}]`,value:a[T],valueSpec:p.geometry_type,style:h.style,styleSpec:h.styleSpec})):y!=="string"&&y!=="number"&&y!=="boolean"&&E.push(new yt(`${u}[${T}]`,a[T],`string, number, or boolean expected, ${y} found`));break;case"any":case"all":case"none":for(let T=1;T<a.length;T++)E=E.concat(ru({key:`${u}[${T}]`,value:a[T],style:h.style,styleSpec:h.styleSpec}));break;case"has":case"!has":y=Lr(a[1]),a.length!==2?E.push(new yt(u,a,`filter array for "${a[0]}" operator must have 2 elements`)):y!=="string"&&E.push(new yt(`${u}[1]`,a[1],`string expected, ${y} found`))}return E}function Ql(h,a){const u=h.key,p=h.validateSpec,y=h.style,E=h.styleSpec,T=h.value,P=h.objectKey,k=E[`${a}_${h.layerType}`];if(!k)return[];const D=P.match(/^(.*)-transition$/);if(a==="paint"&&D&&k[D[1]]&&k[D[1]].transition)return p({key:u,value:T,valueSpec:E.transition,style:y,styleSpec:E});const z=h.valueSpec||k[P];if(!z)return[new yt(u,T,`unknown property "${P}"`)];let $;if(Lr(T)==="string"&&Ra(z)&&!z.tokens&&($=/^{([^}]+)}$/.exec(T)))return[new yt(u,T,`"${P}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify($[1])} }\`.`)];const Y=[];return h.layerType==="symbol"&&(P==="text-field"&&y&&!y.glyphs&&Y.push(new yt(u,T,'use of "text-field" requires a style "glyphs" property')),P==="text-font"&&Ku(Vo(T))&&ei(T.type)==="identity"&&Y.push(new yt(u,T,'"text-font" does not support identity functions'))),Y.concat(p({key:h.key,value:T,valueSpec:z,style:y,styleSpec:E,expressionContext:"property",propertyType:a,propertyKey:P}))}function eh(h){return Ql(h,"paint")}function Kh(h){return Ql(h,"layout")}function ec(h){let a=[];const u=h.value,p=h.key,y=h.style,E=h.styleSpec;if(Lr(u)!=="object")return[new yt(p,u,`object expected, ${Lr(u)} found`)];u.type||u.ref||a.push(new yt(p,u,'either "type" or "ref" is required'));let T=ei(u.type);const P=ei(u.ref);if(u.id){const k=ei(u.id);for(let D=0;D<h.arrayIndex;D++){const z=y.layers[D];ei(z.id)===k&&a.push(new yt(p,u.id,`duplicate layer id "${u.id}", previously used at line ${z.id.__line__}`))}}if("ref"in u){let k;["type","source","source-layer","filter","layout"].forEach((D=>{D in u&&a.push(new yt(p,u[D],`"${D}" is prohibited for ref layers`))})),y.layers.forEach((D=>{ei(D.id)===P&&(k=D)})),k?k.ref?a.push(new yt(p,u.ref,"ref cannot reference another ref layer")):T=ei(k.type):a.push(new yt(p,u.ref,`ref layer "${P}" not found`))}else if(T!=="background")if(u.source){const k=y.sources&&y.sources[u.source],D=k&&ei(k.type);k?D==="vector"&&T==="raster"?a.push(new yt(p,u.source,`layer "${u.id}" requires a raster source`)):D!=="raster-dem"&&T==="hillshade"||D!=="raster-dem"&&T==="color-relief"?a.push(new yt(p,u.source,`layer "${u.id}" requires a raster-dem source`)):D==="raster"&&T!=="raster"?a.push(new yt(p,u.source,`layer "${u.id}" requires a vector source`)):D!=="vector"||u["source-layer"]?D==="raster-dem"&&T!=="hillshade"&&T!=="color-relief"?a.push(new yt(p,u.source,"raster-dem source can only be used with layer type 'hillshade' or 'color-relief'.")):T!=="line"||!u.paint||!u.paint["line-gradient"]||D==="geojson"&&k.lineMetrics||a.push(new yt(p,u,`layer "${u.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):a.push(new yt(p,u,`layer "${u.id}" must specify a "source-layer"`)):a.push(new yt(p,u.source,`source "${u.source}" not found`))}else a.push(new yt(p,u,'missing required property "source"'));return a=a.concat(Fn({key:p,value:u,valueSpec:E.layer,style:h.style,styleSpec:h.styleSpec,validateSpec:h.validateSpec,objectElementValidators:{"*":()=>[],type:()=>h.validateSpec({key:`${p}.type`,value:u.type,valueSpec:E.layer.type,style:h.style,styleSpec:h.styleSpec,validateSpec:h.validateSpec,object:u,objectKey:"type"}),filter:Oa,layout:k=>Fn({layer:u,key:k.key,value:k.value,style:k.style,styleSpec:k.styleSpec,validateSpec:k.validateSpec,objectElementValidators:{"*":D=>Kh(ki({layerType:T},D))}}),paint:k=>Fn({layer:u,key:k.key,value:k.value,style:k.style,styleSpec:k.styleSpec,validateSpec:k.validateSpec,objectElementValidators:{"*":D=>eh(ki({layerType:T},D))}})}})),a}function Cn(h){const a=h.value,u=h.key,p=Lr(a);return p!=="string"?[new yt(u,a,`string expected, ${p} found`)]:[]}const ti={promoteId:function({key:h,value:a}){if(Lr(a)==="string")return Cn({key:h,value:a});{const u=[];for(const p in a)u.push(...Cn({key:`${h}.${p}`,value:a[p]}));return u}}};function Dr(h){const a=h.value,u=h.key,p=h.styleSpec,y=h.style,E=h.validateSpec;if(!a.type)return[new yt(u,a,'"type" is required')];const T=ei(a.type);let P;switch(T){case"vector":case"raster":return P=Fn({key:u,value:a,valueSpec:p[`source_${T.replace("-","_")}`],style:h.style,styleSpec:p,objectElementValidators:ti,validateSpec:E}),P;case"raster-dem":return P=(function(k){var D;const z=(D=k.sourceName)!==null&&D!==void 0?D:"",$=k.value,Y=k.styleSpec,Q=Y.source_raster_dem,te=k.style;let oe=[];const de=Lr($);if($===void 0)return oe;if(de!=="object")return oe.push(new yt("source_raster_dem",$,`object expected, ${de} found`)),oe;const ve=ei($.encoding)==="custom",Fe=["redFactor","greenFactor","blueFactor","baseShift"],Ee=k.value.encoding?`"${k.value.encoding}"`:"Default";for(const Re in $)!ve&&Fe.includes(Re)?oe.push(new yt(Re,$[Re],`In "${z}": "${Re}" is only valid when "encoding" is set to "custom". ${Ee} encoding found`)):Q[Re]?oe=oe.concat(k.validateSpec({key:Re,value:$[Re],valueSpec:Q[Re],validateSpec:k.validateSpec,style:te,styleSpec:Y})):oe.push(new yt(Re,$[Re],`unknown property "${Re}"`));return oe})({sourceName:u,value:a,style:h.style,styleSpec:p,validateSpec:E}),P;case"geojson":if(P=Fn({key:u,value:a,valueSpec:p.source_geojson,style:y,styleSpec:p,validateSpec:E,objectElementValidators:ti}),a.cluster)for(const k in a.clusterProperties){const[D,z]=a.clusterProperties[k],$=typeof D=="string"?[D,["accumulated"],["get",k]]:D;P.push(...Ba({key:`${u}.${k}.map`,value:z,expressionContext:"cluster-map"})),P.push(...Ba({key:`${u}.${k}.reduce`,value:$,expressionContext:"cluster-reduce"}))}return P;case"video":return Fn({key:u,value:a,valueSpec:p.source_video,style:y,validateSpec:E,styleSpec:p});case"image":return Fn({key:u,value:a,valueSpec:p.source_image,style:y,validateSpec:E,styleSpec:p});case"canvas":return[new yt(u,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return La({key:`${u}.type`,value:a.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function Zs(h){const a=h.value,u=h.styleSpec,p=u.light,y=h.style;let E=[];const T=Lr(a);if(a===void 0)return E;if(T!=="object")return E=E.concat([new yt("light",a,`object expected, ${T} found`)]),E;for(const P in a){const k=P.match(/^(.*)-transition$/);E=E.concat(k&&p[k[1]]&&p[k[1]].transition?h.validateSpec({key:P,value:a[P],valueSpec:u.transition,validateSpec:h.validateSpec,style:y,styleSpec:u}):p[P]?h.validateSpec({key:P,value:a[P],valueSpec:p[P],validateSpec:h.validateSpec,style:y,styleSpec:u}):[new yt(P,a[P],`unknown property "${P}"`)])}return E}function Pn(h){const a=h.value,u=h.styleSpec,p=u.sky,y=h.style,E=Lr(a);if(a===void 0)return[];if(E!=="object")return[new yt("sky",a,`object expected, ${E} found`)];let T=[];for(const P in a)T=T.concat(p[P]?h.validateSpec({key:P,value:a[P],valueSpec:p[P],style:y,styleSpec:u}):[new yt(P,a[P],`unknown property "${P}"`)]);return T}function cs(h){const a=h.value,u=h.styleSpec,p=u.terrain,y=h.style;let E=[];const T=Lr(a);if(a===void 0)return E;if(T!=="object")return E=E.concat([new yt("terrain",a,`object expected, ${T} found`)]),E;for(const P in a)E=E.concat(p[P]?h.validateSpec({key:P,value:a[P],valueSpec:p[P],validateSpec:h.validateSpec,style:y,styleSpec:u}):[new yt(P,a[P],`unknown property "${P}"`)]);return E}function xl(h){let a=[];const u=h.value,p=h.key;if(Array.isArray(u)){const y=[],E=[];for(const T in u)u[T].id&&y.includes(u[T].id)&&a.push(new yt(p,u,`all the sprites' ids must be unique, but ${u[T].id} is duplicated`)),y.push(u[T].id),u[T].url&&E.includes(u[T].url)&&a.push(new yt(p,u,`all the sprites' URLs must be unique, but ${u[T].url} is duplicated`)),E.push(u[T].url),a=a.concat(Fn({key:`${p}[${T}]`,value:u[T],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:h.validateSpec}));return a}return Cn({key:p,value:u})}function Go(h){return a=h.value,a&&a.constructor===Object?[]:[new yt(h.key,h.value,`object expected, ${Lr(h.value)} found`)];var a}const Kn={"*":()=>[],array:Ks,boolean:function(h){const a=h.value,u=h.key,p=Lr(a);return p!=="boolean"?[new yt(u,a,`boolean expected, ${p} found`)]:[]},number:ka,color:qh,constants:Qu,enum:La,filter:Oa,function:sa,layer:ec,object:Fn,source:Dr,light:Zs,sky:Pn,terrain:cs,projection:function(h){const a=h.value,u=h.styleSpec,p=u.projection,y=h.style,E=Lr(a);if(a===void 0)return[];if(E!=="object")return[new yt("projection",a,`object expected, ${E} found`)];let T=[];for(const P in a)T=T.concat(p[P]?h.validateSpec({key:P,value:a[P],valueSpec:p[P],style:y,styleSpec:u}):[new yt(P,a[P],`unknown property "${P}"`)]);return T},projectionDefinition:function(h){const a=h.key;let u=h.value;u=u instanceof String?u.valueOf():u;const p=Lr(u);return p!=="array"||(function(y){return Array.isArray(y)&&y.length===3&&typeof y[0]=="string"&&typeof y[1]=="string"&&typeof y[2]=="number"})(u)||(function(y){return!!["interpolate","step","literal"].includes(y[0])})(u)?["array","string"].includes(p)?[]:[new yt(a,u,`projection expected, invalid type "${p}" found`)]:[new yt(a,u,`projection expected, invalid array ${JSON.stringify(u)} found`)]},string:Cn,formatted:function(h){return Cn(h).length===0?[]:Ba(h)},resolvedImage:function(h){return Cn(h).length===0?[]:Ba(h)},padding:function(h){const a=h.key,u=h.value;if(Lr(u)==="array"){if(u.length<1||u.length>4)return[new yt(a,u,`padding requires 1 to 4 values; ${u.length} values found`)];const p={type:"number"};let y=[];for(let E=0;E<u.length;E++)y=y.concat(h.validateSpec({key:`${a}[${E}]`,value:u[E],validateSpec:h.validateSpec,valueSpec:p}));return y}return ka({key:a,value:u,valueSpec:{}})},numberArray:function(h){const a=h.key,u=h.value;if(Lr(u)==="array"){const p={type:"number"};if(u.length<1)return[new yt(a,u,"array length at least 1 expected, length 0 found")];let y=[];for(let E=0;E<u.length;E++)y=y.concat(h.validateSpec({key:`${a}[${E}]`,value:u[E],validateSpec:h.validateSpec,valueSpec:p}));return y}return ka({key:a,value:u,valueSpec:{}})},colorArray:function(h){const a=h.key,u=h.value;if(Lr(u)==="array"){if(u.length<1)return[new yt(a,u,"array length at least 1 expected, length 0 found")];let p=[];for(let y=0;y<u.length;y++)p=p.concat(qh({key:`${a}[${y}]`,value:u[y]}));return p}return qh({key:a,value:u})},variableAnchorOffsetCollection:function(h){const a=h.key,u=h.value,p=Lr(u),y=h.styleSpec;if(p!=="array"||u.length<1||u.length%2!=0)return[new yt(a,u,"variableAnchorOffsetCollection requires a non-empty array of even length")];let E=[];for(let T=0;T<u.length;T+=2)E=E.concat(La({key:`${a}[${T}]`,value:u[T],valueSpec:y.layout_symbol["text-anchor"]})),E=E.concat(Ks({key:`${a}[${T+1}]`,value:u[T+1],valueSpec:{length:2,value:"number"},validateSpec:h.validateSpec,style:h.style,styleSpec:y}));return E},sprite:xl,state:Go};function Da(h){const a=h.value,u=h.valueSpec,p=h.styleSpec;return h.validateSpec=Da,u.expression&&Ku(ei(a))?sa(h):u.expression&&bl(Vo(a))?Ba(h):u.type&&Kn[u.type]?Kn[u.type](h):Fn(ki({},h,{valueSpec:u.type?p[u.type]:u}))}function xf(h){const a=h.value,u=h.key,p=Cn(h);return p.length||(a.indexOf("{fontstack}")===-1&&p.push(new yt(u,a,'"glyphs" url must include a "{fontstack}" token')),a.indexOf("{range}")===-1&&p.push(new yt(u,a,'"glyphs" url must include a "{range}" token'))),p}function us(h,a=Ne){let u=[];return u=u.concat(Da({key:"",value:h,valueSpec:a.$root,styleSpec:a,style:h,validateSpec:Da,objectElementValidators:{glyphs:xf,"*":()=>[]}})),h.constants&&(u=u.concat(Qu({key:"constants",value:h.constants}))),tc(u)}function Is(h){return function(a){return h({...a,validateSpec:Da})}}function tc(h){return[].concat(h).sort(((a,u)=>a.line-u.line))}function gn(h){return function(...a){return tc(h.apply(this,a))}}us.source=gn(Is(Dr)),us.sprite=gn(Is(xl)),us.glyphs=gn(Is(xf)),us.light=gn(Is(Zs)),us.sky=gn(Is(Pn)),us.terrain=gn(Is(cs)),us.state=gn(Is(Go)),us.layer=gn(Is(ec)),us.filter=gn(Is(Oa)),us.paintProperty=gn(Is(eh)),us.layoutProperty=gn(Is(Kh));const Na=us,wf=Na.light,iu=Na.sky,Hg=Na.paintProperty,wl=Na.layoutProperty;function oa(h,a){let u=!1;if(a&&a.length)for(const p of a)h.fire(new lt(new Error(p.message))),u=!0;return u}class aa{constructor(a,u,p){const y=this.cells=[];if(a instanceof ArrayBuffer){this.arrayBuffer=a;const T=new Int32Array(this.arrayBuffer);a=T[0],this.d=(u=T[1])+2*(p=T[2]);for(let k=0;k<this.d*this.d;k++){const D=T[3+k],z=T[3+k+1];y.push(D===z?null:T.subarray(D,z))}const P=T[3+y.length+1];this.keys=T.subarray(T[3+y.length],P),this.bboxes=T.subarray(P),this.insert=this._insertReadonly}else{this.d=u+2*p;for(let T=0;T<this.d*this.d;T++)y.push([]);this.keys=[],this.bboxes=[]}this.n=u,this.extent=a,this.padding=p,this.scale=u/a,this.uid=0;const E=p/u*a;this.min=-E,this.max=a+E}insert(a,u,p,y,E){this._forEachCell(u,p,y,E,this._insertCell,this.uid++,void 0,void 0),this.keys.push(a),this.bboxes.push(u),this.bboxes.push(p),this.bboxes.push(y),this.bboxes.push(E)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(a,u,p,y,E,T){this.cells[E].push(T)}query(a,u,p,y,E){const T=this.min,P=this.max;if(a<=T&&u<=T&&P<=p&&P<=y&&!E)return Array.prototype.slice.call(this.keys);{const k=[];return this._forEachCell(a,u,p,y,this._queryCell,k,{},E),k}}_queryCell(a,u,p,y,E,T,P,k){const D=this.cells[E];if(D!==null){const z=this.keys,$=this.bboxes;for(let Y=0;Y<D.length;Y++){const Q=D[Y];if(P[Q]===void 0){const te=4*Q;(k?k($[te+0],$[te+1],$[te+2],$[te+3]):a<=$[te+2]&&u<=$[te+3]&&p>=$[te+0]&&y>=$[te+1])?(P[Q]=!0,T.push(z[Q])):P[Q]=!1}}}}_forEachCell(a,u,p,y,E,T,P,k){const D=this._convertToCellCoord(a),z=this._convertToCellCoord(u),$=this._convertToCellCoord(p),Y=this._convertToCellCoord(y);for(let Q=D;Q<=$;Q++)for(let te=z;te<=Y;te++){const oe=this.d*te+Q;if((!k||k(this._convertFromCellCoord(Q),this._convertFromCellCoord(te),this._convertFromCellCoord(Q+1),this._convertFromCellCoord(te+1)))&&E.call(this,a,u,p,y,oe,T,P,k))return}}_convertFromCellCoord(a){return(a-this.padding)/this.scale}_convertToCellCoord(a){return Math.max(0,Math.min(this.d-1,Math.floor(a*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const a=this.cells,u=3+this.cells.length+1+1;let p=0;for(let T=0;T<this.cells.length;T++)p+=this.cells[T].length;const y=new Int32Array(u+p+this.keys.length+this.bboxes.length);y[0]=this.extent,y[1]=this.n,y[2]=this.padding;let E=u;for(let T=0;T<a.length;T++){const P=a[T];y[3+T]=E,y.set(P,E),E+=P.length}return y[3+a.length]=E,y.set(this.keys,E),E+=this.keys.length,y[3+a.length+1]=E,y.set(this.bboxes,E),E+=this.bboxes.length,y.buffer}static serialize(a,u){const p=a.toArrayBuffer();return u&&u.push(p),{buffer:p}}static deserialize(a){return new aa(a.buffer)}}const ks={};function Ot(h,a,u={}){if(ks[h])throw new Error(`${h} is already registered.`);Object.defineProperty(a,"_classRegistryKey",{value:h,writeable:!1}),ks[h]={klass:a,omit:u.omit||[],shallow:u.shallow||[]}}Ot("Object",Object),Ot("Set",Set),Ot("TransferableGridIndex",aa),Ot("Color",lr),Ot("Error",Error),Ot("AJAXError",xe),Ot("ResolvedImage",$s),Ot("StylePropertyFunction",ia),Ot("StyleExpression",Yc,{omit:["_evaluator"]}),Ot("ZoomDependentExpression",Jl),Ot("ZoomConstantExpression",Yl),Ot("CompoundExpression",qs,{omit:["_evaluate"]});for(const h in _l)_l[h]._classRegistryKey||Ot(`Expression_${h}`,_l[h]);function Bs(h){return h&&typeof ArrayBuffer<"u"&&(h instanceof ArrayBuffer||h.constructor&&h.constructor.name==="ArrayBuffer")}function hs(h){return h.$name||h.constructor._classRegistryKey}function Fa(h){return!(function(a){if(a===null||typeof a!="object")return!1;const u=hs(a);return!(!u||u==="Object")})(h)&&(h==null||typeof h=="boolean"||typeof h=="number"||typeof h=="string"||h instanceof Boolean||h instanceof Number||h instanceof String||h instanceof Date||h instanceof RegExp||h instanceof Blob||h instanceof Error||Bs(h)||Ps(h)||ArrayBuffer.isView(h)||h instanceof ImageData)}function Ls(h,a){if(Fa(h))return(Bs(h)||Ps(h))&&a&&a.push(h),ArrayBuffer.isView(h)&&a&&a.push(h.buffer),h instanceof ImageData&&a&&a.push(h.data.buffer),h;if(Array.isArray(h)){const E=[];for(const T of h)E.push(Ls(T,a));return E}if(typeof h!="object")throw new Error("can't serialize object of type "+typeof h);const u=hs(h);if(!u)throw new Error(`can't serialize object of unregistered class ${h.constructor.name}`);if(!ks[u])throw new Error(`${u} is not registered.`);const{klass:p}=ks[u],y=p.serialize?p.serialize(h,a):{};if(p.serialize){if(a&&y===a[a.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const E in h){if(!h.hasOwnProperty(E)||ks[u].omit.indexOf(E)>=0)continue;const T=h[E];y[E]=ks[u].shallow.indexOf(E)>=0?T:Ls(T,a)}h instanceof Error&&(y.message=h.message)}if(y.$name)throw new Error("$name property is reserved for worker serialization logic.");return u!=="Object"&&(y.$name=u),y}function ds(h){if(Fa(h))return h;if(Array.isArray(h))return h.map(ds);if(typeof h!="object")throw new Error("can't deserialize object of type "+typeof h);const a=hs(h)||"Object";if(!ks[a])throw new Error(`can't deserialize unregistered class ${a}`);const{klass:u}=ks[a];if(!u)throw new Error(`can't deserialize unregistered class ${a}`);if(u.deserialize)return u.deserialize(h);const p=Object.create(u.prototype);for(const y of Object.keys(h)){if(y==="$name")continue;const E=h[y];p[y]=ks[a].shallow.indexOf(y)>=0?E:ds(E)}return p}class la{constructor(){this.first=!0}update(a,u){const p=Math.floor(a);return this.first?(this.first=!1,this.lastIntegerZoom=p,this.lastIntegerZoomTime=0,this.lastZoom=a,this.lastFloorZoom=p,!0):(this.lastFloorZoom>p?(this.lastIntegerZoom=p+1,this.lastIntegerZoomTime=u):this.lastFloorZoom<p&&(this.lastIntegerZoom=p,this.lastIntegerZoomTime=u),a!==this.lastZoom&&(this.lastZoom=a,this.lastFloorZoom=p,!0))}}const Or={"Latin-1 Supplement":h=>h>=128&&h<=255,"Hangul Jamo":h=>h>=4352&&h<=4607,Khmer:h=>h>=6016&&h<=6143,"General Punctuation":h=>h>=8192&&h<=8303,"Letterlike Symbols":h=>h>=8448&&h<=8527,"Number Forms":h=>h>=8528&&h<=8591,"Miscellaneous Technical":h=>h>=8960&&h<=9215,"Control Pictures":h=>h>=9216&&h<=9279,"Optical Character Recognition":h=>h>=9280&&h<=9311,"Enclosed Alphanumerics":h=>h>=9312&&h<=9471,"Geometric Shapes":h=>h>=9632&&h<=9727,"Miscellaneous Symbols":h=>h>=9728&&h<=9983,"Miscellaneous Symbols and Arrows":h=>h>=11008&&h<=11263,"Ideographic Description Characters":h=>h>=12272&&h<=12287,"CJK Symbols and Punctuation":h=>h>=12288&&h<=12351,Hiragana:h=>h>=12352&&h<=12447,Katakana:h=>h>=12448&&h<=12543,Kanbun:h=>h>=12688&&h<=12703,"CJK Strokes":h=>h>=12736&&h<=12783,"Enclosed CJK Letters and Months":h=>h>=12800&&h<=13055,"CJK Compatibility":h=>h>=13056&&h<=13311,"Yijing Hexagram Symbols":h=>h>=19904&&h<=19967,"CJK Unified Ideographs":h=>h>=19968&&h<=40959,"Hangul Syllables":h=>h>=44032&&h<=55215,"Private Use Area":h=>h>=57344&&h<=63743,"Vertical Forms":h=>h>=65040&&h<=65055,"CJK Compatibility Forms":h=>h>=65072&&h<=65103,"Small Form Variants":h=>h>=65104&&h<=65135,"Halfwidth and Fullwidth Forms":h=>h>=65280&&h<=65519};function nu(h){for(const a of h)if(Zh(a.charCodeAt(0)))return!0;return!1}function Ef(h){for(const a of h)if(!Ei(a.charCodeAt(0)))return!1;return!0}function Zn(h){const a=h.map((u=>{try{return new RegExp(`\\p{sc=${u}}`,"u").source}catch{return null}})).filter((u=>u));return new RegExp(a.join("|"),"u")}const Xs=Zn(["Arab","Dupl","Mong","Ougr","Syrc"]);function Ei(h){return!Xs.test(String.fromCodePoint(h))}const Ys=Zn(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function Zh(h){return!(h!==746&&h!==747&&(h<4352||!(Or["CJK Compatibility Forms"](h)&&!(h>=65097&&h<=65103)||Or["CJK Compatibility"](h)||Or["CJK Strokes"](h)||!(!Or["CJK Symbols and Punctuation"](h)||h>=12296&&h<=12305||h>=12308&&h<=12319||h===12336)||Or["Enclosed CJK Letters and Months"](h)||Or["Ideographic Description Characters"](h)||Or.Kanbun(h)||Or.Katakana(h)&&h!==12540||!(!Or["Halfwidth and Fullwidth Forms"](h)||h===65288||h===65289||h===65293||h>=65306&&h<=65310||h===65339||h===65341||h===65343||h>=65371&&h<=65503||h===65507||h>=65512&&h<=65519)||!(!Or["Small Form Variants"](h)||h>=65112&&h<=65118||h>=65123&&h<=65126)||Or["Vertical Forms"](h)||Or["Yijing Hexagram Symbols"](h)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(h))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(h))||Ys.test(String.fromCodePoint(h)))))}function Af(h){return!(Zh(h)||(function(a){return!!(Or["Latin-1 Supplement"](a)&&(a===167||a===169||a===174||a===177||a===188||a===189||a===190||a===215||a===247)||Or["General Punctuation"](a)&&(a===8214||a===8224||a===8225||a===8240||a===8241||a===8251||a===8252||a===8258||a===8263||a===8264||a===8265||a===8273)||Or["Letterlike Symbols"](a)||Or["Number Forms"](a)||Or["Miscellaneous Technical"](a)&&(a>=8960&&a<=8967||a>=8972&&a<=8991||a>=8996&&a<=9e3||a===9003||a>=9085&&a<=9114||a>=9150&&a<=9165||a===9167||a>=9169&&a<=9179||a>=9186&&a<=9215)||Or["Control Pictures"](a)&&a!==9251||Or["Optical Character Recognition"](a)||Or["Enclosed Alphanumerics"](a)||Or["Geometric Shapes"](a)||Or["Miscellaneous Symbols"](a)&&!(a>=9754&&a<=9759)||Or["Miscellaneous Symbols and Arrows"](a)&&(a>=11026&&a<=11055||a>=11088&&a<=11097||a>=11192&&a<=11243)||Or["CJK Symbols and Punctuation"](a)||Or.Katakana(a)||Or["Private Use Area"](a)||Or["CJK Compatibility Forms"](a)||Or["Small Form Variants"](a)||Or["Halfwidth and Fullwidth Forms"](a)||a===8734||a===8756||a===8757||a>=9984&&a<=10087||a>=10102&&a<=10131||a===65532||a===65533)})(h))}const Xh=Zn(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function th(h){return Xh.test(String.fromCodePoint(h))}function Tf(h,a){return!(!a&&th(h)||h>=2304&&h<=3583||h>=3840&&h<=4255||Or.Khmer(h))}function rh(h){for(const a of h)if(th(a.charCodeAt(0)))return!0;return!1}const po=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(h){this.pluginStatus=h.pluginStatus,this.pluginURL=h.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(h){if(po.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=h.applyArabicShaping,this.processBidirectionalText=h.processBidirectionalText,this.processStyledBidirectionalText=h.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getRTLTextPluginStatus(){return this.pluginStatus}syncState(h,a){return o(this,void 0,void 0,(function*(){if(this.isParsed())return this.getState();if(h.pluginStatus!=="loading")return this.setState(h),h;const u=h.pluginURL,p=new Promise((E=>{this.loadScriptResolve=E}));a(u);const y=new Promise((E=>setTimeout((()=>E()),this.TIMEOUT)));if(yield Promise.race([p,y]),this.isParsed()){const E={pluginStatus:"loaded",pluginURL:u};return this.setState(E),E}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${u}`)}))}};class ri{constructor(a,u){this.zoom=a,u?(this.now=u.now||0,this.fadeDuration=u.fadeDuration||0,this.zoomHistory=u.zoomHistory||new la,this.transition=u.transition||{},this.globalState=u.globalState||{}):(this.now=0,this.fadeDuration=0,this.zoomHistory=new la,this.transition={},this.globalState={})}isSupportedScript(a){return(function(u,p){for(const y of u)if(!Tf(y.charCodeAt(0),p))return!1;return!0})(a,po.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const a=this.zoom,u=a-Math.floor(a),p=this.crossFadingFactor();return a>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:u+(1-u)*p}:{fromScale:.5,toScale:1,t:1-(1-p)*u}}}class El{constructor(a,u){this.property=a,this.value=u,this.expression=(function(p,y){if(Ku(p))return new ia(p,y);if(bl(p)){const E=Zu(p,y);if(E.result==="error")throw new Error(E.value.map((T=>`${T.key}: ${T.message}`)).join(", "));return E.value}{let E=p;return y.type==="color"&&typeof p=="string"?E=lr.parse(p):y.type!=="padding"||typeof p!="number"&&!Array.isArray(p)?y.type!=="numberArray"||typeof p!="number"&&!Array.isArray(p)?y.type!=="colorArray"||typeof p!="string"&&!Array.isArray(p)?y.type==="variableAnchorOffsetCollection"&&Array.isArray(p)?E=pn.parse(p):y.type==="projectionDefinition"&&typeof p=="string"&&(E=Nn.parse(p)):E=pi.parse(p):E=fn.parse(p):E=Hi.parse(p),{globalStateRefs:new Set,kind:"constant",evaluate:()=>E}}})(u===void 0?a.specification.default:u,a.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}getGlobalStateRefs(){return this.expression.globalStateRefs||new Set}possiblyEvaluate(a,u,p){return this.property.possiblyEvaluate(this,a,u,p)}}class Sf{constructor(a){this.property=a,this.value=new El(a,void 0)}transitioned(a,u){return new ou(this.property,this.value,u,pr({},a.transition,this.transition),a.now)}untransitioned(){return new ou(this.property,this.value,null,{},0)}}class su{constructor(a){this._properties=a,this._values=Object.create(a.defaultTransitionablePropertyValues)}getValue(a){return wi(this._values[a].value.value)}setValue(a,u){Object.prototype.hasOwnProperty.call(this._values,a)||(this._values[a]=new Sf(this._values[a].property)),this._values[a].value=new El(this._values[a].property,u===null?void 0:wi(u))}getTransition(a){return wi(this._values[a].transition)}setTransition(a,u){Object.prototype.hasOwnProperty.call(this._values,a)||(this._values[a]=new Sf(this._values[a].property)),this._values[a].transition=wi(u)||void 0}serialize(){const a={};for(const u of Object.keys(this._values)){const p=this.getValue(u);p!==void 0&&(a[u]=p);const y=this.getTransition(u);y!==void 0&&(a[`${u}-transition`]=y)}return a}transitioned(a,u){const p=new Yh(this._properties);for(const y of Object.keys(this._values))p._values[y]=this._values[y].transitioned(a,u._values[y]);return p}untransitioned(){const a=new Yh(this._properties);for(const u of Object.keys(this._values))a._values[u]=this._values[u].untransitioned();return a}}class ou{constructor(a,u,p,y,E){this.property=a,this.value=u,this.begin=E+y.delay||0,this.end=this.begin+y.duration||0,a.specification.transition&&(y.delay||y.duration)&&(this.prior=p)}possiblyEvaluate(a,u,p){const y=a.now||0,E=this.value.possiblyEvaluate(a,u,p),T=this.prior;if(T){if(y>this.end)return this.prior=null,E;if(this.value.isDataDriven())return this.prior=null,E;if(y<this.begin)return T.possiblyEvaluate(a,u,p);{const P=(y-this.begin)/(this.end-this.begin);return this.property.interpolate(T.possiblyEvaluate(a,u,p),E,Ht(P))}}return E}}class Yh{constructor(a){this._properties=a,this._values=Object.create(a.defaultTransitioningPropertyValues)}possiblyEvaluate(a,u,p){const y=new ih(this._properties);for(const E of Object.keys(this._values))y._values[E]=this._values[E].possiblyEvaluate(a,u,p);return y}hasTransition(){for(const a of Object.keys(this._values))if(this._values[a].prior)return!0;return!1}}class Cf{constructor(a){this._properties=a,this._values=Object.create(a.defaultPropertyValues)}hasValue(a){return this._values[a].value!==void 0}getValue(a){return wi(this._values[a].value)}setValue(a,u){this._values[a]=new El(this._values[a].property,u===null?void 0:wi(u))}serialize(){const a={};for(const u of Object.keys(this._values)){const p=this.getValue(u);p!==void 0&&(a[u]=p)}return a}possiblyEvaluate(a,u,p){const y=new ih(this._properties);for(const E of Object.keys(this._values))y._values[E]=this._values[E].possiblyEvaluate(a,u,p);return y}}class fs{constructor(a,u,p){this.property=a,this.value=u,this.parameters=p}isConstant(){return this.value.kind==="constant"}constantOr(a){return this.value.kind==="constant"?this.value.value:a}evaluate(a,u,p,y){return this.property.evaluate(this.value,this.parameters,a,u,p,y)}}class ih{constructor(a){this._properties=a,this._values=Object.create(a.defaultPossiblyEvaluatedValues)}get(a){return this._values[a]}}class zt{constructor(a){this.specification=a}possiblyEvaluate(a,u){if(a.isDataDriven())throw new Error("Value should not be data driven");return a.expression.evaluate(u)}interpolate(a,u,p){const y=Fo[this.specification.type];return y?y(a,u,p):a}}class er{constructor(a,u){this.specification=a,this.overrides=u}possiblyEvaluate(a,u,p,y){return new fs(this,a.expression.kind==="constant"||a.expression.kind==="camera"?{kind:"constant",value:a.expression.evaluate(u,null,{},p,y)}:a.expression,u)}interpolate(a,u,p){if(a.value.kind!=="constant"||u.value.kind!=="constant")return a;if(a.value.value===void 0||u.value.value===void 0)return new fs(this,{kind:"constant",value:void 0},a.parameters);const y=Fo[this.specification.type];if(y){const E=y(a.value.value,u.value.value,p);return new fs(this,{kind:"constant",value:E},a.parameters)}return a}evaluate(a,u,p,y,E,T){return a.kind==="constant"?a.value:a.evaluate(u,p,y,E,T)}}class za extends er{possiblyEvaluate(a,u,p,y){if(a.value===void 0)return new fs(this,{kind:"constant",value:void 0},u);if(a.expression.kind==="constant"){const E=a.expression.evaluate(u,null,{},p,y),T=a.property.specification.type==="resolvedImage"&&typeof E!="string"?E.name:E,P=this._calculate(T,T,T,u);return new fs(this,{kind:"constant",value:P},u)}if(a.expression.kind==="camera"){const E=this._calculate(a.expression.evaluate({zoom:u.zoom-1}),a.expression.evaluate({zoom:u.zoom}),a.expression.evaluate({zoom:u.zoom+1}),u);return new fs(this,{kind:"constant",value:E},u)}return new fs(this,a.expression,u)}evaluate(a,u,p,y,E,T){if(a.kind==="source"){const P=a.evaluate(u,p,y,E,T);return this._calculate(P,P,P,u)}return a.kind==="composite"?this._calculate(a.evaluate({zoom:Math.floor(u.zoom)-1},p,y),a.evaluate({zoom:Math.floor(u.zoom)},p,y),a.evaluate({zoom:Math.floor(u.zoom)+1},p,y),u):a.value}_calculate(a,u,p,y){return y.zoom>y.zoomHistory.lastIntegerZoom?{from:a,to:u}:{from:p,to:u}}interpolate(a){return a}}class ca{constructor(a){this.specification=a}possiblyEvaluate(a,u,p,y){if(a.value!==void 0){if(a.expression.kind==="constant"){const E=a.expression.evaluate(u,null,{},p,y);return this._calculate(E,E,E,u)}return this._calculate(a.expression.evaluate(new ri(Math.floor(u.zoom-1),u)),a.expression.evaluate(new ri(Math.floor(u.zoom),u)),a.expression.evaluate(new ri(Math.floor(u.zoom+1),u)),u)}}_calculate(a,u,p,y){return y.zoom>y.zoomHistory.lastIntegerZoom?{from:a,to:u}:{from:p,to:u}}interpolate(a){return a}}class au{constructor(a){this.specification=a}possiblyEvaluate(a,u,p,y){return!!a.expression.evaluate(u,null,{},p,y)}interpolate(){return!1}}class zn{constructor(a){this.properties=a,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const u in a){const p=a[u];p.specification.overridable&&this.overridableProperties.push(u);const y=this.defaultPropertyValues[u]=new El(p,void 0),E=this.defaultTransitionablePropertyValues[u]=new Sf(p);this.defaultTransitioningPropertyValues[u]=E.untransitioned(),this.defaultPossiblyEvaluatedValues[u]=y.possiblyEvaluate({})}}}Ot("DataDrivenProperty",er),Ot("DataConstantProperty",zt),Ot("CrossFadedDataDrivenProperty",za),Ot("CrossFadedProperty",ca),Ot("ColorRampProperty",au);const Jh="-transition";class jn extends Dt{constructor(a,u){if(super(),this.id=a.id,this.type=a.type,this._featureFilter={filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set},a.type!=="custom"&&(this.metadata=a.metadata,this.minzoom=a.minzoom,this.maxzoom=a.maxzoom,a.type!=="background"&&(this.source=a.source,this.sourceLayer=a["source-layer"],this.filter=a.filter,this._featureFilter=na(a.filter)),u.layout&&(this._unevaluatedLayout=new Cf(u.layout)),u.paint)){this._transitionablePaint=new su(u.paint);for(const p in a.paint)this.setPaintProperty(p,a.paint[p],{validate:!1});for(const p in a.layout)this.setLayoutProperty(p,a.layout[p],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new ih(u.paint)}}setFilter(a){this.filter=a,this._featureFilter=na(a)}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(a){return a==="visibility"?this.visibility:this._unevaluatedLayout.getValue(a)}getLayoutAffectingGlobalStateRefs(){const a=new Set;if(this._unevaluatedLayout)for(const u in this._unevaluatedLayout._values){const p=this._unevaluatedLayout._values[u];for(const y of p.getGlobalStateRefs())a.add(y)}for(const u of this._featureFilter.getGlobalStateRefs())a.add(u);return a}setLayoutProperty(a,u,p={}){u!=null&&this._validate(wl,`layers.${this.id}.layout.${a}`,a,u,p)||(a!=="visibility"?this._unevaluatedLayout.setValue(a,u):this.visibility=u)}getPaintProperty(a){return a.endsWith(Jh)?this._transitionablePaint.getTransition(a.slice(0,-11)):this._transitionablePaint.getValue(a)}setPaintProperty(a,u,p={}){if(u!=null&&this._validate(Hg,`layers.${this.id}.paint.${a}`,a,u,p))return!1;if(a.endsWith(Jh))return this._transitionablePaint.setTransition(a.slice(0,-11),u||void 0),!1;{const y=this._transitionablePaint._values[a],E=y.property.specification["property-type"]==="cross-faded-data-driven",T=y.value.isDataDriven(),P=y.value;this._transitionablePaint.setValue(a,u),this._handleSpecialPaintPropertyUpdate(a);const k=this._transitionablePaint._values[a].value;return k.isDataDriven()||T||E||this._handleOverridablePaintPropertyUpdate(a,P,k)}}_handleSpecialPaintPropertyUpdate(a){}_handleOverridablePaintPropertyUpdate(a,u,p){return!1}isHidden(a){return!!(this.minzoom&&a<this.minzoom)||!!(this.maxzoom&&a>=this.maxzoom)||this.visibility==="none"}updateTransitions(a){this._transitioningPaint=this._transitionablePaint.transitioned(a,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(a,u){a.getCrossfadeParameters&&(this._crossfadeParameters=a.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(a,void 0,u)),this.paint=this._transitioningPaint.possiblyEvaluate(a,void 0,u)}serialize(){const a={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(a.layout=a.layout||{},a.layout.visibility=this.visibility),An(a,((u,p)=>!(u===void 0||p==="layout"&&!Object.keys(u).length||p==="paint"&&!Object.keys(u).length)))}_validate(a,u,p,y,E={}){return(!E||E.validate!==!1)&&oa(this,a.call(Na,{key:u,layerType:this.type,objectKey:p,value:y,styleSpec:Ne,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const a in this.paint._values){const u=this.paint.get(a);if(u instanceof fs&&Ra(u.property.specification)&&(u.value.kind==="source"||u.value.kind==="composite")&&u.value.isStateDependent)return!0}return!1}}const mo={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Ho{constructor(a,u){this._structArray=a,this._pos1=u*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Yr{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(a,u){return a._trim(),u&&(a.isTransferred=!0,u.push(a.arrayBuffer)),{length:a.length,arrayBuffer:a.arrayBuffer}}static deserialize(a){const u=Object.create(this.prototype);return u.arrayBuffer=a.arrayBuffer,u.length=a.length,u.capacity=a.arrayBuffer.byteLength/u.bytesPerElement,u._refreshViews(),u}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(a){this.reserve(a),this.length=a}reserve(a){if(a>this.capacity){this.capacity=Math.max(a,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const u=this.uint8;this._refreshViews(),u&&this.uint8.set(u)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Li(h,a=1){let u=0,p=0;return{members:h.map((y=>{const E=mo[y.type].BYTES_PER_ELEMENT,T=u=go(u,Math.max(a,E)),P=y.components||1;return p=Math.max(p,E),u+=E*P,{name:y.name,type:y.type,components:P,offset:T}})),size:go(u,Math.max(p,a)),alignment:a}}function go(h,a){return Math.ceil(h/a)*a}class Js extends Yr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,u){const p=this.length;return this.resize(p+1),this.emplace(p,a,u)}emplace(a,u,p){const y=2*a;return this.int16[y+0]=u,this.int16[y+1]=p,a}}Js.prototype.bytesPerElement=4,Ot("StructArrayLayout2i4",Js);class Al extends Yr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,u,p){const y=this.length;return this.resize(y+1),this.emplace(y,a,u,p)}emplace(a,u,p,y){const E=3*a;return this.int16[E+0]=u,this.int16[E+1]=p,this.int16[E+2]=y,a}}Al.prototype.bytesPerElement=6,Ot("StructArrayLayout3i6",Al);class Qh extends Yr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,u,p,y){const E=this.length;return this.resize(E+1),this.emplace(E,a,u,p,y)}emplace(a,u,p,y,E){const T=4*a;return this.int16[T+0]=u,this.int16[T+1]=p,this.int16[T+2]=y,this.int16[T+3]=E,a}}Qh.prototype.bytesPerElement=8,Ot("StructArrayLayout4i8",Qh);class Os extends Yr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,u,p,y,E,T){const P=this.length;return this.resize(P+1),this.emplace(P,a,u,p,y,E,T)}emplace(a,u,p,y,E,T,P){const k=6*a;return this.int16[k+0]=u,this.int16[k+1]=p,this.int16[k+2]=y,this.int16[k+3]=E,this.int16[k+4]=T,this.int16[k+5]=P,a}}Os.prototype.bytesPerElement=12,Ot("StructArrayLayout2i4i12",Os);class Ds extends Yr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,u,p,y,E,T){const P=this.length;return this.resize(P+1),this.emplace(P,a,u,p,y,E,T)}emplace(a,u,p,y,E,T,P){const k=4*a,D=8*a;return this.int16[k+0]=u,this.int16[k+1]=p,this.uint8[D+4]=y,this.uint8[D+5]=E,this.uint8[D+6]=T,this.uint8[D+7]=P,a}}Ds.prototype.bytesPerElement=8,Ot("StructArrayLayout2i4ub8",Ds);class Tl extends Yr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,u){const p=this.length;return this.resize(p+1),this.emplace(p,a,u)}emplace(a,u,p){const y=2*a;return this.float32[y+0]=u,this.float32[y+1]=p,a}}Tl.prototype.bytesPerElement=8,Ot("StructArrayLayout2f8",Tl);class nh extends Yr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,u,p,y,E,T,P,k,D,z){const $=this.length;return this.resize($+1),this.emplace($,a,u,p,y,E,T,P,k,D,z)}emplace(a,u,p,y,E,T,P,k,D,z,$){const Y=10*a;return this.uint16[Y+0]=u,this.uint16[Y+1]=p,this.uint16[Y+2]=y,this.uint16[Y+3]=E,this.uint16[Y+4]=T,this.uint16[Y+5]=P,this.uint16[Y+6]=k,this.uint16[Y+7]=D,this.uint16[Y+8]=z,this.uint16[Y+9]=$,a}}nh.prototype.bytesPerElement=20,Ot("StructArrayLayout10ui20",nh);class ua extends Yr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,u,p,y,E,T,P,k,D,z,$,Y){const Q=this.length;return this.resize(Q+1),this.emplace(Q,a,u,p,y,E,T,P,k,D,z,$,Y)}emplace(a,u,p,y,E,T,P,k,D,z,$,Y,Q){const te=12*a;return this.int16[te+0]=u,this.int16[te+1]=p,this.int16[te+2]=y,this.int16[te+3]=E,this.uint16[te+4]=T,this.uint16[te+5]=P,this.uint16[te+6]=k,this.uint16[te+7]=D,this.int16[te+8]=z,this.int16[te+9]=$,this.int16[te+10]=Y,this.int16[te+11]=Q,a}}ua.prototype.bytesPerElement=24,Ot("StructArrayLayout4i4ui4i24",ua);class ed extends Yr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,u,p){const y=this.length;return this.resize(y+1),this.emplace(y,a,u,p)}emplace(a,u,p,y){const E=3*a;return this.float32[E+0]=u,this.float32[E+1]=p,this.float32[E+2]=y,a}}ed.prototype.bytesPerElement=12,Ot("StructArrayLayout3f12",ed);class rc extends Yr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(a){const u=this.length;return this.resize(u+1),this.emplace(u,a)}emplace(a,u){return this.uint32[1*a+0]=u,a}}rc.prototype.bytesPerElement=4,Ot("StructArrayLayout1ul4",rc);class Qs extends Yr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,u,p,y,E,T,P,k,D){const z=this.length;return this.resize(z+1),this.emplace(z,a,u,p,y,E,T,P,k,D)}emplace(a,u,p,y,E,T,P,k,D,z){const $=10*a,Y=5*a;return this.int16[$+0]=u,this.int16[$+1]=p,this.int16[$+2]=y,this.int16[$+3]=E,this.int16[$+4]=T,this.int16[$+5]=P,this.uint32[Y+3]=k,this.uint16[$+8]=D,this.uint16[$+9]=z,a}}Qs.prototype.bytesPerElement=20,Ot("StructArrayLayout6i1ul2ui20",Qs);class ic extends Yr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,u,p,y,E,T){const P=this.length;return this.resize(P+1),this.emplace(P,a,u,p,y,E,T)}emplace(a,u,p,y,E,T,P){const k=6*a;return this.int16[k+0]=u,this.int16[k+1]=p,this.int16[k+2]=y,this.int16[k+3]=E,this.int16[k+4]=T,this.int16[k+5]=P,a}}ic.prototype.bytesPerElement=12,Ot("StructArrayLayout2i2i2i12",ic);class x extends Yr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,u,p,y,E){const T=this.length;return this.resize(T+1),this.emplace(T,a,u,p,y,E)}emplace(a,u,p,y,E,T){const P=4*a,k=8*a;return this.float32[P+0]=u,this.float32[P+1]=p,this.float32[P+2]=y,this.int16[k+6]=E,this.int16[k+7]=T,a}}x.prototype.bytesPerElement=16,Ot("StructArrayLayout2f1f2i16",x);class s extends Yr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,u,p,y,E,T){const P=this.length;return this.resize(P+1),this.emplace(P,a,u,p,y,E,T)}emplace(a,u,p,y,E,T,P){const k=16*a,D=4*a,z=8*a;return this.uint8[k+0]=u,this.uint8[k+1]=p,this.float32[D+1]=y,this.float32[D+2]=E,this.int16[z+6]=T,this.int16[z+7]=P,a}}s.prototype.bytesPerElement=16,Ot("StructArrayLayout2ub2f2i16",s);class d extends Yr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,u,p){const y=this.length;return this.resize(y+1),this.emplace(y,a,u,p)}emplace(a,u,p,y){const E=3*a;return this.uint16[E+0]=u,this.uint16[E+1]=p,this.uint16[E+2]=y,a}}d.prototype.bytesPerElement=6,Ot("StructArrayLayout3ui6",d);class g extends Yr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,u,p,y,E,T,P,k,D,z,$,Y,Q,te,oe,de,ve){const Fe=this.length;return this.resize(Fe+1),this.emplace(Fe,a,u,p,y,E,T,P,k,D,z,$,Y,Q,te,oe,de,ve)}emplace(a,u,p,y,E,T,P,k,D,z,$,Y,Q,te,oe,de,ve,Fe){const Ee=24*a,Re=12*a,Je=48*a;return this.int16[Ee+0]=u,this.int16[Ee+1]=p,this.uint16[Ee+2]=y,this.uint16[Ee+3]=E,this.uint32[Re+2]=T,this.uint32[Re+3]=P,this.uint32[Re+4]=k,this.uint16[Ee+10]=D,this.uint16[Ee+11]=z,this.uint16[Ee+12]=$,this.float32[Re+7]=Y,this.float32[Re+8]=Q,this.uint8[Je+36]=te,this.uint8[Je+37]=oe,this.uint8[Je+38]=de,this.uint32[Re+10]=ve,this.int16[Ee+22]=Fe,a}}g.prototype.bytesPerElement=48,Ot("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",g);class v extends Yr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,u,p,y,E,T,P,k,D,z,$,Y,Q,te,oe,de,ve,Fe,Ee,Re,Je,st,pt,kt,Et,Mt,Yt,Ct){const It=this.length;return this.resize(It+1),this.emplace(It,a,u,p,y,E,T,P,k,D,z,$,Y,Q,te,oe,de,ve,Fe,Ee,Re,Je,st,pt,kt,Et,Mt,Yt,Ct)}emplace(a,u,p,y,E,T,P,k,D,z,$,Y,Q,te,oe,de,ve,Fe,Ee,Re,Je,st,pt,kt,Et,Mt,Yt,Ct,It){const ct=32*a,dr=16*a;return this.int16[ct+0]=u,this.int16[ct+1]=p,this.int16[ct+2]=y,this.int16[ct+3]=E,this.int16[ct+4]=T,this.int16[ct+5]=P,this.int16[ct+6]=k,this.int16[ct+7]=D,this.uint16[ct+8]=z,this.uint16[ct+9]=$,this.uint16[ct+10]=Y,this.uint16[ct+11]=Q,this.uint16[ct+12]=te,this.uint16[ct+13]=oe,this.uint16[ct+14]=de,this.uint16[ct+15]=ve,this.uint16[ct+16]=Fe,this.uint16[ct+17]=Ee,this.uint16[ct+18]=Re,this.uint16[ct+19]=Je,this.uint16[ct+20]=st,this.uint16[ct+21]=pt,this.uint16[ct+22]=kt,this.uint32[dr+12]=Et,this.float32[dr+13]=Mt,this.float32[dr+14]=Yt,this.uint16[ct+30]=Ct,this.uint16[ct+31]=It,a}}v.prototype.bytesPerElement=64,Ot("StructArrayLayout8i15ui1ul2f2ui64",v);class w extends Yr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a){const u=this.length;return this.resize(u+1),this.emplace(u,a)}emplace(a,u){return this.float32[1*a+0]=u,a}}w.prototype.bytesPerElement=4,Ot("StructArrayLayout1f4",w);class C extends Yr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,u,p){const y=this.length;return this.resize(y+1),this.emplace(y,a,u,p)}emplace(a,u,p,y){const E=3*a;return this.uint16[6*a+0]=u,this.float32[E+1]=p,this.float32[E+2]=y,a}}C.prototype.bytesPerElement=12,Ot("StructArrayLayout1ui2f12",C);class B extends Yr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,u,p){const y=this.length;return this.resize(y+1),this.emplace(y,a,u,p)}emplace(a,u,p,y){const E=4*a;return this.uint32[2*a+0]=u,this.uint16[E+2]=p,this.uint16[E+3]=y,a}}B.prototype.bytesPerElement=8,Ot("StructArrayLayout1ul2ui8",B);class O extends Yr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,u){const p=this.length;return this.resize(p+1),this.emplace(p,a,u)}emplace(a,u,p){const y=2*a;return this.uint16[y+0]=u,this.uint16[y+1]=p,a}}O.prototype.bytesPerElement=4,Ot("StructArrayLayout2ui4",O);class F extends Yr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a){const u=this.length;return this.resize(u+1),this.emplace(u,a)}emplace(a,u){return this.uint16[1*a+0]=u,a}}F.prototype.bytesPerElement=2,Ot("StructArrayLayout1ui2",F);class U extends Yr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,u,p,y){const E=this.length;return this.resize(E+1),this.emplace(E,a,u,p,y)}emplace(a,u,p,y,E){const T=4*a;return this.float32[T+0]=u,this.float32[T+1]=p,this.float32[T+2]=y,this.float32[T+3]=E,a}}U.prototype.bytesPerElement=16,Ot("StructArrayLayout4f16",U);class K extends Ho{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new m(this.anchorPointX,this.anchorPointY)}}K.prototype.size=20;class W extends Qs{get(a){return new K(this,a)}}Ot("CollisionBoxArray",W);class X extends Ho{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(a){this._structArray.uint8[this._pos1+37]=a}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(a){this._structArray.uint8[this._pos1+38]=a}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(a){this._structArray.uint32[this._pos4+10]=a}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}X.prototype.size=48;class re extends g{get(a){return new X(this,a)}}Ot("PlacedSymbolArray",re);class ue extends Ho{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(a){this._structArray.uint32[this._pos4+12]=a}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}ue.prototype.size=64;class fe extends v{get(a){return new ue(this,a)}}Ot("SymbolInstanceArray",fe);class pe extends w{getoffsetX(a){return this.float32[1*a+0]}}Ot("GlyphOffsetArray",pe);class _e extends Al{getx(a){return this.int16[3*a+0]}gety(a){return this.int16[3*a+1]}gettileUnitDistanceFromAnchor(a){return this.int16[3*a+2]}}Ot("SymbolLineVertexArray",_e);class we extends Ho{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}we.prototype.size=12;class ye extends C{get(a){return new we(this,a)}}Ot("TextAnchorOffsetArray",ye);class Te extends Ho{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}Te.prototype.size=8;class Ie extends B{get(a){return new Te(this,a)}}Ot("FeatureIndexArray",Ie);class be extends Js{}class ke extends Js{}class Xe extends Js{}class qe extends Os{}class Ze extends Ds{}class tt extends Tl{}class bt extends nh{}class wt extends ua{}class ut extends ed{}class jt extends rc{}class Sr extends ic{}class Gr extends s{}class ii extends d{}class Jr extends O{}const ui=Li([{name:"a_pos",components:2,type:"Int16"}],4),{members:Si}=ui;class br{constructor(a=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=a}prepareSegment(a,u,p,y){const E=this.segments[this.segments.length-1];return a>br.MAX_VERTEX_ARRAY_LENGTH&&si(`Max vertices per segment is ${br.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${a}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${br.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!E||E.vertexLength+a>br.MAX_VERTEX_ARRAY_LENGTH||E.sortKey!==y?this.createNewSegment(u,p,y):E}createNewSegment(a,u,p){const y={vertexOffset:a.length,primitiveOffset:u.length,vertexLength:0,primitiveLength:0,vaos:{}};return p!==void 0&&(y.sortKey=p),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(y),y}getOrCreateLatestSegment(a,u,p){return this.prepareSegment(0,a,u,p)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(const a of this.segments)for(const u in a.vaos)a.vaos[u].destroy()}static simpleSegment(a,u,p,y){return new br([{vertexOffset:a,primitiveOffset:u,vertexLength:p,primitiveLength:y,vaos:{},sortKey:0}])}}function qr(h,a){return 256*(h=yr(Math.floor(h),0,255))+yr(Math.floor(a),0,255)}br.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Ot("SegmentVector",br);const Ji=Li([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var on,_n,ps,_o={exports:{}},ja={exports:{}},ha={exports:{}},nc=(function(){if(ps)return _o.exports;ps=1;var h=(on||(on=1,ja.exports=function(u,p){var y,E,T,P,k,D,z,$;for(E=u.length-(y=3&u.length),T=p,k=3432918353,D=461845907,$=0;$<E;)z=255&u.charCodeAt($)|(255&u.charCodeAt(++$))<<8|(255&u.charCodeAt(++$))<<16|(255&u.charCodeAt(++$))<<24,++$,T=27492+(65535&(P=5*(65535&(T=(T^=z=(65535&(z=(z=(65535&z)*k+(((z>>>16)*k&65535)<<16)&4294967295)<<15|z>>>17))*D+(((z>>>16)*D&65535)<<16)&4294967295)<<13|T>>>19))+((5*(T>>>16)&65535)<<16)&4294967295))+((58964+(P>>>16)&65535)<<16);switch(z=0,y){case 3:z^=(255&u.charCodeAt($+2))<<16;case 2:z^=(255&u.charCodeAt($+1))<<8;case 1:T^=z=(65535&(z=(z=(65535&(z^=255&u.charCodeAt($)))*k+(((z>>>16)*k&65535)<<16)&4294967295)<<15|z>>>17))*D+(((z>>>16)*D&65535)<<16)&4294967295}return T^=u.length,T=2246822507*(65535&(T^=T>>>16))+((2246822507*(T>>>16)&65535)<<16)&4294967295,T=3266489909*(65535&(T^=T>>>13))+((3266489909*(T>>>16)&65535)<<16)&4294967295,(T^=T>>>16)>>>0}),ja.exports),a=(_n||(_n=1,ha.exports=function(u,p){for(var y,E=u.length,T=p^E,P=0;E>=4;)y=1540483477*(65535&(y=255&u.charCodeAt(P)|(255&u.charCodeAt(++P))<<8|(255&u.charCodeAt(++P))<<16|(255&u.charCodeAt(++P))<<24))+((1540483477*(y>>>16)&65535)<<16),T=1540483477*(65535&T)+((1540483477*(T>>>16)&65535)<<16)^(y=1540483477*(65535&(y^=y>>>24))+((1540483477*(y>>>16)&65535)<<16)),E-=4,++P;switch(E){case 3:T^=(255&u.charCodeAt(P+2))<<16;case 2:T^=(255&u.charCodeAt(P+1))<<8;case 1:T=1540483477*(65535&(T^=255&u.charCodeAt(P)))+((1540483477*(T>>>16)&65535)<<16)}return T=1540483477*(65535&(T^=T>>>13))+((1540483477*(T>>>16)&65535)<<16),(T^=T>>>15)>>>0}),ha.exports);return _o.exports=h,_o.exports.murmur3=h,_o.exports.murmur2=a,_o.exports})(),sc=b(nc);class Sl{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(a,u,p,y){this.ids.push(oc(a)),this.positions.push(u,p,y)}getPositions(a){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const u=oc(a);let p=0,y=this.ids.length-1;for(;p<y;){const T=p+y>>1;this.ids[T]>=u?y=T:p=T+1}const E=[];for(;this.ids[p]===u;)E.push({index:this.positions[3*p],start:this.positions[3*p+1],end:this.positions[3*p+2]}),p++;return E}static serialize(a,u){const p=new Float64Array(a.ids),y=new Uint32Array(a.positions);return ms(p,y,0,p.length-1),u&&u.push(p.buffer,y.buffer),{ids:p,positions:y}}static deserialize(a){const u=new Sl;return u.ids=a.ids,u.positions=a.positions,u.indexed=!0,u}}function oc(h){const a=+h;return!isNaN(a)&&a<=Number.MAX_SAFE_INTEGER?a:sc(String(h))}function ms(h,a,u,p){for(;u<p;){const y=h[u+p>>1];let E=u-1,T=p+1;for(;;){do E++;while(h[E]<y);do T--;while(h[T]>y);if(E>=T)break;$o(h,E,T),$o(a,3*E,3*T),$o(a,3*E+1,3*T+1),$o(a,3*E+2,3*T+2)}T-u<p-T?(ms(h,a,u,T),u=T+1):(ms(h,a,T+1,p),p=T)}}function $o(h,a,u){const p=h[a];h[a]=h[u],h[u]=p}Ot("FeaturePositionMap",Sl);class gs{constructor(a,u){this.gl=a.gl,this.location=u}}class Ua extends gs{constructor(a,u){super(a,u),this.current=0}set(a){this.current!==a&&(this.current=a,this.gl.uniform1f(this.location,a))}}class Qi extends gs{constructor(a,u){super(a,u),this.current=[0,0,0,0]}set(a){a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]&&a[3]===this.current[3]||(this.current=a,this.gl.uniform4f(this.location,a[0],a[1],a[2],a[3]))}}class an extends gs{constructor(a,u){super(a,u),this.current=lr.transparent}set(a){a.r===this.current.r&&a.g===this.current.g&&a.b===this.current.b&&a.a===this.current.a||(this.current=a,this.gl.uniform4f(this.location,a.r,a.g,a.b,a.a))}}const _s=new Float32Array(16);function ln(h){return[qr(255*h.r,255*h.g),qr(255*h.b,255*h.a)]}class sh{constructor(a,u,p){this.value=a,this.uniformNames=u.map((y=>`u_${y}`)),this.type=p}setUniform(a,u,p){a.set(p.constantOr(this.value))}getBinding(a,u,p){return this.type==="color"?new an(a,u):new Ua(a,u)}}class lu{constructor(a,u){this.uniformNames=u.map((p=>`u_${p}`)),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(a,u){this.pixelRatioFrom=u.pixelRatio,this.pixelRatioTo=a.pixelRatio,this.patternFrom=u.tlbr,this.patternTo=a.tlbr}setUniform(a,u,p,y){const E=y==="u_pattern_to"?this.patternTo:y==="u_pattern_from"?this.patternFrom:y==="u_pixel_ratio_to"?this.pixelRatioTo:y==="u_pixel_ratio_from"?this.pixelRatioFrom:null;E&&a.set(E)}getBinding(a,u,p){return p.substr(0,9)==="u_pattern"?new Qi(a,u):new Ua(a,u)}}class yn{constructor(a,u,p,y){this.expression=a,this.type=p,this.maxValue=0,this.paintVertexAttributes=u.map((E=>({name:`a_${E}`,type:"Float32",components:p==="color"?2:1,offset:0}))),this.paintVertexArray=new y}populatePaintArray(a,u,p,y,E){const T=this.paintVertexArray.length,P=this.expression.evaluate(new ri(0),u,{},y,[],E);this.paintVertexArray.resize(a),this._setPaintValue(T,a,P)}updatePaintArray(a,u,p,y){const E=this.expression.evaluate({zoom:0},p,y);this._setPaintValue(a,u,E)}_setPaintValue(a,u,p){if(this.type==="color"){const y=ln(p);for(let E=a;E<u;E++)this.paintVertexArray.emplace(E,y[0],y[1])}else{for(let y=a;y<u;y++)this.paintVertexArray.emplace(y,p);this.maxValue=Math.max(this.maxValue,Math.abs(p))}}upload(a){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=a.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class eo{constructor(a,u,p,y,E,T){this.expression=a,this.uniformNames=u.map((P=>`u_${P}_t`)),this.type=p,this.useIntegerZoom=y,this.zoom=E,this.maxValue=0,this.paintVertexAttributes=u.map((P=>({name:`a_${P}`,type:"Float32",components:p==="color"?4:2,offset:0}))),this.paintVertexArray=new T}populatePaintArray(a,u,p,y,E){const T=this.expression.evaluate(new ri(this.zoom),u,{},y,[],E),P=this.expression.evaluate(new ri(this.zoom+1),u,{},y,[],E),k=this.paintVertexArray.length;this.paintVertexArray.resize(a),this._setPaintValue(k,a,T,P)}updatePaintArray(a,u,p,y){const E=this.expression.evaluate({zoom:this.zoom},p,y),T=this.expression.evaluate({zoom:this.zoom+1},p,y);this._setPaintValue(a,u,E,T)}_setPaintValue(a,u,p,y){if(this.type==="color"){const E=ln(p),T=ln(y);for(let P=a;P<u;P++)this.paintVertexArray.emplace(P,E[0],E[1],T[0],T[1])}else{for(let E=a;E<u;E++)this.paintVertexArray.emplace(E,p,y);this.maxValue=Math.max(this.maxValue,Math.abs(p),Math.abs(y))}}upload(a){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=a.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(a,u){const p=this.useIntegerZoom?Math.floor(u.zoom):u.zoom,y=yr(this.expression.interpolationFactor(p,this.zoom,this.zoom+1),0,1);a.set(y)}getBinding(a,u,p){return new Ua(a,u)}}class Wo{constructor(a,u,p,y,E,T){this.expression=a,this.type=u,this.useIntegerZoom=p,this.zoom=y,this.layerId=T,this.zoomInPaintVertexArray=new E,this.zoomOutPaintVertexArray=new E}populatePaintArray(a,u,p){const y=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(a),this.zoomOutPaintVertexArray.resize(a),this._setPaintValues(y,a,u.patterns&&u.patterns[this.layerId],p)}updatePaintArray(a,u,p,y,E){this._setPaintValues(a,u,p.patterns&&p.patterns[this.layerId],E)}_setPaintValues(a,u,p,y){if(!y||!p)return;const{min:E,mid:T,max:P}=p,k=y[E],D=y[T],z=y[P];if(k&&D&&z)for(let $=a;$<u;$++)this.zoomInPaintVertexArray.emplace($,D.tl[0],D.tl[1],D.br[0],D.br[1],k.tl[0],k.tl[1],k.br[0],k.br[1],D.pixelRatio,k.pixelRatio),this.zoomOutPaintVertexArray.emplace($,D.tl[0],D.tl[1],D.br[0],D.br[1],z.tl[0],z.tl[1],z.br[0],z.br[1],D.pixelRatio,z.pixelRatio)}upload(a){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=a.createVertexBuffer(this.zoomInPaintVertexArray,Ji.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=a.createVertexBuffer(this.zoomOutPaintVertexArray,Ji.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Pf{constructor(a,u,p){this.binders={},this._buffers=[];const y=[];for(const E in a.paint._values){if(!p(E))continue;const T=a.paint.get(E);if(!(T instanceof fs&&Ra(T.property.specification)))continue;const P=Rf(E,a.type),k=T.value,D=T.property.specification.type,z=T.property.useIntegerZoom,$=T.property.specification["property-type"],Y=$==="cross-faded"||$==="cross-faded-data-driven";if(k.kind==="constant")this.binders[E]=Y?new lu(k.value,P):new sh(k.value,P,D),y.push(`/u_${E}`);else if(k.kind==="source"||Y){const Q=oh(E,D,"source");this.binders[E]=Y?new Wo(k,D,z,u,Q,a.id):new yn(k,P,D,Q),y.push(`/a_${E}`)}else{const Q=oh(E,D,"composite");this.binders[E]=new eo(k,P,D,z,u,Q),y.push(`/z_${E}`)}}this.cacheKey=y.sort().join("")}getMaxValue(a){const u=this.binders[a];return u instanceof yn||u instanceof eo?u.maxValue:0}populatePaintArrays(a,u,p,y,E){for(const T in this.binders){const P=this.binders[T];(P instanceof yn||P instanceof eo||P instanceof Wo)&&P.populatePaintArray(a,u,p,y,E)}}setConstantPatternPositions(a,u){for(const p in this.binders){const y=this.binders[p];y instanceof lu&&y.setConstantPatternPositions(a,u)}}updatePaintArrays(a,u,p,y,E){let T=!1;for(const P in a){const k=u.getPositions(P);for(const D of k){const z=p.feature(D.index);for(const $ in this.binders){const Y=this.binders[$];if((Y instanceof yn||Y instanceof eo||Y instanceof Wo)&&Y.expression.isStateDependent===!0){const Q=y.paint.get($);Y.expression=Q.value,Y.updatePaintArray(D.start,D.end,z,a[P],E),T=!0}}}}return T}defines(){const a=[];for(const u in this.binders){const p=this.binders[u];(p instanceof sh||p instanceof lu)&&a.push(...p.uniformNames.map((y=>`#define HAS_UNIFORM_${y}`)))}return a}getBinderAttributes(){const a=[];for(const u in this.binders){const p=this.binders[u];if(p instanceof yn||p instanceof eo)for(let y=0;y<p.paintVertexAttributes.length;y++)a.push(p.paintVertexAttributes[y].name);else if(p instanceof Wo)for(let y=0;y<Ji.members.length;y++)a.push(Ji.members[y].name)}return a}getBinderUniforms(){const a=[];for(const u in this.binders){const p=this.binders[u];if(p instanceof sh||p instanceof lu||p instanceof eo)for(const y of p.uniformNames)a.push(y)}return a}getPaintVertexBuffers(){return this._buffers}getUniforms(a,u){const p=[];for(const y in this.binders){const E=this.binders[y];if(E instanceof sh||E instanceof lu||E instanceof eo){for(const T of E.uniformNames)if(u[T]){const P=E.getBinding(a,u[T],T);p.push({name:T,property:y,binding:P})}}}return p}setUniforms(a,u,p,y){for(const{name:E,property:T,binding:P}of u)this.binders[T].setUniform(P,y,p.get(T),E)}updatePaintBuffers(a){this._buffers=[];for(const u in this.binders){const p=this.binders[u];if(a&&p instanceof Wo){const y=a.fromScale===2?p.zoomInPaintVertexBuffer:p.zoomOutPaintVertexBuffer;y&&this._buffers.push(y)}else(p instanceof yn||p instanceof eo)&&p.paintVertexBuffer&&this._buffers.push(p.paintVertexBuffer)}}upload(a){for(const u in this.binders){const p=this.binders[u];(p instanceof yn||p instanceof eo||p instanceof Wo)&&p.upload(a)}this.updatePaintBuffers()}destroy(){for(const a in this.binders){const u=this.binders[a];(u instanceof yn||u instanceof eo||u instanceof Wo)&&u.destroy()}}}class Ns{constructor(a,u,p=()=>!0){this.programConfigurations={};for(const y of a)this.programConfigurations[y.id]=new Pf(y,u,p);this.needsUpload=!1,this._featureMap=new Sl,this._bufferOffset=0}populatePaintArrays(a,u,p,y,E,T){for(const P in this.programConfigurations)this.programConfigurations[P].populatePaintArrays(a,u,y,E,T);u.id!==void 0&&this._featureMap.add(u.id,p,this._bufferOffset,a),this._bufferOffset=a,this.needsUpload=!0}updatePaintArrays(a,u,p,y){for(const E of p)this.needsUpload=this.programConfigurations[E.id].updatePaintArrays(a,this._featureMap,u,E,y)||this.needsUpload}get(a){return this.programConfigurations[a]}upload(a){if(this.needsUpload){for(const u in this.programConfigurations)this.programConfigurations[u].upload(a);this.needsUpload=!1}}destroy(){for(const a in this.programConfigurations)this.programConfigurations[a].destroy()}}function Rf(h,a){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[h]||[h.replace(`${a}-`,"").replace(/-/g,"_")]}function oh(h,a,u){const p={color:{source:Tl,composite:U},number:{source:w,composite:Tl}},y=(function(E){return{"line-pattern":{source:bt,composite:bt},"fill-pattern":{source:bt,composite:bt},"fill-extrusion-pattern":{source:bt,composite:bt}}[E]})(h);return y&&y[u]||p[a][u]}Ot("ConstantBinder",sh),Ot("CrossFadedConstantBinder",lu),Ot("SourceExpressionBinder",yn),Ot("CrossFadedCompositeBinder",Wo),Ot("CompositeExpressionBinder",eo),Ot("ProgramConfiguration",Pf,{omit:["_buffers"]}),Ot("ProgramConfigurationSet",Ns);const Va=Math.pow(2,14)-1,cu=-Va-1;function da(h){const a=ft/h.extent,u=h.loadGeometry();for(let p=0;p<u.length;p++){const y=u[p];for(let E=0;E<y.length;E++){const T=y[E],P=Math.round(T.x*a),k=Math.round(T.y*a);T.x=yr(P,cu,Va),T.y=yr(k,cu,Va),(P<T.x||P>T.x+1||k<T.y||k>T.y+1)&&si("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return u}function Ga(h,a){return{type:h.type,id:h.id,properties:h.properties,geometry:a?da(h):[]}}const $g=-32768;function Yy(h,a,u,p,y){h.emplaceBack($g+8*a+p,$g+8*u+y)}class Wp{constructor(a){this.zoom=a.zoom,this.globalState=a.globalState,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map((u=>u.id)),this.index=a.index,this.hasPattern=!1,this.layoutVertexArray=new ke,this.indexArray=new ii,this.segments=new br,this.programConfigurations=new Ns(a.layers,a.zoom),this.stateDependentLayerIds=this.layers.filter((u=>u.isStateDependent())).map((u=>u.id))}populate(a,u,p){const y=this.layers[0],E=[];let T=null,P=!1,k=y.type==="heatmap";if(y.type==="circle"){const z=y;T=z.layout.get("circle-sort-key"),P=!T.isConstant(),k=k||z.paint.get("circle-pitch-alignment")==="map"}const D=k?u.subdivisionGranularity.circle:1;for(const{feature:z,id:$,index:Y,sourceLayerIndex:Q}of a){const te=this.layers[0]._featureFilter.needGeometry,oe=Ga(z,te);if(!this.layers[0]._featureFilter.filter(new ri(this.zoom,{globalState:this.globalState}),oe,p))continue;const de=P?T.evaluate(oe,{},p):void 0,ve={id:$,properties:z.properties,type:z.type,sourceLayerIndex:Q,index:Y,geometry:te?oe.geometry:da(z),patterns:{},sortKey:de};E.push(ve)}P&&E.sort(((z,$)=>z.sortKey-$.sortKey));for(const z of E){const{geometry:$,index:Y,sourceLayerIndex:Q}=z,te=a[Y].feature;this.addFeature(z,$,Y,p,D),u.featureIndex.insert(te,$,Y,Q,this.index)}}update(a,u,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,u,this.stateDependentLayers,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,Si),this.indexBuffer=a.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(a),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(a,u,p,y,E=1){let T;switch(E){case 1:T=[0,7];break;case 3:T=[0,2,5,7];break;case 5:T=[0,1,3,4,6,7];break;case 7:T=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${E}; valid values are 1, 3, 5, 7.`)}const P=T.length;for(const k of u)for(const D of k){const z=D.x,$=D.y;if(z<0||z>=ft||$<0||$>=ft)continue;const Y=this.segments.prepareSegment(P*P,this.layoutVertexArray,this.indexArray,a.sortKey),Q=Y.vertexLength;for(let te=0;te<P;te++)for(let oe=0;oe<P;oe++)Yy(this.layoutVertexArray,z,$,T[oe],T[te]);for(let te=0;te<P-1;te++)for(let oe=0;oe<P-1;oe++){const de=Q+te*P+oe,ve=Q+(te+1)*P+oe;this.indexArray.emplaceBack(de,ve+1,de+1),this.indexArray.emplaceBack(de,ve,ve+1)}Y.vertexLength+=P*P,Y.primitiveLength+=(P-1)*(P-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,p,{},y)}}function Wg(h,a){for(let u=0;u<h.length;u++)if(ah(a,h[u]))return!0;for(let u=0;u<a.length;u++)if(ah(h,a[u]))return!0;return!!ys(h,a)}function Jy(h,a,u){return!!ah(h,a)||!!qp(a,h,u)}function Qy(h,a){if(h.length===1)return Kg(a,h[0]);for(let u=0;u<a.length;u++){const p=a[u];for(let y=0;y<p.length;y++)if(ah(h,p[y]))return!0}for(let u=0;u<h.length;u++)if(Kg(a,h[u]))return!0;for(let u=0;u<a.length;u++)if(ys(h,a[u]))return!0;return!1}function yo(h,a,u){if(h.length>1){if(ys(h,a))return!0;for(let p=0;p<a.length;p++)if(qp(a[p],h,u))return!0}for(let p=0;p<h.length;p++)if(qp(h[p],a,u))return!0;return!1}function ys(h,a){if(h.length===0||a.length===0)return!1;for(let u=0;u<h.length-1;u++){const p=h[u],y=h[u+1];for(let E=0;E<a.length-1;E++)if(e0(p,y,a[E],a[E+1]))return!0}return!1}function e0(h,a,u,p){return Tn(h,u,p)!==Tn(a,u,p)&&Tn(h,a,u)!==Tn(h,a,p)}function qp(h,a,u){const p=u*u;if(a.length===1)return h.distSqr(a[0])<p;for(let y=1;y<a.length;y++)if(qg(h,a[y-1],a[y])<p)return!0;return!1}function qg(h,a,u){const p=a.distSqr(u);if(p===0)return h.distSqr(a);const y=((h.x-a.x)*(u.x-a.x)+(h.y-a.y)*(u.y-a.y))/p;return h.distSqr(y<0?a:y>1?u:u.sub(a)._mult(y)._add(a))}function Kg(h,a){let u,p,y,E=!1;for(let T=0;T<h.length;T++){u=h[T];for(let P=0,k=u.length-1;P<u.length;k=P++)p=u[P],y=u[k],p.y>a.y!=y.y>a.y&&a.x<(y.x-p.x)*(a.y-p.y)/(y.y-p.y)+p.x&&(E=!E)}return E}function ah(h,a){let u=!1;for(let p=0,y=h.length-1;p<h.length;y=p++){const E=h[p],T=h[y];E.y>a.y!=T.y>a.y&&a.x<(T.x-E.x)*(a.y-E.y)/(T.y-E.y)+E.x&&(u=!u)}return u}function Zg(h,a,u){const p=u[0],y=u[2];if(h.x<p.x&&a.x<p.x||h.x>y.x&&a.x>y.x||h.y<p.y&&a.y<p.y||h.y>y.y&&a.y>y.y)return!1;const E=Tn(h,a,u[0]);return E!==Tn(h,a,u[1])||E!==Tn(h,a,u[2])||E!==Tn(h,a,u[3])}function td(h,a,u){const p=a.paint.get(h).value;return p.kind==="constant"?p.value:u.programConfigurations.get(a.id).getMaxValue(h)}function rd(h){return Math.sqrt(h[0]*h[0]+h[1]*h[1])}function Mf(h,a,u,p,y){if(!a[0]&&!a[1])return h;const E=m.convert(a)._mult(y);u==="viewport"&&E._rotate(-p);const T=[];for(let P=0;P<h.length;P++)T.push(h[P].sub(E));return T}let Xg,Kp;Ot("CircleBucket",Wp,{omit:["layers"]});var Yg={get paint(){return Kp=Kp||new zn({"circle-radius":new er(Ne.paint_circle["circle-radius"]),"circle-color":new er(Ne.paint_circle["circle-color"]),"circle-blur":new er(Ne.paint_circle["circle-blur"]),"circle-opacity":new er(Ne.paint_circle["circle-opacity"]),"circle-translate":new zt(Ne.paint_circle["circle-translate"]),"circle-translate-anchor":new zt(Ne.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new zt(Ne.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new zt(Ne.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new er(Ne.paint_circle["circle-stroke-width"]),"circle-stroke-color":new er(Ne.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new er(Ne.paint_circle["circle-stroke-opacity"])})},get layout(){return Xg=Xg||new zn({"circle-sort-key":new er(Ne.layout_circle["circle-sort-key"])})}};class t0 extends jn{constructor(a){super(a,Yg)}createBucket(a){return new Wp(a)}queryRadius(a){const u=a;return td("circle-radius",this,u)+td("circle-stroke-width",this,u)+rd(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:a,feature:u,featureState:p,geometry:y,transform:E,pixelsToTileUnits:T,unwrappedTileID:P,getElevation:k}){const D=Mf(a,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-E.bearingInRadians,T),z=this.paint.get("circle-radius").evaluate(u,p)+this.paint.get("circle-stroke-width").evaluate(u,p),$=this.paint.get("circle-pitch-alignment")==="map",Y=$?D:(function(te,oe,de,ve){return te.map((Fe=>Zp(Fe,oe,de,ve)))})(D,E,P,k),Q=$?z*T:z;for(const te of y)for(const oe of te){const de=$?oe:Zp(oe,E,P,k);let ve=Q;const Fe=E.projectTileCoordinates(oe.x,oe.y,P,k).signedDistanceFromCamera;if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?ve*=Fe/E.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(ve*=E.cameraToCenterDistance/Fe),Jy(Y,de,ve))return!0}return!1}}function Zp(h,a,u,p){const y=a.projectTileCoordinates(h.x,h.y,u,p).point;return new m((.5*y.x+.5)*a.width,(.5*-y.y+.5)*a.height)}class If extends Wp{}let r0;Ot("HeatmapBucket",If,{omit:["layers"]});var i0={get paint(){return r0=r0||new zn({"heatmap-radius":new er(Ne.paint_heatmap["heatmap-radius"]),"heatmap-weight":new er(Ne.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new zt(Ne.paint_heatmap["heatmap-intensity"]),"heatmap-color":new au(Ne.paint_heatmap["heatmap-color"]),"heatmap-opacity":new zt(Ne.paint_heatmap["heatmap-opacity"])})}};function kf(h,{width:a,height:u},p,y){if(y){if(y instanceof Uint8ClampedArray)y=new Uint8Array(y.buffer);else if(y.length!==a*u*p)throw new RangeError(`mismatched image size. expected: ${y.length} but got: ${a*u*p}`)}else y=new Uint8Array(a*u*p);return h.width=a,h.height=u,h.data=y,h}function Jg(h,{width:a,height:u},p){if(a===h.width&&u===h.height)return;const y=kf({},{width:a,height:u},p);id(h,y,{x:0,y:0},{x:0,y:0},{width:Math.min(h.width,a),height:Math.min(h.height,u)},p),h.width=a,h.height=u,h.data=y.data}function id(h,a,u,p,y,E){if(y.width===0||y.height===0)return a;if(y.width>h.width||y.height>h.height||u.x>h.width-y.width||u.y>h.height-y.height)throw new RangeError("out of range source coordinates for image copy");if(y.width>a.width||y.height>a.height||p.x>a.width-y.width||p.y>a.height-y.height)throw new RangeError("out of range destination coordinates for image copy");const T=h.data,P=a.data;if(T===P)throw new Error("srcData equals dstData, so image is already copied");for(let k=0;k<y.height;k++){const D=((u.y+k)*h.width+u.x)*E,z=((p.y+k)*a.width+p.x)*E;for(let $=0;$<y.width*E;$++)P[z+$]=T[D+$]}return a}class qo{constructor(a,u){kf(this,a,1,u)}resize(a){Jg(this,a,1)}clone(){return new qo({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(a,u,p,y,E){id(a,u,p,y,E,1)}}class to{constructor(a,u){kf(this,a,4,u)}resize(a){Jg(this,a,4)}replace(a,u){u?this.data.set(a):this.data=a instanceof Uint8ClampedArray?new Uint8Array(a.buffer):a}clone(){return new to({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(a,u,p,y,E){id(a,u,p,y,E,4)}setPixel(a,u,p){const y=4*(a*this.width+u);this.data[y+0]=Math.round(255*p.r/p.a),this.data[y+1]=Math.round(255*p.g/p.a),this.data[y+2]=Math.round(255*p.b/p.a),this.data[y+3]=Math.round(255*p.a)}}function Qg(h){const a={},u=h.resolution||256,p=h.clips?h.clips.length:1,y=h.image||new to({width:u,height:p});if(Math.log(u)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${u}`);const E=(T,P,k)=>{a[h.evaluationKey]=k;const D=h.expression.evaluate(a);y.setPixel(T/4/u,P/4,D)};if(h.clips)for(let T=0,P=0;T<p;++T,P+=4*u)for(let k=0,D=0;k<u;k++,D+=4){const z=k/(u-1),{start:$,end:Y}=h.clips[T];E(P,D,$*(1-z)+Y*z)}else for(let T=0,P=0;T<u;T++,P+=4)E(0,P,T/(u-1));return y}Ot("AlphaImage",qo),Ot("RGBAImage",to);const Bf="big-fb";class n0 extends jn{createBucket(a){return new If(a)}constructor(a){super(a,i0),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(a){a==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Qg({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(Bf)&&this.heatmapFbos.delete(Bf)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let e_;var Lf={get paint(){return e_=e_||new zn({"hillshade-illumination-direction":new zt(Ne.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-altitude":new zt(Ne.paint_hillshade["hillshade-illumination-altitude"]),"hillshade-illumination-anchor":new zt(Ne.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new zt(Ne.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new zt(Ne.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new zt(Ne.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new zt(Ne.paint_hillshade["hillshade-accent-color"]),"hillshade-method":new zt(Ne.paint_hillshade["hillshade-method"])})}};class Fs extends jn{constructor(a){super(a,Lf),this.recalculate({zoom:0,zoomHistory:{}},void 0)}getIlluminationProperties(){let a=this.paint.get("hillshade-illumination-direction").values,u=this.paint.get("hillshade-illumination-altitude").values,p=this.paint.get("hillshade-highlight-color").values,y=this.paint.get("hillshade-shadow-color").values;const E=Math.max(a.length,u.length,p.length,y.length);a=a.concat(Array(E-a.length).fill(a.at(-1))),u=u.concat(Array(E-u.length).fill(u.at(-1))),p=p.concat(Array(E-p.length).fill(p.at(-1))),y=y.concat(Array(E-y.length).fill(y.at(-1)));const T=u.map(ea);return{directionRadians:a.map(ea),altitudeRadians:T,shadowColor:y,highlightColor:p}}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}let s0;var vb={get paint(){return s0=s0||new zn({"color-relief-opacity":new zt(Ne["paint_color-relief"]["color-relief-opacity"]),"color-relief-color":new au(Ne["paint_color-relief"]["color-relief-color"])})}};class nd{constructor(a,u,p,y){this.context=a,this.format=p,this.texture=a.gl.createTexture(),this.update(u,y)}update(a,u,p){const{width:y,height:E}=a,T=!(this.size&&this.size[0]===y&&this.size[1]===E||p),{context:P}=this,{gl:k}=P;if(this.useMipmap=!!(u&&u.useMipmap),k.bindTexture(k.TEXTURE_2D,this.texture),P.pixelStoreUnpackFlipY.set(!1),P.pixelStoreUnpack.set(1),P.pixelStoreUnpackPremultiplyAlpha.set(this.format===k.RGBA&&(!u||u.premultiply!==!1)),T)this.size=[y,E],a instanceof HTMLImageElement||a instanceof HTMLCanvasElement||a instanceof HTMLVideoElement||a instanceof ImageData||Ps(a)?k.texImage2D(k.TEXTURE_2D,0,this.format,this.format,k.UNSIGNED_BYTE,a):k.texImage2D(k.TEXTURE_2D,0,this.format,y,E,0,this.format,k.UNSIGNED_BYTE,a.data);else{const{x:D,y:z}=p||{x:0,y:0};a instanceof HTMLImageElement||a instanceof HTMLCanvasElement||a instanceof HTMLVideoElement||a instanceof ImageData||Ps(a)?k.texSubImage2D(k.TEXTURE_2D,0,D,z,k.RGBA,k.UNSIGNED_BYTE,a):k.texSubImage2D(k.TEXTURE_2D,0,D,z,y,E,k.RGBA,k.UNSIGNED_BYTE,a.data)}this.useMipmap&&this.isSizePowerOfTwo()&&k.generateMipmap(k.TEXTURE_2D),P.pixelStoreUnpackFlipY.setDefault(),P.pixelStoreUnpack.setDefault(),P.pixelStoreUnpackPremultiplyAlpha.setDefault()}bind(a,u,p){const{context:y}=this,{gl:E}=y;E.bindTexture(E.TEXTURE_2D,this.texture),p!==E.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(p=E.LINEAR),a!==this.filter&&(E.texParameteri(E.TEXTURE_2D,E.TEXTURE_MAG_FILTER,a),E.texParameteri(E.TEXTURE_2D,E.TEXTURE_MIN_FILTER,p||a),this.filter=a),u!==this.wrap&&(E.texParameteri(E.TEXTURE_2D,E.TEXTURE_WRAP_S,u),E.texParameteri(E.TEXTURE_2D,E.TEXTURE_WRAP_T,u),this.wrap=u)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:a}=this.context;a.deleteTexture(this.texture),this.texture=null}}class vs{constructor(a,u,p,y=1,E=1,T=1,P=0){if(this.uid=a,u.height!==u.width)throw new RangeError("DEM tiles must be square");if(p&&!["mapbox","terrarium","custom"].includes(p))return void si(`"${p}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=u.height;const k=this.dim=u.height-2;switch(this.data=new Uint32Array(u.data.buffer),p){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=y,this.greenFactor=E,this.blueFactor=T,this.baseShift=P;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let D=0;D<k;D++)this.data[this._idx(-1,D)]=this.data[this._idx(0,D)],this.data[this._idx(k,D)]=this.data[this._idx(k-1,D)],this.data[this._idx(D,-1)]=this.data[this._idx(D,0)],this.data[this._idx(D,k)]=this.data[this._idx(D,k-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(k,-1)]=this.data[this._idx(k-1,0)],this.data[this._idx(-1,k)]=this.data[this._idx(0,k-1)],this.data[this._idx(k,k)]=this.data[this._idx(k-1,k-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let D=0;D<k;D++)for(let z=0;z<k;z++){const $=this.get(D,z);$>this.max&&(this.max=$),$<this.min&&(this.min=$)}}get(a,u){const p=new Uint8Array(this.data.buffer),y=4*this._idx(a,u);return this.unpack(p[y],p[y+1],p[y+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(a,u){if(a<-1||a>=this.dim+1||u<-1||u>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(u+1)*this.stride+(a+1)}unpack(a,u,p){return a*this.redFactor+u*this.greenFactor+p*this.blueFactor-this.baseShift}pack(a){return o0(a,this.getUnpackVector())}getPixels(){return new to({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(a,u,p){if(this.dim!==a.dim)throw new Error("dem dimension mismatch");let y=u*this.dim,E=u*this.dim+this.dim,T=p*this.dim,P=p*this.dim+this.dim;switch(u){case-1:y=E-1;break;case 1:E=y+1}switch(p){case-1:T=P-1;break;case 1:P=T+1}const k=-u*this.dim,D=-p*this.dim;for(let z=T;z<P;z++)for(let $=y;$<E;$++)this.data[this._idx($,z)]=a.data[this._idx($+k,z+D)]}}function o0(h,a){const u=a[0],p=a[1],y=a[2],E=a[3],T=Math.min(u,p,y),P=Math.round((h+E)/T);return{r:Math.floor(P*T/u)%256,g:Math.floor(P*T/p)%256,b:Math.floor(P*T/y)%256}}Ot("DEMData",vs);class qt extends jn{constructor(a){super(a,vb)}_createColorRamp(a){const u={elevationStops:[],colorStops:[]},p=this._transitionablePaint._values["color-relief-color"].value.expression;if(p instanceof Yl&&p._styleExpression.expression instanceof Yi){this.colorRampExpression=p;const T=p._styleExpression.expression;u.elevationStops=T.labels,u.colorStops=[];for(const P of u.elevationStops)u.colorStops.push(T.evaluate({globals:{elevation:P}}))}if(u.elevationStops.length<1&&(u.elevationStops=[0],u.colorStops=[lr.transparent]),u.elevationStops.length<2&&(u.elevationStops.push(u.elevationStops[0]+1),u.colorStops.push(u.colorStops[0])),u.elevationStops.length<=a)return u;const y={elevationStops:[],colorStops:[]},E=(u.elevationStops.length-1)/(a-1);for(let T=0;T<u.elevationStops.length-.5;T+=E)y.elevationStops.push(u.elevationStops[Math.round(T)]),y.colorStops.push(u.colorStops[Math.round(T)]);return si(`Too many colors in specification of ${this.id} color-relief layer, may not render properly.`),y}_colorRampChanged(){return this.colorRampExpression!=this._transitionablePaint._values["color-relief-color"].value.expression}getColorRampTextures(a,u,p){if(this.colorRampTextures&&!this._colorRampChanged())return this.colorRampTextures;const y=this._createColorRamp(u),E=new to({width:y.colorStops.length,height:1}),T=new to({width:y.colorStops.length,height:1});for(let P=0;P<y.elevationStops.length;P++){const k=o0(y.elevationStops[P],p);T.setPixel(0,P,new lr(k.r/255,k.g/255,k.b/255,1)),E.setPixel(0,P,y.colorStops[P])}return this.colorRampTextures={elevationTexture:new nd(a,T,a.gl.RGBA),colorTexture:new nd(a,E,a.gl.RGBA)},this.colorRampTextures}hasOffscreenPass(){return this.visibility!=="none"&&!!this.colorRampTextures}}const sd=Li([{name:"a_pos",components:2,type:"Int16"}],4),{members:t_}=sd;function Xp(h,a,u){const p=u.patternDependencies;let y=!1;for(const E of a){const T=E.paint.get(`${h}-pattern`);T.isConstant()||(y=!0);const P=T.constantOr(null);P&&(y=!0,p[P.to]=!0,p[P.from]=!0)}return y}function r_(h,a,u,p,y){const E=y.patternDependencies;for(const T of a){const P=T.paint.get(`${h}-pattern`).value;if(P.kind!=="constant"){let k=P.evaluate({zoom:p-1},u,{},y.availableImages),D=P.evaluate({zoom:p},u,{},y.availableImages),z=P.evaluate({zoom:p+1},u,{},y.availableImages);k=k&&k.name?k.name:k,D=D&&D.name?D.name:D,z=z&&z.name?z.name:z,E[k]=!0,E[D]=!0,E[z]=!0,u.patterns[T.id]={min:k,mid:D,max:z}}}return u}function od(h,a,u,p,y){let E;if(y===(function(T,P,k,D){let z=0;for(let $=P,Y=k-D;$<k;$+=D)z+=(T[Y]-T[$])*(T[$+1]+T[Y+1]),Y=$;return z})(h,a,u,p)>0)for(let T=a;T<u;T+=p)E=Nf(T/p|0,h[T],h[T+1],E);else for(let T=u-p;T>=a;T-=p)E=Nf(T/p|0,h[T],h[T+1],E);return E&&ad(E,E.next)&&(ch(E),E=E.next),E}function Cl(h,a){if(!h)return h;a||(a=h);let u,p=h;do if(u=!1,p.steiner||!ad(p,p.next)&&ni(p.prev,p,p.next)!==0)p=p.next;else{if(ch(p),p=a=p.prev,p===p.next)break;u=!0}while(u||p!==a);return a}function lh(h,a,u,p,y,E,T){if(!h)return;!T&&E&&(function(k,D,z,$){let Y=k;do Y.z===0&&(Y.z=Pl(Y.x,Y.y,D,z,$)),Y.prevZ=Y.prev,Y.nextZ=Y.next,Y=Y.next;while(Y!==k);Y.prevZ.nextZ=null,Y.prevZ=null,(function(Q){let te,oe=1;do{let de,ve=Q;Q=null;let Fe=null;for(te=0;ve;){te++;let Ee=ve,Re=0;for(let st=0;st<oe&&(Re++,Ee=Ee.nextZ,Ee);st++);let Je=oe;for(;Re>0||Je>0&&Ee;)Re!==0&&(Je===0||!Ee||ve.z<=Ee.z)?(de=ve,ve=ve.nextZ,Re--):(de=Ee,Ee=Ee.nextZ,Je--),Fe?Fe.nextZ=de:Q=de,de.prevZ=Fe,Fe=de;ve=Ee}Fe.nextZ=null,oe*=2}while(te>1)})(Y)})(h,p,y,E);let P=h;for(;h.prev!==h.next;){const k=h.prev,D=h.next;if(E?l0(h,p,y,E):a0(h))a.push(k.i,h.i,D.i),ch(h),h=D.next,P=D.next;else if((h=D)===P){T?T===1?lh(h=c0(Cl(h),a),a,u,p,y,E,2):T===2&&i_(h,a,u,p,y,E):lh(Cl(h),a,u,p,y,E,1);break}}}function a0(h){const a=h.prev,u=h,p=h.next;if(ni(a,u,p)>=0)return!1;const y=a.x,E=u.x,T=p.x,P=a.y,k=u.y,D=p.y,z=Math.min(y,E,T),$=Math.min(P,k,D),Y=Math.max(y,E,T),Q=Math.max(P,k,D);let te=p.next;for(;te!==a;){if(te.x>=z&&te.x<=Y&&te.y>=$&&te.y<=Q&&ro(y,P,E,k,T,D,te.x,te.y)&&ni(te.prev,te,te.next)>=0)return!1;te=te.next}return!0}function l0(h,a,u,p){const y=h.prev,E=h,T=h.next;if(ni(y,E,T)>=0)return!1;const P=y.x,k=E.x,D=T.x,z=y.y,$=E.y,Y=T.y,Q=Math.min(P,k,D),te=Math.min(z,$,Y),oe=Math.max(P,k,D),de=Math.max(z,$,Y),ve=Pl(Q,te,a,u,p),Fe=Pl(oe,de,a,u,p);let Ee=h.prevZ,Re=h.nextZ;for(;Ee&&Ee.z>=ve&&Re&&Re.z<=Fe;){if(Ee.x>=Q&&Ee.x<=oe&&Ee.y>=te&&Ee.y<=de&&Ee!==y&&Ee!==T&&ro(P,z,k,$,D,Y,Ee.x,Ee.y)&&ni(Ee.prev,Ee,Ee.next)>=0||(Ee=Ee.prevZ,Re.x>=Q&&Re.x<=oe&&Re.y>=te&&Re.y<=de&&Re!==y&&Re!==T&&ro(P,z,k,$,D,Y,Re.x,Re.y)&&ni(Re.prev,Re,Re.next)>=0))return!1;Re=Re.nextZ}for(;Ee&&Ee.z>=ve;){if(Ee.x>=Q&&Ee.x<=oe&&Ee.y>=te&&Ee.y<=de&&Ee!==y&&Ee!==T&&ro(P,z,k,$,D,Y,Ee.x,Ee.y)&&ni(Ee.prev,Ee,Ee.next)>=0)return!1;Ee=Ee.prevZ}for(;Re&&Re.z<=Fe;){if(Re.x>=Q&&Re.x<=oe&&Re.y>=te&&Re.y<=de&&Re!==y&&Re!==T&&ro(P,z,k,$,D,Y,Re.x,Re.y)&&ni(Re.prev,Re,Re.next)>=0)return!1;Re=Re.nextZ}return!0}function c0(h,a){let u=h;do{const p=u.prev,y=u.next.next;!ad(p,y)&&o_(p,u,u.next,y)&&ld(p,y)&&ld(y,p)&&(a.push(p.i,u.i,y.i),ch(u),ch(u.next),u=h=y),u=u.next}while(u!==h);return Cl(u)}function i_(h,a,u,p,y,E){let T=h;do{let P=T.next.next;for(;P!==T.prev;){if(T.i!==P.i&&h0(T,P)){let k=d0(T,P);return T=Cl(T,T.next),k=Cl(k,k.next),lh(T,a,u,p,y,E,0),void lh(k,a,u,p,y,E,0)}P=P.next}T=T.next}while(T!==h)}function n_(h,a){let u=h.x-a.x;return u===0&&(u=h.y-a.y,u===0)&&(u=(h.next.y-h.y)/(h.next.x-h.x)-(a.next.y-a.y)/(a.next.x-a.x)),u}function bs(h,a){const u=(function(y,E){let T=E;const P=y.x,k=y.y;let D,z=-1/0;if(ad(y,T))return T;do{if(ad(y,T.next))return T.next;if(k<=T.y&&k>=T.next.y&&T.next.y!==T.y){const oe=T.x+(k-T.y)*(T.next.x-T.x)/(T.next.y-T.y);if(oe<=P&&oe>z&&(z=oe,D=T.x<T.next.x?T:T.next,oe===P))return D}T=T.next}while(T!==E);if(!D)return null;const $=D,Y=D.x,Q=D.y;let te=1/0;T=D;do{if(P>=T.x&&T.x>=Y&&P!==T.x&&s_(k<Q?P:z,k,Y,Q,k<Q?z:P,k,T.x,T.y)){const oe=Math.abs(k-T.y)/(P-T.x);ld(T,y)&&(oe<te||oe===te&&(T.x>D.x||T.x===D.x&&Ha(D,T)))&&(D=T,te=oe)}T=T.next}while(T!==$);return D})(h,a);if(!u)return a;const p=d0(u,h);return Cl(p,p.next),Cl(u,u.next)}function Ha(h,a){return ni(h.prev,h,a.prev)<0&&ni(a.next,h,h.next)<0}function Pl(h,a,u,p,y){return(h=1431655765&((h=858993459&((h=252645135&((h=16711935&((h=(h-u)*y|0)|h<<8))|h<<4))|h<<2))|h<<1))|(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=(a-p)*y|0)|a<<8))|a<<4))|a<<2))|a<<1))<<1}function u0(h){let a=h,u=h;do(a.x<u.x||a.x===u.x&&a.y<u.y)&&(u=a),a=a.next;while(a!==h);return u}function s_(h,a,u,p,y,E,T,P){return(y-T)*(a-P)>=(h-T)*(E-P)&&(h-T)*(p-P)>=(u-T)*(a-P)&&(u-T)*(E-P)>=(y-T)*(p-P)}function ro(h,a,u,p,y,E,T,P){return!(h===T&&a===P)&&s_(h,a,u,p,y,E,T,P)}function h0(h,a){return h.next.i!==a.i&&h.prev.i!==a.i&&!(function(u,p){let y=u;do{if(y.i!==u.i&&y.next.i!==u.i&&y.i!==p.i&&y.next.i!==p.i&&o_(y,y.next,u,p))return!0;y=y.next}while(y!==u);return!1})(h,a)&&(ld(h,a)&&ld(a,h)&&(function(u,p){let y=u,E=!1;const T=(u.x+p.x)/2,P=(u.y+p.y)/2;do y.y>P!=y.next.y>P&&y.next.y!==y.y&&T<(y.next.x-y.x)*(P-y.y)/(y.next.y-y.y)+y.x&&(E=!E),y=y.next;while(y!==u);return E})(h,a)&&(ni(h.prev,h,a.prev)||ni(h,a.prev,a))||ad(h,a)&&ni(h.prev,h,h.next)>0&&ni(a.prev,a,a.next)>0)}function ni(h,a,u){return(a.y-h.y)*(u.x-a.x)-(a.x-h.x)*(u.y-a.y)}function ad(h,a){return h.x===a.x&&h.y===a.y}function o_(h,a,u,p){const y=Df(ni(h,a,u)),E=Df(ni(h,a,p)),T=Df(ni(u,p,h)),P=Df(ni(u,p,a));return y!==E&&T!==P||!(y!==0||!Of(h,u,a))||!(E!==0||!Of(h,p,a))||!(T!==0||!Of(u,h,p))||!(P!==0||!Of(u,a,p))}function Of(h,a,u){return a.x<=Math.max(h.x,u.x)&&a.x>=Math.min(h.x,u.x)&&a.y<=Math.max(h.y,u.y)&&a.y>=Math.min(h.y,u.y)}function Df(h){return h>0?1:h<0?-1:0}function ld(h,a){return ni(h.prev,h,h.next)<0?ni(h,a,h.next)>=0&&ni(h,h.prev,a)>=0:ni(h,a,h.prev)<0||ni(h,h.next,a)<0}function d0(h,a){const u=vo(h.i,h.x,h.y),p=vo(a.i,a.x,a.y),y=h.next,E=a.prev;return h.next=a,a.prev=h,u.next=y,y.prev=u,p.next=u,u.prev=p,E.next=p,p.prev=E,p}function Nf(h,a,u,p){const y=vo(h,a,u);return p?(y.next=p.next,y.prev=p,p.next.prev=y,p.next=y):(y.prev=y,y.next=y),y}function ch(h){h.next.prev=h.prev,h.prev.next=h.next,h.prevZ&&(h.prevZ.nextZ=h.nextZ),h.nextZ&&(h.nextZ.prevZ=h.prevZ)}function vo(h,a,u){return{i:h,x:a,y:u,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class jr{constructor(a,u){if(u>a)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=a,this._minGranularity=u}getGranularityForZoomLevel(a){return Math.max(Math.floor(this._baseZoomGranularity/(1<<a)),this._minGranularity,1)}}class vn{constructor(a){this.fill=a.fill,this.line=a.line,this.tile=a.tile,this.stencil=a.stencil,this.circle=a.circle}}vn.noSubdivision=new vn({fill:new jr(0,0),line:new jr(0,0),tile:new jr(0,0),stencil:new jr(0,0),circle:1}),Ot("SubdivisionGranularityExpression",jr),Ot("SubdivisionGranularitySetting",vn);const Oi=-32768,bn=32767;class Ko{constructor(a,u){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=a,this._granularityCellSize=ft/a,this._canonical=u}_getKey(a,u){return(a+=32768)<<16|u+32768}_vertexToIndex(a,u){if(a<-32768||u<-32768||a>32767||u>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");const p=0|Math.round(a),y=0|Math.round(u),E=this._getKey(p,y);if(this._vertexDictionary.has(E))return this._vertexDictionary.get(E);const T=this._vertexBuffer.length/2;return this._vertexDictionary.set(E,T),this._vertexBuffer.push(p,y),T}_subdivideTrianglesScanline(a){if(this._granularity<2)return(function(y,E){const T=[];for(let P=0;P<E.length;P+=3){const k=E[P],D=E[P+1],z=E[P+2],$=y[2*k],Y=y[2*k+1];(y[2*D]-$)*(y[2*z+1]-Y)-(y[2*D+1]-Y)*(y[2*z]-$)>0?(T.push(k),T.push(z),T.push(D)):(T.push(k),T.push(D),T.push(z))}return T})(this._vertexBuffer,a);const u=[],p=a.length;for(let y=0;y<p;y+=3){const E=[a[y+0],a[y+1],a[y+2]],T=[this._vertexBuffer[2*a[y+0]+0],this._vertexBuffer[2*a[y+0]+1],this._vertexBuffer[2*a[y+1]+0],this._vertexBuffer[2*a[y+1]+1],this._vertexBuffer[2*a[y+2]+0],this._vertexBuffer[2*a[y+2]+1]];let P=1/0,k=1/0,D=-1/0,z=-1/0;for(let oe=0;oe<3;oe++){const de=T[2*oe],ve=T[2*oe+1];P=Math.min(P,de),D=Math.max(D,de),k=Math.min(k,ve),z=Math.max(z,ve)}if(P===D||k===z)continue;const $=Math.floor(P/this._granularityCellSize),Y=Math.ceil(D/this._granularityCellSize),Q=Math.floor(k/this._granularityCellSize),te=Math.ceil(z/this._granularityCellSize);if($!==Y||Q!==te)for(let oe=Q;oe<te;oe++){const de=this._scanlineGenerateVertexRingForCellRow(oe,T,E);Ff(this._vertexBuffer,de,u)}else u.push(...E)}return u}_scanlineGenerateVertexRingForCellRow(a,u,p){const y=a*this._granularityCellSize,E=y+this._granularityCellSize,T=[];for(let P=0;P<3;P++){const k=u[2*P],D=u[2*P+1],z=u[2*(P+1)%6],$=u[(2*(P+1)+1)%6],Y=u[2*(P+2)%6],Q=u[(2*(P+2)+1)%6],te=z-k,oe=$-D,de=te===0,ve=oe===0,Fe=(y-D)/oe,Ee=(E-D)/oe,Re=Math.min(Fe,Ee),Je=Math.max(Fe,Ee);if(!ve&&(Re>=1||Je<=0)||ve&&(D<y||D>E)){$>=y&&$<=E&&T.push(p[(P+1)%3]);continue}!ve&&Re>0&&T.push(this._vertexToIndex(k+te*Re,D+oe*Re));const st=k+te*Math.max(Re,0),pt=k+te*Math.min(Je,1);de||this._generateIntraEdgeVertices(T,k,D,z,$,st,pt),!ve&&Je<1&&T.push(this._vertexToIndex(k+te*Je,D+oe*Je)),(ve||$>=y&&$<=E)&&T.push(p[(P+1)%3]),!ve&&($<=y||$>=E)&&this._generateInterEdgeVertices(T,k,D,z,$,Y,Q,pt,y,E)}return T}_generateIntraEdgeVertices(a,u,p,y,E,T,P){const k=y-u,D=E-p,z=D===0,$=z?Math.min(u,y):Math.min(T,P),Y=z?Math.max(u,y):Math.max(T,P),Q=Math.floor($/this._granularityCellSize)+1,te=Math.ceil(Y/this._granularityCellSize)-1;if(z?u<y:T<P)for(let oe=Q;oe<=te;oe++){const de=oe*this._granularityCellSize;a.push(this._vertexToIndex(de,p+D*(de-u)/k))}else for(let oe=te;oe>=Q;oe--){const de=oe*this._granularityCellSize;a.push(this._vertexToIndex(de,p+D*(de-u)/k))}}_generateInterEdgeVertices(a,u,p,y,E,T,P,k,D,z){const $=E-p,Y=T-y,Q=P-E,te=(D-E)/Q,oe=(z-E)/Q,de=Math.min(te,oe),ve=Math.max(te,oe),Fe=y+Y*de;let Ee=Math.floor(Math.min(Fe,k)/this._granularityCellSize)+1,Re=Math.ceil(Math.max(Fe,k)/this._granularityCellSize)-1,Je=k<Fe;const st=Q===0;if(st&&(P===D||P===z))return;if(st||de>=1||ve<=0){const kt=p-P,Et=T+(u-T)*Math.min((D-P)/kt,(z-P)/kt);Ee=Math.floor(Math.min(Et,k)/this._granularityCellSize)+1,Re=Math.ceil(Math.max(Et,k)/this._granularityCellSize)-1,Je=k<Et}const pt=$>0?z:D;if(Je)for(let kt=Ee;kt<=Re;kt++)a.push(this._vertexToIndex(kt*this._granularityCellSize,pt));else for(let kt=Re;kt>=Ee;kt--)a.push(this._vertexToIndex(kt*this._granularityCellSize,pt))}_generateOutline(a){const u=[];for(const p of a){const y=Di(p,this._granularity,!0),E=this._pointArrayToIndices(y),T=[];for(let P=1;P<E.length;P++)T.push(E[P-1]),T.push(E[P]);u.push(T)}return u}_handlePoles(a){let u=!1,p=!1;this._canonical&&(this._canonical.y===0&&(u=!0),this._canonical.y===(1<<this._canonical.z)-1&&(p=!0)),(u||p)&&this._fillPoles(a,u,p)}_ensureNoPoleVertices(){const a=this._vertexBuffer;for(let u=0;u<a.length;u+=2){const p=a[u+1];p===Oi&&(a[u+1]=-32767),p===bn&&(a[u+1]=32766)}}_generatePoleQuad(a,u,p,y,E,T){y>E!=(T===Oi)?(a.push(u),a.push(p),a.push(this._vertexToIndex(y,T)),a.push(p),a.push(this._vertexToIndex(E,T)),a.push(this._vertexToIndex(y,T))):(a.push(p),a.push(u),a.push(this._vertexToIndex(y,T)),a.push(this._vertexToIndex(E,T)),a.push(p),a.push(this._vertexToIndex(y,T)))}_fillPoles(a,u,p){const y=this._vertexBuffer,E=ft,T=a.length;for(let P=2;P<T;P+=3){const k=a[P-2],D=a[P-1],z=a[P],$=y[2*k],Y=y[2*k+1],Q=y[2*D],te=y[2*D+1],oe=y[2*z],de=y[2*z+1];u&&(Y===0&&te===0&&this._generatePoleQuad(a,k,D,$,Q,Oi),te===0&&de===0&&this._generatePoleQuad(a,D,z,Q,oe,Oi),de===0&&Y===0&&this._generatePoleQuad(a,z,k,oe,$,Oi)),p&&(Y===E&&te===E&&this._generatePoleQuad(a,k,D,$,Q,bn),te===E&&de===E&&this._generatePoleQuad(a,D,z,Q,oe,bn),de===E&&Y===E&&this._generatePoleQuad(a,z,k,oe,$,bn))}}_initializeVertices(a){for(let u=0;u<a.length;u+=2)this._vertexToIndex(a[u],a[u+1])}subdividePolygonInternal(a,u){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;const{flattened:p,holeIndices:y}=(function(P){const k=[],D=[];for(const z of P)if(z.length!==0){z!==P[0]&&k.push(D.length/2);for(let $=0;$<z.length;$++)D.push(z[$].x),D.push(z[$].y)}return{flattened:D,holeIndices:k}})(a);let E;this._initializeVertices(p);try{const P=(function(D,z,$=2){const Y=z&&z.length,Q=Y?z[0]*$:D.length;let te=od(D,0,Q,$,!0);const oe=[];if(!te||te.next===te.prev)return oe;let de,ve,Fe;if(Y&&(te=(function(Ee,Re,Je,st){const pt=[];for(let kt=0,Et=Re.length;kt<Et;kt++){const Mt=od(Ee,Re[kt]*st,kt<Et-1?Re[kt+1]*st:Ee.length,st,!1);Mt===Mt.next&&(Mt.steiner=!0),pt.push(u0(Mt))}pt.sort(n_);for(let kt=0;kt<pt.length;kt++)Je=bs(pt[kt],Je);return Je})(D,z,te,$)),D.length>80*$){de=D[0],ve=D[1];let Ee=de,Re=ve;for(let Je=$;Je<Q;Je+=$){const st=D[Je],pt=D[Je+1];st<de&&(de=st),pt<ve&&(ve=pt),st>Ee&&(Ee=st),pt>Re&&(Re=pt)}Fe=Math.max(Ee-de,Re-ve),Fe=Fe!==0?32767/Fe:0}return lh(te,oe,$,de,ve,Fe,0),oe})(p,y),k=this._convertIndices(p,P);E=this._subdivideTrianglesScanline(k)}catch(P){console.error(P)}let T=[];return u&&(T=this._generateOutline(a)),this._ensureNoPoleVertices(),this._handlePoles(E),{verticesFlattened:this._vertexBuffer,indicesTriangles:E,indicesLineList:T}}_convertIndices(a,u){const p=[];for(let y=0;y<u.length;y++)p.push(this._vertexToIndex(a[2*u[y]],a[2*u[y]+1]));return p}_pointArrayToIndices(a){const u=[];for(let p=0;p<a.length;p++){const y=a[p];u.push(this._vertexToIndex(y.x,y.y))}return u}}function uh(h,a,u,p=!0){return new Ko(u,a).subdividePolygonInternal(h,p)}function Di(h,a,u=!1){if(!h||h.length<1)return[];if(h.length<2)return[];const p=h[0],y=h[h.length-1],E=u&&(p.x!==y.x||p.y!==y.y);if(a<2)return E?[...h,h[0]]:[...h];const T=Math.floor(ft/a),P=[];P.push(new m(h[0].x,h[0].y));const k=h.length,D=E?k:k-1;for(let z=0;z<D;z++){const $=h[z],Y=z<k-1?h[z+1]:h[0],Q=$.x,te=$.y,oe=Y.x,de=Y.y,ve=Q!==oe,Fe=te!==de;if(!ve&&!Fe)continue;const Ee=oe-Q,Re=de-te,Je=Math.abs(Ee),st=Math.abs(Re);let pt=Q,kt=te;for(;;){const Mt=Ee>0?(Math.floor(pt/T)+1)*T:(Math.ceil(pt/T)-1)*T,Yt=Re>0?(Math.floor(kt/T)+1)*T:(Math.ceil(kt/T)-1)*T,Ct=Math.abs(pt-Mt),It=Math.abs(kt-Yt),ct=Math.abs(pt-oe),dr=Math.abs(kt-de),xr=ve?Ct/Je:Number.POSITIVE_INFINITY,nr=Fe?It/st:Number.POSITIVE_INFINITY;if((ct<=Ct||!ve)&&(dr<=It||!Fe))break;if(xr<nr&&ve||!Fe){pt=Mt,kt+=Re*xr;const Gt=new m(pt,Math.round(kt));P[P.length-1].x===Gt.x&&P[P.length-1].y===Gt.y||P.push(Gt)}else{pt+=Ee*nr,kt=Yt;const Gt=new m(Math.round(pt),kt);P[P.length-1].x===Gt.x&&P[P.length-1].y===Gt.y||P.push(Gt)}}const Et=new m(oe,de);P[P.length-1].x===Et.x&&P[P.length-1].y===Et.y||P.push(Et)}return P}function Ff(h,a,u){if(a.length===0)throw new Error("Subdivision vertex ring is empty.");let p=0,y=h[2*a[0]];for(let k=1;k<a.length;k++){const D=h[2*a[k]];D<y&&(y=D,p=k)}const E=a.length;let T=p,P=(T+1)%E;for(;;){const k=T-1>=0?T-1:E-1,D=(P+1)%E,z=h[2*a[k]],$=h[2*a[D]],Y=h[2*a[T]],Q=h[2*a[T]+1],te=h[2*a[P]+1];let oe=!1;if(z<$)oe=!0;else if(z>$)oe=!1;else{const de=te-Q,ve=-(h[2*a[P]]-Y),Fe=Q<te?1:-1;((z-Y)*de+(h[2*a[k]+1]-Q)*ve)*Fe>(($-Y)*de+(h[2*a[D]+1]-Q)*ve)*Fe&&(oe=!0)}if(oe){const de=a[k],ve=a[T],Fe=a[P];de!==ve&&de!==Fe&&ve!==Fe&&u.push(Fe,ve,de),T--,T<0&&(T=E-1)}else{const de=a[D],ve=a[T],Fe=a[P];de!==ve&&de!==Fe&&ve!==Fe&&u.push(Fe,ve,de),P++,P>=E&&(P=0)}if(k===D)break}}function uu(h,a,u,p,y,E,T,P,k){const D=y.length/2,z=T&&P&&k;if(D<br.MAX_VERTEX_ARRAY_LENGTH){const $=a.prepareSegment(D,u,p),Y=$.vertexLength;for(let oe=0;oe<E.length;oe+=3)p.emplaceBack(Y+E[oe],Y+E[oe+1],Y+E[oe+2]);let Q,te;$.vertexLength+=D,$.primitiveLength+=E.length/3,z&&(te=T.prepareSegment(D,u,P),Q=te.vertexLength,te.vertexLength+=D);for(let oe=0;oe<y.length;oe+=2)h(y[oe],y[oe+1]);if(z)for(let oe=0;oe<k.length;oe++){const de=k[oe];for(let ve=1;ve<de.length;ve+=2)P.emplaceBack(Q+de[ve-1],Q+de[ve]);te.primitiveLength+=de.length/2}}else(function($,Y,Q,te,oe,de){const ve=[];for(let st=0;st<te.length/2;st++)ve.push(-1);const Fe={count:0};let Ee=0,Re=$.getOrCreateLatestSegment(Y,Q),Je=Re.vertexLength;for(let st=2;st<oe.length;st+=3){const pt=oe[st-2],kt=oe[st-1],Et=oe[st];let Mt=ve[pt]<Ee,Yt=ve[kt]<Ee,Ct=ve[Et]<Ee;Re.vertexLength+((Mt?1:0)+(Yt?1:0)+(Ct?1:0))>br.MAX_VERTEX_ARRAY_LENGTH&&(Re=$.createNewSegment(Y,Q),Ee=Fe.count,Mt=!0,Yt=!0,Ct=!0,Je=0);const It=hu(ve,te,de,Fe,pt,Mt,Re),ct=hu(ve,te,de,Fe,kt,Yt,Re),dr=hu(ve,te,de,Fe,Et,Ct,Re);Q.emplaceBack(Je+It-Ee,Je+ct-Ee,Je+dr-Ee),Re.primitiveLength++}})(a,u,p,y,E,h),z&&(function($,Y,Q,te,oe,de){const ve=[];for(let st=0;st<te.length/2;st++)ve.push(-1);const Fe={count:0};let Ee=0,Re=$.getOrCreateLatestSegment(Y,Q),Je=Re.vertexLength;for(let st=0;st<oe.length;st++){const pt=oe[st];for(let kt=1;kt<oe[st].length;kt+=2){const Et=pt[kt-1],Mt=pt[kt];let Yt=ve[Et]<Ee,Ct=ve[Mt]<Ee;Re.vertexLength+((Yt?1:0)+(Ct?1:0))>br.MAX_VERTEX_ARRAY_LENGTH&&(Re=$.createNewSegment(Y,Q),Ee=Fe.count,Yt=!0,Ct=!0,Je=0);const It=hu(ve,te,de,Fe,Et,Yt,Re),ct=hu(ve,te,de,Fe,Mt,Ct,Re);Q.emplaceBack(Je+It-Ee,Je+ct-Ee),Re.primitiveLength++}}})(T,u,P,y,k,h),a.forceNewSegmentOnNextPrepare(),T?.forceNewSegmentOnNextPrepare()}function hu(h,a,u,p,y,E,T){if(E){const P=p.count;return u(a[2*y],a[2*y+1]),h[y]=p.count,p.count++,T.vertexLength++,P}return h[y]}class zf{constructor(a){this.zoom=a.zoom,this.globalState=a.globalState,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map((u=>u.id)),this.index=a.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Xe,this.indexArray=new ii,this.indexArray2=new Jr,this.programConfigurations=new Ns(a.layers,a.zoom),this.segments=new br,this.segments2=new br,this.stateDependentLayerIds=this.layers.filter((u=>u.isStateDependent())).map((u=>u.id))}populate(a,u,p){this.hasPattern=Xp("fill",this.layers,u);const y=this.layers[0].layout.get("fill-sort-key"),E=!y.isConstant(),T=[];for(const{feature:P,id:k,index:D,sourceLayerIndex:z}of a){const $=this.layers[0]._featureFilter.needGeometry,Y=Ga(P,$);if(!this.layers[0]._featureFilter.filter(new ri(this.zoom,{globalState:this.globalState}),Y,p))continue;const Q=E?y.evaluate(Y,{},p,u.availableImages):void 0,te={id:k,properties:P.properties,type:P.type,sourceLayerIndex:z,index:D,geometry:$?Y.geometry:da(P),patterns:{},sortKey:Q};T.push(te)}E&&T.sort(((P,k)=>P.sortKey-k.sortKey));for(const P of T){const{geometry:k,index:D,sourceLayerIndex:z}=P;if(this.hasPattern){const $=r_("fill",this.layers,P,this.zoom,u);this.patternFeatures.push($)}else this.addFeature(P,k,D,p,{},u.subdivisionGranularity);u.featureIndex.insert(a[D].feature,k,D,z,this.index)}}update(a,u,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,u,this.stateDependentLayers,p)}addFeatures(a,u,p){for(const y of this.patternFeatures)this.addFeature(y,y.geometry,y.index,u,p,a.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,t_),this.indexBuffer=a.createIndexBuffer(this.indexArray),this.indexBuffer2=a.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(a),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(a,u,p,y,E,T){for(const P of Hc(u,500)){const k=uh(P,y,T.fill.getGranularityForZoomLevel(y.z)),D=this.layoutVertexArray;uu(((z,$)=>{D.emplaceBack(z,$)}),this.segments,this.layoutVertexArray,this.indexArray,k.verticesFlattened,k.indicesTriangles,this.segments2,this.indexArray2,k.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,p,E,y)}}let cd,io;Ot("FillBucket",zf,{omit:["layers","patternFeatures"]});var a_={get paint(){return io=io||new zn({"fill-antialias":new zt(Ne.paint_fill["fill-antialias"]),"fill-opacity":new er(Ne.paint_fill["fill-opacity"]),"fill-color":new er(Ne.paint_fill["fill-color"]),"fill-outline-color":new er(Ne.paint_fill["fill-outline-color"]),"fill-translate":new zt(Ne.paint_fill["fill-translate"]),"fill-translate-anchor":new zt(Ne.paint_fill["fill-translate-anchor"]),"fill-pattern":new za(Ne.paint_fill["fill-pattern"])})},get layout(){return cd=cd||new zn({"fill-sort-key":new er(Ne.layout_fill["fill-sort-key"])})}};class ud extends jn{constructor(a){super(a,a_)}recalculate(a,u){super.recalculate(a,u);const p=this.paint._values["fill-outline-color"];p.value.kind==="constant"&&p.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(a){return new zf(a)}queryRadius(){return rd(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:a,geometry:u,transform:p,pixelsToTileUnits:y}){return Qy(Mf(a,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-p.bearingInRadians,y),u)}isTileClipped(){return!0}}const ac=Li([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),Yp=Li([{name:"a_centroid",components:2,type:"Int16"}],4),{members:l_}=ac;class Zo{constructor(a,u,p,y,E){this.properties={},this.extent=p,this.type=0,this.id=void 0,this._pbf=a,this._geometry=-1,this._keys=y,this._values=E,a.readFields(Jp,this,u)}loadGeometry(){const a=this._pbf;a.pos=this._geometry;const u=a.readVarint()+a.pos,p=[];let y,E=1,T=0,P=0,k=0;for(;a.pos<u;){if(T<=0){const D=a.readVarint();E=7&D,T=D>>3}if(T--,E===1||E===2)P+=a.readSVarint(),k+=a.readSVarint(),E===1&&(y&&p.push(y),y=[]),y&&y.push(new m(P,k));else{if(E!==7)throw new Error(`unknown command ${E}`);y&&y.push(y[0].clone())}}return y&&p.push(y),p}bbox(){const a=this._pbf;a.pos=this._geometry;const u=a.readVarint()+a.pos;let p=1,y=0,E=0,T=0,P=1/0,k=-1/0,D=1/0,z=-1/0;for(;a.pos<u;){if(y<=0){const $=a.readVarint();p=7&$,y=$>>3}if(y--,p===1||p===2)E+=a.readSVarint(),T+=a.readSVarint(),E<P&&(P=E),E>k&&(k=E),T<D&&(D=T),T>z&&(z=T);else if(p!==7)throw new Error(`unknown command ${p}`)}return[P,D,k,z]}toGeoJSON(a,u,p){const y=this.extent*Math.pow(2,p),E=this.extent*a,T=this.extent*u,P=this.loadGeometry();function k(Y){return[360*(Y.x+E)/y-180,360/Math.PI*Math.atan(Math.exp((1-2*(Y.y+T)/y)*Math.PI))-90]}function D(Y){return Y.map(k)}let z;if(this.type===1){const Y=[];for(const te of P)Y.push(te[0]);const Q=D(Y);z=Y.length===1?{type:"Point",coordinates:Q[0]}:{type:"MultiPoint",coordinates:Q}}else if(this.type===2){const Y=P.map(D);z=Y.length===1?{type:"LineString",coordinates:Y[0]}:{type:"MultiLineString",coordinates:Y}}else{if(this.type!==3)throw new Error("unknown feature type");{const Y=(function(te){const oe=te.length;if(oe<=1)return[te];const de=[];let ve,Fe;for(let Ee=0;Ee<oe;Ee++){const Re=du(te[Ee]);Re!==0&&(Fe===void 0&&(Fe=Re<0),Fe===Re<0?(ve&&de.push(ve),ve=[te[Ee]]):ve&&ve.push(te[Ee]))}return ve&&de.push(ve),de})(P),Q=[];for(const te of Y)Q.push(te.map(D));z=Q.length===1?{type:"Polygon",coordinates:Q[0]}:{type:"MultiPolygon",coordinates:Q}}}const $={type:"Feature",geometry:z,properties:this.properties};return this.id!=null&&($.id=this.id),$}}function Jp(h,a,u){h===1?a.id=u.readVarint():h===2?(function(p,y){const E=p.readVarint()+p.pos;for(;p.pos<E;){const T=y._keys[p.readVarint()],P=y._values[p.readVarint()];y.properties[T]=P}})(u,a):h===3?a.type=u.readVarint():h===4&&(a._geometry=u.pos)}function du(h){let a=0;for(let u,p,y=0,E=h.length,T=E-1;y<E;T=y++)u=h[y],p=h[T],a+=(p.x-u.x)*(u.y+p.y);return a}Zo.types=["Unknown","Point","LineString","Polygon"];class jf{constructor(a,u){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=a,this._keys=[],this._values=[],this._features=[],a.readFields(Uf,this,u),this.length=this._features.length}feature(a){if(a<0||a>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[a];const u=this._pbf.readVarint()+this._pbf.pos;return new Zo(this._pbf,u,this.extent,this._keys,this._values)}}function Uf(h,a,u){h===15?a.version=u.readVarint():h===1?a.name=u.readString():h===5?a.extent=u.readVarint():h===2?a._features.push(u.pos):h===3?a._keys.push(u.readString()):h===4&&a._values.push((function(p){let y=null;const E=p.readVarint()+p.pos;for(;p.pos<E;){const T=p.readVarint()>>3;y=T===1?p.readString():T===2?p.readFloat():T===3?p.readDouble():T===4?p.readVarint64():T===5?p.readVarint():T===6?p.readSVarint():T===7?p.readBoolean():null}if(y==null)throw new Error("unknown feature value");return y})(u))}class Qp{constructor(a,u){this.layers=a.readFields(em,{},u)}}function em(h,a,u){if(h===3){const p=new jf(u,u.readVarint()+u.pos);p.length&&(a[p.name]=p)}}const hd=Math.pow(2,13);function Un(h,a,u,p,y,E,T,P){h.emplaceBack(a,u,2*Math.floor(p*hd)+T,y*hd*2,E*hd*2,Math.round(P))}class Rl{constructor(a){this.zoom=a.zoom,this.globalState=a.globalState,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map((u=>u.id)),this.index=a.index,this.hasPattern=!1,this.layoutVertexArray=new qe,this.centroidVertexArray=new be,this.indexArray=new ii,this.programConfigurations=new Ns(a.layers,a.zoom),this.segments=new br,this.stateDependentLayerIds=this.layers.filter((u=>u.isStateDependent())).map((u=>u.id))}populate(a,u,p){this.features=[],this.hasPattern=Xp("fill-extrusion",this.layers,u);for(const{feature:y,id:E,index:T,sourceLayerIndex:P}of a){const k=this.layers[0]._featureFilter.needGeometry,D=Ga(y,k);if(!this.layers[0]._featureFilter.filter(new ri(this.zoom,{globalState:this.globalState}),D,p))continue;const z={id:E,sourceLayerIndex:P,index:T,geometry:k?D.geometry:da(y),properties:y.properties,type:y.type,patterns:{}};this.hasPattern?this.features.push(r_("fill-extrusion",this.layers,z,this.zoom,u)):this.addFeature(z,z.geometry,T,p,{},u.subdivisionGranularity),u.featureIndex.insert(y,z.geometry,T,P,this.index,!0)}}addFeatures(a,u,p){for(const y of this.features){const{geometry:E}=y;this.addFeature(y,E,y.index,u,p,a.subdivisionGranularity)}}update(a,u,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,u,this.stateDependentLayers,p)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,l_),this.centroidVertexBuffer=a.createVertexBuffer(this.centroidVertexArray,Yp.members,!0),this.indexBuffer=a.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(a),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(a,u,p,y,E,T){for(const P of Hc(u,500)){const k={x:0,y:0,sampleCount:0},D=this.layoutVertexArray.length;this.processPolygon(k,y,a,P,T);const z=this.layoutVertexArray.length-D,$=Math.floor(k.x/k.sampleCount),Y=Math.floor(k.y/k.sampleCount);for(let Q=0;Q<z;Q++)this.centroidVertexArray.emplaceBack($,Y)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,p,E,y)}processPolygon(a,u,p,y,E){if(y.length<1||c_(y[0]))return;for(const $ of y)$.length!==0&&$a(a,$);const T={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},P=E.fill.getGranularityForZoomLevel(u.z),k=Zo.types[p.type]==="Polygon";for(const $ of y){if($.length===0||c_($))continue;const Y=Di($,P,k);this._generateSideFaces(Y,T)}if(!k)return;const D=uh(y,u,P,!1),z=this.layoutVertexArray;uu((($,Y)=>{Un(z,$,Y,0,0,1,1,0)}),this.segments,this.layoutVertexArray,this.indexArray,D.verticesFlattened,D.indicesTriangles)}_generateSideFaces(a,u){let p=0;for(let y=1;y<a.length;y++){const E=a[y],T=a[y-1];if(bo(E,T))continue;u.segment.vertexLength+4>br.MAX_VERTEX_ARRAY_LENGTH&&(u.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const P=E.sub(T)._perp()._unit(),k=T.dist(E);p+k>32768&&(p=0),Un(this.layoutVertexArray,E.x,E.y,P.x,P.y,0,0,p),Un(this.layoutVertexArray,E.x,E.y,P.x,P.y,0,1,p),p+=k,Un(this.layoutVertexArray,T.x,T.y,P.x,P.y,0,0,p),Un(this.layoutVertexArray,T.x,T.y,P.x,P.y,0,1,p);const D=u.segment.vertexLength;this.indexArray.emplaceBack(D,D+2,D+1),this.indexArray.emplaceBack(D+1,D+2,D+3),u.segment.vertexLength+=4,u.segment.primitiveLength+=2}}}function $a(h,a){for(let u=0;u<a.length;u++){const p=a[u];u===a.length-1&&a[0].x===p.x&&a[0].y===p.y||(h.x+=p.x,h.y+=p.y,h.sampleCount++)}}function bo(h,a){return h.x===a.x&&(h.x<0||h.x>ft)||h.y===a.y&&(h.y<0||h.y>ft)}function c_(h){return h.every((a=>a.x<0))||h.every((a=>a.x>ft))||h.every((a=>a.y<0))||h.every((a=>a.y>ft))}let tm;Ot("FillExtrusionBucket",Rl,{omit:["layers","features"]});var u_={get paint(){return tm=tm||new zn({"fill-extrusion-opacity":new zt(Ne["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new er(Ne["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new zt(Ne["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new zt(Ne["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new za(Ne["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new er(Ne["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new er(Ne["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new zt(Ne["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class bb extends jn{constructor(a){super(a,u_)}createBucket(a){return new Rl(a)}queryRadius(){return rd(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:a,feature:u,featureState:p,geometry:y,transform:E,pixelsToTileUnits:T,pixelPosMatrix:P}){const k=Mf(a,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-E.bearingInRadians,T),D=this.paint.get("fill-extrusion-height").evaluate(u,p),z=this.paint.get("fill-extrusion-base").evaluate(u,p),$=(function(Q,te){const oe=[];for(const de of Q){const ve=[de.x,de.y,0,1];Ft(ve,ve,te),oe.push(new m(ve[0]/ve[3],ve[1]/ve[3]))}return oe})(k,P),Y=(function(Q,te,oe,de){const ve=[],Fe=[],Ee=de[8]*te,Re=de[9]*te,Je=de[10]*te,st=de[11]*te,pt=de[8]*oe,kt=de[9]*oe,Et=de[10]*oe,Mt=de[11]*oe;for(const Yt of Q){const Ct=[],It=[];for(const ct of Yt){const dr=ct.x,xr=ct.y,nr=de[0]*dr+de[4]*xr+de[12],Gt=de[1]*dr+de[5]*xr+de[13],zr=de[2]*dr+de[6]*xr+de[14],en=de[3]*dr+de[7]*xr+de[15],Gn=zr+Je,js=en+st,qa=nr+pt,Yo=Gt+kt,xs=zr+Et,Wi=en+Mt,Xn=new m((nr+Ee)/js,(Gt+Re)/js);Xn.z=Gn/js,Ct.push(Xn);const ws=new m(qa/Wi,Yo/Wi);ws.z=xs/Wi,It.push(ws)}ve.push(Ct),Fe.push(It)}return[ve,Fe]})(y,z,D,P);return(function(Q,te,oe){let de=1/0;Qy(oe,te)&&(de=h_(oe,te[0]));for(let ve=0;ve<te.length;ve++){const Fe=te[ve],Ee=Q[ve];for(let Re=0;Re<Fe.length-1;Re++){const Je=Fe[Re],st=[Je,Fe[Re+1],Ee[Re+1],Ee[Re],Je];Wg(oe,st)&&(de=Math.min(de,h_(oe,st)))}}return de!==1/0&&de})(Y[0],Y[1],$)}}function fa(h,a){return h.x*a.x+h.y*a.y}function h_(h,a){if(h.length===1){let u=0;const p=a[u++];let y;for(;!y||p.equals(y);)if(y=a[u++],!y)return 1/0;for(;u<a.length;u++){const E=a[u],T=h[0],P=y.sub(p),k=E.sub(p),D=T.sub(p),z=fa(P,P),$=fa(P,k),Y=fa(k,k),Q=fa(D,P),te=fa(D,k),oe=z*Y-$*$,de=(Y*Q-$*te)/oe,ve=(z*te-$*Q)/oe,Fe=p.z*(1-de-ve)+y.z*de+E.z*ve;if(isFinite(Fe))return Fe}return 1/0}{let u=1/0;for(const p of a)u=Math.min(u,p.z);return u}}const d_=Li([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:hh}=d_,f_=Li([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:dh}=f_,f0=Math.cos(Math.PI/180*37.5),p_=Math.pow(2,14)/.5;class Vf{constructor(a){this.zoom=a.zoom,this.globalState=a.globalState,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map((u=>u.id)),this.index=a.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((u=>{this.gradients[u.id]={}})),this.layoutVertexArray=new Ze,this.layoutVertexArray2=new tt,this.indexArray=new ii,this.programConfigurations=new Ns(a.layers,a.zoom),this.segments=new br,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((u=>u.isStateDependent())).map((u=>u.id))}populate(a,u,p){this.hasPattern=Xp("line",this.layers,u);const y=this.layers[0].layout.get("line-sort-key"),E=!y.isConstant(),T=[];for(const{feature:P,id:k,index:D,sourceLayerIndex:z}of a){const $=this.layers[0]._featureFilter.needGeometry,Y=Ga(P,$);if(!this.layers[0]._featureFilter.filter(new ri(this.zoom,{globalState:this.globalState}),Y,p))continue;const Q=E?y.evaluate(Y,{},p):void 0,te={id:k,properties:P.properties,type:P.type,sourceLayerIndex:z,index:D,geometry:$?Y.geometry:da(P),patterns:{},sortKey:Q};T.push(te)}E&&T.sort(((P,k)=>P.sortKey-k.sortKey));for(const P of T){const{geometry:k,index:D,sourceLayerIndex:z}=P;if(this.hasPattern){const $=r_("line",this.layers,P,this.zoom,u);this.patternFeatures.push($)}else this.addFeature(P,k,D,p,{},u.subdivisionGranularity);u.featureIndex.insert(a[D].feature,k,D,z,this.index)}}update(a,u,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,u,this.stateDependentLayers,p)}addFeatures(a,u,p){for(const y of this.patternFeatures)this.addFeature(y,y.geometry,y.index,u,p,a.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(a){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=a.createVertexBuffer(this.layoutVertexArray2,dh)),this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,hh),this.indexBuffer=a.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(a),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(a){if(a.properties&&Object.prototype.hasOwnProperty.call(a.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(a.properties,"mapbox_clip_end"))return{start:+a.properties.mapbox_clip_start,end:+a.properties.mapbox_clip_end}}addFeature(a,u,p,y,E,T){const P=this.layers[0].layout,k=P.get("line-join").evaluate(a,{}),D=P.get("line-cap"),z=P.get("line-miter-limit"),$=P.get("line-round-limit");this.lineClips=this.lineFeatureClips(a);for(const Y of u)this.addLine(Y,a,k,D,z,$,y,T);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,p,E,y)}addLine(a,u,p,y,E,T,P,k){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,a=Di(a,P?k.line.getGranularityForZoomLevel(P.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Ee=0;Ee<a.length-1;Ee++)this.totalDistance+=a[Ee].dist(a[Ee+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const D=Zo.types[u.type]==="Polygon";let z=a.length;for(;z>=2&&a[z-1].equals(a[z-2]);)z--;let $=0;for(;$<z-1&&a[$].equals(a[$+1]);)$++;if(z<(D?3:2))return;p==="bevel"&&(E=1.05);const Y=this.overscaling<=16?122880/(512*this.overscaling):0,Q=this.segments.prepareSegment(10*z,this.layoutVertexArray,this.indexArray);let te,oe,de,ve,Fe;this.e1=this.e2=-1,D&&(te=a[z-2],Fe=a[$].sub(te)._unit()._perp());for(let Ee=$;Ee<z;Ee++){if(de=Ee===z-1?D?a[$+1]:void 0:a[Ee+1],de&&a[Ee].equals(de))continue;Fe&&(ve=Fe),te&&(oe=te),te=a[Ee],Fe=de?de.sub(te)._unit()._perp():ve,ve=ve||Fe;let Re=ve.add(Fe);Re.x===0&&Re.y===0||Re._unit();const Je=ve.x*Fe.x+ve.y*Fe.y,st=Re.x*Fe.x+Re.y*Fe.y,pt=st!==0?1/st:1/0,kt=2*Math.sqrt(2-2*st),Et=st<f0&&oe&&de,Mt=ve.x*Fe.y-ve.y*Fe.x>0;if(Et&&Ee>$){const It=te.dist(oe);if(It>2*Y){const ct=te.sub(te.sub(oe)._mult(Y/It)._round());this.updateDistance(oe,ct),this.addCurrentVertex(ct,ve,0,0,Q),oe=ct}}const Yt=oe&&de;let Ct=Yt?p:D?"butt":y;if(Yt&&Ct==="round"&&(pt<T?Ct="miter":pt<=2&&(Ct="fakeround")),Ct==="miter"&&pt>E&&(Ct="bevel"),Ct==="bevel"&&(pt>2&&(Ct="flipbevel"),pt<E&&(Ct="miter")),oe&&this.updateDistance(oe,te),Ct==="miter")Re._mult(pt),this.addCurrentVertex(te,Re,0,0,Q);else if(Ct==="flipbevel"){if(pt>100)Re=Fe.mult(-1);else{const It=pt*ve.add(Fe).mag()/ve.sub(Fe).mag();Re._perp()._mult(It*(Mt?-1:1))}this.addCurrentVertex(te,Re,0,0,Q),this.addCurrentVertex(te,Re.mult(-1),0,0,Q)}else if(Ct==="bevel"||Ct==="fakeround"){const It=-Math.sqrt(pt*pt-1),ct=Mt?It:0,dr=Mt?0:It;if(oe&&this.addCurrentVertex(te,ve,ct,dr,Q),Ct==="fakeround"){const xr=Math.round(180*kt/Math.PI/20);for(let nr=1;nr<xr;nr++){let Gt=nr/xr;if(Gt!==.5){const en=Gt-.5;Gt+=Gt*en*(Gt-1)*((1.0904+Je*(Je*(3.55645-1.43519*Je)-3.2452))*en*en+(.848013+Je*(.215638*Je-1.06021)))}const zr=Fe.sub(ve)._mult(Gt)._add(ve)._unit()._mult(Mt?-1:1);this.addHalfVertex(te,zr.x,zr.y,!1,Mt,0,Q)}}de&&this.addCurrentVertex(te,Fe,-ct,-dr,Q)}else if(Ct==="butt")this.addCurrentVertex(te,Re,0,0,Q);else if(Ct==="square"){const It=oe?1:-1;this.addCurrentVertex(te,Re,It,It,Q)}else Ct==="round"&&(oe&&(this.addCurrentVertex(te,ve,0,0,Q),this.addCurrentVertex(te,ve,1,1,Q,!0)),de&&(this.addCurrentVertex(te,Fe,-1,-1,Q,!0),this.addCurrentVertex(te,Fe,0,0,Q)));if(Et&&Ee<z-1){const It=te.dist(de);if(It>2*Y){const ct=te.add(de.sub(te)._mult(Y/It)._round());this.updateDistance(te,ct),this.addCurrentVertex(ct,Fe,0,0,Q),te=ct}}}}addCurrentVertex(a,u,p,y,E,T=!1){const P=u.y*y-u.x,k=-u.y-u.x*y;this.addHalfVertex(a,u.x+u.y*p,u.y-u.x*p,T,!1,p,E),this.addHalfVertex(a,P,k,T,!0,-y,E),this.distance>p_/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(a,u,p,y,E,T))}addHalfVertex({x:a,y:u},p,y,E,T,P,k){const D=.5*(this.lineClips?this.scaledDistance*(p_-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((a<<1)+(E?1:0),(u<<1)+(T?1:0),Math.round(63*p)+128,Math.round(63*y)+128,1+(P===0?0:P<0?-1:1)|(63&D)<<2,D>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const z=k.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,z,this.e2),k.primitiveLength++),T?this.e2=z:this.e1=z}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(a,u){this.distance+=a.dist(u),this.updateScaledDistance()}}let Gf,p0;Ot("LineBucket",Vf,{omit:["layers","patternFeatures"]});var m0={get paint(){return p0=p0||new zn({"line-opacity":new er(Ne.paint_line["line-opacity"]),"line-color":new er(Ne.paint_line["line-color"]),"line-translate":new zt(Ne.paint_line["line-translate"]),"line-translate-anchor":new zt(Ne.paint_line["line-translate-anchor"]),"line-width":new er(Ne.paint_line["line-width"]),"line-gap-width":new er(Ne.paint_line["line-gap-width"]),"line-offset":new er(Ne.paint_line["line-offset"]),"line-blur":new er(Ne.paint_line["line-blur"]),"line-dasharray":new ca(Ne.paint_line["line-dasharray"]),"line-pattern":new za(Ne.paint_line["line-pattern"]),"line-gradient":new au(Ne.paint_line["line-gradient"])})},get layout(){return Gf=Gf||new zn({"line-cap":new zt(Ne.layout_line["line-cap"]),"line-join":new er(Ne.layout_line["line-join"]),"line-miter-limit":new zt(Ne.layout_line["line-miter-limit"]),"line-round-limit":new zt(Ne.layout_line["line-round-limit"]),"line-sort-key":new er(Ne.layout_line["line-sort-key"])})}};class g0 extends er{possiblyEvaluate(a,u){return u=new ri(Math.floor(u.zoom),{now:u.now,fadeDuration:u.fadeDuration,zoomHistory:u.zoomHistory,transition:u.transition}),super.possiblyEvaluate(a,u)}evaluate(a,u,p,y){return u=pr({},u,{zoom:Math.floor(u.zoom)}),super.evaluate(a,u,p,y)}}let Hf;class fh extends jn{constructor(a){super(a,m0),this.gradientVersion=0,Hf||(Hf=new g0(m0.paint.properties["line-width"].specification),Hf.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(a){if(a==="line-gradient"){const u=this.gradientExpression();this.stepInterpolant=!!(function(p){return p._styleExpression!==void 0})(u)&&u._styleExpression.expression instanceof mi,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(a,u){super.recalculate(a,u),this.paint._values["line-floorwidth"]=Hf.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,a)}createBucket(a){return new Vf(a)}queryRadius(a){const u=a,p=_0(td("line-width",this,u),td("line-gap-width",this,u)),y=td("line-offset",this,u);return p/2+Math.abs(y)+rd(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:a,feature:u,featureState:p,geometry:y,transform:E,pixelsToTileUnits:T}){const P=Mf(a,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-E.bearingInRadians,T),k=T/2*_0(this.paint.get("line-width").evaluate(u,p),this.paint.get("line-gap-width").evaluate(u,p)),D=this.paint.get("line-offset").evaluate(u,p);return D&&(y=(function(z,$){const Y=[];for(let Q=0;Q<z.length;Q++){const te=z[Q],oe=[];for(let de=0;de<te.length;de++){const ve=te[de-1],Fe=te[de],Ee=te[de+1],Re=de===0?new m(0,0):Fe.sub(ve)._unit()._perp(),Je=de===te.length-1?new m(0,0):Ee.sub(Fe)._unit()._perp(),st=Re._add(Je)._unit(),pt=st.x*Je.x+st.y*Je.y;pt!==0&&st._mult(1/pt),oe.push(st._mult($)._add(Fe))}Y.push(oe)}return Y})(y,D*T)),(function(z,$,Y){for(let Q=0;Q<$.length;Q++){const te=$[Q];if(z.length>=3){for(let oe=0;oe<te.length;oe++)if(ah(z,te[oe]))return!0}if(yo(z,te,Y))return!0}return!1})(P,y,k)}isTileClipped(){return!0}}function _0(h,a){return a>0?a+2*h:h}const dd=Li([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),y0=Li([{name:"a_projected_pos",components:3,type:"Float32"}],4);Li([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const cn=Li([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);Li([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const v0=Li([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),b0=Li([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function xb(h,a,u){return h.sections.forEach((p=>{p.text=(function(y,E,T){const P=E.layout.get("text-transform").evaluate(T,{});return P==="uppercase"?y=y.toLocaleUpperCase():P==="lowercase"&&(y=y.toLocaleLowerCase()),po.applyArabicShaping&&(y=po.applyArabicShaping(y)),y})(p.text,a,u)})),h}Li([{name:"triangle",components:3,type:"Uint16"}]),Li([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Li([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),Li([{type:"Float32",name:"offsetX"}]),Li([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),Li([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const $f={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var xn=24;const rm=4294967296,x0=1/rm,Xo=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");class Wf{constructor(a=new Uint8Array(16)){this.buf=ArrayBuffer.isView(a)?a:new Uint8Array(a),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(a,u,p=this.length){for(;this.pos<p;){const y=this.readVarint(),E=y>>3,T=this.pos;this.type=7&y,a(E,u,this),this.pos===T&&this.skip(y)}return u}readMessage(a,u){return this.readFields(a,u,this.readVarint()+this.pos)}readFixed32(){const a=this.dataView.getUint32(this.pos,!0);return this.pos+=4,a}readSFixed32(){const a=this.dataView.getInt32(this.pos,!0);return this.pos+=4,a}readFixed64(){const a=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*rm;return this.pos+=8,a}readSFixed64(){const a=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*rm;return this.pos+=8,a}readFloat(){const a=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,a}readDouble(){const a=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,a}readVarint(a){const u=this.buf;let p,y;return y=u[this.pos++],p=127&y,y<128?p:(y=u[this.pos++],p|=(127&y)<<7,y<128?p:(y=u[this.pos++],p|=(127&y)<<14,y<128?p:(y=u[this.pos++],p|=(127&y)<<21,y<128?p:(y=u[this.pos],p|=(15&y)<<28,(function(E,T,P){const k=P.buf;let D,z;if(z=k[P.pos++],D=(112&z)>>4,z<128||(z=k[P.pos++],D|=(127&z)<<3,z<128)||(z=k[P.pos++],D|=(127&z)<<10,z<128)||(z=k[P.pos++],D|=(127&z)<<17,z<128)||(z=k[P.pos++],D|=(127&z)<<24,z<128)||(z=k[P.pos++],D|=(1&z)<<31,z<128))return wb(E,D,T);throw new Error("Expected varint not more than 10 bytes")})(p,a,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const a=this.readVarint();return a%2==1?(a+1)/-2:a/2}readBoolean(){return!!this.readVarint()}readString(){const a=this.readVarint()+this.pos,u=this.pos;return this.pos=a,a-u>=12&&Xo?Xo.decode(this.buf.subarray(u,a)):(function(p,y,E){let T="",P=y;for(;P<E;){const k=p[P];let D,z,$,Y=null,Q=k>239?4:k>223?3:k>191?2:1;if(P+Q>E)break;Q===1?k<128&&(Y=k):Q===2?(D=p[P+1],(192&D)==128&&(Y=(31&k)<<6|63&D,Y<=127&&(Y=null))):Q===3?(D=p[P+1],z=p[P+2],(192&D)==128&&(192&z)==128&&(Y=(15&k)<<12|(63&D)<<6|63&z,(Y<=2047||Y>=55296&&Y<=57343)&&(Y=null))):Q===4&&(D=p[P+1],z=p[P+2],$=p[P+3],(192&D)==128&&(192&z)==128&&(192&$)==128&&(Y=(15&k)<<18|(63&D)<<12|(63&z)<<6|63&$,(Y<=65535||Y>=1114112)&&(Y=null))),Y===null?(Y=65533,Q=1):Y>65535&&(Y-=65536,T+=String.fromCharCode(Y>>>10&1023|55296),Y=56320|1023&Y),T+=String.fromCharCode(Y),P+=Q}return T})(this.buf,u,a)}readBytes(){const a=this.readVarint()+this.pos,u=this.buf.subarray(this.pos,a);return this.pos=a,u}readPackedVarint(a=[],u){const p=this.readPackedEnd();for(;this.pos<p;)a.push(this.readVarint(u));return a}readPackedSVarint(a=[]){const u=this.readPackedEnd();for(;this.pos<u;)a.push(this.readSVarint());return a}readPackedBoolean(a=[]){const u=this.readPackedEnd();for(;this.pos<u;)a.push(this.readBoolean());return a}readPackedFloat(a=[]){const u=this.readPackedEnd();for(;this.pos<u;)a.push(this.readFloat());return a}readPackedDouble(a=[]){const u=this.readPackedEnd();for(;this.pos<u;)a.push(this.readDouble());return a}readPackedFixed32(a=[]){const u=this.readPackedEnd();for(;this.pos<u;)a.push(this.readFixed32());return a}readPackedSFixed32(a=[]){const u=this.readPackedEnd();for(;this.pos<u;)a.push(this.readSFixed32());return a}readPackedFixed64(a=[]){const u=this.readPackedEnd();for(;this.pos<u;)a.push(this.readFixed64());return a}readPackedSFixed64(a=[]){const u=this.readPackedEnd();for(;this.pos<u;)a.push(this.readSFixed64());return a}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(a){const u=7&a;if(u===0)for(;this.buf[this.pos++]>127;);else if(u===2)this.pos=this.readVarint()+this.pos;else if(u===5)this.pos+=4;else{if(u!==1)throw new Error(`Unimplemented type: ${u}`);this.pos+=8}}writeTag(a,u){this.writeVarint(a<<3|u)}realloc(a){let u=this.length||16;for(;u<this.pos+a;)u*=2;if(u!==this.length){const p=new Uint8Array(u);p.set(this.buf),this.buf=p,this.dataView=new DataView(p.buffer),this.length=u}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(a){this.realloc(4),this.dataView.setInt32(this.pos,a,!0),this.pos+=4}writeSFixed32(a){this.realloc(4),this.dataView.setInt32(this.pos,a,!0),this.pos+=4}writeFixed64(a){this.realloc(8),this.dataView.setInt32(this.pos,-1&a,!0),this.dataView.setInt32(this.pos+4,Math.floor(a*x0),!0),this.pos+=8}writeSFixed64(a){this.realloc(8),this.dataView.setInt32(this.pos,-1&a,!0),this.dataView.setInt32(this.pos+4,Math.floor(a*x0),!0),this.pos+=8}writeVarint(a){(a=+a||0)>268435455||a<0?(function(u,p){let y,E;if(u>=0?(y=u%4294967296|0,E=u/4294967296|0):(y=~(-u%4294967296),E=~(-u/4294967296),4294967295^y?y=y+1|0:(y=0,E=E+1|0)),u>=18446744073709552e3||u<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");p.realloc(10),(function(T,P,k){k.buf[k.pos++]=127&T|128,T>>>=7,k.buf[k.pos++]=127&T|128,T>>>=7,k.buf[k.pos++]=127&T|128,T>>>=7,k.buf[k.pos++]=127&T|128,k.buf[k.pos]=127&(T>>>=7)})(y,0,p),(function(T,P){const k=(7&T)<<4;P.buf[P.pos++]|=k|((T>>>=3)?128:0),T&&(P.buf[P.pos++]=127&T|((T>>>=7)?128:0),T&&(P.buf[P.pos++]=127&T|((T>>>=7)?128:0),T&&(P.buf[P.pos++]=127&T|((T>>>=7)?128:0),T&&(P.buf[P.pos++]=127&T|((T>>>=7)?128:0),T&&(P.buf[P.pos++]=127&T)))))})(E,p)})(a,this):(this.realloc(4),this.buf[this.pos++]=127&a|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=a>>>7&127))))}writeSVarint(a){this.writeVarint(a<0?2*-a-1:2*a)}writeBoolean(a){this.writeVarint(+a)}writeString(a){a=String(a),this.realloc(4*a.length),this.pos++;const u=this.pos;this.pos=(function(y,E,T){for(let P,k,D=0;D<E.length;D++){if(P=E.charCodeAt(D),P>55295&&P<57344){if(!k){P>56319||D+1===E.length?(y[T++]=239,y[T++]=191,y[T++]=189):k=P;continue}if(P<56320){y[T++]=239,y[T++]=191,y[T++]=189,k=P;continue}P=k-55296<<10|P-56320|65536,k=null}else k&&(y[T++]=239,y[T++]=191,y[T++]=189,k=null);P<128?y[T++]=P:(P<2048?y[T++]=P>>6|192:(P<65536?y[T++]=P>>12|224:(y[T++]=P>>18|240,y[T++]=P>>12&63|128),y[T++]=P>>6&63|128),y[T++]=63&P|128)}return T})(this.buf,a,this.pos);const p=this.pos-u;p>=128&&lc(u,p,this),this.pos=u-1,this.writeVarint(p),this.pos+=p}writeFloat(a){this.realloc(4),this.dataView.setFloat32(this.pos,a,!0),this.pos+=4}writeDouble(a){this.realloc(8),this.dataView.setFloat64(this.pos,a,!0),this.pos+=8}writeBytes(a){const u=a.length;this.writeVarint(u),this.realloc(u);for(let p=0;p<u;p++)this.buf[this.pos++]=a[p]}writeRawMessage(a,u){this.pos++;const p=this.pos;a(u,this);const y=this.pos-p;y>=128&&lc(p,y,this),this.pos=p-1,this.writeVarint(y),this.pos+=y}writeMessage(a,u,p){this.writeTag(a,2),this.writeRawMessage(u,p)}writePackedVarint(a,u){u.length&&this.writeMessage(a,im,u)}writePackedSVarint(a,u){u.length&&this.writeMessage(a,ph,u)}writePackedBoolean(a,u){u.length&&this.writeMessage(a,g_,u)}writePackedFloat(a,u){u.length&&this.writeMessage(a,nm,u)}writePackedDouble(a,u){u.length&&this.writeMessage(a,m_,u)}writePackedFixed32(a,u){u.length&&this.writeMessage(a,Eb,u)}writePackedSFixed32(a,u){u.length&&this.writeMessage(a,__,u)}writePackedFixed64(a,u){u.length&&this.writeMessage(a,Ab,u)}writePackedSFixed64(a,u){u.length&&this.writeMessage(a,w0,u)}writeBytesField(a,u){this.writeTag(a,2),this.writeBytes(u)}writeFixed32Field(a,u){this.writeTag(a,5),this.writeFixed32(u)}writeSFixed32Field(a,u){this.writeTag(a,5),this.writeSFixed32(u)}writeFixed64Field(a,u){this.writeTag(a,1),this.writeFixed64(u)}writeSFixed64Field(a,u){this.writeTag(a,1),this.writeSFixed64(u)}writeVarintField(a,u){this.writeTag(a,0),this.writeVarint(u)}writeSVarintField(a,u){this.writeTag(a,0),this.writeSVarint(u)}writeStringField(a,u){this.writeTag(a,2),this.writeString(u)}writeFloatField(a,u){this.writeTag(a,5),this.writeFloat(u)}writeDoubleField(a,u){this.writeTag(a,1),this.writeDouble(u)}writeBooleanField(a,u){this.writeVarintField(a,+u)}}function wb(h,a,u){return u?4294967296*a+(h>>>0):4294967296*(a>>>0)+(h>>>0)}function lc(h,a,u){const p=a<=16383?1:a<=2097151?2:a<=268435455?3:Math.floor(Math.log(a)/(7*Math.LN2));u.realloc(p);for(let y=u.pos-1;y>=h;y--)u.buf[y+p]=u.buf[y]}function im(h,a){for(let u=0;u<h.length;u++)a.writeVarint(h[u])}function ph(h,a){for(let u=0;u<h.length;u++)a.writeSVarint(h[u])}function nm(h,a){for(let u=0;u<h.length;u++)a.writeFloat(h[u])}function m_(h,a){for(let u=0;u<h.length;u++)a.writeDouble(h[u])}function g_(h,a){for(let u=0;u<h.length;u++)a.writeBoolean(h[u])}function Eb(h,a){for(let u=0;u<h.length;u++)a.writeFixed32(h[u])}function __(h,a){for(let u=0;u<h.length;u++)a.writeSFixed32(h[u])}function Ab(h,a){for(let u=0;u<h.length;u++)a.writeFixed64(h[u])}function w0(h,a){for(let u=0;u<h.length;u++)a.writeSFixed64(h[u])}function E0(h,a,u){h===1&&u.readMessage(sm,a)}function sm(h,a,u){if(h===3){const{id:p,bitmap:y,width:E,height:T,left:P,top:k,advance:D}=u.readMessage(om,{});a.push({id:p,bitmap:new qo({width:E+6,height:T+6},y),metrics:{width:E,height:T,left:P,top:k,advance:D}})}}function om(h,a,u){h===1?a.id=u.readVarint():h===2?a.bitmap=u.readBytes():h===3?a.width=u.readVarint():h===4?a.height=u.readVarint():h===5?a.left=u.readSVarint():h===6?a.top=u.readSVarint():h===7&&(a.advance=u.readVarint())}function y_(h){let a=0,u=0;for(const T of h)a+=T.w*T.h,u=Math.max(u,T.w);h.sort(((T,P)=>P.h-T.h));const p=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(a/.95)),u),h:1/0}];let y=0,E=0;for(const T of h)for(let P=p.length-1;P>=0;P--){const k=p[P];if(!(T.w>k.w||T.h>k.h)){if(T.x=k.x,T.y=k.y,E=Math.max(E,T.y+T.h),y=Math.max(y,T.x+T.w),T.w===k.w&&T.h===k.h){const D=p.pop();D&&P<p.length&&(p[P]=D)}else T.h===k.h?(k.x+=T.w,k.w-=T.w):T.w===k.w?(k.y+=T.h,k.h-=T.h):(p.push({x:k.x+T.w,y:k.y,w:k.w-T.w,h:T.h}),k.y+=T.h,k.h-=T.h);break}}return{w:y,h:E,fill:a/(y*E)||0}}class qf{constructor(a,{pixelRatio:u,version:p,stretchX:y,stretchY:E,content:T,textFitWidth:P,textFitHeight:k}){this.paddedRect=a,this.pixelRatio=u,this.stretchX=y,this.stretchY=E,this.content=T,this.version=p,this.textFitWidth=P,this.textFitHeight=k}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class A0{constructor(a,u){const p={},y={};this.haveRenderCallbacks=[];const E=[];this.addImages(a,p,E),this.addImages(u,y,E);const{w:T,h:P}=y_(E),k=new to({width:T||1,height:P||1});for(const D in a){const z=a[D],$=p[D].paddedRect;to.copy(z.data,k,{x:0,y:0},{x:$.x+1,y:$.y+1},z.data)}for(const D in u){const z=u[D],$=y[D].paddedRect,Y=$.x+1,Q=$.y+1,te=z.data.width,oe=z.data.height;to.copy(z.data,k,{x:0,y:0},{x:Y,y:Q},z.data),to.copy(z.data,k,{x:0,y:oe-1},{x:Y,y:Q-1},{width:te,height:1}),to.copy(z.data,k,{x:0,y:0},{x:Y,y:Q+oe},{width:te,height:1}),to.copy(z.data,k,{x:te-1,y:0},{x:Y-1,y:Q},{width:1,height:oe}),to.copy(z.data,k,{x:0,y:0},{x:Y+te,y:Q},{width:1,height:oe})}this.image=k,this.iconPositions=p,this.patternPositions=y}addImages(a,u,p){for(const y in a){const E=a[y],T={x:0,y:0,w:E.data.width+2,h:E.data.height+2};p.push(T),u[y]=new qf(T,E),E.hasRenderCallback&&this.haveRenderCallbacks.push(y)}}patchUpdatedImages(a,u){a.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const p in a.updatedImages)this.patchUpdatedImage(this.iconPositions[p],a.getImage(p),u),this.patchUpdatedImage(this.patternPositions[p],a.getImage(p),u)}patchUpdatedImage(a,u,p){if(!a||!u||a.version===u.version)return;a.version=u.version;const[y,E]=a.tl;p.update(u.data,void 0,{x:y,y:E})}}var cc;Ot("ImagePosition",qf),Ot("ImageAtlas",A0),c.ao=void 0,(cc=c.ao||(c.ao={}))[cc.none=0]="none",cc[cc.horizontal=1]="horizontal",cc[cc.vertical=2]="vertical",cc[cc.horizontalOnly=3]="horizontalOnly";class mh{constructor(){this.scale=1,this.fontStack="",this.imageName=null,this.verticalAlign="bottom"}static forText(a,u,p){const y=new mh;return y.scale=a||1,y.fontStack=u,y.verticalAlign=p||"bottom",y}static forImage(a,u){const p=new mh;return p.imageName=a,p.verticalAlign=u||"bottom",p}}class uc{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(a,u){const p=new uc;for(let y=0;y<a.sections.length;y++){const E=a.sections[y];E.image?p.addImageSection(E):p.addTextSection(E,u)}return p}length(){return this.text.length}getSection(a){return this.sections[this.sectionIndex[a]]}getSectionIndex(a){return this.sectionIndex[a]}getCharCode(a){return this.text.charCodeAt(a)}verticalizePunctuation(){this.text=(function(a){let u="";for(let p=0;p<a.length;p++){const y=a.charCodeAt(p+1)||null,E=a.charCodeAt(p-1)||null;u+=y&&Af(y)&&!$f[a[p+1]]||E&&Af(E)&&!$f[a[p-1]]||!$f[a[p]]?a[p]:$f[a[p]]}return u})(this.text)}trim(){let a=0;for(let p=0;p<this.text.length&&gh[this.text.charCodeAt(p)];p++)a++;let u=this.text.length;for(let p=this.text.length-1;p>=0&&p>=a&&gh[this.text.charCodeAt(p)];p--)u--;this.text=this.text.substring(a,u),this.sectionIndex=this.sectionIndex.slice(a,u)}substring(a,u){const p=new uc;return p.text=this.text.substring(a,u),p.sectionIndex=this.sectionIndex.slice(a,u),p.sections=this.sections,p}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((a,u)=>Math.max(a,this.sections[u].scale)),0)}getMaxImageSize(a){let u=0,p=0;for(let y=0;y<this.length();y++){const E=this.getSection(y);if(E.imageName){const T=a[E.imageName];if(!T)continue;const P=T.displaySize;u=Math.max(u,P[0]),p=Math.max(p,P[1])}}return{maxImageWidth:u,maxImageHeight:p}}addTextSection(a,u){this.text+=a.text,this.sections.push(mh.forText(a.scale,a.fontStack||u,a.verticalAlign));const p=this.sections.length-1;for(let y=0;y<a.text.length;++y)this.sectionIndex.push(p)}addImageSection(a){const u=a.image?a.image.name:"";if(u.length===0)return void si("Can't add FormattedSection with an empty image.");const p=this.getNextImageSectionCharCode();p?(this.text+=String.fromCharCode(p),this.sections.push(mh.forImage(u,a.verticalAlign)),this.sectionIndex.push(this.sections.length-1)):si("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function fd(h,a,u,p,y,E,T,P,k,D,z,$,Y,Q,te){const oe=uc.fromFeature(h,y);let de;$===c.ao.vertical&&oe.verticalizePunctuation();const{processBidirectionalText:ve,processStyledBidirectionalText:Fe}=po;if(ve&&oe.sections.length===1){de=[];const Je=ve(oe.toString(),f(oe,D,E,a,p,Q));for(const st of Je){const pt=new uc;pt.text=st,pt.sections=oe.sections;for(let kt=0;kt<st.length;kt++)pt.sectionIndex.push(0);de.push(pt)}}else if(Fe){de=[];const Je=Fe(oe.text,oe.sectionIndex,f(oe,D,E,a,p,Q));for(const st of Je){const pt=new uc;pt.text=st[0],pt.sectionIndex=st[1],pt.sections=oe.sections,de.push(pt)}}else de=(function(Je,st){const pt=[],kt=Je.text;let Et=0;for(const Mt of st)pt.push(Je.substring(Et,Mt)),Et=Mt;return Et<kt.length&&pt.push(Je.substring(Et,kt.length)),pt})(oe,f(oe,D,E,a,p,Q));const Ee=[],Re={positionedLines:Ee,text:oe.toString(),top:z[1],bottom:z[1],left:z[0],right:z[0],writingMode:$,iconsInText:!1,verticalizable:!1};return(function(Je,st,pt,kt,Et,Mt,Yt,Ct,It,ct,dr,xr){let nr=0,Gt=0,zr=0,en=0;const Gn=Ct==="right"?1:Ct==="left"?0:.5,js=xn/xr;let qa=0;for(const Wi of Et){Wi.trim();const Xn=Wi.getMaxScale(),ws={positionedGlyphs:[],lineOffset:0};Je.positionedLines[qa]=ws;const Es=ws.positionedGlyphs;let xo=0;if(!Wi.length()){Gt+=Mt,++qa;continue}const Ka=S(kt,Wi,js);for(let Jo=0;Jo<Wi.length();Jo++){const Hn=Wi.getSection(Jo),Jn=Wi.getSectionIndex(Jo),Qn=Wi.getCharCode(Jo),Rn=N(It,dr,Qn);let Ci;if(Hn.imageName){if(Je.iconsInText=!0,Hn.scale=Hn.scale*js,Ci=le(Hn,Rn,Xn,Ka,kt),!Ci)continue;xo=Math.max(xo,Ci.imageOffset)}else if(Ci=H(Hn,Qn,Rn,Ka,st,pt),!Ci)continue;const{rect:dc,metrics:cm,baselineOffset:fc}=Ci;Es.push({glyph:Qn,imageName:Hn.imageName,x:nr,y:Gt+fc+-17,vertical:Rn,scale:Hn.scale,fontStack:Hn.fontStack,sectionIndex:Jn,metrics:cm,rect:dc}),Rn?(Je.verticalizable=!0,nr+=(Hn.imageName?cm.advance:xn)*Hn.scale+ct):nr+=cm.advance*Hn.scale+ct}Es.length!==0&&(zr=Math.max(nr-ct,zr),Ae(Es,0,Es.length-1,Gn)),nr=0,ws.lineOffset=Math.max(xo,(Xn-1)*xn);const Yn=Mt*Xn+xo;Gt+=Yn,en=Math.max(Yn,en),++qa}const{horizontalAlign:Yo,verticalAlign:xs}=_(Yt);(function(Wi,Xn,ws,Es,xo,Ka,Yn,Jo,Hn){const Jn=(Xn-ws)*xo;let Qn=0;Qn=Ka!==Yn?-Jo*Es- -17:-Es*Hn*Yn+.5*Yn;for(const Rn of Wi)for(const Ci of Rn.positionedGlyphs)Ci.x+=Jn,Ci.y+=Qn})(Je.positionedLines,Gn,Yo,xs,zr,en,Mt,Gt,Et.length),Je.top+=-xs*Gt,Je.bottom=Je.top+Gt,Je.left+=-Yo*zr,Je.right=Je.left+zr})(Re,a,u,p,de,T,P,k,$,D,Y,te),!(function(Je){for(const st of Je)if(st.positionedGlyphs.length!==0)return!1;return!0})(Ee)&&Re}const gh={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},T0={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},Tb={40:!0};function Kf(h,a,u,p,y,E){if(a.imageName){const T=p[a.imageName];return T?T.displaySize[0]*a.scale*xn/E+y:0}{const T=u[a.fontStack],P=T&&T[h];return P?P.metrics.advance*a.scale+y:0}}function S0(h,a,u,p){const y=Math.pow(h-a,2);return p?h<a?y/2:2*y:y+Math.abs(u)*u}function Zf(h,a,u){let p=0;return h===10&&(p-=1e4),u&&(p+=150),h!==40&&h!==65288||(p+=50),a!==41&&a!==65289||(p+=50),p}function C0(h,a,u,p,y,E){let T=null,P=S0(a,u,y,E);for(const k of p){const D=S0(a-k.x,u,y,E)+k.badness;D<=P&&(T=k,P=D)}return{index:h,x:a,priorBreak:T,badness:P}}function Xf(h){return h?Xf(h.priorBreak).concat(h.index):[]}function f(h,a,u,p,y,E){if(!h)return[];const T=[],P=(function($,Y,Q,te,oe,de){let ve=0;for(let Fe=0;Fe<$.length();Fe++){const Ee=$.getSection(Fe);ve+=Kf($.getCharCode(Fe),Ee,te,oe,Y,de)}return ve/Math.max(1,Math.ceil(ve/Q))})(h,a,u,p,y,E),k=h.text.indexOf("")>=0;let D=0;for(let $=0;$<h.length();$++){const Y=h.getSection($),Q=h.getCharCode($);if(gh[Q]||(D+=Kf(Q,Y,p,y,a,E)),$<h.length()-1){const te=!((z=Q)<11904)&&(!!Or["CJK Compatibility Forms"](z)||!!Or["CJK Compatibility"](z)||!!Or["CJK Strokes"](z)||!!Or["CJK Symbols and Punctuation"](z)||!!Or["Enclosed CJK Letters and Months"](z)||!!Or["Halfwidth and Fullwidth Forms"](z)||!!Or["Ideographic Description Characters"](z)||!!Or["Vertical Forms"](z)||Ys.test(String.fromCodePoint(z)));(T0[Q]||te||Y.imageName||$!==h.length()-2&&Tb[h.getCharCode($+1)])&&T.push(C0($+1,D,P,T,Zf(Q,h.getCharCode($+1),te&&k),!1))}}var z;return Xf(C0(h.length(),D,P,T,0,!0))}function _(h){let a=.5,u=.5;switch(h){case"right":case"top-right":case"bottom-right":a=1;break;case"left":case"top-left":case"bottom-left":a=0}switch(h){case"bottom":case"bottom-right":case"bottom-left":u=1;break;case"top":case"top-right":case"top-left":u=0}return{horizontalAlign:a,verticalAlign:u}}function S(h,a,u){const p=a.getMaxScale()*xn,{maxImageWidth:y,maxImageHeight:E}=a.getMaxImageSize(h),T=Math.max(p,E*u);return{verticalLineContentWidth:Math.max(p,y*u),horizontalLineContentHeight:T}}function I(h){switch(h){case"top":return 0;case"center":return .5;default:return 1}}function N(h,a,u){return!(h===c.ao.horizontal||!a&&!Zh(u)||a&&(gh[u]||(p=u,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(p)))));var p}function H(h,a,u,p,y,E){const T=E[h.fontStack],P=(function(D,z,$,Y){if(D&&D.rect)return D;const Q=z[$.fontStack],te=Q&&Q[Y];return te?{rect:null,metrics:te.metrics}:null})(T&&T[a],y,h,a);if(P===null)return null;let k;if(u)k=p.verticalLineContentWidth-h.scale*xn;else{const D=I(h.verticalAlign);k=(p.horizontalLineContentHeight-h.scale*xn)*D}return{rect:P.rect,metrics:P.metrics,baselineOffset:k}}function le(h,a,u,p,y){const E=y[h.imageName];if(!E)return null;const T=E.paddedRect,P=E.displaySize,k={width:P[0],height:P[1],left:1,top:-3,advance:a?P[1]:P[0]};let D;if(a)D=p.verticalLineContentWidth-P[1]*h.scale;else{const z=I(h.verticalAlign);D=(p.horizontalLineContentHeight-P[1]*h.scale)*z}return{rect:T,metrics:k,baselineOffset:D,imageOffset:(a?P[0]:P[1])*h.scale-xn*u}}function Ae(h,a,u,p){if(p===0)return;const y=h[u],E=(h[u].x+y.metrics.advance*y.scale)*p;for(let T=a;T<=u;T++)h[T].x-=E}function Le(h,a,u){const{horizontalAlign:p,verticalAlign:y}=_(u),E=a[0]-h.displaySize[0]*p,T=a[1]-h.displaySize[1]*y;return{image:h,top:T,bottom:T+h.displaySize[1],left:E,right:E+h.displaySize[0]}}function ot(h){var a,u;let p=h.left,y=h.top,E=h.right-p,T=h.bottom-y;const P=(a=h.image.textFitWidth)!==null&&a!==void 0?a:"stretchOrShrink",k=(u=h.image.textFitHeight)!==null&&u!==void 0?u:"stretchOrShrink",D=(h.image.content[2]-h.image.content[0])/(h.image.content[3]-h.image.content[1]);if(k==="proportional"){if(P==="stretchOnly"&&E/T<D||P==="proportional"){const z=Math.ceil(T*D);p*=z/E,E=z}}else if(P==="proportional"&&k==="stretchOnly"&&D!==0&&E/T>D){const z=Math.ceil(E/D);y*=z/T,T=z}return{x1:p,y1:y,x2:p+E,y2:y+T}}function xt(h,a,u,p,y,E){const T=h.image;let P;if(T.content){const de=T.content,ve=T.pixelRatio||1;P=[de[0]/ve,de[1]/ve,T.displaySize[0]-de[2]/ve,T.displaySize[1]-de[3]/ve]}const k=a.left*E,D=a.right*E;let z,$,Y,Q;u==="width"||u==="both"?(Q=y[0]+k-p[3],$=y[0]+D+p[1]):(Q=y[0]+(k+D-T.displaySize[0])/2,$=Q+T.displaySize[0]);const te=a.top*E,oe=a.bottom*E;return u==="height"||u==="both"?(z=y[1]+te-p[0],Y=y[1]+oe+p[2]):(z=y[1]+(te+oe-T.displaySize[1])/2,Y=z+T.displaySize[1]),{image:T,top:z,right:$,bottom:Y,left:Q,collisionPadding:P}}const vt=128,gt=32640;function Vt(h,a){const{expression:u}=a;if(u.kind==="constant")return{kind:"constant",layoutSize:u.evaluate(new ri(h+1))};if(u.kind==="source")return{kind:"source"};{const{zoomStops:p,interpolationType:y}=u;let E=0;for(;E<p.length&&p[E]<=h;)E++;E=Math.max(0,E-1);let T=E;for(;T<p.length&&p[T]<h+1;)T++;T=Math.min(p.length-1,T);const P=p[E],k=p[T];return u.kind==="composite"?{kind:"composite",minZoom:P,maxZoom:k,interpolationType:y}:{kind:"camera",minZoom:P,maxZoom:k,minSize:u.evaluate(new ri(P)),maxSize:u.evaluate(new ri(k)),interpolationType:y}}}function Kt(h,a,u){let p="never";const y=h.get(a);return y?p=y:h.get(u)&&(p="always"),p}const tr=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function $i(h,a,u,p,y,E,T,P,k,D,z,$,Y){const Q=P?Math.min(gt,Math.round(P[0])):0,te=P?Math.min(gt,Math.round(P[1])):0;h.emplaceBack(a,u,Math.round(32*p),Math.round(32*y),E,T,(Q<<1)+(k?1:0),te,16*D,16*z,256*$,256*Y)}function Qe(h,a,u){h.emplaceBack(a.x,a.y,u),h.emplaceBack(a.x,a.y,u),h.emplaceBack(a.x,a.y,u),h.emplaceBack(a.x,a.y,u)}function Ue(h){for(const a of h.sections)if(rh(a.text))return!0;return!1}class it{constructor(a){this.layoutVertexArray=new wt,this.indexArray=new ii,this.programConfigurations=a,this.segments=new br,this.dynamicLayoutVertexArray=new ut,this.opacityVertexArray=new jt,this.hasVisibleVertices=!1,this.placedSymbolArray=new re}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(a,u,p,y){this.isEmpty()||(p&&(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,dd.members),this.indexBuffer=a.createIndexBuffer(this.indexArray,u),this.dynamicLayoutVertexBuffer=a.createVertexBuffer(this.dynamicLayoutVertexArray,y0.members,!0),this.opacityVertexBuffer=a.createVertexBuffer(this.opacityVertexArray,tr,!0),this.opacityVertexBuffer.itemSize=1),(p||y)&&this.programConfigurations.upload(a))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Ot("SymbolBuffers",it);class Rt{constructor(a,u,p){this.layoutVertexArray=new a,this.layoutAttributes=u,this.indexArray=new p,this.segments=new br,this.collisionVertexArray=new Gr}upload(a){this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=a.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=a.createVertexBuffer(this.collisionVertexArray,cn.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Ot("CollisionBuffers",Rt);class Xt{constructor(a){this.collisionBoxArray=a.collisionBoxArray,this.zoom=a.zoom,this.globalState=a.globalState,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map((T=>T.id)),this.index=a.index,this.pixelRatio=a.pixelRatio,this.sourceLayerIndex=a.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];const u=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Vt(this.zoom,u["text-size"]),this.iconSizeData=Vt(this.zoom,u["icon-size"]);const p=this.layers[0].layout,y=p.get("symbol-sort-key"),E=p.get("symbol-z-order");this.canOverlap=Kt(p,"text-overlap","text-allow-overlap")!=="never"||Kt(p,"icon-overlap","icon-allow-overlap")!=="never"||p.get("text-ignore-placement")||p.get("icon-ignore-placement"),this.sortFeaturesByKey=E!=="viewport-y"&&!y.isConstant(),this.sortFeaturesByY=(E==="viewport-y"||E==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,p.get("symbol-placement")==="point"&&(this.writingModes=p.get("text-writing-mode").map((T=>c.ao[T]))),this.stateDependentLayerIds=this.layers.filter((T=>T.isStateDependent())).map((T=>T.id)),this.sourceID=a.sourceID}createArrays(){this.text=new it(new Ns(this.layers,this.zoom,(a=>/^text/.test(a)))),this.icon=new it(new Ns(this.layers,this.zoom,(a=>/^icon/.test(a)))),this.glyphOffsetArray=new pe,this.lineVertexArray=new _e,this.symbolInstances=new fe,this.textAnchorOffsets=new ye}calculateGlyphDependencies(a,u,p,y,E){for(let T=0;T<a.length;T++)if(u[a.charCodeAt(T)]=!0,(p||y)&&E){const P=$f[a.charAt(T)];P&&(u[P.charCodeAt(0)]=!0)}}populate(a,u,p){const y=this.layers[0],E=y.layout,T=E.get("text-font"),P=E.get("text-field"),k=E.get("icon-image"),D=(P.value.kind!=="constant"||P.value.value instanceof Gi&&!P.value.value.isEmpty()||P.value.value.toString().length>0)&&(T.value.kind!=="constant"||T.value.value.length>0),z=k.value.kind!=="constant"||!!k.value.value||Object.keys(k.parameters).length>0,$=E.get("symbol-sort-key");if(this.features=[],!D&&!z)return;const Y=u.iconDependencies,Q=u.glyphDependencies,te=u.availableImages,oe=new ri(this.zoom,{globalState:this.globalState});for(const{feature:de,id:ve,index:Fe,sourceLayerIndex:Ee}of a){const Re=y._featureFilter.needGeometry,Je=Ga(de,Re);if(!y._featureFilter.filter(oe,Je,p))continue;let st,pt;if(Re||(Je.geometry=da(de)),D){const Et=y.getValueAndResolveTokens("text-field",Je,p,te),Mt=Gi.factory(Et),Yt=this.hasRTLText=this.hasRTLText||Ue(Mt);(!Yt||po.getRTLTextPluginStatus()==="unavailable"||Yt&&po.isParsed())&&(st=xb(Mt,y,Je))}if(z){const Et=y.getValueAndResolveTokens("icon-image",Je,p,te);pt=Et instanceof $s?Et:$s.fromString(Et)}if(!st&&!pt)continue;const kt=this.sortFeaturesByKey?$.evaluate(Je,{},p):void 0;if(this.features.push({id:ve,text:st,icon:pt,index:Fe,sourceLayerIndex:Ee,geometry:Je.geometry,properties:de.properties,type:Zo.types[de.type],sortKey:kt}),pt&&(Y[pt.name]=!0),st){const Et=T.evaluate(Je,{},p).join(","),Mt=E.get("text-rotation-alignment")!=="viewport"&&E.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(c.ao.vertical)>=0;for(const Yt of st.sections)if(Yt.image)Y[Yt.image.name]=!0;else{const Ct=nu(st.toString()),It=Yt.fontStack||Et,ct=Q[It]=Q[It]||{};this.calculateGlyphDependencies(Yt.text,ct,Mt,this.allowVerticalPlacement,Ct)}}}E.get("symbol-placement")==="line"&&(this.features=(function(de){const ve={},Fe={},Ee=[];let Re=0;function Je(Et){Ee.push(de[Et]),Re++}function st(Et,Mt,Yt){const Ct=Fe[Et];return delete Fe[Et],Fe[Mt]=Ct,Ee[Ct].geometry[0].pop(),Ee[Ct].geometry[0]=Ee[Ct].geometry[0].concat(Yt[0]),Ct}function pt(Et,Mt,Yt){const Ct=ve[Mt];return delete ve[Mt],ve[Et]=Ct,Ee[Ct].geometry[0].shift(),Ee[Ct].geometry[0]=Yt[0].concat(Ee[Ct].geometry[0]),Ct}function kt(Et,Mt,Yt){const Ct=Yt?Mt[0][Mt[0].length-1]:Mt[0][0];return`${Et}:${Ct.x}:${Ct.y}`}for(let Et=0;Et<de.length;Et++){const Mt=de[Et],Yt=Mt.geometry,Ct=Mt.text?Mt.text.toString():null;if(!Ct){Je(Et);continue}const It=kt(Ct,Yt),ct=kt(Ct,Yt,!0);if(It in Fe&&ct in ve&&Fe[It]!==ve[ct]){const dr=pt(It,ct,Yt),xr=st(It,ct,Ee[dr].geometry);delete ve[It],delete Fe[ct],Fe[kt(Ct,Ee[xr].geometry,!0)]=xr,Ee[dr].geometry=null}else It in Fe?st(It,ct,Yt):ct in ve?pt(It,ct,Yt):(Je(Et),ve[It]=Re-1,Fe[ct]=Re-1)}return Ee.filter((Et=>Et.geometry))})(this.features)),this.sortFeaturesByKey&&this.features.sort(((de,ve)=>de.sortKey-ve.sortKey))}update(a,u,p){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(a,u,this.layers,p),this.icon.programConfigurations.updatePaintArrays(a,u,this.layers,p))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(a){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(a),this.iconCollisionBox.upload(a)),this.text.upload(a,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(a,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(a,u){const p=this.lineVertexArray.length;if(a.segment!==void 0){let y=a.dist(u[a.segment+1]),E=a.dist(u[a.segment]);const T={};for(let P=a.segment+1;P<u.length;P++)T[P]={x:u[P].x,y:u[P].y,tileUnitDistanceFromAnchor:y},P<u.length-1&&(y+=u[P+1].dist(u[P]));for(let P=a.segment||0;P>=0;P--)T[P]={x:u[P].x,y:u[P].y,tileUnitDistanceFromAnchor:E},P>0&&(E+=u[P-1].dist(u[P]));for(let P=0;P<u.length;P++){const k=T[P];this.lineVertexArray.emplaceBack(k.x,k.y,k.tileUnitDistanceFromAnchor)}}return{lineStartIndex:p,lineLength:this.lineVertexArray.length-p}}addSymbols(a,u,p,y,E,T,P,k,D,z,$,Y){const Q=a.indexArray,te=a.layoutVertexArray,oe=a.segments.prepareSegment(4*u.length,te,Q,this.canOverlap?T.sortKey:void 0),de=this.glyphOffsetArray.length,ve=oe.vertexLength,Fe=this.allowVerticalPlacement&&P===c.ao.vertical?Math.PI/2:0,Ee=T.text&&T.text.sections;for(let Re=0;Re<u.length;Re++){const{tl:Je,tr:st,bl:pt,br:kt,tex:Et,pixelOffsetTL:Mt,pixelOffsetBR:Yt,minFontScaleX:Ct,minFontScaleY:It,glyphOffset:ct,isSDF:dr,sectionIndex:xr}=u[Re],nr=oe.vertexLength,Gt=ct[1];$i(te,k.x,k.y,Je.x,Gt+Je.y,Et.x,Et.y,p,dr,Mt.x,Mt.y,Ct,It),$i(te,k.x,k.y,st.x,Gt+st.y,Et.x+Et.w,Et.y,p,dr,Yt.x,Mt.y,Ct,It),$i(te,k.x,k.y,pt.x,Gt+pt.y,Et.x,Et.y+Et.h,p,dr,Mt.x,Yt.y,Ct,It),$i(te,k.x,k.y,kt.x,Gt+kt.y,Et.x+Et.w,Et.y+Et.h,p,dr,Yt.x,Yt.y,Ct,It),Qe(a.dynamicLayoutVertexArray,k,Fe),Q.emplaceBack(nr,nr+2,nr+1),Q.emplaceBack(nr+1,nr+2,nr+3),oe.vertexLength+=4,oe.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(ct[0]),Re!==u.length-1&&xr===u[Re+1].sectionIndex||a.programConfigurations.populatePaintArrays(te.length,T,T.index,{},Y,Ee&&Ee[xr])}a.placedSymbolArray.emplaceBack(k.x,k.y,de,this.glyphOffsetArray.length-de,ve,D,z,k.segment,p?p[0]:0,p?p[1]:0,y[0],y[1],P,0,!1,0,$)}_addCollisionDebugVertex(a,u,p,y,E,T){return u.emplaceBack(0,0),a.emplaceBack(p.x,p.y,y,E,Math.round(T.x),Math.round(T.y))}addCollisionDebugVertices(a,u,p,y,E,T,P){const k=E.segments.prepareSegment(4,E.layoutVertexArray,E.indexArray),D=k.vertexLength,z=E.layoutVertexArray,$=E.collisionVertexArray,Y=P.anchorX,Q=P.anchorY;this._addCollisionDebugVertex(z,$,T,Y,Q,new m(a,u)),this._addCollisionDebugVertex(z,$,T,Y,Q,new m(p,u)),this._addCollisionDebugVertex(z,$,T,Y,Q,new m(p,y)),this._addCollisionDebugVertex(z,$,T,Y,Q,new m(a,y)),k.vertexLength+=4;const te=E.indexArray;te.emplaceBack(D,D+1),te.emplaceBack(D+1,D+2),te.emplaceBack(D+2,D+3),te.emplaceBack(D+3,D),k.primitiveLength+=4}addDebugCollisionBoxes(a,u,p,y){for(let E=a;E<u;E++){const T=this.collisionBoxArray.get(E);this.addCollisionDebugVertices(T.x1,T.y1,T.x2,T.y2,y?this.textCollisionBox:this.iconCollisionBox,T.anchorPoint,p)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Rt(Sr,v0.members,Jr),this.iconCollisionBox=new Rt(Sr,v0.members,Jr);for(let a=0;a<this.symbolInstances.length;a++){const u=this.symbolInstances.get(a);this.addDebugCollisionBoxes(u.textBoxStartIndex,u.textBoxEndIndex,u,!0),this.addDebugCollisionBoxes(u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u,!0),this.addDebugCollisionBoxes(u.iconBoxStartIndex,u.iconBoxEndIndex,u,!1),this.addDebugCollisionBoxes(u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex,u,!1)}}_deserializeCollisionBoxesForSymbol(a,u,p,y,E,T,P,k,D){const z={};for(let $=u;$<p;$++){const Y=a.get($);z.textBox={x1:Y.x1,y1:Y.y1,x2:Y.x2,y2:Y.y2,anchorPointX:Y.anchorPointX,anchorPointY:Y.anchorPointY},z.textFeatureIndex=Y.featureIndex;break}for(let $=y;$<E;$++){const Y=a.get($);z.verticalTextBox={x1:Y.x1,y1:Y.y1,x2:Y.x2,y2:Y.y2,anchorPointX:Y.anchorPointX,anchorPointY:Y.anchorPointY},z.verticalTextFeatureIndex=Y.featureIndex;break}for(let $=T;$<P;$++){const Y=a.get($);z.iconBox={x1:Y.x1,y1:Y.y1,x2:Y.x2,y2:Y.y2,anchorPointX:Y.anchorPointX,anchorPointY:Y.anchorPointY},z.iconFeatureIndex=Y.featureIndex;break}for(let $=k;$<D;$++){const Y=a.get($);z.verticalIconBox={x1:Y.x1,y1:Y.y1,x2:Y.x2,y2:Y.y2,anchorPointX:Y.anchorPointX,anchorPointY:Y.anchorPointY},z.verticalIconFeatureIndex=Y.featureIndex;break}return z}deserializeCollisionBoxes(a){this.collisionArrays=[];for(let u=0;u<this.symbolInstances.length;u++){const p=this.symbolInstances.get(u);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(a,p.textBoxStartIndex,p.textBoxEndIndex,p.verticalTextBoxStartIndex,p.verticalTextBoxEndIndex,p.iconBoxStartIndex,p.iconBoxEndIndex,p.verticalIconBoxStartIndex,p.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(a,u){const p=a.placedSymbolArray.get(u),y=p.vertexStartIndex+4*p.numGlyphs;for(let E=p.vertexStartIndex;E<y;E+=4)a.indexArray.emplaceBack(E,E+2,E+1),a.indexArray.emplaceBack(E+1,E+2,E+3)}getSortedSymbolIndexes(a){if(this.sortedAngle===a&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const u=Math.sin(a),p=Math.cos(a),y=[],E=[],T=[];for(let P=0;P<this.symbolInstances.length;++P){T.push(P);const k=this.symbolInstances.get(P);y.push(0|Math.round(u*k.anchorX+p*k.anchorY)),E.push(k.featureIndex)}return T.sort(((P,k)=>y[P]-y[k]||E[k]-E[P])),T}addToSortKeyRanges(a,u){const p=this.sortKeyRanges[this.sortKeyRanges.length-1];p&&p.sortKey===u?p.symbolInstanceEnd=a+1:this.sortKeyRanges.push({sortKey:u,symbolInstanceStart:a,symbolInstanceEnd:a+1})}sortFeatures(a){if(this.sortFeaturesByY&&this.sortedAngle!==a&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(a),this.sortedAngle=a,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const u of this.symbolInstanceIndexes){const p=this.symbolInstances.get(u);this.featureSortOrder.push(p.featureIndex),[p.rightJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.leftJustifiedTextSymbolIndex].forEach(((y,E,T)=>{y>=0&&T.indexOf(y)===E&&this.addIndicesForPlacedSymbol(this.text,y)})),p.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,p.verticalPlacedTextSymbolIndex),p.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,p.placedIconSymbolIndex),p.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,p.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let gr,_r;Ot("SymbolBucket",Xt,{omit:["layers","collisionBoxArray","features","compareText"]}),Xt.MAX_GLYPHS=65535,Xt.addDynamicAttributes=Qe;var Ar={get paint(){return _r=_r||new zn({"icon-opacity":new er(Ne.paint_symbol["icon-opacity"]),"icon-color":new er(Ne.paint_symbol["icon-color"]),"icon-halo-color":new er(Ne.paint_symbol["icon-halo-color"]),"icon-halo-width":new er(Ne.paint_symbol["icon-halo-width"]),"icon-halo-blur":new er(Ne.paint_symbol["icon-halo-blur"]),"icon-translate":new zt(Ne.paint_symbol["icon-translate"]),"icon-translate-anchor":new zt(Ne.paint_symbol["icon-translate-anchor"]),"text-opacity":new er(Ne.paint_symbol["text-opacity"]),"text-color":new er(Ne.paint_symbol["text-color"],{runtimeType:Ki,getOverride:h=>h.textColor,hasOverride:h=>!!h.textColor}),"text-halo-color":new er(Ne.paint_symbol["text-halo-color"]),"text-halo-width":new er(Ne.paint_symbol["text-halo-width"]),"text-halo-blur":new er(Ne.paint_symbol["text-halo-blur"]),"text-translate":new zt(Ne.paint_symbol["text-translate"]),"text-translate-anchor":new zt(Ne.paint_symbol["text-translate-anchor"])})},get layout(){return gr=gr||new zn({"symbol-placement":new zt(Ne.layout_symbol["symbol-placement"]),"symbol-spacing":new zt(Ne.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new zt(Ne.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new er(Ne.layout_symbol["symbol-sort-key"]),"symbol-z-order":new zt(Ne.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new zt(Ne.layout_symbol["icon-allow-overlap"]),"icon-overlap":new zt(Ne.layout_symbol["icon-overlap"]),"icon-ignore-placement":new zt(Ne.layout_symbol["icon-ignore-placement"]),"icon-optional":new zt(Ne.layout_symbol["icon-optional"]),"icon-rotation-alignment":new zt(Ne.layout_symbol["icon-rotation-alignment"]),"icon-size":new er(Ne.layout_symbol["icon-size"]),"icon-text-fit":new zt(Ne.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new zt(Ne.layout_symbol["icon-text-fit-padding"]),"icon-image":new er(Ne.layout_symbol["icon-image"]),"icon-rotate":new er(Ne.layout_symbol["icon-rotate"]),"icon-padding":new er(Ne.layout_symbol["icon-padding"]),"icon-keep-upright":new zt(Ne.layout_symbol["icon-keep-upright"]),"icon-offset":new er(Ne.layout_symbol["icon-offset"]),"icon-anchor":new er(Ne.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new zt(Ne.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new zt(Ne.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new zt(Ne.layout_symbol["text-rotation-alignment"]),"text-field":new er(Ne.layout_symbol["text-field"]),"text-font":new er(Ne.layout_symbol["text-font"]),"text-size":new er(Ne.layout_symbol["text-size"]),"text-max-width":new er(Ne.layout_symbol["text-max-width"]),"text-line-height":new zt(Ne.layout_symbol["text-line-height"]),"text-letter-spacing":new er(Ne.layout_symbol["text-letter-spacing"]),"text-justify":new er(Ne.layout_symbol["text-justify"]),"text-radial-offset":new er(Ne.layout_symbol["text-radial-offset"]),"text-variable-anchor":new zt(Ne.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new er(Ne.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new er(Ne.layout_symbol["text-anchor"]),"text-max-angle":new zt(Ne.layout_symbol["text-max-angle"]),"text-writing-mode":new zt(Ne.layout_symbol["text-writing-mode"]),"text-rotate":new er(Ne.layout_symbol["text-rotate"]),"text-padding":new zt(Ne.layout_symbol["text-padding"]),"text-keep-upright":new zt(Ne.layout_symbol["text-keep-upright"]),"text-transform":new er(Ne.layout_symbol["text-transform"]),"text-offset":new er(Ne.layout_symbol["text-offset"]),"text-allow-overlap":new zt(Ne.layout_symbol["text-allow-overlap"]),"text-overlap":new zt(Ne.layout_symbol["text-overlap"]),"text-ignore-placement":new zt(Ne.layout_symbol["text-ignore-placement"]),"text-optional":new zt(Ne.layout_symbol["text-optional"])})}};class Vn{constructor(a){if(a.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=a.property.overrides?a.property.overrides.runtimeType:nl,this.defaultValue=a}evaluate(a){if(a.formattedSection){const u=this.defaultValue.property.overrides;if(u&&u.hasOverride(a.formattedSection))return u.getOverride(a.formattedSection)}return a.feature&&a.featureState?this.defaultValue.evaluate(a.feature,a.featureState):this.defaultValue.property.specification.default}eachChild(a){this.defaultValue.isConstant()||a(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Ot("FormatSectionOverride",Vn,{omit:["defaultValue"]});class $r extends jn{constructor(a){super(a,Ar)}recalculate(a,u){if(super.recalculate(a,u),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const p=this.layout.get("text-writing-mode");if(p){const y=[];for(const E of p)y.indexOf(E)<0&&y.push(E);this.layout._values["text-writing-mode"]=y}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(a,u,p,y){const E=this.layout.get(a).evaluate(u,{},p,y),T=this._unevaluatedLayout._values[a];return T.isDataDriven()||bl(T.value)||!E?E:(function(P,k){return k.replace(/{([^{}]+)}/g,((D,z)=>P&&z in P?String(P[z]):""))})(u.properties,E)}createBucket(a){return new Xt(a)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const a of Ar.paint.overridableProperties){if(!$r.hasPaintOverride(this.layout,a))continue;const u=this.paint.get(a),p=new Vn(u),y=new Yc(p,u.property.specification);let E=null;E=u.value.kind==="constant"||u.value.kind==="source"?new Yl("source",y):new Jl("composite",y,u.value.zoomStops),this.paint._values[a]=new fs(u.property,E,u.parameters)}}_handleOverridablePaintPropertyUpdate(a,u,p){return!(!this.layout||u.isDataDriven()||p.isDataDriven())&&$r.hasPaintOverride(this.layout,a)}static hasPaintOverride(a,u){const p=a.get("text-field"),y=Ar.paint.properties[u];let E=!1;const T=P=>{for(const k of P)if(y.overrides&&y.overrides.hasOverride(k))return void(E=!0)};if(p.value.kind==="constant"&&p.value.value instanceof Gi)T(p.value.value.sections);else if(p.value.kind==="source"){const P=D=>{E||(D instanceof Ws&&cr(D.value)===Rs?T(D.value.sections):D instanceof $l?T(D.sections):D.eachChild(P))},k=p.value;k._styleExpression&&P(k._styleExpression.expression)}return E}}let hc;var Sb={get paint(){return hc=hc||new zn({"background-color":new zt(Ne.paint_background["background-color"]),"background-pattern":new ca(Ne.paint_background["background-pattern"]),"background-opacity":new zt(Ne.paint_background["background-opacity"])})}};class P6 extends jn{constructor(a){super(a,Sb)}}let WT;var R6={get paint(){return WT=WT||new zn({"raster-opacity":new zt(Ne.paint_raster["raster-opacity"]),"raster-hue-rotate":new zt(Ne.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new zt(Ne.paint_raster["raster-brightness-min"]),"raster-brightness-max":new zt(Ne.paint_raster["raster-brightness-max"]),"raster-saturation":new zt(Ne.paint_raster["raster-saturation"]),"raster-contrast":new zt(Ne.paint_raster["raster-contrast"]),"raster-resampling":new zt(Ne.paint_raster["raster-resampling"]),"raster-fade-duration":new zt(Ne.paint_raster["raster-fade-duration"])})}};class M6 extends jn{constructor(a){super(a,R6)}}class I6 extends jn{constructor(a){super(a,{}),this.onAdd=u=>{this.implementation.onAdd&&this.implementation.onAdd(u,u.painter.context.gl)},this.onRemove=u=>{this.implementation.onRemove&&this.implementation.onRemove(u,u.painter.context.gl)},this.implementation=a}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class k6{constructor(a){this._methodToThrottle=a,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._methodToThrottle()}),0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const B6={once:!0},Cb=63710088e-1;class pd{constructor(a,u){if(isNaN(a)||isNaN(u))throw new Error(`Invalid LngLat object: (${a}, ${u})`);if(this.lng=+a,this.lat=+u,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new pd($t(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(a){const u=Math.PI/180,p=this.lat*u,y=a.lat*u,E=Math.sin(p)*Math.sin(y)+Math.cos(p)*Math.cos(y)*Math.cos((a.lng-this.lng)*u);return Cb*Math.acos(Math.min(E,1))}static convert(a){if(a instanceof pd)return a;if(Array.isArray(a)&&(a.length===2||a.length===3))return new pd(Number(a[0]),Number(a[1]));if(!Array.isArray(a)&&typeof a=="object"&&a!==null)return new pd(Number("lng"in a?a.lng:a.lon),Number(a.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const qT=2*Math.PI*Cb;function KT(h){return qT*Math.cos(h*Math.PI/180)}function ZT(h){return(180+h)/360}function XT(h){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+h*Math.PI/360)))/360}function YT(h,a){return h/KT(a)}function Pb(h){return 360/Math.PI*Math.atan(Math.exp((180-360*h)*Math.PI/180))-90}function JT(h,a){return h*KT(Pb(a))}class v_{constructor(a,u,p=0){this.x=+a,this.y=+u,this.z=+p}static fromLngLat(a,u=0){const p=pd.convert(a);return new v_(ZT(p.lng),XT(p.lat),YT(u,p.lat))}toLngLat(){return new pd(360*this.x-180,Pb(this.y))}toAltitude(){return JT(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/qT*(a=Pb(this.y),1/Math.cos(a*Math.PI/180));var a}}function QT(h,a,u){var p=2*Math.PI*6378137/256/Math.pow(2,u);return[h*p-2*Math.PI*6378137/2,a*p-2*Math.PI*6378137/2]}class Rb{constructor(a,u,p){if(!(function(y,E,T){return!(y<0||y>25||T<0||T>=Math.pow(2,y)||E<0||E>=Math.pow(2,y))})(a,u,p))throw new Error(`x=${u}, y=${p}, z=${a} outside of bounds. 0<=x<${Math.pow(2,a)}, 0<=y<${Math.pow(2,a)} 0<=z<=25 `);this.z=a,this.x=u,this.y=p,this.key=am(0,a,a,u,p)}equals(a){return this.z===a.z&&this.x===a.x&&this.y===a.y}url(a,u,p){const y=(T=this.y,P=this.z,k=QT(256*(E=this.x),256*(T=Math.pow(2,P)-T-1),P),D=QT(256*(E+1),256*(T+1),P),k[0]+","+k[1]+","+D[0]+","+D[1]);var E,T,P,k,D;const z=(function($,Y,Q){let te,oe="";for(let de=$;de>0;de--)te=1<<de-1,oe+=(Y&te?1:0)+(Q&te?2:0);return oe})(this.z,this.x,this.y);return a[(this.x+this.y)%a.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(p==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,u>1?"@2x":"").replace(/{quadkey}/g,z).replace(/{bbox-epsg-3857}/g,y)}isChildOf(a){const u=this.z-a.z;return u>0&&a.x===this.x>>u&&a.y===this.y>>u}getTilePoint(a){const u=Math.pow(2,this.z);return new m((a.x*u-this.x)*ft,(a.y*u-this.y)*ft)}toString(){return`${this.z}/${this.x}/${this.y}`}}class eS{constructor(a,u){this.wrap=a,this.canonical=u,this.key=am(a,u.z,u.z,u.x,u.y)}}class Wa{constructor(a,u,p,y,E){if(this.terrainRttPosMatrix32f=null,a<p)throw new Error(`overscaledZ should be >= z; overscaledZ = ${a}; z = ${p}`);this.overscaledZ=a,this.wrap=u,this.canonical=new Rb(p,+y,+E),this.key=am(u,a,p,y,E)}clone(){return new Wa(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(a){return this.overscaledZ===a.overscaledZ&&this.wrap===a.wrap&&this.canonical.equals(a.canonical)}scaledTo(a){if(a>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${a}; overscaledZ = ${this.overscaledZ}`);const u=this.canonical.z-a;return a>this.canonical.z?new Wa(a,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Wa(a,this.wrap,a,this.canonical.x>>u,this.canonical.y>>u)}calculateScaledKey(a,u){if(a>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${a}; overscaledZ = ${this.overscaledZ}`);const p=this.canonical.z-a;return a>this.canonical.z?am(this.wrap*+u,a,this.canonical.z,this.canonical.x,this.canonical.y):am(this.wrap*+u,a,a,this.canonical.x>>p,this.canonical.y>>p)}isChildOf(a){if(a.wrap!==this.wrap)return!1;const u=this.canonical.z-a.canonical.z;return a.overscaledZ===0||a.overscaledZ<this.overscaledZ&&a.canonical.x===this.canonical.x>>u&&a.canonical.y===this.canonical.y>>u}children(a){if(this.overscaledZ>=a)return[new Wa(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const u=this.canonical.z+1,p=2*this.canonical.x,y=2*this.canonical.y;return[new Wa(u,this.wrap,u,p,y),new Wa(u,this.wrap,u,p+1,y),new Wa(u,this.wrap,u,p,y+1),new Wa(u,this.wrap,u,p+1,y+1)]}isLessThan(a){return this.wrap<a.wrap||!(this.wrap>a.wrap)&&(this.overscaledZ<a.overscaledZ||!(this.overscaledZ>a.overscaledZ)&&(this.canonical.x<a.canonical.x||!(this.canonical.x>a.canonical.x)&&this.canonical.y<a.canonical.y))}wrapped(){return new Wa(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(a){return new Wa(this.overscaledZ,a,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new eS(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(a){return this.canonical.getTilePoint(new v_(a.x-this.wrap,a.y))}}function am(h,a,u,p,y){(h*=2)<0&&(h=-1*h-1);const E=1<<u;return(E*E*h+E*y+p).toString(36)+u.toString(36)+a.toString(36)}function b_(h,a){return a?h.properties[a]:h.id}Ot("CanonicalTileID",Rb),Ot("OverscaledTileID",Wa,{omit:["terrainRttPosMatrix32f"]});class Yf{constructor(){this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0}extend(a){return this.minX=Math.min(this.minX,a.x),this.minY=Math.min(this.minY,a.y),this.maxX=Math.max(this.maxX,a.x),this.maxY=Math.max(this.maxY,a.y),this}expandBy(a){return this.minX-=a,this.minY-=a,this.maxX+=a,this.maxY+=a,(this.minX>this.maxX||this.minY>this.maxY)&&(this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0),this}shrinkBy(a){return this.expandBy(-a)}map(a){const u=new Yf;return u.extend(a(new m(this.minX,this.minY))),u.extend(a(new m(this.maxX,this.minY))),u.extend(a(new m(this.minX,this.maxY))),u.extend(a(new m(this.maxX,this.maxY))),u}static fromPoints(a){const u=new Yf;for(const p of a)u.extend(p);return u}contains(a){return a.x>=this.minX&&a.x<=this.maxX&&a.y>=this.minY&&a.y<=this.maxY}empty(){return this.minX>this.maxX}width(){return this.maxX-this.minX}height(){return this.maxY-this.minY}covers(a){return!this.empty()&&!a.empty()&&a.minX>=this.minX&&a.maxX<=this.maxX&&a.minY>=this.minY&&a.maxY<=this.maxY}intersects(a){return!this.empty()&&!a.empty()&&a.minX<=this.maxX&&a.maxX>=this.minX&&a.minY<=this.maxY&&a.maxY>=this.minY}}class tS{constructor(a){this._stringToNumber={},this._numberToString=[];for(let u=0;u<a.length;u++){const p=a[u];this._stringToNumber[p]=u,this._numberToString[u]=p}}encode(a){return this._stringToNumber[a]}decode(a){if(a>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${a} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[a]}}class rS{constructor(a,u,p,y,E){this.type="Feature",this._vectorTileFeature=a,a._z=u,a._x=p,a._y=y,this.properties=a.properties,this.id=E}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(a){this._geometry=a}toJSON(){const a={geometry:this.geometry};for(const u in this)u!=="_geometry"&&u!=="_vectorTileFeature"&&(a[u]=this[u]);return a}}class iS{constructor(a,u){this.tileID=a,this.x=a.canonical.x,this.y=a.canonical.y,this.z=a.canonical.z,this.grid=new aa(ft,16,0),this.grid3D=new aa(ft,16,0),this.featureIndexArray=new Ie,this.promoteId=u}insert(a,u,p,y,E,T){const P=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(p,y,E);const k=T?this.grid3D:this.grid;for(let D=0;D<u.length;D++){const z=u[D],$=[1/0,1/0,-1/0,-1/0];for(let Y=0;Y<z.length;Y++){const Q=z[Y];$[0]=Math.min($[0],Q.x),$[1]=Math.min($[1],Q.y),$[2]=Math.max($[2],Q.x),$[3]=Math.max($[3],Q.y)}$[0]<ft&&$[1]<ft&&$[2]>=0&&$[3]>=0&&k.insert(P,$[0],$[1],$[2],$[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Qp(new Wf(this.rawTileData)).layers,this.sourceLayerCoder=new tS(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(a,u,p,y){this.loadVTLayers();const E=a.params,T=ft/a.tileSize/a.scale,P=na(E.filter),k=a.queryGeometry,D=a.queryPadding*T,z=Yf.fromPoints(k),$=this.grid.query(z.minX-D,z.minY-D,z.maxX+D,z.maxY+D),Y=Yf.fromPoints(a.cameraQueryGeometry).expandBy(D),Q=this.grid3D.query(Y.minX,Y.minY,Y.maxX,Y.maxY,((de,ve,Fe,Ee)=>(function(Re,Je,st,pt,kt){for(const Mt of Re)if(Je<=Mt.x&&st<=Mt.y&&pt>=Mt.x&&kt>=Mt.y)return!0;const Et=[new m(Je,st),new m(Je,kt),new m(pt,kt),new m(pt,st)];if(Re.length>2){for(const Mt of Et)if(ah(Re,Mt))return!0}for(let Mt=0;Mt<Re.length-1;Mt++)if(Zg(Re[Mt],Re[Mt+1],Et))return!0;return!1})(a.cameraQueryGeometry,de-D,ve-D,Fe+D,Ee+D)));for(const de of Q)$.push(de);$.sort(L6);const te={};let oe;for(let de=0;de<$.length;de++){const ve=$[de];if(ve===oe)continue;oe=ve;const Fe=this.featureIndexArray.get(ve);let Ee=null;this.loadMatchingFeature(te,Fe.bucketIndex,Fe.sourceLayerIndex,Fe.featureIndex,P,E.layers,E.availableImages,u,p,y,((Re,Je,st)=>(Ee||(Ee=da(Re)),Je.queryIntersectsFeature({queryGeometry:k,feature:Re,featureState:st,geometry:Ee,zoom:this.z,transform:a.transform,pixelsToTileUnits:T,pixelPosMatrix:a.pixelPosMatrix,unwrappedTileID:this.tileID.toUnwrapped(),getElevation:a.getElevation}))))}return te}loadMatchingFeature(a,u,p,y,E,T,P,k,D,z,$){const Y=this.bucketLayerIDs[u];if(T&&!Y.some((de=>T.has(de))))return;const Q=this.sourceLayerCoder.decode(p),te=this.vtLayers[Q].feature(y);if(E.needGeometry){const de=Ga(te,!0);if(!E.filter(new ri(this.tileID.overscaledZ),de,this.tileID.canonical))return}else if(!E.filter(new ri(this.tileID.overscaledZ),te))return;const oe=this.getId(te,Q);for(let de=0;de<Y.length;de++){const ve=Y[de];if(T&&!T.has(ve))continue;const Fe=k[ve];if(!Fe)continue;let Ee={};oe&&z&&(Ee=z.getState(Fe.sourceLayer||"_geojsonTileLayer",oe));const Re=pr({},D[ve]);Re.paint=nS(Re.paint,Fe.paint,te,Ee,P),Re.layout=nS(Re.layout,Fe.layout,te,Ee,P);const Je=!$||$(te,Fe,Ee);if(!Je)continue;const st=new rS(te,this.z,this.x,this.y,oe);st.layer=Re;let pt=a[ve];pt===void 0&&(pt=a[ve]=[]),pt.push({featureIndex:y,feature:st,intersectionZ:Je})}}lookupSymbolFeatures(a,u,p,y,E,T,P,k){const D={};this.loadVTLayers();const z=na(E);for(const $ of a)this.loadMatchingFeature(D,p,y,$,z,T,P,k,u);return D}hasLayer(a){for(const u of this.bucketLayerIDs)for(const p of u)if(a===p)return!0;return!1}getId(a,u){var p;let y=a.id;return this.promoteId&&(y=a.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[u]],typeof y=="boolean"&&(y=Number(y)),y===void 0&&!((p=a.properties)===null||p===void 0)&&p.cluster&&this.promoteId&&(y=Number(a.properties.cluster_id))),y}}function nS(h,a,u,p,y){return Nr(h,((E,T)=>{const P=a instanceof ih?a.get(T):null;return P&&P.evaluate?P.evaluate(u,p,y):P}))}function L6(h,a){return a-h}function sS(h,a,u,p,y){const E=[];for(let T=0;T<h.length;T++){const P=h[T];let k;for(let D=0;D<P.length-1;D++){let z=P[D],$=P[D+1];z.x<a&&$.x<a||(z.x<a?z=new m(a,z.y+(a-z.x)/($.x-z.x)*($.y-z.y))._round():$.x<a&&($=new m(a,z.y+(a-z.x)/($.x-z.x)*($.y-z.y))._round()),z.y<u&&$.y<u||(z.y<u?z=new m(z.x+(u-z.y)/($.y-z.y)*($.x-z.x),u)._round():$.y<u&&($=new m(z.x+(u-z.y)/($.y-z.y)*($.x-z.x),u)._round()),z.x>=p&&$.x>=p||(z.x>=p?z=new m(p,z.y+(p-z.x)/($.x-z.x)*($.y-z.y))._round():$.x>=p&&($=new m(p,z.y+(p-z.x)/($.x-z.x)*($.y-z.y))._round()),z.y>=y&&$.y>=y||(z.y>=y?z=new m(z.x+(y-z.y)/($.y-z.y)*($.x-z.x),y)._round():$.y>=y&&($=new m(z.x+(y-z.y)/($.y-z.y)*($.x-z.x),y)._round()),k&&z.equals(k[k.length-1])||(k=[z],E.push(k)),k.push($)))))}}return E}Ot("FeatureIndex",iS,{omit:["rawTileData","sourceLayerCoder"]});class md extends m{constructor(a,u,p,y){super(a,u),this.angle=p,y!==void 0&&(this.segment=y)}clone(){return new md(this.x,this.y,this.angle,this.segment)}}function oS(h,a,u,p,y){if(a.segment===void 0||u===0)return!0;let E=a,T=a.segment+1,P=0;for(;P>-u/2;){if(T--,T<0)return!1;P-=h[T].dist(E),E=h[T]}P+=h[T].dist(h[T+1]),T++;const k=[];let D=0;for(;P<u/2;){const z=h[T],$=h[T+1];if(!$)return!1;let Y=h[T-1].angleTo(z)-z.angleTo($);for(Y=Math.abs((Y+3*Math.PI)%(2*Math.PI)-Math.PI),k.push({distance:P,angleDelta:Y}),D+=Y;P-k[0].distance>p;)D-=k.shift().angleDelta;if(D>y)return!1;T++,P+=z.dist($)}return!0}function aS(h){let a=0;for(let u=0;u<h.length-1;u++)a+=h[u].dist(h[u+1]);return a}function lS(h,a,u){return h?.6*a*u:0}function cS(h,a){return Math.max(h?h.right-h.left:0,a?a.right-a.left:0)}function O6(h,a,u,p,y,E){const T=lS(u,y,E),P=cS(u,p)*E;let k=0;const D=aS(h)/2;for(let z=0;z<h.length-1;z++){const $=h[z],Y=h[z+1],Q=$.dist(Y);if(k+Q>D){const te=(D-k)/Q,oe=Fo.number($.x,Y.x,te),de=Fo.number($.y,Y.y,te),ve=new md(oe,de,Y.angleTo($),z);return ve._round(),!T||oS(h,ve,P,T,a)?ve:void 0}k+=Q}}function D6(h,a,u,p,y,E,T,P,k){const D=lS(p,E,T),z=cS(p,y),$=z*T,Y=h[0].x===0||h[0].x===k||h[0].y===0||h[0].y===k;return a-$<a/4&&(a=$+a/4),uS(h,Y?a/2*P%a:(z/2+2*E)*T*P%a,a,D,u,$,Y,!1,k)}function uS(h,a,u,p,y,E,T,P,k){const D=E/2,z=aS(h);let $=0,Y=a-u,Q=[];for(let te=0;te<h.length-1;te++){const oe=h[te],de=h[te+1],ve=oe.dist(de),Fe=de.angleTo(oe);for(;Y+u<$+ve;){Y+=u;const Ee=(Y-$)/ve,Re=Fo.number(oe.x,de.x,Ee),Je=Fo.number(oe.y,de.y,Ee);if(Re>=0&&Re<k&&Je>=0&&Je<k&&Y-D>=0&&Y+D<=z){const st=new md(Re,Je,Fe,te);st._round(),p&&!oS(h,st,E,p,y)||Q.push(st)}}$+=ve}return P||Q.length||T||(Q=uS(h,$/2,u,p,y,E,T,!0,k)),Q}function hS(h,a,u,p){const y=[],E=h.image,T=E.pixelRatio,P=E.paddedRect.w-2,k=E.paddedRect.h-2;let D={x1:h.left,y1:h.top,x2:h.right,y2:h.bottom};const z=E.stretchX||[[0,P]],$=E.stretchY||[[0,k]],Y=(ct,dr)=>ct+dr[1]-dr[0],Q=z.reduce(Y,0),te=$.reduce(Y,0),oe=P-Q,de=k-te;let ve=0,Fe=Q,Ee=0,Re=te,Je=0,st=oe,pt=0,kt=de;if(E.content&&p){const ct=E.content,dr=ct[2]-ct[0],xr=ct[3]-ct[1];(E.textFitWidth||E.textFitHeight)&&(D=ot(h)),ve=P0(z,0,ct[0]),Ee=P0($,0,ct[1]),Fe=P0(z,ct[0],ct[2]),Re=P0($,ct[1],ct[3]),Je=ct[0]-ve,pt=ct[1]-Ee,st=dr-Fe,kt=xr-Re}const Et=D.x1,Mt=D.y1,Yt=D.x2-Et,Ct=D.y2-Mt,It=(ct,dr,xr,nr)=>{const Gt=R0(ct.stretch-ve,Fe,Yt,Et),zr=M0(ct.fixed-Je,st,ct.stretch,Q),en=R0(dr.stretch-Ee,Re,Ct,Mt),Gn=M0(dr.fixed-pt,kt,dr.stretch,te),js=R0(xr.stretch-ve,Fe,Yt,Et),qa=M0(xr.fixed-Je,st,xr.stretch,Q),Yo=R0(nr.stretch-Ee,Re,Ct,Mt),xs=M0(nr.fixed-pt,kt,nr.stretch,te),Wi=new m(Gt,en),Xn=new m(js,en),ws=new m(js,Yo),Es=new m(Gt,Yo),xo=new m(zr/T,Gn/T),Ka=new m(qa/T,xs/T),Yn=a*Math.PI/180;if(Yn){const Jn=Math.sin(Yn),Qn=Math.cos(Yn),Rn=[Qn,-Jn,Jn,Qn];Wi._matMult(Rn),Xn._matMult(Rn),Es._matMult(Rn),ws._matMult(Rn)}const Jo=ct.stretch+ct.fixed,Hn=dr.stretch+dr.fixed;return{tl:Wi,tr:Xn,bl:Es,br:ws,tex:{x:E.paddedRect.x+1+Jo,y:E.paddedRect.y+1+Hn,w:xr.stretch+xr.fixed-Jo,h:nr.stretch+nr.fixed-Hn},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:xo,pixelOffsetBR:Ka,minFontScaleX:st/T/Yt,minFontScaleY:kt/T/Ct,isSDF:u}};if(p&&(E.stretchX||E.stretchY)){const ct=dS(z,oe,Q),dr=dS($,de,te);for(let xr=0;xr<ct.length-1;xr++){const nr=ct[xr],Gt=ct[xr+1];for(let zr=0;zr<dr.length-1;zr++)y.push(It(nr,dr[zr],Gt,dr[zr+1]))}}else y.push(It({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:P+1},{fixed:0,stretch:k+1}));return y}function P0(h,a,u){let p=0;for(const y of h)p+=Math.max(a,Math.min(u,y[1]))-Math.max(a,Math.min(u,y[0]));return p}function dS(h,a,u){const p=[{fixed:-1,stretch:0}];for(const[y,E]of h){const T=p[p.length-1];p.push({fixed:y-T.stretch,stretch:T.stretch}),p.push({fixed:y-T.stretch,stretch:T.stretch+(E-y)})}return p.push({fixed:a+1,stretch:u}),p}function R0(h,a,u,p){return h/a*u+p}function M0(h,a,u,p){return h-a*u/p}Ot("Anchor",md);class I0{constructor(a,u,p,y,E,T,P,k,D,z){var $;if(this.boxStartIndex=a.length,D){let Y=T.top,Q=T.bottom;const te=T.collisionPadding;te&&(Y-=te[1],Q+=te[3]);let oe=Q-Y;oe>0&&(oe=Math.max(10,oe),this.circleDiameter=oe)}else{const Y=!(($=T.image)===null||$===void 0)&&$.content&&(T.image.textFitWidth||T.image.textFitHeight)?ot(T):{x1:T.left,y1:T.top,x2:T.right,y2:T.bottom};Y.y1=Y.y1*P-k[0],Y.y2=Y.y2*P+k[2],Y.x1=Y.x1*P-k[3],Y.x2=Y.x2*P+k[1];const Q=T.collisionPadding;if(Q&&(Y.x1-=Q[0]*P,Y.y1-=Q[1]*P,Y.x2+=Q[2]*P,Y.y2+=Q[3]*P),z){const te=new m(Y.x1,Y.y1),oe=new m(Y.x2,Y.y1),de=new m(Y.x1,Y.y2),ve=new m(Y.x2,Y.y2),Fe=z*Math.PI/180;te._rotate(Fe),oe._rotate(Fe),de._rotate(Fe),ve._rotate(Fe),Y.x1=Math.min(te.x,oe.x,de.x,ve.x),Y.x2=Math.max(te.x,oe.x,de.x,ve.x),Y.y1=Math.min(te.y,oe.y,de.y,ve.y),Y.y2=Math.max(te.y,oe.y,de.y,ve.y)}a.emplaceBack(u.x,u.y,Y.x1,Y.y1,Y.x2,Y.y2,p,y,E)}this.boxEndIndex=a.length}}class N6{constructor(a=[],u=(p,y)=>p<y?-1:p>y?1:0){if(this.data=a,this.length=this.data.length,this.compare=u,this.length>0)for(let p=(this.length>>1)-1;p>=0;p--)this._down(p)}push(a){this.data.push(a),this._up(this.length++)}pop(){if(this.length===0)return;const a=this.data[0],u=this.data.pop();return--this.length>0&&(this.data[0]=u,this._down(0)),a}peek(){return this.data[0]}_up(a){const{data:u,compare:p}=this,y=u[a];for(;a>0;){const E=a-1>>1,T=u[E];if(p(y,T)>=0)break;u[a]=T,a=E}u[a]=y}_down(a){const{data:u,compare:p}=this,y=this.length>>1,E=u[a];for(;a<y;){let T=1+(a<<1);const P=T+1;if(P<this.length&&p(u[P],u[T])<0&&(T=P),p(u[T],E)>=0)break;u[a]=u[T],a=T}u[a]=E}}function F6(h,a=1,u=!1){const p=Yf.fromPoints(h[0]),y=Math.min(p.width(),p.height());let E=y/2;const T=new N6([],z6),{minX:P,minY:k,maxX:D,maxY:z}=p;if(y===0)return new m(P,k);for(let Q=P;Q<D;Q+=y)for(let te=k;te<z;te+=y)T.push(new lm(Q+E,te+E,E,h));let $=(function(Q){let te=0,oe=0,de=0;const ve=Q[0];for(let Fe=0,Ee=ve.length,Re=Ee-1;Fe<Ee;Re=Fe++){const Je=ve[Fe],st=ve[Re],pt=Je.x*st.y-st.x*Je.y;oe+=(Je.x+st.x)*pt,de+=(Je.y+st.y)*pt,te+=3*pt}return new lm(oe/te,de/te,0,Q)})(h),Y=T.length;for(;T.length;){const Q=T.pop();(Q.d>$.d||!$.d)&&($=Q,u&&console.log("found best %d after %d probes",Math.round(1e4*Q.d)/1e4,Y)),Q.max-$.d<=a||(E=Q.h/2,T.push(new lm(Q.p.x-E,Q.p.y-E,E,h)),T.push(new lm(Q.p.x+E,Q.p.y-E,E,h)),T.push(new lm(Q.p.x-E,Q.p.y+E,E,h)),T.push(new lm(Q.p.x+E,Q.p.y+E,E,h)),Y+=4)}return u&&(console.log(`num probes: ${Y}`),console.log(`best distance: ${$.d}`)),$.p}function z6(h,a){return a.max-h.max}function lm(h,a,u,p){this.p=new m(h,a),this.h=u,this.d=(function(y,E){let T=!1,P=1/0;for(let k=0;k<E.length;k++){const D=E[k];for(let z=0,$=D.length,Y=$-1;z<$;Y=z++){const Q=D[z],te=D[Y];Q.y>y.y!=te.y>y.y&&y.x<(te.x-Q.x)*(y.y-Q.y)/(te.y-Q.y)+Q.x&&(T=!T),P=Math.min(P,qg(y,Q,te))}}return(T?1:-1)*Math.sqrt(P)})(this.p,p),this.max=this.d+this.h*Math.SQRT2}var zs;c.aE=void 0,(zs=c.aE||(c.aE={}))[zs.center=1]="center",zs[zs.left=2]="left",zs[zs.right=3]="right",zs[zs.top=4]="top",zs[zs.bottom=5]="bottom",zs[zs["top-left"]=6]="top-left",zs[zs["top-right"]=7]="top-right",zs[zs["bottom-left"]=8]="bottom-left",zs[zs["bottom-right"]=9]="bottom-right";const Mb=Number.POSITIVE_INFINITY;function fS(h,a){return a[1]!==Mb?(function(u,p,y){let E=0,T=0;switch(p=Math.abs(p),y=Math.abs(y),u){case"top-right":case"top-left":case"top":T=y-7;break;case"bottom-right":case"bottom-left":case"bottom":T=7-y}switch(u){case"top-right":case"bottom-right":case"right":E=-p;break;case"top-left":case"bottom-left":case"left":E=p}return[E,T]})(h,a[0],a[1]):(function(u,p){let y=0,E=0;p<0&&(p=0);const T=p/Math.SQRT2;switch(u){case"top-right":case"top-left":E=T-7;break;case"bottom-right":case"bottom-left":E=7-T;break;case"bottom":E=7-p;break;case"top":E=p-7}switch(u){case"top-right":case"bottom-right":y=-T;break;case"top-left":case"bottom-left":y=T;break;case"left":y=p;break;case"right":y=-p}return[y,E]})(h,a[0])}function pS(h,a,u){var p;const y=h.layout,E=(p=y.get("text-variable-anchor-offset"))===null||p===void 0?void 0:p.evaluate(a,{},u);if(E){const P=E.values,k=[];for(let D=0;D<P.length;D+=2){const z=k[D]=P[D],$=P[D+1].map((Y=>Y*xn));z.startsWith("top")?$[1]-=7:z.startsWith("bottom")&&($[1]+=7),k[D+1]=$}return new pn(k)}const T=y.get("text-variable-anchor");if(T){let P;P=h._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[y.get("text-radial-offset").evaluate(a,{},u)*xn,Mb]:y.get("text-offset").evaluate(a,{},u).map((D=>D*xn));const k=[];for(const D of T)k.push(D,fS(D,P));return new pn(k)}return null}function Ib(h){switch(h){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function j6(h,a,u,p,y,E,T,P,k,D,z,$){let Y=E.textMaxSize.evaluate(a,{});Y===void 0&&(Y=T);const Q=h.layers[0].layout,te=Q.get("icon-offset").evaluate(a,{},z),oe=gS(u.horizontal),de=T/24,ve=h.tilePixelRatio*de,Fe=h.tilePixelRatio*Y/24,Ee=h.tilePixelRatio*P,Re=h.tilePixelRatio*Q.get("symbol-spacing"),Je=Q.get("text-padding")*h.tilePixelRatio,st=(function(xr,nr,Gt,zr=1){const en=xr.get("icon-padding").evaluate(nr,{},Gt),Gn=en&&en.values;return[Gn[0]*zr,Gn[1]*zr,Gn[2]*zr,Gn[3]*zr]})(Q,a,z,h.tilePixelRatio),pt=Q.get("text-max-angle")/180*Math.PI,kt=Q.get("text-rotation-alignment")!=="viewport"&&Q.get("symbol-placement")!=="point",Et=Q.get("icon-rotation-alignment")==="map"&&Q.get("symbol-placement")!=="point",Mt=Q.get("symbol-placement"),Yt=Re/2,Ct=Q.get("icon-text-fit");let It;p&&Ct!=="none"&&(h.allowVerticalPlacement&&u.vertical&&(It=xt(p,u.vertical,Ct,Q.get("icon-text-fit-padding"),te,de)),oe&&(p=xt(p,oe,Ct,Q.get("icon-text-fit-padding"),te,de)));const ct=z?$.line.getGranularityForZoomLevel(z.z):1,dr=(xr,nr)=>{nr.x<0||nr.x>=ft||nr.y<0||nr.y>=ft||(function(Gt,zr,en,Gn,js,qa,Yo,xs,Wi,Xn,ws,Es,xo,Ka,Yn,Jo,Hn,Jn,Qn,Rn,Ci,dc,cm,fc,G6){const um=Gt.addToLineVertexArray(zr,en);let Jf,hm,dm,fm,bS=0,xS=0,wS=0,ES=0,zb=-1,jb=-1;const _h={};let AS=sc("");if(Gt.allowVerticalPlacement&&Gn.vertical){const no=xs.layout.get("text-rotate").evaluate(Ci,{},fc)+90;dm=new I0(Wi,zr,Xn,ws,Es,Gn.vertical,xo,Ka,Yn,no),Yo&&(fm=new I0(Wi,zr,Xn,ws,Es,Yo,Hn,Jn,Yn,no))}if(js){const no=xs.layout.get("icon-rotate").evaluate(Ci,{}),Ml=xs.layout.get("icon-text-fit")!=="none",Qf=hS(js,no,cm,Ml),fu=Yo?hS(Yo,no,cm,Ml):void 0;hm=new I0(Wi,zr,Xn,ws,Es,js,Hn,Jn,!1,no),bS=4*Qf.length;const ep=Gt.iconSizeData;let pu=null;ep.kind==="source"?(pu=[vt*xs.layout.get("icon-size").evaluate(Ci,{})],pu[0]>gt&&si(`${Gt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):ep.kind==="composite"&&(pu=[vt*dc.compositeIconSizes[0].evaluate(Ci,{},fc),vt*dc.compositeIconSizes[1].evaluate(Ci,{},fc)],(pu[0]>gt||pu[1]>gt)&&si(`${Gt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),Gt.addSymbols(Gt.icon,Qf,pu,Rn,Qn,Ci,c.ao.none,zr,um.lineStartIndex,um.lineLength,-1,fc),zb=Gt.icon.placedSymbolArray.length-1,fu&&(xS=4*fu.length,Gt.addSymbols(Gt.icon,fu,pu,Rn,Qn,Ci,c.ao.vertical,zr,um.lineStartIndex,um.lineLength,-1,fc),jb=Gt.icon.placedSymbolArray.length-1)}const TS=Object.keys(Gn.horizontal);for(const no of TS){const Ml=Gn.horizontal[no];if(!Jf){AS=sc(Ml.text);const fu=xs.layout.get("text-rotate").evaluate(Ci,{},fc);Jf=new I0(Wi,zr,Xn,ws,Es,Ml,xo,Ka,Yn,fu)}const Qf=Ml.positionedLines.length===1;if(wS+=mS(Gt,zr,Ml,qa,xs,Yn,Ci,Jo,um,Gn.vertical?c.ao.horizontal:c.ao.horizontalOnly,Qf?TS:[no],_h,zb,dc,fc),Qf)break}Gn.vertical&&(ES+=mS(Gt,zr,Gn.vertical,qa,xs,Yn,Ci,Jo,um,c.ao.vertical,["vertical"],_h,jb,dc,fc));const H6=Jf?Jf.boxStartIndex:Gt.collisionBoxArray.length,$6=Jf?Jf.boxEndIndex:Gt.collisionBoxArray.length,W6=dm?dm.boxStartIndex:Gt.collisionBoxArray.length,q6=dm?dm.boxEndIndex:Gt.collisionBoxArray.length,K6=hm?hm.boxStartIndex:Gt.collisionBoxArray.length,Z6=hm?hm.boxEndIndex:Gt.collisionBoxArray.length,X6=fm?fm.boxStartIndex:Gt.collisionBoxArray.length,Y6=fm?fm.boxEndIndex:Gt.collisionBoxArray.length;let pc=-1;const B0=(no,Ml)=>no&&no.circleDiameter?Math.max(no.circleDiameter,Ml):Ml;pc=B0(Jf,pc),pc=B0(dm,pc),pc=B0(hm,pc),pc=B0(fm,pc);const SS=pc>-1?1:0;SS&&(pc*=G6/xn),Gt.glyphOffsetArray.length>=Xt.MAX_GLYPHS&&si("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Ci.sortKey!==void 0&&Gt.addToSortKeyRanges(Gt.symbolInstances.length,Ci.sortKey);const J6=pS(xs,Ci,fc),[Q6,eN]=(function(no,Ml){const Qf=no.length,fu=Ml?.values;if(fu?.length>0)for(let ep=0;ep<fu.length;ep+=2){const pu=fu[ep+1];no.emplaceBack(c.aE[fu[ep]],pu[0],pu[1])}return[Qf,no.length]})(Gt.textAnchorOffsets,J6);Gt.symbolInstances.emplaceBack(zr.x,zr.y,_h.right>=0?_h.right:-1,_h.center>=0?_h.center:-1,_h.left>=0?_h.left:-1,_h.vertical||-1,zb,jb,AS,H6,$6,W6,q6,K6,Z6,X6,Y6,Xn,wS,ES,bS,xS,SS,0,xo,pc,Q6,eN)})(h,nr,xr,u,p,y,It,h.layers[0],h.collisionBoxArray,a.index,a.sourceLayerIndex,h.index,ve,[Je,Je,Je,Je],kt,k,Ee,st,Et,te,a,E,D,z,T)};if(Mt==="line")for(const xr of sS(a.geometry,0,0,ft,ft)){const nr=Di(xr,ct),Gt=D6(nr,Re,pt,u.vertical||oe,p,24,Fe,h.overscaling,ft);for(const zr of Gt)oe&&U6(h,oe.text,Yt,zr)||dr(nr,zr)}else if(Mt==="line-center"){for(const xr of a.geometry)if(xr.length>1){const nr=Di(xr,ct),Gt=O6(nr,pt,u.vertical||oe,p,24,Fe);Gt&&dr(nr,Gt)}}else if(a.type==="Polygon")for(const xr of Hc(a.geometry,0)){const nr=F6(xr,16);dr(Di(xr[0],ct,!0),new md(nr.x,nr.y,0))}else if(a.type==="LineString")for(const xr of a.geometry){const nr=Di(xr,ct);dr(nr,new md(nr[0].x,nr[0].y,0))}else if(a.type==="Point")for(const xr of a.geometry)for(const nr of xr)dr([nr],new md(nr.x,nr.y,0))}function mS(h,a,u,p,y,E,T,P,k,D,z,$,Y,Q,te){const oe=(function(Fe,Ee,Re,Je,st,pt,kt,Et){const Mt=Je.layout.get("text-rotate").evaluate(pt,{})*Math.PI/180,Yt=[];for(const Ct of Ee.positionedLines)for(const It of Ct.positionedGlyphs){if(!It.rect)continue;const ct=It.rect||{};let dr=4,xr=!0,nr=1,Gt=0;const zr=(st||Et)&&It.vertical,en=It.metrics.advance*It.scale/2;if(Et&&Ee.verticalizable&&(Gt=Ct.lineOffset/2-(It.imageName?-(xn-It.metrics.width*It.scale)/2:(It.scale-1)*xn)),It.imageName){const Jn=kt[It.imageName];xr=Jn.sdf,nr=Jn.pixelRatio,dr=1/nr}const Gn=st?[It.x+en,It.y]:[0,0];let js=st?[0,0]:[It.x+en+Re[0],It.y+Re[1]-Gt],qa=[0,0];zr&&(qa=js,js=[0,0]);const Yo=It.metrics.isDoubleResolution?2:1,xs=(It.metrics.left-dr)*It.scale-en+js[0],Wi=(-It.metrics.top-dr)*It.scale+js[1],Xn=xs+ct.w/Yo*It.scale/nr,ws=Wi+ct.h/Yo*It.scale/nr,Es=new m(xs,Wi),xo=new m(Xn,Wi),Ka=new m(xs,ws),Yn=new m(Xn,ws);if(zr){const Jn=new m(-en,en- -17),Qn=-Math.PI/2,Rn=12-en,Ci=new m(22-Rn,-(It.imageName?Rn:0)),dc=new m(...qa);Es._rotateAround(Qn,Jn)._add(Ci)._add(dc),xo._rotateAround(Qn,Jn)._add(Ci)._add(dc),Ka._rotateAround(Qn,Jn)._add(Ci)._add(dc),Yn._rotateAround(Qn,Jn)._add(Ci)._add(dc)}if(Mt){const Jn=Math.sin(Mt),Qn=Math.cos(Mt),Rn=[Qn,-Jn,Jn,Qn];Es._matMult(Rn),xo._matMult(Rn),Ka._matMult(Rn),Yn._matMult(Rn)}const Jo=new m(0,0),Hn=new m(0,0);Yt.push({tl:Es,tr:xo,bl:Ka,br:Yn,tex:ct,writingMode:Ee.writingMode,glyphOffset:Gn,sectionIndex:It.sectionIndex,isSDF:xr,pixelOffsetTL:Jo,pixelOffsetBR:Hn,minFontScaleX:0,minFontScaleY:0})}return Yt})(0,u,P,y,E,T,p,h.allowVerticalPlacement),de=h.textSizeData;let ve=null;de.kind==="source"?(ve=[vt*y.layout.get("text-size").evaluate(T,{})],ve[0]>gt&&si(`${h.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):de.kind==="composite"&&(ve=[vt*Q.compositeTextSizes[0].evaluate(T,{},te),vt*Q.compositeTextSizes[1].evaluate(T,{},te)],(ve[0]>gt||ve[1]>gt)&&si(`${h.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),h.addSymbols(h.text,oe,ve,P,E,T,D,a,k.lineStartIndex,k.lineLength,Y,te);for(const Fe of z)$[Fe]=h.text.placedSymbolArray.length-1;return 4*oe.length}function gS(h){for(const a in h)return h[a];return null}function U6(h,a,u,p){const y=h.compareText;if(a in y){const E=y[a];for(let T=E.length-1;T>=0;T--)if(p.dist(E[T])<u)return!0}else y[a]=[];return y[a].push(p),!1}const _S=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class kb{static from(a){if(!(a instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[u,p]=new Uint8Array(a,0,2);if(u!==219)throw new Error("Data does not appear to be in a KDBush format.");const y=p>>4;if(y!==1)throw new Error(`Got v${y} data when expected v1.`);const E=_S[15&p];if(!E)throw new Error("Unrecognized array type.");const[T]=new Uint16Array(a,2,1),[P]=new Uint32Array(a,4,1);return new kb(P,T,E,a)}constructor(a,u=64,p=Float64Array,y){if(isNaN(a)||a<0)throw new Error(`Unpexpected numItems value: ${a}.`);this.numItems=+a,this.nodeSize=Math.min(Math.max(+u,2),65535),this.ArrayType=p,this.IndexArrayType=a<65536?Uint16Array:Uint32Array;const E=_S.indexOf(this.ArrayType),T=2*a*this.ArrayType.BYTES_PER_ELEMENT,P=a*this.IndexArrayType.BYTES_PER_ELEMENT,k=(8-P%8)%8;if(E<0)throw new Error(`Unexpected typed array class: ${p}.`);y&&y instanceof ArrayBuffer?(this.data=y,this.ids=new this.IndexArrayType(this.data,8,a),this.coords=new this.ArrayType(this.data,8+P+k,2*a),this._pos=2*a,this._finished=!0):(this.data=new ArrayBuffer(8+T+P+k),this.ids=new this.IndexArrayType(this.data,8,a),this.coords=new this.ArrayType(this.data,8+P+k,2*a),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+E]),new Uint16Array(this.data,2,1)[0]=u,new Uint32Array(this.data,4,1)[0]=a)}add(a,u){const p=this._pos>>1;return this.ids[p]=p,this.coords[this._pos++]=a,this.coords[this._pos++]=u,p}finish(){const a=this._pos>>1;if(a!==this.numItems)throw new Error(`Added ${a} items when expected ${this.numItems}.`);return Bb(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(a,u,p,y){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:E,coords:T,nodeSize:P}=this,k=[0,E.length-1,0],D=[];for(;k.length;){const z=k.pop()||0,$=k.pop()||0,Y=k.pop()||0;if($-Y<=P){for(let de=Y;de<=$;de++){const ve=T[2*de],Fe=T[2*de+1];ve>=a&&ve<=p&&Fe>=u&&Fe<=y&&D.push(E[de])}continue}const Q=Y+$>>1,te=T[2*Q],oe=T[2*Q+1];te>=a&&te<=p&&oe>=u&&oe<=y&&D.push(E[Q]),(z===0?a<=te:u<=oe)&&(k.push(Y),k.push(Q-1),k.push(1-z)),(z===0?p>=te:y>=oe)&&(k.push(Q+1),k.push($),k.push(1-z))}return D}within(a,u,p){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:y,coords:E,nodeSize:T}=this,P=[0,y.length-1,0],k=[],D=p*p;for(;P.length;){const z=P.pop()||0,$=P.pop()||0,Y=P.pop()||0;if($-Y<=T){for(let de=Y;de<=$;de++)vS(E[2*de],E[2*de+1],a,u)<=D&&k.push(y[de]);continue}const Q=Y+$>>1,te=E[2*Q],oe=E[2*Q+1];vS(te,oe,a,u)<=D&&k.push(y[Q]),(z===0?a-p<=te:u-p<=oe)&&(P.push(Y),P.push(Q-1),P.push(1-z)),(z===0?a+p>=te:u+p>=oe)&&(P.push(Q+1),P.push($),P.push(1-z))}return k}}function Bb(h,a,u,p,y,E){if(y-p<=u)return;const T=p+y>>1;yS(h,a,T,p,y,E),Bb(h,a,u,p,T-1,1-E),Bb(h,a,u,T+1,y,1-E)}function yS(h,a,u,p,y,E){for(;y>p;){if(y-p>600){const D=y-p+1,z=u-p+1,$=Math.log(D),Y=.5*Math.exp(2*$/3),Q=.5*Math.sqrt($*Y*(D-Y)/D)*(z-D/2<0?-1:1);yS(h,a,u,Math.max(p,Math.floor(u-z*Y/D+Q)),Math.min(y,Math.floor(u+(D-z)*Y/D+Q)),E)}const T=a[2*u+E];let P=p,k=y;for(x_(h,a,p,u),a[2*y+E]>T&&x_(h,a,p,y);P<k;){for(x_(h,a,P,k),P++,k--;a[2*P+E]<T;)P++;for(;a[2*k+E]>T;)k--}a[2*p+E]===T?x_(h,a,p,k):(k++,x_(h,a,k,y)),k<=u&&(p=k+1),u<=k&&(y=k-1)}}function x_(h,a,u,p){Lb(h,u,p),Lb(a,2*u,2*p),Lb(a,2*u+1,2*p+1)}function Lb(h,a,u){const p=h[a];h[a]=h[u],h[u]=p}function vS(h,a,u,p){const y=h-u,E=a-p;return y*y+E*E}var Ob;c.cx=void 0,(Ob=c.cx||(c.cx={})).create="create",Ob.load="load",Ob.fullLoad="fullLoad";let k0=null,w_=[];const Db=1e3/60,Nb="loadTime",Fb="fullLoadTime",V6={mark(h){performance.mark(h)},frame(h){const a=h;k0!=null&&w_.push(a-k0),k0=a},clearMetrics(){k0=null,w_=[],performance.clearMeasures(Nb),performance.clearMeasures(Fb);for(const h in c.cx)performance.clearMarks(c.cx[h])},getPerformanceMetrics(){performance.measure(Nb,c.cx.create,c.cx.load),performance.measure(Fb,c.cx.create,c.cx.fullLoad);const h=performance.getEntriesByName(Nb)[0].duration,a=performance.getEntriesByName(Fb)[0].duration,u=w_.length,p=1/(w_.reduce(((E,T)=>E+T),0)/u/1e3),y=w_.filter((E=>E>Db)).reduce(((E,T)=>E+(T-Db)/Db),0);return{loadTime:h,fullLoadTime:a,fps:p,percentDroppedFrames:y/(u+y)*100,totalFrames:u}}};c.$=ft,c.A=ee,c.B=function([h,a,u]){return a+=90,a*=Math.PI/180,u*=Math.PI/180,{x:h*Math.cos(a)*Math.sin(u),y:h*Math.sin(a)*Math.sin(u),z:h*Math.cos(u)}},c.C=Fo,c.D=zt,c.E=Dt,c.F=ri,c.G=iu,c.H=function(h){if(Ln==null){const a=h.navigator?h.navigator.userAgent:null;Ln=!!h.safari||!(!a||!(/\b(iPad|iPhone|iPod)\b/.test(a)||a.match("Safari")&&!a.match("Chrome")))}return Ln},c.I=qf,c.J=class{constructor(h,a){this.target=h,this.mapId=a,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new k6((()=>this.process())),this.subscription=Po(this.target,"message",(u=>this.receive(u)),!1),this.globalScope=zi(self)?h:window}registerMessageHandler(h,a){this.messageHandlers[h]=a}sendAsync(h,a){return new Promise(((u,p)=>{const y=Math.round(1e18*Math.random()).toString(36).substring(0,10),E=a?Po(a.signal,"abort",(()=>{E?.unsubscribe(),delete this.resolveRejects[y];const k={id:y,type:"<cancel>",origin:location.origin,targetMapId:h.targetMapId,sourceMapId:this.mapId};this.target.postMessage(k)}),B6):null;this.resolveRejects[y]={resolve:k=>{E?.unsubscribe(),u(k)},reject:k=>{E?.unsubscribe(),p(k)}};const T=[],P=Object.assign(Object.assign({},h),{id:y,sourceMapId:this.mapId,origin:location.origin,data:Ls(h.data,T)});this.target.postMessage(P,{transfer:T})}))}receive(h){const a=h.data,u=a.id;if(!(a.origin!=="file://"&&location.origin!=="file://"&&a.origin!=="resource://android"&&location.origin!=="resource://android"&&a.origin!==location.origin||a.targetMapId&&this.mapId!==a.targetMapId)){if(a.type==="<cancel>"){delete this.tasks[u];const p=this.abortControllers[u];return delete this.abortControllers[u],void(p&&p.abort())}if(zi(self)||a.mustQueue)return this.tasks[u]=a,this.taskQueue.push(u),void this.invoker.trigger();this.processTask(u,a)}}process(){if(this.taskQueue.length===0)return;const h=this.taskQueue.shift(),a=this.tasks[h];delete this.tasks[h],this.taskQueue.length>0&&this.invoker.trigger(),a&&this.processTask(h,a)}processTask(h,a){return o(this,void 0,void 0,(function*(){if(a.type==="<response>"){const y=this.resolveRejects[h];return delete this.resolveRejects[h],y?void(a.error?y.reject(ds(a.error)):y.resolve(ds(a.data))):void 0}if(!this.messageHandlers[a.type])return void this.completeTask(h,new Error(`Could not find a registered handler for ${a.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const u=ds(a.data),p=new AbortController;this.abortControllers[h]=p;try{const y=yield this.messageHandlers[a.type](a.sourceMapId,u,p);this.completeTask(h,null,y)}catch(y){this.completeTask(h,y)}}))}completeTask(h,a,u){const p=[];delete this.abortControllers[h];const y={id:h,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:a?Ls(a):null,data:Ls(u,p)};this.target.postMessage(y,{transfer:p})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},c.K=ce,c.L=function(){var h=new ee(16);return ee!=Float32Array&&(h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[6]=0,h[7]=0,h[8]=0,h[9]=0,h[11]=0,h[12]=0,h[13]=0,h[14]=0),h[0]=1,h[5]=1,h[10]=1,h[15]=1,h},c.M=function(h,a,u){var p,y,E,T,P,k,D,z,$,Y,Q,te,oe=u[0],de=u[1],ve=u[2];return a===h?(h[12]=a[0]*oe+a[4]*de+a[8]*ve+a[12],h[13]=a[1]*oe+a[5]*de+a[9]*ve+a[13],h[14]=a[2]*oe+a[6]*de+a[10]*ve+a[14],h[15]=a[3]*oe+a[7]*de+a[11]*ve+a[15]):(y=a[1],E=a[2],T=a[3],P=a[4],k=a[5],D=a[6],z=a[7],$=a[8],Y=a[9],Q=a[10],te=a[11],h[0]=p=a[0],h[1]=y,h[2]=E,h[3]=T,h[4]=P,h[5]=k,h[6]=D,h[7]=z,h[8]=$,h[9]=Y,h[10]=Q,h[11]=te,h[12]=p*oe+P*de+$*ve+a[12],h[13]=y*oe+k*de+Y*ve+a[13],h[14]=E*oe+D*de+Q*ve+a[14],h[15]=T*oe+z*de+te*ve+a[15]),h},c.N=function(h,a,u){var p=u[0],y=u[1],E=u[2];return h[0]=a[0]*p,h[1]=a[1]*p,h[2]=a[2]*p,h[3]=a[3]*p,h[4]=a[4]*y,h[5]=a[5]*y,h[6]=a[6]*y,h[7]=a[7]*y,h[8]=a[8]*E,h[9]=a[9]*E,h[10]=a[10]*E,h[11]=a[11]*E,h[12]=a[12],h[13]=a[13],h[14]=a[14],h[15]=a[15],h},c.O=function(h,a,u){var p=a[0],y=a[1],E=a[2],T=a[3],P=a[4],k=a[5],D=a[6],z=a[7],$=a[8],Y=a[9],Q=a[10],te=a[11],oe=a[12],de=a[13],ve=a[14],Fe=a[15],Ee=u[0],Re=u[1],Je=u[2],st=u[3];return h[0]=Ee*p+Re*P+Je*$+st*oe,h[1]=Ee*y+Re*k+Je*Y+st*de,h[2]=Ee*E+Re*D+Je*Q+st*ve,h[3]=Ee*T+Re*z+Je*te+st*Fe,h[4]=(Ee=u[4])*p+(Re=u[5])*P+(Je=u[6])*$+(st=u[7])*oe,h[5]=Ee*y+Re*k+Je*Y+st*de,h[6]=Ee*E+Re*D+Je*Q+st*ve,h[7]=Ee*T+Re*z+Je*te+st*Fe,h[8]=(Ee=u[8])*p+(Re=u[9])*P+(Je=u[10])*$+(st=u[11])*oe,h[9]=Ee*y+Re*k+Je*Y+st*de,h[10]=Ee*E+Re*D+Je*Q+st*ve,h[11]=Ee*T+Re*z+Je*te+st*Fe,h[12]=(Ee=u[12])*p+(Re=u[13])*P+(Je=u[14])*$+(st=u[15])*oe,h[13]=Ee*y+Re*k+Je*Y+st*de,h[14]=Ee*E+Re*D+Je*Q+st*ve,h[15]=Ee*T+Re*z+Je*te+st*Fe,h},c.P=m,c.Q=function(h,a){const u={};for(let p=0;p<a.length;p++){const y=a[p];y in h&&(u[y]=h[y])}return u},c.R=to,c.S=pd,c.T=nd,c.U=XT,c.V=ZT,c.W=q,c.X=J,c.Y=ss,c.Z=Wa,c._=o,c.a=ne,c.a$=sr,c.a0=function(h,a){var u,p,y,E;if(!h)return a??{};if(!a)return h;const T=Object.assign({},h);if(a.removeAll&&(T.removeAll=!0),a.remove){const P=new Set(T.remove?T.remove.concat(a.remove):a.remove);T.remove=Array.from(P.values())}if(a.add){const P=T.add?T.add.concat(a.add):a.add,k=new Map(P.map((D=>[D.id,D])));T.add=Array.from(k.values())}if(a.update){const P=new Map((u=T.update)===null||u===void 0?void 0:u.map((k=>[k.id,k])));for(const k of a.update){const D=(p=P.get(k.id))!==null&&p!==void 0?p:{id:k.id};k.newGeometry&&(D.newGeometry=k.newGeometry),k.addOrUpdateProperties&&(D.addOrUpdateProperties=((y=D.addOrUpdateProperties)!==null&&y!==void 0?y:[]).concat(k.addOrUpdateProperties)),k.removeProperties&&(D.removeProperties=((E=D.removeProperties)!==null&&E!==void 0?E:[]).concat(k.removeProperties)),k.removeAllProperties&&(D.removeAllProperties=!0),P.set(k.id,D)}T.update=Array.from(P.values())}return T},c.a1=v_,c.a2=Yf,c.a3=25,c.a4=Rb,c.a5=h=>{const a=window.document.createElement("video");return a.muted=!0,new Promise((u=>{a.onloadstart=()=>{u(a)};for(const p of h){const y=window.document.createElement("source");Ye(p)||(a.crossOrigin="Anonymous"),y.src=p,a.appendChild(y)}}))},c.a6=yt,c.a7=function(){return Qt++},c.a8=W,c.a9=Xt,c.aA=function(h){let a=1/0,u=1/0,p=-1/0,y=-1/0;for(const E of h)a=Math.min(a,E.x),u=Math.min(u,E.y),p=Math.max(p,E.x),y=Math.max(y,E.y);return[a,u,p,y]},c.aB=xn,c.aC=Tt,c.aD=function(h,a,u,p,y=!1){if(!u[0]&&!u[1])return[0,0];const E=y?p==="map"?-h.bearingInRadians:0:p==="viewport"?h.bearingInRadians:0;if(E){const T=Math.sin(E),P=Math.cos(E);u=[u[0]*P-u[1]*T,u[0]*T+u[1]*P]}return[y?u[0]:Tt(a,u[0],h.zoom),y?u[1]:Tt(a,u[1],h.zoom)]},c.aF=Kt,c.aG=Ib,c.aH=_,c.aI=kb,c.aJ=Li,c.aK=vn,c.aL=be,c.aM=br,c.aN=ii,c.aO=$t,c.aP=Ro,c.aQ=JT,c.aR=at,c.aS=$e,c.aT=function(h){var a=new ee(3);return a[0]=h[0],a[1]=h[1],a[2]=h[2],a},c.aU=function(h,a,u){return h[0]=a[0]-u[0],h[1]=a[1]-u[1],h[2]=a[2]-u[2],h},c.aV=function(h,a){var u=a[0],p=a[1],y=a[2],E=u*u+p*p+y*y;return E>0&&(E=1/Math.sqrt(E)),h[0]=a[0]*E,h[1]=a[1]*E,h[2]=a[2]*E,h},c.aW=_t,c.aX=function(h,a){return h[0]*a[0]+h[1]*a[1]+h[2]*a[2]},c.aY=function(h,a,u){return h[0]=a[0]*u[0],h[1]=a[1]*u[1],h[2]=a[2]*u[2],h[3]=a[3]*u[3],h},c.aZ=Ve,c.a_=function(h,a,u){const p=a[0]*u[0]+a[1]*u[1]+a[2]*u[2];return p===0?null:(-(h[0]*u[0]+h[1]*u[1]+h[2]*u[2])-u[3])/p},c.aa=na,c.ab=Ga,c.ac=rS,c.ad=function(h){const a={};if(h.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((u,p,y,E)=>{const T=y||E;return a[p]=!T||T.toLowerCase(),""})),a["max-age"]){const u=parseInt(a["max-age"],10);isNaN(u)?delete a["max-age"]:a["max-age"]=u}return a},c.ae=ea,c.af=function(h){return Math.pow(2,h)},c.ag=Se,c.ah=yr,c.ai=85.051129,c.aj=YT,c.ak=function(h){return Math.log(h)/Math.LN2},c.al=function(h){var a=h[0],u=h[1];return a*a+u*u},c.am=function(h,a){const u=[];for(const p in h)p in a||u.push(p);return u},c.an=function(h,a){let u=0,p=0;if(h.kind==="constant")p=h.layoutSize;else if(h.kind!=="source"){const{interpolationType:y,minZoom:E,maxZoom:T}=h,P=y?yr(Yi.interpolationFactor(y,a,E,T),0,1):0;h.kind==="camera"?p=Fo.number(h.minSize,h.maxSize,P):u=P}return{uSizeT:u,uSize:p}},c.ap=function(h,{uSize:a,uSizeT:u},{lowerSize:p,upperSize:y}){return h.kind==="source"?p/vt:h.kind==="composite"?Fo.number(p/vt,y/vt,u):a},c.aq=function(h,a){var u=a[0],p=a[1],y=a[2],E=a[3],T=a[4],P=a[5],k=a[6],D=a[7],z=a[8],$=a[9],Y=a[10],Q=a[11],te=a[12],oe=a[13],de=a[14],ve=a[15],Fe=u*P-p*T,Ee=u*k-y*T,Re=u*D-E*T,Je=p*k-y*P,st=p*D-E*P,pt=y*D-E*k,kt=z*oe-$*te,Et=z*de-Y*te,Mt=z*ve-Q*te,Yt=$*de-Y*oe,Ct=$*ve-Q*oe,It=Y*ve-Q*de,ct=Fe*It-Ee*Ct+Re*Yt+Je*Mt-st*Et+pt*kt;return ct?(h[0]=(P*It-k*Ct+D*Yt)*(ct=1/ct),h[1]=(y*Ct-p*It-E*Yt)*ct,h[2]=(oe*pt-de*st+ve*Je)*ct,h[3]=(Y*st-$*pt-Q*Je)*ct,h[4]=(k*Mt-T*It-D*Et)*ct,h[5]=(u*It-y*Mt+E*Et)*ct,h[6]=(de*Re-te*pt-ve*Ee)*ct,h[7]=(z*pt-Y*Re+Q*Ee)*ct,h[8]=(T*Ct-P*Mt+D*kt)*ct,h[9]=(p*Mt-u*Ct-E*kt)*ct,h[10]=(te*st-oe*Re+ve*Fe)*ct,h[11]=($*Re-z*st-Q*Fe)*ct,h[12]=(P*Et-T*Yt-k*kt)*ct,h[13]=(u*Yt-p*Et+y*kt)*ct,h[14]=(oe*Ee-te*Je-de*Fe)*ct,h[15]=(z*Je-$*Ee+Y*Fe)*ct,h):null},c.ar=At,c.as=function(h){return Math.hypot(h[0],h[1])},c.at=function(h){return h[0]=0,h[1]=0,h},c.au=function(h,a,u){return h[0]=a[0]*u,h[1]=a[1]*u,h},c.av=Qe,c.aw=Ft,c.ax=function(h,a,u,p){const y=a.y-h.y,E=a.x-h.x,T=p.y-u.y,P=p.x-u.x,k=T*E-P*y;if(k===0)return null;const D=(P*(h.y-u.y)-T*(h.x-u.x))/k;return new m(h.x+D*E,h.y+D*y)},c.ay=sS,c.az=Wg,c.b=Ps,c.b$=class extends x{},c.b0=function(h,a,u){return h[0]=a[0]*u,h[1]=a[1]*u,h[2]=a[2]*u,h[3]=a[3]*u,h},c.b1=function(h,a){return h[0]*a[0]+h[1]*a[1]+h[2]*a[2]+h[3]},c.b2=eS,c.b3=am,c.b4=function(h,a,u,p,y){var E,T=1/Math.tan(a/2);return h[0]=T/u,h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[5]=T,h[6]=0,h[7]=0,h[8]=0,h[9]=0,h[11]=-1,h[12]=0,h[13]=0,h[15]=0,y!=null&&y!==1/0?(h[10]=(y+p)*(E=1/(p-y)),h[14]=2*y*p*E):(h[10]=-1,h[14]=-2*p),h},c.b5=function(h){var a=new ee(16);return a[0]=h[0],a[1]=h[1],a[2]=h[2],a[3]=h[3],a[4]=h[4],a[5]=h[5],a[6]=h[6],a[7]=h[7],a[8]=h[8],a[9]=h[9],a[10]=h[10],a[11]=h[11],a[12]=h[12],a[13]=h[13],a[14]=h[14],a[15]=h[15],a},c.b6=function(h,a,u){var p=Math.sin(u),y=Math.cos(u),E=a[0],T=a[1],P=a[2],k=a[3],D=a[4],z=a[5],$=a[6],Y=a[7];return a!==h&&(h[8]=a[8],h[9]=a[9],h[10]=a[10],h[11]=a[11],h[12]=a[12],h[13]=a[13],h[14]=a[14],h[15]=a[15]),h[0]=E*y+D*p,h[1]=T*y+z*p,h[2]=P*y+$*p,h[3]=k*y+Y*p,h[4]=D*y-E*p,h[5]=z*y-T*p,h[6]=$*y-P*p,h[7]=Y*y-k*p,h},c.b7=function(h,a,u){var p=Math.sin(u),y=Math.cos(u),E=a[4],T=a[5],P=a[6],k=a[7],D=a[8],z=a[9],$=a[10],Y=a[11];return a!==h&&(h[0]=a[0],h[1]=a[1],h[2]=a[2],h[3]=a[3],h[12]=a[12],h[13]=a[13],h[14]=a[14],h[15]=a[15]),h[4]=E*y+D*p,h[5]=T*y+z*p,h[6]=P*y+$*p,h[7]=k*y+Y*p,h[8]=D*y-E*p,h[9]=z*y-T*p,h[10]=$*y-P*p,h[11]=Y*y-k*p,h},c.b8=function(){const h=new Float32Array(16);return Se(h),h},c.b9=function(){const h=new Float64Array(16);return Se(h),h},c.bA=function(h,a){const u=ze(h,360),p=ze(a,360),y=p-u,E=p>u?y-360:y+360;return Math.abs(y)<Math.abs(E)?y:E},c.bB=function(h){return h[0]=0,h[1]=0,h[2]=0,h},c.bC=function(h,a,u,p){const y=Math.sqrt(h*h+a*a),E=Math.sqrt(u*u+p*p);h/=y,a/=y,u/=E,p/=E;const T=Math.acos(h*u+a*p);return-a*u+h*p>0?T:-T},c.bD=function(h,a){const u=ze(h,2*Math.PI),p=ze(a,2*Math.PI);return Math.min(Math.abs(u-p),Math.abs(u-p+2*Math.PI),Math.abs(u-p-2*Math.PI))},c.bE=function(){const h={},a=Ne.$version;for(const u in Ne.$root){const p=Ne.$root[u];if(p.required){let y=null;y=u==="version"?a:p.type==="array"?[]:{},y!=null&&(h[u]=y)}}return h},c.bF=la,c.bG=Ce,c.bH=function h(a,u){if(Array.isArray(a)){if(!Array.isArray(u)||a.length!==u.length)return!1;for(let p=0;p<a.length;p++)if(!h(a[p],u[p]))return!1;return!0}if(typeof a=="object"&&a!==null&&u!==null){if(typeof u!="object"||Object.keys(a).length!==Object.keys(u).length)return!1;for(const p in a)if(!h(a[p],u[p]))return!1;return!0}return a===u},c.bI=function(h){h=h.slice();const a=Object.create(null);for(let u=0;u<h.length;u++)a[h[u].id]=h[u];for(let u=0;u<h.length;u++)"ref"in h[u]&&(h[u]=Rr(h[u],a[h[u].ref]));return h},c.bJ=function(h){if(h.type==="custom")return new I6(h);switch(h.type){case"background":return new P6(h);case"circle":return new t0(h);case"color-relief":return new qt(h);case"fill":return new ud(h);case"fill-extrusion":return new bb(h);case"heatmap":return new n0(h);case"hillshade":return new Fs(h);case"line":return new fh(h);case"raster":return new M6(h);case"symbol":return new $r(h)}},c.bK=wi,c.bL=function(h,a){if(!h)return[{command:"setStyle",args:[a]}];let u=[];try{if(!Wt(h.version,a.version))return[{command:"setStyle",args:[a]}];Wt(h.center,a.center)||u.push({command:"setCenter",args:[a.center]}),Wt(h.state,a.state)||u.push({command:"setGlobalState",args:[a.state]}),Wt(h.centerAltitude,a.centerAltitude)||u.push({command:"setCenterAltitude",args:[a.centerAltitude]}),Wt(h.zoom,a.zoom)||u.push({command:"setZoom",args:[a.zoom]}),Wt(h.bearing,a.bearing)||u.push({command:"setBearing",args:[a.bearing]}),Wt(h.pitch,a.pitch)||u.push({command:"setPitch",args:[a.pitch]}),Wt(h.roll,a.roll)||u.push({command:"setRoll",args:[a.roll]}),Wt(h.sprite,a.sprite)||u.push({command:"setSprite",args:[a.sprite]}),Wt(h.glyphs,a.glyphs)||u.push({command:"setGlyphs",args:[a.glyphs]}),Wt(h.transition,a.transition)||u.push({command:"setTransition",args:[a.transition]}),Wt(h.light,a.light)||u.push({command:"setLight",args:[a.light]}),Wt(h.terrain,a.terrain)||u.push({command:"setTerrain",args:[a.terrain]}),Wt(h.sky,a.sky)||u.push({command:"setSky",args:[a.sky]}),Wt(h.projection,a.projection)||u.push({command:"setProjection",args:[a.projection]});const p={},y=[];(function(T,P,k,D){let z;for(z in P=P||{},T=T||{})Object.prototype.hasOwnProperty.call(T,z)&&(Object.prototype.hasOwnProperty.call(P,z)||Ii(z,k,D));for(z in P)Object.prototype.hasOwnProperty.call(P,z)&&(Object.prototype.hasOwnProperty.call(T,z)?Wt(T[z],P[z])||(T[z].type==="geojson"&&P[z].type==="geojson"&&fi(T,P,z)?vr(k,{command:"setGeoJSONSourceData",args:[z,P[z].data]}):ji(z,P,k,D)):Xr(z,P,k))})(h.sources,a.sources,y,p);const E=[];h.layers&&h.layers.forEach((T=>{"source"in T&&p[T.source]?u.push({command:"removeLayer",args:[T.id]}):E.push(T)})),u=u.concat(y),(function(T,P,k){P=P||[];const D=(T=T||[]).map(kr),z=P.map(kr),$=T.reduce(Ui,{}),Y=P.reduce(Ui,{}),Q=D.slice(),te=Object.create(null);let oe,de,ve,Fe,Ee;for(let Re=0,Je=0;Re<D.length;Re++)oe=D[Re],Object.prototype.hasOwnProperty.call(Y,oe)?Je++:(vr(k,{command:"removeLayer",args:[oe]}),Q.splice(Q.indexOf(oe,Je),1));for(let Re=0,Je=0;Re<z.length;Re++)oe=z[z.length-1-Re],Q[Q.length-1-Re]!==oe&&(Object.prototype.hasOwnProperty.call($,oe)?(vr(k,{command:"removeLayer",args:[oe]}),Q.splice(Q.lastIndexOf(oe,Q.length-Je),1)):Je++,Fe=Q[Q.length-Re],vr(k,{command:"addLayer",args:[Y[oe],Fe]}),Q.splice(Q.length-Re,0,oe),te[oe]=!0);for(let Re=0;Re<z.length;Re++)if(oe=z[Re],de=$[oe],ve=Y[oe],!te[oe]&&!Wt(de,ve))if(Wt(de.source,ve.source)&&Wt(de["source-layer"],ve["source-layer"])&&Wt(de.type,ve.type)){for(Ee in Tr(de.layout,ve.layout,k,oe,null,"setLayoutProperty"),Tr(de.paint,ve.paint,k,oe,null,"setPaintProperty"),Wt(de.filter,ve.filter)||vr(k,{command:"setFilter",args:[oe,ve.filter]}),Wt(de.minzoom,ve.minzoom)&&Wt(de.maxzoom,ve.maxzoom)||vr(k,{command:"setLayerZoomRange",args:[oe,ve.minzoom,ve.maxzoom]}),de)Object.prototype.hasOwnProperty.call(de,Ee)&&Ee!=="layout"&&Ee!=="paint"&&Ee!=="filter"&&Ee!=="metadata"&&Ee!=="minzoom"&&Ee!=="maxzoom"&&(Ee.indexOf("paint.")===0?Tr(de[Ee],ve[Ee],k,oe,Ee.slice(6),"setPaintProperty"):Wt(de[Ee],ve[Ee])||vr(k,{command:"setLayerProperty",args:[oe,Ee,ve[Ee]]}));for(Ee in ve)Object.prototype.hasOwnProperty.call(ve,Ee)&&!Object.prototype.hasOwnProperty.call(de,Ee)&&Ee!=="layout"&&Ee!=="paint"&&Ee!=="filter"&&Ee!=="metadata"&&Ee!=="minzoom"&&Ee!=="maxzoom"&&(Ee.indexOf("paint.")===0?Tr(de[Ee],ve[Ee],k,oe,Ee.slice(6),"setPaintProperty"):Wt(de[Ee],ve[Ee])||vr(k,{command:"setLayerProperty",args:[oe,Ee,ve[Ee]]}))}else vr(k,{command:"removeLayer",args:[oe]}),Fe=Q[Q.lastIndexOf(oe)+1],vr(k,{command:"addLayer",args:[ve,Fe]})})(E,a.layers,u)}catch(p){console.warn("Unable to compute style diff:",p),u=[{command:"setStyle",args:[a]}]}return u},c.bM=function(h){const a=[],u=h.id;return u===void 0&&a.push({message:`layers.${u}: missing required property "id"`}),h.render===void 0&&a.push({message:`layers.${u}: missing required method "render"`}),h.renderingMode&&h.renderingMode!=="2d"&&h.renderingMode!=="3d"&&a.push({message:`layers.${u}: property "renderingMode" must be either "2d" or "3d"`}),a},c.bN=Nr,c.bO=An,c.bP=class extends gs{constructor(h,a){super(h,a),this.current=0}set(h){this.current!==h&&(this.current=h,this.gl.uniform1i(this.location,h))}},c.bQ=an,c.bR=class extends gs{constructor(h,a){super(h,a),this.current=_s}set(h){if(h[12]!==this.current[12]||h[0]!==this.current[0])return this.current=h,void this.gl.uniformMatrix4fv(this.location,!1,h);for(let a=1;a<16;a++)if(h[a]!==this.current[a]){this.current=h,this.gl.uniformMatrix4fv(this.location,!1,h);break}}},c.bS=Qi,c.bT=class extends gs{constructor(h,a){super(h,a),this.current=[0,0,0]}set(h){h[0]===this.current[0]&&h[1]===this.current[1]&&h[2]===this.current[2]||(this.current=h,this.gl.uniform3f(this.location,h[0],h[1],h[2]))}},c.bU=class extends gs{constructor(h,a){super(h,a),this.current=[0,0]}set(h){h[0]===this.current[0]&&h[1]===this.current[1]||(this.current=h,this.gl.uniform2f(this.location,h[0],h[1]))}},c.bV=me,c.bW=function(h,a){var u=Math.sin(a),p=Math.cos(a);return h[0]=p,h[1]=u,h[2]=0,h[3]=-u,h[4]=p,h[5]=0,h[6]=0,h[7]=0,h[8]=1,h},c.bX=function(h,a,u){var p=a[0],y=a[1],E=a[2];return h[0]=p*u[0]+y*u[3]+E*u[6],h[1]=p*u[1]+y*u[4]+E*u[7],h[2]=p*u[2]+y*u[5]+E*u[8],h},c.bY=function(h,a,u,p,y,E,T){var P=1/(a-u),k=1/(p-y),D=1/(E-T);return h[0]=-2*P,h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[5]=-2*k,h[6]=0,h[7]=0,h[8]=0,h[9]=0,h[10]=2*D,h[11]=0,h[12]=(a+u)*P,h[13]=(y+p)*k,h[14]=(T+E)*D,h[15]=1,h},c.bZ=class extends gs{constructor(h,a){super(h,a),this.current=new Array}set(h){if(h!=this.current){this.current=h;const a=new Float32Array(4*h.length);for(let u=0;u<h.length;u++)a[4*u]=h[u].r,a[4*u+1]=h[u].g,a[4*u+2]=h[u].b,a[4*u+3]=h[u].a;this.gl.uniform4fv(this.location,a)}}},c.b_=class extends gs{constructor(h,a){super(h,a),this.current=new Array}set(h){if(h!=this.current){this.current=h;const a=new Float32Array(h);this.gl.uniform1fv(this.location,a)}}},c.ba=function(){return new Float64Array(16)},c.bb=function(h,a,u){const p=new Float64Array(4);return Lt(p,h,a-90,u),p},c.bc=function(h,a,u,p){var y,E,T,P,k,D=a[0],z=a[1],$=a[2],Y=a[3],Q=u[0],te=u[1],oe=u[2],de=u[3];return(E=D*Q+z*te+$*oe+Y*de)<0&&(E=-E,Q=-Q,te=-te,oe=-oe,de=-de),1-E>ie?(y=Math.acos(E),T=Math.sin(y),P=Math.sin((1-p)*y)/T,k=Math.sin(p*y)/T):(P=1-p,k=p),h[0]=P*D+k*Q,h[1]=P*z+k*te,h[2]=P*$+k*oe,h[3]=P*Y+k*de,h},c.bd=function(h){const a=new Float64Array(9);var u,p,y,E,T,P,k,D,z,$,Y,Q,te,oe,de,ve,Fe,Ee;$=(y=(p=h)[0])*(k=y+y),Y=(E=p[1])*k,te=(T=p[2])*k,oe=T*(D=E+E),ve=(P=p[3])*k,Fe=P*D,Ee=P*(z=T+T),(u=a)[0]=1-(Q=E*D)-(de=T*z),u[3]=Y-Ee,u[6]=te+Fe,u[1]=Y+Ee,u[4]=1-$-de,u[7]=oe-ve,u[2]=te-Fe,u[5]=oe+ve,u[8]=1-$-Q;const Re=Ro(-Math.asin(yr(a[2],-1,1)));let Je,st;return Math.hypot(a[5],a[8])<.001?(Je=0,st=-Ro(Math.atan2(a[3],a[4]))):(Je=Ro(a[5]===0&&a[8]===0?0:Math.atan2(a[5],a[8])),st=Ro(a[1]===0&&a[0]===0?0:Math.atan2(a[1],a[0]))),{roll:Je,pitch:Re+90,bearing:st}},c.be=function(h,a){return h.roll==a.roll&&h.pitch==a.pitch&&h.bearing==a.bearing},c.bf=lr,c.bg=Ua,c.bh=Oi,c.bi=bn,c.bj=jr,c.bk=ht,c.bl=Ht,c.bm=Nn,c.bn=function(h,a,u,p,y){return ht(p,y,yr((h-a)/(u-a),0,1))},c.bo=ze,c.bp=function(){return new Float64Array(3)},c.bq=function(h,a,u,p){return h[0]=a[0]+u[0]*p,h[1]=a[1]+u[1]*p,h[2]=a[2]+u[2]*p,h},c.br=Lt,c.bs=function(h,a,u){var p=u[0],y=u[1],E=u[2],T=a[0],P=a[1],k=a[2],D=y*k-E*P,z=E*T-p*k,$=p*P-y*T,Y=y*$-E*z,Q=E*D-p*$,te=p*z-y*D,oe=2*u[3];return z*=oe,$*=oe,Q*=2,te*=2,h[0]=T+(D*=oe)+(Y*=2),h[1]=P+z+Q,h[2]=k+$+te,h},c.bt=function(h,a,u){const p=(y=[h[0],h[1],h[2],a[0],a[1],a[2],u[0],u[1],u[2]])[0]*((z=y[8])*(T=y[4])-(P=y[5])*(D=y[7]))+y[1]*(-z*(E=y[3])+P*(k=y[6]))+y[2]*(D*E-T*k);var y,E,T,P,k,D,z;if(p===0)return null;const $=_t([],[a[0],a[1],a[2]],[u[0],u[1],u[2]]),Y=_t([],[u[0],u[1],u[2]],[h[0],h[1],h[2]]),Q=_t([],[h[0],h[1],h[2]],[a[0],a[1],a[2]]),te=at([],$,-h[3]);return $e(te,te,at([],Y,-a[3])),$e(te,te,at([],Q,-u[3])),at(te,te,1/p),te},c.bu=Cb,c.bv=function(){return new Float64Array(4)},c.bw=function(h,a,u,p){var y=[],E=[];return y[0]=a[0]-u[0],y[1]=a[1]-u[1],y[2]=a[2]-u[2],E[0]=y[0]*Math.cos(p)-y[1]*Math.sin(p),E[1]=y[0]*Math.sin(p)+y[1]*Math.cos(p),E[2]=y[2],h[0]=E[0]+u[0],h[1]=E[1]+u[1],h[2]=E[2]+u[2],h},c.bx=function(h,a,u,p){var y=[],E=[];return y[0]=a[0]-u[0],y[1]=a[1]-u[1],y[2]=a[2]-u[2],E[0]=y[0],E[1]=y[1]*Math.cos(p)-y[2]*Math.sin(p),E[2]=y[1]*Math.sin(p)+y[2]*Math.cos(p),h[0]=E[0]+u[0],h[1]=E[1]+u[1],h[2]=E[2]+u[2],h},c.by=function(h,a,u,p){var y=[],E=[];return y[0]=a[0]-u[0],y[1]=a[1]-u[1],y[2]=a[2]-u[2],E[0]=y[2]*Math.sin(p)+y[0]*Math.cos(p),E[1]=y[1],E[2]=y[2]*Math.cos(p)-y[0]*Math.sin(p),h[0]=E[0]+u[0],h[1]=E[1]+u[1],h[2]=E[2]+u[2],h},c.bz=function(h,a,u){var p=Math.sin(u),y=Math.cos(u),E=a[0],T=a[1],P=a[2],k=a[3],D=a[8],z=a[9],$=a[10],Y=a[11];return a!==h&&(h[4]=a[4],h[5]=a[5],h[6]=a[6],h[7]=a[7],h[12]=a[12],h[13]=a[13],h[14]=a[14],h[15]=a[15]),h[0]=E*y-D*p,h[1]=T*y-z*p,h[2]=P*y-$*p,h[3]=k*y-Y*p,h[8]=E*p+D*y,h[9]=T*p+z*y,h[10]=P*p+$*y,h[11]=k*p+Y*y,h},c.c=Oe,c.c0=b0,c.c1=class extends d{},c.c2=Bf,c.c3=function(h){return h<=1?1:Math.pow(2,Math.ceil(Math.log(h)/Math.LN2))},c.c4=Qg,c.c5=function(h,a,u){var p=a[0],y=a[1],E=a[2],T=u[3]*p+u[7]*y+u[11]*E+u[15];return h[0]=(u[0]*p+u[4]*y+u[8]*E+u[12])/(T=T||1),h[1]=(u[1]*p+u[5]*y+u[9]*E+u[13])/T,h[2]=(u[2]*p+u[6]*y+u[10]*E+u[14])/T,h},c.c6=class extends Qh{},c.c7=class extends F{},c.c8=function(h,a){return h[0]===a[0]&&h[1]===a[1]&&h[2]===a[2]&&h[3]===a[3]&&h[4]===a[4]&&h[5]===a[5]&&h[6]===a[6]&&h[7]===a[7]&&h[8]===a[8]&&h[9]===a[9]&&h[10]===a[10]&&h[11]===a[11]&&h[12]===a[12]&&h[13]===a[13]&&h[14]===a[14]&&h[15]===a[15]},c.c9=function(h,a){var u=h[0],p=h[1],y=h[2],E=h[3],T=h[4],P=h[5],k=h[6],D=h[7],z=h[8],$=h[9],Y=h[10],Q=h[11],te=h[12],oe=h[13],de=h[14],ve=h[15],Fe=a[0],Ee=a[1],Re=a[2],Je=a[3],st=a[4],pt=a[5],kt=a[6],Et=a[7],Mt=a[8],Yt=a[9],Ct=a[10],It=a[11],ct=a[12],dr=a[13],xr=a[14],nr=a[15];return Math.abs(u-Fe)<=ie*Math.max(1,Math.abs(u),Math.abs(Fe))&&Math.abs(p-Ee)<=ie*Math.max(1,Math.abs(p),Math.abs(Ee))&&Math.abs(y-Re)<=ie*Math.max(1,Math.abs(y),Math.abs(Re))&&Math.abs(E-Je)<=ie*Math.max(1,Math.abs(E),Math.abs(Je))&&Math.abs(T-st)<=ie*Math.max(1,Math.abs(T),Math.abs(st))&&Math.abs(P-pt)<=ie*Math.max(1,Math.abs(P),Math.abs(pt))&&Math.abs(k-kt)<=ie*Math.max(1,Math.abs(k),Math.abs(kt))&&Math.abs(D-Et)<=ie*Math.max(1,Math.abs(D),Math.abs(Et))&&Math.abs(z-Mt)<=ie*Math.max(1,Math.abs(z),Math.abs(Mt))&&Math.abs($-Yt)<=ie*Math.max(1,Math.abs($),Math.abs(Yt))&&Math.abs(Y-Ct)<=ie*Math.max(1,Math.abs(Y),Math.abs(Ct))&&Math.abs(Q-It)<=ie*Math.max(1,Math.abs(Q),Math.abs(It))&&Math.abs(te-ct)<=ie*Math.max(1,Math.abs(te),Math.abs(ct))&&Math.abs(oe-dr)<=ie*Math.max(1,Math.abs(oe),Math.abs(dr))&&Math.abs(de-xr)<=ie*Math.max(1,Math.abs(de),Math.abs(xr))&&Math.abs(ve-nr)<=ie*Math.max(1,Math.abs(ve),Math.abs(nr))},c.cA=function(h,a){ne.REGISTERED_PROTOCOLS[h]=a},c.cB=function(h){delete ne.REGISTERED_PROTOCOLS[h]},c.cC=function(h,a){const u={};for(let y=0;y<h.length;y++){const E=a&&a[h[y].id]||Gg(h[y]);a&&(a[h[y].id]=E);let T=u[E];T||(T=u[E]=[]),T.push(h[y])}const p=[];for(const y in u)p.push(u[y]);return p},c.cD=Ot,c.cE=tS,c.cF=iS,c.cG=A0,c.cH=function(h){h.bucket.createArrays(),h.bucket.tilePixelRatio=ft/(512*h.bucket.overscaling),h.bucket.compareText={},h.bucket.iconsNeedLinear=!1;const a=h.bucket.layers[0],u=a.layout,p=a._unevaluatedLayout._values,y={layoutIconSize:p["icon-size"].possiblyEvaluate(new ri(h.bucket.zoom+1),h.canonical),layoutTextSize:p["text-size"].possiblyEvaluate(new ri(h.bucket.zoom+1),h.canonical),textMaxSize:p["text-size"].possiblyEvaluate(new ri(18))};if(h.bucket.textSizeData.kind==="composite"){const{minZoom:D,maxZoom:z}=h.bucket.textSizeData;y.compositeTextSizes=[p["text-size"].possiblyEvaluate(new ri(D),h.canonical),p["text-size"].possiblyEvaluate(new ri(z),h.canonical)]}if(h.bucket.iconSizeData.kind==="composite"){const{minZoom:D,maxZoom:z}=h.bucket.iconSizeData;y.compositeIconSizes=[p["icon-size"].possiblyEvaluate(new ri(D),h.canonical),p["icon-size"].possiblyEvaluate(new ri(z),h.canonical)]}const E=u.get("text-line-height")*xn,T=u.get("text-rotation-alignment")!=="viewport"&&u.get("symbol-placement")!=="point",P=u.get("text-keep-upright"),k=u.get("text-size");for(const D of h.bucket.features){const z=u.get("text-font").evaluate(D,{},h.canonical).join(","),$=k.evaluate(D,{},h.canonical),Y=y.layoutTextSize.evaluate(D,{},h.canonical),Q=y.layoutIconSize.evaluate(D,{},h.canonical),te={horizontal:{},vertical:void 0},oe=D.text;let de,ve=[0,0];if(oe){const Re=oe.toString(),Je=u.get("text-letter-spacing").evaluate(D,{},h.canonical)*xn,st=Ef(Re)?Je:0,pt=u.get("text-anchor").evaluate(D,{},h.canonical),kt=pS(a,D,h.canonical);if(!kt){const Ct=u.get("text-radial-offset").evaluate(D,{},h.canonical);ve=Ct?fS(pt,[Ct*xn,Mb]):u.get("text-offset").evaluate(D,{},h.canonical).map((It=>It*xn))}let Et=T?"center":u.get("text-justify").evaluate(D,{},h.canonical);const Mt=u.get("symbol-placement")==="point"?u.get("text-max-width").evaluate(D,{},h.canonical)*xn:1/0,Yt=()=>{h.bucket.allowVerticalPlacement&&nu(Re)&&(te.vertical=fd(oe,h.glyphMap,h.glyphPositions,h.imagePositions,z,Mt,E,pt,"left",st,ve,c.ao.vertical,!0,Y,$))};if(!T&&kt){const Ct=new Set;if(Et==="auto")for(let ct=0;ct<kt.values.length;ct+=2)Ct.add(Ib(kt.values[ct]));else Ct.add(Et);let It=!1;for(const ct of Ct)if(!te.horizontal[ct])if(It)te.horizontal[ct]=te.horizontal[0];else{const dr=fd(oe,h.glyphMap,h.glyphPositions,h.imagePositions,z,Mt,E,"center",ct,st,ve,c.ao.horizontal,!1,Y,$);dr&&(te.horizontal[ct]=dr,It=dr.positionedLines.length===1)}Yt()}else{Et==="auto"&&(Et=Ib(pt));const Ct=fd(oe,h.glyphMap,h.glyphPositions,h.imagePositions,z,Mt,E,pt,Et,st,ve,c.ao.horizontal,!1,Y,$);Ct&&(te.horizontal[Et]=Ct),Yt(),nu(Re)&&T&&P&&(te.vertical=fd(oe,h.glyphMap,h.glyphPositions,h.imagePositions,z,Mt,E,pt,Et,st,ve,c.ao.vertical,!1,Y,$))}}let Fe=!1;if(D.icon&&D.icon.name){const Re=h.imageMap[D.icon.name];Re&&(de=Le(h.imagePositions[D.icon.name],u.get("icon-offset").evaluate(D,{},h.canonical),u.get("icon-anchor").evaluate(D,{},h.canonical)),Fe=!!Re.sdf,h.bucket.sdfIcons===void 0?h.bucket.sdfIcons=Fe:h.bucket.sdfIcons!==Fe&&si("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Re.pixelRatio!==h.bucket.pixelRatio||u.get("icon-rotate").constantOr(1)!==0)&&(h.bucket.iconsNeedLinear=!0))}const Ee=gS(te.horizontal)||te.vertical;h.bucket.iconsInText=!!Ee&&Ee.iconsInText,(Ee||de)&&j6(h.bucket,D,te,de,h.imageMap,y,Y,Q,ve,Fe,h.canonical,h.subdivisionGranularity)}h.showCollisionBoxes&&h.bucket.generateCollisionDebugBuffers()},c.cI=Vf,c.cJ=zf,c.cK=Rl,c.cL=Qp,c.cM=Wf,c.cN=class{constructor(h){this._marks={start:[h.url,"start"].join("#"),end:[h.url,"end"].join("#"),measure:h.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let h=performance.getEntriesByName(this._marks.measure);return h.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),h=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),h}},c.cO=function(h,a,u,p,y){return o(this,void 0,void 0,(function*(){if(J())try{return yield ss(h,a,u,p,y)}catch{}return(function(E,T,P,k,D){const z=E.width,$=E.height;vi&&lo||(vi=new OffscreenCanvas(z,$),lo=vi.getContext("2d",{willReadFrequently:!0})),vi.width=z,vi.height=$,lo.drawImage(E,0,0,z,$);const Y=lo.getImageData(T,P,k,D);return lo.clearRect(0,0,z,$),Y.data})(h,a,u,p,y)}))},c.cP=vs,c.cQ=b,c.cR=jf,c.cS=Zo,c.cT=Jc,c.cU=function(h,a){const u=new Map;if(h!=null)if(h.type==="Feature")u.set(b_(h,a),h);else for(const p of h.features)u.set(b_(p,a),p);return u},c.cV=function(h,a){if(h==null)return!0;if(h.type==="Feature")return b_(h,a)!=null;if(h.type==="FeatureCollection"){const u=new Set;for(const p of h.features){const y=b_(p,a);if(y==null||u.has(y))return!1;u.add(y)}return!0}return!1},c.cW=function(h,a,u){var p,y,E,T;if(a.removeAll&&h.clear(),a.remove)for(const P of a.remove)h.delete(P);if(a.add)for(const P of a.add){const k=b_(P,u);k!=null&&h.set(k,P)}if(a.update)for(const P of a.update){let k=h.get(P.id);if(k==null)continue;const D=!P.removeAllProperties&&(((p=P.removeProperties)===null||p===void 0?void 0:p.length)>0||((y=P.addOrUpdateProperties)===null||y===void 0?void 0:y.length)>0);if((P.newGeometry||P.removeAllProperties||D)&&(k=Object.assign({},k),h.set(P.id,k),D&&(k.properties=Object.assign({},k.properties))),P.newGeometry&&(k.geometry=P.newGeometry),P.removeAllProperties)k.properties={};else if(((E=P.removeProperties)===null||E===void 0?void 0:E.length)>0)for(const z of P.removeProperties)Object.prototype.hasOwnProperty.call(k.properties,z)&&delete k.properties[z];if(((T=P.addOrUpdateProperties)===null||T===void 0?void 0:T.length)>0)for(const{key:z,value:$}of P.addOrUpdateProperties)k.properties[z]=$}},c.cX=po,c.ca=function(h,a){return h[0]=a[0],h[1]=a[1],h[2]=a[2],h[3]=a[3],h[4]=a[4],h[5]=a[5],h[6]=a[6],h[7]=a[7],h[8]=a[8],h[9]=a[9],h[10]=a[10],h[11]=a[11],h[12]=a[12],h[13]=a[13],h[14]=a[14],h[15]=a[15],h},c.cb=h=>h.type==="symbol",c.cc=h=>h.type==="circle",c.cd=h=>h.type==="heatmap",c.ce=h=>h.type==="line",c.cf=h=>h.type==="fill",c.cg=h=>h.type==="fill-extrusion",c.ch=h=>h.type==="hillshade",c.ci=h=>h.type==="color-relief",c.cj=h=>h.type==="raster",c.ck=h=>h.type==="background",c.cl=h=>h.type==="custom",c.cm=Jt,c.cn=function(h,a,u){const p=Ke(a.x-u.x,a.y-u.y),y=Ke(h.x-u.x,h.y-u.y);var E,T;return Ro(Math.atan2(p[0]*y[1]-p[1]*y[0],(E=p)[0]*(T=y)[0]+E[1]*T[1]))},c.co=Pr,c.cp=function(h,a){return Gs[a]&&(h instanceof MouseEvent||h instanceof WheelEvent)},c.cq=function(h,a){return Mo[a]&&"touches"in h},c.cr=function(h){return Mo[h]||Gs[h]},c.cs=function(h,a,u){var p=a[0],y=a[1];return h[0]=u[0]*p+u[4]*y+u[12],h[1]=u[1]*p+u[5]*y+u[13],h},c.ct=function(h,a){const{x:u,y:p}=v_.fromLngLat(a);return!(h<0||h>25||p<0||p>=1||u<0||u>=1)},c.cu=function(h,a){return h[0]=a[0],h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[5]=a[1],h[6]=0,h[7]=0,h[8]=0,h[9]=0,h[10]=a[2],h[11]=0,h[12]=0,h[13]=0,h[14]=0,h[15]=1,h},c.cv=class extends Al{},c.cw=V6,c.cy=function(h){return h.message===co},c.cz=xe,c.d=Ye,c.e=pr,c.f=h=>o(void 0,void 0,void 0,(function*(){if(h.byteLength===0)return createImageBitmap(new ImageData(1,1));const a=new Blob([new Uint8Array(h)],{type:"image/png"});try{return createImageBitmap(a)}catch(u){throw new Error(`Could not load image because of ${u.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}})),c.g=se,c.h=h=>new Promise(((a,u)=>{const p=new Image;p.onload=()=>{a(p),URL.revokeObjectURL(p.src),p.onload=null,window.requestAnimationFrame((()=>{p.src=ns}))},p.onerror=()=>u(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const y=new Blob([new Uint8Array(h)],{type:"image/png"});p.src=h.byteLength?URL.createObjectURL(y):ns})),c.i=zi,c.j=(h,a)=>je(pr(h,{type:"json"}),a),c.k=lt,c.l=dt,c.m=je,c.n=(h,a)=>je(pr(h,{type:"arrayBuffer"}),a),c.o=function(h){return new Wf(h).readFields(E0,[])},c.p=y_,c.q=qo,c.r=zn,c.s=Po,c.t=su,c.u=Or,c.v=Ne,c.w=si,c.x=wf,c.y=oa,c.z=Na})),n("worker",["./shared"],(function(c){class o{constructor(ne){this.keyCache={},ne&&this.replace(ne)}replace(ne){this._layerConfigs={},this._layers={},this.update(ne,[])}update(ne,se){for(const xe of ne){this._layerConfigs[xe.id]=xe;const Ce=this._layers[xe.id]=c.bJ(xe);Ce._featureFilter=c.aa(Ce.filter),this.keyCache[xe.id]&&delete this.keyCache[xe.id]}for(const xe of se)delete this.keyCache[xe],delete this._layerConfigs[xe],delete this._layers[xe];this.familiesBySource={};const ce=c.cC(Object.values(this._layerConfigs),this.keyCache);for(const xe of ce){const Ce=xe.map((lt=>this._layers[lt.id])),je=Ce[0];if(je.visibility==="none")continue;const Ye=je.source||"";let De=this.familiesBySource[Ye];De||(De=this.familiesBySource[Ye]={});const nt=je.sourceLayer||"_geojsonTileLayer";let dt=De[nt];dt||(dt=De[nt]=[]),dt.push(Ce)}}}class m{constructor(ne){const se={},ce=[];for(const Ye in ne){const De=ne[Ye],nt=se[Ye]={};for(const dt in De){const lt=De[+dt];if(!lt||lt.bitmap.width===0||lt.bitmap.height===0)continue;const Dt={x:0,y:0,w:lt.bitmap.width+2,h:lt.bitmap.height+2};ce.push(Dt),nt[dt]={rect:Dt,metrics:lt.metrics}}}const{w:xe,h:Ce}=c.p(ce),je=new c.q({width:xe||1,height:Ce||1});for(const Ye in ne){const De=ne[Ye];for(const nt in De){const dt=De[+nt];if(!dt||dt.bitmap.width===0||dt.bitmap.height===0)continue;const lt=se[Ye][nt].rect;c.q.copy(dt.bitmap,je,{x:0,y:0},{x:lt.x+1,y:lt.y+1},dt.bitmap)}}this.image=je,this.positions=se}}c.cD("GlyphAtlas",m);class b{constructor(ne){this.tileID=new c.Z(ne.tileID.overscaledZ,ne.tileID.wrap,ne.tileID.canonical.z,ne.tileID.canonical.x,ne.tileID.canonical.y),this.uid=ne.uid,this.zoom=ne.zoom,this.pixelRatio=ne.pixelRatio,this.tileSize=ne.tileSize,this.source=ne.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=ne.showCollisionBoxes,this.collectResourceTiming=!!ne.collectResourceTiming,this.returnDependencies=!!ne.returnDependencies,this.promoteId=ne.promoteId,this.inFlightDependencies=[],this.globalState=ne.globalState}parse(ne,se,ce,xe,Ce){return c._(this,void 0,void 0,(function*(){this.status="parsing",this.data=ne,this.collisionBoxArray=new c.a8;const je=new c.cE(Object.keys(ne.layers).sort()),Ye=new c.cF(this.tileID,this.promoteId);Ye.bucketLayerIDs=[];const De={},nt={featureIndex:Ye,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:ce,subdivisionGranularity:Ce},dt=se.familiesBySource[this.source];for(const Tr in dt){const kr=ne.layers[Tr];if(!kr)continue;kr.version===1&&c.w(`Vector tile source "${this.source}" layer "${Tr}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Ui=je.encode(Tr),yt=[];for(let ki=0;ki<kr.length;ki++){const li=kr.feature(ki),Hs=Ye.getId(li,Tr);yt.push({feature:li,id:Hs,index:ki,sourceLayerIndex:Ui})}for(const ki of dt[Tr]){const li=ki[0];li.source!==this.source&&c.w(`layer.source = ${li.source} does not equal this.source = ${this.source}`),li.minzoom&&this.zoom<Math.floor(li.minzoom)||li.maxzoom&&this.zoom>=li.maxzoom||li.visibility!=="none"&&(A(ki,this.zoom,ce),(De[li.id]=li.createBucket({index:Ye.bucketLayerIDs.length,layers:ki,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Ui,sourceID:this.source,globalState:this.globalState})).populate(yt,nt,this.tileID.canonical),Ye.bucketLayerIDs.push(ki.map((Hs=>Hs.id))))}}const lt=c.bN(nt.glyphDependencies,(Tr=>Object.keys(Tr).map(Number)));this.inFlightDependencies.forEach((Tr=>Tr?.abort())),this.inFlightDependencies=[];let Dt=Promise.resolve({});if(Object.keys(lt).length){const Tr=new AbortController;this.inFlightDependencies.push(Tr),Dt=xe.sendAsync({type:"GG",data:{stacks:lt,source:this.source,tileID:this.tileID,type:"glyphs"}},Tr)}const Ne=Object.keys(nt.iconDependencies);let ar=Promise.resolve({});if(Ne.length){const Tr=new AbortController;this.inFlightDependencies.push(Tr),ar=xe.sendAsync({type:"GI",data:{icons:Ne,source:this.source,tileID:this.tileID,type:"icons"}},Tr)}const Rr=Object.keys(nt.patternDependencies);let Wt=Promise.resolve({});if(Rr.length){const Tr=new AbortController;this.inFlightDependencies.push(Tr),Wt=xe.sendAsync({type:"GI",data:{icons:Rr,source:this.source,tileID:this.tileID,type:"patterns"}},Tr)}const[vr,Xr,Ii]=yield Promise.all([Dt,ar,Wt]),ji=new m(vr),fi=new c.cG(Xr,Ii);for(const Tr in De){const kr=De[Tr];kr instanceof c.a9?(A(kr.layers,this.zoom,ce),c.cH({bucket:kr,glyphMap:vr,glyphPositions:ji.positions,imageMap:Xr,imagePositions:fi.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:nt.subdivisionGranularity})):kr.hasPattern&&(kr instanceof c.cI||kr instanceof c.cJ||kr instanceof c.cK)&&(A(kr.layers,this.zoom,ce),kr.addFeatures(nt,this.tileID.canonical,fi.patternPositions))}return this.status="done",{buckets:Object.values(De).filter((Tr=>!Tr.isEmpty())),featureIndex:Ye,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:ji.image,imageAtlas:fi,glyphMap:this.returnDependencies?vr:null,iconMap:this.returnDependencies?Xr:null,glyphPositions:this.returnDependencies?ji.positions:null}}))}}function A(Oe,ne,se){const ce=new c.F(ne);for(const xe of Oe)xe.recalculate(ce,se)}class R{constructor(ne,se,ce){this.actor=ne,this.layerIndex=se,this.availableImages=ce,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(ne,se){return c._(this,void 0,void 0,(function*(){const ce=yield c.n(ne.request,se);try{return{vectorTile:new c.cL(new c.cM(ce.data)),rawData:ce.data,cacheControl:ce.cacheControl,expires:ce.expires}}catch(xe){const Ce=new Uint8Array(ce.data);let je=`Unable to parse the tile at ${ne.request.url}, `;throw je+=Ce[0]===31&&Ce[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${xe.message}`,new Error(je)}}))}loadTile(ne){return c._(this,void 0,void 0,(function*(){const se=ne.uid,ce=!!(ne&&ne.request&&ne.request.collectResourceTiming)&&new c.cN(ne.request),xe=new b(ne);this.loading[se]=xe;const Ce=new AbortController;xe.abort=Ce;try{const je=yield this.loadVectorTile(ne,Ce);if(delete this.loading[se],!je)return null;const Ye=je.rawData,De={};je.expires&&(De.expires=je.expires),je.cacheControl&&(De.cacheControl=je.cacheControl);const nt={};if(ce){const lt=ce.finish();lt&&(nt.resourceTiming=JSON.parse(JSON.stringify(lt)))}xe.vectorTile=je.vectorTile;const dt=xe.parse(je.vectorTile,this.layerIndex,this.availableImages,this.actor,ne.subdivisionGranularity);this.loaded[se]=xe,this.fetching[se]={rawTileData:Ye,cacheControl:De,resourceTiming:nt};try{const lt=yield dt;return c.e({rawTileData:Ye.slice(0)},lt,De,nt)}finally{delete this.fetching[se]}}catch(je){throw delete this.loading[se],xe.status="done",this.loaded[se]=xe,je}}))}reloadTile(ne){return c._(this,void 0,void 0,(function*(){const se=ne.uid;if(!this.loaded||!this.loaded[se])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const ce=this.loaded[se];if(ce.showCollisionBoxes=ne.showCollisionBoxes,ce.globalState=ne.globalState,ce.status==="parsing"){const xe=yield ce.parse(ce.vectorTile,this.layerIndex,this.availableImages,this.actor,ne.subdivisionGranularity);let Ce;if(this.fetching[se]){const{rawTileData:je,cacheControl:Ye,resourceTiming:De}=this.fetching[se];delete this.fetching[se],Ce=c.e({rawTileData:je.slice(0)},xe,Ye,De)}else Ce=xe;return Ce}if(ce.status==="done"&&ce.vectorTile)return ce.parse(ce.vectorTile,this.layerIndex,this.availableImages,this.actor,ne.subdivisionGranularity)}))}abortTile(ne){return c._(this,void 0,void 0,(function*(){const se=this.loading,ce=ne.uid;se&&se[ce]&&se[ce].abort&&(se[ce].abort.abort(),delete se[ce])}))}removeTile(ne){return c._(this,void 0,void 0,(function*(){this.loaded&&this.loaded[ne.uid]&&delete this.loaded[ne.uid]}))}}class M{constructor(){this.loaded={}}loadTile(ne){return c._(this,void 0,void 0,(function*(){const{uid:se,encoding:ce,rawImageData:xe,redFactor:Ce,greenFactor:je,blueFactor:Ye,baseShift:De}=ne,nt=xe.width+2,dt=xe.height+2,lt=c.b(xe)?new c.R({width:nt,height:dt},yield c.cO(xe,-1,-1,nt,dt)):xe,Dt=new c.cP(se,lt,ce,Ce,je,Ye,De);return this.loaded=this.loaded||{},this.loaded[se]=Dt,Dt}))}removeTile(ne){const se=this.loaded,ce=ne.uid;se&&se[ce]&&delete se[ce]}}var L,G,V=(function(){if(G)return L;function Oe(se,ce){if(se.length!==0){ne(se[0],ce);for(var xe=1;xe<se.length;xe++)ne(se[xe],!ce)}}function ne(se,ce){for(var xe=0,Ce=0,je=0,Ye=se.length,De=Ye-1;je<Ye;De=je++){var nt=(se[je][0]-se[De][0])*(se[De][1]+se[je][1]),dt=xe+nt;Ce+=Math.abs(xe)>=Math.abs(nt)?xe-dt+nt:nt-dt+xe,xe=dt}xe+Ce>=0!=!!ce&&se.reverse()}return G=1,L=function se(ce,xe){var Ce,je=ce&&ce.type;if(je==="FeatureCollection")for(Ce=0;Ce<ce.features.length;Ce++)se(ce.features[Ce],xe);else if(je==="GeometryCollection")for(Ce=0;Ce<ce.geometries.length;Ce++)se(ce.geometries[Ce],xe);else if(je==="Feature")se(ce.geometry,xe);else if(je==="Polygon")Oe(ce.coordinates,xe);else if(je==="MultiPolygon")for(Ce=0;Ce<ce.coordinates.length;Ce++)Oe(ce.coordinates[Ce],xe);return ce}})(),q=c.cQ(V);class J extends c.cS{constructor(ne,se){super(new c.cM,0,se,[],[]),this.feature=ne,this.type=ne.type,this.properties=ne.tags?ne.tags:{},"id"in ne&&(typeof ne.id=="string"?this.id=parseInt(ne.id,10):typeof ne.id!="number"||isNaN(ne.id)||(this.id=ne.id))}loadGeometry(){const ne=[],se=this.feature.type===1?[this.feature.geometry]:this.feature.geometry;for(const ce of se){const xe=[];for(const Ce of ce)xe.push(new c.P(Ce[0],Ce[1]));ne.push(xe)}return ne}}class ie extends c.cR{constructor(ne,se){super(new c.cM),this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.version=se?se.version:1,this.extent=se?se.extent:4096,this.length=ne.length,this.features=ne}feature(ne){return new J(this.features[ne],this.extent)}}function ee(Oe,ne){ne.writeVarintField(15,Oe.version||1),ne.writeStringField(1,Oe.name||""),ne.writeVarintField(5,Oe.extent||4096);const se={keys:[],values:[],keycache:{},valuecache:{}};for(let Ce=0;Ce<Oe.length;Ce++)se.feature=Oe.feature(Ce),ne.writeMessage(2,me,se);const ce=se.keys;for(const Ce of ce)ne.writeStringField(3,Ce);const xe=se.values;for(const Ce of xe)ne.writeMessage(4,$e,Ce)}function me(Oe,ne){if(!Oe.feature)return;const se=Oe.feature;se.id!==void 0&&ne.writeVarintField(1,se.id),ne.writeMessage(2,Se,Oe),ne.writeVarintField(3,se.type),ne.writeMessage(4,Be,se)}function Se(Oe,ne){for(const se in Oe.feature?.properties){let ce=Oe.feature.properties[se],xe=Oe.keycache[se];if(ce===null)continue;xe===void 0&&(Oe.keys.push(se),xe=Oe.keys.length-1,Oe.keycache[se]=xe),ne.writeVarint(xe),typeof ce!="string"&&typeof ce!="boolean"&&typeof ce!="number"&&(ce=JSON.stringify(ce));const Ce=typeof ce+":"+ce;let je=Oe.valuecache[Ce];je===void 0&&(Oe.values.push(ce),je=Oe.values.length-1,Oe.valuecache[Ce]=je),ne.writeVarint(je)}}function Me(Oe,ne){return(ne<<3)+(7&Oe)}function Ve(Oe){return Oe<<1^Oe>>31}function Be(Oe,ne){const se=Oe.loadGeometry(),ce=Oe.type;let xe=0,Ce=0;for(const je of se){let Ye=1;ce===1&&(Ye=je.length),ne.writeVarint(Me(1,Ye));const De=ce===3?je.length-1:je.length;for(let nt=0;nt<De;nt++){nt===1&&ce!==1&&ne.writeVarint(Me(2,De-1));const dt=je[nt].x-xe,lt=je[nt].y-Ce;ne.writeVarint(Ve(dt)),ne.writeVarint(Ve(lt)),xe+=dt,Ce+=lt}Oe.type===3&&ne.writeVarint(Me(7,1))}}function $e(Oe,ne){const se=typeof Oe;se==="string"?ne.writeStringField(1,Oe):se==="boolean"?ne.writeBooleanField(7,Oe):se==="number"&&(Oe%1!=0?ne.writeDoubleField(3,Oe):Oe<0?ne.writeSVarintField(6,Oe):ne.writeVarintField(5,Oe))}const at={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Oe=>Oe},_t=Math.fround||(Nt=new Float32Array(1),Oe=>(Nt[0]=+Oe,Nt[0]));var Nt;class sr{constructor(ne){this.options=Object.assign(Object.create(at),ne),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(ne){const{log:se,minZoom:ce,maxZoom:xe}=this.options;se&&console.time("total time");const Ce=`prepare ${ne.length} points`;se&&console.time(Ce),this.points=ne;const je=[];for(let De=0;De<ne.length;De++){const nt=ne[De];if(!nt.geometry)continue;const[dt,lt]=nt.geometry.coordinates,Dt=_t(Lt(dt)),Ne=_t(At(lt));je.push(Dt,Ne,1/0,De,-1,1),this.options.reduce&&je.push(0)}let Ye=this.trees[xe+1]=this._createTree(je);se&&console.timeEnd(Ce);for(let De=xe;De>=ce;De--){const nt=+Date.now();Ye=this.trees[De]=this._createTree(this._cluster(Ye,De)),se&&console.log("z%d: %d clusters in %dms",De,Ye.numItems,+Date.now()-nt)}return se&&console.timeEnd("total time"),this}getClusters(ne,se){let ce=((ne[0]+180)%360+360)%360-180;const xe=Math.max(-90,Math.min(90,ne[1]));let Ce=ne[2]===180?180:((ne[2]+180)%360+360)%360-180;const je=Math.max(-90,Math.min(90,ne[3]));if(ne[2]-ne[0]>=360)ce=-180,Ce=180;else if(ce>Ce){const lt=this.getClusters([ce,xe,180,je],se),Dt=this.getClusters([-180,xe,Ce,je],se);return lt.concat(Dt)}const Ye=this.trees[this._limitZoom(se)],De=Ye.range(Lt(ce),At(je),Lt(Ce),At(xe)),nt=Ye.data,dt=[];for(const lt of De){const Dt=this.stride*lt;dt.push(nt[Dt+5]>1?Ft(nt,Dt,this.clusterProps):this.points[nt[Dt+3]])}return dt}getChildren(ne){const se=this._getOriginId(ne),ce=this._getOriginZoom(ne),xe="No cluster with the specified id.",Ce=this.trees[ce];if(!Ce)throw new Error(xe);const je=Ce.data;if(se*this.stride>=je.length)throw new Error(xe);const Ye=this.options.radius/(this.options.extent*Math.pow(2,ce-1)),De=Ce.within(je[se*this.stride],je[se*this.stride+1],Ye),nt=[];for(const dt of De){const lt=dt*this.stride;je[lt+4]===ne&&nt.push(je[lt+5]>1?Ft(je,lt,this.clusterProps):this.points[je[lt+3]])}if(nt.length===0)throw new Error(xe);return nt}getLeaves(ne,se,ce){const xe=[];return this._appendLeaves(xe,ne,se=se||10,ce=ce||0,0),xe}getTile(ne,se,ce){const xe=this.trees[this._limitZoom(ne)],Ce=Math.pow(2,ne),{extent:je,radius:Ye}=this.options,De=Ye/je,nt=(ce-De)/Ce,dt=(ce+1+De)/Ce,lt={features:[]};return this._addTileFeatures(xe.range((se-De)/Ce,nt,(se+1+De)/Ce,dt),xe.data,se,ce,Ce,lt),se===0&&this._addTileFeatures(xe.range(1-De/Ce,nt,1,dt),xe.data,Ce,ce,Ce,lt),se===Ce-1&&this._addTileFeatures(xe.range(0,nt,De/Ce,dt),xe.data,-1,ce,Ce,lt),lt.features.length?lt:null}getClusterExpansionZoom(ne){let se=this._getOriginZoom(ne)-1;for(;se<=this.options.maxZoom;){const ce=this.getChildren(ne);if(se++,ce.length!==1)break;ne=ce[0].properties.cluster_id}return se}_appendLeaves(ne,se,ce,xe,Ce){const je=this.getChildren(se);for(const Ye of je){const De=Ye.properties;if(De&&De.cluster?Ce+De.point_count<=xe?Ce+=De.point_count:Ce=this._appendLeaves(ne,De.cluster_id,ce,xe,Ce):Ce<xe?Ce++:ne.push(Ye),ne.length===ce)break}return Ce}_createTree(ne){const se=new c.aI(ne.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ce=0;ce<ne.length;ce+=this.stride)se.add(ne[ce],ne[ce+1]);return se.finish(),se.data=ne,se}_addTileFeatures(ne,se,ce,xe,Ce,je){for(const Ye of ne){const De=Ye*this.stride,nt=se[De+5]>1;let dt,lt,Dt;if(nt)dt=Ut(se,De,this.clusterProps),lt=se[De],Dt=se[De+1];else{const Rr=this.points[se[De+3]];dt=Rr.properties;const[Wt,vr]=Rr.geometry.coordinates;lt=Lt(Wt),Dt=At(vr)}const Ne={type:1,geometry:[[Math.round(this.options.extent*(lt*Ce-ce)),Math.round(this.options.extent*(Dt*Ce-xe))]],tags:dt};let ar;ar=nt||this.options.generateId?se[De+3]:this.points[se[De+3]].id,ar!==void 0&&(Ne.id=ar),je.features.push(Ne)}}_limitZoom(ne){return Math.max(this.options.minZoom,Math.min(Math.floor(+ne),this.options.maxZoom+1))}_cluster(ne,se){const{radius:ce,extent:xe,reduce:Ce,minPoints:je}=this.options,Ye=ce/(xe*Math.pow(2,se)),De=ne.data,nt=[],dt=this.stride;for(let lt=0;lt<De.length;lt+=dt){if(De[lt+2]<=se)continue;De[lt+2]=se;const Dt=De[lt],Ne=De[lt+1],ar=ne.within(De[lt],De[lt+1],Ye),Rr=De[lt+5];let Wt=Rr;for(const vr of ar){const Xr=vr*dt;De[Xr+2]>se&&(Wt+=De[Xr+5])}if(Wt>Rr&&Wt>=je){let vr,Xr=Dt*Rr,Ii=Ne*Rr,ji=-1;const fi=(lt/dt<<5)+(se+1)+this.points.length;for(const Tr of ar){const kr=Tr*dt;if(De[kr+2]<=se)continue;De[kr+2]=se;const Ui=De[kr+5];Xr+=De[kr]*Ui,Ii+=De[kr+1]*Ui,De[kr+4]=fi,Ce&&(vr||(vr=this._map(De,lt,!0),ji=this.clusterProps.length,this.clusterProps.push(vr)),Ce(vr,this._map(De,kr)))}De[lt+4]=fi,nt.push(Xr/Wt,Ii/Wt,1/0,fi,-1,Wt),Ce&&nt.push(ji)}else{for(let vr=0;vr<dt;vr++)nt.push(De[lt+vr]);if(Wt>1)for(const vr of ar){const Xr=vr*dt;if(!(De[Xr+2]<=se)){De[Xr+2]=se;for(let Ii=0;Ii<dt;Ii++)nt.push(De[Xr+Ii])}}}}return nt}_getOriginId(ne){return ne-this.points.length>>5}_getOriginZoom(ne){return(ne-this.points.length)%32}_map(ne,se,ce){if(ne[se+5]>1){const je=this.clusterProps[ne[se+6]];return ce?Object.assign({},je):je}const xe=this.points[ne[se+3]].properties,Ce=this.options.map(xe);return ce&&Ce===xe?Object.assign({},Ce):Ce}}function Ft(Oe,ne,se){return{type:"Feature",id:Oe[ne+3],properties:Ut(Oe,ne,se),geometry:{type:"Point",coordinates:[(ce=Oe[ne],360*(ce-.5)),Ke(Oe[ne+1])]}};var ce}function Ut(Oe,ne,se){const ce=Oe[ne+5],xe=ce>=1e4?`${Math.round(ce/1e3)}k`:ce>=1e3?Math.round(ce/100)/10+"k":ce,Ce=Oe[ne+6],je=Ce===-1?{}:Object.assign({},se[Ce]);return Object.assign(je,{cluster:!0,cluster_id:Oe[ne+3],point_count:ce,point_count_abbreviated:xe})}function Lt(Oe){return Oe/360+.5}function At(Oe){const ne=Math.sin(Oe*Math.PI/180),se=.5-.25*Math.log((1+ne)/(1-ne))/Math.PI;return se<0?0:se>1?1:se}function Ke(Oe){const ne=(180-360*Oe)*Math.PI/180;return 360*Math.atan(Math.exp(ne))/Math.PI-90}function ft(Oe,ne,se,ce){let xe=ce;const Ce=ne+(se-ne>>1);let je,Ye=se-ne;const De=Oe[ne],nt=Oe[ne+1],dt=Oe[se],lt=Oe[se+1];for(let Dt=ne+3;Dt<se;Dt+=3){const Ne=Tt(Oe[Dt],Oe[Dt+1],De,nt,dt,lt);if(Ne>xe)je=Dt,xe=Ne;else if(Ne===xe){const ar=Math.abs(Dt-Ce);ar<Ye&&(je=Dt,Ye=ar)}}xe>ce&&(je-ne>3&&ft(Oe,ne,je,ce),Oe[je+2]=xe,se-je>3&&ft(Oe,je,se,ce))}function Tt(Oe,ne,se,ce,xe,Ce){let je=xe-se,Ye=Ce-ce;if(je!==0||Ye!==0){const De=((Oe-se)*je+(ne-ce)*Ye)/(je*je+Ye*Ye);De>1?(se=xe,ce=Ce):De>0&&(se+=je*De,ce+=Ye*De)}return je=Oe-se,Ye=ne-ce,je*je+Ye*Ye}function ze(Oe,ne,se,ce){const xe={id:Oe??null,type:ne,geometry:se,tags:ce,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(ne==="Point"||ne==="MultiPoint"||ne==="LineString")ht(xe,se);else if(ne==="Polygon")ht(xe,se[0]);else if(ne==="MultiLineString")for(const Ce of se)ht(xe,Ce);else if(ne==="MultiPolygon")for(const Ce of se)ht(xe,Ce[0]);return xe}function ht(Oe,ne){for(let se=0;se<ne.length;se+=3)Oe.minX=Math.min(Oe.minX,ne[se]),Oe.minY=Math.min(Oe.minY,ne[se+1]),Oe.maxX=Math.max(Oe.maxX,ne[se]),Oe.maxY=Math.max(Oe.maxY,ne[se+1])}function Ht(Oe,ne,se,ce){if(!ne.geometry)return;const xe=ne.geometry.coordinates;if(xe&&xe.length===0)return;const Ce=ne.geometry.type,je=Math.pow(se.tolerance/((1<<se.maxZoom)*se.extent),2);let Ye=[],De=ne.id;if(se.promoteId?De=ne.properties[se.promoteId]:se.generateId&&(De=ce||0),Ce==="Point")Jt(xe,Ye);else if(Ce==="MultiPoint")for(const nt of xe)Jt(nt,Ye);else if(Ce==="LineString")Pr(xe,Ye,je,!1);else if(Ce==="MultiLineString"){if(se.lineMetrics){for(const nt of xe)Ye=[],Pr(nt,Ye,je,!1),Oe.push(ze(De,"LineString",Ye,ne.properties));return}yr(xe,Ye,je,!1)}else if(Ce==="Polygon")yr(xe,Ye,je,!0);else{if(Ce!=="MultiPolygon"){if(Ce==="GeometryCollection"){for(const nt of ne.geometry.geometries)Ht(Oe,{id:De,geometry:nt,properties:ne.properties},se,ce);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const nt of xe){const dt=[];yr(nt,dt,je,!0),Ye.push(dt)}}Oe.push(ze(De,Ce,Ye,ne.properties))}function Jt(Oe,ne){ne.push($t(Oe[0]),pr(Oe[1]),0)}function Pr(Oe,ne,se,ce){let xe,Ce,je=0;for(let De=0;De<Oe.length;De++){const nt=$t(Oe[De][0]),dt=pr(Oe[De][1]);ne.push(nt,dt,0),De>0&&(je+=ce?(xe*dt-nt*Ce)/2:Math.sqrt(Math.pow(nt-xe,2)+Math.pow(dt-Ce,2))),xe=nt,Ce=dt}const Ye=ne.length-3;ne[2]=1,ft(ne,0,Ye,se),ne[Ye+2]=1,ne.size=Math.abs(je),ne.start=0,ne.end=ne.size}function yr(Oe,ne,se,ce){for(let xe=0;xe<Oe.length;xe++){const Ce=[];Pr(Oe[xe],Ce,se,ce),ne.push(Ce)}}function $t(Oe){return Oe/360+.5}function pr(Oe){const ne=Math.sin(Oe*Math.PI/180),se=.5-.25*Math.log((1+ne)/(1-ne))/Math.PI;return se<0?0:se>1?1:se}function Qt(Oe,ne,se,ce,xe,Ce,je,Ye){if(ce/=ne,Ce>=(se/=ne)&&je<ce)return Oe;if(je<se||Ce>=ce)return null;const De=[];for(const nt of Oe){const dt=nt.geometry;let lt=nt.type;const Dt=xe===0?nt.minX:nt.minY,Ne=xe===0?nt.maxX:nt.maxY;if(Dt>=se&&Ne<ce){De.push(nt);continue}if(Ne<se||Dt>=ce)continue;let ar=[];if(lt==="Point"||lt==="MultiPoint")Nr(dt,ar,se,ce,xe);else if(lt==="LineString")An(dt,ar,se,ce,xe,!1,Ye.lineMetrics);else if(lt==="MultiLineString")Zr(dt,ar,se,ce,xe,!1);else if(lt==="Polygon")Zr(dt,ar,se,ce,xe,!0);else if(lt==="MultiPolygon")for(const Rr of dt){const Wt=[];Zr(Rr,Wt,se,ce,xe,!0),Wt.length&&ar.push(Wt)}if(ar.length){if(Ye.lineMetrics&&lt==="LineString"){for(const Rr of ar)De.push(ze(nt.id,lt,Rr,nt.tags));continue}lt!=="LineString"&&lt!=="MultiLineString"||(ar.length===1?(lt="LineString",ar=ar[0]):lt="MultiLineString"),lt!=="Point"&&lt!=="MultiPoint"||(lt=ar.length===3?"Point":"MultiPoint"),De.push(ze(nt.id,lt,ar,nt.tags))}}return De.length?De:null}function Nr(Oe,ne,se,ce,xe){for(let Ce=0;Ce<Oe.length;Ce+=3){const je=Oe[Ce+xe];je>=se&&je<=ce&&si(ne,Oe[Ce],Oe[Ce+1],Oe[Ce+2])}}function An(Oe,ne,se,ce,xe,Ce,je){let Ye=wi(Oe);const De=xe===0?Tn:zi;let nt,dt,lt=Oe.start;for(let Wt=0;Wt<Oe.length-3;Wt+=3){const vr=Oe[Wt],Xr=Oe[Wt+1],Ii=Oe[Wt+2],ji=Oe[Wt+3],fi=Oe[Wt+4],Tr=xe===0?vr:Xr,kr=xe===0?ji:fi;let Ui=!1;je&&(nt=Math.sqrt(Math.pow(vr-ji,2)+Math.pow(Xr-fi,2))),Tr<se?kr>se&&(dt=De(Ye,vr,Xr,ji,fi,se),je&&(Ye.start=lt+nt*dt)):Tr>ce?kr<ce&&(dt=De(Ye,vr,Xr,ji,fi,ce),je&&(Ye.start=lt+nt*dt)):si(Ye,vr,Xr,Ii),kr<se&&Tr>=se&&(dt=De(Ye,vr,Xr,ji,fi,se),Ui=!0),kr>ce&&Tr<=ce&&(dt=De(Ye,vr,Xr,ji,fi,ce),Ui=!0),!Ce&&Ui&&(je&&(Ye.end=lt+nt*dt),ne.push(Ye),Ye=wi(Oe)),je&&(lt+=nt)}let Dt=Oe.length-3;const Ne=Oe[Dt],ar=Oe[Dt+1],Rr=xe===0?Ne:ar;Rr>=se&&Rr<=ce&&si(Ye,Ne,ar,Oe[Dt+2]),Dt=Ye.length-3,Ce&&Dt>=3&&(Ye[Dt]!==Ye[0]||Ye[Dt+1]!==Ye[1])&&si(Ye,Ye[0],Ye[1],Ye[2]),Ye.length&&ne.push(Ye)}function wi(Oe){const ne=[];return ne.size=Oe.size,ne.start=Oe.start,ne.end=Oe.end,ne}function Zr(Oe,ne,se,ce,xe,Ce){for(const je of Oe)An(je,ne,se,ce,xe,Ce,!1)}function si(Oe,ne,se,ce){Oe.push(ne,se,ce)}function Tn(Oe,ne,se,ce,xe,Ce){const je=(Ce-ne)/(ce-ne);return si(Oe,Ce,se+(xe-se)*je,1),je}function zi(Oe,ne,se,ce,xe,Ce){const je=(Ce-se)/(xe-se);return si(Oe,ne+(ce-ne)*je,Ce,1),je}function Ln(Oe,ne){const se=[];for(let ce=0;ce<Oe.length;ce++){const xe=Oe[ce],Ce=xe.type;let je;if(Ce==="Point"||Ce==="MultiPoint"||Ce==="LineString")je=Ps(xe.geometry,ne);else if(Ce==="MultiLineString"||Ce==="Polygon"){je=[];for(const Ye of xe.geometry)je.push(Ps(Ye,ne))}else if(Ce==="MultiPolygon"){je=[];for(const Ye of xe.geometry){const De=[];for(const nt of Ye)De.push(Ps(nt,ne));je.push(De)}}se.push(ze(xe.id,Ce,je,xe.tags))}return se}function Ps(Oe,ne){const se=[];se.size=Oe.size,Oe.start!==void 0&&(se.start=Oe.start,se.end=Oe.end);for(let ce=0;ce<Oe.length;ce+=3)se.push(Oe[ce]+ne,Oe[ce+1],Oe[ce+2]);return se}function ns(Oe,ne){if(Oe.transformed)return Oe;const se=1<<Oe.z,ce=Oe.x,xe=Oe.y;for(const Ce of Oe.features){const je=Ce.geometry,Ye=Ce.type;if(Ce.geometry=[],Ye===1)for(let De=0;De<je.length;De+=2)Ce.geometry.push(ss(je[De],je[De+1],ne,se,ce,xe));else for(let De=0;De<je.length;De++){const nt=[];for(let dt=0;dt<je[De].length;dt+=2)nt.push(ss(je[De][dt],je[De][dt+1],ne,se,ce,xe));Ce.geometry.push(nt)}}return Oe.transformed=!0,Oe}function ss(Oe,ne,se,ce,xe,Ce){return[Math.round(se*(Oe*ce-xe)),Math.round(se*(ne*ce-Ce))]}function vi(Oe,ne,se,ce,xe){const Ce=ne===xe.maxZoom?0:xe.tolerance/((1<<ne)*xe.extent),je={features:[],numPoints:0,numSimplified:0,numFeatures:Oe.length,source:null,x:se,y:ce,z:ne,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Ye of Oe)lo(je,Ye,Ce,xe);return je}function lo(Oe,ne,se,ce){const xe=ne.geometry,Ce=ne.type,je=[];if(Oe.minX=Math.min(Oe.minX,ne.minX),Oe.minY=Math.min(Oe.minY,ne.minY),Oe.maxX=Math.max(Oe.maxX,ne.maxX),Oe.maxY=Math.max(Oe.maxY,ne.maxY),Ce==="Point"||Ce==="MultiPoint")for(let Ye=0;Ye<xe.length;Ye+=3)je.push(xe[Ye],xe[Ye+1]),Oe.numPoints++,Oe.numSimplified++;else if(Ce==="LineString")Po(je,xe,Oe,se,!1,!1);else if(Ce==="MultiLineString"||Ce==="Polygon")for(let Ye=0;Ye<xe.length;Ye++)Po(je,xe[Ye],Oe,se,Ce==="Polygon",Ye===0);else if(Ce==="MultiPolygon")for(let Ye=0;Ye<xe.length;Ye++){const De=xe[Ye];for(let nt=0;nt<De.length;nt++)Po(je,De[nt],Oe,se,!0,nt===0)}if(je.length){let Ye=ne.tags||null;if(Ce==="LineString"&&ce.lineMetrics){Ye={};for(const nt in ne.tags)Ye[nt]=ne.tags[nt];Ye.mapbox_clip_start=xe.start/xe.size,Ye.mapbox_clip_end=xe.end/xe.size}const De={geometry:je,type:Ce==="Polygon"||Ce==="MultiPolygon"?3:Ce==="LineString"||Ce==="MultiLineString"?2:1,tags:Ye};ne.id!==null&&(De.id=ne.id),Oe.features.push(De)}}function Po(Oe,ne,se,ce,xe,Ce){const je=ce*ce;if(ce>0&&ne.size<(xe?je:ce))return void(se.numPoints+=ne.length/3);const Ye=[];for(let De=0;De<ne.length;De+=3)(ce===0||ne[De+2]>je)&&(se.numSimplified++,Ye.push(ne[De],ne[De+1])),se.numPoints++;xe&&(function(De,nt){let dt=0;for(let lt=0,Dt=De.length,Ne=Dt-2;lt<Dt;Ne=lt,lt+=2)dt+=(De[lt]-De[Ne])*(De[lt+1]+De[Ne+1]);if(dt>0===nt)for(let lt=0,Dt=De.length;lt<Dt/2;lt+=2){const Ne=De[lt],ar=De[lt+1];De[lt]=De[Dt-2-lt],De[lt+1]=De[Dt-1-lt],De[Dt-2-lt]=Ne,De[Dt-1-lt]=ar}})(Ye,Ce),Oe.push(Ye)}const ea={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Ro{constructor(ne,se){const ce=(se=this.options=(function(Ce,je){for(const Ye in je)Ce[Ye]=je[Ye];return Ce})(Object.create(ea),se)).debug;if(ce&&console.time("preprocess data"),se.maxZoom<0||se.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(se.promoteId&&se.generateId)throw new Error("promoteId and generateId cannot be used together.");let xe=(function(Ce,je){const Ye=[];if(Ce.type==="FeatureCollection")for(let De=0;De<Ce.features.length;De++)Ht(Ye,Ce.features[De],je,De);else Ht(Ye,Ce.type==="Feature"?Ce:{geometry:Ce},je);return Ye})(ne,se);this.tiles={},this.tileCoords=[],ce&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",se.indexMaxZoom,se.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),xe=(function(Ce,je){const Ye=je.buffer/je.extent;let De=Ce;const nt=Qt(Ce,1,-1-Ye,Ye,0,-1,2,je),dt=Qt(Ce,1,1-Ye,2+Ye,0,-1,2,je);return(nt||dt)&&(De=Qt(Ce,1,-Ye,1+Ye,0,-1,2,je)||[],nt&&(De=Ln(nt,1).concat(De)),dt&&(De=De.concat(Ln(dt,-1)))),De})(xe,se),xe.length&&this.splitTile(xe,0,0,0),ce&&(xe.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(ne,se,ce,xe,Ce,je,Ye){const De=[ne,se,ce,xe],nt=this.options,dt=nt.debug;for(;De.length;){xe=De.pop(),ce=De.pop(),se=De.pop(),ne=De.pop();const lt=1<<se,Dt=Mo(se,ce,xe);let Ne=this.tiles[Dt];if(!Ne&&(dt>1&&console.time("creation"),Ne=this.tiles[Dt]=vi(ne,se,ce,xe,nt),this.tileCoords.push({z:se,x:ce,y:xe}),dt)){dt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",se,ce,xe,Ne.numFeatures,Ne.numPoints,Ne.numSimplified),console.timeEnd("creation"));const Ui=`z${se}`;this.stats[Ui]=(this.stats[Ui]||0)+1,this.total++}if(Ne.source=ne,Ce==null){if(se===nt.indexMaxZoom||Ne.numPoints<=nt.indexMaxPoints)continue}else{if(se===nt.maxZoom||se===Ce)continue;if(Ce!=null){const Ui=Ce-se;if(ce!==je>>Ui||xe!==Ye>>Ui)continue}}if(Ne.source=null,ne.length===0)continue;dt>1&&console.time("clipping");const ar=.5*nt.buffer/nt.extent,Rr=.5-ar,Wt=.5+ar,vr=1+ar;let Xr=null,Ii=null,ji=null,fi=null,Tr=Qt(ne,lt,ce-ar,ce+Wt,0,Ne.minX,Ne.maxX,nt),kr=Qt(ne,lt,ce+Rr,ce+vr,0,Ne.minX,Ne.maxX,nt);ne=null,Tr&&(Xr=Qt(Tr,lt,xe-ar,xe+Wt,1,Ne.minY,Ne.maxY,nt),Ii=Qt(Tr,lt,xe+Rr,xe+vr,1,Ne.minY,Ne.maxY,nt),Tr=null),kr&&(ji=Qt(kr,lt,xe-ar,xe+Wt,1,Ne.minY,Ne.maxY,nt),fi=Qt(kr,lt,xe+Rr,xe+vr,1,Ne.minY,Ne.maxY,nt),kr=null),dt>1&&console.timeEnd("clipping"),De.push(Xr||[],se+1,2*ce,2*xe),De.push(Ii||[],se+1,2*ce,2*xe+1),De.push(ji||[],se+1,2*ce+1,2*xe),De.push(fi||[],se+1,2*ce+1,2*xe+1)}}getTile(ne,se,ce){ne=+ne,se=+se,ce=+ce;const xe=this.options,{extent:Ce,debug:je}=xe;if(ne<0||ne>24)return null;const Ye=1<<ne,De=Mo(ne,se=se+Ye&Ye-1,ce);if(this.tiles[De])return ns(this.tiles[De],Ce);je>1&&console.log("drilling down to z%d-%d-%d",ne,se,ce);let nt,dt=ne,lt=se,Dt=ce;for(;!nt&&dt>0;)dt--,lt>>=1,Dt>>=1,nt=this.tiles[Mo(dt,lt,Dt)];return nt&&nt.source?(je>1&&(console.log("found parent tile z%d-%d-%d",dt,lt,Dt),console.time("drilling down")),this.splitTile(nt.source,dt,lt,Dt,ne,se,ce),je>1&&console.timeEnd("drilling down"),this.tiles[De]?ns(this.tiles[De],Ce):null):null}}function Mo(Oe,ne,se){return 32*((1<<Oe)*se+ne)+Oe}class Gs extends R{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(ne,se){return c._(this,void 0,void 0,(function*(){const ce=ne.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const xe=this._geoJSONIndex.getTile(ce.z,ce.x,ce.y);if(!xe)return null;const Ce=new ie(xe.features,{version:2,extent:c.$});let je=(function(Ye){const De=new c.cM;return(function(nt,dt){for(const lt in nt.layers)dt.writeMessage(3,ee,nt.layers[lt])})(Ye,De),De.finish()})(Ce);return je.byteOffset===0&&je.byteLength===je.buffer.byteLength||(je=new Uint8Array(je)),{vectorTile:Ce,rawData:je.buffer}}))}loadData(ne){return c._(this,void 0,void 0,(function*(){var se;(se=this._pendingRequest)===null||se===void 0||se.abort();const ce=!!(ne&&ne.request&&ne.request.collectResourceTiming)&&new c.cN(ne.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(ne,this._pendingRequest);const xe=yield this._pendingData;this._geoJSONIndex=ne.cluster?new sr((function({superclusterOptions:je,clusterProperties:Ye}){if(!Ye||!je)return je;const De={},nt={},dt={accumulated:null,zoom:0},lt={properties:null},Dt=Object.keys(Ye);for(const Ne of Dt){const[ar,Rr]=Ye[Ne],Wt=c.cT(Rr),vr=c.cT(typeof ar=="string"?[ar,["accumulated"],["get",Ne]]:ar);De[Ne]=Wt.value,nt[Ne]=vr.value}return je.map=Ne=>{lt.properties=Ne;const ar={};for(const Rr of Dt)ar[Rr]=De[Rr].evaluate(dt,lt);return ar},je.reduce=(Ne,ar)=>{lt.properties=ar;for(const Rr of Dt)dt.accumulated=Ne[Rr],Ne[Rr]=nt[Rr].evaluate(dt,lt)},je})(ne)).load(xe.features):(function(je,Ye){return new Ro(je,Ye)})(xe,ne.geojsonVtOptions),this.loaded={};const Ce={data:xe};if(ce){const je=ce.finish();je&&(Ce.resourceTiming={},Ce.resourceTiming[ne.source]=JSON.parse(JSON.stringify(je)))}return Ce}catch(xe){if(delete this._pendingRequest,c.cy(xe))return{abandoned:!0};throw xe}}))}getData(){return c._(this,void 0,void 0,(function*(){return this._pendingData}))}reloadTile(ne){const se=this.loaded;return se&&se[ne.uid]?super.reloadTile(ne):this.loadTile(ne)}loadAndProcessGeoJSON(ne,se){return c._(this,void 0,void 0,(function*(){let ce=yield this.loadGeoJSON(ne,se);if(delete this._pendingRequest,typeof ce!="object")throw new Error(`Input data given to '${ne.source}' is not a valid GeoJSON object.`);if(q(ce,!0),ne.filter){const xe=c.cT(ne.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(xe.result==="error")throw new Error(xe.value.map((Ce=>`${Ce.key}: ${Ce.message}`)).join(", "));ce={type:"FeatureCollection",features:ce.features.filter((Ce=>xe.value.evaluate({zoom:0},Ce)))}}return ce}))}loadGeoJSON(ne,se){return c._(this,void 0,void 0,(function*(){const{promoteId:ce}=ne;if(ne.request){const xe=yield c.j(ne.request,se);return this._dataUpdateable=c.cV(xe.data,ce)?c.cU(xe.data,ce):void 0,xe.data}if(typeof ne.data=="string")try{const xe=JSON.parse(ne.data);return this._dataUpdateable=c.cV(xe,ce)?c.cU(xe,ce):void 0,xe}catch{throw new Error(`Input data given to '${ne.source}' is not a valid GeoJSON object.`)}if(!ne.dataDiff)throw new Error(`Input data given to '${ne.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${ne.source}`);return c.cW(this._dataUpdateable,ne.dataDiff,ce),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}}))}removeSource(ne){return c._(this,void 0,void 0,(function*(){this._pendingRequest&&this._pendingRequest.abort()}))}getClusterExpansionZoom(ne){return this._geoJSONIndex.getClusterExpansionZoom(ne.clusterId)}getClusterChildren(ne){return this._geoJSONIndex.getChildren(ne.clusterId)}getClusterLeaves(ne){return this._geoJSONIndex.getLeaves(ne.clusterId,ne.limit,ne.offset)}}class co{constructor(ne){this.self=ne,this.actor=new c.J(ne),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(se,ce)=>{if(this.externalWorkerSourceTypes[se])throw new Error(`Worker source with name "${se}" already registered.`);this.externalWorkerSourceTypes[se]=ce},this.self.addProtocol=c.cA,this.self.removeProtocol=c.cB,this.self.registerRTLTextPlugin=se=>{c.cX.setMethods(se)},this.actor.registerMessageHandler("LDT",((se,ce)=>this._getDEMWorkerSource(se,ce.source).loadTile(ce))),this.actor.registerMessageHandler("RDT",((se,ce)=>c._(this,void 0,void 0,(function*(){this._getDEMWorkerSource(se,ce.source).removeTile(ce)})))),this.actor.registerMessageHandler("GCEZ",((se,ce)=>c._(this,void 0,void 0,(function*(){return this._getWorkerSource(se,ce.type,ce.source).getClusterExpansionZoom(ce)})))),this.actor.registerMessageHandler("GCC",((se,ce)=>c._(this,void 0,void 0,(function*(){return this._getWorkerSource(se,ce.type,ce.source).getClusterChildren(ce)})))),this.actor.registerMessageHandler("GCL",((se,ce)=>c._(this,void 0,void 0,(function*(){return this._getWorkerSource(se,ce.type,ce.source).getClusterLeaves(ce)})))),this.actor.registerMessageHandler("LD",((se,ce)=>this._getWorkerSource(se,ce.type,ce.source).loadData(ce))),this.actor.registerMessageHandler("GD",((se,ce)=>this._getWorkerSource(se,ce.type,ce.source).getData())),this.actor.registerMessageHandler("LT",((se,ce)=>this._getWorkerSource(se,ce.type,ce.source).loadTile(ce))),this.actor.registerMessageHandler("RT",((se,ce)=>this._getWorkerSource(se,ce.type,ce.source).reloadTile(ce))),this.actor.registerMessageHandler("AT",((se,ce)=>this._getWorkerSource(se,ce.type,ce.source).abortTile(ce))),this.actor.registerMessageHandler("RMT",((se,ce)=>this._getWorkerSource(se,ce.type,ce.source).removeTile(ce))),this.actor.registerMessageHandler("RS",((se,ce)=>c._(this,void 0,void 0,(function*(){if(!this.workerSources[se]||!this.workerSources[se][ce.type]||!this.workerSources[se][ce.type][ce.source])return;const xe=this.workerSources[se][ce.type][ce.source];delete this.workerSources[se][ce.type][ce.source],xe.removeSource!==void 0&&xe.removeSource(ce)})))),this.actor.registerMessageHandler("RM",(se=>c._(this,void 0,void 0,(function*(){delete this.layerIndexes[se],delete this.availableImages[se],delete this.workerSources[se],delete this.demWorkerSources[se]})))),this.actor.registerMessageHandler("SR",((se,ce)=>c._(this,void 0,void 0,(function*(){this.referrer=ce})))),this.actor.registerMessageHandler("SRPS",((se,ce)=>this._syncRTLPluginState(se,ce))),this.actor.registerMessageHandler("IS",((se,ce)=>c._(this,void 0,void 0,(function*(){this.self.importScripts(ce)})))),this.actor.registerMessageHandler("SI",((se,ce)=>this._setImages(se,ce))),this.actor.registerMessageHandler("UL",((se,ce)=>c._(this,void 0,void 0,(function*(){this._getLayerIndex(se).update(ce.layers,ce.removedIds)})))),this.actor.registerMessageHandler("SL",((se,ce)=>c._(this,void 0,void 0,(function*(){this._getLayerIndex(se).replace(ce)}))))}_setImages(ne,se){return c._(this,void 0,void 0,(function*(){this.availableImages[ne]=se;for(const ce in this.workerSources[ne]){const xe=this.workerSources[ne][ce];for(const Ce in xe)xe[Ce].availableImages=se}}))}_syncRTLPluginState(ne,se){return c._(this,void 0,void 0,(function*(){return yield c.cX.syncState(se,this.self.importScripts)}))}_getAvailableImages(ne){let se=this.availableImages[ne];return se||(se=[]),se}_getLayerIndex(ne){let se=this.layerIndexes[ne];return se||(se=this.layerIndexes[ne]=new o),se}_getWorkerSource(ne,se,ce){if(this.workerSources[ne]||(this.workerSources[ne]={}),this.workerSources[ne][se]||(this.workerSources[ne][se]={}),!this.workerSources[ne][se][ce]){const xe={sendAsync:(Ce,je)=>(Ce.targetMapId=ne,this.actor.sendAsync(Ce,je))};switch(se){case"vector":this.workerSources[ne][se][ce]=new R(xe,this._getLayerIndex(ne),this._getAvailableImages(ne));break;case"geojson":this.workerSources[ne][se][ce]=new Gs(xe,this._getLayerIndex(ne),this._getAvailableImages(ne));break;default:this.workerSources[ne][se][ce]=new this.externalWorkerSourceTypes[se](xe,this._getLayerIndex(ne),this._getAvailableImages(ne))}}return this.workerSources[ne][se][ce]}_getDEMWorkerSource(ne,se){return this.demWorkerSources[ne]||(this.demWorkerSources[ne]={}),this.demWorkerSources[ne][se]||(this.demWorkerSources[ne][se]=new M),this.demWorkerSources[ne][se]}}return c.i(self)&&(self.worker=new co(self)),co})),n("index",["exports","./shared"],(function(c,o){var m="5.6.2";function b(){var x=new o.A(4);return o.A!=Float32Array&&(x[1]=0,x[2]=0),x[0]=1,x[3]=1,x}let A,R;const M={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(x,s,d){const g=requestAnimationFrame((w=>{v(),s(w)})),{unsubscribe:v}=o.s(x.signal,"abort",(()=>{v(),cancelAnimationFrame(g),d(o.c())}),!1)},frameAsync(x){return new Promise(((s,d)=>{this.frame(x,s,d)}))},getImageData(x,s=0){return this.getImageCanvasContext(x).getImageData(-s,-s,x.width+2*s,x.height+2*s)},getImageCanvasContext(x){const s=window.document.createElement("canvas"),d=s.getContext("2d",{willReadFrequently:!0});if(!d)throw new Error("failed to create canvas 2d context");return s.width=x.width,s.height=x.height,d.drawImage(x,0,0,x.width,x.height),d},resolveURL:x=>(A||(A=document.createElement("a")),A.href=x,A.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(R==null&&(R=matchMedia("(prefers-reduced-motion: reduce)")),R.matches)}};class L{static testProp(s){if(!L.docStyle)return s[0];for(let d=0;d<s.length;d++)if(s[d]in L.docStyle)return s[d];return s[0]}static create(s,d,g){const v=window.document.createElement(s);return d!==void 0&&(v.className=d),g&&g.appendChild(v),v}static createNS(s,d){return window.document.createElementNS(s,d)}static disableDrag(){L.docStyle&&L.selectProp&&(L.userSelect=L.docStyle[L.selectProp],L.docStyle[L.selectProp]="none")}static enableDrag(){L.docStyle&&L.selectProp&&(L.docStyle[L.selectProp]=L.userSelect)}static setTransform(s,d){s.style[L.transformProp]=d}static addEventListener(s,d,g,v={}){s.addEventListener(d,g,"passive"in v?v:v.capture)}static removeEventListener(s,d,g,v={}){s.removeEventListener(d,g,"passive"in v?v:v.capture)}static suppressClickInternal(s){s.preventDefault(),s.stopPropagation(),window.removeEventListener("click",L.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",L.suppressClickInternal,!0),window.setTimeout((()=>{window.removeEventListener("click",L.suppressClickInternal,!0)}),0)}static getScale(s){const d=s.getBoundingClientRect();return{x:d.width/s.offsetWidth||1,y:d.height/s.offsetHeight||1,boundingClientRect:d}}static getPoint(s,d,g){const v=d.boundingClientRect;return new o.P((g.clientX-v.left)/d.x-s.clientLeft,(g.clientY-v.top)/d.y-s.clientTop)}static mousePos(s,d){const g=L.getScale(s);return L.getPoint(s,g,d)}static touchPos(s,d){const g=[],v=L.getScale(s);for(let w=0;w<d.length;w++)g.push(L.getPoint(s,v,d[w]));return g}static mouseButton(s){return s.button}static remove(s){s.parentNode&&s.parentNode.removeChild(s)}static sanitize(s){const d=new DOMParser().parseFromString(s,"text/html").body||document.createElement("body"),g=d.querySelectorAll("script");for(const v of g)v.remove();return L.clean(d),d.innerHTML}static isPossiblyDangerous(s,d){const g=d.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(s)||!g.includes("javascript:")&&!g.includes("data:"))||!!s.startsWith("on")||void 0}static clean(s){const d=s.children;for(const g of d)L.removeAttributes(g),L.clean(g)}static removeAttributes(s){for(const{name:d,value:g}of s.attributes)L.isPossiblyDangerous(d,g)&&s.removeAttribute(d)}}L.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,L.selectProp=L.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),L.transformProp=L.testProp(["transform","WebkitTransform"]);const G={supported:!1,testSupport:function(x){!J&&q&&(ie?ee(x):V=x)}};let V,q,J=!1,ie=!1;function ee(x){const s=x.createTexture();x.bindTexture(x.TEXTURE_2D,s);try{if(x.texImage2D(x.TEXTURE_2D,0,x.RGBA,x.RGBA,x.UNSIGNED_BYTE,q),x.isContextLost())return;G.supported=!0}catch{}x.deleteTexture(s),J=!0}var me;typeof document<"u"&&(q=document.createElement("img"),q.onload=()=>{V&&ee(V),V=null,ie=!0},q.onerror=()=>{J=!0,V=null},q.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),(function(x){let s,d,g,v;x.resetRequestQueue=()=>{s=[],d=0,g=0,v={}},x.addThrottleControl=O=>{const F=g++;return v[F]=O,F},x.removeThrottleControl=O=>{delete v[O],C()},x.getImage=(O,F,U=!0)=>new Promise(((K,W)=>{G.supported&&(O.headers||(O.headers={}),O.headers.accept="image/webp,*/*"),o.e(O,{type:"image"}),s.push({abortController:F,requestParameters:O,supportImageRefresh:U,state:"queued",onError:X=>{W(X)},onSuccess:X=>{K(X)}}),C()}));const w=O=>o._(this,void 0,void 0,(function*(){O.state="running";const{requestParameters:F,supportImageRefresh:U,onError:K,onSuccess:W,abortController:X}=O,re=U===!1&&!o.i(self)&&!o.g(F.url)&&(!F.headers||Object.keys(F.headers).reduce(((pe,_e)=>pe&&_e==="accept"),!0));d++;const ue=re?B(F,X):o.m(F,X);try{const pe=yield ue;delete O.abortController,O.state="completed",pe.data instanceof HTMLImageElement||o.b(pe.data)?W(pe):pe.data&&W({data:yield(fe=pe.data,typeof createImageBitmap=="function"?o.f(fe):o.h(fe)),cacheControl:pe.cacheControl,expires:pe.expires})}catch(pe){delete O.abortController,K(pe)}finally{d--,C()}var fe})),C=()=>{const O=(()=>{for(const F of Object.keys(v))if(v[F]())return!0;return!1})()?o.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:o.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let F=d;F<O&&s.length>0;F++){const U=s.shift();U.abortController.signal.aborted?F--:w(U)}},B=(O,F)=>new Promise(((U,K)=>{const W=new Image,X=O.url,re=O.credentials;re&&re==="include"?W.crossOrigin="use-credentials":(re&&re==="same-origin"||!o.d(X))&&(W.crossOrigin="anonymous"),F.signal.addEventListener("abort",(()=>{W.src="",K(o.c())})),W.fetchPriority="high",W.onload=()=>{W.onerror=W.onload=null,U({data:W})},W.onerror=()=>{W.onerror=W.onload=null,F.signal.aborted||K(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},W.src=X}))})(me||(me={})),me.resetRequestQueue();class Se{constructor(s){this._transformRequestFn=s??null}transformRequest(s,d){return this._transformRequestFn&&this._transformRequestFn(s,d)||{url:s}}setTransformRequest(s){this._transformRequestFn=s}}function Me(x){const s=[];if(typeof x=="string")s.push({id:"default",url:x});else if(x&&x.length>0){const d=[];for(const{id:g,url:v}of x){const w=`${g}${v}`;d.indexOf(w)===-1&&(d.push(w),s.push({id:g,url:v}))}}return s}function Ve(x,s,d){try{const g=new URL(x);return g.pathname+=`${s}${d}`,g.toString()}catch{throw new Error(`Invalid sprite URL "${x}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}function Be(x){const{userImage:s}=x;return!!(s&&s.render&&s.render())&&(x.data.replace(new Uint8Array(s.data.buffer)),!0)}class $e extends o.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new o.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(s){if(this.loaded!==s&&(this.loaded=s,s)){for(const{ids:d,promiseResolve:g}of this.requestors)g(this._getImagesForIds(d));this.requestors=[]}}getImage(s){const d=this.images[s];if(d&&!d.data&&d.spriteData){const g=d.spriteData;d.data=new o.R({width:g.width,height:g.height},g.context.getImageData(g.x,g.y,g.width,g.height).data),d.spriteData=null}return d}addImage(s,d){if(this.images[s])throw new Error(`Image id ${s} already exist, use updateImage instead`);this._validate(s,d)&&(this.images[s]=d)}_validate(s,d){let g=!0;const v=d.data||d.spriteData;return this._validateStretch(d.stretchX,v&&v.width)||(this.fire(new o.k(new Error(`Image "${s}" has invalid "stretchX" value`))),g=!1),this._validateStretch(d.stretchY,v&&v.height)||(this.fire(new o.k(new Error(`Image "${s}" has invalid "stretchY" value`))),g=!1),this._validateContent(d.content,d)||(this.fire(new o.k(new Error(`Image "${s}" has invalid "content" value`))),g=!1),g}_validateStretch(s,d){if(!s)return!0;let g=0;for(const v of s){if(v[0]<g||v[1]<v[0]||d<v[1])return!1;g=v[1]}return!0}_validateContent(s,d){if(!s)return!0;if(s.length!==4)return!1;const g=d.spriteData,v=g&&g.width||d.data.width,w=g&&g.height||d.data.height;return!(s[0]<0||v<s[0]||s[1]<0||w<s[1]||s[2]<0||v<s[2]||s[3]<0||w<s[3]||s[2]<s[0]||s[3]<s[1])}updateImage(s,d,g=!0){const v=this.getImage(s);if(g&&(v.data.width!==d.data.width||v.data.height!==d.data.height))throw new Error(`size mismatch between old image (${v.data.width}x${v.data.height}) and new image (${d.data.width}x${d.data.height}).`);d.version=v.version+1,this.images[s]=d,this.updatedImages[s]=!0}removeImage(s){const d=this.images[s];delete this.images[s],delete this.patterns[s],d.userImage&&d.userImage.onRemove&&d.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(s){return new Promise(((d,g)=>{let v=!0;if(!this.isLoaded())for(const w of s)this.images[w]||(v=!1);this.isLoaded()||v?d(this._getImagesForIds(s)):this.requestors.push({ids:s,promiseResolve:d})}))}_getImagesForIds(s){const d={};for(const g of s){let v=this.getImage(g);v||(this.fire(new o.l("styleimagemissing",{id:g})),v=this.getImage(g)),v?d[g]={data:v.data.clone(),pixelRatio:v.pixelRatio,sdf:v.sdf,version:v.version,stretchX:v.stretchX,stretchY:v.stretchY,content:v.content,textFitWidth:v.textFitWidth,textFitHeight:v.textFitHeight,hasRenderCallback:!!(v.userImage&&v.userImage.render)}:o.w(`Image "${g}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return d}getPixelSize(){const{width:s,height:d}=this.atlasImage;return{width:s,height:d}}getPattern(s){const d=this.patterns[s],g=this.getImage(s);if(!g)return null;if(d&&d.position.version===g.version)return d.position;if(d)d.position.version=g.version;else{const v={w:g.data.width+2,h:g.data.height+2,x:0,y:0},w=new o.I(v,g);this.patterns[s]={bin:v,position:w}}return this._updatePatternAtlas(),this.patterns[s].position}bind(s){const d=s.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new o.T(s,this.atlasImage,d.RGBA),this.atlasTexture.bind(d.LINEAR,d.CLAMP_TO_EDGE)}_updatePatternAtlas(){const s=[];for(const w in this.patterns)s.push(this.patterns[w].bin);const{w:d,h:g}=o.p(s),v=this.atlasImage;v.resize({width:d||1,height:g||1});for(const w in this.patterns){const{bin:C}=this.patterns[w],B=C.x+1,O=C.y+1,F=this.getImage(w).data,U=F.width,K=F.height;o.R.copy(F,v,{x:0,y:0},{x:B,y:O},{width:U,height:K}),o.R.copy(F,v,{x:0,y:K-1},{x:B,y:O-1},{width:U,height:1}),o.R.copy(F,v,{x:0,y:0},{x:B,y:O+K},{width:U,height:1}),o.R.copy(F,v,{x:U-1,y:0},{x:B-1,y:O},{width:1,height:K}),o.R.copy(F,v,{x:0,y:0},{x:B+U,y:O},{width:1,height:K})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(s){for(const d of s){if(this.callbackDispatchedThisFrame[d])continue;this.callbackDispatchedThisFrame[d]=!0;const g=this.getImage(d);g||o.w(`Image with ID: "${d}" was not found`),Be(g)&&this.updateImage(d,g)}}}const at=1e20;function _t(x,s,d,g,v,w,C,B,O){for(let F=s;F<s+g;F++)Nt(x,d*w+F,w,v,C,B,O);for(let F=d;F<d+v;F++)Nt(x,F*w+s,1,g,C,B,O)}function Nt(x,s,d,g,v,w,C){w[0]=0,C[0]=-at,C[1]=at,v[0]=x[s];for(let B=1,O=0,F=0;B<g;B++){v[B]=x[s+B*d];const U=B*B;do{const K=w[O];F=(v[B]-v[K]+U-K*K)/(B-K)/2}while(F<=C[O]&&--O>-1);O++,w[O]=B,C[O]=F,C[O+1]=at}for(let B=0,O=0;B<g;B++){for(;C[O+1]<B;)O++;const F=w[O],U=B-F;x[s+B*d]=v[F]+U*U}}class sr{constructor(s,d){this.requestManager=s,this.localIdeographFontFamily=d,this.entries={}}setURL(s){this.url=s}getGlyphs(s){return o._(this,void 0,void 0,(function*(){const d=[];for(const w in s)for(const C of s[w])d.push(this._getAndCacheGlyphsPromise(w,C));const g=yield Promise.all(d),v={};for(const{stack:w,id:C,glyph:B}of g)v[w]||(v[w]={}),v[w][C]=B&&{id:B.id,bitmap:B.bitmap.clone(),metrics:B.metrics};return v}))}_getAndCacheGlyphsPromise(s,d){return o._(this,void 0,void 0,(function*(){let g=this.entries[s];g||(g=this.entries[s]={glyphs:{},requests:{},ranges:{}});let v=g.glyphs[d];if(v!==void 0)return{stack:s,id:d,glyph:v};if(v=this._tinySDF(g,s,d),v)return g.glyphs[d]=v,{stack:s,id:d,glyph:v};const w=Math.floor(d/256);if(256*w>65535)throw new Error("glyphs > 65535 not supported");if(g.ranges[w])return{stack:s,id:d,glyph:v};if(!this.url)throw new Error("glyphsUrl is not set");if(!g.requests[w]){const B=sr.loadGlyphRange(s,w,this.url,this.requestManager);g.requests[w]=B}const C=yield g.requests[w];for(const B in C)this._doesCharSupportLocalGlyph(+B)||(g.glyphs[+B]=C[+B]);return g.ranges[w]=!0,{stack:s,id:d,glyph:C[d]||null}}))}_doesCharSupportLocalGlyph(s){return!!this.localIdeographFontFamily&&(new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(s))||o.u["CJK Unified Ideographs"](s)||o.u["Hangul Syllables"](s)||o.u.Hiragana(s)||o.u.Katakana(s)||o.u["CJK Symbols and Punctuation"](s)||o.u["Halfwidth and Fullwidth Forms"](s))}_tinySDF(s,d,g){const v=this.localIdeographFontFamily;if(!v||!this._doesCharSupportLocalGlyph(g))return;let w=s.tinySDF;if(!w){let B="400";/bold/i.test(d)?B="900":/medium/i.test(d)?B="500":/light/i.test(d)&&(B="200"),w=s.tinySDF=new sr.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:v,fontWeight:B})}const C=w.draw(String.fromCharCode(g));return{id:g,bitmap:new o.q({width:C.width||60,height:C.height||60},C.data),metrics:{width:C.glyphWidth/2||24,height:C.glyphHeight/2||24,left:C.glyphLeft/2+.5||0,top:C.glyphTop/2-27.5||-8,advance:C.glyphAdvance/2||24,isDoubleResolution:!0}}}}sr.loadGlyphRange=function(x,s,d,g){return o._(this,void 0,void 0,(function*(){const v=256*s,w=v+255,C=g.transformRequest(d.replace("{fontstack}",x).replace("{range}",`${v}-${w}`),"Glyphs"),B=yield o.n(C,new AbortController);if(!B||!B.data)throw new Error(`Could not load glyph range. range: ${s}, ${v}-${w}`);const O={};for(const F of o.o(B.data))O[F.id]=F;return O}))},sr.TinySDF=class{constructor({fontSize:x=24,buffer:s=3,radius:d=8,cutoff:g=.25,fontFamily:v="sans-serif",fontWeight:w="normal",fontStyle:C="normal",lang:B=null}={}){this.buffer=s,this.cutoff=g,this.radius=d,this.lang=B;const O=this.size=x+4*s,F=this._createCanvas(O),U=this.ctx=F.getContext("2d",{willReadFrequently:!0});U.font=`${C} ${w} ${x}px ${v}`,U.textBaseline="alphabetic",U.textAlign="left",U.fillStyle="black",this.gridOuter=new Float64Array(O*O),this.gridInner=new Float64Array(O*O),this.f=new Float64Array(O),this.z=new Float64Array(O+1),this.v=new Uint16Array(O)}_createCanvas(x){const s=document.createElement("canvas");return s.width=s.height=x,s}draw(x){const{width:s,actualBoundingBoxAscent:d,actualBoundingBoxDescent:g,actualBoundingBoxLeft:v,actualBoundingBoxRight:w}=this.ctx.measureText(x),C=Math.ceil(d),B=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(w-v))),O=Math.min(this.size-this.buffer,C+Math.ceil(g)),F=B+2*this.buffer,U=O+2*this.buffer,K=Math.max(F*U,0),W=new Uint8ClampedArray(K),X={data:W,width:F,height:U,glyphWidth:B,glyphHeight:O,glyphTop:C,glyphLeft:0,glyphAdvance:s};if(B===0||O===0)return X;const{ctx:re,buffer:ue,gridInner:fe,gridOuter:pe}=this;this.lang&&(re.lang=this.lang),re.clearRect(ue,ue,B,O),re.fillText(x,ue,ue+C);const _e=re.getImageData(ue,ue,B,O);pe.fill(at,0,K),fe.fill(0,0,K);for(let we=0;we<O;we++)for(let ye=0;ye<B;ye++){const Te=_e.data[4*(we*B+ye)+3]/255;if(Te===0)continue;const Ie=(we+ue)*F+ye+ue;if(Te===1)pe[Ie]=0,fe[Ie]=at;else{const be=.5-Te;pe[Ie]=be>0?be*be:0,fe[Ie]=be<0?be*be:0}}_t(pe,0,0,F,U,F,this.f,this.v,this.z),_t(fe,ue,ue,B,O,F,this.f,this.v,this.z);for(let we=0;we<K;we++){const ye=Math.sqrt(pe[we])-Math.sqrt(fe[we]);W[we]=Math.round(255-255*(ye/this.radius+this.cutoff))}return X}};class Ft{constructor(){this.specification=o.v.light.position}possiblyEvaluate(s,d){return o.B(s.expression.evaluate(d))}interpolate(s,d,g){return{x:o.C.number(s.x,d.x,g),y:o.C.number(s.y,d.y,g),z:o.C.number(s.z,d.z,g)}}}let Ut;class Lt extends o.E{constructor(s){super(),Ut=Ut||new o.r({anchor:new o.D(o.v.light.anchor),position:new Ft,color:new o.D(o.v.light.color),intensity:new o.D(o.v.light.intensity)}),this._transitionable=new o.t(Ut),this.setLight(s),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(s,d={}){if(!this._validate(o.x,s,d))for(const g in s){const v=s[g];g.endsWith("-transition")?this._transitionable.setTransition(g.slice(0,-11),v):this._transitionable.setValue(g,v)}}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}_validate(s,d,g){return(!g||g.validate!==!1)&&o.y(this,s.call(o.z,{value:d,style:{glyphs:!0,sprite:!0},styleSpec:o.v}))}}const At=new o.r({"sky-color":new o.D(o.v.sky["sky-color"]),"horizon-color":new o.D(o.v.sky["horizon-color"]),"fog-color":new o.D(o.v.sky["fog-color"]),"fog-ground-blend":new o.D(o.v.sky["fog-ground-blend"]),"horizon-fog-blend":new o.D(o.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new o.D(o.v.sky["sky-horizon-blend"]),"atmosphere-blend":new o.D(o.v.sky["atmosphere-blend"])});class Ke extends o.E{constructor(s){super(),this._transitionable=new o.t(At),this.setSky(s),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new o.F(0))}setSky(s,d={}){if(!this._validate(o.G,s,d)){s||(s={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const g in s){const v=s[g];g.endsWith("-transition")?this._transitionable.setTransition(g.slice(0,-11),v):this._transitionable.setValue(g,v)}}}getSky(){return this._transitionable.serialize()}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}_validate(s,d,g={}){return g?.validate!==!1&&o.y(this,s.call(o.z,o.e({value:d,style:{glyphs:!0,sprite:!0},styleSpec:o.v})))}calculateFogBlendOpacity(s){return s<60?0:s<70?(s-60)/10:1}}class ft{constructor(s,d){this.width=s,this.height=d,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(s,d){const g=s.join(",")+String(d);return this.dashEntry[g]||(this.dashEntry[g]=this.addDash(s,d)),this.dashEntry[g]}getDashRanges(s,d,g){const v=[];let w=s.length%2==1?-s[s.length-1]*g:0,C=s[0]*g,B=!0;v.push({left:w,right:C,isDash:B,zeroLength:s[0]===0});let O=s[0];for(let F=1;F<s.length;F++){B=!B;const U=s[F];w=O*g,O+=U,C=O*g,v.push({left:w,right:C,isDash:B,zeroLength:U===0})}return v}addRoundDash(s,d,g){const v=d/2;for(let w=-g;w<=g;w++){const C=this.width*(this.nextRow+g+w);let B=0,O=s[B];for(let F=0;F<this.width;F++){F/O.right>1&&(O=s[++B]);const U=Math.abs(F-O.left),K=Math.abs(F-O.right),W=Math.min(U,K);let X;const re=w/g*(v+1);if(O.isDash){const ue=v-Math.abs(re);X=Math.sqrt(W*W+ue*ue)}else X=v-Math.sqrt(W*W+re*re);this.data[C+F]=Math.max(0,Math.min(255,X+128))}}}addRegularDash(s){for(let B=s.length-1;B>=0;--B){const O=s[B],F=s[B+1];O.zeroLength?s.splice(B,1):F&&F.isDash===O.isDash&&(F.left=O.left,s.splice(B,1))}const d=s[0],g=s[s.length-1];d.isDash===g.isDash&&(d.left=g.left-this.width,g.right=d.right+this.width);const v=this.width*this.nextRow;let w=0,C=s[w];for(let B=0;B<this.width;B++){B/C.right>1&&(C=s[++w]);const O=Math.abs(B-C.left),F=Math.abs(B-C.right),U=Math.min(O,F);this.data[v+B]=Math.max(0,Math.min(255,(C.isDash?U:-U)+128))}}addDash(s,d){const g=d?7:0,v=2*g+1;if(this.nextRow+v>this.height)return o.w("LineAtlas out of space"),null;let w=0;for(let B=0;B<s.length;B++)w+=s[B];if(w!==0){const B=this.width/w,O=this.getDashRanges(s,this.width,B);d?this.addRoundDash(O,B,g):this.addRegularDash(O)}const C={y:(this.nextRow+g+.5)/this.height,height:2*g/this.height,width:w};return this.nextRow+=v,this.dirty=!0,C}bind(s){const d=s.gl;this.texture?(d.bindTexture(d.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,d.texSubImage2D(d.TEXTURE_2D,0,0,0,this.width,this.height,d.ALPHA,d.UNSIGNED_BYTE,this.data))):(this.texture=d.createTexture(),d.bindTexture(d.TEXTURE_2D,this.texture),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.REPEAT),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.REPEAT),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.LINEAR),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.LINEAR),d.texImage2D(d.TEXTURE_2D,0,d.ALPHA,this.width,this.height,0,d.ALPHA,d.UNSIGNED_BYTE,this.data))}}const Tt="maplibre_preloaded_worker_pool";class ze{constructor(){this.active={}}acquire(s){if(!this.workers)for(this.workers=[];this.workers.length<ze.workerCount;)this.workers.push(new Worker(o.a.WORKER_URL));return this.active[s]=!0,this.workers.slice()}release(s){delete this.active[s],this.numActive()===0&&(this.workers.forEach((d=>{d.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[Tt]}numActive(){return Object.keys(this.active).length}}const ht=Math.floor(M.hardwareConcurrency/2);let Ht,Jt;function Pr(){return Ht||(Ht=new ze),Ht}ze.workerCount=o.H(globalThis)?Math.max(Math.min(ht,3),1):1;class yr{constructor(s,d){this.workerPool=s,this.actors=[],this.currentActor=0,this.id=d;const g=this.workerPool.acquire(d);for(let v=0;v<g.length;v++){const w=new o.J(g[v],d);w.name=`Worker ${v}`,this.actors.push(w)}if(!this.actors.length)throw new Error("No actors found")}broadcast(s,d){const g=[];for(const v of this.actors)g.push(v.sendAsync({type:s,data:d}));return Promise.all(g)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(s=!0){this.actors.forEach((d=>{d.remove()})),this.actors=[],s&&this.workerPool.release(this.id)}registerMessageHandler(s,d){for(const g of this.actors)g.registerMessageHandler(s,d)}}function $t(){return Jt||(Jt=new yr(Pr(),o.K),Jt.registerMessageHandler("GR",((x,s,d)=>o.m(s,d)))),Jt}function pr(x,s){const d=o.L();return o.M(d,d,[1,1,0]),o.N(d,d,[.5*x.width,.5*x.height,1]),x.calculatePosMatrix?o.O(d,d,x.calculatePosMatrix(s.toUnwrapped())):d}function Qt(x,s,d,g,v,w,C){var B;const O=(function(W,X,re){if(W)for(const ue of W){const fe=X[ue];if(fe&&fe.source===re&&fe.type==="fill-extrusion")return!0}else for(const ue in X){const fe=X[ue];if(fe.source===re&&fe.type==="fill-extrusion")return!0}return!1})((B=v?.layers)!==null&&B!==void 0?B:null,s,x.id),F=w.maxPitchScaleFactor(),U=x.tilesIn(g,F,O);U.sort(Nr);const K=[];for(const W of U)K.push({wrappedTileID:W.tileID.wrapped().key,queryResults:W.tile.queryRenderedFeatures(s,d,x._state,W.queryGeometry,W.cameraQueryGeometry,W.scale,v,w,F,pr(x.transform,W.tileID),C?(X,re)=>C(W.tileID,X,re):void 0)});return(function(W,X){for(const re in W)for(const ue of W[re])An(ue,X);return W})((function(W){const X={},re={};for(const ue of W){const fe=ue.queryResults,pe=ue.wrappedTileID,_e=re[pe]=re[pe]||{};for(const we in fe){const ye=fe[we],Te=_e[we]=_e[we]||{},Ie=X[we]=X[we]||[];for(const be of ye)Te[be.featureIndex]||(Te[be.featureIndex]=!0,Ie.push(be))}}return X})(K),x)}function Nr(x,s){const d=x.tileID,g=s.tileID;return d.overscaledZ-g.overscaledZ||d.canonical.y-g.canonical.y||d.wrap-g.wrap||d.canonical.x-g.canonical.x}function An(x,s){const d=x.feature,g=s.getFeatureState(d.layer["source-layer"],d.id);d.source=d.layer.source,d.layer["source-layer"]&&(d.sourceLayer=d.layer["source-layer"]),d.state=g}function wi(x,s,d){return o._(this,void 0,void 0,(function*(){let g=x;if(x.url?g=(yield o.j(s.transformRequest(x.url,"Source"),d)).data:yield M.frameAsync(d),!g)return null;const v=o.Q(o.e(g,x),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in g&&g.vector_layers&&(v.vectorLayerIds=g.vector_layers.map((w=>w.id))),v}))}class Zr{constructor(s,d){s&&(d?this.setSouthWest(s).setNorthEast(d):Array.isArray(s)&&(s.length===4?this.setSouthWest([s[0],s[1]]).setNorthEast([s[2],s[3]]):this.setSouthWest(s[0]).setNorthEast(s[1])))}setNorthEast(s){return this._ne=s instanceof o.S?new o.S(s.lng,s.lat):o.S.convert(s),this}setSouthWest(s){return this._sw=s instanceof o.S?new o.S(s.lng,s.lat):o.S.convert(s),this}extend(s){const d=this._sw,g=this._ne;let v,w;if(s instanceof o.S)v=s,w=s;else{if(!(s instanceof Zr))return Array.isArray(s)?s.length===4||s.every(Array.isArray)?this.extend(Zr.convert(s)):this.extend(o.S.convert(s)):s&&("lng"in s||"lon"in s)&&"lat"in s?this.extend(o.S.convert(s)):this;if(v=s._sw,w=s._ne,!v||!w)return this}return d||g?(d.lng=Math.min(v.lng,d.lng),d.lat=Math.min(v.lat,d.lat),g.lng=Math.max(w.lng,g.lng),g.lat=Math.max(w.lat,g.lat)):(this._sw=new o.S(v.lng,v.lat),this._ne=new o.S(w.lng,w.lat)),this}getCenter(){return new o.S((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new o.S(this.getWest(),this.getNorth())}getSouthEast(){return new o.S(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(s){const{lng:d,lat:g}=o.S.convert(s);let v=this._sw.lng<=d&&d<=this._ne.lng;return this._sw.lng>this._ne.lng&&(v=this._sw.lng>=d&&d>=this._ne.lng),this._sw.lat<=g&&g<=this._ne.lat&&v}static convert(s){return s instanceof Zr?s:s&&new Zr(s)}static fromLngLat(s,d=0){const g=360*d/40075017,v=g/Math.cos(Math.PI/180*s.lat);return new Zr(new o.S(s.lng-v,s.lat-g),new o.S(s.lng+v,s.lat+g))}adjustAntiMeridian(){const s=new o.S(this._sw.lng,this._sw.lat),d=new o.S(this._ne.lng,this._ne.lat);return new Zr(s,s.lng>d.lng?new o.S(d.lng+360,d.lat):d)}}class si{constructor(s,d,g){this.bounds=Zr.convert(this.validateBounds(s)),this.minzoom=d||0,this.maxzoom=g||24}validateBounds(s){return Array.isArray(s)&&s.length===4?[Math.max(-180,s[0]),Math.max(-90,s[1]),Math.min(180,s[2]),Math.min(90,s[3])]:[-180,-90,180,90]}contains(s){const d=Math.pow(2,s.z),g=Math.floor(o.V(this.bounds.getWest())*d),v=Math.floor(o.U(this.bounds.getNorth())*d),w=Math.ceil(o.V(this.bounds.getEast())*d),C=Math.ceil(o.U(this.bounds.getSouth())*d);return s.x>=g&&s.x<w&&s.y>=v&&s.y<C}}class Tn extends o.E{constructor(s,d,g,v){if(super(),this.id=s,this.dispatcher=g,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,o.e(this,o.Q(d,["url","scheme","tileSize","promoteId"])),this._options=o.e({type:"vector"},d),this._collectResourceTiming=d.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(v)}load(){return o._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new o.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const s=yield wi(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),s&&(o.e(this,s),s.bounds&&(this.tileBounds=new si(s.bounds,this.minzoom,this.maxzoom)),this.fire(new o.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.l("data",{dataType:"source",sourceDataType:"content"})))}catch(s){this._tileJSONRequest=null,this.fire(new o.k(s))}}))}loaded(){return this._loaded}hasTile(s){return!this.tileBounds||this.tileBounds.contains(s.canonical)}onAdd(s){this.map=s,this.load()}setSourceProperty(s){this._tileJSONRequest&&this._tileJSONRequest.abort(),s(),this.load()}setTiles(s){return this.setSourceProperty((()=>{this._options.tiles=s})),this}setUrl(s){return this.setSourceProperty((()=>{this.url=s,this._options.url=s})),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return o.e({},this._options)}loadTile(s){return o._(this,void 0,void 0,(function*(){const d=s.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),g={request:this.map._requestManager.transformRequest(d,"Tile"),uid:s.uid,tileID:s.tileID,zoom:s.tileID.overscaledZ,tileSize:this.tileSize*s.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity,globalState:this.map.getGlobalState()};g.request.collectResourceTiming=this._collectResourceTiming;let v="RT";if(s.actor&&s.state!=="expired"){if(s.state==="loading")return new Promise(((w,C)=>{s.reloadPromise={resolve:w,reject:C}}))}else s.actor=this.dispatcher.getActor(),v="LT";s.abortController=new AbortController;try{const w=yield s.actor.sendAsync({type:v,data:g},s.abortController);if(delete s.abortController,s.aborted)return;this._afterTileLoadWorkerResponse(s,w)}catch(w){if(delete s.abortController,s.aborted)return;if(w&&w.status!==404)throw w;this._afterTileLoadWorkerResponse(s,null)}}))}_afterTileLoadWorkerResponse(s,d){if(d&&d.resourceTiming&&(s.resourceTiming=d.resourceTiming),d&&this.map._refreshExpiredTiles&&s.setExpiryData(d),s.loadVectorData(d,this.map.painter),s.reloadPromise){const g=s.reloadPromise;s.reloadPromise=null,this.loadTile(s).then(g.resolve).catch(g.reject)}}abortTile(s){return o._(this,void 0,void 0,(function*(){s.abortController&&(s.abortController.abort(),delete s.abortController),s.actor&&(yield s.actor.sendAsync({type:"AT",data:{uid:s.uid,type:this.type,source:this.id}}))}))}unloadTile(s){return o._(this,void 0,void 0,(function*(){s.unloadVectorData(),s.actor&&(yield s.actor.sendAsync({type:"RMT",data:{uid:s.uid,type:this.type,source:this.id}}))}))}hasTransition(){return!1}}class zi extends o.E{constructor(s,d,g,v){super(),this.id=s,this.dispatcher=g,this.setEventedParent(v),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=o.e({type:"raster"},d),o.e(this,o.Q(d,["url","scheme","tileSize"]))}load(){return o._(this,arguments,void 0,(function*(s=!1){this._loaded=!1,this.fire(new o.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const d=yield wi(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,d&&(o.e(this,d),d.bounds&&(this.tileBounds=new si(d.bounds,this.minzoom,this.maxzoom)),this.fire(new o.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.l("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:s})))}catch(d){this._tileJSONRequest=null,this.fire(new o.k(d))}}))}loaded(){return this._loaded}onAdd(s){this.map=s,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(s){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),s(),this.load(!0)}setTiles(s){return this.setSourceProperty((()=>{this._options.tiles=s})),this}setUrl(s){return this.setSourceProperty((()=>{this.url=s,this._options.url=s})),this}serialize(){return o.e({},this._options)}hasTile(s){return!this.tileBounds||this.tileBounds.contains(s.canonical)}loadTile(s){return o._(this,void 0,void 0,(function*(){const d=s.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);s.abortController=new AbortController;try{const g=yield me.getImage(this.map._requestManager.transformRequest(d,"Tile"),s.abortController,this.map._refreshExpiredTiles);if(delete s.abortController,s.aborted)return void(s.state="unloaded");if(g&&g.data){this.map._refreshExpiredTiles&&(g.cacheControl||g.expires)&&s.setExpiryData({cacheControl:g.cacheControl,expires:g.expires});const v=this.map.painter.context,w=v.gl,C=g.data;s.texture=this.map.painter.getTileTexture(C.width),s.texture?s.texture.update(C,{useMipmap:!0}):(s.texture=new o.T(v,C,w.RGBA,{useMipmap:!0}),s.texture.bind(w.LINEAR,w.CLAMP_TO_EDGE,w.LINEAR_MIPMAP_NEAREST)),s.state="loaded"}}catch(g){if(delete s.abortController,s.aborted)s.state="unloaded";else if(g)throw s.state="errored",g}}))}abortTile(s){return o._(this,void 0,void 0,(function*(){s.abortController&&(s.abortController.abort(),delete s.abortController)}))}unloadTile(s){return o._(this,void 0,void 0,(function*(){s.texture&&this.map.painter.saveTileTexture(s.texture)}))}hasTransition(){return!1}}class Ln extends zi{constructor(s,d,g,v){super(s,d,g,v),this.type="raster-dem",this.maxzoom=22,this._options=o.e({type:"raster-dem"},d),this.encoding=d.encoding||"mapbox",this.redFactor=d.redFactor,this.greenFactor=d.greenFactor,this.blueFactor=d.blueFactor,this.baseShift=d.baseShift}loadTile(s){return o._(this,void 0,void 0,(function*(){const d=s.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),g=this.map._requestManager.transformRequest(d,"Tile");s.neighboringTiles=this._getNeighboringTiles(s.tileID),s.abortController=new AbortController;try{const v=yield me.getImage(g,s.abortController,this.map._refreshExpiredTiles);if(delete s.abortController,s.aborted)return void(s.state="unloaded");if(v&&v.data){const w=v.data;this.map._refreshExpiredTiles&&(v.cacheControl||v.expires)&&s.setExpiryData({cacheControl:v.cacheControl,expires:v.expires});const C=o.b(w)&&o.W()?w:yield this.readImageNow(w),B={type:this.type,uid:s.uid,source:this.id,rawImageData:C,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!s.actor||s.state==="expired"){s.actor=this.dispatcher.getActor();const O=yield s.actor.sendAsync({type:"LDT",data:B});s.dem=O,s.needsHillshadePrepare=!0,s.needsTerrainPrepare=!0,s.state="loaded"}}}catch(v){if(delete s.abortController,s.aborted)s.state="unloaded";else if(v)throw s.state="errored",v}}))}readImageNow(s){return o._(this,void 0,void 0,(function*(){if(typeof VideoFrame<"u"&&o.X()){const d=s.width+2,g=s.height+2;try{return new o.R({width:d,height:g},yield o.Y(s,-1,-1,d,g))}catch{}}return M.getImageData(s,1)}))}_getNeighboringTiles(s){const d=s.canonical,g=Math.pow(2,d.z),v=(d.x-1+g)%g,w=d.x===0?s.wrap-1:s.wrap,C=(d.x+1+g)%g,B=d.x+1===g?s.wrap+1:s.wrap,O={};return O[new o.Z(s.overscaledZ,w,d.z,v,d.y).key]={backfilled:!1},O[new o.Z(s.overscaledZ,B,d.z,C,d.y).key]={backfilled:!1},d.y>0&&(O[new o.Z(s.overscaledZ,w,d.z,v,d.y-1).key]={backfilled:!1},O[new o.Z(s.overscaledZ,s.wrap,d.z,d.x,d.y-1).key]={backfilled:!1},O[new o.Z(s.overscaledZ,B,d.z,C,d.y-1).key]={backfilled:!1}),d.y+1<g&&(O[new o.Z(s.overscaledZ,w,d.z,v,d.y+1).key]={backfilled:!1},O[new o.Z(s.overscaledZ,s.wrap,d.z,d.x,d.y+1).key]={backfilled:!1},O[new o.Z(s.overscaledZ,B,d.z,C,d.y+1).key]={backfilled:!1}),O}unloadTile(s){return o._(this,void 0,void 0,(function*(){s.demTexture&&this.map.painter.saveTileTexture(s.demTexture),s.fbo&&(s.fbo.destroy(),delete s.fbo),s.dem&&delete s.dem,delete s.neighboringTiles,s.state="unloaded",s.actor&&(yield s.actor.sendAsync({type:"RDT",data:{type:this.type,uid:s.uid,source:this.id}}))}))}}class Ps extends o.E{constructor(s,d,g,v){super(),this.id=s,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._isUpdatingWorker=!1,this._pendingWorkerUpdate={data:d.data},this.actor=g.getActor(),this.setEventedParent(v),this._data=d.data,this._options=o.e({},d),this._collectResourceTiming=d.collectResourceTiming,d.maxzoom!==void 0&&(this.maxzoom=d.maxzoom),d.type&&(this.type=d.type),d.attribution&&(this.attribution=d.attribution),this.promoteId=d.promoteId,d.clusterMaxZoom!==void 0&&this.maxzoom<=d.clusterMaxZoom&&o.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${d.clusterMaxZoom}".`),this.workerOptions=o.e({source:this.id,cluster:d.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(d.buffer!==void 0?d.buffer:128),tolerance:this._pixelsToTileUnits(d.tolerance!==void 0?d.tolerance:.375),extent:o.$,maxZoom:this.maxzoom,lineMetrics:d.lineMetrics||!1,generateId:d.generateId||!1},superclusterOptions:{maxZoom:this._getClusterMaxZoom(d.clusterMaxZoom),minPoints:Math.max(2,d.clusterMinPoints||2),extent:o.$,radius:this._pixelsToTileUnits(d.clusterRadius||50),log:!1,generateId:d.generateId||!1},clusterProperties:d.clusterProperties,filter:d.filter},d.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}_pixelsToTileUnits(s){return s*(o.$/this.tileSize)}_getClusterMaxZoom(s){const d=s?Math.round(s):this.maxzoom-1;return Number.isInteger(s)||s===void 0||o.w(`Integer expected for option 'clusterMaxZoom': provided value "${s}" rounded to "${d}"`),d}load(){return o._(this,void 0,void 0,(function*(){yield this._updateWorkerData()}))}onAdd(s){this.map=s,this.load()}setData(s){return this._data=s,this._pendingWorkerUpdate={data:s},this._updateWorkerData(),this}updateData(s){return this._pendingWorkerUpdate.diff=o.a0(this._pendingWorkerUpdate.diff,s),this._updateWorkerData(),this}getData(){return o._(this,void 0,void 0,(function*(){const s=o.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:s})}))}getCoordinatesFromGeometry(s){return s.type==="GeometryCollection"?s.geometries.map((d=>d.coordinates)).flat(1/0):s.coordinates.flat(1/0)}getBounds(){return o._(this,void 0,void 0,(function*(){const s=new Zr,d=yield this.getData();let g;switch(d.type){case"FeatureCollection":g=d.features.map((v=>this.getCoordinatesFromGeometry(v.geometry))).flat(1/0);break;case"Feature":g=this.getCoordinatesFromGeometry(d.geometry);break;default:g=this.getCoordinatesFromGeometry(d)}if(g.length==0)return s;for(let v=0;v<g.length-1;v+=2)s.extend([g[v],g[v+1]]);return s}))}setClusterOptions(s){return this.workerOptions.cluster=s.cluster,s&&(s.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(s.clusterRadius)),s.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=this._getClusterMaxZoom(s.clusterMaxZoom))),this._updateWorkerData(),this}getClusterExpansionZoom(s){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:s,source:this.id}})}getClusterChildren(s){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:s,source:this.id}})}getClusterLeaves(s,d,g){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:s,limit:d,offset:g}})}_updateWorkerData(){return o._(this,void 0,void 0,(function*(){if(this._isUpdatingWorker)return;const{data:s,diff:d}=this._pendingWorkerUpdate;if(!s&&!d)return void o.w(`No data or diff provided to GeoJSONSource ${this.id}.`);const g=o.e({type:this.type},this.workerOptions);s?(typeof s=="string"?(g.request=this.map._requestManager.transformRequest(M.resolveURL(s),"Source"),g.request.collectResourceTiming=this._collectResourceTiming):g.data=JSON.stringify(s),this._pendingWorkerUpdate.data=void 0):d&&(g.dataDiff=d,this._pendingWorkerUpdate.diff=void 0),this._isUpdatingWorker=!0,this.fire(new o.l("dataloading",{dataType:"source"}));try{const v=yield this.actor.sendAsync({type:"LD",data:g});if(this._isUpdatingWorker=!1,this._removed||v.abandoned)return void this.fire(new o.l("dataabort",{dataType:"source"}));this._data=v.data;let w=null;v.resourceTiming&&v.resourceTiming[this.id]&&(w=v.resourceTiming[this.id].slice(0));const C={dataType:"source"};this._collectResourceTiming&&w&&w.length>0&&o.e(C,{resourceTiming:w}),this.fire(new o.l("data",Object.assign(Object.assign({},C),{sourceDataType:"metadata"}))),this.fire(new o.l("data",Object.assign(Object.assign({},C),{sourceDataType:"content"})))}catch(v){if(this._isUpdatingWorker=!1,this._removed)return void this.fire(new o.l("dataabort",{dataType:"source"}));this.fire(new o.k(v))}finally{(this._pendingWorkerUpdate.data||this._pendingWorkerUpdate.diff)&&this._updateWorkerData()}}))}loaded(){return!this._isUpdatingWorker&&this._pendingWorkerUpdate.data===void 0&&this._pendingWorkerUpdate.diff===void 0}loadTile(s){return o._(this,void 0,void 0,(function*(){const d=s.actor?"RT":"LT";s.actor=this.actor;const g={type:this.type,uid:s.uid,tileID:s.tileID,zoom:s.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity,globalState:this.map.getGlobalState()};s.abortController=new AbortController;const v=yield this.actor.sendAsync({type:d,data:g},s.abortController);delete s.abortController,s.unloadVectorData(),s.aborted||s.loadVectorData(v,this.map.painter,d==="RT")}))}abortTile(s){return o._(this,void 0,void 0,(function*(){s.abortController&&(s.abortController.abort(),delete s.abortController),s.aborted=!0}))}unloadTile(s){return o._(this,void 0,void 0,(function*(){s.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:s.uid,type:this.type,source:this.id}})}))}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return o.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}class ns extends o.E{constructor(s,d,g,v){super(),this.flippedWindingOrder=!1,this.id=s,this.dispatcher=g,this.coordinates=d.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(v),this.options=d}load(s){return o._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new o.l("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const d=yield me.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,d&&d.data&&(this.image=d.data,s&&(this.coordinates=s),this._finishLoading())}catch(d){this._request=null,this._loaded=!0,this.fire(new o.k(d))}}))}loaded(){return this._loaded}updateImage(s){return s.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=s.url,this.load(s.coordinates).finally((()=>{this.texture=null})),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new o.l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(s){this.map=s,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(s){this.coordinates=s;const d=s.map(o.a1.fromLngLat);var g;return this.tileID=(function(v){const w=o.a2.fromPoints(v),C=w.width(),B=w.height(),O=Math.max(C,B),F=Math.max(0,Math.floor(-Math.log(O)/Math.LN2)),U=Math.pow(2,F);return new o.a4(F,Math.floor((w.minX+w.maxX)/2*U),Math.floor((w.minY+w.maxY)/2*U))})(d),this.terrainTileRanges=this._getOverlappingTileRanges(d),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=d.map((v=>this.tileID.getTilePoint(v)._round())),this.flippedWindingOrder=((g=this.tileCoords)[1].x-g[0].x)*(g[2].y-g[0].y)-(g[1].y-g[0].y)*(g[2].x-g[0].x)<0,this.fire(new o.l("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const s=this.map.painter.context,d=s.gl;this.texture||(this.texture=new o.T(s,this.image,d.RGBA),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE));let g=!1;for(const v in this.tiles){const w=this.tiles[v];w.state!=="loaded"&&(w.state="loaded",w.texture=this.texture,g=!0)}g&&this.fire(new o.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(s){return o._(this,void 0,void 0,(function*(){this.tileID&&this.tileID.equals(s.tileID.canonical)?(this.tiles[String(s.tileID.wrap)]=s,s.buckets={}):s.state="errored"}))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}_getOverlappingTileRanges(s){const{minX:d,minY:g,maxX:v,maxY:w}=o.a2.fromPoints(s),C={};for(let B=0;B<=o.a3;B++){const O=Math.pow(2,B),F=Math.floor(d*O),U=Math.floor(g*O),K=Math.floor(v*O),W=Math.floor(w*O);C[B]={minTileX:F,minTileY:U,maxTileX:K,maxTileY:W}}return C}}class ss extends ns{constructor(s,d,g,v){super(s,d,g,v),this.roundZoom=!0,this.type="video",this.options=d}load(){return o._(this,void 0,void 0,(function*(){this._loaded=!1;const s=this.options;this.urls=[];for(const d of s.urls)this.urls.push(this.map._requestManager.transformRequest(d,"Source").url);try{const d=yield o.a5(this.urls);if(this._loaded=!0,!d)return;this.video=d,this.video.loop=!0,this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading()}catch(d){this.fire(new o.k(d))}}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(s){if(this.video){const d=this.video.seekable;s<d.start(0)||s>d.end(0)?this.fire(new o.k(new o.a6(`sources.${this.id}`,null,`Playback for this video can be set only between the ${d.start(0)} and ${d.end(0)}-second mark.`))):this.video.currentTime=s}}getVideo(){return this.video}onAdd(s){this.map||(this.map=s,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const s=this.map.painter.context,d=s.gl;this.texture?this.video.paused||(this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE),d.texSubImage2D(d.TEXTURE_2D,0,0,0,d.RGBA,d.UNSIGNED_BYTE,this.video)):(this.texture=new o.T(s,this.video,d.RGBA),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE));let g=!1;for(const v in this.tiles){const w=this.tiles[v];w.state!=="loaded"&&(w.state="loaded",w.texture=this.texture,g=!0)}g&&this.fire(new o.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class vi extends ns{constructor(s,d,g,v){super(s,d,g,v),d.coordinates?Array.isArray(d.coordinates)&&d.coordinates.length===4&&!d.coordinates.some((w=>!Array.isArray(w)||w.length!==2||w.some((C=>typeof C!="number"))))||this.fire(new o.k(new o.a6(`sources.${s}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.k(new o.a6(`sources.${s}`,null,'missing required property "coordinates"'))),d.animate&&typeof d.animate!="boolean"&&this.fire(new o.k(new o.a6(`sources.${s}`,null,'optional "animate" property must be a boolean value'))),d.canvas?typeof d.canvas=="string"||d.canvas instanceof HTMLCanvasElement||this.fire(new o.k(new o.a6(`sources.${s}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.k(new o.a6(`sources.${s}`,null,'missing required property "canvas"'))),this.options=d,this.animate=d.animate===void 0||d.animate}load(){return o._(this,void 0,void 0,(function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.k(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}))}getCanvas(){return this.canvas}onAdd(s){this.map=s,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let s=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,s=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,s=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const d=this.map.painter.context,g=d.gl;this.texture?(s||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new o.T(d,this.canvas,g.RGBA,{premultiply:!0});let v=!1;for(const w in this.tiles){const C=this.tiles[w];C.state!=="loaded"&&(C.state="loaded",C.texture=this.texture,v=!0)}v&&this.fire(new o.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const s of[this.canvas.width,this.canvas.height])if(isNaN(s)||s<=0)return!0;return!1}}const lo={},Po=x=>{switch(x){case"geojson":return Ps;case"image":return ns;case"raster":return zi;case"raster-dem":return Ln;case"vector":return Tn;case"video":return ss;case"canvas":return vi}return lo[x]},ea="RTLPluginLoaded";class Ro extends o.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=$t()}_syncState(s){return this.status=s,this.dispatcher.broadcast("SRPS",{pluginStatus:s,pluginURL:this.url}).catch((d=>{throw this.status="error",d}))}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(s){return o._(this,arguments,void 0,(function*(d,g=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=M.resolveURL(d),!this.url)throw new Error(`requested url ${d} is invalid`);if(this.status==="unavailable"){if(!g)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()}))}_requestImport(){return o._(this,void 0,void 0,(function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new o.l(ea))}))}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let Mo=null;function Gs(){return Mo||(Mo=new Ro),Mo}class co{constructor(s,d){this.timeAdded=0,this.fadeEndTime=0,this.tileID=s,this.uid=o.a7(),this.uses=0,this.tileSize=d,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(s){const d=s+this.timeAdded;d<this.fadeEndTime||(this.fadeEndTime=d)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(s){this.demTexture&&s.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(s,d,g){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",s){s.featureIndex&&(this.latestFeatureIndex=s.featureIndex,s.rawTileData?(this.latestRawTileData=s.rawTileData,this.latestFeatureIndex.rawTileData=s.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=s.collisionBoxArray,this.buckets=(function(v,w){const C={};if(!w)return C;for(const B of v){const O=B.layerIds.map((F=>w.getLayer(F))).filter(Boolean);if(O.length!==0){B.layers=O,B.stateDependentLayerIds&&(B.stateDependentLayers=B.stateDependentLayerIds.map((F=>O.filter((U=>U.id===F))[0])));for(const F of O)C[F.id]=B}}return C})(s.buckets,d?.style),this.hasSymbolBuckets=!1;for(const v in this.buckets){const w=this.buckets[v];if(w instanceof o.a9){if(this.hasSymbolBuckets=!0,!g)break;w.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const v in this.buckets){const w=this.buckets[v];if(w instanceof o.a9&&w.hasRTLText){this.hasRTLText=!0,Gs().lazyLoad();break}}this.queryPadding=0;for(const v in this.buckets){const w=this.buckets[v];this.queryPadding=Math.max(this.queryPadding,d.style.getLayer(v).queryRadius(w))}s.imageAtlas&&(this.imageAtlas=s.imageAtlas),s.glyphAtlasImage&&(this.glyphAtlasImage=s.glyphAtlasImage)}else this.collisionBoxArray=new o.a8}unloadVectorData(){for(const s in this.buckets)this.buckets[s].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(s){return this.buckets[s.id]}upload(s){for(const g in this.buckets){const v=this.buckets[g];v.uploadPending()&&v.upload(s)}const d=s.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new o.T(s,this.imageAtlas.image,d.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new o.T(s,this.glyphAtlasImage,d.ALPHA),this.glyphAtlasImage=null)}prepare(s){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(s,this.imageAtlasTexture)}queryRenderedFeatures(s,d,g,v,w,C,B,O,F,U,K){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:v,cameraQueryGeometry:w,scale:C,tileSize:this.tileSize,pixelPosMatrix:U,transform:O,params:B,queryPadding:this.queryPadding*F,getElevation:K},s,d,g):{}}querySourceFeatures(s,d){const g=this.latestFeatureIndex;if(!g||!g.rawTileData)return;const v=g.loadVTLayers(),w=d&&d.sourceLayer?d.sourceLayer:"",C=v._geojsonTileLayer||v[w];if(!C)return;const B=o.aa(d&&d.filter),{z:O,x:F,y:U}=this.tileID.canonical,K={z:O,x:F,y:U};for(let W=0;W<C.length;W++){const X=C.feature(W);if(B.needGeometry){const fe=o.ab(X,!0);if(!B.filter(new o.F(this.tileID.overscaledZ),fe,this.tileID.canonical))continue}else if(!B.filter(new o.F(this.tileID.overscaledZ),X))continue;const re=g.getId(X,w),ue=new o.ac(X,O,F,U,re);ue.tile=K,s.push(ue)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(s){const d=this.expirationTime;if(s.cacheControl){const g=o.ad(s.cacheControl);g["max-age"]&&(this.expirationTime=Date.now()+1e3*g["max-age"])}else s.expires&&(this.expirationTime=new Date(s.expires).getTime());if(this.expirationTime){const g=Date.now();let v=!1;if(this.expirationTime>g)v=!1;else if(d)if(this.expirationTime<d)v=!0;else{const w=this.expirationTime-d;w?this.expirationTime=g+Math.max(w,3e4):v=!0}else v=!0;v?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(s,d){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(s).length===0)return;const g=this.latestFeatureIndex.loadVTLayers();for(const v in this.buckets){if(!d.style.hasLayer(v))continue;const w=this.buckets[v],C=w.layers[0].sourceLayer||"_geojsonTileLayer",B=g[C],O=s[C];if(!B||!O||Object.keys(O).length===0)continue;w.update(O,B,this.imageAtlas&&this.imageAtlas.patternPositions||{});const F=d&&d.style&&d.style.getLayer(v);F&&(this.queryPadding=Math.max(this.queryPadding,F.queryRadius(w)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<M.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(s){this.symbolFadeHoldUntil=M.now()+s}setDependencies(s,d){const g={};for(const v of d)g[v]=!0;this.dependencies[s]=g}hasDependency(s,d){for(const g of s){const v=this.dependencies[g];if(v){for(const w of d)if(v[w])return!0}}return!1}}class Oe{constructor(s,d){this.max=s,this.onRemove=d,this.reset()}reset(){for(const s in this.data)for(const d of this.data[s])d.timeout&&clearTimeout(d.timeout),this.onRemove(d.value);return this.data={},this.order=[],this}add(s,d,g){const v=s.wrapped().key;this.data[v]===void 0&&(this.data[v]=[]);const w={value:d,timeout:void 0};if(g!==void 0&&(w.timeout=setTimeout((()=>{this.remove(s,w)}),g)),this.data[v].push(w),this.order.push(v),this.order.length>this.max){const C=this._getAndRemoveByKey(this.order[0]);C&&this.onRemove(C)}return this}has(s){return s.wrapped().key in this.data}getAndRemove(s){return this.has(s)?this._getAndRemoveByKey(s.wrapped().key):null}_getAndRemoveByKey(s){const d=this.data[s].shift();return d.timeout&&clearTimeout(d.timeout),this.data[s].length===0&&delete this.data[s],this.order.splice(this.order.indexOf(s),1),d.value}getByKey(s){const d=this.data[s];return d?d[0].value:null}get(s){return this.has(s)?this.data[s.wrapped().key][0].value:null}remove(s,d){if(!this.has(s))return this;const g=s.wrapped().key,v=d===void 0?0:this.data[g].indexOf(d),w=this.data[g][v];return this.data[g].splice(v,1),w.timeout&&clearTimeout(w.timeout),this.data[g].length===0&&delete this.data[g],this.onRemove(w.value),this.order.splice(this.order.indexOf(g),1),this}setMaxSize(s){for(this.max=s;this.order.length>this.max;){const d=this._getAndRemoveByKey(this.order[0]);d&&this.onRemove(d)}return this}filter(s){const d=[];for(const g in this.data)for(const v of this.data[g])s(v.value)||d.push(v);for(const g of d)this.remove(g.value.tileID,g)}}class ne{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(s,d,g){const v=String(d);if(this.stateChanges[s]=this.stateChanges[s]||{},this.stateChanges[s][v]=this.stateChanges[s][v]||{},o.e(this.stateChanges[s][v],g),this.deletedStates[s]===null){this.deletedStates[s]={};for(const w in this.state[s])w!==v&&(this.deletedStates[s][w]=null)}else if(this.deletedStates[s]&&this.deletedStates[s][v]===null){this.deletedStates[s][v]={};for(const w in this.state[s][v])g[w]||(this.deletedStates[s][v][w]=null)}else for(const w in g)this.deletedStates[s]&&this.deletedStates[s][v]&&this.deletedStates[s][v][w]===null&&delete this.deletedStates[s][v][w]}removeFeatureState(s,d,g){if(this.deletedStates[s]===null)return;const v=String(d);if(this.deletedStates[s]=this.deletedStates[s]||{},g&&d!==void 0)this.deletedStates[s][v]!==null&&(this.deletedStates[s][v]=this.deletedStates[s][v]||{},this.deletedStates[s][v][g]=null);else if(d!==void 0)if(this.stateChanges[s]&&this.stateChanges[s][v])for(g in this.deletedStates[s][v]={},this.stateChanges[s][v])this.deletedStates[s][v][g]=null;else this.deletedStates[s][v]=null;else this.deletedStates[s]=null}getState(s,d){const g=String(d),v=o.e({},(this.state[s]||{})[g],(this.stateChanges[s]||{})[g]);if(this.deletedStates[s]===null)return{};if(this.deletedStates[s]){const w=this.deletedStates[s][d];if(w===null)return{};for(const C in w)delete v[C]}return v}initializeTileState(s,d){s.setFeatureState(this.state,d)}coalesceChanges(s,d){const g={};for(const v in this.stateChanges){this.state[v]=this.state[v]||{};const w={};for(const C in this.stateChanges[v])this.state[v][C]||(this.state[v][C]={}),o.e(this.state[v][C],this.stateChanges[v][C]),w[C]=this.state[v][C];g[v]=w}for(const v in this.deletedStates){this.state[v]=this.state[v]||{};const w={};if(this.deletedStates[v]===null)for(const C in this.state[v])w[C]={},this.state[v][C]={};else for(const C in this.deletedStates[v]){if(this.deletedStates[v][C]===null)this.state[v][C]={};else for(const B of Object.keys(this.deletedStates[v][C]))delete this.state[v][C][B];w[C]=this.state[v][C]}g[v]=g[v]||{},o.e(g[v],w)}if(this.stateChanges={},this.deletedStates={},Object.keys(g).length!==0)for(const v in s)s[v].setFeatureState(g,d)}}const se=89.25;function ce(x,s){const d=o.ah(s.lat,-o.ai,o.ai);return new o.P(o.V(s.lng)*x,o.U(d)*x)}function xe(x,s){return new o.a1(s.x/x,s.y/x).toLngLat()}function Ce(x){return x.cameraToCenterDistance*Math.min(.85*Math.tan(o.ae(90-x.pitch)),Math.tan(o.ae(se-x.pitch)))}function je(x,s){const d=x.canonical,g=s/o.af(d.z),v=d.x+Math.pow(2,d.z)*x.wrap,w=o.ag(new Float64Array(16));return o.M(w,w,[v*g,d.y*g,0]),o.N(w,w,[g/o.$,g/o.$,1]),w}function Ye(x,s,d,g,v){const w=o.a1.fromLngLat(x,s),C=v*o.aj(1,x.lat),B=C*Math.cos(o.ae(d)),O=Math.sqrt(C*C-B*B),F=O*Math.sin(o.ae(-g)),U=O*Math.cos(o.ae(-g));return new o.a1(w.x+F,w.y+U,w.z+B)}function De(x,s,d){const g=s.intersectsFrustum(x);if(!d||g===0)return g;const v=s.intersectsPlane(d);return v===0?0:g===2&&v===2?2:1}function nt(x,s,d){let g=0;const v=(d-s)/10;for(let w=0;w<10;w++)g+=v*Math.pow(Math.cos(s+(w+.5)/10*(d-s)),x);return g}function dt(x,s){return function(d,g,v,w,C){const B=2*((x-1)/o.ak(Math.cos(o.ae(se-C))/Math.cos(o.ae(se)))-1),O=Math.acos(v/w),F=2*nt(B-1,0,o.ae(C/2)),U=Math.min(o.ae(se),O+o.ae(C/2)),K=nt(B-1,Math.min(U,O-o.ae(C/2)),U),W=Math.atan(g/v),X=Math.hypot(g,v);let re=d;return re+=o.ak(w/X/Math.max(.5,Math.cos(o.ae(C/2)))),re+=B*o.ak(Math.cos(W))/2,re-=o.ak(Math.max(1,K/F/s))/2,re}}const lt=dt(9.314,3);function Dt(x,s){const d=(s.roundZoom?Math.round:Math.floor)(x.zoom+o.ak(x.tileSize/s.tileSize));return Math.max(0,d)}function Ne(x,s){const d=x.getCameraFrustum(),g=x.getClippingPlane(),v=x.screenPointToMercatorCoordinate(x.getCameraPoint()),w=o.a1.fromLngLat(x.center,x.elevation);v.z=w.z+Math.cos(x.pitchInRadians)*x.cameraToCenterDistance/x.worldSize;const C=x.getCoveringTilesDetailsProvider(),B=C.allowVariableZoom(x,s),O=Dt(x,s),F=s.minzoom||0,U=s.maxzoom!==void 0?s.maxzoom:x.maxZoom,K=Math.min(Math.max(0,O),U),W=Math.pow(2,K),X=[W*v.x,W*v.y,0],re=[W*w.x,W*w.y,0],ue=Math.hypot(w.x-v.x,w.y-v.y),fe=Math.abs(w.z-v.z),pe=Math.hypot(ue,fe),_e=Te=>({zoom:0,x:0,y:0,wrap:Te,fullyVisible:!1}),we=[],ye=[];if(x.renderWorldCopies&&C.allowWorldCopies())for(let Te=1;Te<=3;Te++)we.push(_e(-Te)),we.push(_e(Te));for(we.push(_e(0));we.length>0;){const Te=we.pop(),Ie=Te.x,be=Te.y;let ke=Te.fullyVisible;const Xe={x:Ie,y:be,z:Te.zoom},qe=C.getTileBoundingVolume(Xe,Te.wrap,x.elevation,s);if(!ke){const wt=De(d,qe,g);if(wt===0)continue;ke=wt===2}const Ze=C.distanceToTile2d(v.x,v.y,Xe,qe);let tt=O;B&&(tt=(s.calculateTileZoom||lt)(x.zoom+o.ak(x.tileSize/s.tileSize),Ze,fe,pe,x.fov)),tt=(s.roundZoom?Math.round:Math.floor)(tt),tt=Math.max(0,tt);const bt=Math.min(tt,U);if(Te.wrap=C.getWrap(w,Xe,Te.wrap),Te.zoom>=bt){if(Te.zoom<F)continue;const wt=K-Te.zoom,ut=X[0]-.5-(Ie<<wt),jt=X[1]-.5-(be<<wt),Sr=s.reparseOverscaled?Math.max(Te.zoom,tt):Te.zoom;ye.push({tileID:new o.Z(Te.zoom===U?Sr:Te.zoom,Te.wrap,Te.zoom,Ie,be),distanceSq:o.al([re[0]-.5-Ie,re[1]-.5-be]),tileDistanceToCamera:Math.sqrt(ut*ut+jt*jt)})}else for(let wt=0;wt<4;wt++)we.push({zoom:Te.zoom+1,x:(Ie<<1)+wt%2,y:(be<<1)+(wt>>1),wrap:Te.wrap,fullyVisible:ke})}return ye.sort(((Te,Ie)=>Te.distanceSq-Ie.distanceSq)).map((Te=>Te.tileID))}const ar=o.a2.fromPoints([new o.P(0,0),new o.P(o.$,o.$)]);class Rr extends o.E{constructor(s,d,g){super(),this.id=s,this.dispatcher=g,this.on("data",(v=>this._dataHandler(v))),this.on("dataloading",(()=>{this._sourceErrored=!1})),this.on("error",(()=>{this._sourceErrored=this._source.loaded()})),this._source=((v,w,C,B)=>{const O=new(Po(w.type))(v,w,C,B);if(O.id!==v)throw new Error(`Expected Source id to be ${v} instead of ${O.id}`);return O})(s,d,g,this),this._tiles={},this._cache=new Oe(0,(v=>this._unloadTile(v))),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new ne,this._didEmitContent=!1,this._updated=!1}onAdd(s){this.map=s,this._maxTileCacheSize=s?s._maxTileCacheSize:null,this._maxTileCacheZoomLevels=s?s._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(s)}onRemove(s){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(s)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const s in this._tiles){const d=this._tiles[s];if(d.state!=="loaded"&&d.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const s=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,s&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(s,d,g){return o._(this,void 0,void 0,(function*(){try{yield this._source.loadTile(s),this._tileLoaded(s,d,g)}catch(v){s.state="errored",v.status!==404?this._source.fire(new o.k(v,{tile:s})):this.update(this.transform,this.terrain)}}))}_unloadTile(s){this._source.unloadTile&&this._source.unloadTile(s)}_abortTile(s){this._source.abortTile&&this._source.abortTile(s),this._source.fire(new o.l("dataabort",{tile:s,coord:s.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(s){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const d in this._tiles){const g=this._tiles[d];g.upload(s),g.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map((s=>s.tileID)).sort(Wt).map((s=>s.key))}getRenderableIds(s){const d=[];for(const g in this._tiles)this._isIdRenderable(g,s)&&d.push(this._tiles[g]);return s?d.sort(((g,v)=>{const w=g.tileID,C=v.tileID,B=new o.P(w.canonical.x,w.canonical.y)._rotate(-this.transform.bearingInRadians),O=new o.P(C.canonical.x,C.canonical.y)._rotate(-this.transform.bearingInRadians);return w.overscaledZ-C.overscaledZ||O.y-B.y||O.x-B.x})).map((g=>g.tileID.key)):d.map((g=>g.tileID)).sort(Wt).map((g=>g.key))}hasRenderableParent(s){const d=this.findLoadedParent(s,0);return!!d&&this._isIdRenderable(d.tileID.key)}_isIdRenderable(s,d){return this._tiles[s]&&this._tiles[s].hasData()&&!this._coveredTiles[s]&&(d||!this._tiles[s].holdingForFade())}reload(s){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const d in this._tiles)s?this._reloadTile(d,"expired"):this._tiles[d].state!=="errored"&&this._reloadTile(d,"reloading")}}_reloadTile(s,d){return o._(this,void 0,void 0,(function*(){const g=this._tiles[s];g&&(g.state!=="loading"&&(g.state=d),yield this._loadTile(g,s,d))}))}_tileLoaded(s,d,g){s.timeAdded=M.now(),g==="expired"&&(s.refreshedUponExpiration=!0),this._setTileReloadTimer(d,s),this.getSource().type==="raster-dem"&&s.dem&&this._backfillDEM(s),this._state.initializeTileState(s,this.map?this.map.painter:null),s.aborted||this._source.fire(new o.l("data",{dataType:"source",tile:s,coord:s.tileID}))}_backfillDEM(s){const d=this.getRenderableIds();for(let v=0;v<d.length;v++){const w=d[v];if(s.neighboringTiles&&s.neighboringTiles[w]){const C=this.getTileByID(w);g(s,C),g(C,s)}}function g(v,w){v.needsHillshadePrepare=!0,v.needsTerrainPrepare=!0;let C=w.tileID.canonical.x-v.tileID.canonical.x;const B=w.tileID.canonical.y-v.tileID.canonical.y,O=Math.pow(2,v.tileID.canonical.z),F=w.tileID.key;C===0&&B===0||Math.abs(B)>1||(Math.abs(C)>1&&(Math.abs(C+O)===1?C+=O:Math.abs(C-O)===1&&(C-=O)),w.dem&&v.dem&&(v.dem.backfillBorder(w.dem,C,B),v.neighboringTiles&&v.neighboringTiles[F]&&(v.neighboringTiles[F].backfilled=!0)))}}getTile(s){return this.getTileByID(s.key)}getTileByID(s){return this._tiles[s]}_retainLoadedChildren(s,d,g,v){for(const w in this._tiles){let C=this._tiles[w];if(v[w]||!C.hasData()||C.tileID.overscaledZ<=d||C.tileID.overscaledZ>g)continue;let B=C.tileID;for(;C&&C.tileID.overscaledZ>d+1;){const F=C.tileID.scaledTo(C.tileID.overscaledZ-1);C=this._tiles[F.key],C&&C.hasData()&&(B=F)}let O=B;for(;O.overscaledZ>d;)if(O=O.scaledTo(O.overscaledZ-1),s[O.key]||s[O.canonical.key]){v[B.key]=B;break}}}findLoadedParent(s,d){if(s.key in this._loadedParentTiles){const g=this._loadedParentTiles[s.key];return g&&g.tileID.overscaledZ>=d?g:null}for(let g=s.overscaledZ-1;g>=d;g--){const v=s.scaledTo(g),w=this._getLoadedTile(v);if(w)return w}}findLoadedSibling(s){return this._getLoadedTile(s)}_getLoadedTile(s){const d=this._tiles[s.key];return d&&d.hasData()?d:this._cache.getByKey(s.wrapped().key)}updateCacheSize(s){const d=Math.ceil(s.width/this._source.tileSize)+1,g=Math.ceil(s.height/this._source.tileSize)+1,v=Math.floor(d*g*(this._maxTileCacheZoomLevels===null?o.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),w=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,v):v;this._cache.setMaxSize(w)}handleWrapJump(s){const d=Math.round((s-(this._prevLng===void 0?s:this._prevLng))/360);if(this._prevLng=s,d){const g={};for(const v in this._tiles){const w=this._tiles[v];w.tileID=w.tileID.unwrapTo(w.tileID.wrap+d),g[w.tileID.key]=w}this._tiles=g;for(const v in this._timers)clearTimeout(this._timers[v]),delete this._timers[v];for(const v in this._tiles)this._setTileReloadTimer(v,this._tiles[v])}}_updateCoveredAndRetainedTiles(s,d,g,v,w,C){const B={},O={},F=Object.keys(s),U=M.now();for(const K of F){const W=s[K],X=this._tiles[K];if(!X||X.fadeEndTime!==0&&X.fadeEndTime<=U)continue;const re=this.findLoadedParent(W,d),ue=this.findLoadedSibling(W),fe=re||ue||null;fe&&(this._addTile(fe.tileID),B[fe.tileID.key]=fe.tileID),O[K]=W}this._retainLoadedChildren(O,v,g,s);for(const K in B)s[K]||(this._coveredTiles[K]=!0,s[K]=B[K]);if(C){const K={},W={};for(const X of w)this._tiles[X.key].hasData()?K[X.key]=X:W[X.key]=X;for(const X in W){const re=W[X].children(this._source.maxzoom);this._tiles[re[0].key]&&this._tiles[re[1].key]&&this._tiles[re[2].key]&&this._tiles[re[3].key]&&(K[re[0].key]=s[re[0].key]=re[0],K[re[1].key]=s[re[1].key]=re[1],K[re[2].key]=s[re[2].key]=re[2],K[re[3].key]=s[re[3].key]=re[3],delete W[X])}for(const X in W){const re=W[X],ue=this.findLoadedParent(re,this._source.minzoom),fe=this.findLoadedSibling(re),pe=ue||fe||null;if(pe){K[pe.tileID.key]=s[pe.tileID.key]=pe.tileID;for(const _e in K)K[_e].isChildOf(pe.tileID)&&delete K[_e]}}for(const X in this._tiles)K[X]||(this._coveredTiles[X]=!0)}}update(s,d){if(!this._sourceLoaded||this._paused)return;let g;this.transform=s,this.terrain=d,this.updateCacheSize(s),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?g=s.getVisibleUnwrappedCoordinates(this._source.tileID).map((U=>new o.Z(U.canonical.z,U.wrap,U.canonical.z,U.canonical.x,U.canonical.y))):(g=Ne(s,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:d,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(g=g.filter((U=>this._source.hasTile(U))))):g=[];const v=Dt(s,this._source),w=Math.max(v-Rr.maxOverzooming,this._source.minzoom),C=Math.max(v+Rr.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const U={};for(const K of g)if(K.canonical.z>this._source.minzoom){const W=K.scaledTo(K.canonical.z-1);U[W.key]=W;const X=K.scaledTo(Math.max(this._source.minzoom,Math.min(K.canonical.z,5)));U[X.key]=X}g=g.concat(Object.values(U))}const B=g.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,B&&this.fire(new o.l("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const O=this._updateRetainedTiles(g,v);vr(this._source.type)&&this._updateCoveredAndRetainedTiles(O,w,C,v,g,d);for(const U in O)this._tiles[U].clearFadeHold();const F=o.am(this._tiles,O);for(const U of F){const K=this._tiles[U];K.hasSymbolBuckets&&!K.holdingForFade()?K.setHoldDuration(this.map._fadeDuration):K.hasSymbolBuckets&&!K.symbolFadeFinished()||this._removeTile(U)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const s in this._tiles)this._tiles[s].holdingForFade()&&this._removeTile(s)}_updateRetainedTiles(s,d){var g;const v={},w={},C=Math.max(d-Rr.maxOverzooming,this._source.minzoom),B=Math.max(d+Rr.maxUnderzooming,this._source.minzoom),O={};for(const F of s){const U=this._addTile(F);v[F.key]=F,U.hasData()||d<this._source.maxzoom&&(O[F.key]=F)}this._retainLoadedChildren(O,d,B,v);for(const F of s){let U=this._tiles[F.key];if(U.hasData())continue;if(d+1>this._source.maxzoom){const W=F.children(this._source.maxzoom)[0],X=this.getTile(W);if(X&&X.hasData()){v[W.key]=W;continue}}else{const W=F.children(this._source.maxzoom);if(v[W[0].key]&&v[W[1].key]&&v[W[2].key]&&v[W[3].key])continue}let K=U.wasRequested();for(let W=F.overscaledZ-1;W>=C;--W){const X=F.scaledTo(W);if(w[X.key])break;if(w[X.key]=!0,U=this.getTile(X),!U&&K&&(U=this._addTile(X)),U){const re=U.hasData();if((re||!(!((g=this.map)===null||g===void 0)&&g.cancelPendingTileRequestsWhileZooming)||K)&&(v[X.key]=X),K=U.wasRequested(),re)break}}}return v}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const s in this._tiles){const d=[];let g,v=this._tiles[s].tileID;for(;v.overscaledZ>0;){if(v.key in this._loadedParentTiles){g=this._loadedParentTiles[v.key];break}d.push(v.key);const w=v.scaledTo(v.overscaledZ-1);if(g=this._getLoadedTile(w),g)break;v=w}for(const w of d)this._loadedParentTiles[w]=g}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const s in this._tiles){const d=this._tiles[s].tileID,g=this._getLoadedTile(d);this._loadedSiblingTiles[d.key]=g}}_addTile(s){let d=this._tiles[s.key];if(d)return d;d=this._cache.getAndRemove(s),d&&(this._setTileReloadTimer(s.key,d),d.tileID=s,this._state.initializeTileState(d,this.map?this.map.painter:null),this._cacheTimers[s.key]&&(clearTimeout(this._cacheTimers[s.key]),delete this._cacheTimers[s.key],this._setTileReloadTimer(s.key,d)));const g=d;return d||(d=new co(s,this._source.tileSize*s.overscaleFactor()),this._loadTile(d,s.key,d.state)),d.uses++,this._tiles[s.key]=d,g||this._source.fire(new o.l("dataloading",{tile:d,coord:d.tileID,dataType:"source"})),d}_setTileReloadTimer(s,d){s in this._timers&&(clearTimeout(this._timers[s]),delete this._timers[s]);const g=d.getExpiryTimeout();g&&(this._timers[s]=setTimeout((()=>{this._reloadTile(s,"expired"),delete this._timers[s]}),g))}refreshTiles(s){for(const d in this._tiles)(this._isIdRenderable(d)||this._tiles[d].state=="errored")&&s.some((g=>g.equals(this._tiles[d].tileID.canonical)))&&this._reloadTile(d,"expired")}_removeTile(s){const d=this._tiles[s];d&&(d.uses--,delete this._tiles[s],this._timers[s]&&(clearTimeout(this._timers[s]),delete this._timers[s]),d.uses>0||(d.hasData()&&d.state!=="reloading"?this._cache.add(d.tileID,d,d.getExpiryTimeout()):(d.aborted=!0,this._abortTile(d),this._unloadTile(d))))}_dataHandler(s){const d=s.sourceDataType;s.dataType==="source"&&d==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&s.dataType==="source"&&d==="content"&&(this.reload(s.sourceDataChanged),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const s in this._tiles)this._removeTile(s);this._cache.reset()}tilesIn(s,d,g){const v=[],w=this.transform;if(!w)return v;const C=w.getCoveringTilesDetailsProvider().allowWorldCopies(),B=g?w.getCameraQueryGeometry(s):s,O=X=>w.screenPointToMercatorCoordinate(X,this.terrain),F=this.transformBbox(s,O,!C),U=this.transformBbox(B,O,!C),K=this.getIds(),W=o.a2.fromPoints(U);for(let X=0;X<K.length;X++){const re=this._tiles[K[X]];if(re.holdingForFade())continue;const ue=C?[re.tileID]:[re.tileID.unwrapTo(-1),re.tileID.unwrapTo(0)],fe=Math.pow(2,w.zoom-re.tileID.overscaledZ),pe=d*re.queryPadding*o.$/re.tileSize/fe;for(const _e of ue){const we=W.map((ye=>_e.getTilePoint(new o.a1(ye.x,ye.y))));if(we.expandBy(pe),we.intersects(ar)){const ye=F.map((Ie=>_e.getTilePoint(Ie))),Te=U.map((Ie=>_e.getTilePoint(Ie)));v.push({tile:re,tileID:C?_e:_e.unwrapTo(0),queryGeometry:ye,cameraQueryGeometry:Te,scale:fe})}}}return v}transformBbox(s,d,g){let v=s.map(d);if(g){const w=o.a2.fromPoints(s);w.shrinkBy(.001*Math.min(w.width(),w.height()));const C=w.map(d);o.a2.fromPoints(v).covers(C)||(v=v.map((B=>B.x>.5?new o.a1(B.x-1,B.y,B.z):B)))}return v}getVisibleCoordinates(s){const d=this.getRenderableIds(s).map((g=>this._tiles[g].tileID));return this.transform&&this.transform.populateCache(d),d}hasTransition(){if(this._source.hasTransition())return!0;if(vr(this._source.type)){const s=M.now();for(const d in this._tiles)if(this._tiles[d].fadeEndTime>=s)return!0}return!1}setFeatureState(s,d,g){this._state.updateState(s=s||"_geojsonTileLayer",d,g)}removeFeatureState(s,d,g){this._state.removeFeatureState(s=s||"_geojsonTileLayer",d,g)}getFeatureState(s,d){return this._state.getState(s=s||"_geojsonTileLayer",d)}setDependencies(s,d,g){const v=this._tiles[s];v&&v.setDependencies(d,g)}reloadTilesForDependencies(s,d){for(const g in this._tiles)this._tiles[g].hasDependency(s,d)&&this._reloadTile(g,"reloading");this._cache.filter((g=>!g.hasDependency(s,d)))}}function Wt(x,s){const d=Math.abs(2*x.wrap)-+(x.wrap<0),g=Math.abs(2*s.wrap)-+(s.wrap<0);return x.overscaledZ-s.overscaledZ||g-d||s.canonical.y-x.canonical.y||s.canonical.x-x.canonical.x}function vr(x){return x==="raster"||x==="image"||x==="video"}Rr.maxOverzooming=10,Rr.maxUnderzooming=3;class Xr{constructor(s,d){this.reset(s,d)}reset(s,d){this.points=s||[],this._distances=[0];for(let g=1;g<this.points.length;g++)this._distances[g]=this._distances[g-1]+this.points[g].dist(this.points[g-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(d||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(s){if(this.points.length===1)return this.points[0];s=o.ah(s,0,1);let d=1,g=this._distances[d];const v=s*this.paddedLength+this.padding;for(;g<v&&d<this._distances.length;)g=this._distances[++d];const w=d-1,C=this._distances[w],B=g-C,O=B>0?(v-C)/B:0;return this.points[w].mult(1-O).add(this.points[d].mult(O))}}function Ii(x,s){let d=!0;return x==="always"||x!=="never"&&s!=="never"||(d=!1),d}class ji{constructor(s,d,g){const v=this.boxCells=[],w=this.circleCells=[];this.xCellCount=Math.ceil(s/g),this.yCellCount=Math.ceil(d/g);for(let C=0;C<this.xCellCount*this.yCellCount;C++)v.push([]),w.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=s,this.height=d,this.xScale=this.xCellCount/s,this.yScale=this.yCellCount/d,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(s,d,g,v,w){this._forEachCell(d,g,v,w,this._insertBoxCell,this.boxUid++),this.boxKeys.push(s),this.bboxes.push(d),this.bboxes.push(g),this.bboxes.push(v),this.bboxes.push(w)}insertCircle(s,d,g,v){this._forEachCell(d-v,g-v,d+v,g+v,this._insertCircleCell,this.circleUid++),this.circleKeys.push(s),this.circles.push(d),this.circles.push(g),this.circles.push(v)}_insertBoxCell(s,d,g,v,w,C){this.boxCells[w].push(C)}_insertCircleCell(s,d,g,v,w,C){this.circleCells[w].push(C)}_query(s,d,g,v,w,C,B){if(g<0||s>this.width||v<0||d>this.height)return[];const O=[];if(s<=0&&d<=0&&this.width<=g&&this.height<=v){if(w)return[{key:null,x1:s,y1:d,x2:g,y2:v}];for(let F=0;F<this.boxKeys.length;F++)O.push({key:this.boxKeys[F],x1:this.bboxes[4*F],y1:this.bboxes[4*F+1],x2:this.bboxes[4*F+2],y2:this.bboxes[4*F+3]});for(let F=0;F<this.circleKeys.length;F++){const U=this.circles[3*F],K=this.circles[3*F+1],W=this.circles[3*F+2];O.push({key:this.circleKeys[F],x1:U-W,y1:K-W,x2:U+W,y2:K+W})}}else this._forEachCell(s,d,g,v,this._queryCell,O,{hitTest:w,overlapMode:C,seenUids:{box:{},circle:{}}},B);return O}query(s,d,g,v){return this._query(s,d,g,v,!1,null)}hitTest(s,d,g,v,w,C){return this._query(s,d,g,v,!0,w,C).length>0}hitTestCircle(s,d,g,v,w){const C=s-g,B=s+g,O=d-g,F=d+g;if(B<0||C>this.width||F<0||O>this.height)return!1;const U=[];return this._forEachCell(C,O,B,F,this._queryCellCircle,U,{hitTest:!0,overlapMode:v,circle:{x:s,y:d,radius:g},seenUids:{box:{},circle:{}}},w),U.length>0}_queryCell(s,d,g,v,w,C,B,O){const{seenUids:F,hitTest:U,overlapMode:K}=B,W=this.boxCells[w];if(W!==null){const re=this.bboxes;for(const ue of W)if(!F.box[ue]){F.box[ue]=!0;const fe=4*ue,pe=this.boxKeys[ue];if(s<=re[fe+2]&&d<=re[fe+3]&&g>=re[fe+0]&&v>=re[fe+1]&&(!O||O(pe))&&(!U||!Ii(K,pe.overlapMode))&&(C.push({key:pe,x1:re[fe],y1:re[fe+1],x2:re[fe+2],y2:re[fe+3]}),U))return!0}}const X=this.circleCells[w];if(X!==null){const re=this.circles;for(const ue of X)if(!F.circle[ue]){F.circle[ue]=!0;const fe=3*ue,pe=this.circleKeys[ue];if(this._circleAndRectCollide(re[fe],re[fe+1],re[fe+2],s,d,g,v)&&(!O||O(pe))&&(!U||!Ii(K,pe.overlapMode))){const _e=re[fe],we=re[fe+1],ye=re[fe+2];if(C.push({key:pe,x1:_e-ye,y1:we-ye,x2:_e+ye,y2:we+ye}),U)return!0}}}return!1}_queryCellCircle(s,d,g,v,w,C,B,O){const{circle:F,seenUids:U,overlapMode:K}=B,W=this.boxCells[w];if(W!==null){const re=this.bboxes;for(const ue of W)if(!U.box[ue]){U.box[ue]=!0;const fe=4*ue,pe=this.boxKeys[ue];if(this._circleAndRectCollide(F.x,F.y,F.radius,re[fe+0],re[fe+1],re[fe+2],re[fe+3])&&(!O||O(pe))&&!Ii(K,pe.overlapMode))return C.push(!0),!0}}const X=this.circleCells[w];if(X!==null){const re=this.circles;for(const ue of X)if(!U.circle[ue]){U.circle[ue]=!0;const fe=3*ue,pe=this.circleKeys[ue];if(this._circlesCollide(re[fe],re[fe+1],re[fe+2],F.x,F.y,F.radius)&&(!O||O(pe))&&!Ii(K,pe.overlapMode))return C.push(!0),!0}}}_forEachCell(s,d,g,v,w,C,B,O){const F=this._convertToXCellCoord(s),U=this._convertToYCellCoord(d),K=this._convertToXCellCoord(g),W=this._convertToYCellCoord(v);for(let X=F;X<=K;X++)for(let re=U;re<=W;re++)if(w.call(this,s,d,g,v,this.xCellCount*re+X,C,B,O))return}_convertToXCellCoord(s){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(s*this.xScale)))}_convertToYCellCoord(s){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(s*this.yScale)))}_circlesCollide(s,d,g,v,w,C){const B=v-s,O=w-d,F=g+C;return F*F>B*B+O*O}_circleAndRectCollide(s,d,g,v,w,C,B){const O=(C-v)/2,F=Math.abs(s-(v+O));if(F>O+g)return!1;const U=(B-w)/2,K=Math.abs(d-(w+U));if(K>U+g)return!1;if(F<=O||K<=U)return!0;const W=F-O,X=K-U;return W*W+X*X<=g*g}}function fi(x,s,d){const g=o.L();if(!x){const{vecSouth:K,vecEast:W}=kr(s),X=b();X[0]=W[0],X[1]=W[1],X[2]=K[0],X[3]=K[1],v=X,(U=(C=(w=X)[0])*(F=w[3])-(O=w[2])*(B=w[1]))&&(v[0]=F*(U=1/U),v[1]=-B*U,v[2]=-O*U,v[3]=C*U),g[0]=X[0],g[1]=X[1],g[4]=X[2],g[5]=X[3]}var v,w,C,B,O,F,U;return o.N(g,g,[1/d,1/d,1]),g}function Tr(x,s,d,g){if(x){const v=o.L();if(!s){const{vecSouth:w,vecEast:C}=kr(d);v[0]=C[0],v[1]=C[1],v[4]=w[0],v[5]=w[1]}return o.N(v,v,[g,g,1]),v}return d.pixelsToClipSpaceMatrix}function kr(x){const s=Math.cos(x.rollInRadians),d=Math.sin(x.rollInRadians),g=Math.cos(x.pitchInRadians),v=Math.cos(x.bearingInRadians),w=Math.sin(x.bearingInRadians),C=o.ar();C[0]=-v*g*d-w*s,C[1]=-w*g*d+v*s;const B=o.as(C);B<1e-9?o.at(C):o.au(C,C,1/B);const O=o.ar();O[0]=v*g*s-w*d,O[1]=w*g*s+v*d;const F=o.as(O);return F<1e-9?o.at(O):o.au(O,O,1/F),{vecEast:O,vecSouth:C}}function Ui(x,s,d,g){let v;g?(v=[x,s,g(x,s),1],o.aw(v,v,d)):(v=[x,s,0,1],sl(v,v,d));const w=v[3];return{point:new o.P(v[0]/w,v[1]/w),signedDistanceFromCamera:w,isOccluded:!1}}function yt(x,s){return .5+x/s*.5}function ki(x,s){return x.x>=-s[0]&&x.x<=s[0]&&x.y>=-s[1]&&x.y<=s[1]}function li(x,s,d,g,v,w,C,B,O,F,U,K,W){const X=d?x.textSizeData:x.iconSizeData,re=o.an(X,s.transform.zoom),ue=[256/s.width*2+1,256/s.height*2+1],fe=d?x.text.dynamicLayoutVertexArray:x.icon.dynamicLayoutVertexArray;fe.clear();const pe=x.lineVertexArray,_e=d?x.text.placedSymbolArray:x.icon.placedSymbolArray,we=s.transform.width/s.transform.height;let ye=!1;for(let Te=0;Te<_e.length;Te++){const Ie=_e.get(Te);if(Ie.hidden||Ie.writingMode===o.ao.vertical&&!ye){ho(Ie.numGlyphs,fe);continue}ye=!1;const be=new o.P(Ie.anchorX,Ie.anchorY),ke={getElevation:W,pitchedLabelPlaneMatrix:g,lineVertexArray:pe,pitchWithMap:w,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:s.transform,tileAnchorPoint:be,unwrappedTileID:O,width:F,height:U,translation:K},Xe=Wn(Ie.anchorX,Ie.anchorY,ke);if(!ki(Xe.point,ue)){ho(Ie.numGlyphs,fe);continue}const qe=yt(s.transform.cameraToCenterDistance,Xe.signedDistanceFromCamera),Ze=o.ap(X,re,Ie),tt=w?Ze*s.transform.getPitchedTextCorrection(Ie.anchorX,Ie.anchorY,O)/qe:Ze*qe,bt=St({projectionContext:ke,pitchedLabelPlaneMatrixInverse:v,symbol:Ie,fontSize:tt,flip:!1,keepUpright:C,glyphOffsetArray:x.glyphOffsetArray,dynamicLayoutVertexArray:fe,aspectRatio:we,rotateToLine:B});ye=bt.useVertical,(bt.notEnoughRoom||ye||bt.needsFlipping&&St({projectionContext:ke,pitchedLabelPlaneMatrixInverse:v,symbol:Ie,fontSize:tt,flip:!0,keepUpright:C,glyphOffsetArray:x.glyphOffsetArray,dynamicLayoutVertexArray:fe,aspectRatio:we,rotateToLine:B}).notEnoughRoom)&&ho(Ie.numGlyphs,fe)}d?x.text.dynamicLayoutVertexBuffer.updateData(fe):x.icon.dynamicLayoutVertexBuffer.updateData(fe)}function Hs(x,s,d,g,v,w,C,B){const O=w.glyphStartIndex+w.numGlyphs,F=w.lineStartIndex,U=w.lineStartIndex+w.lineLength,K=s.getoffsetX(w.glyphStartIndex),W=s.getoffsetX(O-1),X=Rs(x*K,d,g,v,w.segment,F,U,B,C);if(!X)return null;const re=Rs(x*W,d,g,v,w.segment,F,U,B,C);return re?B.projectionCache.anyProjectionOccluded?null:{first:X,last:re}:null}function nl(x,s,d,g){return x===o.ao.horizontal&&Math.abs(d.y-s.y)>Math.abs(d.x-s.x)*g?{useVertical:!0}:(x===o.ao.vertical?s.y<d.y:s.x>d.x)?{needsFlipping:!0}:null}function St(x){const{projectionContext:s,pitchedLabelPlaneMatrixInverse:d,symbol:g,fontSize:v,flip:w,keepUpright:C,glyphOffsetArray:B,dynamicLayoutVertexArray:O,aspectRatio:F,rotateToLine:U}=x,K=v/24,W=g.lineOffsetX*K,X=g.lineOffsetY*K;let re;if(g.numGlyphs>1){const ue=g.glyphStartIndex+g.numGlyphs,fe=g.lineStartIndex,pe=g.lineStartIndex+g.lineLength,_e=Hs(K,B,W,X,w,g,U,s);if(!_e)return{notEnoughRoom:!0};const we=uo(_e.first.point.x,_e.first.point.y,s,d),ye=uo(_e.last.point.x,_e.last.point.y,s,d);if(C&&!w){const Te=nl(g.writingMode,we,ye,F);if(Te)return Te}re=[_e.first];for(let Te=g.glyphStartIndex+1;Te<ue-1;Te++){const Ie=Rs(K*B.getoffsetX(Te),W,X,w,g.segment,fe,pe,s,U);if(!Ie)return{notEnoughRoom:!0};re.push(Ie)}re.push(_e.last)}else{if(C&&!w){const fe=Ki(s.tileAnchorPoint.x,s.tileAnchorPoint.y,s).point,pe=g.lineStartIndex+g.segment+1,_e=new o.P(s.lineVertexArray.getx(pe),s.lineVertexArray.gety(pe)),we=Ki(_e.x,_e.y,s),ye=we.signedDistanceFromCamera>0?we.point:Mr(s.tileAnchorPoint,_e,fe,1,s),Te=uo(fe.x,fe.y,s,d),Ie=uo(ye.x,ye.y,s,d),be=nl(g.writingMode,Te,Ie,F);if(be)return be}const ue=Rs(K*B.getoffsetX(g.glyphStartIndex),W,X,w,g.segment,g.lineStartIndex,g.lineStartIndex+g.lineLength,s,U);if(!ue||s.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};re=[ue]}for(const ue of re)o.av(O,ue.point,ue.angle);return{}}function Mr(x,s,d,g,v){const w=x.add(x.sub(s)._unit()),C=Ki(w.x,w.y,v).point,B=d.sub(C);return d.add(B._mult(g/B.mag()))}function hr(x,s,d){const g=s.projectionCache;if(g.projections[x])return g.projections[x];const v=new o.P(s.lineVertexArray.getx(x),s.lineVertexArray.gety(x)),w=Ki(v.x,v.y,s);if(w.signedDistanceFromCamera>0)return g.projections[x]=w.point,g.anyProjectionOccluded=g.anyProjectionOccluded||w.isOccluded,w.point;const C=x-d.direction;return Mr(d.distanceFromAnchor===0?s.tileAnchorPoint:new o.P(s.lineVertexArray.getx(C),s.lineVertexArray.gety(C)),v,d.previousVertex,d.absOffsetX-d.distanceFromAnchor+1,s)}function Ki(x,s,d){const g=x+d.translation[0],v=s+d.translation[1];let w;return d.pitchWithMap?(w=Ui(g,v,d.pitchedLabelPlaneMatrix,d.getElevation),w.isOccluded=!1):(w=d.transform.projectTileCoordinates(g,v,d.unwrappedTileID,d.getElevation),w.point.x=(.5*w.point.x+.5)*d.width,w.point.y=(.5*-w.point.y+.5)*d.height),w}function uo(x,s,d,g){if(d.pitchWithMap){const v=[x,s,0,1];return o.aw(v,v,g),d.transform.projectTileCoordinates(v[0]/v[3],v[1]/v[3],d.unwrappedTileID,d.getElevation).point}return{x:x/d.width*2-1,y:1-s/d.height*2}}function Wn(x,s,d){return d.transform.projectTileCoordinates(x,s,d.unwrappedTileID,d.getElevation)}function fr(x,s,d){return x._unit()._perp()._mult(s*d)}function Io(x,s,d,g,v,w,C,B,O){if(B.projectionCache.offsets[x])return B.projectionCache.offsets[x];const F=d.add(s);if(x+O.direction<g||x+O.direction>=v)return B.projectionCache.offsets[x]=F,F;const U=hr(x+O.direction,B,O),K=fr(U.sub(d),C,O.direction),W=d.add(K),X=U.add(K);return B.projectionCache.offsets[x]=o.ax(w,F,W,X)||F,B.projectionCache.offsets[x]}function Rs(x,s,d,g,v,w,C,B,O){const F=g?x-s:x+s;let U=F>0?1:-1,K=0;g&&(U*=-1,K=Math.PI),U<0&&(K+=Math.PI);let W,X=U>0?w+v:w+v+1;B.projectionCache.cachedAnchorPoint?W=B.projectionCache.cachedAnchorPoint:(W=Ki(B.tileAnchorPoint.x,B.tileAnchorPoint.y,B).point,B.projectionCache.cachedAnchorPoint=W);let re,ue,fe=W,pe=W,_e=0,we=0;const ye=Math.abs(F),Te=[];let Ie;for(;_e+we<=ye;){if(X+=U,X<w||X>=C)return null;_e+=we,pe=fe,ue=re;const Xe={absOffsetX:ye,direction:U,distanceFromAnchor:_e,previousVertex:pe};if(fe=hr(X,B,Xe),d===0)Te.push(pe),Ie=fe.sub(pe);else{let qe;const Ze=fe.sub(pe);qe=Ze.mag()===0?fr(hr(X+U,B,Xe).sub(fe),d,U):fr(Ze,d,U),ue||(ue=pe.add(qe)),re=Io(X,qe,fe,w,C,ue,d,B,Xe),Te.push(ue),Ie=re.sub(ue)}we=Ie.mag()}const be=Ie._mult((ye-_e)/we)._add(ue||pe),ke=K+Math.atan2(fe.y-pe.y,fe.x-pe.x);return Te.push(be),{point:be,angle:O?ke:0,path:Te}}const wa=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function ho(x,s){for(let d=0;d<x;d++){const g=s.length;s.resize(g+4),s.float32.set(wa,3*g)}}function sl(x,s,d){const g=s[0],v=s[1];return x[0]=d[0]*g+d[4]*v+d[12],x[1]=d[1]*g+d[5]*v+d[13],x[3]=d[3]*g+d[7]*v+d[15],x}const wr=100;class On{constructor(s,d=new ji(s.width+200,s.height+200,25),g=new ji(s.width+200,s.height+200,25)){this.transform=s,this.grid=d,this.ignoredGrid=g,this.pitchFactor=Math.cos(s.pitch*Math.PI/180)*s.cameraToCenterDistance,this.screenRightBoundary=s.width+wr,this.screenBottomBoundary=s.height+wr,this.gridRightBoundary=s.width+200,this.gridBottomBoundary=s.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(s,d,g,v,w,C,B,O,F,U,K,W){const X=this.projectAndGetPerspectiveRatio(s.anchorPointX+O[0],s.anchorPointY+O[1],w,U,W),re=g*X.perspectiveRatio;let ue;if(C||B)ue=this._projectCollisionBox(s,re,v,w,C,B,O,X,U,K,W);else{const Ie=X.x+(K?K.x*re:0),be=X.y+(K?K.y*re:0);ue={allPointsOccluded:!1,box:[Ie+s.x1*re,be+s.y1*re,Ie+s.x2*re,be+s.y2*re]}}const[fe,pe,_e,we]=ue.box,ye=C?ue.allPointsOccluded:X.isOccluded;let Te=ye;return Te||(Te=X.perspectiveRatio<this.perspectiveRatioCutoff),Te||(Te=!this.isInsideGrid(fe,pe,_e,we)),Te||d!=="always"&&this.grid.hitTest(fe,pe,_e,we,d,F)?{box:[fe,pe,_e,we],placeable:!1,offscreen:!1,occluded:ye}:{box:[fe,pe,_e,we],placeable:!0,offscreen:this.isOffscreen(fe,pe,_e,we),occluded:ye}}placeCollisionCircles(s,d,g,v,w,C,B,O,F,U,K,W,X,re){const ue=[],fe=new o.P(d.anchorX,d.anchorY),pe=this.getPerspectiveRatio(fe.x,fe.y,C,re),_e=(F?w*this.transform.getPitchedTextCorrection(d.anchorX,d.anchorY,C)/pe:w*pe)/o.aB,we={getElevation:re,pitchedLabelPlaneMatrix:B,lineVertexArray:g,pitchWithMap:F,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:fe,unwrappedTileID:C,width:this.transform.width,height:this.transform.height,translation:X},ye=Hs(_e,v,d.lineOffsetX*_e,d.lineOffsetY*_e,!1,d,!1,we);let Te=!1,Ie=!1,be=!0;if(ye){const ke=.5*K*pe+W,Xe=new o.P(-100,-100),qe=new o.P(this.screenRightBoundary,this.screenBottomBoundary),Ze=new Xr,tt=ye.first,bt=ye.last;let wt=[];for(let Sr=tt.path.length-1;Sr>=1;Sr--)wt.push(tt.path[Sr]);for(let Sr=1;Sr<bt.path.length;Sr++)wt.push(bt.path[Sr]);const ut=2.5*ke;if(F){const Sr=this.projectPathToScreenSpace(wt,we);wt=Sr.some((Gr=>Gr.signedDistanceFromCamera<=0))?[]:Sr.map((Gr=>Gr.point))}let jt=[];if(wt.length>0){const Sr=wt[0].clone(),Gr=wt[0].clone();for(let ii=1;ii<wt.length;ii++)Sr.x=Math.min(Sr.x,wt[ii].x),Sr.y=Math.min(Sr.y,wt[ii].y),Gr.x=Math.max(Gr.x,wt[ii].x),Gr.y=Math.max(Gr.y,wt[ii].y);jt=Sr.x>=Xe.x&&Gr.x<=qe.x&&Sr.y>=Xe.y&&Gr.y<=qe.y?[wt]:Gr.x<Xe.x||Sr.x>qe.x||Gr.y<Xe.y||Sr.y>qe.y?[]:o.ay([wt],Xe.x,Xe.y,qe.x,qe.y)}for(const Sr of jt){Ze.reset(Sr,.25*ke);let Gr=0;Gr=Ze.length<=.5*ke?1:Math.ceil(Ze.paddedLength/ut)+1;for(let ii=0;ii<Gr;ii++){const Jr=ii/Math.max(Gr-1,1),ui=Ze.lerp(Jr),Si=ui.x+wr,br=ui.y+wr;ue.push(Si,br,ke,0);const qr=Si-ke,Ji=br-ke,on=Si+ke,_n=br+ke;if(be=be&&this.isOffscreen(qr,Ji,on,_n),Ie=Ie||this.isInsideGrid(qr,Ji,on,_n),s!=="always"&&this.grid.hitTestCircle(Si,br,ke,s,U)&&(Te=!0,!O))return{circles:[],offscreen:!1,collisionDetected:Te}}}}return{circles:!O&&Te||!Ie||pe<this.perspectiveRatioCutoff?[]:ue,offscreen:be,collisionDetected:Te}}projectPathToScreenSpace(s,d){const g=(function(v,w){const C=o.L();return o.aq(C,w.pitchedLabelPlaneMatrix),v.map((B=>{const O=Ui(B.x,B.y,C,w.getElevation),F=w.transform.projectTileCoordinates(O.point.x,O.point.y,w.unwrappedTileID,w.getElevation);return F.point.x=(.5*F.point.x+.5)*w.width,F.point.y=(.5*-F.point.y+.5)*w.height,F}))})(s,d);return(function(v){let w=0,C=0,B=0,O=0;for(let F=0;F<v.length;F++)v[F].isOccluded?(B=F+1,O=0):(O++,O>C&&(C=O,w=B));return v.slice(w,w+C)})(g)}queryRenderedSymbols(s){if(s.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const d=[],g=new o.a2;for(const K of s){const W=new o.P(K.x+wr,K.y+wr);g.extend(W),d.push(W)}const{minX:v,minY:w,maxX:C,maxY:B}=g,O=this.grid.query(v,w,C,B).concat(this.ignoredGrid.query(v,w,C,B)),F={},U={};for(const K of O){const W=K.key;if(F[W.bucketInstanceId]===void 0&&(F[W.bucketInstanceId]={}),F[W.bucketInstanceId][W.featureIndex])continue;const X=[new o.P(K.x1,K.y1),new o.P(K.x2,K.y1),new o.P(K.x2,K.y2),new o.P(K.x1,K.y2)];o.az(d,X)&&(F[W.bucketInstanceId][W.featureIndex]=!0,U[W.bucketInstanceId]===void 0&&(U[W.bucketInstanceId]=[]),U[W.bucketInstanceId].push(W.featureIndex))}return U}insertCollisionBox(s,d,g,v,w,C){(g?this.ignoredGrid:this.grid).insert({bucketInstanceId:v,featureIndex:w,collisionGroupID:C,overlapMode:d},s[0],s[1],s[2],s[3])}insertCollisionCircles(s,d,g,v,w,C){const B=g?this.ignoredGrid:this.grid,O={bucketInstanceId:v,featureIndex:w,collisionGroupID:C,overlapMode:d};for(let F=0;F<s.length;F+=4)B.insertCircle(O,s[F],s[F+1],s[F+2])}projectAndGetPerspectiveRatio(s,d,g,v,w){if(w){let C;v?(C=[s,d,v(s,d),1],o.aw(C,C,w)):(C=[s,d,0,1],sl(C,C,w));const B=C[3];return{x:(C[0]/B+1)/2*this.transform.width+wr,y:(-C[1]/B+1)/2*this.transform.height+wr,perspectiveRatio:.5+this.transform.cameraToCenterDistance/B*.5,isOccluded:!1,signedDistanceFromCamera:B}}{const C=this.transform.projectTileCoordinates(s,d,g,v);return{x:(C.point.x+1)/2*this.transform.width+wr,y:(1-C.point.y)/2*this.transform.height+wr,perspectiveRatio:.5+this.transform.cameraToCenterDistance/C.signedDistanceFromCamera*.5,isOccluded:C.isOccluded,signedDistanceFromCamera:C.signedDistanceFromCamera}}}getPerspectiveRatio(s,d,g,v){const w=this.transform.projectTileCoordinates(s,d,g,v);return .5+this.transform.cameraToCenterDistance/w.signedDistanceFromCamera*.5}isOffscreen(s,d,g,v){return g<wr||s>=this.screenRightBoundary||v<wr||d>this.screenBottomBoundary}isInsideGrid(s,d,g,v){return g>=0&&s<this.gridRightBoundary&&v>=0&&d<this.gridBottomBoundary}getViewportMatrix(){const s=o.ag([]);return o.M(s,s,[-100,-100,0]),s}_projectCollisionBox(s,d,g,v,w,C,B,O,F,U,K){let W=1,X=0,re=0,ue=1;const fe=s.anchorPointX+B[0],pe=s.anchorPointY+B[1];if(C&&!w){const wt=this.projectAndGetPerspectiveRatio(fe+1,pe,v,F,K),ut=wt.x-O.x,jt=Math.atan((wt.y-O.y)/ut)+(ut<0?Math.PI:0),Sr=Math.sin(jt),Gr=Math.cos(jt);W=Gr,X=Sr,re=-Sr,ue=Gr}else if(!C&&w){const wt=kr(this.transform);W=wt.vecEast[0],X=wt.vecEast[1],re=wt.vecSouth[0],ue=wt.vecSouth[1]}let _e=O.x,we=O.y,ye=d;w&&(_e=fe,we=pe,ye=Math.pow(2,-(this.transform.zoom-g.overscaledZ)),ye*=this.transform.getPitchedTextCorrection(fe,pe,v),U||(ye*=o.ah(.5+O.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),U&&(_e+=W*U.x*ye+re*U.y*ye,we+=X*U.x*ye+ue*U.y*ye);const Te=s.x1*ye,Ie=s.x2*ye,be=(Te+Ie)/2,ke=s.y1*ye,Xe=s.y2*ye,qe=(ke+Xe)/2,Ze=[{offsetX:Te,offsetY:ke},{offsetX:be,offsetY:ke},{offsetX:Ie,offsetY:ke},{offsetX:Ie,offsetY:qe},{offsetX:Ie,offsetY:Xe},{offsetX:be,offsetY:Xe},{offsetX:Te,offsetY:Xe},{offsetX:Te,offsetY:qe}];let tt=[];for(const{offsetX:wt,offsetY:ut}of Ze)tt.push(new o.P(_e+W*wt+re*ut,we+X*wt+ue*ut));let bt=!1;if(w){const wt=tt.map((ut=>this.projectAndGetPerspectiveRatio(ut.x,ut.y,v,F,K)));bt=wt.some((ut=>!ut.isOccluded)),tt=wt.map((ut=>new o.P(ut.x,ut.y)))}else bt=!0;return{box:o.aA(tt),allPointsOccluded:!bt}}}class Bi{constructor(s,d,g,v){this.opacity=s?Math.max(0,Math.min(1,s.opacity+(s.placed?d:-d))):v&&g?1:0,this.placed=g}isHidden(){return this.opacity===0&&!this.placed}}class Fr{constructor(s,d,g,v,w){this.text=new Bi(s?s.text:null,d,g,w),this.icon=new Bi(s?s.icon:null,d,v,w)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class os{constructor(s,d,g){this.text=s,this.icon=d,this.skipFade=g}}class ko{constructor(s,d,g,v,w){this.bucketInstanceId=s,this.featureIndex=d,this.sourceLayerIndex=g,this.bucketIndex=v,this.tileID=w}}class as{constructor(s){this.crossSourceCollisions=s,this.maxGroupID=0,this.collisionGroups={}}get(s){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[s]){const d=++this.maxGroupID;this.collisionGroups[s]={ID:d,predicate:g=>g.collisionGroupID===d}}return this.collisionGroups[s]}}function Zi(x,s,d,g,v){const{horizontalAlign:w,verticalAlign:C}=o.aH(x);return new o.P(-(w-.5)*s+g[0]*v,-(C-.5)*d+g[1]*v)}class sn{constructor(s,d,g,v,w){this.transform=s.clone(),this.terrain=d,this.collisionIndex=new On(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=g,this.retainedQueryData={},this.collisionGroups=new as(v),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=w,w&&(w.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(s){const d=this.terrain;return d?(g,v)=>d.getElevation(s,g,v):null}getBucketParts(s,d,g,v){const w=g.getBucket(d),C=g.latestFeatureIndex;if(!w||!C||d.id!==w.layerIds[0])return;const B=g.collisionBoxArray,O=w.layers[0].layout,F=w.layers[0].paint,U=Math.pow(2,this.transform.zoom-g.tileID.overscaledZ),K=g.tileSize/o.$,W=g.tileID.toUnwrapped(),X=O.get("text-rotation-alignment")==="map",re=o.aC(g,1,this.transform.zoom),ue=o.aD(this.collisionIndex.transform,g,F.get("text-translate"),F.get("text-translate-anchor")),fe=o.aD(this.collisionIndex.transform,g,F.get("icon-translate"),F.get("icon-translate-anchor")),pe=fi(X,this.transform,re);this.retainedQueryData[w.bucketInstanceId]=new ko(w.bucketInstanceId,C,w.sourceLayerIndex,w.index,g.tileID);const _e={bucket:w,layout:O,translationText:ue,translationIcon:fe,unwrappedTileID:W,pitchedLabelPlaneMatrix:pe,scale:U,textPixelRatio:K,holdingForFade:g.holdingForFade(),collisionBoxArray:B,partiallyEvaluatedTextSize:o.an(w.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(w.sourceID)};if(v)for(const we of w.sortKeyRanges){const{sortKey:ye,symbolInstanceStart:Te,symbolInstanceEnd:Ie}=we;s.push({sortKey:ye,symbolInstanceStart:Te,symbolInstanceEnd:Ie,parameters:_e})}else s.push({symbolInstanceStart:0,symbolInstanceEnd:w.symbolInstances.length,parameters:_e})}attemptAnchorPlacement(s,d,g,v,w,C,B,O,F,U,K,W,X,re,ue,fe,pe,_e,we,ye){const Te=o.aE[s.textAnchor],Ie=[s.textOffset0,s.textOffset1],be=Zi(Te,g,v,Ie,w),ke=this.collisionIndex.placeCollisionBox(d,W,O,F,U,B,C,fe,K.predicate,we,be,ye);if((!_e||this.collisionIndex.placeCollisionBox(_e,W,O,F,U,B,C,pe,K.predicate,we,be,ye).placeable)&&ke.placeable){let Xe;if(this.prevPlacement&&this.prevPlacement.variableOffsets[X.crossTileID]&&this.prevPlacement.placements[X.crossTileID]&&this.prevPlacement.placements[X.crossTileID].text&&(Xe=this.prevPlacement.variableOffsets[X.crossTileID].anchor),X.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[X.crossTileID]={textOffset:Ie,width:g,height:v,anchor:Te,textBoxScale:w,prevAnchor:Xe},this.markUsedJustification(re,Te,X,ue),re.allowVerticalPlacement&&(this.markUsedOrientation(re,ue,X),this.placedOrientations[X.crossTileID]=ue),{shift:be,placedGlyphBoxes:ke}}}placeLayerBucketPart(s,d,g){const{bucket:v,layout:w,translationText:C,translationIcon:B,unwrappedTileID:O,pitchedLabelPlaneMatrix:F,textPixelRatio:U,holdingForFade:K,collisionBoxArray:W,partiallyEvaluatedTextSize:X,collisionGroup:re}=s.parameters,ue=w.get("text-optional"),fe=w.get("icon-optional"),pe=o.aF(w,"text-overlap","text-allow-overlap"),_e=pe==="always",we=o.aF(w,"icon-overlap","icon-allow-overlap"),ye=we==="always",Te=w.get("text-rotation-alignment")==="map",Ie=w.get("text-pitch-alignment")==="map",be=w.get("icon-text-fit")!=="none",ke=w.get("symbol-z-order")==="viewport-y",Xe=_e&&(ye||!v.hasIconData()||fe),qe=ye&&(_e||!v.hasTextData()||ue);!v.collisionArrays&&W&&v.deserializeCollisionBoxes(W);const Ze=this.retainedQueryData[v.bucketInstanceId].tileID,tt=this._getTerrainElevationFunc(Ze),bt=this.transform.getFastPathSimpleProjectionMatrix(Ze),wt=(ut,jt,Sr)=>{var Gr,ii;if(d[ut.crossTileID])return;if(K)return void(this.placements[ut.crossTileID]=new os(!1,!1,!1));let Jr=!1,ui=!1,Si=!0,br=null,qr={box:null,placeable:!1,offscreen:null,occluded:!1},Ji={placeable:!1},on=null,_n=null,ps=null,_o=0,ja=0,ha=0;jt.textFeatureIndex?_o=jt.textFeatureIndex:ut.useRuntimeCollisionCircles&&(_o=ut.featureIndex),jt.verticalTextFeatureIndex&&(ja=jt.verticalTextFeatureIndex);const nc=jt.textBox;if(nc){const ms=Qi=>{let an=o.ao.horizontal;if(v.allowVerticalPlacement&&!Qi&&this.prevPlacement){const _s=this.prevPlacement.placedOrientations[ut.crossTileID];_s&&(this.placedOrientations[ut.crossTileID]=_s,an=_s,this.markUsedOrientation(v,an,ut))}return an},$o=(Qi,an)=>{if(v.allowVerticalPlacement&&ut.numVerticalGlyphVertices>0&&jt.verticalTextBox){for(const _s of v.writingModes)if(_s===o.ao.vertical?(qr=an(),Ji=qr):qr=Qi(),qr&&qr.placeable)break}else qr=Qi()},gs=ut.textAnchorOffsetStartIndex,Ua=ut.textAnchorOffsetEndIndex;if(Ua===gs){const Qi=(an,_s)=>{const ln=this.collisionIndex.placeCollisionBox(an,pe,U,Ze,O,Ie,Te,C,re.predicate,tt,void 0,bt);return ln&&ln.placeable&&(this.markUsedOrientation(v,_s,ut),this.placedOrientations[ut.crossTileID]=_s),ln};$o((()=>Qi(nc,o.ao.horizontal)),(()=>{const an=jt.verticalTextBox;return v.allowVerticalPlacement&&ut.numVerticalGlyphVertices>0&&an?Qi(an,o.ao.vertical):{box:null,offscreen:null}})),ms(qr&&qr.placeable)}else{let Qi=o.aE[(ii=(Gr=this.prevPlacement)===null||Gr===void 0?void 0:Gr.variableOffsets[ut.crossTileID])===null||ii===void 0?void 0:ii.anchor];const an=(ln,sh,lu)=>{const yn=ln.x2-ln.x1,eo=ln.y2-ln.y1,Wo=ut.textBoxScale,Pf=be&&we==="never"?sh:null;let Ns=null,Rf=pe==="never"?1:2,oh="never";Qi&&Rf++;for(let Va=0;Va<Rf;Va++){for(let cu=gs;cu<Ua;cu++){const da=v.textAnchorOffsets.get(cu);if(Qi&&da.textAnchor!==Qi)continue;const Ga=this.attemptAnchorPlacement(da,ln,yn,eo,Wo,Te,Ie,U,Ze,O,re,oh,ut,v,lu,C,B,Pf,tt);if(Ga&&(Ns=Ga.placedGlyphBoxes,Ns&&Ns.placeable))return Jr=!0,br=Ga.shift,Ns}Qi?Qi=null:oh=pe}return g&&!Ns&&(Ns={box:this.collisionIndex.placeCollisionBox(nc,"always",U,Ze,O,Ie,Te,C,re.predicate,tt,void 0,bt).box,offscreen:!1,placeable:!1,occluded:!1}),Ns};$o((()=>an(nc,jt.iconBox,o.ao.horizontal)),(()=>{const ln=jt.verticalTextBox;return v.allowVerticalPlacement&&(!qr||!qr.placeable)&&ut.numVerticalGlyphVertices>0&&ln?an(ln,jt.verticalIconBox,o.ao.vertical):{box:null,occluded:!0,offscreen:null}})),qr&&(Jr=qr.placeable,Si=qr.offscreen);const _s=ms(qr&&qr.placeable);if(!Jr&&this.prevPlacement){const ln=this.prevPlacement.variableOffsets[ut.crossTileID];ln&&(this.variableOffsets[ut.crossTileID]=ln,this.markUsedJustification(v,ln.anchor,ut,_s))}}}if(on=qr,Jr=on&&on.placeable,Si=on&&on.offscreen,ut.useRuntimeCollisionCircles){const ms=v.text.placedSymbolArray.get(ut.centerJustifiedTextSymbolIndex),$o=o.ap(v.textSizeData,X,ms),gs=w.get("text-padding");_n=this.collisionIndex.placeCollisionCircles(pe,ms,v.lineVertexArray,v.glyphOffsetArray,$o,O,F,g,Ie,re.predicate,ut.collisionCircleDiameter,gs,C,tt),_n.circles.length&&_n.collisionDetected&&!g&&o.w("Collisions detected, but collision boxes are not shown"),Jr=_e||_n.circles.length>0&&!_n.collisionDetected,Si=Si&&_n.offscreen}if(jt.iconFeatureIndex&&(ha=jt.iconFeatureIndex),jt.iconBox){const ms=$o=>this.collisionIndex.placeCollisionBox($o,we,U,Ze,O,Ie,Te,B,re.predicate,tt,be&&br?br:void 0,bt);Ji&&Ji.placeable&&jt.verticalIconBox?(ps=ms(jt.verticalIconBox),ui=ps.placeable):(ps=ms(jt.iconBox),ui=ps.placeable),Si=Si&&ps.offscreen}const sc=ue||ut.numHorizontalGlyphVertices===0&&ut.numVerticalGlyphVertices===0,Sl=fe||ut.numIconVertices===0;sc||Sl?Sl?sc||(ui=ui&&Jr):Jr=ui&&Jr:ui=Jr=ui&&Jr;const oc=ui&&ps.placeable;if(Jr&&on.placeable&&this.collisionIndex.insertCollisionBox(on.box,pe,w.get("text-ignore-placement"),v.bucketInstanceId,Ji&&Ji.placeable&&ja?ja:_o,re.ID),oc&&this.collisionIndex.insertCollisionBox(ps.box,we,w.get("icon-ignore-placement"),v.bucketInstanceId,ha,re.ID),_n&&Jr&&this.collisionIndex.insertCollisionCircles(_n.circles,pe,w.get("text-ignore-placement"),v.bucketInstanceId,_o,re.ID),g&&this.storeCollisionData(v.bucketInstanceId,Sr,jt,on,ps,_n),ut.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(v.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[ut.crossTileID]=new os((Jr||Xe)&&!on?.occluded,(ui||qe)&&!ps?.occluded,Si||v.justReloaded),d[ut.crossTileID]=!0};if(ke){if(s.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const ut=v.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let jt=ut.length-1;jt>=0;--jt){const Sr=ut[jt];wt(v.symbolInstances.get(Sr),v.collisionArrays[Sr],Sr)}}else for(let ut=s.symbolInstanceStart;ut<s.symbolInstanceEnd;ut++)wt(v.symbolInstances.get(ut),v.collisionArrays[ut],ut);v.justReloaded=!1}storeCollisionData(s,d,g,v,w,C){if(g.textBox||g.iconBox){let B,O;this.collisionBoxArrays.has(s)?B=this.collisionBoxArrays.get(s):(B=new Map,this.collisionBoxArrays.set(s,B)),B.has(d)?O=B.get(d):(O={text:null,icon:null},B.set(d,O)),g.textBox&&(O.text=v.box),g.iconBox&&(O.icon=w.box)}if(C){let B=this.collisionCircleArrays[s];B===void 0&&(B=this.collisionCircleArrays[s]=[]);for(let O=0;O<C.circles.length;O+=4)B.push(C.circles[O+0]-wr),B.push(C.circles[O+1]-wr),B.push(C.circles[O+2]),B.push(C.collisionDetected?1:0)}}markUsedJustification(s,d,g,v){let w;w=v===o.ao.vertical?g.verticalPlacedTextSymbolIndex:{left:g.leftJustifiedTextSymbolIndex,center:g.centerJustifiedTextSymbolIndex,right:g.rightJustifiedTextSymbolIndex}[o.aG(d)];const C=[g.leftJustifiedTextSymbolIndex,g.centerJustifiedTextSymbolIndex,g.rightJustifiedTextSymbolIndex,g.verticalPlacedTextSymbolIndex];for(const B of C)B>=0&&(s.text.placedSymbolArray.get(B).crossTileID=w>=0&&B!==w?0:g.crossTileID)}markUsedOrientation(s,d,g){const v=d===o.ao.horizontal||d===o.ao.horizontalOnly?d:0,w=d===o.ao.vertical?d:0,C=[g.leftJustifiedTextSymbolIndex,g.centerJustifiedTextSymbolIndex,g.rightJustifiedTextSymbolIndex];for(const B of C)s.text.placedSymbolArray.get(B).placedOrientation=v;g.verticalPlacedTextSymbolIndex&&(s.text.placedSymbolArray.get(g.verticalPlacedTextSymbolIndex).placedOrientation=w)}commit(s){this.commitTime=s,this.zoomAtLastRecencyCheck=this.transform.zoom;const d=this.prevPlacement;let g=!1;this.prevZoomAdjustment=d?d.zoomAdjustment(this.transform.zoom):0;const v=d?d.symbolFadeChange(s):1,w=d?d.opacities:{},C=d?d.variableOffsets:{},B=d?d.placedOrientations:{};for(const O in this.placements){const F=this.placements[O],U=w[O];U?(this.opacities[O]=new Fr(U,v,F.text,F.icon),g=g||F.text!==U.text.placed||F.icon!==U.icon.placed):(this.opacities[O]=new Fr(null,v,F.text,F.icon,F.skipFade),g=g||F.text||F.icon)}for(const O in w){const F=w[O];if(!this.opacities[O]){const U=new Fr(F,v,!1,!1);U.isHidden()||(this.opacities[O]=U,g=g||F.text.placed||F.icon.placed)}}for(const O in C)this.variableOffsets[O]||!this.opacities[O]||this.opacities[O].isHidden()||(this.variableOffsets[O]=C[O]);for(const O in B)this.placedOrientations[O]||!this.opacities[O]||this.opacities[O].isHidden()||(this.placedOrientations[O]=B[O]);if(d&&d.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");g?this.lastPlacementChangeTime=s:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=d?d.lastPlacementChangeTime:s)}updateLayerOpacities(s,d){const g={};for(const v of d){const w=v.getBucket(s);w&&v.latestFeatureIndex&&s.id===w.layerIds[0]&&this.updateBucketOpacities(w,v.tileID,g,v.collisionBoxArray)}}updateBucketOpacities(s,d,g,v){s.hasTextData()&&(s.text.opacityVertexArray.clear(),s.text.hasVisibleVertices=!1),s.hasIconData()&&(s.icon.opacityVertexArray.clear(),s.icon.hasVisibleVertices=!1),s.hasIconCollisionBoxData()&&s.iconCollisionBox.collisionVertexArray.clear(),s.hasTextCollisionBoxData()&&s.textCollisionBox.collisionVertexArray.clear();const w=s.layers[0],C=w.layout,B=new Fr(null,0,!1,!1,!0),O=C.get("text-allow-overlap"),F=C.get("icon-allow-overlap"),U=w._unevaluatedLayout.hasValue("text-variable-anchor")||w._unevaluatedLayout.hasValue("text-variable-anchor-offset"),K=C.get("text-rotation-alignment")==="map",W=C.get("text-pitch-alignment")==="map",X=C.get("icon-text-fit")!=="none",re=new Fr(null,0,O&&(F||!s.hasIconData()||C.get("icon-optional")),F&&(O||!s.hasTextData()||C.get("text-optional")),!0);!s.collisionArrays&&v&&(s.hasIconCollisionBoxData()||s.hasTextCollisionBoxData())&&s.deserializeCollisionBoxes(v);const ue=(pe,_e,we)=>{for(let ye=0;ye<_e/4;ye++)pe.opacityVertexArray.emplaceBack(we);pe.hasVisibleVertices=pe.hasVisibleVertices||we!==ls},fe=this.collisionBoxArrays.get(s.bucketInstanceId);for(let pe=0;pe<s.symbolInstances.length;pe++){const _e=s.symbolInstances.get(pe),{numHorizontalGlyphVertices:we,numVerticalGlyphVertices:ye,crossTileID:Te}=_e;let Ie=this.opacities[Te];g[Te]?Ie=B:Ie||(Ie=re,this.opacities[Te]=Ie),g[Te]=!0;const be=_e.numIconVertices>0,ke=this.placedOrientations[_e.crossTileID],Xe=ke===o.ao.vertical,qe=ke===o.ao.horizontal||ke===o.ao.horizontalOnly;if(we>0||ye>0){const tt=Lo(Ie.text);ue(s.text,we,Xe?ls:tt),ue(s.text,ye,qe?ls:tt);const bt=Ie.text.isHidden();[_e.rightJustifiedTextSymbolIndex,_e.centerJustifiedTextSymbolIndex,_e.leftJustifiedTextSymbolIndex].forEach((jt=>{jt>=0&&(s.text.placedSymbolArray.get(jt).hidden=bt||Xe?1:0)})),_e.verticalPlacedTextSymbolIndex>=0&&(s.text.placedSymbolArray.get(_e.verticalPlacedTextSymbolIndex).hidden=bt||qe?1:0);const wt=this.variableOffsets[_e.crossTileID];wt&&this.markUsedJustification(s,wt.anchor,_e,ke);const ut=this.placedOrientations[_e.crossTileID];ut&&(this.markUsedJustification(s,"left",_e,ut),this.markUsedOrientation(s,ut,_e))}if(be){const tt=Lo(Ie.icon),bt=!(X&&_e.verticalPlacedIconSymbolIndex&&Xe);_e.placedIconSymbolIndex>=0&&(ue(s.icon,_e.numIconVertices,bt?tt:ls),s.icon.placedSymbolArray.get(_e.placedIconSymbolIndex).hidden=Ie.icon.isHidden()),_e.verticalPlacedIconSymbolIndex>=0&&(ue(s.icon,_e.numVerticalIconVertices,bt?ls:tt),s.icon.placedSymbolArray.get(_e.verticalPlacedIconSymbolIndex).hidden=Ie.icon.isHidden())}const Ze=fe&&fe.has(pe)?fe.get(pe):{text:null,icon:null};if(s.hasIconCollisionBoxData()||s.hasTextCollisionBoxData()){const tt=s.collisionArrays[pe];if(tt){let bt=new o.P(0,0);if(tt.textBox||tt.verticalTextBox){let wt=!0;if(U){const ut=this.variableOffsets[Te];ut?(bt=Zi(ut.anchor,ut.width,ut.height,ut.textOffset,ut.textBoxScale),K&&bt._rotate(W?-this.transform.bearingInRadians:this.transform.bearingInRadians)):wt=!1}if(tt.textBox||tt.verticalTextBox){let ut;tt.textBox&&(ut=Xe),tt.verticalTextBox&&(ut=qe),Lc(s.textCollisionBox.collisionVertexArray,Ie.text.placed,!wt||ut,Ze.text,bt.x,bt.y)}}if(tt.iconBox||tt.verticalIconBox){const wt=!!(!qe&&tt.verticalIconBox);let ut;tt.iconBox&&(ut=wt),tt.verticalIconBox&&(ut=!wt),Lc(s.iconCollisionBox.collisionVertexArray,Ie.icon.placed,ut,Ze.icon,X?bt.x:0,X?bt.y:0)}}}}if(s.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[s.bucketInstanceId]&&(this.retainedQueryData[s.bucketInstanceId].featureSortOrder=s.featureSortOrder),s.hasTextData()&&s.text.opacityVertexBuffer&&s.text.opacityVertexBuffer.updateData(s.text.opacityVertexArray),s.hasIconData()&&s.icon.opacityVertexBuffer&&s.icon.opacityVertexBuffer.updateData(s.icon.opacityVertexArray),s.hasIconCollisionBoxData()&&s.iconCollisionBox.collisionVertexBuffer&&s.iconCollisionBox.collisionVertexBuffer.updateData(s.iconCollisionBox.collisionVertexArray),s.hasTextCollisionBoxData()&&s.textCollisionBox.collisionVertexBuffer&&s.textCollisionBox.collisionVertexBuffer.updateData(s.textCollisionBox.collisionVertexArray),s.text.opacityVertexArray.length!==s.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${s.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${s.text.layoutVertexArray.length}) / 4`);if(s.icon.opacityVertexArray.length!==s.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${s.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${s.icon.layoutVertexArray.length}) / 4`);s.bucketInstanceId in this.collisionCircleArrays&&(s.collisionCircleArray=this.collisionCircleArrays[s.bucketInstanceId],delete this.collisionCircleArrays[s.bucketInstanceId])}symbolFadeChange(s){return this.fadeDuration===0?1:(s-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(s){return Math.max(0,(this.transform.zoom-s)/1.5)}hasTransitions(s){return this.stale||s-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(s,d){const g=this.zoomAtLastRecencyCheck===d?1-this.zoomAdjustment(d):1;return this.zoomAtLastRecencyCheck=d,this.commitTime+this.fadeDuration*g>s}setStale(){this.stale=!0}}function Lc(x,s,d,g,v,w){g&&g.length!==0||(g=[0,0,0,0]);const C=g[0]-wr,B=g[1]-wr,O=g[2]-wr,F=g[3]-wr;x.emplaceBack(s?1:0,d?1:0,v||0,w||0,C,B),x.emplaceBack(s?1:0,d?1:0,v||0,w||0,O,B),x.emplaceBack(s?1:0,d?1:0,v||0,w||0,O,F),x.emplaceBack(s?1:0,d?1:0,v||0,w||0,C,F)}const Dn=Math.pow(2,25),Ms=Math.pow(2,24),Bo=Math.pow(2,17),Oc=Math.pow(2,16),ol=Math.pow(2,9),al=Math.pow(2,8),Ea=Math.pow(2,1);function Lo(x){if(x.opacity===0&&!x.placed)return 0;if(x.opacity===1&&x.placed)return 4294967295;const s=x.placed?1:0,d=Math.floor(127*x.opacity);return d*Dn+s*Ms+d*Bo+s*Oc+d*ol+s*al+d*Ea+s}const ls=0;class Lu{constructor(s){this._sortAcrossTiles=s.layout.get("symbol-z-order")!=="viewport-y"&&!s.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(s,d,g,v,w){const C=this._bucketParts;for(;this._currentTileIndex<s.length;)if(d.getBucketParts(C,v,s[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,w())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,C.sort(((B,O)=>B.sortKey-O.sortKey)));this._currentPartIndex<C.length;)if(d.placeLayerBucketPart(C[this._currentPartIndex],this._seenCrossTileIDs,g),this._currentPartIndex++,w())return!0;return!1}}class ll{constructor(s,d,g,v,w,C,B,O){this.placement=new sn(s,d,C,B,O),this._currentPlacementIndex=g.length-1,this._forceFullPlacement=v,this._showCollisionBoxes=w,this._done=!1}isDone(){return this._done}continuePlacement(s,d,g){const v=M.now(),w=()=>!this._forceFullPlacement&&M.now()-v>2;for(;this._currentPlacementIndex>=0;){const C=d[s[this._currentPlacementIndex]],B=this.placement.collisionIndex.transform.zoom;if(C.type==="symbol"&&(!C.minzoom||C.minzoom<=B)&&(!C.maxzoom||C.maxzoom>B)){if(this._inProgressLayer||(this._inProgressLayer=new Lu(C)),this._inProgressLayer.continuePlacement(g[C.source],this.placement,this._showCollisionBoxes,C,w))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(s){return this.placement.commit(s),this.placement}}const Oo=512/o.$/2;class cl{constructor(s,d,g){this.tileID=s,this.bucketInstanceId=g,this._symbolsByKey={};const v=new Map;for(let w=0;w<d.length;w++){const C=d.get(w),B=C.key,O=v.get(B);O?O.push(C):v.set(B,[C])}for(const[w,C]of v){const B={positions:C.map((O=>({x:Math.floor(O.anchorX*Oo),y:Math.floor(O.anchorY*Oo)}))),crossTileIDs:C.map((O=>O.crossTileID))};if(B.positions.length>128){const O=new o.aI(B.positions.length,16,Uint16Array);for(const{x:F,y:U}of B.positions)O.add(F,U);O.finish(),delete B.positions,B.index=O}this._symbolsByKey[w]=B}}getScaledCoordinates(s,d){const{x:g,y:v,z:w}=this.tileID.canonical,{x:C,y:B,z:O}=d.canonical,F=Oo/Math.pow(2,O-w),U=(B*o.$+s.anchorY)*F,K=v*o.$*Oo;return{x:Math.floor((C*o.$+s.anchorX)*F-g*o.$*Oo),y:Math.floor(U-K)}}findMatches(s,d,g){const v=this.tileID.canonical.z<d.canonical.z?1:Math.pow(2,this.tileID.canonical.z-d.canonical.z);for(let w=0;w<s.length;w++){const C=s.get(w);if(C.crossTileID)continue;const B=this._symbolsByKey[C.key];if(!B)continue;const O=this.getScaledCoordinates(C,d);if(B.index){const F=B.index.range(O.x-v,O.y-v,O.x+v,O.y+v).sort();for(const U of F){const K=B.crossTileIDs[U];if(!g[K]){g[K]=!0,C.crossTileID=K;break}}}else if(B.positions)for(let F=0;F<B.positions.length;F++){const U=B.positions[F],K=B.crossTileIDs[F];if(Math.abs(U.x-O.x)<=v&&Math.abs(U.y-O.y)<=v&&!g[K]){g[K]=!0,C.crossTileID=K;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map((({crossTileIDs:s})=>s))}}class Aa{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Zd{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(s){const d=Math.round((s-this.lng)/360);if(d!==0)for(const g in this.indexes){const v=this.indexes[g],w={};for(const C in v){const B=v[C];B.tileID=B.tileID.unwrapTo(B.tileID.wrap+d),w[B.tileID.key]=B}this.indexes[g]=w}this.lng=s}addBucket(s,d,g){if(this.indexes[s.overscaledZ]&&this.indexes[s.overscaledZ][s.key]){if(this.indexes[s.overscaledZ][s.key].bucketInstanceId===d.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(s.overscaledZ,this.indexes[s.overscaledZ][s.key])}for(let w=0;w<d.symbolInstances.length;w++)d.symbolInstances.get(w).crossTileID=0;this.usedCrossTileIDs[s.overscaledZ]||(this.usedCrossTileIDs[s.overscaledZ]={});const v=this.usedCrossTileIDs[s.overscaledZ];for(const w in this.indexes){const C=this.indexes[w];if(Number(w)>s.overscaledZ)for(const B in C){const O=C[B];O.tileID.isChildOf(s)&&O.findMatches(d.symbolInstances,s,v)}else{const B=C[s.scaledTo(Number(w)).key];B&&B.findMatches(d.symbolInstances,s,v)}}for(let w=0;w<d.symbolInstances.length;w++){const C=d.symbolInstances.get(w);C.crossTileID||(C.crossTileID=g.generate(),v[C.crossTileID]=!0)}return this.indexes[s.overscaledZ]===void 0&&(this.indexes[s.overscaledZ]={}),this.indexes[s.overscaledZ][s.key]=new cl(s,d.symbolInstances,d.bucketInstanceId),!0}removeBucketCrossTileIDs(s,d){for(const g of d.getCrossTileIDsLists())for(const v of g)delete this.usedCrossTileIDs[s][v]}removeStaleBuckets(s){let d=!1;for(const g in this.indexes){const v=this.indexes[g];for(const w in v)s[v[w].bucketInstanceId]||(this.removeBucketCrossTileIDs(g,v[w]),delete v[w],d=!0)}return d}}class ae{constructor(){this.layerIndexes={},this.crossTileIDs=new Aa,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(s,d,g){let v=this.layerIndexes[s.id];v===void 0&&(v=this.layerIndexes[s.id]=new Zd);let w=!1;const C={};v.handleWrapJump(g);for(const B of d){const O=B.getBucket(s);O&&s.id===O.layerIds[0]&&(O.bucketInstanceId||(O.bucketInstanceId=++this.maxBucketInstanceId),v.addBucket(B.tileID,O,this.crossTileIDs)&&(w=!0),C[O.bucketInstanceId]=!0)}return v.removeStaleBuckets(C)&&(w=!0),w}pruneUnusedLayers(s){const d={};s.forEach((g=>{d[g]=!0}));for(const g in this.layerIndexes)d[g]||delete this.layerIndexes[g]}}var he="void main() {fragColor=vec4(1.0);}";const Pe={prelude:We(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
out highp vec4 fragColor;`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c
);}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
#ifdef GLOBE
if ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}
#endif
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;`),projectionMercator:We("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:We("",`#define GLOBE_RADIUS 6371008.8
uniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos
);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); 
if (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len
);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}`),background:We(`uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:We(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:We(`in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {
#ifdef GLOBE
vec3 center_vector=projectToSphere(circle_center);
#endif
float angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {
#ifdef GLOBE
vec4 projected_center=interpolateProjection(circle_center,center_vector,ele);
#else
vec4 projected_center=projectTileWithElevation(circle_center,ele);
#endif
corner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}
#ifdef GLOBE
vec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);
#else
gl_Position=projectTileWithElevation(corner_position,ele);
#endif
} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:We(he,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:We(`uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);
#ifdef GLOBE
vec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);
#else
gl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));
#endif
}`),heatmapTexture:We(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:We("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:We("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),colorRelief:We(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;uniform vec4 u_unpack;uniform sampler2D u_elevation_stops;uniform sampler2D u_color_stops;uniform int u_color_ramp_size;uniform float u_opacity;in vec2 v_pos;float getElevation(vec2 coord) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}float getElevationStop(int stop) {float x=(float(stop)+0.5)/float(u_color_ramp_size);vec4 data=texture(u_elevation_stops,vec2(x,0))*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {float el=getElevation(v_pos);int r=(u_color_ramp_size-1);int l=0;float el_l=getElevationStop(l);float el_r=getElevationStop(r);while(r-l > 1){int m=(r+l)/2;float el_m=getElevationStop(m);if(el < el_m){r=m;el_r=el_m;}else
{l=m;el_l=el_m;}}float x=(float(l)+(el-el_l)/(el_r-el_l)+0.5)/float(u_color_ramp_size);fragColor=u_opacity*texture(u_color_stops,vec2(x,0));
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_dimension;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_pos/8192.0)*scale+epsilon;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),debug:We("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:We(he,`in vec2 a_pos;void main() {
#ifdef GLOBE
gl_Position=projectTileFor3D(a_pos,0.0);
#else
gl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);
#endif
}`),fill:We(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
fragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_fill_translate;in vec2 a_pos;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);}`),fillOutline:We(`in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillOutlinePattern:We(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillPattern:We(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:We(`in vec4 v_color;void main() {fragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
out vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);
#ifdef GLOBE
mat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);
#endif
directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:We(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
#ifdef GLOBE
out vec3 v_sphere_pos;
#endif
out vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:We(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {vec2 epsilon=1.0/u_dimension;float tileSize=u_dimension.x-2.0;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))*tileSize/pow(2.0,exaggeration+(28.2562-u_zoom));fragColor=clamp(vec4(deriv.x/8.0+0.5,deriv.y/8.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:We(`uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform float u_exaggeration;uniform vec4 u_accent;uniform int u_method;uniform float u_altitudes[NUM_ILLUMINATION_SOURCES];uniform float u_azimuths[NUM_ILLUMINATION_SOURCES];uniform vec4 u_shadows[NUM_ILLUMINATION_SOURCES];uniform vec4 u_highlights[NUM_ILLUMINATION_SOURCES];
#define PI 3.141592653589793
#define STANDARD 0
#define COMBINED 1
#define IGOR 2
#define MULTIDIRECTIONAL 3
#define BASIC 4
float get_aspect(vec2 deriv){return deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);}void igor_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float aspect=get_aspect(deriv);float azimuth=u_azimuths[0]+PI;float slope_stength=atan(length(deriv))*2.0/PI;float aspect_strength=1.0-abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);float shadow_strength=slope_stength*aspect_strength;float highlight_strength=slope_stength*(1.0-aspect_strength);fragColor=u_shadows[0]*shadow_strength+u_highlights[0]*highlight_strength;}void standard_hillshade(vec2 deriv){float azimuth=u_azimuths[0]+PI;float slope=atan(0.625*length(deriv));float aspect=get_aspect(deriv);float intensity=u_exaggeration;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadows[0],u_highlights[0],shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;}void basic_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor=u_highlights[0]*(2.0*shade-1.0);}else
{fragColor=u_shadows[0]*(1.0-2.0*shade);}}void multidirectional_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;fragColor=vec4(0,0,0,0);for(int i=0; i < NUM_ILLUMINATION_SOURCES; i++){float cos_alt=cos(u_altitudes[i]);float sin_alt=sin(u_altitudes[i]);float cos_az=-cos(u_azimuths[i]);float sin_az=-sin(u_azimuths[i]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor+=u_highlights[i]*(2.0*shade-1.0)/float(NUM_ILLUMINATION_SOURCES);}else
{fragColor+=u_shadows[i]*(1.0-2.0*shade)/float(NUM_ILLUMINATION_SOURCES);}}}void combined_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=acos((sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv)));cang=clamp(cang,0.0,PI/2.0);float shade=cang*atan(length(deriv))*4.0/PI/PI;float highlight=(PI/2.0-cang)*atan(length(deriv))*4.0/PI/PI;fragColor=u_shadows[0]*shade+u_highlights[0]*highlight;}void main() {vec4 pixel=texture(u_image,v_pos);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));vec2 deriv=((pixel.rg*8.0)-4.0)/scaleFactor;if (u_method==BASIC) {basic_hillshade(deriv);} else if (u_method==COMBINED) {combined_hillshade(deriv);} else if (u_method==IGOR) {igor_hillshade(deriv);} else if (u_method==MULTIDIRECTIONAL) {multidirectional_hillshade(deriv);} else if (u_method==STANDARD) {standard_hillshade(deriv);} else {standard_hillshade(deriv);}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:We(`uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:We(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:We(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:We(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:We(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;
#ifdef GLOBE
if (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}
#endif
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),symbolIcon:We(`uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:We(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:We(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:We("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:We("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:We("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:We("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:We(`in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758
);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}`,"in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:We("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function We(x,s){const d=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,g=s.match(/in ([\w]+) ([\w]+)/g),v=x.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),w=s.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),C=w?w.concat(v):v,B={};return{fragmentSource:x=x.replace(d,((O,F,U,K,W)=>(B[W]=!0,F==="define"?`
#ifndef HAS_UNIFORM_u_${W}
in ${U} ${K} ${W};
#else
uniform ${U} ${K} u_${W};
#endif
`:`
#ifdef HAS_UNIFORM_u_${W}
    ${U} ${K} ${W} = u_${W};
#endif
`))),vertexSource:s=s.replace(d,((O,F,U,K,W)=>{const X=K==="float"?"vec2":"vec4",re=W.match(/color/)?"color":X;return B[W]?F==="define"?`
#ifndef HAS_UNIFORM_u_${W}
uniform lowp float u_${W}_t;
in ${U} ${X} a_${W};
out ${U} ${K} ${W};
#else
uniform ${U} ${K} u_${W};
#endif
`:re==="vec4"?`
#ifndef HAS_UNIFORM_u_${W}
    ${W} = a_${W};
#else
    ${U} ${K} ${W} = u_${W};
#endif
`:`
#ifndef HAS_UNIFORM_u_${W}
    ${W} = unpack_mix_${re}(a_${W}, u_${W}_t);
#else
    ${U} ${K} ${W} = u_${W};
#endif
`:F==="define"?`
#ifndef HAS_UNIFORM_u_${W}
uniform lowp float u_${W}_t;
in ${U} ${X} a_${W};
#else
uniform ${U} ${K} u_${W};
#endif
`:re==="vec4"?`
#ifndef HAS_UNIFORM_u_${W}
    ${U} ${K} ${W} = a_${W};
#else
    ${U} ${K} ${W} = u_${W};
#endif
`:`
#ifndef HAS_UNIFORM_u_${W}
    ${U} ${K} ${W} = unpack_mix_${re}(a_${W}, u_${W}_t);
#else
    ${U} ${K} ${W} = u_${W};
#endif
`})),staticAttributes:g,staticUniforms:C}}class mt{constructor(s,d,g){this.vertexBuffer=s,this.indexBuffer=d,this.segments=g}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var Zt=o.aJ([{name:"a_pos",type:"Int16",components:2}]);const Er="#define PROJECTION_MERCATOR",Wr="mercator";class lr{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return Wr}get shaderDefine(){return Er}get shaderPreludeCode(){return Pe.projectionMercator}get vertexShaderPreludeCode(){return Pe.projectionMercator.vertexSource}get subdivisionGranularity(){return o.aK.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(s){}getMeshFromTileID(s,d,g,v,w){if(this._cachedMesh)return this._cachedMesh;const C=new o.aL;C.emplaceBack(0,0),C.emplaceBack(o.$,0),C.emplaceBack(0,o.$),C.emplaceBack(o.$,o.$);const B=s.createVertexBuffer(C,Zt.members),O=o.aM.simpleSegment(0,0,4,2),F=new o.aN;F.emplaceBack(1,0,2),F.emplaceBack(1,2,3);const U=s.createIndexBuffer(F);return this._cachedMesh=new mt(B,U,O),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(s){}}class Ti{constructor(s=0,d=0,g=0,v=0){if(isNaN(s)||s<0||isNaN(d)||d<0||isNaN(g)||g<0||isNaN(v)||v<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=s,this.bottom=d,this.left=g,this.right=v}interpolate(s,d,g){return d.top!=null&&s.top!=null&&(this.top=o.C.number(s.top,d.top,g)),d.bottom!=null&&s.bottom!=null&&(this.bottom=o.C.number(s.bottom,d.bottom,g)),d.left!=null&&s.left!=null&&(this.left=o.C.number(s.left,d.left,g)),d.right!=null&&s.right!=null&&(this.right=o.C.number(s.right,d.right,g)),this}getCenter(s,d){const g=o.ah((this.left+s-this.right)/2,0,s),v=o.ah((this.top+d-this.bottom)/2,0,d);return new o.P(g,v)}equals(s){return this.top===s.top&&this.bottom===s.bottom&&this.left===s.left&&this.right===s.right}clone(){return new Ti(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Vi(x,s){if(!x.renderWorldCopies||x.lngRange)return;const d=s.lng-x.center.lng;s.lng+=d>180?-360:d<-180?360:0}function Do(x){return Math.max(0,Math.floor(x))}class Gi{constructor(s,d,g,v,w,C){this._callbacks=s,this._tileSize=512,this._renderWorldCopies=C===void 0||!!C,this._minZoom=d||0,this._maxZoom=g||22,this._minPitch=v??0,this._maxPitch=w??60,this.setMaxBounds(),this._width=0,this._height=0,this._center=new o.S(0,0),this._elevation=0,this._zoom=0,this._tileZoom=Do(this._zoom),this._scale=o.af(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new Ti,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(s,d,g){this._latRange=s.latRange,this._lngRange=s.lngRange,this._width=s.width,this._height=s.height,this._center=s.center,this._elevation=s.elevation,this._minElevationForCurrentTile=s.minElevationForCurrentTile,this._zoom=s.zoom,this._tileZoom=Do(this._zoom),this._scale=o.af(this._zoom),this._bearingInRadians=s.bearingInRadians,this._fovInRadians=s.fovInRadians,this._pitchInRadians=s.pitchInRadians,this._rollInRadians=s.rollInRadians,this._unmodified=s.unmodified,this._edgeInsets=new Ti(s.padding.top,s.padding.bottom,s.padding.left,s.padding.right),this._minZoom=s.minZoom,this._maxZoom=s.maxZoom,this._minPitch=s.minPitch,this._maxPitch=s.maxPitch,this._renderWorldCopies=s.renderWorldCopies,this._cameraToCenterDistance=s.cameraToCenterDistance,this._nearZ=s.nearZ,this._farZ=s.farZ,this._autoCalculateNearFarZ=!g&&s.autoCalculateNearFarZ,d&&this._constrain(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(s){this._minElevationForCurrentTile=s}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(s){this._minZoom!==s&&(this._minZoom=s,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(s){this._maxZoom!==s&&(this._maxZoom=s,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(s){this._minPitch!==s&&(this._minPitch=s,this.setPitch(Math.max(this.pitch,s)))}get maxPitch(){return this._maxPitch}setMaxPitch(s){this._maxPitch!==s&&(this._maxPitch=s,this.setPitch(Math.min(this.pitch,s)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(s){s===void 0?s=!0:s===null&&(s=!1),this._renderWorldCopies=s}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new o.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(s){const d=o.aO(s,-180,180)*Math.PI/180;var g,v,w,C,B,O,F,U,K;this._bearingInRadians!==d&&(this._unmodified=!1,this._bearingInRadians=d,this._calcMatrices(),this._rotationMatrix=b(),g=this._rotationMatrix,w=-this._bearingInRadians,C=(v=this._rotationMatrix)[0],B=v[1],O=v[2],F=v[3],U=Math.sin(w),K=Math.cos(w),g[0]=C*K+O*U,g[1]=B*K+F*U,g[2]=C*-U+O*K,g[3]=B*-U+F*K)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(s){const d=o.ah(s,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==d&&(this._unmodified=!1,this._pitchInRadians=d,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(s){const d=s/180*Math.PI;this._rollInRadians!==d&&(this._unmodified=!1,this._rollInRadians=d,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return o.aP(this._fovInRadians)}setFov(s){s=o.ah(s,.1,150),this.fov!==s&&(this._unmodified=!1,this._fovInRadians=o.ae(s),this._calcMatrices())}get zoom(){return this._zoom}setZoom(s){const d=this.getConstrained(this._center,s).zoom;this._zoom!==d&&(this._unmodified=!1,this._zoom=d,this._tileZoom=Math.max(0,Math.floor(d)),this._scale=o.af(d),this._constrain(),this._calcMatrices())}get center(){return this._center}setCenter(s){s.lat===this._center.lat&&s.lng===this._center.lng||(this._unmodified=!1,this._center=s,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(s){s!==this._elevation&&(this._elevation=s,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(s){this._edgeInsets.equals(s)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,s,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(s,d){this._autoCalculateNearFarZ=!1,this._nearZ=s,this._farZ=d,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(s){return this._edgeInsets.equals(s)}interpolatePadding(s,d,g){this._unmodified=!1,this._edgeInsets.interpolate(s,d,g),this._constrain(),this._calcMatrices()}resize(s,d,g=!0){this._width=s,this._height=d,g&&this._constrain(),this._calcMatrices()}getMaxBounds(){return this._latRange&&this._latRange.length===2&&this._lngRange&&this._lngRange.length===2?new Zr([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(s){s?(this._lngRange=[s.getWest(),s.getEast()],this._latRange=[s.getSouth(),s.getNorth()],this._constrain()):(this._lngRange=null,this._latRange=[-o.ai,o.ai])}getConstrained(s,d){return this._callbacks.getConstrained(s,d)}getCameraQueryGeometry(s,d){if(d.length===1)return[d[0],s];{const{minX:g,minY:v,maxX:w,maxY:C}=o.a2.fromPoints(d).extend(s);return[new o.P(g,v),new o.P(w,v),new o.P(w,C),new o.P(g,C),new o.P(g,v)]}}_constrain(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;const s=this._unmodified,{center:d,zoom:g}=this.getConstrained(this.center,this.zoom);this.setCenter(d),this.setZoom(g),this._unmodified=s,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let s=o.ag(new Float64Array(16));o.N(s,s,[this._width/2,-this._height/2,1]),o.M(s,s,[1,-1,0]),this._clipSpaceToPixelsMatrix=s,s=o.ag(new Float64Array(16)),o.N(s,s,[1,-1,1]),o.M(s,s,[-1,-1,0]),o.N(s,s,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=s,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(s,d,g,v){const w=g!==void 0?g:this.bearing,C=v=v!==void 0?v:this.pitch,B=o.a1.fromLngLat(s,d),O=-Math.cos(o.ae(C)),F=Math.sin(o.ae(C)),U=F*Math.sin(o.ae(w)),K=-F*Math.cos(o.ae(w));let W=this.elevation;const X=d-W;let re;O*X>=0||Math.abs(O)<.1?(re=1e4,W=d+re*O):re=-X/O;let ue,fe,pe=o.aQ(1,B.y),_e=0;do{if(_e+=1,_e>10)break;fe=re/pe,ue=new o.a1(B.x+U*fe,B.y+K*fe),pe=1/ue.meterInMercatorCoordinateUnits()}while(Math.abs(re-fe*pe)>1e-12);return{center:ue.toLngLat(),elevation:W,zoom:o.ak(this.height/2/Math.tan(this.fovInRadians/2)/fe/this.tileSize)}}recalculateZoomAndCenter(s){if(this.elevation-s==0)return;const d=o.aj(1,this.center.lat)*this.worldSize,g=this.cameraToCenterDistance/d,v=o.a1.fromLngLat(this.center,this.elevation),w=Ye(this.center,this.elevation,this.pitch,this.bearing,g);this._elevation=s;const C=this.calculateCenterFromCameraLngLatAlt(w.toLngLat(),o.aQ(w.z,v.y),this.bearing,this.pitch);this._elevation=C.elevation,this._center=C.center,this.setZoom(C.zoom)}getCameraPoint(){const s=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.P(s*Math.sin(this.rollInRadians),s*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){const s=o.aj(1,this.center.lat)*this.worldSize;return Ye(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/s).toLngLat()}getMercatorTileCoordinates(s){if(!s)return[0,0,1,1];const d=s.canonical.z>=0?1<<s.canonical.z:Math.pow(2,s.canonical.z);return[s.canonical.x/d,s.canonical.y/d,1/d/o.$,1/d/o.$]}}class Hi{constructor(s,d){this.min=s,this.max=d,this.center=o.aR([],o.aS([],this.min,this.max),.5)}quadrant(s){const d=[s%2==0,s<2],g=o.aT(this.min),v=o.aT(this.max);for(let w=0;w<d.length;w++)g[w]=d[w]?this.min[w]:this.center[w],v[w]=d[w]?this.center[w]:this.max[w];return v[2]=this.max[2],new Hi(g,v)}distanceX(s){return Math.max(Math.min(this.max[0],s[0]),this.min[0])-s[0]}distanceY(s){return Math.max(Math.min(this.max[1],s[1]),this.min[1])-s[1]}intersectsFrustum(s){let d=!0;for(let g=0;g<s.planes.length;g++){const v=this.intersectsPlane(s.planes[g]);if(v===0)return 0;v===1&&(d=!1)}return d?2:s.aabb.min[0]>this.max[0]||s.aabb.min[1]>this.max[1]||s.aabb.min[2]>this.max[2]||s.aabb.max[0]<this.min[0]||s.aabb.max[1]<this.min[1]||s.aabb.max[2]<this.min[2]?0:1}intersectsPlane(s){let d=s[3],g=s[3];for(let v=0;v<3;v++)s[v]>0?(d+=s[v]*this.min[v],g+=s[v]*this.max[v]):(g+=s[v]*this.min[v],d+=s[v]*this.max[v]);return d>=0?2:g<0?0:1}}class fn{distanceToTile2d(s,d,g,v){const w=v.distanceX([s,d]),C=v.distanceY([s,d]);return Math.hypot(w,C)}getWrap(s,d,g){return g}getTileBoundingVolume(s,d,g,v){var w,C;let B=0,O=0;if(v?.terrain){const U=new o.Z(s.z,d,s.z,s.x,s.y),K=v.terrain.getMinMaxElevation(U);B=(w=K.minElevation)!==null&&w!==void 0?w:Math.min(0,g),O=(C=K.maxElevation)!==null&&C!==void 0?C:Math.max(0,g)}const F=1<<s.z;return new Hi([d+s.x/F,s.y/F,B],[d+(s.x+1)/F,(s.y+1)/F,O])}allowVariableZoom(s,d){const g=s.fov*(Math.abs(Math.cos(s.rollInRadians))*s.height+Math.abs(Math.sin(s.rollInRadians))*s.width)/s.height,v=o.ah(78.5-g/2,0,60);return!!d.terrain||s.pitch>v}allowWorldCopies(){return!0}prepareNextFrame(){}}class pi{constructor(s,d,g){this.points=s,this.planes=d,this.aabb=g}static fromInvProjectionMatrix(s,d=1,g=0,v,w){const C=w?[[6,5,4],[0,1,2],[0,3,7],[2,1,5],[3,2,6],[0,4,5]]:[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]],B=Math.pow(2,g),O=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((W=>(function(X,re,ue,fe){const pe=o.aw([],X,re),_e=1/pe[3]/ue*fe;return o.aY(pe,pe,[_e,_e,1/pe[3],_e])})(W,s,d,B)));v&&(function(W,X,re,ue){const fe=ue?4:0,pe=ue?0:4;let _e=0;const we=[],ye=[];for(let be=0;be<4;be++){const ke=o.aU([],W[be+pe],W[be+fe]),Xe=o.aZ(ke);o.aR(ke,ke,1/Xe),we.push(Xe),ye.push(ke)}for(let be=0;be<4;be++){const ke=o.a_(W[be+fe],ye[be],re);_e=ke!==null&&ke>=0?Math.max(_e,ke):Math.max(_e,we[be])}const Te=(function(be,ke){const Xe=o.aU([],be[ke[0]],be[ke[1]]),qe=o.aU([],be[ke[2]],be[ke[1]]),Ze=[0,0,0,0];return o.aV(Ze,o.aW([],Xe,qe)),Ze[3]=-o.aX(Ze,be[ke[0]]),Ze})(W,X),Ie=(function(be,ke){const Xe=o.a$(be),qe=o.b0([],be,1/Xe),Ze=o.aU([],ke,o.aR([],qe,o.aX(ke,qe))),tt=o.a$(Ze);if(tt>0){const bt=Math.sqrt(1-qe[3]*qe[3]),wt=o.aR([],qe,-qe[3]),ut=o.aS([],wt,o.aR([],Ze,bt/tt));return o.b1(ke,ut)}return null})(re,Te);if(Ie!==null){const be=Ie/o.aX(ye[0],Te);_e=Math.min(_e,be)}for(let be=0;be<4;be++){const ke=Math.min(_e,we[be]);W[be+pe]=[W[be+fe][0]+ye[be][0]*ke,W[be+fe][1]+ye[be][1]*ke,W[be+fe][2]+ye[be][2]*ke,1]}})(O,C[0],v,w);const F=C.map((W=>{const X=o.aU([],O[W[0]],O[W[1]]),re=o.aU([],O[W[2]],O[W[1]]),ue=o.aV([],o.aW([],X,re)),fe=-o.aX(ue,O[W[1]]);return ue.concat(fe)})),U=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],K=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(const W of O)for(let X=0;X<3;X++)U[X]=Math.min(U[X],W[X]),K[X]=Math.max(K[X],W[X]);return new pi(O,F,new Hi(U,K))}}class ci{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(s){this._helper.setMinZoom(s)}setMaxZoom(s){this._helper.setMaxZoom(s)}setMinPitch(s){this._helper.setMinPitch(s)}setMaxPitch(s){this._helper.setMaxPitch(s)}setRenderWorldCopies(s){this._helper.setRenderWorldCopies(s)}setBearing(s){this._helper.setBearing(s)}setPitch(s){this._helper.setPitch(s)}setRoll(s){this._helper.setRoll(s)}setFov(s){this._helper.setFov(s)}setZoom(s){this._helper.setZoom(s)}setCenter(s){this._helper.setCenter(s)}setElevation(s){this._helper.setElevation(s)}setMinElevationForCurrentTile(s){this._helper.setMinElevationForCurrentTile(s)}setPadding(s){this._helper.setPadding(s)}interpolatePadding(s,d,g){return this._helper.interpolatePadding(s,d,g)}isPaddingEqual(s){return this._helper.isPaddingEqual(s)}resize(s,d,g=!0){this._helper.resize(s,d,g)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(s){this._helper.setMaxBounds(s)}overrideNearFarZ(s,d){this._helper.overrideNearFarZ(s,d)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(s){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),s)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(s,d){}constructor(s,d,g,v,w){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this._helper=new Gi({calcMatrices:()=>{this._calcMatrices()},getConstrained:(C,B)=>this.getConstrained(C,B)},s,d,g,v,w),this._coveringTilesDetailsProvider=new fn}clone(){const s=new ci;return s.apply(this),s}apply(s,d,g){this._helper.apply(s,d,g)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(s){const d=[new o.b2(0,s)];if(this._helper._renderWorldCopies){const g=this.screenPointToMercatorCoordinate(new o.P(0,0)),v=this.screenPointToMercatorCoordinate(new o.P(this._helper._width,0)),w=this.screenPointToMercatorCoordinate(new o.P(this._helper._width,this._helper._height)),C=this.screenPointToMercatorCoordinate(new o.P(0,this._helper._height)),B=Math.floor(Math.min(g.x,v.x,w.x,C.x)),O=Math.floor(Math.max(g.x,v.x,w.x,C.x)),F=1;for(let U=B-F;U<=O+F;U++)U!==0&&d.push(new o.b2(U,s))}return d}getCameraFrustum(){return pi.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(s){const d=this.screenPointToLocation(this.centerPoint,s),g=s?s.getElevationForLngLatZoom(d,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(g)}setLocationAtPoint(s,d){const g=o.aj(this.elevation,this.center.lat),v=this.screenPointToMercatorCoordinateAtZ(d,g),w=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,g),C=o.a1.fromLngLat(s),B=new o.a1(C.x-(v.x-w.x),C.y-(v.y-w.y));this.setCenter(B?.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(s,d){return d?this.coordinatePoint(o.a1.fromLngLat(s),d.getElevationForLngLatZoom(s,this._helper._tileZoom),this._pixelMatrix3D):this.coordinatePoint(o.a1.fromLngLat(s))}screenPointToLocation(s,d){var g;return(g=this.screenPointToMercatorCoordinate(s,d))===null||g===void 0?void 0:g.toLngLat()}screenPointToMercatorCoordinate(s,d){if(d){const g=d.pointCoordinate(s);if(g!=null)return g}return this.screenPointToMercatorCoordinateAtZ(s)}screenPointToMercatorCoordinateAtZ(s,d){const g=d||0,v=[s.x,s.y,0,1],w=[s.x,s.y,1,1];o.aw(v,v,this._pixelMatrixInverse),o.aw(w,w,this._pixelMatrixInverse);const C=v[3],B=w[3],O=v[1]/C,F=w[1]/B,U=v[2]/C,K=w[2]/B,W=U===K?0:(g-U)/(K-U);return new o.a1(o.C.number(v[0]/C,w[0]/B,W)/this.worldSize,o.C.number(O,F,W)/this.worldSize,g)}coordinatePoint(s,d=0,g=this._pixelMatrix){const v=[s.x*this.worldSize,s.y*this.worldSize,d,1];return o.aw(v,v,g),new o.P(v[0]/v[3],v[1]/v[3])}getBounds(){const s=Math.max(0,this._helper._height/2-Ce(this));return new Zr().extend(this.screenPointToLocation(new o.P(0,s))).extend(this.screenPointToLocation(new o.P(this._helper._width,s))).extend(this.screenPointToLocation(new o.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new o.P(0,this._helper._height)))}isPointOnMapSurface(s,d){return d?d.pointCoordinate(s)!=null:s.y>this.height/2-Ce(this)}calculatePosMatrix(s,d=!1,g){var v;const w=(v=s.key)!==null&&v!==void 0?v:o.b3(s.wrap,s.canonical.z,s.canonical.z,s.canonical.x,s.canonical.y),C=d?this._alignedPosMatrixCache:this._posMatrixCache;if(C.has(w)){const F=C.get(w);return g?F.f32:F.f64}const B=je(s,this.worldSize);o.O(B,d?this._alignedProjMatrix:this._viewProjMatrix,B);const O={f64:B,f32:new Float32Array(B)};return C.set(w,O),g?O.f32:O.f64}calculateFogMatrix(s){const d=s.key,g=this._fogMatrixCacheF32;if(g.has(d))return g.get(d);const v=je(s,this.worldSize);return o.O(v,this._fogMatrix,v),g.set(d,new Float32Array(v)),g.get(d)}getConstrained(s,d){d=o.ah(+d,this.minZoom,this.maxZoom);const g={center:new o.S(s.lng,s.lat),zoom:d};let v=this._helper._lngRange;if(!this._helper._renderWorldCopies&&v===null){const we=179.9999999999;v=[-we,we]}const w=this.tileSize*o.af(g.zoom);let C=0,B=w,O=0,F=w,U=0,K=0;const{x:W,y:X}=this.size;if(this._helper._latRange){const we=this._helper._latRange;C=o.U(we[1])*w,B=o.U(we[0])*w,B-C<X&&(U=X/(B-C))}v&&(O=o.aO(o.V(v[0])*w,0,w),F=o.aO(o.V(v[1])*w,0,w),F<O&&(F+=w),F-O<W&&(K=W/(F-O)));const{x:re,y:ue}=ce(w,s);let fe,pe;const _e=Math.max(K||0,U||0);if(_e){const we=new o.P(K?(F+O)/2:re,U?(B+C)/2:ue);return g.center=xe(w,we).wrap(),g.zoom+=o.ak(_e),g}if(this._helper._latRange){const we=X/2;ue-we<C&&(pe=C+we),ue+we>B&&(pe=B-we)}if(v){const we=(O+F)/2;let ye=re;this._helper._renderWorldCopies&&(ye=o.aO(re,we-w/2,we+w/2));const Te=W/2;ye-Te<O&&(fe=O+Te),ye+Te>F&&(fe=F-Te)}if(fe!==void 0||pe!==void 0){const we=new o.P(fe??re,pe??ue);g.center=xe(w,we).wrap()}return g}calculateCenterFromCameraLngLatAlt(s,d,g,v){return this._helper.calculateCenterFromCameraLngLatAlt(s,d,g,v)}_calculateNearFarZIfNeeded(s,d,g){if(!this._helper.autoCalculateNearFarZ)return;const v=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),w=s-v*this._helper._pixelPerMeter/Math.cos(d),C=v<0?w:s,B=Math.PI/2+this.pitchInRadians,O=o.ae(this.fov)*(Math.abs(Math.cos(o.ae(this.roll)))*this.height+Math.abs(Math.sin(o.ae(this.roll)))*this.width)/this.height*(.5+g.y/this.height),F=Math.sin(O)*C/Math.sin(o.ah(Math.PI-B-O,.01,Math.PI-.01)),U=Ce(this),K=Math.atan(U/this._helper.cameraToCenterDistance),W=o.ae(.75),X=K>W?2*K*(.5+g.y/(2*U)):W,re=Math.sin(X)*C/Math.sin(o.ah(Math.PI-B-X,.01,Math.PI-.01)),ue=Math.min(F,re);this._helper._farZ=1.01*(Math.cos(Math.PI/2-d)*ue+C),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;const s=this.centerOffset,d=ce(this.worldSize,this.center),g=d.x,v=d.y;this._helper._pixelPerMeter=o.aj(1,this.center.lat)*this.worldSize;const w=o.ae(Math.min(this.pitch,se)),C=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(w));let B;this._calculateNearFarZIfNeeded(C,w,s),B=new Float64Array(16),o.b4(B,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),o.aq(this._invProjMatrix,B),B[8]=2*-s.x/this._helper._width,B[9]=2*s.y/this._helper._height,this._projectionMatrix=o.b5(B),o.N(B,B,[1,-1,1]),o.M(B,B,[0,0,-this._helper.cameraToCenterDistance]),o.b6(B,B,-this.rollInRadians),o.b7(B,B,this.pitchInRadians),o.b6(B,B,-this.bearingInRadians),o.M(B,B,[-g,-v,0]),this._mercatorMatrix=o.N([],B,[this.worldSize,this.worldSize,this.worldSize]),o.N(B,B,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=o.O(new Float64Array(16),this.clipSpaceToPixelsMatrix,B),o.M(B,B,[0,0,-this.elevation]),this._viewProjMatrix=B,this._invViewProjMatrix=o.aq([],B);const O=[0,0,-1,1];o.aw(O,O,this._invViewProjMatrix),this._cameraPosition=[O[0]/O[3],O[1]/O[3],O[2]/O[3]],this._fogMatrix=new Float64Array(16),o.b4(this._fogMatrix,this.fovInRadians,this.width/this.height,C,this._helper._farZ),this._fogMatrix[8]=2*-s.x/this.width,this._fogMatrix[9]=2*s.y/this.height,o.N(this._fogMatrix,this._fogMatrix,[1,-1,1]),o.M(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),o.b6(this._fogMatrix,this._fogMatrix,-this.rollInRadians),o.b7(this._fogMatrix,this._fogMatrix,this.pitchInRadians),o.b6(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),o.M(this._fogMatrix,this._fogMatrix,[-g,-v,0]),o.N(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),o.M(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=o.O(new Float64Array(16),this.clipSpaceToPixelsMatrix,B);const F=this._helper._width%2/2,U=this._helper._height%2/2,K=Math.cos(this.bearingInRadians),W=Math.sin(-this.bearingInRadians),X=g-Math.round(g)+K*F+W*U,re=v-Math.round(v)+K*U+W*F,ue=new Float64Array(B);if(o.M(ue,ue,[X>.5?X-1:X,re>.5?re-1:re,0]),this._alignedProjMatrix=ue,B=o.aq(new Float64Array(16),this._pixelMatrix),!B)throw new Error("failed to invert matrix");this._pixelMatrixInverse=B,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;const s=this.screenPointToMercatorCoordinate(new o.P(0,0)),d=[s.x*this.worldSize,s.y*this.worldSize,0,1];return o.aw(d,d,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){const s=o.aj(1,this.center.lat)*this.worldSize;return Ye(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/s).toLngLat()}lngLatToCameraDepth(s,d){const g=o.a1.fromLngLat(s),v=[g.x*this.worldSize,g.y*this.worldSize,d,1];return o.aw(v,v,this._viewProjMatrix),v[2]/v[3]}getProjectionData(s){const{overscaledTileID:d,aligned:g,applyTerrainMatrix:v}=s,w=this._helper.getMercatorTileCoordinates(d),C=d?this.calculatePosMatrix(d,g,!0):null;let B;return B=d&&d.terrainRttPosMatrix32f&&v?d.terrainRttPosMatrix32f:C||o.b8(),{mainMatrix:B,tileMercatorCoords:w,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:B}}isLocationOccluded(s){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(s,d,g){return 1}transformLightDirection(s){return o.aT(s)}getRayDirectionFromPixel(s){throw new Error("Not implemented.")}projectTileCoordinates(s,d,g,v){const w=this.calculatePosMatrix(g);let C;v?(C=[s,d,v(s,d),1],o.aw(C,C,w)):(C=[s,d,0,1],sl(C,C,w));const B=C[3];return{point:new o.P(C[0]/B,C[1]/B),signedDistanceFromCamera:B,isOccluded:!1}}populateCache(s){for(const d of s)this.calculatePosMatrix(d)}getMatrixForModel(s,d){const g=o.a1.fromLngLat(s,d),v=g.meterInMercatorCoordinateUnits(),w=o.b9();return o.M(w,w,[g.x,g.y,g.z]),o.b6(w,w,Math.PI),o.b7(w,w,Math.PI/2),o.N(w,w,[-v,v,v]),w}getProjectionDataForCustomLayer(s=!0){const d=new o.Z(0,0,0,0,0),g=this.getProjectionData({overscaledTileID:d,applyGlobeMatrix:s}),v=je(d,this.worldSize);o.O(v,this._viewProjMatrix,v),g.tileMercatorCoords=[0,0,1,1];const w=[o.$,o.$,this.worldSize/this._helper.pixelsPerMeter],C=o.ba();return o.N(C,v,w),g.fallbackMatrix=C,g.mainMatrix=C,g}getFastPathSimpleProjectionMatrix(s){return this.calculatePosMatrix(s)}}function Xd(){o.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function pn(x){if(x.useSlerp)if(x.k<1){const s=o.bb(x.startEulerAngles.roll,x.startEulerAngles.pitch,x.startEulerAngles.bearing),d=o.bb(x.endEulerAngles.roll,x.endEulerAngles.pitch,x.endEulerAngles.bearing),g=new Float64Array(4);o.bc(g,s,d,x.k);const v=o.bd(g);x.tr.setRoll(v.roll),x.tr.setPitch(v.pitch),x.tr.setBearing(v.bearing)}else x.tr.setRoll(x.endEulerAngles.roll),x.tr.setPitch(x.endEulerAngles.pitch),x.tr.setBearing(x.endEulerAngles.bearing);else x.tr.setRoll(o.C.number(x.startEulerAngles.roll,x.endEulerAngles.roll,x.k)),x.tr.setPitch(o.C.number(x.startEulerAngles.pitch,x.endEulerAngles.pitch,x.k)),x.tr.setBearing(o.C.number(x.startEulerAngles.bearing,x.endEulerAngles.bearing,x.k))}function $s(x,s,d,g,v){const w=v.padding,C=ce(v.worldSize,d.getNorthWest()),B=ce(v.worldSize,d.getNorthEast()),O=ce(v.worldSize,d.getSouthEast()),F=ce(v.worldSize,d.getSouthWest()),U=o.ae(-g),K=C.rotate(U),W=B.rotate(U),X=O.rotate(U),re=F.rotate(U),ue=new o.P(Math.max(K.x,W.x,re.x,X.x),Math.max(K.y,W.y,re.y,X.y)),fe=new o.P(Math.min(K.x,W.x,re.x,X.x),Math.min(K.y,W.y,re.y,X.y)),pe=ue.sub(fe),_e=(v.width-(w.left+w.right+s.left+s.right))/pe.x,we=(v.height-(w.top+w.bottom+s.top+s.bottom))/pe.y;if(we<0||_e<0)return void Xd();const ye=Math.min(o.ak(v.scale*Math.min(_e,we)),x.maxZoom),Te=o.P.convert(x.offset),Ie=new o.P((s.left-s.right)/2,(s.top-s.bottom)/2).rotate(o.ae(g)),be=Te.add(Ie).mult(v.scale/o.af(ye));return{center:xe(v.worldSize,C.add(O).div(2).sub(be)),zoom:ye,bearing:g}}class Nn{get useGlobeControls(){return!1}handlePanInertia(s,d){return{easingOffset:s,easingCenter:d.center}}handleMapControlsRollPitchBearingZoom(s,d){s.bearingDelta&&d.setBearing(d.bearing+s.bearingDelta),s.pitchDelta&&d.setPitch(d.pitch+s.pitchDelta),s.rollDelta&&d.setRoll(d.roll+s.rollDelta),s.zoomDelta&&d.setZoom(d.zoom+s.zoomDelta)}handleMapControlsPan(s,d,g){s.around.distSqr(d.centerPoint)<.01||d.setLocationAtPoint(g,s.around)}cameraForBoxAndBearing(s,d,g,v,w){return $s(s,d,g,v,w)}handleJumpToCenterZoom(s,d){s.zoom!==(d.zoom!==void 0?+d.zoom:s.zoom)&&s.setZoom(+d.zoom),d.center!==void 0&&s.setCenter(o.S.convert(d.center))}handleEaseTo(s,d){const g=s.zoom,v=s.padding,w={roll:s.roll,pitch:s.pitch,bearing:s.bearing},C={roll:d.roll===void 0?s.roll:d.roll,pitch:d.pitch===void 0?s.pitch:d.pitch,bearing:d.bearing===void 0?s.bearing:d.bearing},B=d.zoom!==void 0,O=!s.isPaddingEqual(d.padding);let F=!1;const U=B?+d.zoom:s.zoom;let K=s.centerPoint.add(d.offsetAsPoint);const W=s.screenPointToLocation(K),{center:X,zoom:re}=s.getConstrained(o.S.convert(d.center||W),U??g);Vi(s,X);const ue=ce(s.worldSize,W),fe=ce(s.worldSize,X).sub(ue),pe=o.af(re-g);return F=re!==g,{easeFunc:_e=>{if(F&&s.setZoom(o.C.number(g,re,_e)),o.be(w,C)||pn({startEulerAngles:w,endEulerAngles:C,tr:s,k:_e,useSlerp:w.roll!=C.roll}),O&&(s.interpolatePadding(v,d.padding,_e),K=s.centerPoint.add(d.offsetAsPoint)),d.around)s.setLocationAtPoint(d.around,d.aroundPoint);else{const we=o.af(s.zoom-g),ye=re>g?Math.min(2,pe):Math.max(.5,pe),Te=Math.pow(ye,1-_e),Ie=xe(s.worldSize,ue.add(fe.mult(_e*Te)).mult(we));s.setLocationAtPoint(s.renderWorldCopies?Ie.wrap():Ie,K)}},isZooming:F,elevationCenter:X}}handleFlyTo(s,d){const g=d.zoom!==void 0,v=s.zoom,w=s.getConstrained(o.S.convert(d.center||d.locationAtOffset),g?+d.zoom:v),C=w.center,B=w.zoom;Vi(s,C);const O=ce(s.worldSize,d.locationAtOffset),F=ce(s.worldSize,C).sub(O),U=F.mag(),K=o.af(B-v);let W;if(d.minZoom!==void 0){const X=Math.min(+d.minZoom,v,B),re=s.getConstrained(C,X).zoom;W=o.af(re-v)}return{easeFunc:(X,re,ue,fe)=>{s.setZoom(X===1?B:v+o.ak(re));const pe=X===1?C:xe(s.worldSize,O.add(F.mult(ue)).mult(re));s.setLocationAtPoint(s.renderWorldCopies?pe.wrap():pe,fe)},scaleOfZoom:K,targetCenter:C,scaleOfMinZoom:W,pixelPathLength:U}}}class oi{constructor(s,d,g){this.blendFunction=s,this.blendColor=d,this.mask=g}}oi.Replace=[1,0],oi.disabled=new oi(oi.Replace,o.bf.transparent,[!1,!1,!1,!1]),oi.unblended=new oi(oi.Replace,o.bf.transparent,[!0,!0,!0,!0]),oi.alphaBlended=new oi([1,771],o.bf.transparent,[!0,!0,!0,!0]);const ul=2305;class cr{constructor(s,d,g){this.enable=s,this.mode=d,this.frontFace=g}}cr.disabled=new cr(!1,1029,ul),cr.backCCW=new cr(!0,1029,ul),cr.frontCCW=new cr(!0,1028,ul);class mr{constructor(s,d,g){this.func=s,this.mask=d,this.range=g}}mr.ReadOnly=!1,mr.ReadWrite=!0,mr.disabled=new mr(519,mr.ReadOnly,[0,1]);const Ws=7680;class Br{constructor(s,d,g,v,w,C){this.test=s,this.ref=d,this.mask=g,this.fail=v,this.depthFail=w,this.pass=C}}Br.disabled=new Br({func:519,mask:0},0,0,Ws,Ws,Ws);const qn=new WeakMap;function ta(x){var s;if(qn.has(x))return qn.get(x);{const d=(s=x.getParameter(x.VERSION))===null||s===void 0?void 0:s.startsWith("WebGL 2.0");return qn.set(x,d),d}}class ra{get awaitingQuery(){return!!this._readbackQueue}constructor(s){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=s;const d=s.context,g=d.gl;this._texFormat=g.RGBA,this._texType=g.UNSIGNED_BYTE;const v=new o.aL;v.emplaceBack(-1,-1),v.emplaceBack(2,-1),v.emplaceBack(-1,2);const w=new o.aN;w.emplaceBack(0,1,2),this._fullscreenTriangle=new mt(d.createVertexBuffer(v,Zt.members),d.createIndexBuffer(w),o.aM.simpleSegment(0,0,v.length,w.length)),this._resultBuffer=new Uint8Array(4),d.activeTexture.set(g.TEXTURE1);const C=g.createTexture();g.bindTexture(g.TEXTURE_2D,C),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,g.CLAMP_TO_EDGE),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,g.CLAMP_TO_EDGE),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,g.NEAREST),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,g.NEAREST),g.texImage2D(g.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=d.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(C),ta(g)&&(this._pbo=g.createBuffer(),g.bindBuffer(g.PIXEL_PACK_BUFFER,this._pbo),g.bufferData(g.PIXEL_PACK_BUFFER,4,g.STREAM_READ),g.bindBuffer(g.PIXEL_PACK_BUFFER,null))}destroy(){const s=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),s.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(s,d){const g=this._updateCount;return this._readbackQueue?g>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():g>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(s,d),this._updateCount++,this._measuredError}_bindFramebuffer(){const s=this._cachedRenderContext.context,d=s.gl;s.activeTexture.set(d.TEXTURE1),d.bindTexture(d.TEXTURE_2D,this._fbo.colorAttachment.get()),s.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(s,d){const g=this._cachedRenderContext.context,v=g.gl;if(this._bindFramebuffer(),g.viewport.set([0,0,this._texWidth,this._texHeight]),g.clear({color:o.bf.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(g,v.TRIANGLES,mr.disabled,Br.disabled,oi.unblended,cr.disabled,((w,C)=>({u_input:w,u_output_expected:C}))(s,d),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&ta(v)){v.bindBuffer(v.PIXEL_PACK_BUFFER,this._pbo),v.readBuffer(v.COLOR_ATTACHMENT0),v.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),v.bindBuffer(v.PIXEL_PACK_BUFFER,null);const w=v.fenceSync(v.SYNC_GPU_COMMANDS_COMPLETE,0);v.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:w}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){const s=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&ta(s)){const d=s.clientWaitSync(this._readbackQueue.sync,0,0);if(d===s.WAIT_FAILED)return o.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(d===s.TIMEOUT_EXPIRED)return;s.bindBuffer(s.PIXEL_PACK_BUFFER,this._pbo),s.getBufferSubData(s.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),s.bindBuffer(s.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),s.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=ra._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(s){let d=0;return d+=s[0]/256,d+=s[1]/65536,d+=s[2]/16777216,s[3]<127&&(d=-d),d/128}}const Dc=o.$/128;function Nc(x,s){const d=x.granularity!==void 0?Math.max(x.granularity,1):1,g=d+(x.generateBorders?2:0),v=d+(x.extendToNorthPole||x.generateBorders?1:0)+(x.extendToSouthPole||x.generateBorders?1:0),w=g+1,C=v+1,B=x.generateBorders?-1:0,O=x.generateBorders||x.extendToNorthPole?-1:0,F=d+(x.generateBorders?1:0),U=d+(x.generateBorders||x.extendToSouthPole?1:0),K=w*C,W=g*v*6,X=w*C>65536;if(X&&s==="16bit")throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");const re=X||s==="32bit",ue=new Int16Array(2*K);let fe=0;for(let we=O;we<=U;we++)for(let ye=B;ye<=F;ye++){let Te=ye/d*o.$;ye===-1&&(Te=-Dc),ye===d+1&&(Te=o.$+Dc);let Ie=we/d*o.$;we===-1&&(Ie=x.extendToNorthPole?o.bh:-Dc),we===d+1&&(Ie=x.extendToSouthPole?o.bi:o.$+Dc),ue[fe++]=Te,ue[fe++]=Ie}const pe=re?new Uint32Array(W):new Uint16Array(W);let _e=0;for(let we=0;we<v;we++)for(let ye=0;ye<g;ye++){const Te=ye+1+we*w,Ie=ye+(we+1)*w,be=ye+1+(we+1)*w;pe[_e++]=ye+we*w,pe[_e++]=Ie,pe[_e++]=Te,pe[_e++]=Te,pe[_e++]=Ie,pe[_e++]=be}return{vertices:ue.buffer.slice(0),indices:pe.buffer.slice(0),uses32bitIndices:re}}const hl=new o.aK({fill:new o.bj(128,2),line:new o.bj(512,0),tile:new o.bj(128,32),stencil:new o.bj(128,1),circle:3});class Fc{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return Pe.projectionGlobe}get vertexShaderPreludeCode(){return Pe.projectionMercator.vertexSource}get subdivisionGranularity(){return hl}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(s){this._errorMeasurement||(this._errorMeasurement=new ra(s));const d=o.U(this._errorQueryLatitudeDegrees),g=2*Math.atan(Math.exp(Math.PI-d*Math.PI*2))-.5*Math.PI,v=this._errorMeasurement.updateErrorLoop(d,g),w=M.now();v!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=v,this._errorMeasurementLastChangeTime=w);const C=Math.min(Math.max((w-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=o.bk(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,o.bl(C))}_getMeshKey(s){return`${s.granularity.toString(36)}_${s.generateBorders?"b":""}${s.extendToNorthPole?"n":""}${s.extendToSouthPole?"s":""}`}getMeshFromTileID(s,d,g,v,w){const C=(w==="stencil"?hl.stencil:hl.tile).getGranularityForZoomLevel(d.z);return this._getMesh(s,{granularity:C,generateBorders:g,extendToNorthPole:d.y===0&&v,extendToSouthPole:d.y===(1<<d.z)-1&&v})}_getMesh(s,d){const g=this._getMeshKey(d);if(g in this._tileMeshCache)return this._tileMeshCache[g];const v=(function(w,C){const B=Nc(C,"16bit"),O=o.aL.deserialize({arrayBuffer:B.vertices,length:B.vertices.byteLength/2/2}),F=o.aN.deserialize({arrayBuffer:B.indices,length:B.indices.byteLength/2/3});return new mt(w.createVertexBuffer(O,Zt.members),w.createIndexBuffer(F),o.aM.simpleSegment(0,0,O.length,F.length))})(s,d);return this._tileMeshCache[g]=v,v}recalculate(s){}hasTransition(){const s=M.now();let d=!1;return d=d||(s-this._errorMeasurementLastChangeTime)/1e3<.7,d=d||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,d}setErrorQueryLatitudeDegrees(s){this._errorQueryLatitudeDegrees=s}}const No=new o.r({type:new o.D(o.v.projection.type)});class zc extends o.E{constructor(s){super(),this._transitionable=new o.t(No),this.setProjection(s),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new o.F(0)),this._mercatorProjection=new lr,this._verticalPerspectiveProjection=new Fc}get transitionState(){const s=this.properties.get("type");if(typeof s=="string"&&s==="mercator")return 0;if(typeof s=="string"&&s==="vertical-perspective")return 1;if(s instanceof o.bm){if(s.from==="vertical-perspective"&&s.to==="mercator")return 1-s.transition;if(s.from==="mercator"&&s.to==="vertical-perspective")return s.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(s){this._mercatorProjection.updateGPUdependent(s),this._verticalPerspectiveProjection.updateGPUdependent(s)}getMeshFromTileID(s,d,g,v,w){return this.currentProjection.getMeshFromTileID(s,d,g,v,w)}setProjection(s){this._transitionable.setValue("type",s?.type||"mercator")}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}setErrorQueryLatitudeDegrees(s){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(s),this._mercatorProjection.setErrorQueryLatitudeDegrees(s)}}function Hl(x){const s=Ta(x.worldSize,x.center.lat);return 2*Math.PI*s}function fo(x,s,d,g,v){const w=1/(1<<v),C=s/o.$*w+g*w,B=o.bo((x/o.$*w+d*w)*Math.PI*2+Math.PI,2*Math.PI),O=2*Math.atan(Math.exp(Math.PI-C*Math.PI*2))-.5*Math.PI,F=Math.cos(O),U=new Float64Array(3);return U[0]=Math.sin(B)*F,U[1]=Math.sin(O),U[2]=Math.cos(B)*F,U}function Xi(x){return(function(s,d){const g=Math.cos(d),v=new Float64Array(3);return v[0]=Math.sin(s)*g,v[1]=Math.sin(d),v[2]=Math.cos(s)*g,v})(x.lng*Math.PI/180,x.lat*Math.PI/180)}function Ta(x,s){return x/(2*Math.PI)/Math.cos(s*Math.PI/180)}function jc(x){const s=Math.asin(x[1])/Math.PI*180,d=Math.sqrt(x[0]*x[0]+x[2]*x[2]);if(d>1e-6){const g=x[0]/d,v=Math.acos(x[2]/d),w=(g>0?v:-v)/Math.PI*180;return new o.S(o.aO(w,-180,180),s)}return new o.S(0,s)}function mn(x){return Math.cos(x*Math.PI/180)}function mi(x,s){const d=mn(x),g=mn(s);return o.ak(g/d)}function Oh(x,s){const d=x.rotate(s.bearingInRadians),g=s.zoom+mi(s.center.lat,0),v=o.bk(1/mn(s.center.lat),1/mn(Math.min(Math.abs(s.center.lat),60)),o.bn(g,7,3,0,1)),w=360/Hl({worldSize:s.worldSize,center:{lat:s.center.lat}});return new o.S(s.center.lng-d.x*w*v,o.ah(s.center.lat+d.y*w,-o.ai,o.ai))}function Sa(x){const s=.5*x,d=Math.sin(s),g=Math.cos(s);return Math.log(d+g)-Math.log(g-d)}function Yd(x,s,d,g){const v=x.lat+d*g;if(Math.abs(d)>1){const w=(Math.sign(x.lat+d)!==Math.sign(x.lat)?-Math.abs(x.lat):Math.abs(x.lat))*Math.PI/180,C=Math.abs(x.lat+d)*Math.PI/180,B=Sa(w+g*(C-w)),O=Sa(w),F=Sa(C);return new o.S(x.lng+s*((B-O)/(F-O)),v)}return new o.S(x.lng+s*g,v)}class Jd{constructor(s){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._boundingVolumeFactory=s}swapBuffers(){if(!this._hadAnyChanges)return;const s=this._cachePrevious;this._cachePrevious=this._cache,this._cache=s,this._cache.clear(),this._hadAnyChanges=!1}getTileBoundingVolume(s,d,g,v){const w=`${s.z}_${s.x}_${s.y}_${v?.terrain?"t":""}`,C=this._cache.get(w);if(C)return C;const B=this._cachePrevious.get(w);if(B)return this._cache.set(w,B),B;const O=this._boundingVolumeFactory(s,d,g,v);return this._cache.set(w,O),this._hadAnyChanges=!0,O}}class dl{constructor(s,d,g,v){this.min=g,this.max=v,this.points=s,this.planes=d}static fromAabb(s,d){const g=[];for(let v=0;v<8;v++)g.push([1&~v?s[0]:d[0],(v>>1&1)==1?d[1]:s[1],(v>>2&1)==1?d[2]:s[2]]);return new dl(g,[[-1,0,0,d[0]],[1,0,0,-s[0]],[0,-1,0,d[1]],[0,1,0,-s[1]],[0,0,-1,d[2]],[0,0,1,-s[2]]],s,d)}static fromCenterSizeAngles(s,d,g){const v=o.br([],g[0],g[1],g[2]),w=o.bs([],[d[0],0,0],v),C=o.bs([],[0,d[1],0],v),B=o.bs([],[0,0,d[2]],v),O=[...s],F=[...s];for(let K=0;K<8;K++)for(let W=0;W<3;W++){const X=s[W]+w[W]*(1&~K?-1:1)+C[W]*((K>>1&1)==1?1:-1)+B[W]*((K>>2&1)==1?1:-1);O[W]=Math.min(O[W],X),F[W]=Math.max(F[W],X)}const U=[];for(let K=0;K<8;K++){const W=[...s];o.aS(W,W,o.aR([],w,1&~K?-1:1)),o.aS(W,W,o.aR([],C,(K>>1&1)==1?1:-1)),o.aS(W,W,o.aR([],B,(K>>2&1)==1?1:-1)),U.push(W)}return new dl(U,[[...w,-o.aX(w,U[0])],[...C,-o.aX(C,U[0])],[...B,-o.aX(B,U[0])],[-w[0],-w[1],-w[2],-o.aX(w,U[7])],[-C[0],-C[1],-C[2],-o.aX(C,U[7])],[-B[0],-B[1],-B[2],-o.aX(B,U[7])]],O,F)}intersectsFrustum(s){let d=!0;const g=this.points.length,v=this.planes.length,w=s.planes.length,C=s.points.length;for(let B=0;B<w;B++){const O=s.planes[B];let F=0;for(let U=0;U<g;U++){const K=this.points[U];O[0]*K[0]+O[1]*K[1]+O[2]*K[2]+O[3]>=0&&F++}if(F===0)return 0;F<g&&(d=!1)}if(d)return 2;for(let B=0;B<v;B++){const O=this.planes[B];let F=0;for(let U=0;U<C;U++){const K=s.points[U];O[0]*K[0]+O[1]*K[1]+O[2]*K[2]+O[3]>=0&&F++}if(F===0)return 0}return 1}intersectsPlane(s){const d=this.points.length;let g=0;for(let v=0;v<d;v++){const w=this.points[v];s[0]*w[0]+s[1]*w[1]+s[2]*w[2]+s[3]>=0&&g++}return g===d?2:g===0?0:1}}function Yi(x,s,d){const g=x-s;return g<0?-g:Math.max(0,g-d)}function fl(x,s,d,g,v){const w=x-d;let C;return C=w<0?Math.min(-w,1+w-v):w>1?Math.min(Math.max(w-v,0),1-w):0,Math.max(C,Yi(s,g,v))}class Fo{constructor(){this._boundingVolumeCache=new Jd(this._computeTileBoundingVolume)}prepareNextFrame(){this._boundingVolumeCache.swapBuffers()}distanceToTile2d(s,d,g,v){const w=1<<g.z,C=1/w,B=g.x/w,O=g.y/w;let F=2;return F=Math.min(F,fl(s,d,B,O,C)),F=Math.min(F,fl(s,d,B+.5,-O-C,C)),F=Math.min(F,fl(s,d,B+.5,2-O-C,C)),F}getWrap(s,d,g){const v=1<<d.z,w=1/v,C=d.x/v,B=Yi(s.x,C,w),O=Yi(s.x,C-1,w),F=Yi(s.x,C+1,w),U=Math.min(B,O,F);return U===F?1:U===O?-1:0}allowVariableZoom(s,d){return Dt(s,d)>4}allowWorldCopies(){return!1}getTileBoundingVolume(s,d,g,v){return this._boundingVolumeCache.getTileBoundingVolume(s,d,g,v)}_computeTileBoundingVolume(s,d,g,v){var w,C;let B=0,O=0;if(v?.terrain){const F=new o.Z(s.z,d,s.z,s.x,s.y),U=v.terrain.getMinMaxElevation(F);B=(w=U.minElevation)!==null&&w!==void 0?w:Math.min(0,g),O=(C=U.maxElevation)!==null&&C!==void 0?C:Math.max(0,g)}if(B/=o.bu,O/=o.bu,B+=1,O+=1,s.z<=0)return dl.fromAabb([-O,-O,-O],[O,O,O]);if(s.z===1)return dl.fromAabb([s.x===0?-O:0,s.y===0?0:-O,-O],[s.x===0?0:O,s.y===0?O:0,O]);{const F=[fo(0,0,s.x,s.y,s.z),fo(o.$,0,s.x,s.y,s.z),fo(o.$,o.$,s.x,s.y,s.z),fo(0,o.$,s.x,s.y,s.z)],U=[];for(const Ze of F)U.push(o.aR([],Ze,O));if(O!==B)for(const Ze of F)U.push(o.aR([],Ze,B));s.y===0&&U.push([0,1,0]),s.y===(1<<s.z)-1&&U.push([0,-1,0]);const K=[1,1,1],W=[-1,-1,-1];for(const Ze of U)for(let tt=0;tt<3;tt++)K[tt]=Math.min(K[tt],Ze[tt]),W[tt]=Math.max(W[tt],Ze[tt]);const X=fo(o.$/2,o.$/2,s.x,s.y,s.z),re=o.aW([],[0,1,0],X);o.aV(re,re);const ue=o.aW([],X,re);o.aV(ue,ue);const fe=o.aW([],F[2],F[1]);o.aV(fe,fe);const pe=o.aW([],F[0],F[3]);o.aV(pe,pe),U.push(o.aR([],X,O)),s.y>=(1<<s.z)/2&&U.push(o.aR([],fo(o.$/2,0,s.x,s.y,s.z),O)),s.y<(1<<s.z)/2&&U.push(o.aR([],fo(o.$/2,o.$,s.x,s.y,s.z),O));const _e=Ou(X,U),we=Ou(ue,U),ye=[-X[0],-X[1],-X[2],_e.max],Te=[X[0],X[1],X[2],-_e.min],Ie=[-ue[0],-ue[1],-ue[2],we.max],be=[ue[0],ue[1],ue[2],-we.min],ke=[...fe,0],Xe=[...pe,0],qe=[];return s.y===0?qe.push(o.bt(Xe,ke,ye),o.bt(Xe,ke,Te)):qe.push(o.bt(Ie,ke,ye),o.bt(Ie,ke,Te),o.bt(Ie,Xe,ye),o.bt(Ie,Xe,Te)),s.y===(1<<s.z)-1?qe.push(o.bt(Xe,ke,ye),o.bt(Xe,ke,Te)):qe.push(o.bt(be,ke,ye),o.bt(be,ke,Te),o.bt(be,Xe,ye),o.bt(be,Xe,Te)),new dl(qe,[ye,Te,Ie,be,ke,Xe],K,W)}}}function Ou(x,s){let d=1/0,g=-1/0;for(const v of s){const w=o.aX(x,v);d=Math.min(d,w),g=Math.max(g,w)}return{min:d,max:g}}class Du{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(s){this._helper.setMinZoom(s)}setMaxZoom(s){this._helper.setMaxZoom(s)}setMinPitch(s){this._helper.setMinPitch(s)}setMaxPitch(s){this._helper.setMaxPitch(s)}setRenderWorldCopies(s){this._helper.setRenderWorldCopies(s)}setBearing(s){this._helper.setBearing(s)}setPitch(s){this._helper.setPitch(s)}setRoll(s){this._helper.setRoll(s)}setFov(s){this._helper.setFov(s)}setZoom(s){this._helper.setZoom(s)}setCenter(s){this._helper.setCenter(s)}setElevation(s){this._helper.setElevation(s)}setMinElevationForCurrentTile(s){this._helper.setMinElevationForCurrentTile(s)}setPadding(s){this._helper.setPadding(s)}interpolatePadding(s,d,g){return this._helper.interpolatePadding(s,d,g)}isPaddingEqual(s){return this._helper.isPaddingEqual(s)}resize(s,d){this._helper.resize(s,d)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(s){this._helper.setMaxBounds(s)}overrideNearFarZ(s,d){this._helper.overrideNearFarZ(s,d)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(s){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),s)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(s){}constructor(){this._cachedClippingPlane=o.bv(),this._projectionMatrix=o.b9(),this._globeViewProjMatrix32f=o.b8(),this._globeViewProjMatrixNoCorrection=o.b9(),this._globeViewProjMatrixNoCorrectionInverted=o.b9(),this._globeProjMatrixInverted=o.b9(),this._cameraPosition=o.bp(),this._globeLatitudeErrorCorrectionRadians=0,this._helper=new Gi({calcMatrices:()=>{this._calcMatrices()},getConstrained:(s,d)=>this.getConstrained(s,d)}),this._coveringTilesDetailsProvider=new Fo}clone(){const s=new Du;return s.apply(this),s}apply(s,d){this._globeLatitudeErrorCorrectionRadians=d||0,this._helper.apply(s)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){const s=o.bp();return s[0]=this._cameraPosition[0],s[1]=this._cameraPosition[1],s[2]=this._cameraPosition[2],s}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(s){const{overscaledTileID:d,applyGlobeMatrix:g}=s,v=this._helper.getMercatorTileCoordinates(d);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:v,clippingPlane:this._cachedClippingPlane,projectionTransition:g?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(s){const d=this.pitchInRadians,g=this.cameraToCenterDistance/s,v=Math.sin(d)*g,w=Math.cos(d)*g+1,C=1/Math.sqrt(v*v+w*w)*1;let B=-v,O=w;const F=Math.sqrt(B*B+O*O);B/=F,O/=F;const U=[0,B,O];o.bw(U,U,[0,0,0],-this.bearingInRadians),o.bx(U,U,[0,0,0],-1*this.center.lat*Math.PI/180),o.by(U,U,[0,0,0],this.center.lng*Math.PI/180);const K=1/o.aZ(U);return o.aR(U,U,K),[...U,-C*K]}isLocationOccluded(s){return!this.isSurfacePointVisible(Xi(s))}transformLightDirection(s){const d=this._helper._center.lng*Math.PI/180,g=this._helper._center.lat*Math.PI/180,v=Math.cos(g),w=[Math.sin(d)*v,Math.sin(g),Math.cos(d)*v],C=[w[2],0,-w[0]],B=[0,0,0];o.aW(B,C,w),o.aV(C,C),o.aV(B,B);const O=[0,0,0];return o.aV(O,[C[0]*s[0]+B[0]*s[1]+w[0]*s[2],C[1]*s[0]+B[1]*s[1]+w[1]*s[2],C[2]*s[0]+B[2]*s[1]+w[2]*s[2]]),O}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(s,d,g){const v=(function(B,O,F){const U=1/(1<<F.z);return new o.a1(B/o.$*U+F.x*U,O/o.$*U+F.y*U)})(s,d,g.canonical),w=(C=v.y,[o.bo(v.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-C*Math.PI*2))-.5*Math.PI]);var C;return this.getCircleRadiusCorrection()/Math.cos(w[1])}projectTileCoordinates(s,d,g,v){const w=g.canonical,C=fo(s,d,w.x,w.y,w.z),B=1+(v?v(s,d):0)/o.bu,O=[C[0]*B,C[1]*B,C[2]*B,1];o.aw(O,O,this._globeViewProjMatrixNoCorrection);const F=this._cachedClippingPlane,U=F[0]*C[0]+F[1]*C[1]+F[2]*C[2]+F[3]<0;return{point:new o.P(O[0]/O[3],O[1]/O[3]),signedDistanceFromCamera:O[3],isOccluded:U}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;const s=Ta(this.worldSize,this.center.lat),d=o.ba(),g=o.ba();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*s),o.b4(d,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);const v=this.centerOffset;d[8]=2*-v.x/this._helper._width,d[9]=2*v.y/this._helper._height,this._projectionMatrix=o.b5(d),this._globeProjMatrixInverted=o.ba(),o.aq(this._globeProjMatrixInverted,d),o.M(d,d,[0,0,-this.cameraToCenterDistance]),o.b6(d,d,this.rollInRadians),o.b7(d,d,-this.pitchInRadians),o.b6(d,d,this.bearingInRadians),o.M(d,d,[0,0,-s]);const w=o.bp();w[0]=s,w[1]=s,w[2]=s,o.b7(g,d,this.center.lat*Math.PI/180),o.bz(g,g,-this.center.lng*Math.PI/180),o.N(g,g,w),this._globeViewProjMatrixNoCorrection=g,o.b7(d,d,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),o.bz(d,d,-this.center.lng*Math.PI/180),o.N(d,d,w),this._globeViewProjMatrix32f=new Float32Array(d),this._globeViewProjMatrixNoCorrectionInverted=o.ba(),o.aq(this._globeViewProjMatrixNoCorrectionInverted,g);const C=o.bp();this._cameraPosition=o.bp(),this._cameraPosition[2]=this.cameraToCenterDistance/s,o.bw(this._cameraPosition,this._cameraPosition,C,-this.rollInRadians),o.bx(this._cameraPosition,this._cameraPosition,C,this.pitchInRadians),o.bw(this._cameraPosition,this._cameraPosition,C,-this.bearingInRadians),o.aS(this._cameraPosition,this._cameraPosition,[0,0,1]),o.bx(this._cameraPosition,this._cameraPosition,C,-this.center.lat*Math.PI/180),o.by(this._cameraPosition,this._cameraPosition,C,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(s);const B=o.b5(this._globeViewProjMatrixNoCorrectionInverted);o.N(B,B,[1,1,-1]),this._cachedFrustum=pi.fromInvProjectionMatrix(B,1,0,this._cachedClippingPlane,!0)}calculateFogMatrix(s){o.w("calculateFogMatrix is not supported on globe projection.");const d=o.ba();return o.ag(d),d}getVisibleUnwrappedCoordinates(s){return[new o.b2(0,s)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(s){s&&o.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(s,d){if(!this._globeViewProjMatrixNoCorrection)return 1;const g=Xi(s);o.aR(g,g,1+d/o.bu);const v=o.bv();return o.aw(v,[g[0],g[1],g[2],1],this._globeViewProjMatrixNoCorrection),v[2]/v[3]}populateCache(s){}getBounds(){const s=.5*this.width,d=.5*this.height,g=[new o.P(0,0),new o.P(s,0),new o.P(this.width,0),new o.P(this.width,d),new o.P(this.width,this.height),new o.P(s,this.height),new o.P(0,this.height),new o.P(0,d)],v=[];for(const K of g)v.push(this.unprojectScreenPoint(K));let w=0,C=0,B=0,O=0;const F=this.center;for(const K of v){const W=o.bA(F.lng,K.lng),X=o.bA(F.lat,K.lat);W<C&&(C=W),W>w&&(w=W),X<O&&(O=X),X>B&&(B=X)}const U=[F.lng+C,F.lat+O,F.lng+w,F.lat+B];return this.isSurfacePointOnScreen([0,1,0])&&(U[3]=90,U[0]=-180,U[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(U[1]=-90,U[0]=-180,U[2]=180),new Zr(U)}getConstrained(s,d){const g=o.ah(s.lat,-o.ai,o.ai),v=o.ah(+d,this.minZoom+mi(0,g),this.maxZoom);return{center:new o.S(s.lng,g),zoom:v}}calculateCenterFromCameraLngLatAlt(s,d,g,v){return this._helper.calculateCenterFromCameraLngLatAlt(s,d,g,v)}setLocationAtPoint(s,d){const g=Xi(this.unprojectScreenPoint(d)),v=Xi(s),w=o.bp();o.bB(w);const C=o.bp();o.by(C,g,w,-this.center.lng*Math.PI/180),o.bx(C,C,w,this.center.lat*Math.PI/180);const B=v[0]*v[0]+v[2]*v[2],O=C[0]*C[0];if(B<O)return;const F=Math.sqrt(B-O),U=-F,K=o.bC(v[0],v[2],C[0],F),W=o.bC(v[0],v[2],C[0],U),X=o.bp();o.by(X,v,w,-K);const re=o.bC(X[1],X[2],C[1],C[2]),ue=o.bp();o.by(ue,v,w,-W);const fe=o.bC(ue[1],ue[2],C[1],C[2]),pe=.5*Math.PI,_e=re>=-pe&&re<=pe,we=fe>=-pe&&fe<=pe;let ye,Te;if(_e&&we){const Xe=this.center.lng*Math.PI/180,qe=this.center.lat*Math.PI/180;o.bD(K,Xe)+o.bD(re,qe)<o.bD(W,Xe)+o.bD(fe,qe)?(ye=K,Te=re):(ye=W,Te=fe)}else if(_e)ye=K,Te=re;else{if(!we)return;ye=W,Te=fe}const Ie=ye/Math.PI*180,be=Te/Math.PI*180,ke=this.center.lat;this.setCenter(new o.S(Ie,o.ah(be,-90,90))),this.setZoom(this.zoom+mi(ke,this.center.lat))}locationToScreenPoint(s,d){const g=Xi(s);if(d){const v=d.getElevationForLngLatZoom(s,this._helper._tileZoom);o.aR(g,g,1+v/o.bu)}return this._projectSurfacePointToScreen(g)}_projectSurfacePointToScreen(s){const d=o.bv();return o.aw(d,[...s,1],this._globeViewProjMatrixNoCorrection),d[0]/=d[3],d[1]/=d[3],new o.P((.5*d[0]+.5)*this.width,(.5*-d[1]+.5)*this.height)}screenPointToMercatorCoordinate(s,d){if(d){const g=d.pointCoordinate(s);if(g)return g}return o.a1.fromLngLat(this.unprojectScreenPoint(s))}screenPointToLocation(s,d){var g;return(g=this.screenPointToMercatorCoordinate(s,d))===null||g===void 0?void 0:g.toLngLat()}isPointOnMapSurface(s,d){const g=this._cameraPosition,v=this.getRayDirectionFromPixel(s);return!!this.rayPlanetIntersection(g,v)}getRayDirectionFromPixel(s){const d=o.bv();d[0]=s.x/this.width*2-1,d[1]=-1*(s.y/this.height*2-1),d[2]=1,d[3]=1,o.aw(d,d,this._globeViewProjMatrixNoCorrectionInverted),d[0]/=d[3],d[1]/=d[3],d[2]/=d[3];const g=o.bp();g[0]=d[0]-this._cameraPosition[0],g[1]=d[1]-this._cameraPosition[1],g[2]=d[2]-this._cameraPosition[2];const v=o.bp();return o.aV(v,g),v}isSurfacePointVisible(s){const d=this._cachedClippingPlane;return d[0]*s[0]+d[1]*s[1]+d[2]*s[2]+d[3]>=0}isSurfacePointOnScreen(s){if(!this.isSurfacePointVisible(s))return!1;const d=o.bv();return o.aw(d,[...s,1],this._globeViewProjMatrixNoCorrection),d[0]/=d[3],d[1]/=d[3],d[2]/=d[3],d[0]>-1&&d[0]<1&&d[1]>-1&&d[1]<1&&d[2]>-1&&d[2]<1}rayPlanetIntersection(s,d){const g=o.aX(s,d),v=o.bp(),w=o.bp();o.aR(w,d,g),o.aU(v,s,w);const C=1-o.aX(v,v);if(C<0)return null;const B=o.aX(s,s)-1,O=-g+(g<0?1:-1)*Math.sqrt(C),F=B/O,U=O;return{tMin:Math.min(F,U),tMax:Math.max(F,U)}}unprojectScreenPoint(s){const d=this._cameraPosition,g=this.getRayDirectionFromPixel(s),v=this.rayPlanetIntersection(d,g);if(v){const U=o.bp();o.aS(U,d,[g[0]*v.tMin,g[1]*v.tMin,g[2]*v.tMin]);const K=o.bp();return o.aV(K,U),jc(K)}const w=this._cachedClippingPlane,C=w[0]*g[0]+w[1]*g[1]+w[2]*g[2],B=-o.b1(w,d)/C,O=o.bp();if(B>0)o.aS(O,d,[g[0]*B,g[1]*B,g[2]*B]);else{const U=o.bp();o.aS(U,d,[2*g[0],2*g[1],2*g[2]]);const K=o.b1(this._cachedClippingPlane,U);o.aU(O,U,[this._cachedClippingPlane[0]*K,this._cachedClippingPlane[1]*K,this._cachedClippingPlane[2]*K])}const F=(function(U){const K=o.bp();return K[0]=U[0]*-U[3],K[1]=U[1]*-U[3],K[2]=U[2]*-U[3],{center:K,radius:Math.sqrt(1-U[3]*U[3])}})(w);return jc((function(U,K,W){const X=o.bp();o.aU(X,W,U);const re=o.bp();return o.bq(re,U,X,K/o.a$(X)),re})(F.center,F.radius,O))}getMatrixForModel(s,d){const g=o.S.convert(s),v=1/o.bu,w=o.b9();return o.bz(w,w,g.lng/180*Math.PI),o.b7(w,w,-g.lat/180*Math.PI),o.M(w,w,[0,0,1+d/o.bu]),o.b7(w,w,.5*Math.PI),o.N(w,w,[v,v,v]),w}getProjectionDataForCustomLayer(s=!0){const d=this.getProjectionData({overscaledTileID:new o.Z(0,0,0,0,0),applyGlobeMatrix:s});return d.tileMercatorCoords=[0,0,1,1],d}getFastPathSimpleProjectionMatrix(s){}}class Nu{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(s){this._helper.setMinZoom(s)}setMaxZoom(s){this._helper.setMaxZoom(s)}setMinPitch(s){this._helper.setMinPitch(s)}setMaxPitch(s){this._helper.setMaxPitch(s)}setRenderWorldCopies(s){this._helper.setRenderWorldCopies(s)}setBearing(s){this._helper.setBearing(s)}setPitch(s){this._helper.setPitch(s)}setRoll(s){this._helper.setRoll(s)}setFov(s){this._helper.setFov(s)}setZoom(s){this._helper.setZoom(s)}setCenter(s){this._helper.setCenter(s)}setElevation(s){this._helper.setElevation(s)}setMinElevationForCurrentTile(s){this._helper.setMinElevationForCurrentTile(s)}setPadding(s){this._helper.setPadding(s)}interpolatePadding(s,d,g){return this._helper.interpolatePadding(s,d,g)}isPaddingEqual(s){return this._helper.isPaddingEqual(s)}resize(s,d,g=!0){this._helper.resize(s,d,g)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(s){this._helper.setMaxBounds(s)}overrideNearFarZ(s,d){this._helper.overrideNearFarZ(s,d)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(s){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),s)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(s,d){this._globeness=s,this._globeLatitudeErrorCorrectionRadians=d,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().prepareNextFrame(),this._mercatorTransform.getCoveringTilesDetailsProvider().prepareNextFrame()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this._helper=new Gi({calcMatrices:()=>{this._calcMatrices()},getConstrained:(s,d)=>this.getConstrained(s,d)}),this._globeness=1,this._mercatorTransform=new ci,this._verticalPerspectiveTransform=new Du}clone(){const s=new Nu;return s._globeness=this._globeness,s._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,s.apply(this),s}apply(s){this._helper.apply(s),this._mercatorTransform.apply(this),this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(s){const d=this._mercatorTransform.getProjectionData(s),g=this._verticalPerspectiveTransform.getProjectionData(s);return{mainMatrix:this.isGlobeRendering?g.mainMatrix:d.mainMatrix,clippingPlane:g.clippingPlane,tileMercatorCoords:g.tileMercatorCoords,projectionTransition:s.applyGlobeMatrix?this._globeness:0,fallbackMatrix:d.fallbackMatrix}}isLocationOccluded(s){return this.currentTransform.isLocationOccluded(s)}transformLightDirection(s){return this.currentTransform.transformLightDirection(s)}getPixelScale(){return o.bk(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return o.bk(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(s,d,g){const v=this._mercatorTransform.getPitchedTextCorrection(s,d,g),w=this._verticalPerspectiveTransform.getPitchedTextCorrection(s,d,g);return o.bk(v,w,this._globeness)}projectTileCoordinates(s,d,g,v){return this.currentTransform.projectTileCoordinates(s,d,g,v)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(s){return this.currentTransform.calculateFogMatrix(s)}getVisibleUnwrappedCoordinates(s){return this.currentTransform.getVisibleUnwrappedCoordinates(s)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(s){this._mercatorTransform.recalculateZoomAndCenter(s),this._verticalPerspectiveTransform.recalculateZoomAndCenter(s)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(s,d){return this.currentTransform.lngLatToCameraDepth(s,d)}populateCache(s){this._mercatorTransform.populateCache(s),this._verticalPerspectiveTransform.populateCache(s)}getBounds(){return this.currentTransform.getBounds()}getConstrained(s,d){return this.currentTransform.getConstrained(s,d)}calculateCenterFromCameraLngLatAlt(s,d,g,v){return this._helper.calculateCenterFromCameraLngLatAlt(s,d,g,v)}setLocationAtPoint(s,d){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(s,d),void this.apply(this._mercatorTransform);this._verticalPerspectiveTransform.setLocationAtPoint(s,d),this.apply(this._verticalPerspectiveTransform)}locationToScreenPoint(s,d){return this.currentTransform.locationToScreenPoint(s,d)}screenPointToMercatorCoordinate(s,d){return this.currentTransform.screenPointToMercatorCoordinate(s,d)}screenPointToLocation(s,d){return this.currentTransform.screenPointToLocation(s,d)}isPointOnMapSurface(s,d){return this.currentTransform.isPointOnMapSurface(s,d)}getRayDirectionFromPixel(s){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(s)}getMatrixForModel(s,d){return this.currentTransform.getMatrixForModel(s,d)}getProjectionDataForCustomLayer(s=!0){const d=this._mercatorTransform.getProjectionDataForCustomLayer(s);if(!this.isGlobeRendering)return d;const g=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(s);return g.fallbackMatrix=d.mainMatrix,g}getFastPathSimpleProjectionMatrix(s){return this.currentTransform.getFastPathSimpleProjectionMatrix(s)}}class Sn{get useGlobeControls(){return!0}handlePanInertia(s,d){const g=Oh(s,d);return Math.abs(g.lng-d.center.lng)>180&&(g.lng=d.center.lng+179.5*Math.sign(g.lng-d.center.lng)),{easingCenter:g,easingOffset:new o.P(0,0)}}handleMapControlsRollPitchBearingZoom(s,d){const g=s.around,v=d.screenPointToLocation(g);s.bearingDelta&&d.setBearing(d.bearing+s.bearingDelta),s.pitchDelta&&d.setPitch(d.pitch+s.pitchDelta),s.rollDelta&&d.setRoll(d.roll+s.rollDelta);const w=d.zoom;s.zoomDelta&&d.setZoom(d.zoom+s.zoomDelta);const C=d.zoom-w;if(C===0)return;const B=o.bA(d.center.lng,v.lng),O=B/(Math.abs(B/180)+1),F=o.bA(d.center.lat,v.lat),U=d.getRayDirectionFromPixel(g),K=d.cameraPosition,W=-1*o.aX(K,U),X=o.bp();o.aS(X,K,[U[0]*W,U[1]*W,U[2]*W]);const re=o.aZ(X)-1,ue=Math.exp(.5*-Math.max(re-.3,0)),fe=Ta(d.worldSize,d.center.lat)/Math.min(d.width,d.height),pe=o.bn(fe,.9,.5,1,.25),_e=(1-o.af(-C))*Math.min(ue,pe),we=d.center.lat,ye=d.zoom,Te=new o.S(d.center.lng+O*_e,o.ah(d.center.lat+F*_e,-o.ai,o.ai));d.setLocationAtPoint(v,g);const Ie=d.center,be=o.bn(Math.abs(B),45,85,0,1),ke=o.bn(fe,.75,.35,0,1),Xe=Math.pow(Math.max(be,ke),.25),qe=o.bA(Ie.lng,Te.lng),Ze=o.bA(Ie.lat,Te.lat);d.setCenter(new o.S(Ie.lng+qe*Xe,Ie.lat+Ze*Xe).wrap()),d.setZoom(ye+mi(we,d.center.lat))}handleMapControlsPan(s,d,g){if(!s.panDelta)return;const v=d.center.lat,w=d.zoom;d.setCenter(Oh(s.panDelta,d).wrap()),d.setZoom(w+mi(v,d.center.lat))}cameraForBoxAndBearing(s,d,g,v,w){const C=$s(s,d,g,v,w),B=d.left/w.width*2-1,O=(w.width-d.right)/w.width*2-1,F=d.top/w.height*-2+1,U=(w.height-d.bottom)/w.height*-2+1,K=o.bA(g.getWest(),g.getEast())<0,W=K?g.getEast():g.getWest(),X=K?g.getWest():g.getEast(),re=Math.max(g.getNorth(),g.getSouth()),ue=Math.min(g.getNorth(),g.getSouth()),fe=W+.5*o.bA(W,X),pe=re+.5*o.bA(re,ue),_e=w.clone();_e.setCenter(C.center),_e.setBearing(C.bearing),_e.setPitch(0),_e.setRoll(0),_e.setZoom(C.zoom);const we=_e.modelViewProjectionMatrix,ye=[Xi(g.getNorthWest()),Xi(g.getNorthEast()),Xi(g.getSouthWest()),Xi(g.getSouthEast()),Xi(new o.S(X,pe)),Xi(new o.S(W,pe)),Xi(new o.S(fe,re)),Xi(new o.S(fe,ue))],Te=Xi(C.center);let Ie=Number.POSITIVE_INFINITY;for(const be of ye)B<0&&(Ie=Sn.getLesserNonNegativeNonNull(Ie,Sn.solveVectorScale(be,Te,we,"x",B))),O>0&&(Ie=Sn.getLesserNonNegativeNonNull(Ie,Sn.solveVectorScale(be,Te,we,"x",O))),F>0&&(Ie=Sn.getLesserNonNegativeNonNull(Ie,Sn.solveVectorScale(be,Te,we,"y",F))),U<0&&(Ie=Sn.getLesserNonNegativeNonNull(Ie,Sn.solveVectorScale(be,Te,we,"y",U)));if(Number.isFinite(Ie)&&Ie!==0)return C.zoom=_e.zoom+o.ak(Ie),C;Xd()}handleJumpToCenterZoom(s,d){const g=s.center.lat,v=s.getConstrained(d.center?o.S.convert(d.center):s.center,s.zoom).center;s.setCenter(v.wrap());const w=d.zoom!==void 0?+d.zoom:s.zoom+mi(g,v.lat);s.zoom!==w&&s.setZoom(w)}handleEaseTo(s,d){const g=s.zoom,v=s.center,w=s.padding,C={roll:s.roll,pitch:s.pitch,bearing:s.bearing},B={roll:d.roll===void 0?s.roll:d.roll,pitch:d.pitch===void 0?s.pitch:d.pitch,bearing:d.bearing===void 0?s.bearing:d.bearing},O=d.zoom!==void 0,F=!s.isPaddingEqual(d.padding);let U=!1;const K=d.center?o.S.convert(d.center):v,W=s.getConstrained(K,g).center;Vi(s,W);const X=s.clone();X.setCenter(W),X.setZoom(O?+d.zoom:g+mi(v.lat,K.lat)),X.setBearing(d.bearing);const re=new o.P(o.ah(s.centerPoint.x+d.offsetAsPoint.x,0,s.width),o.ah(s.centerPoint.y+d.offsetAsPoint.y,0,s.height));X.setLocationAtPoint(W,re);const ue=(d.offset&&d.offsetAsPoint.mag())>0?X.center:W,fe=O?+d.zoom:g+mi(v.lat,ue.lat),pe=g+mi(v.lat,0),_e=fe+mi(ue.lat,0),we=o.bA(v.lng,ue.lng),ye=o.bA(v.lat,ue.lat),Te=o.af(_e-pe);return U=fe!==g,{easeFunc:Ie=>{if(o.be(C,B)||pn({startEulerAngles:C,endEulerAngles:B,tr:s,k:Ie,useSlerp:C.roll!=B.roll}),F&&s.interpolatePadding(w,d.padding,Ie),d.around)o.w("Easing around a point is not supported under globe projection."),s.setLocationAtPoint(d.around,d.aroundPoint);else{const be=_e>pe?Math.min(2,Te):Math.max(.5,Te),ke=Math.pow(be,1-Ie),Xe=Yd(v,we,ye,Ie*ke);s.setCenter(Xe.wrap())}if(U){const be=o.C.number(pe,_e,Ie)+mi(0,s.center.lat);s.setZoom(be)}},isZooming:U,elevationCenter:ue}}handleFlyTo(s,d){const g=d.zoom!==void 0,v=s.center,w=s.zoom,C=s.padding,B=!s.isPaddingEqual(d.padding),O=s.getConstrained(o.S.convert(d.center||d.locationAtOffset),w).center,F=g?+d.zoom:s.zoom+mi(s.center.lat,O.lat),U=s.clone();U.setCenter(O),U.setZoom(F),U.setBearing(d.bearing);const K=new o.P(o.ah(s.centerPoint.x+d.offsetAsPoint.x,0,s.width),o.ah(s.centerPoint.y+d.offsetAsPoint.y,0,s.height));U.setLocationAtPoint(O,K);const W=U.center;Vi(s,W);const X=(function(ye,Te,Ie){const be=Xi(Te),ke=Xi(Ie),Xe=o.aX(be,ke),qe=Math.acos(Xe),Ze=Hl(ye);return qe/(2*Math.PI)*Ze})(s,v,W),re=w+mi(v.lat,0),ue=F+mi(W.lat,0),fe=o.af(ue-re);let pe;if(typeof d.minZoom=="number"){const ye=+d.minZoom+mi(W.lat,0),Te=Math.min(ye,re,ue)+mi(0,W.lat),Ie=s.getConstrained(W,Te).zoom+mi(W.lat,0);pe=o.af(Ie-re)}const _e=o.bA(v.lng,W.lng),we=o.bA(v.lat,W.lat);return{easeFunc:(ye,Te,Ie,be)=>{const ke=Yd(v,_e,we,Ie);B&&s.interpolatePadding(C,d.padding,ye);const Xe=ye===1?W:ke;s.setCenter(Xe.wrap());const qe=re+o.ak(Te);s.setZoom(ye===1?F:qe+mi(0,Xe.lat))},scaleOfZoom:fe,targetCenter:W,scaleOfMinZoom:pe,pixelPathLength:X}}static solveVectorScale(s,d,g,v,w){const C=v==="x"?[g[0],g[4],g[8],g[12]]:[g[1],g[5],g[9],g[13]],B=[g[3],g[7],g[11],g[15]],O=s[0]*C[0]+s[1]*C[1]+s[2]*C[2],F=s[0]*B[0]+s[1]*B[1]+s[2]*B[2],U=d[0]*C[0]+d[1]*C[1]+d[2]*C[2],K=d[0]*B[0]+d[1]*B[1]+d[2]*B[2];return U+w*F===O+w*K||B[3]*(O-U)+C[3]*(K-F)+O*K==U*F?null:(U+C[3]-w*K-w*B[3])/(U-O-w*K+w*F)}static getLesserNonNegativeNonNull(s,d){return d!==null&&d>=0&&d<s?d:s}}class Np{constructor(s){this._globe=s,this._mercatorCameraHelper=new Nn,this._verticalPerspectiveCameraHelper=new Sn}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(s,d){return this.currentHelper.handlePanInertia(s,d)}handleMapControlsRollPitchBearingZoom(s,d){return this.currentHelper.handleMapControlsRollPitchBearingZoom(s,d)}handleMapControlsPan(s,d,g){this.currentHelper.handleMapControlsPan(s,d,g)}cameraForBoxAndBearing(s,d,g,v,w){return this.currentHelper.cameraForBoxAndBearing(s,d,g,v,w)}handleJumpToCenterZoom(s,d){this.currentHelper.handleJumpToCenterZoom(s,d)}handleEaseTo(s,d){return this.currentHelper.handleEaseTo(s,d)}handleFlyTo(s,d){return this.currentHelper.handleFlyTo(s,d)}}const Dh=(x,s)=>o.y(x,s&&s.filter((d=>d.identifier!=="source.canvas"))),Og=o.bE();class Qd extends o.E{constructor(s,d={}){super(),this._rtlPluginLoaded=()=>{for(const g in this.sourceCaches){const v=this.sourceCaches[g].getSource().type;v!=="vector"&&v!=="geojson"||this.sourceCaches[g].reload()}},this.map=s,this.dispatcher=new yr(Pr(),s._getMapId()),this.dispatcher.registerMessageHandler("GG",((g,v)=>this.getGlyphs(g,v))),this.dispatcher.registerMessageHandler("GI",((g,v)=>this.getImages(g,v))),this.imageManager=new $e,this.imageManager.setEventedParent(this),this.glyphManager=new sr(s._requestManager,d.localIdeographFontFamily),this.lineAtlas=new ft(256,512),this.crossTileSymbolIndex=new ae,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new o.bF,this._loaded=!1,this._availableImages=[],this._globalState={},this._resetUpdates(),this.dispatcher.broadcast("SR",o.bG()),Gs().on(ea,this._rtlPluginLoaded),this.on("data",(g=>{if(g.dataType!=="source"||g.sourceDataType!=="metadata")return;const v=this.sourceCaches[g.sourceId];if(!v)return;const w=v.getSource();if(w&&w.vectorLayerIds)for(const C in this._layers){const B=this._layers[C];B.source===w.id&&this._validateLayer(B)}}))}setGlobalStateProperty(s,d){var g,v,w;this._checkLoaded();const C=d===null?(w=(v=(g=this.stylesheet.state)===null||g===void 0?void 0:g[s])===null||v===void 0?void 0:v.default)!==null&&w!==void 0?w:null:d;if(o.bH(C,this._globalState[s]))return this;this._globalState[s]=C;const B=this._findGlobalStateAffectedSources([s]);for(const O in this.sourceCaches)B.has(O)&&(this._reloadSource(O),this._changed=!0)}getGlobalState(){return this._globalState}setGlobalState(s){this._checkLoaded();const d=[];for(const v in s)!o.bH(this._globalState[v],s[v].default)&&(d.push(v),this._globalState[v]=s[v].default);const g=this._findGlobalStateAffectedSources(d);for(const v in this.sourceCaches)g.has(v)&&(this._reloadSource(v),this._changed=!0)}_findGlobalStateAffectedSources(s){if(s.length===0)return new Set;const d=new Set;for(const g in this._layers){const v=this._layers[g],w=v.getLayoutAffectingGlobalStateRefs();for(const C of s)w.has(C)&&d.add(v.source)}return d}loadURL(s,d={},g){this.fire(new o.l("dataloading",{dataType:"style"})),d.validate=typeof d.validate!="boolean"||d.validate;const v=this.map._requestManager.transformRequest(s,"Style");this._loadStyleRequest=new AbortController;const w=this._loadStyleRequest;o.j(v,this._loadStyleRequest).then((C=>{this._loadStyleRequest=null,this._load(C.data,d,g)})).catch((C=>{this._loadStyleRequest=null,C&&!w.signal.aborted&&this.fire(new o.k(C))}))}loadJSON(s,d={},g){this.fire(new o.l("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,M.frameAsync(this._frameRequest).then((()=>{this._frameRequest=null,d.validate=d.validate!==!1,this._load(s,d,g)})).catch((()=>{}))}loadEmpty(){this.fire(new o.l("dataloading",{dataType:"style"})),this._load(Og,{validate:!1})}_load(s,d,g){var v,w,C;const B=d.transformStyle?d.transformStyle(g,s):s;if(!d.validate||!Dh(this,o.z(B))){this._loaded=!0,this.stylesheet=B;for(const O in B.sources)this.addSource(O,B.sources[O],{validate:!1});B.sprite?this._loadSprite(B.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(B.glyphs),this._createLayers(),this.light=new Lt(this.stylesheet.light),this._setProjectionInternal(((v=this.stylesheet.projection)===null||v===void 0?void 0:v.type)||"mercator"),this.sky=new Ke(this.stylesheet.sky),this.map.setTerrain((w=this.stylesheet.terrain)!==null&&w!==void 0?w:null),this.setGlobalState((C=this.stylesheet.state)!==null&&C!==void 0?C:null),this.fire(new o.l("data",{dataType:"style"})),this.fire(new o.l("style.load"))}}_createLayers(){const s=o.bI(this.stylesheet.layers);this.dispatcher.broadcast("SL",s),this._order=s.map((d=>d.id)),this._layers={},this._serializedLayers=null;for(const d of s){const g=o.bJ(d);g.setEventedParent(this,{layer:{id:d.id}}),this._layers[d.id]=g}}_loadSprite(s,d=!1,g=void 0){let v;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,(function(w,C,B,O){return o._(this,void 0,void 0,(function*(){const F=Me(w),U=B>1?"@2x":"",K={},W={};for(const{id:X,url:re}of F){const ue=C.transformRequest(Ve(re,U,".json"),"SpriteJSON");K[X]=o.j(ue,O);const fe=C.transformRequest(Ve(re,U,".png"),"SpriteImage");W[X]=me.getImage(fe,O)}return yield Promise.all([...Object.values(K),...Object.values(W)]),(function(X,re){return o._(this,void 0,void 0,(function*(){const ue={};for(const fe in X){ue[fe]={};const pe=M.getImageCanvasContext((yield re[fe]).data),_e=(yield X[fe]).data;for(const we in _e){const{width:ye,height:Te,x:Ie,y:be,sdf:ke,pixelRatio:Xe,stretchX:qe,stretchY:Ze,content:tt,textFitWidth:bt,textFitHeight:wt}=_e[we];ue[fe][we]={data:null,pixelRatio:Xe,sdf:ke,stretchX:qe,stretchY:Ze,content:tt,textFitWidth:bt,textFitHeight:wt,spriteData:{width:ye,height:Te,x:Ie,y:be,context:pe}}}}return ue}))})(K,W)}))})(s,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then((w=>{if(this._spriteRequest=null,w)for(const C in w){this._spritesImagesIds[C]=[];const B=this._spritesImagesIds[C]?this._spritesImagesIds[C].filter((O=>!(O in w))):[];for(const O of B)this.imageManager.removeImage(O),this._changedImages[O]=!0;for(const O in w[C]){const F=C==="default"?O:`${C}:${O}`;this._spritesImagesIds[C].push(F),F in this.imageManager.images?this.imageManager.updateImage(F,w[C][O],!1):this.imageManager.addImage(F,w[C][O]),d&&(this._changedImages[F]=!0)}}})).catch((w=>{this._spriteRequest=null,v=w,this.fire(new o.k(v))})).finally((()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),d&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.l("data",{dataType:"style"})),g&&g(v)}))}_unloadSprite(){for(const s of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(s),this._changedImages[s]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.l("data",{dataType:"style"}))}_validateLayer(s){const d=this.sourceCaches[s.source];if(!d)return;const g=s.sourceLayer;if(!g)return;const v=d.getSource();(v.type==="geojson"||v.vectorLayerIds&&v.vectorLayerIds.indexOf(g)===-1)&&this.fire(new o.k(new Error(`Source layer "${g}" does not exist on source "${v.id}" as specified by style layer "${s.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const s in this.sourceCaches)if(!this.sourceCaches[s].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(s,d=!1){const g=this._serializedAllLayers();if(!s||s.length===0)return Object.values(d?o.bK(g):g);const v=[];for(const w of s)if(g[w]){const C=d?o.bK(g[w]):g[w];v.push(C)}return v}_serializedAllLayers(){let s=this._serializedLayers;if(s)return s;s=this._serializedLayers={};const d=Object.keys(this._layers);for(const g of d){const v=this._layers[g];v.type!=="custom"&&(s[g]=v.serialize())}return s}hasTransitions(){var s,d,g;if(!((s=this.light)===null||s===void 0)&&s.hasTransition()||!((d=this.sky)===null||d===void 0)&&d.hasTransition()||!((g=this.projection)===null||g===void 0)&&g.hasTransition())return!0;for(const v in this.sourceCaches)if(this.sourceCaches[v].hasTransition())return!0;for(const v in this._layers)if(this._layers[v].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(s){if(!this._loaded)return;const d=this._changed;if(d){const v=Object.keys(this._updatedLayers),w=Object.keys(this._removedLayers);(v.length||w.length)&&this._updateWorkerLayers(v,w);for(const C in this._updatedSources){const B=this._updatedSources[C];if(B==="reload")this._reloadSource(C);else{if(B!=="clear")throw new Error(`Invalid action ${B}`);this._clearSource(C)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const C in this._updatedPaintProps)this._layers[C].updateTransitions(s);this.light.updateTransitions(s),this.sky.updateTransitions(s),this._resetUpdates()}const g={};for(const v in this.sourceCaches){const w=this.sourceCaches[v];g[v]=w.used,w.used=!1}for(const v of this._order){const w=this._layers[v];w.recalculate(s,this._availableImages),!w.isHidden(s.zoom)&&w.source&&(this.sourceCaches[w.source].used=!0)}for(const v in g){const w=this.sourceCaches[v];!!g[v]!=!!w.used&&w.fire(new o.l("data",{sourceDataType:"visibility",dataType:"source",sourceId:v}))}this.light.recalculate(s),this.sky.recalculate(s),this.projection.recalculate(s),this.z=s.zoom,d&&this.fire(new o.l("data",{dataType:"style"}))}_updateTilesForChangedImages(){const s=Object.keys(this._changedImages);if(s.length){for(const d in this.sourceCaches)this.sourceCaches[d].reloadTilesForDependencies(["icons","patterns"],s);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const s in this.sourceCaches)this.sourceCaches[s].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(s,d){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(s,!1),removedIds:d})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(s,d={}){var g;this._checkLoaded();const v=this.serialize();if(s=d.transformStyle?d.transformStyle(v,s):s,((g=d.validate)===null||g===void 0||g)&&Dh(this,o.z(s)))return!1;(s=o.bK(s)).layers=o.bI(s.layers);const w=o.bL(v,s),C=this._getOperationsToPerform(w);if(C.unimplemented.length>0)throw new Error(`Unimplemented: ${C.unimplemented.join(", ")}.`);if(C.operations.length===0)return!1;for(const B of C.operations)B();return this.stylesheet=s,this._serializedLayers=null,!0}_getOperationsToPerform(s){const d=[],g=[];for(const v of s)switch(v.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":d.push((()=>this.addLayer.apply(this,v.args)));break;case"removeLayer":d.push((()=>this.removeLayer.apply(this,v.args)));break;case"setPaintProperty":d.push((()=>this.setPaintProperty.apply(this,v.args)));break;case"setLayoutProperty":d.push((()=>this.setLayoutProperty.apply(this,v.args)));break;case"setFilter":d.push((()=>this.setFilter.apply(this,v.args)));break;case"addSource":d.push((()=>this.addSource.apply(this,v.args)));break;case"removeSource":d.push((()=>this.removeSource.apply(this,v.args)));break;case"setLayerZoomRange":d.push((()=>this.setLayerZoomRange.apply(this,v.args)));break;case"setLight":d.push((()=>this.setLight.apply(this,v.args)));break;case"setGeoJSONSourceData":d.push((()=>this.setGeoJSONSourceData.apply(this,v.args)));break;case"setGlyphs":d.push((()=>this.setGlyphs.apply(this,v.args)));break;case"setSprite":d.push((()=>this.setSprite.apply(this,v.args)));break;case"setTerrain":d.push((()=>this.map.setTerrain.apply(this,v.args)));break;case"setSky":d.push((()=>this.setSky.apply(this,v.args)));break;case"setProjection":this.setProjection.apply(this,v.args);break;case"setGlobalState":d.push((()=>this.setGlobalState.apply(this,v.args)));break;case"setTransition":d.push((()=>{}));break;default:g.push(v.command)}return{operations:d,unimplemented:g}}addImage(s,d){if(this.getImage(s))return this.fire(new o.k(new Error(`An image named "${s}" already exists.`)));this.imageManager.addImage(s,d),this._afterImageUpdated(s)}updateImage(s,d){this.imageManager.updateImage(s,d)}getImage(s){return this.imageManager.getImage(s)}removeImage(s){if(!this.getImage(s))return this.fire(new o.k(new Error(`An image named "${s}" does not exist.`)));this.imageManager.removeImage(s),this._afterImageUpdated(s)}_afterImageUpdated(s){this._availableImages=this.imageManager.listImages(),this._changedImages[s]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.l("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(s,d,g={}){if(this._checkLoaded(),this.sourceCaches[s]!==void 0)throw new Error(`Source "${s}" already exists.`);if(!d.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(d).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(d.type)>=0&&this._validate(o.z.source,`sources.${s}`,d,null,g))return;this.map&&this.map._collectResourceTiming&&(d.collectResourceTiming=!0);const v=this.sourceCaches[s]=new Rr(s,d,this.dispatcher);v.style=this,v.setEventedParent(this,(()=>({isSourceLoaded:v.loaded(),source:v.serialize(),sourceId:s}))),v.onAdd(this.map),this._changed=!0}removeSource(s){if(this._checkLoaded(),this.sourceCaches[s]===void 0)throw new Error("There is no source with this ID");for(const g in this._layers)if(this._layers[g].source===s)return this.fire(new o.k(new Error(`Source "${s}" cannot be removed while layer "${g}" is using it.`)));const d=this.sourceCaches[s];delete this.sourceCaches[s],delete this._updatedSources[s],d.fire(new o.l("data",{sourceDataType:"metadata",dataType:"source",sourceId:s})),d.setEventedParent(null),d.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(s,d){if(this._checkLoaded(),this.sourceCaches[s]===void 0)throw new Error(`There is no source with this ID=${s}`);const g=this.sourceCaches[s].getSource();if(g.type!=="geojson")throw new Error(`geojsonSource.type is ${g.type}, which is !== 'geojson`);g.setData(d),this._changed=!0}getSource(s){return this.sourceCaches[s]&&this.sourceCaches[s].getSource()}addLayer(s,d,g={}){this._checkLoaded();const v=s.id;if(this.getLayer(v))return void this.fire(new o.k(new Error(`Layer "${v}" already exists on this map.`)));let w;if(s.type==="custom"){if(Dh(this,o.bM(s)))return;w=o.bJ(s)}else{if("source"in s&&typeof s.source=="object"&&(this.addSource(v,s.source),s=o.bK(s),s=o.e(s,{source:v})),this._validate(o.z.layer,`layers.${v}`,s,{arrayIndex:-1},g))return;w=o.bJ(s),this._validateLayer(w),w.setEventedParent(this,{layer:{id:v}})}const C=d?this._order.indexOf(d):this._order.length;if(d&&C===-1)this.fire(new o.k(new Error(`Cannot add layer "${v}" before non-existing layer "${d}".`)));else{if(this._order.splice(C,0,v),this._layerOrderChanged=!0,this._layers[v]=w,this._removedLayers[v]&&w.source&&w.type!=="custom"){const B=this._removedLayers[v];delete this._removedLayers[v],B.type!==w.type?this._updatedSources[w.source]="clear":(this._updatedSources[w.source]="reload",this.sourceCaches[w.source].pause())}this._updateLayer(w),w.onAdd&&w.onAdd(this.map)}}moveLayer(s,d){if(this._checkLoaded(),this._changed=!0,!this._layers[s])return void this.fire(new o.k(new Error(`The layer '${s}' does not exist in the map's style and cannot be moved.`)));if(s===d)return;const g=this._order.indexOf(s);this._order.splice(g,1);const v=d?this._order.indexOf(d):this._order.length;d&&v===-1?this.fire(new o.k(new Error(`Cannot move layer "${s}" before non-existing layer "${d}".`))):(this._order.splice(v,0,s),this._layerOrderChanged=!0)}removeLayer(s){this._checkLoaded();const d=this._layers[s];if(!d)return void this.fire(new o.k(new Error(`Cannot remove non-existing layer "${s}".`)));d.setEventedParent(null);const g=this._order.indexOf(s);this._order.splice(g,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[s]=d,delete this._layers[s],this._serializedLayers&&delete this._serializedLayers[s],delete this._updatedLayers[s],delete this._updatedPaintProps[s],d.onRemove&&d.onRemove(this.map)}getLayer(s){return this._layers[s]}getLayersOrder(){return[...this._order]}hasLayer(s){return s in this._layers}setLayerZoomRange(s,d,g){this._checkLoaded();const v=this.getLayer(s);v?v.minzoom===d&&v.maxzoom===g||(d!=null&&(v.minzoom=d),g!=null&&(v.maxzoom=g),this._updateLayer(v)):this.fire(new o.k(new Error(`Cannot set the zoom range of non-existing layer "${s}".`)))}setFilter(s,d,g={}){this._checkLoaded();const v=this.getLayer(s);if(v){if(!o.bH(v.filter,d))return d==null?(v.setFilter(void 0),void this._updateLayer(v)):void(this._validate(o.z.filter,`layers.${v.id}.filter`,d,null,g)||(v.setFilter(o.bK(d)),this._updateLayer(v)))}else this.fire(new o.k(new Error(`Cannot filter non-existing layer "${s}".`)))}getFilter(s){return o.bK(this.getLayer(s).filter)}setLayoutProperty(s,d,g,v={}){this._checkLoaded();const w=this.getLayer(s);w?o.bH(w.getLayoutProperty(d),g)||(w.setLayoutProperty(d,g,v),this._updateLayer(w)):this.fire(new o.k(new Error(`Cannot style non-existing layer "${s}".`)))}getLayoutProperty(s,d){const g=this.getLayer(s);if(g)return g.getLayoutProperty(d);this.fire(new o.k(new Error(`Cannot get style of non-existing layer "${s}".`)))}setPaintProperty(s,d,g,v={}){this._checkLoaded();const w=this.getLayer(s);w?o.bH(w.getPaintProperty(d),g)||(w.setPaintProperty(d,g,v)&&this._updateLayer(w),this._changed=!0,this._updatedPaintProps[s]=!0,this._serializedLayers=null):this.fire(new o.k(new Error(`Cannot style non-existing layer "${s}".`)))}getPaintProperty(s,d){return this.getLayer(s).getPaintProperty(d)}setFeatureState(s,d){this._checkLoaded();const g=s.source,v=s.sourceLayer,w=this.sourceCaches[g];if(w===void 0)return void this.fire(new o.k(new Error(`The source '${g}' does not exist in the map's style.`)));const C=w.getSource().type;C==="geojson"&&v?this.fire(new o.k(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):C!=="vector"||v?(s.id===void 0&&this.fire(new o.k(new Error("The feature id parameter must be provided."))),w.setFeatureState(v,s.id,d)):this.fire(new o.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(s,d){this._checkLoaded();const g=s.source,v=this.sourceCaches[g];if(v===void 0)return void this.fire(new o.k(new Error(`The source '${g}' does not exist in the map's style.`)));const w=v.getSource().type,C=w==="vector"?s.sourceLayer:void 0;w!=="vector"||C?d&&typeof s.id!="string"&&typeof s.id!="number"?this.fire(new o.k(new Error("A feature id is required to remove its specific state property."))):v.removeFeatureState(C,s.id,d):this.fire(new o.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(s){this._checkLoaded();const d=s.source,g=s.sourceLayer,v=this.sourceCaches[d];if(v!==void 0)return v.getSource().type!=="vector"||g?(s.id===void 0&&this.fire(new o.k(new Error("The feature id parameter must be provided."))),v.getFeatureState(g,s.id)):void this.fire(new o.k(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new o.k(new Error(`The source '${d}' does not exist in the map's style.`)))}getTransition(){return o.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const s=o.bN(this.sourceCaches,(w=>w.serialize())),d=this._serializeByIds(this._order,!0),g=this.map.getTerrain()||void 0,v=this.stylesheet;return o.bO({version:v.version,name:v.name,metadata:v.metadata,light:v.light,sky:v.sky,center:v.center,zoom:v.zoom,bearing:v.bearing,pitch:v.pitch,sprite:v.sprite,glyphs:v.glyphs,transition:v.transition,projection:v.projection,sources:s,layers:d,terrain:g},(w=>w!==void 0))}_updateLayer(s){this._updatedLayers[s.id]=!0,s.source&&!this._updatedSources[s.source]&&this.sourceCaches[s.source].getSource().type!=="raster"&&(this._updatedSources[s.source]="reload",this.sourceCaches[s.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(s){const d=C=>this._layers[C].type==="fill-extrusion",g={},v=[];for(let C=this._order.length-1;C>=0;C--){const B=this._order[C];if(d(B)){g[B]=C;for(const O of s){const F=O[B];if(F)for(const U of F)v.push(U)}}}v.sort(((C,B)=>B.intersectionZ-C.intersectionZ));const w=[];for(let C=this._order.length-1;C>=0;C--){const B=this._order[C];if(d(B))for(let O=v.length-1;O>=0;O--){const F=v[O].feature;if(g[F.layer.id]<C)break;w.push(F),v.pop()}else for(const O of s){const F=O[B];if(F)for(const U of F)w.push(U.feature)}}return w}queryRenderedFeatures(s,d,g){d&&d.filter&&this._validate(o.z.filter,"queryRenderedFeatures.filter",d.filter,null,d);const v={};if(d&&d.layers){if(!(Array.isArray(d.layers)||d.layers instanceof Set))return this.fire(new o.k(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(const F of d.layers){const U=this._layers[F];if(!U)return this.fire(new o.k(new Error(`The layer '${F}' does not exist in the map's style and cannot be queried for features.`))),[];v[U.source]=!0}}const w=[];d.availableImages=this._availableImages;const C=this._serializedAllLayers(),B=d.layers instanceof Set?d.layers:Array.isArray(d.layers)?new Set(d.layers):null,O=Object.assign(Object.assign({},d),{layers:B});for(const F in this.sourceCaches)d.layers&&!v[F]||w.push(Qt(this.sourceCaches[F],this._layers,C,s,O,g,this.map.terrain?(U,K,W)=>this.map.terrain.getElevation(U,K,W):void 0));return this.placement&&w.push((function(F,U,K,W,X,re,ue){const fe={},pe=re.queryRenderedSymbols(W),_e=[];for(const we of Object.keys(pe).map(Number))_e.push(ue[we]);_e.sort(Nr);for(const we of _e){const ye=we.featureIndex.lookupSymbolFeatures(pe[we.bucketInstanceId],U,we.bucketIndex,we.sourceLayerIndex,X.filter,X.layers,X.availableImages,F);for(const Te in ye){const Ie=fe[Te]=fe[Te]||[],be=ye[Te];be.sort(((ke,Xe)=>{const qe=we.featureSortOrder;if(qe){const Ze=qe.indexOf(ke.featureIndex);return qe.indexOf(Xe.featureIndex)-Ze}return Xe.featureIndex-ke.featureIndex}));for(const ke of be)Ie.push(ke)}}return(function(we,ye,Te){for(const Ie in we)for(const be of we[Ie])An(be,Te[ye[Ie].source]);return we})(fe,F,K)})(this._layers,C,this.sourceCaches,s,O,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(w)}querySourceFeatures(s,d){d&&d.filter&&this._validate(o.z.filter,"querySourceFeatures.filter",d.filter,null,d);const g=this.sourceCaches[s];return g?(function(v,w){const C=v.getRenderableIds().map((F=>v.getTileByID(F))),B=[],O={};for(let F=0;F<C.length;F++){const U=C[F],K=U.tileID.canonical.key;O[K]||(O[K]=!0,U.querySourceFeatures(B,w))}return B})(g,d):[]}getLight(){return this.light.getLight()}setLight(s,d={}){this._checkLoaded();const g=this.light.getLight();let v=!1;for(const C in s)if(!o.bH(s[C],g[C])){v=!0;break}if(!v)return;const w={now:M.now(),transition:o.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(s,d),this.light.updateTransitions(w)}getProjection(){var s;return(s=this.stylesheet)===null||s===void 0?void 0:s.projection}setProjection(s){if(this._checkLoaded(),this.projection){if(this.projection.name===s.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=s,this._setProjectionInternal(s.type)}getSky(){var s;return(s=this.stylesheet)===null||s===void 0?void 0:s.sky}setSky(s,d={}){this._checkLoaded();const g=this.getSky();let v=!1;if(!s&&!g)return;if(s&&!g)v=!0;else if(!s&&g)v=!0;else for(const C in s)if(!o.bH(s[C],g[C])){v=!0;break}if(!v)return;const w={now:M.now(),transition:o.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=s,this.sky.setSky(s,d),this.sky.updateTransitions(w)}_setProjectionInternal(s){const d=(function(g){if(Array.isArray(g)){const v=new zc({type:g});return{projection:v,transform:new Nu,cameraHelper:new Np(v)}}switch(g){case"mercator":return{projection:new lr,transform:new ci,cameraHelper:new Nn};case"globe":{const v=new zc({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:v,transform:new Nu,cameraHelper:new Np(v)}}case"vertical-perspective":return{projection:new Fc,transform:new Du,cameraHelper:new Sn};default:return o.w(`Unknown projection name: ${g}. Falling back to mercator projection.`),{projection:new lr,transform:new ci,cameraHelper:new Nn}}})(s);this.projection=d.projection,this.map.migrateProjection(d.transform,d.cameraHelper);for(const g in this.sourceCaches)this.sourceCaches[g].reload()}_validate(s,d,g,v,w={}){return(!w||w.validate!==!1)&&Dh(this,s.call(o.z,o.e({key:d,style:this.serialize(),value:g,styleSpec:o.v},v)))}_remove(s=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),Gs().off(ea,this._rtlPluginLoaded);for(const d in this._layers)this._layers[d].setEventedParent(null);for(const d in this.sourceCaches){const g=this.sourceCaches[d];g.setEventedParent(null),g.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),s&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(s)}_clearSource(s){this.sourceCaches[s].clearTiles()}_reloadSource(s){this.sourceCaches[s].resume(),this.sourceCaches[s].reload()}_updateSources(s){for(const d in this.sourceCaches)this.sourceCaches[d].update(s,this.map.terrain)}_generateCollisionBoxes(){for(const s in this.sourceCaches)this._reloadSource(s)}_updatePlacement(s,d,g,v,w=!1){let C=!1,B=!1;const O={};for(const F of this._order){const U=this._layers[F];if(U.type!=="symbol")continue;if(!O[U.source]){const W=this.sourceCaches[U.source];O[U.source]=W.getRenderableIds(!0).map((X=>W.getTileByID(X))).sort(((X,re)=>re.tileID.overscaledZ-X.tileID.overscaledZ||(X.tileID.isLessThan(re.tileID)?-1:1)))}const K=this.crossTileSymbolIndex.addLayer(U,O[U.source],s.center.lng);C=C||K}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((w=w||this._layerOrderChanged||g===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(M.now(),s.zoom))&&(this.pauseablePlacement=new ll(s,this.map.terrain,this._order,w,d,g,v,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,O),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(M.now()),B=!0),C&&this.pauseablePlacement.placement.setStale()),B||C)for(const F of this._order){const U=this._layers[F];U.type==="symbol"&&this.placement.updateLayerOpacities(U,O[U.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(M.now())}_releaseSymbolFadeTiles(){for(const s in this.sourceCaches)this.sourceCaches[s].releaseSymbolFadeTiles()}getImages(s,d){return o._(this,void 0,void 0,(function*(){const g=yield this.imageManager.getImages(d.icons);this._updateTilesForChangedImages();const v=this.sourceCaches[d.source];return v&&v.setDependencies(d.tileID.key,d.type,d.icons),g}))}getGlyphs(s,d){return o._(this,void 0,void 0,(function*(){const g=yield this.glyphManager.getGlyphs(d.stacks),v=this.sourceCaches[d.source];return v&&v.setDependencies(d.tileID.key,d.type,[""]),g}))}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(s,d={}){this._checkLoaded(),s&&this._validate(o.z.glyphs,"glyphs",s,null,d)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=s,this.glyphManager.entries={},this.glyphManager.setURL(s))}addSprite(s,d,g={},v){this._checkLoaded();const w=[{id:s,url:d}],C=[...Me(this.stylesheet.sprite),...w];this._validate(o.z.sprite,"sprite",C,null,g)||(this.stylesheet.sprite=C,this._loadSprite(w,!0,v))}removeSprite(s){this._checkLoaded();const d=Me(this.stylesheet.sprite);if(d.find((g=>g.id===s))){if(this._spritesImagesIds[s])for(const g of this._spritesImagesIds[s])this.imageManager.removeImage(g),this._changedImages[g]=!0;d.splice(d.findIndex((g=>g.id===s)),1),this.stylesheet.sprite=d.length>0?d:void 0,delete this._spritesImagesIds[s],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.l("data",{dataType:"style"}))}else this.fire(new o.k(new Error(`Sprite "${s}" doesn't exists on this map.`)))}getSprite(){return Me(this.stylesheet.sprite)}setSprite(s,d={},g){this._checkLoaded(),s&&this._validate(o.z.sprite,"sprite",s,null,d)||(this.stylesheet.sprite=s,s?this._loadSprite(s,!0,g):(this._unloadSprite(),g&&g(null)))}}var Dg=o.aJ([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Fp{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(s,d,g,v,w,C,B,O,F){this.context=s;let U=this.boundPaintVertexBuffers.length!==v.length;for(let K=0;!U&&K<v.length;K++)this.boundPaintVertexBuffers[K]!==v[K]&&(U=!0);!this.vao||this.boundProgram!==d||this.boundLayoutVertexBuffer!==g||U||this.boundIndexBuffer!==w||this.boundVertexOffset!==C||this.boundDynamicVertexBuffer!==B||this.boundDynamicVertexBuffer2!==O||this.boundDynamicVertexBuffer3!==F?this.freshBind(d,g,v,w,C,B,O,F):(s.bindVertexArray.set(this.vao),B&&B.bind(),w&&w.dynamicDraw&&w.bind(),O&&O.bind(),F&&F.bind())}freshBind(s,d,g,v,w,C,B,O){const F=s.numAttributes,U=this.context,K=U.gl;this.vao&&this.destroy(),this.vao=U.createVertexArray(),U.bindVertexArray.set(this.vao),this.boundProgram=s,this.boundLayoutVertexBuffer=d,this.boundPaintVertexBuffers=g,this.boundIndexBuffer=v,this.boundVertexOffset=w,this.boundDynamicVertexBuffer=C,this.boundDynamicVertexBuffer2=B,this.boundDynamicVertexBuffer3=O,d.enableAttributes(K,s);for(const W of g)W.enableAttributes(K,s);C&&C.enableAttributes(K,s),B&&B.enableAttributes(K,s),O&&O.enableAttributes(K,s),d.bind(),d.setVertexAttribPointers(K,s,w);for(const W of g)W.bind(),W.setVertexAttribPointers(K,s,w);C&&(C.bind(),C.setVertexAttribPointers(K,s,w)),v&&v.bind(),B&&(B.bind(),B.setVertexAttribPointers(K,s,w)),O&&(O.bind(),O.setVertexAttribPointers(K,s,w)),U.currentNumAttributes=F}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const Nh=(x,s,d,g,v)=>({u_texture:0,u_ele_delta:x,u_fog_matrix:s,u_fog_color:d?d.properties.get("fog-color"):o.bf.white,u_fog_ground_blend:d?d.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:v?0:d?d.calculateFogBlendOpacity(g):0,u_horizon_color:d?d.properties.get("horizon-color"):o.bf.white,u_horizon_fog_blend:d?d.properties.get("horizon-fog-blend"):1,u_is_globe_mode:v?1:0}),ef={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function $l(x){const s=[];for(let d=0;d<x.length;d++){if(x[d]===null)continue;const g=x[d].split(" ");s.push(g.pop())}return s}class tf{constructor(s,d,g,v,w,C,B,O,F=[]){const U=s.gl;this.program=U.createProgram();const K=$l(d.staticAttributes),W=g?g.getBinderAttributes():[],X=K.concat(W),re=Pe.prelude.staticUniforms?$l(Pe.prelude.staticUniforms):[],ue=B.staticUniforms?$l(B.staticUniforms):[],fe=d.staticUniforms?$l(d.staticUniforms):[],pe=g?g.getBinderUniforms():[],_e=re.concat(ue).concat(fe).concat(pe),we=[];for(const qe of _e)we.indexOf(qe)<0&&we.push(qe);const ye=g?g.defines():[];ta(U)&&ye.unshift("#version 300 es"),w&&ye.push("#define OVERDRAW_INSPECTOR;"),C&&ye.push("#define TERRAIN3D;"),O&&ye.push(O),F&&ye.push(...F);let Te=ye.concat(Pe.prelude.fragmentSource,B.fragmentSource,d.fragmentSource).join(`
`),Ie=ye.concat(Pe.prelude.vertexSource,B.vertexSource,d.vertexSource).join(`
`);ta(U)||(Te=(function(qe){return qe.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")})(Te),Ie=(function(qe){return qe.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")})(Ie));const be=U.createShader(U.FRAGMENT_SHADER);if(U.isContextLost())return void(this.failedToCreate=!0);if(U.shaderSource(be,Te),U.compileShader(be),!U.getShaderParameter(be,U.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${U.getShaderInfoLog(be)}`);U.attachShader(this.program,be);const ke=U.createShader(U.VERTEX_SHADER);if(U.isContextLost())return void(this.failedToCreate=!0);if(U.shaderSource(ke,Ie),U.compileShader(ke),!U.getShaderParameter(ke,U.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${U.getShaderInfoLog(ke)}`);U.attachShader(this.program,ke),this.attributes={};const Xe={};this.numAttributes=X.length;for(let qe=0;qe<this.numAttributes;qe++)X[qe]&&(U.bindAttribLocation(this.program,qe,X[qe]),this.attributes[X[qe]]=qe);if(U.linkProgram(this.program),!U.getProgramParameter(this.program,U.LINK_STATUS))throw new Error(`Program failed to link: ${U.getProgramInfoLog(this.program)}`);U.deleteShader(ke),U.deleteShader(be);for(let qe=0;qe<we.length;qe++){const Ze=we[qe];if(Ze&&!Xe[Ze]){const tt=U.getUniformLocation(this.program,Ze);tt&&(Xe[Ze]=tt)}}this.fixedUniforms=v(s,Xe),this.terrainUniforms=((qe,Ze)=>({u_depth:new o.bP(qe,Ze.u_depth),u_terrain:new o.bP(qe,Ze.u_terrain),u_terrain_dim:new o.bg(qe,Ze.u_terrain_dim),u_terrain_matrix:new o.bR(qe,Ze.u_terrain_matrix),u_terrain_unpack:new o.bS(qe,Ze.u_terrain_unpack),u_terrain_exaggeration:new o.bg(qe,Ze.u_terrain_exaggeration)}))(s,Xe),this.projectionUniforms=((qe,Ze)=>({u_projection_matrix:new o.bR(qe,Ze.u_projection_matrix),u_projection_tile_mercator_coords:new o.bS(qe,Ze.u_projection_tile_mercator_coords),u_projection_clipping_plane:new o.bS(qe,Ze.u_projection_clipping_plane),u_projection_transition:new o.bg(qe,Ze.u_projection_transition),u_projection_fallback_matrix:new o.bR(qe,Ze.u_projection_fallback_matrix)}))(s,Xe),this.binderUniforms=g?g.getUniforms(s,Xe):[]}draw(s,d,g,v,w,C,B,O,F,U,K,W,X,re,ue,fe,pe,_e,we){const ye=s.gl;if(this.failedToCreate)return;if(s.program.set(this.program),s.setDepthMode(g),s.setStencilMode(v),s.setColorMode(w),s.setCullFace(C),O){s.activeTexture.set(ye.TEXTURE2),ye.bindTexture(ye.TEXTURE_2D,O.depthTexture),s.activeTexture.set(ye.TEXTURE3),ye.bindTexture(ye.TEXTURE_2D,O.texture);for(const Ie in this.terrainUniforms)this.terrainUniforms[Ie].set(O[Ie])}if(F)for(const Ie in F)this.projectionUniforms[ef[Ie]].set(F[Ie]);if(B)for(const Ie in this.fixedUniforms)this.fixedUniforms[Ie].set(B[Ie]);fe&&fe.setUniforms(s,this.binderUniforms,re,{zoom:ue});let Te=0;switch(d){case ye.LINES:Te=2;break;case ye.TRIANGLES:Te=3;break;case ye.LINE_STRIP:Te=1}for(const Ie of X.get()){const be=Ie.vaos||(Ie.vaos={});(be[U]||(be[U]=new Fp)).bind(s,this,K,fe?fe.getPaintVertexBuffers():[],W,Ie.vertexOffset,pe,_e,we),ye.drawElements(d,Ie.primitiveLength*Te,ye.UNSIGNED_SHORT,Ie.primitiveOffset*Te*2)}}}function Uc(x,s,d){const g=1/o.aC(d,1,s.transform.tileZoom),v=Math.pow(2,d.tileID.overscaledZ),w=d.tileSize*Math.pow(2,s.transform.tileZoom)/v,C=w*(d.tileID.canonical.x+d.tileID.wrap*v),B=w*d.tileID.canonical.y;return{u_image:0,u_texsize:d.imageAtlasTexture.size,u_scale:[g,x.fromScale,x.toScale],u_fade:x.t,u_pixel_coord_upper:[C>>16,B>>16],u_pixel_coord_lower:[65535&C,65535&B]}}const zo=(x,s,d,g)=>{const v=x.style.light,w=v.properties.get("position"),C=[w.x,w.y,w.z],B=o.bV();v.properties.get("anchor")==="viewport"&&o.bW(B,x.transform.bearingInRadians),o.bX(C,C,B);const O=x.transform.transformLightDirection(C),F=v.properties.get("color");return{u_lightpos:C,u_lightpos_globe:O,u_lightintensity:v.properties.get("intensity"),u_lightcolor:[F.r,F.g,F.b],u_vertical_gradient:+s,u_opacity:d,u_fill_translate:g}},Ng=(x,s,d,g,v,w,C)=>o.e(zo(x,s,d,g),Uc(w,x,C),{u_height_factor:-Math.pow(2,v.overscaledZ)/C.tileSize/8}),Fh=(x,s,d,g)=>o.e(Uc(s,x,d),{u_fill_translate:g}),Vc=(x,s)=>({u_world:x,u_fill_translate:s}),Fu=(x,s,d,g,v)=>o.e(Fh(x,s,d,v),{u_world:g}),Fg=(x,s,d,g,v)=>{const w=x.transform;let C,B,O=0;if(d.paint.get("circle-pitch-alignment")==="map"){const F=o.aC(s,1,w.zoom);C=!0,B=[F,F],O=F/(o.$*Math.pow(2,s.tileID.overscaledZ))*2*Math.PI*v}else C=!1,B=w.pixelsToGLUnits;return{u_camera_to_center_distance:w.cameraToCenterDistance,u_scale_with_map:+(d.paint.get("circle-pitch-scale")==="map"),u_pitch_with_map:+C,u_device_pixel_ratio:x.pixelRatio,u_extrude_scale:B,u_globe_extrude_scale:O,u_translate:g}},zh=x=>({u_pixel_extrude_scale:[1/x.width,1/x.height]}),zg=x=>({u_viewport_size:[x.width,x.height]}),Wl=(x,s=1)=>({u_color:x,u_overlay:0,u_overlay_scale:s}),zp=(x,s,d,g)=>{const v=o.aC(x,1,s)/(o.$*Math.pow(2,x.tileID.overscaledZ))*2*Math.PI*g;return{u_extrude_scale:o.aC(x,1,s),u_intensity:d,u_globe_extrude_scale:v}},rf=(x,s,d,g)=>{const v=o.L();o.bY(v,0,x.width,x.height,0,0,1);const w=x.context.gl;return{u_matrix:v,u_world:[w.drawingBufferWidth,w.drawingBufferHeight],u_image:d,u_color_ramp:g,u_opacity:s.paint.get("heatmap-opacity")}},nf=(x,s,d)=>{const g=d.paint.get("hillshade-accent-color");let v;switch(d.paint.get("hillshade-method")){case"basic":v=4;break;case"combined":v=1;break;case"igor":v=2;break;case"multidirectional":v=3;break;default:v=0}const w=d.getIlluminationProperties();for(let C=0;C<w.directionRadians.length;C++)d.paint.get("hillshade-illumination-anchor")==="viewport"&&(w.directionRadians[C]+=x.transform.bearingInRadians);return{u_image:0,u_latrange:sf(0,s.tileID),u_exaggeration:d.paint.get("hillshade-exaggeration"),u_altitudes:w.altitudeRadians,u_azimuths:w.directionRadians,u_accent:g,u_method:v,u_highlights:w.highlightColor,u_shadows:w.shadowColor}},Gc=(x,s)=>{const d=s.stride,g=o.L();return o.bY(g,0,o.$,-o.$,0,0,1),o.M(g,g,[0,-o.$,0]),{u_matrix:g,u_image:1,u_dimension:[d,d],u_zoom:x.overscaledZ,u_unpack:s.getUnpackVector()}};function sf(x,s){const d=Math.pow(2,s.canonical.z),g=s.canonical.y;return[new o.a1(0,g/d).toLngLat().lat,new o.a1(0,(g+1)/d).toLngLat().lat]}const of=(x,s,d=0)=>({u_image:0,u_unpack:s.getUnpackVector(),u_dimension:[s.stride,s.stride],u_elevation_stops:1,u_color_stops:4,u_color_ramp_size:d,u_opacity:x.paint.get("color-relief-opacity")}),zu=(x,s,d,g)=>{const v=x.transform;return{u_translation:cf(x,s,d),u_ratio:g/o.aC(s,1,v.zoom),u_device_pixel_ratio:x.pixelRatio,u_units_to_pixels:[1/v.pixelsToGLUnits[0],1/v.pixelsToGLUnits[1]]}},af=(x,s,d,g,v)=>o.e(zu(x,s,d,g),{u_image:0,u_image_height:v}),lf=(x,s,d,g,v)=>{const w=x.transform,C=ml(s,w);return{u_translation:cf(x,s,d),u_texsize:s.imageAtlasTexture.size,u_ratio:g/o.aC(s,1,w.zoom),u_device_pixel_ratio:x.pixelRatio,u_image:0,u_scale:[C,v.fromScale,v.toScale],u_fade:v.t,u_units_to_pixels:[1/w.pixelsToGLUnits[0],1/w.pixelsToGLUnits[1]]}},pl=(x,s,d,g,v,w)=>{const C=x.lineAtlas,B=ml(s,x.transform),O=d.layout.get("line-cap")==="round",F=C.getDash(v.from,O),U=C.getDash(v.to,O),K=F.width*w.fromScale,W=U.width*w.toScale;return o.e(zu(x,s,d,g),{u_patternscale_a:[B/K,-F.height/2],u_patternscale_b:[B/W,-U.height/2],u_sdfgamma:C.width/(256*Math.min(K,W)*x.pixelRatio)/2,u_image:0,u_tex_y_a:F.y,u_tex_y_b:U.y,u_mix:w.t})};function ml(x,s){return 1/o.aC(x,1,s.tileZoom)}function cf(x,s,d){return o.aD(x.transform,s,d.paint.get("line-translate"),d.paint.get("line-translate-anchor"))}const ju=(x,s,d,g,v)=>{return{u_tl_parent:x,u_scale_parent:s,u_buffer_scale:1,u_fade_t:d.mix,u_opacity:d.opacity*g.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:g.paint.get("raster-brightness-min"),u_brightness_high:g.paint.get("raster-brightness-max"),u_saturation_factor:(C=g.paint.get("raster-saturation"),C>0?1-1/(1.001-C):-C),u_contrast_factor:(w=g.paint.get("raster-contrast"),w>0?1/(1-w):1+w),u_spin_weights:jg(g.paint.get("raster-hue-rotate")),u_coords_top:[v[0].x,v[0].y,v[1].x,v[1].y],u_coords_bottom:[v[3].x,v[3].y,v[2].x,v[2].y]};var w,C};function jg(x){x*=Math.PI/180;const s=Math.sin(x),d=Math.cos(x);return[(2*d+1)/3,(-Math.sqrt(3)*s-d+1)/3,(Math.sqrt(3)*s-d+1)/3]}const Hc=(x,s,d,g,v,w,C,B,O,F,U,K,W)=>{const X=C.transform;return{u_is_size_zoom_constant:+(x==="constant"||x==="source"),u_is_size_feature_constant:+(x==="constant"||x==="camera"),u_size_t:s?s.uSizeT:0,u_size:s?s.uSize:0,u_camera_to_center_distance:X.cameraToCenterDistance,u_pitch:X.pitch/360*2*Math.PI,u_rotate_symbol:+d,u_aspect_ratio:X.width/X.height,u_fade_change:C.options.fadeDuration?C.symbolFadeChange:1,u_label_plane_matrix:B,u_coord_matrix:O,u_is_text:+U,u_pitch_with_map:+g,u_is_along_line:v,u_is_variable_anchor:w,u_texsize:K,u_texture:0,u_translation:F,u_pitched_scale:W}},uf=(x,s,d,g,v,w,C,B,O,F,U,K,W,X)=>{const re=C.transform;return o.e(Hc(x,s,d,g,v,w,C,B,O,F,U,K,X),{u_gamma_scale:g?Math.cos(re.pitch*Math.PI/180)*re.cameraToCenterDistance:1,u_device_pixel_ratio:C.pixelRatio,u_is_halo:1})},Uu=(x,s,d,g,v,w,C,B,O,F,U,K,W)=>o.e(uf(x,s,d,g,v,w,C,B,O,F,!0,U,0,W),{u_texsize_icon:K,u_texture_icon:1}),$c=(x,s)=>({u_opacity:x,u_color:s}),jp=(x,s,d,g,v)=>o.e((function(w,C,B,O){const F=B.imageManager.getPattern(w.from.toString()),U=B.imageManager.getPattern(w.to.toString()),{width:K,height:W}=B.imageManager.getPixelSize(),X=Math.pow(2,O.tileID.overscaledZ),re=O.tileSize*Math.pow(2,B.transform.tileZoom)/X,ue=re*(O.tileID.canonical.x+O.tileID.wrap*X),fe=re*O.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:F.tl,u_pattern_br_a:F.br,u_pattern_tl_b:U.tl,u_pattern_br_b:U.br,u_texsize:[K,W],u_mix:C.t,u_pattern_size_a:F.displaySize,u_pattern_size_b:U.displaySize,u_scale_a:C.fromScale,u_scale_b:C.toScale,u_tile_units_to_pixels:1/o.aC(O,1,B.transform.tileZoom),u_pixel_coord_upper:[ue>>16,fe>>16],u_pixel_coord_lower:[65535&ue,65535&fe]}})(d,v,s,g),{u_opacity:x}),Wc=(x,s)=>{},hf={fillExtrusion:(x,s)=>({u_lightpos:new o.bT(x,s.u_lightpos),u_lightpos_globe:new o.bT(x,s.u_lightpos_globe),u_lightintensity:new o.bg(x,s.u_lightintensity),u_lightcolor:new o.bT(x,s.u_lightcolor),u_vertical_gradient:new o.bg(x,s.u_vertical_gradient),u_opacity:new o.bg(x,s.u_opacity),u_fill_translate:new o.bU(x,s.u_fill_translate)}),fillExtrusionPattern:(x,s)=>({u_lightpos:new o.bT(x,s.u_lightpos),u_lightpos_globe:new o.bT(x,s.u_lightpos_globe),u_lightintensity:new o.bg(x,s.u_lightintensity),u_lightcolor:new o.bT(x,s.u_lightcolor),u_vertical_gradient:new o.bg(x,s.u_vertical_gradient),u_height_factor:new o.bg(x,s.u_height_factor),u_opacity:new o.bg(x,s.u_opacity),u_fill_translate:new o.bU(x,s.u_fill_translate),u_image:new o.bP(x,s.u_image),u_texsize:new o.bU(x,s.u_texsize),u_pixel_coord_upper:new o.bU(x,s.u_pixel_coord_upper),u_pixel_coord_lower:new o.bU(x,s.u_pixel_coord_lower),u_scale:new o.bT(x,s.u_scale),u_fade:new o.bg(x,s.u_fade)}),fill:(x,s)=>({u_fill_translate:new o.bU(x,s.u_fill_translate)}),fillPattern:(x,s)=>({u_image:new o.bP(x,s.u_image),u_texsize:new o.bU(x,s.u_texsize),u_pixel_coord_upper:new o.bU(x,s.u_pixel_coord_upper),u_pixel_coord_lower:new o.bU(x,s.u_pixel_coord_lower),u_scale:new o.bT(x,s.u_scale),u_fade:new o.bg(x,s.u_fade),u_fill_translate:new o.bU(x,s.u_fill_translate)}),fillOutline:(x,s)=>({u_world:new o.bU(x,s.u_world),u_fill_translate:new o.bU(x,s.u_fill_translate)}),fillOutlinePattern:(x,s)=>({u_world:new o.bU(x,s.u_world),u_image:new o.bP(x,s.u_image),u_texsize:new o.bU(x,s.u_texsize),u_pixel_coord_upper:new o.bU(x,s.u_pixel_coord_upper),u_pixel_coord_lower:new o.bU(x,s.u_pixel_coord_lower),u_scale:new o.bT(x,s.u_scale),u_fade:new o.bg(x,s.u_fade),u_fill_translate:new o.bU(x,s.u_fill_translate)}),circle:(x,s)=>({u_camera_to_center_distance:new o.bg(x,s.u_camera_to_center_distance),u_scale_with_map:new o.bP(x,s.u_scale_with_map),u_pitch_with_map:new o.bP(x,s.u_pitch_with_map),u_extrude_scale:new o.bU(x,s.u_extrude_scale),u_device_pixel_ratio:new o.bg(x,s.u_device_pixel_ratio),u_globe_extrude_scale:new o.bg(x,s.u_globe_extrude_scale),u_translate:new o.bU(x,s.u_translate)}),collisionBox:(x,s)=>({u_pixel_extrude_scale:new o.bU(x,s.u_pixel_extrude_scale)}),collisionCircle:(x,s)=>({u_viewport_size:new o.bU(x,s.u_viewport_size)}),debug:(x,s)=>({u_color:new o.bQ(x,s.u_color),u_overlay:new o.bP(x,s.u_overlay),u_overlay_scale:new o.bg(x,s.u_overlay_scale)}),depth:Wc,clippingMask:Wc,heatmap:(x,s)=>({u_extrude_scale:new o.bg(x,s.u_extrude_scale),u_intensity:new o.bg(x,s.u_intensity),u_globe_extrude_scale:new o.bg(x,s.u_globe_extrude_scale)}),heatmapTexture:(x,s)=>({u_matrix:new o.bR(x,s.u_matrix),u_world:new o.bU(x,s.u_world),u_image:new o.bP(x,s.u_image),u_color_ramp:new o.bP(x,s.u_color_ramp),u_opacity:new o.bg(x,s.u_opacity)}),hillshade:(x,s)=>({u_image:new o.bP(x,s.u_image),u_latrange:new o.bU(x,s.u_latrange),u_exaggeration:new o.bg(x,s.u_exaggeration),u_altitudes:new o.b_(x,s.u_altitudes),u_azimuths:new o.b_(x,s.u_azimuths),u_accent:new o.bQ(x,s.u_accent),u_method:new o.bP(x,s.u_method),u_shadows:new o.bZ(x,s.u_shadows),u_highlights:new o.bZ(x,s.u_highlights)}),hillshadePrepare:(x,s)=>({u_matrix:new o.bR(x,s.u_matrix),u_image:new o.bP(x,s.u_image),u_dimension:new o.bU(x,s.u_dimension),u_zoom:new o.bg(x,s.u_zoom),u_unpack:new o.bS(x,s.u_unpack)}),colorRelief:(x,s)=>({u_image:new o.bP(x,s.u_image),u_unpack:new o.bS(x,s.u_unpack),u_dimension:new o.bU(x,s.u_dimension),u_elevation_stops:new o.bP(x,s.u_elevation_stops),u_color_stops:new o.bP(x,s.u_color_stops),u_color_ramp_size:new o.bP(x,s.u_color_ramp_size),u_opacity:new o.bg(x,s.u_opacity)}),line:(x,s)=>({u_translation:new o.bU(x,s.u_translation),u_ratio:new o.bg(x,s.u_ratio),u_device_pixel_ratio:new o.bg(x,s.u_device_pixel_ratio),u_units_to_pixels:new o.bU(x,s.u_units_to_pixels)}),lineGradient:(x,s)=>({u_translation:new o.bU(x,s.u_translation),u_ratio:new o.bg(x,s.u_ratio),u_device_pixel_ratio:new o.bg(x,s.u_device_pixel_ratio),u_units_to_pixels:new o.bU(x,s.u_units_to_pixels),u_image:new o.bP(x,s.u_image),u_image_height:new o.bg(x,s.u_image_height)}),linePattern:(x,s)=>({u_translation:new o.bU(x,s.u_translation),u_texsize:new o.bU(x,s.u_texsize),u_ratio:new o.bg(x,s.u_ratio),u_device_pixel_ratio:new o.bg(x,s.u_device_pixel_ratio),u_image:new o.bP(x,s.u_image),u_units_to_pixels:new o.bU(x,s.u_units_to_pixels),u_scale:new o.bT(x,s.u_scale),u_fade:new o.bg(x,s.u_fade)}),lineSDF:(x,s)=>({u_translation:new o.bU(x,s.u_translation),u_ratio:new o.bg(x,s.u_ratio),u_device_pixel_ratio:new o.bg(x,s.u_device_pixel_ratio),u_units_to_pixels:new o.bU(x,s.u_units_to_pixels),u_patternscale_a:new o.bU(x,s.u_patternscale_a),u_patternscale_b:new o.bU(x,s.u_patternscale_b),u_sdfgamma:new o.bg(x,s.u_sdfgamma),u_image:new o.bP(x,s.u_image),u_tex_y_a:new o.bg(x,s.u_tex_y_a),u_tex_y_b:new o.bg(x,s.u_tex_y_b),u_mix:new o.bg(x,s.u_mix)}),raster:(x,s)=>({u_tl_parent:new o.bU(x,s.u_tl_parent),u_scale_parent:new o.bg(x,s.u_scale_parent),u_buffer_scale:new o.bg(x,s.u_buffer_scale),u_fade_t:new o.bg(x,s.u_fade_t),u_opacity:new o.bg(x,s.u_opacity),u_image0:new o.bP(x,s.u_image0),u_image1:new o.bP(x,s.u_image1),u_brightness_low:new o.bg(x,s.u_brightness_low),u_brightness_high:new o.bg(x,s.u_brightness_high),u_saturation_factor:new o.bg(x,s.u_saturation_factor),u_contrast_factor:new o.bg(x,s.u_contrast_factor),u_spin_weights:new o.bT(x,s.u_spin_weights),u_coords_top:new o.bS(x,s.u_coords_top),u_coords_bottom:new o.bS(x,s.u_coords_bottom)}),symbolIcon:(x,s)=>({u_is_size_zoom_constant:new o.bP(x,s.u_is_size_zoom_constant),u_is_size_feature_constant:new o.bP(x,s.u_is_size_feature_constant),u_size_t:new o.bg(x,s.u_size_t),u_size:new o.bg(x,s.u_size),u_camera_to_center_distance:new o.bg(x,s.u_camera_to_center_distance),u_pitch:new o.bg(x,s.u_pitch),u_rotate_symbol:new o.bP(x,s.u_rotate_symbol),u_aspect_ratio:new o.bg(x,s.u_aspect_ratio),u_fade_change:new o.bg(x,s.u_fade_change),u_label_plane_matrix:new o.bR(x,s.u_label_plane_matrix),u_coord_matrix:new o.bR(x,s.u_coord_matrix),u_is_text:new o.bP(x,s.u_is_text),u_pitch_with_map:new o.bP(x,s.u_pitch_with_map),u_is_along_line:new o.bP(x,s.u_is_along_line),u_is_variable_anchor:new o.bP(x,s.u_is_variable_anchor),u_texsize:new o.bU(x,s.u_texsize),u_texture:new o.bP(x,s.u_texture),u_translation:new o.bU(x,s.u_translation),u_pitched_scale:new o.bg(x,s.u_pitched_scale)}),symbolSDF:(x,s)=>({u_is_size_zoom_constant:new o.bP(x,s.u_is_size_zoom_constant),u_is_size_feature_constant:new o.bP(x,s.u_is_size_feature_constant),u_size_t:new o.bg(x,s.u_size_t),u_size:new o.bg(x,s.u_size),u_camera_to_center_distance:new o.bg(x,s.u_camera_to_center_distance),u_pitch:new o.bg(x,s.u_pitch),u_rotate_symbol:new o.bP(x,s.u_rotate_symbol),u_aspect_ratio:new o.bg(x,s.u_aspect_ratio),u_fade_change:new o.bg(x,s.u_fade_change),u_label_plane_matrix:new o.bR(x,s.u_label_plane_matrix),u_coord_matrix:new o.bR(x,s.u_coord_matrix),u_is_text:new o.bP(x,s.u_is_text),u_pitch_with_map:new o.bP(x,s.u_pitch_with_map),u_is_along_line:new o.bP(x,s.u_is_along_line),u_is_variable_anchor:new o.bP(x,s.u_is_variable_anchor),u_texsize:new o.bU(x,s.u_texsize),u_texture:new o.bP(x,s.u_texture),u_gamma_scale:new o.bg(x,s.u_gamma_scale),u_device_pixel_ratio:new o.bg(x,s.u_device_pixel_ratio),u_is_halo:new o.bP(x,s.u_is_halo),u_translation:new o.bU(x,s.u_translation),u_pitched_scale:new o.bg(x,s.u_pitched_scale)}),symbolTextAndIcon:(x,s)=>({u_is_size_zoom_constant:new o.bP(x,s.u_is_size_zoom_constant),u_is_size_feature_constant:new o.bP(x,s.u_is_size_feature_constant),u_size_t:new o.bg(x,s.u_size_t),u_size:new o.bg(x,s.u_size),u_camera_to_center_distance:new o.bg(x,s.u_camera_to_center_distance),u_pitch:new o.bg(x,s.u_pitch),u_rotate_symbol:new o.bP(x,s.u_rotate_symbol),u_aspect_ratio:new o.bg(x,s.u_aspect_ratio),u_fade_change:new o.bg(x,s.u_fade_change),u_label_plane_matrix:new o.bR(x,s.u_label_plane_matrix),u_coord_matrix:new o.bR(x,s.u_coord_matrix),u_is_text:new o.bP(x,s.u_is_text),u_pitch_with_map:new o.bP(x,s.u_pitch_with_map),u_is_along_line:new o.bP(x,s.u_is_along_line),u_is_variable_anchor:new o.bP(x,s.u_is_variable_anchor),u_texsize:new o.bU(x,s.u_texsize),u_texsize_icon:new o.bU(x,s.u_texsize_icon),u_texture:new o.bP(x,s.u_texture),u_texture_icon:new o.bP(x,s.u_texture_icon),u_gamma_scale:new o.bg(x,s.u_gamma_scale),u_device_pixel_ratio:new o.bg(x,s.u_device_pixel_ratio),u_is_halo:new o.bP(x,s.u_is_halo),u_translation:new o.bU(x,s.u_translation),u_pitched_scale:new o.bg(x,s.u_pitched_scale)}),background:(x,s)=>({u_opacity:new o.bg(x,s.u_opacity),u_color:new o.bQ(x,s.u_color)}),backgroundPattern:(x,s)=>({u_opacity:new o.bg(x,s.u_opacity),u_image:new o.bP(x,s.u_image),u_pattern_tl_a:new o.bU(x,s.u_pattern_tl_a),u_pattern_br_a:new o.bU(x,s.u_pattern_br_a),u_pattern_tl_b:new o.bU(x,s.u_pattern_tl_b),u_pattern_br_b:new o.bU(x,s.u_pattern_br_b),u_texsize:new o.bU(x,s.u_texsize),u_mix:new o.bg(x,s.u_mix),u_pattern_size_a:new o.bU(x,s.u_pattern_size_a),u_pattern_size_b:new o.bU(x,s.u_pattern_size_b),u_scale_a:new o.bg(x,s.u_scale_a),u_scale_b:new o.bg(x,s.u_scale_b),u_pixel_coord_upper:new o.bU(x,s.u_pixel_coord_upper),u_pixel_coord_lower:new o.bU(x,s.u_pixel_coord_lower),u_tile_units_to_pixels:new o.bg(x,s.u_tile_units_to_pixels)}),terrain:(x,s)=>({u_texture:new o.bP(x,s.u_texture),u_ele_delta:new o.bg(x,s.u_ele_delta),u_fog_matrix:new o.bR(x,s.u_fog_matrix),u_fog_color:new o.bQ(x,s.u_fog_color),u_fog_ground_blend:new o.bg(x,s.u_fog_ground_blend),u_fog_ground_blend_opacity:new o.bg(x,s.u_fog_ground_blend_opacity),u_horizon_color:new o.bQ(x,s.u_horizon_color),u_horizon_fog_blend:new o.bg(x,s.u_horizon_fog_blend),u_is_globe_mode:new o.bg(x,s.u_is_globe_mode)}),terrainDepth:(x,s)=>({u_ele_delta:new o.bg(x,s.u_ele_delta)}),terrainCoords:(x,s)=>({u_texture:new o.bP(x,s.u_texture),u_terrain_coords_id:new o.bg(x,s.u_terrain_coords_id),u_ele_delta:new o.bg(x,s.u_ele_delta)}),projectionErrorMeasurement:(x,s)=>({u_input:new o.bg(x,s.u_input),u_output_expected:new o.bg(x,s.u_output_expected)}),atmosphere:(x,s)=>({u_sun_pos:new o.bT(x,s.u_sun_pos),u_atmosphere_blend:new o.bg(x,s.u_atmosphere_blend),u_globe_position:new o.bT(x,s.u_globe_position),u_globe_radius:new o.bg(x,s.u_globe_radius),u_inv_proj_matrix:new o.bR(x,s.u_inv_proj_matrix)}),sky:(x,s)=>({u_sky_color:new o.bQ(x,s.u_sky_color),u_horizon_color:new o.bQ(x,s.u_horizon_color),u_horizon:new o.bU(x,s.u_horizon),u_horizon_normal:new o.bU(x,s.u_horizon_normal),u_sky_horizon_blend:new o.bg(x,s.u_sky_horizon_blend),u_sky_blend:new o.bg(x,s.u_sky_blend)})};class df{constructor(s,d,g){this.context=s;const v=s.gl;this.buffer=v.createBuffer(),this.dynamicDraw=!!g,this.context.unbindVAO(),s.bindElementBuffer.set(this.buffer),v.bufferData(v.ELEMENT_ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?v.DYNAMIC_DRAW:v.STATIC_DRAW),this.dynamicDraw||delete d.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(s){const d=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),d.bufferSubData(d.ELEMENT_ARRAY_BUFFER,0,s.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const qc={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class jo{constructor(s,d,g,v){this.length=d.length,this.attributes=g,this.itemSize=d.bytesPerElement,this.dynamicDraw=v,this.context=s;const w=s.gl;this.buffer=w.createBuffer(),s.bindVertexBuffer.set(this.buffer),w.bufferData(w.ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?w.DYNAMIC_DRAW:w.STATIC_DRAW),this.dynamicDraw||delete d.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(s){if(s.length!==this.length)throw new Error(`Length of new data is ${s.length}, which doesn't match current length of ${this.length}`);const d=this.context.gl;this.bind(),d.bufferSubData(d.ARRAY_BUFFER,0,s.arrayBuffer)}enableAttributes(s,d){for(let g=0;g<this.attributes.length;g++){const v=d.attributes[this.attributes[g].name];v!==void 0&&s.enableVertexAttribArray(v)}}setVertexAttribPointers(s,d,g){for(let v=0;v<this.attributes.length;v++){const w=this.attributes[v],C=d.attributes[w.name];C!==void 0&&s.vertexAttribPointer(C,w.components,s[qc[w.type]],!1,this.itemSize,w.offset+this.itemSize*(g||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Ur{constructor(s){this.gl=s.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(s){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class jh extends Ur{getDefault(){return o.bf.transparent}set(s){const d=this.current;(s.r!==d.r||s.g!==d.g||s.b!==d.b||s.a!==d.a||this.dirty)&&(this.gl.clearColor(s.r,s.g,s.b,s.a),this.current=s,this.dirty=!1)}}class Uh extends Ur{getDefault(){return 1}set(s){(s!==this.current||this.dirty)&&(this.gl.clearDepth(s),this.current=s,this.dirty=!1)}}class Up extends Ur{getDefault(){return 0}set(s){(s!==this.current||this.dirty)&&(this.gl.clearStencil(s),this.current=s,this.dirty=!1)}}class ff extends Ur{getDefault(){return[!0,!0,!0,!0]}set(s){const d=this.current;(s[0]!==d[0]||s[1]!==d[1]||s[2]!==d[2]||s[3]!==d[3]||this.dirty)&&(this.gl.colorMask(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class ql extends Ur{getDefault(){return!0}set(s){(s!==this.current||this.dirty)&&(this.gl.depthMask(s),this.current=s,this.dirty=!1)}}class pf extends Ur{getDefault(){return 255}set(s){(s!==this.current||this.dirty)&&(this.gl.stencilMask(s),this.current=s,this.dirty=!1)}}class Ug extends Ur{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(s){const d=this.current;(s.func!==d.func||s.ref!==d.ref||s.mask!==d.mask||this.dirty)&&(this.gl.stencilFunc(s.func,s.ref,s.mask),this.current=s,this.dirty=!1)}}class Uo extends Ur{getDefault(){const s=this.gl;return[s.KEEP,s.KEEP,s.KEEP]}set(s){const d=this.current;(s[0]!==d[0]||s[1]!==d[1]||s[2]!==d[2]||this.dirty)&&(this.gl.stencilOp(s[0],s[1],s[2]),this.current=s,this.dirty=!1)}}class Vu extends Ur{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const d=this.gl;s?d.enable(d.STENCIL_TEST):d.disable(d.STENCIL_TEST),this.current=s,this.dirty=!1}}class Vp extends Ur{getDefault(){return[0,1]}set(s){const d=this.current;(s[0]!==d[0]||s[1]!==d[1]||this.dirty)&&(this.gl.depthRange(s[0],s[1]),this.current=s,this.dirty=!1)}}class mf extends Ur{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const d=this.gl;s?d.enable(d.DEPTH_TEST):d.disable(d.DEPTH_TEST),this.current=s,this.dirty=!1}}class Gp extends Ur{getDefault(){return this.gl.LESS}set(s){(s!==this.current||this.dirty)&&(this.gl.depthFunc(s),this.current=s,this.dirty=!1)}}class gf extends Ur{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const d=this.gl;s?d.enable(d.BLEND):d.disable(d.BLEND),this.current=s,this.dirty=!1}}class Kc extends Ur{getDefault(){const s=this.gl;return[s.ONE,s.ZERO]}set(s){const d=this.current;(s[0]!==d[0]||s[1]!==d[1]||this.dirty)&&(this.gl.blendFunc(s[0],s[1]),this.current=s,this.dirty=!1)}}class Vh extends Ur{getDefault(){return o.bf.transparent}set(s){const d=this.current;(s.r!==d.r||s.g!==d.g||s.b!==d.b||s.a!==d.a||this.dirty)&&(this.gl.blendColor(s.r,s.g,s.b,s.a),this.current=s,this.dirty=!1)}}class Gh extends Ur{getDefault(){return this.gl.FUNC_ADD}set(s){(s!==this.current||this.dirty)&&(this.gl.blendEquation(s),this.current=s,this.dirty=!1)}}class gl extends Ur{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const d=this.gl;s?d.enable(d.CULL_FACE):d.disable(d.CULL_FACE),this.current=s,this.dirty=!1}}class Ca extends Ur{getDefault(){return this.gl.BACK}set(s){(s!==this.current||this.dirty)&&(this.gl.cullFace(s),this.current=s,this.dirty=!1)}}class Pa extends Ur{getDefault(){return this.gl.CCW}set(s){(s!==this.current||this.dirty)&&(this.gl.frontFace(s),this.current=s,this.dirty=!1)}}class _l extends Ur{getDefault(){return null}set(s){(s!==this.current||this.dirty)&&(this.gl.useProgram(s),this.current=s,this.dirty=!1)}}class qs extends Ur{getDefault(){return this.gl.TEXTURE0}set(s){(s!==this.current||this.dirty)&&(this.gl.activeTexture(s),this.current=s,this.dirty=!1)}}class Gu extends Ur{getDefault(){const s=this.gl;return[0,0,s.drawingBufferWidth,s.drawingBufferHeight]}set(s){const d=this.current;(s[0]!==d[0]||s[1]!==d[1]||s[2]!==d[2]||s[3]!==d[3]||this.dirty)&&(this.gl.viewport(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class Kl extends Ur{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const d=this.gl;d.bindFramebuffer(d.FRAMEBUFFER,s),this.current=s,this.dirty=!1}}class Hu extends Ur{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const d=this.gl;d.bindRenderbuffer(d.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class yl extends Ur{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const d=this.gl;d.bindTexture(d.TEXTURE_2D,s),this.current=s,this.dirty=!1}}class Zl extends Ur{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const d=this.gl;d.bindBuffer(d.ARRAY_BUFFER,s),this.current=s,this.dirty=!1}}class $u extends Ur{getDefault(){return null}set(s){const d=this.gl;d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,s),this.current=s,this.dirty=!1}}class Zc extends Ur{getDefault(){return null}set(s){var d;if(s===this.current&&!this.dirty)return;const g=this.gl;ta(g)?g.bindVertexArray(s):(d=g.getExtension("OES_vertex_array_object"))===null||d===void 0||d.bindVertexArrayOES(s),this.current=s,this.dirty=!1}}class Wu extends Ur{getDefault(){return 4}set(s){if(s===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_ALIGNMENT,s),this.current=s,this.dirty=!1}}class _f extends Ur{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s),this.current=s,this.dirty=!1}}class Xl extends Ur{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,s),this.current=s,this.dirty=!1}}class Ra extends Ur{constructor(s,d){super(s),this.context=s,this.parent=d}getDefault(){return null}}class Ma extends Ra{setDirty(){this.dirty=!0}set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,s,0),this.current=s,this.dirty=!1}}class qu extends Ra{set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferRenderbuffer(d.FRAMEBUFFER,d.DEPTH_ATTACHMENT,d.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class Lr extends Ra{set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferRenderbuffer(d.FRAMEBUFFER,d.DEPTH_STENCIL_ATTACHMENT,d.RENDERBUFFER,s),this.current=s,this.dirty=!1}}const Ku="Framebuffer is not complete";class Vg{constructor(s,d,g,v,w){this.context=s,this.width=d,this.height=g;const C=s.gl,B=this.framebuffer=C.createFramebuffer();if(this.colorAttachment=new Ma(s,B),v)this.depthAttachment=w?new Lr(s,B):new qu(s,B);else if(w)throw new Error("Stencil cannot be set without depth");if(C.checkFramebufferStatus(C.FRAMEBUFFER)!==C.FRAMEBUFFER_COMPLETE)throw new Error(Ku)}destroy(){const s=this.context.gl,d=this.colorAttachment.get();if(d&&s.deleteTexture(d),this.depthAttachment){const g=this.depthAttachment.get();g&&s.deleteRenderbuffer(g)}s.deleteFramebuffer(this.framebuffer)}}class Xc{constructor(s){var d,g;if(this.gl=s,this.clearColor=new jh(this),this.clearDepth=new Uh(this),this.clearStencil=new Up(this),this.colorMask=new ff(this),this.depthMask=new ql(this),this.stencilMask=new pf(this),this.stencilFunc=new Ug(this),this.stencilOp=new Uo(this),this.stencilTest=new Vu(this),this.depthRange=new Vp(this),this.depthTest=new mf(this),this.depthFunc=new Gp(this),this.blend=new gf(this),this.blendFunc=new Kc(this),this.blendColor=new Vh(this),this.blendEquation=new Gh(this),this.cullFace=new gl(this),this.cullFaceSide=new Ca(this),this.frontFace=new Pa(this),this.program=new _l(this),this.activeTexture=new qs(this),this.viewport=new Gu(this),this.bindFramebuffer=new Kl(this),this.bindRenderbuffer=new Hu(this),this.bindTexture=new yl(this),this.bindVertexBuffer=new Zl(this),this.bindElementBuffer=new $u(this),this.bindVertexArray=new Zc(this),this.pixelStoreUnpack=new Wu(this),this.pixelStoreUnpackPremultiplyAlpha=new _f(this),this.pixelStoreUnpackFlipY=new Xl(this),this.extTextureFilterAnisotropic=s.getExtension("EXT_texture_filter_anisotropic")||s.getExtension("MOZ_EXT_texture_filter_anisotropic")||s.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=s.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=s.getParameter(s.MAX_TEXTURE_SIZE),ta(s)){this.HALF_FLOAT=s.HALF_FLOAT;const v=s.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(d=s.RGBA16F)!==null&&d!==void 0?d:v?.RGBA16F_EXT,this.RGB16F=(g=s.RGB16F)!==null&&g!==void 0?g:v?.RGB16F_EXT,s.getExtension("EXT_color_buffer_float")}else{s.getExtension("EXT_color_buffer_half_float"),s.getExtension("OES_texture_half_float_linear");const v=s.getExtension("OES_texture_half_float");this.HALF_FLOAT=v?.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(s,d){return new df(this,s,d)}createVertexBuffer(s,d,g){return new jo(this,s,d,g)}createRenderbuffer(s,d,g){const v=this.gl,w=v.createRenderbuffer();return this.bindRenderbuffer.set(w),v.renderbufferStorage(v.RENDERBUFFER,s,d,g),this.bindRenderbuffer.set(null),w}createFramebuffer(s,d,g,v){return new Vg(this,s,d,g,v)}clear({color:s,depth:d,stencil:g}){const v=this.gl;let w=0;s&&(w|=v.COLOR_BUFFER_BIT,this.clearColor.set(s),this.colorMask.set([!0,!0,!0,!0])),d!==void 0&&(w|=v.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(d),this.depthMask.set(!0)),g!==void 0&&(w|=v.STENCIL_BUFFER_BIT,this.clearStencil.set(g),this.stencilMask.set(255)),v.clear(w)}setCullFace(s){s.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(s.mode),this.frontFace.set(s.frontFace))}setDepthMode(s){s.func!==this.gl.ALWAYS||s.mask?(this.depthTest.set(!0),this.depthFunc.set(s.func),this.depthMask.set(s.mask),this.depthRange.set(s.range)):this.depthTest.set(!1)}setStencilMode(s){s.test.func!==this.gl.ALWAYS||s.mask?(this.stencilTest.set(!0),this.stencilMask.set(s.mask),this.stencilOp.set([s.fail,s.depthFail,s.pass]),this.stencilFunc.set({func:s.test.func,ref:s.ref,mask:s.test.mask})):this.stencilTest.set(!1)}setColorMode(s){o.bH(s.blendFunction,oi.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(s.blendFunction),this.blendColor.set(s.blendColor)),this.colorMask.set(s.mask)}createVertexArray(){var s;return ta(this.gl)?this.gl.createVertexArray():(s=this.gl.getExtension("OES_vertex_array_object"))===null||s===void 0?void 0:s.createVertexArrayOES()}deleteVertexArray(s){var d;return ta(this.gl)?this.gl.deleteVertexArray(s):(d=this.gl.getExtension("OES_vertex_array_object"))===null||d===void 0?void 0:d.deleteVertexArrayOES(s)}unbindVAO(){this.bindVertexArray.set(null)}}let vl;function yf(x,s,d,g,v){const w=x.context,C=x.transform,B=w.gl,O=x.useProgram("collisionBox"),F=[];let U=0,K=0;for(let pe=0;pe<g.length;pe++){const _e=g[pe],we=s.getTile(_e).getBucket(d);if(!we)continue;const ye=v?we.textCollisionBox:we.iconCollisionBox,Te=we.collisionCircleArray;Te.length>0&&(F.push({circleArray:Te,circleOffset:K,coord:_e}),U+=Te.length/4,K=U),ye&&O.draw(w,B.LINES,mr.disabled,Br.disabled,x.colorModeForRenderPass(),cr.disabled,zh(x.transform),x.style.map.terrain&&x.style.map.terrain.getTerrainData(_e),C.getProjectionData({overscaledTileID:_e,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),d.id,ye.layoutVertexBuffer,ye.indexBuffer,ye.segments,null,x.transform.zoom,null,null,ye.collisionVertexBuffer)}if(!v||!F.length)return;const W=x.useProgram("collisionCircle"),X=new o.b$;X.resize(4*U),X._trim();let re=0;for(const pe of F)for(let _e=0;_e<pe.circleArray.length/4;_e++){const we=4*_e,ye=pe.circleArray[we+0],Te=pe.circleArray[we+1],Ie=pe.circleArray[we+2],be=pe.circleArray[we+3];X.emplace(re++,ye,Te,Ie,be,0),X.emplace(re++,ye,Te,Ie,be,1),X.emplace(re++,ye,Te,Ie,be,2),X.emplace(re++,ye,Te,Ie,be,3)}(!vl||vl.length<2*U)&&(vl=(function(pe){const _e=2*pe,we=new o.c1;we.resize(_e),we._trim();for(let ye=0;ye<_e;ye++){const Te=6*ye;we.uint16[Te+0]=4*ye+0,we.uint16[Te+1]=4*ye+1,we.uint16[Te+2]=4*ye+2,we.uint16[Te+3]=4*ye+2,we.uint16[Te+4]=4*ye+3,we.uint16[Te+5]=4*ye+0}return we})(U));const ue=w.createIndexBuffer(vl,!0),fe=w.createVertexBuffer(X,o.c0.members,!0);for(const pe of F){const _e=zg(x.transform);W.draw(w,B.TRIANGLES,mr.disabled,Br.disabled,x.colorModeForRenderPass(),cr.disabled,_e,x.style.map.terrain&&x.style.map.terrain.getTerrainData(pe.coord),null,d.id,fe,ue,o.aM.simpleSegment(0,2*pe.circleOffset,pe.circleArray.length,pe.circleArray.length/2),null,x.transform.zoom,null,null,null)}fe.destroy(),ue.destroy()}const Hp=o.ag(new Float32Array(16));function bi(x,s,d,g,v,w){const{horizontalAlign:C,verticalAlign:B}=o.aH(x);return new o.P((-(C-.5)*s/v+g[0])*w,(-(B-.5)*d/v+g[1])*w)}function vf(x,s,d,g,v,w){const C=s.tileAnchorPoint.add(new o.P(s.translation[0],s.translation[1]));if(s.pitchWithMap){let B=g.mult(w);d||(B=B.rotate(-v));const O=C.add(B);return Ui(O.x,O.y,s.pitchedLabelPlaneMatrix,s.getElevation).point}if(d){const B=Ki(s.tileAnchorPoint.x+1,s.tileAnchorPoint.y,s).point.sub(x),O=Math.atan(B.y/B.x)+(B.x<0?Math.PI:0);return x.add(g.rotate(O))}return x.add(g)}function Yc(x,s,d,g,v,w,C,B,O,F,U,K){const W=x.text.placedSymbolArray,X=x.text.dynamicLayoutVertexArray,re=x.icon.dynamicLayoutVertexArray,ue={};X.clear();for(let fe=0;fe<W.length;fe++){const pe=W.get(fe),_e=pe.hidden||!pe.crossTileID||x.allowVerticalPlacement&&!pe.placedOrientation?null:g[pe.crossTileID];if(_e){const we=new o.P(pe.anchorX,pe.anchorY),ye={getElevation:K,width:v.width,height:v.height,pitchedLabelPlaneMatrix:w,pitchWithMap:d,transform:v,tileAnchorPoint:we,translation:F,unwrappedTileID:U},Te=d?Wn(we.x,we.y,ye):Ki(we.x,we.y,ye),Ie=yt(v.cameraToCenterDistance,Te.signedDistanceFromCamera);let be=o.ap(x.textSizeData,B,pe)*Ie/o.aB;d&&(be*=x.tilePixelRatio/C);const{width:ke,height:Xe,anchor:qe,textOffset:Ze,textBoxScale:tt}=_e,bt=bi(qe,ke,Xe,Ze,tt,be),wt=v.getPitchedTextCorrection(we.x+F[0],we.y+F[1],U),ut=vf(Te.point,ye,s,bt,-v.bearingInRadians,wt),jt=x.allowVerticalPlacement&&pe.placedOrientation===o.ao.vertical?Math.PI/2:0;for(let Sr=0;Sr<pe.numGlyphs;Sr++)o.av(X,ut,jt);O&&pe.associatedIconIndex>=0&&(ue[pe.associatedIconIndex]={shiftedAnchor:ut,angle:jt})}else ho(pe.numGlyphs,X)}if(O){re.clear();const fe=x.icon.placedSymbolArray;for(let pe=0;pe<fe.length;pe++){const _e=fe.get(pe);if(_e.hidden)ho(_e.numGlyphs,re);else{const we=ue[pe];if(we)for(let ye=0;ye<_e.numGlyphs;ye++)o.av(re,we.shiftedAnchor,we.angle);else ho(_e.numGlyphs,re)}}x.icon.dynamicLayoutVertexBuffer.updateData(re)}x.text.dynamicLayoutVertexBuffer.updateData(X)}function bl(x,s,d){return d.iconsInText&&s?"symbolTextAndIcon":x?"symbolSDF":"symbolIcon"}function Jc(x,s,d,g,v,w,C,B,O,F,U,K,W){const X=x.context,re=X.gl,ue=x.transform,fe=B==="map",pe=O==="map",_e=B!=="viewport"&&d.layout.get("symbol-placement")!=="point",we=fe&&!pe&&!_e,ye=!d.layout.get("symbol-sort-key").isConstant();let Te=!1;const Ie=x.getDepthModeForSublayer(0,mr.ReadOnly),be=d._unevaluatedLayout.hasValue("text-variable-anchor")||d._unevaluatedLayout.hasValue("text-variable-anchor-offset"),ke=[],Xe=ue.getCircleRadiusCorrection();for(const qe of g){const Ze=s.getTile(qe),tt=Ze.getBucket(d);if(!tt)continue;const bt=v?tt.text:tt.icon;if(!bt||!bt.segments.get().length||!bt.hasVisibleVertices)continue;const wt=bt.programConfigurations.get(d.id),ut=v||tt.sdfIcons,jt=v?tt.textSizeData:tt.iconSizeData,Sr=pe||ue.pitch!==0,Gr=x.useProgram(bl(ut,v,tt),wt),ii=o.an(jt,ue.zoom),Jr=x.style.map.terrain&&x.style.map.terrain.getTerrainData(qe);let ui,Si,br,qr,Ji=[0,0],on=null;if(v)Si=Ze.glyphAtlasTexture,br=re.LINEAR,ui=Ze.glyphAtlasTexture.size,tt.iconsInText&&(Ji=Ze.imageAtlasTexture.size,on=Ze.imageAtlasTexture,qr=Sr||x.options.rotating||x.options.zooming||jt.kind==="composite"||jt.kind==="camera"?re.LINEAR:re.NEAREST);else{const Qi=d.layout.get("icon-size").constantOr(0)!==1||tt.iconsNeedLinear;Si=Ze.imageAtlasTexture,br=ut||x.options.rotating||x.options.zooming||Qi||Sr?re.LINEAR:re.NEAREST,ui=Ze.imageAtlasTexture.size}const _n=o.aC(Ze,1,x.transform.zoom),ps=fi(fe,x.transform,_n),_o=o.L();o.aq(_o,ps);const ja=Tr(pe,fe,x.transform,_n),ha=o.aD(ue,Ze,w,C),nc=ue.getProjectionData({overscaledTileID:qe,applyGlobeMatrix:!W,applyTerrainMatrix:!0}),sc=be&&tt.hasTextData(),Sl=d.layout.get("icon-text-fit")!=="none"&&sc&&tt.hasIconData();if(_e){const Qi=x.style.map.terrain?(_s,ln)=>x.style.map.terrain.getElevation(qe,_s,ln):null,an=d.layout.get("text-rotation-alignment")==="map";li(tt,x,v,ps,_o,pe,F,an,qe.toUnwrapped(),ue.width,ue.height,ha,Qi)}const oc=v&&be||Sl,ms=_e||oc?Hp:pe?ps:x.transform.clipSpaceToPixelsMatrix,$o=ut&&d.paint.get(v?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let gs;gs=ut?tt.iconsInText?Uu(jt.kind,ii,we,pe,_e,oc,x,ms,ja,ha,ui,Ji,Xe):uf(jt.kind,ii,we,pe,_e,oc,x,ms,ja,ha,v,ui,0,Xe):Hc(jt.kind,ii,we,pe,_e,oc,x,ms,ja,ha,v,ui,Xe);const Ua={program:Gr,buffers:bt,uniformValues:gs,projectionData:nc,atlasTexture:Si,atlasTextureIcon:on,atlasInterpolation:br,atlasInterpolationIcon:qr,isSDF:ut,hasHalo:$o};if(ye&&tt.canOverlap){Te=!0;const Qi=bt.segments.get();for(const an of Qi)ke.push({segments:new o.aM([an]),sortKey:an.sortKey,state:Ua,terrainData:Jr})}else ke.push({segments:bt.segments,sortKey:0,state:Ua,terrainData:Jr})}Te&&ke.sort(((qe,Ze)=>qe.sortKey-Ze.sortKey));for(const qe of ke){const Ze=qe.state;if(X.activeTexture.set(re.TEXTURE0),Ze.atlasTexture.bind(Ze.atlasInterpolation,re.CLAMP_TO_EDGE),Ze.atlasTextureIcon&&(X.activeTexture.set(re.TEXTURE1),Ze.atlasTextureIcon&&Ze.atlasTextureIcon.bind(Ze.atlasInterpolationIcon,re.CLAMP_TO_EDGE)),Ze.isSDF){const tt=Ze.uniformValues;Ze.hasHalo&&(tt.u_is_halo=1,Yl(Ze.buffers,qe.segments,d,x,Ze.program,Ie,U,K,tt,Ze.projectionData,qe.terrainData)),tt.u_is_halo=0}Yl(Ze.buffers,qe.segments,d,x,Ze.program,Ie,U,K,Ze.uniformValues,Ze.projectionData,qe.terrainData)}}function Yl(x,s,d,g,v,w,C,B,O,F,U){const K=g.context;v.draw(K,K.gl.TRIANGLES,w,C,B,cr.backCCW,O,U,F,d.id,x.layoutVertexBuffer,x.indexBuffer,s,d.paint,g.transform.zoom,x.programConfigurations.get(d.id),x.dynamicLayoutVertexBuffer,x.opacityVertexBuffer)}function Jl(x,s,d,g,v){const w=x.context,C=w.gl,B=Br.disabled,O=new oi([C.ONE,C.ONE],o.bf.transparent,[!0,!0,!0,!0]),F=s.getBucket(d);if(!F)return;const U=g.key;let K=d.heatmapFbos.get(U);K||(K=ia(w,s.tileSize,s.tileSize),d.heatmapFbos.set(U,K)),w.bindFramebuffer.set(K.framebuffer),w.viewport.set([0,0,s.tileSize,s.tileSize]),w.clear({color:o.bf.transparent});const W=F.programConfigurations.get(d.id),X=x.useProgram("heatmap",W,!v),re=x.transform.getProjectionData({overscaledTileID:s.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),ue=x.style.map.terrain.getTerrainData(g);X.draw(w,C.TRIANGLES,mr.disabled,B,O,cr.disabled,zp(s,x.transform.zoom,d.paint.get("heatmap-intensity"),1),ue,re,d.id,F.layoutVertexBuffer,F.indexBuffer,F.segments,d.paint,x.transform.zoom,W)}function Zu(x,s,d,g,v){const w=x.context,C=w.gl,B=x.transform;w.setColorMode(x.colorModeForRenderPass());const O=Qc(w,s),F=d.key,U=s.heatmapFbos.get(F);if(!U)return;w.activeTexture.set(C.TEXTURE0),C.bindTexture(C.TEXTURE_2D,U.colorAttachment.get()),w.activeTexture.set(C.TEXTURE1),O.bind(C.LINEAR,C.CLAMP_TO_EDGE);const K=B.getProjectionData({overscaledTileID:d,applyTerrainMatrix:v,applyGlobeMatrix:!g});x.useProgram("heatmapTexture").draw(w,C.TRIANGLES,mr.disabled,Br.disabled,x.colorModeForRenderPass(),cr.disabled,rf(x,s,0,1),null,K,s.id,x.rasterBoundsBuffer,x.quadTriangleIndexBuffer,x.rasterBoundsSegments,s.paint,B.zoom),U.destroy(),s.heatmapFbos.delete(F)}function ia(x,s,d){var g,v;const w=x.gl,C=w.createTexture();w.bindTexture(w.TEXTURE_2D,C),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_WRAP_S,w.CLAMP_TO_EDGE),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_WRAP_T,w.CLAMP_TO_EDGE),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_MIN_FILTER,w.LINEAR),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_MAG_FILTER,w.LINEAR);const B=(g=x.HALF_FLOAT)!==null&&g!==void 0?g:w.UNSIGNED_BYTE,O=(v=x.RGBA16F)!==null&&v!==void 0?v:w.RGBA;w.texImage2D(w.TEXTURE_2D,0,O,s,d,0,w.RGBA,B,null);const F=x.createFramebuffer(s,d,!1,!1);return F.colorAttachment.set(C),F}function Qc(x,s){return s.colorRampTexture||(s.colorRampTexture=new o.T(x,s.colorRamp,x.gl.RGBA)),s.colorRampTexture}function Xu(x,s,d,g,v){if(!d||!g||!g.imageAtlas)return;const w=g.imageAtlas.patternPositions;let C=w[d.to.toString()],B=w[d.from.toString()];if(!C&&B&&(C=B),!B&&C&&(B=C),!C||!B){const O=v.getPaintProperty(s);C=w[O],B=w[O]}C&&B&&x.setConstantPatternPositions(C,B)}function Hh(x,s,d,g,v,w,C,B){const O=x.context.gl,F="fill-pattern",U=d.paint.get(F),K=U&&U.constantOr(1),W=d.getCrossfadeParameters();let X,re,ue,fe,pe;const _e=x.transform,we=d.paint.get("fill-translate"),ye=d.paint.get("fill-translate-anchor");C?(re=K&&!d.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",X=O.LINES):(re=K?"fillPattern":"fill",X=O.TRIANGLES);const Te=U.constantOr(null);for(const Ie of g){const be=s.getTile(Ie);if(K&&!be.patternsLoaded())continue;const ke=be.getBucket(d);if(!ke)continue;const Xe=ke.programConfigurations.get(d.id),qe=x.useProgram(re,Xe),Ze=x.style.map.terrain&&x.style.map.terrain.getTerrainData(Ie);K&&(x.context.activeTexture.set(O.TEXTURE0),be.imageAtlasTexture.bind(O.LINEAR,O.CLAMP_TO_EDGE),Xe.updatePaintBuffers(W)),Xu(Xe,F,Te,be,d);const tt=_e.getProjectionData({overscaledTileID:Ie,applyGlobeMatrix:!B,applyTerrainMatrix:!0}),bt=o.aD(_e,be,we,ye);if(C){fe=ke.indexBuffer2,pe=ke.segments2;const ut=[O.drawingBufferWidth,O.drawingBufferHeight];ue=re==="fillOutlinePattern"&&K?Fu(x,W,be,ut,bt):Vc(ut,bt)}else fe=ke.indexBuffer,pe=ke.segments,ue=K?Fh(x,W,be,bt):{u_fill_translate:bt};const wt=x.stencilModeForClipping(Ie);qe.draw(x.context,X,v,wt,w,cr.backCCW,ue,Ze,tt,d.id,ke.layoutVertexBuffer,fe,pe,d.paint,x.transform.zoom,Xe)}}function $h(x,s,d,g,v,w,C,B){const O=x.context,F=O.gl,U="fill-extrusion-pattern",K=d.paint.get(U),W=K.constantOr(1),X=d.getCrossfadeParameters(),re=d.paint.get("fill-extrusion-opacity"),ue=K.constantOr(null),fe=x.transform;for(const pe of g){const _e=s.getTile(pe),we=_e.getBucket(d);if(!we)continue;const ye=x.style.map.terrain&&x.style.map.terrain.getTerrainData(pe),Te=we.programConfigurations.get(d.id),Ie=x.useProgram(W?"fillExtrusionPattern":"fillExtrusion",Te);W&&(x.context.activeTexture.set(F.TEXTURE0),_e.imageAtlasTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE),Te.updatePaintBuffers(X));const be=fe.getProjectionData({overscaledTileID:pe,applyGlobeMatrix:!B,applyTerrainMatrix:!0});Xu(Te,U,ue,_e,d);const ke=o.aD(fe,_e,d.paint.get("fill-extrusion-translate"),d.paint.get("fill-extrusion-translate-anchor")),Xe=d.paint.get("fill-extrusion-vertical-gradient"),qe=W?Ng(x,Xe,re,ke,pe,X,_e):zo(x,Xe,re,ke);Ie.draw(O,O.gl.TRIANGLES,v,w,C,cr.backCCW,qe,ye,be,d.id,we.layoutVertexBuffer,we.indexBuffer,we.segments,d.paint,x.transform.zoom,Te,x.style.map.terrain&&we.centroidVertexBuffer)}}function na(x,s,d,g,v,w,C,B,O){var F;const U=x.style.projection,K=x.context,W=x.transform,X=K.gl,re=[`#define NUM_ILLUMINATION_SOURCES ${d.paint.get("hillshade-highlight-color").values.length}`],ue=x.useProgram("hillshade",null,!1,re),fe=!x.options.moving;for(const pe of g){const _e=s.getTile(pe),we=_e.fbo;if(!we)continue;const ye=U.getMeshFromTileID(K,pe.canonical,B,!0,"raster"),Te=(F=x.style.map.terrain)===null||F===void 0?void 0:F.getTerrainData(pe);K.activeTexture.set(X.TEXTURE0),X.bindTexture(X.TEXTURE_2D,we.colorAttachment.get());const Ie=W.getProjectionData({overscaledTileID:pe,aligned:fe,applyGlobeMatrix:!O,applyTerrainMatrix:!0});ue.draw(K,X.TRIANGLES,w,v[pe.overscaledZ],C,cr.backCCW,nf(x,_e,d),Te,Ie,d.id,ye.vertexBuffer,ye.indexBuffer,ye.segments)}}function eu(x,s,d,g,v,w,C,B,O){var F;const U=x.style.projection,K=x.context,W=x.transform,X=K.gl,re=x.useProgram("colorRelief"),ue=!x.options.moving;let fe=!0,pe=0;for(const _e of g){const we=s.getTile(_e),ye=we.dem;if(fe){const qe=X.getParameter(X.MAX_TEXTURE_SIZE),{elevationTexture:Ze,colorTexture:tt}=d.getColorRampTextures(K,qe,ye.getUnpackVector());K.activeTexture.set(X.TEXTURE1),Ze.bind(X.NEAREST,X.CLAMP_TO_EDGE),K.activeTexture.set(X.TEXTURE4),tt.bind(X.LINEAR,X.CLAMP_TO_EDGE),fe=!1,pe=Ze.size[0]}if(!ye||!ye.data)continue;const Te=ye.stride,Ie=ye.getPixels();if(K.activeTexture.set(X.TEXTURE0),K.pixelStoreUnpackPremultiplyAlpha.set(!1),we.demTexture=we.demTexture||x.getTileTexture(Te),we.demTexture){const qe=we.demTexture;qe.update(Ie,{premultiply:!1}),qe.bind(X.LINEAR,X.CLAMP_TO_EDGE)}else we.demTexture=new o.T(K,Ie,X.RGBA,{premultiply:!1}),we.demTexture.bind(X.LINEAR,X.CLAMP_TO_EDGE);const be=U.getMeshFromTileID(K,_e.canonical,B,!0,"raster"),ke=(F=x.style.map.terrain)===null||F===void 0?void 0:F.getTerrainData(_e),Xe=W.getProjectionData({overscaledTileID:_e,aligned:ue,applyGlobeMatrix:!O,applyTerrainMatrix:!0});re.draw(K,X.TRIANGLES,w,v[_e.overscaledZ],C,cr.backCCW,of(d,we.dem,pe),ke,Xe,d.id,be.vertexBuffer,be.indexBuffer,be.segments)}}const tu=[new o.P(0,0),new o.P(o.$,0),new o.P(o.$,o.$),new o.P(0,o.$)];function Ia(x,s,d,g,v,w,C,B,O=!1,F=!1){const U=g[g.length-1].overscaledZ,K=x.context,W=K.gl,X=x.useProgram("raster"),re=x.transform,ue=x.style.projection,fe=x.colorModeForRenderPass(),pe=!x.options.moving;for(const _e of g){const we=x.getDepthModeForSublayer(_e.overscaledZ-U,d.paint.get("raster-opacity")===1?mr.ReadWrite:mr.ReadOnly,W.LESS),ye=s.getTile(_e);ye.registerFadeDuration(d.paint.get("raster-fade-duration"));const Te=s.findLoadedParent(_e,0),Ie=s.findLoadedSibling(_e),be=Yu(ye,Te||Ie||null,s,d,x.transform,x.style.map.terrain);let ke,Xe;const qe=d.paint.get("raster-resampling")==="nearest"?W.NEAREST:W.LINEAR;K.activeTexture.set(W.TEXTURE0),ye.texture.bind(qe,W.CLAMP_TO_EDGE,W.LINEAR_MIPMAP_NEAREST),K.activeTexture.set(W.TEXTURE1),Te?(Te.texture.bind(qe,W.CLAMP_TO_EDGE,W.LINEAR_MIPMAP_NEAREST),ke=Math.pow(2,Te.tileID.overscaledZ-ye.tileID.overscaledZ),Xe=[ye.tileID.canonical.x*ke%1,ye.tileID.canonical.y*ke%1]):ye.texture.bind(qe,W.CLAMP_TO_EDGE,W.LINEAR_MIPMAP_NEAREST),ye.texture.useMipmap&&K.extTextureFilterAnisotropic&&x.transform.pitch>20&&W.texParameterf(W.TEXTURE_2D,K.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,K.extTextureFilterAnisotropicMax);const Ze=x.style.map.terrain&&x.style.map.terrain.getTerrainData(_e),tt=re.getProjectionData({overscaledTileID:_e,aligned:pe,applyGlobeMatrix:!F,applyTerrainMatrix:!0}),bt=ju(Xe||[0,0],ke||1,be,d,B),wt=ue.getMeshFromTileID(K,_e.canonical,w,C,"raster");X.draw(K,W.TRIANGLES,we,v?v[_e.overscaledZ]:Br.disabled,fe,O?cr.frontCCW:cr.backCCW,bt,Ze,tt,d.id,wt.vertexBuffer,wt.indexBuffer,wt.segments)}}function Yu(x,s,d,g,v,w){const C=g.paint.get("raster-fade-duration");if(!w&&C>0){const B=M.now(),O=(B-x.timeAdded)/C,F=s?(B-s.timeAdded)/C:-1,U=d.getSource(),K=Dt(v,{tileSize:U.tileSize,roundZoom:U.roundZoom}),W=!s||Math.abs(s.tileID.overscaledZ-K)>Math.abs(x.tileID.overscaledZ-K),X=W&&x.refreshedUponExpiration?1:o.ah(W?O:1-F,0,1);return x.refreshedUponExpiration&&O>=1&&(x.refreshedUponExpiration=!1),s?{opacity:1,mix:1-X}:{opacity:X,mix:0}}return{opacity:1,mix:0}}const Wh=new o.bf(1,0,0,1),$p=new o.bf(0,1,0,1),Ju=new o.bf(0,0,1,1),bf=new o.bf(1,0,1,1),Gg=new o.bf(0,1,1,1);function Qu(x,s,d,g){Vo(x,0,s+d/2,x.transform.width,d,g)}function ei(x,s,d,g){Vo(x,s-d/2,0,d,x.transform.height,g)}function Vo(x,s,d,g,v,w){const C=x.context,B=C.gl;B.enable(B.SCISSOR_TEST),B.scissor(s*x.pixelRatio,d*x.pixelRatio,g*x.pixelRatio,v*x.pixelRatio),C.clear({color:w}),B.disable(B.SCISSOR_TEST)}function Fn(x,s,d){const g=x.context,v=g.gl,w=x.useProgram("debug"),C=mr.disabled,B=Br.disabled,O=x.colorModeForRenderPass(),F="$debug",U=x.style.map.terrain&&x.style.map.terrain.getTerrainData(d);g.activeTexture.set(v.TEXTURE0);const K=s.getTileByID(d.key).latestRawTileData,W=Math.floor((K&&K.byteLength||0)/1024),X=s.getTile(d).tileSize,re=512/Math.min(X,512)*(d.overscaledZ/x.transform.zoom)*.5;let ue=d.canonical.toString();d.overscaledZ!==d.canonical.z&&(ue+=` => ${d.overscaledZ}`),(function(pe,_e){pe.initDebugOverlayCanvas();const we=pe.debugOverlayCanvas,ye=pe.context.gl,Te=pe.debugOverlayCanvas.getContext("2d");Te.clearRect(0,0,we.width,we.height),Te.shadowColor="white",Te.shadowBlur=2,Te.lineWidth=1.5,Te.strokeStyle="white",Te.textBaseline="top",Te.font="bold 36px Open Sans, sans-serif",Te.fillText(_e,5,5),Te.strokeText(_e,5,5),pe.debugOverlayTexture.update(we),pe.debugOverlayTexture.bind(ye.LINEAR,ye.CLAMP_TO_EDGE)})(x,`${ue} ${W}kB`);const fe=x.transform.getProjectionData({overscaledTileID:d,applyGlobeMatrix:!0,applyTerrainMatrix:!0});w.draw(g,v.TRIANGLES,C,B,oi.alphaBlended,cr.disabled,Wl(o.bf.transparent,re),null,fe,F,x.debugBuffer,x.quadTriangleIndexBuffer,x.debugSegments),w.draw(g,v.LINE_STRIP,C,B,O,cr.disabled,Wl(o.bf.red),U,fe,F,x.debugBuffer,x.tileBorderIndexBuffer,x.debugSegments)}function Ks(x,s,d,g){const{isRenderingGlobe:v}=g,w=x.context,C=w.gl,B=x.transform,O=x.colorModeForRenderPass(),F=x.getDepthModeFor3D(),U=x.useProgram("terrain");w.bindFramebuffer.set(null),w.viewport.set([0,0,x.width,x.height]);for(const K of d){const W=s.getTerrainMesh(K.tileID),X=x.renderToTexture.getTexture(K),re=s.getTerrainData(K.tileID);w.activeTexture.set(C.TEXTURE0),C.bindTexture(C.TEXTURE_2D,X.texture);const ue=s.getMeshFrameDelta(B.zoom),fe=B.calculateFogMatrix(K.tileID.toUnwrapped()),pe=Nh(ue,fe,x.style.sky,B.pitch,v),_e=B.getProjectionData({overscaledTileID:K.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});U.draw(w,C.TRIANGLES,F,Br.disabled,O,cr.backCCW,pe,re,_e,"terrain",W.vertexBuffer,W.indexBuffer,W.segments)}}function ka(x,s){if(!s.mesh){const d=new o.aL;d.emplaceBack(-1,-1),d.emplaceBack(1,-1),d.emplaceBack(1,1),d.emplaceBack(-1,1);const g=new o.aN;g.emplaceBack(0,1,2),g.emplaceBack(0,2,3),s.mesh=new mt(x.createVertexBuffer(d,Zt.members),x.createIndexBuffer(g),o.aM.simpleSegment(0,0,d.length,g.length))}return s.mesh}class sa{constructor(s,d){this.context=new Xc(s),this.transform=d,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:o.ag(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=Rr.maxUnderzooming+Rr.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new ae}resize(s,d,g){if(this.width=Math.floor(s*g),this.height=Math.floor(d*g),this.pixelRatio=g,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const v of this.style._order)this.style._layers[v].resize()}setup(){const s=this.context,d=new o.aL;d.emplaceBack(0,0),d.emplaceBack(o.$,0),d.emplaceBack(0,o.$),d.emplaceBack(o.$,o.$),this.tileExtentBuffer=s.createVertexBuffer(d,Zt.members),this.tileExtentSegments=o.aM.simpleSegment(0,0,4,2);const g=new o.aL;g.emplaceBack(0,0),g.emplaceBack(o.$,0),g.emplaceBack(0,o.$),g.emplaceBack(o.$,o.$),this.debugBuffer=s.createVertexBuffer(g,Zt.members),this.debugSegments=o.aM.simpleSegment(0,0,4,5);const v=new o.c6;v.emplaceBack(0,0,0,0),v.emplaceBack(o.$,0,o.$,0),v.emplaceBack(0,o.$,0,o.$),v.emplaceBack(o.$,o.$,o.$,o.$),this.rasterBoundsBuffer=s.createVertexBuffer(v,Dg.members),this.rasterBoundsSegments=o.aM.simpleSegment(0,0,4,2);const w=new o.aL;w.emplaceBack(0,0),w.emplaceBack(o.$,0),w.emplaceBack(0,o.$),w.emplaceBack(o.$,o.$),this.rasterBoundsBufferPosOnly=s.createVertexBuffer(w,Zt.members),this.rasterBoundsSegmentsPosOnly=o.aM.simpleSegment(0,0,4,5);const C=new o.aL;C.emplaceBack(0,0),C.emplaceBack(1,0),C.emplaceBack(0,1),C.emplaceBack(1,1),this.viewportBuffer=s.createVertexBuffer(C,Zt.members),this.viewportSegments=o.aM.simpleSegment(0,0,4,2);const B=new o.c7;B.emplaceBack(0),B.emplaceBack(1),B.emplaceBack(3),B.emplaceBack(2),B.emplaceBack(0),this.tileBorderIndexBuffer=s.createIndexBuffer(B);const O=new o.aN;O.emplaceBack(1,0,2),O.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=s.createIndexBuffer(O);const F=this.context.gl;this.stencilClearMode=new Br({func:F.ALWAYS,mask:0},0,255,F.ZERO,F.ZERO,F.ZERO),this.tileExtentMesh=new mt(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){const s=this.context,d=s.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const g=o.L();o.bY(g,0,this.width,this.height,0,0,1),o.N(g,g,[d.drawingBufferWidth,d.drawingBufferHeight,0]);const v={mainMatrix:g,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:g};this.useProgram("clippingMask",null,!0).draw(s,d.TRIANGLES,mr.disabled,this.stencilClearMode,oi.disabled,cr.disabled,null,null,v,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(s,d,g){if(this.currentStencilSource===s.source||!s.isTileClipped()||!d||!d.length)return;this.currentStencilSource=s.source,this.nextStencilID+d.length>256&&this.clearStencil();const v=this.context;v.setColorMode(oi.disabled),v.setDepthMode(mr.disabled);const w={};for(const C of d)w[C.key]=this.nextStencilID++;this._renderTileMasks(w,d,g,!0),this._renderTileMasks(w,d,g,!1),this._tileClippingMaskIDs=w}_renderTileMasks(s,d,g,v){const w=this.context,C=w.gl,B=this.style.projection,O=this.transform,F=this.useProgram("clippingMask");for(const U of d){const K=s[U.key],W=this.style.map.terrain&&this.style.map.terrain.getTerrainData(U),X=B.getMeshFromTileID(this.context,U.canonical,v,!0,"stencil"),re=O.getProjectionData({overscaledTileID:U,applyGlobeMatrix:!g,applyTerrainMatrix:!0});F.draw(w,C.TRIANGLES,mr.disabled,new Br({func:C.ALWAYS,mask:0},K,255,C.KEEP,C.KEEP,C.REPLACE),oi.disabled,g?cr.disabled:cr.backCCW,null,W,re,"$clipping",X.vertexBuffer,X.indexBuffer,X.segments)}}_renderTilesDepthBuffer(){const s=this.context,d=s.gl,g=this.style.projection,v=this.transform,w=this.useProgram("depth"),C=this.getDepthModeFor3D(),B=Ne(v,{tileSize:v.tileSize});for(const O of B){const F=this.style.map.terrain&&this.style.map.terrain.getTerrainData(O),U=g.getMeshFromTileID(this.context,O.canonical,!0,!0,"raster"),K=v.getProjectionData({overscaledTileID:O,applyGlobeMatrix:!0,applyTerrainMatrix:!0});w.draw(s,d.TRIANGLES,C,Br.disabled,oi.disabled,cr.backCCW,null,F,K,"$clipping",U.vertexBuffer,U.indexBuffer,U.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const s=this.nextStencilID++,d=this.context.gl;return new Br({func:d.NOTEQUAL,mask:255},s,255,d.KEEP,d.KEEP,d.REPLACE)}stencilModeForClipping(s){const d=this.context.gl;return new Br({func:d.EQUAL,mask:255},this._tileClippingMaskIDs[s.key],0,d.KEEP,d.KEEP,d.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(s){const d=this.context.gl,g=s.sort(((C,B)=>B.overscaledZ-C.overscaledZ)),v=g[g.length-1].overscaledZ,w=g[0].overscaledZ-v+1;if(w>1){this.currentStencilSource=void 0,this.nextStencilID+w>256&&this.clearStencil();const C={};for(let B=0;B<w;B++)C[B+v]=new Br({func:d.GEQUAL,mask:255},B+this.nextStencilID,255,d.KEEP,d.KEEP,d.REPLACE);return this.nextStencilID+=w,[C,g]}return[{[v]:Br.disabled},g]}stencilConfigForOverlapTwoPass(s){const d=this.context.gl,g=s.sort(((C,B)=>B.overscaledZ-C.overscaledZ)),v=g[g.length-1].overscaledZ,w=g[0].overscaledZ-v+1;if(this.clearStencil(),w>1){const C={},B={};for(let O=0;O<w;O++)C[O+v]=new Br({func:d.GREATER,mask:255},w+1+O,255,d.KEEP,d.KEEP,d.REPLACE),B[O+v]=new Br({func:d.GREATER,mask:255},1+O,255,d.KEEP,d.KEEP,d.REPLACE);return this.nextStencilID=2*w+1,[C,B,g]}return this.nextStencilID=3,[{[v]:new Br({func:d.GREATER,mask:255},2,255,d.KEEP,d.KEEP,d.REPLACE)},{[v]:new Br({func:d.GREATER,mask:255},1,255,d.KEEP,d.KEEP,d.REPLACE)},g]}colorModeForRenderPass(){const s=this.context.gl;return this._showOverdrawInspector?new oi([s.CONSTANT_COLOR,s.ONE],new o.bf(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?oi.unblended:oi.alphaBlended}getDepthModeForSublayer(s,d,g){if(!this.opaquePassEnabledForLayer())return mr.disabled;const v=1-((1+this.currentLayer)*this.numSublayers+s)*this.depthEpsilon;return new mr(g||this.context.gl.LEQUAL,d,[v,v])}getDepthModeFor3D(){return new mr(this.context.gl.LEQUAL,mr.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(s,d){var g,v;this.style=s,this.options=d,this.lineAtlas=s.lineAtlas,this.imageManager=s.imageManager,this.glyphManager=s.glyphManager,this.symbolFadeChange=s.placement.symbolFadeChange(M.now()),this.imageManager.beginFrame();const w=this.style._order,C=this.style.sourceCaches,B={},O={},F={},U={isRenderingToTexture:!1,isRenderingGlobe:((g=s.projection)===null||g===void 0?void 0:g.transitionState)>0};for(const W in C){const X=C[W];X.used&&X.prepare(this.context),B[W]=X.getVisibleCoordinates(!1),O[W]=B[W].slice().reverse(),F[W]=X.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let W=0;W<w.length;W++)if(this.style._layers[w[W]].is3D()){this.opaquePassCutoff=W;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const W of w){const X=this.style._layers[W];if(!X.hasOffscreenPass()||X.isHidden(this.transform.zoom))continue;const re=O[X.source];(X.type==="custom"||re.length)&&this.renderLayer(this,C[X.source],X,re,U)}if((v=this.style.projection)===null||v===void 0||v.updateGPUdependent({context:this.context,useProgram:W=>this.useProgram(W)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:d.showOverdrawInspector?o.bf.black:o.bf.transparent,depth:1}),this.clearStencil(),this.style.sky&&(function(W,X){const re=W.context,ue=re.gl,fe=((Ie,be,ke)=>{const Xe=Math.cos(be.rollInRadians),qe=Math.sin(be.rollInRadians),Ze=Ce(be),tt=be.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:Ie.properties.get("sky-color"),u_horizon_color:Ie.properties.get("horizon-color"),u_horizon:[(be.width/2-Ze*qe)*ke,(be.height/2+Ze*Xe)*ke],u_horizon_normal:[-qe,Xe],u_sky_horizon_blend:Ie.properties.get("sky-horizon-blend")*be.height/2*ke,u_sky_blend:tt}})(X,W.style.map.transform,W.pixelRatio),pe=new mr(ue.LEQUAL,mr.ReadWrite,[0,1]),_e=Br.disabled,we=W.colorModeForRenderPass(),ye=W.useProgram("sky"),Te=ka(re,X);ye.draw(re,ue.TRIANGLES,pe,_e,we,cr.disabled,fe,null,void 0,"sky",Te.vertexBuffer,Te.indexBuffer,Te.segments)})(this,this.style.sky),this._showOverdrawInspector=d.showOverdrawInspector,this.depthRangeFor3D=[0,1-(s._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=w.length-1;this.currentLayer>=0;this.currentLayer--){const W=this.style._layers[w[this.currentLayer]],X=C[W.source],re=B[W.source];this._renderTileClippingMasks(W,re,!1),this.renderLayer(this,X,W,re,U)}this.renderPass="translucent";let K=!1;for(this.currentLayer=0;this.currentLayer<w.length;this.currentLayer++){const W=this.style._layers[w[this.currentLayer]],X=C[W.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(W,U))continue;this.opaquePassEnabledForLayer()||K||(K=!0,U.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());const re=(W.type==="symbol"?F:O)[W.source];this._renderTileClippingMasks(W,B[W.source],!!this.renderToTexture),this.renderLayer(this,X,W,re,U)}if(U.isRenderingGlobe&&(function(W,X,re){const ue=W.context,fe=ue.gl,pe=W.useProgram("atmosphere"),_e=new mr(fe.LEQUAL,mr.ReadOnly,[0,1]),we=W.transform,ye=(function(tt,bt){const wt=tt.properties.get("position"),ut=[-wt.x,-wt.y,-wt.z],jt=o.ag(new Float64Array(16));return tt.properties.get("anchor")==="map"&&(o.b6(jt,jt,bt.rollInRadians),o.b7(jt,jt,-bt.pitchInRadians),o.b6(jt,jt,bt.bearingInRadians),o.b7(jt,jt,bt.center.lat*Math.PI/180),o.bz(jt,jt,-bt.center.lng*Math.PI/180)),o.c5(ut,ut,jt),ut})(re,W.transform),Te=we.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),Ie=X.properties.get("atmosphere-blend")*Te.projectionTransition;if(Ie===0)return;const be=Ta(we.worldSize,we.center.lat),ke=we.inverseProjectionMatrix,Xe=new Float64Array(4);Xe[3]=1,o.aw(Xe,Xe,we.modelViewProjectionMatrix),Xe[0]/=Xe[3],Xe[1]/=Xe[3],Xe[2]/=Xe[3],Xe[3]=1,o.aw(Xe,Xe,ke),Xe[0]/=Xe[3],Xe[1]/=Xe[3],Xe[2]/=Xe[3],Xe[3]=1;const qe=((tt,bt,wt,ut,jt)=>({u_sun_pos:tt,u_atmosphere_blend:bt,u_globe_position:wt,u_globe_radius:ut,u_inv_proj_matrix:jt}))(ye,Ie,[Xe[0],Xe[1],Xe[2]],be,ke),Ze=ka(ue,X);pe.draw(ue,fe.TRIANGLES,_e,Br.disabled,oi.alphaBlended,cr.disabled,qe,null,null,"atmosphere",Ze.vertexBuffer,Ze.indexBuffer,Ze.segments)})(this,this.style.sky,this.style.light),this.options.showTileBoundaries){const W=(function(X,re){let ue=null;const fe=Object.values(X._layers).flatMap((ye=>ye.source&&!ye.isHidden(re)?[X.sourceCaches[ye.source]]:[])),pe=fe.filter((ye=>ye.getSource().type==="vector")),_e=fe.filter((ye=>ye.getSource().type!=="vector")),we=ye=>{(!ue||ue.getSource().maxzoom<ye.getSource().maxzoom)&&(ue=ye)};return pe.forEach((ye=>we(ye))),ue||_e.forEach((ye=>we(ye))),ue})(this.style,this.transform.zoom);W&&(function(X,re,ue){for(let fe=0;fe<ue.length;fe++)Fn(X,re,ue[fe])})(this,W,W.getVisibleCoordinates())}this.options.showPadding&&(function(W){const X=W.transform.padding;Qu(W,W.transform.height-(X.top||0),3,Wh),Qu(W,X.bottom||0,3,$p),ei(W,X.left||0,3,Ju),ei(W,W.transform.width-(X.right||0),3,bf);const re=W.transform.centerPoint;(function(ue,fe,pe,_e){Vo(ue,fe-1,pe-10,2,20,_e),Vo(ue,fe-10,pe-1,20,2,_e)})(W,re.x,W.transform.height-re.y,Gg)})(this),this.context.setDefault()}maybeDrawDepthAndCoords(s){if(!this.style||!this.style.map||!this.style.map.terrain)return;const d=this.terrainFacilitator.matrix,g=this.transform.modelViewProjectionMatrix;let v=this.terrainFacilitator.dirty;v||(v=s?!o.c8(d,g):!o.c9(d,g)),v||(v=this.style.map.terrain.sourceCache.anyTilesAfterTime(this.terrainFacilitator.renderTime)),v&&(o.ca(d,g),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,(function(w,C){const B=w.context,O=B.gl,F=w.transform,U=oi.unblended,K=new mr(O.LEQUAL,mr.ReadWrite,[0,1]),W=C.sourceCache.getRenderableTiles(),X=w.useProgram("terrainDepth");B.bindFramebuffer.set(C.getFramebuffer("depth").framebuffer),B.viewport.set([0,0,w.width/devicePixelRatio,w.height/devicePixelRatio]),B.clear({color:o.bf.transparent,depth:1});for(const re of W){const ue=C.getTerrainMesh(re.tileID),fe=C.getTerrainData(re.tileID),pe=F.getProjectionData({overscaledTileID:re.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),_e={u_ele_delta:C.getMeshFrameDelta(F.zoom)};X.draw(B,O.TRIANGLES,K,Br.disabled,U,cr.backCCW,_e,fe,pe,"terrain",ue.vertexBuffer,ue.indexBuffer,ue.segments)}B.bindFramebuffer.set(null),B.viewport.set([0,0,w.width,w.height])})(this,this.style.map.terrain),(function(w,C){const B=w.context,O=B.gl,F=w.transform,U=oi.unblended,K=new mr(O.LEQUAL,mr.ReadWrite,[0,1]),W=C.getCoordsTexture(),X=C.sourceCache.getRenderableTiles(),re=w.useProgram("terrainCoords");B.bindFramebuffer.set(C.getFramebuffer("coords").framebuffer),B.viewport.set([0,0,w.width/devicePixelRatio,w.height/devicePixelRatio]),B.clear({color:o.bf.transparent,depth:1}),C.coordsIndex=[];for(const ue of X){const fe=C.getTerrainMesh(ue.tileID),pe=C.getTerrainData(ue.tileID);B.activeTexture.set(O.TEXTURE0),O.bindTexture(O.TEXTURE_2D,W.texture);const _e={u_terrain_coords_id:(255-C.coordsIndex.length)/255,u_texture:0,u_ele_delta:C.getMeshFrameDelta(F.zoom)},we=F.getProjectionData({overscaledTileID:ue.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});re.draw(B,O.TRIANGLES,K,Br.disabled,U,cr.backCCW,_e,pe,we,"terrain",fe.vertexBuffer,fe.indexBuffer,fe.segments),C.coordsIndex.push(ue.tileID.key)}B.bindFramebuffer.set(null),B.viewport.set([0,0,w.width,w.height])})(this,this.style.map.terrain))}renderLayer(s,d,g,v,w){g.isHidden(this.transform.zoom)||(g.type==="background"||g.type==="custom"||(v||[]).length)&&(this.id=g.id,o.cb(g)?(function(C,B,O,F,U,K){if(C.renderPass!=="translucent")return;const{isRenderingToTexture:W}=K,X=Br.disabled,re=C.colorModeForRenderPass();(O._unevaluatedLayout.hasValue("text-variable-anchor")||O._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&(function(ue,fe,pe,_e,we,ye,Te,Ie,be){const ke=fe.transform,Xe=fe.style.map.terrain,qe=we==="map",Ze=ye==="map";for(const tt of ue){const bt=_e.getTile(tt),wt=bt.getBucket(pe);if(!wt||!wt.text||!wt.text.segments.get().length)continue;const ut=o.an(wt.textSizeData,ke.zoom),jt=o.aC(bt,1,fe.transform.zoom),Sr=fi(qe,fe.transform,jt),Gr=pe.layout.get("icon-text-fit")!=="none"&&wt.hasIconData();if(ut){const ii=Math.pow(2,ke.zoom-bt.tileID.overscaledZ),Jr=Xe?(ui,Si)=>Xe.getElevation(tt,ui,Si):null;Yc(wt,qe,Ze,be,ke,Sr,ii,ut,Gr,o.aD(ke,bt,Te,Ie),tt.toUnwrapped(),Jr)}}})(F,C,O,B,O.layout.get("text-rotation-alignment"),O.layout.get("text-pitch-alignment"),O.paint.get("text-translate"),O.paint.get("text-translate-anchor"),U),O.paint.get("icon-opacity").constantOr(1)!==0&&Jc(C,B,O,F,!1,O.paint.get("icon-translate"),O.paint.get("icon-translate-anchor"),O.layout.get("icon-rotation-alignment"),O.layout.get("icon-pitch-alignment"),O.layout.get("icon-keep-upright"),X,re,W),O.paint.get("text-opacity").constantOr(1)!==0&&Jc(C,B,O,F,!0,O.paint.get("text-translate"),O.paint.get("text-translate-anchor"),O.layout.get("text-rotation-alignment"),O.layout.get("text-pitch-alignment"),O.layout.get("text-keep-upright"),X,re,W),B.map.showCollisionBoxes&&(yf(C,B,O,F,!0),yf(C,B,O,F,!1))})(s,d,g,v,this.style.placement.variableOffsets,w):o.cc(g)?(function(C,B,O,F,U){if(C.renderPass!=="translucent")return;const{isRenderingToTexture:K}=U,W=O.paint.get("circle-opacity"),X=O.paint.get("circle-stroke-width"),re=O.paint.get("circle-stroke-opacity"),ue=!O.layout.get("circle-sort-key").isConstant();if(W.constantOr(1)===0&&(X.constantOr(1)===0||re.constantOr(1)===0))return;const fe=C.context,pe=fe.gl,_e=C.transform,we=C.getDepthModeForSublayer(0,mr.ReadOnly),ye=Br.disabled,Te=C.colorModeForRenderPass(),Ie=[],be=_e.getCircleRadiusCorrection();for(let ke=0;ke<F.length;ke++){const Xe=F[ke],qe=B.getTile(Xe),Ze=qe.getBucket(O);if(!Ze)continue;const tt=O.paint.get("circle-translate"),bt=O.paint.get("circle-translate-anchor"),wt=o.aD(_e,qe,tt,bt),ut=Ze.programConfigurations.get(O.id),jt=C.useProgram("circle",ut),Sr=Ze.layoutVertexBuffer,Gr=Ze.indexBuffer,ii=C.style.map.terrain&&C.style.map.terrain.getTerrainData(Xe),Jr={programConfiguration:ut,program:jt,layoutVertexBuffer:Sr,indexBuffer:Gr,uniformValues:Fg(C,qe,O,wt,be),terrainData:ii,projectionData:_e.getProjectionData({overscaledTileID:Xe,applyGlobeMatrix:!K,applyTerrainMatrix:!0})};if(ue){const ui=Ze.segments.get();for(const Si of ui)Ie.push({segments:new o.aM([Si]),sortKey:Si.sortKey,state:Jr})}else Ie.push({segments:Ze.segments,sortKey:0,state:Jr})}ue&&Ie.sort(((ke,Xe)=>ke.sortKey-Xe.sortKey));for(const ke of Ie){const{programConfiguration:Xe,program:qe,layoutVertexBuffer:Ze,indexBuffer:tt,uniformValues:bt,terrainData:wt,projectionData:ut}=ke.state;qe.draw(fe,pe.TRIANGLES,we,ye,Te,cr.backCCW,bt,wt,ut,O.id,Ze,tt,ke.segments,O.paint,C.transform.zoom,Xe)}})(s,d,g,v,w):o.cd(g)?(function(C,B,O,F,U){if(O.paint.get("heatmap-opacity")===0)return;const K=C.context,{isRenderingToTexture:W,isRenderingGlobe:X}=U;if(C.style.map.terrain){for(const re of F){const ue=B.getTile(re);B.hasRenderableParent(re)||(C.renderPass==="offscreen"?Jl(C,ue,O,re,X):C.renderPass==="translucent"&&Zu(C,O,re,W,X))}K.viewport.set([0,0,C.width,C.height])}else C.renderPass==="offscreen"?(function(re,ue,fe,pe){const _e=re.context,we=_e.gl,ye=re.transform,Te=Br.disabled,Ie=new oi([we.ONE,we.ONE],o.bf.transparent,[!0,!0,!0,!0]);(function(be,ke,Xe){const qe=be.gl;be.activeTexture.set(qe.TEXTURE1),be.viewport.set([0,0,ke.width/4,ke.height/4]);let Ze=Xe.heatmapFbos.get(o.c2);Ze?(qe.bindTexture(qe.TEXTURE_2D,Ze.colorAttachment.get()),be.bindFramebuffer.set(Ze.framebuffer)):(Ze=ia(be,ke.width/4,ke.height/4),Xe.heatmapFbos.set(o.c2,Ze))})(_e,re,fe),_e.clear({color:o.bf.transparent});for(let be=0;be<pe.length;be++){const ke=pe[be];if(ue.hasRenderableParent(ke))continue;const Xe=ue.getTile(ke),qe=Xe.getBucket(fe);if(!qe)continue;const Ze=qe.programConfigurations.get(fe.id),tt=re.useProgram("heatmap",Ze),bt=ye.getProjectionData({overscaledTileID:ke,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),wt=ye.getCircleRadiusCorrection();tt.draw(_e,we.TRIANGLES,mr.disabled,Te,Ie,cr.backCCW,zp(Xe,ye.zoom,fe.paint.get("heatmap-intensity"),wt),null,bt,fe.id,qe.layoutVertexBuffer,qe.indexBuffer,qe.segments,fe.paint,ye.zoom,Ze)}_e.viewport.set([0,0,re.width,re.height])})(C,B,O,F):C.renderPass==="translucent"&&(function(re,ue){const fe=re.context,pe=fe.gl;fe.setColorMode(re.colorModeForRenderPass());const _e=ue.heatmapFbos.get(o.c2);_e&&(fe.activeTexture.set(pe.TEXTURE0),pe.bindTexture(pe.TEXTURE_2D,_e.colorAttachment.get()),fe.activeTexture.set(pe.TEXTURE1),Qc(fe,ue).bind(pe.LINEAR,pe.CLAMP_TO_EDGE),re.useProgram("heatmapTexture").draw(fe,pe.TRIANGLES,mr.disabled,Br.disabled,re.colorModeForRenderPass(),cr.disabled,rf(re,ue,0,1),null,null,ue.id,re.viewportBuffer,re.quadTriangleIndexBuffer,re.viewportSegments,ue.paint,re.transform.zoom))})(C,O)})(s,d,g,v,w):o.ce(g)?(function(C,B,O,F,U){if(C.renderPass!=="translucent")return;const{isRenderingToTexture:K}=U,W=O.paint.get("line-opacity"),X=O.paint.get("line-width");if(W.constantOr(1)===0||X.constantOr(1)===0)return;const re=C.getDepthModeForSublayer(0,mr.ReadOnly),ue=C.colorModeForRenderPass(),fe=O.paint.get("line-dasharray"),pe=O.paint.get("line-pattern"),_e=pe.constantOr(1),we=O.paint.get("line-gradient"),ye=O.getCrossfadeParameters(),Te=_e?"linePattern":fe?"lineSDF":we?"lineGradient":"line",Ie=C.context,be=Ie.gl,ke=C.transform;let Xe=!0;for(const qe of F){const Ze=B.getTile(qe);if(_e&&!Ze.patternsLoaded())continue;const tt=Ze.getBucket(O);if(!tt)continue;const bt=tt.programConfigurations.get(O.id),wt=C.context.program.get(),ut=C.useProgram(Te,bt),jt=Xe||ut.program!==wt,Sr=C.style.map.terrain&&C.style.map.terrain.getTerrainData(qe),Gr=pe.constantOr(null);if(Gr&&Ze.imageAtlas){const br=Ze.imageAtlas,qr=br.patternPositions[Gr.to.toString()],Ji=br.patternPositions[Gr.from.toString()];qr&&Ji&&bt.setConstantPatternPositions(qr,Ji)}const ii=ke.getProjectionData({overscaledTileID:qe,applyGlobeMatrix:!K,applyTerrainMatrix:!0}),Jr=ke.getPixelScale(),ui=_e?lf(C,Ze,O,Jr,ye):fe?pl(C,Ze,O,Jr,fe,ye):we?af(C,Ze,O,Jr,tt.lineClipsArray.length):zu(C,Ze,O,Jr);if(_e)Ie.activeTexture.set(be.TEXTURE0),Ze.imageAtlasTexture.bind(be.LINEAR,be.CLAMP_TO_EDGE),bt.updatePaintBuffers(ye);else if(fe&&(jt||C.lineAtlas.dirty))Ie.activeTexture.set(be.TEXTURE0),C.lineAtlas.bind(Ie);else if(we){const br=tt.gradients[O.id];let qr=br.texture;if(O.gradientVersion!==br.version){let Ji=256;if(O.stepInterpolant){const on=B.getSource().maxzoom,_n=qe.canonical.z===on?Math.ceil(1<<C.transform.maxZoom-qe.canonical.z):1;Ji=o.ah(o.c3(tt.maxLineLength/o.$*1024*_n),256,Ie.maxTextureSize)}br.gradient=o.c4({expression:O.gradientExpression(),evaluationKey:"lineProgress",resolution:Ji,image:br.gradient||void 0,clips:tt.lineClipsArray}),br.texture?br.texture.update(br.gradient):br.texture=new o.T(Ie,br.gradient,be.RGBA),br.version=O.gradientVersion,qr=br.texture}Ie.activeTexture.set(be.TEXTURE0),qr.bind(O.stepInterpolant?be.NEAREST:be.LINEAR,be.CLAMP_TO_EDGE)}const Si=C.stencilModeForClipping(qe);ut.draw(Ie,be.TRIANGLES,re,Si,ue,cr.disabled,ui,Sr,ii,O.id,tt.layoutVertexBuffer,tt.indexBuffer,tt.segments,O.paint,C.transform.zoom,bt,tt.layoutVertexBuffer2),Xe=!1}})(s,d,g,v,w):o.cf(g)?(function(C,B,O,F,U){const K=O.paint.get("fill-color"),W=O.paint.get("fill-opacity");if(W.constantOr(1)===0)return;const{isRenderingToTexture:X}=U,re=C.colorModeForRenderPass(),ue=O.paint.get("fill-pattern"),fe=C.opaquePassEnabledForLayer()&&!ue.constantOr(1)&&K.constantOr(o.bf.transparent).a===1&&W.constantOr(0)===1?"opaque":"translucent";if(C.renderPass===fe){const pe=C.getDepthModeForSublayer(1,C.renderPass==="opaque"?mr.ReadWrite:mr.ReadOnly);Hh(C,B,O,F,pe,re,!1,X)}if(C.renderPass==="translucent"&&O.paint.get("fill-antialias")){const pe=C.getDepthModeForSublayer(O.getPaintProperty("fill-outline-color")?2:0,mr.ReadOnly);Hh(C,B,O,F,pe,re,!0,X)}})(s,d,g,v,w):o.cg(g)?(function(C,B,O,F,U){const K=O.paint.get("fill-extrusion-opacity");if(K===0)return;const{isRenderingToTexture:W}=U;if(C.renderPass==="translucent"){const X=new mr(C.context.gl.LEQUAL,mr.ReadWrite,C.depthRangeFor3D);if(K!==1||O.paint.get("fill-extrusion-pattern").constantOr(1))$h(C,B,O,F,X,Br.disabled,oi.disabled,W),$h(C,B,O,F,X,C.stencilModeFor3D(),C.colorModeForRenderPass(),W);else{const re=C.colorModeForRenderPass();$h(C,B,O,F,X,Br.disabled,re,W)}}})(s,d,g,v,w):o.ch(g)?(function(C,B,O,F,U){if(C.renderPass!=="offscreen"&&C.renderPass!=="translucent")return;const{isRenderingToTexture:K}=U,W=C.context,X=C.style.projection.useSubdivision,re=C.getDepthModeForSublayer(0,mr.ReadOnly),ue=C.colorModeForRenderPass();if(C.renderPass==="offscreen")(function(fe,pe,_e,we,ye,Te,Ie){const be=fe.context,ke=be.gl;for(const Xe of _e){const qe=pe.getTile(Xe),Ze=qe.dem;if(!Ze||!Ze.data||!qe.needsHillshadePrepare)continue;const tt=Ze.dim,bt=Ze.stride,wt=Ze.getPixels();if(be.activeTexture.set(ke.TEXTURE1),be.pixelStoreUnpackPremultiplyAlpha.set(!1),qe.demTexture=qe.demTexture||fe.getTileTexture(bt),qe.demTexture){const jt=qe.demTexture;jt.update(wt,{premultiply:!1}),jt.bind(ke.NEAREST,ke.CLAMP_TO_EDGE)}else qe.demTexture=new o.T(be,wt,ke.RGBA,{premultiply:!1}),qe.demTexture.bind(ke.NEAREST,ke.CLAMP_TO_EDGE);be.activeTexture.set(ke.TEXTURE0);let ut=qe.fbo;if(!ut){const jt=new o.T(be,{width:tt,height:tt,data:null},ke.RGBA);jt.bind(ke.LINEAR,ke.CLAMP_TO_EDGE),ut=qe.fbo=be.createFramebuffer(tt,tt,!0,!1),ut.colorAttachment.set(jt.texture)}be.bindFramebuffer.set(ut.framebuffer),be.viewport.set([0,0,tt,tt]),fe.useProgram("hillshadePrepare").draw(be,ke.TRIANGLES,ye,Te,Ie,cr.disabled,Gc(qe.tileID,Ze),null,null,we.id,fe.rasterBoundsBuffer,fe.quadTriangleIndexBuffer,fe.rasterBoundsSegments),qe.needsHillshadePrepare=!1}})(C,B,F,O,re,Br.disabled,ue),W.viewport.set([0,0,C.width,C.height]);else if(C.renderPass==="translucent")if(X){const[fe,pe,_e]=C.stencilConfigForOverlapTwoPass(F);na(C,B,O,_e,fe,re,ue,!1,K),na(C,B,O,_e,pe,re,ue,!0,K)}else{const[fe,pe]=C.getStencilConfigForOverlapAndUpdateStencilID(F);na(C,B,O,pe,fe,re,ue,!1,K)}})(s,d,g,v,w):o.ci(g)?(function(C,B,O,F,U){if(C.renderPass!=="translucent"||!F.length)return;const{isRenderingToTexture:K}=U,W=C.style.projection.useSubdivision,X=C.getDepthModeForSublayer(0,mr.ReadOnly),re=C.colorModeForRenderPass();if(W){const[ue,fe,pe]=C.stencilConfigForOverlapTwoPass(F);eu(C,B,O,pe,ue,X,re,!1,K),eu(C,B,O,pe,fe,X,re,!0,K)}else{const[ue,fe]=C.getStencilConfigForOverlapAndUpdateStencilID(F);eu(C,B,O,fe,ue,X,re,!1,K)}})(s,d,g,v,w):o.cj(g)?(function(C,B,O,F,U){if(C.renderPass!=="translucent"||O.paint.get("raster-opacity")===0||!F.length)return;const{isRenderingToTexture:K}=U,W=B.getSource(),X=C.style.projection.useSubdivision;if(W instanceof ns)Ia(C,B,O,F,null,!1,!1,W.tileCoords,W.flippedWindingOrder,K);else if(X){const[re,ue,fe]=C.stencilConfigForOverlapTwoPass(F);Ia(C,B,O,fe,re,!1,!0,tu,!1,K),Ia(C,B,O,fe,ue,!0,!0,tu,!1,K)}else{const[re,ue]=C.getStencilConfigForOverlapAndUpdateStencilID(F);Ia(C,B,O,ue,re,!1,!0,tu,!1,K)}})(s,d,g,v,w):o.ck(g)?(function(C,B,O,F,U){const K=O.paint.get("background-color"),W=O.paint.get("background-opacity");if(W===0)return;const{isRenderingToTexture:X}=U,re=C.context,ue=re.gl,fe=C.style.projection,pe=C.transform,_e=pe.tileSize,we=O.paint.get("background-pattern");if(C.isPatternMissing(we))return;const ye=!we&&K.a===1&&W===1&&C.opaquePassEnabledForLayer()?"opaque":"translucent";if(C.renderPass!==ye)return;const Te=Br.disabled,Ie=C.getDepthModeForSublayer(0,ye==="opaque"?mr.ReadWrite:mr.ReadOnly),be=C.colorModeForRenderPass(),ke=C.useProgram(we?"backgroundPattern":"background"),Xe=F||Ne(pe,{tileSize:_e,terrain:C.style.map.terrain});we&&(re.activeTexture.set(ue.TEXTURE0),C.imageManager.bind(C.context));const qe=O.getCrossfadeParameters();for(const Ze of Xe){const tt=pe.getProjectionData({overscaledTileID:Ze,applyGlobeMatrix:!X,applyTerrainMatrix:!0}),bt=we?jp(W,C,we,{tileID:Ze,tileSize:_e},qe):$c(W,K),wt=C.style.map.terrain&&C.style.map.terrain.getTerrainData(Ze),ut=fe.getMeshFromTileID(re,Ze.canonical,!1,!0,"raster");ke.draw(re,ue.TRIANGLES,Ie,Te,be,cr.backCCW,bt,wt,tt,O.id,ut.vertexBuffer,ut.indexBuffer,ut.segments)}})(s,0,g,v,w):o.cl(g)&&(function(C,B,O,F){const{isRenderingGlobe:U}=F,K=C.context,W=O.implementation,X=C.style.projection,re=C.transform,ue=re.getProjectionDataForCustomLayer(U),fe={farZ:re.farZ,nearZ:re.nearZ,fov:re.fov*Math.PI/180,modelViewProjectionMatrix:re.modelViewProjectionMatrix,projectionMatrix:re.projectionMatrix,shaderData:{variantName:X.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;
uniform mat4 u_projection_matrix;
${X.shaderPreludeCode.vertexSource}`,define:X.shaderDefine},defaultProjectionData:ue},pe=W.renderingMode?W.renderingMode:"2d";if(C.renderPass==="offscreen"){const _e=W.prerender;_e&&(C.setCustomLayerDefaults(),K.setColorMode(C.colorModeForRenderPass()),_e.call(W,K.gl,fe),K.setDirty(),C.setBaseState())}else if(C.renderPass==="translucent"){C.setCustomLayerDefaults(),K.setColorMode(C.colorModeForRenderPass()),K.setStencilMode(Br.disabled);const _e=pe==="3d"?C.getDepthModeFor3D():C.getDepthModeForSublayer(0,mr.ReadOnly);K.setDepthMode(_e),W.render(K.gl,fe),K.setDirty(),C.setBaseState(),K.bindFramebuffer.set(null)}})(s,0,g,w))}saveTileTexture(s){const d=this._tileTextures[s.size[0]];d?d.push(s):this._tileTextures[s.size[0]]=[s]}getTileTexture(s){const d=this._tileTextures[s];return d&&d.length>0?d.pop():null}isPatternMissing(s){if(!s)return!1;if(!s.from||!s.to)return!0;const d=this.imageManager.getPattern(s.from.toString()),g=this.imageManager.getPattern(s.to.toString());return!d||!g}useProgram(s,d,g=!1,v=[]){this.cache=this.cache||{};const w=!!this.style.map.terrain,C=this.style.projection,B=g?Pe.projectionMercator:C.shaderPreludeCode,O=g?Er:C.shaderDefine,F=s+(d?d.cacheKey:"")+`/${g?Wr:C.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(w?"/terrain":"")+(v?`/${v.join("/")}`:"");return this.cache[F]||(this.cache[F]=new tf(this.context,Pe[s],d,hf[s],this._showOverdrawInspector,w,B,O,v)),this.cache[F]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const s=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(s.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new o.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:s,drawingBufferHeight:d}=this.context.gl;return this.width!==s||this.height!==d}}function Ba(x,s){let d,g=!1,v=null,w=null;const C=()=>{v=null,g&&(x.apply(w,d),v=setTimeout(C,s),g=!1)};return(...B)=>(g=!0,w=this,d=B,v||C(),v)}class qh{constructor(s){this._getCurrentHash=()=>{const d=window.location.hash.replace("#","");if(this._hashName){let g;return d.split("&").map((v=>v.split("="))).forEach((v=>{v[0]===this._hashName&&(g=v)})),(g&&g[1]||"").split("/")}return d.split("/")},this._onHashChange=()=>{const d=this._getCurrentHash();if(!this._isValidHash(d))return!1;const g=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(d[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+d[2],+d[1]],zoom:+d[0],bearing:g,pitch:+(d[4]||0)}),!0},this._updateHashUnthrottled=()=>{const d=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,d)},this._removeHash=()=>{const d=this._getCurrentHash();if(d.length===0)return;const g=d.join("/");let v=g;v.split("&").length>0&&(v=v.split("&")[0]),this._hashName&&(v=`${this._hashName}=${g}`);let w=window.location.hash.replace(v,"");w.startsWith("#&")?w=w.slice(0,1)+w.slice(2):w==="#"&&(w="");let C=window.location.href.replace(/(#.+)?$/,w);C=C.replace("&&","&"),window.history.replaceState(window.history.state,null,C)},this._updateHash=Ba(this._updateHashUnthrottled,300),this._hashName=s&&encodeURIComponent(s)}addTo(s){return this._map=s,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(s){const d=this._map.getCenter(),g=Math.round(100*this._map.getZoom())/100,v=Math.ceil((g*Math.LN2+Math.log(512/360/.5))/Math.LN10),w=Math.pow(10,v),C=Math.round(d.lng*w)/w,B=Math.round(d.lat*w)/w,O=this._map.getBearing(),F=this._map.getPitch();let U="";if(U+=s?`/${C}/${B}/${g}`:`${g}/${B}/${C}`,(O||F)&&(U+="/"+Math.round(10*O)/10),F&&(U+=`/${Math.round(F)}`),this._hashName){const K=this._hashName;let W=!1;const X=window.location.hash.slice(1).split("&").map((re=>{const ue=re.split("=")[0];return ue===K?(W=!0,`${ue}=${U}`):re})).filter((re=>re));return W||X.push(`${K}=${U}`),`#${X.join("&")}`}return`#${U}`}_isValidHash(s){if(s.length<3||s.some(isNaN))return!1;try{new o.S(+s[2],+s[1])}catch{return!1}const d=+s[0],g=+(s[3]||0),v=+(s[4]||0);return d>=this._map.getMinZoom()&&d<=this._map.getMaxZoom()&&g>=-180&&g<=180&&v>=this._map.getMinPitch()&&v<=this._map.getMaxPitch()}}const La={linearity:.3,easing:o.cm(0,0,.3,1)},Oa=o.e({deceleration:2500,maxSpeed:1400},La),ru=o.e({deceleration:20,maxSpeed:1400},La),Ql=o.e({deceleration:1e3,maxSpeed:360},La),eh=o.e({deceleration:1e3,maxSpeed:90},La),Kh=o.e({deceleration:1e3,maxSpeed:360},La);class ec{constructor(s){this._map=s,this.clear()}clear(){this._inertiaBuffer=[]}record(s){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:M.now(),settings:s})}_drainInertiaBuffer(){const s=this._inertiaBuffer,d=M.now();for(;s.length>0&&d-s[0].time>160;)s.shift()}_onMoveEnd(s){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const d={zoom:0,bearing:0,pitch:0,roll:0,pan:new o.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:w}of this._inertiaBuffer)d.zoom+=w.zoomDelta||0,d.bearing+=w.bearingDelta||0,d.pitch+=w.pitchDelta||0,d.roll+=w.rollDelta||0,w.panDelta&&d.pan._add(w.panDelta),w.around&&(d.around=w.around),w.pinchAround&&(d.pinchAround=w.pinchAround);const g=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,v={};if(d.pan.mag()){const w=ti(d.pan.mag(),g,o.e({},Oa,s||{})),C=d.pan.mult(w.amount/d.pan.mag()),B=this._map.cameraHelper.handlePanInertia(C,this._map.transform);v.center=B.easingCenter,v.offset=B.easingOffset,Cn(v,w)}if(d.zoom){const w=ti(d.zoom,g,ru);v.zoom=this._map.transform.zoom+w.amount,Cn(v,w)}if(d.bearing){const w=ti(d.bearing,g,Ql);v.bearing=this._map.transform.bearing+o.ah(w.amount,-179,179),Cn(v,w)}if(d.pitch){const w=ti(d.pitch,g,eh);v.pitch=this._map.transform.pitch+w.amount,Cn(v,w)}if(d.roll){const w=ti(d.roll,g,Kh);v.roll=this._map.transform.roll+o.ah(w.amount,-179,179),Cn(v,w)}if(v.zoom||v.bearing){const w=d.pinchAround===void 0?d.around:d.pinchAround;v.around=w?this._map.unproject(w):this._map.getCenter()}return this.clear(),o.e(v,{noMoveStart:!0})}}function Cn(x,s){(!x.duration||x.duration<s.duration)&&(x.duration=s.duration,x.easing=s.easing)}function ti(x,s,d){const{maxSpeed:g,linearity:v,deceleration:w}=d,C=o.ah(x*v/(s/1e3),-g,g),B=Math.abs(C)/(w*v);return{easing:d.easing,duration:1e3*B,amount:C*(B/2)}}class Dr extends o.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,d,g,v={}){g=g instanceof MouseEvent?g:new MouseEvent(s,g);const w=L.mousePos(d.getCanvas(),g),C=d.unproject(w);super(s,o.e({point:w,lngLat:C,originalEvent:g},v)),this._defaultPrevented=!1,this.target=d}}class Zs extends o.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,d,g){const v=s==="touchend"?g.changedTouches:g.touches,w=L.touchPos(d.getCanvasContainer(),v),C=w.map((O=>d.unproject(O))),B=w.reduce(((O,F,U,K)=>O.add(F.div(K.length))),new o.P(0,0));super(s,{points:w,point:B,lngLats:C,lngLat:d.unproject(B),originalEvent:g}),this._defaultPrevented=!1}}class Pn extends o.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,d,g){super(s,{originalEvent:g}),this._defaultPrevented=!1}}class cs{constructor(s,d){this._map=s,this._clickTolerance=d.clickTolerance}reset(){delete this._mousedownPos}wheel(s){return this._firePreventable(new Pn(s.type,this._map,s))}mousedown(s,d){return this._mousedownPos=d,this._firePreventable(new Dr(s.type,this._map,s))}mouseup(s){this._map.fire(new Dr(s.type,this._map,s))}click(s,d){this._mousedownPos&&this._mousedownPos.dist(d)>=this._clickTolerance||this._map.fire(new Dr(s.type,this._map,s))}dblclick(s){return this._firePreventable(new Dr(s.type,this._map,s))}mouseover(s){this._map.fire(new Dr(s.type,this._map,s))}mouseout(s){this._map.fire(new Dr(s.type,this._map,s))}touchstart(s){return this._firePreventable(new Zs(s.type,this._map,s))}touchmove(s){this._map.fire(new Zs(s.type,this._map,s))}touchend(s){this._map.fire(new Zs(s.type,this._map,s))}touchcancel(s){this._map.fire(new Zs(s.type,this._map,s))}_firePreventable(s){if(this._map.fire(s),s.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class xl{constructor(s){this._map=s}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(s){this._map.fire(new Dr(s.type,this._map,s))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Dr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(s){this._delayContextMenu?this._contextMenuEvent=s:this._ignoreContextMenu||this._map.fire(new Dr(s.type,this._map,s)),this._map.listens("contextmenu")&&s.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Go{constructor(s){this._map=s}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(s){return this.transform.screenPointToLocation(o.P.convert(s),this._map.terrain)}}class Kn{constructor(s,d){this._map=s,this._tr=new Go(s),this._el=s.getCanvasContainer(),this._container=s.getContainer(),this._clickTolerance=d.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(s,d){this.isEnabled()&&s.shiftKey&&s.button===0&&(L.disableDrag(),this._startPos=this._lastPos=d,this._active=!0)}mousemoveWindow(s,d){if(!this._active)return;const g=d;if(this._lastPos.equals(g)||!this._box&&g.dist(this._startPos)<this._clickTolerance)return;const v=this._startPos;this._lastPos=g,this._box||(this._box=L.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",s));const w=Math.min(v.x,g.x),C=Math.max(v.x,g.x),B=Math.min(v.y,g.y),O=Math.max(v.y,g.y);L.setTransform(this._box,`translate(${w}px,${B}px)`),this._box.style.width=C-w+"px",this._box.style.height=O-B+"px"}mouseupWindow(s,d){if(!this._active||s.button!==0)return;const g=this._startPos,v=d;if(this.reset(),L.suppressClick(),g.x!==v.x||g.y!==v.y)return this._map.fire(new o.l("boxzoomend",{originalEvent:s})),{cameraAnimation:w=>w.fitScreenCoordinates(g,v,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",s)}keydown(s){this._active&&s.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",s))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(L.remove(this._box),this._box=null),L.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(s,d){return this._map.fire(new o.l(s,{originalEvent:d}))}}function Da(x,s){if(x.length!==s.length)throw new Error(`The number of touches and points are not equal - touches ${x.length}, points ${s.length}`);const d={};for(let g=0;g<x.length;g++)d[x[g].identifier]=s[g];return d}class xf{constructor(s){this.reset(),this.numTouches=s.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(s,d,g){(this.centroid||g.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=s.timeStamp),g.length===this.numTouches&&(this.centroid=(function(v){const w=new o.P(0,0);for(const C of v)w._add(C);return w.div(v.length)})(d),this.touches=Da(g,d)))}touchmove(s,d,g){if(this.aborted||!this.centroid)return;const v=Da(g,d);for(const w in this.touches){const C=v[w];(!C||C.dist(this.touches[w])>30)&&(this.aborted=!0)}}touchend(s,d,g){if((!this.centroid||s.timeStamp-this.startTime>500)&&(this.aborted=!0),g.length===0){const v=!this.aborted&&this.centroid;if(this.reset(),v)return v}}}class us{constructor(s){this.singleTap=new xf(s),this.numTaps=s.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(s,d,g){this.singleTap.touchstart(s,d,g)}touchmove(s,d,g){this.singleTap.touchmove(s,d,g)}touchend(s,d,g){const v=this.singleTap.touchend(s,d,g);if(v){const w=s.timeStamp-this.lastTime<500,C=!this.lastTap||this.lastTap.dist(v)<30;if(w&&C||this.reset(),this.count++,this.lastTime=s.timeStamp,this.lastTap=v,this.count===this.numTaps)return this.reset(),v}}}class Is{constructor(s){this._tr=new Go(s),this._zoomIn=new us({numTouches:1,numTaps:2}),this._zoomOut=new us({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(s,d,g){this._zoomIn.touchstart(s,d,g),this._zoomOut.touchstart(s,d,g)}touchmove(s,d,g){this._zoomIn.touchmove(s,d,g),this._zoomOut.touchmove(s,d,g)}touchend(s,d,g){const v=this._zoomIn.touchend(s,d,g),w=this._zoomOut.touchend(s,d,g),C=this._tr;return v?(this._active=!0,s.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:B=>B.easeTo({duration:300,zoom:C.zoom+1,around:C.unproject(v)},{originalEvent:s})}):w?(this._active=!0,s.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:B=>B.easeTo({duration:300,zoom:C.zoom-1,around:C.unproject(w)},{originalEvent:s})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class tc{constructor(s){this._enabled=!!s.enable,this._moveStateManager=s.moveStateManager,this._clickTolerance=s.clickTolerance||1,this._moveFunction=s.move,this._activateOnStart=!!s.activateOnStart,s.assignEvents(this),this.reset()}reset(s){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(s)}_move(...s){const d=this._moveFunction(...s);if(d.bearingDelta||d.pitchDelta||d.rollDelta||d.around||d.panDelta)return this._active=!0,d}dragStart(s,d){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(s)&&(this._moveStateManager.startMove(s),this._lastPoint=Array.isArray(d)?d[0]:d,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(s,d){if(!this.isEnabled())return;const g=this._lastPoint;if(!g)return;if(s.preventDefault(),!this._moveStateManager.isValidMoveEvent(s))return void this.reset(s);const v=Array.isArray(d)?d[0]:d;return!this._moved&&v.dist(g)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=v,this._move(g,v))}dragEnd(s){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(s)&&(this._moved&&L.suppressClick(),this.reset(s))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const gn=0,Na=2,wf={[gn]:1,[Na]:2};class iu{constructor(s){this._correctEvent=s.checkCorrectEvent}startMove(s){const d=L.mouseButton(s);this._eventButton=d}endMove(s){delete this._eventButton}isValidStartEvent(s){return this._correctEvent(s)}isValidMoveEvent(s){return!(function(d,g){const v=wf[g];return d.buttons===void 0||(d.buttons&v)!==v})(s,this._eventButton)}isValidEndEvent(s){return L.mouseButton(s)===this._eventButton}}class Hg{constructor(){this._firstTouch=void 0}_isOneFingerTouch(s){return s.targetTouches.length===1}_isSameTouchEvent(s){return s.targetTouches[0].identifier===this._firstTouch}startMove(s){this._firstTouch=s.targetTouches[0].identifier}endMove(s){delete this._firstTouch}isValidStartEvent(s){return this._isOneFingerTouch(s)}isValidMoveEvent(s){return this._isOneFingerTouch(s)&&this._isSameTouchEvent(s)}isValidEndEvent(s){return this._isOneFingerTouch(s)&&this._isSameTouchEvent(s)}}class wl{constructor(s=new iu({checkCorrectEvent:()=>!0}),d=new Hg){this.mouseMoveStateManager=s,this.oneFingerTouchMoveStateManager=d}_executeRelevantHandler(s,d,g){return s instanceof MouseEvent?d(s):typeof TouchEvent<"u"&&s instanceof TouchEvent?g(s):void 0}startMove(s){this._executeRelevantHandler(s,(d=>this.mouseMoveStateManager.startMove(d)),(d=>this.oneFingerTouchMoveStateManager.startMove(d)))}endMove(s){this._executeRelevantHandler(s,(d=>this.mouseMoveStateManager.endMove(d)),(d=>this.oneFingerTouchMoveStateManager.endMove(d)))}isValidStartEvent(s){return this._executeRelevantHandler(s,(d=>this.mouseMoveStateManager.isValidStartEvent(d)),(d=>this.oneFingerTouchMoveStateManager.isValidStartEvent(d)))}isValidMoveEvent(s){return this._executeRelevantHandler(s,(d=>this.mouseMoveStateManager.isValidMoveEvent(d)),(d=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(d)))}isValidEndEvent(s){return this._executeRelevantHandler(s,(d=>this.mouseMoveStateManager.isValidEndEvent(d)),(d=>this.oneFingerTouchMoveStateManager.isValidEndEvent(d)))}}const oa=x=>{x.mousedown=x.dragStart,x.mousemoveWindow=x.dragMove,x.mouseup=x.dragEnd,x.contextmenu=s=>{s.preventDefault()}};class aa{constructor(s,d){this._clickTolerance=s.clickTolerance||1,this._map=d,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new o.P(0,0)}_shouldBePrevented(s){return s<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(s,d,g){return this._calculateTransform(s,d,g)}touchmove(s,d,g){if(this._active){if(!this._shouldBePrevented(g.length))return s.preventDefault(),this._calculateTransform(s,d,g);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",s)}}touchend(s,d,g){this._calculateTransform(s,d,g),this._active&&this._shouldBePrevented(g.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(s,d,g){g.length>0&&(this._active=!0);const v=Da(g,d),w=new o.P(0,0),C=new o.P(0,0);let B=0;for(const F in v){const U=v[F],K=this._touches[F];K&&(w._add(U),C._add(U.sub(K)),B++,v[F]=U)}if(this._touches=v,this._shouldBePrevented(B)||!C.mag())return;const O=C.div(B);return this._sum._add(O),this._sum.mag()<this._clickTolerance?void 0:{around:w.div(B),panDelta:O}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ks{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(s,d,g){this._firstTwoTouches||g.length<2||(this._firstTwoTouches=[g[0].identifier,g[1].identifier],this._start([d[0],d[1]]))}touchmove(s,d,g){if(!this._firstTwoTouches)return;s.preventDefault();const[v,w]=this._firstTwoTouches,C=Ot(g,d,v),B=Ot(g,d,w);if(!C||!B)return;const O=this._aroundCenter?null:C.add(B).div(2);return this._move([C,B],O,s)}touchend(s,d,g){if(!this._firstTwoTouches)return;const[v,w]=this._firstTwoTouches,C=Ot(g,d,v),B=Ot(g,d,w);C&&B||(this._active&&L.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(s){this._enabled=!0,this._aroundCenter=!!s&&s.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Ot(x,s,d){for(let g=0;g<x.length;g++)if(x[g].identifier===d)return s[g]}function Bs(x,s){return Math.log(x/s)/Math.LN2}class hs extends ks{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(s){this._startDistance=this._distance=s[0].dist(s[1])}_move(s,d){const g=this._distance;if(this._distance=s[0].dist(s[1]),this._active||!(Math.abs(Bs(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Bs(this._distance,g),pinchAround:d}}}function Fa(x,s){return 180*x.angleWith(s)/Math.PI}class Ls extends ks{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(s){this._startVector=this._vector=s[0].sub(s[1]),this._minDiameter=s[0].dist(s[1])}_move(s,d,g){const v=this._vector;if(this._vector=s[0].sub(s[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Fa(this._vector,v),pinchAround:d}}_isBelowThreshold(s){this._minDiameter=Math.min(this._minDiameter,s.mag());const d=25/(Math.PI*this._minDiameter)*360,g=Fa(s,this._startVector);return Math.abs(g)<d}}function ds(x){return Math.abs(x.y)>Math.abs(x.x)}class la extends ks{constructor(s){super(),this._currentTouchCount=0,this._map=s}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(s,d,g){super.touchstart(s,d,g),this._currentTouchCount=g.length}_start(s){this._lastPoints=s,ds(s[0].sub(s[1]))&&(this._valid=!1)}_move(s,d,g){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const v=s[0].sub(this._lastPoints[0]),w=s[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(v,w,g.timeStamp),this._valid?(this._lastPoints=s,this._active=!0,{pitchDelta:(v.y+w.y)/2*-.5}):void 0}gestureBeginsVertically(s,d,g){if(this._valid!==void 0)return this._valid;const v=s.mag()>=2,w=d.mag()>=2;if(!v&&!w)return;if(!v||!w)return this._firstMove===void 0&&(this._firstMove=g),g-this._firstMove<100&&void 0;const C=s.y>0==d.y>0;return ds(s)&&ds(d)&&C}}const Or={panStep:100,bearingStep:15,pitchStep:10};class nu{constructor(s){this._tr=new Go(s);const d=Or;this._panStep=d.panStep,this._bearingStep=d.bearingStep,this._pitchStep=d.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(s){if(s.altKey||s.ctrlKey||s.metaKey)return;let d=0,g=0,v=0,w=0,C=0;switch(s.keyCode){case 61:case 107:case 171:case 187:d=1;break;case 189:case 109:case 173:d=-1;break;case 37:s.shiftKey?g=-1:(s.preventDefault(),w=-1);break;case 39:s.shiftKey?g=1:(s.preventDefault(),w=1);break;case 38:s.shiftKey?v=1:(s.preventDefault(),C=-1);break;case 40:s.shiftKey?v=-1:(s.preventDefault(),C=1);break;default:return}return this._rotationDisabled&&(g=0,v=0),{cameraAnimation:B=>{const O=this._tr;B.easeTo({duration:300,easeId:"keyboardHandler",easing:Ef,zoom:d?Math.round(O.zoom)+d*(s.shiftKey?2:1):O.zoom,bearing:O.bearing+g*this._bearingStep,pitch:O.pitch+v*this._pitchStep,offset:[-w*this._panStep,-C*this._panStep],center:O.center},{originalEvent:s})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Ef(x){return x*(2-x)}const Zn=4.000244140625,Xs=1/450;class Ei{constructor(s,d){this._onTimeout=g=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(g)},this._map=s,this._tr=new Go(s),this._triggerRenderFrame=d,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=Xs}setZoomRate(s){this._defaultZoomRate=s}setWheelZoomRate(s){this._wheelZoomRate=s}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(s){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!s&&s.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(s){return!!this._map.cooperativeGestures.isEnabled()&&!(s.ctrlKey||this._map.cooperativeGestures.isBypassed(s))}wheel(s){if(!this.isEnabled())return;if(this._shouldBePrevented(s))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",s);let d=s.deltaMode===WheelEvent.DOM_DELTA_LINE?40*s.deltaY:s.deltaY;const g=M.now(),v=g-(this._lastWheelEventTime||0);this._lastWheelEventTime=g,d!==0&&d%Zn==0?this._type="wheel":d!==0&&Math.abs(d)<4?this._type="trackpad":v>400?(this._type=null,this._lastValue=d,this._timeout=setTimeout(this._onTimeout,40,s)):this._type||(this._type=Math.abs(v*d)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,d+=this._lastValue)),s.shiftKey&&d&&(d/=4),this._type&&(this._lastWheelEvent=s,this._delta-=d,this._active||this._start(s)),s.preventDefault()}_start(s){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const d=L.mousePos(this._map.getCanvas(),s),g=this._tr;this._aroundPoint=this._aroundCenter?g.transform.locationToScreenPoint(o.S.convert(g.center)):d,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const s=this._tr.transform;if(typeof this._lastExpectedZoom=="number"){const B=s.zoom-this._lastExpectedZoom;typeof this._startZoom=="number"&&(this._startZoom+=B),typeof this._targetZoom=="number"&&(this._targetZoom+=B)}if(this._delta!==0){const B=this._type==="wheel"&&Math.abs(this._delta)>Zn?this._wheelZoomRate:this._defaultZoomRate;let O=2/(1+Math.exp(-Math.abs(this._delta*B)));this._delta<0&&O!==0&&(O=1/O);const F=typeof this._targetZoom!="number"?s.scale:o.af(this._targetZoom);this._targetZoom=s.getConstrained(s.getCameraLngLat(),o.ak(F*O)).zoom,this._type==="wheel"&&(this._startZoom=s.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const d=typeof this._targetZoom!="number"?s.zoom:this._targetZoom,g=this._startZoom,v=this._easing;let w,C=!1;if(this._type==="wheel"&&g&&v){const B=M.now()-this._lastWheelEventTime,O=Math.min((B+5)/200,1),F=v(O);w=o.C.number(g,d,F),O<1?this._frameId||(this._frameId=!0):C=!0}else w=d,C=!0;return this._active=!0,C&&(this._active=!1,this._finishTimeout=setTimeout((()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout}),200)),this._lastExpectedZoom=w,{noInertia:!0,needsRenderFrame:!C,zoomDelta:w-s.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(s){let d=o.co;if(this._prevEase){const g=this._prevEase,v=(M.now()-g.start)/g.duration,w=g.easing(v+.01)-g.easing(v),C=.27/Math.sqrt(w*w+1e-4)*.01,B=Math.sqrt(.0729-C*C);d=o.cm(C,B,.25,1)}return this._prevEase={start:M.now(),duration:s,easing:d},d}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Ys{constructor(s,d){this._clickZoom=s,this._tapZoom=d}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Zh{constructor(s){this._tr=new Go(s),this.reset()}reset(){this._active=!1}dblclick(s,d){return s.preventDefault(),{cameraAnimation:g=>{g.easeTo({duration:300,zoom:this._tr.zoom+(s.shiftKey?-1:1),around:this._tr.unproject(d)},{originalEvent:s})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Af{constructor(){this._tap=new us({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(s,d,g){if(!this._swipePoint)if(this._tapTime){const v=d[0],w=s.timeStamp-this._tapTime<500,C=this._tapPoint.dist(v)<30;w&&C?g.length>0&&(this._swipePoint=v,this._swipeTouch=g[0].identifier):this.reset()}else this._tap.touchstart(s,d,g)}touchmove(s,d,g){if(this._tapTime){if(this._swipePoint){if(g[0].identifier!==this._swipeTouch)return;const v=d[0],w=v.y-this._swipePoint.y;return this._swipePoint=v,s.preventDefault(),this._active=!0,{zoomDelta:w/128}}}else this._tap.touchmove(s,d,g)}touchend(s,d,g){if(this._tapTime)this._swipePoint&&g.length===0&&this.reset();else{const v=this._tap.touchend(s,d,g);v&&(this._tapTime=s.timeStamp,this._tapPoint=v)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Xh{constructor(s,d,g){this._el=s,this._mousePan=d,this._touchPan=g}enable(s){this._inertiaOptions=s||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class th{constructor(s,d,g,v){this._pitchWithRotate=s.pitchWithRotate,this._rollEnabled=s.rollEnabled,this._mouseRotate=d,this._mousePitch=g,this._mouseRoll=v}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class Tf{constructor(s,d,g,v){this._el=s,this._touchZoom=d,this._touchRotate=g,this._tapDragZoom=v,this._rotationDisabled=!1,this._enabled=!0}enable(s){this._touchZoom.enable(s),this._rotationDisabled||this._touchRotate.enable(s),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class rh{constructor(s,d){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=s,this._options=d,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const s=this._map.getCanvasContainer();s.classList.add("maplibregl-cooperative-gestures"),this._container=L.create("div","maplibregl-cooperative-gesture-screen",s);let d=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(d=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const g=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),v=document.createElement("div");v.className="maplibregl-desktop-message",v.textContent=d,this._container.appendChild(v);const w=document.createElement("div");w.className="maplibregl-mobile-message",w.textContent=g,this._container.appendChild(w),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(L.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(s){return s[this._bypassKey]}notifyGestureBlocked(s,d){this._enabled&&(this._map.fire(new o.l("cooperativegestureprevented",{gestureType:s,originalEvent:d})),this._container.classList.add("maplibregl-show"),setTimeout((()=>{this._container.classList.remove("maplibregl-show")}),100))}}const po=x=>x.zoom||x.drag||x.roll||x.pitch||x.rotate;class ri extends o.l{}function El(x){return x.panDelta&&x.panDelta.mag()||x.zoomDelta||x.bearingDelta||x.pitchDelta||x.rollDelta}class Sf{constructor(s,d){this.handleWindowEvent=v=>{this.handleEvent(v,`${v.type}Window`)},this.handleEvent=(v,w)=>{if(v.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const C=v.type==="renderFrame"?void 0:v,B={needsRenderFrame:!1},O={},F={};for(const{handlerName:W,handler:X,allowed:re}of this._handlers){if(!X.isEnabled())continue;let ue;if(this._blockedByActive(F,re,W))X.reset();else if(X[w||v.type]){if(o.cp(v,w||v.type)){const fe=L.mousePos(this._map.getCanvas(),v);ue=X[w||v.type](v,fe)}else if(o.cq(v,w||v.type)){const fe=this._getMapTouches(v.touches),pe=L.touchPos(this._map.getCanvas(),fe);ue=X[w||v.type](v,pe,fe)}else o.cr(w||v.type)||(ue=X[w||v.type](v));this.mergeHandlerResult(B,O,ue,W,C),ue&&ue.needsRenderFrame&&this._triggerRenderFrame()}(ue||X.isActive())&&(F[W]=X)}const U={};for(const W in this._previousActiveHandlers)F[W]||(U[W]=C);this._previousActiveHandlers=F,(Object.keys(U).length||El(B))&&(this._changes.push([B,O,U]),this._triggerRenderFrame()),(Object.keys(F).length||El(B))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:K}=B;K&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],K(this._map))},this._map=s,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new ec(s),this._bearingSnap=d.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(d);const g=this._el;this._listeners=[[g,"touchstart",{passive:!0}],[g,"touchmove",{passive:!1}],[g,"touchend",void 0],[g,"touchcancel",void 0],[g,"mousedown",void 0],[g,"mousemove",void 0],[g,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[g,"mouseover",void 0],[g,"mouseout",void 0],[g,"dblclick",void 0],[g,"click",void 0],[g,"keydown",{capture:!1}],[g,"keyup",void 0],[g,"wheel",{passive:!1}],[g,"contextmenu",void 0],[window,"blur",void 0]];for(const[v,w,C]of this._listeners)L.addEventListener(v,w,v===document?this.handleWindowEvent:this.handleEvent,C)}destroy(){for(const[s,d,g]of this._listeners)L.removeEventListener(s,d,s===document?this.handleWindowEvent:this.handleEvent,g)}_addDefaultHandlers(s){const d=this._map,g=d.getCanvasContainer();this._add("mapEvent",new cs(d,s));const v=d.boxZoom=new Kn(d,s);this._add("boxZoom",v),s.interactive&&s.boxZoom&&v.enable();const w=d.cooperativeGestures=new rh(d,s.cooperativeGestures);this._add("cooperativeGestures",w),s.cooperativeGestures&&w.enable();const C=new Is(d),B=new Zh(d);d.doubleClickZoom=new Ys(B,C),this._add("tapZoom",C),this._add("clickZoom",B),s.interactive&&s.doubleClickZoom&&d.doubleClickZoom.enable();const O=new Af;this._add("tapDragZoom",O);const F=d.touchPitch=new la(d);this._add("touchPitch",F),s.interactive&&s.touchPitch&&d.touchPitch.enable(s.touchPitch);const U=()=>d.project(d.getCenter()),K=(function({enable:ye,clickTolerance:Te,aroundCenter:Ie=!0,minPixelCenterThreshold:be=100,rotateDegreesPerPixelMoved:ke=.8},Xe){const qe=new iu({checkCorrectEvent:Ze=>L.mouseButton(Ze)===0&&Ze.ctrlKey||L.mouseButton(Ze)===2&&!Ze.ctrlKey});return new tc({clickTolerance:Te,move:(Ze,tt)=>{const bt=Xe();if(Ie&&Math.abs(bt.y-Ze.y)>be)return{bearingDelta:o.cn(new o.P(Ze.x,tt.y),tt,bt)};let wt=(tt.x-Ze.x)*ke;return Ie&&tt.y<bt.y&&(wt=-wt),{bearingDelta:wt}},moveStateManager:qe,enable:ye,assignEvents:oa})})(s,U),W=(function({enable:ye,clickTolerance:Te,pitchDegreesPerPixelMoved:Ie=-.5}){const be=new iu({checkCorrectEvent:ke=>L.mouseButton(ke)===0&&ke.ctrlKey||L.mouseButton(ke)===2});return new tc({clickTolerance:Te,move:(ke,Xe)=>({pitchDelta:(Xe.y-ke.y)*Ie}),moveStateManager:be,enable:ye,assignEvents:oa})})(s),X=(function({enable:ye,clickTolerance:Te,rollDegreesPerPixelMoved:Ie=.3},be){const ke=new iu({checkCorrectEvent:Xe=>L.mouseButton(Xe)===2&&Xe.ctrlKey});return new tc({clickTolerance:Te,move:(Xe,qe)=>{const Ze=be();let tt=(qe.x-Xe.x)*Ie;return qe.y<Ze.y&&(tt=-tt),{rollDelta:tt}},moveStateManager:ke,enable:ye,assignEvents:oa})})(s,U);d.dragRotate=new th(s,K,W,X),this._add("mouseRotate",K,["mousePitch"]),this._add("mousePitch",W,["mouseRotate","mouseRoll"]),this._add("mouseRoll",X,["mousePitch"]),s.interactive&&s.dragRotate&&d.dragRotate.enable();const re=(function({enable:ye,clickTolerance:Te}){const Ie=new iu({checkCorrectEvent:be=>L.mouseButton(be)===0&&!be.ctrlKey});return new tc({clickTolerance:Te,move:(be,ke)=>({around:ke,panDelta:ke.sub(be)}),activateOnStart:!0,moveStateManager:Ie,enable:ye,assignEvents:oa})})(s),ue=new aa(s,d);d.dragPan=new Xh(g,re,ue),this._add("mousePan",re),this._add("touchPan",ue,["touchZoom","touchRotate"]),s.interactive&&s.dragPan&&d.dragPan.enable(s.dragPan);const fe=new Ls,pe=new hs;d.touchZoomRotate=new Tf(g,pe,fe,O),this._add("touchRotate",fe,["touchPan","touchZoom"]),this._add("touchZoom",pe,["touchPan","touchRotate"]),s.interactive&&s.touchZoomRotate&&d.touchZoomRotate.enable(s.touchZoomRotate);const _e=d.scrollZoom=new Ei(d,(()=>this._triggerRenderFrame()));this._add("scrollZoom",_e,["mousePan"]),s.interactive&&s.scrollZoom&&d.scrollZoom.enable(s.scrollZoom);const we=d.keyboard=new nu(d);this._add("keyboard",we),s.interactive&&s.keyboard&&d.keyboard.enable(),this._add("blockableMapEvent",new xl(d))}_add(s,d,g){this._handlers.push({handlerName:s,handler:d,allowed:g}),this._handlersById[s]=d}stop(s){if(!this._updatingCamera){for(const{handler:d}of this._handlers)d.reset();this._inertia.clear(),this._fireEvents({},{},s),this._changes=[]}}isActive(){for(const{handler:s}of this._handlers)if(s.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!po(this._eventsInProgress)||this.isZooming()}_blockedByActive(s,d,g){for(const v in s)if(v!==g&&(!d||d.indexOf(v)<0))return!0;return!1}_getMapTouches(s){const d=[];for(const g of s)this._el.contains(g.target)&&d.push(g);return d}mergeHandlerResult(s,d,g,v,w){if(!g)return;o.e(s,g);const C={handlerName:v,originalEvent:g.originalEvent||w};g.zoomDelta!==void 0&&(d.zoom=C),g.panDelta!==void 0&&(d.drag=C),g.rollDelta!==void 0&&(d.roll=C),g.pitchDelta!==void 0&&(d.pitch=C),g.bearingDelta!==void 0&&(d.rotate=C)}_applyChanges(){const s={},d={},g={};for(const[v,w,C]of this._changes)v.panDelta&&(s.panDelta=(s.panDelta||new o.P(0,0))._add(v.panDelta)),v.zoomDelta&&(s.zoomDelta=(s.zoomDelta||0)+v.zoomDelta),v.bearingDelta&&(s.bearingDelta=(s.bearingDelta||0)+v.bearingDelta),v.pitchDelta&&(s.pitchDelta=(s.pitchDelta||0)+v.pitchDelta),v.rollDelta&&(s.rollDelta=(s.rollDelta||0)+v.rollDelta),v.around!==void 0&&(s.around=v.around),v.pinchAround!==void 0&&(s.pinchAround=v.pinchAround),v.noInertia&&(s.noInertia=v.noInertia),o.e(d,w),o.e(g,C);this._updateMapTransform(s,d,g),this._changes=[]}_updateMapTransform(s,d,g){const v=this._map,w=v._getTransformForUpdate(),C=v.terrain;if(!(El(s)||C&&this._terrainMovement))return this._fireEvents(d,g,!0);v._stop(!0);let{panDelta:B,zoomDelta:O,bearingDelta:F,pitchDelta:U,rollDelta:K,around:W,pinchAround:X}=s;X!==void 0&&(W=X),W=W||v.transform.centerPoint,C&&!w.isPointOnMapSurface(W)&&(W=w.centerPoint);const re={panDelta:B,zoomDelta:O,rollDelta:K,pitchDelta:U,bearingDelta:F,around:W};this._map.cameraHelper.useGlobeControls&&!w.isPointOnMapSurface(W)&&(W=w.centerPoint);const ue=W.distSqr(w.centerPoint)<.01?w.center:w.screenPointToLocation(B?W.sub(B):W);C?(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(re,w),this._terrainMovement||!d.drag&&!d.zoom?d.drag&&this._terrainMovement?w.setCenter(w.screenPointToLocation(w.centerPoint.sub(B))):this._map.cameraHelper.handleMapControlsPan(re,w,ue):(this._terrainMovement=!0,this._map._elevationFreeze=!0,this._map.cameraHelper.handleMapControlsPan(re,w,ue))):(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(re,w),this._map.cameraHelper.handleMapControlsPan(re,w,ue)),v._applyUpdatedTransform(w),this._map._update(),s.noInertia||this._inertia.record(s),this._fireEvents(d,g,!0)}_fireEvents(s,d,g){const v=po(this._eventsInProgress),w=po(s),C={};for(const K in s){const{originalEvent:W}=s[K];this._eventsInProgress[K]||(C[`${K}start`]=W),this._eventsInProgress[K]=s[K]}!v&&w&&this._fireEvent("movestart",w.originalEvent);for(const K in C)this._fireEvent(K,C[K]);w&&this._fireEvent("move",w.originalEvent);for(const K in s){const{originalEvent:W}=s[K];this._fireEvent(K,W)}const B={};let O;for(const K in this._eventsInProgress){const{handlerName:W,originalEvent:X}=this._eventsInProgress[K];this._handlersById[W].isActive()||(delete this._eventsInProgress[K],O=d[W]||X,B[`${K}end`]=O)}for(const K in B)this._fireEvent(K,B[K]);const F=po(this._eventsInProgress),U=(v||w)&&!F;if(U&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const K=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&K.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(K)}if(g&&U){this._updatingCamera=!0;const K=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),W=X=>X!==0&&-this._bearingSnap<X&&X<this._bearingSnap;!K||!K.essential&&M.prefersReducedMotion?(this._map.fire(new o.l("moveend",{originalEvent:O})),W(this._map.getBearing())&&this._map.resetNorth()):(W(K.bearing||this._map.getBearing())&&(K.bearing=0),K.freezeElevation=!0,this._map.easeTo(K,{originalEvent:O})),this._updatingCamera=!1}}_fireEvent(s,d){this._map.fire(new o.l(s,d?{originalEvent:d}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((s=>{delete this._frameId,this.handleEvent(new ri("renderFrame",{timeStamp:s})),this._applyChanges()}))}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class su extends o.E{constructor(s,d,g){super(),this._renderFrameCallback=()=>{const v=Math.min((M.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(v)),v<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=s,this._bearingSnap=g.bearingSnap,this.cameraHelper=d,this.on("moveend",(()=>{delete this._requestedCameraState}))}migrateProjection(s,d){s.apply(this.transform),this.transform=s,this.cameraHelper=d}getCenter(){return new o.S(this.transform.center.lng,this.transform.center.lat)}setCenter(s,d){return this.jumpTo({center:s},d)}getCenterElevation(){return this.transform.elevation}setCenterElevation(s,d){return this.jumpTo({elevation:s},d),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(s){this._centerClampedToGround=s}panBy(s,d,g){return s=o.P.convert(s).mult(-1),this.panTo(this.transform.center,o.e({offset:s},d),g)}panTo(s,d,g){return this.easeTo(o.e({center:s},d),g)}getZoom(){return this.transform.zoom}setZoom(s,d){return this.jumpTo({zoom:s},d),this}zoomTo(s,d,g){return this.easeTo(o.e({zoom:s},d),g)}zoomIn(s,d){return this.zoomTo(this.getZoom()+1,s,d),this}zoomOut(s,d){return this.zoomTo(this.getZoom()-1,s,d),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(s,d){return s!=this.transform.fov&&(this.transform.setFov(s),this.fire(new o.l("movestart",d)).fire(new o.l("move",d)).fire(new o.l("moveend",d))),this}getBearing(){return this.transform.bearing}setBearing(s,d){return this.jumpTo({bearing:s},d),this}getPadding(){return this.transform.padding}setPadding(s,d){return this.jumpTo({padding:s},d),this}rotateTo(s,d,g){return this.easeTo(o.e({bearing:s},d),g)}resetNorth(s,d){return this.rotateTo(0,o.e({duration:1e3},s),d),this}resetNorthPitch(s,d){return this.easeTo(o.e({bearing:0,pitch:0,roll:0,duration:1e3},s),d),this}snapToNorth(s,d){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(s,d):this}getPitch(){return this.transform.pitch}setPitch(s,d){return this.jumpTo({pitch:s},d),this}getRoll(){return this.transform.roll}setRoll(s,d){return this.jumpTo({roll:s},d),this}cameraForBounds(s,d){s=Zr.convert(s).adjustAntiMeridian();const g=d&&d.bearing||0;return this._cameraForBoxAndBearing(s.getNorthWest(),s.getSouthEast(),g,d)}_cameraForBoxAndBearing(s,d,g,v){const w={top:0,bottom:0,right:0,left:0};if(typeof(v=o.e({padding:w,offset:[0,0],maxZoom:this.transform.maxZoom},v)).padding=="number"){const F=v.padding;v.padding={top:F,bottom:F,right:F,left:F}}const C=o.e(w,v.padding);v.padding=C;const B=this.transform,O=new Zr(s,d);return this.cameraHelper.cameraForBoxAndBearing(v,C,O,g,B)}fitBounds(s,d,g){return this._fitInternal(this.cameraForBounds(s,d),d,g)}fitScreenCoordinates(s,d,g,v,w){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(o.P.convert(s)),this.transform.screenPointToLocation(o.P.convert(d)),g,v),v,w)}_fitInternal(s,d,g){return s?(delete(d=o.e(s,d)).padding,d.linear?this.easeTo(d,g):this.flyTo(d,g)):this}jumpTo(s,d){this.stop();const g=this._getTransformForUpdate();let v=!1,w=!1,C=!1;const B=g.zoom;this.cameraHelper.handleJumpToCenterZoom(g,s);const O=g.zoom!==B;return"elevation"in s&&g.elevation!==+s.elevation&&g.setElevation(+s.elevation),"bearing"in s&&g.bearing!==+s.bearing&&(v=!0,g.setBearing(+s.bearing)),"pitch"in s&&g.pitch!==+s.pitch&&(w=!0,g.setPitch(+s.pitch)),"roll"in s&&g.roll!==+s.roll&&(C=!0,g.setRoll(+s.roll)),s.padding==null||g.isPaddingEqual(s.padding)||g.setPadding(s.padding),this._applyUpdatedTransform(g),this.fire(new o.l("movestart",d)).fire(new o.l("move",d)),O&&this.fire(new o.l("zoomstart",d)).fire(new o.l("zoom",d)).fire(new o.l("zoomend",d)),v&&this.fire(new o.l("rotatestart",d)).fire(new o.l("rotate",d)).fire(new o.l("rotateend",d)),w&&this.fire(new o.l("pitchstart",d)).fire(new o.l("pitch",d)).fire(new o.l("pitchend",d)),C&&this.fire(new o.l("rollstart",d)).fire(new o.l("roll",d)).fire(new o.l("rollend",d)),this.fire(new o.l("moveend",d))}calculateCameraOptionsFromTo(s,d,g,v=0){const w=o.a1.fromLngLat(s,d),C=o.a1.fromLngLat(g,v),B=C.x-w.x,O=C.y-w.y,F=C.z-w.z,U=Math.hypot(B,O,F);if(U===0)throw new Error("Can't calculate camera options with same From and To");const K=Math.hypot(B,O),W=o.ak(this.transform.cameraToCenterDistance/U/this.transform.tileSize),X=180*Math.atan2(B,-O)/Math.PI;let re=180*Math.acos(K/U)/Math.PI;return re=F<0?90-re:90+re,{center:C.toLngLat(),elevation:v,zoom:W,pitch:re,bearing:X}}calculateCameraOptionsFromCameraLngLatAltRotation(s,d,g,v,w){const C=this.transform.calculateCenterFromCameraLngLatAlt(s,d,g,v);return{center:C.center,elevation:C.elevation,zoom:C.zoom,bearing:g,pitch:v,roll:w}}easeTo(s,d){this._stop(!1,s.easeId),((s=o.e({offset:[0,0],duration:500,easing:o.co},s)).animate===!1||!s.essential&&M.prefersReducedMotion)&&(s.duration=0);const g=this._getTransformForUpdate(),v=this.getBearing(),w=g.pitch,C=g.roll,B="bearing"in s?this._normalizeBearing(s.bearing,v):v,O="pitch"in s?+s.pitch:w,F="roll"in s?this._normalizeBearing(s.roll,C):C,U="padding"in s?s.padding:g.padding,K=o.P.convert(s.offset);let W,X;s.around&&(W=o.S.convert(s.around),X=g.locationToScreenPoint(W));const re={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},ue=this.cameraHelper.handleEaseTo(g,{bearing:B,pitch:O,roll:F,padding:U,around:W,aroundPoint:X,offsetAsPoint:K,offset:s.offset,zoom:s.zoom,center:s.center});return this._rotating=this._rotating||v!==B,this._pitching=this._pitching||O!==w,this._rolling=this._rolling||F!==C,this._padding=!g.isPaddingEqual(U),this._zooming=this._zooming||ue.isZooming,this._easeId=s.easeId,this._prepareEase(d,s.noMoveStart,re),this.terrain&&this._prepareElevation(ue.elevationCenter),this._ease((fe=>{ue.easeFunc(fe),this.terrain&&!s.freezeElevation&&this._updateElevation(fe),this._applyUpdatedTransform(g),this._fireMoveEvents(d)}),(fe=>{this.terrain&&s.freezeElevation&&this._finalizeElevation(),this._afterEase(d,fe)}),s),this}_prepareEase(s,d,g={}){this._moving=!0,d||g.moving||this.fire(new o.l("movestart",s)),this._zooming&&!g.zooming&&this.fire(new o.l("zoomstart",s)),this._rotating&&!g.rotating&&this.fire(new o.l("rotatestart",s)),this._pitching&&!g.pitching&&this.fire(new o.l("pitchstart",s)),this._rolling&&!g.rolling&&this.fire(new o.l("rollstart",s))}_prepareElevation(s){this._elevationCenter=s,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(s,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(s){this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));const d=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(s<1&&d!==this._elevationTarget){const g=this._elevationTarget-this._elevationStart;this._elevationStart+=s*(g-(d-(g*s+this._elevationStart))/(1-s)),this._elevationTarget=d}this.transform.setElevation(o.C.number(this._elevationStart,this._elevationTarget,s))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(s){if(!this.terrain&&s.elevation>=0&&s.pitch<=90)return{};const d=s.getCameraLngLat(),g=s.getCameraAltitude(),v=this.terrain?this.terrain.getElevationForLngLatZoom(d,s.zoom):0;if(g<v){const w=this.calculateCameraOptionsFromTo(d,v,s.center,s.elevation);return{pitch:w.pitch,zoom:w.zoom}}return{}}_applyUpdatedTransform(s){const d=[];if(d.push((v=>this._elevateCameraIfInsideTerrain(v))),this.transformCameraUpdate&&d.push((v=>this.transformCameraUpdate(v))),!d.length)return;const g=s.clone();for(const v of d){const w=g.clone(),{center:C,zoom:B,roll:O,pitch:F,bearing:U,elevation:K}=v(w);C&&w.setCenter(C),K!==void 0&&w.setElevation(K),B!==void 0&&w.setZoom(B),O!==void 0&&w.setRoll(O),F!==void 0&&w.setPitch(F),U!==void 0&&w.setBearing(U),g.apply(w)}this.transform.apply(g)}_fireMoveEvents(s){this.fire(new o.l("move",s)),this._zooming&&this.fire(new o.l("zoom",s)),this._rotating&&this.fire(new o.l("rotate",s)),this._pitching&&this.fire(new o.l("pitch",s)),this._rolling&&this.fire(new o.l("roll",s))}_afterEase(s,d){if(this._easeId&&d&&this._easeId===d)return;delete this._easeId;const g=this._zooming,v=this._rotating,w=this._pitching,C=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,g&&this.fire(new o.l("zoomend",s)),v&&this.fire(new o.l("rotateend",s)),w&&this.fire(new o.l("pitchend",s)),C&&this.fire(new o.l("rollend",s)),this.fire(new o.l("moveend",s))}flyTo(s,d){if(!s.essential&&M.prefersReducedMotion){const tt=o.Q(s,["center","zoom","bearing","pitch","roll","elevation"]);return this.jumpTo(tt,d)}this.stop(),s=o.e({offset:[0,0],speed:1.2,curve:1.42,easing:o.co},s);const g=this._getTransformForUpdate(),v=g.bearing,w=g.pitch,C=g.roll,B=g.padding,O="bearing"in s?this._normalizeBearing(s.bearing,v):v,F="pitch"in s?+s.pitch:w,U="roll"in s?this._normalizeBearing(s.roll,C):C,K="padding"in s?s.padding:g.padding,W=o.P.convert(s.offset);let X=g.centerPoint.add(W);const re=g.screenPointToLocation(X),ue=this.cameraHelper.handleFlyTo(g,{bearing:O,pitch:F,roll:U,padding:K,locationAtOffset:re,offsetAsPoint:W,center:s.center,minZoom:s.minZoom,zoom:s.zoom});let fe=s.curve;const pe=Math.max(g.width,g.height),_e=pe/ue.scaleOfZoom,we=ue.pixelPathLength;typeof ue.scaleOfMinZoom=="number"&&(fe=Math.sqrt(pe/ue.scaleOfMinZoom/we*2));const ye=fe*fe;function Te(tt){const bt=(_e*_e-pe*pe+(tt?-1:1)*ye*ye*we*we)/(2*(tt?_e:pe)*ye*we);return Math.log(Math.sqrt(bt*bt+1)-bt)}function Ie(tt){return(Math.exp(tt)-Math.exp(-tt))/2}function be(tt){return(Math.exp(tt)+Math.exp(-tt))/2}const ke=Te(!1);let Xe=function(tt){return be(ke)/be(ke+fe*tt)},qe=function(tt){return pe*((be(ke)*(Ie(bt=ke+fe*tt)/be(bt))-Ie(ke))/ye)/we;var bt},Ze=(Te(!0)-ke)/fe;if(Math.abs(we)<2e-6||!isFinite(Ze)){if(Math.abs(pe-_e)<1e-6)return this.easeTo(s,d);const tt=_e<pe?-1:1;Ze=Math.abs(Math.log(_e/pe))/fe,qe=()=>0,Xe=bt=>Math.exp(tt*fe*bt)}return s.duration="duration"in s?+s.duration:1e3*Ze/("screenSpeed"in s?+s.screenSpeed/fe:+s.speed),s.maxDuration&&s.duration>s.maxDuration&&(s.duration=0),this._zooming=!0,this._rotating=v!==O,this._pitching=F!==w,this._rolling=U!==C,this._padding=!g.isPaddingEqual(K),this._prepareEase(d,!1),this.terrain&&this._prepareElevation(ue.targetCenter),this._ease((tt=>{const bt=tt*Ze,wt=1/Xe(bt),ut=qe(bt);this._rotating&&g.setBearing(o.C.number(v,O,tt)),this._pitching&&g.setPitch(o.C.number(w,F,tt)),this._rolling&&g.setRoll(o.C.number(C,U,tt)),this._padding&&(g.interpolatePadding(B,K,tt),X=g.centerPoint.add(W)),ue.easeFunc(tt,wt,ut,X),this.terrain&&!s.freezeElevation&&this._updateElevation(tt),this._applyUpdatedTransform(g),this._fireMoveEvents(d)}),(()=>{this.terrain&&s.freezeElevation&&this._finalizeElevation(),this._afterEase(d)}),s),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(s,d){var g;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const v=this._onEaseEnd;delete this._onEaseEnd,v.call(this,d)}return s||(g=this.handlers)===null||g===void 0||g.stop(!1),this}_ease(s,d,g){g.animate===!1||g.duration===0?(s(1),d()):(this._easeStart=M.now(),this._easeOptions=g,this._onEaseFrame=s,this._onEaseEnd=d,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(s,d){s=o.aO(s,-180,180);const g=Math.abs(s-d);return Math.abs(s-360-d)<g&&(s-=360),Math.abs(s+360-d)<g&&(s+=360),s}queryTerrainElevation(s){return this.terrain?this.terrain.getElevationForLngLatZoom(o.S.convert(s),this.transform.tileZoom):null}}const ou={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class Yh{constructor(s=ou){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=d=>{!d||d.sourceDataType!=="metadata"&&d.sourceDataType!=="visibility"&&d.dataType!=="style"&&d.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=s}getDefaultPosition(){return"bottom-right"}onAdd(s){return this._map=s,this._compact=this.options.compact,this._container=L.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=L.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=L.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){L.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(s,d){const g=this._map._getUIString(`AttributionControl.${d}`);s.title=g,s.setAttribute("aria-label",g)}_updateAttributions(){if(!this._map.style)return;let s=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?s=s.concat(this.options.customAttribution.map((v=>typeof v!="string"?"":v))):typeof this.options.customAttribution=="string"&&s.push(this.options.customAttribution)),this._map.style.stylesheet){const v=this._map.style.stylesheet;this.styleOwner=v.owner,this.styleId=v.id}const d=this._map.style.sourceCaches;for(const v in d){const w=d[v];if(w.used||w.usedForTerrain){const C=w.getSource();C.attribution&&s.indexOf(C.attribution)<0&&s.push(C.attribution)}}s=s.filter((v=>String(v).trim())),s.sort(((v,w)=>v.length-w.length)),s=s.filter(((v,w)=>{for(let C=w+1;C<s.length;C++)if(s[C].indexOf(v)>=0)return!1;return!0}));const g=s.join(" | ");g!==this._attribHTML&&(this._attribHTML=g,s.length?(this._innerContainer.innerHTML=L.sanitize(g),this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Cf{constructor(s={}){this._updateCompact=()=>{const d=this._container.children;if(d.length){const g=d[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&g.classList.add("maplibregl-compact"):g.classList.remove("maplibregl-compact")}},this.options=s}getDefaultPosition(){return"bottom-left"}onAdd(s){this._map=s,this._compact=this.options&&this.options.compact,this._container=L.create("div","maplibregl-ctrl");const d=L.create("a","maplibregl-ctrl-logo");return d.target="_blank",d.rel="noopener nofollow",d.href="https://maplibre.org/",d.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),d.setAttribute("rel","noopener nofollow"),this._container.appendChild(d),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){L.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class fs{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(s){const d=++this._id;return this._queue.push({callback:s,id:d,cancelled:!1}),d}remove(s){const d=this._currentlyRunning,g=d?this._queue.concat(d):this._queue;for(const v of g)if(v.id===s)return void(v.cancelled=!0)}run(s=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const d=this._currentlyRunning=this._queue;this._queue=[];for(const g of d)if(!g.cancelled&&(g.callback(s),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var ih=o.aJ([{name:"a_pos3d",type:"Int16",components:3}]);class zt extends o.E{constructor(s){super(),this._lastTilesetChange=M.now(),this.sourceCache=s,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=s._source.tileSize*2**this.deltaZoom,s.usedForTerrain=!0,s.tileSize=this.tileSize}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(s,d){this.sourceCache.update(s,d),this._renderableTilesKeys=[];const g={};for(const v of Ne(s,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:d,calculateTileZoom:this.sourceCache._source.calculateTileZoom}))g[v.key]=!0,this._renderableTilesKeys.push(v.key),this._tiles[v.key]||(v.terrainRttPosMatrix32f=new Float64Array(16),o.bY(v.terrainRttPosMatrix32f,0,o.$,o.$,0,0,1),this._tiles[v.key]=new co(v,this.tileSize),this._lastTilesetChange=M.now());for(const v in this._tiles)g[v]||delete this._tiles[v]}freeRtt(s){for(const d in this._tiles){const g=this._tiles[d];(!s||g.tileID.equals(s)||g.tileID.isChildOf(s)||s.isChildOf(g.tileID))&&(g.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map((s=>this.getTileByID(s)))}getTileByID(s){return this._tiles[s]}getTerrainCoords(s,d){return d?this._getTerrainCoordsForTileRanges(s,d):this._getTerrainCoordsForRegularTile(s)}_getTerrainCoordsForRegularTile(s){const d={};for(const g of this._renderableTilesKeys){const v=this._tiles[g].tileID,w=s.clone(),C=o.ba();if(v.canonical.equals(s.canonical))o.bY(C,0,o.$,o.$,0,0,1);else if(v.canonical.isChildOf(s.canonical)){const B=v.canonical.z-s.canonical.z,O=v.canonical.x-(v.canonical.x>>B<<B),F=v.canonical.y-(v.canonical.y>>B<<B),U=o.$>>B;o.bY(C,0,U,U,0,0,1),o.M(C,C,[-O*U,-F*U,0])}else{if(!s.canonical.isChildOf(v.canonical))continue;{const B=s.canonical.z-v.canonical.z,O=s.canonical.x-(s.canonical.x>>B<<B),F=s.canonical.y-(s.canonical.y>>B<<B),U=o.$>>B;o.bY(C,0,o.$,o.$,0,0,1),o.M(C,C,[O*U,F*U,0]),o.N(C,C,[1/2**B,1/2**B,0])}}w.terrainRttPosMatrix32f=new Float32Array(C),d[g]=w}return d}_getTerrainCoordsForTileRanges(s,d){const g={};for(const v of this._renderableTilesKeys){const w=this._tiles[v].tileID;if(!this._isWithinTileRanges(w,d))continue;const C=s.clone(),B=o.ba();if(w.canonical.z===s.canonical.z){const O=s.canonical.x-w.canonical.x,F=s.canonical.y-w.canonical.y;o.bY(B,0,o.$,o.$,0,0,1),o.M(B,B,[O*o.$,F*o.$,0])}else if(w.canonical.z>s.canonical.z){const O=w.canonical.z-s.canonical.z,F=w.canonical.x-(w.canonical.x>>O<<O),U=w.canonical.y-(w.canonical.y>>O<<O),K=s.canonical.x-(w.canonical.x>>O),W=s.canonical.y-(w.canonical.y>>O),X=o.$>>O;o.bY(B,0,X,X,0,0,1),o.M(B,B,[-F*X+K*o.$,-U*X+W*o.$,0])}else{const O=s.canonical.z-w.canonical.z,F=s.canonical.x-(s.canonical.x>>O<<O),U=s.canonical.y-(s.canonical.y>>O<<O),K=(s.canonical.x>>O)-w.canonical.x,W=(s.canonical.y>>O)-w.canonical.y,X=o.$<<O;o.bY(B,0,X,X,0,0,1),o.M(B,B,[F*o.$+K*X,U*o.$+W*X,0])}C.terrainRttPosMatrix32f=new Float32Array(B),g[v]=C}return g}getSourceTile(s,d){const g=this.sourceCache._source;let v=s.overscaledZ-this.deltaZoom;if(v>g.maxzoom&&(v=g.maxzoom),v<g.minzoom)return null;this._sourceTileCache[s.key]||(this._sourceTileCache[s.key]=s.scaledTo(v).key);let w=this.sourceCache.getTileByID(this._sourceTileCache[s.key]);if((!w||!w.dem)&&d)for(;v>=g.minzoom&&(!w||!w.dem);)w=this.sourceCache.getTileByID(s.scaledTo(v--).key);return w}anyTilesAfterTime(s=Date.now()){return this._lastTilesetChange>=s}_isWithinTileRanges(s,d){return d[s.canonical.z]&&s.canonical.x>=d[s.canonical.z].minTileX&&s.canonical.x<=d[s.canonical.z].maxTileX&&s.canonical.y>=d[s.canonical.z].minTileY&&s.canonical.y<=d[s.canonical.z].maxTileY}}class er{constructor(s,d,g){this._meshCache={},this.painter=s,this.sourceCache=new zt(d),this.options=g,this.exaggeration=typeof g.exaggeration=="number"?g.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(s,d,g,v=o.$){var w;if(!(d>=0&&d<v&&g>=0&&g<v))return 0;const C=this.getTerrainData(s),B=(w=C.tile)===null||w===void 0?void 0:w.dem;if(!B)return 0;const O=o.cs([],[d/v*o.$,g/v*o.$],C.u_terrain_matrix),F=[O[0]*B.dim,O[1]*B.dim],U=Math.floor(F[0]),K=Math.floor(F[1]),W=F[0]-U,X=F[1]-K;return B.get(U,K)*(1-W)*(1-X)+B.get(U+1,K)*W*(1-X)+B.get(U,K+1)*(1-W)*X+B.get(U+1,K+1)*W*X}getElevationForLngLatZoom(s,d){if(!o.ct(d,s.wrap()))return 0;const{tileID:g,mercatorX:v,mercatorY:w}=this._getOverscaledTileIDFromLngLatZoom(s,d);return this.getElevation(g,v%o.$,w%o.$,o.$)}getElevation(s,d,g,v=o.$){return this.getDEMElevation(s,d,g,v)*this.exaggeration}getTerrainData(s){if(!this._emptyDemTexture){const v=this.painter.context,w=new o.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new o.T(v,w,v.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new o.T(v,new o.R({width:1,height:1}),v.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(v.gl.NEAREST,v.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=o.ag([])}const d=this.sourceCache.getSourceTile(s,!0);if(d&&d.dem&&(!d.demTexture||d.needsTerrainPrepare)){const v=this.painter.context;d.demTexture=this.painter.getTileTexture(d.dem.stride),d.demTexture?d.demTexture.update(d.dem.getPixels(),{premultiply:!1}):d.demTexture=new o.T(v,d.dem.getPixels(),v.gl.RGBA,{premultiply:!1}),d.demTexture.bind(v.gl.NEAREST,v.gl.CLAMP_TO_EDGE),d.needsTerrainPrepare=!1}const g=d&&d+d.tileID.key+s.key;if(g&&!this._demMatrixCache[g]){const v=this.sourceCache.sourceCache._source.maxzoom;let w=s.canonical.z-d.tileID.canonical.z;s.overscaledZ>s.canonical.z&&(s.canonical.z>=v?w=s.canonical.z-v:o.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const C=s.canonical.x-(s.canonical.x>>w<<w),B=s.canonical.y-(s.canonical.y>>w<<w),O=o.cu(new Float64Array(16),[1/(o.$<<w),1/(o.$<<w),0]);o.M(O,O,[C*o.$,B*o.$,0]),this._demMatrixCache[s.key]={matrix:O,coord:s}}return{u_depth:2,u_terrain:3,u_terrain_dim:d&&d.dem&&d.dem.dim||1,u_terrain_matrix:g?this._demMatrixCache[s.key].matrix:this._emptyDemMatrix,u_terrain_unpack:d&&d.dem&&d.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(d&&d.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:d}}getFramebuffer(s){const d=this.painter,g=d.width/devicePixelRatio,v=d.height/devicePixelRatio;return!this._fbo||this._fbo.width===g&&this._fbo.height===v||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new o.T(d.context,{width:g,height:v,data:null},d.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(d.context.gl.NEAREST,d.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new o.T(d.context,{width:g,height:v,data:null},d.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(d.context.gl.NEAREST,d.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=d.context.createFramebuffer(g,v,!0,!1),this._fbo.depthAttachment.set(d.context.createRenderbuffer(d.context.gl.DEPTH_COMPONENT16,g,v))),this._fbo.colorAttachment.set(s==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const s=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const d=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let w=0,C=0;w<this._coordsTextureSize;w++)for(let B=0;B<this._coordsTextureSize;B++,C+=4)d[C+0]=255&B,d[C+1]=255&w,d[C+2]=B>>8<<4|w>>8,d[C+3]=0;const g=new o.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(d.buffer)),v=new o.T(s,g,s.gl.RGBA,{premultiply:!1});return v.bind(s.gl.NEAREST,s.gl.CLAMP_TO_EDGE),this._coordsTexture=v,v}pointCoordinate(s){this.painter.maybeDrawDepthAndCoords(!0);const d=new Uint8Array(4),g=this.painter.context,v=g.gl,w=Math.round(s.x*this.painter.pixelRatio/devicePixelRatio),C=Math.round(s.y*this.painter.pixelRatio/devicePixelRatio),B=Math.round(this.painter.height/devicePixelRatio);g.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),v.readPixels(w,B-C-1,1,1,v.RGBA,v.UNSIGNED_BYTE,d),g.bindFramebuffer.set(null);const O=d[0]+(d[2]>>4<<8),F=d[1]+((15&d[2])<<8),U=this.coordsIndex[255-d[3]],K=U&&this.sourceCache.getTileByID(U);if(!K)return null;const W=this._coordsTextureSize,X=(1<<K.tileID.canonical.z)*W;return new o.a1((K.tileID.canonical.x*W+O)/X+K.tileID.wrap,(K.tileID.canonical.y*W+F)/X,this.getElevation(K.tileID,O,F,W))}depthAtPoint(s){const d=new Uint8Array(4),g=this.painter.context,v=g.gl;return g.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),v.readPixels(s.x,this.painter.height/devicePixelRatio-s.y-1,1,1,v.RGBA,v.UNSIGNED_BYTE,d),g.bindFramebuffer.set(null),(d[0]/16777216+d[1]/65536+d[2]/256+d[3])/256}getTerrainMesh(s){var d;const g=((d=this.painter.style.projection)===null||d===void 0?void 0:d.transitionState)>0,v=g&&s.canonical.y===0,w=g&&s.canonical.y===(1<<s.canonical.z)-1,C=`m_${v?"n":""}_${w?"s":""}`;if(this._meshCache[C])return this._meshCache[C];const B=this.painter.context,O=new o.cv,F=new o.aN,U=this.meshSize,K=o.$/U,W=U*U;for(let be=0;be<=U;be++)for(let ke=0;ke<=U;ke++)O.emplaceBack(ke*K,be*K,0);for(let be=0;be<W;be+=U+1)for(let ke=0;ke<U;ke++)F.emplaceBack(ke+be,U+ke+be+1,U+ke+be+2),F.emplaceBack(ke+be,U+ke+be+2,ke+be+1);const X=O.length,re=X+(U+1),ue=(U+1)*U,fe=v?o.bh:0,pe=v?0:1,_e=w?o.bi:o.$,we=w?0:1;for(let be=0;be<=U;be++)O.emplaceBack(be*K,fe,pe);for(let be=0;be<=U;be++)O.emplaceBack(be*K,_e,we);for(let be=0;be<U;be++)F.emplaceBack(ue+be,re+be,re+be+1),F.emplaceBack(ue+be,re+be+1,ue+be+1),F.emplaceBack(0+be,X+be+1,X+be),F.emplaceBack(0+be,0+be+1,X+be+1);const ye=O.length,Te=ye+2*(U+1);for(const be of[0,1])for(let ke=0;ke<=U;ke++)for(const Xe of[0,1])O.emplaceBack(be*o.$,ke*K,Xe);for(let be=0;be<2*U;be+=2)F.emplaceBack(ye+be,ye+be+1,ye+be+3),F.emplaceBack(ye+be,ye+be+3,ye+be+2),F.emplaceBack(Te+be,Te+be+3,Te+be+1),F.emplaceBack(Te+be,Te+be+2,Te+be+3);const Ie=new mt(B.createVertexBuffer(O,ih.members),B.createIndexBuffer(F),o.aM.simpleSegment(0,0,O.length,F.length));return this._meshCache[C]=Ie,Ie}getMeshFrameDelta(s){return 2*Math.PI*o.bu/Math.pow(2,Math.max(s,0))/5}getMinTileElevationForLngLatZoom(s,d){var g;const{tileID:v}=this._getOverscaledTileIDFromLngLatZoom(s,d);return(g=this.getMinMaxElevation(v).minElevation)!==null&&g!==void 0?g:0}getMinMaxElevation(s){const d=this.getTerrainData(s).tile,g={minElevation:null,maxElevation:null};return d&&d.dem&&(g.minElevation=d.dem.min*this.exaggeration,g.maxElevation=d.dem.max*this.exaggeration),g}_getOverscaledTileIDFromLngLatZoom(s,d){const g=o.a1.fromLngLat(s.wrap()),v=(1<<d)*o.$,w=g.x*v,C=g.y*v,B=Math.floor(w/o.$),O=Math.floor(C/o.$);return{tileID:new o.Z(d,0,d,B,O),mercatorX:w,mercatorY:C}}}class za{constructor(s,d,g){this._context=s,this._size=d,this._tileSize=g,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const s of this._objects)s.texture.destroy(),s.fbo.destroy()}_createObject(s){const d=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),g=new o.T(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return g.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),d.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),d.colorAttachment.set(g.texture),{id:s,fbo:d,texture:g,stamp:-1,inUse:!1}}getObjectForId(s){return this._objects[s]}useObject(s){s.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter((d=>s.id!==d)),this._recentlyUsed.push(s.id)}stampObject(s){s.stamp=++this._stamp}getOrCreateFreeObject(){for(const d of this._recentlyUsed)if(!this._objects[d].inUse)return this._objects[d];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const s=this._createObject(this._objects.length);return this._objects.push(s),s}freeObject(s){s.inUse=!1}freeAllObjects(){for(const s of this._objects)this.freeObject(s)}isFull(){return!(this._objects.length<this._size)&&this._objects.some((s=>!s.inUse))===!1}}const ca={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0,"color-relief":!0};class au{constructor(s,d){this.painter=s,this.terrain=d,this.pool=new za(s.context,30,d.sourceCache.tileSize*d.qualityFactor)}destruct(){this.pool.destruct()}getTexture(s){return this.pool.getObjectForId(s.rtt[this._stacks.length-1].id).texture}prepareForRender(s,d){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=s._order.filter((g=>!s._layers[g].isHidden(d))),this._coordsAscending={};for(const g in s.sourceCaches){this._coordsAscending[g]={};const v=s.sourceCaches[g].getVisibleCoordinates(),w=s.sourceCaches[g].getSource(),C=w instanceof ns?w.terrainTileRanges:null;for(const B of v){const O=this.terrain.sourceCache.getTerrainCoords(B,C);for(const F in O)this._coordsAscending[g][F]||(this._coordsAscending[g][F]=[]),this._coordsAscending[g][F].push(O[F])}}this._coordsAscendingStr={};for(const g of s._order){const v=s._layers[g],w=v.source;if(ca[v.type]&&!this._coordsAscendingStr[w]){this._coordsAscendingStr[w]={};for(const C in this._coordsAscending[w])this._coordsAscendingStr[w][C]=this._coordsAscending[w][C].map((B=>B.key)).sort().join()}}for(const g of this._renderableTiles)for(const v in this._coordsAscendingStr){const w=this._coordsAscendingStr[v][g.tileID.key];w&&w!==g.rttCoords[v]&&(g.rtt=[])}}renderLayer(s,d){if(s.isHidden(this.painter.transform.zoom))return!1;const g=Object.assign(Object.assign({},d),{isRenderingToTexture:!0}),v=s.type,w=this.painter,C=this._renderableLayerIds[this._renderableLayerIds.length-1]===s.id;if(ca[v]&&(this._prevType&&ca[this._prevType]||this._stacks.push([]),this._prevType=v,this._stacks[this._stacks.length-1].push(s.id),!C))return!0;if(ca[this._prevType]||ca[v]&&C){this._prevType=v;const B=this._stacks.length-1,O=this._stacks[B]||[];for(const F of this._renderableTiles){if(this.pool.isFull()&&(Ks(this.painter,this.terrain,this._rttTiles,g),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(F),F.rtt[B]){const K=this.pool.getObjectForId(F.rtt[B].id);if(K.stamp===F.rtt[B].stamp){this.pool.useObject(K);continue}}const U=this.pool.getOrCreateFreeObject();this.pool.useObject(U),this.pool.stampObject(U),F.rtt[B]={id:U.id,stamp:U.stamp},w.context.bindFramebuffer.set(U.fbo.framebuffer),w.context.clear({color:o.bf.transparent,stencil:0}),w.currentStencilSource=void 0;for(let K=0;K<O.length;K++){const W=w.style._layers[O[K]],X=W.source?this._coordsAscending[W.source][F.tileID.key]:[F.tileID];w.context.viewport.set([0,0,U.fbo.width,U.fbo.height]),w._renderTileClippingMasks(W,X,!0),w.renderLayer(w,w.style.sourceCaches[W.source],W,X,g),W.source&&(F.rttCoords[W.source]=this._coordsAscendingStr[W.source][F.tileID.key])}}return Ks(this.painter,this.terrain,this._rttTiles,g),this._rttTiles=[],this.pool.freeAllObjects(),ca[v]}return!1}}const zn={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Jh=m,jn={hash:!1,interactive:!0,bearingSnap:7,attributionControl:ou,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:o.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0},mo={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class Ho{constructor(s,d,g=!1){this.mousedown=w=>{this.startMove(w,L.mousePos(this.element,w)),L.addEventListener(window,"mousemove",this.mousemove),L.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=w=>{this.move(w,L.mousePos(this.element,w))},this.mouseup=w=>{this._rotatePitchHandler.dragEnd(w),this.offTemp()},this.touchstart=w=>{w.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=L.touchPos(this.element,w.targetTouches)[0],this.startMove(w,this._startPos),L.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),L.addEventListener(window,"touchend",this.touchend))},this.touchmove=w=>{w.targetTouches.length!==1?this.reset():(this._lastPos=L.touchPos(this.element,w.targetTouches)[0],this.move(w,this._lastPos))},this.touchend=w=>{w.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHandler.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=d;const v=new wl;this._rotatePitchHandler=new tc({clickTolerance:3,move:(w,C)=>{const B=d.getBoundingClientRect(),O=new o.P((B.bottom-B.top)/2,(B.right-B.left)/2);return{bearingDelta:o.cn(new o.P(w.x,C.y),C,O),pitchDelta:g?-.5*(C.y-w.y):void 0}},moveStateManager:v,enable:!0,assignEvents:()=>{}}),this.map=s,L.addEventListener(d,"mousedown",this.mousedown),L.addEventListener(d,"touchstart",this.touchstart,{passive:!1}),L.addEventListener(d,"touchcancel",this.reset)}startMove(s,d){this._rotatePitchHandler.dragStart(s,d),L.disableDrag()}move(s,d){const g=this.map,{bearingDelta:v,pitchDelta:w}=this._rotatePitchHandler.dragMove(s,d)||{};v&&g.setBearing(g.getBearing()+v),w&&g.setPitch(g.getPitch()+w)}off(){const s=this.element;L.removeEventListener(s,"mousedown",this.mousedown),L.removeEventListener(s,"touchstart",this.touchstart,{passive:!1}),L.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),L.removeEventListener(window,"touchend",this.touchend),L.removeEventListener(s,"touchcancel",this.reset),this.offTemp()}offTemp(){L.enableDrag(),L.removeEventListener(window,"mousemove",this.mousemove),L.removeEventListener(window,"mouseup",this.mouseup),L.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),L.removeEventListener(window,"touchend",this.touchend)}}let Yr;function Li(x,s,d,g=!1){if(g||!d.getCoveringTilesDetailsProvider().allowWorldCopies())return x?.wrap();const v=new o.S(x.lng,x.lat);if(x=new o.S(x.lng,x.lat),s){const w=new o.S(x.lng-360,x.lat),C=new o.S(x.lng+360,x.lat),B=d.locationToScreenPoint(x).distSqr(s);d.locationToScreenPoint(w).distSqr(s)<B?x=w:d.locationToScreenPoint(C).distSqr(s)<B&&(x=C)}for(;Math.abs(x.lng-d.center.lng)>180;){const w=d.locationToScreenPoint(x);if(w.x>=0&&w.y>=0&&w.x<=d.width&&w.y<=d.height)break;x.lng>d.center.lng?x.lng-=360:x.lng+=360}return x.lng!==v.lng&&d.isPointOnMapSurface(d.locationToScreenPoint(x))?x:v}const go={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Js(x,s,d){const g=x.classList;for(const v in go)g.remove(`maplibregl-${d}-anchor-${v}`);g.add(`maplibregl-${d}-anchor-${s}`)}class Al extends o.E{constructor(s){if(super(),this._onKeyPress=d=>{const g=d.code,v=d.charCode||d.keyCode;g!=="Space"&&g!=="Enter"&&v!==32&&v!==13||this.togglePopup()},this._onMapClick=d=>{const g=d.originalEvent.target,v=this._element;this._popup&&(g===v||v.contains(g))&&this.togglePopup()},this._update=d=>{if(!this._map)return;const g=this._map.loaded()&&!this._map.isMoving();(d?.type==="terrain"||d?.type==="render"&&!g)&&this._map.once("render",this._update),this._lngLat=Li(this._lngLat,this._flatPos,this._map.transform),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let v="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?v=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(v=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let w="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?w="rotateX(0deg)":this._pitchAlignment==="map"&&(w=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||d&&d.type!=="moveend"||(this._pos=this._pos.round()),L.setTransform(this._element,`${go[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${w} ${v}`),M.frameAsync(new AbortController).then((()=>{this._updateOpacity(d&&d.type==="moveend")})).catch((()=>{}))},this._onMove=d=>{if(!this._isDragging){const g=this._clickTolerance||this._map._clickTolerance;this._isDragging=d.point.dist(this._pointerdownPos)>=g}this._isDragging&&(this._pos=d.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new o.l("dragstart"))),this.fire(new o.l("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new o.l("dragend")),this._state="inactive"},this._addDragHandler=d=>{this._element.contains(d.originalEvent.target)&&(d.preventDefault(),this._positionDelta=d.point.sub(this._pos).add(this._offset),this._pointerdownPos=d.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=s&&s.anchor||"center",this._color=s&&s.color||"#3FB1CE",this._scale=s&&s.scale||1,this._draggable=s&&s.draggable||!1,this._clickTolerance=s&&s.clickTolerance||0,this._subpixelPositioning=s&&s.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=s&&s.rotation||0,this._rotationAlignment=s&&s.rotationAlignment||"auto",this._pitchAlignment=s&&s.pitchAlignment&&s.pitchAlignment!=="auto"?s.pitchAlignment:this._rotationAlignment,this.setOpacity(s?.opacity,s?.opacityWhenCovered),s&&s.element)this._element=s.element,this._offset=o.P.convert(s&&s.offset||[0,0]);else{this._defaultMarker=!0,this._element=L.create("div");const d=L.createNS("http://www.w3.org/2000/svg","svg"),g=41,v=27;d.setAttributeNS(null,"display","block"),d.setAttributeNS(null,"height",`${g}px`),d.setAttributeNS(null,"width",`${v}px`),d.setAttributeNS(null,"viewBox",`0 0 ${v} ${g}`);const w=L.createNS("http://www.w3.org/2000/svg","g");w.setAttributeNS(null,"stroke","none"),w.setAttributeNS(null,"stroke-width","1"),w.setAttributeNS(null,"fill","none"),w.setAttributeNS(null,"fill-rule","evenodd");const C=L.createNS("http://www.w3.org/2000/svg","g");C.setAttributeNS(null,"fill-rule","nonzero");const B=L.createNS("http://www.w3.org/2000/svg","g");B.setAttributeNS(null,"transform","translate(3.0, 29.0)"),B.setAttributeNS(null,"fill","#000000");const O=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const pe of O){const _e=L.createNS("http://www.w3.org/2000/svg","ellipse");_e.setAttributeNS(null,"opacity","0.04"),_e.setAttributeNS(null,"cx","10.5"),_e.setAttributeNS(null,"cy","5.80029008"),_e.setAttributeNS(null,"rx",pe.rx),_e.setAttributeNS(null,"ry",pe.ry),B.appendChild(_e)}const F=L.createNS("http://www.w3.org/2000/svg","g");F.setAttributeNS(null,"fill",this._color);const U=L.createNS("http://www.w3.org/2000/svg","path");U.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),F.appendChild(U);const K=L.createNS("http://www.w3.org/2000/svg","g");K.setAttributeNS(null,"opacity","0.25"),K.setAttributeNS(null,"fill","#000000");const W=L.createNS("http://www.w3.org/2000/svg","path");W.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),K.appendChild(W);const X=L.createNS("http://www.w3.org/2000/svg","g");X.setAttributeNS(null,"transform","translate(6.0, 7.0)"),X.setAttributeNS(null,"fill","#FFFFFF");const re=L.createNS("http://www.w3.org/2000/svg","g");re.setAttributeNS(null,"transform","translate(8.0, 8.0)");const ue=L.createNS("http://www.w3.org/2000/svg","circle");ue.setAttributeNS(null,"fill","#000000"),ue.setAttributeNS(null,"opacity","0.25"),ue.setAttributeNS(null,"cx","5.5"),ue.setAttributeNS(null,"cy","5.5"),ue.setAttributeNS(null,"r","5.4999962");const fe=L.createNS("http://www.w3.org/2000/svg","circle");fe.setAttributeNS(null,"fill","#FFFFFF"),fe.setAttributeNS(null,"cx","5.5"),fe.setAttributeNS(null,"cy","5.5"),fe.setAttributeNS(null,"r","5.4999962"),re.appendChild(ue),re.appendChild(fe),C.appendChild(B),C.appendChild(F),C.appendChild(K),C.appendChild(X),C.appendChild(re),d.appendChild(C),d.setAttributeNS(null,"height",g*this._scale+"px"),d.setAttributeNS(null,"width",v*this._scale+"px"),this._element.appendChild(d),this._offset=o.P.convert(s&&s.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",(d=>{d.preventDefault()})),this._element.addEventListener("mousedown",(d=>{d.preventDefault()})),Js(this._element,this._anchor,"marker"),s&&s.className)for(const d of s.className.split(" "))this._element.classList.add(d);this._popup=null}addTo(s){return this.remove(),this._map=s,this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label",s._getUIString("Marker.Title")),s.getCanvasContainer().appendChild(this._element),s.on("move",this._update),s.on("moveend",this._update),s.on("terrain",this._update),s.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),L.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(s){return this._lngLat=o.S.convert(s),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(s){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),s){if(!("offset"in s.options)){const d=Math.abs(13.5)/Math.SQRT2;s.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[d,-1*(38.1-13.5+d)],"bottom-right":[-d,-1*(38.1-13.5+d)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=s,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(s){return this._subpixelPositioning=s,this}getPopup(){return this._popup}togglePopup(){const s=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:s?(s.isOpen()?s.remove():(s.setLngLat(this._lngLat),s.addTo(this._map)),this):this}_updateOpacity(s=!1){var d,g;const v=(d=this._map)===null||d===void 0?void 0:d.terrain,w=this._map.transform.isLocationOccluded(this._lngLat);if(!v||w){const X=w?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==X&&(this._element.style.opacity=X))}if(s)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout((()=>{this._opacityTimeout=null}),100)}const C=this._map,B=C.terrain.depthAtPoint(this._pos),O=C.terrain.getElevationForLngLatZoom(this._lngLat,C.transform.tileZoom);if(C.transform.lngLatToCameraDepth(this._lngLat,O)-B<.006)return void(this._element.style.opacity=this._opacity);const F=-this._offset.y/C.transform.pixelsPerMeter,U=Math.sin(C.getPitch()*Math.PI/180)*F,K=C.terrain.depthAtPoint(new o.P(this._pos.x,this._pos.y-this._offset.y)),W=C.transform.lngLatToCameraDepth(this._lngLat,O+U)-K>.006;!((g=this._popup)===null||g===void 0)&&g.isOpen()&&W&&this._popup.remove(),this._element.style.opacity=W?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(s){return this._offset=o.P.convert(s),this._update(),this}addClassName(s){this._element.classList.add(s)}removeClassName(s){this._element.classList.remove(s)}toggleClassName(s){return this._element.classList.toggle(s)}setDraggable(s){return this._draggable=!!s,this._map&&(s?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(s){return this._rotation=s||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(s){return this._rotationAlignment=s||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(s){return this._pitchAlignment=s&&s!=="auto"?s:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(s,d){return(this._opacity===void 0||s===void 0&&d===void 0)&&(this._opacity="1",this._opacityWhenCovered="0.2"),s!==void 0&&(this._opacity=s),d!==void 0&&(this._opacityWhenCovered=d),this._map&&this._updateOpacity(!0),this}}const Qh={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Os=0,Ds=!1;const Tl={maxWidth:100,unit:"metric"};function nh(x,s,d){const g=d&&d.maxWidth||100,v=x._container.clientHeight/2,w=x._container.clientWidth/2,C=x.unproject([w-g/2,v]),B=x.unproject([w+g/2,v]),O=Math.round(x.project(B).x-x.project(C).x),F=Math.min(g,O,x._container.clientWidth),U=C.distanceTo(B);if(d&&d.unit==="imperial"){const K=3.2808*U;K>5280?ua(s,F,K/5280,x._getUIString("ScaleControl.Miles")):ua(s,F,K,x._getUIString("ScaleControl.Feet"))}else d&&d.unit==="nautical"?ua(s,F,U/1852,x._getUIString("ScaleControl.NauticalMiles")):U>=1e3?ua(s,F,U/1e3,x._getUIString("ScaleControl.Kilometers")):ua(s,F,U,x._getUIString("ScaleControl.Meters"))}function ua(x,s,d,g){const v=(function(w){const C=Math.pow(10,`${Math.floor(w)}`.length-1);let B=w/C;return B=B>=10?10:B>=5?5:B>=3?3:B>=2?2:B>=1?1:(function(O){const F=Math.pow(10,Math.ceil(-Math.log(O)/Math.LN10));return Math.round(O*F)/F})(B),C*B})(d);x.style.width=s*(v/d)+"px",x.innerHTML=`${v}&nbsp;${g}`}const ed={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1,locationOccludedOpacity:void 0},rc=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Qs(x){if(x){if(typeof x=="number"){const s=Math.round(Math.abs(x)/Math.SQRT2);return{center:new o.P(0,0),top:new o.P(0,x),"top-left":new o.P(s,s),"top-right":new o.P(-s,s),bottom:new o.P(0,-x),"bottom-left":new o.P(s,-s),"bottom-right":new o.P(-s,-s),left:new o.P(x,0),right:new o.P(-x,0)}}if(x instanceof o.P||Array.isArray(x)){const s=o.P.convert(x);return{center:s,top:s,"top-left":s,"top-right":s,bottom:s,"bottom-left":s,"bottom-right":s,left:s,right:s}}return{center:o.P.convert(x.center||[0,0]),top:o.P.convert(x.top||[0,0]),"top-left":o.P.convert(x["top-left"]||[0,0]),"top-right":o.P.convert(x["top-right"]||[0,0]),bottom:o.P.convert(x.bottom||[0,0]),"bottom-left":o.P.convert(x["bottom-left"]||[0,0]),"bottom-right":o.P.convert(x["bottom-right"]||[0,0]),left:o.P.convert(x.left||[0,0]),right:o.P.convert(x.right||[0,0])}}return Qs(new o.P(0,0))}const ic=m;c.AJAXError=o.cz,c.Event=o.l,c.Evented=o.E,c.LngLat=o.S,c.MercatorCoordinate=o.a1,c.Point=o.P,c.addProtocol=o.cA,c.config=o.a,c.removeProtocol=o.cB,c.AttributionControl=Yh,c.BoxZoomHandler=Kn,c.CanvasSource=vi,c.CooperativeGesturesHandler=rh,c.DoubleClickZoomHandler=Ys,c.DragPanHandler=Xh,c.DragRotateHandler=th,c.EdgeInsets=Ti,c.FullscreenControl=class extends o.E{constructor(x={}){super(),this._onFullscreenChange=()=>{var s;let d=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((s=d?.shadowRoot)===null||s===void 0)&&s.fullscreenElement;)d=d.shadowRoot.fullscreenElement;d===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,x&&x.container&&(x.container instanceof HTMLElement?this._container=x.container:o.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(x){return this._map=x,this._container||(this._container=this._map.getContainer()),this._controlContainer=L.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){L.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const x=this._fullscreenButton=L.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);L.create("span","maplibregl-ctrl-icon",x).setAttribute("aria-hidden","true"),x.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const x=this._getTitle();this._fullscreenButton.setAttribute("aria-label",x),this._fullscreenButton.title=x}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new o.l("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new o.l("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},c.GeoJSONSource=Ps,c.GeolocateControl=class extends o.E{constructor(x){super(),this._onSuccess=s=>{if(this._map){if(this._isOutOfMapMaxBounds(s))return this._setErrorState(),this.fire(new o.l("outofmaxbounds",s)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=s,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(s),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(s),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new o.l("geolocate",s)),this._finish()}},this._updateCamera=s=>{const d=new o.S(s.coords.longitude,s.coords.latitude),g=s.coords.accuracy,v=this._map.getBearing(),w=o.e({bearing:v},this.options.fitBoundsOptions),C=Zr.fromLngLat(d,g);this._map.fitBounds(C,w,{geolocateSource:!0})},this._updateMarker=s=>{if(s){const d=new o.S(s.coords.longitude,s.coords.latitude);this._accuracyCircleMarker.setLngLat(d).addTo(this._map),this._userLocationDotMarker.setLngLat(d).addTo(this._map),this._accuracy=s.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=s=>{if(this._map){if(s.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const d=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=d,this._geolocateButton.setAttribute("aria-label",d),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(s.code===3&&Ds)return;this.options.trackUserLocation&&this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new o.l("error",s)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",(s=>s.preventDefault())),this._geolocateButton=L.create("button","maplibregl-ctrl-geolocate",this._container),L.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=s=>{if(this._map){if(s===!1){o.w("Geolocation support is not available so the GeolocateControl will be disabled.");const d=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=d,this._geolocateButton.setAttribute("aria-label",d)}else{const d=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=d,this._geolocateButton.setAttribute("aria-label",d)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=L.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Al({element:this._dotElement}),this._circleElement=L.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Al({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",(()=>this.trigger())),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(d=>{const g=d?.[0]instanceof ResizeObserverEntry;d.geolocateSource||this._watchState!=="ACTIVE_LOCK"||g||this._map.isZooming()||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new o.l("trackuserlocationend")),this.fire(new o.l("userlocationlostfocus")))}))}},this.options=o.e({},Qh,x)}onAdd(x){return this._map=x,this._container=L.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),(function(){return o._(this,arguments,void 0,(function*(s=!1){if(Yr!==void 0&&!s)return Yr;if(window.navigator.permissions===void 0)return Yr=!!window.navigator.geolocation,Yr;try{Yr=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{Yr=!!window.navigator.geolocation}return Yr}))})().then((s=>this._finishSetupUI(s))),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),L.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Os=0,Ds=!1}_isOutOfMapMaxBounds(x){const s=this._map.getMaxBounds(),d=x.coords;return s&&(d.longitude<s.getWest()||d.longitude>s.getEast()||d.latitude<s.getSouth()||d.latitude>s.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const x=this._map.getBounds(),s=x.getSouthEast(),d=x.getNorthEast(),g=s.distanceTo(d),v=Math.ceil(this._accuracy/(g/this._map._container.clientHeight)*2);this._circleElement.style.width=`${v}px`,this._circleElement.style.height=`${v}px`}trigger(){if(!this._setup)return o.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.l("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Os--,Ds=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new o.l("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.l("trackuserlocationstart")),this.fire(new o.l("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let x;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Os++,Os>1?(x={maximumAge:6e5,timeout:0},Ds=!0):(x=this.options.positionOptions,Ds=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,x)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},c.GlobeControl=class{constructor(){this._toggleProjection=()=>{var x;const s=(x=this._map.getProjection())===null||x===void 0?void 0:x.type;this._map.setProjection(s!=="mercator"&&s?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var x;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),((x=this._map.getProjection())===null||x===void 0?void 0:x.type)==="globe"?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(x){return this._map=x,this._container=L.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=L.create("button","maplibregl-ctrl-globe",this._container),L.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){L.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},c.Hash=qh,c.ImageSource=ns,c.KeyboardHandler=nu,c.LngLatBounds=Zr,c.LogoControl=Cf,c.Map=class extends su{constructor(x){var s,d;o.cw.mark(o.cx.create);const g=Object.assign(Object.assign(Object.assign({},jn),x),{canvasContextAttributes:Object.assign(Object.assign({},jn.canvasContextAttributes),x.canvasContextAttributes)});if(g.minZoom!=null&&g.maxZoom!=null&&g.minZoom>g.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(g.minPitch!=null&&g.maxPitch!=null&&g.minPitch>g.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(g.minPitch!=null&&g.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(g.maxPitch!=null&&g.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");const v=new ci,w=new Nn;if(g.minZoom!==void 0&&v.setMinZoom(g.minZoom),g.maxZoom!==void 0&&v.setMaxZoom(g.maxZoom),g.minPitch!==void 0&&v.setMinPitch(g.minPitch),g.maxPitch!==void 0&&v.setMaxPitch(g.maxPitch),g.renderWorldCopies!==void 0&&v.setRenderWorldCopies(g.renderWorldCopies),super(v,w,{bearingSnap:g.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new fs,this._controls=[],this._mapId=o.a7(),this._contextLost=B=>{B.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new o.l("webglcontextlost",{originalEvent:B}))},this._contextRestored=B=>{this._setupPainter(),this.resize(),this._update(),this.fire(new o.l("webglcontextrestored",{originalEvent:B}))},this._onMapScroll=B=>{if(B.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=g.interactive,this._maxTileCacheSize=g.maxTileCacheSize,this._maxTileCacheZoomLevels=g.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},g.canvasContextAttributes),this._trackResize=g.trackResize===!0,this._bearingSnap=g.bearingSnap,this._centerClampedToGround=g.centerClampedToGround,this._refreshExpiredTiles=g.refreshExpiredTiles===!0,this._fadeDuration=g.fadeDuration,this._crossSourceCollisions=g.crossSourceCollisions===!0,this._collectResourceTiming=g.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},zn),g.locale),this._clickTolerance=g.clickTolerance,this._overridePixelRatio=g.pixelRatio,this._maxCanvasSize=g.maxCanvasSize,this.transformCameraUpdate=g.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=g.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=me.addThrottleControl((()=>this.isMoving())),this._requestManager=new Se(g.transformRequest),typeof g.container=="string"){if(this._container=document.getElementById(g.container),!this._container)throw new Error(`Container '${g.container}' not found.`)}else{if(!(g.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=g.container}if(g.maxBounds&&this.setMaxBounds(g.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),this.on("terrain",(()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)})),this.once("idle",(()=>{this._idleTriggered=!0})),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let B=!1;const O=Ba((F=>{this._trackResize&&!this._removed&&(this.resize(F),this.redraw())}),50);this._resizeObserver=new ResizeObserver((F=>{B?O(F):B=!0})),this._resizeObserver.observe(this._container)}this.handlers=new Sf(this,g),this._hash=g.hash&&new qh(typeof g.hash=="string"&&g.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:g.center,elevation:g.elevation,zoom:g.zoom,bearing:g.bearing,pitch:g.pitch,roll:g.roll}),g.bounds&&(this.resize(),this.fitBounds(g.bounds,o.e({},g.fitBoundsOptions,{duration:0}))));const C=typeof g.style=="string"||((d=(s=g.style)===null||s===void 0?void 0:s.projection)===null||d===void 0?void 0:d.type)!=="globe";this.resize(null,C),this._localIdeographFontFamily=g.localIdeographFontFamily,this._validateStyle=g.validateStyle,g.style&&this.setStyle(g.style,{localIdeographFontFamily:g.localIdeographFontFamily}),g.attributionControl&&this.addControl(new Yh(typeof g.attributionControl=="boolean"?void 0:g.attributionControl)),g.maplibreLogo&&this.addControl(new Cf,g.logoPosition),this.on("style.load",(()=>{if(C||this._resizeTransform(),this.transform.unmodified){const B=o.Q(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(B)}})),this.on("data",(B=>{this._update(B.dataType==="style"),this.fire(new o.l(`${B.dataType}data`,B))})),this.on("dataloading",(B=>{this.fire(new o.l(`${B.dataType}dataloading`,B))})),this.on("dataabort",(B=>{this.fire(new o.l("sourcedataabort",B))}))}_getMapId(){return this._mapId}setGlobalStateProperty(x,s){return this.style.setGlobalStateProperty(x,s),this._update(!0)}getGlobalState(){return this.style.getGlobalState()}addControl(x,s){if(s===void 0&&(s=x.getDefaultPosition?x.getDefaultPosition():"top-right"),!x||!x.onAdd)return this.fire(new o.k(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const d=x.onAdd(this);this._controls.push(x);const g=this._controlPositions[s];return s.indexOf("bottom")!==-1?g.insertBefore(d,g.firstChild):g.appendChild(d),this}removeControl(x){if(!x||!x.onRemove)return this.fire(new o.k(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const s=this._controls.indexOf(x);return s>-1&&this._controls.splice(s,1),x.onRemove(this),this}hasControl(x){return this._controls.indexOf(x)>-1}calculateCameraOptionsFromTo(x,s,d,g){return g==null&&this.terrain&&(g=this.terrain.getElevationForLngLatZoom(d,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(x,s,d,g)}resize(x,s=!0){const[d,g]=this._containerDimensions(),v=this._getClampedPixelRatio(d,g);if(this._resizeCanvas(d,g,v),this.painter.resize(d,g,v),this.painter.overLimit()){const C=this.painter.context.gl;this._maxCanvasSize=[C.drawingBufferWidth,C.drawingBufferHeight];const B=this._getClampedPixelRatio(d,g);this._resizeCanvas(d,g,B),this.painter.resize(d,g,B)}this._resizeTransform(s);const w=!this._moving;return w&&(this.stop(),this.fire(new o.l("movestart",x)).fire(new o.l("move",x))),this.fire(new o.l("resize",x)),w&&this.fire(new o.l("moveend",x)),this}_resizeTransform(x=!0){var s;const[d,g]=this._containerDimensions();this.transform.resize(d,g,x),(s=this._requestedCameraState)===null||s===void 0||s.resize(d,g,x)}_getClampedPixelRatio(x,s){const{0:d,1:g}=this._maxCanvasSize,v=this.getPixelRatio(),w=x*v,C=s*v;return Math.min(w>d?d/w:1,C>g?g/C:1)*v}getPixelRatio(){var x;return(x=this._overridePixelRatio)!==null&&x!==void 0?x:devicePixelRatio}setPixelRatio(x){this._overridePixelRatio=x,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(x){return this.transform.setMaxBounds(Zr.convert(x)),this._update()}setMinZoom(x){if((x=x??-2)>=-2&&x<=this.transform.maxZoom)return this.transform.setMinZoom(x),this._update(),this.getZoom()<x&&this.setZoom(x),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(x){if((x=x??22)>=this.transform.minZoom)return this.transform.setMaxZoom(x),this._update(),this.getZoom()>x&&this.setZoom(x),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(x){if((x=x??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(x>=0&&x<=this.transform.maxPitch)return this.transform.setMinPitch(x),this._update(),this.getPitch()<x&&this.setPitch(x),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(x){if((x=x??60)>180)throw new Error("maxPitch must be less than or equal to 180");if(x>=this.transform.minPitch)return this.transform.setMaxPitch(x),this._update(),this.getPitch()>x&&this.setPitch(x),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(x){return this.transform.setRenderWorldCopies(x),this._update()}project(x){return this.transform.locationToScreenPoint(o.S.convert(x),this.style&&this.terrain)}unproject(x){return this.transform.screenPointToLocation(o.P.convert(x),this.terrain)}isMoving(){var x;return this._moving||((x=this.handlers)===null||x===void 0?void 0:x.isMoving())}isZooming(){var x;return this._zooming||((x=this.handlers)===null||x===void 0?void 0:x.isZooming())}isRotating(){var x;return this._rotating||((x=this.handlers)===null||x===void 0?void 0:x.isRotating())}_createDelegatedListener(x,s,d){if(x==="mouseenter"||x==="mouseover"){let g=!1;return{layers:s,listener:d,delegates:{mousemove:v=>{const w=s.filter((B=>this.getLayer(B))),C=w.length!==0?this.queryRenderedFeatures(v.point,{layers:w}):[];C.length?g||(g=!0,d.call(this,new Dr(x,this,v.originalEvent,{features:C}))):g=!1},mouseout:()=>{g=!1}}}}if(x==="mouseleave"||x==="mouseout"){let g=!1;return{layers:s,listener:d,delegates:{mousemove:v=>{const w=s.filter((C=>this.getLayer(C)));(w.length!==0?this.queryRenderedFeatures(v.point,{layers:w}):[]).length?g=!0:g&&(g=!1,d.call(this,new Dr(x,this,v.originalEvent)))},mouseout:v=>{g&&(g=!1,d.call(this,new Dr(x,this,v.originalEvent)))}}}}{const g=v=>{const w=s.filter((B=>this.getLayer(B))),C=w.length!==0?this.queryRenderedFeatures(v.point,{layers:w}):[];C.length&&(v.features=C,d.call(this,v),delete v.features)};return{layers:s,listener:d,delegates:{[x]:g}}}}_saveDelegatedListener(x,s){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[x]=this._delegatedListeners[x]||[],this._delegatedListeners[x].push(s)}_removeDelegatedListener(x,s,d){if(!this._delegatedListeners||!this._delegatedListeners[x])return;const g=this._delegatedListeners[x];for(let v=0;v<g.length;v++){const w=g[v];if(w.listener===d&&w.layers.length===s.length&&w.layers.every((C=>s.includes(C)))){for(const C in w.delegates)this.off(C,w.delegates[C]);return void g.splice(v,1)}}}on(x,s,d){if(d===void 0)return super.on(x,s);const g=typeof s=="string"?[s]:s,v=this._createDelegatedListener(x,g,d);this._saveDelegatedListener(x,v);for(const w in v.delegates)this.on(w,v.delegates[w]);return{unsubscribe:()=>{this._removeDelegatedListener(x,g,d)}}}once(x,s,d){if(d===void 0)return super.once(x,s);const g=typeof s=="string"?[s]:s,v=this._createDelegatedListener(x,g,d);for(const w in v.delegates){const C=v.delegates[w];v.delegates[w]=(...B)=>{this._removeDelegatedListener(x,g,d),C(...B)}}this._saveDelegatedListener(x,v);for(const w in v.delegates)this.once(w,v.delegates[w]);return this}off(x,s,d){return d===void 0?super.off(x,s):(this._removeDelegatedListener(x,typeof s=="string"?[s]:s,d),this)}queryRenderedFeatures(x,s){if(!this.style)return[];let d;const g=x instanceof o.P||Array.isArray(x),v=g?x:[[0,0],[this.transform.width,this.transform.height]];if(s=s||(g?{}:x)||{},v instanceof o.P||typeof v[0]=="number")d=[o.P.convert(v)];else{const w=o.P.convert(v[0]),C=o.P.convert(v[1]);d=[w,new o.P(C.x,w.y),C,new o.P(w.x,C.y),w]}return this.style.queryRenderedFeatures(d,s,this.transform)}querySourceFeatures(x,s){return this.style.querySourceFeatures(x,s)}setStyle(x,s){return(s=o.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},s)).diff!==!1&&s.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&x?(this._diffStyle(x,s),this):(this._localIdeographFontFamily=s.localIdeographFontFamily,this._updateStyle(x,s))}setTransformRequest(x){return this._requestManager.setTransformRequest(x),this}_getUIString(x){const s=this._locale[x];if(s==null)throw new Error(`Missing UI string '${x}'`);return s}_updateStyle(x,s){var d,g;if(s.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",(()=>this._updateStyle(x,s)));const v=this.style&&s.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!x)),x?(this.style=new Qd(this,s||{}),this.style.setEventedParent(this,{style:this.style}),typeof x=="string"?this.style.loadURL(x,s,v):this.style.loadJSON(x,s,v),this):((g=(d=this.style)===null||d===void 0?void 0:d.projection)===null||g===void 0||g.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Qd(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(x,s){if(typeof x=="string"){const d=this._requestManager.transformRequest(x,"Style");o.j(d,new AbortController).then((g=>{this._updateDiff(g.data,s)})).catch((g=>{g&&this.fire(new o.k(g))}))}else typeof x=="object"&&this._updateDiff(x,s)}_updateDiff(x,s){try{this.style.setState(x,s)&&this._update(!0)}catch(d){o.w(`Unable to perform style diff: ${d.message||d.error||d}.  Rebuilding the style from scratch.`),this._updateStyle(x,s)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():o.w("There is no style added to the map.")}addSource(x,s){return this._lazyInitEmptyStyle(),this.style.addSource(x,s),this._update(!0)}isSourceLoaded(x){const s=this.style&&this.style.sourceCaches[x];if(s!==void 0)return s.loaded();this.fire(new o.k(new Error(`There is no source with ID '${x}'`)))}setTerrain(x){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),x){const s=this.style.sourceCaches[x.source];if(!s)throw new Error(`cannot load terrain, because there exists no source with ID: ${x.source}`);this.terrain===null&&s.reload();for(const d in this.style._layers){const g=this.style._layers[d];g.type==="hillshade"&&g.source===x.source&&o.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality."),g.type==="color-relief"&&g.source===x.source&&o.w("You are using the same source for a color-relief layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new er(this.painter,s,x),this.painter.renderToTexture=new au(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=d=>{var g;d.dataType==="style"?this.terrain.sourceCache.freeRtt():d.dataType==="source"&&d.tile&&(d.sourceId!==x.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),((g=d.source)===null||g===void 0?void 0:g.type)==="image"?this.terrain.sourceCache.freeRtt():this.terrain.sourceCache.freeRtt(d.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new o.l("terrain",{terrain:x})),this}getTerrain(){var x,s;return(s=(x=this.terrain)===null||x===void 0?void 0:x.options)!==null&&s!==void 0?s:null}areTilesLoaded(){const x=this.style&&this.style.sourceCaches;for(const s in x){const d=x[s]._tiles;for(const g in d){const v=d[g];if(v.state!=="loaded"&&v.state!=="errored")return!1}}return!0}removeSource(x){return this.style.removeSource(x),this._update(!0)}getSource(x){return this.style.getSource(x)}setSourceTileLodParams(x,s,d){if(d){const g=this.getSource(d);if(!g)throw new Error(`There is no source with ID "${d}", cannot set LOD parameters`);g.calculateTileZoom=dt(Math.max(1,x),Math.max(1,s))}else for(const g in this.style.sourceCaches)this.style.sourceCaches[g].getSource().calculateTileZoom=dt(Math.max(1,x),Math.max(1,s));return this._update(!0),this}refreshTiles(x,s){const d=this.style.sourceCaches[x];if(!d)throw new Error(`There is no source cache with ID "${x}", cannot refresh tile`);s===void 0?d.reload(!0):d.refreshTiles(s.map((g=>new o.a4(g.z,g.x,g.y))))}addImage(x,s,d={}){const{pixelRatio:g=1,sdf:v=!1,stretchX:w,stretchY:C,content:B,textFitWidth:O,textFitHeight:F}=d;if(this._lazyInitEmptyStyle(),!(s instanceof HTMLImageElement||o.b(s))){if(s.width===void 0||s.height===void 0)return this.fire(new o.k(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:U,height:K,data:W}=s,X=s;return this.style.addImage(x,{data:new o.R({width:U,height:K},new Uint8Array(W)),pixelRatio:g,stretchX:w,stretchY:C,content:B,textFitWidth:O,textFitHeight:F,sdf:v,version:0,userImage:X}),X.onAdd&&X.onAdd(this,x),this}}{const{width:U,height:K,data:W}=M.getImageData(s);this.style.addImage(x,{data:new o.R({width:U,height:K},W),pixelRatio:g,stretchX:w,stretchY:C,content:B,textFitWidth:O,textFitHeight:F,sdf:v,version:0})}}updateImage(x,s){const d=this.style.getImage(x);if(!d)return this.fire(new o.k(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const g=s instanceof HTMLImageElement||o.b(s)?M.getImageData(s):s,{width:v,height:w,data:C}=g;if(v===void 0||w===void 0)return this.fire(new o.k(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(v!==d.data.width||w!==d.data.height)return this.fire(new o.k(new Error("The width and height of the updated image must be that same as the previous version of the image")));const B=!(s instanceof HTMLImageElement||o.b(s));return d.data.replace(C,B),this.style.updateImage(x,d),this}getImage(x){return this.style.getImage(x)}hasImage(x){return x?!!this.style.getImage(x):(this.fire(new o.k(new Error("Missing required image id"))),!1)}removeImage(x){this.style.removeImage(x)}loadImage(x){return me.getImage(this._requestManager.transformRequest(x,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(x,s){return this._lazyInitEmptyStyle(),this.style.addLayer(x,s),this._update(!0)}moveLayer(x,s){return this.style.moveLayer(x,s),this._update(!0)}removeLayer(x){return this.style.removeLayer(x),this._update(!0)}getLayer(x){return this.style.getLayer(x)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(x,s,d){return this.style.setLayerZoomRange(x,s,d),this._update(!0)}setFilter(x,s,d={}){return this.style.setFilter(x,s,d),this._update(!0)}getFilter(x){return this.style.getFilter(x)}setPaintProperty(x,s,d,g={}){return this.style.setPaintProperty(x,s,d,g),this._update(!0)}getPaintProperty(x,s){return this.style.getPaintProperty(x,s)}setLayoutProperty(x,s,d,g={}){return this.style.setLayoutProperty(x,s,d,g),this._update(!0)}getLayoutProperty(x,s){return this.style.getLayoutProperty(x,s)}setGlyphs(x,s={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(x,s),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(x,s,d={}){return this._lazyInitEmptyStyle(),this.style.addSprite(x,s,d,(g=>{g||this._update(!0)})),this}removeSprite(x){return this._lazyInitEmptyStyle(),this.style.removeSprite(x),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(x,s={}){return this._lazyInitEmptyStyle(),this.style.setSprite(x,s,(d=>{d||this._update(!0)})),this}setLight(x,s={}){return this._lazyInitEmptyStyle(),this.style.setLight(x,s),this._update(!0)}getLight(){return this.style.getLight()}setSky(x,s={}){return this._lazyInitEmptyStyle(),this.style.setSky(x,s),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(x,s){return this.style.setFeatureState(x,s),this._update()}removeFeatureState(x,s){return this.style.removeFeatureState(x,s),this._update()}getFeatureState(x){return this.style.getFeatureState(x)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let x=0,s=0;return this._container&&(x=this._container.clientWidth||400,s=this._container.clientHeight||300),[x,s]}_setupContainer(){const x=this._container;x.classList.add("maplibregl-map");const s=this._canvasContainer=L.create("div","maplibregl-canvas-container",x);this._interactive&&s.classList.add("maplibregl-interactive"),this._canvas=L.create("canvas","maplibregl-canvas",s),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const d=this._containerDimensions(),g=this._getClampedPixelRatio(d[0],d[1]);this._resizeCanvas(d[0],d[1],g);const v=this._controlContainer=L.create("div","maplibregl-control-container",x),w=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((C=>{w[C]=L.create("div",`maplibregl-ctrl-${C} `,v)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(x,s,d){this._canvas.width=Math.floor(d*x),this._canvas.height=Math.floor(d*s),this._canvas.style.width=`${x}px`,this._canvas.style.height=`${s}px`}_setupPainter(){const x=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0});let s=null;this._canvas.addEventListener("webglcontextcreationerror",(g=>{s={requestedAttributes:x},g&&(s.statusMessage=g.statusMessage,s.type=g.type)}),{once:!0});let d=null;if(d=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,x):this._canvas.getContext("webgl2",x)||this._canvas.getContext("webgl",x),!d){const g="Failed to initialize WebGL";throw s?(s.message=g,new Error(JSON.stringify(s))):new Error(g)}this.painter=new sa(d,this.transform),G.testSupport(d)}migrateProjection(x,s){super.migrateProjection(x,s),this.painter.transform=x,this.fire(new o.l("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(x){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||x,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(x){return this._update(),this._renderTaskQueue.add(x)}_cancelRenderFrame(x){this._renderTaskQueue.remove(x)}_render(x){var s,d,g,v,w;const C=this._idleTriggered?this._fadeDuration:0,B=((s=this.style.projection)===null||s===void 0?void 0:s.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(x),this._removed)return;let O=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const K=this.transform.zoom,W=M.now();this.style.zoomHistory.update(K,W);const X=new o.F(K,{now:W,fadeDuration:C,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition(),globalState:this.style.getGlobalState()}),re=X.crossFadingFactor();re===1&&re===this._crossFadingFactor||(O=!0,this._crossFadingFactor=re),this.style.update(X)}const F=((d=this.style.projection)===null||d===void 0?void 0:d.transitionState)>0!==B;(g=this.style.projection)===null||g===void 0||g.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState((v=this.style.projection)===null||v===void 0?void 0:v.transitionState,(w=this.style.projection)===null||w===void 0?void 0:w.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||F)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,C,this._crossSourceCollisions,F),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:C,showPadding:this.showPadding}),this.fire(new o.l("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,o.cw.mark(o.cx.load),this.fire(new o.l("load"))),this.style&&(this.style.hasTransitions()||O)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const U=this._sourcesDirty||this._styleDirty||this._placementDirty;return U||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new o.l("idle")),!this._loaded||this._fullyLoaded||U||(this._fullyLoaded=!0,o.cw.mark(o.cx.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var x;this._hash&&this._hash.remove();for(const d of this._controls)d.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),me.removeThrottleControl(this._imageQueueHandle),(x=this._resizeObserver)===null||x===void 0||x.disconnect();const s=this.painter.context.gl.getExtension("WEBGL_lose_context");s?.loseContext&&s.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),L.remove(this._canvasContainer),L.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),o.cw.clearMetrics(),this._removed=!0,this.fire(new o.l("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,M.frame(this._frameRequest,(x=>{o.cw.frame(x),this._frameRequest=null;try{this._render(x)}catch(s){if(!o.cy(s)&&!(function(d){return d.message===Ku})(s))throw s}}),(()=>{})))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(x){this._showTileBoundaries!==x&&(this._showTileBoundaries=x,this._update())}get showPadding(){return!!this._showPadding}set showPadding(x){this._showPadding!==x&&(this._showPadding=x,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(x){this._showCollisionBoxes!==x&&(this._showCollisionBoxes=x,x?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(x){this._showOverdrawInspector!==x&&(this._showOverdrawInspector=x,this._update())}get repaint(){return!!this._repaint}set repaint(x){this._repaint!==x&&(this._repaint=x,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(x){this._vertices=x,this._update()}get version(){return Jh}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(x){return this._lazyInitEmptyStyle(),this.style.setProjection(x),this._update(!0)}},c.MapMouseEvent=Dr,c.MapTouchEvent=Zs,c.MapWheelEvent=Pn,c.Marker=Al,c.NavigationControl=class{constructor(x){this._updateZoomButtons=()=>{const s=this._map.getZoom(),d=s===this._map.getMaxZoom(),g=s===this._map.getMinZoom();this._zoomInButton.disabled=d,this._zoomOutButton.disabled=g,this._zoomInButton.setAttribute("aria-disabled",d.toString()),this._zoomOutButton.setAttribute("aria-disabled",g.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(s,d)=>{const g=this._map._getUIString(`NavigationControl.${d}`);s.title=g,s.setAttribute("aria-label",g)},this.options=o.e({},mo,x),this._container=L.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",(s=>s.preventDefault())),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",(s=>this._map.zoomIn({},{originalEvent:s}))),L.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",(s=>this._map.zoomOut({},{originalEvent:s}))),L.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",(s=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:s}):this._map.resetNorth({},{originalEvent:s})})),this._compassIcon=L.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(x){return this._map=x,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Ho(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){L.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(x,s){const d=L.create("button",x,this._container);return d.type="button",d.addEventListener("click",s),d}},c.Popup=class extends o.E{constructor(x){super(),this._updateOpacity=()=>{this.options.locationOccludedOpacity!==void 0&&(this._container.style.opacity=this._map.transform.isLocationOccluded(this.getLngLat())?`${this.options.locationOccludedOpacity}`:"")},this.remove=()=>(this._content&&L.remove(this._content),this._container&&(L.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new o.l("close"))),this),this._onMouseUp=s=>{this._update(s.point)},this._onMouseMove=s=>{this._update(s.point)},this._onDrag=s=>{this._update(s.point)},this._update=s=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=L.create("div","maplibregl-popup",this._map.getContainer()),this._tip=L.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const C of this.options.className.split(" "))this._container.classList.add(C);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=Li(this._lngLat,this._flatPos,this._map.transform,this._trackPointer),this._trackPointer&&!s)return;const d=this._flatPos=this._pos=this._trackPointer&&s?s:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&s?s:this._map.transform.locationToScreenPoint(this._lngLat));let g=this.options.anchor;const v=Qs(this.options.offset);if(!g){const C=this._container.offsetWidth,B=this._container.offsetHeight;let O;O=d.y+v.bottom.y<B?["top"]:d.y>this._map.transform.height-B?["bottom"]:[],d.x<C/2?O.push("left"):d.x>this._map.transform.width-C/2&&O.push("right"),g=O.length===0?"bottom":O.join("-")}let w=d.add(v[g]);this.options.subpixelPositioning||(w=w.round()),L.setTransform(this._container,`${go[g]} translate(${w.x}px,${w.y}px)`),Js(this._container,g,"popup"),this._updateOpacity()},this._onClose=()=>{this.remove()},this.options=o.e(Object.create(ed),x)}addTo(x){return this._map&&this.remove(),this._map=x,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new o.l("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(x){return this._lngLat=o.S.convert(x),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(x){return this.setDOMContent(document.createTextNode(x))}setHTML(x){const s=document.createDocumentFragment(),d=document.createElement("body");let g;for(d.innerHTML=x;g=d.firstChild,g;)s.appendChild(g);return this.setDOMContent(s)}getMaxWidth(){var x;return(x=this._container)===null||x===void 0?void 0:x.style.maxWidth}setMaxWidth(x){return this.options.maxWidth=x,this._update(),this}setDOMContent(x){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=L.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(x),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(x){return this._container&&this._container.classList.add(x),this}removeClassName(x){return this._container&&this._container.classList.remove(x),this}setOffset(x){return this.options.offset=x,this._update(),this}toggleClassName(x){if(this._container)return this._container.classList.toggle(x)}setSubpixelPositioning(x){this.options.subpixelPositioning=x}_createCloseButton(){this.options.closeButton&&(this._closeButton=L.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const x=this._container.querySelector(rc);x&&x.focus()}},c.RasterDEMTileSource=Ln,c.RasterTileSource=zi,c.ScaleControl=class{constructor(x){this._onMove=()=>{nh(this._map,this._container,this.options)},this.setUnit=s=>{this.options.unit=s,nh(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},Tl),x)}getDefaultPosition(){return"bottom-left"}onAdd(x){return this._map=x,this._container=L.create("div","maplibregl-ctrl maplibregl-ctrl-scale",x.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){L.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},c.ScrollZoomHandler=Ei,c.Style=Qd,c.TerrainControl=class{constructor(x){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=x}onAdd(x){return this._map=x,this._container=L.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=L.create("button","maplibregl-ctrl-terrain",this._container),L.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){L.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},c.TwoFingersTouchPitchHandler=la,c.TwoFingersTouchRotateHandler=Ls,c.TwoFingersTouchZoomHandler=hs,c.TwoFingersTouchZoomRotateHandler=Tf,c.VectorTileSource=Tn,c.VideoSource=ss,c.addSourceType=(x,s)=>o._(void 0,void 0,void 0,(function*(){if(Po(x))throw new Error(`A source type called "${x}" already exists.`);((d,g)=>{lo[d]=g})(x,s)})),c.clearPrewarmedResources=function(){const x=Ht;x&&(x.isPreloaded()&&x.numActive()===1?(x.release(Tt),Ht=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},c.createTileMesh=Nc,c.getMaxParallelImageRequests=function(){return o.a.MAX_PARALLEL_IMAGE_REQUESTS},c.getRTLTextPluginStatus=function(){return Gs().getRTLTextPluginStatus()},c.getVersion=function(){return ic},c.getWorkerCount=function(){return ze.workerCount},c.getWorkerUrl=function(){return o.a.WORKER_URL},c.importScriptInWorkers=function(x){return $t().broadcast("IS",x)},c.prewarm=function(){Pr().acquire(Tt)},c.setMaxParallelImageRequests=function(x){o.a.MAX_PARALLEL_IMAGE_REQUESTS=x},c.setRTLTextPlugin=function(x,s){return Gs().setRTLTextPlugin(x,s)},c.setWorkerCount=function(x){ze.workerCount=x},c.setWorkerUrl=function(x){o.a.WORKER_URL=x}}));var l=r;return l}))})(A2)),A2.exports}var tn=Wq();const qq=ZB(tn),rv=KB({__proto__:null,default:qq},[tn]),Kq="https://api.olamaps.io/tiles/vector/v1/styles/default-light-standard/style.json?key=0.4.0",Zq="https://api.olamaps.io/tiles/vector/v1/3dtiles/tileset.json",Xq=t=>`<svg width="108" height="18" viewBox="0 0 108 18" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M31.0629 8.9393L34.6986 15.7293H38.2743L31.0629 2.2793L23.8516 15.7293H27.4273L31.0629 8.9393Z" fill="${t}"/><path d="M19.2265 12.5798L19.2365 2.25977H16.0703V15.7298H22.163L23.851 12.5798H19.2265Z" fill="${t}"/><path d="M7.22135 1.7793C5.79466 1.77733 4.39943 2.19909 3.21222 2.99123C2.025 3.78337 1.09915 4.91029 0.551806 6.22939C0.00446369 7.5485 -0.139771 9.00051 0.137352 10.4017C0.414475 11.8029 1.1005 13.0903 2.10863 14.1011C3.11676 15.1118 4.40168 15.8004 5.80082 16.0798C7.19996 16.3592 8.65043 16.2168 9.96872 15.6707C11.287 15.1245 12.4139 14.1991 13.2067 13.0116C13.9995 11.824 14.4227 10.4277 14.4227 8.9993C14.4227 7.08617 13.6643 5.25125 12.3141 3.89753C10.9639 2.5438 9.13219 1.78195 7.22135 1.7793ZM7.22135 12.8893C6.45207 12.8933 5.69892 12.6685 5.05735 12.2435C4.41579 11.8184 3.91469 11.2123 3.61755 10.5019C3.32041 9.79141 3.24061 9.00864 3.38827 8.25274C3.53592 7.49684 3.90438 6.80184 4.44695 6.25581C4.98952 5.70978 5.68178 5.3373 6.43601 5.18558C7.19023 5.03385 7.97246 5.10971 8.68358 5.40354C9.3947 5.69737 10.0027 6.19594 10.4305 6.83607C10.8583 7.4762 11.0867 8.22908 11.0867 8.9993C11.0867 9.51015 10.9862 10.016 10.791 10.4879C10.5957 10.9599 10.3095 11.3887 9.94873 11.7499C9.58794 12.1112 9.15963 12.3977 8.68823 12.5932C8.21684 12.7887 7.71161 12.8893 7.20138 12.8893H7.22135Z" fill="${t}"/><path d="M55.5634 4.82953V4.33953L50.4296 15.7295H49.4308L44.3768 4.33953V4.82953L43.9773 15.7295H42.9785L43.438 2.26953H44.5766L49.7104 13.8095C49.8003 14.0495 49.9102 14.2895 49.9801 14.5095C50.0543 14.2675 50.1513 14.0332 50.2698 13.8095L55.3437 2.26953H56.4723L56.9318 15.7295H55.933L55.5634 4.82953Z" fill="${t}"/><path d="M60.3287 15.7495H59.25L65.2428 2.26953H66.5513L72.5441 15.7495H71.4254L69.6875 11.8395H62.0666L60.3287 15.7495ZM66.4614 4.54953C66.2216 3.96953 66.0019 3.41953 65.8621 3.01953C65.7322 3.41953 65.5125 4.01953 65.2928 4.54953L62.4462 10.9095H69.288L66.4614 4.54953Z" fill="${t}"/><path d="M79.1611 2.14062C82.6669 2.14062 84.4048 3.62063 84.4048 6.62063C84.4048 9.62063 82.6669 11.0706 79.211 11.0706H75.9949V15.5906H74.9961V2.14062H79.1611ZM79.1611 10.1406C82.0077 10.1406 83.436 8.97062 83.416 6.61062C83.396 4.25062 82.0077 3.06062 79.1411 3.06062H75.9949V10.1406H79.1611Z" fill="${t}"/><path d="M95.1406 3.9293C93.7557 3.25763 92.2346 2.91539 90.6959 2.9293C88.8481 2.9293 87.6995 4.0193 87.6995 5.2293C87.6995 6.8693 88.5984 7.3593 91.6248 8.3693C94.6511 9.3793 95.9995 10.3693 95.9995 12.3693C95.9995 14.9993 93.942 15.9293 91.6947 15.9293C89.6115 15.9429 87.5948 15.1964 86.0215 13.8293L86.5009 13.0693C87.9375 14.3316 89.7833 15.0282 91.6947 15.0293C93.902 15.0293 95.0007 14.1193 95.0007 12.4893C95.0007 10.8593 94.1617 10.2093 90.9356 9.1293C88.069 8.1793 86.7007 7.5993 86.7007 5.2793C86.7007 3.3993 88.2488 2.0293 90.6959 2.0293C92.3497 2.03153 93.9817 2.40754 95.4702 3.1293L95.1406 3.9293Z" fill="${t}"/></svg>`;async function Uy(t,e,r,i){return i._parse(t,e,r,i)}function Ni(t,e){if(!t)throw new Error(e||"loader assertion failed.")}const X1=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),tP=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);tP&&parseFloat(tP[1]);const rP=globalThis,iP=globalThis.process||{},Yq=globalThis.navigator||{};function YB(t){if(typeof window<"u"&&window.process?.type==="renderer"||typeof process<"u"&&process.versions?.electron)return!0;const e=typeof navigator<"u"&&navigator.userAgent;return!!(e&&e.indexOf("Electron")>=0)}function qd(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process?.browser)||YB()}function Jq(t){return qd()?YB()?"Electron":(Yq.userAgent||"").indexOf("Edge")>-1?"Edge":globalThis.chrome?"Chrome":globalThis.safari?"Safari":globalThis.mozInnerScreenX?"Firefox":"Unknown":"Node"}const JB="4.0.7";function Qq(t){try{const e=window[t],r="__storage_test__";return e.setItem(r,r),e.removeItem(r),e}catch{return null}}class eK{constructor(e,r,i="sessionStorage"){this.storage=Qq(i),this.id=e,this.config=r,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const r=JSON.stringify(this.config);this.storage.setItem(this.id,r)}}_loadConfiguration(){let e={};if(this.storage){const r=this.storage.getItem(this.id);e=r?JSON.parse(r):{}}return Object.assign(this.config,e),this}}function tK(t){let e;return t<10?e=`${t.toFixed(2)}ms`:t<100?e=`${t.toFixed(1)}ms`:t<1e3?e=`${t.toFixed(0)}ms`:e=`${(t/1e3).toFixed(2)}s`,e}function rK(t,e=8){const r=Math.max(e-t.length,0);return`${" ".repeat(r)}${t}`}var l1;(function(t){t[t.BLACK=30]="BLACK",t[t.RED=31]="RED",t[t.GREEN=32]="GREEN",t[t.YELLOW=33]="YELLOW",t[t.BLUE=34]="BLUE",t[t.MAGENTA=35]="MAGENTA",t[t.CYAN=36]="CYAN",t[t.WHITE=37]="WHITE",t[t.BRIGHT_BLACK=90]="BRIGHT_BLACK",t[t.BRIGHT_RED=91]="BRIGHT_RED",t[t.BRIGHT_GREEN=92]="BRIGHT_GREEN",t[t.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",t[t.BRIGHT_BLUE=94]="BRIGHT_BLUE",t[t.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",t[t.BRIGHT_CYAN=96]="BRIGHT_CYAN",t[t.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(l1||(l1={}));const iK=10;function nP(t){return typeof t!="string"?t:(t=t.toUpperCase(),l1[t]||l1.WHITE)}function nK(t,e,r){return!qd&&typeof t=="string"&&(e&&(t=`\x1B[${nP(e)}m${t}\x1B[39m`),r&&(t=`\x1B[${nP(r)+iK}m${t}\x1B[49m`)),t}function sK(t,e=["constructor"]){const r=Object.getPrototypeOf(t),i=Object.getOwnPropertyNames(r),n=t;for(const l of i){const c=n[l];typeof c=="function"&&(e.find(o=>l===o)||(n[l]=c.bind(t)))}}function LA(t,e){if(!t)throw new Error("Assertion failed")}function Em(){let t;if(qd()&&rP.performance)t=rP?.performance?.now?.();else if("hrtime"in iP){const e=iP?.hrtime?.();t=e[0]*1e3+e[1]/1e6}else t=Date.now();return t}const Am={debug:qd()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},oK={enabled:!0,level:0};function Tm(){}const sP={},oP={once:!0};class Ig{constructor({id:e}={id:""}){this.VERSION=JB,this._startTs=Em(),this._deltaTs=Em(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new eK(`__probe-${this.id}__`,oK),this.timeStamp(`${this.id} started`),sK(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((Em()-this._startTs).toPrecision(10))}getDelta(){return Number((Em()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(e=!0){return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,r){this._storage.setConfiguration({[e]:r})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,r){if(!e)throw new Error(r||"Assertion failed")}warn(e){return this._getLogFunction(0,e,Am.warn,arguments,oP)}error(e){return this._getLogFunction(0,e,Am.error,arguments)}deprecated(e,r){return this.warn(`\`${e}\` is deprecated and will be removed in a later version. Use \`${r}\` instead`)}removed(e,r){return this.error(`\`${e}\` has been removed. Use \`${r}\` instead`)}probe(e,r){return this._getLogFunction(e,r,Am.log,arguments,{time:!0,once:!0})}log(e,r){return this._getLogFunction(e,r,Am.debug,arguments)}info(e,r){return this._getLogFunction(e,r,console.info,arguments)}once(e,r){return this._getLogFunction(e,r,Am.debug||Am.info,arguments,oP)}table(e,r,i){return r?this._getLogFunction(e,r,console.table||Tm,i&&[i],{tag:lK(r)}):Tm}time(e,r){return this._getLogFunction(e,r,console.time?console.time:console.info)}timeEnd(e,r){return this._getLogFunction(e,r,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,r){return this._getLogFunction(e,r,console.timeStamp||Tm)}group(e,r,i={collapsed:!1}){const n=aP({logLevel:e,message:r,opts:i}),{collapsed:l}=i;return n.method=(l?console.groupCollapsed:console.group)||console.info,this._getLogFunction(n)}groupCollapsed(e,r,i={}){return this.group(e,r,Object.assign({},i,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||Tm)}withGroup(e,r,i){this.group(e,r)();try{i()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=QB(e)}_getLogFunction(e,r,i,n,l){if(this._shouldLog(e)){l=aP({logLevel:e,message:r,args:n,opts:l}),i=i||l.method,LA(i),l.total=this.getTotal(),l.delta=this.getDelta(),this._deltaTs=Em();const c=l.tag||l.message;if(l.once&&c)if(!sP[c])sP[c]=Em();else return Tm;return r=aK(this.id,l.message,l),i.bind(console,r,...l.args)}return Tm}}Ig.VERSION=JB;function QB(t){if(!t)return 0;let e;switch(typeof t){case"number":e=t;break;case"object":e=t.logLevel||t.priority||0;break;default:return 0}return LA(Number.isFinite(e)&&e>=0),e}function aP(t){const{logLevel:e,message:r}=t;t.logLevel=QB(e);const i=t.args?Array.from(t.args):[];for(;i.length&&i.shift()!==r;);switch(typeof e){case"string":case"function":r!==void 0&&i.unshift(r),t.message=e;break;case"object":Object.assign(t,e);break}typeof t.message=="function"&&(t.message=t.message());const n=typeof t.message;return LA(n==="string"||n==="object"),Object.assign(t,{args:i},t.opts)}function aK(t,e,r){if(typeof e=="string"){const i=r.time?rK(tK(r.total)):"";e=r.time?`${t}: ${i}  ${e}`:`${t}: ${e}`,e=nK(e,r.color,r.background)}return e}function lK(t){for(const e in t)for(const r in t[e])return r||"untitled";return"empty"}globalThis.probe={};const eL=new Ig({id:"@probe.gl/log"}),Mx="4.3.1",cK=Mx[0]>="0"&&Mx[0]<="9"?`v${Mx}`:"";function uK(){const t=new Ig({id:"loaders.gl"});return globalThis.loaders=globalThis.loaders||{},globalThis.loaders.log=t,globalThis.loaders.version=cK,globalThis.probe=globalThis.probe||{},globalThis.probe.loaders=t,t}const hK=uK();function dK(t,e){return tL(t||{},e)}function tL(t,e,r=0){if(r>3)return e;const i={...t};for(const[n,l]of Object.entries(e))l&&typeof l=="object"&&!Array.isArray(l)?i[n]=tL(i[n]||{},e[n],r+1):i[n]=e[n];return i}function fK(t){globalThis.loaders||={},globalThis.loaders.modules||={},Object.assign(globalThis.loaders.modules,t)}function pK(t){return globalThis.loaders?.modules?.[t]||null}const mK="latest";function gK(){return globalThis._loadersgl_?.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.3.1"),globalThis._loadersgl_.version}const rL=gK();function Ih(t,e){if(!t)throw new Error(e||"loaders.gl assertion failed.")}const jl=typeof process!="object"||String(process)!=="[object process]"||process.browser,OA=typeof importScripts=="function",_K=typeof window<"u"&&typeof window.orientation<"u",lP=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);lP&&parseFloat(lP[1]);class yK{name;workerThread;isRunning=!0;result;_resolve=()=>{};_reject=()=>{};constructor(e,r){this.name=e,this.workerThread=r,this.result=new Promise((i,n)=>{this._resolve=i,this._reject=n})}postMessage(e,r){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:r})}done(e){Ih(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){Ih(this.isRunning),this.isRunning=!1,this._reject(e)}}class Ix{terminate(){}}const kx=new Map;function vK(t){Ih(t.source&&!t.url||!t.source&&t.url);let e=kx.get(t.source||t.url);return e||(t.url&&(e=bK(t.url),kx.set(t.url,e)),t.source&&(e=iL(t.source),kx.set(t.source,e))),Ih(e),e}function bK(t){if(!t.startsWith("http"))return t;const e=xK(t);return iL(e)}function iL(t){const e=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(e)}function xK(t){return`try {
  importScripts('${t}');
} catch (error) {
  console.error(error);
  throw error;
}`}function nL(t,e=!0,r){const i=r||new Set;if(t){if(cP(t))i.add(t);else if(cP(t.buffer))i.add(t.buffer);else if(!ArrayBuffer.isView(t)&&e&&typeof t=="object")for(const n in t)nL(t[n],e,i)}return r===void 0?Array.from(i):[]}function cP(t){return t?t instanceof ArrayBuffer||typeof MessagePort<"u"&&t instanceof MessagePort||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas:!1}const Bx=()=>{};class T2{name;source;url;terminated=!1;worker;onMessage;onError;_loadableURL="";static isSupported(){return typeof Worker<"u"&&jl||typeof Ix<"u"&&!jl}constructor(e){const{name:r,source:i,url:n}=e;Ih(i||n),this.name=r,this.source=i,this.url=n,this.onMessage=Bx,this.onError=l=>console.log(l),this.worker=jl?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=Bx,this.onError=Bx,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(e,r){r=r||nL(e),this.worker.postMessage(e,r)}_getErrorFromErrorEvent(e){let r="Failed to load ";return r+=`worker ${this.name} from ${this.url}. `,e.message&&(r+=`${e.message} in `),e.lineno&&(r+=`:${e.lineno}:${e.colno}`),new Error(r)}_createBrowserWorker(){this._loadableURL=vK({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=r=>{r.data?this.onMessage(r.data):this.onError(new Error("No data received"))},e.onerror=r=>{this.onError(this._getErrorFromErrorEvent(r)),this.terminated=!0},e.onmessageerror=r=>console.error(r),e}_createNodeWorker(){let e;if(this.url){const r=this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`;e=new Ix(r,{eval:!1})}else if(this.source)e=new Ix(this.source,{eval:!0});else throw new Error("no worker");return e.on("message",r=>{this.onMessage(r)}),e.on("error",r=>{this.onError(r)}),e.on("exit",r=>{}),e}}class wK{name="unnamed";source;url;maxConcurrency=1;maxMobileConcurrency=1;onDebug=()=>{};reuseWorkers=!0;props={};jobQueue=[];idleQueue=[];count=0;isDestroyed=!1;static isSupported(){return T2.isSupported()}constructor(e){this.source=e.source,this.url=e.url,this.setProps(e)}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}async startJob(e,r=(n,l,c)=>n.done(c),i=(n,l)=>n.error(l)){const n=new Promise(l=>(this.jobQueue.push({name:e,onMessage:r,onError:i,onStart:l}),this));return this._startQueuedJob(),await n}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const r=this.jobQueue.shift();if(r){this.onDebug({message:"Starting job",name:r.name,workerThread:e,backlog:this.jobQueue.length});const i=new yK(r.name,e);e.onMessage=n=>r.onMessage(i,n.type,n.payload),e.onError=n=>r.onError(i,n),r.onStart(i);try{await i.result}catch(n){console.error(`Worker exception: ${n}`)}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){!jl||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new T2({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return _K?this.maxMobileConcurrency:this.maxConcurrency}}const EK={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}};class Rd{props;workerPools=new Map;static _workerFarm;static isSupported(){return T2.isSupported()}static getWorkerFarm(e={}){return Rd._workerFarm=Rd._workerFarm||new Rd({}),Rd._workerFarm.setProps(e),Rd._workerFarm}constructor(e){this.props={...EK},this.setProps(e),this.workerPools=new Map}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const r of this.workerPools.values())r.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:r,source:i,url:n}=e;let l=this.workerPools.get(r);return l||(l=new wK({name:r,source:i,url:n}),l.setProps(this._getWorkerPoolProps()),this.workerPools.set(r,l)),l}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}function AK(t,e={}){const r=e[t.id]||{},i=jl?`${t.id}-worker.js`:`${t.id}-worker-node.js`;let n=r.workerUrl;if(!n&&t.id==="compression"&&(n=e.workerUrl),e._workerType==="test"&&(jl?n=`modules/${t.module}/dist/${i}`:n=`modules/${t.module}/src/workers/${t.id}-worker-node.ts`),!n){let l=t.version;l==="latest"&&(l=mK);const c=l?`@${l}`:"";n=`https://unpkg.com/@loaders.gl/${t.module}${c}/dist/${i}`}return Ih(n),n}function TK(t,e=rL){Ih(t,"no worker provided");const r=t.version;return!(!e||!r)}const Lx={};async function Tp(t,e=null,r={},i=null){return e&&(t=SK(t,e,r,i)),Lx[t]=Lx[t]||CK(t),await Lx[t]}function SK(t,e,r={},i=null){if(!r.useLocalLibraries&&t.startsWith("http"))return t;i=i||t;const n=r.modules||{};return n[i]?n[i]:jl?r.CDN?(Ih(r.CDN.startsWith("http")),`${r.CDN}/${e}@${rL}/dist/libs/${i}`):OA?`../src/libs/${i}`:`modules/${e}/src/libs/${i}`:`modules/${e}/dist/libs/${i}`}async function CK(t){if(t.endsWith("wasm"))return await RK(t);if(!jl)try{const{requireFromFile:r}=globalThis.loaders||{};return await r?.(t)}catch(r){return console.error(r),null}if(OA)return importScripts(t);const e=await MK(t);return PK(e,t)}function PK(t,e){if(!jl){const{requireFromString:i}=globalThis.loaders||{};return i?.(t,e)}if(OA)return eval.call(globalThis,t),null;const r=document.createElement("script");r.id=e;try{r.appendChild(document.createTextNode(t))}catch{r.text=t}return document.body.appendChild(r),null}async function RK(t){const{readFileAsArrayBuffer:e}=globalThis.loaders||{};return jl||!e||t.startsWith("http")?await(await fetch(t)).arrayBuffer():await e(t)}async function MK(t){const{readFileAsText:e}=globalThis.loaders||{};return jl||!e||t.startsWith("http")?await(await fetch(t)).text():await e(t)}function IK(t,e){return!Rd.isSupported()||!jl&&!e?._nodeWorkers?!1:t.worker&&e?.worker}async function kK(t,e,r,i,n){const l=t.id,c=AK(t,r),o=Rd.getWorkerFarm(r).getWorkerPool({name:l,url:c});r=JSON.parse(JSON.stringify(r)),i=JSON.parse(JSON.stringify(i||{}));const m=await o.startJob("process-on-worker",BK.bind(null,n));return m.postMessage("process",{input:e,options:r,context:i}),await(await m.result).result}async function BK(t,e,r,i){switch(r){case"done":e.done(i);break;case"error":e.error(new Error(i.error));break;case"process":const{id:n,input:l,options:c}=i;try{const o=await t(l,c);e.postMessage("done",{id:n,result:o})}catch(o){const m=o instanceof Error?o.message:"unknown error";e.postMessage("error",{id:n,error:m})}break;default:console.warn(`parse-with-worker unknown message ${r}`)}}function LK(t,e=5){return typeof t=="string"?t.slice(0,e):ArrayBuffer.isView(t)?uP(t.buffer,t.byteOffset,e):t instanceof ArrayBuffer?uP(t,0,e):""}function uP(t,e,r){if(t.byteLength<=e+r)return"";const i=new DataView(t);let n="";for(let l=0;l<r;l++)n+=String.fromCharCode(i.getUint8(e+l));return n}function OK(t){try{return JSON.parse(t)}catch{throw new Error(`Failed to parse JSON from data starting with "${LK(t)}"`)}}function DK(t,e,r){if(r=r||t.byteLength,t.byteLength<r||e.byteLength<r)return!1;const i=new Uint8Array(t),n=new Uint8Array(e);for(let l=0;l<i.length;++l)if(i[l]!==n[l])return!1;return!0}function NK(...t){return FK(t)}function FK(t){const e=t.map(l=>l instanceof ArrayBuffer?new Uint8Array(l):l),r=e.reduce((l,c)=>l+c.byteLength,0),i=new Uint8Array(r);let n=0;for(const l of e)i.set(l,n),n+=l.byteLength;return i.buffer}function DA(t,e,r){const i=r!==void 0?new Uint8Array(t).subarray(e,e+r):new Uint8Array(t).subarray(e);return new Uint8Array(i).buffer}function Vy(t,e){return Ni(t>=0),Ni(e>0),t+(e-1)&-4}function zK(t,e,r){let i;if(t instanceof ArrayBuffer)i=new Uint8Array(t);else{const n=t.byteOffset,l=t.byteLength;i=new Uint8Array(t.buffer||t.arrayBuffer,n,l)}return e.set(i,r),r+Vy(i.byteLength,4)}async function jK(t){const e=[];for await(const r of t)e.push(r);return NK(...e)}function hP(){let t;if(typeof window<"u"&&window.performance)t=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();t=e[0]*1e3+e[1]/1e6}else t=Date.now();return t}class dP{constructor(e,r){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=r,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=hP(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(hP()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class kg{constructor(e){this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e,r="count"){return this._getOrCreate({name:e,type:r})}get size(){return Object.keys(this.stats).length}reset(){for(const e of Object.values(this.stats))e.reset();return this}forEach(e){for(const r of Object.values(this.stats))e(r)}getTable(){const e={};return this.forEach(r=>{e[r.name]={time:r.time||0,count:r.count||0,average:r.getAverageTime()||0,hz:r.getHz()||0}}),e}_initializeStats(e=[]){e.forEach(r=>this._getOrCreate(r))}_getOrCreate(e){const{name:r,type:i}=e;let n=this.stats[r];return n||(e instanceof dP?n=e:n=new dP(r,i),this.stats[r]=n),n}}const UK="Queued Requests",VK="Active Requests",GK="Cancelled Requests",HK="Queued Requests Ever",$K="Active Requests Ever",WK={id:"request-scheduler",throttleRequests:!0,maxRequests:6,debounceTime:0};class qK{props;stats;activeRequestCount=0;requestQueue=[];requestMap=new Map;updateTimer=null;constructor(e={}){this.props={...WK,...e},this.stats=new kg({id:this.props.id}),this.stats.get(UK),this.stats.get(VK),this.stats.get(GK),this.stats.get(HK),this.stats.get($K)}scheduleRequest(e,r=()=>0){if(!this.props.throttleRequests)return Promise.resolve({done:()=>{}});if(this.requestMap.has(e))return this.requestMap.get(e);const i={handle:e,priority:0,getPriority:r},n=new Promise(l=>(i.resolve=l,i));return this.requestQueue.push(i),this.requestMap.set(e,n),this._issueNewRequests(),n}_issueRequest(e){const{handle:r,resolve:i}=e;let n=!1;const l=()=>{n||(n=!0,this.requestMap.delete(r),this.activeRequestCount--,this._issueNewRequests())};return this.activeRequestCount++,i?i({done:l}):Promise.resolve({done:l})}_issueNewRequests(){this.updateTimer!==null&&clearTimeout(this.updateTimer),this.updateTimer=setTimeout(()=>this._issueNewRequestsAsync(),this.props.debounceTime)}_issueNewRequestsAsync(){this.updateTimer!==null&&clearTimeout(this.updateTimer),this.updateTimer=null;const e=Math.max(this.props.maxRequests-this.activeRequestCount,0);if(e!==0){this._updateAllRequests();for(let r=0;r<e;++r){const i=this.requestQueue.shift();i&&this._issueRequest(i)}}}_updateAllRequests(){const e=this.requestQueue;for(let r=0;r<e.length;++r){const i=e[r];this._updateRequest(i)||(e.splice(r,1),this.requestMap.delete(i.handle),r--)}e.sort((r,i)=>r.priority-i.priority)}_updateRequest(e){return e.priority=e.getPriority(e.handle),e.priority<0?(e.resolve(null),!1):!0}}let KK="";const fP={};function ZK(t){for(const e in fP)if(t.startsWith(e)){const r=fP[e];t=t.replace(e,r)}return!t.startsWith("http://")&&!t.startsWith("https://")&&(t=`${KK}${t}`),t}function XK(t){return t&&typeof t=="object"&&t.isBuffer}function sL(t){if(XK(t)||t instanceof ArrayBuffer)return t;if(ArrayBuffer.isView(t))return t.byteOffset===0&&t.byteLength===t.buffer.byteLength?t.buffer:t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength);if(typeof t=="string"){const e=t;return new TextEncoder().encode(e).buffer}if(t&&typeof t=="object"&&t._toArrayBuffer)return t._toArrayBuffer();throw new Error("toArrayBuffer")}function YK(){if(typeof process<"u"&&typeof process.cwd<"u")return process.cwd();const t=window.location?.pathname;return t?.slice(0,t.lastIndexOf("/")+1)||""}function oL(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(e+1):""}function NA(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(0,e):""}function JK(...t){const e=[];for(let l=0;l<t.length;l++)e[l]=t[l];let r="",i=!1,n;for(let l=e.length-1;l>=-1&&!i;l--){let c;l>=0?c=e[l]:(n===void 0&&(n=YK()),c=n),c.length!==0&&(r=`${c}/${r}`,i=c.charCodeAt(0)===G_)}return r=QK(r,!i),i?`/${r}`:r.length>0?r:"."}const G_=47,Ox=46;function QK(t,e){let r="",i=-1,n=0,l,c=!1;for(let o=0;o<=t.length;++o){if(o<t.length)l=t.charCodeAt(o);else{if(l===G_)break;l=G_}if(l===G_){if(!(i===o-1||n===1))if(i!==o-1&&n===2){if(r.length<2||!c||r.charCodeAt(r.length-1)!==Ox||r.charCodeAt(r.length-2)!==Ox){if(r.length>2){const m=r.length-1;let b=m;for(;b>=0&&r.charCodeAt(b)!==G_;--b);if(b!==m){r=b===-1?"":r.slice(0,b),i=o,n=0,c=!1;continue}}else if(r.length===2||r.length===1){r="",i=o,n=0,c=!1;continue}}e&&(r.length>0?r+="/..":r="..",c=!0)}else{const m=t.slice(i+1,o);r.length>0?r+=`/${m}`:r=m,c=!1}i=o,n=0}else l===Ox&&n!==-1?++n:n=-1}return r}const eZ=t=>typeof t=="boolean",iy=t=>typeof t=="function",Gy=t=>t!==null&&typeof t=="object",pP=t=>Gy(t)&&t.constructor==={}.constructor,tZ=t=>!!t&&typeof t[Symbol.iterator]=="function",rZ=t=>t&&typeof t[Symbol.asyncIterator]=="function",Bp=t=>typeof Response<"u"&&t instanceof Response||t&&t.arrayBuffer&&t.text&&t.json,Lp=t=>typeof Blob<"u"&&t instanceof Blob,iZ=t=>t&&typeof t=="object"&&t.isBuffer,nZ=t=>typeof ReadableStream<"u"&&t instanceof ReadableStream||Gy(t)&&iy(t.tee)&&iy(t.cancel)&&iy(t.getReader),sZ=t=>Gy(t)&&iy(t.read)&&iy(t.pipe)&&eZ(t.readable),aL=t=>nZ(t)||sZ(t);class oZ extends Error{constructor(e,r){super(e),this.reason=r.reason,this.url=r.url,this.response=r.response}reason;url;response}const aZ=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,lZ=/^([-\w.]+\/[-\w.+]+)/;function mP(t,e){return t.toLowerCase()===e.toLowerCase()}function cZ(t){const e=lZ.exec(t);return e?e[1]:t}function gP(t){const e=aZ.exec(t);return e?e[1]:""}const lL=/\?.*/;function uZ(t){const e=t.match(lL);return e&&e[0]}function FA(t){return t.replace(lL,"")}function hZ(t){if(t.length<50)return t;const e=t.slice(t.length-15);return`${t.substr(0,32)}...${e}`}function Y1(t){return Bp(t)?t.url:Lp(t)?t.name||"":typeof t=="string"?t:""}function zA(t){if(Bp(t)){const e=t,r=e.headers.get("content-type")||"",i=FA(e.url);return cZ(r)||gP(i)}return Lp(t)?t.type||"":typeof t=="string"?gP(t):""}function dZ(t){return Bp(t)?t.headers["content-length"]||-1:Lp(t)?t.size:typeof t=="string"?t.length:t instanceof ArrayBuffer||ArrayBuffer.isView(t)?t.byteLength:-1}async function cL(t){if(Bp(t))return t;const e={},r=dZ(t);r>=0&&(e["content-length"]=String(r));const i=Y1(t),n=zA(t);n&&(e["content-type"]=n);const l=await mZ(t);l&&(e["x-first-bytes"]=l),typeof t=="string"&&(t=new TextEncoder().encode(t));const c=new Response(t,{headers:e});return Object.defineProperty(c,"url",{value:i}),c}async function fZ(t){if(!t.ok)throw await pZ(t)}async function pZ(t){const e=hZ(t.url);let r=`Failed to fetch resource (${t.status}) ${t.statusText}: ${e}`;r=r.length>100?`${r.slice(0,100)}...`:r;const i={reason:t.statusText,url:t.url,response:t};try{const n=t.headers.get("Content-Type");i.reason=!t.bodyUsed&&n?.includes("application/json")?await t.json():await t.text()}catch{}return new oZ(r,i)}async function mZ(t){if(typeof t=="string")return`data:,${t.slice(0,5)}`;if(t instanceof Blob){const e=t.slice(0,5);return await new Promise(r=>{const i=new FileReader;i.onload=n=>r(n?.target?.result),i.readAsDataURL(e)})}if(t instanceof ArrayBuffer){const e=t.slice(0,5);return`data:base64,${gZ(e)}`}return null}function gZ(t){let e="";const r=new Uint8Array(t);for(let i=0;i<r.byteLength;i++)e+=String.fromCharCode(r[i]);return btoa(e)}function _Z(t){return!yZ(t)&&!vZ(t)}function yZ(t){return t.startsWith("http:")||t.startsWith("https:")}function vZ(t){return t.startsWith("data:")}async function _P(t,e){if(typeof t=="string"){const r=ZK(t);return _Z(r)&&globalThis.loaders?.fetchNode?globalThis.loaders?.fetchNode(r,e):await fetch(r,e)}return await cL(t)}const yP=new Ig({id:"loaders.gl"});class bZ{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class xZ{console;constructor(){this.console=console}log(...e){return this.console.log.bind(this.console,...e)}info(...e){return this.console.info.bind(this.console,...e)}warn(...e){return this.console.warn.bind(this.console,...e)}error(...e){return this.console.error.bind(this.console,...e)}}const uL={fetch:null,mimeType:void 0,nothrow:!1,log:new xZ,useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:X1,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},wZ={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function hL(){globalThis.loaders=globalThis.loaders||{};const{loaders:t}=globalThis;return t._state||(t._state={}),t._state}function dL(){const t=hL();return t.globalOptions=t.globalOptions||{...uL},t.globalOptions}function EZ(t,e,r,i){return r=r||[],r=Array.isArray(r)?r:[r],AZ(t,r),SZ(e,t,i)}function AZ(t,e){vP(t,null,uL,wZ,e);for(const r of e){const i=t&&t[r.id]||{},n=r.options&&r.options[r.id]||{},l=r.deprecatedOptions&&r.deprecatedOptions[r.id]||{};vP(i,r.id,n,l,e)}}function vP(t,e,r,i,n){const l=e||"Top level",c=e?`${e}.`:"";for(const o in t){const m=!e&&Gy(t[o]),b=o==="baseUri"&&!e,A=o==="workerUrl"&&e;if(!(o in r)&&!b&&!A){if(o in i)yP.warn(`${l} loader option '${c}${o}' no longer supported, use '${i[o]}'`)();else if(!m){const R=TZ(o,n);yP.warn(`${l} loader option '${c}${o}' not recognized. ${R}`)()}}}}function TZ(t,e){const r=t.toLowerCase();let i="";for(const n of e)for(const l in n.options){if(t===l)return`Did you mean '${n.id}.${l}'?`;const c=l.toLowerCase();(r.startsWith(c)||c.startsWith(r))&&(i=i||`Did you mean '${n.id}.${l}'?`)}return i}function SZ(t,e,r){const i={...t.options||{}};return CZ(i,r),i.log===null&&(i.log=new bZ),bP(i,dL()),bP(i,e),i}function bP(t,e){for(const r in e)if(r in e){const i=e[r];pP(i)&&pP(t[r])?t[r]={...t[r],...e[r]}:t[r]=e[r]}}function CZ(t,e){e&&!("baseUri"in t)&&(t.baseUri=e)}function jA(t){return t?(Array.isArray(t)&&(t=t[0]),Array.isArray(t?.extensions)):!1}function UA(t){Ni(t,"null loader"),Ni(jA(t),"invalid loader");let e;return Array.isArray(t)&&(e=t[1],t=t[0],t={...t,options:{...t.options,...e}}),(t?.parseTextSync||t?.parseText)&&(t.text=!0),t.text||(t.binary=!0),t}const fL=()=>{const t=hL();return t.loaderRegistry=t.loaderRegistry||[],t.loaderRegistry};function PZ(t){const e=fL();t=Array.isArray(t)?t:[t];for(const r of t){const i=UA(r);e.find(n=>i===n)||e.unshift(i)}}function RZ(){return fL()}const MZ=/\.([^.]+)$/;async function IZ(t,e=[],r,i){if(!pL(t))return null;let n=xP(t,e,{...r,nothrow:!0},i);if(n)return n;if(Lp(t)&&(t=await t.slice(0,10).arrayBuffer(),n=xP(t,e,r,i)),!n&&!r?.nothrow)throw new Error(mL(t));return n}function xP(t,e=[],r,i){if(!pL(t))return null;if(e&&!Array.isArray(e))return UA(e);let n=[];e&&(n=n.concat(e)),r?.ignoreRegisteredLoaders||n.push(...RZ()),BZ(n);const l=kZ(t,n,r,i);if(!l&&!r?.nothrow)throw new Error(mL(t));return l}function kZ(t,e,r,i){const n=Y1(t),l=zA(t),c=FA(n)||i?.url;let o=null,m="";return r?.mimeType&&(o=Dx(e,r?.mimeType),m=`match forced by supplied MIME type ${r?.mimeType}`),o=o||LZ(e,c),m=m||(o?`matched url ${c}`:""),o=o||Dx(e,l),m=m||(o?`matched MIME type ${l}`:""),o=o||DZ(e,t),m=m||(o?`matched initial data ${gL(t)}`:""),r?.fallbackMimeType&&(o=o||Dx(e,r?.fallbackMimeType),m=m||(o?`matched fallback MIME type ${l}`:"")),m&&hK.log(1,`selectLoader selected ${o?.name}: ${m}.`),o}function pL(t){return!(t instanceof Response&&t.status===204)}function mL(t){const e=Y1(t),r=zA(t);let i="No valid loader found (";i+=e?`${oL(e)}, `:"no url provided, ",i+=`MIME type: ${r?`"${r}"`:"not provided"}, `;const n=t?gL(t):"";return i+=n?` first bytes: "${n}"`:"first bytes: not available",i+=")",i}function BZ(t){for(const e of t)UA(e)}function LZ(t,e){const r=e&&MZ.exec(e),i=r&&r[1];return i?OZ(t,i):null}function OZ(t,e){e=e.toLowerCase();for(const r of t)for(const i of r.extensions)if(i.toLowerCase()===e)return r;return null}function Dx(t,e){for(const r of t)if(r.mimeTypes?.some(i=>mP(e,i))||mP(e,`application/x.${r.id}`))return r;return null}function DZ(t,e){if(!e)return null;for(const r of t)if(typeof e=="string"){if(NZ(e,r))return r}else if(ArrayBuffer.isView(e)){if(wP(e.buffer,e.byteOffset,r))return r}else if(e instanceof ArrayBuffer&&wP(e,0,r))return r;return null}function NZ(t,e){return e.testText?e.testText(t):(Array.isArray(e.tests)?e.tests:[e.tests]).some(r=>t.startsWith(r))}function wP(t,e,r){return(Array.isArray(r.tests)?r.tests:[r.tests]).some(i=>FZ(t,e,r,i))}function FZ(t,e,r,i){if(i instanceof ArrayBuffer)return DK(i,t,i.byteLength);switch(typeof i){case"function":return i(t);case"string":const n=S2(t,e,i.length);return i===n;default:return!1}}function gL(t,e=5){return typeof t=="string"?t.slice(0,e):ArrayBuffer.isView(t)?S2(t.buffer,t.byteOffset,e):t instanceof ArrayBuffer?S2(t,0,e):""}function S2(t,e,r){if(t.byteLength<e+r)return"";const i=new DataView(t);let n="";for(let l=0;l<r;l++)n+=String.fromCharCode(i.getUint8(e+l));return n}const zZ=256*1024;function*jZ(t,e){const r=e?.chunkSize||zZ;let i=0;const n=new TextEncoder;for(;i<t.length;){const l=Math.min(t.length-i,r),c=t.slice(i,i+l);i+=l,yield n.encode(c)}}const UZ=256*1024;function*VZ(t,e={}){const{chunkSize:r=UZ}=e;let i=0;for(;i<t.byteLength;){const n=Math.min(t.byteLength-i,r),l=new ArrayBuffer(n),c=new Uint8Array(t,i,n);new Uint8Array(l).set(c),i+=n,yield l}}const GZ=1024*1024;async function*HZ(t,e){const r=e?.chunkSize||GZ;let i=0;for(;i<t.size;){const n=i+r,l=await t.slice(i,n).arrayBuffer();i=n,yield l}}function EP(t,e){return X1?$Z(t,e):WZ(t)}async function*$Z(t,e){const r=t.getReader();let i;try{for(;;){const n=i||r.read();e?._streamReadAhead&&(i=r.read());const{done:l,value:c}=await n;if(l)return;yield sL(c)}}catch{r.releaseLock()}}async function*WZ(t,e){for await(const r of t)yield sL(r)}function qZ(t,e){if(typeof t=="string")return jZ(t,e);if(t instanceof ArrayBuffer)return VZ(t,e);if(Lp(t))return HZ(t,e);if(aL(t))return EP(t,e);if(Bp(t))return EP(t.body,e);throw new Error("makeIterator")}const _L="Cannot convert supplied data type";function KZ(t,e,r){if(e.text&&typeof t=="string")return t;if(iZ(t)&&(t=t.buffer),t instanceof ArrayBuffer){const i=t;return e.text&&!e.binary?new TextDecoder("utf8").decode(i):i}if(ArrayBuffer.isView(t)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(t);let i=t.buffer;const n=t.byteLength||t.length;return(t.byteOffset!==0||n!==i.byteLength)&&(i=i.slice(t.byteOffset,t.byteOffset+n)),i}throw new Error(_L)}async function ZZ(t,e,r){const i=t instanceof ArrayBuffer||ArrayBuffer.isView(t);if(typeof t=="string"||i)return KZ(t,e);if(Lp(t)&&(t=await cL(t)),Bp(t)){const n=t;return await fZ(n),e.binary?await n.arrayBuffer():await n.text()}if(aL(t)&&(t=qZ(t,r)),tZ(t)||rZ(t))return jK(t);throw new Error(_L)}function yL(t,e){const r=dL(),i=t||r;return typeof i.fetch=="function"?i.fetch:Gy(i.fetch)?n=>_P(n,i.fetch):e?.fetch?e?.fetch:_P}function XZ(t,e,r){if(r)return r;const i={fetch:yL(e,t),...t};if(i.url){const n=FA(i.url);i.baseUrl=n,i.queryString=uZ(i.url),i.filename=oL(n),i.baseUrl=NA(n)}return Array.isArray(i.loaders)||(i.loaders=null),i}function YZ(t,e){if(t&&!Array.isArray(t))return t;let r;if(t&&(r=Array.isArray(t)?t:[t]),e&&e.loaders){const i=Array.isArray(e.loaders)?e.loaders:[e.loaders];r=r?[...r,...i]:i}return r&&r.length?r:void 0}async function c1(t,e,r,i){e&&!Array.isArray(e)&&!jA(e)&&(i=void 0,r=e,e=void 0),t=await t,r=r||{};const n=Y1(t),l=YZ(e,i),c=await IZ(t,l,r);return c?(r=EZ(r,c,l,n),i=XZ({url:n,_parse:c1,loaders:l},r,i||null),await JZ(c,t,r,i)):null}async function JZ(t,e,r,i){if(TK(t),r=dK(t.options,r),Bp(e)){const l=e,{ok:c,redirected:o,status:m,statusText:b,type:A,url:R}=l,M=Object.fromEntries(l.headers.entries());i.response={headers:M,ok:c,redirected:o,status:m,statusText:b,type:A,url:R}}e=await ZZ(e,t,r);const n=t;if(n.parseTextSync&&typeof e=="string")return n.parseTextSync(e,r,i);if(IK(t,r))return await kK(t,e,r,i,c1);if(n.parseText&&typeof e=="string")return await n.parseText(e,r,i);if(n.parse)return await n.parse(e,r,i);throw Ih(!n.parseSync),new Error(`${t.id} loader - no parser found and worker is disabled`)}function QZ(t){switch(t.constructor){case Int8Array:return"int8";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int16Array:return"int16";case Uint16Array:return"uint16";case Int32Array:return"int32";case Uint32Array:return"uint32";case Float32Array:return"float32";case Float64Array:return"float64";default:return"null"}}function vL(t){let e=1/0,r=1/0,i=1/0,n=-1/0,l=-1/0,c=-1/0;const o=t.POSITION?t.POSITION.value:[],m=o&&o.length;for(let b=0;b<m;b+=3){const A=o[b],R=o[b+1],M=o[b+2];e=A<e?A:e,r=R<r?R:r,i=M<i?M:i,n=A>n?A:n,l=R>l?R:l,c=M>c?M:c}return[[e,r,i],[n,l,c]]}function eX(t,e,r){const i=QZ(e.value),n=r||tX(e);return{name:t,type:{type:"fixed-size-list",listSize:e.size,children:[{name:"value",type:i}]},nullable:!1,metadata:n}}function tX(t){const e={};return"byteOffset"in t&&(e.byteOffset=t.byteOffset.toString(10)),"byteStride"in t&&(e.byteStride=t.byteStride.toString(10)),"normalized"in t&&(e.normalized=t.normalized.toString()),e}async function Fd(t,e,r,i){let n,l;!Array.isArray(e)&&!jA(e)?(n=[],l=e):(n=e,l=r);const c=yL(l);let o=t;return typeof t=="string"&&(o=await c(t)),Lp(t)&&(o=await c(t)),Array.isArray(n)?await c1(o,n,l):await c1(o,n,l)}const rX="4.3.1",iX=globalThis.loaders?.parseImageNode,C2=typeof Image<"u",P2=typeof ImageBitmap<"u",nX=!!iX,R2=X1?!0:nX;function sX(t){switch(t){case"auto":return P2||C2||R2;case"imagebitmap":return P2;case"image":return C2;case"data":return R2;default:throw new Error(`@loaders.gl/images: image ${t} not supported in this environment`)}}function oX(){if(P2)return"imagebitmap";if(C2)return"image";if(R2)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function aX(t){const e=lX(t);if(!e)throw new Error("Not an image");return e}function bL(t){switch(aX(t)){case"data":return t;case"image":case"imagebitmap":const e=document.createElement("canvas"),r=e.getContext("2d");if(!r)throw new Error("getImageData");return e.width=t.width,e.height=t.height,r.drawImage(t,0,0),r.getImageData(0,0,t.width,t.height);default:throw new Error("getImageData")}}function lX(t){return typeof ImageBitmap<"u"&&t instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&t instanceof Image?"image":t&&typeof t=="object"&&t.data&&t.width&&t.height?"data":null}const cX=/^data:image\/svg\+xml/,uX=/\.svg((\?|#).*)?$/;function VA(t){return t&&(cX.test(t)||uX.test(t))}function hX(t,e){if(VA(e)){let r=new TextDecoder().decode(t);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(r=unescape(encodeURIComponent(r)))}catch(i){throw new Error(i.message)}return`data:image/svg+xml;base64,${btoa(r)}`}return xL(t,e)}function xL(t,e){if(VA(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(t)])}async function wL(t,e,r){const i=hX(t,r),n=self.URL||self.webkitURL,l=typeof i!="string"&&n.createObjectURL(i);try{return await dX(l||i,e)}finally{l&&n.revokeObjectURL(l)}}async function dX(t,e){const r=new Image;return r.src=t,e.image&&e.image.decode&&r.decode?(await r.decode(),r):await new Promise((i,n)=>{try{r.onload=()=>i(r),r.onerror=l=>{const c=l instanceof Error?l.message:"error";n(new Error(c))}}catch(l){n(l)}})}const fX={};let AP=!0;async function pX(t,e,r){let i;VA(r)?i=await wL(t,e,r):i=xL(t,r);const n=e&&e.imagebitmap;return await mX(i,n)}async function mX(t,e=null){if((gX(e)||!AP)&&(e=null),e)try{return await createImageBitmap(t,e)}catch(r){console.warn(r),AP=!1}return await createImageBitmap(t)}function gX(t){for(const e in t||fX)return!1;return!0}function _X(t){return!xX(t,"ftyp",4)||(t[8]&96)===0?null:yX(t)}function yX(t){switch(vX(t,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function vX(t,e,r){return String.fromCharCode(...t.slice(e,r))}function bX(t){return[...t].map(e=>e.charCodeAt(0))}function xX(t,e,r=0){const i=bX(e);for(let n=0;n<i.length;++n)if(i[n]!==t[n+r])return!1;return!0}const Eu=!1,ny=!0;function GA(t){const e=Hy(t);return EX(e)||SX(e)||AX(e)||TX(e)||wX(e)}function wX(t){const e=new Uint8Array(t instanceof DataView?t.buffer:t),r=_X(e);return r?{mimeType:r.mimeType,width:0,height:0}:null}function EX(t){const e=Hy(t);return e.byteLength>=24&&e.getUint32(0,Eu)===2303741511?{mimeType:"image/png",width:e.getUint32(16,Eu),height:e.getUint32(20,Eu)}:null}function AX(t){const e=Hy(t);return e.byteLength>=10&&e.getUint32(0,Eu)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,ny),height:e.getUint16(8,ny)}:null}function TX(t){const e=Hy(t);return e.byteLength>=14&&e.getUint16(0,Eu)===16973&&e.getUint32(2,ny)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,ny),height:e.getUint32(22,ny)}:null}function SX(t){const e=Hy(t);if(!(e.byteLength>=3&&e.getUint16(0,Eu)===65496&&e.getUint8(2)===255))return null;const{tableMarkers:r,sofMarkers:i}=CX();let n=2;for(;n+9<e.byteLength;){const l=e.getUint16(n,Eu);if(i.has(l))return{mimeType:"image/jpeg",height:e.getUint16(n+5,Eu),width:e.getUint16(n+7,Eu)};if(!r.has(l))return null;n+=2,n+=e.getUint16(n,Eu)}return null}function CX(){const t=new Set([65499,65476,65484,65501,65534]);for(let e=65504;e<65520;++e)t.add(e);return{tableMarkers:t,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function Hy(t){if(t instanceof DataView)return t;if(ArrayBuffer.isView(t))return new DataView(t.buffer);if(t instanceof ArrayBuffer)return new DataView(t);throw new Error("toDataView")}async function PX(t,e){const{mimeType:r}=GA(t)||{},i=globalThis.loaders?.parseImageNode;return Ni(i),await i(t,r)}async function RX(t,e,r){e=e||{};const i=(e.image||{}).type||"auto",{url:n}=r||{},l=MX(i);let c;switch(l){case"imagebitmap":c=await pX(t,e,n);break;case"image":c=await wL(t,e,n);break;case"data":c=await PX(t);break;default:Ni(!1)}return i==="data"&&(c=bL(c)),c}function MX(t){switch(t){case"auto":case"data":return oX();default:return sX(t),t}}const IX=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],kX=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],BX={image:{type:"auto",decode:!0}},EL={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:rX,mimeTypes:kX,extensions:IX,parse:RX,tests:[t=>!!GA(new DataView(t))],options:BX},Nx={};function LX(t){if(Nx[t]===void 0){const e=X1?DX(t):OX(t);Nx[t]=e}return Nx[t]}function OX(t){const e=["image/png","image/jpeg","image/gif"],r=globalThis.loaders?.imageFormatsNode||e;return!!globalThis.loaders?.parseImageNode&&r.includes(t)}function DX(t){switch(t){case"image/avif":case"image/webp":return NX(t);default:return!0}}function NX(t){try{return document.createElement("canvas").toDataURL(t).indexOf(`data:${t}`)===0}catch{return!1}}const hi=new Ig({id:"deck"});let M2={};function FX(t){M2=t}function Ao(t,e,r,i){hi.level>0&&M2[t]&&M2[t].call(null,e,r,i)}function zX(t){const e=t[0],r=t[t.length-1];return e==="{"&&r==="}"||e==="["&&r==="]"}const jX={dataType:null,batchType:null,id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:zX,parseTextSync:JSON.parse};function UX(){const t="9.0.35",e=globalThis.deck&&globalThis.deck.VERSION;if(e&&e!==t)throw new Error(`deck.gl - multiple versions detected: ${e} vs ${t}`);return e||(hi.log(1,`deck.gl ${t}`)(),globalThis.deck={...globalThis.deck,VERSION:t,version:t,log:hi,_registerLoggers:FX},PZ([jX,[EL,{imagebitmap:{premultiplyAlpha:"none"}}]])),t}const VX=UX();function yp(t,e){if(!t)throw new Error(e||"shadertools: assertion failed.")}const Fx={number:{type:"number",validate(t,e){return Number.isFinite(t)&&typeof e=="object"&&(e.max===void 0||t<=e.max)&&(e.min===void 0||t>=e.min)}},array:{type:"array",validate(t,e){return Array.isArray(t)||ArrayBuffer.isView(t)}}};function GX(t){const e={};for(const[r,i]of Object.entries(t))e[r]=$X(i);return e}function HX(t,e,r){const i={};for(const[n,l]of Object.entries(e))t&&n in t&&!l.private?(l.validate&&yp(l.validate(t[n],l),`${r}: invalid ${n}`),i[n]=t[n]):i[n]=l.value;return i}function $X(t){let e=TP(t);if(e!=="object")return{value:t,...Fx[e],type:e};if(typeof t=="object")return t?t.type!==void 0?{...t,...Fx[t.type],type:t.type}:t.value===void 0?{type:"object",value:t}:(e=TP(t.value),{...t,...Fx[e],type:e}):{type:"object",value:null};throw new Error("props")}function TP(t){return Array.isArray(t)||ArrayBuffer.isView(t)?"array":typeof t}const WX=`#ifdef MODULE_LOGDEPTH
logdepth_adjustPosition(gl_Position);
#endif
`,qX=`#ifdef MODULE_MATERIAL
gl_FragColor = material_filterColor(gl_FragColor);
#endif
#ifdef MODULE_LIGHTING
gl_FragColor = lighting_filterColor(gl_FragColor);
#endif
#ifdef MODULE_FOG
gl_FragColor = fog_filterColor(gl_FragColor);
#endif
#ifdef MODULE_PICKING
gl_FragColor = picking_filterHighlightColor(gl_FragColor);
gl_FragColor = picking_filterPickingColor(gl_FragColor);
#endif
#ifdef MODULE_LOGDEPTH
logdepth_setFragDepth();
#endif
`,KX={vertex:WX,fragment:qX},SP=/void\s+main\s*\([^)]*\)\s*\{\n?/,CP=/}\n?[^{}]*$/,zx=[],Uv="__LUMA_INJECT_DECLARATIONS__";function ZX(t){const e={vertex:{},fragment:{}};for(const r in t){let i=t[r];const n=XX(r);typeof i=="string"&&(i={order:0,injection:i}),e[n][r]=i}return e}function XX(t){const e=t.slice(0,2);switch(e){case"vs":return"vertex";case"fs":return"fragment";default:throw new Error(e)}}function u1(t,e,r,i=!1){const n=e==="vertex";for(const l in r){const c=r[l];c.sort((m,b)=>m.order-b.order),zx.length=c.length;for(let m=0,b=c.length;m<b;++m)zx[m]=c[m].injection;const o=`${zx.join(`
`)}
`;switch(l){case"vs:#decl":n&&(t=t.replace(Uv,o));break;case"vs:#main-start":n&&(t=t.replace(SP,m=>m+o));break;case"vs:#main-end":n&&(t=t.replace(CP,m=>o+m));break;case"fs:#decl":n||(t=t.replace(Uv,o));break;case"fs:#main-start":n||(t=t.replace(SP,m=>m+o));break;case"fs:#main-end":n||(t=t.replace(CP,m=>o+m));break;default:t=t.replace(l,m=>m+o)}}return t=t.replace(Uv,""),i&&(t=t.replace(/\}\s*$/,l=>l+KX[e])),t}let YX=1;class vp{name;vs;fs;getModuleUniforms;dependencies;deprecations;defines;injections;uniforms={};uniformTypes={};static instantiateModules(e){return e.map(r=>{if(r instanceof vp)return r;yp(typeof r!="string",`Shader module use by name is deprecated. Import shader module '${JSON.stringify(r)}' and use it directly.`),r.name||(console.warn("shader module has no name"),r.name=`shader-module-${YX++}`);const i=new vp(r);return i.dependencies=vp.instantiateModules(r.dependencies||[]),i})}constructor(e){const{name:r,vs:i,fs:n,dependencies:l=[],uniformTypes:c={},uniformPropTypes:o={},getUniforms:m,deprecations:b=[],defines:A={},inject:R={}}=e;yp(typeof r=="string"),this.name=r,this.vs=i,this.fs=n,this.getModuleUniforms=m,this.dependencies=vp.instantiateModules(l),this.deprecations=this._parseDeprecationDefinitions(b),this.defines=A,this.injections=ZX(R),this.uniformTypes=c,o&&(this.uniforms=GX(o))}getModuleSource(e){let r;switch(e){case"vertex":r=this.vs||"";break;case"fragment":r=this.fs||"";break;default:yp(!1)}const i=this.name.toUpperCase().replace(/[^0-9a-z]/gi,"_");return`// ----- MODULE ${this.name} ---------------

#define MODULE_${i}
${r}

`}getUniforms(e,r){return this.getModuleUniforms?this.getModuleUniforms(e,r):HX(e,this.uniforms,this.name)}getDefines(){return this.defines}checkDeprecations(e,r){this.deprecations.forEach(i=>{i.regex?.test(e)&&(i.deprecated?r.deprecated(i.old,i.new)():r.removed(i.old,i.new)())})}_parseDeprecationDefinitions(e){return e.forEach(r=>{switch(r.type){case"function":r.regex=new RegExp(`\\b${r.old}\\(`);break;default:r.regex=new RegExp(`${r.type} ${r.old};`)}}),e}_defaultGetUniforms(e={}){const r={},i=this.uniforms;for(const n in i){const l=i[n];n in e&&!l.private?(l.validate&&yp(l.validate(e[n],l),`${this.name}: invalid ${n}`),r[n]=e[n]):r[n]=l.value}return r}}function PP(t){if(t.source&&t.platformInfo.type==="webgpu")return{...t,vs:void 0,fs:void 0};if(!t.vs)throw new Error("no vertex shader");const e=RP(t.platformInfo,t.vs);let r;return t.fs&&(r=RP(t.platformInfo,t.fs)),{...t,vs:e,fs:r}}function RP(t,e){if(typeof e=="string")return e;switch(t.type){case"webgpu":if(e?.wgsl)return e.wgsl;throw new Error("WebGPU does not support GLSL shaders");default:if(e?.glsl)return e.glsl;throw new Error("WebGL does not support WGSL shaders")}}function J1(t){const e=vp.instantiateModules(t);return JX(e)}function JX(t){const e={},r={};return AL({modules:t,level:0,moduleMap:e,moduleDepth:r}),Object.keys(r).sort((i,n)=>r[n]-r[i]).map(i=>e[i])}function AL(t){const{modules:e,level:r,moduleMap:i,moduleDepth:n}=t;if(r>=5)throw new Error("Possible loop in shader dependency graph");for(const l of e)i[l.name]=l,(n[l.name]===void 0||n[l.name]<r)&&(n[l.name]=r);for(const l of e)l.dependencies&&AL({modules:l.dependencies,level:r+1,moduleMap:i,moduleDepth:n})}function QX(t){switch(t?.gpu.toLowerCase()){case"apple":return`#define APPLE_GPU
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"nvidia":return`#define NVIDIA_GPU
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function eY(t,e){if(Number(t.match(/^#version[ \t]+(\d+)/m)?.[1]||100)!==300)throw new Error("luma.gl v9 only supports GLSL 3.00 shader sources");switch(e){case"vertex":return t=MP(t,tY),t;case"fragment":return t=MP(t,rY),t;default:throw new Error(e)}}const TL=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],tY=[...TL,[I2("attribute"),"in $1"],[I2("varying"),"out $1"]],rY=[...TL,[I2("varying"),"in $1"]];function MP(t,e){for(const[r,i]of e)t=t.replace(r,i);return t}function I2(t){return new RegExp(`\\b${t}[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)`,"g")}function SL(t,e){let r="";for(const i in t){const n=t[i];if(r+=`void ${n.signature} {
`,n.header&&(r+=`  ${n.header}`),e[i]){const l=e[i];l.sort((c,o)=>c.order-o.order);for(const c of l)r+=`  ${c.injection}
`}n.footer&&(r+=`  ${n.footer}`),r+=`}
`}return r}function CL(t){const e={vertex:{},fragment:{}};for(const r of t){let i,n;typeof r!="string"?(i=r,n=i.hook):(i={},n=r),n=n.trim();const[l,c]=n.split(":"),o=n.replace(/\(.+/,""),m=Object.assign(i,{signature:c});switch(l){case"vs":e.vertex[o]=m;break;case"fs":e.fragment[o]=m;break;default:throw new Error(l)}}return e}function iY(t,e){return{name:nY(t,e),language:"glsl",version:sY(t)}}function nY(t,e="unnamed"){const r=/#define[^\S\r\n]*SHADER_NAME[^\S\r\n]*([A-Za-z0-9_-]+)\s*/.exec(t);return r?r[1]:e}function sY(t){let e=100;const r=t.match(/[^\s]+/g);if(r&&r.length>=2&&r[0]==="#version"){const i=parseInt(r[1],10);Number.isFinite(i)&&(e=i)}if(e!==100&&e!==300)throw new Error(`Invalid GLSL version ${e}`);return e}const PL=`

${Uv}
`,oY=`precision highp float;
`;function aY(t){const e=J1(t.modules||[]);return{source:k2(t.platformInfo,{...t,source:t.source,stage:"vertex",modules:e}),getUniforms:HA(e)}}function lY(t){const e=J1(t.modules||[]);return{vs:k2(t.platformInfo,{...t,source:t.vs,stage:"vertex",modules:e}),fs:k2(t.platformInfo,{...t,source:t.fs,stage:"fragment",modules:e}),getUniforms:HA(e)}}function cY(t){const{vs:e,fs:r}=t,i=J1(t.modules||[]);return{vs:IP(t.platformInfo,{...t,source:e,stage:"vertex",modules:i}),fs:IP(t.platformInfo,{...t,source:r,stage:"fragment",modules:i}),getUniforms:HA(i)}}function k2(t,e){const{source:r,stage:i,modules:n,hookFunctions:l=[],inject:c={},log:o}=e;yp(typeof r=="string","shader source must be a string");const m=r;let b="";const A=CL(l),R={},M={},L={};for(const V in c){const q=typeof c[V]=="string"?{injection:c[V],order:0}:c[V],J=/^(v|f)s:(#)?([\w-]+)$/.exec(V);if(J){const ie=J[2],ee=J[3];ie?ee==="decl"?M[V]=[q]:L[V]=[q]:R[V]=[q]}else L[V]=[q]}const G=t.type!=="webgpu"?n:[];for(const V of G){o&&V.checkDeprecations(m,o);const q=V.getModuleSource(i,"wgsl");b+=q;const J=V.injections[i];for(const ie in J){const ee=/^(v|f)s:#([\w-]+)$/.exec(ie);if(ee){const me=ee[2]==="decl"?M:L;me[ie]=me[ie]||[],me[ie].push(J[ie])}else R[ie]=R[ie]||[],R[ie].push(J[ie])}}return b+=PL,b=u1(b,i,M),b+=SL(A[i],R),b+=m,b=u1(b,i,L),b}function IP(t,e){const{id:r,source:i,stage:n,language:l="glsl",modules:c,defines:o={},hookFunctions:m=[],inject:b={},prologue:A=!0,log:R}=e;yp(typeof i=="string","shader source must be a string");const M=l==="glsl"?iY(i).version:-1,L=t.shaderLanguageVersion,G=M===100?"#version 100":"#version 300 es",V=i.split(`
`).slice(1).join(`
`),q={};c.forEach(Me=>{Object.assign(q,Me.getDefines())}),Object.assign(q,o);let J="";switch(l){case"wgsl":break;case"glsl":J=A?`${G}

// ----- PROLOGUE -------------------------
${uY({id:r,source:i,stage:n})}
${`#define SHADER_TYPE_${n.toUpperCase()}`}
${QX(t)}
${n==="fragment"?oY:""}

// ----- APPLICATION DEFINES -------------------------

${hY(q)}

`:`${G}
`;break}const ie=CL(m),ee={},me={},Se={};for(const Me in b){const Ve=typeof b[Me]=="string"?{injection:b[Me],order:0}:b[Me],Be=/^(v|f)s:(#)?([\w-]+)$/.exec(Me);if(Be){const $e=Be[2],at=Be[3];$e?at==="decl"?me[Me]=[Ve]:Se[Me]=[Ve]:ee[Me]=[Ve]}else Se[Me]=[Ve]}for(const Me of c){R&&Me.checkDeprecations(V,R);const Ve=Me.getModuleSource(n);J+=Ve;const Be=Me.injections[n];for(const $e in Be){const at=/^(v|f)s:#([\w-]+)$/.exec($e);if(at){const _t=at[2]==="decl"?me:Se;_t[$e]=_t[$e]||[],_t[$e].push(Be[$e])}else ee[$e]=ee[$e]||[],ee[$e].push(Be[$e])}}return J+="// ----- MAIN SHADER SOURCE -------------------------",J+=PL,J=u1(J,n,me),J+=SL(ie[n],ee),J+=V,J=u1(J,n,Se),l==="glsl"&&M!==L&&(J=eY(J,n)),J.trim()}function HA(t){return function(e){const r={};for(const i of t){const n=i.getUniforms(e,r);Object.assign(r,n)}return r}}function uY(t){const{id:e,source:r,stage:i}=t;return e&&r.indexOf("SHADER_NAME")===-1?`
#define SHADER_NAME ${e}_${i}

`:""}function hY(t={}){let e="";for(const r in t){const i=t[r];(i||Number.isFinite(i))&&(e+=`#define ${r.toUpperCase()} ${t[r]}
`)}return e}class bp{static defaultShaderAssembler;_hookFunctions=[];_defaultModules=[];static getDefaultShaderAssembler(){return bp.defaultShaderAssembler=bp.defaultShaderAssembler||new bp,bp.defaultShaderAssembler}addDefaultModule(e){this._defaultModules.find(r=>r.name===(typeof e=="string"?e:e.name))||this._defaultModules.push(e)}removeDefaultModule(e){const r=typeof e=="string"?e:e.name;this._defaultModules=this._defaultModules.filter(i=>i.name!==r)}addShaderHook(e,r){r&&(e=Object.assign(r,{hook:e})),this._hookFunctions.push(e)}assembleShader(e){const r=this._getModuleList(e.modules),i=this._hookFunctions,n=PP(e);return{...aY({platformInfo:e.platformInfo,...n,modules:r,hookFunctions:i}),modules:r}}assembleShaderPair(e){const r=PP(e),i=this._getModuleList(e.modules),n=this._hookFunctions,{platformInfo:l}=e;return{...e.platformInfo.shaderLanguage==="wgsl"?lY({platformInfo:l,...r,modules:i,hookFunctions:n}):cY({platformInfo:l,...r,modules:i,hookFunctions:n}),modules:i}}_getModuleList(e=[]){const r=new Array(this._defaultModules.length+e.length),i={};let n=0;for(let l=0,c=this._defaultModules.length;l<c;++l){const o=this._defaultModules[l],m=o.name;r[n++]=o,i[m]=!0}for(let l=0,c=e.length;l<c;++l){const o=e[l],m=o.name;i[m]||(r[n++]=o,i[m]=!0)}return r.length=n,vp.instantiateModules(r)}}const dY=`out vec4 transform_output;
void main() {
transform_output = vec4(0);
}`,fY=`#version 300 es
${dY}`;function pY(t){const{input:e,inputChannels:r,output:i}={};if(!e)return fY;if(!r)throw new Error("inputChannels");const n=mY(r),l=gY(e,r);return`#version 300 es
in ${n} ${e};
out vec4 ${i};
void main() {
  ${i} = ${l};
}`}function mY(t){switch(t){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`invalid channels: ${t}`)}}function gY(t,e){switch(e){case 1:return`vec4(${t}, 0.0, 0.0, 1.0)`;case 2:return`vec4(${t}, 0.0, 1.0)`;case 3:return`vec4(${t}, 1.0)`;case 4:return t;default:throw new Error(`invalid channels: ${e}`)}}const Pt=new Ig({id:"luma.gl"});class _Y{stats=new Map;getStats(e){return this.get(e)}get(e){return this.stats.has(e)||this.stats.set(e,new kg({id:e})),this.stats.get(e)}}const $A=new _Y;function yY(){const t="9.0.27",e="set luma.log.level=1 (or higher) to trace rendering";if(globalThis.luma&&globalThis.luma.VERSION!==t)throw new Error(`luma.gl - multiple VERSIONs detected: ${globalThis.luma.VERSION} vs ${t}`);return globalThis.luma||(qd()&&Pt.log(1,`${t} - ${e}`)(),globalThis.luma=globalThis.luma||{VERSION:t,version:t,log:Pt,stats:$A}),t}const vY=yY();function bY(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)?t:null}function by(t){return Array.isArray(t)?t.length===0||typeof t[0]=="number"?t:null:bY(t)}const jx={};function Kd(t="id"){jx[t]=jx[t]||1;const e=jx[t]++;return`${t}-${e}`}function h1(t){let e=!0;for(const r in t){e=!1;break}return e}let Mi=class{static defaultProps={id:"undefined",handle:void 0,userData:void 0};id;props;userData={};_device;destroyed=!1;allocatedBytes=0;_attachedResources=new Set;constructor(t,e,r){if(!t)throw new Error("no device");this._device=t,this.props=xY(e,r);const i=this.props.id!=="undefined"?this.props.id:Kd(this[Symbol.toStringTag]);this.props.id=i,this.id=i,this.userData=this.props.userData||{},this.addStats()}destroy(){this.destroyResource()}delete(){return this.destroy(),this}toString(){return`${this[Symbol.toStringTag]||this.constructor.name}(${this.id})`}getProps(){return this.props}attachResource(t){this._attachedResources.add(t)}detachResource(t){this._attachedResources.delete(t)}destroyAttachedResource(t){this._attachedResources.delete(t)&&t.destroy()}destroyAttachedResources(){for(const t of Object.values(this._attachedResources))t.destroy();this._attachedResources=new Set}destroyResource(){this.destroyAttachedResources(),this.removeStats(),this.destroyed=!0}removeStats(){const t=this._device.statsManager.getStats("Resource Counts"),e=this[Symbol.toStringTag];t.get(`${e}s Active`).decrementCount()}trackAllocatedMemory(t,e=this[Symbol.toStringTag]){const r=this._device.statsManager.getStats("Resource Counts");r.get("GPU Memory").addCount(t),r.get(`${e} Memory`).addCount(t),this.allocatedBytes=t}trackDeallocatedMemory(t=this[Symbol.toStringTag]){const e=this._device.statsManager.getStats("Resource Counts");e.get("GPU Memory").subtractCount(this.allocatedBytes),e.get(`${t} Memory`).subtractCount(this.allocatedBytes),this.allocatedBytes=0}addStats(){const t=this._device.statsManager.getStats("Resource Counts"),e=this[Symbol.toStringTag];t.get("Resources Created").incrementCount(),t.get(`${e}s Created`).incrementCount(),t.get(`${e}s Active`).incrementCount()}};function xY(t,e){const r={...e};for(const i in t)t[i]!==void 0&&(r[i]=t[i]);return r}class rn extends Mi{static defaultProps={...Mi.defaultProps,usage:0,byteLength:0,byteOffset:0,data:null,indexType:"uint16",mappedAtCreation:!1};static MAP_READ=1;static MAP_WRITE=2;static COPY_SRC=4;static COPY_DST=8;static INDEX=16;static VERTEX=32;static UNIFORM=64;static STORAGE=128;static INDIRECT=256;static QUERY_RESOLVE=512;get[Symbol.toStringTag](){return"Buffer"}usage;indexType;updateTimestamp;constructor(e,r){const i={...r};(r.usage||0)&rn.INDEX&&!r.indexType&&(r.data instanceof Uint32Array?i.indexType="uint32":r.data instanceof Uint16Array&&(i.indexType="uint16")),super(e,i,rn.defaultProps),this.usage=r.usage||0,this.indexType=i.indexType,this.updateTimestamp=e.incrementTimestamp()}readSyncWebGL(e,r){throw new Error("not implemented")}static DEBUG_DATA_MAX_LENGTH=32;debugData=new ArrayBuffer(0);_setDebugData(e,r,i){const n=ArrayBuffer.isView(e)?e.buffer:e,l=Math.min(e?e.byteLength:i,rn.DEBUG_DATA_MAX_LENGTH);e===null?this.debugData=new ArrayBuffer(l):r===0&&i===e.byteLength?this.debugData=n.slice(0,l):this.debugData=n.slice(r,r+l)}}function RL(t){const e=kP[t],r=wY(e),i=t.includes("norm"),n=!i&&!t.startsWith("float"),l=t.startsWith("s");return{dataType:kP[t],byteLength:r,integer:n,signed:l,normalized:i}}function wY(t){return EY[t]}const kP={uint8:"uint8",sint8:"sint8",unorm8:"uint8",snorm8:"sint8",uint16:"uint16",sint16:"sint16",unorm16:"uint16",snorm16:"sint16",float16:"float16",float32:"float32",uint32:"uint32",sint32:"sint32"},EY={uint8:1,sint8:1,uint16:2,sint16:2,float16:2,float32:4,uint32:4,sint32:4},AY=["bc1","bc2","bc3","bc4","bc5","bc6","bc7","etc1","etc2","eac","atc","astc","pvrtc"],TY=/^(rg?b?a?)([0-9]*)([a-z]*)(-srgb)?(-webgl|-unsized)?$/;function SY(t){return AY.some(e=>t.startsWith(e))}function ML(t){const e=TY.exec(t);if(e){const[,r,i,n,l,c]=e;if(r){const o=`${n}${i}`,m=RL(o);return{format:r,components:r.length,srgb:l==="-srgb",unsized:c==="-unsized",webgl:c==="-webgl",...m}}}return PY(t)}const CY={"rgba4unorm-webgl":{format:"rgba",bpp:2},"rgb565unorm-webgl":{format:"rgb",bpp:2},"rgb5a1unorm-webgl":{format:"rgba",bbp:2},rgb9e5ufloat:{format:"rgb",bbp:4},rg11b10ufloat:{format:"rgb",bbp:4},rgb10a2unorm:{format:"rgba",bbp:4},"rgb10a2uint-webgl":{format:"rgba",bbp:4},stencil8:{components:1,bpp:1,a:"stencil"},depth16unorm:{components:1,bpp:2,a:"depth"},depth24plus:{components:1,bpp:3,a:"depth"},depth32float:{components:1,bpp:4,a:"depth"},"depth24plus-stencil8":{components:2,bpp:4,a:"depth-stencil"},"depth24unorm-stencil8":{components:2,bpp:4,a:"depth-stencil"},"depth32float-stencil8":{components:2,bpp:4,a:"depth-stencil"}};function PY(t){const e=CY[t];if(!e)throw new Error(`Unknown format ${t}`);return{format:e.format||"",components:e.components||e.format?.length||1,byteLength:e.bpp||1,srgb:!1,unsized:!1}}class RY{}class MY{features;disabledFeatures;constructor(e=[],r){this.features=new Set(e),this.disabledFeatures=r||{}}*[Symbol.iterator](){yield*this.features}has(e){return!this.disabledFeatures[e]&&this.features.has(e)}}class cg{static defaultProps={id:null,canvas:null,container:null,manageState:!0,width:800,height:600,requestMaxLimits:!0,debug:!!Pt.get("debug"),spector:!!(Pt.get("spector")||Pt.get("spectorjs")),break:[],initalizeFeatures:!0,disabledFeatures:{"compilation-status-async-webgl":!0},gl:null,onError:e=>Pt.error(e.message)};get[Symbol.toStringTag](){return"Device"}static VERSION=vY;constructor(e){this.props={...cg.defaultProps,...e},this.id=this.props.id||Kd(this[Symbol.toStringTag].toLowerCase())}id;props;userData={};statsManager=$A;_lumaData={};isTextureFormatCompressed(e){return SY(e)}loseDevice(){return!1}getCanvasContext(){if(!this.canvasContext)throw new Error("Device has no CanvasContext");return this.canvasContext}createTexture(e){return(e instanceof Promise||typeof e=="string")&&(e={data:e}),this._createTexture(e)}createCommandEncoder(e={}){throw new Error("not implemented")}readPixelsToArrayWebGL(e,r){throw new Error("not implemented")}readPixelsToBufferWebGL(e,r){throw new Error("not implemented")}setParametersWebGL(e){throw new Error("not implemented")}getParametersWebGL(e){throw new Error("not implemented")}withParametersWebGL(e,r){throw new Error("not implemented")}clearWebGL(e){throw new Error("not implemented")}resetWebGL(){throw new Error("not implemented")}timestamp=0;incrementTimestamp(){return this.timestamp++}onError(e){this.props.onError(e)}_getBufferProps(e){(e instanceof ArrayBuffer||ArrayBuffer.isView(e))&&(e={data:e});const r={...e};return(e.usage||0)&rn.INDEX&&!e.indexType&&(e.data instanceof Uint32Array?r.indexType="uint32":e.data instanceof Uint16Array?r.indexType="uint16":Pt.warn("indices buffer content must be of integer type")()),r}}function _i(t,e){if(!t)throw new Error(e||"luma.gl: assertion failed.")}const R_=new Map;class Jm{static defaultProps={...cg.defaultProps,type:"best-available",devices:void 0};static stats=$A;static log=Pt;static registerDevices(e){for(const r of e)_i(r.type&&r.isSupported&&r.create),R_.set(r.type,r)}static getAvailableDevices(){return Array.from(R_).map(e=>e.type)}static getSupportedDevices(){return Array.from(R_).filter(e=>e.isSupported()).map(e=>e.type)}static setDefaultDeviceProps(e){Object.assign(cg.defaultProps,e)}static async attachDevice(e){const r=BP(e.devices)||R_;if(e.handle instanceof WebGL2RenderingContext){const i=r.get("webgl");if(i)return await i.attach(e.handle)}if(e.handle===null){const i=r.get("unknown");if(i)return await i.attach(null)}throw new Error("Failed to attach device. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.")}static async createDevice(e={}){e={...Jm.defaultProps,...e},e.gl&&(e.type="webgl");const r=BP(e.devices)||R_;let i,n;switch(e.type){case"webgpu":if(i=r.get("webgpu"),i)return await i.create(e);break;case"webgl":if(n=r.get("webgl"),n)return await n.create(e);break;case"unknown":const l=r.get("unknown");if(l)return await l.create(e);break;case"best-available":if(i=r.get("webgpu"),i?.isSupported?.())return await i.create(e);if(n=r.get("webgl"),n?.isSupported?.())return await n.create(e);break}throw new Error("No matching device found. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.")}static enforceWebGL2(e=!0){const r=HTMLCanvasElement.prototype;if(!e&&r.originalGetContext){r.getContext=r.originalGetContext,r.originalGetContext=void 0;return}r.originalGetContext=r.getContext,r.getContext=function(i,n){return i==="webgl"||i==="experimental-webgl"?this.originalGetContext("webgl2",n):this.originalGetContext(i,n)}}}function BP(t){if(!t||t?.length===0)return null;const e=new Map;for(const r of t)e.set(r.type,r);return e}const IY=qd()&&typeof document<"u",Q1=()=>IY&&document.readyState==="complete",kY={canvas:null,width:800,height:600,useDevicePixels:!0,autoResize:!0,container:null,visible:!0,colorSpace:"srgb",alphaMode:"opaque"};class IL{id;props;canvas;htmlCanvas;offscreenCanvas;type;width=1;height=1;resizeObserver;_canvasSizeInfo={clientWidth:0,clientHeight:0,devicePixelRatio:1};static get isPageLoaded(){return Q1()}static pageLoaded=BY();constructor(e){if(this.props={...kY,...e},e=this.props,!qd()){this.id="node-canvas-context",this.type="node",this.width=this.props.width,this.height=this.props.height,this.canvas=null;return}if(e.canvas)typeof e.canvas=="string"?this.canvas=OY(e.canvas):this.canvas=e.canvas;else{const r=DY(e),i=LY(e?.container||null);i.insertBefore(r,i.firstChild),this.canvas=r,e?.visible||(this.canvas.style.visibility="hidden")}this.canvas instanceof HTMLCanvasElement?(this.id=this.canvas.id,this.type="html-canvas",this.htmlCanvas=this.canvas):(this.id="offscreen-canvas",this.type="offscreen-canvas",this.offscreenCanvas=this.canvas),this.canvas instanceof HTMLCanvasElement&&e.autoResize&&(this.resizeObserver=new ResizeObserver(r=>{for(const i of r)i.target===this.canvas&&this.update()}),this.resizeObserver.observe(this.canvas))}getDevicePixelRatio(e){return typeof OffscreenCanvas<"u"&&this.canvas instanceof OffscreenCanvas||(e=e===void 0?this.props.useDevicePixels:e,!e||e<=0)?1:e===!0?typeof window<"u"&&window.devicePixelRatio||1:e}getPixelSize(){switch(this.type){case"node":return[this.width,this.height];case"offscreen-canvas":return[this.canvas.width,this.canvas.height];case"html-canvas":const e=this.getDevicePixelRatio(),r=this.canvas;return r.parentElement?[r.clientWidth*e,r.clientHeight*e]:[this.canvas.width,this.canvas.height];default:throw new Error(this.type)}}getAspect(){const[e,r]=this.getPixelSize();return e/r}cssToDeviceRatio(){try{const[e]=this.getDrawingBufferSize(),{clientWidth:r}=this._canvasSizeInfo;return r?e/r:1}catch{return 1}}cssToDevicePixels(e,r=!0){const i=this.cssToDeviceRatio(),[n,l]=this.getDrawingBufferSize();return NY(e,i,n,l,r)}setDevicePixelRatio(e,r={}){if(!this.htmlCanvas)return;let i="width"in r?r.width:this.htmlCanvas.clientWidth,n="height"in r?r.height:this.htmlCanvas.clientHeight;(!i||!n)&&(Pt.log(1,"Canvas clientWidth/clientHeight is 0")(),e=1,i=this.htmlCanvas.width||1,n=this.htmlCanvas.height||1);const l=this._canvasSizeInfo;if(l.clientWidth!==i||l.clientHeight!==n||l.devicePixelRatio!==e){let c=e;const o=Math.floor(i*c),m=Math.floor(n*c);this.htmlCanvas.width=o,this.htmlCanvas.height=m;const[b,A]=this.getDrawingBufferSize();(b!==o||A!==m)&&(c=Math.min(b/i,A/n),this.htmlCanvas.width=Math.floor(i*c),this.htmlCanvas.height=Math.floor(n*c),Pt.warn("Device pixel ratio clamped")()),this._canvasSizeInfo.clientWidth=i,this._canvasSizeInfo.clientHeight=n,this._canvasSizeInfo.devicePixelRatio=e}}getDrawingBufferSize(){const e=this.device.gl;if(!e)throw new Error("canvas size");return[e.drawingBufferWidth,e.drawingBufferHeight]}_setAutoCreatedCanvasId(e){this.htmlCanvas?.id==="lumagl-auto-created-canvas"&&(this.htmlCanvas.id=e)}}function BY(){return Q1()||typeof window>"u"?Promise.resolve():new Promise(t=>{window.addEventListener("load",()=>t())})}function LY(t){if(typeof t=="string"){const e=document.getElementById(t);if(!e&&!Q1())throw new Error(`Accessing '${t}' before page was loaded`);if(!e)throw new Error(`${t} is not an HTML element`);return e}else if(t)return t;return document.body}function OY(t){const e=document.getElementById(t);if(!e&&!Q1())throw new Error(`Accessing '${t}' before page was loaded`);if(!(e instanceof HTMLCanvasElement))throw new Error("Object is not a canvas element");return e}function DY(t){const{width:e,height:r}=t,i=document.createElement("canvas");return i.id="lumagl-auto-created-canvas",i.width=e||1,i.height=r||1,i.style.width=Number.isFinite(e)?`${e}px`:"100%",i.style.height=Number.isFinite(r)?`${r}px`:"100%",i}function NY(t,e,r,i,n){const l=t,c=LP(l[0],e,r);let o=OP(l[1],e,i,n),m=LP(l[0]+1,e,r);const b=m===r-1?m:m-1;m=OP(l[1]+1,e,i,n);let A;return n?(m=m===0?m:m+1,A=o,o=m):A=m===i-1?m:m-1,{x:c,y:o,width:Math.max(b-c+1,1),height:Math.max(A-o+1,1)}}function LP(t,e,r){return Math.min(Math.round(t*e),r-1)}function OP(t,e,r,i){return i?Math.max(0,r-1-Math.round(t*e)):Math.min(Math.round(t*e),r-1)}class rl extends Mi{static defaultProps={...Mi.defaultProps,data:null,dimension:"2d",format:"rgba8unorm",width:void 0,height:void 0,depth:1,mipmaps:!0,compressed:!1,usage:0,mipLevels:void 0,samples:void 0,type:void 0,sampler:{},view:void 0};static COPY_SRC=1;static COPY_DST=2;static TEXTURE_BINDING=4;static STORAGE_BINDING=8;static RENDER_ATTACHMENT=16;get[Symbol.toStringTag](){return"Texture"}dimension;format;width;height;depth;updateTimestamp;constructor(e,r,i=rl.defaultProps){super(e,r,i),this.dimension=this.props.dimension,this.format=this.props.format,this.width=this.props.width,this.height=this.props.height,this.depth=this.props.depth,this.updateTimestamp=e.incrementTimestamp()}}class eb extends Mi{static defaultProps={...Mi.defaultProps,format:void 0,dimension:void 0,aspect:"all",baseMipLevel:0,mipLevelCount:void 0,baseArrayLayer:0,arrayLayerCount:void 0};get[Symbol.toStringTag](){return"TextureView"}constructor(e,r){super(e,r,eb.defaultProps)}}function FY(t,e,r){let i="";const n=e.split(/\r?\n/),l=t.slice().sort((c,o)=>c.lineNum-o.lineNum);switch(r?.showSourceCode||"no"){case"all":let c=0;for(let o=1;o<=n.length;o++)for(i+=kL(n[o-1],o,r);l.length>c&&l[c].lineNum===o;){const m=l[c++];i+=DP(m,n,m.lineNum,{...r,inlineSource:!1})}return i;case"issues":case"no":for(const o of t)i+=DP(o,n,o.lineNum,{inlineSource:r?.showSourceCode!=="no"});return i}}function DP(t,e,r,i){if(i?.inlineSource){const n=zY(e,r),l=t.linePos>0?`${" ".repeat(t.linePos+5)}^^^
`:"";return`
${n}${l}${t.type.toUpperCase()}: ${t.message}

`}return i?.html?`<div class='luma-compiler-log-error' style="color:red;"><b> ${t.type.toUpperCase()}: ${t.message}</b></div>`:`${t.type.toUpperCase()}: ${t.message}`}function zY(t,e,r){let i="";for(let n=e-2;n<=e;n++){const l=t[n-1];l!==void 0&&(i+=kL(l,e,r))}return i}function kL(t,e,r){const i=r?.html?UY(t):t;return`${jY(String(e),4)}: ${i}${r?.html?"<br/>":`
`}`}function jY(t,e){let r="";for(let i=t.length;i<e;++i)r+=" ";return r+t}function UY(t){return t.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}function BL(t,e){return{name:VY(t,e),language:"glsl",version:GY(t)}}function VY(t,e="unnamed"){const r=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/.exec(t);return r?r[1]:e}function GY(t){let e=100;const r=t.match(/[^\s]+/g);if(r&&r.length>=2&&r[0]==="#version"){const i=parseInt(r[1],10);Number.isFinite(i)&&(e=i)}return e}class tb extends Mi{static defaultProps={...Mi.defaultProps,language:"auto",stage:void 0,source:"",sourceMap:null,entryPoint:"main",debug:"errors"};get[Symbol.toStringTag](){return"Shader"}stage;source;compilationStatus="pending";constructor(e,r){super(e,{id:HY(r),...r},tb.defaultProps),this.stage=this.props.stage,this.source=this.props.source}getCompilationInfoSync(){return null}getTranslatedSource(){return null}async debugShader(e=this.props.debug){switch(e){case"never":return;case"errors":if(this.compilationStatus==="success")return;break}const r=await this.getCompilationInfo();this.props.debug==="warnings"&&r?.length===0||this._displayShaderLog(r)}_displayShaderLog(e){if(typeof document>"u"||!document?.createElement)return;const r=BL(this.source).name,i=`${this.stage} ${r}`;let n=FY(e,this.source,{showSourceCode:"all",html:!0});const l=this.getTranslatedSource();l&&(n+=`<br /><br /><h1>Translated Source</h1><br /><br /><code style="user-select:text;"><pre>${l}</pre></code>`);const c=document.createElement("Button");c.innerHTML=`
<h1>Shader Compilation Error in ${i}</h1><br /><br />
<code style="user-select:text;"><pre>
${n}
</pre></code>`,c.style.top="10px",c.style.left="10px",c.style.position="absolute",c.style.zIndex="9999",c.style.width="100%",c.style.textAlign="left",document.body.appendChild(c);const o=document.getElementsByClassName("luma-compiler-log-error");o[0]?.scrollIntoView&&o[0].scrollIntoView(),c.onclick=()=>{const m=`data:text/plain,${encodeURIComponent(this.source)}`;navigator.clipboard.writeText(m)}}}function HY(t){return BL(t.source).name||t.id||Kd(`unnamed ${t.stage}-shader`)}class rb extends Mi{static defaultProps={...Mi.defaultProps,type:"color-sampler",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",addressModeW:"clamp-to-edge",magFilter:"nearest",minFilter:"nearest",mipmapFilter:"nearest",lodMinClamp:0,lodMaxClamp:32,compare:"less-equal",maxAnisotropy:1};get[Symbol.toStringTag](){return"Sampler"}constructor(e,r){super(e,r,rb.defaultProps)}}class ib extends Mi{static defaultProps={...Mi.defaultProps,width:1,height:1,colorAttachments:[],depthStencilAttachment:null};get[Symbol.toStringTag](){return"Framebuffer"}width;height;colorAttachments=[];depthStencilAttachment=null;constructor(e,r={}){super(e,r,ib.defaultProps),this.width=this.props.width,this.height=this.props.height}resize(e){let r=!e;if(e){const[i,n]=Array.isArray(e)?e:[e.width,e.height];r=r||n!==this.height||i!==this.width,this.width=i,this.height=n}r&&(Pt.log(2,`Resizing framebuffer ${this.id} to ${this.width}x${this.height}`)(),this.resizeAttachments(this.width,this.height))}autoCreateAttachmentTextures(){if(this.props.colorAttachments.length===0&&!this.props.depthStencilAttachment)throw new Error("Framebuffer has noattachments");this.colorAttachments=this.props.colorAttachments.map(r=>{if(typeof r=="string"){const i=this.createColorTexture(r);return this.attachResource(i),i.view}return r instanceof rl?r.view:r});const e=this.props.depthStencilAttachment;if(e)if(typeof e=="string"){const r=this.createDepthStencilTexture(e);this.attachResource(r),this.depthStencilAttachment=r.view}else e instanceof rl?this.depthStencilAttachment=e.view:this.depthStencilAttachment=e}createColorTexture(e){return this.device.createTexture({id:"color-attachment",usage:rl.RENDER_ATTACHMENT,format:e,width:this.width,height:this.height})}createDepthStencilTexture(e){return this.device.createTexture({id:"depth-stencil-attachment",usage:rl.RENDER_ATTACHMENT,format:e,width:this.width,height:this.height})}resizeAttachments(e,r){for(let i=0;i<this.colorAttachments.length;++i)if(this.colorAttachments[i]){const n=this.device._createTexture({...this.colorAttachments[i].props,width:e,height:r});this.destroyAttachedResource(this.colorAttachments[i]),this.colorAttachments[i]=n.view,this.attachResource(n.view)}if(this.depthStencilAttachment){const i=this.device._createTexture({...this.depthStencilAttachment.props,width:e,height:r});this.destroyAttachedResource(this.depthStencilAttachment),this.depthStencilAttachment=i.view,this.attachResource(i)}}}class ug extends Mi{static defaultProps={...Mi.defaultProps,vs:null,vertexEntryPoint:"vertexMain",vsConstants:{},fs:null,fragmentEntryPoint:"fragmentMain",fsConstants:{},shaderLayout:null,bufferLayout:[],topology:"triangle-list",parameters:{},bindings:{},uniforms:{}};get[Symbol.toStringTag](){return"RenderPipeline"}shaderLayout;bufferLayout;linkStatus="pending";hash="";constructor(e,r){super(e,r,ug.defaultProps),this.shaderLayout=this.props.shaderLayout,this.bufferLayout=this.props.bufferLayout||[]}setUniformsWebGL(e){throw new Error("Use uniform blocks")}}class WA extends Mi{static defaultProps={...Mi.defaultProps,framebuffer:null,parameters:void 0,clearColor:[0,0,0,0],clearDepth:1,clearStencil:0,depthReadOnly:!1,stencilReadOnly:!1,discard:!1,occlusionQuerySet:void 0,timestampQuerySet:void 0,beginTimestampIndex:void 0,endTimestampIndex:void 0};get[Symbol.toStringTag](){return"RenderPass"}constructor(e,r){super(e,r,WA.defaultProps)}}class d1 extends Mi{static defaultProps={...Mi.defaultProps,shader:void 0,entryPoint:void 0,constants:{},shaderLayout:void 0};get[Symbol.toStringTag](){return"ComputePipeline"}hash="";constructor(e,r){super(e,r,d1.defaultProps)}}class qA extends Mi{static defaultProps={...Mi.defaultProps,measureExecutionTime:void 0};get[Symbol.toStringTag](){return"CommandEncoder"}constructor(e,r){super(e,r,qA.defaultProps)}}class KA extends Mi{static defaultProps={...Mi.defaultProps};get[Symbol.toStringTag](){return"CommandBuffer"}constructor(e,r){super(e,r,KA.defaultProps)}}function $Y(t){const[e,r]=qY[t],i=e==="i32"||e==="u32",n=e!=="u32",l=KY[e]*r,c=WY(e,r);return{dataType:e,components:r,defaultVertexFormat:c,byteLength:l,integer:i,signed:n}}function WY(t,e){let r;switch(t){case"f32":r="float32";break;case"i32":r="sint32";break;case"u32":r="uint32";break;case"f16":return e<=2?"float16x2":"float16x4"}return e===1?r:`${r}x${e}`}const qY={f32:["f32",1],"vec2<f32>":["f32",2],"vec3<f32>":["f32",3],"vec4<f32>":["f32",4],f16:["f16",1],"vec2<f16>":["f16",2],"vec3<f16>":["f16",3],"vec4<f16>":["f16",4],i32:["i32",1],"vec2<i32>":["i32",2],"vec3<i32>":["i32",3],"vec4<i32>":["i32",4],u32:["u32",1],"vec2<u32>":["u32",2],"vec3<u32>":["u32",3],"vec4<u32>":["u32",4]},KY={f32:4,f16:2,i32:4,u32:4};function LL(t){let e;t.endsWith("-webgl")&&(t.replace("-webgl",""),e=!0);const[r,i]=t.split("x"),n=r,l=i?parseInt(i):1,c=RL(n),o={type:n,components:l,byteLength:c.byteLength*l,integer:c.integer,signed:c.signed,normalized:c.normalized};return e&&(o.webglOnly=!0),o}function OL(t,e){const r={};for(const i of t.attributes)r[i.name]=XY(t,e,i.name);return r}function ZY(t,e,r=16){const i=OL(t,e),n=new Array(r).fill(null);for(const l of Object.values(i))n[l.location]=l;return n}function XY(t,e,r){const i=YY(t,r),n=JY(e,r);if(!i)return null;const l=$Y(i.type),c=n?.vertexFormat||l.defaultVertexFormat,o=LL(c);return{attributeName:n?.attributeName||i.name,bufferName:n?.bufferName||i.name,location:i.location,shaderType:i.type,shaderDataType:l.dataType,shaderComponents:l.components,vertexFormat:c,bufferDataType:o.type,bufferComponents:o.components,normalized:o.normalized,integer:l.integer,stepMode:n?.stepMode||i.stepMode,byteOffset:n?.byteOffset||0,byteStride:n?.byteStride||0}}function YY(t,e){const r=t.attributes.find(i=>i.name===e);return r||Pt.warn(`shader layout attribute "${e}" not present in shader`),r||null}function JY(t,e){QY(t);let r=eJ(t,e);return r||(r=tJ(t,e),r)?r:(Pt.warn(`layout for attribute "${e}" not present in buffer layout`),null)}function QY(t){for(const e of t)(e.attributes&&e.format||!e.attributes&&!e.format)&&Pt.warn(`BufferLayout ${name} must have either 'attributes' or 'format' field`)}function eJ(t,e){for(const r of t)if(r.format&&r.name===e)return{attributeName:r.name,bufferName:e,stepMode:r.stepMode,vertexFormat:r.format,byteOffset:0,byteStride:r.byteStride||0};return null}function tJ(t,e){for(const r of t){let i=r.byteStride;if(typeof r.byteStride!="number")for(const l of r.attributes||[]){const c=LL(l.format);i+=c.byteLength}const n=r.attributes?.find(l=>l.attribute===e);if(n)return{attributeName:n.attribute,bufferName:r.name,stepMode:r.stepMode,vertexFormat:n.format,byteOffset:n.byteOffset,byteStride:i}}return null}function rJ(t,e){const r={...t,attributes:t.attributes.map(i=>({...i}))};for(const i of e?.attributes||[]){const n=r.attributes.find(l=>l.name===i.name);n?(n.type=i.type||n.type,n.stepMode=i.stepMode||n.stepMode):Pt.warn(`shader layout attribute ${i.name} not present in shader`)}return r}class ZA extends Mi{static defaultProps={...Mi.defaultProps,renderPipeline:null};get[Symbol.toStringTag](){return"VertexArray"}maxVertexAttributes;attributeInfos;indexBuffer=null;attributes;constructor(e,r){super(e,r,ZA.defaultProps),this.maxVertexAttributes=e.limits.maxVertexAttributes,this.attributes=new Array(this.maxVertexAttributes).fill(null),this.attributeInfos=ZY(r.renderPipeline.shaderLayout,r.renderPipeline.bufferLayout,this.maxVertexAttributes)}setConstantWebGL(e,r){throw new Error("constant attributes not supported")}}class XA extends Mi{static defaultProps={...Mi.defaultProps,layout:void 0,buffers:{}};get[Symbol.toStringTag](){return"TransformFeedback"}constructor(e,r){super(e,r,XA.defaultProps)}}class YA extends Mi{static defaultProps={...Mi.defaultProps,type:void 0,count:void 0};get[Symbol.toStringTag](){return"QuerySet"}constructor(e,r){super(e,r,YA.defaultProps)}}const iJ={f32:{type:"f32",components:1},i32:{type:"i32",components:1},u32:{type:"u32",components:1},"vec2<f32>":{type:"f32",components:2},"vec3<f32>":{type:"f32",components:3},"vec4<f32>":{type:"f32",components:4},"vec2<i32>":{type:"i32",components:2},"vec3<i32>":{type:"i32",components:3},"vec4<i32>":{type:"i32",components:4},"vec2<u32>":{type:"u32",components:2},"vec3<u32>":{type:"u32",components:3},"vec4<u32>":{type:"u32",components:4},"mat2x2<f32>":{type:"f32",components:4},"mat2x3<f32>":{type:"f32",components:6},"mat2x4<f32>":{type:"f32",components:8},"mat3x2<f32>":{type:"f32",components:6},"mat3x3<f32>":{type:"f32",components:9},"mat3x4<f32>":{type:"f32",components:12},"mat4x2<f32>":{type:"f32",components:8},"mat4x3<f32>":{type:"f32",components:12},"mat4x4<f32>":{type:"f32",components:16}};function nJ(t){const e=iJ[t];return _i(t),e}function sJ(t,e){switch(e){case 1:return t;case 2:return t+t%2;default:return t+(4-t%4)%4}}let iv;function DL(t){return(!iv||iv.byteLength<t)&&(iv=new ArrayBuffer(t)),iv}function oJ(t,e){const r=DL(t.BYTES_PER_ELEMENT*e);return new t(r,0,e)}function aJ(t){const{target:e,source:r,start:i=0,count:n=1}=t,l=r.length,c=n*l;let o=0;for(let m=i;o<l;o++)e[m++]=r[o];for(;o<c;)o<c-o?(e.copyWithin(i+o,i,i+o),o*=2):(e.copyWithin(i+o,i,i+c-o),o=c);return t.target}const NP=1024;class lJ{layout={};byteLength;constructor(e){let r=0;for(const[n,l]of Object.entries(e)){const c=nJ(l),{type:o,components:m}=c;r=sJ(r,m);const b=r;r+=m,this.layout[n]={type:o,size:m,offset:b}}r+=(4-r%4)%4;const i=r*4;this.byteLength=Math.max(i,NP)}getData(e){const r=Math.max(this.byteLength,NP),i=DL(r),n={i32:new Int32Array(i),u32:new Uint32Array(i),f32:new Float32Array(i),f16:new Uint16Array(i)};for(const[l,c]of Object.entries(e)){const o=this.layout[l];if(!o){Pt.warn(`Supplied uniform value ${l} not present in uniform block layout`)();continue}const{type:m,size:b,offset:A}=o,R=n[m];if(b===1){if(typeof c!="number"&&typeof c!="boolean"){Pt.warn(`Supplied value for single component uniform ${l} is not a number: ${c}`)();continue}R[A]=Number(c)}else{const M=by(c);if(!M){Pt.warn(`Supplied value for multi component / array uniform ${l} is not a numeric array: ${c}`)();continue}R.set(M,A)}}return new Uint8Array(i)}has(e){return!!this.layout[e]}get(e){return this.layout[e]}}function cJ(t,e,r=16){if(t!==e)return!1;const i=by(t);if(!i)return!1;const n=by(e);if(n&&i.length===n.length){for(let l=0;l<i.length;++l)if(n[l]!==i[l])return!1}return!0}function uJ(t){const e=by(t);return e?e.slice():t}class hJ{name;uniforms={};modifiedUniforms={};modified=!0;bindingLayout={};needsRedraw="initialized";constructor(e){if(this.name=e?.name,e?.name&&e?.shaderLayout){const r=e?.shaderLayout.bindings?.find(n=>n.type==="uniform"&&n.name===e?.name);if(!r)throw new Error(e?.name);const i=r;for(const n of i.uniforms||[])this.bindingLayout[n.name]=n}}setUniforms(e){for(const[r,i]of Object.entries(e))this._setUniform(r,i),this.needsRedraw||this.setNeedsRedraw(`${this.name}.${r}=${i}`)}setNeedsRedraw(e){this.needsRedraw=this.needsRedraw||e}getAllUniforms(){return this.modifiedUniforms={},this.needsRedraw=!1,this.uniforms||{}}_setUniform(e,r){cJ(this.uniforms[e],r)||(this.uniforms[e]=uJ(r),this.modifiedUniforms[e]=!0,this.modified=!0)}}class dJ{uniformBlocks=new Map;uniformBufferLayouts=new Map;uniformBuffers=new Map;constructor(e){for(const[r,i]of Object.entries(e)){const n=r,l=new lJ(i.uniformTypes||{});this.uniformBufferLayouts.set(n,l);const c=new hJ({name:r});c.setUniforms(i.defaultUniforms||{}),this.uniformBlocks.set(n,c)}}destroy(){for(const e of this.uniformBuffers.values())e.destroy()}setUniforms(e){for(const[r,i]of Object.entries(e))this.uniformBlocks.get(r).setUniforms(i);this.updateUniformBuffers()}getUniformBufferByteLength(e){return this.uniformBufferLayouts.get(e).byteLength}getUniformBufferData(e){const r=this.uniformBlocks.get(e).getAllUniforms();return this.uniformBufferLayouts.get(e).getData(r)}createUniformBuffer(e,r,i){i&&this.setUniforms(i);const n=this.getUniformBufferByteLength(r),l=e.createBuffer({usage:rn.UNIFORM|rn.COPY_DST,byteLength:n}),c=this.getUniformBufferData(r);return l.write(c),l}getManagedUniformBuffer(e,r){if(!this.uniformBuffers.get(r)){const i=this.getUniformBufferByteLength(r),n=e.createBuffer({usage:rn.UNIFORM|rn.COPY_DST,byteLength:i});this.uniformBuffers.set(r,n)}return this.uniformBuffers.get(r)}updateUniformBuffers(){let e=!1;for(const r of this.uniformBlocks.keys()){const i=this.updateUniformBuffer(r);e||=i}return e&&Pt.log(3,`UniformStore.updateUniformBuffers(): ${e}`)(),e}updateUniformBuffer(e){const r=this.uniformBlocks.get(e),i=this.uniformBuffers.get(e);let n=!1;if(i&&r.needsRedraw){n||=r.needsRedraw;const l=this.getUniformBufferData(e);this.uniformBuffers.get(e).write(l);const c=this.uniformBlocks.get(e).getAllUniforms();Pt.log(4,`Writing to uniform buffer ${String(e)}`,l,c)()}return n}}function NL(t){const e=ArrayBuffer.isView(t)?t.constructor:t;switch(e){case Float32Array:return"float32";case Uint16Array:return"uint16";case Uint32Array:return"uint32";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int8Array:return"sint8";case Int16Array:return"sint16";case Int32Array:return"sint32";default:throw new Error(e.constructor.name)}}function FL(t){switch(t){case"float32":return Float32Array;case"uint32":return Uint32Array;case"sint32":return Int32Array;case"uint16":case"unorm16":return Uint16Array;case"sint16":case"snorm16":return Int16Array;case"uint8":case"unorm8":return Uint8Array;case"sint8":case"snorm8":return Int8Array;default:throw new Error(t)}}function fJ(t,e,r){if(!e||e>4)throw new Error(`size ${e}`);const i=e;let n=NL(t);if(n==="uint8"&&r&&i===1)return"unorm8-webgl";if(n==="uint8"&&r&&i===3)return"unorm8x3-webgl";if(n==="uint8"||n==="sint8"){if(i===1||i===3)throw new Error(`size: ${e}`);return r&&(n=n.replace("int","norm")),`${n}x${i}`}if(n==="uint16"||n==="sint16"){if(i===1||i===3)throw new Error(`size: ${e}`);return r&&(n=n.replace("int","norm")),`${n}x${i}`}return i===1?n:`${n}x${i}`}function pJ(t){return by(t)!==null||typeof t=="number"||typeof t=="boolean"}function JA(t){const e={bindings:{},uniforms:{}};return Object.keys(t).forEach(r=>{const i=t[r];pJ(i)?e.uniforms[r]=i:e.bindings[r]=i}),e}function mJ(t,e,r){const{removedProps:i={},deprecatedProps:n={},replacedProps:l={}}=r;for(const o in i)if(o in e){const m=i[o]?`${t}.${i[o]}`:"N/A";Pt.removed(`${t}.${o}`,m)()}for(const o in n)if(o in e){const m=n[o];Pt.deprecated(`${t}.${o}`,`${t}.${m}`)()}let c=null;for(const[o,m]of Object.entries(l))o in e&&(Pt.deprecated(`${t}.${o}`,`${t}.${m}`)(),c=c||Object.assign({},e),c[m]=e[o],delete c[o]);return c||e}let gJ="";async function _J(t,e){return await new Promise((r,i)=>{try{const n=new Image;n.onload=()=>r(n),n.onerror=()=>i(new Error(`Could not load image ${t}.`)),n.crossOrigin=e?.crossOrigin||"anonymous",n.src=t.startsWith("http")?t:gJ+t}catch(n){i(n)}})}async function zL(t,e){const r=document.getElementsByTagName("head")[0];if(!r)throw new Error("loadScript");const i=document.createElement("script");return i.setAttribute("type","text/javascript"),i.setAttribute("src",t),new Promise((n,l)=>{i.onload=n,i.onerror=c=>l(new Error(`Unable to load script '${t}': ${c}`)),r.appendChild(i)})}function B2(t,e,r){if(t===e)return!0;if(!r||!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let i=0;i<t.length;i++)if(!B2(t[i],e[i],r-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const i=Object.keys(t),n=Object.keys(e);if(i.length!==n.length)return!1;for(const l of i)if(!e.hasOwnProperty(l)||!B2(t[l],e[l],r-1))return!1;return!0}return!1}function yJ(t){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(t):setTimeout(t,1e3/60)}function vJ(t){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(t):clearTimeout(t)}class bJ{constructor(){this.constants=new Map,this.aliases=new Map,this.structs=new Map}}class Lh{constructor(){}get isAstNode(){return!0}get astNodeType(){return""}evaluate(e){throw new Error("Cannot evaluate node")}evaluateString(e){return this.evaluate(e).toString()}search(e){}searchBlock(e,r){if(e){r(f1.instance);for(const i of e)i instanceof Array?this.searchBlock(i,r):i.search(r);r(p1.instance)}}}class f1 extends Lh{}f1.instance=new f1;class p1 extends Lh{}p1.instance=new p1;class dn extends Lh{constructor(){super()}}class L2 extends dn{constructor(e,r,i,n,l,c){super(),this.calls=new Set,this.name=e,this.args=r,this.returnType=i,this.body=n,this.startLine=l,this.endLine=c}get astNodeType(){return"function"}search(e){this.searchBlock(this.body,e)}}class xJ extends dn{constructor(e){super(),this.expression=e}get astNodeType(){return"staticAssert"}search(e){this.expression.search(e)}}class wJ extends dn{constructor(e,r){super(),this.condition=e,this.body=r}get astNodeType(){return"while"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class EJ extends dn{constructor(e){super(),this.body=e}get astNodeType(){return"continuing"}search(e){this.searchBlock(this.body,e)}}class AJ extends dn{constructor(e,r,i,n){super(),this.init=e,this.condition=r,this.increment=i,this.body=n}get astNodeType(){return"for"}search(e){var r,i,n;(r=this.init)===null||r===void 0||r.search(e),(i=this.condition)===null||i===void 0||i.search(e),(n=this.increment)===null||n===void 0||n.search(e),this.searchBlock(this.body,e)}}class pp extends dn{constructor(e,r,i,n,l){super(),this.name=e,this.type=r,this.storage=i,this.access=n,this.value=l}get astNodeType(){return"var"}search(e){var r;e(this),(r=this.value)===null||r===void 0||r.search(e)}}class jL extends dn{constructor(e,r,i){super(),this.name=e,this.type=r,this.value=i}get astNodeType(){return"override"}search(e){var r;(r=this.value)===null||r===void 0||r.search(e)}}class O2 extends dn{constructor(e,r,i,n,l){super(),this.name=e,this.type=r,this.storage=i,this.access=n,this.value=l}get astNodeType(){return"let"}search(e){var r;e(this),(r=this.value)===null||r===void 0||r.search(e)}}class FP extends dn{constructor(e,r,i,n,l){super(),this.name=e,this.type=r,this.storage=i,this.access=n,this.value=l}get astNodeType(){return"const"}evaluate(e){return this.value.evaluate(e)}search(e){var r;e(this),(r=this.value)===null||r===void 0||r.search(e)}}var hg;(function(t){t.increment="++",t.decrement="--"})(hg||(hg={}));(function(t){function e(r){const i=r;if(i=="parse")throw new Error("Invalid value for IncrementOperator");return t[i]}t.parse=e})(hg||(hg={}));class TJ extends dn{constructor(e,r){super(),this.operator=e,this.variable=r}get astNodeType(){return"increment"}search(e){this.variable.search(e)}}var xy;(function(t){t.assign="=",t.addAssign="+=",t.subtractAssin="-=",t.multiplyAssign="*=",t.divideAssign="/=",t.moduloAssign="%=",t.andAssign="&=",t.orAssign="|=",t.xorAssign="^=",t.shiftLeftAssign="<<=",t.shiftRightAssign=">>="})(xy||(xy={}));(function(t){function e(r){const i=r;if(i=="parse")throw new Error("Invalid value for AssignOperator");return i}t.parse=e})(xy||(xy={}));class SJ extends dn{constructor(e,r,i){super(),this.operator=e,this.variable=r,this.value=i}get astNodeType(){return"assign"}search(e){this.variable.search(e),this.value.search(e)}}class UL extends dn{constructor(e,r){super(),this.name=e,this.args=r}get astNodeType(){return"call"}search(e){for(const r of this.args)r.search(e);e(this)}}class CJ extends dn{constructor(e,r){super(),this.body=e,this.continuing=r}get astNodeType(){return"loop"}}class PJ extends dn{constructor(e,r){super(),this.condition=e,this.body=r}get astNodeType(){return"body"}}class RJ extends dn{constructor(e,r,i,n){super(),this.condition=e,this.body=r,this.elseif=i,this.else=n}get astNodeType(){return"if"}search(e){this.condition.search(e),this.searchBlock(this.body,e),this.searchBlock(this.elseif,e),this.searchBlock(this.else,e)}}class MJ extends dn{constructor(e){super(),this.value=e}get astNodeType(){return"return"}search(e){var r;(r=this.value)===null||r===void 0||r.search(e)}}class IJ extends dn{constructor(e){super(),this.name=e}get astNodeType(){return"enable"}}class kJ extends dn{constructor(e){super(),this.extensions=e}get astNodeType(){return"requires"}}class BJ extends dn{constructor(e,r){super(),this.severity=e,this.rule=r}get astNodeType(){return"diagnostic"}}class VL extends dn{constructor(e,r){super(),this.name=e,this.type=r}get astNodeType(){return"alias"}}class LJ extends dn{constructor(){super()}get astNodeType(){return"discard"}}class OJ extends dn{constructor(){super()}get astNodeType(){return"break"}}class DJ extends dn{constructor(){super()}get astNodeType(){return"continue"}}class Op extends dn{constructor(e){super(),this.name=e}get astNodeType(){return"type"}get isStruct(){return!1}get isArray(){return!1}}class up extends Op{constructor(e,r,i,n){super(e),this.members=r,this.startLine=i,this.endLine=n}get astNodeType(){return"struct"}get isStruct(){return!0}getMemberIndex(e){for(let r=0;r<this.members.length;r++)if(this.members[r].name==e)return r;return-1}}class HL extends Op{constructor(e,r,i){super(e),this.format=r,this.access=i}get astNodeType(){return"template"}}class NJ extends Op{constructor(e,r,i,n){super(e),this.storage=r,this.type=i,this.access=n}get astNodeType(){return"pointer"}}class $L extends Op{constructor(e,r,i,n){super(e),this.attributes=r,this.format=i,this.count=n}get astNodeType(){return"array"}get isArray(){return!0}}class H_ extends Op{constructor(e,r,i){super(e),this.format=r,this.access=i}get astNodeType(){return"sampler"}}class ku extends Lh{constructor(){super()}}class FJ extends ku{constructor(e){super(),this.value=e}get astNodeType(){return"stringExpr"}toString(){return this.value}evaluateString(){return this.value}}class Um extends ku{constructor(e,r){super(),this.type=e,this.args=r}get astNodeType(){return"createExpr"}search(e){if(e(this),this.args)for(const r of this.args)r.search(e)}evaluate(e){return this.args[0].evaluate(e)}}class WL extends ku{constructor(e,r){super(),this.name=e,this.args=r}get astNodeType(){return"callExpr"}evaluate(e){switch(this.name){case"abs":return Math.abs(this.args[0].evaluate(e));case"acos":return Math.acos(this.args[0].evaluate(e));case"acosh":return Math.acosh(this.args[0].evaluate(e));case"asin":return Math.asin(this.args[0].evaluate(e));case"asinh":return Math.asinh(this.args[0].evaluate(e));case"atan":return Math.atan(this.args[0].evaluate(e));case"atan2":return Math.atan2(this.args[0].evaluate(e),this.args[1].evaluate(e));case"atanh":return Math.atanh(this.args[0].evaluate(e));case"ceil":return Math.ceil(this.args[0].evaluate(e));case"clamp":return Math.min(Math.max(this.args[0].evaluate(e),this.args[1].evaluate(e)),this.args[2].evaluate(e));case"cos":return Math.cos(this.args[0].evaluate(e));case"degrees":return this.args[0].evaluate(e)*180/Math.PI;case"distance":return Math.sqrt(Math.pow(this.args[0].evaluate(e)-this.args[1].evaluate(e),2));case"dot":case"exp":return Math.exp(this.args[0].evaluate(e));case"exp2":return Math.pow(2,this.args[0].evaluate(e));case"floor":return Math.floor(this.args[0].evaluate(e));case"fma":return this.args[0].evaluate(e)*this.args[1].evaluate(e)+this.args[2].evaluate(e);case"fract":return this.args[0].evaluate(e)-Math.floor(this.args[0].evaluate(e));case"inverseSqrt":return 1/Math.sqrt(this.args[0].evaluate(e));case"log":return Math.log(this.args[0].evaluate(e));case"log2":return Math.log2(this.args[0].evaluate(e));case"max":return Math.max(this.args[0].evaluate(e),this.args[1].evaluate(e));case"min":return Math.min(this.args[0].evaluate(e),this.args[1].evaluate(e));case"mix":return this.args[0].evaluate(e)*(1-this.args[2].evaluate(e))+this.args[1].evaluate(e)*this.args[2].evaluate(e);case"modf":return this.args[0].evaluate(e)-Math.floor(this.args[0].evaluate(e));case"pow":return Math.pow(this.args[0].evaluate(e),this.args[1].evaluate(e));case"radians":return this.args[0].evaluate(e)*Math.PI/180;case"round":return Math.round(this.args[0].evaluate(e));case"sign":return Math.sign(this.args[0].evaluate(e));case"sin":return Math.sin(this.args[0].evaluate(e));case"sinh":return Math.sinh(this.args[0].evaluate(e));case"saturate":return Math.min(Math.max(this.args[0].evaluate(e),0),1);case"smoothstep":return this.args[0].evaluate(e)*this.args[0].evaluate(e)*(3-2*this.args[0].evaluate(e));case"sqrt":return Math.sqrt(this.args[0].evaluate(e));case"step":return this.args[0].evaluate(e)<this.args[1].evaluate(e)?0:1;case"tan":return Math.tan(this.args[0].evaluate(e));case"tanh":return Math.tanh(this.args[0].evaluate(e));case"trunc":return Math.trunc(this.args[0].evaluate(e));default:throw new Error("Non const function: "+this.name)}}search(e){for(const r of this.args)r.search(e);e(this)}}class D2 extends ku{constructor(e){super(),this.name=e}get astNodeType(){return"varExpr"}search(e){e(this),this.postfix&&this.postfix.search(e)}evaluate(e){const r=e.constants.get(this.name);if(!r)throw new Error("Cannot evaluate node");return r.evaluate(e)}}class zP extends ku{constructor(e,r){super(),this.name=e,this.initializer=r}get astNodeType(){return"constExpr"}evaluate(e){var r,i;if(this.initializer instanceof Um){const n=(r=this.postfix)===null||r===void 0?void 0:r.evaluateString(e),l=(i=this.initializer.type)===null||i===void 0?void 0:i.name,c=e.structs.get(l),o=c?.getMemberIndex(n);return o!==void 0&&o!=-1?this.initializer.args[o].evaluate(e):this.initializer.evaluate(e)}return this.initializer.evaluate(e)}search(e){this.initializer.search(e)}}class jP extends ku{constructor(e){super(),this.value=e}get astNodeType(){return"literalExpr"}evaluate(){return this.value}}class zJ extends ku{constructor(e,r){super(),this.type=e,this.value=r}get astNodeType(){return"bitcastExpr"}search(e){this.value.search(e)}}class UP extends ku{constructor(e){super(),this.contents=e}get astNodeType(){return"groupExpr"}evaluate(e){return this.contents[0].evaluate(e)}search(e){this.searchBlock(this.contents,e)}}class jJ extends ku{constructor(e){super(),this.index=e}search(e){this.index.search(e)}}class qL extends ku{constructor(){super()}}class UJ extends qL{constructor(e,r){super(),this.operator=e,this.right=r}get astNodeType(){return"unaryOp"}evaluate(e){switch(this.operator){case"+":return this.right.evaluate(e);case"-":return-this.right.evaluate(e);case"!":return this.right.evaluate(e)?0:1;case"~":return~this.right.evaluate(e);default:throw new Error("Unknown unary operator: "+this.operator)}}search(e){this.right.search(e)}}class mu extends qL{constructor(e,r,i){super(),this.operator=e,this.left=r,this.right=i}get astNodeType(){return"binaryOp"}evaluate(e){switch(this.operator){case"+":return this.left.evaluate(e)+this.right.evaluate(e);case"-":return this.left.evaluate(e)-this.right.evaluate(e);case"*":return this.left.evaluate(e)*this.right.evaluate(e);case"/":return this.left.evaluate(e)/this.right.evaluate(e);case"%":return this.left.evaluate(e)%this.right.evaluate(e);case"==":return this.left.evaluate(e)==this.right.evaluate(e)?1:0;case"!=":return this.left.evaluate(e)!=this.right.evaluate(e)?1:0;case"<":return this.left.evaluate(e)<this.right.evaluate(e)?1:0;case">":return this.left.evaluate(e)>this.right.evaluate(e)?1:0;case"<=":return this.left.evaluate(e)<=this.right.evaluate(e)?1:0;case">=":return this.left.evaluate(e)>=this.right.evaluate(e)?1:0;case"&&":return this.left.evaluate(e)&&this.right.evaluate(e)?1:0;case"||":return this.left.evaluate(e)||this.right.evaluate(e)?1:0;default:throw new Error(`Unknown operator ${this.operator}`)}}search(e){this.left.search(e),this.right.search(e)}}class KL extends Lh{constructor(){super()}}class VJ extends KL{constructor(e,r){super(),this.selector=e,this.body=r}get astNodeType(){return"case"}search(e){this.searchBlock(this.body,e)}}class GJ extends KL{constructor(e){super(),this.body=e}get astNodeType(){return"default"}search(e){this.searchBlock(this.body,e)}}class HJ extends Lh{constructor(e,r,i){super(),this.name=e,this.type=r,this.attributes=i}get astNodeType(){return"argument"}}class $J extends Lh{constructor(e,r){super(),this.condition=e,this.body=r}get astNodeType(){return"elseif"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class WJ extends Lh{constructor(e,r,i){super(),this.name=e,this.type=r,this.attributes=i}get astNodeType(){return"member"}}let qJ=class extends Lh{constructor(t,e){super(),this.name=t,this.value=e}get astNodeType(){return"attribute"}};var rt,Ge;(function(t){t[t.token=0]="token",t[t.keyword=1]="keyword",t[t.reserved=2]="reserved"})(Ge||(Ge={}));class He{constructor(e,r,i){this.name=e,this.type=r,this.rule=i}toString(){return this.name}}class ge{}rt=ge;ge.none=new He("",Ge.reserved,"");ge.eof=new He("EOF",Ge.token,"");ge.reserved={asm:new He("asm",Ge.reserved,"asm"),bf16:new He("bf16",Ge.reserved,"bf16"),do:new He("do",Ge.reserved,"do"),enum:new He("enum",Ge.reserved,"enum"),f16:new He("f16",Ge.reserved,"f16"),f64:new He("f64",Ge.reserved,"f64"),handle:new He("handle",Ge.reserved,"handle"),i8:new He("i8",Ge.reserved,"i8"),i16:new He("i16",Ge.reserved,"i16"),i64:new He("i64",Ge.reserved,"i64"),mat:new He("mat",Ge.reserved,"mat"),premerge:new He("premerge",Ge.reserved,"premerge"),regardless:new He("regardless",Ge.reserved,"regardless"),typedef:new He("typedef",Ge.reserved,"typedef"),u8:new He("u8",Ge.reserved,"u8"),u16:new He("u16",Ge.reserved,"u16"),u64:new He("u64",Ge.reserved,"u64"),unless:new He("unless",Ge.reserved,"unless"),using:new He("using",Ge.reserved,"using"),vec:new He("vec",Ge.reserved,"vec"),void:new He("void",Ge.reserved,"void")};ge.keywords={array:new He("array",Ge.keyword,"array"),atomic:new He("atomic",Ge.keyword,"atomic"),bool:new He("bool",Ge.keyword,"bool"),f32:new He("f32",Ge.keyword,"f32"),i32:new He("i32",Ge.keyword,"i32"),mat2x2:new He("mat2x2",Ge.keyword,"mat2x2"),mat2x3:new He("mat2x3",Ge.keyword,"mat2x3"),mat2x4:new He("mat2x4",Ge.keyword,"mat2x4"),mat3x2:new He("mat3x2",Ge.keyword,"mat3x2"),mat3x3:new He("mat3x3",Ge.keyword,"mat3x3"),mat3x4:new He("mat3x4",Ge.keyword,"mat3x4"),mat4x2:new He("mat4x2",Ge.keyword,"mat4x2"),mat4x3:new He("mat4x3",Ge.keyword,"mat4x3"),mat4x4:new He("mat4x4",Ge.keyword,"mat4x4"),ptr:new He("ptr",Ge.keyword,"ptr"),sampler:new He("sampler",Ge.keyword,"sampler"),sampler_comparison:new He("sampler_comparison",Ge.keyword,"sampler_comparison"),struct:new He("struct",Ge.keyword,"struct"),texture_1d:new He("texture_1d",Ge.keyword,"texture_1d"),texture_2d:new He("texture_2d",Ge.keyword,"texture_2d"),texture_2d_array:new He("texture_2d_array",Ge.keyword,"texture_2d_array"),texture_3d:new He("texture_3d",Ge.keyword,"texture_3d"),texture_cube:new He("texture_cube",Ge.keyword,"texture_cube"),texture_cube_array:new He("texture_cube_array",Ge.keyword,"texture_cube_array"),texture_multisampled_2d:new He("texture_multisampled_2d",Ge.keyword,"texture_multisampled_2d"),texture_storage_1d:new He("texture_storage_1d",Ge.keyword,"texture_storage_1d"),texture_storage_2d:new He("texture_storage_2d",Ge.keyword,"texture_storage_2d"),texture_storage_2d_array:new He("texture_storage_2d_array",Ge.keyword,"texture_storage_2d_array"),texture_storage_3d:new He("texture_storage_3d",Ge.keyword,"texture_storage_3d"),texture_depth_2d:new He("texture_depth_2d",Ge.keyword,"texture_depth_2d"),texture_depth_2d_array:new He("texture_depth_2d_array",Ge.keyword,"texture_depth_2d_array"),texture_depth_cube:new He("texture_depth_cube",Ge.keyword,"texture_depth_cube"),texture_depth_cube_array:new He("texture_depth_cube_array",Ge.keyword,"texture_depth_cube_array"),texture_depth_multisampled_2d:new He("texture_depth_multisampled_2d",Ge.keyword,"texture_depth_multisampled_2d"),texture_external:new He("texture_external",Ge.keyword,"texture_external"),u32:new He("u32",Ge.keyword,"u32"),vec2:new He("vec2",Ge.keyword,"vec2"),vec3:new He("vec3",Ge.keyword,"vec3"),vec4:new He("vec4",Ge.keyword,"vec4"),bitcast:new He("bitcast",Ge.keyword,"bitcast"),block:new He("block",Ge.keyword,"block"),break:new He("break",Ge.keyword,"break"),case:new He("case",Ge.keyword,"case"),continue:new He("continue",Ge.keyword,"continue"),continuing:new He("continuing",Ge.keyword,"continuing"),default:new He("default",Ge.keyword,"default"),diagnostic:new He("diagnostic",Ge.keyword,"diagnostic"),discard:new He("discard",Ge.keyword,"discard"),else:new He("else",Ge.keyword,"else"),enable:new He("enable",Ge.keyword,"enable"),fallthrough:new He("fallthrough",Ge.keyword,"fallthrough"),false:new He("false",Ge.keyword,"false"),fn:new He("fn",Ge.keyword,"fn"),for:new He("for",Ge.keyword,"for"),function:new He("function",Ge.keyword,"function"),if:new He("if",Ge.keyword,"if"),let:new He("let",Ge.keyword,"let"),const:new He("const",Ge.keyword,"const"),loop:new He("loop",Ge.keyword,"loop"),while:new He("while",Ge.keyword,"while"),private:new He("private",Ge.keyword,"private"),read:new He("read",Ge.keyword,"read"),read_write:new He("read_write",Ge.keyword,"read_write"),return:new He("return",Ge.keyword,"return"),requires:new He("requires",Ge.keyword,"requires"),storage:new He("storage",Ge.keyword,"storage"),switch:new He("switch",Ge.keyword,"switch"),true:new He("true",Ge.keyword,"true"),alias:new He("alias",Ge.keyword,"alias"),type:new He("type",Ge.keyword,"type"),uniform:new He("uniform",Ge.keyword,"uniform"),var:new He("var",Ge.keyword,"var"),override:new He("override",Ge.keyword,"override"),workgroup:new He("workgroup",Ge.keyword,"workgroup"),write:new He("write",Ge.keyword,"write"),r8unorm:new He("r8unorm",Ge.keyword,"r8unorm"),r8snorm:new He("r8snorm",Ge.keyword,"r8snorm"),r8uint:new He("r8uint",Ge.keyword,"r8uint"),r8sint:new He("r8sint",Ge.keyword,"r8sint"),r16uint:new He("r16uint",Ge.keyword,"r16uint"),r16sint:new He("r16sint",Ge.keyword,"r16sint"),r16float:new He("r16float",Ge.keyword,"r16float"),rg8unorm:new He("rg8unorm",Ge.keyword,"rg8unorm"),rg8snorm:new He("rg8snorm",Ge.keyword,"rg8snorm"),rg8uint:new He("rg8uint",Ge.keyword,"rg8uint"),rg8sint:new He("rg8sint",Ge.keyword,"rg8sint"),r32uint:new He("r32uint",Ge.keyword,"r32uint"),r32sint:new He("r32sint",Ge.keyword,"r32sint"),r32float:new He("r32float",Ge.keyword,"r32float"),rg16uint:new He("rg16uint",Ge.keyword,"rg16uint"),rg16sint:new He("rg16sint",Ge.keyword,"rg16sint"),rg16float:new He("rg16float",Ge.keyword,"rg16float"),rgba8unorm:new He("rgba8unorm",Ge.keyword,"rgba8unorm"),rgba8unorm_srgb:new He("rgba8unorm_srgb",Ge.keyword,"rgba8unorm_srgb"),rgba8snorm:new He("rgba8snorm",Ge.keyword,"rgba8snorm"),rgba8uint:new He("rgba8uint",Ge.keyword,"rgba8uint"),rgba8sint:new He("rgba8sint",Ge.keyword,"rgba8sint"),bgra8unorm:new He("bgra8unorm",Ge.keyword,"bgra8unorm"),bgra8unorm_srgb:new He("bgra8unorm_srgb",Ge.keyword,"bgra8unorm_srgb"),rgb10a2unorm:new He("rgb10a2unorm",Ge.keyword,"rgb10a2unorm"),rg11b10float:new He("rg11b10float",Ge.keyword,"rg11b10float"),rg32uint:new He("rg32uint",Ge.keyword,"rg32uint"),rg32sint:new He("rg32sint",Ge.keyword,"rg32sint"),rg32float:new He("rg32float",Ge.keyword,"rg32float"),rgba16uint:new He("rgba16uint",Ge.keyword,"rgba16uint"),rgba16sint:new He("rgba16sint",Ge.keyword,"rgba16sint"),rgba16float:new He("rgba16float",Ge.keyword,"rgba16float"),rgba32uint:new He("rgba32uint",Ge.keyword,"rgba32uint"),rgba32sint:new He("rgba32sint",Ge.keyword,"rgba32sint"),rgba32float:new He("rgba32float",Ge.keyword,"rgba32float"),static_assert:new He("static_assert",Ge.keyword,"static_assert")};ge.tokens={decimal_float_literal:new He("decimal_float_literal",Ge.token,/((-?[0-9]*\.[0-9]+|-?[0-9]+\.[0-9]*)((e|E)(\+|-)?[0-9]+)?f?)|(-?[0-9]+(e|E)(\+|-)?[0-9]+f?)|([0-9]+f)/),hex_float_literal:new He("hex_float_literal",Ge.token,/-?0x((([0-9a-fA-F]*\.[0-9a-fA-F]+|[0-9a-fA-F]+\.[0-9a-fA-F]*)((p|P)(\+|-)?[0-9]+f?)?)|([0-9a-fA-F]+(p|P)(\+|-)?[0-9]+f?))/),int_literal:new He("int_literal",Ge.token,/-?0x[0-9a-fA-F]+|0i?|-?[1-9][0-9]*i?/),uint_literal:new He("uint_literal",Ge.token,/0x[0-9a-fA-F]+u|0u|[1-9][0-9]*u/),ident:new He("ident",Ge.token,/[_a-zA-Z][0-9a-zA-Z_]*/),and:new He("and",Ge.token,"&"),and_and:new He("and_and",Ge.token,"&&"),arrow:new He("arrow ",Ge.token,"->"),attr:new He("attr",Ge.token,"@"),forward_slash:new He("forward_slash",Ge.token,"/"),bang:new He("bang",Ge.token,"!"),bracket_left:new He("bracket_left",Ge.token,"["),bracket_right:new He("bracket_right",Ge.token,"]"),brace_left:new He("brace_left",Ge.token,"{"),brace_right:new He("brace_right",Ge.token,"}"),colon:new He("colon",Ge.token,":"),comma:new He("comma",Ge.token,","),equal:new He("equal",Ge.token,"="),equal_equal:new He("equal_equal",Ge.token,"=="),not_equal:new He("not_equal",Ge.token,"!="),greater_than:new He("greater_than",Ge.token,">"),greater_than_equal:new He("greater_than_equal",Ge.token,">="),shift_right:new He("shift_right",Ge.token,">>"),less_than:new He("less_than",Ge.token,"<"),less_than_equal:new He("less_than_equal",Ge.token,"<="),shift_left:new He("shift_left",Ge.token,"<<"),modulo:new He("modulo",Ge.token,"%"),minus:new He("minus",Ge.token,"-"),minus_minus:new He("minus_minus",Ge.token,"--"),period:new He("period",Ge.token,"."),plus:new He("plus",Ge.token,"+"),plus_plus:new He("plus_plus",Ge.token,"++"),or:new He("or",Ge.token,"|"),or_or:new He("or_or",Ge.token,"||"),paren_left:new He("paren_left",Ge.token,"("),paren_right:new He("paren_right",Ge.token,")"),semicolon:new He("semicolon",Ge.token,";"),star:new He("star",Ge.token,"*"),tilde:new He("tilde",Ge.token,"~"),underscore:new He("underscore",Ge.token,"_"),xor:new He("xor",Ge.token,"^"),plus_equal:new He("plus_equal",Ge.token,"+="),minus_equal:new He("minus_equal",Ge.token,"-="),times_equal:new He("times_equal",Ge.token,"*="),division_equal:new He("division_equal",Ge.token,"/="),modulo_equal:new He("modulo_equal",Ge.token,"%="),and_equal:new He("and_equal",Ge.token,"&="),or_equal:new He("or_equal",Ge.token,"|="),xor_equal:new He("xor_equal",Ge.token,"^="),shift_right_equal:new He("shift_right_equal",Ge.token,">>="),shift_left_equal:new He("shift_left_equal",Ge.token,"<<=")};ge.simpleTokens={"@":rt.tokens.attr,"{":rt.tokens.brace_left,"}":rt.tokens.brace_right,":":rt.tokens.colon,",":rt.tokens.comma,"(":rt.tokens.paren_left,")":rt.tokens.paren_right,";":rt.tokens.semicolon};ge.literalTokens={"&":rt.tokens.and,"&&":rt.tokens.and_and,"->":rt.tokens.arrow,"/":rt.tokens.forward_slash,"!":rt.tokens.bang,"[":rt.tokens.bracket_left,"]":rt.tokens.bracket_right,"=":rt.tokens.equal,"==":rt.tokens.equal_equal,"!=":rt.tokens.not_equal,">":rt.tokens.greater_than,">=":rt.tokens.greater_than_equal,">>":rt.tokens.shift_right,"<":rt.tokens.less_than,"<=":rt.tokens.less_than_equal,"<<":rt.tokens.shift_left,"%":rt.tokens.modulo,"-":rt.tokens.minus,"--":rt.tokens.minus_minus,".":rt.tokens.period,"+":rt.tokens.plus,"++":rt.tokens.plus_plus,"|":rt.tokens.or,"||":rt.tokens.or_or,"*":rt.tokens.star,"~":rt.tokens.tilde,_:rt.tokens.underscore,"^":rt.tokens.xor,"+=":rt.tokens.plus_equal,"-=":rt.tokens.minus_equal,"*=":rt.tokens.times_equal,"/=":rt.tokens.division_equal,"%=":rt.tokens.modulo_equal,"&=":rt.tokens.and_equal,"|=":rt.tokens.or_equal,"^=":rt.tokens.xor_equal,">>=":rt.tokens.shift_right_equal,"<<=":rt.tokens.shift_left_equal};ge.regexTokens={decimal_float_literal:rt.tokens.decimal_float_literal,hex_float_literal:rt.tokens.hex_float_literal,int_literal:rt.tokens.int_literal,uint_literal:rt.tokens.uint_literal,ident:rt.tokens.ident};ge.storage_class=[rt.keywords.function,rt.keywords.private,rt.keywords.workgroup,rt.keywords.uniform,rt.keywords.storage];ge.access_mode=[rt.keywords.read,rt.keywords.write,rt.keywords.read_write];ge.sampler_type=[rt.keywords.sampler,rt.keywords.sampler_comparison];ge.sampled_texture_type=[rt.keywords.texture_1d,rt.keywords.texture_2d,rt.keywords.texture_2d_array,rt.keywords.texture_3d,rt.keywords.texture_cube,rt.keywords.texture_cube_array];ge.multisampled_texture_type=[rt.keywords.texture_multisampled_2d];ge.storage_texture_type=[rt.keywords.texture_storage_1d,rt.keywords.texture_storage_2d,rt.keywords.texture_storage_2d_array,rt.keywords.texture_storage_3d];ge.depth_texture_type=[rt.keywords.texture_depth_2d,rt.keywords.texture_depth_2d_array,rt.keywords.texture_depth_cube,rt.keywords.texture_depth_cube_array,rt.keywords.texture_depth_multisampled_2d];ge.texture_external_type=[rt.keywords.texture_external];ge.any_texture_type=[...rt.sampled_texture_type,...rt.multisampled_texture_type,...rt.storage_texture_type,...rt.depth_texture_type,...rt.texture_external_type];ge.texel_format=[rt.keywords.r8unorm,rt.keywords.r8snorm,rt.keywords.r8uint,rt.keywords.r8sint,rt.keywords.r16uint,rt.keywords.r16sint,rt.keywords.r16float,rt.keywords.rg8unorm,rt.keywords.rg8snorm,rt.keywords.rg8uint,rt.keywords.rg8sint,rt.keywords.r32uint,rt.keywords.r32sint,rt.keywords.r32float,rt.keywords.rg16uint,rt.keywords.rg16sint,rt.keywords.rg16float,rt.keywords.rgba8unorm,rt.keywords.rgba8unorm_srgb,rt.keywords.rgba8snorm,rt.keywords.rgba8uint,rt.keywords.rgba8sint,rt.keywords.bgra8unorm,rt.keywords.bgra8unorm_srgb,rt.keywords.rgb10a2unorm,rt.keywords.rg11b10float,rt.keywords.rg32uint,rt.keywords.rg32sint,rt.keywords.rg32float,rt.keywords.rgba16uint,rt.keywords.rgba16sint,rt.keywords.rgba16float,rt.keywords.rgba32uint,rt.keywords.rgba32sint,rt.keywords.rgba32float];ge.const_literal=[rt.tokens.int_literal,rt.tokens.uint_literal,rt.tokens.decimal_float_literal,rt.tokens.hex_float_literal,rt.keywords.true,rt.keywords.false];ge.literal_or_ident=[rt.tokens.ident,rt.tokens.int_literal,rt.tokens.uint_literal,rt.tokens.decimal_float_literal,rt.tokens.hex_float_literal];ge.element_count_expression=[rt.tokens.int_literal,rt.tokens.uint_literal,rt.tokens.ident];ge.template_types=[rt.keywords.vec2,rt.keywords.vec3,rt.keywords.vec4,rt.keywords.mat2x2,rt.keywords.mat2x3,rt.keywords.mat2x4,rt.keywords.mat3x2,rt.keywords.mat3x3,rt.keywords.mat3x4,rt.keywords.mat4x2,rt.keywords.mat4x3,rt.keywords.mat4x4,rt.keywords.atomic,rt.keywords.bitcast,...rt.any_texture_type];ge.attribute_name=[rt.tokens.ident,rt.keywords.block,rt.keywords.diagnostic];ge.assignment_operators=[rt.tokens.equal,rt.tokens.plus_equal,rt.tokens.minus_equal,rt.tokens.times_equal,rt.tokens.division_equal,rt.tokens.modulo_equal,rt.tokens.and_equal,rt.tokens.or_equal,rt.tokens.xor_equal,rt.tokens.shift_right_equal,rt.tokens.shift_left_equal];ge.increment_operators=[rt.tokens.plus_plus,rt.tokens.minus_minus];class VP{constructor(e,r,i){this.type=e,this.lexeme=r,this.line=i}toString(){return this.lexeme}isTemplateType(){return ge.template_types.indexOf(this.type)!=-1}isArrayType(){return this.type==ge.keywords.array}isArrayOrTemplateType(){return this.isArrayType()||this.isTemplateType()}}class KJ{constructor(e){this._tokens=[],this._start=0,this._current=0,this._line=1,this._source=e??""}scanTokens(){for(;!this._isAtEnd();)if(this._start=this._current,!this.scanToken())throw`Invalid syntax at line ${this._line}`;return this._tokens.push(new VP(ge.eof,"",this._line)),this._tokens}scanToken(){let e=this._advance();if(e==`
`)return this._line++,!0;if(this._isWhitespace(e))return!0;if(e=="/"){if(this._peekAhead()=="/"){for(;e!=`
`;){if(this._isAtEnd())return!0;e=this._advance()}return this._line++,!0}else if(this._peekAhead()=="*"){this._advance();let c=1;for(;c>0;){if(this._isAtEnd())return!0;if(e=this._advance(),e==`
`)this._line++;else if(e=="*"){if(this._peekAhead()=="/"&&(this._advance(),c--,c==0))return!0}else e=="/"&&this._peekAhead()=="*"&&(this._advance(),c++)}return!0}}const r=ge.simpleTokens[e];if(r)return this._addToken(r),!0;let i=ge.none;const n=this._isAlpha(e),l=e==="_";if(this._isAlphaNumeric(e)){let c=this._peekAhead();for(;this._isAlphaNumeric(c);)e+=this._advance(),c=this._peekAhead()}if(n){const c=ge.keywords[e];if(c)return this._addToken(c),!0}if(n||l)return this._addToken(ge.tokens.ident),!0;for(;;){let c=this._findType(e);const o=this._peekAhead();if(e=="-"&&this._tokens.length>0){if(o=="=")return this._current++,e+=o,this._addToken(ge.tokens.minus_equal),!0;if(o=="-")return this._current++,e+=o,this._addToken(ge.tokens.minus_minus),!0;const m=this._tokens.length-1;if((ge.literal_or_ident.indexOf(this._tokens[m].type)!=-1||this._tokens[m].type==ge.tokens.paren_right)&&o!=">")return this._addToken(c),!0}if(e==">"&&(o==">"||o=="=")){let m=!1,b=this._tokens.length-1;for(let A=0;A<5&&b>=0&&ge.assignment_operators.indexOf(this._tokens[b].type)===-1;++A,--b)if(this._tokens[b].type===ge.tokens.less_than){b>0&&this._tokens[b-1].isArrayOrTemplateType()&&(m=!0);break}if(m)return this._addToken(c),!0}if(c===ge.none){let m=e,b=0;const A=2;for(let R=0;R<A;++R)if(m+=this._peekAhead(R),c=this._findType(m),c!==ge.none){b=R;break}if(c===ge.none)return i===ge.none?!1:(this._current--,this._addToken(i),!0);e=m,this._current+=b+1}if(i=c,this._isAtEnd())break;e+=this._advance()}return i===ge.none?!1:(this._addToken(i),!0)}_findType(e){for(const i in ge.regexTokens){const n=ge.regexTokens[i];if(this._match(e,n.rule))return n}return ge.literalTokens[e]||ge.none}_match(e,r){const i=r.exec(e);return i&&i.index==0&&i[0]==e}_isAtEnd(){return this._current>=this._source.length}_isAlpha(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"}_isAlphaNumeric(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"||e=="_"||e>="0"&&e<="9"}_isWhitespace(e){return e==" "||e=="	"||e=="\r"}_advance(e=0){let r=this._source[this._current];return e=e||0,e++,this._current+=e,r}_peekAhead(e=0){return e=e||0,this._current+e>=this._source.length?"\0":this._source[this._current+e]}_addToken(e){const r=this._source.substring(this._start,this._current);this._tokens.push(new VP(e,r,this._line))}}class ZJ{constructor(){this._tokens=[],this._current=0,this._currentLine=0,this._context=new bJ,this._deferArrayCountEval=[]}parse(e){this._initialize(e),this._deferArrayCountEval.length=0;const r=[];for(;!this._isAtEnd();){const i=this._global_decl_or_directive();if(!i)break;r.push(i)}if(this._deferArrayCountEval.length>0){for(const i of this._deferArrayCountEval){const n=i.arrayType,l=i.countNode;if(l instanceof D2){const c=l.name,o=this._context.constants.get(c);if(o)try{const m=o.evaluate(this._context);n.count=m}catch{}}}this._deferArrayCountEval.length=0}return r}_initialize(e){if(e)if(typeof e=="string"){const r=new KJ(e);this._tokens=r.scanTokens()}else this._tokens=e;else this._tokens=[];this._current=0}_error(e,r){return{token:e,message:r,toString:function(){return`${r}`}}}_isAtEnd(){return this._current>=this._tokens.length||this._peek().type==ge.eof}_match(e){if(e instanceof He)return this._check(e)?(this._advance(),!0):!1;for(let r=0,i=e.length;r<i;++r){const n=e[r];if(this._check(n))return this._advance(),!0}return!1}_consume(e,r){if(this._check(e))return this._advance();throw this._error(this._peek(),r)}_check(e){if(this._isAtEnd())return!1;const r=this._peek();if(e instanceof Array){const i=r.type;return e.indexOf(i)!=-1}return r.type==e}_advance(){var e,r;return this._currentLine=(r=(e=this._peek())===null||e===void 0?void 0:e.line)!==null&&r!==void 0?r:-1,this._isAtEnd()||this._current++,this._previous()}_peek(){return this._tokens[this._current]}_previous(){return this._tokens[this._current-1]}_global_decl_or_directive(){for(;this._match(ge.tokens.semicolon)&&!this._isAtEnd(););if(this._match(ge.keywords.alias)){const r=this._type_alias();return this._consume(ge.tokens.semicolon,"Expected ';'"),r}if(this._match(ge.keywords.diagnostic)){const r=this._diagnostic();return this._consume(ge.tokens.semicolon,"Expected ';'"),r}if(this._match(ge.keywords.requires)){const r=this._requires_directive();return this._consume(ge.tokens.semicolon,"Expected ';'"),r}if(this._match(ge.keywords.enable)){const r=this._enable_directive();return this._consume(ge.tokens.semicolon,"Expected ';'"),r}const e=this._attribute();if(this._check(ge.keywords.var)){const r=this._global_variable_decl();return r!=null&&(r.attributes=e),this._consume(ge.tokens.semicolon,"Expected ';'."),r}if(this._check(ge.keywords.override)){const r=this._override_variable_decl();return r!=null&&(r.attributes=e),this._consume(ge.tokens.semicolon,"Expected ';'."),r}if(this._check(ge.keywords.let)){const r=this._global_let_decl();return r!=null&&(r.attributes=e),this._consume(ge.tokens.semicolon,"Expected ';'."),r}if(this._check(ge.keywords.const)){const r=this._global_const_decl();return r!=null&&(r.attributes=e),this._consume(ge.tokens.semicolon,"Expected ';'."),r}if(this._check(ge.keywords.struct)){const r=this._struct_decl();return r!=null&&(r.attributes=e),r}if(this._check(ge.keywords.fn)){const r=this._function_decl();return r!=null&&(r.attributes=e),r}return null}_function_decl(){if(!this._match(ge.keywords.fn))return null;const e=this._currentLine,r=this._consume(ge.tokens.ident,"Expected function name.").toString();this._consume(ge.tokens.paren_left,"Expected '(' for function arguments.");const i=[];if(!this._check(ge.tokens.paren_right))do{if(this._check(ge.tokens.paren_right))break;const o=this._attribute(),m=this._consume(ge.tokens.ident,"Expected argument name.").toString();this._consume(ge.tokens.colon,"Expected ':' for argument type.");const b=this._attribute(),A=this._type_decl();A!=null&&(A.attributes=b,i.push(new HJ(m,A,o)))}while(this._match(ge.tokens.comma));this._consume(ge.tokens.paren_right,"Expected ')' after function arguments.");let n=null;if(this._match(ge.tokens.arrow)){const o=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=o)}const l=this._compound_statement(),c=this._currentLine;return new L2(r,i,n,l,e,c)}_compound_statement(){const e=[];for(this._consume(ge.tokens.brace_left,"Expected '{' for block.");!this._check(ge.tokens.brace_right);){const r=this._statement();r!==null&&e.push(r)}return this._consume(ge.tokens.brace_right,"Expected '}' for block."),e}_statement(){for(;this._match(ge.tokens.semicolon)&&!this._isAtEnd(););if(this._check(ge.tokens.attr)&&this._attribute(),this._check(ge.keywords.if))return this._if_statement();if(this._check(ge.keywords.switch))return this._switch_statement();if(this._check(ge.keywords.loop))return this._loop_statement();if(this._check(ge.keywords.for))return this._for_statement();if(this._check(ge.keywords.while))return this._while_statement();if(this._check(ge.keywords.continuing))return this._continuing_statement();if(this._check(ge.keywords.static_assert))return this._static_assert_statement();if(this._check(ge.tokens.brace_left))return this._compound_statement();let e=null;return this._check(ge.keywords.return)?e=this._return_statement():this._check([ge.keywords.var,ge.keywords.let,ge.keywords.const])?e=this._variable_statement():this._match(ge.keywords.discard)?e=new LJ:this._match(ge.keywords.break)?e=new OJ:this._match(ge.keywords.continue)?e=new DJ:e=this._increment_decrement_statement()||this._func_call_statement()||this._assignment_statement(),e!=null&&this._consume(ge.tokens.semicolon,"Expected ';' after statement."),e}_static_assert_statement(){if(!this._match(ge.keywords.static_assert))return null;const e=this._optional_paren_expression();return new xJ(e)}_while_statement(){if(!this._match(ge.keywords.while))return null;const e=this._optional_paren_expression();this._check(ge.tokens.attr)&&this._attribute();const r=this._compound_statement();return new wJ(e,r)}_continuing_statement(){if(!this._match(ge.keywords.continuing))return null;const e=this._compound_statement();return new EJ(e)}_for_statement(){if(!this._match(ge.keywords.for))return null;this._consume(ge.tokens.paren_left,"Expected '('.");const e=this._check(ge.tokens.semicolon)?null:this._for_init();this._consume(ge.tokens.semicolon,"Expected ';'.");const r=this._check(ge.tokens.semicolon)?null:this._short_circuit_or_expression();this._consume(ge.tokens.semicolon,"Expected ';'.");const i=this._check(ge.tokens.paren_right)?null:this._for_increment();this._consume(ge.tokens.paren_right,"Expected ')'."),this._check(ge.tokens.attr)&&this._attribute();const n=this._compound_statement();return new AJ(e,r,i,n)}_for_init(){return this._variable_statement()||this._func_call_statement()||this._assignment_statement()}_for_increment(){return this._func_call_statement()||this._increment_decrement_statement()||this._assignment_statement()}_variable_statement(){if(this._check(ge.keywords.var)){const e=this._variable_decl();if(e===null)throw this._error(this._peek(),"Variable declaration expected.");let r=null;return this._match(ge.tokens.equal)&&(r=this._short_circuit_or_expression()),new pp(e.name,e.type,e.storage,e.access,r)}if(this._match(ge.keywords.let)){const e=this._consume(ge.tokens.ident,"Expected name for let.").toString();let r=null;if(this._match(ge.tokens.colon)){const n=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=n)}this._consume(ge.tokens.equal,"Expected '=' for let.");const i=this._short_circuit_or_expression();return new O2(e,r,null,null,i)}if(this._match(ge.keywords.const)){const e=this._consume(ge.tokens.ident,"Expected name for const.").toString();let r=null;if(this._match(ge.tokens.colon)){const n=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=n)}this._consume(ge.tokens.equal,"Expected '=' for const.");const i=this._short_circuit_or_expression();return new FP(e,r,null,null,i)}return null}_increment_decrement_statement(){const e=this._current,r=this._unary_expression();if(r==null)return null;if(!this._check(ge.increment_operators))return this._current=e,null;const i=this._consume(ge.increment_operators,"Expected increment operator");return new TJ(i.type===ge.tokens.plus_plus?hg.increment:hg.decrement,r)}_assignment_statement(){let e=null;if(this._check(ge.tokens.brace_right))return null;let r=this._match(ge.tokens.underscore);if(r||(e=this._unary_expression()),!r&&e==null)return null;const i=this._consume(ge.assignment_operators,"Expected assignment operator."),n=this._short_circuit_or_expression();return new SJ(xy.parse(i.lexeme),e,n)}_func_call_statement(){if(!this._check(ge.tokens.ident))return null;const e=this._current,r=this._consume(ge.tokens.ident,"Expected function name."),i=this._argument_expression_list();return i===null?(this._current=e,null):new UL(r.lexeme,i)}_loop_statement(){if(!this._match(ge.keywords.loop))return null;this._check(ge.tokens.attr)&&this._attribute(),this._consume(ge.tokens.brace_left,"Expected '{' for loop.");const e=[];let r=this._statement();for(;r!==null;){if(Array.isArray(r))for(let n of r)e.push(n);else e.push(r);r=this._statement()}let i=null;return this._match(ge.keywords.continuing)&&(i=this._compound_statement()),this._consume(ge.tokens.brace_right,"Expected '}' for loop."),new CJ(e,i)}_switch_statement(){if(!this._match(ge.keywords.switch))return null;const e=this._optional_paren_expression();this._check(ge.tokens.attr)&&this._attribute(),this._consume(ge.tokens.brace_left,"Expected '{' for switch.");const r=this._switch_body();if(r==null||r.length==0)throw this._error(this._previous(),"Expected 'case' or 'default'.");return this._consume(ge.tokens.brace_right,"Expected '}' for switch."),new PJ(e,r)}_switch_body(){const e=[];if(this._match(ge.keywords.case)){const r=this._case_selectors();this._match(ge.tokens.colon),this._check(ge.tokens.attr)&&this._attribute(),this._consume(ge.tokens.brace_left,"Exected '{' for switch case.");const i=this._case_body();this._consume(ge.tokens.brace_right,"Exected '}' for switch case."),e.push(new VJ(r,i))}if(this._match(ge.keywords.default)){this._match(ge.tokens.colon),this._check(ge.tokens.attr)&&this._attribute(),this._consume(ge.tokens.brace_left,"Exected '{' for switch default.");const r=this._case_body();this._consume(ge.tokens.brace_right,"Exected '}' for switch default."),e.push(new GJ(r))}if(this._check([ge.keywords.default,ge.keywords.case])){const r=this._switch_body();e.push(r[0])}return e}_case_selectors(){const e=[this._shift_expression()];for(;this._match(ge.tokens.comma);)e.push(this._shift_expression());return e}_case_body(){if(this._match(ge.keywords.fallthrough))return this._consume(ge.tokens.semicolon,"Expected ';'"),[];let e=this._statement();if(e==null)return[];e instanceof Array||(e=[e]);const r=this._case_body();return r.length==0?e:[...e,r[0]]}_if_statement(){if(!this._match(ge.keywords.if))return null;const e=this._optional_paren_expression();this._check(ge.tokens.attr)&&this._attribute();const r=this._compound_statement();let i=[];this._match_elseif()&&(this._check(ge.tokens.attr)&&this._attribute(),i=this._elseif_statement(i));let n=null;return this._match(ge.keywords.else)&&(this._check(ge.tokens.attr)&&this._attribute(),n=this._compound_statement()),new RJ(e,r,i,n)}_match_elseif(){return this._tokens[this._current].type===ge.keywords.else&&this._tokens[this._current+1].type===ge.keywords.if?(this._advance(),this._advance(),!0):!1}_elseif_statement(e=[]){const r=this._optional_paren_expression(),i=this._compound_statement();return e.push(new $J(r,i)),this._match_elseif()&&(this._check(ge.tokens.attr)&&this._attribute(),this._elseif_statement(e)),e}_return_statement(){if(!this._match(ge.keywords.return))return null;const e=this._short_circuit_or_expression();return new MJ(e)}_short_circuit_or_expression(){let e=this._short_circuit_and_expr();for(;this._match(ge.tokens.or_or);)e=new mu(this._previous().toString(),e,this._short_circuit_and_expr());return e}_short_circuit_and_expr(){let e=this._inclusive_or_expression();for(;this._match(ge.tokens.and_and);)e=new mu(this._previous().toString(),e,this._inclusive_or_expression());return e}_inclusive_or_expression(){let e=this._exclusive_or_expression();for(;this._match(ge.tokens.or);)e=new mu(this._previous().toString(),e,this._exclusive_or_expression());return e}_exclusive_or_expression(){let e=this._and_expression();for(;this._match(ge.tokens.xor);)e=new mu(this._previous().toString(),e,this._and_expression());return e}_and_expression(){let e=this._equality_expression();for(;this._match(ge.tokens.and);)e=new mu(this._previous().toString(),e,this._equality_expression());return e}_equality_expression(){const e=this._relational_expression();return this._match([ge.tokens.equal_equal,ge.tokens.not_equal])?new mu(this._previous().toString(),e,this._relational_expression()):e}_relational_expression(){let e=this._shift_expression();for(;this._match([ge.tokens.less_than,ge.tokens.greater_than,ge.tokens.less_than_equal,ge.tokens.greater_than_equal]);)e=new mu(this._previous().toString(),e,this._shift_expression());return e}_shift_expression(){let e=this._additive_expression();for(;this._match([ge.tokens.shift_left,ge.tokens.shift_right]);)e=new mu(this._previous().toString(),e,this._additive_expression());return e}_additive_expression(){let e=this._multiplicative_expression();for(;this._match([ge.tokens.plus,ge.tokens.minus]);)e=new mu(this._previous().toString(),e,this._multiplicative_expression());return e}_multiplicative_expression(){let e=this._unary_expression();for(;this._match([ge.tokens.star,ge.tokens.forward_slash,ge.tokens.modulo]);)e=new mu(this._previous().toString(),e,this._unary_expression());return e}_unary_expression(){return this._match([ge.tokens.minus,ge.tokens.bang,ge.tokens.tilde,ge.tokens.star,ge.tokens.and])?new UJ(this._previous().toString(),this._unary_expression()):this._singular_expression()}_singular_expression(){const e=this._primary_expression(),r=this._postfix_expression();return r&&(e.postfix=r),e}_postfix_expression(){if(this._match(ge.tokens.bracket_left)){const e=this._short_circuit_or_expression();this._consume(ge.tokens.bracket_right,"Expected ']'.");const r=new jJ(e),i=this._postfix_expression();return i&&(r.postfix=i),r}if(this._match(ge.tokens.period)){const e=this._consume(ge.tokens.ident,"Expected member name."),r=this._postfix_expression(),i=new FJ(e.lexeme);return r&&(i.postfix=r),i}return null}_getStruct(e){return this._context.aliases.has(e)?this._context.aliases.get(e).type:this._context.structs.has(e)?this._context.structs.get(e):null}_primary_expression(){if(this._match(ge.tokens.ident)){const i=this._previous().toString();if(this._check(ge.tokens.paren_left)){const n=this._argument_expression_list(),l=this._getStruct(i);return l!=null?new Um(l,n):new WL(i,n)}if(this._context.constants.has(i)){const n=this._context.constants.get(i);return new zP(i,n.value)}return new D2(i)}if(this._match(ge.const_literal))return new jP(parseFloat(this._previous().toString()));if(this._check(ge.tokens.paren_left))return this._paren_expression();if(this._match(ge.keywords.bitcast)){this._consume(ge.tokens.less_than,"Expected '<'.");const i=this._type_decl();this._consume(ge.tokens.greater_than,"Expected '>'.");const n=this._paren_expression();return new zJ(i,n)}const e=this._type_decl(),r=this._argument_expression_list();return new Um(e,r)}_argument_expression_list(){if(!this._match(ge.tokens.paren_left))return null;const e=[];do{if(this._check(ge.tokens.paren_right))break;const r=this._short_circuit_or_expression();e.push(r)}while(this._match(ge.tokens.comma));return this._consume(ge.tokens.paren_right,"Expected ')' for agument list"),e}_optional_paren_expression(){this._match(ge.tokens.paren_left);const e=this._short_circuit_or_expression();return this._match(ge.tokens.paren_right),new UP([e])}_paren_expression(){this._consume(ge.tokens.paren_left,"Expected '('.");const e=this._short_circuit_or_expression();return this._consume(ge.tokens.paren_right,"Expected ')'."),new UP([e])}_struct_decl(){if(!this._match(ge.keywords.struct))return null;const e=this._currentLine,r=this._consume(ge.tokens.ident,"Expected name for struct.").toString();this._consume(ge.tokens.brace_left,"Expected '{' for struct body.");const i=[];for(;!this._check(ge.tokens.brace_right);){const c=this._attribute(),o=this._consume(ge.tokens.ident,"Expected variable name.").toString();this._consume(ge.tokens.colon,"Expected ':' for struct member type.");const m=this._attribute(),b=this._type_decl();b!=null&&(b.attributes=m),this._check(ge.tokens.brace_right)?this._match(ge.tokens.comma):this._consume(ge.tokens.comma,"Expected ',' for struct member."),i.push(new WJ(o,b,c))}this._consume(ge.tokens.brace_right,"Expected '}' after struct body.");const n=this._currentLine,l=new up(r,i,e,n);return this._context.structs.set(r,l),l}_global_variable_decl(){const e=this._variable_decl();return e&&this._match(ge.tokens.equal)&&(e.value=this._const_expression()),e}_override_variable_decl(){const e=this._override_decl();return e&&this._match(ge.tokens.equal)&&(e.value=this._const_expression()),e}_global_const_decl(){if(!this._match(ge.keywords.const))return null;const e=this._consume(ge.tokens.ident,"Expected variable name");let r=null;if(this._match(ge.tokens.colon)){const l=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=l)}let i=null;if(this._match(ge.tokens.equal)){const l=this._short_circuit_or_expression();if(l instanceof Um)i=l;else if(l instanceof zP&&l.initializer instanceof Um)i=l.initializer;else try{const c=l.evaluate(this._context);i=new jP(c)}catch{i=l}}const n=new FP(e.toString(),r,"","",i);return this._context.constants.set(n.name,n),n}_global_let_decl(){if(!this._match(ge.keywords.let))return null;const e=this._consume(ge.tokens.ident,"Expected variable name");let r=null;if(this._match(ge.tokens.colon)){const n=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=n)}let i=null;return this._match(ge.tokens.equal)&&(i=this._const_expression()),new O2(e.toString(),r,"","",i)}_const_expression(){return this._short_circuit_or_expression()}_variable_decl(){if(!this._match(ge.keywords.var))return null;let e="",r="";this._match(ge.tokens.less_than)&&(e=this._consume(ge.storage_class,"Expected storage_class.").toString(),this._match(ge.tokens.comma)&&(r=this._consume(ge.access_mode,"Expected access_mode.").toString()),this._consume(ge.tokens.greater_than,"Expected '>'."));const i=this._consume(ge.tokens.ident,"Expected variable name");let n=null;if(this._match(ge.tokens.colon)){const l=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=l)}return new pp(i.toString(),n,e,r,null)}_override_decl(){if(!this._match(ge.keywords.override))return null;const e=this._consume(ge.tokens.ident,"Expected variable name");let r=null;if(this._match(ge.tokens.colon)){const i=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=i)}return new jL(e.toString(),r,null)}_diagnostic(){this._consume(ge.tokens.paren_left,"Expected '('");const e=this._consume(ge.tokens.ident,"Expected severity control name.");this._consume(ge.tokens.comma,"Expected ','");const r=this._consume(ge.tokens.ident,"Expected diagnostic rule name.");return this._consume(ge.tokens.paren_right,"Expected ')'"),new BJ(e.toString(),r.toString())}_enable_directive(){const e=this._consume(ge.tokens.ident,"identity expected.");return new IJ(e.toString())}_requires_directive(){const e=[this._consume(ge.tokens.ident,"identity expected.").toString()];for(;this._match(ge.tokens.comma);){const r=this._consume(ge.tokens.ident,"identity expected.");e.push(r.toString())}return new kJ(e)}_type_alias(){const e=this._consume(ge.tokens.ident,"identity expected.");this._consume(ge.tokens.equal,"Expected '=' for type alias.");let r=this._type_decl();if(r===null)throw this._error(this._peek(),"Expected Type for Alias.");this._context.aliases.has(r.name)&&(r=this._context.aliases.get(r.name).type);const i=new VL(e.toString(),r);return this._context.aliases.set(i.name,i),i}_type_decl(){if(this._check([ge.tokens.ident,...ge.texel_format,ge.keywords.bool,ge.keywords.f32,ge.keywords.i32,ge.keywords.u32])){const i=this._advance(),n=i.toString();return this._context.structs.has(n)?this._context.structs.get(n):this._context.aliases.has(n)?this._context.aliases.get(n).type:new Op(i.toString())}let e=this._texture_sampler_types();if(e)return e;if(this._check(ge.template_types)){let i=this._advance().toString(),n=null,l=null;return this._match(ge.tokens.less_than)&&(n=this._type_decl(),l=null,this._match(ge.tokens.comma)&&(l=this._consume(ge.access_mode,"Expected access_mode for pointer").toString()),this._consume(ge.tokens.greater_than,"Expected '>' for type.")),new HL(i,n,l)}if(this._match(ge.keywords.ptr)){let i=this._previous().toString();this._consume(ge.tokens.less_than,"Expected '<' for pointer.");const n=this._consume(ge.storage_class,"Expected storage_class for pointer");this._consume(ge.tokens.comma,"Expected ',' for pointer.");const l=this._type_decl();let c=null;return this._match(ge.tokens.comma)&&(c=this._consume(ge.access_mode,"Expected access_mode for pointer").toString()),this._consume(ge.tokens.greater_than,"Expected '>' for pointer."),new NJ(i,n.toString(),l,c)}const r=this._attribute();if(this._match(ge.keywords.array)){let i=null,n=-1;const l=this._previous();let c=null;if(this._match(ge.tokens.less_than)){i=this._type_decl(),this._context.aliases.has(i.name)&&(i=this._context.aliases.get(i.name).type);let m="";if(this._match(ge.tokens.comma)){c=this._shift_expression();try{m=c.evaluate(this._context).toString(),c=null}catch{m="1"}}this._consume(ge.tokens.greater_than,"Expected '>' for array."),n=m?parseInt(m):0}const o=new $L(l.toString(),r,i,n);return c&&this._deferArrayCountEval.push({arrayType:o,countNode:c}),o}return null}_texture_sampler_types(){if(this._match(ge.sampler_type))return new H_(this._previous().toString(),null,null);if(this._match(ge.depth_texture_type))return new H_(this._previous().toString(),null,null);if(this._match(ge.sampled_texture_type)||this._match(ge.multisampled_texture_type)){const e=this._previous();this._consume(ge.tokens.less_than,"Expected '<' for sampler type.");const r=this._type_decl();return this._consume(ge.tokens.greater_than,"Expected '>' for sampler type."),new H_(e.toString(),r,null)}if(this._match(ge.storage_texture_type)){const e=this._previous();this._consume(ge.tokens.less_than,"Expected '<' for sampler type.");const r=this._consume(ge.texel_format,"Invalid texel format.").toString();this._consume(ge.tokens.comma,"Expected ',' after texel format.");const i=this._consume(ge.access_mode,"Expected access mode for storage texture type.").toString();return this._consume(ge.tokens.greater_than,"Expected '>' for sampler type."),new H_(e.toString(),r,i)}return null}_attribute(){let e=[];for(;this._match(ge.tokens.attr);){const r=this._consume(ge.attribute_name,"Expected attribute name"),i=new qJ(r.toString(),null);if(this._match(ge.tokens.paren_left)){if(i.value=this._consume(ge.literal_or_ident,"Expected attribute value").toString(),this._check(ge.tokens.comma)){this._advance();do{const n=this._consume(ge.literal_or_ident,"Expected attribute value").toString();i.value instanceof Array||(i.value=[i.value]),i.value.push(n)}while(this._match(ge.tokens.comma))}this._consume(ge.tokens.paren_right,"Expected ')'")}e.push(i)}return e.length==0?null:e}}class Qm{constructor(e,r){this.name=e,this.attributes=r,this.size=0}get isArray(){return!1}get isStruct(){return!1}get isTemplate(){return!1}}class GP{constructor(e,r,i){this.name=e,this.type=r,this.attributes=i,this.offset=0,this.size=0}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray?this.type.format:this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class nv extends Qm{constructor(e,r){super(e,r),this.members=[],this.align=0,this.startLine=-1,this.endLine=-1,this.inUse=!1}get isStruct(){return!0}}class Ux extends Qm{constructor(e,r){super(e,r),this.count=0,this.stride=0}get isArray(){return!0}}class HP extends Qm{constructor(e,r,i,n){super(e,i),this.format=r,this.access=n}get isTemplate(){return!0}}var Cd;(function(t){t[t.Uniform=0]="Uniform",t[t.Storage=1]="Storage",t[t.Texture=2]="Texture",t[t.Sampler=3]="Sampler",t[t.StorageTexture=4]="StorageTexture"})(Cd||(Cd={}));class sv{constructor(e,r,i,n,l,c,o){this.name=e,this.type=r,this.group=i,this.binding=n,this.attributes=l,this.resourceType=c,this.access=o}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get size(){return this.type.size}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray?this.type.format:this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class XJ{constructor(e,r){this.name=e,this.type=r}}class ov{constructor(e,r){this.align=e,this.size=r}}class YJ{constructor(e,r,i,n){this.name=e,this.type=r,this.locationType=i,this.location=n,this.interpolation=null}}class $P{constructor(e,r,i,n){this.name=e,this.type=r,this.locationType=i,this.location=n}}class JJ{constructor(e,r,i,n){this.name=e,this.type=r,this.attributes=i,this.id=n}}class QJ{constructor(e,r){this.name=e,this.type=r}}class eQ{constructor(e,r=null){this.stage=null,this.inputs=[],this.outputs=[],this.arguments=[],this.returnType=null,this.resources=[],this.overrides=[],this.startLine=-1,this.endLine=-1,this.inUse=!1,this.calls=new Set,this.name=e,this.stage=r}}class tQ{constructor(){this.vertex=[],this.fragment=[],this.compute=[]}}class rQ{constructor(e){this.resources=null,this.inUse=!1,this.info=null,this.node=e}}class wh{constructor(e){this.uniforms=[],this.storage=[],this.textures=[],this.samplers=[],this.aliases=[],this.overrides=[],this.structs=[],this.entry=new tQ,this.functions=[],this._types=new Map,this._functions=new Map,e&&this.update(e)}_isStorageTexture(e){return e.name=="texture_storage_1d"||e.name=="texture_storage_2d"||e.name=="texture_storage_2d_array"||e.name=="texture_storage_3d"}update(e){const r=new ZJ().parse(e);for(const i of r)i instanceof L2&&this._functions.set(i.name,new rQ(i));for(const i of r)if(i instanceof up){const n=this._getTypeInfo(i,null);n instanceof nv&&this.structs.push(n)}for(const i of r){if(i instanceof VL){this.aliases.push(this._getAliasInfo(i));continue}if(i instanceof jL){const n=i,l=this._getAttributeNum(n.attributes,"id",0),c=n.type!=null?this._getTypeInfo(n.type,n.attributes):null;this.overrides.push(new JJ(n.name,c,n.attributes,l));continue}if(this._isUniformVar(i)){const n=i,l=this._getAttributeNum(n.attributes,"group",0),c=this._getAttributeNum(n.attributes,"binding",0),o=this._getTypeInfo(n.type,n.attributes),m=new sv(n.name,o,l,c,n.attributes,Cd.Uniform,n.access);this.uniforms.push(m);continue}if(this._isStorageVar(i)){const n=i,l=this._getAttributeNum(n.attributes,"group",0),c=this._getAttributeNum(n.attributes,"binding",0),o=this._getTypeInfo(n.type,n.attributes),m=this._isStorageTexture(o),b=new sv(n.name,o,l,c,n.attributes,m?Cd.StorageTexture:Cd.Storage,n.access);this.storage.push(b);continue}if(this._isTextureVar(i)){const n=i,l=this._getAttributeNum(n.attributes,"group",0),c=this._getAttributeNum(n.attributes,"binding",0),o=this._getTypeInfo(n.type,n.attributes),m=this._isStorageTexture(o),b=new sv(n.name,o,l,c,n.attributes,m?Cd.StorageTexture:Cd.Texture,n.access);m?this.storage.push(b):this.textures.push(b);continue}if(this._isSamplerVar(i)){const n=i,l=this._getAttributeNum(n.attributes,"group",0),c=this._getAttributeNum(n.attributes,"binding",0),o=this._getTypeInfo(n.type,n.attributes),m=new sv(n.name,o,l,c,n.attributes,Cd.Sampler,n.access);this.samplers.push(m);continue}if(i instanceof L2){const n=this._getAttribute(i,"vertex"),l=this._getAttribute(i,"fragment"),c=this._getAttribute(i,"compute"),o=n||l||c,m=new eQ(i.name,o?.name);m.startLine=i.startLine,m.endLine=i.endLine,this.functions.push(m),this._functions.get(i.name).info=m,o?(this._functions.get(i.name).inUse=!0,m.inUse=!0,m.resources=this._findResources(i,!!o),m.inputs=this._getInputs(i.args),m.outputs=this._getOutputs(i.returnType),this.entry[o.name].push(m)):(m.arguments=i.args.map(b=>new QJ(b.name,this._getTypeInfo(b.type,b.attributes))),m.returnType=i.returnType?this._getTypeInfo(i.returnType,i.attributes):null);continue}}for(const i of this._functions.values())i.info&&(i.info.inUse=i.inUse,this._addCalls(i.node,i.info.calls));for(const i of this._functions.values())i.node.search(n=>{var l;if(n.astNodeType==="varExpr"){const c=n;for(const o of this.overrides)c.name==o.name&&((l=i.info)===null||l===void 0||l.overrides.push(o))}});for(const i of this.uniforms)this._markStructsInUse(i.type);for(const i of this.storage)this._markStructsInUse(i.type)}_markStructsInUse(e){if(e)if(e.isStruct){if(e.inUse=!0,e.members)for(const r of e.members)this._markStructsInUse(r.type)}else if(e.isArray)this._markStructsInUse(e.format);else if(e.isTemplate)e.format&&this._markStructsInUse(e.format);else{const r=this._getAlias(e.name);r&&this._markStructsInUse(r)}}_addCalls(e,r){var i;for(const n of e.calls){const l=(i=this._functions.get(n.name))===null||i===void 0?void 0:i.info;l&&r.add(l)}}findResource(e,r){for(const i of this.uniforms)if(i.group==e&&i.binding==r)return i;for(const i of this.storage)if(i.group==e&&i.binding==r)return i;for(const i of this.textures)if(i.group==e&&i.binding==r)return i;for(const i of this.samplers)if(i.group==e&&i.binding==r)return i;return null}_findResource(e){for(const r of this.uniforms)if(r.name==e)return r;for(const r of this.storage)if(r.name==e)return r;for(const r of this.textures)if(r.name==e)return r;for(const r of this.samplers)if(r.name==e)return r;return null}_markStructsFromAST(e){const r=this._getTypeInfo(e,null);this._markStructsInUse(r)}_findResources(e,r){const i=[],n=this,l=[];return e.search(c=>{if(c instanceof f1)l.push({});else if(c instanceof p1)l.pop();else if(c instanceof pp){const o=c;r&&o.type!==null&&this._markStructsFromAST(o.type),l.length>0&&(l[l.length-1][o.name]=o)}else if(c instanceof Um){const o=c;r&&o.type!==null&&this._markStructsFromAST(o.type)}else if(c instanceof O2){const o=c;r&&o.type!==null&&this._markStructsFromAST(o.type),l.length>0&&(l[l.length-1][o.name]=o)}else if(c instanceof D2){const o=c;if(l.length>0&&l[l.length-1][o.name])return;const m=n._findResource(o.name);m&&i.push(m)}else if(c instanceof WL){const o=c,m=n._functions.get(o.name);m&&(r&&(m.inUse=!0),e.calls.add(m.node),m.resources===null&&(m.resources=n._findResources(m.node,r)),i.push(...m.resources))}else if(c instanceof UL){const o=c,m=n._functions.get(o.name);m&&(r&&(m.inUse=!0),e.calls.add(m.node),m.resources===null&&(m.resources=n._findResources(m.node,r)),i.push(...m.resources))}}),[...new Map(i.map(c=>[c.name,c])).values()]}getBindGroups(){const e=[];function r(i,n){i>=e.length&&(e.length=i+1),e[i]===void 0&&(e[i]=[]),n>=e[i].length&&(e[i].length=n+1)}for(const i of this.uniforms){r(i.group,i.binding);const n=e[i.group];n[i.binding]=i}for(const i of this.storage){r(i.group,i.binding);const n=e[i.group];n[i.binding]=i}for(const i of this.textures){r(i.group,i.binding);const n=e[i.group];n[i.binding]=i}for(const i of this.samplers){r(i.group,i.binding);const n=e[i.group];n[i.binding]=i}return e}_getOutputs(e,r=void 0){if(r===void 0&&(r=[]),e instanceof up)this._getStructOutputs(e,r);else{const i=this._getOutputInfo(e);i!==null&&r.push(i)}return r}_getStructOutputs(e,r){for(const i of e.members)if(i.type instanceof up)this._getStructOutputs(i.type,r);else{const n=this._getAttribute(i,"location")||this._getAttribute(i,"builtin");if(n!==null){const l=this._getTypeInfo(i.type,i.type.attributes),c=this._parseInt(n.value),o=new $P(i.name,l,n.name,c);r.push(o)}}}_getOutputInfo(e){const r=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(r!==null){const i=this._getTypeInfo(e,e.attributes),n=this._parseInt(r.value);return new $P("",i,r.name,n)}return null}_getInputs(e,r=void 0){r===void 0&&(r=[]);for(const i of e)if(i.type instanceof up)this._getStructInputs(i.type,r);else{const n=this._getInputInfo(i);n!==null&&r.push(n)}return r}_getStructInputs(e,r){for(const i of e.members)if(i.type instanceof up)this._getStructInputs(i.type,r);else{const n=this._getInputInfo(i);n!==null&&r.push(n)}}_getInputInfo(e){const r=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(r!==null){const i=this._getAttribute(e,"interpolation"),n=this._getTypeInfo(e.type,e.attributes),l=this._parseInt(r.value),c=new YJ(e.name,n,r.name,l);return i!==null&&(c.interpolation=this._parseString(i.value)),c}return null}_parseString(e){return e instanceof Array&&(e=e[0]),e}_parseInt(e){e instanceof Array&&(e=e[0]);const r=parseInt(e);return isNaN(r)?e:r}_getAlias(e){for(const r of this.aliases)if(r.name==e)return r.type;return null}_getAliasInfo(e){return new XJ(e.name,this._getTypeInfo(e.type,null))}_getTypeInfo(e,r){if(this._types.has(e))return this._types.get(e);if(e instanceof $L){const n=e,l=n.format?this._getTypeInfo(n.format,n.attributes):null,c=new Ux(n.name,r);return c.format=l,c.count=n.count,this._types.set(e,c),this._updateTypeInfo(c),c}if(e instanceof up){const n=e,l=new nv(n.name,r);l.startLine=n.startLine,l.endLine=n.endLine;for(const c of n.members){const o=this._getTypeInfo(c.type,c.attributes);l.members.push(new GP(c.name,o,c.attributes))}return this._types.set(e,l),this._updateTypeInfo(l),l}if(e instanceof H_){const n=e,l=n.format instanceof Op,c=n.format?l?this._getTypeInfo(n.format,null):new Qm(n.format,null):null,o=new HP(n.name,c,r,n.access);return this._types.set(e,o),this._updateTypeInfo(o),o}if(e instanceof HL){const n=e,l=n.format?this._getTypeInfo(n.format,null):null,c=new HP(n.name,l,r,n.access);return this._types.set(e,c),this._updateTypeInfo(c),c}const i=new Qm(e.name,r);return this._types.set(e,i),this._updateTypeInfo(i),i}_updateTypeInfo(e){var r,i;const n=this._getTypeSize(e);if(e.size=(r=n?.size)!==null&&r!==void 0?r:0,e instanceof Ux&&e.format){const l=this._getTypeSize(e.format);e.stride=(i=l?.size)!==null&&i!==void 0?i:0,this._updateTypeInfo(e.format)}e instanceof nv&&this._updateStructInfo(e)}_updateStructInfo(e){var r;let i=0,n=0,l=0,c=0;for(let o=0,m=e.members.length;o<m;++o){const b=e.members[o],A=this._getTypeSize(b);if(!A)continue;(r=this._getAlias(b.type.name))!==null&&r!==void 0||b.type;const R=A.align,M=A.size;i=this._roundUp(R,i+n),n=M,l=i,c=Math.max(c,R),b.offset=i,b.size=M,this._updateTypeInfo(b.type)}e.size=this._roundUp(c,l+n),e.align=c}_getTypeSize(e){var r,i;if(e==null)return null;const n=this._getAttributeNum(e.attributes,"size",0),l=this._getAttributeNum(e.attributes,"align",0);if(e instanceof GP&&(e=e.type),e instanceof Qm){const c=this._getAlias(e.name);c!==null&&(e=c)}{const c=wh._typeInfo[e.name];if(c!==void 0){const o=((r=e.format)===null||r===void 0?void 0:r.name)==="f16"?2:1;return new ov(Math.max(l,c.align/o),Math.max(n,c.size/o))}}{const c=wh._typeInfo[e.name.substring(0,e.name.length-1)];if(c){const o=e.name[e.name.length-1]==="h"?2:1;return new ov(Math.max(l,c.align/o),Math.max(n,c.size/o))}}if(e instanceof Ux){let c=e,o=8,m=8;const b=this._getTypeSize(c.format);b!==null&&(m=b.size,o=b.align);const A=c.count,R=this._getAttributeNum((i=e?.attributes)!==null&&i!==void 0?i:null,"stride",this._roundUp(o,m));return m=A*R,n&&(m=n),new ov(Math.max(l,o),Math.max(n,m))}if(e instanceof nv){let c=0,o=0,m=0,b=0,A=0;for(const R of e.members){const M=this._getTypeSize(R.type);M!==null&&(c=Math.max(M.align,c),m=this._roundUp(M.align,m+b),b=M.size,A=m)}return o=this._roundUp(c,A+b),new ov(Math.max(l,c),Math.max(n,o))}return null}_isUniformVar(e){return e instanceof pp&&e.storage=="uniform"}_isStorageVar(e){return e instanceof pp&&e.storage=="storage"}_isTextureVar(e){return e instanceof pp&&e.type!==null&&wh._textureTypes.indexOf(e.type.name)!=-1}_isSamplerVar(e){return e instanceof pp&&e.type!==null&&wh._samplerTypes.indexOf(e.type.name)!=-1}_getAttribute(e,r){const i=e;if(!i||!i.attributes)return null;const n=i.attributes;for(let l of n)if(l.name==r)return l;return null}_getAttributeNum(e,r,i){if(e===null)return i;for(let n of e)if(n.name==r){let l=n!==null&&n.value!==null?n.value:i;return l instanceof Array&&(l=l[0]),typeof l=="number"?l:typeof l=="string"?parseInt(l):i}return i}_roundUp(e,r){return Math.ceil(r/e)*e}}wh._typeInfo={f16:{align:2,size:2},i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},atomic:{align:4,size:4},vec2:{align:8,size:8},vec3:{align:16,size:12},vec4:{align:16,size:16},mat2x2:{align:8,size:16},mat3x2:{align:8,size:24},mat4x2:{align:8,size:32},mat2x3:{align:16,size:32},mat3x3:{align:16,size:48},mat4x3:{align:16,size:64},mat2x4:{align:16,size:32},mat3x4:{align:16,size:48},mat4x4:{align:16,size:64}};wh._textureTypes=ge.any_texture_type.map(t=>t.name);wh._samplerTypes=ge.sampler_type.map(t=>t.name);function iQ(t){const e={attributes:[],bindings:[]};let r;try{r=nQ(t)}catch(l){return Pt.error(l.message)(),e}for(const l of r.uniforms){const c=[];for(const o of l.type?.members||[])c.push({name:o.name,type:WP(o.type)});e.bindings.push({type:"uniform",name:l.name,location:l.binding,group:l.group,members:c})}const i=r.entry.vertex[0],n=i?.inputs.length||0;for(let l=0;l<n;l++){const c=i.inputs[l];if(c.locationType==="location"){const o=WP(c.type);e.attributes.push({name:c.name,location:Number(c.location),type:o})}}return e}function WP(t){return t.format?`${t.name}<${t.format.name}>`:t.name}function nQ(t){try{return new wh(t)}catch(e){if(e instanceof Error)throw e;let r="WGSL parse error";throw typeof e=="object"&&e?.message&&(r+=`: ${e.message} `),typeof e=="object"&&e?.token&&(r+=e.token.line||""),new Error(r,{cause:e})}}const sQ=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;
const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;
const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;
const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01;
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03;
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04;
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06;
float sin_taylor_fp32(float a) {
float r, s, t, x;
if (a == 0.0) {
return 0.0;
}
x = -a * a;
s = a;
r = a;
r = r * x;
t = r * INVERSE_FACTORIAL_3;
s = s + t;
r = r * x;
t = r * INVERSE_FACTORIAL_5;
s = s + t;
r = r * x;
t = r * INVERSE_FACTORIAL_7;
s = s + t;
r = r * x;
t = r * INVERSE_FACTORIAL_9;
s = s + t;
return s;
}
void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
if (a == 0.0) {
sin_t = 0.0;
cos_t = 1.0;
}
sin_t = sin_taylor_fp32(a);
cos_t = sqrt(1.0 - sin_t * sin_t);
}
float tan_taylor_fp32(float a) {
float sin_a;
float cos_a;
if (a == 0.0) {
return 0.0;
}
float z = floor(a / TWO_PI);
float r = a - TWO_PI * z;
float t;
float q = floor(r / PI_2 + 0.5);
int j = int(q);
if (j < -2 || j > 2) {
return 1.0 / 0.0;
}
t = r - PI_2 * q;
q = floor(t / PI_16 + 0.5);
int k = int(q);
int abs_k = int(abs(float(k)));
if (abs_k > 4) {
return 1.0 / 0.0;
} else {
t = t - PI_16 * q;
}
float u = 0.0;
float v = 0.0;
float sin_t, cos_t;
float s, c;
sincos_taylor_fp32(t, sin_t, cos_t);
if (k == 0) {
s = sin_t;
c = cos_t;
} else {
if (abs(float(abs_k) - 1.0) < 0.5) {
u = COS_TABLE_0;
v = SIN_TABLE_0;
} else if (abs(float(abs_k) - 2.0) < 0.5) {
u = COS_TABLE_1;
v = SIN_TABLE_1;
} else if (abs(float(abs_k) - 3.0) < 0.5) {
u = COS_TABLE_2;
v = SIN_TABLE_2;
} else if (abs(float(abs_k) - 4.0) < 0.5) {
u = COS_TABLE_3;
v = SIN_TABLE_3;
}
if (k > 0) {
s = u * sin_t + v * cos_t;
c = u * cos_t - v * sin_t;
} else {
s = u * sin_t - v * cos_t;
c = u * cos_t + v * sin_t;
}
}
if (j == 0) {
sin_a = s;
cos_a = c;
} else if (j == 1) {
sin_a = c;
cos_a = -s;
} else if (j == -1) {
sin_a = -c;
cos_a = s;
} else {
sin_a = -s;
cos_a = -c;
}
return sin_a / cos_a;
}
#endif
float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
return tan_taylor_fp32(a);
#else
return tan(a);
#endif
}
`,oQ={name:"fp32",vs:sQ},aQ=[0,1,1,1],lQ=`uniform pickingUniforms {
float isActive;
float isAttribute;
float isHighlightActive;
float useFloatColors;
vec3 highlightedObjectColor;
vec4 highlightColor;
} picking;
out vec4 picking_vRGBcolor_Avalid;
vec3 picking_normalizeColor(vec3 color) {
return picking.useFloatColors > 0.5 ? color : color / 255.0;
}
vec4 picking_normalizeColor(vec4 color) {
return picking.useFloatColors > 0.5 ? color : color / 255.0;
}
bool picking_isColorZero(vec3 color) {
return dot(color, vec3(1.0)) < 0.00001;
}
bool picking_isColorValid(vec3 color) {
return dot(color, vec3(1.0)) > 0.00001;
}
bool isVertexHighlighted(vec3 vertexColor) {
vec3 highlightedObjectColor = picking_normalizeColor(picking.highlightedObjectColor);
return
bool(picking.isHighlightActive) && picking_isColorZero(abs(vertexColor - highlightedObjectColor));
}
void picking_setPickingColor(vec3 pickingColor) {
pickingColor = picking_normalizeColor(pickingColor);
if (bool(picking.isActive)) {
picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));
if (!bool(picking.isAttribute)) {
picking_vRGBcolor_Avalid.rgb = pickingColor;
}
} else {
picking_vRGBcolor_Avalid.a = float(isVertexHighlighted(pickingColor));
}
}
void picking_setPickingAttribute(float value) {
if (bool(picking.isAttribute)) {
picking_vRGBcolor_Avalid.r = value;
}
}
void picking_setPickingAttribute(vec2 value) {
if (bool(picking.isAttribute)) {
picking_vRGBcolor_Avalid.rg = value;
}
}
void picking_setPickingAttribute(vec3 value) {
if (bool(picking.isAttribute)) {
picking_vRGBcolor_Avalid.rgb = value;
}
}
`,cQ=`uniform pickingUniforms {
float isActive;
float isAttribute;
float isHighlightActive;
float useFloatColors;
vec3 highlightedObjectColor;
vec4 highlightColor;
} picking;
in vec4 picking_vRGBcolor_Avalid;
vec4 picking_filterHighlightColor(vec4 color) {
if (picking.isActive > 0.5) {
return color;
}
bool selected = bool(picking_vRGBcolor_Avalid.a);
if (selected) {
float highLightAlpha = picking.highlightColor.a;
float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
float highLightRatio = highLightAlpha / blendedAlpha;
vec3 blendedRGB = mix(color.rgb, picking.highlightColor.rgb, highLightRatio);
return vec4(blendedRGB, blendedAlpha);
} else {
return color;
}
}
vec4 picking_filterPickingColor(vec4 color) {
if (bool(picking.isActive)) {
if (picking_vRGBcolor_Avalid.a == 0.0) {
discard;
}
return picking_vRGBcolor_Avalid;
}
return color;
}
vec4 picking_filterColor(vec4 color) {
vec4 highlightColor = picking_filterHighlightColor(color);
return picking_filterPickingColor(highlightColor);
}
`,qP={name:"picking",vs:lQ,fs:cQ,uniformTypes:{isActive:"f32",isAttribute:"f32",isHighlightActive:"f32",useFloatColors:"f32",highlightedObjectColor:"vec3<f32>",highlightColor:"vec4<f32>"},defaultUniforms:{isActive:!1,isAttribute:!1,isHighlightActive:!1,useFloatColors:!0,highlightedObjectColor:[0,0,0],highlightColor:aQ},getUniforms:uQ};function uQ(t={},e){const r={};if(t.highlightedObjectColor!==void 0)if(t.highlightedObjectColor===null)r.isHighlightActive=!1;else{r.isHighlightActive=!0;const i=t.highlightedObjectColor.slice(0,3);r.highlightedObjectColor=i}if(t.highlightColor){const i=Array.from(t.highlightColor,n=>n/255);Number.isFinite(i[3])||(i[3]=1),r.highlightColor=i}return t.isActive!==void 0&&(r.isActive=!!t.isActive,r.isAttribute=!!t.isAttribute),t.useFloatColors!==void 0&&(r.useFloatColors=!!t.useFloatColors),r}function ZL(t,e=[],r=0){const i=Math.fround(t),n=t-i;return e[r]=i,e[r+1]=n,e}function hQ(t){return t-Math.fround(t)}function dQ(t){const e=new Float32Array(32);for(let r=0;r<4;++r)for(let i=0;i<4;++i){const n=r*4+i;ZL(t[i*4+r],e,n*2)}return e}const fQ=`uniform float ONE;
vec2 split(float a) {
const float SPLIT = 4097.0;
float t = a * SPLIT;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
float a_hi = t * ONE - (t - a);
float a_lo = a * ONE - a_hi;
#else
float a_hi = t - (t - a);
float a_lo = a - a_hi;
#endif
return vec2(a_hi, a_lo);
}
vec2 split2(vec2 a) {
vec2 b = split(a.x);
b.y += a.y;
return b;
}
vec2 quickTwoSum(float a, float b) {
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
float sum = (a + b) * ONE;
float err = b - (sum - a) * ONE;
#else
float sum = a + b;
float err = b - (sum - a);
#endif
return vec2(sum, err);
}
vec2 twoSum(float a, float b) {
float s = (a + b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
float v = (s * ONE - a) * ONE;
float err = (a - (s - v) * ONE) * ONE * ONE * ONE + (b - v);
#else
float v = s - a;
float err = (a - (s - v)) + (b - v);
#endif
return vec2(s, err);
}
vec2 twoSub(float a, float b) {
float s = (a - b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
float v = (s * ONE - a) * ONE;
float err = (a - (s - v) * ONE) * ONE * ONE * ONE - (b + v);
#else
float v = s - a;
float err = (a - (s - v)) - (b + v);
#endif
return vec2(s, err);
}
vec2 twoSqr(float a) {
float prod = a * a;
vec2 a_fp64 = split(a);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
float err = ((a_fp64.x * a_fp64.x - prod) * ONE + 2.0 * a_fp64.x *
a_fp64.y * ONE * ONE) + a_fp64.y * a_fp64.y * ONE * ONE * ONE;
#else
float err = ((a_fp64.x * a_fp64.x - prod) + 2.0 * a_fp64.x * a_fp64.y) + a_fp64.y * a_fp64.y;
#endif
return vec2(prod, err);
}
vec2 twoProd(float a, float b) {
float prod = a * b;
vec2 a_fp64 = split(a);
vec2 b_fp64 = split(b);
float err = ((a_fp64.x * b_fp64.x - prod) + a_fp64.x * b_fp64.y +
a_fp64.y * b_fp64.x) + a_fp64.y * b_fp64.y;
return vec2(prod, err);
}
vec2 sum_fp64(vec2 a, vec2 b) {
vec2 s, t;
s = twoSum(a.x, b.x);
t = twoSum(a.y, b.y);
s.y += t.x;
s = quickTwoSum(s.x, s.y);
s.y += t.y;
s = quickTwoSum(s.x, s.y);
return s;
}
vec2 sub_fp64(vec2 a, vec2 b) {
vec2 s, t;
s = twoSub(a.x, b.x);
t = twoSub(a.y, b.y);
s.y += t.x;
s = quickTwoSum(s.x, s.y);
s.y += t.y;
s = quickTwoSum(s.x, s.y);
return s;
}
vec2 mul_fp64(vec2 a, vec2 b) {
vec2 prod = twoProd(a.x, b.x);
prod.y += a.x * b.y;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
prod = split2(prod);
#endif
prod = quickTwoSum(prod.x, prod.y);
prod.y += a.y * b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
prod = split2(prod);
#endif
prod = quickTwoSum(prod.x, prod.y);
return prod;
}
vec2 div_fp64(vec2 a, vec2 b) {
float xn = 1.0 / b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
vec2 yn = mul_fp64(a, vec2(xn, 0));
#else
vec2 yn = a * xn;
#endif
float diff = (sub_fp64(a, mul_fp64(b, yn))).x;
vec2 prod = twoProd(xn, diff);
return sum_fp64(yn, prod);
}
vec2 sqrt_fp64(vec2 a) {
if (a.x == 0.0 && a.y == 0.0) return vec2(0.0, 0.0);
if (a.x < 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);
float x = 1.0 / sqrt(a.x);
float yn = a.x * x;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
vec2 yn_sqr = twoSqr(yn) * ONE;
#else
vec2 yn_sqr = twoSqr(yn);
#endif
float diff = sub_fp64(a, yn_sqr).x;
vec2 prod = twoProd(x * 0.5, diff);
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
return sum_fp64(split(yn), prod);
#else
return sum_fp64(vec2(yn, 0.0), prod);
#endif
}
`,pQ={ONE:1};function mQ(){return pQ}const gQ={name:"fp64-arithmetic",vs:fQ,getUniforms:mQ,fp64ify:ZL,fp64LowPart:hQ,fp64ifyMatrix4:dQ},_Q=1/Math.PI*180,yQ=1/180*Math.PI,vQ={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1};globalThis.mathgl=globalThis.mathgl||{config:{...vQ}};const Cs=globalThis.mathgl.config;function bQ(t,{precision:e=Cs.precision}={}){return t=AQ(t),`${parseFloat(t.toPrecision(e))}`}function zd(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}function xQ(t){return EQ(t)}function wQ(t){return bc(t)}function EQ(t,e){return QA(t,r=>r*yQ,e)}function bc(t,e){return QA(t,r=>r*_Q,e)}function Eh(t,e,r){return QA(t,i=>Math.max(e,Math.min(r,i)))}function m1(t,e,r){return zd(t)?t.map((i,n)=>m1(i,e[n],r)):r*e+(1-r)*t}function Pc(t,e,r){const i=Cs.EPSILON;r&&(Cs.EPSILON=r);try{if(t===e)return!0;if(zd(t)&&zd(e)){if(t.length!==e.length)return!1;for(let n=0;n<t.length;++n)if(!Pc(t[n],e[n]))return!1;return!0}return t&&t.equals?t.equals(e):e&&e.equals?e.equals(t):typeof t=="number"&&typeof e=="number"?Math.abs(t-e)<=Cs.EPSILON*Math.max(1,Math.abs(t),Math.abs(e)):!1}finally{Cs.EPSILON=i}}function AQ(t){return Math.round(t/Cs.EPSILON)*Cs.EPSILON}function TQ(t){return t.clone?t.clone():new Array(t.length)}function QA(t,e,r){if(zd(t)){const i=t;r=r||TQ(i);for(let n=0;n<r.length&&n<i.length;++n){const l=typeof t=="number"?t:t[n];r[n]=e(l,n,r)}return r}return e(t)}class eT extends Array{clone(){return new this.constructor().copy(this)}fromArray(e,r=0){for(let i=0;i<this.ELEMENTS;++i)this[i]=e[i+r];return this.check()}toArray(e=[],r=0){for(let i=0;i<this.ELEMENTS;++i)e[r+i]=this[i];return e}toObject(e){return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:zd(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(Cs)}formatString(e){let r="";for(let i=0;i<this.ELEMENTS;++i)r+=(i>0?", ":"")+bQ(this[i],e);return`${e.printTypes?this.constructor.name:""}[${r}]`}equals(e){if(!e||this.length!==e.length)return!1;for(let r=0;r<this.ELEMENTS;++r)if(!Pc(this[r],e[r]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let r=0;r<this.ELEMENTS;++r)if(this[r]!==e[r])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,r,i){if(i===void 0)return this.lerp(this,e,r);for(let n=0;n<this.ELEMENTS;++n){const l=e[n],c=typeof r=="number"?r:r[n];this[n]=l+i*(c-l)}return this.check()}min(e){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(e[r],this[r]);return this.check()}max(e){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.max(e[r],this[r]);return this.check()}clamp(e,r){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(Math.max(this[i],e[i]),r[i]);return this.check()}add(...e){for(const r of e)for(let i=0;i<this.ELEMENTS;++i)this[i]+=r[i];return this.check()}subtract(...e){for(const r of e)for(let i=0;i<this.ELEMENTS;++i)this[i]-=r[i];return this.check()}scale(e){if(typeof e=="number")for(let r=0;r<this.ELEMENTS;++r)this[r]*=e;else for(let r=0;r<this.ELEMENTS&&r<e.length;++r)this[r]*=e[r];return this.check()}multiplyByScalar(e){for(let r=0;r<this.ELEMENTS;++r)this[r]*=e;return this.check()}check(){if(Cs.debug&&!this.validate())throw new Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let e=this.length===this.ELEMENTS;for(let r=0;r<this.ELEMENTS;++r)e=e&&Number.isFinite(this[r]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let r=0;r<this.ELEMENTS;++r)this[r]=e;return this.check()}addScalar(e){for(let r=0;r<this.ELEMENTS;++r)this[r]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let r=0;r<this.ELEMENTS;++r)this[r]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,r){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(Math.max(this[i],e),r);return this.check()}get elements(){return this}}function SQ(t,e){if(t.length!==e)return!1;for(let r=0;r<t.length;++r)if(!Number.isFinite(t[r]))return!1;return!0}function gi(t){if(!Number.isFinite(t))throw new Error(`Invalid number ${JSON.stringify(t)}`);return t}function sy(t,e,r=""){if(Cs.debug&&!SQ(t,e))throw new Error(`math.gl: ${r} some fields set to invalid numbers'`);return t}function wc(t,e){if(!t)throw new Error(`math.gl assertion ${e}`)}class tT extends eT{get x(){return this[0]}set x(e){this[0]=gi(e)}get y(){return this[1]}set y(e){this[1]=gi(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let r=0;r<this.ELEMENTS;++r)e+=this[r]*this[r];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let r=0;for(let i=0;i<this.ELEMENTS;++i){const n=this[i]-e[i];r+=n*n}return gi(r)}dot(e){let r=0;for(let i=0;i<this.ELEMENTS;++i)r+=this[i]*e[i];return gi(r)}normalize(){const e=this.magnitude();if(e!==0)for(let r=0;r<this.ELEMENTS;++r)this[r]/=e;return this.check()}multiply(...e){for(const r of e)for(let i=0;i<this.ELEMENTS;++i)this[i]*=r[i];return this.check()}divide(...e){for(const r of e)for(let i=0;i<this.ELEMENTS;++i)this[i]/=r[i];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return wc(e>=0&&e<this.ELEMENTS,"index is out of range"),gi(this[e])}setComponent(e,r){return wc(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=r,this.check()}addVectors(e,r){return this.copy(e).add(r)}subVectors(e,r){return this.copy(e).subtract(r)}multiplyVectors(e,r){return this.copy(e).multiply(r)}addScaledVector(e,r){return this.add(new this.constructor(e).multiplyScalar(r))}}const oy=1e-6;let Mc=typeof Float32Array<"u"?Float32Array:Array;function CQ(){const t=new Mc(2);return Mc!=Float32Array&&(t[0]=0,t[1]=0),t}function KP(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t}function PQ(t,e){return t[0]=-e[0],t[1]=-e[1],t}function XL(t,e,r,i){const n=e[0],l=e[1];return t[0]=n+i*(r[0]-n),t[1]=l+i*(r[1]-l),t}function RQ(t,e,r){const i=e[0],n=e[1];return t[0]=r[0]*i+r[2]*n,t[1]=r[1]*i+r[3]*n,t}function MQ(t,e,r){const i=e[0],n=e[1];return t[0]=r[0]*i+r[2]*n+r[4],t[1]=r[1]*i+r[3]*n+r[5],t}function YL(t,e,r){const i=e[0],n=e[1];return t[0]=r[0]*i+r[3]*n+r[6],t[1]=r[1]*i+r[4]*n+r[7],t}function JL(t,e,r){const i=e[0],n=e[1];return t[0]=r[0]*i+r[4]*n+r[12],t[1]=r[1]*i+r[5]*n+r[13],t}(function(){const t=CQ();return function(e,r,i,n,l,c){let o,m;for(r||(r=2),i||(i=0),n?m=Math.min(n*r+i,e.length):m=e.length,o=i;o<m;o+=r)t[0]=e[o],t[1]=e[o+1],l(t,t,c),e[o]=t[0],e[o+1]=t[1];return e}})();function QL(t,e,r){const i=e[0],n=e[1],l=r[3]*i+r[7]*n||1;return t[0]=(r[0]*i+r[4]*n)/l,t[1]=(r[1]*i+r[5]*n)/l,t}function eO(t,e,r){const i=e[0],n=e[1],l=e[2],c=r[3]*i+r[7]*n+r[11]*l||1;return t[0]=(r[0]*i+r[4]*n+r[8]*l)/c,t[1]=(r[1]*i+r[5]*n+r[9]*l)/c,t[2]=(r[2]*i+r[6]*n+r[10]*l)/c,t}function IQ(t,e,r){const i=e[0],n=e[1];return t[0]=r[0]*i+r[2]*n,t[1]=r[1]*i+r[3]*n,t[2]=e[2],t}function kQ(t,e,r){const i=e[0],n=e[1];return t[0]=r[0]*i+r[2]*n,t[1]=r[1]*i+r[3]*n,t[2]=e[2],t[3]=e[3],t}function tO(t,e,r){const i=e[0],n=e[1],l=e[2];return t[0]=r[0]*i+r[3]*n+r[6]*l,t[1]=r[1]*i+r[4]*n+r[7]*l,t[2]=r[2]*i+r[5]*n+r[8]*l,t[3]=e[3],t}class rT extends tT{constructor(e=0,r=0){super(2),zd(e)&&arguments.length===1?this.copy(e):(Cs.debug&&(gi(e),gi(r)),this[0]=e,this[1]=r)}set(e,r){return this[0]=e,this[1]=r,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this.check()}fromObject(e){return Cs.debug&&(gi(e.x),gi(e.y)),this[0]=e.x,this[1]=e.y,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e}get ELEMENTS(){return 2}horizontalAngle(){return Math.atan2(this.y,this.x)}verticalAngle(){return Math.atan2(this.x,this.y)}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return JL(this,this,e),this.check()}transformAsVector(e){return QL(this,this,e),this.check()}transformByMatrix3(e){return YL(this,this,e),this.check()}transformByMatrix2x3(e){return MQ(this,this,e),this.check()}transformByMatrix2(e){return RQ(this,this,e),this.check()}}function rO(){const t=new Mc(3);return Mc!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function iO(t){const e=t[0],r=t[1],i=t[2];return Math.sqrt(e*e+r*r+i*i)}function ZP(t,e,r){const i=new Mc(3);return i[0]=t,i[1]=e,i[2]=r,i}function BQ(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t}function LQ(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function OQ(t,e){const r=e[0],i=e[1],n=e[2];let l=r*r+i*i+n*n;return l>0&&(l=1/Math.sqrt(l)),t[0]=e[0]*l,t[1]=e[1]*l,t[2]=e[2]*l,t}function iT(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function Vv(t,e,r){const i=e[0],n=e[1],l=e[2],c=r[0],o=r[1],m=r[2];return t[0]=n*m-l*o,t[1]=l*c-i*m,t[2]=i*o-n*c,t}function nT(t,e,r){const i=e[0],n=e[1],l=e[2];let c=r[3]*i+r[7]*n+r[11]*l+r[15];return c=c||1,t[0]=(r[0]*i+r[4]*n+r[8]*l+r[12])/c,t[1]=(r[1]*i+r[5]*n+r[9]*l+r[13])/c,t[2]=(r[2]*i+r[6]*n+r[10]*l+r[14])/c,t}function nO(t,e,r){const i=e[0],n=e[1],l=e[2];return t[0]=i*r[0]+n*r[3]+l*r[6],t[1]=i*r[1]+n*r[4]+l*r[7],t[2]=i*r[2]+n*r[5]+l*r[8],t}function sO(t,e,r){const i=r[0],n=r[1],l=r[2],c=r[3],o=e[0],m=e[1],b=e[2];let A=n*b-l*m,R=l*o-i*b,M=i*m-n*o,L=n*M-l*R,G=l*A-i*M,V=i*R-n*A;const q=c*2;return A*=q,R*=q,M*=q,L*=2,G*=2,V*=2,t[0]=o+A+L,t[1]=m+R+G,t[2]=b+M+V,t}function DQ(t,e,r,i){const n=[],l=[];return n[0]=e[0]-r[0],n[1]=e[1]-r[1],n[2]=e[2]-r[2],l[0]=n[0],l[1]=n[1]*Math.cos(i)-n[2]*Math.sin(i),l[2]=n[1]*Math.sin(i)+n[2]*Math.cos(i),t[0]=l[0]+r[0],t[1]=l[1]+r[1],t[2]=l[2]+r[2],t}function NQ(t,e,r,i){const n=[],l=[];return n[0]=e[0]-r[0],n[1]=e[1]-r[1],n[2]=e[2]-r[2],l[0]=n[2]*Math.sin(i)+n[0]*Math.cos(i),l[1]=n[1],l[2]=n[2]*Math.cos(i)-n[0]*Math.sin(i),t[0]=l[0]+r[0],t[1]=l[1]+r[1],t[2]=l[2]+r[2],t}function FQ(t,e,r,i){const n=[],l=[];return n[0]=e[0]-r[0],n[1]=e[1]-r[1],n[2]=e[2]-r[2],l[0]=n[0]*Math.cos(i)-n[1]*Math.sin(i),l[1]=n[0]*Math.sin(i)+n[1]*Math.cos(i),l[2]=n[2],t[0]=l[0]+r[0],t[1]=l[1]+r[1],t[2]=l[2]+r[2],t}function zQ(t,e){const r=t[0],i=t[1],n=t[2],l=e[0],c=e[1],o=e[2],m=Math.sqrt((r*r+i*i+n*n)*(l*l+c*c+o*o)),b=m&&iT(t,e)/m;return Math.acos(Math.min(Math.max(b,-1),1))}const jQ=BQ,UQ=iO;(function(){const t=rO();return function(e,r,i,n,l,c){let o,m;for(r||(r=3),i||(i=0),n?m=Math.min(n*r+i,e.length):m=e.length,o=i;o<m;o+=r)t[0]=e[o],t[1]=e[o+1],t[2]=e[o+2],l(t,t,c),e[o]=t[0],e[o+1]=t[1],e[o+2]=t[2];return e}})();const Vx=[0,0,0];let av;class et extends tT{static get ZERO(){return av||(av=new et(0,0,0),Object.freeze(av)),av}constructor(e=0,r=0,i=0){super(-0,-0,-0),arguments.length===1&&zd(e)?this.copy(e):(Cs.debug&&(gi(e),gi(r),gi(i)),this[0]=e,this[1]=r,this[2]=i)}set(e,r,i){return this[0]=e,this[1]=r,this[2]=i,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return Cs.debug&&(gi(e.x),gi(e.y),gi(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=gi(e)}angle(e){return zQ(this,e)}cross(e){return Vv(this,this,e),this.check()}rotateX({radians:e,origin:r=Vx}){return DQ(this,this,r,e),this.check()}rotateY({radians:e,origin:r=Vx}){return NQ(this,this,r,e),this.check()}rotateZ({radians:e,origin:r=Vx}){return FQ(this,this,r,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return nT(this,this,e),this.check()}transformAsVector(e){return eO(this,this,e),this.check()}transformByMatrix3(e){return nO(this,this,e),this.check()}transformByMatrix2(e){return IQ(this,this,e),this.check()}transformByQuaternion(e){return sO(this,this,e),this.check()}}let lv;class sT extends tT{static get ZERO(){return lv||(lv=new sT(0,0,0,0),Object.freeze(lv)),lv}constructor(e=0,r=0,i=0,n=0){super(-0,-0,-0,-0),zd(e)&&arguments.length===1?this.copy(e):(Cs.debug&&(gi(e),gi(r),gi(i),gi(n)),this[0]=e,this[1]=r,this[2]=i,this[3]=n)}set(e,r,i,n){return this[0]=e,this[1]=r,this[2]=i,this[3]=n,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}fromObject(e){return Cs.debug&&(gi(e.x),gi(e.y),gi(e.z),gi(e.w)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e.w=this[3],e}get ELEMENTS(){return 4}get z(){return this[2]}set z(e){this[2]=gi(e)}get w(){return this[3]}set w(e){this[3]=gi(e)}transform(e){return nT(this,this,e),this.check()}transformByMatrix3(e){return tO(this,this,e),this.check()}transformByMatrix2(e){return kQ(this,this,e),this.check()}transformByQuaternion(e){return sO(this,this,e),this.check()}applyMatrix4(e){return e.transform(this,this),this}}class oO extends eT{toString(){let e="[";if(Cs.printRowMajor){e+="row-major:";for(let r=0;r<this.RANK;++r)for(let i=0;i<this.RANK;++i)e+=` ${this[i*this.RANK+r]}`}else{e+="column-major:";for(let r=0;r<this.ELEMENTS;++r)e+=` ${this[r]}`}return e+="]",e}getElementIndex(e,r){return r*this.RANK+e}getElement(e,r){return this[r*this.RANK+e]}setElement(e,r,i){return this[r*this.RANK+e]=gi(i),this}getColumn(e,r=new Array(this.RANK).fill(-0)){const i=e*this.RANK;for(let n=0;n<this.RANK;++n)r[n]=this[i+n];return r}setColumn(e,r){const i=e*this.RANK;for(let n=0;n<this.RANK;++n)this[i+n]=r[n];return this}}function VQ(){const t=new Mc(9);return Mc!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function GQ(t,e){if(t===e){const r=e[1],i=e[2],n=e[5];t[1]=e[3],t[2]=e[6],t[3]=r,t[5]=e[7],t[6]=i,t[7]=n}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function HQ(t,e){const r=e[0],i=e[1],n=e[2],l=e[3],c=e[4],o=e[5],m=e[6],b=e[7],A=e[8],R=A*c-o*b,M=-A*l+o*m,L=b*l-c*m;let G=r*R+i*M+n*L;return G?(G=1/G,t[0]=R*G,t[1]=(-A*i+n*b)*G,t[2]=(o*i-n*c)*G,t[3]=M*G,t[4]=(A*r-n*m)*G,t[5]=(-o*r+n*l)*G,t[6]=L*G,t[7]=(-b*r+i*m)*G,t[8]=(c*r-i*l)*G,t):null}function $Q(t){const e=t[0],r=t[1],i=t[2],n=t[3],l=t[4],c=t[5],o=t[6],m=t[7],b=t[8];return e*(b*l-c*m)+r*(-b*n+c*o)+i*(m*n-l*o)}function XP(t,e,r){const i=e[0],n=e[1],l=e[2],c=e[3],o=e[4],m=e[5],b=e[6],A=e[7],R=e[8],M=r[0],L=r[1],G=r[2],V=r[3],q=r[4],J=r[5],ie=r[6],ee=r[7],me=r[8];return t[0]=M*i+L*c+G*b,t[1]=M*n+L*o+G*A,t[2]=M*l+L*m+G*R,t[3]=V*i+q*c+J*b,t[4]=V*n+q*o+J*A,t[5]=V*l+q*m+J*R,t[6]=ie*i+ee*c+me*b,t[7]=ie*n+ee*o+me*A,t[8]=ie*l+ee*m+me*R,t}function WQ(t,e,r){const i=e[0],n=e[1],l=e[2],c=e[3],o=e[4],m=e[5],b=e[6],A=e[7],R=e[8],M=r[0],L=r[1];return t[0]=i,t[1]=n,t[2]=l,t[3]=c,t[4]=o,t[5]=m,t[6]=M*i+L*c+b,t[7]=M*n+L*o+A,t[8]=M*l+L*m+R,t}function qQ(t,e,r){const i=e[0],n=e[1],l=e[2],c=e[3],o=e[4],m=e[5],b=e[6],A=e[7],R=e[8],M=Math.sin(r),L=Math.cos(r);return t[0]=L*i+M*c,t[1]=L*n+M*o,t[2]=L*l+M*m,t[3]=L*c-M*i,t[4]=L*o-M*n,t[5]=L*m-M*l,t[6]=b,t[7]=A,t[8]=R,t}function YP(t,e,r){const i=r[0],n=r[1];return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=n*e[3],t[4]=n*e[4],t[5]=n*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function KQ(t,e){const r=e[0],i=e[1],n=e[2],l=e[3],c=r+r,o=i+i,m=n+n,b=r*c,A=i*c,R=i*o,M=n*c,L=n*o,G=n*m,V=l*c,q=l*o,J=l*m;return t[0]=1-R-G,t[3]=A-J,t[6]=M+q,t[1]=A+J,t[4]=1-b-G,t[7]=L-V,t[2]=M-q,t[5]=L+V,t[8]=1-b-R,t}var N2;(function(t){t[t.COL0ROW0=0]="COL0ROW0",t[t.COL0ROW1=1]="COL0ROW1",t[t.COL0ROW2=2]="COL0ROW2",t[t.COL1ROW0=3]="COL1ROW0",t[t.COL1ROW1=4]="COL1ROW1",t[t.COL1ROW2=5]="COL1ROW2",t[t.COL2ROW0=6]="COL2ROW0",t[t.COL2ROW1=7]="COL2ROW1",t[t.COL2ROW2=8]="COL2ROW2"})(N2||(N2={}));const ZQ=Object.freeze([1,0,0,0,1,0,0,0,1]);class kn extends oO{static get IDENTITY(){return YQ()}static get ZERO(){return XQ()}get ELEMENTS(){return 9}get RANK(){return 3}get INDICES(){return N2}constructor(e,...r){super(-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):r.length>0?this.copy([e,...r]):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this.check()}identity(){return this.copy(ZQ)}fromObject(e){return this.check()}fromQuaternion(e){return KQ(this,e),this.check()}set(e,r,i,n,l,c,o,m,b){return this[0]=e,this[1]=r,this[2]=i,this[3]=n,this[4]=l,this[5]=c,this[6]=o,this[7]=m,this[8]=b,this.check()}setRowMajor(e,r,i,n,l,c,o,m,b){return this[0]=e,this[1]=n,this[2]=o,this[3]=r,this[4]=l,this[5]=m,this[6]=i,this[7]=c,this[8]=b,this.check()}determinant(){return $Q(this)}transpose(){return GQ(this,this),this.check()}invert(){return HQ(this,this),this.check()}multiplyLeft(e){return XP(this,e,this),this.check()}multiplyRight(e){return XP(this,this,e),this.check()}rotate(e){return qQ(this,this,e),this.check()}scale(e){return Array.isArray(e)?YP(this,this,e):YP(this,this,[e,e]),this.check()}translate(e){return WQ(this,this,e),this.check()}transform(e,r){let i;switch(e.length){case 2:i=YL(r||[-0,-0],e,this);break;case 3:i=nO(r||[-0,-0,-0],e,this);break;case 4:i=tO(r||[-0,-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return sy(i,e.length),i}transformVector(e,r){return this.transform(e,r)}transformVector2(e,r){return this.transform(e,r)}transformVector3(e,r){return this.transform(e,r)}}let cv,uv=null;function XQ(){return cv||(cv=new kn([0,0,0,0,0,0,0,0,0]),Object.freeze(cv)),cv}function YQ(){return uv||(uv=new kn,Object.freeze(uv)),uv}function JQ(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function QQ(t,e){if(t===e){const r=e[1],i=e[2],n=e[3],l=e[6],c=e[7],o=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=r,t[6]=e[9],t[7]=e[13],t[8]=i,t[9]=l,t[11]=e[14],t[12]=n,t[13]=c,t[14]=o}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function F2(t,e){const r=e[0],i=e[1],n=e[2],l=e[3],c=e[4],o=e[5],m=e[6],b=e[7],A=e[8],R=e[9],M=e[10],L=e[11],G=e[12],V=e[13],q=e[14],J=e[15],ie=r*o-i*c,ee=r*m-n*c,me=r*b-l*c,Se=i*m-n*o,Me=i*b-l*o,Ve=n*b-l*m,Be=A*V-R*G,$e=A*q-M*G,at=A*J-L*G,_t=R*q-M*V,Nt=R*J-L*V,sr=M*J-L*q;let Ft=ie*sr-ee*Nt+me*_t+Se*at-Me*$e+Ve*Be;return Ft?(Ft=1/Ft,t[0]=(o*sr-m*Nt+b*_t)*Ft,t[1]=(n*Nt-i*sr-l*_t)*Ft,t[2]=(V*Ve-q*Me+J*Se)*Ft,t[3]=(M*Me-R*Ve-L*Se)*Ft,t[4]=(m*at-c*sr-b*$e)*Ft,t[5]=(r*sr-n*at+l*$e)*Ft,t[6]=(q*me-G*Ve-J*ee)*Ft,t[7]=(A*Ve-M*me+L*ee)*Ft,t[8]=(c*Nt-o*at+b*Be)*Ft,t[9]=(i*at-r*Nt-l*Be)*Ft,t[10]=(G*Me-V*me+J*ie)*Ft,t[11]=(R*me-A*Me-L*ie)*Ft,t[12]=(o*$e-c*_t-m*Be)*Ft,t[13]=(r*_t-i*$e+n*Be)*Ft,t[14]=(V*ee-G*Se-q*ie)*Ft,t[15]=(A*Se-R*ee+M*ie)*Ft,t):null}function eee(t){const e=t[0],r=t[1],i=t[2],n=t[3],l=t[4],c=t[5],o=t[6],m=t[7],b=t[8],A=t[9],R=t[10],M=t[11],L=t[12],G=t[13],V=t[14],q=t[15],J=e*c-r*l,ie=e*o-i*l,ee=r*o-i*c,me=b*G-A*L,Se=b*V-R*L,Me=A*V-R*G,Ve=e*Me-r*Se+i*me,Be=l*Me-c*Se+o*me,$e=b*ee-A*ie+R*J,at=L*ee-G*ie+V*J;return m*Ve-n*Be+q*$e-M*at}function Sp(t,e,r){const i=e[0],n=e[1],l=e[2],c=e[3],o=e[4],m=e[5],b=e[6],A=e[7],R=e[8],M=e[9],L=e[10],G=e[11],V=e[12],q=e[13],J=e[14],ie=e[15];let ee=r[0],me=r[1],Se=r[2],Me=r[3];return t[0]=ee*i+me*o+Se*R+Me*V,t[1]=ee*n+me*m+Se*M+Me*q,t[2]=ee*l+me*b+Se*L+Me*J,t[3]=ee*c+me*A+Se*G+Me*ie,ee=r[4],me=r[5],Se=r[6],Me=r[7],t[4]=ee*i+me*o+Se*R+Me*V,t[5]=ee*n+me*m+Se*M+Me*q,t[6]=ee*l+me*b+Se*L+Me*J,t[7]=ee*c+me*A+Se*G+Me*ie,ee=r[8],me=r[9],Se=r[10],Me=r[11],t[8]=ee*i+me*o+Se*R+Me*V,t[9]=ee*n+me*m+Se*M+Me*q,t[10]=ee*l+me*b+Se*L+Me*J,t[11]=ee*c+me*A+Se*G+Me*ie,ee=r[12],me=r[13],Se=r[14],Me=r[15],t[12]=ee*i+me*o+Se*R+Me*V,t[13]=ee*n+me*m+Se*M+Me*q,t[14]=ee*l+me*b+Se*L+Me*J,t[15]=ee*c+me*A+Se*G+Me*ie,t}function g1(t,e,r){const i=r[0],n=r[1],l=r[2];let c,o,m,b,A,R,M,L,G,V,q,J;return e===t?(t[12]=e[0]*i+e[4]*n+e[8]*l+e[12],t[13]=e[1]*i+e[5]*n+e[9]*l+e[13],t[14]=e[2]*i+e[6]*n+e[10]*l+e[14],t[15]=e[3]*i+e[7]*n+e[11]*l+e[15]):(c=e[0],o=e[1],m=e[2],b=e[3],A=e[4],R=e[5],M=e[6],L=e[7],G=e[8],V=e[9],q=e[10],J=e[11],t[0]=c,t[1]=o,t[2]=m,t[3]=b,t[4]=A,t[5]=R,t[6]=M,t[7]=L,t[8]=G,t[9]=V,t[10]=q,t[11]=J,t[12]=c*i+A*n+G*l+e[12],t[13]=o*i+R*n+V*l+e[13],t[14]=m*i+M*n+q*l+e[14],t[15]=b*i+L*n+J*l+e[15]),t}function oT(t,e,r){const i=r[0],n=r[1],l=r[2];return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*l,t[9]=e[9]*l,t[10]=e[10]*l,t[11]=e[11]*l,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function tee(t,e,r,i){let n=i[0],l=i[1],c=i[2],o=Math.sqrt(n*n+l*l+c*c),m,b,A,R,M,L,G,V,q,J,ie,ee,me,Se,Me,Ve,Be,$e,at,_t,Nt,sr,Ft,Ut;return o<oy?null:(o=1/o,n*=o,l*=o,c*=o,b=Math.sin(r),m=Math.cos(r),A=1-m,R=e[0],M=e[1],L=e[2],G=e[3],V=e[4],q=e[5],J=e[6],ie=e[7],ee=e[8],me=e[9],Se=e[10],Me=e[11],Ve=n*n*A+m,Be=l*n*A+c*b,$e=c*n*A-l*b,at=n*l*A-c*b,_t=l*l*A+m,Nt=c*l*A+n*b,sr=n*c*A+l*b,Ft=l*c*A-n*b,Ut=c*c*A+m,t[0]=R*Ve+V*Be+ee*$e,t[1]=M*Ve+q*Be+me*$e,t[2]=L*Ve+J*Be+Se*$e,t[3]=G*Ve+ie*Be+Me*$e,t[4]=R*at+V*_t+ee*Nt,t[5]=M*at+q*_t+me*Nt,t[6]=L*at+J*_t+Se*Nt,t[7]=G*at+ie*_t+Me*Nt,t[8]=R*sr+V*Ft+ee*Ut,t[9]=M*sr+q*Ft+me*Ut,t[10]=L*sr+J*Ft+Se*Ut,t[11]=G*sr+ie*Ft+Me*Ut,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function aO(t,e,r){const i=Math.sin(r),n=Math.cos(r),l=e[4],c=e[5],o=e[6],m=e[7],b=e[8],A=e[9],R=e[10],M=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=l*n+b*i,t[5]=c*n+A*i,t[6]=o*n+R*i,t[7]=m*n+M*i,t[8]=b*n-l*i,t[9]=A*n-c*i,t[10]=R*n-o*i,t[11]=M*n-m*i,t}function ree(t,e,r){const i=Math.sin(r),n=Math.cos(r),l=e[0],c=e[1],o=e[2],m=e[3],b=e[8],A=e[9],R=e[10],M=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=l*n-b*i,t[1]=c*n-A*i,t[2]=o*n-R*i,t[3]=m*n-M*i,t[8]=l*i+b*n,t[9]=c*i+A*n,t[10]=o*i+R*n,t[11]=m*i+M*n,t}function lO(t,e,r){const i=Math.sin(r),n=Math.cos(r),l=e[0],c=e[1],o=e[2],m=e[3],b=e[4],A=e[5],R=e[6],M=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=l*n+b*i,t[1]=c*n+A*i,t[2]=o*n+R*i,t[3]=m*n+M*i,t[4]=b*n-l*i,t[5]=A*n-c*i,t[6]=R*n-o*i,t[7]=M*n-m*i,t}function iee(t,e){const r=e[0],i=e[1],n=e[2],l=e[4],c=e[5],o=e[6],m=e[8],b=e[9],A=e[10];return t[0]=Math.sqrt(r*r+i*i+n*n),t[1]=Math.sqrt(l*l+c*c+o*o),t[2]=Math.sqrt(m*m+b*b+A*A),t}function nee(t,e){const r=e[0],i=e[1],n=e[2],l=e[3],c=r+r,o=i+i,m=n+n,b=r*c,A=i*c,R=i*o,M=n*c,L=n*o,G=n*m,V=l*c,q=l*o,J=l*m;return t[0]=1-R-G,t[1]=A+J,t[2]=M-q,t[3]=0,t[4]=A-J,t[5]=1-b-G,t[6]=L+V,t[7]=0,t[8]=M+q,t[9]=L-V,t[10]=1-b-R,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function see(t,e,r,i,n,l,c){const o=1/(r-e),m=1/(n-i),b=1/(l-c);return t[0]=l*2*o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=l*2*m,t[6]=0,t[7]=0,t[8]=(r+e)*o,t[9]=(n+i)*m,t[10]=(c+l)*b,t[11]=-1,t[12]=0,t[13]=0,t[14]=c*l*2*b,t[15]=0,t}function oee(t,e,r,i,n){const l=1/Math.tan(e/2);if(t[0]=l/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,n!=null&&n!==1/0){const c=1/(i-n);t[10]=(n+i)*c,t[14]=2*n*i*c}else t[10]=-1,t[14]=-2*i;return t}const aee=oee;function lee(t,e,r,i,n,l,c){const o=1/(e-r),m=1/(i-n),b=1/(l-c);return t[0]=-2*o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*m,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*b,t[11]=0,t[12]=(e+r)*o,t[13]=(n+i)*m,t[14]=(c+l)*b,t[15]=1,t}const cee=lee;function uee(t,e,r,i){let n,l,c,o,m,b,A,R,M,L;const G=e[0],V=e[1],q=e[2],J=i[0],ie=i[1],ee=i[2],me=r[0],Se=r[1],Me=r[2];return Math.abs(G-me)<oy&&Math.abs(V-Se)<oy&&Math.abs(q-Me)<oy?JQ(t):(R=G-me,M=V-Se,L=q-Me,n=1/Math.sqrt(R*R+M*M+L*L),R*=n,M*=n,L*=n,l=ie*L-ee*M,c=ee*R-J*L,o=J*M-ie*R,n=Math.sqrt(l*l+c*c+o*o),n?(n=1/n,l*=n,c*=n,o*=n):(l=0,c=0,o=0),m=M*o-L*c,b=L*l-R*o,A=R*c-M*l,n=Math.sqrt(m*m+b*b+A*A),n?(n=1/n,m*=n,b*=n,A*=n):(m=0,b=0,A=0),t[0]=l,t[1]=m,t[2]=R,t[3]=0,t[4]=c,t[5]=b,t[6]=M,t[7]=0,t[8]=o,t[9]=A,t[10]=L,t[11]=0,t[12]=-(l*G+c*V+o*q),t[13]=-(m*G+b*V+A*q),t[14]=-(R*G+M*V+L*q),t[15]=1,t)}function hee(){const t=new Mc(4);return Mc!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function dee(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t}function cO(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t}function fee(t){const e=t[0],r=t[1],i=t[2],n=t[3];return Math.sqrt(e*e+r*r+i*i+n*n)}function pee(t){const e=t[0],r=t[1],i=t[2],n=t[3];return e*e+r*r+i*i+n*n}function mee(t,e){const r=e[0],i=e[1],n=e[2],l=e[3];let c=r*r+i*i+n*n+l*l;return c>0&&(c=1/Math.sqrt(c)),t[0]=r*c,t[1]=i*c,t[2]=n*c,t[3]=l*c,t}function gee(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function _ee(t,e,r,i){const n=e[0],l=e[1],c=e[2],o=e[3];return t[0]=n+i*(r[0]-n),t[1]=l+i*(r[1]-l),t[2]=c+i*(r[2]-c),t[3]=o+i*(r[3]-o),t}function $y(t,e,r){const i=e[0],n=e[1],l=e[2],c=e[3];return t[0]=r[0]*i+r[4]*n+r[8]*l+r[12]*c,t[1]=r[1]*i+r[5]*n+r[9]*l+r[13]*c,t[2]=r[2]*i+r[6]*n+r[10]*l+r[14]*c,t[3]=r[3]*i+r[7]*n+r[11]*l+r[15]*c,t}function yee(t,e,r){const i=e[0],n=e[1],l=e[2],c=r[0],o=r[1],m=r[2],b=r[3],A=b*i+o*l-m*n,R=b*n+m*i-c*l,M=b*l+c*n-o*i,L=-c*i-o*n-m*l;return t[0]=A*b+L*-c+R*-m-M*-o,t[1]=R*b+L*-o+M*-c-A*-m,t[2]=M*b+L*-m+A*-o-R*-c,t[3]=e[3],t}(function(){const t=hee();return function(e,r,i,n,l,c){let o,m;for(r||(r=4),i||(i=0),n?m=Math.min(n*r+i,e.length):m=e.length,o=i;o<m;o+=r)t[0]=e[o],t[1]=e[o+1],t[2]=e[o+2],t[3]=e[o+3],l(t,t,c),e[o]=t[0],e[o+1]=t[1],e[o+2]=t[2],e[o+3]=t[3];return e}})();var z2;(function(t){t[t.COL0ROW0=0]="COL0ROW0",t[t.COL0ROW1=1]="COL0ROW1",t[t.COL0ROW2=2]="COL0ROW2",t[t.COL0ROW3=3]="COL0ROW3",t[t.COL1ROW0=4]="COL1ROW0",t[t.COL1ROW1=5]="COL1ROW1",t[t.COL1ROW2=6]="COL1ROW2",t[t.COL1ROW3=7]="COL1ROW3",t[t.COL2ROW0=8]="COL2ROW0",t[t.COL2ROW1=9]="COL2ROW1",t[t.COL2ROW2=10]="COL2ROW2",t[t.COL2ROW3=11]="COL2ROW3",t[t.COL3ROW0=12]="COL3ROW0",t[t.COL3ROW1=13]="COL3ROW1",t[t.COL3ROW2=14]="COL3ROW2",t[t.COL3ROW3=15]="COL3ROW3"})(z2||(z2={}));const vee=45*Math.PI/180,bee=1,Gx=.1,Hx=500,xee=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class Kr extends oO{static get IDENTITY(){return Eee()}static get ZERO(){return wee()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return z2}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,r,i,n,l,c,o,m,b,A,R,M,L,G,V,q){return this[0]=e,this[1]=r,this[2]=i,this[3]=n,this[4]=l,this[5]=c,this[6]=o,this[7]=m,this[8]=b,this[9]=A,this[10]=R,this[11]=M,this[12]=L,this[13]=G,this[14]=V,this[15]=q,this.check()}setRowMajor(e,r,i,n,l,c,o,m,b,A,R,M,L,G,V,q){return this[0]=e,this[1]=l,this[2]=b,this[3]=L,this[4]=r,this[5]=c,this[6]=A,this[7]=G,this[8]=i,this[9]=o,this[10]=R,this[11]=V,this[12]=n,this[13]=m,this[14]=M,this[15]=q,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(xee)}fromObject(e){return this.check()}fromQuaternion(e){return nee(this,e),this.check()}frustum(e){const{left:r,right:i,bottom:n,top:l,near:c=Gx,far:o=Hx}=e;return o===1/0?Aee(this,r,i,n,l,c):see(this,r,i,n,l,c,o),this.check()}lookAt(e){const{eye:r,center:i=[0,0,0],up:n=[0,1,0]}=e;return uee(this,r,i,n),this.check()}ortho(e){const{left:r,right:i,bottom:n,top:l,near:c=Gx,far:o=Hx}=e;return cee(this,r,i,n,l,c,o),this.check()}orthographic(e){const{fovy:r=vee,aspect:i=bee,focalDistance:n=1,near:l=Gx,far:c=Hx}=e;JP(r);const o=r/2,m=n*Math.tan(o),b=m*i;return this.ortho({left:-b,right:b,bottom:-m,top:m,near:l,far:c})}perspective(e){const{fovy:r=45*Math.PI/180,aspect:i=1,near:n=.1,far:l=500}=e;return JP(r),aee(this,r,i,n,l),this.check()}determinant(){return eee(this)}getScale(e=[-0,-0,-0]){return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(e=[-0,-0,-0]){return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,r){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],r=r||[-0,-0,-0];const i=this.getScale(r),n=1/i[0],l=1/i[1],c=1/i[2];return e[0]=this[0]*n,e[1]=this[1]*l,e[2]=this[2]*c,e[3]=0,e[4]=this[4]*n,e[5]=this[5]*l,e[6]=this[6]*c,e[7]=0,e[8]=this[8]*n,e[9]=this[9]*l,e[10]=this[10]*c,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,r){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],r=r||[-0,-0,-0];const i=this.getScale(r),n=1/i[0],l=1/i[1],c=1/i[2];return e[0]=this[0]*n,e[1]=this[1]*l,e[2]=this[2]*c,e[3]=this[4]*n,e[4]=this[5]*l,e[5]=this[6]*c,e[6]=this[8]*n,e[7]=this[9]*l,e[8]=this[10]*c,e}transpose(){return QQ(this,this),this.check()}invert(){return F2(this,this),this.check()}multiplyLeft(e){return Sp(this,e,this),this.check()}multiplyRight(e){return Sp(this,this,e),this.check()}rotateX(e){return aO(this,this,e),this.check()}rotateY(e){return ree(this,this,e),this.check()}rotateZ(e){return lO(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,r){return tee(this,this,e,r),this.check()}scale(e){return oT(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return g1(this,this,e),this.check()}transform(e,r){return e.length===4?(r=$y(r||[-0,-0,-0,-0],e,this),sy(r,4),r):this.transformAsPoint(e,r)}transformAsPoint(e,r){const{length:i}=e;let n;switch(i){case 2:n=JL(r||[-0,-0],e,this);break;case 3:n=nT(r||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return sy(n,e.length),n}transformAsVector(e,r){let i;switch(e.length){case 2:i=QL(r||[-0,-0],e,this);break;case 3:i=eO(r||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return sy(i,e.length),i}transformPoint(e,r){return this.transformAsPoint(e,r)}transformVector(e,r){return this.transformAsPoint(e,r)}transformDirection(e,r){return this.transformAsVector(e,r)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,r,i){return this.identity().translate([e,r,i])}}let hv,dv;function wee(){return hv||(hv=new Kr([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(hv)),hv}function Eee(){return dv||(dv=new Kr,Object.freeze(dv)),dv}function JP(t){if(t>Math.PI*2)throw Error("expected radians")}function Aee(t,e,r,i,n,l){const c=2*l/(r-e),o=2*l/(n-i),m=(r+e)/(r-e),b=(n+i)/(n-i),A=-1,R=-1,M=-2*l;return t[0]=c,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=m,t[9]=b,t[10]=A,t[11]=R,t[12]=0,t[13]=0,t[14]=M,t[15]=0,t}function QP(){const t=new Mc(4);return Mc!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function Tee(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function uO(t,e,r){r=r*.5;const i=Math.sin(r);return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=Math.cos(r),t}function eR(t,e,r){const i=e[0],n=e[1],l=e[2],c=e[3],o=r[0],m=r[1],b=r[2],A=r[3];return t[0]=i*A+c*o+n*b-l*m,t[1]=n*A+c*m+l*o-i*b,t[2]=l*A+c*b+i*m-n*o,t[3]=c*A-i*o-n*m-l*b,t}function See(t,e,r){r*=.5;const i=e[0],n=e[1],l=e[2],c=e[3],o=Math.sin(r),m=Math.cos(r);return t[0]=i*m+c*o,t[1]=n*m+l*o,t[2]=l*m-n*o,t[3]=c*m-i*o,t}function Cee(t,e,r){r*=.5;const i=e[0],n=e[1],l=e[2],c=e[3],o=Math.sin(r),m=Math.cos(r);return t[0]=i*m-l*o,t[1]=n*m+c*o,t[2]=l*m+i*o,t[3]=c*m-n*o,t}function Pee(t,e,r){r*=.5;const i=e[0],n=e[1],l=e[2],c=e[3],o=Math.sin(r),m=Math.cos(r);return t[0]=i*m+n*o,t[1]=n*m-i*o,t[2]=l*m+c*o,t[3]=c*m-l*o,t}function Ree(t,e){const r=e[0],i=e[1],n=e[2];return t[0]=r,t[1]=i,t[2]=n,t[3]=Math.sqrt(Math.abs(1-r*r-i*i-n*n)),t}function Gv(t,e,r,i){const n=e[0],l=e[1],c=e[2],o=e[3];let m=r[0],b=r[1],A=r[2],R=r[3],M,L,G,V,q;return M=n*m+l*b+c*A+o*R,M<0&&(M=-M,m=-m,b=-b,A=-A,R=-R),1-M>oy?(L=Math.acos(M),q=Math.sin(L),G=Math.sin((1-i)*L)/q,V=Math.sin(i*L)/q):(G=1-i,V=i),t[0]=G*n+V*m,t[1]=G*l+V*b,t[2]=G*c+V*A,t[3]=G*o+V*R,t}function Mee(t,e){const r=e[0],i=e[1],n=e[2],l=e[3],c=r*r+i*i+n*n+l*l,o=c?1/c:0;return t[0]=-r*o,t[1]=-i*o,t[2]=-n*o,t[3]=l*o,t}function Iee(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function hO(t,e){const r=e[0]+e[4]+e[8];let i;if(r>0)i=Math.sqrt(r+1),t[3]=.5*i,i=.5/i,t[0]=(e[5]-e[7])*i,t[1]=(e[6]-e[2])*i,t[2]=(e[1]-e[3])*i;else{let n=0;e[4]>e[0]&&(n=1),e[8]>e[n*3+n]&&(n=2);const l=(n+1)%3,c=(n+2)%3;i=Math.sqrt(e[n*3+n]-e[l*3+l]-e[c*3+c]+1),t[n]=.5*i,i=.5/i,t[3]=(e[l*3+c]-e[c*3+l])*i,t[l]=(e[l*3+n]+e[n*3+l])*i,t[c]=(e[c*3+n]+e[n*3+c])*i}return t}const kee=dee,Bee=cO,Lee=gee,Oee=_ee,Dee=fee,Nee=pee,dO=mee,Fee=(function(){const t=rO(),e=ZP(1,0,0),r=ZP(0,1,0);return function(i,n,l){const c=iT(n,l);return c<-.999999?(Vv(t,e,n),UQ(t)<1e-6&&Vv(t,r,n),OQ(t,t),uO(i,t,Math.PI),i):c>.999999?(i[0]=0,i[1]=0,i[2]=0,i[3]=1,i):(Vv(t,n,l),i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=1+c,dO(i,i))}})();(function(){const t=QP(),e=QP();return function(r,i,n,l,c,o){return Gv(t,i,c,o),Gv(e,n,l,o),Gv(r,t,e,2*o*(1-o)),r}})();(function(){const t=VQ();return function(e,r,i,n){return t[0]=i[0],t[3]=i[1],t[6]=i[2],t[1]=n[0],t[4]=n[1],t[7]=n[2],t[2]=-r[0],t[5]=-r[1],t[8]=-r[2],dO(e,hO(e,t))}})();const zee=[0,0,0,1];class wy extends eT{constructor(e=0,r=0,i=0,n=1){super(-0,-0,-0,-0),Array.isArray(e)&&arguments.length===1?this.copy(e):this.set(e,r,i,n)}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}set(e,r,i,n){return this[0]=e,this[1]=r,this[2]=i,this[3]=n,this.check()}fromObject(e){return this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this.check()}fromMatrix3(e){return hO(this,e),this.check()}fromAxisRotation(e,r){return uO(this,e,r),this.check()}identity(){return Tee(this),this.check()}setAxisAngle(e,r){return this.fromAxisRotation(e,r)}get ELEMENTS(){return 4}get x(){return this[0]}set x(e){this[0]=gi(e)}get y(){return this[1]}set y(e){this[1]=gi(e)}get z(){return this[2]}set z(e){this[2]=gi(e)}get w(){return this[3]}set w(e){this[3]=gi(e)}len(){return Dee(this)}lengthSquared(){return Nee(this)}dot(e){return Lee(this,e)}rotationTo(e,r){return Fee(this,e,r),this.check()}add(e){return kee(this,this,e),this.check()}calculateW(){return Ree(this,this),this.check()}conjugate(){return Iee(this,this),this.check()}invert(){return Mee(this,this),this.check()}lerp(e,r,i){return i===void 0?this.lerp(this,e,r):(Oee(this,e,r,i),this.check())}multiplyRight(e){return eR(this,this,e),this.check()}multiplyLeft(e){return eR(this,e,this),this.check()}normalize(){const e=this.len(),r=e>0?1/e:0;return this[0]=this[0]*r,this[1]=this[1]*r,this[2]=this[2]*r,this[3]=this[3]*r,e===0&&(this[3]=1),this.check()}rotateX(e){return See(this,this,e),this.check()}rotateY(e){return Cee(this,this,e),this.check()}rotateZ(e){return Pee(this,this,e),this.check()}scale(e){return Bee(this,this,e),this.check()}slerp(e,r,i){let n,l,c;switch(arguments.length){case 1:({start:n=zee,target:l,ratio:c}=e);break;case 2:n=this,l=e,c=r;break;default:n=e,l=r,c=i}return Gv(this,n,l,c),this.check()}transformVector4(e,r=new sT){return yee(r,e,this),sy(r,4)}lengthSq(){return this.lengthSquared()}setFromAxisAngle(e,r){return this.setAxisAngle(e,r)}premultiply(e){return this.multiplyLeft(e)}multiply(e){return this.multiplyRight(e)}}const jee=.1,Uee=1e-12,fO=1e-15,Vee=1e-20,tR=`#if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
struct AmbientLight {
vec3 color;
};
struct PointLight {
vec3 color;
vec3 position;
vec3 attenuation;
};
struct DirectionalLight {
vec3 color;
vec3 direction;
};
uniform AmbientLight lighting_uAmbientLight;
uniform PointLight lighting_uPointLight[MAX_LIGHTS];
uniform DirectionalLight lighting_uDirectionalLight[MAX_LIGHTS];
uniform int lighting_uPointLightCount;
uniform int lighting_uDirectionalLightCount;
uniform bool lighting_uEnabled;
float getPointLightAttenuation(PointLight pointLight, float distance) {
return pointLight.attenuation.x
+ pointLight.attenuation.y * distance
+ pointLight.attenuation.z * distance * distance;
}
#endif
`,Gee={lightSources:{}};function $x(t={}){const{color:e=[0,0,0],intensity:r=1}=t;return e.map(i=>i*r/255)}function Hee({ambientLight:t,pointLights:e=[],directionalLights:r=[]}){const i={};return t?i["lighting_uAmbientLight.color"]=$x(t):i["lighting_uAmbientLight.color"]=[0,0,0],e.forEach((n,l)=>{i[`lighting_uPointLight[${l}].color`]=$x(n),i[`lighting_uPointLight[${l}].position`]=n.position,i[`lighting_uPointLight[${l}].attenuation`]=n.attenuation||[1,0,0]}),i.lighting_uPointLightCount=e.length,r.forEach((n,l)=>{i[`lighting_uDirectionalLight[${l}].color`]=$x(n),i[`lighting_uDirectionalLight[${l}].direction`]=n.direction}),i.lighting_uDirectionalLightCount=r.length,i}function pO(t=Gee){if("lightSources"in t){const{ambientLight:e,pointLights:r,directionalLights:i}=t.lightSources||{};return e||r&&r.length>0||i&&i.length>0?Object.assign({},Hee({ambientLight:e,pointLights:r,directionalLights:i}),{lighting_uEnabled:!0}):{lighting_uEnabled:!1}}if("lights"in t){const e={pointLights:[],directionalLights:[]};for(const r of t.lights||[])switch(r.type){case"ambient":e.ambientLight=r;break;case"directional":e.directionalLights?.push(r);break;case"point":e.pointLights?.push(r);break}return pO({lightSources:e})}return{}}const aT={name:"lights",vs:tR,fs:tR,getUniforms:pO,defines:{MAX_LIGHTS:3}},mO=`uniform float lighting_uAmbient;
uniform float lighting_uDiffuse;
uniform float lighting_uShininess;
uniform vec3  lighting_uSpecularColor;
vec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {
vec3 halfway_direction = normalize(light_direction + view_direction);
float lambertian = dot(light_direction, normal_worldspace);
float specular = 0.0;
if (lambertian > 0.0) {
float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
specular = pow(specular_angle, lighting_uShininess);
}
lambertian = max(lambertian, 0.0);
return (lambertian * lighting_uDiffuse * surfaceColor + specular * lighting_uSpecularColor) * color;
}
vec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
vec3 lightColor = surfaceColor;
if (lighting_uEnabled) {
vec3 view_direction = normalize(cameraPosition - position_worldspace);
lightColor = lighting_uAmbient * surfaceColor * lighting_uAmbientLight.color;
for (int i = 0; i < MAX_LIGHTS; i++) {
if (i >= lighting_uPointLightCount) {
break;
}
PointLight pointLight = lighting_uPointLight[i];
vec3 light_position_worldspace = pointLight.position;
vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
}
for (int i = 0; i < MAX_LIGHTS; i++) {
if (i >= lighting_uDirectionalLightCount) {
break;
}
DirectionalLight directionalLight = lighting_uDirectionalLight[i];
lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
}
}
return lightColor;
}
vec3 lighting_getSpecularLightColor(vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
vec3 lightColor = vec3(0, 0, 0);
vec3 surfaceColor = vec3(0, 0, 0);
if (lighting_uEnabled) {
vec3 view_direction = normalize(cameraPosition - position_worldspace);
for (int i = 0; i < MAX_LIGHTS; i++) {
if (i >= lighting_uPointLightCount) {
break;
}
PointLight pointLight = lighting_uPointLight[i];
vec3 light_position_worldspace = pointLight.position;
vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
}
for (int i = 0; i < MAX_LIGHTS; i++) {
if (i >= lighting_uDirectionalLightCount) {
break;
}
DirectionalLight directionalLight = lighting_uDirectionalLight[i];
lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
}
}
return lightColor;
}
`,$ee={};function Wee(t){const{ambient:e=.35,diffuse:r=.6,shininess:i=32,specularColor:n=[30,30,30]}=t;return{lighting_uAmbient:e,lighting_uDiffuse:r,lighting_uShininess:i,lighting_uSpecularColor:n.map(l=>l/255)}}function gO(t=$ee){if(!("material"in t))return{};const{material:e}=t;return e?Wee(e):{lighting_uEnabled:!1}}const qee={name:"gouraud-lighting",dependencies:[aT],vs:mO,defines:{LIGHTING_VERTEX:1},getUniforms:gO},Kee={name:"phong-lighting",dependencies:[aT],fs:mO,defines:{LIGHTING_FRAGMENT:1},getUniforms:gO},Zee=`uniform mat4 u_MVPMatrix;
uniform mat4 u_ModelMatrix;
uniform mat4 u_NormalMatrix;
out vec3 pbr_vPosition;
out vec2 pbr_vUV;
#ifdef HAS_NORMALS
# ifdef HAS_TANGENTS
out mat3 pbr_vTBN;
# else
out vec3 pbr_vNormal;
# endif
#endif
void pbr_setPositionNormalTangentUV(vec4 position, vec4 normal, vec4 tangent, vec2 uv)
{
vec4 pos = u_ModelMatrix * position;
pbr_vPosition = vec3(pos.xyz) / pos.w;
#ifdef HAS_NORMALS
#ifdef HAS_TANGENTS
vec3 normalW = normalize(vec3(u_NormalMatrix * vec4(normal.xyz, 0.0)));
vec3 tangentW = normalize(vec3(u_ModelMatrix * vec4(tangent.xyz, 0.0)));
vec3 bitangentW = cross(normalW, tangentW) * tangent.w;
pbr_vTBN = mat3(tangentW, bitangentW, normalW);
#else
pbr_vNormal = normalize(vec3(u_ModelMatrix * vec4(normal.xyz, 0.0)));
#endif
#endif
#ifdef HAS_UV
pbr_vUV = uv;
#else
pbr_vUV = vec2(0.,0.);
#endif
}
`,Xee=`precision highp float;
uniform bool pbr_uUnlit;
#ifdef USE_IBL
uniform samplerCube u_DiffuseEnvSampler;
uniform samplerCube u_SpecularEnvSampler;
uniform sampler2D u_brdfLUT;
uniform vec2 u_ScaleIBLAmbient;
#endif
#ifdef HAS_BASECOLORMAP
uniform sampler2D u_BaseColorSampler;
#endif
#ifdef HAS_NORMALMAP
uniform sampler2D u_NormalSampler;
uniform float u_NormalScale;
#endif
#ifdef HAS_EMISSIVEMAP
uniform sampler2D u_EmissiveSampler;
uniform vec3 u_EmissiveFactor;
#endif
#ifdef HAS_METALROUGHNESSMAP
uniform sampler2D u_MetallicRoughnessSampler;
#endif
#ifdef HAS_OCCLUSIONMAP
uniform sampler2D u_OcclusionSampler;
uniform float u_OcclusionStrength;
#endif
#ifdef ALPHA_CUTOFF
uniform float u_AlphaCutoff;
#endif
uniform vec2 u_MetallicRoughnessValues;
uniform vec4 u_BaseColorFactor;
uniform vec3 u_Camera;
#ifdef PBR_DEBUG
uniform vec4 u_ScaleDiffBaseMR;
uniform vec4 u_ScaleFGDSpec;
#endif
in vec3 pbr_vPosition;
in vec2 pbr_vUV;
#ifdef HAS_NORMALS
#ifdef HAS_TANGENTS
in mat3 pbr_vTBN;
#else
in vec3 pbr_vNormal;
#endif
#endif
struct PBRInfo
{
float NdotL;
float NdotV;
float NdotH;
float LdotH;
float VdotH;
float perceptualRoughness;
float metalness;
vec3 reflectance0;
vec3 reflectance90;
float alphaRoughness;
vec3 diffuseColor;
vec3 specularColor;
vec3 n;
vec3 v;
};
const float M_PI = 3.141592653589793;
const float c_MinRoughness = 0.04;
vec4 SRGBtoLINEAR(vec4 srgbIn)
{
#ifdef MANUAL_SRGB
#ifdef SRGB_FAST_APPROXIMATION
vec3 linOut = pow(srgbIn.xyz,vec3(2.2));
#else
vec3 bLess = step(vec3(0.04045),srgbIn.xyz);
vec3 linOut = mix( srgbIn.xyz/vec3(12.92), pow((srgbIn.xyz+vec3(0.055))/vec3(1.055),vec3(2.4)), bLess );
#endif
return vec4(linOut,srgbIn.w);;
#else
return srgbIn;
#endif
}
vec3 getNormal()
{
#ifndef HAS_TANGENTS
vec3 pos_dx = dFdx(pbr_vPosition);
vec3 pos_dy = dFdy(pbr_vPosition);
vec3 tex_dx = dFdx(vec3(pbr_vUV, 0.0));
vec3 tex_dy = dFdy(vec3(pbr_vUV, 0.0));
vec3 t = (tex_dy.t * pos_dx - tex_dx.t * pos_dy) / (tex_dx.s * tex_dy.t - tex_dy.s * tex_dx.t);
#ifdef HAS_NORMALS
vec3 ng = normalize(pbr_vNormal);
#else
vec3 ng = cross(pos_dx, pos_dy);
#endif
t = normalize(t - ng * dot(ng, t));
vec3 b = normalize(cross(ng, t));
mat3 tbn = mat3(t, b, ng);
#else
mat3 tbn = pbr_vTBN;
#endif
#ifdef HAS_NORMALMAP
vec3 n = texture(u_NormalSampler, pbr_vUV).rgb;
n = normalize(tbn * ((2.0 * n - 1.0) * vec3(u_NormalScale, u_NormalScale, 1.0)));
#else
vec3 n = normalize(tbn[2].xyz);
#endif
return n;
}
#ifdef USE_IBL
vec3 getIBLContribution(PBRInfo pbrInputs, vec3 n, vec3 reflection)
{
float mipCount = 9.0;
float lod = (pbrInputs.perceptualRoughness * mipCount);
vec3 brdf = SRGBtoLINEAR(texture(u_brdfLUT,
vec2(pbrInputs.NdotV, 1.0 - pbrInputs.perceptualRoughness))).rgb;
vec3 diffuseLight = SRGBtoLINEAR(textureCube(u_DiffuseEnvSampler, n)).rgb;
#ifdef USE_TEX_LOD
vec3 specularLight = SRGBtoLINEAR(textureCubeLod(u_SpecularEnvSampler, reflection, lod)).rgb;
#else
vec3 specularLight = SRGBtoLINEAR(textureCube(u_SpecularEnvSampler, reflection)).rgb;
#endif
vec3 diffuse = diffuseLight * pbrInputs.diffuseColor;
vec3 specular = specularLight * (pbrInputs.specularColor * brdf.x + brdf.y);
diffuse *= u_ScaleIBLAmbient.x;
specular *= u_ScaleIBLAmbient.y;
return diffuse + specular;
}
#endif
vec3 diffuse(PBRInfo pbrInputs)
{
return pbrInputs.diffuseColor / M_PI;
}
vec3 specularReflection(PBRInfo pbrInputs)
{
return pbrInputs.reflectance0 +
(pbrInputs.reflectance90 - pbrInputs.reflectance0) *
pow(clamp(1.0 - pbrInputs.VdotH, 0.0, 1.0), 5.0);
}
float geometricOcclusion(PBRInfo pbrInputs)
{
float NdotL = pbrInputs.NdotL;
float NdotV = pbrInputs.NdotV;
float r = pbrInputs.alphaRoughness;
float attenuationL = 2.0 * NdotL / (NdotL + sqrt(r * r + (1.0 - r * r) * (NdotL * NdotL)));
float attenuationV = 2.0 * NdotV / (NdotV + sqrt(r * r + (1.0 - r * r) * (NdotV * NdotV)));
return attenuationL * attenuationV;
}
float microfacetDistribution(PBRInfo pbrInputs)
{
float roughnessSq = pbrInputs.alphaRoughness * pbrInputs.alphaRoughness;
float f = (pbrInputs.NdotH * roughnessSq - pbrInputs.NdotH) * pbrInputs.NdotH + 1.0;
return roughnessSq / (M_PI * f * f);
}
void PBRInfo_setAmbientLight(inout PBRInfo pbrInputs) {
pbrInputs.NdotL = 1.0;
pbrInputs.NdotH = 0.0;
pbrInputs.LdotH = 0.0;
pbrInputs.VdotH = 1.0;
}
void PBRInfo_setDirectionalLight(inout PBRInfo pbrInputs, vec3 lightDirection) {
vec3 n = pbrInputs.n;
vec3 v = pbrInputs.v;
vec3 l = normalize(lightDirection);
vec3 h = normalize(l+v);
pbrInputs.NdotL = clamp(dot(n, l), 0.001, 1.0);
pbrInputs.NdotH = clamp(dot(n, h), 0.0, 1.0);
pbrInputs.LdotH = clamp(dot(l, h), 0.0, 1.0);
pbrInputs.VdotH = clamp(dot(v, h), 0.0, 1.0);
}
void PBRInfo_setPointLight(inout PBRInfo pbrInputs, PointLight pointLight) {
vec3 light_direction = normalize(pointLight.position - pbr_vPosition);
PBRInfo_setDirectionalLight(pbrInputs, light_direction);
}
vec3 calculateFinalColor(PBRInfo pbrInputs, vec3 lightColor) {
vec3 F = specularReflection(pbrInputs);
float G = geometricOcclusion(pbrInputs);
float D = microfacetDistribution(pbrInputs);
vec3 diffuseContrib = (1.0 - F) * diffuse(pbrInputs);
vec3 specContrib = F * G * D / (4.0 * pbrInputs.NdotL * pbrInputs.NdotV);
return pbrInputs.NdotL * lightColor * (diffuseContrib + specContrib);
}
vec4 pbr_filterColor(vec4 colorUnused)
{
#ifdef HAS_BASECOLORMAP
vec4 baseColor = SRGBtoLINEAR(texture(u_BaseColorSampler, pbr_vUV)) * u_BaseColorFactor;
#else
vec4 baseColor = u_BaseColorFactor;
#endif
#ifdef ALPHA_CUTOFF
if (baseColor.a < u_AlphaCutoff) {
discard;
}
#endif
vec3 color = vec3(0, 0, 0);
if(pbr_uUnlit){
color.rgb = baseColor.rgb;
}
else{
float perceptualRoughness = u_MetallicRoughnessValues.y;
float metallic = u_MetallicRoughnessValues.x;
#ifdef HAS_METALROUGHNESSMAP
vec4 mrSample = texture(u_MetallicRoughnessSampler, pbr_vUV);
perceptualRoughness = mrSample.g * perceptualRoughness;
metallic = mrSample.b * metallic;
#endif
perceptualRoughness = clamp(perceptualRoughness, c_MinRoughness, 1.0);
metallic = clamp(metallic, 0.0, 1.0);
float alphaRoughness = perceptualRoughness * perceptualRoughness;
vec3 f0 = vec3(0.04);
vec3 diffuseColor = baseColor.rgb * (vec3(1.0) - f0);
diffuseColor *= 1.0 - metallic;
vec3 specularColor = mix(f0, baseColor.rgb, metallic);
float reflectance = max(max(specularColor.r, specularColor.g), specularColor.b);
float reflectance90 = clamp(reflectance * 25.0, 0.0, 1.0);
vec3 specularEnvironmentR0 = specularColor.rgb;
vec3 specularEnvironmentR90 = vec3(1.0, 1.0, 1.0) * reflectance90;
vec3 n = getNormal();
vec3 v = normalize(u_Camera - pbr_vPosition);
float NdotV = clamp(abs(dot(n, v)), 0.001, 1.0);
vec3 reflection = -normalize(reflect(v, n));
PBRInfo pbrInputs = PBRInfo(
0.0,
NdotV,
0.0,
0.0,
0.0,
perceptualRoughness,
metallic,
specularEnvironmentR0,
specularEnvironmentR90,
alphaRoughness,
diffuseColor,
specularColor,
n,
v
);
#ifdef USE_LIGHTS
PBRInfo_setAmbientLight(pbrInputs);
color += calculateFinalColor(pbrInputs, lighting_uAmbientLight.color);
for(int i = 0; i < lighting_uDirectionalLightCount; i++) {
if (i < lighting_uDirectionalLightCount) {
PBRInfo_setDirectionalLight(pbrInputs, lighting_uDirectionalLight[i].direction);
color += calculateFinalColor(pbrInputs, lighting_uDirectionalLight[i].color);
}
}
for(int i = 0; i < lighting_uPointLightCount; i++) {
if (i < lighting_uPointLightCount) {
PBRInfo_setPointLight(pbrInputs, lighting_uPointLight[i]);
float attenuation = getPointLightAttenuation(lighting_uPointLight[i], distance(lighting_uPointLight[i].position, pbr_vPosition));
color += calculateFinalColor(pbrInputs, lighting_uPointLight[i].color / attenuation);
}
}
#endif
#ifdef USE_IBL
color += getIBLContribution(pbrInputs, n, reflection);
#endif
#ifdef HAS_OCCLUSIONMAP
float ao = texture(u_OcclusionSampler, pbr_vUV).r;
color = mix(color, color * ao, u_OcclusionStrength);
#endif
#ifdef HAS_EMISSIVEMAP
vec3 emissive = SRGBtoLINEAR(texture(u_EmissiveSampler, pbr_vUV)).rgb * u_EmissiveFactor;
color += emissive;
#endif
#ifdef PBR_DEBUG
color = mix(color, baseColor.rgb, u_ScaleDiffBaseMR.y);
color = mix(color, vec3(metallic), u_ScaleDiffBaseMR.z);
color = mix(color, vec3(perceptualRoughness), u_ScaleDiffBaseMR.w);
#endif
}
return vec4(pow(color,vec3(1.0/2.2)), baseColor.a);
}
`,lT={name:"pbr",vs:Zee,fs:Xee,defines:{LIGHTING_FRAGMENT:1},dependencies:[aT]},_O="#define SMOOTH_EDGE_RADIUS 0.5",Yee=`
${_O}

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`,Jee=`
${_O}

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,Qee={name:"geometry",vs:Yee,fs:Jee},Qr={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(Qr,"IDENTITY",{get:()=>(hi.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const Su={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},j2={common:0,meters:1,pixels:2},U2={click:{handler:"onClick"},panstart:{handler:"onDragStart"},panmove:{handler:"onDrag"},panend:{handler:"onDragEnd"}},ete=Object.keys(Qr).map(t=>`const int COORDINATE_SYSTEM_${t} = ${Qr[t]};`).join(""),tte=Object.keys(Su).map(t=>`const int PROJECTION_MODE_${t} = ${Su[t]};`).join(""),rte=Object.keys(j2).map(t=>`const int UNIT_${t.toUpperCase()} = ${j2[t]};`).join(""),ite=`${ete}
${tte}
${rte}
uniform int project_uCoordinateSystem;
uniform int project_uProjectionMode;
uniform float project_uScale;
uniform bool project_uWrapLongitude;
uniform vec3 project_uCommonUnitsPerMeter;
uniform vec3 project_uCommonUnitsPerWorldUnit;
uniform vec3 project_uCommonUnitsPerWorldUnit2;
uniform vec4 project_uCenter;
uniform mat4 project_uModelMatrix;
uniform mat4 project_uViewProjectionMatrix;
uniform vec2 project_uViewportSize;
uniform float project_uDevicePixelRatio;
uniform float project_uFocalDistance;
uniform vec3 project_uCameraPosition;
uniform vec3 project_uCoordinateOrigin;
uniform vec3 project_uCommonOrigin;
uniform bool project_uPseudoMeters;
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
float y = clamp(lat, -89.9, 89.9);
return 1.0 / cos(radians(y));
}
float project_size() {
if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR &&
project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
project_uPseudoMeters == false) {
if (geometry.position.w == 0.0) {
return project_size_at_latitude(geometry.worldPosition.y);
}
float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
float y2 = y * y;
float y4 = y2 * y2;
float y6 = y4 * y2;
return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
}
return 1.0;
}
float project_size_at_latitude(float meters, float lat) {
return meters * project_uCommonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
return meters * project_uCommonUnitsPerMeter.z * project_size();
}
vec2 project_size(vec2 meters) {
return meters * project_uCommonUnitsPerMeter.xy * project_size();
}
vec3 project_size(vec3 meters) {
return meters * project_uCommonUnitsPerMeter * project_size();
}
vec4 project_size(vec4 meters) {
return vec4(meters.xyz * project_uCommonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
vec3 uz = normalize(up);
vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
vec3 uy = cross(uz, ux);
return mat3(ux, uy, uz);
}
bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
transform = project_get_orientation_matrix(commonPosition);
return true;
}
return false;
}
vec3 project_normal(vec3 vector) {
vec4 normal_modelspace = project_uModelMatrix * vec4(vector, 0.0);
vec3 n = normalize(normal_modelspace.xyz * project_uCommonUnitsPerMeter);
mat3 rotation;
if (project_needs_rotation(geometry.position.xyz, rotation)) {
n = rotation * n;
}
return n;
}
vec4 project_offset_(vec4 offset) {
float dy = offset.y;
vec3 commonUnitsPerWorldUnit = project_uCommonUnitsPerWorldUnit + project_uCommonUnitsPerWorldUnit2 * dy;
return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
float x = lnglat.x;
if (project_uWrapLongitude) {
x = mod(x + 180., 360.0) - 180.;
}
float y = clamp(lnglat.y, -89.9, 89.9);
return vec2(
radians(x) + PI,
PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
) * WORLD_SCALE;
}
vec3 project_globe_(vec3 lnglatz) {
float lambda = radians(lnglatz.x);
float phi = radians(lnglatz.y);
float cosPhi = cos(phi);
float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
return vec3(
sin(lambda) * cosPhi,
-cos(lambda) * cosPhi,
sin(phi)
) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
vec4 position_world = project_uModelMatrix * position;
if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR) {
if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_mercator_(position_world.xy),
project_size_at_latitude(position_world.z, position_world.y),
position_world.w
);
}
if (project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
position_world.xyz += project_uCoordinateOrigin;
}
}
if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_globe_(position_world.xyz),
position_world.w
);
}
}
if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
if (abs(position_world.y - project_uCoordinateOrigin.y) > 0.25) {
return vec4(
project_mercator_(position_world.xy) - project_uCommonOrigin.xy,
project_size(position_world.z),
position_world.w
);
}
}
}
if (project_uProjectionMode == PROJECTION_MODE_IDENTITY ||
(project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
(project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
position_world.xyz -= project_uCoordinateOrigin;
}
return project_offset_(position_world) + project_offset_(project_uModelMatrix * vec4(position64Low, 0.0));
}
vec4 project_position(vec4 position) {
return project_position(position, ZERO_64_LOW);
}
vec3 project_position(vec3 position, vec3 position64Low) {
vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
return projected_position.xyz;
}
vec3 project_position(vec3 position) {
vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
return projected_position.xyz;
}
vec2 project_position(vec2 position) {
vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
return projected_position.xy;
}
vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
return project_common_position_to_clipspace(position, project_uViewProjectionMatrix, project_uCenter);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
vec2 offset = pixels / project_uViewportSize * project_uDevicePixelRatio * 2.0;
return offset * project_uFocalDistance;
}
float project_size_to_pixel(float meters) {
return project_size(meters) * project_uScale;
}
float project_size_to_pixel(float size, int unit) {
if (unit == UNIT_METERS) return project_size_to_pixel(size);
if (unit == UNIT_COMMON) return size * project_uScale;
return size;
}
float project_pixel_size(float pixels) {
return pixels / project_uScale;
}
vec2 project_pixel_size(vec2 pixels) {
return pixels / project_uScale;
}
`;function nte(t,e){if(t===e)return!0;if(Array.isArray(t)){const r=t.length;if(!e||e.length!==r)return!1;for(let i=0;i<r;i++)if(t[i]!==e[i])return!1;return!0}return!1}function Wy(t){let e={},r;return i=>{for(const n in i)if(!nte(i[n],e[n])){r=t(i),e=i;break}return r}}const rR=[0,0,0,0],ste=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],yO=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],ote=[0,0,0],vO=[0,0,0],ate=Wy(ute);function bO(t,e,r=vO){r.length<3&&(r=[r[0],r[1],0]);let i=r,n,l=!0;switch(e===Qr.LNGLAT_OFFSETS||e===Qr.METER_OFFSETS?n=r:n=t.isGeospatial?[Math.fround(t.longitude),Math.fround(t.latitude),0]:null,t.projectionMode){case Su.WEB_MERCATOR:(e===Qr.LNGLAT||e===Qr.CARTESIAN)&&(n=[0,0,0],l=!1);break;case Su.WEB_MERCATOR_AUTO_OFFSET:e===Qr.LNGLAT?i=n:e===Qr.CARTESIAN&&(i=[Math.fround(t.center[0]),Math.fround(t.center[1]),0],n=t.unprojectPosition(i),i[0]-=r[0],i[1]-=r[1],i[2]-=r[2]);break;case Su.IDENTITY:i=t.position.map(Math.fround),i[2]=i[2]||0;break;case Su.GLOBE:l=!1,n=null;break;default:l=!1}return{geospatialOrigin:n,shaderCoordinateOrigin:i,offsetMode:l}}function lte(t,e,r){const{viewMatrixUncentered:i,projectionMatrix:n}=t;let{viewMatrix:l,viewProjectionMatrix:c}=t,o=rR,m=rR,b=t.cameraPosition;const{geospatialOrigin:A,shaderCoordinateOrigin:R,offsetMode:M}=bO(t,e,r);return M&&(m=t.projectPosition(A||R),b=[b[0]-m[0],b[1]-m[1],b[2]-m[2]],m[3]=1,o=$y([],m,c),l=i||l,c=Sp([],n,l),c=Sp([],c,ste)),{viewMatrix:l,viewProjectionMatrix:c,projectionCenter:o,originCommon:m,cameraPosCommon:b,shaderCoordinateOrigin:R,geospatialOrigin:A}}function cte({viewport:t,devicePixelRatio:e=1,modelMatrix:r=null,coordinateSystem:i=Qr.DEFAULT,coordinateOrigin:n=vO,autoWrapLongitude:l=!1}){i===Qr.DEFAULT&&(i=t.isGeospatial?Qr.LNGLAT:Qr.CARTESIAN);const c=ate({viewport:t,devicePixelRatio:e,coordinateSystem:i,coordinateOrigin:n});return c.project_uWrapLongitude=l,c.project_uModelMatrix=r||yO,c}function ute({viewport:t,devicePixelRatio:e,coordinateSystem:r,coordinateOrigin:i}){const{projectionCenter:n,viewProjectionMatrix:l,originCommon:c,cameraPosCommon:o,shaderCoordinateOrigin:m,geospatialOrigin:b}=lte(t,r,i),A=t.getDistanceScales(),R=[t.width*e,t.height*e],M=$y([],[0,0,-t.focalDistance,1],t.projectionMatrix)[3]||1,L={project_uCoordinateSystem:r,project_uProjectionMode:t.projectionMode,project_uCoordinateOrigin:m,project_uCommonOrigin:c.slice(0,3),project_uCenter:n,project_uPseudoMeters:!!t._pseudoMeters,project_uViewportSize:R,project_uDevicePixelRatio:e,project_uFocalDistance:M,project_uCommonUnitsPerMeter:A.unitsPerMeter,project_uCommonUnitsPerWorldUnit:A.unitsPerMeter,project_uCommonUnitsPerWorldUnit2:ote,project_uScale:t.scale,project_uWrapLongitude:!1,project_uViewProjectionMatrix:l,project_uModelMatrix:yO,project_uCameraPosition:o};if(b){const G=t.getDistanceScales(b);switch(r){case Qr.METER_OFFSETS:L.project_uCommonUnitsPerWorldUnit=G.unitsPerMeter,L.project_uCommonUnitsPerWorldUnit2=G.unitsPerMeter2;break;case Qr.LNGLAT:case Qr.LNGLAT_OFFSETS:t._pseudoMeters||(L.project_uCommonUnitsPerMeter=G.unitsPerMeter),L.project_uCommonUnitsPerWorldUnit=G.unitsPerDegree,L.project_uCommonUnitsPerWorldUnit2=G.unitsPerDegree2;break;case Qr.CARTESIAN:L.project_uCommonUnitsPerWorldUnit=[1,1,G.unitsPerMeter[2]],L.project_uCommonUnitsPerWorldUnit2=[0,0,G.unitsPerMeter2[2]];break}}return L}const hte={};function dte(t=hte){return"viewport"in t?cte(t):{}}const cT={name:"project",dependencies:[oQ,Qee],vs:ite,getUniforms:dte},fte=`
vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`,uT={name:"project32",dependencies:[cT],vs:fte};function pte(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function eg(t,e){const r=$y([],e,t);return cO(r,r,1/r[3]),r}function iR(t,e){const r=t%e;return r<0?e+r:r}function V2(t,e,r){return t<e?e:t>r?r:t}function mte(t){return Math.log(t)*Math.LOG2E}const hT=Math.log2||mte;function kh(t,e){if(!t)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}const Ac=Math.PI,xO=Ac/4,Ul=Ac/180,G2=180/Ac,dg=512,_1=4003e4,fv=85.051129,gte=1.5;function _te(t){return hT(t)}function Ey(t){const[e,r]=t;kh(Number.isFinite(e)),kh(Number.isFinite(r)&&r>=-90&&r<=90,"invalid latitude");const i=e*Ul,n=r*Ul,l=dg*(i+Ac)/(2*Ac),c=dg*(Ac+Math.log(Math.tan(xO+n*.5)))/(2*Ac);return[l,c]}function fg(t){const[e,r]=t,i=e/dg*(2*Ac)-Ac,n=2*(Math.atan(Math.exp(r/dg*(2*Ac)-Ac))-xO);return[i*G2,n*G2]}function yte(t){const{latitude:e}=t;kh(Number.isFinite(e));const r=Math.cos(e*Ul);return _te(_1*r)-9}function Hv(t){const e=Math.cos(t*Ul);return dg/_1/e}function H2(t){const{latitude:e,longitude:r,highPrecision:i=!1}=t;kh(Number.isFinite(e)&&Number.isFinite(r));const n=dg,l=Math.cos(e*Ul),c=n/360,o=c/l,m=n/_1/l,b={unitsPerMeter:[m,m,m],metersPerUnit:[1/m,1/m,1/m],unitsPerDegree:[c,o,m],degreesPerUnit:[1/c,1/o,1/m]};if(i){const A=Ul*Math.tan(e*Ul)/l,R=c*A/2,M=n/_1*A,L=M/o*m;b.unitsPerDegree2=[0,R,M],b.unitsPerMeter2=[L,0,L]}return b}function wO(t,e){const[r,i,n]=t,[l,c,o]=e,{unitsPerMeter:m,unitsPerMeter2:b}=H2({longitude:r,latitude:i,highPrecision:!0}),A=Ey(t);A[0]+=l*(m[0]+b[0]*c),A[1]+=c*(m[1]+b[1]*c);const R=fg(A),M=(n||0)+(o||0);return Number.isFinite(n)||Number.isFinite(o)?[R[0],R[1],M]:R}function vte(t){const{height:e,pitch:r,bearing:i,altitude:n,scale:l,center:c}=t,o=pte();g1(o,o,[0,0,-n]),aO(o,o,-r*Ul),lO(o,o,i*Ul);const m=l/e;return oT(o,o,[m,m,m]),c&&g1(o,o,LQ([],c)),o}function bte(t){const{width:e,height:r,altitude:i,pitch:n=0,offset:l,center:c,scale:o,nearZMultiplier:m=1,farZMultiplier:b=1}=t;let{fovy:A=y1(gte)}=t;i!==void 0&&(A=y1(i));const R=A*Ul,M=n*Ul,L=EO(A);let G=L;c&&(G+=c[2]*o/Math.cos(M)/r);const V=R*(.5+(l?l[1]:0)/r),q=Math.sin(V)*G/Math.sin(V2(Math.PI/2-M-V,.01,Math.PI-.01)),J=Math.sin(M)*q+G,ie=G*10,ee=Math.min(J*b,ie);return{fov:R,aspect:e/r,focalDistance:L,near:m,far:ee}}function y1(t){return 2*Math.atan(.5/t)*G2}function EO(t){return .5/Math.tan(.5*t*Ul)}function AO(t,e){const[r,i,n=0]=t;return kh(Number.isFinite(r)&&Number.isFinite(i)&&Number.isFinite(n)),eg(e,[r,i,n,1])}function dT(t,e,r=0){const[i,n,l]=t;if(kh(Number.isFinite(i)&&Number.isFinite(n),"invalid pixel coordinate"),Number.isFinite(l))return eg(e,[i,n,l,1]);const c=eg(e,[i,n,0,1]),o=eg(e,[i,n,1,1]),m=c[2],b=o[2],A=m===b?0:((r||0)-m)/(b-m);return XL([],c,o,A)}function xte(t){const{width:e,height:r,bounds:i,minExtent:n=0,maxZoom:l=24,offset:c=[0,0]}=t,[[o,m],[b,A]]=i,R=wte(t.padding),M=Ey([o,V2(A,-fv,fv)]),L=Ey([b,V2(m,-fv,fv)]),G=[Math.max(Math.abs(L[0]-M[0]),n),Math.max(Math.abs(L[1]-M[1]),n)],V=[e-R.left-R.right-Math.abs(c[0])*2,r-R.top-R.bottom-Math.abs(c[1])*2];kh(V[0]>0&&V[1]>0);const q=V[0]/G[0],J=V[1]/G[1],ie=(R.right-R.left)/2/q,ee=(R.top-R.bottom)/2/J,me=[(L[0]+M[0])/2+ie,(L[1]+M[1])/2+ee],Se=fg(me),Me=Math.min(l,hT(Math.abs(Math.min(q,J))));return kh(Number.isFinite(Me)),{longitude:Se[0],latitude:Se[1],zoom:Me}}function wte(t=0){return typeof t=="number"?{top:t,bottom:t,left:t,right:t}:(kh(Number.isFinite(t.top)&&Number.isFinite(t.bottom)&&Number.isFinite(t.left)&&Number.isFinite(t.right)),t)}const nR=Math.PI/180;function Ete(t,e=0){const{width:r,height:i,unproject:n}=t,l={targetZ:e},c=n([0,i],l),o=n([r,i],l);let m,b;const A=t.fovy?.5*t.fovy*nR:Math.atan(.5/t.altitude),R=(90-t.pitch)*nR;return A>R-.01?(m=sR(t,0,e),b=sR(t,r,e)):(m=n([0,0],l),b=n([r,0],l)),[c,o,b,m]}function sR(t,e,r){const{pixelUnprojectionMatrix:i}=t,n=eg(i,[e,0,1,1]),l=eg(i,[e,t.height,1,1]),c=(r*t.distanceScales.unitsPerMeter[2]-n[2])/(l[2]-n[2]),o=XL([],n,l,c),m=fg(o);return m.push(r),m}const oR=512;function Ate(t){const{width:e,height:r,pitch:i=0}=t;let{longitude:n,latitude:l,zoom:c,bearing:o=0}=t;(n<-180||n>180)&&(n=iR(n+180,360)-180),(o<-180||o>180)&&(o=iR(o+180,360)-180);const m=hT(r/oR);if(c<=m)c=m,l=0;else{const b=r/2/Math.pow(2,c),A=fg([0,b])[1];if(l<A)l=A;else{const R=fg([0,oR-b])[1];l>R&&(l=R)}}return{width:e,height:r,longitude:n,latitude:l,zoom:c,pitch:i,bearing:o}}const Tte=`
const int max_lights = 2;
uniform mat4 shadow_uViewProjectionMatrices[max_lights];
uniform vec4 shadow_uProjectCenters[max_lights];
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform int shadow_uLightId;
uniform float shadow_uLightCount;

out vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  if (shadow_uDrawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[shadow_uLightId], shadow_uProjectCenters[shadow_uLightId]);
  }
  if (shadow_uUseShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow_uLightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[i], shadow_uProjectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,Ste=`
const int max_lights = 2;
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;
uniform vec4 shadow_uColor;
uniform float shadow_uLightCount;

in vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow_uDrawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow_uUseShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow_uLightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow_uColor.a / shadow_uLightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow_uColor.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,Cte=Wy(kte),Pte=Wy(Bte),Rte=[0,0,0,1],Mte=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function Ite(t,e){const[r,i,n]=t,l=dT([r,i,n],e);return Number.isFinite(n)?l:[l[0],l[1],0]}function kte({viewport:t,center:e}){return new Kr(t.viewProjectionMatrix).invert().transform(e)}function Bte({viewport:t,shadowMatrices:e}){const r=[],i=t.pixelUnprojectionMatrix,n=t.isGeospatial?void 0:1,l=[[0,0,n],[t.width,0,n],[0,t.height,n],[t.width,t.height,n],[0,0,-1],[t.width,0,-1],[0,t.height,-1],[t.width,t.height,-1]].map(c=>Ite(c,i));for(const c of e){const o=c.clone().translate(new et(t.center).negate()),m=l.map(A=>o.transform(A)),b=new Kr().ortho({left:Math.min(...m.map(A=>A[0])),right:Math.max(...m.map(A=>A[0])),bottom:Math.min(...m.map(A=>A[1])),top:Math.max(...m.map(A=>A[1])),near:Math.min(...m.map(A=>-A[2])),far:Math.max(...m.map(A=>-A[2]))});r.push(b.multiplyRight(c))}return r}function Lte(t,e){const{shadowEnabled:r=!0}=t;if(!r||!t.shadowMatrices||!t.shadowMatrices.length)return{shadow_uDrawShadowMap:!1,shadow_uUseShadowMap:!1,shadow_uShadowMap0:t.dummyShadowMap,shadow_uShadowMap1:t.dummyShadowMap};const i={shadow_uDrawShadowMap:!!t.drawToShadowMap,shadow_uUseShadowMap:t.shadowMaps?t.shadowMaps.length>0:!1,shadow_uColor:t.shadowColor||Rte,shadow_uLightId:t.shadowLightId||0,shadow_uLightCount:t.shadowMatrices.length},n=Cte({viewport:t.viewport,center:e.project_uCenter}),l=[],c=Pte({shadowMatrices:t.shadowMatrices,viewport:t.viewport}).slice();for(let o=0;o<t.shadowMatrices.length;o++){const m=c[o],b=m.clone().translate(new et(t.viewport.center).negate());e.project_uCoordinateSystem===Qr.LNGLAT&&e.project_uProjectionMode===Su.WEB_MERCATOR?(c[o]=b,l[o]=n):(c[o]=m.clone().multiplyRight(Mte),l[o]=b.transform(n))}for(let o=0;o<c.length;o++)i[`shadow_uViewProjectionMatrices[${o}]`]=c[o],i[`shadow_uProjectCenters[${o}]`]=l[o];for(let o=0;o<2;o++)i[`shadow_uShadowMap${o}`]=t.shadowMaps&&t.shadowMaps[o]||t.dummyShadowMap;return i}const aR={name:"shadow",dependencies:[cT],vs:Tte,fs:Ste,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:(t={},e={})=>"viewport"in t&&(t.drawToShadowMap||t.shadowMaps&&t.shadowMaps.length>0)?Lte(t,e):{}},fT={...qP,defaultUniforms:{...qP.defaultUniforms,useFloatColors:!1},inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}}},Ote=[cT],Dte=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"];function Nte(){const t=bp.getDefaultShaderAssembler();for(const e of Ote)t.addDefaultModule(e);for(const e of Dte)t.addShaderHook(e);return t}const Fte=[255,255,255],zte=1;let jte=0;class Ute{constructor(e={}){this.type="ambient";const{color:r=Fte}=e,{intensity:i=zte}=e;this.id=e.id||`ambient-${jte++}`,this.color=r,this.intensity=i}}const Vte=[255,255,255],Gte=1,Hte=[0,0,-1];let $te=0;class lR{constructor(e={}){this.type="directional";const{color:r=Vte}=e,{intensity:i=Gte}=e,{direction:n=Hte}=e,{_shadow:l=!1}=e;this.id=e.id||`directional-${$te++}`,this.color=r,this.intensity=i,this.type="directional",this.direction=new et(n).normalize().toArray(),this.shadow=l}getProjectedLight(e){return this}}class Wte{constructor(e,r={id:"pass"}){const{id:i}=r;this.id=i,this.device=e,this.props={...r}}setProps(e){Object.assign(this.props,e)}render(e){}cleanup(){}}class pT extends Wte{constructor(){super(...arguments),this._lastRenderIndex=-1}render(e){const[r,i]=this.device.canvasContext.getDrawingBufferSize(),n=e.clearCanvas??!0,l=e.clearColor??(n?[0,0,0,0]:!1),c=n?1:!1,o=n?0:!1,m=e.colorMask??15,b={viewport:[0,0,r,i]};e.colorMask&&(b.colorMask=m),e.scissorRect&&(b.scissorRect=e.scissorRect);const A=this.device.beginRenderPass({framebuffer:e.target,parameters:b,clearColor:l,clearDepth:c,clearStencil:o});try{return this._drawLayers(A,e)}finally{A.end()}}_drawLayers(e,r){const{target:i,moduleParameters:n,viewports:l,views:c,onViewportActive:o,clearStack:m=!0}=r;r.pass=r.pass||"unknown",m&&(this._lastRenderIndex=-1);const b=[];for(const A of l){const R=c&&c[A.id];o?.(A);const M=this._getDrawLayerParams(A,r),L=A.subViewports||[A];for(const G of L){const V=this._drawLayersInViewport(e,{target:i,moduleParameters:n,viewport:G,view:R,pass:r.pass,layers:r.layers},M);b.push(V)}}return b}_getDrawLayerParams(e,{layers:r,pass:i,isPicking:n=!1,layerFilter:l,cullRect:c,effects:o,moduleParameters:m},b=!1){const A=[],R=TO(this._lastRenderIndex+1),M={layer:r[0],viewport:e,isPicking:n,renderPass:i,cullRect:c},L={};for(let G=0;G<r.length;G++){const V=r[G],q=this._shouldDrawLayer(V,M,l,L),J={shouldDrawLayer:q};q&&!b&&(J.layerRenderIndex=R(V,q),J.moduleParameters=this._getModuleParameters(V,o,i,m),J.layerParameters={...V.context.deck?.props.parameters,...this.getLayerParameters(V,G,e)}),A[G]=J}return A}_drawLayersInViewport(e,{layers:r,moduleParameters:i,pass:n,target:l,viewport:c,view:o},m){const b=qte(this.device,{moduleParameters:i,target:l,viewport:c});if(o&&o.props.clear){const R=o.props.clear===!0?{color:!0,depth:!0}:o.props.clear;this.device.withParametersWebGL({scissorTest:!0,scissor:b},()=>this.device.clearWebGL(R))}const A={totalCount:r.length,visibleCount:0,compositeCount:0,pickableCount:0};e.setParameters({viewport:b});for(let R=0;R<r.length;R++){const M=r[R],{shouldDrawLayer:L,layerRenderIndex:G,moduleParameters:V,layerParameters:q}=m[R];if(L&&M.props.pickable&&A.pickableCount++,M.isComposite)A.compositeCount++;else if(L){A.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,G),V.viewport=c,M.context.renderPass=e;try{M._drawLayer({renderPass:e,moduleParameters:V,uniforms:{layerIndex:G},parameters:q})}catch(J){M.raiseError(J,`drawing ${M} to ${n}`)}}}return A}shouldDrawLayer(e){return!0}getModuleParameters(e,r){return null}getLayerParameters(e,r,i){return e.props.parameters}_shouldDrawLayer(e,r,i,n){if(!(e.props.visible&&this.shouldDrawLayer(e)))return!1;r.layer=e;let l=e.parent;for(;l;){if(!l.props.visible||!l.filterSubLayer(r))return!1;r.layer=l,l=l.parent}if(i){const c=r.layer.id;if(c in n||(n[c]=i(r)),!n[c])return!1}return e.activateViewport(r.viewport),!0}_getModuleParameters(e,r,i,n){const l=this.device.canvasContext.cssToDeviceRatio(),c=Object.assign(Object.create(e.internalState?.propsInTransition||e.props),{autoWrapLongitude:e.wrapLongitude,viewport:e.context.viewport,mousePosition:e.context.mousePosition,picking:{isActive:0},devicePixelRatio:l});if(r)for(const o of r)Object.assign(c,o.getModuleParameters?.(e));return Object.assign(c,this.getModuleParameters(e,r),n)}}function TO(t=0,e={}){const r={},i=(n,l)=>{const c=n.props._offset,o=n.id,m=n.parent&&n.parent.id;let b;if(m&&!(m in e)&&i(n.parent,!1),m in r){const A=r[m]=r[m]||TO(e[m],e);b=A(n,l),r[o]=A}else Number.isFinite(c)?(b=c+(e[m]||0),r[o]=null):b=t;return l&&b>=t&&(t=b+1),e[o]=b,b};return i}function qte(t,{moduleParameters:e,target:r,viewport:i}){const n=e&&e.devicePixelRatio||t.canvasContext.cssToDeviceRatio(),[,l]=t.canvasContext.getDrawingBufferSize(),c=r?r.height:l,o=i;return[o.x*n,c-(o.y+o.height)*n,o.width*n,o.height*n]}class Kte extends pT{constructor(e,r){super(e,r),this.shadowMap=e.createTexture({width:1,height:1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}}),this.depthBuffer=e.createTexture({format:"depth16unorm",width:1,height:1,mipmaps:!1,dataFormat:6402,type:5125}),this.fbo=e.createFramebuffer({id:"shadowmap",width:1,height:1,colorAttachments:[this.shadowMap],depthStencilAttachment:this.depthBuffer})}render(e){const r=this.fbo,i=this.device.canvasContext.cssToDeviceRatio(),n=e.viewports[0],l=n.width*i,c=n.height*i,o=[1,1,1,1];(l!==r.width||c!==r.height)&&r.resize({width:l,height:c}),super.render({...e,clearColor:o,target:r,pass:"shadow"})}getLayerParameters(e,r,i){return{...e.props.parameters,blend:!1,depthRange:[0,1],depthTest:!0}}shouldDrawLayer(e){return e.props.shadowEnabled!==!1}getModuleParameters(){return{drawToShadowMap:!0}}delete(){this.fbo&&(this.fbo.destroy(),this.fbo=null),this.shadowMap&&(this.shadowMap.destroy(),this.shadowMap=null),this.depthBuffer&&(this.depthBuffer.destroy(),this.depthBuffer=null)}}const Zte={color:[255,255,255],intensity:1},cR=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],Xte=[0,0,0,200/255];class SO{constructor(e={}){this.id="lighting-effect",this.shadowColor=Xte,this.shadow=!1,this.ambientLight=null,this.directionalLights=[],this.pointLights=[],this.shadowPasses=[],this.shadowMaps=[],this.dummyShadowMap=null,this.setProps(e)}setup(e){this.context=e;const{device:r,deck:i}=e;this.shadow&&!this.dummyShadowMap&&(this._createShadowPasses(r),i._addDefaultShaderModule(aR),this.dummyShadowMap=r.createTexture({width:1,height:1}))}setProps(e){this.ambientLight=null,this.directionalLights=[],this.pointLights=[];for(const r in e){const i=e[r];switch(i.type){case"ambient":this.ambientLight=i;break;case"directional":this.directionalLights.push(i);break;case"point":this.pointLights.push(i);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(r=>r.shadow),this.context&&this.setup(this.context),this.props=e}preRender({layers:e,layerFilter:r,viewports:i,onViewportActive:n,views:l}){if(this.shadow){this.shadowMatrices=this._calculateMatrices();for(let c=0;c<this.shadowPasses.length;c++)this.shadowPasses[c].render({layers:e,layerFilter:r,viewports:i,onViewportActive:n,views:l,moduleParameters:{shadowLightId:c,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}})}}getModuleParameters(e){const r=this.shadow?{shadowMaps:this.shadowMaps,dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{};return r.lightSources={ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(i=>i.getProjectedLight({layer:e})),pointLights:this.pointLights.map(i=>i.getProjectedLight({layer:e}))},r}cleanup(e){for(const r of this.shadowPasses)r.delete();this.shadowPasses.length=0,this.shadowMaps.length=0,this.dummyShadowMap&&(this.dummyShadowMap.destroy(),this.dummyShadowMap=null,e.deck._removeDefaultShaderModule(aR))}_calculateMatrices(){const e=[];for(const r of this.directionalLights){const i=new Kr().lookAt({eye:new et(r.direction).negate()});e.push(i)}return e}_createShadowPasses(e){for(let r=0;r<this.directionalLights.length;r++){const i=new Kte(e);this.shadowPasses[r]=i,this.shadowMaps[r]=i.shadowMap}}_applyDefaultLights(){const{ambientLight:e,pointLights:r,directionalLights:i}=this;!e&&r.length===0&&i.length===0&&(this.ambientLight=new Ute(Zte),this.directionalLights.push(new lR(cR[0]),new lR(cR[1])))}}class Yte{constructor(e={}){this._pool=[],this.opts={overAlloc:2,poolSize:100},this.setOptions(e)}setOptions(e){Object.assign(this.opts,e)}allocate(e,r,{size:i=1,type:n,padding:l=0,copy:c=!1,initialize:o=!1,maxCount:m}){const b=n||e&&e.constructor||Float32Array,A=r*i+l;if(ArrayBuffer.isView(e)){if(A<=e.length)return e;if(A*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new b(e.buffer,0,A)}let R=1/0;m&&(R=m*i+l);const M=this._allocate(b,A,o,R);return e&&c?M.set(e):o||M.fill(0,0,4),this._release(e),M}release(e){this._release(e)}_allocate(e,r,i,n){let l=Math.max(Math.ceil(r*this.opts.overAlloc),1);l>n&&(l=n);const c=this._pool,o=e.BYTES_PER_ELEMENT*l,m=c.findIndex(b=>b.byteLength>=o);if(m>=0){const b=new e(c.splice(m,1)[0],0,l);return i&&b.fill(0),b}return new e(l)}_release(e){if(!ArrayBuffer.isView(e))return;const r=this._pool,{buffer:i}=e,{byteLength:n}=i,l=r.findIndex(c=>c.byteLength>=n);l<0?r.push(i):(l>0||r.length<this.opts.poolSize)&&r.splice(l,0,i),r.length>this.opts.poolSize&&r.shift()}}const Ay=new Yte;function $_(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Jte(t){return[t[12],t[13],t[14]]}function Qte(t){return{left:Sm(t[3]+t[0],t[7]+t[4],t[11]+t[8],t[15]+t[12]),right:Sm(t[3]-t[0],t[7]-t[4],t[11]-t[8],t[15]-t[12]),bottom:Sm(t[3]+t[1],t[7]+t[5],t[11]+t[9],t[15]+t[13]),top:Sm(t[3]-t[1],t[7]-t[5],t[11]-t[9],t[15]-t[13]),near:Sm(t[3]+t[2],t[7]+t[6],t[11]+t[10],t[15]+t[14]),far:Sm(t[3]-t[2],t[7]-t[6],t[11]-t[10],t[15]-t[14])}}const uR=new et;function Sm(t,e,r,i){uR.set(t,e,r);const n=uR.len();return{distance:i/n,normal:new et(-t/n,-e/n,-r/n)}}function ere(t){return t-Math.fround(t)}let M_;function Wx(t,e){const{size:r=1,startIndex:i=0}=e,n=e.endIndex!==void 0?e.endIndex:t.length,l=(n-i)/r;M_=Ay.allocate(M_,l,{type:Float32Array,size:r*2});let c=i,o=0;for(;c<n;){for(let m=0;m<r;m++){const b=t[c++];M_[o+m]=b,M_[o+m+r]=ere(b)}o+=r*2}return M_.subarray(0,l*r*2)}function tre(t){let e=null,r=!1;for(const i of t)i&&(e?(r||(e=[[e[0][0],e[0][1]],[e[1][0],e[1][1]]],r=!0),e[0][0]=Math.min(e[0][0],i[0][0]),e[0][1]=Math.min(e[0][1],i[0][1]),e[1][0]=Math.max(e[1][0],i[1][0]),e[1][1]=Math.max(e[1][1],i[1][1])):e=i);return e}const rre=Math.PI/180,ire=$_(),hR=[0,0,0],nre={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function sre({width:t,height:e,orthographic:r,fovyRadians:i,focalDistance:n,padding:l,near:c,far:o}){const m=t/e,b=r?new Kr().orthographic({fovy:i,aspect:m,focalDistance:n,near:c,far:o}):new Kr().perspective({fovy:i,aspect:m,near:c,far:o});if(l){const{left:A=0,right:R=0,top:M=0,bottom:L=0}=l,G=Eh((A+t-R)/2,0,t)-t/2,V=Eh((M+e-L)/2,0,e)-e/2;b[8]-=G*2/t,b[9]+=V*2/e}return b}class qy{constructor(e={}){this._frustumPlanes={},this.id=e.id||this.constructor.displayName||"viewport",this.x=e.x||0,this.y=e.y||0,this.width=e.width||1,this.height=e.height||1,this.zoom=e.zoom||0,this.padding=e.padding,this.distanceScales=e.distanceScales||nre,this.focalDistance=e.focalDistance||1,this.position=e.position||hR,this.modelMatrix=e.modelMatrix||null;const{longitude:r,latitude:i}=e;this.isGeospatial=Number.isFinite(i)&&Number.isFinite(r),this._initProps(e),this._initMatrices(e),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?Su.WEB_MERCATOR:Su.WEB_MERCATOR_AUTO_OFFSET:Su.IDENTITY}equals(e){return e instanceof qy?this===e?!0:e.width===this.width&&e.height===this.height&&e.scale===this.scale&&Pc(e.projectionMatrix,this.projectionMatrix)&&Pc(e.viewMatrix,this.viewMatrix):!1}project(e,{topLeft:r=!0}={}){const i=this.projectPosition(e),n=AO(i,this.pixelProjectionMatrix),[l,c]=n,o=r?c:this.height-c;return e.length===2?[l,o]:[l,o,n[2]]}unproject(e,{topLeft:r=!0,targetZ:i}={}){const[n,l,c]=e,o=r?l:this.height-l,m=i&&i*this.distanceScales.unitsPerMeter[2],b=dT([n,o,c],this.pixelUnprojectionMatrix,m),[A,R,M]=this.unprojectPosition(b);return Number.isFinite(c)?[A,R,M]:Number.isFinite(i)?[A,R,i]:[A,R]}projectPosition(e){const[r,i]=this.projectFlat(e),n=(e[2]||0)*this.distanceScales.unitsPerMeter[2];return[r,i,n]}unprojectPosition(e){const[r,i]=this.unprojectFlat(e),n=(e[2]||0)*this.distanceScales.metersPerUnit[2];return[r,i,n]}projectFlat(e){if(this.isGeospatial){const r=Ey(e);return r[1]=Eh(r[1],-318,830),r}return e}unprojectFlat(e){return this.isGeospatial?fg(e):e}getBounds(e={}){const r={targetZ:e.z||0},i=this.unproject([0,0],r),n=this.unproject([this.width,0],r),l=this.unproject([0,this.height],r),c=this.unproject([this.width,this.height],r);return[Math.min(i[0],n[0],l[0],c[0]),Math.min(i[1],n[1],l[1],c[1]),Math.max(i[0],n[0],l[0],c[0]),Math.max(i[1],n[1],l[1],c[1])]}getDistanceScales(e){return e?H2({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel({x:e,y:r,width:i=1,height:n=1}){return e<this.x+this.width&&this.x<e+i&&r<this.y+this.height&&this.y<r+n}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,Qte(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(e,r){return null}_initProps(e){const r=e.longitude,i=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=yte({latitude:i})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||H2({latitude:i,longitude:r}));const n=Math.pow(2,this.zoom);this.scale=n;const{position:l,modelMatrix:c}=e;let o=hR;if(l&&(o=c?new Kr(c).transformAsVector(l,[]):l),this.isGeospatial){const m=this.projectPosition([r,i,0]);this.center=new et(o).scale(this.distanceScales.unitsPerMeter).add(m)}else this.center=this.projectPosition(o)}_initMatrices(e){const{viewMatrix:r=ire,projectionMatrix:i=null,orthographic:n=!1,fovyRadians:l,fovy:c=75,near:o=.1,far:m=1e3,padding:b=null,focalDistance:A=1}=e;this.viewMatrixUncentered=r,this.viewMatrix=new Kr().multiplyRight(r).translate(new et(this.center).negate()),this.projectionMatrix=i||sre({width:this.width,height:this.height,orthographic:n,fovyRadians:l||c*rre,focalDistance:A,padding:b,near:o,far:m});const R=$_();Sp(R,R,this.projectionMatrix),Sp(R,R,this.viewMatrix),this.viewProjectionMatrix=R,this.viewMatrixInverse=F2([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=Jte(this.viewMatrixInverse);const M=$_(),L=$_();oT(M,M,[this.width/2,-this.height/2,1]),g1(M,M,[1,-1,0]),Sp(L,M,this.viewProjectionMatrix),this.pixelProjectionMatrix=L,this.pixelUnprojectionMatrix=F2($_(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||hi.warn("Pixel project matrix not invertible")()}}qy.displayName="Viewport";class Mp extends qy{constructor(e={}){const{latitude:r=0,longitude:i=0,zoom:n=0,pitch:l=0,bearing:c=0,nearZMultiplier:o=.1,farZMultiplier:m=1.01,nearZ:b,farZ:A,orthographic:R=!1,projectionMatrix:M,repeat:L=!1,worldOffset:G=0,position:V,padding:q,legacyMeterSizes:J=!1}=e;let{width:ie,height:ee,altitude:me=1.5}=e;const Se=Math.pow(2,n);ie=ie||1,ee=ee||1;let Me,Ve=null;if(M)me=M[5]/2,Me=y1(me);else{e.fovy?(Me=e.fovy,me=EO(Me)):Me=y1(me);let $e;if(q){const{top:at=0,bottom:_t=0}=q;$e=[0,Eh((at+ee-_t)/2,0,ee)-ee/2]}Ve=bte({width:ie,height:ee,scale:Se,center:V&&[0,0,V[2]*Hv(r)],offset:$e,pitch:l,fovy:Me,nearZMultiplier:o,farZMultiplier:m}),Number.isFinite(b)&&(Ve.near=b),Number.isFinite(A)&&(Ve.far=A)}let Be=vte({height:ee,pitch:l,bearing:c,scale:Se,altitude:me});G&&(Be=new Kr().translate([512*G,0,0]).multiplyLeft(Be)),super({...e,width:ie,height:ee,viewMatrix:Be,longitude:i,latitude:r,zoom:n,...Ve,fovy:Me,focalDistance:me}),this.latitude=r,this.longitude=i,this.zoom=n,this.pitch=l,this.bearing=c,this.altitude=me,this.fovy=Me,this.orthographic=R,this._subViewports=L?[]:null,this._pseudoMeters=J,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const e=this.getBounds(),r=Math.floor((e[0]+180)/360),i=Math.ceil((e[2]-180)/360);for(let n=r;n<=i;n++){const l=n?new Mp({...this,worldOffset:n}):this;this._subViewports.push(l)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);const[r,i]=this.projectFlat(e),n=(e[2]||0)*Hv(e[1]);return[r,i,n]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);const[r,i]=this.unprojectFlat(e),n=(e[2]||0)/Hv(i);return[r,i,n]}addMetersToLngLat(e,r){return wO(e,r)}panByPosition(e,r){const i=dT(r,this.pixelUnprojectionMatrix),n=this.projectFlat(e),l=KP([],n,PQ([],i)),c=KP([],this.center,l),[o,m]=this.unprojectFlat(c);return{longitude:o,latitude:m}}getBounds(e={}){const r=Ete(this,e.z||0);return[Math.min(r[0][0],r[1][0],r[2][0],r[3][0]),Math.min(r[0][1],r[1][1],r[2][1],r[3][1]),Math.max(r[0][0],r[1][0],r[2][0],r[3][0]),Math.max(r[0][1],r[1][1],r[2][1],r[3][1])]}fitBounds(e,r={}){const{width:i,height:n}=this,{longitude:l,latitude:c,zoom:o}=xte({width:i,height:n,bounds:e,...r});return new Mp({width:i,height:n,longitude:l,latitude:c,zoom:o})}}Mp.displayName="WebMercatorViewport";const dR=[0,0,0];function qx(t,e,r=!1){const i=e.projectPosition(t);if(r&&e instanceof Mp){const[n,l,c=0]=t,o=e.getDistanceScales([n,l]);i[2]=c*o.unitsPerMeter[2]}return i}function ore(t){const{viewport:e,modelMatrix:r,coordinateOrigin:i}=t;let{coordinateSystem:n,fromCoordinateSystem:l,fromCoordinateOrigin:c}=t;return n===Qr.DEFAULT&&(n=e.isGeospatial?Qr.LNGLAT:Qr.CARTESIAN),l===void 0&&(l=n),c===void 0&&(c=i),{viewport:e,coordinateSystem:n,coordinateOrigin:i,modelMatrix:r,fromCoordinateSystem:l,fromCoordinateOrigin:c}}function CO(t,{viewport:e,modelMatrix:r,coordinateSystem:i,coordinateOrigin:n,offsetMode:l}){let[c,o,m=0]=t;switch(r&&([c,o,m]=$y([],[c,o,m,1],r)),i){case Qr.LNGLAT:return qx([c,o,m],e,l);case Qr.LNGLAT_OFFSETS:return qx([c+n[0],o+n[1],m+(n[2]||0)],e,l);case Qr.METER_OFFSETS:return qx(wO(n,[c,o,m]),e,l);case Qr.CARTESIAN:default:return e.isGeospatial?[c+n[0],o+n[1],m+n[2]]:e.projectPosition([c,o,m])}}function are(t,e){const{viewport:r,coordinateSystem:i,coordinateOrigin:n,modelMatrix:l,fromCoordinateSystem:c,fromCoordinateOrigin:o}=ore(e),{autoOffset:m=!0}=e,{geospatialOrigin:b=dR,shaderCoordinateOrigin:A=dR,offsetMode:R=!1}=m?bO(r,i,n):{},M=CO(t,{viewport:r,modelMatrix:l,coordinateSystem:c,coordinateOrigin:o,offsetMode:R});if(R){const L=r.projectPosition(b||A);jQ(M,M,L)}return M}let lre=1,cre=1;class PO{time=0;channels=new Map;animations=new Map;playing=!1;lastEngineTime=-1;constructor(){}addChannel(e){const{delay:r=0,duration:i=Number.POSITIVE_INFINITY,rate:n=1,repeat:l=1}=e,c=lre++,o={time:0,delay:r,duration:i,rate:n,repeat:l};return this._setChannelTime(o,this.time),this.channels.set(c,o),c}removeChannel(e){this.channels.delete(e);for(const[r,i]of this.animations)i.channel===e&&this.detachAnimation(r)}isFinished(e){const r=this.channels.get(e);return r===void 0?!1:this.time>=r.delay+r.duration*r.repeat}getTime(e){if(e===void 0)return this.time;const r=this.channels.get(e);return r===void 0?-1:r.time}setTime(e){this.time=Math.max(0,e);const r=this.channels.values();for(const n of r)this._setChannelTime(n,this.time);const i=this.animations.values();for(const n of i){const{animation:l,channel:c}=n;l.setTime(this.getTime(c))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,r){const i=cre++;return this.animations.set(i,{animation:e,channel:r}),e.setTime(this.getTime(r)),i}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,r){const i=r-e.delay,n=e.duration*e.repeat;i>=n?e.time=e.duration*e.rate:(e.time=Math.max(0,i)%e.duration,e.time*=e.rate)}}let ure=0;const hre={device:null,onAddHTML:()=>"",onInitialize:async()=>null,onRender:()=>{},onFinalize:()=>{},onError:t=>console.error(t),stats:Jm.stats.get(`animation-loop-${ure++}`),useDevicePixels:!0,autoResizeViewport:!1,autoResizeDrawingBuffer:!1};class dre{device=null;canvas=null;props;animationProps=null;timeline=null;stats;cpuTime;gpuTime;frameRate;display;needsRedraw="initialized";_initialized=!1;_running=!1;_animationFrameId=null;_nextFramePromise=null;_resolveNextFrame=null;_cpuStartTime=0;constructor(e){if(this.props={...hre,...e},e=this.props,!e.device)throw new Error("No device provided");const{useDevicePixels:r=!0}=this.props;this.stats=e.stats||new kg({id:"animation-loop-stats"}),this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this.setProps({autoResizeViewport:e.autoResizeViewport,autoResizeDrawingBuffer:e.autoResizeDrawingBuffer,useDevicePixels:r}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}destroy(){this.stop(),this._setDisplay(null)}delete(){this.destroy()}setNeedsRedraw(e){return this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.props.autoResizeViewport=e.autoResizeViewport||!1),"autoResizeDrawingBuffer"in e&&(this.props.autoResizeDrawingBuffer=e.autoResizeDrawingBuffer||!1),"useDevicePixels"in e&&(this.props.useDevicePixels=e.useDevicePixels||!1),this}async start(){if(this._running)return this;this._running=!0;try{let e;return this._initialized||(this._initialized=!0,await this._initDevice(),this._initialize(),await this.props.onInitialize(this._getAnimationProps())),this._running?(e!==!1&&(this._cancelAnimationFrame(),this._requestAnimationFrame()),this):null}catch(e){const r=e instanceof Error?e:new Error("Unknown error");throw this.props.onError(r),r}}stop(){return this._running&&(this.animationProps&&this.props.onFinalize(this.animationProps),this._cancelAnimationFrame(),this._nextFramePromise=null,this._resolveNextFrame=null,this._running=!1),this}redraw(){return this.device?.isLost?this:(this._beginFrameTimers(),this._setupFrame(),this._updateAnimationProps(),this._renderFrame(this._getAnimationProps()),this._clearNeedsRedraw(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endFrameTimers(),this)}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}async toDataURL(){if(this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.canvas instanceof HTMLCanvasElement)return this.canvas.toDataURL();throw new Error("OffscreenCanvas")}_initialize(){this._startEventHandling(),this._initializeAnimationProps(),this._updateAnimationProps(),this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_setDisplay(e){this.display&&(this.display.destroy(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_requestAnimationFrame(){this._running&&(this._animationFrameId=yJ(this._animationFrame.bind(this)))}_cancelAnimationFrame(){this._animationFrameId!==null&&(vJ(this._animationFrameId),this._animationFrameId=null)}_animationFrame(){this._running&&(this.redraw(),this._requestAnimationFrame())}_renderFrame(e){if(this.display){this.display._renderFrame(e);return}this.props.onRender(this._getAnimationProps()),this.device.submit()}_clearNeedsRedraw(){this.needsRedraw=!1}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_initializeAnimationProps(){if(!this.device)throw new Error("loop");this.animationProps={animationLoop:this,device:this.device,canvas:this.device?.canvasContext?.canvas,timeline:this.timeline,useDevicePixels:this.props.useDevicePixels,needsRedraw:!1,width:1,height:1,aspect:1,time:0,startTime:Date.now(),engineTime:0,tick:0,tock:0,_mousePosition:null}}_getAnimationProps(){if(!this.animationProps)throw new Error("animationProps");return this.animationProps}_updateAnimationProps(){if(!this.animationProps)return;const{width:e,height:r,aspect:i}=this._getSizeAndAspect();(e!==this.animationProps.width||r!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),i!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=r,this.animationProps.aspect=i,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime}async _initDevice(){if(this.device=await this.props.device,!this.device)throw new Error("No device provided");this.canvas=this.device.canvasContext?.canvas||null}_createInfoDiv(){if(this.canvas&&this.props.onAddHTML){const e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";const r=document.createElement("div");r.style.position="absolute",r.style.left="10px",r.style.bottom="10px",r.style.width="300px",r.style.background="white",this.canvas instanceof HTMLCanvasElement&&e.appendChild(this.canvas),e.appendChild(r);const i=this.props.onAddHTML(r);i&&(r.innerHTML=i)}}_getSizeAndAspect(){if(!this.device)return{width:1,height:1,aspect:1};const[e,r]=this.device?.canvasContext?.getPixelSize()||[1,1];let i=1;const n=this.device?.canvasContext?.canvas;return n&&n.clientHeight?i=n.clientWidth/n.clientHeight:e>0&&r>0&&(i=e/r),{width:e,height:r,aspect:i}}_resizeViewport(){this.props.autoResizeViewport&&this.device.gl&&this.device.gl.viewport(0,0,this.device.gl.drawingBufferWidth,this.device.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){this.props.autoResizeDrawingBuffer&&this.device?.canvasContext?.resize({useDevicePixels:this.props.useDevicePixels})}_beginFrameTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this.cpuTime.timeStart()}_endFrameTimers(){this.cpuTime.timeEnd()}_startEventHandling(){this.canvas&&(this.canvas.addEventListener("mousemove",this._onMousemove.bind(this)),this.canvas.addEventListener("mouseleave",this._onMouseleave.bind(this)))}_onMousemove(e){e instanceof MouseEvent&&(this._getAnimationProps()._mousePosition=[e.offsetX,e.offsetY])}_onMouseleave(e){this._getAnimationProps()._mousePosition=null}}class fR{id;userData={};topology;bufferLayout=[];vertexCount;indices;attributes;constructor(e){this.id=e.id||Kd("geometry"),this.topology=e.topology,this.indices=e.indices||null,this.attributes=e.attributes,this.vertexCount=e.vertexCount,this.bufferLayout=e.bufferLayout||[],this.indices&&_i(this.indices.usage===rn.INDEX)}destroy(){this.indices?.destroy();for(const e of Object.values(this.attributes))e.destroy()}getVertexCount(){return this.vertexCount}getAttributes(){return this.attributes}getIndexes(){return this.indices}_calculateVertexCount(e){return e.byteLength/12}}function fre(t,e){if(e instanceof fR)return e;const r=pre(t,e),{attributes:i,bufferLayout:n}=mre(t,e);return new fR({topology:e.topology||"triangle-list",bufferLayout:n,vertexCount:e.vertexCount,indices:r,attributes:i})}function pre(t,e){if(!e.indices)return;const r=e.indices.value;return t.createBuffer({usage:rn.INDEX,data:r})}function mre(t,e){const r=[],i={};for(const[l,c]of Object.entries(e.attributes)){let o=l;switch(l){case"POSITION":o="positions";break;case"NORMAL":o="normals";break;case"TEXCOORD_0":o="texCoords";break;case"COLOR_0":o="colors";break}i[o]=t.createBuffer({data:c.value,id:`${l}-buffer`});const{value:m,size:b,normalized:A}=c;r.push({name:o,format:fJ(m,b,A)})}const n=e._calculateVertexCount(e.attributes,e.indices);return{attributes:i,bufferLayout:r,vertexCount:n}}class gre{modules;moduleUniforms;moduleBindings;moduleUniformsChanged;constructor(e){const r=J1(Object.values(e).filter(i=>i.dependencies));for(const i of r)e[i.name]=i;Pt.log(1,"Creating ShaderInputs with modules",Object.keys(e))(),this.modules=e,this.moduleUniforms={},this.moduleBindings={};for(const[i,n]of Object.entries(e)){const l=i;this.moduleUniforms[l]=n.defaultUniforms||{},this.moduleBindings[l]={}}}destroy(){}setProps(e){for(const r of Object.keys(e)){const i=r,n=e[i],l=this.modules[i];if(!l){Pt.warn(`Module ${r} not found`)();continue}const c=this.moduleUniforms[i],o=this.moduleBindings[i],m=l.getUniforms?.(n,c)||n,{uniforms:b,bindings:A}=JA(m);this.moduleUniforms[i]={...c,...b},this.moduleBindings[i]={...o,...A}}}getModules(){return Object.values(this.modules)}getUniformValues(){return this.moduleUniforms}getBindings(){const e={};for(const r of Object.values(this.moduleBindings))Object.assign(e,r);return e}getDebugTable(){const e={};for(const[r,i]of Object.entries(this.moduleUniforms))for(const[n,l]of Object.entries(i))e[`${r}.${n}`]={type:this.modules[r].uniformTypes?.[n],value:String(l)};return e}}class mT{static defaultProps={...ug.defaultProps};device;_hashCounter=0;_hashes={};_renderPipelineCache={};_computePipelineCache={};static getDefaultPipelineFactory(e){return e._lumaData.defaultPipelineFactory=e._lumaData.defaultPipelineFactory||new mT(e),e._lumaData.defaultPipelineFactory}constructor(e){this.device=e}createRenderPipeline(e){const r={...ug.defaultProps,...e},i=this._hashRenderPipeline(r);if(!this._renderPipelineCache[i]){const n=this.device.createRenderPipeline({...r,id:r.id?`${r.id}-cached`:void 0});n.hash=i,this._renderPipelineCache[i]={pipeline:n,useCount:0}}return this._renderPipelineCache[i].useCount++,this._renderPipelineCache[i].pipeline}createComputePipeline(e){const r={...d1.defaultProps,...e},i=this._hashComputePipeline(r);if(!this._computePipelineCache[i]){const n=this.device.createComputePipeline({...r,id:r.id?`${r.id}-cached`:void 0});n.hash=i,this._computePipelineCache[i]={pipeline:n,useCount:0}}return this._computePipelineCache[i].useCount++,this._computePipelineCache[i].pipeline}release(e){const r=e.hash,i=e instanceof d1?this._computePipelineCache:this._renderPipelineCache;i[r].useCount--,i[r].useCount===0&&(i[r].pipeline.destroy(),delete i[r])}_hashComputePipeline(e){return`${this._getHash(e.shader.source)}`}_hashRenderPipeline(e){const r=this._getHash(e.vs.source),i=e.fs?this._getHash(e.fs.source):0,n="-",l=this._getHash(JSON.stringify(e.bufferLayout));switch(this.device.type){case"webgl":return`${r}/${i}V${n}BL${l}`;default:const c=this._getHash(JSON.stringify(e.parameters));return`${r}/${i}V${n}T${e.topology}P${c}BL${l}`}}_getHash(e){return this._hashes[e]===void 0&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}}class gT{static defaultProps={...tb.defaultProps};device;_cache={};static getDefaultShaderFactory(e){return e._lumaData.defaultShaderFactory||=new gT(e),e._lumaData.defaultShaderFactory}constructor(e){this.device=e}createShader(e){const r=this._hashShader(e);let i=this._cache[r];if(!i){const n=this.device.createShader({...e,id:e.id?`${e.id}-cached`:void 0});this._cache[r]=i={shader:n,useCount:0}}return i.useCount++,i.shader}release(e){const r=this._hashShader(e),i=this._cache[r];i&&(i.useCount--,i.useCount===0&&(delete this._cache[r],i.shader.destroy()))}_hashShader(e){return`${e.stage}:${e.source}`}}function _re(t,e){const r={},i="Values";if(t.attributes.length===0&&!t.varyings?.length)return{"No attributes or varyings":{[i]:"N/A"}};for(const n of t.attributes)if(n){const l=`${n.location} ${n.name}: ${n.type}`;r[`in ${l}`]={[i]:n.stepMode||"vertex"}}for(const n of t.varyings||[]){const l=`${n.location} ${n.name}`;r[`out ${l}`]={[i]:JSON.stringify(n.accessor)}}return r}let Us=null,Kx=null;function yre(t,{id:e,minimap:r,opaque:i,top:n="0",left:l="0",rgbaScale:c=1}){Us||(Us=document.createElement("canvas"),Us.id=e,Us.title=e,Us.style.zIndex="100",Us.style.position="absolute",Us.style.top=n,Us.style.left=l,Us.style.border="blue 1px solid",Us.style.transform="scaleY(-1)",document.body.appendChild(Us),Kx=Us.getContext("2d")),(Us.width!==t.width||Us.height!==t.height)&&(Us.width=t.width/2,Us.height=t.height/2,Us.style.width="400px",Us.style.height="400px");const o=t.device.readPixelsToArrayWebGL(t),m=Kx.createImageData(t.width,t.height),b=0;for(let A=0;A<o.length;A+=4)m.data[b+A+0]=o[A+0]*c,m.data[b+A+1]=o[A+1]*c,m.data[b+A+2]=o[A+2]*c,m.data[b+A+3]=i?255:o[A+3]*c;Kx.putImageData(m,0,0)}const Cm=2,vre=1e4;class jd{static defaultProps={...ug.defaultProps,source:null,vs:null,fs:null,id:"unnamed",handle:void 0,userData:{},defines:{},modules:[],moduleSettings:void 0,geometry:null,indexBuffer:null,attributes:{},constantAttributes:{},varyings:[],isInstanced:void 0,instanceCount:0,vertexCount:0,shaderInputs:void 0,pipelineFactory:void 0,shaderFactory:void 0,transformFeedback:void 0,shaderAssembler:bp.getDefaultShaderAssembler(),debugShaders:void 0,disableWarnings:void 0};device;id;source;vs;fs;pipelineFactory;shaderFactory;userData={};parameters;topology;bufferLayout;isInstanced=void 0;instanceCount=0;vertexCount;indexBuffer=null;bufferAttributes={};constantAttributes={};bindings={};uniforms={};vertexArray;transformFeedback=null;pipeline;shaderInputs;_uniformStore;_attributeInfos={};_gpuGeometry=null;_getModuleUniforms;props;_pipelineNeedsUpdate="newly created";_needsRedraw="initializing";_destroyed=!1;_lastDrawTimestamp=-1;constructor(e,r){this.props={...jd.defaultProps,...r},r=this.props,this.id=r.id||Kd("model"),this.device=e,Object.assign(this.userData,r.userData);const i=Object.fromEntries(this.props.modules?.map(c=>[c.name,c])||[]);this.setShaderInputs(r.shaderInputs||new gre(i));const n=bre(e),l=(this.props.modules?.length>0?this.props.modules:this.shaderInputs?.getModules())||[];if(this.device.type==="webgpu"&&this.props.source){this.props.shaderLayout||=iQ(this.props.source);const{source:c,getUniforms:o}=this.props.shaderAssembler.assembleShader({platformInfo:n,...this.props,modules:l});this.source=c,this._getModuleUniforms=o}else{const{vs:c,fs:o,getUniforms:m}=this.props.shaderAssembler.assembleShaderPair({platformInfo:n,...this.props,modules:l});this.vs=c,this.fs=o,this._getModuleUniforms=m}this.vertexCount=this.props.vertexCount,this.instanceCount=this.props.instanceCount,this.topology=this.props.topology,this.bufferLayout=this.props.bufferLayout,this.parameters=this.props.parameters,r.geometry&&this.setGeometry(r.geometry),this.pipelineFactory=r.pipelineFactory||mT.getDefaultPipelineFactory(this.device),this.shaderFactory=r.shaderFactory||gT.getDefaultShaderFactory(this.device),this.pipeline=this._updatePipeline(),this.vertexArray=e.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry),"isInstanced"in r&&(this.isInstanced=r.isInstanced),r.instanceCount&&this.setInstanceCount(r.instanceCount),r.vertexCount&&this.setVertexCount(r.vertexCount),r.indexBuffer&&this.setIndexBuffer(r.indexBuffer),r.attributes&&this.setAttributes(r.attributes),r.constantAttributes&&this.setConstantAttributes(r.constantAttributes),r.bindings&&this.setBindings(r.bindings),r.uniforms&&this.setUniforms(r.uniforms),r.moduleSettings&&this.updateModuleSettings(r.moduleSettings),r.transformFeedback&&(this.transformFeedback=r.transformFeedback),Object.seal(this)}destroy(){this._destroyed||(this.pipelineFactory.release(this.pipeline),this.shaderFactory.release(this.pipeline.vs),this.pipeline.fs&&this.shaderFactory.release(this.pipeline.fs),this._uniformStore.destroy(),this._gpuGeometry?.destroy(),this._destroyed=!0)}needsRedraw(){this._getBindingsUpdateTimestamp()>this._lastDrawTimestamp&&this.setNeedsRedraw("contents of bound textures or buffers updated");const e=this._needsRedraw;return this._needsRedraw=!1,e}setNeedsRedraw(e){this._needsRedraw||=e}predraw(){this.updateShaderInputs(),this.pipeline=this._updatePipeline()}draw(e){this.predraw();let r;try{this._logDrawCallStart(),this.pipeline=this._updatePipeline(),this.pipeline.setBindings(this.bindings,{disableWarnings:this.props.disableWarnings}),h1(this.uniforms)||this.pipeline.setUniformsWebGL(this.uniforms);const{indexBuffer:i}=this.vertexArray,n=i?i.byteLength/(i.indexType==="uint32"?4:2):void 0;r=this.pipeline.draw({renderPass:e,vertexArray:this.vertexArray,isInstanced:this.isInstanced,vertexCount:this.vertexCount,instanceCount:this.instanceCount,indexCount:n,transformFeedback:this.transformFeedback||void 0,parameters:this.parameters,topology:this.topology})}finally{this._logDrawCallEnd()}return this._logFramebuffer(e),r?(this._lastDrawTimestamp=this.device.timestamp,this._needsRedraw=!1):this._needsRedraw="waiting for resource initialization",r}setGeometry(e){this._gpuGeometry?.destroy();const r=e&&fre(this.device,e);r&&(this.setTopology(r.topology||"triangle-list"),this.bufferLayout=pR(r.bufferLayout,this.bufferLayout),this.vertexArray&&this._setGeometryAttributes(r)),this._gpuGeometry=r}setTopology(e){e!==this.topology&&(this.topology=e,this._setPipelineNeedsUpdate("topology"))}setBufferLayout(e){this.bufferLayout=this._gpuGeometry?pR(e,this._gpuGeometry.bufferLayout):e,this._setPipelineNeedsUpdate("bufferLayout"),this.pipeline=this._updatePipeline(),this.vertexArray=this.device.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry)}setParameters(e){B2(e,this.parameters,2)||(this.parameters=e,this._setPipelineNeedsUpdate("parameters"))}setInstanceCount(e){this.instanceCount=e,this.isInstanced===void 0&&e>0&&(this.isInstanced=!0),this.setNeedsRedraw("instanceCount")}setVertexCount(e){this.vertexCount=e,this.setNeedsRedraw("vertexCount")}setShaderInputs(e){this.shaderInputs=e,this._uniformStore=new dJ(this.shaderInputs.modules);for(const r of Object.keys(this.shaderInputs.modules)){const i=this._uniformStore.getManagedUniformBuffer(this.device,r);this.bindings[`${r}Uniforms`]=i}this.setNeedsRedraw("shaderInputs")}updateShaderInputs(){this._uniformStore.setUniforms(this.shaderInputs.getUniformValues()),this.setBindings(this.shaderInputs.getBindings()),this.setNeedsRedraw("shaderInputs")}setBindings(e){Object.assign(this.bindings,e),this.setNeedsRedraw("bindings")}setTransformFeedback(e){this.transformFeedback=e,this.setNeedsRedraw("transformFeedback")}setIndexBuffer(e){this.vertexArray.setIndexBuffer(e),this.setNeedsRedraw("indexBuffer")}setAttributes(e,r){e.indices&&Pt.warn(`Model:${this.id} setAttributes() - indexBuffer should be set using setIndexBuffer()`)();for(const[i,n]of Object.entries(e)){const l=this.bufferLayout.find(m=>mR(m).includes(i));if(!l){Pt.warn(`Model(${this.id}): Missing layout for buffer "${i}".`)();continue}const c=mR(l);let o=!1;for(const m of c){const b=this._attributeInfos[m];b&&(this.vertexArray.setBuffer(b.location,n),o=!0)}!o&&!(r?.disableWarnings??this.props.disableWarnings)&&Pt.warn(`Model(${this.id}): Ignoring buffer "${n.id}" for unknown attribute "${i}"`)()}this.setNeedsRedraw("attributes")}setConstantAttributes(e,r){for(const[i,n]of Object.entries(e)){const l=this._attributeInfos[i];l?this.vertexArray.setConstantWebGL(l.location,n):(r?.disableWarnings??this.props.disableWarnings)||Pt.warn(`Model "${this.id}: Ignoring constant supplied for unknown attribute "${i}"`)()}this.setNeedsRedraw("constants")}setUniforms(e){h1(e)||(this.pipeline.setUniformsWebGL(e),Object.assign(this.uniforms,e)),this.setNeedsRedraw("uniforms")}updateModuleSettings(e){const{bindings:r,uniforms:i}=JA(this._getModuleUniforms(e));Object.assign(this.bindings,r),Object.assign(this.uniforms,i),this.setNeedsRedraw("moduleSettings")}_getBindingsUpdateTimestamp(){let e=0;for(const r of Object.values(this.bindings))r instanceof eb?e=Math.max(e,r.texture.updateTimestamp):r instanceof rn||r instanceof rl?e=Math.max(e,r.updateTimestamp):r instanceof rb||(e=Math.max(e,r.buffer.updateTimestamp));return e}_setGeometryAttributes(e){const r={...e.attributes};for(const[i]of Object.entries(r))!this.pipeline.shaderLayout.attributes.find(n=>n.name===i)&&i!=="positions"&&delete r[i];this.vertexCount=e.vertexCount,this.setIndexBuffer(e.indices||null),this.setAttributes(e.attributes,{disableWarnings:!0}),this.setAttributes(r,{disableWarnings:this.props.disableWarnings}),this.setNeedsRedraw("geometry attributes")}_setPipelineNeedsUpdate(e){this._pipelineNeedsUpdate||=e,this.setNeedsRedraw(e)}_updatePipeline(){if(this._pipelineNeedsUpdate){let e=null,r=null;this.pipeline&&(Pt.log(1,`Model ${this.id}: Recreating pipeline because "${this._pipelineNeedsUpdate}".`)(),e=this.pipeline.vs,r=this.pipeline.fs),this._pipelineNeedsUpdate=!1;const i=this.shaderFactory.createShader({id:`${this.id}-vertex`,stage:"vertex",source:this.source||this.vs,debug:this.props.debugShaders});let n=null;this.source?n=i:this.fs&&(n=this.shaderFactory.createShader({id:`${this.id}-fragment`,stage:"fragment",source:this.source||this.fs,debug:this.props.debugShaders})),this.pipeline=this.pipelineFactory.createRenderPipeline({...this.props,bufferLayout:this.bufferLayout,topology:this.topology,parameters:this.parameters,vs:i,fs:n}),this._attributeInfos=OL(this.pipeline.shaderLayout,this.bufferLayout),e&&this.shaderFactory.release(e),r&&this.shaderFactory.release(r)}return this.pipeline}_lastLogTime=0;_logOpen=!1;_logDrawCallStart(){const e=Pt.level>3?0:vre;Pt.level<2||Date.now()-this._lastLogTime<e||(this._lastLogTime=Date.now(),this._logOpen=!0,Pt.group(Cm,`>>> DRAWING MODEL ${this.id}`,{collapsed:Pt.level<=2})())}_logDrawCallEnd(){if(this._logOpen){const e=_re(this.pipeline.shaderLayout,this.id);Pt.table(Cm,e)();const r=this.shaderInputs.getDebugTable();for(const[n,l]of Object.entries(this.uniforms))r[n]={value:l};Pt.table(Cm,r)();const i=this._getAttributeDebugTable();Pt.table(Cm,this._attributeInfos)(),Pt.table(Cm,i)(),Pt.groupEnd(Cm)(),this._logOpen=!1}}_drawCount=0;_logFramebuffer(e){const r=Pt.get("framebuffer");if(this._drawCount++,!r||this._drawCount++>3&&this._drawCount%60)return;const i=e.props.framebuffer;i&&yre(i,{id:i.id,minimap:!0})}_getAttributeDebugTable(){const e={};for(const[r,i]of Object.entries(this._attributeInfos))e[i.location]={name:r,type:i.shaderType,values:this._getBufferOrConstantValues(this.vertexArray.attributes[i.location],i.bufferDataType)};if(this.vertexArray.indexBuffer){const{indexBuffer:r}=this.vertexArray,i=r.indexType==="uint32"?new Uint32Array(r.debugData):new Uint16Array(r.debugData);e.indices={name:"indices",type:r.indexType,values:i.toString()}}return e}_getBufferOrConstantValues(e,r){const i=FL(r);return(e instanceof rn?new i(e.debugData):e).toString()}}function pR(t,e){const r=[...t];for(const i of e){const n=r.findIndex(l=>l.name===i.name);n<0?r.push(i):r[n]=i}return r}function bre(t){return{type:t.type,shaderLanguage:t.info.shadingLanguage,shaderLanguageVersion:t.info.shadingLanguageVersion,gpu:t.info.gpu,features:t.features}}function mR(t){return t.attributes?t.attributes?.map(e=>e.attribute):[t.name]}class Ty{device;model;transformFeedback;static isSupported(e){return e?.info?.type==="webgl"}constructor(e,r=jd.defaultProps){_i(Ty.isSupported(e),"BufferTransform not yet implemented on WebGPU"),this.device=e,this.model=new jd(this.device,{id:r.id||"buffer-transform-model",fs:r.fs||pY(),topology:r.topology||"point-list",...r}),this.transformFeedback=this.device.createTransformFeedback({layout:this.model.pipeline.shaderLayout,buffers:r.feedbackBuffers}),this.model.setTransformFeedback(this.transformFeedback),Object.seal(this)}destroy(){this.model&&this.model.destroy()}delete(){this.destroy()}run(e){const r=this.device.beginRenderPass(e);this.model.draw(r),r.end()}update(...e){console.warn("TextureTransform#update() not implemented")}getBuffer(e){return this.transformFeedback.getBuffer(e)}readAsync(e){const r=this.getBuffer(e);if(r instanceof rn)return r.readAsync();const{buffer:i,byteOffset:n=0,byteLength:l=i.byteLength}=r;return i.readAsync(n,l)}}class tg{id;topology;vertexCount;indices;attributes;userData={};constructor(e){const{attributes:r={},indices:i=null,vertexCount:n=null}=e;this.id=e.id||Kd("geometry"),this.topology=e.topology,i&&(this.indices=ArrayBuffer.isView(i)?{value:i,size:1}:i),this.attributes={};for(const[l,c]of Object.entries(r)){const o=ArrayBuffer.isView(c)?{value:c}:c;_i(ArrayBuffer.isView(o.value),`${this._print(l)}: must be typed array or object with value as typed array`),(l==="POSITION"||l==="positions")&&!o.size&&(o.size=3),l==="indices"?(_i(!this.indices),this.indices=o):this.attributes[l]=o}this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this.vertexCount=n||this._calculateVertexCount(this.attributes,this.indices)}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return`Geometry ${this.id} attribute ${e}`}_setAttributes(e,r){return this}_calculateVertexCount(e,r){if(r)return r.value.length;let i=1/0;for(const n of Object.values(e)){const{value:l,size:c,constant:o}=n;!o&&l&&c>=1&&(i=Math.min(i,l.length/c))}return _i(Number.isFinite(i)),i}}class v1{id;matrix=new Kr;display=!0;position=new et;rotation=new et;scale=new et(1,1,1);userData={};props={};constructor(e={}){const{id:r}=e;this.id=r||Kd(this.constructor.name),this._setScenegraphNodeProps(e)}getBounds(){return null}destroy(){}delete(){this.destroy()}setProps(e){return this._setScenegraphNodeProps(e),this}toString(){return`{type: ScenegraphNode, id: ${this.id})}`}setPosition(e){return _i(e.length===3,"setPosition requires vector argument"),this.position=e,this}setRotation(e){return _i(e.length===3,"setRotation requires vector argument"),this.rotation=e,this}setScale(e){return _i(e.length===3,"setScale requires vector argument"),this.scale=e,this}setMatrix(e,r=!0){r?this.matrix.copy(e):this.matrix=e}setMatrixComponents(e){const{position:r,rotation:i,scale:n,update:l=!0}=e;return r&&this.setPosition(r),i&&this.setRotation(i),n&&this.setScale(n),l&&this.updateMatrix(),this}updateMatrix(){const e=this.position,r=this.rotation,i=this.scale;return this.matrix.identity(),this.matrix.translate(e),this.matrix.rotateXYZ(r),this.matrix.scale(i),this}update(e={}){const{position:r,rotation:i,scale:n}=e;return r&&this.setPosition(r),i&&this.setRotation(i),n&&this.setScale(n),this.updateMatrix(),this}getCoordinateUniforms(e,r){_i(e),r=r||this.matrix;const i=new Kr(e).multiplyRight(r),n=i.invert(),l=n.transpose();return{viewMatrix:e,modelMatrix:r,objectMatrix:r,worldMatrix:i,worldInverseMatrix:n,worldInverseTransposeMatrix:l}}_setScenegraphNodeProps(e){"display"in e&&(this.display=e.display),"position"in e&&this.setPosition(e.position),"rotation"in e&&this.setRotation(e.rotation),"scale"in e&&this.setScale(e.scale),"matrix"in e&&this.setMatrix(e.matrix),Object.assign(this.props,e)}}class rg extends v1{children;constructor(e={}){e=Array.isArray(e)?{children:e}:e;const{children:r=[]}=e;Pt.assert(r.every(i=>i instanceof v1),"every child must an instance of ScenegraphNode"),super(e),this.children=r}getBounds(){const e=[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]];return this.traverse((r,{worldMatrix:i})=>{const n=r.getBounds();if(!n)return;const[l,c]=n,o=new et(l).add(c).divide([2,2,2]);i.transformAsPoint(o,o);const m=new et(c).subtract(l).divide([2,2,2]);i.transformAsVector(m,m);for(let b=0;b<8;b++){const A=new et(b&1?-1:1,b&2?-1:1,b&4?-1:1).multiply(m).add(o);for(let R=0;R<3;R++)e[0][R]=Math.min(e[0][R],A[R]),e[1][R]=Math.max(e[1][R],A[R])}}),Number.isFinite(e[0][0])?e:null}destroy(){this.children.forEach(e=>e.destroy()),this.removeAll(),super.destroy()}add(...e){for(const r of e)Array.isArray(r)?this.add(...r):this.children.push(r);return this}remove(e){const r=this.children,i=r.indexOf(e);return i>-1&&r.splice(i,1),this}removeAll(){return this.children=[],this}traverse(e,{worldMatrix:r=new Kr}={}){const i=new Kr(r).multiplyRight(this.matrix);for(const n of this.children)n instanceof rg?n.traverse(e,{worldMatrix:i}):e(n,{worldMatrix:i})}}class $2 extends v1{model;bounds=null;managedResources;constructor(e){super(e),this.model=e.model,this.managedResources=e.managedResources||[],this.bounds=e.bounds||null,this.setProps(e)}getBounds(){return this.bounds}destroy(){this.model&&(this.model.destroy(),this.model=null),this.managedResources.forEach(e=>e.destroy()),this.managedResources=[]}draw(e){return this.model.draw(e)}}const xre={blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"zero",blendAlphaOperation:"add",blendAlphaSrcFactor:"constant-alpha",blendAlphaDstFactor:"zero"};class RO extends pT{constructor(){super(...arguments),this._colorEncoderState=null}render(e){return"pickingFBO"in e?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer({layers:e,layerFilter:r,views:i,viewports:n,onViewportActive:l,pickingFBO:c,deviceRect:{x:o,y:m,width:b,height:A},cullRect:R,effects:M,pass:L="picking",pickZ:G,moduleParameters:V}){this.pickZ=G;const q=this._resetColorEncoder(G),J=[o,m,b,A],ie=super.render({target:c,layers:e,layerFilter:r,views:i,viewports:n,onViewportActive:l,cullRect:R,effects:M?.filter(ee=>ee.useInPicking),pass:L,isPicking:!0,moduleParameters:V,clearColor:[0,0,0,0],colorMask:15,scissorRect:J});return this._colorEncoderState=null,{decodePickingColor:q&&Ere.bind(null,q),stats:ie}}shouldDrawLayer(e){const{pickable:r,operation:i}=e.props;return r&&i.includes("draw")||i.includes("terrain")||i.includes("mask")}getModuleParameters(){return{picking:{isActive:1,isAttribute:this.pickZ},lightSources:{}}}getLayerParameters(e,r,i){const n={depthMask:!0,depthTest:!0,depthRange:[0,1],...e.props.parameters},{pickable:l,operation:c}=e.props;return!this._colorEncoderState||c.includes("terrain")?n.blend=!1:l&&c.includes("draw")&&(Object.assign(n,xre),n.blend=!0,n.blendColor=wre(this._colorEncoderState,e,i)),n}_resetColorEncoder(e){return this._colorEncoderState=e?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function wre(t,e,r){const{byLayer:i,byAlpha:n}=t;let l,c=i.get(e);return c?(c.viewports.push(r),l=c.a):(l=i.size+1,l<=255?(c={a:l,layer:e,viewports:[r]},i.set(e,c),n[l]=c):(hi.warn("Too many pickable layers, only picking the first 255")(),l=0)),[0,0,0,l/255]}function Ere(t,e){const r=t.byAlpha[e[3]];return r&&{pickedLayer:r.layer,pickedViewports:r.viewports,pickedObjectIndex:r.layer.decodePickingColor(e)}}const Lm={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},b1=Symbol.for("component"),Bd=Symbol.for("propTypes"),Zx=Symbol.for("deprecatedProps"),ig=Symbol.for("asyncPropDefaults"),Ip=Symbol.for("asyncPropOriginal"),Md=Symbol.for("asyncPropResolved");function pg(t,e=()=>!0){return Array.isArray(t)?MO(t,e,[]):e(t)?[t]:[]}function MO(t,e,r){let i=-1;for(;++i<t.length;){const n=t[i];Array.isArray(n)?MO(n,e,r):e(n)&&r.push(n)}return r}function Are({target:t,source:e,start:r=0,count:i=1}){const n=e.length,l=i*n;let c=0;for(let o=r;c<n;c++)t[o++]=e[c];for(;c<l;)c<l-c?(t.copyWithin(r+c,r,r+c),c*=2):(t.copyWithin(r+c,r,r+l-c),c=l);return t}class Tre{constructor(e,r,i){this._loadCount=0,this._subscribers=new Set,this.id=e,this.context=i,this.setData(r)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(e,r){if(e===this._data&&!r)return;this._data=e;const i=++this._loadCount;let n=e;typeof e=="string"&&(n=Fd(e)),n instanceof Promise?(this.isLoaded=!1,this._loader=n.then(l=>{this._loadCount===i&&(this.isLoaded=!0,this._error=void 0,this._content=l)}).catch(l=>{this._loadCount===i&&(this.isLoaded=!0,this._error=l||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=e);for(const l of this._subscribers)l.onChange(this.getData())}}class Sre{constructor(e){this.protocol=e.protocol||"resource://",this._context={device:e.device,gl:e.device?.gl,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return e.startsWith(this.protocol)?!0:e in this._resources}add({resourceId:e,data:r,forceUpdate:i=!1,persistent:n=!0}){let l=this._resources[e];l?l.setData(r,i):(l=new Tre(e,r,this._context),this._resources[e]=l),l.persistent=n}remove(e){const r=this._resources[e];r&&(r.delete(),delete this._resources[e])}unsubscribe({consumerId:e}){const r=this._consumers[e];if(r){for(const i in r){const n=r[i],l=this._resources[n.resourceId];l&&l.unsubscribe(n)}delete this._consumers[e],this.prune()}}subscribe({resourceId:e,onChange:r,consumerId:i,requestId:n="default"}){const{_resources:l,protocol:c}=this;e.startsWith(c)&&(e=e.replace(c,""),l[e]||this.add({resourceId:e,data:null,persistent:!1}));const o=l[e];if(this._track(i,n,o,r),o)return o.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const e in this._resources)this._resources[e].delete()}_track(e,r,i,n){const l=this._consumers,c=l[e]=l[e]||{};let o=c[r];const m=o&&o.resourceId&&this._resources[o.resourceId];m&&(m.unsubscribe(o),this.prune()),i&&(o?(o.onChange=n,o.resourceId=i.id):o={onChange:n,resourceId:i.id},c[r]=o,i.subscribe(o))}_prune(){this._pruneRequest=null;for(const e of Object.keys(this._resources)){const r=this._resources[e];!r.persistent&&!r.inUse()&&(r.delete(),delete this._resources[e])}}}const Cre="layerManager.setLayers",Pre="layerManager.activateViewport";class Rre{constructor(e,r){this._lastRenderedLayers=[],this._needsRedraw=!1,this._needsUpdate=!1,this._nextLayers=null,this._debug=!1,this._defaultShaderModulesChanged=!1,this.activateViewport=o=>{Ao(Pre,this,o),o&&(this.context.viewport=o)};const{deck:i,stats:n,viewport:l,timeline:c}=r||{};this.layers=[],this.resourceManager=new Sre({device:e,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,device:e,gl:e?.gl,deck:i,shaderAssembler:Nte(),defaultShaderModules:[],renderPass:void 0,stats:n||new kg({id:"deck.gl"}),viewport:l||new qy({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:c||new PO,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const e of this.layers)this._finalizeLayer(e)}needsRedraw(e={clearRedrawFlags:!1}){let r=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);for(const i of this.layers){const n=i.getNeedsRedraw(e);r=r||n}return r}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._defaultShaderModulesChanged?"shader modules changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers({layerIds:e}={}){return e?this.layers.filter(r=>e.find(i=>r.id.indexOf(i)===0)):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,r){Ao(Cre,this,r,e),this._lastRenderedLayers=e;const i=pg(e,Boolean);for(const n of i)n.context=this.context;this._updateLayers(this.layers,i)}updateLayers(){const e=this.needsUpdate();e&&(this.setNeedsRedraw(`updating layers: ${e}`),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}addDefaultShaderModule(e){const{defaultShaderModules:r}=this.context;r.find(i=>i.name===e.name)||(r.push(e),this._defaultShaderModulesChanged=!0)}removeDefaultShaderModule(e){const{defaultShaderModules:r}=this.context,i=r.findIndex(n=>n.name===e.name);i>=0&&(r.splice(i,1),this._defaultShaderModulesChanged=!0)}_handleError(e,r,i){i.raiseError(r,`${e} of ${i}`)}_updateLayers(e,r){const i={};for(const c of e)i[c.id]?hi.warn(`Multiple old layers with same id ${c.id}`)():i[c.id]=c;if(this._defaultShaderModulesChanged){for(const c of e)c.setNeedsUpdate(),c.setChangeFlags({extensionsChanged:!0});this._defaultShaderModulesChanged=!1}const n=[];this._updateSublayersRecursively(r,i,n),this._finalizeOldLayers(i);let l=!1;for(const c of n)if(c.hasUniformTransition()){l=`Uniform transition in ${c}`;break}this._needsUpdate=l,this.layers=n}_updateSublayersRecursively(e,r,i){for(const n of e){n.context=this.context;const l=r[n.id];l===null&&hi.warn(`Multiple new layers with same id ${n.id}`)(),r[n.id]=null;let c=null;try{this._debug&&l!==n&&n.validateProps(),l?(this._transferLayerState(l,n),this._updateLayer(n)):this._initializeLayer(n),i.push(n),c=n.isComposite?n.getSubLayers():null}catch(o){this._handleError("matching",o,n)}c&&this._updateSublayersRecursively(c,r,i)}}_finalizeOldLayers(e){for(const r in e){const i=e[r];i&&this._finalizeLayer(i)}}_initializeLayer(e){try{e._initialize(),e.lifecycle=Lm.INITIALIZED}catch(r){this._handleError("initialization",r,e)}}_transferLayerState(e,r){r._transferState(e),r.lifecycle=Lm.MATCHED,r!==e&&(e.lifecycle=Lm.AWAITING_GC)}_updateLayer(e){try{e._update()}catch(r){this._handleError("update",r,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||`finalized ${e}`,e.lifecycle=Lm.AWAITING_FINALIZATION;try{e._finalize(),e.lifecycle=Lm.FINALIZED}catch(r){this._handleError("finalization",r,e)}}}function Tc(t,e,r){if(t===e)return!0;if(!r||!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let i=0;i<t.length;i++)if(!Tc(t[i],e[i],r-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const i=Object.keys(t),n=Object.keys(e);if(i.length!==n.length)return!1;for(const l of i)if(!e.hasOwnProperty(l)||!Tc(t[l],e[l],r-1))return!1;return!0}return!1}class Mre{constructor(e){this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(const e in this.controllers){const r=this.controllers[e];r&&r.finalize()}this.controllers={}}needsRedraw(e={clearRedrawFlags:!1}){const r=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),r}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(const e in this.controllers){const r=this.controllers[e];r&&r.updateTransition()}}getViewports(e){return e?this._viewports.filter(r=>r.containsPixel(e)):this._viewports}getViews(){const e={};return this.views.forEach(r=>{e[r.id]=r}),e}getView(e){return this.views.find(r=>r.id===e)}getViewState(e){const r=typeof e=="string"?this.getView(e):e,i=r&&this.viewState[r.getViewStateId()]||this.viewState;return r?r.filterViewState(i):i}getViewport(e){return this._viewportMap[e]}unproject(e,r){const i=this.getViewports(),n={x:e[0],y:e[1]};for(let l=i.length-1;l>=0;--l){const c=i[l];if(c.containsPixel(n)){const o=e.slice();return o[0]-=c.x,o[1]-=c.y,c.unproject(o,r)}}return null}setProps(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,r){(e!==this.width||r!==this.height)&&(this.width=e,this.height=r,this.setNeedsUpdate("Size changed"))}_setViews(e){e=pg(e,Boolean),this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){e?(!Tc(e,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=e):hi.warn("missing `viewState` or `initialViewState`")()}_createController(e,r){const i=r.type;return new i({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._eventCallbacks.onViewStateChange,onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:n=>this.getView(e.id)?.makeViewport({viewState:n,width:this.width,height:this.height})})}_updateController(e,r,i,n){const l=e.controller;if(l&&i){const c={...r,...l,id:e.id,x:i.x,y:i.y,width:i.width,height:i.height};return(!n||n.constructor!==l.type)&&(n=this._createController(e,c)),n&&n.setProps(c),n}return null}_rebuildViewports(){const{views:e}=this,r=this.controllers;this._viewports=[],this.controllers={};let i=!1;for(let n=e.length;n--;){const l=e[n],c=this.getViewState(l),o=l.makeViewport({viewState:c,width:this.width,height:this.height});let m=r[l.id];const b=!!l.controller;b&&!m&&(i=!0),(i||!b)&&m&&(m.finalize(),m=null),this.controllers[l.id]=this._updateController(l,c,o,m),o&&this._viewports.unshift(o)}for(const n in r){const l=r[n];l&&!this.controllers[n]&&l.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)})}_diffViews(e,r){return e.length!==r.length?!0:e.some((i,n)=>!e[n].equals(r[n]))}}const Ire=/([0-9]+\.?[0-9]*)(%|px)/;function yd(t){switch(typeof t){case"number":return{position:t,relative:!1};case"string":const e=Ire.exec(t);if(e&&e.length>=3){const r=e[2]==="%",i=parseFloat(e[1]);return{position:r?i/100:i,relative:r}}default:throw new Error(`Could not parse position string ${t}`)}}function vd(t,e){return t.relative?Math.round(t.position*e):t.position}class kre{constructor(e){const{id:r,x:i=0,y:n=0,width:l="100%",height:c="100%",padding:o=null}=e;this.id=r||this.constructor.displayName||"view",this.props={...e,id:this.id},this._x=yd(i),this._y=yd(n),this._width=yd(l),this._height=yd(c),this._padding=o&&{left:yd(o.left||0),right:yd(o.right||0),top:yd(o.top||0),bottom:yd(o.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e?!0:this.ViewportType===e.ViewportType&&Tc(this.props,e.props,2)}makeViewport({width:e,height:r,viewState:i}){i=this.filterViewState(i);const n=this.getDimensions({width:e,height:r});return!n.height||!n.width?null:new this.ViewportType({...i,...this.props,...n})}getViewStateId(){const{viewState:e}=this.props;return typeof e=="string"?e:e?.id||this.id}filterViewState(e){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const r={...e};for(const i in this.props.viewState)i!=="id"&&(r[i]=this.props.viewState[i]);return r}return e}getDimensions({width:e,height:r}){const i={x:vd(this._x,e),y:vd(this._y,r),width:vd(this._width,e),height:vd(this._height,r)};return this._padding&&(i.padding={left:vd(this._padding.left,e),top:vd(this._padding.top,r),right:vd(this._padding.right,e),bottom:vd(this._padding.bottom,r)}),i}get controller(){const e=this.props.controller;return e?e===!0?{type:this.ControllerType}:typeof e=="function"?{type:e}:{type:this.ControllerType,...e}:null}}class nb{constructor(e){this._inProgress=!1,this._handle=null,this.time=0,this.settings={duration:0},this._timeline=e}get inProgress(){return this._inProgress}start(e){this.cancel(),this.settings=e,this._inProgress=!0,this.settings.onStart?.(this)}end(){this._inProgress&&(this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,this.settings.onEnd?.(this))}cancel(){this._inProgress&&(this.settings.onInterrupt?.(this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1)}update(){if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:e,settings:r}=this;this._handle=e.addChannel({delay:e.getTime(),duration:r.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),this.settings.onUpdate?.(this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const gR=()=>{},W2={BREAK:1,SNAP_TO_END:2,IGNORE:3},Bre=t=>t,Lre=W2.BREAK;class Ore{constructor(e){this._onTransitionUpdate=r=>{const{time:i,settings:{interpolator:n,startProps:l,endProps:c,duration:o,easing:m}}=r,b=m(i/o),A=n.interpolateProps(l,c,b);this.propsInTransition=this.getControllerState({...this.props,...A}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})},this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new nb(e.timeline),this.onViewStateChange=e.onViewStateChange||gR,this.onStateChange=e.onStateChange||gR}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let r=!1;const i=this.props;if(this.props=e,!i||this._shouldIgnoreViewportChange(i,e))return!1;if(this._isTransitionEnabled(e)){let n=i;if(this.transition.inProgress){const{interruption:l,endProps:c}=this.transition.settings;n={...i,...l===W2.SNAP_TO_END?c:this.propsInTransition||i}}this._triggerTransition(n,e),r=!0}else this.transition.cancel();return r}updateTransition(){this.transition.update()}_isTransitionEnabled(e){const{transitionDuration:r,transitionInterpolator:i}=e;return(r>0||r==="auto")&&!!i}_isUpdateDueToCurrentTransition(e){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition):!1}_shouldIgnoreViewportChange(e,r){return this.transition.inProgress?this.transition.settings.interruption===W2.IGNORE||this._isUpdateDueToCurrentTransition(r):this._isTransitionEnabled(r)?r.transitionInterpolator.arePropsEqual(e,r):!0}_triggerTransition(e,r){const i=this.getControllerState(e),n=this.getControllerState(r).shortestPathFrom(i),l=r.transitionInterpolator,c=l.getDuration?l.getDuration(e,r):r.transitionDuration;if(c===0)return;const o=l.initializeProps(e,n);this.propsInTransition={};const m={duration:c,easing:r.transitionEasing||Bre,interpolator:l,interruption:r.transitionInterruption||Lre,startProps:o.start,endProps:o.end,onStart:r.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(r.onTransitionInterrupt),onEnd:this._onTransitionEnd(r.onTransitionEnd)};this.transition.start(m),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return r=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e?.(r)}}}function Ss(t,e){if(!t)throw new Error(e||"deck.gl: assertion failed.")}class Dre{constructor(e){const{compare:r,extract:i,required:n}=e;this._propsToCompare=r,this._propsToExtract=i||r,this._requiredProps=n}arePropsEqual(e,r){for(const i of this._propsToCompare)if(!(i in e)||!(i in r)||!Pc(e[i],r[i]))return!1;return!0}initializeProps(e,r){const i={},n={};for(const l of this._propsToExtract)(l in e||l in r)&&(i[l]=e[l],n[l]=r[l]);return this._checkRequiredProps(i),this._checkRequiredProps(n),{start:i,end:n}}getDuration(e,r){return r.transitionDuration}_checkRequiredProps(e){this._requiredProps&&this._requiredProps.forEach(r=>{const i=e[r];Ss(Number.isFinite(i)||Array.isArray(i),`${r} is required for transition`)})}}const Nre=["longitude","latitude","zoom","bearing","pitch"],Fre=["longitude","latitude","zoom"];class IO extends Dre{constructor(e={}){const r=Array.isArray(e)?e:e.transitionProps,i=Array.isArray(e)?{}:e;i.transitionProps=Array.isArray(r)?{compare:r,required:r}:r||{compare:Nre,required:Fre},super(i.transitionProps),this.opts=i}initializeProps(e,r){const i=super.initializeProps(e,r),{makeViewport:n,around:l}=this.opts;if(n&&l){const c=n(e),o=n(r),m=c.unproject(l);i.start.around=l,Object.assign(i.end,{around:o.project(m),aroundPosition:m,width:r.width,height:r.height})}return i}interpolateProps(e,r,i){const n={};for(const l of this._propsToExtract)n[l]=m1(e[l]||0,r[l]||0,i);if(r.aroundPosition&&this.opts.makeViewport){const l=this.opts.makeViewport({...r,...n});Object.assign(n,l.panByPosition(r.aroundPosition,m1(e.around,r.around,i)))}return n}}const bd={transitionDuration:0},zre=300,pv=t=>1-(1-t)*(1-t),Pm={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],TRIPLE_PAN:["tripanstart","tripanmove","tripanend"],DOUBLE_TAP:["doubletap"],KEYBOARD:["keydown"]},sp={};class jre{constructor(e){this.state={},this._events={},this._interactionState={isDragging:!1},this._customEvents=[],this._eventStartBlocked=null,this._panMove=!1,this.invertPan=!1,this.dragMode="rotate",this.inertia=0,this.scrollZoom=!0,this.dragPan=!0,this.dragRotate=!0,this.doubleClickZoom=!0,this.touchZoom=!0,this.touchRotate=!1,this.keyboard=!0,this.transitionManager=new Ore({...e,getControllerState:r=>new this.ControllerState(r),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=e.eventManager,this.onViewStateChange=e.onViewStateChange||(()=>{}),this.onStateChange=e.onStateChange||(()=>{}),this.makeViewport=e.makeViewport}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}finalize(){for(const e in this._events)this._events[e]&&this.eventManager?.off(e,this.handleEvent);this.transitionManager.finalize()}handleEvent(e){this._controllerState=void 0;const r=this._eventStartBlocked;switch(e.type){case"panstart":return r?!1:this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return r?!1:this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"tripanstart":return r?!1:this._onTriplePanStart(e);case"tripanmove":return this._onTriplePan(e);case"tripanend":return this._onTriplePanEnd(e);case"doubletap":return this._onDoubleTap(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(e){const{x:r,y:i}=this.props,{offsetCenter:n}=e;return[n.x-r,n.y-i]}isPointInBounds(e,r){const{width:i,height:n}=this.props;if(r&&r.handled)return!1;const l=e[0]>=0&&e[0]<=i&&e[1]>=0&&e[1]<=n;return l&&r&&r.stopPropagation(),l}isFunctionKeyPressed(e){const{srcEvent:r}=e;return!!(r.metaKey||r.altKey||r.ctrlKey||r.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(e){const r=setTimeout(()=>{this._eventStartBlocked===r&&(this._eventStartBlocked=null)},e);this._eventStartBlocked=r}setProps(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);const{inertia:r}=e;this.inertia=Number.isFinite(r)?r:r===!0?zre:0;const{scrollZoom:i=!0,dragPan:n=!0,dragRotate:l=!0,doubleClickZoom:c=!0,touchZoom:o=!0,touchRotate:m=!1,keyboard:b=!0}=e,A=!!this.onViewStateChange;this.toggleEvents(Pm.WHEEL,A&&i),this.toggleEvents(Pm.PAN,A),this.toggleEvents(Pm.PINCH,A&&(o||m)),this.toggleEvents(Pm.TRIPLE_PAN,A&&m),this.toggleEvents(Pm.DOUBLE_TAP,A&&c),this.toggleEvents(Pm.KEYBOARD,A&&b),this.scrollZoom=i,this.dragPan=n,this.dragRotate=l,this.doubleClickZoom=c,this.touchZoom=o,this.touchRotate=m,this.keyboard=b}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,r){this.eventManager&&e.forEach(i=>{this._events[i]!==r&&(this._events[i]=r,r?this.eventManager.on(i,this.handleEvent):this.eventManager.off(i,this.handleEvent))})}updateViewport(e,r=null,i={}){const n={...e.getViewportProps(),...r},l=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(i),l){const c=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:n,interactionState:this._interactionState,oldViewState:c,viewId:this.props.id})}}_onTransition(e){this.onViewStateChange({...e,interactionState:this._interactionState,viewId:this.props.id})}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}_onPanStart(e){const r=this.getCenter(e);if(!this.isPointInBounds(r,e))return!1;let i=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(i=!i);const n=this.controllerState[i?"panStart":"rotateStart"]({pos:r});return this._panMove=i,this.updateViewport(n,bd,{isDragging:!0}),!0}_onPan(e){return this.isDragging()?this._panMove?this._onPanMove(e):this._onPanRotate(e):!1}_onPanEnd(e){return this.isDragging()?this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e):!1}_onPanMove(e){if(!this.dragPan)return!1;const r=this.getCenter(e),i=this.controllerState.pan({pos:r});return this.updateViewport(i,bd,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){const{inertia:r}=this;if(this.dragPan&&r&&e.velocity){const i=this.getCenter(e),n=[i[0]+e.velocityX*r/2,i[1]+e.velocityY*r/2],l=this.controllerState.pan({pos:n}).panEnd();this.updateViewport(l,{...this._getTransitionProps(),transitionDuration:r,transitionEasing:pv},{isDragging:!1,isPanning:!0})}else{const i=this.controllerState.panEnd();this.updateViewport(i,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;const r=this.getCenter(e),i=this.controllerState.rotate({pos:r});return this.updateViewport(i,bd,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){const{inertia:r}=this;if(this.dragRotate&&r&&e.velocity){const i=this.getCenter(e),n=[i[0]+e.velocityX*r/2,i[1]+e.velocityY*r/2],l=this.controllerState.rotate({pos:n}).rotateEnd();this.updateViewport(l,{...this._getTransitionProps(),transitionDuration:r,transitionEasing:pv},{isDragging:!1,isRotating:!0})}else{const i=this.controllerState.rotateEnd();this.updateViewport(i,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;const r=this.getCenter(e);if(!this.isPointInBounds(r,e))return!1;e.srcEvent.preventDefault();const{speed:i=.01,smooth:n=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:l}=e;let c=2/(1+Math.exp(-Math.abs(l*i)));l<0&&c!==0&&(c=1/c);const o=this.controllerState.zoom({pos:r,scale:c});return this.updateViewport(o,{...this._getTransitionProps({around:r}),transitionDuration:n?250:1},{isZooming:!0,isPanning:!0}),!0}_onTriplePanStart(e){const r=this.getCenter(e);if(!this.isPointInBounds(r,e))return!1;const i=this.controllerState.rotateStart({pos:r});return this.updateViewport(i,bd,{isDragging:!0}),!0}_onTriplePan(e){if(!this.touchRotate||!this.isDragging())return!1;const r=this.getCenter(e);r[0]-=e.deltaX;const i=this.controllerState.rotate({pos:r});return this.updateViewport(i,bd,{isDragging:!0,isRotating:!0}),!0}_onTriplePanEnd(e){if(!this.isDragging())return!1;const{inertia:r}=this;if(this.touchRotate&&r&&e.velocityY){const i=this.getCenter(e),n=[i[0],i[1]+=e.velocityY*r/2],l=this.controllerState.rotate({pos:n});this.updateViewport(l,{...this._getTransitionProps(),transitionDuration:r,transitionEasing:pv},{isDragging:!1,isRotating:!0}),this.blockEvents(r)}else{const i=this.controllerState.rotateEnd();this.updateViewport(i,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){const r=this.getCenter(e);if(!this.isPointInBounds(r,e))return!1;const i=this.controllerState.zoomStart({pos:r}).rotateStart({pos:r});return sp._startPinchRotation=e.rotation,sp._lastPinchEvent=e,this.updateViewport(i,bd,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let r=this.controllerState;if(this.touchZoom){const{scale:i}=e,n=this.getCenter(e);r=r.zoom({pos:n,scale:i})}if(this.touchRotate){const{rotation:i}=e;r=r.rotate({deltaAngleX:sp._startPinchRotation-i})}return this.updateViewport(r,bd,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),sp._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;const{inertia:r}=this,{_lastPinchEvent:i}=sp;if(this.touchZoom&&r&&i&&e.scale!==i.scale){const n=this.getCenter(e);let l=this.controllerState.rotateEnd();const c=Math.log2(e.scale),o=(c-Math.log2(i.scale))/(e.deltaTime-i.deltaTime),m=Math.pow(2,c+o*r/2);l=l.zoom({pos:n,scale:m}).zoomEnd(),this.updateViewport(l,{...this._getTransitionProps({around:n}),transitionDuration:r,transitionEasing:pv},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(r)}else{const n=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(n,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return sp._startPinchRotation=null,sp._lastPinchEvent=null,!0}_onDoubleTap(e){if(!this.doubleClickZoom)return!1;const r=this.getCenter(e);if(!this.isPointInBounds(r,e))return!1;const i=this.isFunctionKeyPressed(e),n=this.controllerState.zoom({pos:r,scale:i?.5:2});return this.updateViewport(n,this._getTransitionProps({around:r}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){if(!this.keyboard)return!1;const r=this.isFunctionKeyPressed(e),{zoomSpeed:i,moveSpeed:n,rotateSpeedX:l,rotateSpeedY:c}=this.keyboard===!0?{}:this.keyboard,{controllerState:o}=this;let m;const b={};switch(e.srcEvent.code){case"Minus":m=r?o.zoomOut(i).zoomOut(i):o.zoomOut(i),b.isZooming=!0;break;case"Equal":m=r?o.zoomIn(i).zoomIn(i):o.zoomIn(i),b.isZooming=!0;break;case"ArrowLeft":r?(m=o.rotateLeft(l),b.isRotating=!0):(m=o.moveLeft(n),b.isPanning=!0);break;case"ArrowRight":r?(m=o.rotateRight(l),b.isRotating=!0):(m=o.moveRight(n),b.isPanning=!0);break;case"ArrowUp":r?(m=o.rotateUp(c),b.isRotating=!0):(m=o.moveUp(n),b.isPanning=!0);break;case"ArrowDown":r?(m=o.rotateDown(c),b.isRotating=!0):(m=o.moveDown(n),b.isPanning=!0);break;default:return!1}return this.updateViewport(m,this._getTransitionProps(),b),!0}_getTransitionProps(e){const{transition:r}=this;return!r||!r.transitionInterpolator?bd:e?{...r,transitionInterpolator:new IO({...e,...r.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:r}}class Ure{constructor(e,r){this._viewportProps=this.applyConstraints(e),this._state=r}getViewportProps(){return this._viewportProps}getState(){return this._state}}const _R=5,Vre=1.2;class Gre extends Ure{constructor(e){const{width:r,height:i,latitude:n,longitude:l,zoom:c,bearing:o=0,pitch:m=0,altitude:b=1.5,position:A=[0,0,0],maxZoom:R=20,minZoom:M=0,maxPitch:L=60,minPitch:G=0,startPanLngLat:V,startZoomLngLat:q,startRotatePos:J,startBearing:ie,startPitch:ee,startZoom:me,normalize:Se=!0}=e;Ss(Number.isFinite(l)),Ss(Number.isFinite(n)),Ss(Number.isFinite(c)),super({width:r,height:i,latitude:n,longitude:l,zoom:c,bearing:o,pitch:m,altitude:b,maxZoom:R,minZoom:M,maxPitch:L,minPitch:G,normalize:Se,position:A},{startPanLngLat:V,startZoomLngLat:q,startRotatePos:J,startBearing:ie,startPitch:ee,startZoom:me}),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan({pos:e,startPos:r}){const i=this.getState().startPanLngLat||this._unproject(r);if(!i)return this;const n=this.makeViewport(this.getViewportProps()).panByPosition(i,e);return this._getUpdatedState(n)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:e,deltaAngleX:r=0,deltaAngleY:i=0}){const{startRotatePos:n,startBearing:l,startPitch:c}=this.getState();if(!n||l===void 0||c===void 0)return this;let o;return e?o=this._getNewRotation(e,n,c,l):o={bearing:l+r,pitch:c+i},this._getUpdatedState(o)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:e}){return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:r,scale:i}){let{startZoom:n,startZoomLngLat:l}=this.getState();if(l||(n=this.getViewportProps().zoom,l=this._unproject(r)||this._unproject(e)),!l)return this;const{maxZoom:c,minZoom:o}=this.getViewportProps();let m=n+Math.log2(i);m=Eh(m,o,c);const b=this.makeViewport({...this.getViewportProps(),zoom:m});return this._getUpdatedState({zoom:m,...b.panByPosition(l,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(e=2){return this._zoomFromCenter(e)}zoomOut(e=2){return this._zoomFromCenter(1/e)}moveLeft(e=100){return this._panFromCenter([e,0])}moveRight(e=100){return this._panFromCenter([-e,0])}moveUp(e=100){return this._panFromCenter([0,e])}moveDown(e=100){return this._panFromCenter([0,-e])}rotateLeft(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){const r=e.getViewportProps(),i={...this.getViewportProps()},{bearing:n,longitude:l}=i;return Math.abs(n-r.bearing)>180&&(i.bearing=n<0?n+360:n-360),Math.abs(l-r.longitude)>180&&(i.longitude=l<0?l+360:l-360),i}applyConstraints(e){const{maxZoom:r,minZoom:i,zoom:n}=e;e.zoom=Eh(n,i,r);const{maxPitch:l,minPitch:c,pitch:o}=e;e.pitch=Eh(o,c,l);const{normalize:m=!0}=e;return m&&Object.assign(e,Ate(e)),e}_zoomFromCenter(e){const{width:r,height:i}=this.getViewportProps();return this.zoom({pos:[r/2,i/2],scale:e})}_panFromCenter(e){const{width:r,height:i}=this.getViewportProps();return this.pan({startPos:[r/2,i/2],pos:[r/2+e[0],i/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}_unproject(e){const r=this.makeViewport(this.getViewportProps());return e&&r.unproject(e)}_getNewRotation(e,r,i,n){const l=e[0]-r[0],c=e[1]-r[1],o=e[1],m=r[1],{width:b,height:A}=this.getViewportProps(),R=l/b;let M=0;c>0?Math.abs(A-m)>_R&&(M=c/(m-A)*Vre):c<0&&m>_R&&(M=1-o/m),M=Eh(M,-1,1);const{minPitch:L,maxPitch:G}=this.getViewportProps(),V=n+180*R;let q=i;return M>0?q=i+M*(G-i):M<0&&(q=i-M*(L-i)),{pitch:q,bearing:V}}}class Hre extends jre{constructor(){super(...arguments),this.ControllerState=Gre,this.transition={transitionDuration:300,transitionInterpolator:new IO({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})},this.dragMode="pan"}setProps(e){e.position=e.position||[0,0,0];const r=this.props;super.setProps(e),(!r||r.height!==e.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...e,...this.state}))}}class _T extends kre{constructor(e={}){super(e)}get ViewportType(){return Mp}get ControllerType(){return Hre}}_T.displayName="MapView";const $re=new SO;function Wre(t,e){const r=t.order??1/0,i=e.order??1/0;return r-i}class qre{constructor(e){this._resolvedEffects=[],this._defaultEffects=[],this.effects=[],this._context=e,this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(e){const r=this._defaultEffects;if(!r.find(i=>i.id===e.id)){const i=r.findIndex(n=>Wre(n,e)>0);i<0?r.push(e):r.splice(i,0,e),e.setup(this._context),this._setEffects(this.effects)}}setProps(e){"effects"in e&&(Tc(e.effects,this.effects,1)||this._setEffects(e.effects))}needsRedraw(e={clearRedrawFlags:!1}){const r=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),r}getEffects(){return this._resolvedEffects}_setEffects(e){const r={};for(const n of this.effects)r[n.id]=n;const i=[];for(const n of e){const l=r[n.id];let c=n;l&&l!==n?l.setProps?(l.setProps(n.props),c=l):l.cleanup(this._context):l||n.setup(this._context),i.push(c),delete r[n.id]}for(const n in r)r[n].cleanup(this._context);this.effects=i,this._resolvedEffects=i.concat(this._defaultEffects),e.some(n=>n instanceof SO)||this._resolvedEffects.push($re),this._needsRedraw="effects changed"}finalize(){for(const e of this._resolvedEffects)e.cleanup(this._context);this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class Kre extends pT{shouldDrawLayer(e){const{operation:r}=e.props;return r.includes("draw")||r.includes("terrain")}}const Zre="deckRenderer.renderLayers";class Xre{constructor(e){this.device=e,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new Kre(e),this.pickLayersPass=new RO(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){if(!e.viewports.length)return;const r=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,i={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...e};i.effects&&this._preRender(i.effects,i);const n=this.lastPostProcessEffect?this.renderBuffers[0]:i.target;this.lastPostProcessEffect&&(i.clearColor=[0,0,0,0],i.clearCanvas=!0);const l=r.render({...i,target:n});i.effects&&this._postRender(i.effects,i),this.renderCount++,Ao(Zre,this,l,e)}needsRedraw(e={clearRedrawFlags:!1}){const r=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),r}finalize(){const{renderBuffers:e}=this;for(const r of e)r.delete();e.length=0}_preRender(e,r){this.lastPostProcessEffect=null,r.preRenderStats=r.preRenderStats||{};for(const i of e)r.preRenderStats[i.id]=i.preRender(r),i.postRender&&(this.lastPostProcessEffect=i.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:e}=this,r=this.device.canvasContext.getDrawingBufferSize();e.length===0&&[0,1].map(i=>{const n=this.device.createTexture({sampler:{minFilter:"linear",magFilter:"linear"}});e.push(this.device.createFramebuffer({id:`deck-renderbuffer-${i}`,colorAttachments:[n]}))});for(const i of e)i.resize(r)}_postRender(e,r){const{renderBuffers:i}=this,n={...r,inputBuffer:i[0],swapBuffer:i[1]};for(const l of e)if(l.postRender){n.target=l.id===this.lastPostProcessEffect?r.target:void 0;const c=l.postRender(n);n.inputBuffer=c,n.swapBuffer=c===i[0]?i[1]:i[0]}}}const Yre={pickedColor:null,pickedObjectIndex:-1};function Jre({pickedColors:t,decodePickingColor:e,deviceX:r,deviceY:i,deviceRadius:n,deviceRect:l}){const{x:c,y:o,width:m,height:b}=l;let A=n*n,R=-1,M=0;for(let L=0;L<b;L++){const G=L+o-i,V=G*G;if(V>A)M+=4*m;else for(let q=0;q<m;q++){if(t[M+3]-1>=0){const J=q+c-r,ie=J*J+V;ie<=A&&(A=ie,R=M)}M+=4}}if(R>=0){const L=t.slice(R,R+4),G=e(L);if(G){const V=Math.floor(R/4/m),q=R/4-V*m;return{...G,pickedColor:L,pickedX:c+q,pickedY:o+V}}hi.error("Picked non-existent layer. Is picking buffer corrupt?")()}return Yre}function Qre({pickedColors:t,decodePickingColor:e}){const r=new Map;if(t){for(let i=0;i<t.length;i+=4)if(t[i+3]-1>=0){const n=t.slice(i,i+4),l=n.join(",");if(!r.has(l)){const c=e(n);c?r.set(l,{...c,color:n}):hi.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(r.values())}function kO({pickInfo:t,viewports:e,pixelRatio:r,x:i,y:n,z:l}){let c=e[0];e.length>1&&(c=tie(t?.pickedViewports||e,{x:i,y:n}));let o;if(c){const m=[i-c.x,n-c.y];l!==void 0&&(m[2]=l),o=c.unproject(m)}return{color:null,layer:null,viewport:c,index:-1,picked:!1,x:i,y:n,pixel:[i,n],coordinate:o,devicePixel:t&&"pickedX"in t?[t.pickedX,t.pickedY]:void 0,pixelRatio:r}}function eie(t){const{pickInfo:e,lastPickedInfo:r,mode:i,layers:n}=t,{pickedColor:l,pickedLayer:c,pickedObjectIndex:o}=e,m=c?[c]:[];if(i==="hover"){const R=r.index,M=r.layerId,L=c?c.props.id:null;if(L!==M||o!==R){if(L!==M){const G=n.find(V=>V.props.id===M);G&&m.unshift(G)}r.layerId=L,r.index=o,r.info=null}}const b=kO(t),A=new Map;return A.set(null,b),m.forEach(R=>{let M={...b};R===c&&(M.color=l,M.index=o,M.picked=!0),M=BO({layer:R,info:M,mode:i});const L=M.layer;R===c&&i==="hover"&&(r.info=M),A.set(L.id,M),i==="hover"&&L.updateAutoHighlight(M)}),A}function BO({layer:t,info:e,mode:r}){for(;t&&e;){const i=e.layer||null;e.sourceLayer=i,e.layer=t,e=t.getPickingInfo({info:e,mode:r,sourceLayer:i}),t=t.parent}return e}function tie(t,e){for(let r=t.length-1;r>=0;r--){const i=t[r];if(i.containsPixel(e))return i}return t[0]}class rie{constructor(e){this._pickable=!0,this.device=e,this.pickLayersPass=new RO(e),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.destroy(),this.depthFBO&&this.depthFBO.destroy()}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject({x:e,y:r,layers:i,viewports:n},l=this.lastPickedInfo.info){const c=l&&l.layer&&l.layer.id,o=l&&l.viewport&&l.viewport.id,m=c?i.find(R=>R.id===c):null,b=o&&n.find(R=>R.id===o)||n[0],A=b&&b.unproject([e-b.x,r-b.y]);return{...l,x:e,y:r,viewport:b,coordinate:A,layer:m}}_resizeBuffer(){if(!this.pickingFBO&&(this.pickingFBO=this.device.createFramebuffer({colorAttachments:["rgba8unorm"],depthStencilAttachment:"depth16unorm"}),this.device.isTextureFormatRenderable("rgba32float"))){const r=this.device.createFramebuffer({colorAttachments:["rgba32float"],depthStencilAttachment:"depth16unorm"});this.depthFBO=r}const{canvas:e}=this.device.getCanvasContext();this.pickingFBO?.resize({width:e.width,height:e.height}),this.depthFBO?.resize({width:e.width,height:e.height})}_getPickable(e){if(this._pickable===!1)return null;const r=e.filter(i=>this.pickLayersPass.shouldDrawLayer(i)&&!i.isComposite);return r.length?r:null}_pickClosestObject({layers:e,views:r,viewports:i,x:n,y:l,radius:c=0,depth:o=1,mode:m="query",unproject3D:b,onViewportActive:A,effects:R}){const M=this.device.canvasContext.cssToDeviceRatio(),L=this._getPickable(e);if(!L||i.length===0)return{result:[],emptyInfo:kO({viewports:i,x:n,y:l,pixelRatio:M})};this._resizeBuffer();const G=this.device.canvasContext.cssToDevicePixels([n,l],!0),V=[G.x+Math.floor(G.width/2),G.y+Math.floor(G.height/2)],q=Math.round(c*M),{width:J,height:ie}=this.pickingFBO,ee=this._getPickingRect({deviceX:V[0],deviceY:V[1],deviceRadius:q,deviceWidth:J,deviceHeight:ie}),me={x:n-c,y:l-c,width:c*2+1,height:c*2+1};let Se;const Me=[],Ve=new Set;for(let Be=0;Be<o;Be++){let $e;if(ee){const _t=this._drawAndSample({layers:L,views:r,viewports:i,onViewportActive:A,deviceRect:ee,cullRect:me,effects:R,pass:`picking:${m}`});$e=Jre({..._t,deviceX:V[0],deviceY:V[1],deviceRadius:q,deviceRect:ee})}else $e={pickedColor:null,pickedObjectIndex:-1};let at;if($e.pickedLayer&&b&&this.depthFBO){const{pickedColors:_t}=this._drawAndSample({layers:[$e.pickedLayer],views:r,viewports:i,onViewportActive:A,deviceRect:{x:$e.pickedX,y:$e.pickedY,width:1,height:1},cullRect:me,effects:R,pass:`picking:${m}:z`},!0);_t[3]&&(at=_t[0])}$e.pickedLayer&&Be+1<o&&(Ve.add($e.pickedLayer),$e.pickedLayer.disablePickingIndex($e.pickedObjectIndex)),Se=eie({pickInfo:$e,lastPickedInfo:this.lastPickedInfo,mode:m,layers:L,viewports:i,x:n,y:l,z:at,pixelRatio:M});for(const _t of Se.values())_t.layer&&Me.push(_t);if(!$e.pickedColor)break}for(const Be of Ve)Be.restorePickingColors();return{result:Me,emptyInfo:Se.get(null)}}_pickVisibleObjects({layers:e,views:r,viewports:i,x:n,y:l,width:c=1,height:o=1,mode:m="query",maxObjects:b=null,onViewportActive:A,effects:R}){const M=this._getPickable(e);if(!M||i.length===0)return[];this._resizeBuffer();const L=this.device.canvasContext.cssToDeviceRatio(),G=this.device.canvasContext.cssToDevicePixels([n,l],!0),V=G.x,q=G.y+G.height,J=this.device.canvasContext.cssToDevicePixels([n+c,l+o],!0),ie=J.x+J.width,ee=J.y,me={x:V,y:ee,width:ie-V,height:q-ee},Se=this._drawAndSample({layers:M,views:r,viewports:i,onViewportActive:A,deviceRect:me,cullRect:{x:n,y:l,width:c,height:o},effects:R,pass:`picking:${m}`}),Me=Qre(Se),Ve=new Map,Be=[],$e=Number.isFinite(b);for(let at=0;at<Me.length&&!($e&&Be.length>=b);at++){const _t=Me[at];let Nt={color:_t.pickedColor,layer:null,index:_t.pickedObjectIndex,picked:!0,x:n,y:l,pixelRatio:L};Nt=BO({layer:_t.pickedLayer,info:Nt,mode:m});const sr=Nt.layer.id;Ve.has(sr)||Ve.set(sr,new Set);const Ft=Ve.get(sr),Ut=Nt.object??Nt.index;Ft.has(Ut)||(Ft.add(Ut),Be.push(Nt))}return Be}_drawAndSample({layers:e,views:r,viewports:i,onViewportActive:n,deviceRect:l,cullRect:c,effects:o,pass:m},b=!1){const A=b?this.depthFBO:this.pickingFBO,R={layers:e,layerFilter:this.layerFilter,views:r,viewports:i,onViewportActive:n,pickingFBO:A,deviceRect:l,cullRect:c,effects:o,pass:m,pickZ:b,preRenderStats:{}};for(const ie of o)ie.useInPicking&&(R.preRenderStats[ie.id]=ie.preRender(R));const{decodePickingColor:M}=this.pickLayersPass.render(R),{x:L,y:G,width:V,height:q}=l,J=new(b?Float32Array:Uint8Array)(V*q*4);return this.device.readPixelsToArrayWebGL(A,{sourceX:L,sourceY:G,sourceWidth:V,sourceHeight:q,target:J}),{pickedColors:J,decodePickingColor:M}}_getPickingRect({deviceX:e,deviceY:r,deviceRadius:i,deviceWidth:n,deviceHeight:l}){const c=Math.max(0,e-i),o=Math.max(0,r-i),m=Math.min(n,e+i+1)-c,b=Math.min(l,r+i+1)-o;return m<=0||b<=0?null:{x:c,y:o,width:m,height:b}}}const iie={"top-left":{top:0,left:0},"top-right":{top:0,right:0},"bottom-left":{bottom:0,left:0},"bottom-right":{bottom:0,right:0},fill:{top:0,left:0,bottom:0,right:0}},nie="top-left",yR="__root";class sie{constructor({deck:e,parentElement:r}){this.defaultWidgets=[],this.widgets=[],this.resolvedWidgets=[],this.containers={},this.lastViewports={},this.deck=e,this.parentElement=r}getWidgets(){return this.resolvedWidgets}setProps(e){e.widgets&&!Tc(e.widgets,this.widgets,1)&&this._setWidgets(e.widgets)}finalize(){for(const e of this.getWidgets())this._remove(e);this.defaultWidgets.length=0,this.resolvedWidgets.length=0;for(const e in this.containers)this.containers[e].remove()}addDefault(e){this.defaultWidgets.find(r=>r.id===e.id)||(this._add(e),this.defaultWidgets.push(e),this._setWidgets(this.widgets))}_setWidgets(e){const r={};for(const i of this.resolvedWidgets)r[i.id]=i;this.resolvedWidgets.length=0;for(const i of this.defaultWidgets)r[i.id]=null,this.resolvedWidgets.push(i);for(let i of e){const n=r[i.id];n?n.viewId!==i.viewId||n.placement!==i.placement?(this._remove(n),this._add(i)):i!==n&&(n.setProps(i.props),i=n):this._add(i),r[i.id]=null,this.resolvedWidgets.push(i)}for(const i in r){const n=r[i];n&&this._remove(n)}this.widgets=e}_add(e){const{viewId:r=null,placement:i=nie}=e,n=e.onAdd({deck:this.deck,viewId:r});n&&this._getContainer(r,i).append(n),e._element=n}_remove(e){e.onRemove(),e._element&&e._element.remove(),e._element=void 0}_getContainer(e,r){const i=e||yR;let n=this.containers[i];n||(n=document.createElement("div"),n.style.pointerEvents="none",n.style.position="absolute",n.style.overflow="hidden",this.parentElement?.append(n),this.containers[i]=n);let l=n.querySelector(`.${r}`);return l||(l=document.createElement("div"),l.className=r,l.style.position="absolute",l.style.zIndex="2",Object.assign(l.style,iie[r]),n.append(l)),l}_updateContainers(){const e=this.deck.width,r=this.deck.height;for(const i in this.containers){const n=this.lastViewports[i]||null,l=i===yR||n,c=this.containers[i];l?(c.style.display="block",c.style.left=`${n?n.x:0}px`,c.style.top=`${n?n.y:0}px`,c.style.width=`${n?n.width:e}px`,c.style.height=`${n?n.height:r}px`):c.style.display="none"}}onRedraw({viewports:e,layers:r}){const i=e.reduce((l,c)=>(l[c.id]=c,l),{}),{lastViewports:n}=this;for(const l of this.getWidgets()){const{viewId:c}=l;if(c){const o=i[c];o&&(l.onViewportChange&&!o.equals(n[c])&&l.onViewportChange(o),l.onRedraw?.({viewports:[o],layers:r}))}else{if(l.onViewportChange)for(const o of e)o.equals(n[o.id])||l.onViewportChange(o);l.onRedraw?.({viewports:e,layers:r})}}this.lastViewports=i,this._updateContainers()}onHover(e,r){for(const i of this.getWidgets()){const{viewId:n}=i;(!n||n===e.viewport?.id)&&i.onHover?.(e,r)}}onEvent(e,r){const i=U2[r.type];if(i)for(const n of this.getWidgets()){const{viewId:l}=n;(!l||l===e.viewport?.id)&&n[i.handler]?.(e,r)}}}const oie={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class aie{constructor(){this.id="default-tooltip",this.placement="fill",this.props={},this.isVisible=!1}onAdd({deck:e}){const r=document.createElement("div");return r.className="deck-tooltip",Object.assign(r.style,oie),this.deck=e,this.element=r,r}onRemove(){this.deck=void 0,this.element=void 0}setProps(){}onViewportChange(e){this.isVisible&&e.id===this.lastViewport?.id&&e!==this.lastViewport&&this.setTooltip(null)}onHover(e){const{deck:r}=this,i=r&&r.props.getTooltip;if(!i)return;const n=i(e);this.lastViewport=e.viewport,this.setTooltip(n,e.x,e.y)}setTooltip(e,r,i){const n=this.element;if(n){if(typeof e=="string")n.innerText=e;else if(e)e.text&&(n.innerText=e.text),e.html&&(n.innerHTML=e.html),e.className&&(n.className=e.className);else{this.isVisible=!1,n.style.display="none";return}this.isVisible=!0,n.style.display="block",n.style.transform=`translate(${r}px, ${i}px)`,e&&typeof e=="object"&&"style"in e&&Object.assign(n.style,e.style)}}}var Vm;(function(t){t[t.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",t[t.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",t[t.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN",t[t.ZERO=0]="ZERO",t[t.ONE=1]="ONE",t[t.SRC_COLOR=768]="SRC_COLOR",t[t.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",t[t.SRC_ALPHA=770]="SRC_ALPHA",t[t.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",t[t.DST_ALPHA=772]="DST_ALPHA",t[t.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",t[t.DST_COLOR=774]="DST_COLOR",t[t.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",t[t.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",t[t.CONSTANT_COLOR=32769]="CONSTANT_COLOR",t[t.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",t[t.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",t[t.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",t[t.FUNC_ADD=32774]="FUNC_ADD",t[t.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",t[t.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",t[t.BLEND_EQUATION=32777]="BLEND_EQUATION",t[t.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",t[t.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",t[t.BLEND_DST_RGB=32968]="BLEND_DST_RGB",t[t.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",t[t.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",t[t.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",t[t.BLEND_COLOR=32773]="BLEND_COLOR",t[t.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",t[t.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",t[t.LINE_WIDTH=2849]="LINE_WIDTH",t[t.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",t[t.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",t[t.CULL_FACE_MODE=2885]="CULL_FACE_MODE",t[t.FRONT_FACE=2886]="FRONT_FACE",t[t.DEPTH_RANGE=2928]="DEPTH_RANGE",t[t.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",t[t.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",t[t.DEPTH_FUNC=2932]="DEPTH_FUNC",t[t.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",t[t.STENCIL_FUNC=2962]="STENCIL_FUNC",t[t.STENCIL_FAIL=2964]="STENCIL_FAIL",t[t.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",t[t.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",t[t.STENCIL_REF=2967]="STENCIL_REF",t[t.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",t[t.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",t[t.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",t[t.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",t[t.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",t[t.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",t[t.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",t[t.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",t[t.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",t[t.VIEWPORT=2978]="VIEWPORT",t[t.SCISSOR_BOX=3088]="SCISSOR_BOX",t[t.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",t[t.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",t[t.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",t[t.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",t[t.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",t[t.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",t[t.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",t[t.RED_BITS=3410]="RED_BITS",t[t.GREEN_BITS=3411]="GREEN_BITS",t[t.BLUE_BITS=3412]="BLUE_BITS",t[t.ALPHA_BITS=3413]="ALPHA_BITS",t[t.DEPTH_BITS=3414]="DEPTH_BITS",t[t.STENCIL_BITS=3415]="STENCIL_BITS",t[t.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",t[t.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",t[t.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",t[t.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",t[t.SAMPLES=32937]="SAMPLES",t[t.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",t[t.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",t[t.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",t[t.VENDOR=7936]="VENDOR",t[t.RENDERER=7937]="RENDERER",t[t.VERSION=7938]="VERSION",t[t.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",t[t.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",t[t.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",t[t.STATIC_DRAW=35044]="STATIC_DRAW",t[t.STREAM_DRAW=35040]="STREAM_DRAW",t[t.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.BUFFER_SIZE=34660]="BUFFER_SIZE",t[t.BUFFER_USAGE=34661]="BUFFER_USAGE",t[t.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",t[t.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",t[t.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",t[t.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",t[t.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",t[t.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",t[t.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",t[t.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",t[t.CULL_FACE=2884]="CULL_FACE",t[t.FRONT=1028]="FRONT",t[t.BACK=1029]="BACK",t[t.FRONT_AND_BACK=1032]="FRONT_AND_BACK",t[t.BLEND=3042]="BLEND",t[t.DEPTH_TEST=2929]="DEPTH_TEST",t[t.DITHER=3024]="DITHER",t[t.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",t[t.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",t[t.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",t[t.SCISSOR_TEST=3089]="SCISSOR_TEST",t[t.STENCIL_TEST=2960]="STENCIL_TEST",t[t.NO_ERROR=0]="NO_ERROR",t[t.INVALID_ENUM=1280]="INVALID_ENUM",t[t.INVALID_VALUE=1281]="INVALID_VALUE",t[t.INVALID_OPERATION=1282]="INVALID_OPERATION",t[t.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",t[t.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",t[t.CW=2304]="CW",t[t.CCW=2305]="CCW",t[t.DONT_CARE=4352]="DONT_CARE",t[t.FASTEST=4353]="FASTEST",t[t.NICEST=4354]="NICEST",t[t.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.INT=5124]="INT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.FLOAT=5126]="FLOAT",t[t.DOUBLE=5130]="DOUBLE",t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.ALPHA=6406]="ALPHA",t[t.RGB=6407]="RGB",t[t.RGBA=6408]="RGBA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",t[t.VERTEX_SHADER=35633]="VERTEX_SHADER",t[t.COMPILE_STATUS=35713]="COMPILE_STATUS",t[t.DELETE_STATUS=35712]="DELETE_STATUS",t[t.LINK_STATUS=35714]="LINK_STATUS",t[t.VALIDATE_STATUS=35715]="VALIDATE_STATUS",t[t.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",t[t.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",t[t.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",t[t.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",t[t.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",t[t.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",t[t.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",t[t.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",t[t.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",t[t.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",t[t.SHADER_TYPE=35663]="SHADER_TYPE",t[t.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",t[t.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",t[t.NEVER=512]="NEVER",t[t.LESS=513]="LESS",t[t.EQUAL=514]="EQUAL",t[t.LEQUAL=515]="LEQUAL",t[t.GREATER=516]="GREATER",t[t.NOTEQUAL=517]="NOTEQUAL",t[t.GEQUAL=518]="GEQUAL",t[t.ALWAYS=519]="ALWAYS",t[t.KEEP=7680]="KEEP",t[t.REPLACE=7681]="REPLACE",t[t.INCR=7682]="INCR",t[t.DECR=7683]="DECR",t[t.INVERT=5386]="INVERT",t[t.INCR_WRAP=34055]="INCR_WRAP",t[t.DECR_WRAP=34056]="DECR_WRAP",t[t.NEAREST=9728]="NEAREST",t[t.LINEAR=9729]="LINEAR",t[t.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",t[t.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",t[t.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",t[t.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",t[t.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",t[t.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",t[t.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",t[t.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE=5890]="TEXTURE",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",t[t.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",t[t.TEXTURE0=33984]="TEXTURE0",t[t.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",t[t.REPEAT=10497]="REPEAT",t[t.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",t[t.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",t[t.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",t[t.FLOAT_VEC2=35664]="FLOAT_VEC2",t[t.FLOAT_VEC3=35665]="FLOAT_VEC3",t[t.FLOAT_VEC4=35666]="FLOAT_VEC4",t[t.INT_VEC2=35667]="INT_VEC2",t[t.INT_VEC3=35668]="INT_VEC3",t[t.INT_VEC4=35669]="INT_VEC4",t[t.BOOL=35670]="BOOL",t[t.BOOL_VEC2=35671]="BOOL_VEC2",t[t.BOOL_VEC3=35672]="BOOL_VEC3",t[t.BOOL_VEC4=35673]="BOOL_VEC4",t[t.FLOAT_MAT2=35674]="FLOAT_MAT2",t[t.FLOAT_MAT3=35675]="FLOAT_MAT3",t[t.FLOAT_MAT4=35676]="FLOAT_MAT4",t[t.SAMPLER_2D=35678]="SAMPLER_2D",t[t.SAMPLER_CUBE=35680]="SAMPLER_CUBE",t[t.LOW_FLOAT=36336]="LOW_FLOAT",t[t.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",t[t.HIGH_FLOAT=36338]="HIGH_FLOAT",t[t.LOW_INT=36339]="LOW_INT",t[t.MEDIUM_INT=36340]="MEDIUM_INT",t[t.HIGH_INT=36341]="HIGH_INT",t[t.FRAMEBUFFER=36160]="FRAMEBUFFER",t[t.RENDERBUFFER=36161]="RENDERBUFFER",t[t.RGBA4=32854]="RGBA4",t[t.RGB5_A1=32855]="RGB5_A1",t[t.RGB565=36194]="RGB565",t[t.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",t[t.STENCIL_INDEX=6401]="STENCIL_INDEX",t[t.STENCIL_INDEX8=36168]="STENCIL_INDEX8",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t[t.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",t[t.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",t[t.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",t[t.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",t[t.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",t[t.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",t[t.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",t[t.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",t[t.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",t[t.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",t[t.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",t[t.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",t[t.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",t[t.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",t[t.NONE=0]="NONE",t[t.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",t[t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",t[t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",t[t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",t[t.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",t[t.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",t[t.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",t[t.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",t[t.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",t[t.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",t[t.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",t[t.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",t[t.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",t[t.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",t[t.READ_BUFFER=3074]="READ_BUFFER",t[t.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",t[t.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",t[t.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",t[t.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",t[t.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",t[t.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",t[t.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",t[t.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",t[t.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",t[t.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",t[t.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",t[t.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",t[t.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",t[t.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",t[t.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",t[t.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",t[t.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",t[t.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",t[t.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",t[t.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",t[t.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",t[t.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",t[t.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",t[t.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",t[t.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",t[t.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",t[t.RED=6403]="RED",t[t.RGB8=32849]="RGB8",t[t.RGBA8=32856]="RGBA8",t[t.RGB10_A2=32857]="RGB10_A2",t[t.TEXTURE_3D=32879]="TEXTURE_3D",t[t.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",t[t.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",t[t.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",t[t.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",t[t.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",t[t.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",t[t.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",t[t.SRGB=35904]="SRGB",t[t.SRGB8=35905]="SRGB8",t[t.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",t[t.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",t[t.RGBA32F=34836]="RGBA32F",t[t.RGB32F=34837]="RGB32F",t[t.RGBA16F=34842]="RGBA16F",t[t.RGB16F=34843]="RGB16F",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",t[t.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",t[t.R11F_G11F_B10F=35898]="R11F_G11F_B10F",t[t.RGB9_E5=35901]="RGB9_E5",t[t.RGBA32UI=36208]="RGBA32UI",t[t.RGB32UI=36209]="RGB32UI",t[t.RGBA16UI=36214]="RGBA16UI",t[t.RGB16UI=36215]="RGB16UI",t[t.RGBA8UI=36220]="RGBA8UI",t[t.RGB8UI=36221]="RGB8UI",t[t.RGBA32I=36226]="RGBA32I",t[t.RGB32I=36227]="RGB32I",t[t.RGBA16I=36232]="RGBA16I",t[t.RGB16I=36233]="RGB16I",t[t.RGBA8I=36238]="RGBA8I",t[t.RGB8I=36239]="RGB8I",t[t.RED_INTEGER=36244]="RED_INTEGER",t[t.RGB_INTEGER=36248]="RGB_INTEGER",t[t.RGBA_INTEGER=36249]="RGBA_INTEGER",t[t.R8=33321]="R8",t[t.RG8=33323]="RG8",t[t.R16F=33325]="R16F",t[t.R32F=33326]="R32F",t[t.RG16F=33327]="RG16F",t[t.RG32F=33328]="RG32F",t[t.R8I=33329]="R8I",t[t.R8UI=33330]="R8UI",t[t.R16I=33331]="R16I",t[t.R16UI=33332]="R16UI",t[t.R32I=33333]="R32I",t[t.R32UI=33334]="R32UI",t[t.RG8I=33335]="RG8I",t[t.RG8UI=33336]="RG8UI",t[t.RG16I=33337]="RG16I",t[t.RG16UI=33338]="RG16UI",t[t.RG32I=33339]="RG32I",t[t.RG32UI=33340]="RG32UI",t[t.R8_SNORM=36756]="R8_SNORM",t[t.RG8_SNORM=36757]="RG8_SNORM",t[t.RGB8_SNORM=36758]="RGB8_SNORM",t[t.RGBA8_SNORM=36759]="RGBA8_SNORM",t[t.RGB10_A2UI=36975]="RGB10_A2UI",t[t.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",t[t.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",t[t.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",t[t.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",t[t.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",t[t.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",t[t.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",t[t.HALF_FLOAT=5131]="HALF_FLOAT",t[t.RG=33319]="RG",t[t.RG_INTEGER=33320]="RG_INTEGER",t[t.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",t[t.CURRENT_QUERY=34917]="CURRENT_QUERY",t[t.QUERY_RESULT=34918]="QUERY_RESULT",t[t.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",t[t.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",t[t.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",t[t.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",t[t.DRAW_BUFFER0=34853]="DRAW_BUFFER0",t[t.DRAW_BUFFER1=34854]="DRAW_BUFFER1",t[t.DRAW_BUFFER2=34855]="DRAW_BUFFER2",t[t.DRAW_BUFFER3=34856]="DRAW_BUFFER3",t[t.DRAW_BUFFER4=34857]="DRAW_BUFFER4",t[t.DRAW_BUFFER5=34858]="DRAW_BUFFER5",t[t.DRAW_BUFFER6=34859]="DRAW_BUFFER6",t[t.DRAW_BUFFER7=34860]="DRAW_BUFFER7",t[t.DRAW_BUFFER8=34861]="DRAW_BUFFER8",t[t.DRAW_BUFFER9=34862]="DRAW_BUFFER9",t[t.DRAW_BUFFER10=34863]="DRAW_BUFFER10",t[t.DRAW_BUFFER11=34864]="DRAW_BUFFER11",t[t.DRAW_BUFFER12=34865]="DRAW_BUFFER12",t[t.DRAW_BUFFER13=34866]="DRAW_BUFFER13",t[t.DRAW_BUFFER14=34867]="DRAW_BUFFER14",t[t.DRAW_BUFFER15=34868]="DRAW_BUFFER15",t[t.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",t[t.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",t[t.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",t[t.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",t[t.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",t[t.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",t[t.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",t[t.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",t[t.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",t[t.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",t[t.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",t[t.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",t[t.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",t[t.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",t[t.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",t[t.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",t[t.SAMPLER_3D=35679]="SAMPLER_3D",t[t.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",t[t.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",t[t.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",t[t.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",t[t.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",t[t.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",t[t.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",t[t.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",t[t.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",t[t.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",t[t.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",t[t.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",t[t.MAX_SAMPLES=36183]="MAX_SAMPLES",t[t.SAMPLER_BINDING=35097]="SAMPLER_BINDING",t[t.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",t[t.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",t[t.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",t[t.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",t[t.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",t[t.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",t[t.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",t[t.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",t[t.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",t[t.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",t[t.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",t[t.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",t[t.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",t[t.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",t[t.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",t[t.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",t[t.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",t[t.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",t[t.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",t[t.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",t[t.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",t[t.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",t[t.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",t[t.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",t[t.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",t[t.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",t[t.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",t[t.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",t[t.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",t[t.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",t[t.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",t[t.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",t[t.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",t[t.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",t[t.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",t[t.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",t[t.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",t[t.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",t[t.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",t[t.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",t[t.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",t[t.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",t[t.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",t[t.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",t[t.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",t[t.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",t[t.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",t[t.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",t[t.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",t[t.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",t[t.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",t[t.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",t[t.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",t[t.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",t[t.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",t[t.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",t[t.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",t[t.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",t[t.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",t[t.UNIFORM_TYPE=35383]="UNIFORM_TYPE",t[t.UNIFORM_SIZE=35384]="UNIFORM_SIZE",t[t.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",t[t.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",t[t.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",t[t.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",t[t.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",t[t.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",t[t.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",t[t.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",t[t.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",t[t.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",t[t.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",t[t.OBJECT_TYPE=37138]="OBJECT_TYPE",t[t.SYNC_CONDITION=37139]="SYNC_CONDITION",t[t.SYNC_STATUS=37140]="SYNC_STATUS",t[t.SYNC_FLAGS=37141]="SYNC_FLAGS",t[t.SYNC_FENCE=37142]="SYNC_FENCE",t[t.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",t[t.UNSIGNALED=37144]="UNSIGNALED",t[t.SIGNALED=37145]="SIGNALED",t[t.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",t[t.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",t[t.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",t[t.WAIT_FAILED=37149]="WAIT_FAILED",t[t.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",t[t.COLOR=6144]="COLOR",t[t.DEPTH=6145]="DEPTH",t[t.STENCIL=6146]="STENCIL",t[t.MIN=32775]="MIN",t[t.MAX=32776]="MAX",t[t.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",t[t.STREAM_READ=35041]="STREAM_READ",t[t.STREAM_COPY=35042]="STREAM_COPY",t[t.STATIC_READ=35045]="STATIC_READ",t[t.STATIC_COPY=35046]="STATIC_COPY",t[t.DYNAMIC_READ=35049]="DYNAMIC_READ",t[t.DYNAMIC_COPY=35050]="DYNAMIC_COPY",t[t.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",t[t.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",t[t.INVALID_INDEX=4294967295]="INVALID_INDEX",t[t.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",t[t.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",t[t.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",t[t.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",t[t.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",t[t.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",t[t.R16_EXT=33322]="R16_EXT",t[t.RG16_EXT=33324]="RG16_EXT",t[t.RGB16_EXT=32852]="RGB16_EXT",t[t.RGBA16_EXT=32859]="RGBA16_EXT",t[t.R16_SNORM_EXT=36760]="R16_SNORM_EXT",t[t.RG16_SNORM_EXT=36761]="RG16_SNORM_EXT",t[t.RGB16_SNORM_EXT=36762]="RGB16_SNORM_EXT",t[t.RGBA16_SNORM_EXT=36763]="RGBA16_SNORM_EXT",t[t.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",t[t.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",t[t.COMPRESSED_RED_RGTC1_EXT=36283]="COMPRESSED_RED_RGTC1_EXT",t[t.COMPRESSED_SIGNED_RED_RGTC1_EXT=36284]="COMPRESSED_SIGNED_RED_RGTC1_EXT",t[t.COMPRESSED_RED_GREEN_RGTC2_EXT=36285]="COMPRESSED_RED_GREEN_RGTC2_EXT",t[t.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT=36286]="COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT",t[t.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",t[t.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",t[t.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",t[t.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",t[t.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",t[t.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",t[t.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",t[t.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",t[t.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",t[t.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",t[t.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",t[t.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",t[t.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",t[t.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",t[t.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",t[t.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",t[t.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",t[t.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",t[t.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",t[t.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",t[t.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",t[t.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",t[t.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",t[t.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",t[t.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",t[t.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",t[t.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",t[t.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37848]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=37851]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR",t[t.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",t[t.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",t[t.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",t[t.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",t[t.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",t[t.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",t[t.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT",t[t.COMPLETION_STATUS_KHR=37297]="COMPLETION_STATUS_KHR",t[t.DEPTH_CLAMP_EXT=34383]="DEPTH_CLAMP_EXT",t[t.FIRST_VERTEX_CONVENTION_WEBGL=36429]="FIRST_VERTEX_CONVENTION_WEBGL",t[t.LAST_VERTEX_CONVENTION_WEBGL=36430]="LAST_VERTEX_CONVENTION_WEBGL",t[t.PROVOKING_VERTEX_WEBL=36431]="PROVOKING_VERTEX_WEBL",t[t.POLYGON_MODE_WEBGL=2880]="POLYGON_MODE_WEBGL",t[t.POLYGON_OFFSET_LINE_WEBGL=10754]="POLYGON_OFFSET_LINE_WEBGL",t[t.LINE_WEBGL=6913]="LINE_WEBGL",t[t.FILL_WEBGL=6914]="FILL_WEBGL",t[t.MAX_CLIP_DISTANCES_WEBGL=3378]="MAX_CLIP_DISTANCES_WEBGL",t[t.MAX_CULL_DISTANCES_WEBGL=33529]="MAX_CULL_DISTANCES_WEBGL",t[t.MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL=33530]="MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL",t[t.CLIP_DISTANCE0_WEBGL=12288]="CLIP_DISTANCE0_WEBGL",t[t.CLIP_DISTANCE1_WEBGL=12289]="CLIP_DISTANCE1_WEBGL",t[t.CLIP_DISTANCE2_WEBGL=12290]="CLIP_DISTANCE2_WEBGL",t[t.CLIP_DISTANCE3_WEBGL=12291]="CLIP_DISTANCE3_WEBGL",t[t.CLIP_DISTANCE4_WEBGL=12292]="CLIP_DISTANCE4_WEBGL",t[t.CLIP_DISTANCE5_WEBGL=12293]="CLIP_DISTANCE5_WEBGL",t[t.CLIP_DISTANCE6_WEBGL=12294]="CLIP_DISTANCE6_WEBGL",t[t.CLIP_DISTANCE7_WEBGL=12295]="CLIP_DISTANCE7_WEBGL",t[t.POLYGON_OFFSET_CLAMP_EXT=36379]="POLYGON_OFFSET_CLAMP_EXT",t[t.LOWER_LEFT_EXT=36001]="LOWER_LEFT_EXT",t[t.UPPER_LEFT_EXT=36002]="UPPER_LEFT_EXT",t[t.NEGATIVE_ONE_TO_ONE_EXT=37726]="NEGATIVE_ONE_TO_ONE_EXT",t[t.ZERO_TO_ONE_EXT=37727]="ZERO_TO_ONE_EXT",t[t.CLIP_ORIGIN_EXT=37724]="CLIP_ORIGIN_EXT",t[t.CLIP_DEPTH_MODE_EXT=37725]="CLIP_DEPTH_MODE_EXT",t[t.SRC1_COLOR_WEBGL=35065]="SRC1_COLOR_WEBGL",t[t.SRC1_ALPHA_WEBGL=34185]="SRC1_ALPHA_WEBGL",t[t.ONE_MINUS_SRC1_COLOR_WEBGL=35066]="ONE_MINUS_SRC1_COLOR_WEBGL",t[t.ONE_MINUS_SRC1_ALPHA_WEBGL=35067]="ONE_MINUS_SRC1_ALPHA_WEBGL",t[t.MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL=35068]="MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL",t[t.MIRROR_CLAMP_TO_EDGE_EXT=34627]="MIRROR_CLAMP_TO_EDGE_EXT"})(Vm||(Vm={}));const yT={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,35725:null,36006:null,36007:null,34229:null,34964:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32926:!1,32928:!1,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],36389:null,36662:null,36663:null,35053:null,35055:null,35723:4352,36010:null,35977:!1,3333:4,3317:4,37440:!1,37441:!1,37443:37444,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},es=(t,e,r)=>e?t.enable(r):t.disable(r),vR=(t,e,r)=>t.hint(r,e),Za=(t,e,r)=>t.pixelStorei(r,e),bR=(t,e,r)=>{const i=r===36006?36009:36008;return t.bindFramebuffer(i,e)},I_=(t,e,r)=>{const i={34964:34962,36662:36662,36663:36663,35053:35051,35055:35052}[r];t.bindBuffer(i,e)};function Xx(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}const lie={3042:es,32773:(t,e)=>t.blendColor(...e),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(t,e)=>t.clearColor(...e),3107:(t,e)=>t.colorMask(...e),2884:es,2885:(t,e)=>t.cullFace(e),2929:es,2931:(t,e)=>t.clearDepth(e),2932:(t,e)=>t.depthFunc(e),2928:(t,e)=>t.depthRange(...e),2930:(t,e)=>t.depthMask(e),3024:es,35723:vR,35725:(t,e)=>t.useProgram(e),36007:(t,e)=>t.bindRenderbuffer(36161,e),36389:(t,e)=>t.bindTransformFeedback?.(36386,e),34229:(t,e)=>t.bindVertexArray(e),36006:bR,36010:bR,34964:I_,36662:I_,36663:I_,35053:I_,35055:I_,2886:(t,e)=>t.frontFace(e),33170:vR,2849:(t,e)=>t.lineWidth(e),32823:es,32824:"polygonOffset",10752:"polygonOffset",35977:es,32926:es,32928:es,32938:"sampleCoverage",32939:"sampleCoverage",3089:es,3088:(t,e)=>t.scissor(...e),2960:es,2961:(t,e)=>t.clearStencil(e),2968:(t,e)=>t.stencilMaskSeparate(1028,e),36005:(t,e)=>t.stencilMaskSeparate(1029,e),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(t,e)=>t.viewport(...e),34383:es,10754:es,12288:es,12289:es,12290:es,12291:es,12292:es,12293:es,12294:es,12295:es,3333:Za,3317:Za,37440:Za,37441:Za,37443:Za,3330:Za,3332:Za,3331:Za,3314:Za,32878:Za,3316:Za,3315:Za,32877:Za,framebuffer:(t,e)=>{const r=e&&"handle"in e?e.handle:e;return t.bindFramebuffer(36160,r)},blend:(t,e)=>e?t.enable(3042):t.disable(3042),blendColor:(t,e)=>t.blendColor(...e),blendEquation:(t,e)=>{const r=typeof e=="number"?[e,e]:e;t.blendEquationSeparate(...r)},blendFunc:(t,e)=>{const r=e?.length===2?[...e,...e]:e;t.blendFuncSeparate(...r)},clearColor:(t,e)=>t.clearColor(...e),clearDepth:(t,e)=>t.clearDepth(e),clearStencil:(t,e)=>t.clearStencil(e),colorMask:(t,e)=>t.colorMask(...e),cull:(t,e)=>e?t.enable(2884):t.disable(2884),cullFace:(t,e)=>t.cullFace(e),depthTest:(t,e)=>e?t.enable(2929):t.disable(2929),depthFunc:(t,e)=>t.depthFunc(e),depthMask:(t,e)=>t.depthMask(e),depthRange:(t,e)=>t.depthRange(...e),dither:(t,e)=>e?t.enable(3024):t.disable(3024),derivativeHint:(t,e)=>{t.hint(35723,e)},frontFace:(t,e)=>t.frontFace(e),mipmapHint:(t,e)=>t.hint(33170,e),lineWidth:(t,e)=>t.lineWidth(e),polygonOffsetFill:(t,e)=>e?t.enable(32823):t.disable(32823),polygonOffset:(t,e)=>t.polygonOffset(...e),sampleCoverage:(t,e)=>t.sampleCoverage(...e),scissorTest:(t,e)=>e?t.enable(3089):t.disable(3089),scissor:(t,e)=>t.scissor(...e),stencilTest:(t,e)=>e?t.enable(2960):t.disable(2960),stencilMask:(t,e)=>{e=Xx(e)?e:[e,e];const[r,i]=e;t.stencilMaskSeparate(1028,r),t.stencilMaskSeparate(1029,i)},stencilFunc:(t,e)=>{e=Xx(e)&&e.length===3?[...e,...e]:e;const[r,i,n,l,c,o]=e;t.stencilFuncSeparate(1028,r,i,n),t.stencilFuncSeparate(1029,l,c,o)},stencilOp:(t,e)=>{e=Xx(e)&&e.length===3?[...e,...e]:e;const[r,i,n,l,c,o]=e;t.stencilOpSeparate(1028,r,i,n),t.stencilOpSeparate(1029,l,c,o)},viewport:(t,e)=>t.viewport(...e)};function Mn(t,e,r){return e[t]!==void 0?e[t]:r[t]}const cie={blendEquation:(t,e,r)=>t.blendEquationSeparate(Mn(32777,e,r),Mn(34877,e,r)),blendFunc:(t,e,r)=>t.blendFuncSeparate(Mn(32969,e,r),Mn(32968,e,r),Mn(32971,e,r),Mn(32970,e,r)),polygonOffset:(t,e,r)=>t.polygonOffset(Mn(32824,e,r),Mn(10752,e,r)),sampleCoverage:(t,e,r)=>t.sampleCoverage(Mn(32938,e,r),Mn(32939,e,r)),stencilFuncFront:(t,e,r)=>t.stencilFuncSeparate(1028,Mn(2962,e,r),Mn(2967,e,r),Mn(2963,e,r)),stencilFuncBack:(t,e,r)=>t.stencilFuncSeparate(1029,Mn(34816,e,r),Mn(36003,e,r),Mn(36004,e,r)),stencilOpFront:(t,e,r)=>t.stencilOpSeparate(1028,Mn(2964,e,r),Mn(2965,e,r),Mn(2966,e,r)),stencilOpBack:(t,e,r)=>t.stencilOpSeparate(1029,Mn(34817,e,r),Mn(34818,e,r),Mn(34819,e,r))},xR={enable:(t,e)=>t({[e]:!0}),disable:(t,e)=>t({[e]:!1}),pixelStorei:(t,e,r)=>t({[e]:r}),hint:(t,e,r)=>t({[e]:r}),useProgram:(t,e)=>t({35725:e}),bindRenderbuffer:(t,e,r)=>t({36007:r}),bindTransformFeedback:(t,e,r)=>t({36389:r}),bindVertexArray:(t,e)=>t({34229:e}),bindFramebuffer:(t,e,r)=>{switch(e){case 36160:return t({36006:r,36010:r});case 36009:return t({36006:r});case 36008:return t({36010:r});default:return null}},bindBuffer:(t,e,r)=>{const i={34962:[34964],36662:[36662],36663:[36663],35051:[35053],35052:[35055]}[e];return i?t({[i]:r}):{valueChanged:!0}},blendColor:(t,e,r,i,n)=>t({32773:new Float32Array([e,r,i,n])}),blendEquation:(t,e)=>t({32777:e,34877:e}),blendEquationSeparate:(t,e,r)=>t({32777:e,34877:r}),blendFunc:(t,e,r)=>t({32969:e,32968:r,32971:e,32970:r}),blendFuncSeparate:(t,e,r,i,n)=>t({32969:e,32968:r,32971:i,32970:n}),clearColor:(t,e,r,i,n)=>t({3106:new Float32Array([e,r,i,n])}),clearDepth:(t,e)=>t({2931:e}),clearStencil:(t,e)=>t({2961:e}),colorMask:(t,e,r,i,n)=>t({3107:[e,r,i,n]}),cullFace:(t,e)=>t({2885:e}),depthFunc:(t,e)=>t({2932:e}),depthRange:(t,e,r)=>t({2928:new Float32Array([e,r])}),depthMask:(t,e)=>t({2930:e}),frontFace:(t,e)=>t({2886:e}),lineWidth:(t,e)=>t({2849:e}),polygonOffset:(t,e,r)=>t({32824:e,10752:r}),sampleCoverage:(t,e,r)=>t({32938:e,32939:r}),scissor:(t,e,r,i,n)=>t({3088:new Int32Array([e,r,i,n])}),stencilMask:(t,e)=>t({2968:e,36005:e}),stencilMaskSeparate:(t,e,r)=>t({[e===1028?2968:36005]:r}),stencilFunc:(t,e,r,i)=>t({2962:e,2967:r,2963:i,34816:e,36003:r,36004:i}),stencilFuncSeparate:(t,e,r,i,n)=>t({[e===1028?2962:34816]:r,[e===1028?2967:36003]:i,[e===1028?2963:36004]:n}),stencilOp:(t,e,r,i)=>t({2964:e,2965:r,2966:i,34817:e,34818:r,34819:i}),stencilOpSeparate:(t,e,r,i,n)=>t({[e===1028?2964:34817]:r,[e===1028?2965:34818]:i,[e===1028?2966:34819]:n}),viewport:(t,e,r,i,n)=>t({2978:[e,r,i,n]})},gu=(t,e)=>t.isEnabled(e),wR={3042:gu,2884:gu,2929:gu,3024:gu,32823:gu,32926:gu,32928:gu,3089:gu,2960:gu,35977:gu},uie=new Set([34016,36388,36387,35983,35368,34965,35739,35738,3074,34853,34854,34855,34856,34857,34858,34859,34860,34861,34862,34863,34864,34865,34866,34867,34868,35097,32873,35869,32874,34068]);function Bg(t,e){if(die(e))return;const r={};for(const n in e){const l=Number(n),c=lie[n];c&&(typeof c=="string"?r[c]=!0:c(t,e[n],l))}const i=t.state&&t.state.cache;if(i)for(const n in r){const l=cie[n];l(t,e,i)}}function LO(t,e=yT){if(typeof e=="number"){const n=e,l=wR[n];return l?l(t,n):t.getParameter(n)}const r=Array.isArray(e)?e:Object.keys(e),i={};for(const n of r){const l=wR[n];i[n]=l?l(t,Number(n)):t.getParameter(Number(n))}return i}function hie(t){Bg(t,yT)}function die(t){for(const e in t)return!1;return!0}function fie(t,e){if(t===e)return!0;const r=Array.isArray(t)||ArrayBuffer.isView(t),i=Array.isArray(e)||ArrayBuffer.isView(e);if(r&&i&&t.length===e.length){for(let n=0;n<t.length;++n)if(t[n]!==e[n])return!1;return!0}return!1}class pie{gl;program=null;stateStack=[];enable=!0;cache;log;constructor(e,{copyState:r=!1,log:i=()=>{}}={}){this.gl=e,this.cache=r?LO(e):Object.assign({},yT),this.log=i,this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(e={}){this.stateStack.push({})}pop(){_i(this.stateStack.length>0);const e=this.stateStack[this.stateStack.length-1];Bg(this.gl,e),this.stateStack.pop()}_updateCache(e){let r=!1,i;const n=this.stateStack.length>0?this.stateStack[this.stateStack.length-1]:null;for(const l in e){_i(l!==void 0);const c=e[l],o=this.cache[l];fie(c,o)||(r=!0,i=o,n&&!(l in n)&&(n[l]=o),this.cache[l]=c)}return{valueChanged:r,oldValue:i}}}function kp(t){return t.state}function OO(t,e){const{enable:r=!0,copyState:i}=e;if(_i(i!==void 0),!t.state){t.state=new pie(t,{copyState:i}),gie(t);for(const l in xR){const c=xR[l];mie(t,l,c)}ER(t,"getParameter"),ER(t,"isEnabled")}const n=kp(t);return n.enable=r,t}function sb(t){let e=kp(t);e||(OO(t,{copyState:!1}),e=kp(t)),e.push()}function Sy(t){const e=kp(t);_i(e),e.pop()}function ER(t,e){const r=t[e].bind(t);t[e]=function(i){if(i===void 0||uie.has(i))return r(i);const n=kp(t);return i in n.cache||(n.cache[i]=r(i)),n.enable?n.cache[i]:r(i)},Object.defineProperty(t[e],"name",{value:`${e}-from-cache`,configurable:!1})}function mie(t,e,r){if(!t[e])return;const i=t[e].bind(t);t[e]=function(...n){const l=kp(t),{valueChanged:c,oldValue:o}=r(l._updateCache,...n);return c&&i(...n),o},Object.defineProperty(t[e],"name",{value:`${e}-to-cache`,configurable:!1})}function gie(t){const e=t.useProgram.bind(t);t.useProgram=function(r){const i=kp(t);i.program!==r&&(e(r),i.program=r)}}const _ie={powerPreference:"high-performance",onContextLost:()=>console.error("WebGL context lost"),onContextRestored:()=>console.info("WebGL context restored")};function yie(t,e){e={..._ie,...e};let r=null;const i=l=>r=l.statusMessage||r;t.addEventListener("webglcontextcreationerror",i,!1);let n=null;if(n||=t.getContext("webgl2",e),t.removeEventListener("webglcontextcreationerror",i,!1),!n)throw new Error(`Failed to create WebGL context: ${r||"Unknown error"}`);if(e.onContextLost){const{onContextLost:l}=e;t.addEventListener("webglcontextlost",c=>l(c),!1)}if(e.onContextRestored){const{onContextRestored:l}=e;t.addEventListener("webglcontextrestored",c=>l(c),!1)}return n}function Ud(t,e,r){return r[e]===void 0&&(r[e]=t.getExtension(e)||null),r[e]}function vie(t,e){const r=t.getParameter(7936),i=t.getParameter(7937);Ud(t,"WEBGL_debug_renderer_info",e);const n=e.WEBGL_debug_renderer_info,l=t.getParameter(n?n.UNMASKED_VENDOR_WEBGL:7936),c=t.getParameter(n?n.UNMASKED_RENDERER_WEBGL:7937),o=l||r,m=c||i,b=t.getParameter(7938),A=DO(o,m),R=bie(o,m),M=xie(o,m);return{type:"webgl",gpu:A,gpuType:M,gpuBackend:R,vendor:o,renderer:m,version:b,shadingLanguage:"glsl",shadingLanguageVersion:300}}function DO(t,e){return/NVIDIA/i.exec(t)||/NVIDIA/i.exec(e)?"nvidia":/INTEL/i.exec(t)||/INTEL/i.exec(e)?"intel":/Apple/i.exec(t)||/Apple/i.exec(e)?"apple":/AMD/i.exec(t)||/AMD/i.exec(e)||/ATI/i.exec(t)||/ATI/i.exec(e)?"amd":/SwiftShader/i.exec(t)||/SwiftShader/i.exec(e)?"software":"unknown"}function bie(t,e){return/Metal/i.exec(t)||/Metal/i.exec(e)?"metal":/ANGLE/i.exec(t)||/ANGLE/i.exec(e)?"opengl":"unknown"}function xie(t,e){if(/SwiftShader/i.exec(t)||/SwiftShader/i.exec(e))return"cpu";switch(DO(t,e)){case"intel":return"integrated";case"software":return"cpu";case"unknown":return"unknown";default:return"discrete"}}function NO(t){switch(t){case"uint8":return 5121;case"sint8":return 5120;case"unorm8":return 5121;case"snorm8":return 5120;case"uint16":return 5123;case"sint16":return 5122;case"unorm16":return 5123;case"snorm16":return 5122;case"uint32":return 5125;case"sint32":return 5124;case"float16":return 5131;case"float32":return 5126}throw new Error(String(t))}const Eo="texture-compression-bc",Pi="texture-compression-astc",_u="texture-compression-etc2",wie="texture-compression-etc1-webgl",mv="texture-compression-pvrtc-webgl",Yx="texture-compression-atc-webgl",k_="float32-renderable-webgl",Jx="float16-renderable-webgl",Eie="rgb9e5ufloat_renderable-webgl",Qx="snorm8-renderable-webgl",B_="norm16-renderable-webgl",ew="snorm16-renderable-webgl",gv="float32-filterable",AR="float16-filterable-webgl",W_="WEBGL_compressed_texture_s3tc",q_="WEBGL_compressed_texture_s3tc_srgb",Gm="EXT_texture_compression_rgtc",Hm="EXT_texture_compression_bptc",Aie="WEBGL_compressed_texture_etc",Tie="WEBGL_compressed_texture_astc",Sie="WEBGL_compressed_texture_etc1",Cie="WEBGL_compressed_texture_pvrtc",Pie="WEBGL_compressed_texture_atc",TR="EXT_texture_norm16",SR="EXT_render_snorm",Rie="EXT_color_buffer_float",vT={"float32-renderable-webgl":["EXT_color_buffer_float"],"float16-renderable-webgl":["EXT_color_buffer_half_float"],"rgb9e5ufloat_renderable-webgl":["WEBGL_render_shared_exponent"],"snorm8-renderable-webgl":[SR],"norm16-renderable-webgl":[TR],"snorm16-renderable-webgl":[TR,SR],"float32-filterable":["OES_texture_float_linear"],"float16-filterable-webgl":["OES_texture_half_float_linear"],"texture-filterable-anisotropic-webgl":["EXT_texture_filter_anisotropic"],"texture-blend-float-webgl":["EXT_float_blend"],"texture-compression-bc":[W_,q_,Gm,Hm],"texture-compression-bc5-webgl":[Gm],"texture-compression-bc7-webgl":[Hm],"texture-compression-etc2":[Aie],"texture-compression-astc":[Tie],"texture-compression-etc1-webgl":[Sie],"texture-compression-pvrtc-webgl":[Cie],"texture-compression-atc-webgl":[Pie]};function Mie(t){return t in vT}function Iie(t,e,r){return(vT[e]||[]).every(i=>Ud(t,i,r))}const ob={"rgb8unorm-unsized":{gl:6407,b:4,c:2,bpp:4,dataFormat:6407,types:[5121,33635]},"rgba8unorm-unsized":{gl:6408,b:4,c:2,bpp:4,dataFormat:6408,types:[5121,32819,32820]},r8unorm:{gl:33321,b:1,c:1,rb:!0},r8snorm:{gl:36756,b:1,c:1,render:Qx},r8uint:{gl:33330,b:1,c:1,rb:!0},r8sint:{gl:33329,b:1,c:1,rb:!0},rg8unorm:{gl:33323,b:2,c:2,rb:!0},rg8snorm:{gl:36757,b:2,c:2,render:Qx},rg8uint:{gl:33336,b:2,c:2,rb:!0},rg8sint:{gl:33335,b:2,c:2,rb:!0},r16uint:{gl:33332,b:2,c:1,rb:!0},r16sint:{gl:33331,b:2,c:1,rb:!0},r16float:{gl:33325,b:2,c:1,render:Jx,filter:"float16-filterable-webgl",rb:!0},"r16unorm-webgl":{gl:33322,b:2,c:1,f:B_,rb:!0},"r16snorm-webgl":{gl:36760,b:2,c:1,f:ew},"rgba4unorm-webgl":{gl:32854,b:2,c:4,wgpu:!1,rb:!0},"rgb565unorm-webgl":{gl:36194,b:2,c:4,wgpu:!1,rb:!0},"rgb5a1unorm-webgl":{gl:32855,b:2,c:4,wgpu:!1,rb:!0},"rgb8unorm-webgl":{gl:32849,b:3,c:3,wgpu:!1},"rgb8snorm-webgl":{gl:36758,b:3,c:3,wgpu:!1},rgba8unorm:{gl:32856,b:4,c:2,bpp:4},"rgba8unorm-srgb":{gl:35907,b:4,c:4,bpp:4},rgba8snorm:{gl:36759,b:4,c:4,render:Qx},rgba8uint:{gl:36220,b:4,c:4,bpp:4},rgba8sint:{gl:36238,b:4,c:4,bpp:4},bgra8unorm:{b:4,c:4},"bgra8unorm-srgb":{b:4,c:4},rg16uint:{gl:33338,b:4,c:1,bpp:4},rg16sint:{gl:33337,b:4,c:2,bpp:4},rg16float:{gl:33327,bpp:4,b:4,c:2,render:Jx,filter:AR,rb:!0},"rg16unorm-webgl":{gl:33324,b:2,c:2,render:B_},"rg16snorm-webgl":{gl:36761,b:2,c:2,render:ew},r32uint:{gl:33334,b:4,c:1,bpp:4,rb:!0},r32sint:{gl:33333,b:4,c:1,bpp:4,rb:!0},r32float:{gl:33326,bpp:4,b:4,c:1,render:k_,filter:gv},rgb9e5ufloat:{gl:35901,b:4,c:3,p:1,render:Eie},rg11b10ufloat:{gl:35898,b:4,c:3,p:1,render:k_,rb:!0},rgb10a2unorm:{gl:32857,b:4,c:4,p:1,rb:!0},"rgb10a2uint-webgl":{b:4,c:4,gl:36975,p:1,wgpu:!1,bpp:4,rb:!0},"rgb16unorm-webgl":{gl:32852,b:2,c:3,f:B_},"rgb16snorm-webgl":{gl:36762,b:2,c:3,f:B_},rg32uint:{gl:33340,b:8,c:2,rb:!0},rg32sint:{gl:33339,b:8,c:2,rb:!0},rg32float:{gl:33328,b:8,c:2,render:k_,filter:gv,rb:!0},rgba16uint:{gl:36214,b:8,c:4,rb:!0},rgba16sint:{gl:36232,b:8,c:4,rb:!0},rgba16float:{gl:34842,b:8,c:4,render:Jx,filter:AR},"rgba16unorm-webgl":{gl:32859,b:2,c:4,render:B_,rb:!0},"rgba16snorm-webgl":{gl:36763,b:2,c:4,render:ew},"rgb32float-webgl":{gl:34837,render:k_,filter:gv,gl2ext:Rie,dataFormat:6407,types:[5126]},rgba32uint:{gl:36208,b:16,c:4,rb:!0},rgba32sint:{gl:36226,b:16,c:4,rb:!0},rgba32float:{gl:34836,b:16,c:4,render:k_,filter:gv,rb:!0},stencil8:{gl:36168,b:1,c:1,attachment:36128,rb:!0},depth16unorm:{gl:33189,b:2,c:1,attachment:36096,dataFormat:6402,types:[5123],rb:!0},depth24plus:{gl:33190,b:3,c:1,attachment:36096,dataFormat:6402,types:[5125]},depth32float:{gl:36012,b:4,c:1,attachment:36096,dataFormat:6402,types:[5126],rb:!0},"depth24plus-stencil8":{gl:35056,b:4,c:2,p:1,attachment:33306,rb:!0,depthTexture:!0,dataFormat:34041,types:[34042]},"depth24unorm-stencil8":{gl:35056,b:4,c:2,p:1,attachment:33306,dataFormat:34041,types:[34042],rb:!0},"depth32float-stencil8":{gl:36013,b:5,c:2,p:1,attachment:33306,dataFormat:34041,types:[36269],rb:!0},"bc1-rgb-unorm-webgl":{gl:33776,x:W_,f:Eo},"bc1-rgb-unorm-srgb-webgl":{gl:35916,x:q_,f:Eo},"bc1-rgba-unorm":{gl:33777,x:W_,f:Eo},"bc1-rgba-unorm-srgb":{gl:35916,x:q_,f:Eo},"bc2-rgba-unorm":{gl:33778,x:W_,f:Eo},"bc2-rgba-unorm-srgb":{gl:35918,x:q_,f:Eo},"bc3-rgba-unorm":{gl:33779,x:W_,f:Eo},"bc3-rgba-unorm-srgb":{gl:35919,x:q_,f:Eo},"bc4-r-unorm":{gl:36283,x:Gm,f:Eo},"bc4-r-snorm":{gl:36284,x:Gm,f:Eo},"bc5-rg-unorm":{gl:36285,x:Gm,f:Eo},"bc5-rg-snorm":{gl:36286,x:Gm,f:Eo},"bc6h-rgb-ufloat":{gl:36495,x:Hm,f:Eo},"bc6h-rgb-float":{gl:36494,x:Hm,f:Eo},"bc7-rgba-unorm":{gl:36492,x:Hm,f:Eo},"bc7-rgba-unorm-srgb":{gl:36493,x:Hm,f:Eo},"etc2-rgb8unorm":{gl:37492,f:_u},"etc2-rgb8unorm-srgb":{gl:37494,f:_u},"etc2-rgb8a1unorm":{gl:37496,f:_u},"etc2-rgb8a1unorm-srgb":{gl:37497,f:_u},"etc2-rgba8unorm":{gl:37493,f:_u},"etc2-rgba8unorm-srgb":{gl:37495,f:_u},"eac-r11unorm":{gl:37488,f:_u},"eac-r11snorm":{gl:37489,f:_u},"eac-rg11unorm":{gl:37490,f:_u},"eac-rg11snorm":{gl:37491,f:_u},"astc-4x4-unorm":{gl:37808,f:Pi},"astc-4x4-unorm-srgb":{gl:37840,f:Pi},"astc-5x4-unorm":{gl:37809,f:Pi},"astc-5x4-unorm-srgb":{gl:37841,f:Pi},"astc-5x5-unorm":{gl:37810,f:Pi},"astc-5x5-unorm-srgb":{gl:37842,f:Pi},"astc-6x5-unorm":{gl:37811,f:Pi},"astc-6x5-unorm-srgb":{gl:37843,f:Pi},"astc-6x6-unorm":{gl:37812,f:Pi},"astc-6x6-unorm-srgb":{gl:37844,f:Pi},"astc-8x5-unorm":{gl:37813,f:Pi},"astc-8x5-unorm-srgb":{gl:37845,f:Pi},"astc-8x6-unorm":{gl:37814,f:Pi},"astc-8x6-unorm-srgb":{gl:37846,f:Pi},"astc-8x8-unorm":{gl:37815,f:Pi},"astc-8x8-unorm-srgb":{gl:37847,f:Pi},"astc-10x5-unorm":{gl:37819,f:Pi},"astc-10x5-unorm-srgb":{gl:37851,f:Pi},"astc-10x6-unorm":{gl:37817,f:Pi},"astc-10x6-unorm-srgb":{gl:37849,f:Pi},"astc-10x8-unorm":{gl:37818,f:Pi},"astc-10x8-unorm-srgb":{gl:37850,f:Pi},"astc-10x10-unorm":{gl:37819,f:Pi},"astc-10x10-unorm-srgb":{gl:37851,f:Pi},"astc-12x10-unorm":{gl:37820,f:Pi},"astc-12x10-unorm-srgb":{gl:37852,f:Pi},"astc-12x12-unorm":{gl:37821,f:Pi},"astc-12x12-unorm-srgb":{gl:37853,f:Pi},"pvrtc-rgb4unorm-webgl":{gl:35840,f:mv},"pvrtc-rgba4unorm-webgl":{gl:35842,f:mv},"pvrtc-rbg2unorm-webgl":{gl:35841,f:mv},"pvrtc-rgba2unorm-webgl":{gl:35843,f:mv},"etc1-rbg-unorm-webgl":{gl:36196,f:wie},"atc-rgb-unorm-webgl":{gl:35986,f:Yx},"atc-rgba-unorm-webgl":{gl:35986,f:Yx},"atc-rgbai-unorm-webgl":{gl:34798,f:Yx}},kie={6403:1,36244:1,33319:2,33320:2,6407:3,36248:3,6408:4,36249:4,6402:1,34041:1,6406:1,6409:1,6410:2},Bie={5126:4,5125:4,5124:4,5123:2,5122:2,5131:2,5120:1,5121:1};function bT(t,e,r){const i=ob[e];if(!i||i.gl===void 0)return!1;const n=i.x||i.gl2ext;return n?!!Ud(t,n,r):!0}function FO(t){const e=ob[t]?.gl;if(e===void 0)throw new Error(`Unsupported texture format ${t}`);return e}function Lie(t,e,r){if(!bT(t,e,r)||e.startsWith("depth")||e.startsWith("stencil"))return!1;try{if(ML(e).signed)return!1}catch{return!1}return e.endsWith("32float")?!!Ud(t,"OES_texture_float_linear, extensions",r):e.endsWith("16float")?!!Ud(t,"OES_texture_half_float_linear, extensions",r):!0}function Oie(t,e,r){return!(!bT(t,e,r)||typeof e=="number")}function x1(t){const e=ob[t],r=FO(t),i=ML(t);return{format:r,dataFormat:e?.dataFormat||Nie(i.format,i.integer,i.normalized,r),type:i.dataType?NO(i.dataType):e?.types?.[0]||5121,compressed:i.compressed}}function Die(t){const e=ob[t];if(!e?.attachment)throw new Error(`${t} is not a depth stencil format`);return e.attachment}function CR(t){const e=x1(t),r=kie[e.dataFormat]||4,i=Bie[e.type]||1;return r*i}function Nie(t,e,r,i){if(i===6408||i===6407)return i;switch(t){case"r":return e&&!r?36244:6403;case"rg":return e&&!r?33320:33319;case"rgb":return e&&!r?36248:6407;case"rgba":return e&&!r?36249:6408;default:return 6408}}const PR={"depth-clip-control":"EXT_depth_clamp","timer-query-webgl":"EXT_disjoint_timer_query_webgl2","compilation-status-async-webgl":"KHR_parallel_shader_compile","polygon-mode-webgl":"WEBGL_polygon_mode","provoking-vertex-webgl":"WEBGL_provoking_vertex","shader-clip-cull-distance-webgl":"WEBGL_clip_cull_distance","shader-noperspective-interpolation-webgl":"NV_shader_noperspective_interpolation","shader-conservative-depth-webgl":"EXT_conservative_depth"};class Fie extends MY{gl;extensions;testedFeatures=new Set;constructor(e,r,i){super([],i),this.gl=e,this.extensions=r,Ud(e,"EXT_color_buffer_float",r)}*[Symbol.iterator](){const e=this.getFeatures();for(const r of e)this.has(r)&&(yield r);return[]}has(e){return this.disabledFeatures[e]?!1:(this.testedFeatures.has(e)||(this.testedFeatures.add(e),Mie(e)&&Iie(this.gl,e,this.extensions)&&this.features.add(e),this.getWebGLFeature(e)&&this.features.add(e)),this.features.has(e))}initializeFeatures(){const e=this.getFeatures().filter(r=>r!=="polygon-mode-webgl");for(const r of e)this.has(r)}getFeatures(){return[...Object.keys(PR),...Object.keys(vT)]}getWebGLFeature(e){const r=PR[e];return typeof r=="string"?!!Ud(this.gl,r,this.extensions):!!r}}class zie extends RY{get maxTextureDimension1D(){return 0}get maxTextureDimension2D(){return this.getParameter(3379)}get maxTextureDimension3D(){return this.getParameter(32883)}get maxTextureArrayLayers(){return this.getParameter(35071)}get maxBindGroups(){return 0}get maxDynamicUniformBuffersPerPipelineLayout(){return 0}get maxDynamicStorageBuffersPerPipelineLayout(){return 0}get maxSampledTexturesPerShaderStage(){return this.getParameter(35660)}get maxSamplersPerShaderStage(){return this.getParameter(35661)}get maxStorageBuffersPerShaderStage(){return 0}get maxStorageTexturesPerShaderStage(){return 0}get maxUniformBuffersPerShaderStage(){return this.getParameter(35375)}get maxUniformBufferBindingSize(){return this.getParameter(35376)}get maxStorageBufferBindingSize(){return 0}get minUniformBufferOffsetAlignment(){return this.getParameter(35380)}get minStorageBufferOffsetAlignment(){return 0}get maxVertexBuffers(){return 16}get maxVertexAttributes(){return this.getParameter(34921)}get maxVertexBufferArrayStride(){return 2048}get maxInterStageShaderComponents(){return this.getParameter(35659)}get maxComputeWorkgroupStorageSize(){return 0}get maxComputeInvocationsPerWorkgroup(){return 0}get maxComputeWorkgroupSizeX(){return 0}get maxComputeWorkgroupSizeY(){return 0}get maxComputeWorkgroupSizeZ(){return 0}get maxComputeWorkgroupsPerDimension(){return 0}gl;limits={};constructor(e){super(),this.gl=e}getParameter(e){return this.limits[e]===void 0&&(this.limits[e]=this.gl.getParameter(e)),this.limits[e]}}function Id(t,e,r){if(jie(e))return r(t);const{nocatch:i=!0}=e;sb(t),Bg(t,e);let n;if(i)n=r(t),Sy(t);else try{n=r(t)}finally{Sy(t)}return n}function jie(t){for(const e in t)return!1;return!0}function Uie(t,e,r,i){if(h1(e))return i(t);const n=t;sb(n.gl);try{return Vie(t,e),Bg(n.gl,r),i(t)}finally{Sy(n.gl)}}function Vie(t,e){const r=t,{gl:i}=r;if(e.cullMode)switch(e.cullMode){case"none":i.disable(2884);break;case"front":i.enable(2884),i.cullFace(1028);break;case"back":i.enable(2884),i.cullFace(1029);break}if(e.frontFace&&i.frontFace(Cp("frontFace",e.frontFace,{ccw:2305,cw:2304})),e.unclippedDepth&&t.features.has("depth-clip-control")&&i.enable(34383),e.depthBias!==void 0&&(i.enable(32823),i.polygonOffset(e.depthBias,e.depthBiasSlopeScale||0)),e.provokingVertex&&t.features.has("provoking-vertex-webgl")){const n=r.getExtension("WEBGL_provoking_vertex").WEBGL_provoking_vertex,l=Cp("provokingVertex",e.provokingVertex,{first:36429,last:36430});n?.provokingVertexWEBGL(l)}if((e.polygonMode||e.polygonOffsetLine)&&t.features.has("polygon-mode-webgl")){if(e.polygonMode){const n=r.getExtension("WEBGL_polygon_mode").WEBGL_polygon_mode,l=Cp("polygonMode",e.polygonMode,{fill:6914,line:6913});n?.polygonModeWEBGL(1028,l),n?.polygonModeWEBGL(1029,l)}e.polygonOffsetLine&&i.enable(10754)}if(t.features.has("shader-clip-cull-distance-webgl")&&(e.clipDistance0&&i.enable(12288),e.clipDistance1&&i.enable(12289),e.clipDistance2&&i.enable(12290),e.clipDistance3&&i.enable(12291),e.clipDistance4&&i.enable(12292),e.clipDistance5&&i.enable(12293),e.clipDistance6&&i.enable(12294),e.clipDistance7&&i.enable(12295)),e.depthWriteEnabled!==void 0&&i.depthMask(Hie("depthWriteEnabled",e.depthWriteEnabled)),e.depthCompare&&(e.depthCompare!=="always"?i.enable(2929):i.disable(2929),i.depthFunc(q2("depthCompare",e.depthCompare))),e.stencilWriteMask){const n=e.stencilWriteMask;i.stencilMaskSeparate(1028,n),i.stencilMaskSeparate(1029,n)}if(e.stencilReadMask&&Pt.warn("stencilReadMask not supported under WebGL"),e.stencilCompare){const n=e.stencilReadMask||4294967295,l=q2("depthCompare",e.stencilCompare);e.stencilCompare!=="always"?i.enable(2960):i.disable(2960),i.stencilFuncSeparate(1028,l,0,n),i.stencilFuncSeparate(1029,l,0,n)}if(e.stencilPassOperation&&e.stencilFailOperation&&e.stencilDepthFailOperation){const n=tw("stencilPassOperation",e.stencilPassOperation),l=tw("stencilFailOperation",e.stencilFailOperation),c=tw("stencilDepthFailOperation",e.stencilDepthFailOperation);i.stencilOpSeparate(1028,l,c,n),i.stencilOpSeparate(1029,l,c,n)}if(e.blendColorOperation||e.blendAlphaOperation){i.enable(3042);const n=RR("blendColorOperation",e.blendColorOperation||"add"),l=RR("blendAlphaOperation",e.blendAlphaOperation||"add");i.blendEquationSeparate(n,l);const c=_v("blendColorSrcFactor",e.blendColorSrcFactor||"one"),o=_v("blendColorDstFactor",e.blendColorDstFactor||"zero"),m=_v("blendAlphaSrcFactor",e.blendAlphaSrcFactor||"one"),b=_v("blendAlphaDstFactor",e.blendAlphaDstFactor||"zero");i.blendFuncSeparate(c,o,m,b)}}function q2(t,e){return Cp(t,e,{never:512,less:513,equal:514,"less-equal":515,greater:516,"not-equal":517,"greater-equal":518,always:519})}function tw(t,e){return Cp(t,e,{keep:7680,zero:0,replace:7681,invert:5386,"increment-clamp":7682,"decrement-clamp":7683,"increment-wrap":34055,"decrement-wrap":34056})}function RR(t,e){return Cp(t,e,{add:32774,subtract:32778,"reverse-subtract":32779,min:32775,max:32776})}function _v(t,e){return Cp(t,e,{one:1,zero:0,"src-color":768,"one-minus-src-color":769,"dst-color":774,"one-minus-dst-color":775,"src-alpha":770,"one-minus-src-alpha":771,"dst-alpha":772,"one-minus-dst-alpha":773,"src-alpha-saturated":776,"constant-color":32769,"one-minus-constant-color":32770,"constant-alpha":32771,"one-minus-constant-alpha":32772})}function Gie(t,e){return`Illegal parameter ${e} for ${t}`}function Cp(t,e,r){if(!(e in r))throw new Error(Gie(t,e));return r[e]}function Hie(t,e){return e}function zO(t){const e={};return t.addressModeU&&(e[10242]=rw(t.addressModeU)),t.addressModeV&&(e[10243]=rw(t.addressModeV)),t.addressModeW&&(e[32882]=rw(t.addressModeW)),t.magFilter&&(e[10240]=jO(t.magFilter)),(t.minFilter||t.mipmapFilter)&&(e[10241]=$ie(t.minFilter||"linear",t.mipmapFilter)),t.lodMinClamp!==void 0&&(e[33082]=t.lodMinClamp),t.lodMaxClamp!==void 0&&(e[33083]=t.lodMaxClamp),t.type==="comparison-sampler"&&(e[34892]=34894),t.compare&&(e[34893]=q2("compare",t.compare)),t.maxAnisotropy&&(e[34046]=t.maxAnisotropy),e}function rw(t){switch(t){case"clamp-to-edge":return 33071;case"repeat":return 10497;case"mirror-repeat":return 33648}}function jO(t){switch(t){case"nearest":return 9728;case"linear":return 9729}}function $ie(t,e){if(!e)return jO(t);switch(t){case"nearest":return e==="nearest"?9984:9986;case"linear":return e==="nearest"?9985:9987}}class Ld extends rn{device;gl;handle;glTarget;glUsage;glIndexType=5123;byteLength;bytesUsed;constructor(e,r={}){super(e,r),this.device=e,this.gl=this.device.gl;const i=typeof r=="object"?r.handle:void 0;this.handle=i||this.gl.createBuffer(),e.setSpectorMetadata(this.handle,{...this.props,data:typeof this.props.data}),this.glTarget=Wie(this.props.usage),this.glUsage=qie(this.props.usage),this.glIndexType=this.props.indexType==="uint32"?5125:5123,r.data?this._initWithData(r.data,r.byteOffset,r.byteLength):this._initWithByteLength(r.byteLength||0)}_initWithData(e,r=0,i=e.byteLength+r){const n=this.glTarget;this.gl.bindBuffer(n,this.handle),this.gl.bufferData(n,i,this.glUsage),this.gl.bufferSubData(n,r,e),this.gl.bindBuffer(n,null),this.bytesUsed=i,this.byteLength=i,this._setDebugData(e,r,i),this.trackAllocatedMemory(i)}_initWithByteLength(e){_i(e>=0);let r=e;e===0&&(r=new Float32Array(0));const i=this.glTarget;return this.gl.bindBuffer(i,this.handle),this.gl.bufferData(i,r,this.glUsage),this.gl.bindBuffer(i,null),this.bytesUsed=e,this.byteLength=e,this._setDebugData(null,0,e),this.trackAllocatedMemory(e),this}destroy(){!this.destroyed&&this.handle&&(this.removeStats(),this.trackDeallocatedMemory(),this.gl.deleteBuffer(this.handle),this.destroyed=!0,this.handle=null)}write(e,r=0){this.gl.bindBuffer(36663,this.handle),this.gl.bufferSubData(36663,r,e),this.gl.bindBuffer(36663,null),this._setDebugData(e,r,e.byteLength)}async readAsync(e=0,r){return this.readSyncWebGL(e,r)}readSyncWebGL(e=0,r){r=r??this.byteLength-e;const i=new Uint8Array(r);return this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,e,i,0,r),this.gl.bindBuffer(36662,null),this._setDebugData(i,e,r),i}}function Wie(t){return t&rn.INDEX?34963:t&rn.VERTEX?34962:t&rn.UNIFORM?35345:34962}function qie(t){return t&rn.INDEX||t&rn.VERTEX?35044:t&rn.UNIFORM?35048:35044}class K2 extends rb{device;handle;parameters;constructor(e,r){super(e,r),this.device=e,this.parameters=zO(r),this.handle=this.handle||this.device.gl.createSampler(),this._setSamplerParameters(this.parameters)}destroy(){this.handle&&(this.device.gl.deleteSampler(this.handle),this.handle=void 0)}toString(){return`Sampler(${this.id},${JSON.stringify(this.props)})`}_setSamplerParameters(e){for(const[r,i]of Object.entries(e)){const n=Number(r);switch(n){case 33082:case 33083:this.device.gl.samplerParameterf(this.handle,n,i);break;default:this.device.gl.samplerParameteri(this.handle,n,i);break}}}}class $m extends eb{device;gl;handle;texture;constructor(e,r){super(e,{...rl.defaultProps,...r}),this.device=e,this.gl=this.device.gl,this.handle=null,this.texture=r.texture}}const Kie={parameters:{},pixelStore:{},pixels:null,border:0,dataFormat:void 0,textureUnit:void 0,target:void 0};class Sc extends rl{static FACES=[34069,34070,34071,34072,34073,34074];MAX_ATTRIBUTES;device;gl;handle;sampler=void 0;view=void 0;glFormat=void 0;type=void 0;dataFormat=void 0;mipmaps=void 0;target;textureUnit=void 0;loaded=!1;_video;constructor(e,r){super(e,{...Kie,format:"rgba8unorm",...r}),this.device=e,this.gl=this.device.gl,this.handle=this.props.handle||this.gl.createTexture(),this.device.setSpectorMetadata(this.handle,{...this.props,data:typeof this.props.data}),this.glFormat=6408,this.target=Zie(this.props),this.loaded=!1,typeof this.props?.data=="string"&&Object.assign(this.props,{data:_J(this.props.data)}),this.initialize(this.props),Object.seal(this)}destroy(){this.handle&&(this.gl.deleteTexture(this.handle),this.removeStats(),this.trackDeallocatedMemory("Texture"),this.destroyed=!0)}toString(){return`Texture(${this.id},${this.width}x${this.height})`}createView(e){return new $m(this.device,{...e,texture:this})}initialize(e={}){if(this.props.dimension==="cube")return this.initializeCube(e);let r=e.data;if(r instanceof Promise)return r.then(q=>this.initialize(Object.assign({},e,{pixels:q,data:q}))),this;const i=typeof HTMLVideoElement<"u"&&r instanceof HTMLVideoElement;if(i&&r.readyState<HTMLVideoElement.HAVE_METADATA)return this._video=null,r.addEventListener("loadeddata",()=>this.initialize(e)),this;const{parameters:n={}}=e,{pixels:l=null,pixelStore:c={},textureUnit:o=void 0,mipmaps:m=!0}=e;r||(r=l);let{width:b,height:A,dataFormat:R,type:M,compressed:L=!1}=e;const{depth:G=0}=e,V=FO(e.format);return{width:b,height:A,compressed:L,dataFormat:R,type:M}=this._deduceParameters({format:e.format,type:M,dataFormat:R,compressed:L,data:r,width:b,height:A}),this.width=b,this.height=A,this.glFormat=V,this.type=M,this.dataFormat=R,this.textureUnit=o,Number.isFinite(this.textureUnit)&&(this.gl.activeTexture(33984+this.textureUnit),this.gl.bindTexture(this.target,this.handle)),this.mipmaps=m,this.setImageData({data:r,width:b,height:A,depth:G,format:e.format,type:M,dataFormat:R,parameters:c,compressed:L}),this.setSampler(e.sampler),this._setSamplerParameters(n),this.view=this.createView({...this.props,mipLevelCount:1,arrayLayerCount:1}),m&&this.device.isTextureFormatFilterable(e.format)&&this.generateMipmap(),i&&(this._video={video:r,parameters:n,lastTime:r.readyState>=HTMLVideoElement.HAVE_CURRENT_DATA?r.currentTime:-1}),this}initializeCube(e){const{mipmaps:r=!0,parameters:i={}}=e;return this.setCubeMapImageData(e).then(()=>{this.loaded=!0,r&&this.generateMipmap(e),this.setSampler(e.sampler),this._setSamplerParameters(i)}),this}setSampler(e={}){let r;e instanceof K2?(this.sampler=e,r=e.props):(this.sampler=new K2(this.device,e),r=e);const i=zO(r);return this._setSamplerParameters(i),this}resize(e){const{height:r,width:i,mipmaps:n=!1}=e;return i!==this.width||r!==this.height?this.initialize({width:i,height:r,format:this.format,type:this.type,dataFormat:this.dataFormat,mipmaps:n}):this}update(){if(this._video){const{video:e,parameters:r,lastTime:i}=this._video;if(i===e.currentTime||e.readyState<HTMLVideoElement.HAVE_CURRENT_DATA)return;this.setSubImageData({data:e,parameters:r}),this.mipmaps&&this.generateMipmap(),this._video.lastTime=e.currentTime}}generateMipmap(e={}){return this.mipmaps=!0,this.gl.bindTexture(this.target,this.handle),Id(this.gl,e,()=>{this.gl.generateMipmap(this.target)}),this.gl.bindTexture(this.target,null),this}setImageData(e){if(this.props.dimension==="3d"||this.props.dimension==="2d-array")return this.setImageData3D(e);this.trackDeallocatedMemory("Texture");const{target:r=this.target,pixels:i=null,level:n=0,glFormat:l=this.glFormat,offset:c=0,parameters:o={}}=e;let{data:m=null,type:b=this.type,width:A=this.width,height:R=this.height,dataFormat:M=this.dataFormat,compressed:L=!1}=e;m||(m=i),{type:b,dataFormat:M,compressed:L,width:A,height:R}=this._deduceParameters({format:this.props.format,type:b,dataFormat:M,compressed:L,data:m,width:A,height:R});const{gl:G}=this;G.bindTexture(this.target,this.handle);let V=null;if({data:m,dataType:V}=this._getDataType({data:m,compressed:L}),Id(this.gl,o,()=>{switch(V){case"null":G.texImage2D(r,n,l,A,R,0,M,b,m);break;case"typed-array":G.texImage2D(r,n,l,A,R,0,M,b,m,c);break;case"buffer":this.device.gl.bindBuffer(35052,m.handle||m),this.device.gl.texImage2D(r,n,l,A,R,0,M,b,c),this.device.gl.bindBuffer(35052,null);break;case"browser-object":G.texImage2D(r,n,l,A,R,0,M,b,m);break;case"compressed":for(const[q,J]of m.entries())G.compressedTexImage2D(r,q,J.format,J.width,J.height,0,J.data);break;default:_i(!1,"Unknown image data type")}}),m&&m.byteLength)this.trackAllocatedMemory(m.byteLength,"Texture");else{const q=CR(this.props.format);this.trackAllocatedMemory(this.width*this.height*q,"Texture")}return this.loaded=!0,this}setSubImageData({target:e=this.target,pixels:r=null,data:i=null,x:n=0,y:l=0,width:c=this.width,height:o=this.height,level:m=0,glFormat:b=this.glFormat,type:A=this.type,dataFormat:R=this.dataFormat,compressed:M=!1,offset:L=0,parameters:G={}}){if({type:A,dataFormat:R,compressed:M,width:c,height:o}=this._deduceParameters({format:this.props.format,type:A,dataFormat:R,compressed:M,data:i,width:c,height:o}),_i(this.depth===1,"texSubImage not supported for 3D textures"),i||(i=r),i&&i.data){const V=i;i=V.data,c=V.shape[0],o=V.shape[1]}i instanceof Ld&&(i=i.handle),this.gl.bindTexture(this.target,this.handle),Id(this.gl,G,()=>{M?this.gl.compressedTexSubImage2D(e,m,n,l,c,o,b,i):i===null?this.gl.texSubImage2D(e,m,n,l,c,o,R,A,null):ArrayBuffer.isView(i)?this.gl.texSubImage2D(e,m,n,l,c,o,R,A,i,L):typeof WebGLBuffer<"u"&&i instanceof WebGLBuffer?(this.device.gl.bindBuffer(35052,i),this.device.gl.texSubImage2D(e,m,n,l,c,o,R,A,L),this.device.gl.bindBuffer(35052,null)):this.device.gl.texSubImage2D(e,m,n,l,c,o,R,A,i)}),this.gl.bindTexture(this.target,null)}copyFramebuffer(e={}){return Pt.error("Texture.copyFramebuffer({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(e=this.textureUnit){const{gl:r}=this;return e!==void 0&&(this.textureUnit=e,r.activeTexture(33984+e)),r.bindTexture(this.target,this.handle),e}unbind(e=this.textureUnit){const{gl:r}=this;return e!==void 0&&(this.textureUnit=e,r.activeTexture(33984+e)),r.bindTexture(this.target,null),e}_getDataType({data:e,compressed:r=!1}){return r?{data:e,dataType:"compressed"}:e===null?{data:e,dataType:"null"}:ArrayBuffer.isView(e)?{data:e,dataType:"typed-array"}:e instanceof Ld?{data:e.handle,dataType:"buffer"}:typeof WebGLBuffer<"u"&&e instanceof WebGLBuffer?{data:e,dataType:"buffer"}:{data:e,dataType:"browser-object"}}_deduceParameters(e){const{format:r,data:i}=e;let{width:n,height:l,dataFormat:c,type:o,compressed:m}=e;const b=x1(r);return c=c||b.dataFormat,o=o||b.type,m=m||b.compressed,{width:n,height:l}=this._deduceImageSize(i,n,l),{dataFormat:c,type:o,compressed:m,width:n,height:l,format:r,data:i}}_deduceImageSize(e,r,i){let n;return typeof ImageData<"u"&&e instanceof ImageData?n={width:e.width,height:e.height}:typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement?n={width:e.naturalWidth,height:e.naturalHeight}:typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement?n={width:e.width,height:e.height}:typeof ImageBitmap<"u"&&e instanceof ImageBitmap?n={width:e.width,height:e.height}:typeof HTMLVideoElement<"u"&&e instanceof HTMLVideoElement?n={width:e.videoWidth,height:e.videoHeight}:e?n={width:r,height:i}:n={width:r>=0?r:1,height:i>=0?i:1},_i(n,"Could not deduced texture size"),_i(r===void 0||n.width===r,"Deduced texture width does not match supplied width"),_i(i===void 0||n.height===i,"Deduced texture height does not match supplied height"),n}async setCubeMapImageData(e){const{gl:r}=this,{width:i,height:n,pixels:l,data:c,format:o=6408,type:m=5121}=e,b=l||c,A=await Promise.all(Sc.FACES.map(R=>{const M=b[R];return Promise.all(Array.isArray(M)?M:[M])}));this.bind(),Sc.FACES.forEach((R,M)=>{A[M].length>1&&this.props.mipmaps!==!1&&Pt.warn(`${this.id} has mipmap and multiple LODs.`)(),A[M].forEach((L,G)=>{i&&n?r.texImage2D(R,G,o,i,n,0,o,m,L):r.texImage2D(R,G,o,o,m,L)})}),this.unbind()}setImageDataForFace(e){const{face:r,width:i,height:n,pixels:l,data:c,format:o=6408,type:m=5121}=e,{gl:b}=this,A=l||c;return this.bind(),A instanceof Promise?A.then(R=>this.setImageDataForFace(Object.assign({},e,{face:r,data:R,pixels:R}))):this.width||this.height?b.texImage2D(r,0,o,i,n,0,o,m,A):b.texImage2D(r,0,o,o,m,A),this}setImageData3D(e){const{level:r=0,dataFormat:i,format:n,type:l,width:c,height:o,depth:m=1,offset:b=0,data:A,parameters:R={}}=e;this.trackDeallocatedMemory("Texture"),this.gl.bindTexture(this.target,this.handle);const M=x1(n);if(Id(this.gl,R,()=>{ArrayBuffer.isView(A)&&this.gl.texImage3D(this.target,r,M.format,c,o,m,0,M.dataFormat,M.type,A),A instanceof Ld&&(this.gl.bindBuffer(35052,A.handle),this.gl.texImage3D(this.target,r,i,c,o,m,0,n,l,b))}),A&&A.byteLength)this.trackAllocatedMemory(A.byteLength,"Texture");else{const L=CR(this.props.format);this.trackAllocatedMemory(this.width*this.height*this.depth*L,"Texture")}return this.loaded=!0,this}_setSamplerParameters(e){if(!h1(e)){Xie(e),this.gl.bindTexture(this.target,this.handle);for(const[r,i]of Object.entries(e)){const n=Number(r),l=i;switch(n){case 33082:case 33083:this.gl.texParameterf(this.target,n,l);break;default:this.gl.texParameteri(this.target,n,l);break}}this.gl.bindTexture(this.target,null)}}}function Zie(t){switch(t.dimension){case"2d":return 3553;case"cube":return 34067;case"2d-array":return 35866;case"3d":return 32879;case"1d":case"cube-array":default:throw new Error(t.dimension)}}function Xie(t){Pt.log(1,"texture sampler parameters",t)()}class ay extends ib{device;gl;handle;get texture(){return this.colorAttachments[0]}constructor(e,r){super(e,r);const i=r.handle===null;if(this.device=e,this.gl=e.gl,this.handle=this.props.handle||i?this.props.handle:this.gl.createFramebuffer(),!i){e.setSpectorMetadata(this.handle,{id:this.props.id,props:this.props}),this.autoCreateAttachmentTextures();const n=this.gl.bindFramebuffer(36160,this.handle);for(let l=0;l<this.colorAttachments.length;++l){const c=this.colorAttachments[l],o=36064+l;c&&this._attachOne(o,c)}if(this.depthStencilAttachment&&this._attachOne(Die(this.depthStencilAttachment.props.format),this.depthStencilAttachment),r.check!==!1){const l=this.gl.checkFramebufferStatus(36160);if(l!==36053)throw new Error(`Framebuffer ${Jie(l)}`)}this.gl.bindFramebuffer(36160,n)}}destroy(){super.destroy(),!this.destroyed&&this.handle!==null&&this.gl.deleteFramebuffer(this.handle)}createDepthStencilTexture(e){return new Sc(this.device,{id:`${this.id}-depth-stencil`,format:e,width:this.width,height:this.height,mipmaps:!1})}resizeAttachments(e,r){if(this.handle===null)return this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this;e===void 0&&(e=this.gl.drawingBufferWidth),r===void 0&&(r=this.gl.drawingBufferHeight);for(const i of this.colorAttachments)i.texture.resize({width:e,height:r});return this.depthStencilAttachment&&this.depthStencilAttachment.texture.resize({width:e,height:r}),this}_attachOne(e,r){if(Array.isArray(r)){const[i,n=0,l=0]=r;return this._attachTexture(e,i,n,l),i}if(r instanceof Sc)return this._attachTexture(e,r,0,0),r;if(r instanceof $m){const i=r;return this._attachTexture(e,i.texture,i.props.baseMipLevel,i.props.baseArrayLayer),r.texture}throw new Error("attach")}_attachTexture(e,r,i,n){const{gl:l}=this.device;switch(l.bindTexture(r.target,r.handle),r.target){case 35866:case 32879:l.framebufferTextureLayer(36160,e,r.target,n,i);break;case 34067:const c=Yie(i);l.framebufferTexture2D(36160,e,c,r.handle,n);break;case 3553:l.framebufferTexture2D(36160,e,3553,r.handle,n);break;default:_i(!1,"Illegal texture type")}l.bindTexture(r.target,null)}}function Yie(t){return t<34069?t+34069:t}function Jie(t){switch(t){case 36053:return"success";case 36054:return"Mismatched attachments";case 36055:return"No attachments";case 36057:return"Height/width mismatch";case 36061:return"Unsupported or split attachments";case 36182:return"Samples mismatch";default:return`${t}`}}class Qie extends IL{device;presentationSize;_framebuffer=null;constructor(e,r){super(r),this.device=e,this.presentationSize=[-1,-1],this._setAutoCreatedCanvasId(`${this.device.id}-canvas`),this.update()}getCurrentFramebuffer(){return this.update(),this._framebuffer=this._framebuffer||new ay(this.device,{handle:null}),this._framebuffer}update(){const e=this.getPixelSize();(e[0]!==this.presentationSize[0]||e[1]!==this.presentationSize[1])&&(this.presentationSize=e,this.resize())}resize(e){if(this.device.gl&&this.canvas){const r=this.getDevicePixelRatio(e?.useDevicePixels);this.setDevicePixelRatio(r,e);return}}commit(){}}const ene={spector:Pt.get("spector")||Pt.get("spectorjs")},tne="https://cdn.jsdelivr.net/npm/spectorjs@0.9.30/dist/spector.bundle.js",rne=1;let ma=null,MR=!1;async function ine(t){if(!globalThis.SPECTOR)try{await zL(tne)}catch(e){Pt.warn(String(e))}}function nne(t){if(t={...ene,...t},!t?.spector||(!ma&&globalThis.SPECTOR&&(Pt.probe(rne,"SPECTOR found and initialized")(),ma=new globalThis.SPECTOR.Spector,globalThis.luma&&(globalThis.luma.spector=ma)),!ma))return null;if(MR||(MR=!0,ma.spyCanvases(),ma?.onCaptureStarted.add(e=>Pt.info("Spector capture started:",e)()),ma?.onCapture.add(e=>{Pt.info("Spector capture complete:",e)(),ma?.getResultUI(),ma?.resultView.display(),ma?.resultView.addCapture(e)})),t?.canvas){if(typeof t.spector=="string"&&t.spector!==t.canvas.id)return ma;ma?.startCapture(t?.canvas,500),new Promise(e=>setTimeout(e,2e3)).then(e=>{Pt.info("Spector capture stopped after 2 seconds")(),ma?.stopCapture()})}return ma}const sne="https://unpkg.com/webgl-debug@2.0.1/index.js";function UO(t){return t.luma=t.luma||{},t.luma}async function one(){qd()&&!globalThis.WebGLDebugUtils&&(globalThis.global=globalThis.global||globalThis,globalThis.global.module={},await zL(sne))}function ane(t,e={}){return t?e.debug?cne(t,e):lne(t):null}function lne(t){const e=UO(t);return e.realContext?e.realContext:t}function cne(t,e){if(!globalThis.WebGLDebugUtils)return Pt.warn("webgl-debug not loaded")(),t;const r=UO(t);if(r.debugContext)return r.debugContext;globalThis.WebGLDebugUtils.init({...Vm,...t});const i=globalThis.WebGLDebugUtils.makeDebugContext(t,une.bind(null,e),hne.bind(null,e));for(const c in Vm)!(c in i)&&typeof Vm[c]=="number"&&(i[c]=Vm[c]);class n{}Object.setPrototypeOf(i,Object.getPrototypeOf(t)),Object.setPrototypeOf(n,i);const l=Object.create(n);return r.realContext=t,r.debugContext=l,l.debug=!0,l}function iw(t,e){e=Array.from(e).map(i=>i===void 0?"undefined":i);let r=globalThis.WebGLDebugUtils.glFunctionArgsToString(t,e);return r=`${r.slice(0,100)}${r.length>100?"...":""}`,`gl.${t}(${r})`}function une(t,e,r,i){i=Array.from(i).map(o=>o===void 0?"undefined":o);const n=globalThis.WebGLDebugUtils.glEnumToString(e),l=globalThis.WebGLDebugUtils.glFunctionArgsToString(r,i),c=`${n} in gl.${r}(${l})`;Pt.error(c)();debugger;if(t.throwOnError)throw new Error(c)}function hne(t,e,r){let i="";if(Pt.level>=1&&(i=iw(e,r),Pt.log(1,i)()),t.break&&t.break.length>0&&(i=i||iw(e,r),t.break.every(n=>i.indexOf(n)!==-1)))debugger;for(const n of r)if(n===void 0){if(i=i||iw(e,r),t.throwOnError)throw new Error(`Undefined argument: ${i}`);Pt.error(`Undefined argument: ${i}`)();debugger}}function dne(t){const e=t.split(/\r?\n/),r=[];for(const i of e){if(i.length<=1)continue;const n=i.split(":");if(n.length===2){const[R,M]=n;r.push({message:M.trim(),type:IR(R),lineNum:0,linePos:0});continue}const[l,c,o,...m]=n;let b=parseInt(o,10);isNaN(b)&&(b=0);let A=parseInt(c,10);isNaN(A)&&(A=0),r.push({message:m.join(":").trim(),type:IR(l),lineNum:b,linePos:A})}return r}function IR(t){const e=["warning","error","info"],r=t.toLowerCase();return e.includes(r)?r:"info"}class fne extends tb{device;handle;constructor(e,r){switch(super(e,r),this.device=e,this.props.stage){case"vertex":this.handle=this.props.handle||this.device.gl.createShader(35633);break;case"fragment":this.handle=this.props.handle||this.device.gl.createShader(35632);break;default:throw new Error(this.props.stage)}this._compile(this.source)}destroy(){this.handle&&(this.removeStats(),this.device.gl.deleteShader(this.handle),this.destroyed=!0)}async getCompilationInfo(){return await this._waitForCompilationComplete(),this.getCompilationInfoSync()}getCompilationInfoSync(){const e=this.device.gl.getShaderInfoLog(this.handle);return dne(e)}getTranslatedSource(){return this.device.getExtension("WEBGL_debug_shaders").WEBGL_debug_shaders?.getTranslatedShaderSource(this.handle)}async _compile(e){e=(i=>i.startsWith("#version ")?i:`#version 100
${i}`)(e);const{gl:r}=this.device;if(r.shaderSource(this.handle,e),r.compileShader(this.handle),Pt.level===0){this.compilationStatus="pending";return}if(!this.device.features.has("compilation-status-async-webgl")){if(this._getCompilationStatus(),this.debugShader(),this.compilationStatus==="error")throw new Error(`GLSL compilation errors in ${this.props.stage} shader ${this.props.id}`);return}Pt.once(1,"Shader compilation is asynchronous")(),await this._waitForCompilationComplete(),Pt.info(2,`Shader ${this.id} - async compilation complete: ${this.compilationStatus}`)(),this._getCompilationStatus(),this.debugShader()}async _waitForCompilationComplete(){const e=async i=>await new Promise(n=>setTimeout(n,i));if(!this.device.features.has("compilation-status-async-webgl")){await e(10);return}const{gl:r}=this.device;for(;;){if(r.getShaderParameter(this.handle,37297))return;await e(10)}}_getCompilationStatus(){this.compilationStatus=this.device.gl.getShaderParameter(this.handle,35713)?"success":"error"}}const pne=256,mne=1024,gne=16384,nw=6144,_ne=[1,2,4,8];class yne extends WA{device;glParameters;constructor(e,r){super(e,r),this.device=e,sb(this.device.gl),this.setParameters(this.props.parameters),this.clear()}end(){Sy(this.device.gl)}pushDebugGroup(e){}popDebugGroup(){}insertDebugMarker(e){}setParameters(e={}){const r={...this.glParameters};this.props.framebuffer&&(r.framebuffer=this.props.framebuffer),this.props.depthReadOnly&&(r.depthMask=!this.props.depthReadOnly),r.stencilMask=this.props.stencilReadOnly?0:1,r[35977]=this.props.discard,e.viewport&&(e.viewport.length>=6?(r.viewport=e.viewport.slice(0,4),r.depthRange=[e.viewport[4],e.viewport[5]]):r.viewport=e.viewport),e.scissorRect&&(r.scissorTest=!0,r.scissor=e.scissorRect),e.blendConstant&&(r.blendColor=e.blendConstant),e.stencilReference&&(console.warn("RenderPassParameters.stencilReference not yet implemented in WebGL"),e[2967]=e.stencilReference),e.colorMask&&(r.colorMask=_ne.map(i=>!!(i&e.colorMask))),this.glParameters=r,Bg(this.device.gl,r)}beginOcclusionQuery(e){this.props.occlusionQuerySet?.beginOcclusionQuery()}endOcclusionQuery(){this.props.occlusionQuerySet?.endOcclusionQuery()}clear(){const e={...this.glParameters};let r=0;this.props.clearColor!==!1&&(r|=gne,e.clearColor=this.props.clearColor),this.props.clearDepth!==!1&&(r|=pne,e.clearDepth=this.props.clearDepth),this.props.clearStencil!==!1&&(r|=mne,e.clearStencil=this.props.clearStencil),r!==0&&Id(this.device.gl,e,()=>{this.device.gl.clear(r)})}clearColorBuffer(e=0,r=[0,0,0,0]){Id(this.device.gl,{framebuffer:this.props.framebuffer},()=>{switch(r.constructor){case Int32Array:this.device.gl.clearBufferiv(nw,e,r);break;case Uint32Array:this.device.gl.clearBufferuiv(nw,e,r);break;case Float32Array:default:this.device.gl.clearBufferfv(nw,e,r);break}})}}const vne="Failed to deduce GL constant from typed array";function bne(t){switch(ArrayBuffer.isView(t)?t.constructor:t){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(vne)}}function Z2(t,e){const{clamped:r=!0}=e||{};switch(t){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return r?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}const xne={offset:0,stride:0,type:5126,size:1,divisor:0,normalized:!1,integer:!1},wne={deprecatedProps:{instanced:"divisor",isInstanced:"divisor"}};class ly{offset;stride;type;size;divisor;normalized;integer;buffer;index;static getBytesPerElement(e){return Z2(e.type||5126).BYTES_PER_ELEMENT}static getBytesPerVertex(e){return _i(e.size),Z2(e.type||5126).BYTES_PER_ELEMENT*e.size}static resolve(...e){return new ly(xne,...e)}constructor(...e){e.forEach(r=>this._assign(r)),Object.freeze(this)}toString(){return JSON.stringify(this)}get BYTES_PER_ELEMENT(){return ly.getBytesPerElement(this)}get BYTES_PER_VERTEX(){return ly.getBytesPerVertex(this)}_assign(e={}){return e=mJ("Accessor",e,wne),e.type!==void 0&&(this.type=e.type,(e.type===5124||e.type===5125)&&(this.integer=!0)),e.size!==void 0&&(this.size=e.size),e.offset!==void 0&&(this.offset=e.offset),e.stride!==void 0&&(this.stride=e.stride),e.normalize!==void 0&&(this.normalized=e.normalize),e.normalized!==void 0&&(this.normalized=e.normalized),e.integer!==void 0&&(this.integer=e.integer),e.divisor!==void 0&&(this.divisor=e.divisor),e.buffer!==void 0&&(this.buffer=e.buffer),e.index!==void 0&&(typeof e.index=="boolean"?this.index=e.index?1:0:this.index=e.index),e.instanced!==void 0&&(this.divisor=e.instanced?1:0),e.isInstanced!==void 0&&(this.divisor=e.isInstanced?1:0),this.offset===void 0&&delete this.offset,this.stride===void 0&&delete this.stride,this.type===void 0&&delete this.type,this.size===void 0&&delete this.size,this.divisor===void 0&&delete this.divisor,this.normalized===void 0&&delete this.normalized,this.integer===void 0&&delete this.integer,this.buffer===void 0&&delete this.buffer,this.index===void 0&&delete this.index,this}}function Ene(t){return Ane.includes(t)}const Ane=[35678,35680,35679,35682,36289,36292,36293,36298,36299,36300,36303,36306,36307,36308,36311],VO={5126:[5126,1,"float","f32","float32"],35664:[5126,2,"vec2","vec2<f32>","float32x2"],35665:[5126,3,"vec3","vec3<f32>","float32x3"],35666:[5126,4,"vec4","vec4<f32>","float32x4"],5124:[5124,1,"int","i32","sint32"],35667:[5124,2,"ivec2","vec2<i32>","sint32x2"],35668:[5124,3,"ivec3","vec3<i32>","sint32x3"],35669:[5124,4,"ivec4","vec4<i32>","sint32x4"],5125:[5125,1,"uint","u32","uint32"],36294:[5125,2,"uvec2","vec2<u32>","uint32x2"],36295:[5125,3,"uvec3","vec3<u32>","uint32x3"],36296:[5125,4,"uvec4","vec4<u32>","uint32x4"],35670:[5126,1,"bool","f32","float32"],35671:[5126,2,"bvec2","vec2<f32>","float32x2"],35672:[5126,3,"bvec3","vec3<f32>","float32x3"],35673:[5126,4,"bvec4","vec4<f32>","float32x4"],35674:[5126,8,"mat2","mat2x2<f32>"],35685:[5126,8,"mat2x3","mat2x3<f32>"],35686:[5126,8,"mat2x4","mat2x4<f32>"],35687:[5126,12,"mat3x2","mat3x2<f32>"],35675:[5126,12,"mat3","mat3x3<f32>"],35688:[5126,12,"mat3x4","mat3x4<f32>"],35689:[5126,16,"mat4x2","mat4x2<f32>"],35690:[5126,16,"mat4x3","mat4x3<f32>"],35676:[5126,16,"mat4","mat4x4<f32>"]};function GO(t){const e=VO[t];if(!e)throw new Error("uniform");const[r,i,,n]=e;return{format:n,components:i,glType:r}}function Tne(t){const e=VO[t];if(!e)throw new Error("attribute");const[,r,,i,n]=e;return{attributeType:i,vertexFormat:n,components:r}}function Sne(t,e){const r={attributes:[],bindings:[]};r.attributes=Cne(t,e);const i=Mne(t,e);for(const o of i){const m=o.uniforms.map(b=>({name:b.name,format:b.format,byteOffset:b.byteOffset,byteStride:b.byteStride,arrayLength:b.arrayLength}));r.bindings.push({type:"uniform",name:o.name,location:o.location,visibility:(o.vertex?1:0)&(o.fragment?2:0),minBindingSize:o.byteLength,uniforms:m})}const n=Rne(t,e);let l=0;for(const o of n)if(Ene(o.type)){const{viewDimension:m,sampleType:b}=kne(o.type);r.bindings.push({type:"texture",name:o.name,location:l,viewDimension:m,sampleType:b}),o.textureUnit=l,l+=1}n.length&&(r.uniforms=n);const c=Pne(t,e);return c?.length&&(r.varyings=c),r}function Cne(t,e){const r=[],i=t.getProgramParameter(e,35721);for(let n=0;n<i;n++){const l=t.getActiveAttrib(e,n);if(!l)throw new Error("activeInfo");const{name:c,type:o}=l,m=t.getAttribLocation(e,c);if(m>=0){const{attributeType:b}=Tne(o),A=/instance/i.test(c)?"instance":"vertex";r.push({name:c,location:m,stepMode:A,type:b})}}return r.sort((n,l)=>n.location-l.location),r}function Pne(t,e){const r=[],i=t.getProgramParameter(e,35971);for(let n=0;n<i;n++){const l=t.getTransformFeedbackVarying(e,n);if(!l)throw new Error("activeInfo");const{name:c,type:o,size:m}=l,{glType:b,components:A}=GO(o),R=new ly({type:b,size:m*A}),M={location:n,name:c,accessor:R};r.push(M)}return r.sort((n,l)=>n.location-l.location),r}function Rne(t,e){const r=[],i=t.getProgramParameter(e,35718);for(let n=0;n<i;n++){const l=t.getActiveUniform(e,n);if(!l)throw new Error("activeInfo");const{name:c,size:o,type:m}=l,{name:b,isArray:A}=Bne(c);let R=t.getUniformLocation(e,b);const M={location:R,name:b,size:o,type:m,isArray:A};if(r.push(M),M.size>1)for(let L=0;L<M.size;L++){const G=`${b}[${L}]`;R=t.getUniformLocation(e,G);const V={...M,name:G,location:R};r.push(V)}}return r}function Mne(t,e){const r=(l,c)=>t.getActiveUniformBlockParameter(e,l,c),i=[],n=t.getProgramParameter(e,35382);for(let l=0;l<n;l++){const c={name:t.getActiveUniformBlockName(e,l)||"",location:r(l,35391),byteLength:r(l,35392),vertex:r(l,35396),fragment:r(l,35398),uniformCount:r(l,35394),uniforms:[]},o=r(l,35395)||[],m=t.getActiveUniforms(e,o,35383),b=t.getActiveUniforms(e,o,35384),A=t.getActiveUniforms(e,o,35387),R=t.getActiveUniforms(e,o,35388);for(let M=0;M<c.uniformCount;++M){const L=t.getActiveUniform(e,o[M]);if(!L)throw new Error("activeInfo");c.uniforms.push({name:L.name,format:GO(m[M]).format,type:m[M],arrayLength:b[M],byteOffset:A[M],byteStride:R[M]})}i.push(c)}return i.sort((l,c)=>l.location-c.location),i}const Ine={35678:["2d","float"],35680:["cube","float"],35679:["3d","float"],35682:["3d","depth"],36289:["2d-array","float"],36292:["2d-array","depth"],36293:["cube","float"],36298:["2d","sint"],36299:["3d","sint"],36300:["cube","sint"],36303:["2d-array","uint"],36306:["2d","uint"],36307:["3d","uint"],36308:["cube","uint"],36311:["2d-array","uint"]};function kne(t){const e=Ine[t];if(!e)throw new Error("sampler");const[r,i]=e;return{viewDimension:r,sampleType:i}}function Bne(t){if(t[t.length-1]!=="]")return{name:t,length:1,isArray:!1};const e=/([^[]*)(\[[0-9]+\])?/.exec(t);if(!e||e.length<2)throw new Error(`Failed to parse GLSL uniform name ${t}`);return{name:e[1],length:e[2]?1:0,isArray:!!e[2]}}function Lne(t,e,r,i){const n=t;let l=i;l===!0&&(l=1),l===!1&&(l=0);const c=typeof l=="number"?[l]:l;switch(r){case 35678:case 35680:case 35679:case 35682:case 36289:case 36292:case 36293:case 36298:case 36299:case 36300:case 36303:case 36306:case 36307:case 36308:case 36311:if(typeof i!="number")throw new Error("samplers must be set to integers");return t.uniform1i(e,i);case 5126:return t.uniform1fv(e,c);case 35664:return t.uniform2fv(e,c);case 35665:return t.uniform3fv(e,c);case 35666:return t.uniform4fv(e,c);case 5124:return t.uniform1iv(e,c);case 35667:return t.uniform2iv(e,c);case 35668:return t.uniform3iv(e,c);case 35669:return t.uniform4iv(e,c);case 35670:return t.uniform1iv(e,c);case 35671:return t.uniform2iv(e,c);case 35672:return t.uniform3iv(e,c);case 35673:return t.uniform4iv(e,c);case 5125:return n.uniform1uiv(e,c,1);case 36294:return n.uniform2uiv(e,c,2);case 36295:return n.uniform3uiv(e,c,3);case 36296:return n.uniform4uiv(e,c,4);case 35674:return t.uniformMatrix2fv(e,!1,c);case 35675:return t.uniformMatrix3fv(e,!1,c);case 35676:return t.uniformMatrix4fv(e,!1,c);case 35685:return n.uniformMatrix2x3fv(e,!1,c);case 35686:return n.uniformMatrix2x4fv(e,!1,c);case 35687:return n.uniformMatrix3x2fv(e,!1,c);case 35688:return n.uniformMatrix3x4fv(e,!1,c);case 35689:return n.uniformMatrix4x2fv(e,!1,c);case 35690:return n.uniformMatrix4x3fv(e,!1,c)}throw new Error("Illegal uniform")}function One(t){switch(t){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 3;case"line-loop-webgl":return 2;case"triangle-list":return 4;case"triangle-strip":return 5;case"triangle-fan-webgl":return 6;default:throw new Error(t)}}function Dne(t){switch(t){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 1;case"line-loop-webgl":return 1;case"triangle-list":return 4;case"triangle-strip":return 4;case"triangle-fan-webgl":return 4;default:throw new Error(t)}}const kR=4;class Nne extends ug{device;handle;vs;fs;introspectedLayout;uniforms={};bindings={};varyings=null;_uniformCount=0;_uniformSetters={};constructor(e,r){super(e,r),this.device=e,this.handle=this.props.handle||this.device.gl.createProgram(),this.device.setSpectorMetadata(this.handle,{id:this.props.id}),this.vs=r.vs,this.fs=r.fs;const{varyings:i,bufferMode:n=35981}=r;switch(i&&i.length>0&&(this.varyings=i,this.device.gl.transformFeedbackVaryings(this.handle,i,n)),this._linkShaders(),Pt.time(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.introspectedLayout=Sne(this.device.gl,this.handle),Pt.timeEnd(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.shaderLayout=rJ(this.introspectedLayout,r.shaderLayout),this.props.topology){case"triangle-fan-webgl":case"line-loop-webgl":Pt.warn(`Primitive topology ${this.props.topology} is deprecated and will be removed in v9.1`);break}}destroy(){this.handle&&(this.device.gl.deleteProgram(this.handle),this.destroyed=!0)}setBindings(e,r){for(const[i,n]of Object.entries(e)){const l=this.shaderLayout.bindings.find(c=>c.name===i)||this.shaderLayout.bindings.find(c=>c.name===`${i}Uniforms`);if(!l){const c=this.shaderLayout.bindings.map(o=>`"${o.name}"`).join(", ");r?.disableWarnings||Pt.warn(`Unknown binding "${i}" in render pipeline "${this.id}", expected one of ${c}`)();continue}switch(n||Pt.warn(`Unsetting binding "${i}" in render pipeline "${this.id}"`)(),l.type){case"uniform":if(!(n instanceof Ld)&&!(n.buffer instanceof Ld))throw new Error("buffer value");break;case"texture":if(!(n instanceof $m||n instanceof Sc||n instanceof ay))throw new Error("texture value");break;case"sampler":Pt.warn(`Ignoring sampler ${i}`)();break;default:throw new Error(l.type)}this.bindings[i]=n}}draw(e){const{renderPass:r,parameters:i=this.props.parameters,topology:n=this.props.topology,vertexArray:l,vertexCount:c,instanceCount:o,isInstanced:m=!1,firstVertex:b=0,transformFeedback:A}=e,R=One(n),M=!!l.indexBuffer,L=l.indexBuffer?.glIndexType;if(this.linkStatus!=="success")return Pt.info(2,`RenderPipeline:${this.id}.draw() aborted - waiting for shader linking`)(),!1;if(!this._areTexturesRenderable()||c===0)return Pt.info(2,`RenderPipeline:${this.id}.draw() aborted - textures not yet loaded`)(),!1;if(c===0)return Pt.info(2,`RenderPipeline:${this.id}.draw() aborted - no vertices to draw`)(),!0;this.device.gl.useProgram(this.handle),l.bindBeforeRender(r),A&&A.begin(this.props.topology),this._applyBindings(),this._applyUniforms();const G=r;return Uie(this.device,i,G.glParameters,()=>{M&&m?this.device.gl.drawElementsInstanced(R,c||0,L,b,o||0):M?this.device.gl.drawElements(R,c||0,L,b):m?this.device.gl.drawArraysInstanced(R,b,c||0,o||0):this.device.gl.drawArrays(R,b,c||0),A&&A.end()}),l.unbindAfterRender(r),!0}setUniformsWebGL(e){const{bindings:r}=JA(e);Object.keys(r).forEach(i=>{Pt.warn(`Unsupported value "${JSON.stringify(r[i])}" used in setUniforms() for key ${i}. Use setBindings() instead?`)()}),Object.assign(this.uniforms,e)}async _linkShaders(){const{gl:e}=this.device;if(e.attachShader(this.handle,this.vs.handle),e.attachShader(this.handle,this.fs.handle),Pt.time(kR,`linkProgram for ${this.id}`)(),e.linkProgram(this.handle),Pt.timeEnd(kR,`linkProgram for ${this.id}`)(),Pt.level,!this.device.features.has("compilation-status-async-webgl")){const i=this._getLinkStatus();this._reportLinkStatus(i);return}Pt.once(1,"RenderPipeline linking is asynchronous")(),await this._waitForLinkComplete(),Pt.info(2,`RenderPipeline ${this.id} - async linking complete: ${this.linkStatus}`)();const r=this._getLinkStatus();this._reportLinkStatus(r)}_reportLinkStatus(e){switch(e){case"success":return;default:throw this.vs.compilationStatus==="error"?(this.vs.debugShader(),new Error(`Error during compilation of shader ${this.vs.id}`)):this.fs?.compilationStatus==="error"?(this.fs.debugShader(),new Error(`Error during compilation of shader ${this.fs.id}`)):new Error(`Error during ${e}: ${this.device.gl.getProgramInfoLog(this.handle)}`)}}_getLinkStatus(){const{gl:e}=this.device;return e.getProgramParameter(this.handle,35714)?(e.validateProgram(this.handle),e.getProgramParameter(this.handle,35715)?(this.linkStatus="success","success"):(this.linkStatus="error","validation")):(this.linkStatus="error","linking")}async _waitForLinkComplete(){const e=async i=>await new Promise(n=>setTimeout(n,i));if(!this.device.features.has("compilation-status-async-webgl")){await e(10);return}const{gl:r}=this.device;for(;;){if(r.getProgramParameter(this.handle,37297))return;await e(10)}}_areTexturesRenderable(){let e=!0;for(const[,r]of Object.entries(this.bindings))r instanceof Sc&&(r.update(),e=e&&r.loaded);return e}_applyBindings(){if(this.linkStatus!=="success")return;const{gl:e}=this.device;e.useProgram(this.handle);let r=0,i=0;for(const n of this.shaderLayout.bindings){const l=this.bindings[n.name]||this.bindings[n.name.replace(/Uniforms$/,"")];if(!l)throw new Error(`No value for binding ${n.name} in ${this.id}`);switch(n.type){case"uniform":const{name:c}=n,o=e.getUniformBlockIndex(this.handle,c);if(o===4294967295)throw new Error(`Invalid uniform block name ${c}`);e.uniformBlockBinding(this.handle,i,o),l instanceof Ld?e.bindBufferBase(35345,i,l.handle):e.bindBufferRange(35345,i,l.buffer.handle,l.offset||0,l.size||l.buffer.byteLength-l.offset),i+=1;break;case"texture":if(!(l instanceof $m||l instanceof Sc||l instanceof ay))throw new Error("texture");let m;if(l instanceof $m)m=l.texture;else if(l instanceof Sc)m=l;else if(l instanceof ay&&l.colorAttachments[0]instanceof $m)Pt.warn("Passing framebuffer in texture binding may be deprecated. Use fbo.colorAttachments[0] instead")(),m=l.colorAttachments[0].texture;else throw new Error("No texture");e.activeTexture(33984+r),e.bindTexture(m.target,m.handle),r+=1;break;case"sampler":break;case"storage":case"read-only-storage":throw new Error(`binding type '${n.type}' not supported in WebGL`)}}}_applyUniforms(){for(const e of this.shaderLayout.uniforms||[]){const{name:r,location:i,type:n,textureUnit:l}=e,c=this.uniforms[r]??l;c!==void 0&&Lne(this.device.gl,i,n,c)}}}class Fne extends KA{device;commands=[];constructor(e){super(e,{}),this.device=e}submitCommands(e=this.commands){for(const r of e)switch(r.name){case"copy-buffer-to-buffer":zne(this.device,r.options);break;case"copy-buffer-to-texture":jne(this.device,r.options);break;case"copy-texture-to-buffer":Une(this.device,r.options);break;case"copy-texture-to-texture":Vne(this.device,r.options);break}}}function zne(t,e){const r=e.source,i=e.destination;t.gl.bindBuffer(36662,r.handle),t.gl.bindBuffer(36663,i.handle),t.gl.copyBufferSubData(36662,36663,e.sourceOffset??0,e.destinationOffset??0,e.size),t.gl.bindBuffer(36662,null),t.gl.bindBuffer(36663,null)}function jne(t,e){throw new Error("Not implemented")}function Une(t,e){const{source:r,mipLevel:i=0,aspect:n="all",width:l=e.source.width,height:c=e.source.height,depthOrArrayLayers:o=0,origin:m=[0,0],destination:b,byteOffset:A=0,bytesPerRow:R,rowsPerImage:M}=e;if(n!=="all")throw new Error("not supported");if(i!==0||o!==0||R||M)throw new Error("not implemented");const{framebuffer:L,destroyFramebuffer:G}=HO(r);let V;try{const q=b,J=l||L.width,ie=c||L.height,ee=x1(L.texture.props.format),me=ee.dataFormat,Se=ee.type;t.gl.bindBuffer(35051,q.handle),V=t.gl.bindFramebuffer(36160,L.handle),t.gl.readPixels(m[0],m[1],J,ie,me,Se,A)}finally{t.gl.bindBuffer(35051,null),V!==void 0&&t.gl.bindFramebuffer(36160,V),G&&L.destroy()}}function Vne(t,e){const{source:r,destinationMipLevel:i=0,origin:n=[0,0],destinationOrigin:l=[0,0],destination:c}=e;let{width:o=e.destination.width,height:m=e.destination.height}=e;const{framebuffer:b,destroyFramebuffer:A}=HO(r),[R,M]=n,[L,G,V]=l,q=t.gl.bindFramebuffer(36160,b.handle);let J=null,ie;if(c instanceof Sc)J=c,o=Number.isFinite(o)?o:J.width,m=Number.isFinite(m)?m:J.height,J.bind(0),ie=J.target;else throw new Error("invalid destination");switch(ie){case 3553:case 34067:t.gl.copyTexSubImage2D(ie,i,L,G,R,M,o,m);break;case 35866:case 32879:t.gl.copyTexSubImage3D(ie,i,L,G,V,R,M,o,m);break}J&&J.unbind(),t.gl.bindFramebuffer(36160,q),A&&b.destroy()}function HO(t){if(t instanceof rl){const{width:e,height:r,id:i}=t;return{framebuffer:t.device.createFramebuffer({id:`framebuffer-for-${i}`,width:e,height:r,colorAttachments:[t]}),destroyFramebuffer:!0}}return{framebuffer:t,destroyFramebuffer:!1}}class Gne extends qA{device;commandBuffer;constructor(e,r){super(e,r),this.device=e,this.commandBuffer=new Fne(e)}destroy(){}finish(){this.commandBuffer.submitCommands()}copyBufferToBuffer(e){this.commandBuffer.commands.push({name:"copy-buffer-to-buffer",options:e})}copyBufferToTexture(e){this.commandBuffer.commands.push({name:"copy-buffer-to-texture",options:e})}copyTextureToBuffer(e){this.commandBuffer.commands.push({name:"copy-texture-to-buffer",options:e})}copyTextureToTexture(e){this.commandBuffer.commands.push({name:"copy-texture-to-texture",options:e})}pushDebugGroup(e){}popDebugGroup(){}insertDebugMarker(e){}resolveQuerySet(e,r,i){}}class xT extends ZA{get[Symbol.toStringTag](){return"VertexArray"}device;handle;buffer=null;bufferValue=null;static isConstantAttributeZeroSupported(e){return Jq()==="Chrome"}constructor(e,r){super(e,r),this.device=e,this.handle=this.device.gl.createVertexArray()}destroy(){super.destroy(),this.buffer&&this.buffer?.destroy(),this.handle&&(this.device.gl.deleteVertexArray(this.handle),this.handle=void 0)}setIndexBuffer(e){const r=e;if(r&&r.glTarget!==34963)throw new Error("Use .setBuffer()");this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34963,r?r.handle:null),this.indexBuffer=r,this.device.gl.bindVertexArray(null)}setBuffer(e,r){const i=r;if(i.glTarget===34963)throw new Error("Use .setIndexBuffer()");const{size:n,type:l,stride:c,offset:o,normalized:m,integer:b,divisor:A}=this._getAccessor(e);this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34962,i.handle),b?this.device.gl.vertexAttribIPointer(e,n,l,c,o):this.device.gl.vertexAttribPointer(e,n,l,m,c,o),this.device.gl.bindBuffer(34962,null),this.device.gl.enableVertexAttribArray(e),this.device.gl.vertexAttribDivisor(e,A||0),this.attributes[e]=i,this.device.gl.bindVertexArray(null)}setConstantWebGL(e,r){this._enable(e,!1),this.attributes[e]=r}bindBeforeRender(){this.device.gl.bindVertexArray(this.handle),this._applyConstantAttributes()}unbindAfterRender(){this.device.gl.bindVertexArray(null)}_applyConstantAttributes(){for(let e=0;e<this.maxVertexAttributes;++e){const r=this.attributes[e];ArrayBuffer.isView(r)&&this.device.setConstantAttributeWebGL(e,r)}}_getAccessor(e){const r=this.attributeInfos[e];if(!r)throw new Error(`Unknown attribute location ${e}`);const i=NO(r.bufferDataType);return{size:r.bufferComponents,type:i,stride:r.byteStride,offset:r.byteOffset,normalized:r.normalized,integer:r.integer,divisor:r.stepMode==="instance"?1:0}}_enable(e,r=!0){const i=xT.isConstantAttributeZeroSupported(this.device)||e!==0;(r||i)&&(e=Number(e),this.device.gl.bindVertexArray(this.handle),r?this.device.gl.enableVertexAttribArray(e):this.device.gl.disableVertexAttribArray(e),this.device.gl.bindVertexArray(null))}getConstantBuffer(e,r){const i=Hne(r),n=i.byteLength*e,l=i.length*e;if(this.buffer&&n!==this.buffer.byteLength)throw new Error(`Buffer size is immutable, byte length ${n} !== ${this.buffer.byteLength}.`);let c=!this.buffer;if(this.buffer=this.buffer||this.device.createBuffer({byteLength:n}),c=c||!$ne(i,this.bufferValue),c){const o=oJ(r.constructor,l);aJ({target:o,source:i,start:0,count:l}),this.buffer.write(o),this.bufferValue=r}return this.buffer}}function Hne(t){return Array.isArray(t)?new Float32Array(t):t}function $ne(t,e){if(!t||!e||t.length!==e.length||t.constructor!==e.constructor)return!1;for(let r=0;r<t.length;++r)if(t[r]!==e[r])return!1;return!0}class Wne extends XA{device;gl;handle;layout;buffers={};unusedBuffers={};bindOnUse=!0;_bound=!1;constructor(e,r){super(e,r),this.device=e,this.gl=e.gl,this.handle=this.props.handle||this.gl.createTransformFeedback(),this.layout=this.props.layout,r.buffers&&this.setBuffers(r.buffers),Object.seal(this)}destroy(){this.gl.deleteTransformFeedback(this.handle),super.destroy()}begin(e="point-list"){this.gl.bindTransformFeedback(36386,this.handle),this.bindOnUse&&this._bindBuffers(),this.gl.beginTransformFeedback(Dne(e))}end(){this.gl.endTransformFeedback(),this.bindOnUse&&this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null)}setBuffers(e){this.buffers={},this.unusedBuffers={},this.bind(()=>{for(const r in e)this.setBuffer(r,e[r])})}setBuffer(e,r){const i=this._getVaryingIndex(e),{buffer:n,byteLength:l,byteOffset:c}=this._getBufferRange(r);if(i<0){this.unusedBuffers[e]=n,Pt.warn(`${this.id} unusedBuffers varying buffer ${e}`)();return}this.buffers[i]={buffer:n,byteLength:l,byteOffset:c},this.bindOnUse||this._bindBuffer(i,n,c,l)}getBuffer(e){if(BR(e))return this.buffers[e]||null;const r=this._getVaryingIndex(e);return r>=0?this.buffers[r]:null}bind(e=this.handle){if(typeof e!="function")return this.gl.bindTransformFeedback(36386,e),this;let r;return this._bound?r=e():(this.gl.bindTransformFeedback(36386,this.handle),this._bound=!0,r=e(),this._bound=!1,this.gl.bindTransformFeedback(36386,null)),r}unbind(){this.bind(null)}_getBufferRange(e){if(e instanceof Ld)return{buffer:e,byteOffset:0,byteLength:e.byteLength};const{buffer:r,byteOffset:i=0,byteLength:n=e.buffer.byteLength}=e;return{buffer:r,byteOffset:i,byteLength:n}}_getVaryingIndex(e){if(BR(e))return Number(e);for(const r of this.layout.varyings)if(e===r.name)return r.location;return-1}_bindBuffers(){for(const e in this.buffers){const{buffer:r,byteLength:i,byteOffset:n}=this._getBufferRange(this.buffers[e]);this._bindBuffer(Number(e),r,n,i)}}_unbindBuffers(){for(const e in this.buffers)this.gl.bindBufferBase(35982,Number(e),null)}_bindBuffer(e,r,i=0,n){const l=r&&r.handle;!l||n===void 0?this.gl.bindBufferBase(35982,e,l):this.gl.bindBufferRange(35982,e,l,i,n)}}function BR(t){return typeof t=="number"?Number.isInteger(t):/^\d+$/.test(t)}class qne extends YA{device;handle;target=null;_queryPending=!1;_pollingPromise=null;get[Symbol.toStringTag](){return"Query"}constructor(e,r){if(super(e,r),this.device=e,r.count>1)throw new Error("WebGL QuerySet can only have one value");this.handle=this.device.gl.createQuery(),Object.seal(this)}destroy(){this.device.gl.deleteQuery(this.handle)}beginTimestampQuery(){return this._begin(35007)}endTimestampQuery(){this._end()}beginOcclusionQuery(e){return this._begin(e?.conservative?36202:35887)}endOcclusionQuery(){this._end()}beginTransformFeedbackQuery(){return this._begin(35976)}endTransformFeedbackQuery(){this._end()}async resolveQuery(){return[await this.pollQuery()]}_begin(e){this._queryPending||(this.target=e,this.device.gl.beginQuery(this.target,this.handle))}_end(){this._queryPending||this.target&&(this.device.gl.endQuery(this.target),this.target=null,this._queryPending=!0)}isResultAvailable(){if(!this._queryPending)return!1;const e=this.device.gl.getQueryParameter(this.handle,34919);return e&&(this._queryPending=!1),e}isTimerDisjoint(){return this.device.gl.getParameter(36795)}getResult(){return this.device.gl.getQueryParameter(this.handle,34918)}getTimerMilliseconds(){return this.getResult()/1e6}pollQuery(e=Number.POSITIVE_INFINITY){if(this._pollingPromise)return this._pollingPromise;let r=0;return this._pollingPromise=new Promise((i,n)=>{const l=()=>{this.isResultAvailable()?(i(this.getResult()),this._pollingPromise=null):r++>e?(n("Timed out"),this._pollingPromise=null):requestAnimationFrame(l)};requestAnimationFrame(l)}),this._pollingPromise}}function $O(t){switch(t){case 6406:case 33326:case 6403:return 1;case 33328:case 33319:return 2;case 6407:case 34837:return 3;case 6408:case 34836:return 4;default:return _i(!1),0}}function Kne(t){switch(t){case 5121:return 1;case 33635:case 32819:case 32820:return 2;case 5126:return 4;default:return _i(!1),0}}function Zne(t,e){const{sourceX:r=0,sourceY:i=0,sourceFormat:n=6408,sourceAttachment:l=36064}=e||{};let{target:c=null,sourceWidth:o,sourceHeight:m,sourceType:b}=e||{};const{framebuffer:A,deleteFramebuffer:R}=WO(t);_i(A);const{gl:M,handle:L}=A;o=o||A.width,m=m||A.height;const G=l-36064;b=b||A.colorAttachments[G]?.texture?.type||5121,c=Jne(c,b,n,o,m),b=b||bne(c);const V=M.bindFramebuffer(36160,L);return M.readPixels(r,i,o,m,n,b,c),M.bindFramebuffer(36160,V||null),R&&A.destroy(),c}function Xne(t,e){const{target:r,sourceX:i=0,sourceY:n=0,sourceFormat:l=6408,targetByteOffset:c=0}=e||{};let{sourceWidth:o,sourceHeight:m,sourceType:b}=e||{};const{framebuffer:A,deleteFramebuffer:R}=WO(t);_i(A),o=o||A.width,m=m||A.height;const M=A;b=b||5121;let L=r;if(!L){const V=$O(l),q=Kne(b),J=c+o*m*V*q;L=M.device.createBuffer({byteLength:J})}const G=t.device.createCommandEncoder();return G.copyTextureToBuffer({source:t,width:o,height:m,origin:[i,n],destination:L,byteOffset:c}),G.destroy(),R&&A.destroy(),L}function WO(t){return t instanceof ib?{framebuffer:t,deleteFramebuffer:!1}:{framebuffer:Yne(t),deleteFramebuffer:!0}}function Yne(t,e){const{device:r,width:i,height:n,id:l}=t;return r.createFramebuffer({...e,id:`framebuffer-for-${l}`,width:i,height:n,colorAttachments:[t]})}function Jne(t,e,r,i,n){if(t)return t;e=e||5121;const l=Z2(e,{clamped:!1}),c=$O(r);return new l(i*n*c)}const Qne=256,ese=1024,tse=16384,rse="clear: bad arguments";function ise(t,e){const{framebuffer:r=null,color:i=null,depth:n=null,stencil:l=null}=e||{},c={};r&&(c.framebuffer=r);let o=0;i&&(o|=tse,i!==!0&&(c.clearColor=i)),n&&(o|=Qne,n!==!0&&(c.clearDepth=n)),l&&(o|=ese,n!==!0&&(c.clearStencil=n)),_i(o!==0,rse);const m=t.gl;Id(m,c,()=>{m.clear(o)})}const L_=1;class kd extends cg{static type="webgl";type="webgl";handle;features;limits;info;canvasContext;lost;_resolveContextLost;static isSupported(){return typeof WebGL2RenderingContext<"u"}static attach(e){if(e instanceof kd)return e;if(e?.device instanceof cg)return e.device;if(!nse(e))throw new Error("Invalid WebGL2RenderingContext");return new kd({gl:e})}static async create(e={}){Pt.groupCollapsed(L_,"WebGLDevice created")();const r=[];e.debug&&r.push(one()),e.spector&&r.push(ine()),typeof e.canvas=="string"&&r.push(IL.pageLoaded);const i=await Promise.allSettled(r);for(const c of i)c.status==="rejected"&&Pt.error(`Failed to initialize debug libraries ${c.reason}`)();if(Pt.probe(L_+1,"DOM is loaded")(),e.gl?.device)return Pt.warn("reattaching existing device")(),kd.attach(e.gl);const n=new kd(e),l=`Created ${n.type}${n.debug?" debug":""} context: ${n.info.vendor}, ${n.info.renderer} for canvas: ${n.canvasContext.id}`;return Pt.probe(L_,l)(),Pt.table(L_,n.info)(),Pt.groupEnd(L_)(),n}constructor(e){super({...e,id:e.id||Kd("webgl-device")});const r=e.gl?.device;if(r)throw new Error(`WebGL context already attached to device ${r.id}`);const i=e.gl?.canvas||e.canvas;this.canvasContext=new Qie(this,{...e,canvas:i}),this.lost=new Promise(o=>{this._resolveContextLost=o});let n=e.gl||null;if(n||=yie(this.canvasContext.canvas,{...e,onContextLost:o=>this._resolveContextLost?.({reason:"destroyed",message:"Entered sleep mode, or too many apps or browser tabs are using the GPU."})}),!n)throw new Error("WebGL context creation failed");this.handle=n,this.gl=n,this.gl.device=this,this.gl._version=2,e.spector&&(this.spectorJS=nne({...this.props,canvas:this.handle.canvas})),this.info=vie(this.gl,this._extensions),this.limits=new zie(this.gl),this.features=new Fie(this.gl,this._extensions,this.props.disabledFeatures),this.props.initalizeFeatures&&this.features.initializeFeatures(),this.canvasContext.resize();const{enable:l=!0,copyState:c=!1}=e;OO(this.gl,{enable:l,copyState:c}),e.debug&&(this.gl=ane(this.gl,{...e,throwOnError:!0}),this.debug=!0,Pt.level=Math.max(Pt.level,1),Pt.warn("WebGL debug mode activated. Performance reduced.")())}destroy(){}get isLost(){return this.gl.isContextLost()}getSize(){return[this.gl.drawingBufferWidth,this.gl.drawingBufferHeight]}isTextureFormatSupported(e){return bT(this.gl,e,this._extensions)}isTextureFormatFilterable(e){return Lie(this.gl,e,this._extensions)}isTextureFormatRenderable(e){return Oie(this.gl,e,this._extensions)}createCanvasContext(e){throw new Error("WebGL only supports a single canvas")}createBuffer(e){const r=this._getBufferProps(e);return new Ld(this,r)}_createTexture(e){return new Sc(this,e)}createExternalTexture(e){throw new Error("createExternalTexture() not implemented")}createSampler(e){return new K2(this,e)}createShader(e){return new fne(this,e)}createFramebuffer(e){return new ay(this,e)}createVertexArray(e){return new xT(this,e)}createTransformFeedback(e){return new Wne(this,e)}createQuerySet(e){return new qne(this,e)}createRenderPipeline(e){return new Nne(this,e)}beginRenderPass(e){return new yne(this,e)}createComputePipeline(e){throw new Error("ComputePipeline not supported in WebGL")}beginComputePass(e){throw new Error("ComputePass not supported in WebGL")}renderPass=null;createCommandEncoder(e){return new Gne(this,e)}submit(){this.renderPass?.end(),this.renderPass=null}readPixelsToArrayWebGL(e,r){return Zne(e,r)}readPixelsToBufferWebGL(e,r){return Xne(e,r)}setParametersWebGL(e){Bg(this.gl,e)}getParametersWebGL(e){return LO(this.gl,e)}withParametersWebGL(e,r){return Id(this.gl,e,r)}clearWebGL(e){ise(this,e)}resetWebGL(){Pt.warn("WebGLDevice.resetWebGL is deprecated, use only for debugging")(),hie(this.gl)}gl;debug=!1;_canvasSizeInfo={clientWidth:0,clientHeight:0,devicePixelRatio:1};_extensions={};_polyfilled=!1;spectorJS;loseDevice(){let e=!1;const r=this.getExtension("WEBGL_lose_context").WEBGL_lose_context;return r&&(e=!0,r.loseContext()),this._resolveContextLost?.({reason:"destroyed",message:"Application triggered context loss"}),e}pushState(){sb(this.gl)}popState(){Sy(this.gl)}setSpectorMetadata(e,r){e.__SPECTOR_Metadata=r}getGLKey(e,r){r=r||this.gl2||this.gl;const i=Number(e);for(const n in r)if(r[n]===i)return`GL.${n}`;return String(e)}_constants;setConstantAttributeWebGL(e,r){const i=this.limits.maxVertexAttributes;this._constants=this._constants||new Array(i).fill(null);const n=this._constants[e];switch(n&&lse(n,r)&&Pt.info(1,`setConstantAttributeWebGL(${e}) could have been skipped, value unchanged`)(),this._constants[e]=r,r.constructor){case Float32Array:sse(this,e,r);break;case Int32Array:ose(this,e,r);break;case Uint32Array:ase(this,e,r);break;default:_i(!1)}}getExtension(e){return Ud(this.gl,e,this._extensions),this._extensions}}function nse(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:!!(t&&Number.isFinite(t._version))}function sse(t,e,r){switch(r.length){case 1:t.gl.vertexAttrib1fv(e,r);break;case 2:t.gl.vertexAttrib2fv(e,r);break;case 3:t.gl.vertexAttrib3fv(e,r);break;case 4:t.gl.vertexAttrib4fv(e,r);break;default:_i(!1)}}function ose(t,e,r){t.gl.vertexAttribI4iv(e,r)}function ase(t,e,r){t.gl.vertexAttribI4uiv(e,r)}function lse(t,e){if(!t||!e||t.length!==e.length||t.constructor!==e.constructor)return!1;for(let r=0;r<t.length;++r)if(t[r]!==e[r])return!1;return!0}var LR={exports:{}};/*! Hammer.JS - v2.0.7 - 2016-04-22
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */var OR;function cse(){return OR||(OR=1,(function(t){(function(e,r,i,n){var l=["","webkit","Moz","MS","ms","o"],c=r.createElement("div"),o="function",m=Math.round,b=Math.abs,A=Date.now;function R(ae,he,Pe){return setTimeout(ee(ae,Pe),he)}function M(ae,he,Pe){return Array.isArray(ae)?(L(ae,Pe[he],Pe),!0):!1}function L(ae,he,Pe){var We;if(ae)if(ae.forEach)ae.forEach(he,Pe);else if(ae.length!==n)for(We=0;We<ae.length;)he.call(Pe,ae[We],We,ae),We++;else for(We in ae)ae.hasOwnProperty(We)&&he.call(Pe,ae[We],We,ae)}function G(ae,he,Pe){var We="DEPRECATED METHOD: "+he+`
`+Pe+` AT 
`;return function(){var mt=new Error("get-stack-trace"),Zt=mt&&mt.stack?mt.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",Er=e.console&&(e.console.warn||e.console.log);return Er&&Er.call(e.console,We,Zt),ae.apply(this,arguments)}}var V;typeof Object.assign!="function"?V=function(ae){if(ae===n||ae===null)throw new TypeError("Cannot convert undefined or null to object");for(var he=Object(ae),Pe=1;Pe<arguments.length;Pe++){var We=arguments[Pe];if(We!==n&&We!==null)for(var mt in We)We.hasOwnProperty(mt)&&(he[mt]=We[mt])}return he}:V=Object.assign;var q=G(function(ae,he,Pe){for(var We=Object.keys(he),mt=0;mt<We.length;)(!Pe||Pe&&ae[We[mt]]===n)&&(ae[We[mt]]=he[We[mt]]),mt++;return ae},"extend","Use `assign`."),J=G(function(ae,he){return q(ae,he,!0)},"merge","Use `assign`.");function ie(ae,he,Pe){var We=he.prototype,mt;mt=ae.prototype=Object.create(We),mt.constructor=ae,mt._super=We,Pe&&V(mt,Pe)}function ee(ae,he){return function(){return ae.apply(he,arguments)}}function me(ae,he){return typeof ae==o?ae.apply(he&&he[0]||n,he):ae}function Se(ae,he){return ae===n?he:ae}function Me(ae,he,Pe){L(at(he),function(We){ae.addEventListener(We,Pe,!1)})}function Ve(ae,he,Pe){L(at(he),function(We){ae.removeEventListener(We,Pe,!1)})}function Be(ae,he){for(;ae;){if(ae==he)return!0;ae=ae.parentNode}return!1}function $e(ae,he){return ae.indexOf(he)>-1}function at(ae){return ae.trim().split(/\s+/g)}function _t(ae,he,Pe){if(ae.indexOf&&!Pe)return ae.indexOf(he);for(var We=0;We<ae.length;){if(Pe&&ae[We][Pe]==he||!Pe&&ae[We]===he)return We;We++}return-1}function Nt(ae){return Array.prototype.slice.call(ae,0)}function sr(ae,he,Pe){for(var We=[],mt=[],Zt=0;Zt<ae.length;){var Er=ae[Zt][he];_t(mt,Er)<0&&We.push(ae[Zt]),mt[Zt]=Er,Zt++}return We=We.sort(function(Wr,lr){return Wr[he]>lr[he]}),We}function Ft(ae,he){for(var Pe,We,mt=he[0].toUpperCase()+he.slice(1),Zt=0;Zt<l.length;){if(Pe=l[Zt],We=Pe?Pe+mt:he,We in ae)return We;Zt++}return n}var Ut=1;function Lt(){return Ut++}function At(ae){var he=ae.ownerDocument||ae;return he.defaultView||he.parentWindow||e}var Ke=/mobile|tablet|ip(ad|hone|od)|android/i,ft="ontouchstart"in e,Tt=Ft(e,"PointerEvent")!==n,ze=ft&&Ke.test(navigator.userAgent),ht="touch",Ht="pen",Jt="mouse",Pr="kinect",yr=25,$t=1,pr=2,Qt=4,Nr=8,An=1,wi=2,Zr=4,si=8,Tn=16,zi=wi|Zr,Ln=si|Tn,Ps=zi|Ln,ns=["x","y"],ss=["clientX","clientY"];function vi(ae,he){var Pe=this;this.manager=ae,this.callback=he,this.element=ae.element,this.target=ae.options.inputTarget,this.domHandler=function(We){me(ae.options.enable,[ae])&&Pe.handler(We)},this.init()}vi.prototype={handler:function(){},init:function(){this.evEl&&Me(this.element,this.evEl,this.domHandler),this.evTarget&&Me(this.target,this.evTarget,this.domHandler),this.evWin&&Me(At(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&Ve(this.element,this.evEl,this.domHandler),this.evTarget&&Ve(this.target,this.evTarget,this.domHandler),this.evWin&&Ve(At(this.element),this.evWin,this.domHandler)}};function lo(ae){var he,Pe=ae.options.inputClass;return Pe?he=Pe:Tt?he=ar:ze?he=Tr:ft?he=ki:he=nt,new he(ae,Po)}function Po(ae,he,Pe){var We=Pe.pointers.length,mt=Pe.changedPointers.length,Zt=he&$t&&We-mt===0,Er=he&(Qt|Nr)&&We-mt===0;Pe.isFirst=!!Zt,Pe.isFinal=!!Er,Zt&&(ae.session={}),Pe.eventType=he,ea(ae,Pe),ae.emit("hammer.input",Pe),ae.recognize(Pe),ae.session.prevInput=Pe}function ea(ae,he){var Pe=ae.session,We=he.pointers,mt=We.length;Pe.firstInput||(Pe.firstInput=Gs(he)),mt>1&&!Pe.firstMultiple?Pe.firstMultiple=Gs(he):mt===1&&(Pe.firstMultiple=!1);var Zt=Pe.firstInput,Er=Pe.firstMultiple,Wr=Er?Er.center:Zt.center,lr=he.center=co(We);he.timeStamp=A(),he.deltaTime=he.timeStamp-Zt.timeStamp,he.angle=ce(Wr,lr),he.distance=se(Wr,lr),Ro(Pe,he),he.offsetDirection=ne(he.deltaX,he.deltaY);var Ti=Oe(he.deltaTime,he.deltaX,he.deltaY);he.overallVelocityX=Ti.x,he.overallVelocityY=Ti.y,he.overallVelocity=b(Ti.x)>b(Ti.y)?Ti.x:Ti.y,he.scale=Er?Ce(Er.pointers,We):1,he.rotation=Er?xe(Er.pointers,We):0,he.maxPointers=Pe.prevInput?he.pointers.length>Pe.prevInput.maxPointers?he.pointers.length:Pe.prevInput.maxPointers:he.pointers.length,Mo(Pe,he);var Vi=ae.element;Be(he.srcEvent.target,Vi)&&(Vi=he.srcEvent.target),he.target=Vi}function Ro(ae,he){var Pe=he.center,We=ae.offsetDelta||{},mt=ae.prevDelta||{},Zt=ae.prevInput||{};(he.eventType===$t||Zt.eventType===Qt)&&(mt=ae.prevDelta={x:Zt.deltaX||0,y:Zt.deltaY||0},We=ae.offsetDelta={x:Pe.x,y:Pe.y}),he.deltaX=mt.x+(Pe.x-We.x),he.deltaY=mt.y+(Pe.y-We.y)}function Mo(ae,he){var Pe=ae.lastInterval||he,We=he.timeStamp-Pe.timeStamp,mt,Zt,Er,Wr;if(he.eventType!=Nr&&(We>yr||Pe.velocity===n)){var lr=he.deltaX-Pe.deltaX,Ti=he.deltaY-Pe.deltaY,Vi=Oe(We,lr,Ti);Zt=Vi.x,Er=Vi.y,mt=b(Vi.x)>b(Vi.y)?Vi.x:Vi.y,Wr=ne(lr,Ti),ae.lastInterval=he}else mt=Pe.velocity,Zt=Pe.velocityX,Er=Pe.velocityY,Wr=Pe.direction;he.velocity=mt,he.velocityX=Zt,he.velocityY=Er,he.direction=Wr}function Gs(ae){for(var he=[],Pe=0;Pe<ae.pointers.length;)he[Pe]={clientX:m(ae.pointers[Pe].clientX),clientY:m(ae.pointers[Pe].clientY)},Pe++;return{timeStamp:A(),pointers:he,center:co(he),deltaX:ae.deltaX,deltaY:ae.deltaY}}function co(ae){var he=ae.length;if(he===1)return{x:m(ae[0].clientX),y:m(ae[0].clientY)};for(var Pe=0,We=0,mt=0;mt<he;)Pe+=ae[mt].clientX,We+=ae[mt].clientY,mt++;return{x:m(Pe/he),y:m(We/he)}}function Oe(ae,he,Pe){return{x:he/ae||0,y:Pe/ae||0}}function ne(ae,he){return ae===he?An:b(ae)>=b(he)?ae<0?wi:Zr:he<0?si:Tn}function se(ae,he,Pe){Pe||(Pe=ns);var We=he[Pe[0]]-ae[Pe[0]],mt=he[Pe[1]]-ae[Pe[1]];return Math.sqrt(We*We+mt*mt)}function ce(ae,he,Pe){Pe||(Pe=ns);var We=he[Pe[0]]-ae[Pe[0]],mt=he[Pe[1]]-ae[Pe[1]];return Math.atan2(mt,We)*180/Math.PI}function xe(ae,he){return ce(he[1],he[0],ss)+ce(ae[1],ae[0],ss)}function Ce(ae,he){return se(he[0],he[1],ss)/se(ae[0],ae[1],ss)}var je={mousedown:$t,mousemove:pr,mouseup:Qt},Ye="mousedown",De="mousemove mouseup";function nt(){this.evEl=Ye,this.evWin=De,this.pressed=!1,vi.apply(this,arguments)}ie(nt,vi,{handler:function(ae){var he=je[ae.type];he&$t&&ae.button===0&&(this.pressed=!0),he&pr&&ae.which!==1&&(he=Qt),this.pressed&&(he&Qt&&(this.pressed=!1),this.callback(this.manager,he,{pointers:[ae],changedPointers:[ae],pointerType:Jt,srcEvent:ae}))}});var dt={pointerdown:$t,pointermove:pr,pointerup:Qt,pointercancel:Nr,pointerout:Nr},lt={2:ht,3:Ht,4:Jt,5:Pr},Dt="pointerdown",Ne="pointermove pointerup pointercancel";e.MSPointerEvent&&!e.PointerEvent&&(Dt="MSPointerDown",Ne="MSPointerMove MSPointerUp MSPointerCancel");function ar(){this.evEl=Dt,this.evWin=Ne,vi.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}ie(ar,vi,{handler:function(ae){var he=this.store,Pe=!1,We=ae.type.toLowerCase().replace("ms",""),mt=dt[We],Zt=lt[ae.pointerType]||ae.pointerType,Er=Zt==ht,Wr=_t(he,ae.pointerId,"pointerId");mt&$t&&(ae.button===0||Er)?Wr<0&&(he.push(ae),Wr=he.length-1):mt&(Qt|Nr)&&(Pe=!0),!(Wr<0)&&(he[Wr]=ae,this.callback(this.manager,mt,{pointers:he,changedPointers:[ae],pointerType:Zt,srcEvent:ae}),Pe&&he.splice(Wr,1))}});var Rr={touchstart:$t,touchmove:pr,touchend:Qt,touchcancel:Nr},Wt="touchstart",vr="touchstart touchmove touchend touchcancel";function Xr(){this.evTarget=Wt,this.evWin=vr,this.started=!1,vi.apply(this,arguments)}ie(Xr,vi,{handler:function(ae){var he=Rr[ae.type];if(he===$t&&(this.started=!0),!!this.started){var Pe=Ii.call(this,ae,he);he&(Qt|Nr)&&Pe[0].length-Pe[1].length===0&&(this.started=!1),this.callback(this.manager,he,{pointers:Pe[0],changedPointers:Pe[1],pointerType:ht,srcEvent:ae})}}});function Ii(ae,he){var Pe=Nt(ae.touches),We=Nt(ae.changedTouches);return he&(Qt|Nr)&&(Pe=sr(Pe.concat(We),"identifier")),[Pe,We]}var ji={touchstart:$t,touchmove:pr,touchend:Qt,touchcancel:Nr},fi="touchstart touchmove touchend touchcancel";function Tr(){this.evTarget=fi,this.targetIds={},vi.apply(this,arguments)}ie(Tr,vi,{handler:function(ae){var he=ji[ae.type],Pe=kr.call(this,ae,he);Pe&&this.callback(this.manager,he,{pointers:Pe[0],changedPointers:Pe[1],pointerType:ht,srcEvent:ae})}});function kr(ae,he){var Pe=Nt(ae.touches),We=this.targetIds;if(he&($t|pr)&&Pe.length===1)return We[Pe[0].identifier]=!0,[Pe,Pe];var mt,Zt,Er=Nt(ae.changedTouches),Wr=[],lr=this.target;if(Zt=Pe.filter(function(Ti){return Be(Ti.target,lr)}),he===$t)for(mt=0;mt<Zt.length;)We[Zt[mt].identifier]=!0,mt++;for(mt=0;mt<Er.length;)We[Er[mt].identifier]&&Wr.push(Er[mt]),he&(Qt|Nr)&&delete We[Er[mt].identifier],mt++;if(Wr.length)return[sr(Zt.concat(Wr),"identifier"),Wr]}var Ui=2500,yt=25;function ki(){vi.apply(this,arguments);var ae=ee(this.handler,this);this.touch=new Tr(this.manager,ae),this.mouse=new nt(this.manager,ae),this.primaryTouch=null,this.lastTouches=[]}ie(ki,vi,{handler:function(ae,he,Pe){var We=Pe.pointerType==ht,mt=Pe.pointerType==Jt;if(!(mt&&Pe.sourceCapabilities&&Pe.sourceCapabilities.firesTouchEvents)){if(We)li.call(this,he,Pe);else if(mt&&nl.call(this,Pe))return;this.callback(ae,he,Pe)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function li(ae,he){ae&$t?(this.primaryTouch=he.changedPointers[0].identifier,Hs.call(this,he)):ae&(Qt|Nr)&&Hs.call(this,he)}function Hs(ae){var he=ae.changedPointers[0];if(he.identifier===this.primaryTouch){var Pe={x:he.clientX,y:he.clientY};this.lastTouches.push(Pe);var We=this.lastTouches,mt=function(){var Zt=We.indexOf(Pe);Zt>-1&&We.splice(Zt,1)};setTimeout(mt,Ui)}}function nl(ae){for(var he=ae.srcEvent.clientX,Pe=ae.srcEvent.clientY,We=0;We<this.lastTouches.length;We++){var mt=this.lastTouches[We],Zt=Math.abs(he-mt.x),Er=Math.abs(Pe-mt.y);if(Zt<=yt&&Er<=yt)return!0}return!1}var St=Ft(c.style,"touchAction"),Mr=St!==n,hr="compute",Ki="auto",uo="manipulation",Wn="none",fr="pan-x",Io="pan-y",Rs=sl();function wa(ae,he){this.manager=ae,this.set(he)}wa.prototype={set:function(ae){ae==hr&&(ae=this.compute()),Mr&&this.manager.element.style&&Rs[ae]&&(this.manager.element.style[St]=ae),this.actions=ae.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var ae=[];return L(this.manager.recognizers,function(he){me(he.options.enable,[he])&&(ae=ae.concat(he.getTouchAction()))}),ho(ae.join(" "))},preventDefaults:function(ae){var he=ae.srcEvent,Pe=ae.offsetDirection;if(this.manager.session.prevented){he.preventDefault();return}var We=this.actions,mt=$e(We,Wn)&&!Rs[Wn],Zt=$e(We,Io)&&!Rs[Io],Er=$e(We,fr)&&!Rs[fr];if(mt){var Wr=ae.pointers.length===1,lr=ae.distance<2,Ti=ae.deltaTime<250;if(Wr&&lr&&Ti)return}if(!(Er&&Zt)&&(mt||Zt&&Pe&zi||Er&&Pe&Ln))return this.preventSrc(he)},preventSrc:function(ae){this.manager.session.prevented=!0,ae.preventDefault()}};function ho(ae){if($e(ae,Wn))return Wn;var he=$e(ae,fr),Pe=$e(ae,Io);return he&&Pe?Wn:he||Pe?he?fr:Io:$e(ae,uo)?uo:Ki}function sl(){if(!Mr)return!1;var ae={},he=e.CSS&&e.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(Pe){ae[Pe]=he?e.CSS.supports("touch-action",Pe):!0}),ae}var wr=1,On=2,Bi=4,Fr=8,os=Fr,ko=16,as=32;function Zi(ae){this.options=V({},this.defaults,ae||{}),this.id=Lt(),this.manager=null,this.options.enable=Se(this.options.enable,!0),this.state=wr,this.simultaneous={},this.requireFail=[]}Zi.prototype={defaults:{},set:function(ae){return V(this.options,ae),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(ae){if(M(ae,"recognizeWith",this))return this;var he=this.simultaneous;return ae=Dn(ae,this),he[ae.id]||(he[ae.id]=ae,ae.recognizeWith(this)),this},dropRecognizeWith:function(ae){return M(ae,"dropRecognizeWith",this)?this:(ae=Dn(ae,this),delete this.simultaneous[ae.id],this)},requireFailure:function(ae){if(M(ae,"requireFailure",this))return this;var he=this.requireFail;return ae=Dn(ae,this),_t(he,ae)===-1&&(he.push(ae),ae.requireFailure(this)),this},dropRequireFailure:function(ae){if(M(ae,"dropRequireFailure",this))return this;ae=Dn(ae,this);var he=_t(this.requireFail,ae);return he>-1&&this.requireFail.splice(he,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(ae){return!!this.simultaneous[ae.id]},emit:function(ae){var he=this,Pe=this.state;function We(mt){he.manager.emit(mt,ae)}Pe<Fr&&We(he.options.event+sn(Pe)),We(he.options.event),ae.additionalEvent&&We(ae.additionalEvent),Pe>=Fr&&We(he.options.event+sn(Pe))},tryEmit:function(ae){if(this.canEmit())return this.emit(ae);this.state=as},canEmit:function(){for(var ae=0;ae<this.requireFail.length;){if(!(this.requireFail[ae].state&(as|wr)))return!1;ae++}return!0},recognize:function(ae){var he=V({},ae);if(!me(this.options.enable,[this,he])){this.reset(),this.state=as;return}this.state&(os|ko|as)&&(this.state=wr),this.state=this.process(he),this.state&(On|Bi|Fr|ko)&&this.tryEmit(he)},process:function(ae){},getTouchAction:function(){},reset:function(){}};function sn(ae){return ae&ko?"cancel":ae&Fr?"end":ae&Bi?"move":ae&On?"start":""}function Lc(ae){return ae==Tn?"down":ae==si?"up":ae==wi?"left":ae==Zr?"right":""}function Dn(ae,he){var Pe=he.manager;return Pe?Pe.get(ae):ae}function Ms(){Zi.apply(this,arguments)}ie(Ms,Zi,{defaults:{pointers:1},attrTest:function(ae){var he=this.options.pointers;return he===0||ae.pointers.length===he},process:function(ae){var he=this.state,Pe=ae.eventType,We=he&(On|Bi),mt=this.attrTest(ae);return We&&(Pe&Nr||!mt)?he|ko:We||mt?Pe&Qt?he|Fr:he&On?he|Bi:On:as}});function Bo(){Ms.apply(this,arguments),this.pX=null,this.pY=null}ie(Bo,Ms,{defaults:{event:"pan",threshold:10,pointers:1,direction:Ps},getTouchAction:function(){var ae=this.options.direction,he=[];return ae&zi&&he.push(Io),ae&Ln&&he.push(fr),he},directionTest:function(ae){var he=this.options,Pe=!0,We=ae.distance,mt=ae.direction,Zt=ae.deltaX,Er=ae.deltaY;return mt&he.direction||(he.direction&zi?(mt=Zt===0?An:Zt<0?wi:Zr,Pe=Zt!=this.pX,We=Math.abs(ae.deltaX)):(mt=Er===0?An:Er<0?si:Tn,Pe=Er!=this.pY,We=Math.abs(ae.deltaY))),ae.direction=mt,Pe&&We>he.threshold&&mt&he.direction},attrTest:function(ae){return Ms.prototype.attrTest.call(this,ae)&&(this.state&On||!(this.state&On)&&this.directionTest(ae))},emit:function(ae){this.pX=ae.deltaX,this.pY=ae.deltaY;var he=Lc(ae.direction);he&&(ae.additionalEvent=this.options.event+he),this._super.emit.call(this,ae)}});function Oc(){Ms.apply(this,arguments)}ie(Oc,Ms,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[Wn]},attrTest:function(ae){return this._super.attrTest.call(this,ae)&&(Math.abs(ae.scale-1)>this.options.threshold||this.state&On)},emit:function(ae){if(ae.scale!==1){var he=ae.scale<1?"in":"out";ae.additionalEvent=this.options.event+he}this._super.emit.call(this,ae)}});function ol(){Zi.apply(this,arguments),this._timer=null,this._input=null}ie(ol,Zi,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[Ki]},process:function(ae){var he=this.options,Pe=ae.pointers.length===he.pointers,We=ae.distance<he.threshold,mt=ae.deltaTime>he.time;if(this._input=ae,!We||!Pe||ae.eventType&(Qt|Nr)&&!mt)this.reset();else if(ae.eventType&$t)this.reset(),this._timer=R(function(){this.state=os,this.tryEmit()},he.time,this);else if(ae.eventType&Qt)return os;return as},reset:function(){clearTimeout(this._timer)},emit:function(ae){this.state===os&&(ae&&ae.eventType&Qt?this.manager.emit(this.options.event+"up",ae):(this._input.timeStamp=A(),this.manager.emit(this.options.event,this._input)))}});function al(){Ms.apply(this,arguments)}ie(al,Ms,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[Wn]},attrTest:function(ae){return this._super.attrTest.call(this,ae)&&(Math.abs(ae.rotation)>this.options.threshold||this.state&On)}});function Ea(){Ms.apply(this,arguments)}ie(Ea,Ms,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:zi|Ln,pointers:1},getTouchAction:function(){return Bo.prototype.getTouchAction.call(this)},attrTest:function(ae){var he=this.options.direction,Pe;return he&(zi|Ln)?Pe=ae.overallVelocity:he&zi?Pe=ae.overallVelocityX:he&Ln&&(Pe=ae.overallVelocityY),this._super.attrTest.call(this,ae)&&he&ae.offsetDirection&&ae.distance>this.options.threshold&&ae.maxPointers==this.options.pointers&&b(Pe)>this.options.velocity&&ae.eventType&Qt},emit:function(ae){var he=Lc(ae.offsetDirection);he&&this.manager.emit(this.options.event+he,ae),this.manager.emit(this.options.event,ae)}});function Lo(){Zi.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}ie(Lo,Zi,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[uo]},process:function(ae){var he=this.options,Pe=ae.pointers.length===he.pointers,We=ae.distance<he.threshold,mt=ae.deltaTime<he.time;if(this.reset(),ae.eventType&$t&&this.count===0)return this.failTimeout();if(We&&mt&&Pe){if(ae.eventType!=Qt)return this.failTimeout();var Zt=this.pTime?ae.timeStamp-this.pTime<he.interval:!0,Er=!this.pCenter||se(this.pCenter,ae.center)<he.posThreshold;this.pTime=ae.timeStamp,this.pCenter=ae.center,!Er||!Zt?this.count=1:this.count+=1,this._input=ae;var Wr=this.count%he.taps;if(Wr===0)return this.hasRequireFailures()?(this._timer=R(function(){this.state=os,this.tryEmit()},he.interval,this),On):os}return as},failTimeout:function(){return this._timer=R(function(){this.state=as},this.options.interval,this),as},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==os&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function ls(ae,he){return he=he||{},he.recognizers=Se(he.recognizers,ls.defaults.preset),new Oo(ae,he)}ls.VERSION="2.0.7",ls.defaults={domEvents:!1,touchAction:hr,enable:!0,inputTarget:null,inputClass:null,preset:[[al,{enable:!1}],[Oc,{enable:!1},["rotate"]],[Ea,{direction:zi}],[Bo,{direction:zi},["swipe"]],[Lo],[Lo,{event:"doubletap",taps:2},["tap"]],[ol]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var Lu=1,ll=2;function Oo(ae,he){this.options=V({},ls.defaults,he||{}),this.options.inputTarget=this.options.inputTarget||ae,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=ae,this.input=lo(this),this.touchAction=new wa(this,this.options.touchAction),cl(this,!0),L(this.options.recognizers,function(Pe){var We=this.add(new Pe[0](Pe[1]));Pe[2]&&We.recognizeWith(Pe[2]),Pe[3]&&We.requireFailure(Pe[3])},this)}Oo.prototype={set:function(ae){return V(this.options,ae),ae.touchAction&&this.touchAction.update(),ae.inputTarget&&(this.input.destroy(),this.input.target=ae.inputTarget,this.input.init()),this},stop:function(ae){this.session.stopped=ae?ll:Lu},recognize:function(ae){var he=this.session;if(!he.stopped){this.touchAction.preventDefaults(ae);var Pe,We=this.recognizers,mt=he.curRecognizer;(!mt||mt&&mt.state&os)&&(mt=he.curRecognizer=null);for(var Zt=0;Zt<We.length;)Pe=We[Zt],he.stopped!==ll&&(!mt||Pe==mt||Pe.canRecognizeWith(mt))?Pe.recognize(ae):Pe.reset(),!mt&&Pe.state&(On|Bi|Fr)&&(mt=he.curRecognizer=Pe),Zt++}},get:function(ae){if(ae instanceof Zi)return ae;for(var he=this.recognizers,Pe=0;Pe<he.length;Pe++)if(he[Pe].options.event==ae)return he[Pe];return null},add:function(ae){if(M(ae,"add",this))return this;var he=this.get(ae.options.event);return he&&this.remove(he),this.recognizers.push(ae),ae.manager=this,this.touchAction.update(),ae},remove:function(ae){if(M(ae,"remove",this))return this;if(ae=this.get(ae),ae){var he=this.recognizers,Pe=_t(he,ae);Pe!==-1&&(he.splice(Pe,1),this.touchAction.update())}return this},on:function(ae,he){if(ae!==n&&he!==n){var Pe=this.handlers;return L(at(ae),function(We){Pe[We]=Pe[We]||[],Pe[We].push(he)}),this}},off:function(ae,he){if(ae!==n){var Pe=this.handlers;return L(at(ae),function(We){he?Pe[We]&&Pe[We].splice(_t(Pe[We],he),1):delete Pe[We]}),this}},emit:function(ae,he){this.options.domEvents&&Aa(ae,he);var Pe=this.handlers[ae]&&this.handlers[ae].slice();if(!(!Pe||!Pe.length)){he.type=ae,he.preventDefault=function(){he.srcEvent.preventDefault()};for(var We=0;We<Pe.length;)Pe[We](he),We++}},destroy:function(){this.element&&cl(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function cl(ae,he){var Pe=ae.element;if(Pe.style){var We;L(ae.options.cssProps,function(mt,Zt){We=Ft(Pe.style,Zt),he?(ae.oldCssProps[We]=Pe.style[We],Pe.style[We]=mt):Pe.style[We]=ae.oldCssProps[We]||""}),he||(ae.oldCssProps={})}}function Aa(ae,he){var Pe=r.createEvent("Event");Pe.initEvent(ae,!0,!0),Pe.gesture=he,he.target.dispatchEvent(Pe)}V(ls,{INPUT_START:$t,INPUT_MOVE:pr,INPUT_END:Qt,INPUT_CANCEL:Nr,STATE_POSSIBLE:wr,STATE_BEGAN:On,STATE_CHANGED:Bi,STATE_ENDED:Fr,STATE_RECOGNIZED:os,STATE_CANCELLED:ko,STATE_FAILED:as,DIRECTION_NONE:An,DIRECTION_LEFT:wi,DIRECTION_RIGHT:Zr,DIRECTION_UP:si,DIRECTION_DOWN:Tn,DIRECTION_HORIZONTAL:zi,DIRECTION_VERTICAL:Ln,DIRECTION_ALL:Ps,Manager:Oo,Input:vi,TouchAction:wa,TouchInput:Tr,MouseInput:nt,PointerEventInput:ar,TouchMouseInput:ki,SingleTouchInput:Xr,Recognizer:Zi,AttrRecognizer:Ms,Tap:Lo,Pan:Bo,Swipe:Ea,Pinch:Oc,Rotate:al,Press:ol,on:Me,off:Ve,each:L,merge:J,extend:q,assign:V,inherit:ie,bindFn:ee,prefixed:Ft});var Zd=typeof e<"u"?e:typeof self<"u"?self:{};Zd.Hammer=ls,t.exports?t.exports=ls:e[i]=ls})(window,document,"Hammer")})(LR)),LR.exports}var Ky=cse();const use=ZB(Ky),yu=KB({__proto__:null,default:use},[Ky]),qO=1,KO=2,X2=4,hse={mousedown:qO,mousemove:KO,mouseup:X2};function dse(t,e){for(let r=0;r<t.length;r++)if(e(t[r]))return!0;return!1}function fse(t){const e=t.prototype.handler;t.prototype.handler=function(r){const i=this.store;r.button>0&&r.type==="pointerdown"&&(dse(i,n=>n.pointerId===r.pointerId)||i.push(r)),e.call(this,r)}}function pse(t){t.prototype.handler=function(e){let r=hse[e.type];r&qO&&e.button>=0&&(this.pressed=!0),r&KO&&e.buttons===0&&(r=X2),this.pressed&&(r&X2&&(this.pressed=!1),this.callback(this.manager,r,{pointers:[e],changedPointers:[e],pointerType:"mouse",srcEvent:e}))}}fse(Ky.PointerEventInput);pse(Ky.MouseInput);const mse=Ky.Manager;class ab{constructor(e,r,i){this.element=e,this.callback=r,this.options={enable:!0,...i}}}const gse=yu?[[yu.Pan,{event:"tripan",pointers:3,threshold:0,enable:!1}],[yu.Rotate,{enable:!1}],[yu.Pinch,{enable:!1}],[yu.Swipe,{enable:!1}],[yu.Pan,{threshold:0,enable:!1}],[yu.Press,{enable:!1}],[yu.Tap,{event:"doubletap",taps:2,enable:!1}],[yu.Tap,{event:"anytap",enable:!1}],[yu.Tap,{enable:!1}]]:null,DR={tripan:["rotate","pinch","pan"],rotate:["pinch"],pinch:["pan"],pan:["press","doubletap","anytap","tap"],doubletap:["anytap"],anytap:["tap"]},_se={doubletap:["tap"]},yse={pointerdown:"pointerdown",pointermove:"pointermove",pointerup:"pointerup",touchstart:"pointerdown",touchmove:"pointermove",touchend:"pointerup",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup"},wT={KEY_EVENTS:["keydown","keyup"],MOUSE_EVENTS:["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"],WHEEL_EVENTS:["wheel","mousewheel"]},vse={tap:"tap",anytap:"anytap",doubletap:"doubletap",press:"press",pinch:"pinch",pinchin:"pinch",pinchout:"pinch",pinchstart:"pinch",pinchmove:"pinch",pinchend:"pinch",pinchcancel:"pinch",rotate:"rotate",rotatestart:"rotate",rotatemove:"rotate",rotateend:"rotate",rotatecancel:"rotate",tripan:"tripan",tripanstart:"tripan",tripanmove:"tripan",tripanup:"tripan",tripandown:"tripan",tripanleft:"tripan",tripanright:"tripan",tripanend:"tripan",tripancancel:"tripan",pan:"pan",panstart:"pan",panmove:"pan",panup:"pan",pandown:"pan",panleft:"pan",panright:"pan",panend:"pan",pancancel:"pan",swipe:"swipe",swipeleft:"swipe",swiperight:"swipe",swipeup:"swipe",swipedown:"swipe"},NR={click:"tap",anyclick:"anytap",dblclick:"doubletap",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup",mouseover:"pointerover",mouseout:"pointerout",mouseleave:"pointerleave"},bse=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",Wm=typeof window<"u"?window:global;let Y2=!1;try{const t={get passive(){return Y2=!0,!0}};Wm.addEventListener("test",null,t),Wm.removeEventListener("test",null)}catch{Y2=!1}const xse=bse.indexOf("firefox")!==-1,{WHEEL_EVENTS:wse}=wT,FR="wheel",zR=4.000244140625,Ese=40,Ase=.25;class Tse extends ab{constructor(e,r,i){super(e,r,i),this.handleEvent=n=>{if(!this.options.enable)return;let l=n.deltaY;Wm.WheelEvent&&(xse&&n.deltaMode===Wm.WheelEvent.DOM_DELTA_PIXEL&&(l/=Wm.devicePixelRatio),n.deltaMode===Wm.WheelEvent.DOM_DELTA_LINE&&(l*=Ese)),l!==0&&l%zR===0&&(l=Math.floor(l/zR)),n.shiftKey&&l&&(l=l*Ase),this.callback({type:FR,center:{x:n.clientX,y:n.clientY},delta:-l,srcEvent:n,pointerType:"mouse",target:n.target})},this.events=(this.options.events||[]).concat(wse),this.events.forEach(n=>e.addEventListener(n,this.handleEvent,Y2?{passive:!1}:!1))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,r){e===FR&&(this.options.enable=r)}}const{MOUSE_EVENTS:Sse}=wT,jR="pointermove",UR="pointerover",VR="pointerout",GR="pointerenter",HR="pointerleave";class Cse extends ab{constructor(e,r,i){super(e,r,i),this.handleEvent=l=>{this.handleOverEvent(l),this.handleOutEvent(l),this.handleEnterEvent(l),this.handleLeaveEvent(l),this.handleMoveEvent(l)},this.pressed=!1;const{enable:n}=this.options;this.enableMoveEvent=n,this.enableLeaveEvent=n,this.enableEnterEvent=n,this.enableOutEvent=n,this.enableOverEvent=n,this.events=(this.options.events||[]).concat(Sse),this.events.forEach(l=>e.addEventListener(l,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,r){e===jR&&(this.enableMoveEvent=r),e===UR&&(this.enableOverEvent=r),e===VR&&(this.enableOutEvent=r),e===GR&&(this.enableEnterEvent=r),e===HR&&(this.enableLeaveEvent=r)}handleOverEvent(e){this.enableOverEvent&&e.type==="mouseover"&&this._emit(UR,e)}handleOutEvent(e){this.enableOutEvent&&e.type==="mouseout"&&this._emit(VR,e)}handleEnterEvent(e){this.enableEnterEvent&&e.type==="mouseenter"&&this._emit(GR,e)}handleLeaveEvent(e){this.enableLeaveEvent&&e.type==="mouseleave"&&this._emit(HR,e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":e.buttons===0&&(this.pressed=!1),this.pressed||this._emit(jR,e);break;case"mouseup":this.pressed=!1;break}}_emit(e,r){this.callback({type:e,center:{x:r.clientX,y:r.clientY},srcEvent:r,pointerType:"mouse",target:r.target})}}const{KEY_EVENTS:Pse}=wT,$R="keydown",WR="keyup";class Rse extends ab{constructor(e,r,i){super(e,r,i),this.handleEvent=n=>{const l=n.target||n.srcElement;l.tagName==="INPUT"&&l.type==="text"||l.tagName==="TEXTAREA"||(this.enableDownEvent&&n.type==="keydown"&&this.callback({type:$R,srcEvent:n,key:n.key,target:n.target}),this.enableUpEvent&&n.type==="keyup"&&this.callback({type:WR,srcEvent:n,key:n.key,target:n.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,this.events=(this.options.events||[]).concat(Pse),e.tabIndex=this.options.tabIndex||0,e.style.outline="none",this.events.forEach(n=>e.addEventListener(n,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,r){e===$R&&(this.enableDownEvent=r),e===WR&&(this.enableUpEvent=r)}}const qR="contextmenu";class Mse extends ab{constructor(e,r,i){super(e,r,i),this.handleEvent=n=>{this.options.enable&&this.callback({type:qR,center:{x:n.clientX,y:n.clientY},srcEvent:n,pointerType:"mouse",target:n.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,r){e===qR&&(this.options.enable=r)}}const KR=1,J2=2,ZR=4,Ise={pointerdown:KR,pointermove:J2,pointerup:ZR,mousedown:KR,mousemove:J2,mouseup:ZR},kse=0,Bse=1,Lse=2,Ose=1,Dse=2,Nse=4;function Fse(t){const e=Ise[t.srcEvent.type];if(!e)return null;const{buttons:r,button:i}=t.srcEvent;let n=!1,l=!1,c=!1;return e===J2?(n=!!(r&Ose),l=!!(r&Nse),c=!!(r&Dse)):(n=i===kse,l=i===Bse,c=i===Lse),{leftButton:n,middleButton:l,rightButton:c}}function zse(t,e){const r=t.center;if(!r)return null;const i=e.getBoundingClientRect(),n=i.width/e.offsetWidth||1,l=i.height/e.offsetHeight||1,c={x:(r.x-i.left-e.clientLeft)/n,y:(r.y-i.top-e.clientTop)/l};return{center:r,offsetCenter:c}}const sw={srcElement:"root",priority:0};class jse{constructor(e){this.handleEvent=r=>{if(this.isEmpty())return;const i=this._normalizeEvent(r);let n=r.srcEvent.target;for(;n&&n!==i.rootElement;){if(this._emit(i,n),i.handled)return;n=n.parentNode}this._emit(i,"root")},this.eventManager=e,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,r,i,n=!1,l=!1){const{handlers:c,handlersByElement:o}=this;let m=sw;typeof i=="string"||i&&i.addEventListener?m={...sw,srcElement:i}:i&&(m={...sw,...i});let b=o.get(m.srcElement);b||(b=[],o.set(m.srcElement,b));const A={type:e,handler:r,srcElement:m.srcElement,priority:m.priority};n&&(A.once=!0),l&&(A.passive=!0),c.push(A),this._active=this._active||!A.passive;let R=b.length-1;for(;R>=0&&!(b[R].priority>=A.priority);)R--;b.splice(R+1,0,A)}remove(e,r){const{handlers:i,handlersByElement:n}=this;for(let l=i.length-1;l>=0;l--){const c=i[l];if(c.type===e&&c.handler===r){i.splice(l,1);const o=n.get(c.srcElement);o.splice(o.indexOf(c),1),o.length===0&&n.delete(c.srcElement)}}this._active=i.some(l=>!l.passive)}_emit(e,r){const i=this.handlersByElement.get(r);if(i){let n=!1;const l=()=>{e.handled=!0},c=()=>{e.handled=!0,n=!0},o=[];for(let m=0;m<i.length;m++){const{type:b,handler:A,once:R}=i[m];if(A({...e,type:b,stopPropagation:l,stopImmediatePropagation:c}),R&&o.push(i[m]),n)break}for(let m=0;m<o.length;m++){const{type:b,handler:A}=o[m];this.remove(b,A)}}}_normalizeEvent(e){const r=this.eventManager.getElement();return{...e,...Fse(e),...zse(e,r),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:r}}}const Use={events:null,recognizers:null,recognizerOptions:{},Manager:mse,touchAction:"none",tabIndex:0};class Vse{constructor(e=null,r){this._onBasicInput=n=>{const{srcEvent:l}=n,c=yse[l.type];c&&this.manager.emit(c,n)},this._onOtherEvent=n=>{this.manager.emit(n.type,n)},this.options={...Use,...r},this.events=new Map,this.setElement(e);const{events:i}=this.options;i&&this.on(i)}getElement(){return this.element}setElement(e){if(this.element&&this.destroy(),this.element=e,!e)return;const{options:r}=this,i=r.Manager;this.manager=new i(e,{touchAction:r.touchAction,recognizers:r.recognizers||gse}).on("hammer.input",this._onBasicInput),r.recognizers||Object.keys(DR).forEach(n=>{const l=this.manager.get(n);l&&DR[n].forEach(c=>{l.recognizeWith(c)})});for(const n in r.recognizerOptions){const l=this.manager.get(n);if(l){const c=r.recognizerOptions[n];delete c.enable,l.set(c)}}this.wheelInput=new Tse(e,this._onOtherEvent,{enable:!1}),this.moveInput=new Cse(e,this._onOtherEvent,{enable:!1}),this.keyInput=new Rse(e,this._onOtherEvent,{enable:!1,tabIndex:r.tabIndex}),this.contextmenuInput=new Mse(e,this._onOtherEvent,{enable:!1});for(const[n,l]of this.events)l.isEmpty()||(this._toggleRecognizer(l.recognizerName,!0),this.manager.on(n,l.handleEvent))}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy(),this.wheelInput=null,this.moveInput=null,this.keyInput=null,this.contextmenuInput=null,this.manager=null,this.element=null)}on(e,r,i){this._addEventHandler(e,r,i,!1)}once(e,r,i){this._addEventHandler(e,r,i,!0)}watch(e,r,i){this._addEventHandler(e,r,i,!1,!0)}off(e,r){this._removeEventHandler(e,r)}_toggleRecognizer(e,r){const{manager:i}=this;if(!i)return;const n=i.get(e);if(n&&n.options.enable!==r){n.set({enable:r});const l=_se[e];l&&!this.options.recognizers&&l.forEach(c=>{const o=i.get(c);r?(o.requireFailure(e),n.dropRequireFailure(c)):o.dropRequireFailure(e)})}this.wheelInput.enableEventType(e,r),this.moveInput.enableEventType(e,r),this.keyInput.enableEventType(e,r),this.contextmenuInput.enableEventType(e,r)}_addEventHandler(e,r,i,n,l){if(typeof e!="string"){i=r;for(const A in e)this._addEventHandler(A,e[A],i,n,l);return}const{manager:c,events:o}=this,m=NR[e]||e;let b=o.get(m);b||(b=new jse(this),o.set(m,b),b.recognizerName=vse[m]||m,c&&c.on(m,b.handleEvent)),b.add(e,r,i,n,l),b.isEmpty()||this._toggleRecognizer(b.recognizerName,!0)}_removeEventHandler(e,r){if(typeof e!="string"){for(const c in e)this._removeEventHandler(c,e[c]);return}const{events:i}=this,n=NR[e]||e,l=i.get(n);if(l&&(l.remove(e,r),l.isEmpty())){const{recognizerName:c}=l;let o=!1;for(const m of i.values())if(m.recognizerName===c&&!m.isEmpty()){o=!0;break}o||this._toggleRecognizer(c,!1)}}}function xd(){}const Gse=({isDragging:t})=>t?"grabbing":"grab",ZO={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,parameters:{},parent:null,device:null,deviceProps:{type:"webgl"},gl:null,glOptions:{},canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,widgets:[],onDeviceInitialized:xd,onWebGLInitialized:xd,onResize:xd,onViewStateChange:xd,onInteractionStateChange:xd,onBeforeRender:xd,onAfterRender:xd,onLoad:xd,onError:t=>hi.error(t.message,t.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:Gse,getTooltip:null,debug:!1,drawPickingColors:!1};class Cy{constructor(e){this.width=0,this.height=0,this.userData={},this.device=null,this.canvas=null,this.viewManager=null,this.layerManager=null,this.effectManager=null,this.deckRenderer=null,this.deckPicker=null,this.eventManager=null,this.widgetManager=null,this.tooltip=null,this.animationLoop=null,this.cursorState={isHovering:!1,isDragging:!1},this.stats=new kg({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this._lastPointerDownInfo=null,this._onPointerMove=i=>{const{_pickRequest:n}=this;if(i.type==="pointerleave")n.x=-1,n.y=-1,n.radius=0;else{if(i.leftButton||i.rightButton)return;{const l=i.offsetCenter;if(!l)return;n.x=l.x,n.y=l.y,n.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:n.x,y:n.y}),n.event=i},this._onEvent=i=>{const n=U2[i.type],l=i.offsetCenter;if(!n||!l||!this.layerManager)return;const c=this.layerManager.getLayers(),o=this.deckPicker.getLastPickedObject({x:l.x,y:l.y,layers:c,viewports:this.getViewports(l)},this._lastPointerDownInfo),{layer:m}=o,b=m&&(m[n.handler]||m.props[n.handler]),A=this.props[n.handler];let R=!1;b&&(R=b.call(m,o,i)),R||(A?.(o,i),this.widgetManager.onEvent(o,i))},this._onPointerDown=i=>{const n=i.offsetCenter,l=this._pick("pickObject","pickObject Time",{x:n.x,y:n.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=l.result[0]||l.emptyInfo},this.props={...ZO,...e},e=this.props,e.viewState&&e.initialViewState&&hi.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),this.viewState=this.props.initialViewState,e.device?this.device=e.device:e.gl&&(e.gl instanceof WebGLRenderingContext&&hi.error("WebGL1 context not supported.")(),this.device=kd.attach(e.gl));let r=this.device;r||(Jm.registerDevices([kd]),r=Jm.createDevice({...e.deviceProps,canvas:this._createCanvas(e)})),this.animationLoop=this._createAnimationLoop(r,e),this.setProps(e),e._typedArrayManagerProps&&Ay.setOptions(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){this.animationLoop?.stop(),this.animationLoop?.destroy(),this.animationLoop=null,this._lastPointerDownInfo=null,this.layerManager?.finalize(),this.layerManager=null,this.viewManager?.finalize(),this.viewManager=null,this.effectManager?.finalize(),this.effectManager=null,this.deckRenderer?.finalize(),this.deckRenderer=null,this.deckPicker?.finalize(),this.deckPicker=null,this.eventManager?.destroy(),this.eventManager=null,this.widgetManager?.finalize(),this.widgetManager=null,!this.props.canvas&&!this.props.device&&!this.props.gl&&this.canvas&&(this.canvas.parentElement?.removeChild(this.canvas),this.canvas=null)}setProps(e){this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&hi.removed("onLayerHover","onHover")(),"onLayerClick"in e&&hi.removed("onLayerClick","onClick")(),e.initialViewState&&!Tc(this.props.initialViewState,e.initialViewState,3)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);const r=Object.create(this.props);Object.assign(r,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),this.animationLoop?.setProps(r),this.layerManager&&(this.viewManager.setProps(r),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(r),this.effectManager.setProps(r),this.deckRenderer.setProps(r),this.deckPicker.setProps(r),this.widgetManager.setProps(r)),this.stats.get("setProps Time").timeEnd()}needsRedraw(e={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let r=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);const i=this.viewManager.needsRedraw(e),n=this.layerManager.needsRedraw(e),l=this.effectManager.needsRedraw(e),c=this.deckRenderer.needsRedraw(e);return r=r||i||n||l||c,r}redraw(e){if(!this.layerManager)return;let r=this.needsRedraw({clearRedrawFlags:!0});r=e||r,r&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(r):this._drawLayers(r))}get isInitialized(){return this.viewManager!==null}getViews(){return Ss(this.viewManager),this.viewManager.views}getViewports(e){return Ss(this.viewManager),this.viewManager.getViewports(e)}getCanvas(){return this.canvas}pickObject(e){const r=this._pick("pickObject","pickObject Time",e).result;return r.length?r[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e,r=!1){for(const i in e)this.layerManager.resourceManager.add({resourceId:i,data:e[i],forceUpdate:r})}_removeResources(e){for(const r of e)this.layerManager.resourceManager.remove(r)}_addDefaultEffect(e){this.effectManager.addDefaultEffect(e)}_addDefaultShaderModule(e){this.layerManager.addDefaultShaderModule(e)}_removeDefaultShaderModule(e){this.layerManager?.removeDefaultShaderModule(e)}_pick(e,r,i){Ss(this.deckPicker);const{stats:n}=this;n.get("Pick Count").incrementCount(),n.get(r).timeStart();const l=this.deckPicker[e]({layers:this.layerManager.getLayers(i),views:this.viewManager.getViews(),viewports:this.getViewports(i),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...i});return n.get(r).timeEnd(),l}_createCanvas(e){let r=e.canvas;return typeof r=="string"&&(r=document.getElementById(r),Ss(r)),r||(r=document.createElement("canvas"),r.id=e.id||"deckgl-overlay",(e.parent||document.body).appendChild(r)),Object.assign(r.style,e.style),r}_setCanvasSize(e){if(!this.canvas)return;const{width:r,height:i}=e;if(r||r===0){const n=Number.isFinite(r)?`${r}px`:r;this.canvas.style.width=n}if(i||i===0){const n=Number.isFinite(i)?`${i}px`:i;this.canvas.style.position=e.style?.position||"absolute",this.canvas.style.height=n}}_updateCanvasSize(){const{canvas:e}=this;if(!e)return;const r=e.clientWidth??e.width,i=e.clientHeight??e.height;(r!==this.width||i!==this.height)&&(this.width=r,this.height=i,this.viewManager?.setProps({width:r,height:i}),this.layerManager?.activateViewport(this.getViewports()[0]),this.props.onResize({width:r,height:i}))}_createAnimationLoop(e,r){const{gl:i,onError:n,useDevicePixels:l}=r;return new dre({device:e,useDevicePixels:l,autoResizeDrawingBuffer:!i,autoResizeViewport:!1,onInitialize:c=>this._setDevice(c.device),onRender:this._onRenderFrame.bind(this),onError:n})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){const{views:e}=this.props,r=Array.isArray(e)?e:e?[e]:[new _T({id:"default-view"})];return r.length&&this.props.controller&&(r[0].props.controller=this.props.controller),r}_onContextLost(){const{onError:e}=this.props;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}_pickAndCallback(){const{_pickRequest:e}=this;if(e.event){const{result:r,emptyInfo:i}=this._pick("pickObject","pickObject Time",e);this.cursorState.isHovering=r.length>0;let n=i,l=!1;for(const c of r)n=c,l=c.layer?.onHover(c,e.event)||l;l||(this.props.onHover?.(n,e.event),this.widgetManager.onHover(n,e.event)),e.event=null}}_updateCursor(){const e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}_setDevice(e){if(this.device=e,!this.animationLoop)return;this.canvas||(this.canvas=this.device.canvasContext?.canvas),this.device.setParametersWebGL({blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onDeviceInitialized(this.device),this.device instanceof kd&&this.props.onWebGLInitialized(this.device.gl);const r=new PO;r.play(),this.animationLoop.attachTimeline(r),this.eventManager=new Vse(this.props.parent||this.canvas,{touchAction:this.props.touchAction,recognizerOptions:this.props.eventRecognizerOptions,events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const n in U2)this.eventManager.on(n,this._onEvent);this.viewManager=new Mre({timeline:r,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const i=this.viewManager.getViewports()[0];this.layerManager=new Rre(this.device,{deck:this,stats:this.stats,viewport:i,timeline:r}),this.effectManager=new qre({deck:this,device:this.device}),this.deckRenderer=new Xre(this.device),this.deckPicker=new rie(this.device),this.widgetManager=new sie({deck:this,parentElement:this.canvas?.parentElement}),this.widgetManager.addDefault(new aie),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,r){const{device:i,gl:n}=this.layerManager.context;this.props.onBeforeRender({device:i,gl:n});const l={target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...r};this.deckRenderer?.renderLayers(l),l.pass==="screen"&&this.widgetManager.onRedraw({viewports:l.viewports,layers:l.layers}),this.props.onAfterRender({device:i,gl:n})}_onRenderFrame(){this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),hi.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.layerManager.updateLayers(),this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){const r=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:r},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}_getFrameStats(){const{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();const r=this.animationLoop.stats;e.get("GPU Time").addTime(r.get("GPU Time").lastTiming),e.get("CPU Time").addTime(r.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:e,stats:r}=this;e.fps=r.get("frameRate").getHz(),e.setPropsTime=r.get("setProps Time").time,e.updateAttributesTime=r.get("Update Attributes").time,e.framesRedrawn=r.get("Redraw Count").count,e.pickTime=r.get("pickObject Time").time+r.get("pickMultipleObjects Time").time+r.get("pickObjects Time").time,e.pickCount=r.get("Pick Count").count,e.gpuTime=r.get("GPU Time").time,e.cpuTime=r.get("CPU Time").time,e.gpuTimePerFrame=r.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=r.get("CPU Time").getAverageTime();const i=Jm.stats.get("Memory Usage");e.bufferMemory=i.get("Buffer Memory").count,e.textureMemory=i.get("Texture Memory").count,e.renderbufferMemory=i.get("Renderbuffer Memory").count,e.gpuMemory=i.get("GPU Memory").count}}Cy.defaultProps=ZO;Cy.VERSION=VX;function Hse(t){switch(t){case"float64":return Float64Array;case"uint8":case"unorm8":return Uint8ClampedArray;default:return FL(t)}}const $se=NL;function yv(t,e){return{attribute:t,format:e.size>1?`${e.type}x${e.size}`:e.type,byteOffset:e.offset||0}}function xp(t){return t.stride||t.size*t.bytesPerElement}function Wse(t,e){return t.type===e.type&&t.size===e.size&&xp(t)===xp(e)&&(t.offset||0)===(e.offset||0)}function Q2(t,e){e.offset&&hi.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const r=xp(t),i=e.vertexOffset!==void 0?e.vertexOffset:t.vertexOffset||0,n=e.elementOffset||0,l=i*r+n*t.bytesPerElement+(t.offset||0);return{...e,offset:l,stride:r}}function qse(t,e){const r=Q2(t,e);return{high:r,low:{...r,offset:r.offset+t.size*4}}}class Kse{constructor(e,r,i){this._buffer=null,this.device=e,this.id=r.id||"",this.size=r.size||1;const n=r.logicalType||r.type,l=n==="float64";let{defaultValue:c}=r;c=Number.isFinite(c)?[c]:c||new Array(this.size).fill(0);let o;l?o="float32":!n&&r.isIndexed?o="uint32":o=n||"float32";let m=Hse(n||o);this.doublePrecision=l,l&&r.fp64===!1&&(m=Float32Array),this.value=null,this.settings={...r,defaultType:m,defaultValue:c,logicalType:n,type:o,normalized:o.includes("norm"),size:this.size,bytesPerElement:m.BYTES_PER_ELEMENT},this.state={...i,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1}}get isConstant(){return this.state.constant}get buffer(){return this._buffer}get byteOffset(){const e=this.getAccessor();return e.vertexOffset?e.vertexOffset*xp(e):0}get numInstances(){return this.state.numInstances}set numInstances(e){this.state.numInstances=e}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),Ay.release(this.state.allocatedValue)}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(e=this.id,r=null){const i={};if(this.state.constant){const n=this.value;if(r){const l=Q2(this.getAccessor(),r),c=l.offset/n.BYTES_PER_ELEMENT,o=l.size||this.size;i[e]=n.subarray(c,c+o)}else i[e]=n}else i[e]=this.getBuffer();return this.doublePrecision&&(this.value instanceof Float64Array?i[`${e}64Low`]=i[e]:i[`${e}64Low`]=new Float32Array(this.size)),i}_getBufferLayout(e=this.id,r=null){const i=this.getAccessor(),n=[],l={name:this.id,byteStride:xp(i),attributes:n};if(this.doublePrecision){const c=qse(i,r||{});n.push(yv(e,{...i,...c.high}),yv(`${e}64Low`,{...i,...c.low}))}else if(r){const c=Q2(i,r);n.push(yv(e,{...i,...c}))}else n.push(yv(e,i));return l}setAccessor(e){this.state.bufferAccessor=e}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let e=null;if(this.state.constant&&this.value){const r=Array.from(this.value);e=[r,r]}else{const{value:r,numInstances:i,size:n}=this,l=i*n;if(r&&l&&r.length>=l){const c=new Array(n).fill(1/0),o=new Array(n).fill(-1/0);for(let m=0;m<l;)for(let b=0;b<n;b++){const A=r[m++];A<c[b]&&(c[b]=A),A>o[b]&&(o[b]=A)}e=[c,o]}}return this.state.bounds=e,e}setData(e){const{state:r}=this;let i;ArrayBuffer.isView(e)?i={value:e}:e instanceof rn?i={buffer:e}:i=e;const n={...this.settings,...i};if(ArrayBuffer.isView(i.value)){if(!i.type)if(this.doublePrecision&&i.value instanceof Float64Array)n.type="float32";else{const l=$se(i.value);n.type=n.normalized?l.replace("int","norm"):l}n.bytesPerElement=i.value.BYTES_PER_ELEMENT,n.stride=xp(n)}if(r.bounds=null,i.constant){let l=i.value;if(l=this._normalizeValue(l,[],0),this.settings.normalized&&(l=this.normalizeConstant(l)),!(!r.constant||!this._areValuesEqual(l,this.value)))return!1;r.externalBuffer=null,r.constant=!0,this.value=ArrayBuffer.isView(l)?l:new Float32Array(l)}else if(i.buffer){const l=i.buffer;r.externalBuffer=l,r.constant=!1,this.value=i.value||null}else if(i.value){this._checkExternalBuffer(i);let l=i.value;r.externalBuffer=null,r.constant=!1,this.value=l;let{buffer:c}=this;const o=xp(n),m=(n.vertexOffset||0)*o;if(this.doublePrecision&&l instanceof Float64Array&&(l=Wx(l,n)),this.settings.isIndexed){const A=this.settings.defaultType;l.constructor!==A&&(l=new A(l))}const b=l.byteLength+m+o*2;(!c||c.byteLength<b)&&(c=this._createBuffer(b)),c.write(l,m)}return this.setAccessor(n),!0}updateSubBuffer(e={}){this.state.bounds=null;const r=this.value,{startOffset:i=0,endOffset:n}=e;this.buffer.write(this.doublePrecision&&r instanceof Float64Array?Wx(r,{size:this.size,startIndex:i,endIndex:n}):r.subarray(i,n),i*r.BYTES_PER_ELEMENT+this.byteOffset)}allocate(e,r=!1){const{state:i}=this,n=i.allocatedValue,l=Ay.allocate(n,e+1,{size:this.size,type:this.settings.defaultType,copy:r});this.value=l;const{byteOffset:c}=this;let{buffer:o}=this;return(!o||o.byteLength<l.byteLength+c)&&(o=this._createBuffer(l.byteLength+c),r&&n&&o.write(n instanceof Float64Array?Wx(n,this):n,c)),i.allocatedValue=l,i.constant=!1,i.externalBuffer=null,this.setAccessor(this.settings),!0}_checkExternalBuffer(e){const{value:r}=e;if(!ArrayBuffer.isView(r))throw new Error(`Attribute ${this.id} value is not TypedArray`);const i=this.settings.defaultType;let n=!1;if(this.doublePrecision&&(n=r.BYTES_PER_ELEMENT<4),n)throw new Error(`Attribute ${this.id} does not support ${r.constructor.name}`);!(r instanceof i)&&this.settings.normalized&&!("normalized"in e)&&hi.warn(`Attribute ${this.id} is normalized`)()}normalizeConstant(e){switch(this.settings.type){case"snorm8":return new Float32Array(e).map(r=>(r+128)/255*2-1);case"snorm16":return new Float32Array(e).map(r=>(r+32768)/65535*2-1);case"unorm8":return new Float32Array(e).map(r=>r/255);case"unorm16":return new Float32Array(e).map(r=>r/65535);default:return e}}_normalizeValue(e,r,i){const{defaultValue:n,size:l}=this.settings;if(Number.isFinite(e))return r[i]=e,r;if(!e){let c=l;for(;--c>=0;)r[i+c]=n[c];return r}switch(l){case 4:r[i+3]=Number.isFinite(e[3])?e[3]:n[3];case 3:r[i+2]=Number.isFinite(e[2])?e[2]:n[2];case 2:r[i+1]=Number.isFinite(e[1])?e[1]:n[1];case 1:r[i+0]=Number.isFinite(e[0])?e[0]:n[0];break;default:let c=l;for(;--c>=0;)r[i+c]=Number.isFinite(e[c])?e[c]:n[c]}return r}_areValuesEqual(e,r){if(!e||!r)return!1;const{size:i}=this;for(let n=0;n<i;n++)if(e[n]!==r[n])return!1;return!0}_createBuffer(e){this._buffer&&this._buffer.destroy();const{isIndexed:r,type:i}=this.settings;return this._buffer=this.device.createBuffer({...this._buffer?.props,id:this.id,usage:r?rn.INDEX:rn.VERTEX,indexType:r?i:void 0,byteLength:e}),this._buffer}}const XR=[],YR=[];function XO(t,e=0,r=1/0){let i=XR;const n={index:-1,data:t,target:[]};return t?typeof t[Symbol.iterator]=="function"?i=t:t.length>0&&(YR.length=t.length,i=YR):i=XR,(e>0||Number.isFinite(r))&&(i=(Array.isArray(i)?i:Array.from(i)).slice(e,r),n.index=e-1),{iterable:i,objectInfo:n}}function YO(t){return t&&t[Symbol.asyncIterator]}function Zse(t,e){const{size:r,stride:i,offset:n,startIndices:l,nested:c}=e,o=t.BYTES_PER_ELEMENT,m=i?i/o:r,b=n?n/o:0,A=Math.floor((t.length-b)/m);return(R,{index:M,target:L})=>{if(!l){const J=M*m+b;for(let ie=0;ie<r;ie++)L[ie]=t[J+ie];return L}const G=l[M],V=l[M+1]||A;let q;if(c){q=new Array(V-G);for(let J=G;J<V;J++){const ie=J*m+b;L=new Array(r);for(let ee=0;ee<r;ee++)L[ee]=t[ie+ee];q[J-G]=L}}else if(m===r)q=t.subarray(G*r+b,V*r+b);else{q=new t.constructor((V-G)*r);let J=0;for(let ie=G;ie<V;ie++){const ee=ie*m+b;for(let me=0;me<r;me++)q[J++]=t[ee+me]}}return q}}const Xse=[],$v=[[0,1/0]];function Yse(t,e){if(t===$v||(e[0]<0&&(e[0]=0),e[0]>=e[1]))return t;const r=[],i=t.length;let n=0;for(let l=0;l<i;l++){const c=t[l];c[1]<e[0]?(r.push(c),n=l+1):c[0]>e[1]?r.push(c):e=[Math.min(c[0],e[0]),Math.max(c[1],e[1])]}return r.splice(n,0,e),r}const Jse={interpolation:{duration:0,easing:t=>t},spring:{stiffness:.05,damping:.5}};function JO(t,e){if(!t)return null;Number.isFinite(t)&&(t={type:"interpolation",duration:t});const r=t.type||"interpolation";return{...Jse[r],...e,...t,type:r}}class QO extends Kse{constructor(e,r){super(e,r,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,layoutChanged:!1,updateRanges:$v}),this.constant=!1,this.settings.update=r.update||(r.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:e=!1}={}){const r=this.state.needsRedraw;return this.state.needsRedraw=r&&!e,r}layoutChanged(){return this.state.layoutChanged}setAccessor(e){var r;(r=this.state).layoutChanged||(r.layoutChanged=!Wse(e,this.getAccessor())),super.setAccessor(e)}getUpdateTriggers(){const{accessor:e}=this.settings;return[this.id].concat(typeof e!="function"&&e||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;const{accessor:r}=this.settings,i=this.settings.transition,n=Array.isArray(r)?e[r.find(l=>e[l])]:e[r];return JO(n,i)}setNeedsUpdate(e=this.id,r){if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),r){const{startRow:i=0,endRow:n=1/0}=r;this.state.updateRanges=Yse(this.state.updateRanges,[i,n])}else this.state.updateRanges=$v}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=Xse}setNeedsRedraw(e=this.id){this.state.needsRedraw=this.state.needsRedraw||e}allocate(e){const{state:r,settings:i}=this;return i.noAlloc?!1:i.update?(super.allocate(e,r.updateRanges!==$v),!0):!1}updateBuffer({numInstances:e,data:r,props:i,context:n}){if(!this.needsUpdate())return!1;const{state:{updateRanges:l},settings:{update:c,noAlloc:o}}=this;let m=!0;if(c){for(const[b,A]of l)c.call(n,this,{data:r,startRow:b,endRow:A,props:i,numInstances:e});if(this.value)if(this.constant||!this.buffer||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[b,A]of l){const R=Number.isFinite(b)?this.getVertexOffset(b):0,M=Number.isFinite(A)?this.getVertexOffset(A):o||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:R,endOffset:M})}this._checkAttributeArray()}else m=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),m}setConstantValue(e){return e===void 0||typeof e=="function"?!1:(this.setData({constant:!0,value:e})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(e){const{state:r}=this;return e?(this.clearNeedsUpdate(),r.lastExternalBuffer===e||(r.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(r.lastExternalBuffer=null,!1)}setBinaryValue(e,r=null){const{state:i,settings:n}=this;if(!e)return i.binaryValue=null,i.binaryAccessor=null,!1;if(n.noAlloc)return!1;if(i.binaryValue===e)return this.clearNeedsUpdate(),!0;if(i.binaryValue=e,this.setNeedsRedraw(),n.transform||r!==this.startIndices){ArrayBuffer.isView(e)&&(e={value:e});const l=e;Ss(ArrayBuffer.isView(l.value),`invalid ${n.accessor}`);const c=!!l.size&&l.size!==this.size;return i.binaryAccessor=Zse(l.value,{size:l.size||this.size,stride:l.stride,offset:l.offset,startIndices:r,nested:c}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){const{startIndices:r}=this;return(r?e<r.length?r[e]:this.numInstances:e)*this.size}getValue(){const e=this.settings.shaderAttributes,r=super.getValue();if(!e)return r;for(const i in e)Object.assign(r,super.getValue(i,e[i]));return r}getBufferLayout(e){this.state.layoutChanged=!1;const r=this.settings.shaderAttributes,i=super._getBufferLayout(),{stepMode:n}=this.settings;if(n==="dynamic"?i.stepMode=e?e.isInstanced?"instance":"vertex":"instance":i.stepMode=n??"vertex",!r)return i;for(const l in r){const c=super._getBufferLayout(l,r[l]);i.attributes.push(...c.attributes)}return i}_autoUpdater(e,{data:r,startRow:i,endRow:n,props:l,numInstances:c}){if(e.constant)return;const{settings:o,state:m,value:b,size:A,startIndices:R}=e,{accessor:M,transform:L}=o,G=m.binaryAccessor||(typeof M=="function"?M:l[M]);Ss(typeof G=="function",`accessor "${M}" is not a function`);let V=e.getVertexOffset(i);const{iterable:q,objectInfo:J}=XO(r,i,n);for(const ie of q){J.index++;let ee=G(ie,J);if(L&&(ee=L.call(this,ee)),R){const me=(J.index<R.length-1?R[J.index+1]:c)-R[J.index];if(ee&&Array.isArray(ee[0])){let Se=V;for(const Me of ee)e._normalizeValue(Me,b,Se),Se+=A}else ee&&ee.length>A?b.set(ee,V):(e._normalizeValue(ee,J.target,0),Are({target:b,source:J.target,start:V,count:me}));V+=me*A}else e._normalizeValue(ee,b,V),V+=A}}_validateAttributeUpdaters(){const{settings:e}=this;if(!(e.noAlloc||typeof e.update=="function"))throw new Error(`Attribute ${this.id} missing update or accessor`)}_checkAttributeArray(){const{value:e}=this,r=Math.min(4,this.size);if(e&&e.length>=r){let i=!0;switch(r){case 4:i=i&&Number.isFinite(e[3]);case 3:i=i&&Number.isFinite(e[2]);case 2:i=i&&Number.isFinite(e[1]);case 1:i=i&&Number.isFinite(e[0]);break;default:i=!1}if(!i)throw new Error(`Illegal attribute generated for ${this.id}`)}}}function ow(t){const{source:e,target:r,start:i=0,size:n,getData:l}=t,c=t.end||r.length,o=e.length,m=c-i;if(o>m){r.set(e.subarray(0,m),i);return}if(r.set(e,i),!l)return;let b=o;for(;b<m;){const A=l(b,e);for(let R=0;R<n;R++)r[i+b]=A[R]||0,b++}}function Qse({source:t,target:e,size:r,getData:i,sourceStartIndices:n,targetStartIndices:l}){if(!n||!l)return ow({source:t,target:e,size:r,getData:i}),e;let c=0,o=0;const m=i&&((A,R)=>i(A+o,R)),b=Math.min(n.length,l.length);for(let A=1;A<b;A++){const R=n[A]*r,M=l[A]*r;ow({source:t.subarray(c,R),target:e,start:o,end:M,size:r,getData:m}),c=R,o=M}return o<e.length&&ow({source:[],target:e,start:o,size:r,getData:m}),e}function eoe(t){const{device:e,settings:r,value:i}=t,n=new QO(e,r);return n.setData({value:i instanceof Float64Array?new Float64Array(0):new Float32Array(0),normalized:r.normalized}),n}function eD(t){switch(t){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`No defined attribute type for size "${t}"`)}}function tD(t){switch(t){case 1:return"float32";case 2:return"float32x2";case 3:return"float32x3";case 4:return"float32x4";default:throw new Error("invalid type size")}}function rD(t){t.push(t.shift())}function toe(t,e){const{doublePrecision:r,settings:i,value:n,size:l}=t,c=r&&n instanceof Float64Array?2:1;let o=0;const{shaderAttributes:m}=t.settings;if(m)for(const b of Object.values(m))o=Math.max(o,b.vertexOffset??0);return(i.noAlloc?n.length:(e+o)*l)*c}function iD({device:t,source:e,target:r}){return(!r||r.byteLength<e.byteLength)&&(r?.destroy(),r=t.createBuffer({byteLength:e.byteLength,usage:e.usage})),r}function nD({device:t,buffer:e,attribute:r,fromLength:i,toLength:n,fromStartIndices:l,getData:c=o=>o}){const o=r.doublePrecision&&r.value instanceof Float64Array?2:1,m=r.size*o,b=r.byteOffset,A=r.settings.bytesPerElement<4?b/r.settings.bytesPerElement*4:b,R=r.startIndices,M=l&&R,L=r.isConstant;if(!M&&e&&i>=n)return e;const G=r.value instanceof Float64Array?Float32Array:r.value.constructor,V=L?r.value:new G(r.getBuffer().readSyncWebGL(b,n*G.BYTES_PER_ELEMENT).buffer);if(r.settings.normalized&&!L){const ee=c;c=(me,Se)=>r.normalizeConstant(ee(me,Se))}const q=L?(ee,me)=>c(V,me):(ee,me)=>c(V.subarray(ee+b,ee+b+m),me),J=e?new Float32Array(e.readSyncWebGL(A,i*4).buffer):new Float32Array(0),ie=new Float32Array(n);return Qse({source:J,target:ie,sourceStartIndices:l,targetStartIndices:R,size:m,getData:q}),(!e||e.byteLength<ie.byteLength+A)&&(e?.destroy(),e=t.createBuffer({byteLength:ie.byteLength+A,usage:35050})),e.write(ie,A),e}class sD{constructor({device:e,attribute:r,timeline:i}){this.buffers=[],this.currentLength=0,this.device=e,this.transition=new nb(i),this.attribute=r,this.attributeInTransition=eoe(r),this.currentStartIndices=r.startIndices}get inProgress(){return this.transition.inProgress}start(e,r,i=1/0){this.settings=e,this.currentStartIndices=this.attribute.startIndices,this.currentLength=toe(this.attribute,r),this.transition.start({...e,duration:i})}update(){const e=this.transition.update();return e&&this.onUpdate(),e}setBuffer(e){this.attributeInTransition.setData({buffer:e,normalized:this.attribute.settings.normalized,value:this.attributeInTransition.value})}cancel(){this.transition.cancel()}delete(){this.cancel();for(const e of this.buffers)e.destroy();this.buffers.length=0}}class roe extends sD{constructor({device:e,attribute:r,timeline:i}){super({device:e,attribute:r,timeline:i}),this.type="interpolation",this.transform=soe(e,r)}start(e,r){const i=this.currentLength,n=this.currentStartIndices;if(super.start(e,r,e.duration),e.duration<=0){this.transition.cancel();return}const{buffers:l,attribute:c}=this;rD(l),l[0]=nD({device:this.device,buffer:l[0],attribute:c,fromLength:i,toLength:this.currentLength,fromStartIndices:n,getData:e.enter}),l[1]=iD({device:this.device,source:l[0],target:l[1]}),this.setBuffer(l[1]);const{transform:o}=this,m=o.model;let b=Math.floor(this.currentLength/c.size);oD(c)&&(b/=2),m.setVertexCount(b),c.isConstant?(m.setAttributes({aFrom:l[0]}),m.setConstantAttributes({aTo:c.value})):m.setAttributes({aFrom:l[0],aTo:c.getBuffer()}),o.transformFeedback.setBuffers({vCurrent:l[1]})}onUpdate(){const{duration:e,easing:r}=this.settings,{time:i}=this.transition;let n=i/e;r&&(n=r(n));const{model:l}=this.transform;l.setUniforms({time:n}),this.transform.run({discard:!0})}delete(){super.delete(),this.transform.destroy()}}const ioe=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

uniform float time;
in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, time);
  gl_Position = vec4(0.0);
}
`,noe=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

uniform float time;
in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aFrom64Low;
in ATTRIBUTE_TYPE aTo;
in ATTRIBUTE_TYPE aTo64Low;
out ATTRIBUTE_TYPE vCurrent;
out ATTRIBUTE_TYPE vCurrent64Low;

vec2 mix_fp64(vec2 a, vec2 b, float x) {
  vec2 range = sub_fp64(b, a);
  return sum_fp64(a, mul_fp64(range, vec2(x, 0.0)));
}

void main(void) {
  for (int i=0; i<ATTRIBUTE_SIZE; i++) {
    vec2 value = mix_fp64(vec2(aFrom[i], aFrom64Low[i]), vec2(aTo[i], aTo64Low[i]), time);
    vCurrent[i] = value.x;
    vCurrent64Low[i] = value.y;
  }
  gl_Position = vec4(0.0);
}
`;function oD(t){return t.doublePrecision&&t.value instanceof Float64Array}function soe(t,e){const r=e.size,i=eD(r),n=tD(r),l=e.getBufferLayout();return oD(e)?new Ty(t,{vs:noe,bufferLayout:[{name:"aFrom",byteStride:8*r,attributes:[{attribute:"aFrom",format:n,byteOffset:0},{attribute:"aFrom64Low",format:n,byteOffset:4*r}]},{name:"aTo",byteStride:8*r,attributes:[{attribute:"aTo",format:n,byteOffset:0},{attribute:"aTo64Low",format:n,byteOffset:4*r}]}],modules:[gQ],defines:{ATTRIBUTE_TYPE:i,ATTRIBUTE_SIZE:r},moduleSettings:{},varyings:["vCurrent","vCurrent64Low"],bufferMode:35980,disableWarnings:!0}):new Ty(t,{vs:ioe,bufferLayout:[{name:"aFrom",format:n},{name:"aTo",format:l.attributes[0].format}],defines:{ATTRIBUTE_TYPE:i},varyings:["vCurrent"],disableWarnings:!0})}class ooe extends sD{constructor({device:e,attribute:r,timeline:i}){super({device:e,attribute:r,timeline:i}),this.type="spring",this.texture=uoe(e),this.framebuffer=hoe(e,this.texture),this.transform=coe(e,r)}start(e,r){const i=this.currentLength,n=this.currentStartIndices;super.start(e,r);const{buffers:l,attribute:c}=this;for(let m=0;m<2;m++)l[m]=nD({device:this.device,buffer:l[m],attribute:c,fromLength:i,toLength:this.currentLength,fromStartIndices:n,getData:e.enter});l[2]=iD({device:this.device,source:l[0],target:l[2]}),this.setBuffer(l[1]);const{model:o}=this.transform;o.setVertexCount(Math.floor(this.currentLength/c.size)),c.isConstant?o.setConstantAttributes({aTo:c.value}):o.setAttributes({aTo:c.getBuffer()})}onUpdate(){const{buffers:e,transform:r,framebuffer:i,transition:n}=this,l=this.settings;r.model.setAttributes({aPrev:e[0],aCur:e[1]}),r.transformFeedback.setBuffers({vNext:e[2]}),r.model.setUniforms({stiffness:l.stiffness,damping:l.damping}),r.run({framebuffer:i,discard:!1,parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]}),rD(e),this.setBuffer(e[1]),this.device.readPixelsToArrayWebGL(i)[0]>0||n.end()}delete(){super.delete(),this.transform.destroy(),this.texture.destroy(),this.framebuffer.destroy()}}const aoe=`#version 300 es
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

uniform float stiffness;
uniform float damping;
in ATTRIBUTE_TYPE aPrev;
in ATTRIBUTE_TYPE aCur;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vNext;
out float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE spring = delta * stiffness;
  ATTRIBUTE_TYPE damper = velocity * -1.0 * damping;
  return spring + damper + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,loe=`#version 300 es
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

in float vIsTransitioningFlag;

out vec4 fragColor;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  fragColor = vec4(1.0);
}`;function coe(t,e){const r=eD(e.size),i=tD(e.size);return new Ty(t,{vs:aoe,fs:loe,bufferLayout:[{name:"aPrev",format:i},{name:"aCur",format:i},{name:"aTo",format:e.getBufferLayout().attributes[0].format}],varyings:["vNext"],defines:{ATTRIBUTE_TYPE:r},parameters:{depthCompare:"always",blendColorOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}})}function uoe(t){return t.createTexture({data:new Uint8Array(4),format:"rgba8unorm",mipmaps:!1,width:1,height:1})}function hoe(t,e){return t.createFramebuffer({id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,colorAttachments:[e]})}const doe={interpolation:roe,spring:ooe};class foe{constructor(e,{id:r,timeline:i}){if(!e)throw new Error("AttributeTransitionManager is constructed without device");this.id=r,this.device=e,this.timeline=i,this.transitions={},this.needsRedraw=!1,this.numInstances=1}finalize(){for(const e in this.transitions)this._removeTransition(e)}update({attributes:e,transitions:r,numInstances:i}){this.numInstances=i||1;for(const n in e){const l=e[n],c=l.getTransitionSetting(r);c&&this._updateAttribute(n,l,c)}for(const n in this.transitions){const l=e[n];(!l||!l.getTransitionSetting(r))&&this._removeTransition(n)}}hasAttribute(e){const r=this.transitions[e];return r&&r.inProgress}getAttributes(){const e={};for(const r in this.transitions){const i=this.transitions[r];i.inProgress&&(e[r]=i.attributeInTransition)}return e}run(){if(this.numInstances===0)return!1;for(const r in this.transitions)this.transitions[r].update()&&(this.needsRedraw=!0);const e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].delete(),delete this.transitions[e]}_updateAttribute(e,r,i){const n=this.transitions[e];let l=!n||n.type!==i.type;if(l){n&&this._removeTransition(e);const c=doe[i.type];c?this.transitions[e]=new c({attribute:r,timeline:this.timeline,device:this.device}):(hi.error(`unsupported transition type '${i.type}'`)(),l=!1)}(l||r.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(i,this.numInstances))}}const JR="attributeManager.invalidate",poe="attributeManager.updateStart",moe="attributeManager.updateEnd",goe="attribute.updateStart",_oe="attribute.allocate",yoe="attribute.updateEnd";class voe{constructor(e,{id:r="attribute-manager",stats:i,timeline:n}={}){this.mergeBoundsMemoized=Wy(tre),this.id=r,this.device=e,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=i,this.attributeTransitionManager=new foe(e,{id:`${r}-transitions`,timeline:n}),Object.seal(this)}finalize(){for(const e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(e={clearRedrawFlags:!1}){const r=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,r&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(e){this._add(e)}addInstanced(e){this._add(e,{stepMode:"instance"})}remove(e){for(const r of e)this.attributes[r]!==void 0&&(this.attributes[r].delete(),delete this.attributes[r])}invalidate(e,r){const i=this._invalidateTrigger(e,r);Ao(JR,this,e,i)}invalidateAll(e){for(const r in this.attributes)this.attributes[r].setNeedsUpdate(r,e);Ao(JR,this,"all")}update({data:e,numInstances:r,startIndices:i=null,transitions:n,props:l={},buffers:c={},context:o={}}){let m=!1;Ao(poe,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const b in this.attributes){const A=this.attributes[b],R=A.settings.accessor;A.startIndices=i,A.numInstances=r,l[b]&&hi.removed(`props.${b}`,`data.attributes.${b}`)(),A.setExternalBuffer(c[b])||A.setBinaryValue(typeof R=="string"?c[R]:void 0,e.startIndices)||typeof R=="string"&&!c[R]&&A.setConstantValue(l[R])||A.needsUpdate()&&(m=!0,this._updateAttribute({attribute:A,numInstances:r,data:e,props:l,context:o})),this.needsRedraw=this.needsRedraw||A.needsRedraw()}m&&Ao(moe,this,r),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:r,transitions:n})}updateTransition(){const{attributeTransitionManager:e}=this,r=e.run();return this.needsRedraw=this.needsRedraw||r,r}getAttributes(){return{...this.attributes,...this.attributeTransitionManager.getAttributes()}}getBounds(e){const r=e.map(i=>this.attributes[i]?.getBounds());return this.mergeBoundsMemoized(r)}getChangedAttributes(e={clearChangedFlags:!1}){const{attributes:r,attributeTransitionManager:i}=this,n={...i.getAttributes()};for(const l in r){const c=r[l];c.needsRedraw(e)&&!i.hasAttribute(l)&&(n[l]=c)}return n}getBufferLayouts(e){return Object.values(this.getAttributes()).map(r=>r.getBufferLayout(e))}_add(e,r){for(const i in e){const n=e[i],l={...n,id:i,size:n.isIndexed&&1||n.size||1,...r};this.attributes[i]=new QO(this.device,l)}this._mapUpdateTriggersToAttributes()}_mapUpdateTriggersToAttributes(){const e={};for(const r in this.attributes)this.attributes[r].getUpdateTriggers().forEach(i=>{e[i]||(e[i]=[]),e[i].push(r)});this.updateTriggers=e}_invalidateTrigger(e,r){const{attributes:i,updateTriggers:n}=this,l=n[e];return l&&l.forEach(c=>{const o=i[c];o&&o.setNeedsUpdate(o.id,r)}),l}_updateAttribute(e){const{attribute:r,numInstances:i}=e;if(Ao(goe,r),r.constant){r.setConstantValue(r.value);return}r.allocate(i)&&Ao(_oe,r,i),r.updateBuffer(e)&&(this.needsRedraw=!0,Ao(yoe,r,i))}}class boe extends nb{get value(){return this._value}_onUpdate(){const{time:e,settings:{fromValue:r,toValue:i,duration:n,easing:l}}=this,c=l(e/n);this._value=m1(r,i,c)}}const QR=1e-5;function eM(t,e,r,i,n){const l=e-t,c=(r-e)*n,o=-l*i;return c+o+l+e}function xoe(t,e,r,i,n){if(Array.isArray(r)){const l=[];for(let c=0;c<r.length;c++)l[c]=eM(t[c],e[c],r[c],i,n);return l}return eM(t,e,r,i,n)}function tM(t,e){if(Array.isArray(t)){let r=0;for(let i=0;i<t.length;i++){const n=t[i]-e[i];r+=n*n}return Math.sqrt(r)}return Math.abs(t-e)}class woe extends nb{get value(){return this._currValue}_onUpdate(){const{fromValue:e,toValue:r,damping:i,stiffness:n}=this.settings,{_prevValue:l=e,_currValue:c=e}=this;let o=xoe(l,c,r,i,n);const m=tM(o,r),b=tM(o,c);m<QR&&b<QR&&(o=r,this.end()),this._prevValue=c,this._currValue=o}}const Eoe={interpolation:boe,spring:woe};class Aoe{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,r,i,n){const{transitions:l}=this;if(l.has(e)){const m=l.get(e),{value:b=m.settings.fromValue}=m;r=b,this.remove(e)}if(n=JO(n),!n)return;const c=Eoe[n.type];if(!c){hi.error(`unsupported transition type '${n.type}'`)();return}const o=new c(this.timeline);o.start({...n,fromValue:r,toValue:i}),l.set(e,o)}remove(e){const{transitions:r}=this;r.has(e)&&(r.get(e).cancel(),r.delete(e))}update(){const e={};for(const[r,i]of this.transitions)i.update(),e[r]=i.value,i.inProgress||this.remove(r);return e}clear(){for(const e of this.transitions.keys())this.remove(e)}}function Toe(t){const e=t[Bd];for(const r in e){const i=e[r],{validate:n}=i;if(n&&!n(t[r],i))throw new Error(`Invalid prop ${r}: ${t[r]}`)}}function Soe(t,e){const r=aD({newProps:t,oldProps:e,propTypes:t[Bd],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),i=Poe(t,e);let n=!1;return i||(n=Roe(t,e)),{dataChanged:i,propsChanged:r,updateTriggersChanged:n,extensionsChanged:Moe(t,e),transitionsChanged:Coe(t,e)}}function Coe(t,e){if(!t.transitions)return!1;const r={},i=t[Bd];let n=!1;for(const l in t.transitions){const c=i[l],o=c&&c.type;(o==="number"||o==="color"||o==="array")&&eE(t[l],e[l],c)&&(r[l]=!0,n=!0)}return n?r:!1}function aD({newProps:t,oldProps:e,ignoreProps:r={},propTypes:i={},triggerName:n="props"}){if(e===t)return!1;if(typeof t!="object"||t===null)return`${n} changed shallowly`;if(typeof e!="object"||e===null)return`${n} changed shallowly`;for(const l of Object.keys(t))if(!(l in r)){if(!(l in e))return`${n}.${l} added`;const c=eE(t[l],e[l],i[l]);if(c)return`${n}.${l} ${c}`}for(const l of Object.keys(e))if(!(l in r)){if(!(l in t))return`${n}.${l} dropped`;if(!Object.hasOwnProperty.call(t,l)){const c=eE(t[l],e[l],i[l]);if(c)return`${n}.${l} ${c}`}}return!1}function eE(t,e,r){let i=r&&r.equal;return i&&!i(t,e,r)||!i&&(i=t&&e&&t.equals,i&&!i.call(t,e))?"changed deeply":!i&&e!==t?"changed shallowly":null}function Poe(t,e){if(e===null)return"oldProps is null, initial diff";let r=!1;const{dataComparator:i,_dataDiff:n}=t;return i?i(t.data,e.data)||(r="Data comparator detected a change"):t.data!==e.data&&(r="A new data container was supplied"),r&&n&&(r=n(t.data,e.data)||r),r}function Roe(t,e){if(e===null)return{all:!0};if("all"in t.updateTriggers&&rM(t,e,"all"))return{all:!0};const r={};let i=!1;for(const n in t.updateTriggers)n!=="all"&&rM(t,e,n)&&(r[n]=!0,i=!0);return i?r:!1}function Moe(t,e){if(e===null)return!0;const r=e.extensions,{extensions:i}=t;if(i===r)return!1;if(!r||!i||i.length!==r.length)return!0;for(let n=0;n<i.length;n++)if(!i[n].equals(r[n]))return!0;return!1}function rM(t,e,r){let i=t.updateTriggers[r];i=i??{};let n=e.updateTriggers[r];return n=n??{},aD({oldProps:n,newProps:i,triggerName:r})}const Ioe="count(): argument not an object",koe="count(): argument not a container";function Boe(t){if(!Ooe(t))throw new Error(Ioe);if(typeof t.count=="function")return t.count();if(Number.isFinite(t.size))return t.size;if(Number.isFinite(t.length))return t.length;if(Loe(t))return Object.keys(t).length;throw new Error(koe)}function Loe(t){return t!==null&&typeof t=="object"&&t.constructor===Object}function Ooe(t){return t!==null&&typeof t=="object"}function iM(t,e){if(!e)return t;const r={...t,...e};if("defines"in e&&(r.defines={...t.defines,...e.defines}),"modules"in e&&(r.modules=(t.modules||[]).concat(e.modules),e.modules.some(i=>i.name==="project64"))){const i=r.modules.findIndex(n=>n.name==="project32");i>=0&&r.modules.splice(i,1)}if("inject"in e)if(!t.inject)r.inject=e.inject;else{const i={...t.inject};for(const n in e.inject)i[n]=(i[n]||"")+e.inject[n];r.inject=i}return r}const Doe={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},tE={};function Noe(t,e,r,i){if(r instanceof rl)return r;r.constructor&&r.constructor.name!=="Object"&&(r={data:r});let n=null;r.compressed&&(n={minFilter:"linear",mipmapFilter:r.data.length>1?"nearest":"linear"});const l=e.createTexture({...r,sampler:{...Doe,...n,...i}});return tE[l.id]=t,l}function Foe(t,e){!e||!(e instanceof rl)||tE[e.id]===t&&(e.delete(),delete tE[e.id])}const zoe={boolean:{validate(t,e){return!0},equal(t,e,r){return!!t==!!e}},number:{validate(t,e){return Number.isFinite(t)&&(!("max"in e)||t<=e.max)&&(!("min"in e)||t>=e.min)}},color:{validate(t,e){return e.optional&&!t||rE(t)&&(t.length===3||t.length===4)},equal(t,e,r){return Tc(t,e,1)}},accessor:{validate(t,e){const r=w1(t);return r==="function"||r===w1(e.value)},equal(t,e,r){return typeof e=="function"?!0:Tc(t,e,1)}},array:{validate(t,e){return e.optional&&!t||rE(t)},equal(t,e,r){const{compare:i}=r,n=Number.isInteger(i)?i:i?1:0;return i?Tc(t,e,n):t===e}},object:{equal(t,e,r){if(r.ignore)return!0;const{compare:i}=r,n=Number.isInteger(i)?i:i?1:0;return i?Tc(t,e,n):t===e}},function:{validate(t,e){return e.optional&&!t||typeof t=="function"},equal(t,e,r){return!r.compare&&r.ignore!==!1||t===e}},data:{transform:(t,e,r)=>{if(!t)return t;const{dataTransform:i}=r.props;return i?i(t):typeof t.shape=="string"&&t.shape.endsWith("-table")&&Array.isArray(t.data)?t.data:t}},image:{transform:(t,e,r)=>{const i=r.context;return!i||!i.device?null:Noe(r.id,i.device,t,{...e.parameters,...r.props.textureParameters})},release:(t,e,r)=>{Foe(r.id,t)}}};function joe(t){const e={},r={},i={};for(const[n,l]of Object.entries(t)){const c=l?.deprecatedFor;if(c)i[n]=Array.isArray(c)?c:[c];else{const o=Uoe(n,l);e[n]=o,r[n]=o.value}}return{propTypes:e,defaultProps:r,deprecatedProps:i}}function Uoe(t,e){switch(w1(e)){case"object":return O_(t,e);case"array":return O_(t,{type:"array",value:e,compare:!1});case"boolean":return O_(t,{type:"boolean",value:e});case"number":return O_(t,{type:"number",value:e});case"function":return O_(t,{type:"function",value:e,compare:!0});default:return{name:t,type:"unknown",value:e}}}function O_(t,e){return"type"in e?{name:t,...zoe[e.type],...e}:"value"in e?{name:t,type:w1(e.value),...e}:{name:t,type:"object",value:e}}function rE(t){return Array.isArray(t)||ArrayBuffer.isView(t)}function w1(t){return rE(t)?"array":t===null?"null":typeof t}function Voe(t,e){let r;for(let l=e.length-1;l>=0;l--){const c=e[l];"extensions"in c&&(r=c.extensions)}const i=iE(t.constructor,r),n=Object.create(i);n[b1]=t,n[Ip]={},n[Md]={};for(let l=0;l<e.length;++l){const c=e[l];for(const o in c)n[o]=c[o]}return Object.freeze(n),n}const Goe="_mergedDefaultProps";function iE(t,e){if(!(t instanceof lb.constructor))return{};let r=Goe;if(e)for(const n of e){const l=n.constructor;l&&(r+=`:${l.extensionName||l.name}`)}return lD(t,r)||(t[r]=Hoe(t,e||[]))}function Hoe(t,e){if(!t.prototype)return null;const r=Object.getPrototypeOf(t),i=iE(r),n=lD(t,"defaultProps")||{},l=joe(n),c=Object.assign(Object.create(null),i,l.defaultProps),o=Object.assign(Object.create(null),i?.[Bd],l.propTypes),m=Object.assign(Object.create(null),i?.[Zx],l.deprecatedProps);for(const b of e){const A=iE(b.constructor);A&&(Object.assign(c,A),Object.assign(o,A[Bd]),Object.assign(m,A[Zx]))}return $oe(c,t),qoe(c,o),Woe(c,m),c[Bd]=o,c[Zx]=m,e.length===0&&!ET(t,"_propTypes")&&(t._propTypes=o),c}function $oe(t,e){const r=Zoe(e);Object.defineProperties(t,{id:{writable:!0,value:r}})}function Woe(t,e){for(const r in e)Object.defineProperty(t,r,{enumerable:!1,set(i){const n=`${this.id}: ${r}`;for(const l of e[r])ET(this,l)||(this[l]=i);hi.deprecated(n,e[r].join("/"))()}})}function qoe(t,e){const r={},i={};for(const n in e){const l=e[n],{name:c,value:o}=l;l.async&&(r[c]=o,i[c]=Koe(c))}t[ig]=r,t[Ip]={},Object.defineProperties(t,i)}function Koe(t){return{enumerable:!0,set(e){typeof e=="string"||e instanceof Promise||YO(e)?this[Ip][t]=e:this[Md][t]=e},get(){if(this[Md]){if(t in this[Md])return this[Md][t]||this[ig][t];if(t in this[Ip]){const e=this[b1]&&this[b1].internalState;if(e&&e.hasAsyncProp(t))return e.getAsyncProp(t)||this[ig][t]}}return this[ig][t]}}}function ET(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function lD(t,e){return ET(t,e)&&t[e]}function Zoe(t){const e=t.componentName;return e||hi.warn(`${t.name}.componentName not specified`)(),e||t.name}let Xoe=0;class lb{constructor(...e){this.props=Voe(this,e),this.id=this.props.id,this.count=Xoe++}clone(e){const{props:r}=this,i={};for(const n in r[ig])n in r[Md]?i[n]=r[Md][n]:n in r[Ip]&&(i[n]=r[Ip][n]);return new this.constructor({...r,...i,...e})}}lb.componentName="Component";lb.defaultProps={};const Yoe=Object.freeze({});class Joe{constructor(e){this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const e in this.asyncProps){const r=this.asyncProps[e];r&&r.type&&r.type.release&&r.type.release(r.resolvedValue,r.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||Yoe}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){const r=this.asyncProps[e];return r&&r.resolvedValue}isAsyncPropLoading(e){if(e){const r=this.asyncProps[e];return!!(r&&r.pendingLoadCount>0&&r.pendingLoadCount!==r.resolvedLoadCount)}for(const r in this.asyncProps)if(this.isAsyncPropLoading(r))return!0;return!1}reloadAsyncProp(e,r){this._watchPromise(e,Promise.resolve(r))}setAsyncProps(e){this.component=e[b1]||this.component;const r=e[Md]||{},i=e[Ip]||e,n=e[ig]||{};for(const l in r){const c=r[l];this._createAsyncPropData(l,n[l]),this._updateAsyncProp(l,c),r[l]=this.getAsyncProp(l)}for(const l in i){const c=i[l];this._createAsyncPropData(l,n[l]),this._updateAsyncProp(l,c)}}_fetch(e,r){return null}_onResolve(e,r){}_onError(e,r){}_updateAsyncProp(e,r){if(this._didAsyncInputValueChange(e,r)){if(typeof r=="string"&&(r=this._fetch(e,r)),r instanceof Promise){this._watchPromise(e,r);return}if(YO(r)){this._resolveAsyncIterable(e,r);return}this._setPropValue(e,r)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}_didAsyncInputValueChange(e,r){const i=this.asyncProps[e];return r===i.resolvedValue||r===i.lastValue?!1:(i.lastValue=r,!0)}_setPropValue(e,r){this._freezeAsyncOldProps();const i=this.asyncProps[e];i&&(r=this._postProcessValue(i,r),i.resolvedValue=r,i.pendingLoadCount++,i.resolvedLoadCount=i.pendingLoadCount)}_setAsyncPropValue(e,r,i){const n=this.asyncProps[e];n&&i>=n.resolvedLoadCount&&r!==void 0&&(this._freezeAsyncOldProps(),n.resolvedValue=r,n.resolvedLoadCount=i,this.onAsyncPropUpdated(e,r))}_watchPromise(e,r){const i=this.asyncProps[e];if(i){i.pendingLoadCount++;const n=i.pendingLoadCount;r.then(l=>{this.component&&(l=this._postProcessValue(i,l),this._setAsyncPropValue(e,l,n),this._onResolve(e,l))}).catch(l=>{this._onError(e,l)})}}async _resolveAsyncIterable(e,r){if(e!=="data"){this._setPropValue(e,r);return}const i=this.asyncProps[e];if(!i)return;i.pendingLoadCount++;const n=i.pendingLoadCount;let l=[],c=0;for await(const o of r){if(!this.component)return;const{dataTransform:m}=this.component.props;m?l=m(o,l):l=l.concat(o),Object.defineProperty(l,"__diff",{enumerable:!1,value:[{startRow:c,endRow:l.length}]}),c=l.length,this._setAsyncPropValue(e,l,n)}this._onResolve(e,l)}_postProcessValue(e,r){const i=e.type;return i&&this.component&&(i.release&&i.release(e.resolvedValue,i,this.component),i.transform)?i.transform(r,i,this.component):r}_createAsyncPropData(e,r){if(!this.asyncProps[e]){const i=this.component&&this.component.props[Bd];this.asyncProps[e]={type:i&&i[e],lastValue:null,resolvedValue:r,pendingLoadCount:0,resolvedLoadCount:0}}}}class Qoe extends Joe{constructor({attributeManager:e,layer:r}){super(r),this.attributeManager=e,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(e,r){const i=this.layer,n=i?.props.fetch;return n?n(r,{propName:e,layer:i}):super._fetch(e,r)}_onResolve(e,r){const i=this.layer;if(i){const n=i.props.onDataLoad;e==="data"&&n&&n(r,{propName:e,layer:i})}}_onError(e,r){const i=this.layer;i&&i.raiseError(r,`loading ${e} of ${this.layer}`)}}const eae="layer.changeFlag",tae="layer.initialize",rae="layer.update",iae="layer.finalize",nae="layer.matched",nM=2**24-1,sae=Object.freeze([]),oae=Wy(({oldViewport:t,viewport:e})=>t.equals(e));let vu=new Uint8ClampedArray(0);const aae={data:{type:"data",value:sae,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:t=>t&&t.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(t,{propName:e,layer:r,loaders:i,loadOptions:n,signal:l})=>{const{resourceManager:c}=r.context;n=n||r.getLoadOptions(),i=i||r.props.loaders,l&&(n={...n,fetch:{...n?.fetch,signal:l}});let o=c.contains(t);return!o&&!n&&(c.add({resourceId:t,data:Fd(t,i),persistent:!1}),o=!0),o?c.subscribe({resourceId:t,onChange:m=>r.internalState?.reloadAsyncProp(e,m),consumerId:r.id,requestId:e}):Fd(t,i,n)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:Qr.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:({layerIndex:t})=>[0,-t*100]},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class Lg extends lb{constructor(){super(...arguments),this.internalState=null,this.lifecycle=Lm.NO_STATE,this.parent=null}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let e=this;for(;e.parent;)e=e.parent;return e}toString(){return`${this.constructor.layerName||this.constructor.name}({id: '${this.props.id}'})`}project(e){Ss(this.internalState);const r=this.internalState.viewport||this.context.viewport,i=CO(e,{viewport:r,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[n,l,c]=AO(i,r.pixelProjectionMatrix);return e.length===2?[n,l]:[n,l,c]}unproject(e){return Ss(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(e)}projectPosition(e,r){Ss(this.internalState);const i=this.internalState.viewport||this.context.viewport;return are(e,{viewport:i,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...r})}get isComposite(){return!1}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){const e=this.state;return e&&(e.models||e.model&&[e.model])||[]}setModuleParameters(e){for(const r of this.getModels())r.updateModuleSettings(e)}setShaderModuleProps(...e){for(const r of this.getModels())r.shaderInputs.setProps(...e)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:e}=this.props;return e===Qr.DEFAULT||e===Qr.LNGLAT||e===Qr.CARTESIAN}onHover(e,r){return this.props.onHover&&this.props.onHover(e,r)||!1}onClick(e,r){return this.props.onClick&&this.props.onClick(e,r)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(e,r=[]){return r[0]=e+1&255,r[1]=e+1>>8&255,r[2]=e+1>>8>>8&255,r}decodePickingColor(e){Ss(e instanceof Uint8Array);const[r,i,n]=e;return r+i*256+n*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:Boe(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){return this.getAttributeManager()?.getBounds(["positions","instancePositions"])}getShaders(e){e=iM(e,{disableWarnings:!0,modules:this.context.defaultShaderModules});for(const r of this.props.extensions)e=iM(e,r.getShaders.call(this,r));return e}shouldUpdateState(e){return e.changeFlags.propsOrDataChanged}updateState(e){const r=this.getAttributeManager(),{dataChanged:i}=e.changeFlags;if(i&&r)if(Array.isArray(i))for(const n of i)r.invalidateAll(n);else r.invalidateAll();if(r){const{props:n}=e,l=this.internalState.hasPickingBuffer,c=Number.isInteger(n.highlightedObjectIndex)||n.pickable||n.extensions.some(o=>o.getNeedsPickingBuffer.call(this,o));if(l!==c){this.internalState.hasPickingBuffer=c;const{pickingColors:o,instancePickingColors:m}=r.attributes,b=o||m;b&&(c&&b.constant&&(b.constant=!1,r.invalidate(b.id)),!b.value&&!c&&(b.constant=!0,b.value=[0,0,0]))}}}finalizeState(e){for(const i of this.getModels())i.destroy();const r=this.getAttributeManager();r&&r.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(e){for(const r of this.getModels())r.draw(e)}getPickingInfo({info:e,mode:r,sourceLayer:i}){const{index:n}=e;return n>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[n]),e}raiseError(e,r){r&&(e=new Error(`${r}: ${e.message}`,{cause:e})),this.props.onError?.(e)||this.context?.onError?.(e,this)}getNeedsRedraw(e={clearRedrawFlags:!1}){return this._getNeedsRedraw(e)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){return this.internalState?.uniformTransitions.active||!1}activateViewport(e){if(!this.internalState)return;const r=this.internalState.viewport;this.internalState.viewport=e,(!r||!oae({oldViewport:r,viewport:e}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(e="all"){const r=this.getAttributeManager();r&&(e==="all"?r.invalidateAll():r.invalidate(e))}updateAttributes(e){let r=!1;for(const i in e)e[i].layoutChanged()&&(r=!0);for(const i of this.getModels())this._setModelAttributes(i,e,r)}_updateAttributes(){const e=this.getAttributeManager();if(!e)return;const r=this.props,i=this.getNumInstances(),n=this.getStartIndices();e.update({data:r.data,numInstances:i,startIndices:n,props:r,transitions:r.transitions,buffers:r.data.attributes,context:this});const l=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(l)}_updateAttributeTransition(){const e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){const{uniformTransitions:e}=this.internalState;if(e.active){const r=e.update(),i=Object.create(this.props);for(const n in r)Object.defineProperty(i,n,{value:r[n]});return i}return this.props}calculateInstancePickingColors(e,{numInstances:r}){if(e.constant)return;const i=Math.floor(vu.length/4);if(this.internalState.usesPickingColorCache=!0,i<r){r>nM&&hi.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),vu=Ay.allocate(vu,r,{size:4,copy:!0,maxCount:Math.max(r,nM)});const n=Math.floor(vu.length/4),l=[];for(let c=i;c<n;c++)this.encodePickingColor(c,l),vu[c*4+0]=l[0],vu[c*4+1]=l[1],vu[c*4+2]=l[2]}e.value=vu.subarray(0,r*4)}_setModelAttributes(e,r,i=!1){if(!Object.keys(r).length)return;if(i){const o=this.getAttributeManager();e.setBufferLayout(o.getBufferLayouts(e)),r=o.getAttributes()}const n=e.userData?.excludeAttributes||{},l={},c={};for(const o in r){if(n[o])continue;const m=r[o].getValue();for(const b in m){const A=m[b];A instanceof rn?r[o].settings.isIndexed?e.setIndexBuffer(A):l[b]=A:A&&(c[b]=A)}}e.setAttributes(l),e.setConstantAttributes(c)}disablePickingIndex(e){const r=this.props.data;if(!("attributes"in r)){this._disablePickingIndex(e);return}const{pickingColors:i,instancePickingColors:n}=this.getAttributeManager().attributes,l=i||n,c=l&&r.attributes&&r.attributes[l.id];if(c&&c.value){const o=c.value,m=this.encodePickingColor(e);for(let b=0;b<r.length;b++){const A=l.getVertexOffset(b);o[A]===m[0]&&o[A+1]===m[1]&&o[A+2]===m[2]&&this._disablePickingIndex(b)}}else this._disablePickingIndex(e)}_disablePickingIndex(e){const{pickingColors:r,instancePickingColors:i}=this.getAttributeManager().attributes,n=r||i;if(!n)return;const l=n.getVertexOffset(e),c=n.getVertexOffset(e+1);n.buffer.write(new Uint8Array(c-l),l)}restorePickingColors(){const{pickingColors:e,instancePickingColors:r}=this.getAttributeManager().attributes,i=e||r;i&&(this.internalState.usesPickingColorCache&&i.value.buffer!==vu.buffer&&(i.value=vu.subarray(0,i.value.length)),i.updateSubBuffer({startOffset:0}))}_initialize(){Ss(!this.internalState),Ss(Number.isFinite(this.props.coordinateSystem)),Ao(tae,this);const e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:"uint8",size:4,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new Qoe({attributeManager:e,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(hi.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),e)}),this.internalState.uniformTransitions=new Aoe(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const r of this.props.extensions)r.initializeState.call(this,this.context,r);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(e){Ao(nae,this,this===e);const{state:r,internalState:i}=e;this!==e&&(this.internalState=i,this.state=r,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const e=this.needsUpdate();if(Ao(rae,this,e),!e)return;const r=this.props,i=this.context,n=this.internalState,l=i.viewport,c=this._updateUniformTransition();n.propsInTransition=c,i.viewport=n.viewport||l,this.props=c;try{const o=this._getUpdateParams(),m=this.getModels();if(i.device)this.updateState(o);else try{this.updateState(o)}catch{}for(const A of this.props.extensions)A.updateState.call(this,o,A);const b=this.getModels()[0]!==m[0];this._postUpdate(o,b)}finally{i.viewport=l,this.props=r,this._clearChangeFlags(),n.needsUpdate=!1,n.resetOldProps()}}_finalize(){Ao(iae,this),this.finalizeState(this.context);for(const e of this.props.extensions)e.finalizeState.call(this,this.context,e)}_drawLayer({renderPass:e,moduleParameters:r=null,uniforms:i={},parameters:n={}}){this._updateAttributeTransition();const l=this.props,c=this.context;this.props=this.internalState.propsInTransition||l;const o=this.props.opacity;i.opacity=Math.pow(o,1/2.2);try{if(r){const{isActive:A,isAttribute:R}=r.picking;this.setModuleParameters(r),this.setShaderModuleProps({picking:{isActive:A,isAttribute:R}})}const{getPolygonOffset:m}=this.props,b=m&&m(i)||[0,0];c.device.setParametersWebGL({polygonOffset:b});for(const A of this.getModels())A.setParameters(n);c.device.withParametersWebGL(n,()=>{const A={renderPass:e,moduleParameters:r,uniforms:i,parameters:n,context:c};for(const R of this.props.extensions)R.draw.call(this,A,R);this.draw(A)})}finally{this.props=l}}getChangeFlags(){return this.internalState?.changeFlags}setChangeFlags(e){if(!this.internalState)return;const{changeFlags:r}=this.internalState;for(const n in e)if(e[n]){let l=!1;switch(n){case"dataChanged":const c=e[n],o=r[n];c&&Array.isArray(o)&&(r.dataChanged=Array.isArray(c)?o.concat(c):c,l=!0);default:r[n]||(r[n]=e[n],l=!0)}l&&Ao(eae,this,n,e)}const i=!!(r.dataChanged||r.updateTriggersChanged||r.propsChanged||r.extensionsChanged);r.propsOrDataChanged=i,r.somethingChanged=i||r.viewportChanged||r.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(e,r){const i=Soe(e,r);if(i.updateTriggersChanged)for(const n in i.updateTriggersChanged)i.updateTriggersChanged[n]&&this.invalidateAttribute(n);if(i.transitionsChanged)for(const n in i.transitionsChanged)this.internalState.uniformTransitions.add(n,r[n],e[n],e.transitions?.[n]);return this.setChangeFlags(i)}validateProps(){Toe(this.props)}updateAutoHighlight(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){const r={highlightedObjectColor:e.picked?e.color:null},{highlightColor:i}=this.props;e.picked&&typeof i=="function"&&(r.highlightColor=i(e)),this.setShaderModuleProps({picking:r}),this.setNeedsRedraw()}_getAttributeManager(){const e=this.context;return new voe(e.device,{id:this.props.id,stats:e.stats,timeline:e.timeline})}_postUpdate(e,r){const{props:i,oldProps:n}=e;this.setNeedsRedraw(),this._updateAttributes();const l=this.state.model;l?.isInstanced&&l.setInstanceCount(this.getNumInstances());const{autoHighlight:c,highlightedObjectIndex:o,highlightColor:m}=i;if(r||n.autoHighlight!==c||n.highlightedObjectIndex!==o||n.highlightColor!==m){const b={};Array.isArray(m)&&(b.highlightColor=m),(r||n.autoHighlight!==c||o!==n.highlightedObjectIndex)&&(b.highlightedObjectColor=Number.isFinite(o)&&o>=0?this.encodePickingColor(o):null),this.setShaderModuleProps({picking:b})}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let r=!1;r=r||this.internalState.needsRedraw&&this.id;const i=this.getAttributeManager(),n=i?i.getNeedsRedraw(e):!1;if(r=r||n,r)for(const l of this.props.extensions)l.onNeedsRedraw.call(this,l);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags,r}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}Lg.defaultProps=aae;Lg.layerName="Layer";const lae="compositeLayer.renderLayers";class cD extends Lg{get isComposite(){return!0}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(e=>e.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(e){}setState(e){super.setState(e),this.setNeedsUpdate()}getPickingInfo({info:e}){const{object:r}=e;return r&&r.__source&&r.__source.parent&&r.__source.parent.id===this.id&&(e.object=r.__source.object,e.index=r.__source.index),e}filterSubLayer(e){return!0}shouldRenderSubLayer(e,r){return r&&r.length}getSubLayerClass(e,r){const{_subLayerProps:i}=this.props;return i&&i[e]&&i[e].type||r}getSubLayerRow(e,r,i){return e.__source={parent:this,object:r,index:i},e}getSubLayerAccessor(e){if(typeof e=="function"){const r={index:-1,data:this.props.data,target:[]};return(i,n)=>i&&i.__source?(r.index=i.__source.index,e(i.__source.object,r)):e(i,n)}return e}getSubLayerProps(e={}){const{opacity:r,pickable:i,visible:n,parameters:l,getPolygonOffset:c,highlightedObjectIndex:o,autoHighlight:m,highlightColor:b,coordinateSystem:A,coordinateOrigin:R,wrapLongitude:M,positionFormat:L,modelMatrix:G,extensions:V,fetch:q,operation:J,_subLayerProps:ie}=this.props,ee={id:"",updateTriggers:{},opacity:r,pickable:i,visible:n,parameters:l,getPolygonOffset:c,highlightedObjectIndex:o,autoHighlight:m,highlightColor:b,coordinateSystem:A,coordinateOrigin:R,wrapLongitude:M,positionFormat:L,modelMatrix:G,extensions:V,fetch:q,operation:J},me=ie&&e.id&&ie[e.id],Se=me&&me.updateTriggers,Me=e.id||"sublayer";if(me){const Ve=this.props[Bd],Be=e.type?e.type._propTypes:{};for(const $e in me){const at=Be[$e]||Ve[$e];at&&at.type==="accessor"&&(me[$e]=this.getSubLayerAccessor(me[$e]))}}Object.assign(ee,e,me),ee.id=`${this.props.id}-${Me}`,ee.updateTriggers={all:this.props.updateTriggers?.all,...e.updateTriggers,...Se};for(const Ve of V){const Be=Ve.getSubLayerProps.call(this,Ve);Be&&Object.assign(ee,Be,{updateTriggers:Object.assign(ee.updateTriggers,Be.updateTriggers)})}return ee}_updateAutoHighlight(e){for(const r of this.getSubLayers())r.updateAutoHighlight(e)}_getAttributeManager(){return null}_postUpdate(e,r){let i=this.internalState.subLayers;const n=!i||this.needsUpdate();if(n){const l=this.renderLayers();i=pg(l,Boolean),this.internalState.subLayers=i}Ao(lae,this,n,i);for(const l of i)l.parent=this}}cD.layerName="CompositeLayer";const cae=`#version 300 es
#define SHADER_NAME point-cloud-layer-vertex-shader
in vec3 positions;
in vec3 instanceNormals;
in vec4 instanceColors;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec3 instancePickingColors;
uniform float opacity;
uniform float radiusPixels;
uniform int sizeUnits;
out vec4 vColor;
out vec2 unitPosition;
void main(void) {
geometry.worldPosition = instancePositions;
geometry.normal = project_normal(instanceNormals);
unitPosition = positions.xy;
geometry.uv = unitPosition;
geometry.pickingColor = instancePickingColors;
vec3 offset = vec3(positions.xy * project_size_to_pixel(radiusPixels, sizeUnits), 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
vec3 lightColor = lighting_getLightColor(instanceColors.rgb, project_uCameraPosition, geometry.position.xyz, geometry.normal);
vColor = vec4(lightColor, instanceColors.a * opacity);
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,uae=`#version 300 es
#define SHADER_NAME point-cloud-layer-fragment-shader
precision highp float;
in vec4 vColor;
in vec2 unitPosition;
out vec4 fragColor;
void main(void) {
geometry.uv = unitPosition;
float distToCenter = length(unitPosition);
if (distToCenter > 1.0) {
discard;
}
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,uD=[0,0,0,255],hD=[0,0,1],hae={sizeUnits:"pixels",pointSize:{type:"number",min:0,value:10},getPosition:{type:"accessor",value:t=>t.position},getNormal:{type:"accessor",value:hD},getColor:{type:"accessor",value:uD},material:!0,radiusPixels:{deprecatedFor:"pointSize"}};function dae(t){const{header:e,attributes:r}=t;if(!(!e||!r)&&(t.length=e.vertexCount,r.POSITION&&(r.instancePositions=r.POSITION),r.NORMAL&&(r.instanceNormals=r.NORMAL),r.COLOR_0)){const{size:i,value:n}=r.COLOR_0;r.instanceColors={size:i,type:"unorm8",value:n}}}class AT extends Lg{getShaders(){return super.getShaders({vs:cae,fs:uae,modules:[uT,qee,fT]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceNormals:{size:3,transition:!0,accessor:"getNormal",defaultValue:hD},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:uD}})}updateState(e){const{changeFlags:r,props:i}=e;super.updateState(e),r.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll()),r.dataChanged&&dae(i.data)}draw({uniforms:e}){const{pointSize:r,sizeUnits:i}=this.props,n=this.state.model;n.setUniforms(e),n.setUniforms({sizeUnits:j2[i],radiusPixels:r}),n.draw(this.context.renderPass)}_getModel(){const e=[];for(let r=0;r<3;r++){const i=r/3*Math.PI*2;e.push(Math.cos(i)*2,Math.sin(i)*2,0)}return new jd(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new tg({topology:"triangle-list",attributes:{positions:new Float32Array(e)}}),isInstanced:!0})}}AT.layerName="PointCloudLayer";AT.defaultProps=hae;const Qa={OUTSIDE:-1,INTERSECTING:0,INSIDE:1};new et;new et;const D_=new et,sM=new et;class Zy{constructor(e=[0,0,0],r=0){this.radius=-0,this.center=new et,this.fromCenterRadius(e,r)}fromCenterRadius(e,r){return this.center.from(e),this.radius=r,this}fromCornerPoints(e,r){return r=D_.from(r),this.center=new et().from(e).add(r).scale(.5),this.radius=this.center.distance(r),this}equals(e){return this===e||!!e&&this.center.equals(e.center)&&this.radius===e.radius}clone(){return new Zy(this.center,this.radius)}union(e){const r=this.center,i=this.radius,n=e.center,l=e.radius,c=D_.copy(n).subtract(r),o=c.magnitude();if(i>=o+l)return this.clone();if(l>=o+i)return e.clone();const m=(i+o+l)*.5;return sM.copy(c).scale((-i+m)/o).add(r),this.center.copy(sM),this.radius=m,this}expand(e){const r=D_.from(e).subtract(this.center).magnitude();return r>this.radius&&(this.radius=r),this}transform(e){this.center.transform(e);const r=iee(D_,e);return this.radius=Math.max(r[0],Math.max(r[1],r[2]))*this.radius,this}distanceSquaredTo(e){const r=this.distanceTo(e);return r*r}distanceTo(e){const r=D_.from(e).subtract(this.center);return Math.max(0,r.len()-this.radius)}intersectPlane(e){const r=this.center,i=this.radius,n=e.normal.dot(r)+e.distance;return n<-i?Qa.OUTSIDE:n<i?Qa.INTERSECTING:Qa.INSIDE}}const fae=new et,pae=new et,vv=new et,bv=new et,xv=new et,mae=new et,gae=new et,vh={COLUMN0ROW0:0,COLUMN0ROW1:1,COLUMN0ROW2:2,COLUMN1ROW0:3,COLUMN1ROW1:4,COLUMN1ROW2:5,COLUMN2ROW0:6,COLUMN2ROW1:7,COLUMN2ROW2:8};class Xy{constructor(e=[0,0,0],r=[0,0,0,0,0,0,0,0,0]){this.center=new et().from(e),this.halfAxes=new kn(r)}get halfSize(){const e=this.halfAxes.getColumn(0),r=this.halfAxes.getColumn(1),i=this.halfAxes.getColumn(2);return[new et(e).len(),new et(r).len(),new et(i).len()]}get quaternion(){const e=this.halfAxes.getColumn(0),r=this.halfAxes.getColumn(1),i=this.halfAxes.getColumn(2),n=new et(e).normalize(),l=new et(r).normalize(),c=new et(i).normalize();return new wy().fromMatrix3(new kn([...n,...l,...c]))}fromCenterHalfSizeQuaternion(e,r,i){const n=new wy(i),l=new kn().fromQuaternion(n);return l[0]=l[0]*r[0],l[1]=l[1]*r[0],l[2]=l[2]*r[0],l[3]=l[3]*r[1],l[4]=l[4]*r[1],l[5]=l[5]*r[1],l[6]=l[6]*r[2],l[7]=l[7]*r[2],l[8]=l[8]*r[2],this.center=new et().from(e),this.halfAxes=l,this}clone(){return new Xy(this.center,this.halfAxes)}equals(e){return this===e||!!e&&this.center.equals(e.center)&&this.halfAxes.equals(e.halfAxes)}getBoundingSphere(e=new Zy){const r=this.halfAxes,i=r.getColumn(0,vv),n=r.getColumn(1,bv),l=r.getColumn(2,xv),c=fae.copy(i).add(n).add(l);return e.center.copy(this.center),e.radius=c.magnitude(),e}intersectPlane(e){const r=this.center,i=e.normal,n=this.halfAxes,l=i.x,c=i.y,o=i.z,m=Math.abs(l*n[vh.COLUMN0ROW0]+c*n[vh.COLUMN0ROW1]+o*n[vh.COLUMN0ROW2])+Math.abs(l*n[vh.COLUMN1ROW0]+c*n[vh.COLUMN1ROW1]+o*n[vh.COLUMN1ROW2])+Math.abs(l*n[vh.COLUMN2ROW0]+c*n[vh.COLUMN2ROW1]+o*n[vh.COLUMN2ROW2]),b=i.dot(r)+e.distance;return b<=-m?Qa.OUTSIDE:b>=m?Qa.INSIDE:Qa.INTERSECTING}distanceTo(e){return Math.sqrt(this.distanceSquaredTo(e))}distanceSquaredTo(e){const r=pae.from(e).subtract(this.center),i=this.halfAxes,n=i.getColumn(0,vv),l=i.getColumn(1,bv),c=i.getColumn(2,xv),o=n.magnitude(),m=l.magnitude(),b=c.magnitude();n.normalize(),l.normalize(),c.normalize();let A=0,R;return R=Math.abs(r.dot(n))-o,R>0&&(A+=R*R),R=Math.abs(r.dot(l))-m,R>0&&(A+=R*R),R=Math.abs(r.dot(c))-b,R>0&&(A+=R*R),A}computePlaneDistances(e,r,i=[-0,-0]){let n=Number.POSITIVE_INFINITY,l=Number.NEGATIVE_INFINITY;const c=this.center,o=this.halfAxes,m=o.getColumn(0,vv),b=o.getColumn(1,bv),A=o.getColumn(2,xv),R=mae.copy(m).add(b).add(A).add(c),M=gae.copy(R).subtract(e);let L=r.dot(M);return n=Math.min(L,n),l=Math.max(L,l),R.copy(c).add(m).add(b).subtract(A),M.copy(R).subtract(e),L=r.dot(M),n=Math.min(L,n),l=Math.max(L,l),R.copy(c).add(m).subtract(b).add(A),M.copy(R).subtract(e),L=r.dot(M),n=Math.min(L,n),l=Math.max(L,l),R.copy(c).add(m).subtract(b).subtract(A),M.copy(R).subtract(e),L=r.dot(M),n=Math.min(L,n),l=Math.max(L,l),c.copy(R).subtract(m).add(b).add(A),M.copy(R).subtract(e),L=r.dot(M),n=Math.min(L,n),l=Math.max(L,l),c.copy(R).subtract(m).add(b).subtract(A),M.copy(R).subtract(e),L=r.dot(M),n=Math.min(L,n),l=Math.max(L,l),c.copy(R).subtract(m).subtract(b).add(A),M.copy(R).subtract(e),L=r.dot(M),n=Math.min(L,n),l=Math.max(L,l),c.copy(R).subtract(m).subtract(b).subtract(A),M.copy(R).subtract(e),L=r.dot(M),n=Math.min(L,n),l=Math.max(L,l),i[0]=n,i[1]=l,i}transform(e){this.center.transformAsPoint(e);const r=this.halfAxes.getColumn(0,vv);r.transformAsPoint(e);const i=this.halfAxes.getColumn(1,bv);i.transformAsPoint(e);const n=this.halfAxes.getColumn(2,xv);return n.transformAsPoint(e),this.halfAxes=new kn([...r,...i,...n]),this}getTransform(){throw new Error("not implemented")}}const oM=new et,aM=new et;class wu{constructor(e=[0,0,1],r=0){this.normal=new et,this.distance=-0,this.fromNormalDistance(e,r)}fromNormalDistance(e,r){return wc(Number.isFinite(r)),this.normal.from(e).normalize(),this.distance=r,this}fromPointNormal(e,r){e=oM.from(e),this.normal.from(r).normalize();const i=-this.normal.dot(e);return this.distance=i,this}fromCoefficients(e,r,i,n){return this.normal.set(e,r,i),wc(Pc(this.normal.len(),1)),this.distance=n,this}clone(){return new wu(this.normal,this.distance)}equals(e){return Pc(this.distance,e.distance)&&Pc(this.normal,e.normal)}getPointDistance(e){return this.normal.dot(e)+this.distance}transform(e){const r=aM.copy(this.normal).transformAsVector(e).normalize(),i=this.normal.scale(-this.distance).transform(e);return this.fromPointNormal(i,r)}projectPointOntoPlane(e,r=[0,0,0]){const i=oM.from(e),n=this.getPointDistance(i),l=aM.copy(this.normal).scale(n);return i.subtract(l).to(r)}}const lM=[new et([1,0,0]),new et([0,1,0]),new et([0,0,1])],cM=new et,_ae=new et;class Dl{constructor(e=[]){this.planes=e}fromBoundingSphere(e){this.planes.length=2*lM.length;const r=e.center,i=e.radius;let n=0;for(const l of lM){let c=this.planes[n],o=this.planes[n+1];c||(c=this.planes[n]=new wu),o||(o=this.planes[n+1]=new wu);const m=cM.copy(l).scale(-i).add(r);c.fromPointNormal(m,l);const b=cM.copy(l).scale(i).add(r),A=_ae.copy(l).negate();o.fromPointNormal(b,A),n+=2}return this}computeVisibility(e){let r=Qa.INSIDE;for(const i of this.planes)switch(e.intersectPlane(i)){case Qa.OUTSIDE:return Qa.OUTSIDE;case Qa.INTERSECTING:r=Qa.INTERSECTING;break}return r}computeVisibilityWithPlaneMask(e,r){if(wc(Number.isFinite(r),"parentPlaneMask is required."),r===Dl.MASK_OUTSIDE||r===Dl.MASK_INSIDE)return r;let i=Dl.MASK_INSIDE;const n=this.planes;for(let l=0;l<this.planes.length;++l){const c=l<31?1<<l:0;if(l<31&&(r&c)===0)continue;const o=n[l],m=e.intersectPlane(o);if(m===Qa.OUTSIDE)return Dl.MASK_OUTSIDE;m===Qa.INTERSECTING&&(i|=c)}return i}}Dl.MASK_OUTSIDE=4294967295;Dl.MASK_INSIDE=0;Dl.MASK_INDETERMINATE=2147483647;new et;new et;new et;new et;new et;new et;new et;new et;new et;new et;new et;new et;new et;new et;new et;new et;new et;const bu=new kn,yae=new kn,vae=new kn,wv=new kn,uM=new kn;function bae(t,e={}){const r=Vee,i=10;let n=0,l=0;const c=yae,o=vae;c.identity(),o.copy(t);const m=r*xae(o);for(;l<i&&wae(o)>m;)Eae(o,wv),uM.copy(wv).transpose(),o.multiplyRight(wv),o.multiplyLeft(uM),c.multiplyRight(wv),++n>2&&(++l,n=0);return e.unitary=c.toTarget(e.unitary),e.diagonal=o.toTarget(e.diagonal),e}function xae(t){let e=0;for(let r=0;r<9;++r){const i=t[r];e+=i*i}return Math.sqrt(e)}const nE=[1,0,0],sE=[2,2,1];function wae(t){let e=0;for(let r=0;r<3;++r){const i=t[bu.getElementIndex(sE[r],nE[r])];e+=2*i*i}return Math.sqrt(e)}function Eae(t,e){const r=fO;let i=0,n=1;for(let b=0;b<3;++b){const A=Math.abs(t[bu.getElementIndex(sE[b],nE[b])]);A>i&&(n=b,i=A)}const l=nE[n],c=sE[n];let o=1,m=0;if(Math.abs(t[bu.getElementIndex(c,l)])>r){const b=t[bu.getElementIndex(c,c)],A=t[bu.getElementIndex(l,l)],R=t[bu.getElementIndex(c,l)],M=(b-A)/2/R;let L;M<0?L=-1/(-M+Math.sqrt(1+M*M)):L=1/(M+Math.sqrt(1+M*M)),o=1/Math.sqrt(1+L*L),m=L*o}return kn.IDENTITY.to(e),e[bu.getElementIndex(l,l)]=e[bu.getElementIndex(c,c)]=o,e[bu.getElementIndex(c,l)]=m,e[bu.getElementIndex(l,c)]=-m,e}const wd=new et,Aae=new et,Tae=new et,Sae=new et,Cae=new et,Pae=new kn,Rae={diagonal:new kn,unitary:new kn};function Mae(t,e=new Xy){if(!t||t.length===0)return e.halfAxes=new kn([0,0,0,0,0,0,0,0,0]),e.center=new et,e;const r=t.length,i=new et(0,0,0);for(const $e of t)i.add($e);const n=1/r;i.multiplyByScalar(n);let l=0,c=0,o=0,m=0,b=0,A=0;for(const $e of t){const at=wd.copy($e).subtract(i);l+=at.x*at.x,c+=at.x*at.y,o+=at.x*at.z,m+=at.y*at.y,b+=at.y*at.z,A+=at.z*at.z}l*=n,c*=n,o*=n,m*=n,b*=n,A*=n;const R=Pae;R[0]=l,R[1]=c,R[2]=o,R[3]=c,R[4]=m,R[5]=b,R[6]=o,R[7]=b,R[8]=A;const{unitary:M}=bae(R,Rae),L=e.halfAxes.copy(M);let G=L.getColumn(0,Tae),V=L.getColumn(1,Sae),q=L.getColumn(2,Cae),J=-Number.MAX_VALUE,ie=-Number.MAX_VALUE,ee=-Number.MAX_VALUE,me=Number.MAX_VALUE,Se=Number.MAX_VALUE,Me=Number.MAX_VALUE;for(const $e of t)wd.copy($e),J=Math.max(wd.dot(G),J),ie=Math.max(wd.dot(V),ie),ee=Math.max(wd.dot(q),ee),me=Math.min(wd.dot(G),me),Se=Math.min(wd.dot(V),Se),Me=Math.min(wd.dot(q),Me);G=G.multiplyByScalar(.5*(me+J)),V=V.multiplyByScalar(.5*(Se+ie)),q=q.multiplyByScalar(.5*(Me+ee)),e.center.copy(G).add(V).add(q);const Ve=Aae.set(J-me,ie-Se,ee-Me).multiplyByScalar(.5),Be=new kn([Ve[0],0,0,0,Ve[1],0,0,0,Ve[2]]);return e.halfAxes.multiplyRight(Be),e}const aw=Math.PI/180,Ev=new Float32Array(16),hM=new Float32Array(12);function dM(t,e,r){const i=e[0]*aw,n=e[1]*aw,l=e[2]*aw,c=Math.sin(l),o=Math.sin(i),m=Math.sin(n),b=Math.cos(l),A=Math.cos(i),R=Math.cos(n),M=r[0],L=r[1],G=r[2];t[0]=M*R*A,t[1]=M*m*A,t[2]=M*-o,t[3]=L*(-m*b+R*o*c),t[4]=L*(R*b+m*o*c),t[5]=L*A*c,t[6]=G*(m*c+R*o*b),t[7]=G*(-R*c+m*o*b),t[8]=G*A*b}function fM(t){return t[0]=t[0],t[1]=t[1],t[2]=t[2],t[3]=t[4],t[4]=t[5],t[5]=t[6],t[6]=t[8],t[7]=t[9],t[8]=t[10],t[9]=t[12],t[10]=t[13],t[11]=t[14],t.subarray(0,12)}const dD={size:12,accessor:["getOrientation","getScale","getTranslation","getTransformMatrix"],shaderAttributes:{instanceModelMatrixCol0:{size:3,elementOffset:0},instanceModelMatrixCol1:{size:3,elementOffset:3},instanceModelMatrixCol2:{size:3,elementOffset:6},instanceTranslation:{size:3,elementOffset:9}},update(t,{startRow:e,endRow:r}){const{data:i,getOrientation:n,getScale:l,getTranslation:c,getTransformMatrix:o}=this.props,m=Array.isArray(o),b=m&&o.length===16,A=Array.isArray(l),R=Array.isArray(n),M=Array.isArray(c),L=b||!m&&!!o(i[0]);L?t.constant=b:t.constant=R&&A&&M;const G=t.value;if(t.constant){let V;L?(Ev.set(o),V=fM(Ev)):(V=hM,dM(V,n,l),V.set(c,9)),t.value=new Float32Array(V)}else{let V=e*t.size;const{iterable:q,objectInfo:J}=XO(i,e,r);for(const ie of q){J.index++;let ee;if(L)Ev.set(b?o:o(ie,J)),ee=fM(Ev);else{ee=hM;const me=R?n:n(ie,J),Se=A?l:l(ie,J);dM(ee,me,Se),ee.set(M?c:c(ie,J),9)}G[V++]=ee[0],G[V++]=ee[1],G[V++]=ee[2],G[V++]=ee[3],G[V++]=ee[4],G[V++]=ee[5],G[V++]=ee[6],G[V++]=ee[7],G[V++]=ee[8],G[V++]=ee[9],G[V++]=ee[10],G[V++]=ee[11]}}}};function fD(t,e){return e===Qr.CARTESIAN||e===Qr.METER_OFFSETS||e===Qr.DEFAULT&&!t.isGeospatial}const Iae=`#version 300 es
#define SHADER_NAME simple-mesh-layer-vs
uniform float sizeScale;
uniform bool composeModelMatrix;
in vec3 positions;
in vec3 normals;
in vec3 colors;
in vec2 texCoords;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec3 instanceModelMatrixCol0;
in vec3 instanceModelMatrixCol1;
in vec3 instanceModelMatrixCol2;
in vec3 instanceTranslation;
out vec2 vTexCoord;
out vec3 cameraPosition;
out vec3 normals_commonspace;
out vec4 position_commonspace;
out vec4 vColor;
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = texCoords;
geometry.pickingColor = instancePickingColors;
vTexCoord = texCoords;
cameraPosition = project_uCameraPosition;
vColor = vec4(colors * instanceColors.rgb, instanceColors.a);
mat3 instanceModelMatrix = mat3(instanceModelMatrixCol0, instanceModelMatrixCol1, instanceModelMatrixCol2);
vec3 pos = (instanceModelMatrix * positions) * sizeScale + instanceTranslation;
if (composeModelMatrix) {
DECKGL_FILTER_SIZE(pos, geometry);
normals_commonspace = project_normal(instanceModelMatrix * normals);
geometry.worldPosition += pos;
gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), position_commonspace);
geometry.position = position_commonspace;
}
else {
pos = project_size(pos);
DECKGL_FILTER_SIZE(pos, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, position_commonspace);
geometry.position = position_commonspace;
normals_commonspace = project_normal(instanceModelMatrix * normals);
}
geometry.normal = normals_commonspace;
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,kae=`#version 300 es
#define SHADER_NAME simple-mesh-layer-fs
precision highp float;
uniform bool hasTexture;
uniform sampler2D sampler;
uniform bool flatShading;
uniform float opacity;
in vec2 vTexCoord;
in vec3 cameraPosition;
in vec3 normals_commonspace;
in vec4 position_commonspace;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
geometry.uv = vTexCoord;
vec3 normal;
if (flatShading) {
normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
} else {
normal = normals_commonspace;
}
vec4 color = hasTexture ? texture(sampler, vTexCoord) : vColor;
DECKGL_FILTER_COLOR(color, geometry);
vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);
fragColor = vec4(lightColor, color.a * opacity);
}
`;function lw(t){const e=t.positions||t.POSITION;hi.assert(e,'no "postions" or "POSITION" attribute in mesh');const r=e.value.length/e.size;let i=t.COLOR_0||t.colors;i||(i={size:3,value:new Float32Array(r*3).fill(1)});let n=t.NORMAL||t.normals;n||(n={size:3,value:new Float32Array(r*3).fill(0)});let l=t.TEXCOORD_0||t.texCoords;return l||(l={size:2,value:new Float32Array(r*2).fill(0)}),{positions:e,colors:i,normals:n,texCoords:l}}function pM(t){return t instanceof tg?(t.attributes=lw(t.attributes),t):t.attributes?new tg({...t,topology:"triangle-list",attributes:lw(t.attributes)}):new tg({topology:"triangle-list",attributes:lw(t)})}const Bae=[0,0,0,255],Lae={mesh:{type:"object",value:null,async:!0},texture:{type:"image",value:null,async:!0},sizeScale:{type:"number",value:1,min:0},_instanced:!0,wireframe:!1,material:!0,getPosition:{type:"accessor",value:t=>t.position},getColor:{type:"accessor",value:Bae},getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},textureParameters:{type:"object",ignore:!0,value:null}};class TT extends Lg{getShaders(){return super.getShaders({vs:Iae,fs:kae,modules:[uT,Kee,fT]})}getBounds(){if(this.props._instanced)return super.getBounds();let e=this.state.positionBounds;if(e)return e;const{mesh:r}=this.props;if(!r)return null;if(e=r.header?.boundingBox,!e){const{attributes:i}=pM(r);i.POSITION=i.POSITION||i.positions,e=vL(i)}return this.state.positionBounds=e,e}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{transition:!0,type:"float64",fp64:this.use64bitPositions(),size:3,accessor:"getPosition"},instanceColors:{type:"unorm8",transition:!0,size:this.props.colorFormat.length,accessor:"getColor",defaultValue:[0,0,0,255]},instanceModelMatrix:dD}),this.setState({emptyTexture:this.context.device.createTexture({data:new Uint8Array(4),width:1,height:1})})}updateState(e){super.updateState(e);const{props:r,oldProps:i,changeFlags:n}=e;if(r.mesh!==i.mesh||n.extensionsChanged){if(this.state.positionBounds=null,this.state.model?.destroy(),r.mesh){this.state.model=this.getModel(r.mesh);const l=r.mesh.attributes||r.mesh;this.setState({hasNormals:!!(l.NORMAL||l.normals)})}this.getAttributeManager().invalidateAll()}r.texture!==i.texture&&r.texture instanceof rl&&this.setTexture(r.texture),this.state.model&&this.state.model.setTopology(this.props.wireframe?"line-strip":"triangle-list")}finalizeState(e){super.finalizeState(e),this.state.emptyTexture.delete()}draw({uniforms:e}){const{model:r}=this.state;if(!r)return;const{viewport:i,renderPass:n}=this.context,{sizeScale:l,coordinateSystem:c,_instanced:o}=this.props;r.setUniforms(e),r.setUniforms({sizeScale:l,composeModelMatrix:!o||fD(i,c),flatShading:!this.state.hasNormals}),r.draw(n)}get isLoaded(){return!!(this.state?.model&&super.isLoaded)}getModel(e){const r=new jd(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:pM(e),isInstanced:!0}),{texture:i}=this.props,{emptyTexture:n}=this.state;return r.setBindings({sampler:i||n}),r.setUniforms({hasTexture:!!i}),r}setTexture(e){const{emptyTexture:r,model:i}=this.state;i&&(i.setBindings({sampler:e||r}),i.setUniforms({hasTexture:!!e}))}}TT.defaultProps=Lae;TT.layerName="SimpleMeshLayer";var Ec;(function(t){t[t.FUNC_ADD=32774]="FUNC_ADD",t[t.ONE=1]="ONE",t[t.SRC_ALPHA=770]="SRC_ALPHA",t[t.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",t[t.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",t[t.LINEAR=9729]="LINEAR",t[t.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",t[t.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL"})(Ec||(Ec={}));function pD(t,e,r,i){const n={defines:{MANUAL_SRGB:1,SRGB_FAST_APPROXIMATION:1},bindings:{},uniforms:{u_Camera:[0,0,0],u_MetallicRoughnessValues:[1,1]},parameters:{},glParameters:{},generatedTextures:[]};n.defines.USE_TEX_LOD=1;const{imageBasedLightingEnvironment:l}=i;return l&&(n.bindings.u_DiffuseEnvSampler=l.diffuseEnvSampler,n.bindings.u_SpecularEnvSampler=l.specularEnvSampler,n.bindings.u_brdfLUT=l.brdfLutTexture,n.uniforms.u_ScaleIBLAmbient=[1,1]),i?.pbrDebug&&(n.defines.PBR_DEBUG=1,n.uniforms.u_ScaleDiffBaseMR=[0,0,0,0],n.uniforms.u_ScaleFGDSpec=[0,0,0,0]),r.NORMAL&&(n.defines.HAS_NORMALS=1),r.TANGENT&&i?.useTangents&&(n.defines.HAS_TANGENTS=1),r.TEXCOORD_0&&(n.defines.HAS_UV=1),i?.imageBasedLightingEnvironment&&(n.defines.USE_IBL=1),i?.lights&&(n.defines.USE_LIGHTS=1),e&&Oae(t,e,n),n}function Oae(t,e,r){if(r.uniforms.pbr_uUnlit=!!e.unlit,e.pbrMetallicRoughness&&Dae(t,e.pbrMetallicRoughness,r),e.normalTexture){cy(t,e.normalTexture,"u_NormalSampler","HAS_NORMALMAP",r);const{scale:i=1}=e.normalTexture;r.uniforms.u_NormalScale=i}if(e.occlusionTexture){cy(t,e.occlusionTexture,"u_OcclusionSampler","HAS_OCCLUSIONMAP",r);const{strength:i=1}=e.occlusionTexture;r.uniforms.u_OcclusionStrength=i}switch(e.emissiveTexture&&(cy(t,e.emissiveTexture,"u_EmissiveSampler","HAS_EMISSIVEMAP",r),r.uniforms.u_EmissiveFactor=e.emissiveFactor||[0,0,0]),e.alphaMode){case"MASK":const{alphaCutoff:i=.5}=e;r.defines.ALPHA_CUTOFF=1,r.uniforms.u_AlphaCutoff=i;break;case"BLEND":Pt.warn("glTF BLEND alphaMode might not work well because it requires mesh sorting")(),r.parameters.blendColorOperation="add",r.parameters.blendColorSrcFactor="src-alpha",r.parameters.blendColorDstFactor="one-minus-src-alpha",r.parameters.blendAlphaOperation="add",r.parameters.blendAlphaSrcFactor="one",r.parameters.blendAlphaDstFactor="one-minus-src-alpha",r.glParameters.blend=!0,r.glParameters.blendEquation=Ec.FUNC_ADD,r.glParameters.blendFunc=[Ec.SRC_ALPHA,Ec.ONE_MINUS_SRC_ALPHA,Ec.ONE,Ec.ONE_MINUS_SRC_ALPHA];break}}function Dae(t,e,r){e.baseColorTexture&&cy(t,e.baseColorTexture,"u_BaseColorSampler","HAS_BASECOLORMAP",r),r.uniforms.u_BaseColorFactor=e.baseColorFactor||[1,1,1,1],e.metallicRoughnessTexture&&cy(t,e.metallicRoughnessTexture,"u_MetallicRoughnessSampler","HAS_METALROUGHNESSMAP",r);const{metallicFactor:i=1,roughnessFactor:n=1}=e;r.uniforms.u_MetallicRoughnessValues=[i,n]}function cy(t,e,r,i=null,n){const l=e?.texture?.sampler?.parameters||{},c=e.texture.source.image;let o,m={};c.compressed?(o=c,m={[Ec.TEXTURE_MIN_FILTER]:c.data.length>1?Ec.LINEAR_MIPMAP_NEAREST:Ec.LINEAR}):o={data:c};const b=t.createTexture({id:e.uniformName||e.id,parameters:{...l,...m},pixelStore:{[Ec.UNPACK_FLIP_Y_WEBGL]:!1},...o});n.bindings[r]=b,i&&(n.defines[i]=1),n.generatedTextures.push(b)}const Nae="4.3.1",E1={TRANSCODER:"basis_transcoder.js",TRANSCODER_WASM:"basis_transcoder.wasm",ENCODER:"basis_encoder.js",ENCODER_WASM:"basis_encoder.wasm"};let mM;async function gM(t){return fK(t.modules),pK("basis")||(mM||=Fae(t),await mM)}async function Fae(t){let e=null,r=null;return[e,r]=await Promise.all([await Tp(E1.TRANSCODER,"textures",t),await Tp(E1.TRANSCODER_WASM,"textures",t)]),e=e||globalThis.BASIS,await zae(e,r)}function zae(t,e){const r={};return e&&(r.wasmBinary=e),new Promise(i=>{t(r).then(n=>{const{BasisFile:l,initializeBasis:c}=n;c(),i({BasisFile:l})})})}let cw;async function _M(t){const e=t.modules||{};return e.basisEncoder?e.basisEncoder:(cw=cw||jae(t),await cw)}async function jae(t){let e=null,r=null;return[e,r]=await Promise.all([await Tp(E1.ENCODER,"textures",t),await Tp(E1.ENCODER_WASM,"textures",t)]),e=e||globalThis.BASIS,await Uae(e,r)}function Uae(t,e){const r={};return e&&(r.wasmBinary=e),new Promise(i=>{t(r).then(n=>{const{BasisFile:l,KTX2File:c,initializeBasis:o,BasisEncoder:m}=n;o(),i({BasisFile:l,KTX2File:c,BasisEncoder:m})})})}const Rm={COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGB_ETC1_WEBGL:36196,COMPRESSED_RGBA_ASTC_4X4_KHR:37808},Vae=["","WEBKIT_","MOZ_"],yM={WEBGL_compressed_texture_s3tc:"dxt",WEBGL_compressed_texture_s3tc_srgb:"dxt-srgb",WEBGL_compressed_texture_etc1:"etc1",WEBGL_compressed_texture_etc:"etc2",WEBGL_compressed_texture_pvrtc:"pvrtc",WEBGL_compressed_texture_atc:"atc",WEBGL_compressed_texture_astc:"astc",EXT_texture_compression_rgtc:"rgtc"};let Av=null;function Gae(t){if(!Av){t=t||Hae()||void 0,Av=new Set;for(const e of Vae)for(const r in yM)if(t&&t.getExtension(`${e}${r}`)){const i=yM[r];Av.add(i)}}return Av}function Hae(){try{return document.createElement("canvas").getContext("webgl")}catch{return null}}const Xa=[171,75,84,88,32,50,48,187,13,10,26,10];function $ae(t){const e=new Uint8Array(t);return!(e.byteLength<Xa.length||e[0]!==Xa[0]||e[1]!==Xa[1]||e[2]!==Xa[2]||e[3]!==Xa[3]||e[4]!==Xa[4]||e[5]!==Xa[5]||e[6]!==Xa[6]||e[7]!==Xa[7]||e[8]!==Xa[8]||e[9]!==Xa[9]||e[10]!==Xa[10]||e[11]!==Xa[11])}const Wae={etc1:{basisFormat:0,compressed:!0,format:Rm.COMPRESSED_RGB_ETC1_WEBGL},etc2:{basisFormat:1,compressed:!0},bc1:{basisFormat:2,compressed:!0,format:Rm.COMPRESSED_RGB_S3TC_DXT1_EXT},bc3:{basisFormat:3,compressed:!0,format:Rm.COMPRESSED_RGBA_S3TC_DXT5_EXT},bc4:{basisFormat:4,compressed:!0},bc5:{basisFormat:5,compressed:!0},"bc7-m6-opaque-only":{basisFormat:6,compressed:!0},"bc7-m5":{basisFormat:7,compressed:!0},"pvrtc1-4-rgb":{basisFormat:8,compressed:!0,format:Rm.COMPRESSED_RGB_PVRTC_4BPPV1_IMG},"pvrtc1-4-rgba":{basisFormat:9,compressed:!0,format:Rm.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG},"astc-4x4":{basisFormat:10,compressed:!0,format:Rm.COMPRESSED_RGBA_ASTC_4X4_KHR},"atc-rgb":{basisFormat:11,compressed:!0},"atc-rgba-interpolated-alpha":{basisFormat:12,compressed:!0},rgba32:{basisFormat:13,compressed:!1},rgb565:{basisFormat:14,compressed:!1},bgr565:{basisFormat:15,compressed:!1},rgba4444:{basisFormat:16,compressed:!1}};async function qae(t,e){if(e.basis.containerFormat==="auto"){if($ae(t)){const i=await _M(e);return vM(i.KTX2File,t,e)}const{BasisFile:r}=await gM(e);return uw(r,t,e)}switch(e.basis.module){case"encoder":const r=await _M(e);switch(e.basis.containerFormat){case"ktx2":return vM(r.KTX2File,t,e);case"basis":default:return uw(r.BasisFile,t,e)}case"transcoder":default:const{BasisFile:i}=await gM(e);return uw(i,t,e)}}function uw(t,e,r){const i=new t(new Uint8Array(e));try{if(!i.startTranscoding())throw new Error("Failed to start basis transcoding");const n=i.getNumImages(),l=[];for(let c=0;c<n;c++){const o=i.getNumLevels(c),m=[];for(let b=0;b<o;b++)m.push(Kae(i,c,b,r));l.push(m)}return l}finally{i.close(),i.delete()}}function Kae(t,e,r,i){const n=t.getImageWidth(e,r),l=t.getImageHeight(e,r),c=t.getHasAlpha(),{compressed:o,format:m,basisFormat:b}=mD(i,c),A=t.getImageTranscodedSizeInBytes(e,r,b),R=new Uint8Array(A);if(!t.transcodeImage(R,e,r,b,0,0))throw new Error("failed to start Basis transcoding");return{width:n,height:l,data:R,compressed:o,format:m,hasAlpha:c}}function vM(t,e,r){const i=new t(new Uint8Array(e));try{if(!i.startTranscoding())throw new Error("failed to start KTX2 transcoding");const n=i.getLevels(),l=[];for(let c=0;c<n;c++)l.push(Zae(i,c,r));return[l]}finally{i.close(),i.delete()}}function Zae(t,e,r){const{alphaFlag:i,height:n,width:l}=t.getImageLevelInfo(e,0,0),{compressed:c,format:o,basisFormat:m}=mD(r,i),b=t.getImageTranscodedSizeInBytes(e,0,0,m),A=new Uint8Array(b);if(!t.transcodeImage(A,e,0,0,m,0,-1,-1))throw new Error("Failed to transcode KTX2 image");return{width:l,height:n,data:A,compressed:c,levelSize:b,hasAlpha:i,format:o}}function mD(t,e){let r=t&&t.basis&&t.basis.format;return r==="auto"&&(r=gD()),typeof r=="object"&&(r=e?r.alpha:r.noAlpha),r=r.toLowerCase(),Wae[r]}function gD(){const t=Gae();return t.has("astc")?"astc-4x4":t.has("dxt")?{alpha:"bc3",noAlpha:"bc1"}:t.has("pvrtc")?{alpha:"pvrtc1-4-rgba",noAlpha:"pvrtc1-4-rgb"}:t.has("etc1")?"etc1":t.has("etc2")?"etc2":"rgb565"}const Xae={dataType:null,batchType:null,name:"Basis",id:"basis",module:"textures",version:Nae,worker:!0,extensions:["basis","ktx2"],mimeTypes:["application/octet-stream","image/ktx2"],tests:["sB"],binary:!0,options:{basis:{format:"auto",libraryPath:"libs/",containerFormat:"auto",module:"transcoder"}}},Yae={...Xae,parse:qae},Jae={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Qae={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};class ele{name;startTime=0;playing=!0;speed=1;channels=[];constructor(e){Object.assign(this,e)}animate(e){if(!this.playing)return;const r=(e/1e3-this.startTime)*this.speed;this.channels.forEach(({sampler:i,target:n,path:l})=>{ale(r,i,n,l),ile(n,n._node)})}}class tle{animations;constructor(e){this.animations=e.animations.map((r,i)=>{const n=r.name||`Animation-${i}`,l=r.samplers.map(({input:o,interpolation:m="LINEAR",output:b})=>({input:bM(e.accessors[o]),interpolation:m,output:bM(e.accessors[b])})),c=r.channels.map(({sampler:o,target:m})=>({sampler:l[o],target:e.nodes[m.node],path:m.path}));return new ele({name:n,channels:c})})}animate(e){this.setTime(e)}setTime(e){this.animations.forEach(r=>r.animate(e))}getAnimations(){return this.animations}}function bM(t){if(!t._animation){const e=Qae[t.componentType],r=Jae[t.type],i=r*t.count,{buffer:n,byteOffset:l}=t.bufferView.data,c=new e(n,l+(t.byteOffset||0),i);if(r===1)t._animation=Array.from(c);else{const o=[];for(let m=0;m<c.length;m+=r)o.push(Array.from(c.slice(m,m+r)));t._animation=o}}return t._animation}const rle=new Kr;function ile(t,e){if(e.matrix.identity(),t.translation&&e.matrix.translate(t.translation),t.rotation){const r=rle.fromQuaternion(t.rotation);e.matrix.multiplyRight(r)}t.scale&&e.matrix.scale(t.scale)}const hw=new wy;function nle(t,e,r,i,n){if(e==="rotation"){hw.slerp({start:r,target:i,ratio:n});for(let l=0;l<hw.length;l++)t[e][l]=hw[l]}else for(let l=0;l<r.length;l++)t[e][l]=n*i[l]+(1-n)*r[l]}function sle(t,e,{p0:r,outTangent0:i,inTangent1:n,p1:l,tDiff:c,ratio:o}){for(let m=0;m<t[e].length;m++){const b=i[m]*c,A=n[m]*c;t[e][m]=(2*Math.pow(o,3)-3*Math.pow(o,2)+1)*r[m]+(Math.pow(o,3)-2*Math.pow(o,2)+o)*b+(-2*Math.pow(o,3)+3*Math.pow(o,2))*l[m]+(Math.pow(o,3)-Math.pow(o,2))*A}}function ole(t,e,r){for(let i=0;i<r.length;i++)t[e][i]=r[i]}function ale(t,{input:e,interpolation:r,output:i},n,l){const c=e[e.length-1],o=t%c,m=e.findIndex(M=>M>=o),b=Math.max(0,m-1);if(!Array.isArray(n[l]))switch(l){case"translation":n[l]=[0,0,0];break;case"rotation":n[l]=[0,0,0,1];break;case"scale":n[l]=[1,1,1];break;default:Pt.warn(`Bad animation path ${l}`)()}_i(n[l].length===i[b].length);const A=e[b],R=e[m];switch(r){case"STEP":ole(n,l,i[b]);break;case"LINEAR":if(R>A){const M=(o-A)/(R-A);nle(n,l,i[b],i[m],M)}break;case"CUBICSPLINE":if(R>A){const M=(o-A)/(R-A),L=R-A,G=i[3*b+1],V=i[3*b+2],q=i[3*m+0],J=i[3*m+1];sle(n,l,{p0:G,outTangent0:V,inTangent1:q,p1:J,tDiff:L,ratio:M})}break;default:Pt.warn(`Interpolation ${r} not supported`)();break}}const lle=`
#pragma vscode_glsllint_stage: vert
#if (__VERSION__ < 300)
  #define _attr attribute
#else
  #define _attr in
#endif

  // _attr vec4 POSITION;
  _attr vec4 positions;

  #ifdef HAS_NORMALS
    // _attr vec4 NORMAL;
    _attr vec4 normals;
  #endif

  #ifdef HAS_TANGENTS
    _attr vec4 TANGENT;
  #endif

  #ifdef HAS_UV
    // _attr vec2 TEXCOORD_0;
    _attr vec2 texCoords;
  #endif

  void main(void) {
    vec4 _NORMAL = vec4(0.);
    vec4 _TANGENT = vec4(0.);
    vec2 _TEXCOORD_0 = vec2(0.);

    #ifdef HAS_NORMALS
      _NORMAL = normals;
    #endif

    #ifdef HAS_TANGENTS
      _TANGENT = TANGENT;
    #endif

    #ifdef HAS_UV
      _TEXCOORD_0 = texCoords;
    #endif

    pbr_setPositionNormalTangentUV(positions, _NORMAL, _TANGENT, _TEXCOORD_0);
    gl_Position = u_MVPMatrix * positions;
  }
`,cle=`
#pragma vscode_glsllint_stage: frag
#if (__VERSION__ < 300)
  #define fragmentColor gl_FragColor
#else
  out vec4 fragmentColor;
#endif

  void main(void) {
    vec3 pos = pbr_vPosition;
    fragmentColor = pbr_filterColor(vec4(1.0));
  }
`;function ule(t,e){const{id:r,geometry:i,material:n,vertexCount:l,materialOptions:c,modelOptions:o}=e,m=pD(t,n,i.attributes,c);Pt.info(4,"createGLTFModel defines: ",m.defines)();const b=[],A={depthWriteEnabled:!0,depthCompare:"less",depthFormat:"depth24plus",cullMode:"back"},R={id:r,geometry:i,topology:i.topology,vertexCount:l,modules:[lT],vs:xM(t,lle),fs:xM(t,cle),...o,bindings:{...m.bindings,...o.bindings},defines:{...m.defines,...o.defines},parameters:{...A,...m.parameters,...o.parameters},uniforms:{...m.uniforms,...o.uniforms}},M=new jd(t,R);return new $2({managedResources:b,model:M})}function xM(t,e){return`#version 300 es
${e}`}const hle={modelOptions:{},pbrDebug:!1,imageBasedLightingEnvironment:null,lights:!0,useTangents:!1};class dle{device;options;gltf;constructor(e,r={}){this.device=e,this.options={...hle,...r}}instantiate(e){return this.gltf=e,(e.scenes||[]).map(r=>this.createScene(r))}createAnimator(){return Array.isArray(this.gltf.animations)?new tle(this.gltf):null}createScene(e){const r=(e.nodes||[]).map(i=>this.createNode(i));return new rg({id:e.name||e.id,children:r})}createNode(e){if(!e._node){const r=(e.children||[]).map(n=>this.createNode(n));e.mesh&&r.push(this.createMesh(e.mesh));const i=new rg({id:e.name||e.id,children:r});if(e.matrix)i.setMatrix(e.matrix);else{if(i.matrix.identity(),e.translation&&i.matrix.translate(e.translation),e.rotation){const n=new Kr().fromQuaternion(e.rotation);i.matrix.multiplyRight(n)}e.scale&&i.matrix.scale(e.scale)}e._node=i}return e._node}createMesh(e){if(!e._mesh){const r=(e.primitives||[]).map((n,l)=>this.createPrimitive(n,l,e)),i=new rg({id:e.name||e.id,children:r});e._mesh=i}return e._mesh}createPrimitive(e,r,i){const n=e.name||`${i.name||i.id}-primitive-${r}`,l=fle(e.mode||4),c=e.indices?e.indices.count:this.getVertexCount(e.attributes),o=ule(this.device,{id:n,geometry:this.createGeometry(n,e,l),material:e.material,materialOptions:this.options,modelOptions:this.options.modelOptions,vertexCount:c});return o.bounds=[e.attributes.POSITION.min,e.attributes.POSITION.max],o}getVertexCount(e){throw new Error("getVertexCount not implemented")}createGeometry(e,r,i){const n={};for(const[l,c]of Object.entries(r.attributes)){const{components:o,size:m,value:b}=c;n[l]={size:m??o,value:b}}return new tg({id:e,topology:i,indices:r.indices.value,attributes:n})}createBuffer(e,r){e.bufferView||(e.bufferView={});const{bufferView:i}=e;return i.lumaBuffers||(i.lumaBuffers={}),i.lumaBuffers[r]||(i.lumaBuffers[r]=this.device.createBuffer({id:`from-${i.id}`,data:i.data||e.value})),i.lumaBuffers[r]}createSampler(e){return e}needsPOT(){return!1}}var xh;(function(t){t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN"})(xh||(xh={}));function fle(t){switch(t){case xh.POINTS:return"point-list";case xh.LINES:return"line-list";case xh.LINE_STRIP:return"line-strip";case xh.LINE_LOOP:return"line-loop-webgl";case xh.TRIANGLES:return"triangle-list";case xh.TRIANGLE_STRIP:return"triangle-strip";case xh.TRIANGLE_FAN:return"triangle-fan-webgl";default:throw new Error(t)}}function ple(t,e,r){const i=new dle(t,r),n=i.instantiate(e),l=i.createAnimator();return{scenes:n,animator:l}}function il(t,e){if(!t)throw new Error(e||"assert failed: gltf")}const _D={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},yD={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},mle=1.33,wM=["SCALAR","VEC2","VEC3","VEC4"],gle=[[Int8Array,5120],[Uint8Array,5121],[Int16Array,5122],[Uint16Array,5123],[Uint32Array,5125],[Float32Array,5126],[Float64Array,5130]],_le=new Map(gle),yle={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},vle={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},ble={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function vD(t){return wM[t-1]||wM[0]}function cb(t){const e=_le.get(t.constructor);if(!e)throw new Error("Illegal typed array");return e}function ST(t,e){const r=ble[t.componentType],i=yle[t.type],n=vle[t.componentType],l=t.count*i,c=t.count*i*n;il(c>=0&&c<=e.byteLength);const o=yD[t.componentType],m=_D[t.type];return{ArrayType:r,length:l,byteLength:c,componentByteSize:o,numberOfComponentsInElement:m}}function bD(t){let{images:e,bufferViews:r}=t;e=e||[],r=r||[];const i=e.map(c=>c.bufferView);r=r.filter(c=>!i.includes(c));const n=r.reduce((c,o)=>c+o.byteLength,0),l=e.reduce((c,o)=>{const{width:m,height:b}=o.image;return c+m*b},0);return n+Math.ceil(4*l*mle)}function xle(t,e,r){const i=t.bufferViews[r];il(i);const n=i.buffer,l=e[n];il(l);const c=(i.byteOffset||0)+l.byteOffset;return new Uint8Array(l.arrayBuffer,c,i.byteLength)}function wle(t,e,r){const i=typeof r=="number"?t.accessors?.[r]:r;if(!i)throw new Error(`No gltf accessor ${JSON.stringify(r)}`);const n=t.bufferViews?.[i.bufferView||0];if(!n)throw new Error(`No gltf buffer view for accessor ${n}`);const{arrayBuffer:l,byteOffset:c}=e[n.buffer],o=(c||0)+(i.byteOffset||0)+(n.byteOffset||0),{ArrayType:m,length:b,componentByteSize:A,numberOfComponentsInElement:R}=ST(i,n),M=A*R,L=n.byteStride||M;if(typeof n.byteStride>"u"||n.byteStride===M)return new m(l,o,b);const G=new m(b);for(let V=0;V<i.count;V++){const q=new m(l,o+V*L,R);G.set(q,V*R)}return G}function Ele(){return{asset:{version:"2.0",generator:"loaders.gl"},buffers:[],extensions:{},extensionsRequired:[],extensionsUsed:[]}}class Vs{gltf;sourceBuffers;byteLength;constructor(e){this.gltf={json:e?.json||Ele(),buffers:e?.buffers||[],images:e?.images||[]},this.sourceBuffers=[],this.byteLength=0,this.gltf.buffers&&this.gltf.buffers[0]&&(this.byteLength=this.gltf.buffers[0].byteLength,this.sourceBuffers=[this.gltf.buffers[0]])}get json(){return this.gltf.json}getApplicationData(e){return this.json[e]}getExtraData(e){return(this.json.extras||{})[e]}hasExtension(e){const r=this.getUsedExtensions().find(n=>n===e),i=this.getRequiredExtensions().find(n=>n===e);return typeof r=="string"||typeof i=="string"}getExtension(e){const r=this.getUsedExtensions().find(n=>n===e),i=this.json.extensions||{};return r?i[e]:null}getRequiredExtension(e){return this.getRequiredExtensions().find(r=>r===e)?this.getExtension(e):null}getRequiredExtensions(){return this.json.extensionsRequired||[]}getUsedExtensions(){return this.json.extensionsUsed||[]}getRemovedExtensions(){return this.json.extensionsRemoved||[]}getObjectExtension(e,r){return(e.extensions||{})[r]}getScene(e){return this.getObject("scenes",e)}getNode(e){return this.getObject("nodes",e)}getSkin(e){return this.getObject("skins",e)}getMesh(e){return this.getObject("meshes",e)}getMaterial(e){return this.getObject("materials",e)}getAccessor(e){return this.getObject("accessors",e)}getTexture(e){return this.getObject("textures",e)}getSampler(e){return this.getObject("samplers",e)}getImage(e){return this.getObject("images",e)}getBufferView(e){return this.getObject("bufferViews",e)}getBuffer(e){return this.getObject("buffers",e)}getObject(e,r){if(typeof r=="object")return r;const i=this.json[e]&&this.json[e][r];if(!i)throw new Error(`glTF file error: Could not find ${e}[${r}]`);return i}getTypedArrayForBufferView(e){e=this.getBufferView(e);const r=e.buffer,i=this.gltf.buffers[r];il(i);const n=(e.byteOffset||0)+i.byteOffset;return new Uint8Array(i.arrayBuffer,n,e.byteLength)}getTypedArrayForAccessor(e){const r=this.getAccessor(e);return wle(this.gltf.json,this.gltf.buffers,r)}getTypedArrayForImageData(e){e=this.getAccessor(e);const r=this.getBufferView(e.bufferView),i=this.getBuffer(r.buffer).data,n=r.byteOffset||0;return new Uint8Array(i,n,r.byteLength)}addApplicationData(e,r){return this.json[e]=r,this}addExtraData(e,r){return this.json.extras=this.json.extras||{},this.json.extras[e]=r,this}addObjectExtension(e,r,i){return e.extensions=e.extensions||{},e.extensions[r]=i,this.registerUsedExtension(r),this}setObjectExtension(e,r,i){const n=e.extensions||{};n[r]=i}removeObjectExtension(e,r){const i=e?.extensions||{};if(i[r]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];const n=this.json.extensionsRemoved;n.includes(r)||n.push(r)}delete i[r]}addExtension(e,r={}){return il(r),this.json.extensions=this.json.extensions||{},this.json.extensions[e]=r,this.registerUsedExtension(e),r}addRequiredExtension(e,r={}){return il(r),this.addExtension(e,r),this.registerRequiredExtension(e),r}registerUsedExtension(e){this.json.extensionsUsed=this.json.extensionsUsed||[],this.json.extensionsUsed.find(r=>r===e)||this.json.extensionsUsed.push(e)}registerRequiredExtension(e){this.registerUsedExtension(e),this.json.extensionsRequired=this.json.extensionsRequired||[],this.json.extensionsRequired.find(r=>r===e)||this.json.extensionsRequired.push(e)}removeExtension(e){if(this.json.extensions?.[e]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];const r=this.json.extensionsRemoved;r.includes(e)||r.push(e)}this.json.extensions&&delete this.json.extensions[e],this.json.extensionsRequired&&this._removeStringFromArray(this.json.extensionsRequired,e),this.json.extensionsUsed&&this._removeStringFromArray(this.json.extensionsUsed,e)}setDefaultScene(e){this.json.scene=e}addScene(e){const{nodeIndices:r}=e;return this.json.scenes=this.json.scenes||[],this.json.scenes.push({nodes:r}),this.json.scenes.length-1}addNode(e){const{meshIndex:r,matrix:i}=e;this.json.nodes=this.json.nodes||[];const n={mesh:r};return i&&(n.matrix=i),this.json.nodes.push(n),this.json.nodes.length-1}addMesh(e){const{attributes:r,indices:i,material:n,mode:l=4}=e,c={primitives:[{attributes:this._addAttributes(r),mode:l}]};if(i){const o=this._addIndices(i);c.primitives[0].indices=o}return Number.isFinite(n)&&(c.primitives[0].material=n),this.json.meshes=this.json.meshes||[],this.json.meshes.push(c),this.json.meshes.length-1}addPointCloud(e){const r={primitives:[{attributes:this._addAttributes(e),mode:0}]};return this.json.meshes=this.json.meshes||[],this.json.meshes.push(r),this.json.meshes.length-1}addImage(e,r){const i=GA(e),n=r||i?.mimeType,l={bufferView:this.addBufferView(e),mimeType:n};return this.json.images=this.json.images||[],this.json.images.push(l),this.json.images.length-1}addBufferView(e,r=0,i=this.byteLength){const n=e.byteLength;il(Number.isFinite(n)),this.sourceBuffers=this.sourceBuffers||[],this.sourceBuffers.push(e);const l={buffer:r,byteOffset:i,byteLength:n};return this.byteLength+=Vy(n,4),this.json.bufferViews=this.json.bufferViews||[],this.json.bufferViews.push(l),this.json.bufferViews.length-1}addAccessor(e,r){const i={bufferView:e,type:vD(r.size),componentType:r.componentType,count:r.count,max:r.max,min:r.min};return this.json.accessors=this.json.accessors||[],this.json.accessors.push(i),this.json.accessors.length-1}addBinaryBuffer(e,r={size:3}){const i=this.addBufferView(e);let n={min:r.min,max:r.max};(!n.min||!n.max)&&(n=this._getAccessorMinMax(e,r.size));const l={size:r.size,componentType:cb(e),count:Math.round(e.length/r.size),min:n.min,max:n.max};return this.addAccessor(i,Object.assign(l,r))}addTexture(e){const{imageIndex:r}=e,i={source:r};return this.json.textures=this.json.textures||[],this.json.textures.push(i),this.json.textures.length-1}addMaterial(e){return this.json.materials=this.json.materials||[],this.json.materials.push(e),this.json.materials.length-1}createBinaryChunk(){const e=this.byteLength,r=new ArrayBuffer(e),i=new Uint8Array(r);let n=0;for(const l of this.sourceBuffers||[])n=zK(l,i,n);this.json?.buffers?.[0]?this.json.buffers[0].byteLength=e:this.json.buffers=[{byteLength:e}],this.gltf.binary=r,this.sourceBuffers=[r],this.gltf.buffers=[{arrayBuffer:r,byteOffset:0,byteLength:r.byteLength}]}_removeStringFromArray(e,r){let i=!0;for(;i;){const n=e.indexOf(r);n>-1?e.splice(n,1):i=!1}}_addAttributes(e={}){const r={};for(const i in e){const n=e[i],l=this._getGltfAttributeName(i),c=this.addBinaryBuffer(n.value,n);r[l]=c}return r}_addIndices(e){return this.addBinaryBuffer(e,{size:1})}_getGltfAttributeName(e){switch(e.toLowerCase()){case"position":case"positions":case"vertices":return"POSITION";case"normal":case"normals":return"NORMAL";case"color":case"colors":return"COLOR_0";case"texcoord":case"texcoords":return"TEXCOORD_0";default:return e}}_getAccessorMinMax(e,r){const i={min:null,max:null};if(e.length<r)return i;i.min=[],i.max=[];const n=e.subarray(0,r);for(const l of n)i.min.push(l),i.max.push(l);for(let l=r;l<e.length;l+=r)for(let c=0;c<r;c++)i.min[0+c]=Math.min(i.min[0+c],e[l+c]),i.max[0+c]=Math.max(i.max[0+c],e[l+c]);return i}}function EM(t){return(t%1+1)%1}const xD={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16,BOOLEAN:1,STRING:1,ENUM:1},Ale={INT8:Int8Array,UINT8:Uint8Array,INT16:Int16Array,UINT16:Uint16Array,INT32:Int32Array,UINT32:Uint32Array,INT64:BigInt64Array,UINT64:BigUint64Array,FLOAT32:Float32Array,FLOAT64:Float64Array},wD={INT8:1,UINT8:1,INT16:2,UINT16:2,INT32:4,UINT32:4,INT64:8,UINT64:8,FLOAT32:4,FLOAT64:8};function CT(t,e){return wD[e]*xD[t]}function ub(t,e,r,i){if(r!=="UINT8"&&r!=="UINT16"&&r!=="UINT32"&&r!=="UINT64")return null;const n=t.getTypedArrayForBufferView(e),l=hb(n,"SCALAR",r,i+1);return l instanceof BigInt64Array||l instanceof BigUint64Array?null:l}function hb(t,e,r,i=1){const n=xD[e],l=Ale[r],c=wD[r],o=i*n,m=o*c;let b=t.buffer,A=t.byteOffset;return A%c!==0&&(b=new Uint8Array(b).slice(A,A+m).buffer,A=0),new l(b,A,o)}function PT(t,e,r){const i=`TEXCOORD_${e.texCoord||0}`,n=r.attributes[i],l=t.getTypedArrayForAccessor(n),c=t.gltf.json,o=e.index,m=c.textures?.[o]?.source;if(typeof m<"u"){const b=c.images?.[m]?.mimeType,A=t.gltf.images?.[m];if(A&&typeof A.width<"u"){const R=[];for(let M=0;M<l.length;M+=2){const L=Tle(A,b,l,M,e.channels);R.push(L)}return R}}return[]}function ED(t,e,r,i,n){if(!r?.length)return;const l=[];for(const A of r){let R=i.findIndex(M=>M===A);R===-1&&(R=i.push(A)-1),l.push(R)}const c=new Uint32Array(l),o=t.gltf.buffers.push({arrayBuffer:c.buffer,byteOffset:c.byteOffset,byteLength:c.byteLength})-1,m=t.addBufferView(c,o,0),b=t.addAccessor(m,{size:1,componentType:cb(c),count:c.length});n.attributes[e]=b}function Tle(t,e,r,i,n=[0]){const l={r:{offset:0,shift:0},g:{offset:1,shift:8},b:{offset:2,shift:16},a:{offset:3,shift:24}},c=r[i],o=r[i+1];let m=1;e&&(e.indexOf("image/jpeg")!==-1||e.indexOf("image/png")!==-1)&&(m=4);const b=Sle(c,o,t,m);let A=0;for(const R of n){const M=typeof R=="number"?Object.values(l)[R]:l[R],L=b+M.offset,G=bL(t);if(G.data.length<=L)throw new Error(`${G.data.length} <= ${L}`);const V=G.data[L];A|=V<<M.shift}return A}function Sle(t,e,r,i=1){const n=r.width,l=EM(t)*(n-1),c=Math.round(l),o=r.height,m=EM(e)*(o-1),b=Math.round(m),A=r.components?r.components:i;return(b*n+c)*A}function AD(t,e,r,i,n){const l=[];for(let c=0;c<e;c++){const o=r[c],m=r[c+1]-r[c];if(m+o>i)break;const b=o/n,A=m/n;l.push(t.slice(b,b+A))}return l}function TD(t,e,r){const i=[];for(let n=0;n<e;n++){const l=n*r;i.push(t.slice(l,l+r))}return i}function SD(t,e,r,i){if(r)throw new Error("Not implemented - arrayOffsets for strings is specified");if(i){const n=[],l=new TextDecoder("utf8");let c=0;for(let o=0;o<t;o++){const m=i[o+1]-i[o];if(m+c<=e.length){const b=e.subarray(c,m+c),A=l.decode(b);n.push(A),c+=m}}return n}return[]}const ng="EXT_mesh_features",Cle=ng;async function Ple(t,e){const r=new Vs(t);Mle(r,e)}function Rle(t,e){const r=new Vs(t);return kle(r),r.createBinaryChunk(),r.gltf}function Mle(t,e){const r=t.gltf.json;if(r.meshes)for(const i of r.meshes)for(const n of i.primitives)Ile(t,n,e)}function Ile(t,e,r){if(!r?.gltf?.loadBuffers)return;const i=e.extensions?.[ng]?.featureIds;if(i)for(const n of i){let l;if(typeof n.attribute<"u"){const c=`_FEATURE_ID_${n.attribute}`,o=e.attributes[c];l=t.getTypedArrayForAccessor(o)}else typeof n.texture<"u"&&r?.gltf?.loadImages?l=PT(t,n.texture,e):l=[];n.data=l}}function kle(t,e){const r=t.gltf.json.meshes;if(r)for(const i of r)for(const n of i.primitives)Lle(t,n)}function Ble(t,e,r,i){e.extensions||(e.extensions={});let n=e.extensions[ng];n||(n={featureIds:[]},e.extensions[ng]=n);const{featureIds:l}=n,c={featureCount:r.length,propertyTable:i,data:r};l.push(c),t.addObjectExtension(e,ng,n)}function Lle(t,e){const r=e.extensions?.[ng];if(!r)return;const i=r.featureIds;i.forEach((n,l)=>{if(n.data){const{accessorKey:c,index:o}=Ole(e.attributes),m=new Uint32Array(n.data);i[l]={featureCount:m.length,propertyTable:n.propertyTable,attribute:o},t.gltf.buffers.push({arrayBuffer:m.buffer,byteOffset:m.byteOffset,byteLength:m.byteLength});const b=t.addBufferView(m),A=t.addAccessor(b,{size:1,componentType:cb(m),count:m.length});e.attributes[c]=A}})}function Ole(t){const e="_FEATURE_ID_",r=Object.keys(t).filter(n=>n.indexOf(e)===0);let i=-1;for(const n of r){const l=Number(n.substring(e.length));l>i&&(i=l)}return i++,{accessorKey:`${e}${i}`,index:i}}const Dle=Object.freeze(Object.defineProperty({__proto__:null,createExtMeshFeatures:Ble,decode:Ple,encode:Rle,name:Cle},Symbol.toStringTag,{value:"Module"})),mg="EXT_structural_metadata",Nle=mg;async function Fle(t,e){const r=new Vs(t);jle(r,e)}function zle(t,e){const r=new Vs(t);return rce(r),r.createBinaryChunk(),r.gltf}function jle(t,e){if(!e.gltf?.loadBuffers)return;const r=t.getExtension(mg);r&&(e.gltf?.loadImages&&Ule(t,r),Vle(t,r))}function Ule(t,e){const r=e.propertyTextures,i=t.gltf.json;if(r&&i.meshes)for(const n of i.meshes)for(const l of n.primitives)Hle(t,r,l,e)}function Vle(t,e){const r=e.schema;if(!r)return;const i=r.classes,n=e.propertyTables;if(i&&n)for(const l in i){const c=Gle(n,l);c&&Wle(t,r,c)}}function Gle(t,e){for(const r of t)if(r.class===e)return r;return null}function Hle(t,e,r,i){if(!e)return;const n=r.extensions?.[mg]?.propertyTextures;if(n)for(const l of n){const c=e[l];$le(t,c,r,i)}}function $le(t,e,r,i){if(!e.properties)return;i.dataAttributeNames||(i.dataAttributeNames=[]);const n=e.class;for(const l in e.properties){const c=`${n}_${l}`,o=e.properties?.[l];if(!o)continue;o.data||(o.data=[]);const m=o.data,b=PT(t,o,r);b!==null&&(ED(t,c,b,m,r),o.data=m,i.dataAttributeNames.push(c))}}function Wle(t,e,r){const i=e.classes?.[r.class];if(!i)throw new Error(`Incorrect data in the EXT_structural_metadata extension: no schema class with name ${r.class}`);const n=r.count;for(const l in i.properties){const c=i.properties[l],o=r.properties?.[l];if(o){const m=qle(t,e,c,n,o);o.data=m}}}function qle(t,e,r,i,n){let l=[];const c=n.values,o=t.getTypedArrayForBufferView(c),m=Kle(t,r,n,i),b=Zle(t,n,i);switch(r.type){case"SCALAR":case"VEC2":case"VEC3":case"VEC4":case"MAT2":case"MAT3":case"MAT4":{l=Xle(r,i,o,m);break}case"BOOLEAN":throw new Error(`Not implemented - classProperty.type=${r.type}`);case"STRING":{l=SD(i,o,m,b);break}case"ENUM":{l=Yle(e,r,i,o,m);break}default:throw new Error(`Unknown classProperty type ${r.type}`)}return l}function Kle(t,e,r,i){return e.array&&typeof e.count>"u"&&typeof r.arrayOffsets<"u"?ub(t,r.arrayOffsets,r.arrayOffsetType||"UINT32",i):null}function Zle(t,e,r){return typeof e.stringOffsets<"u"?ub(t,e.stringOffsets,e.stringOffsetType||"UINT32",r):null}function Xle(t,e,r,i){const n=t.array,l=t.count,c=CT(t.type,t.componentType),o=r.byteLength/c;let m;return t.componentType?m=hb(r,t.type,t.componentType,o):m=r,n?i?AD(m,e,i,r.length,c):l?TD(m,e,l):[]:m}function Yle(t,e,r,i,n){const l=e.enumType;if(!l)throw new Error("Incorrect data in the EXT_structural_metadata extension: classProperty.enumType is not set for type ENUM");const c=t.enums?.[l];if(!c)throw new Error(`Incorrect data in the EXT_structural_metadata extension: schema.enums does't contain ${l}`);const o=c.valueType||"UINT16",m=CT(e.type,o),b=i.byteLength/m;let A=hb(i,e.type,o,b);if(A||(A=i),e.array){if(n)return Jle({valuesData:A,numberOfElements:r,arrayOffsets:n,valuesDataBytesLength:i.length,elementSize:m,enumEntry:c});const R=e.count;return R?Qle(A,r,R,c):[]}return RT(A,0,r,c)}function Jle(t){const{valuesData:e,numberOfElements:r,arrayOffsets:i,valuesDataBytesLength:n,elementSize:l,enumEntry:c}=t,o=[];for(let m=0;m<r;m++){const b=i[m],A=i[m+1]-i[m];if(A+b>n)break;const R=b/l,M=A/l,L=RT(e,R,M,c);o.push(L)}return o}function Qle(t,e,r,i){const n=[];for(let l=0;l<e;l++){const c=r*l,o=RT(t,c,r,i);n.push(o)}return n}function RT(t,e,r,i){const n=[];for(let l=0;l<r;l++)if(t instanceof BigInt64Array||t instanceof BigUint64Array)n.push("");else{const c=t[e+l],o=ece(i,c);o?n.push(o.name):n.push("")}return n}function ece(t,e){for(const r of t.values)if(r.value===e)return r;return null}const tce="schemaClassId";function rce(t,e){const r=t.getExtension(mg);if(r&&r.propertyTables)for(const i of r.propertyTables){const n=i.class,l=r.schema?.classes?.[n];i.properties&&l&&ice(i,l,t)}}function ice(t,e,r){for(const i in t.properties){const n=t.properties[i].data;if(n){const l=e.properties[i];if(l){const c=ace(n,l,r);t.properties[i]=c}}}}function nce(t,e,r=tce){let i=t.getExtension(mg);i||(i=t.addExtension(mg)),i.schema=sce(e,r,i.schema);const n=oce(e,r,i.schema);return i.propertyTables||(i.propertyTables=[]),i.propertyTables.push(n)-1}function sce(t,e,r){const i=r??{id:"schema_id"},n={properties:{}};for(const l of t){const c={type:l.elementType,componentType:l.componentType};n.properties[l.name]=c}return i.classes={},i.classes[e]=n,i}function oce(t,e,r){const i={class:e,count:0};let n=0;const l=r.classes?.[e];for(const c of t){if(n===0&&(n=c.values.length),n!==c.values.length&&c.values.length)throw new Error("Illegal values in attributes");l?.properties[c.name]&&(i.properties||(i.properties={}),i.properties[c.name]={values:0,data:c.values})}return i.count=n,i}function ace(t,e,r){const i={values:0};if(e.type==="STRING"){const{stringData:n,stringOffsets:l}=uce(t);i.stringOffsets=dw(l,r),i.values=dw(n,r)}else if(e.type==="SCALAR"&&e.componentType){const n=cce(t,e.componentType);i.values=dw(n,r)}return i}const lce={INT8:Int8Array,UINT8:Uint8Array,INT16:Int16Array,UINT16:Uint16Array,INT32:Int32Array,UINT32:Uint32Array,INT64:Int32Array,UINT64:Uint32Array,FLOAT32:Float32Array,FLOAT64:Float64Array};function cce(t,e){const r=[];for(const n of t)r.push(Number(n));const i=lce[e];if(!i)throw new Error("Illegal component type");return new i(r)}function uce(t){const e=new TextEncoder,r=[];let i=0;for(const m of t){const b=e.encode(m);i+=b.length,r.push(b)}const n=new Uint8Array(i),l=[];let c=0;for(const m of r)n.set(m,c),l.push(c),c+=m.length;l.push(c);const o=new Uint32Array(l);return{stringData:n,stringOffsets:o}}function dw(t,e){return e.gltf.buffers.push({arrayBuffer:t.buffer,byteOffset:t.byteOffset,byteLength:t.byteLength}),e.addBufferView(t)}const hce=Object.freeze(Object.defineProperty({__proto__:null,createExtStructuralMetadata:nce,decode:Fle,encode:zle,name:Nle},Symbol.toStringTag,{value:"Module"})),CD="EXT_feature_metadata",dce=CD;async function fce(t,e){const r=new Vs(t);pce(r,e)}function pce(t,e){if(!e.gltf?.loadBuffers)return;const r=t.getExtension(CD);r&&(e.gltf?.loadImages&&mce(t,r),gce(t,r))}function mce(t,e){const r=e.schema;if(!r)return;const i=r.classes,{featureTextures:n}=e;if(i&&n)for(const l in i){const c=i[l],o=yce(n,l);o&&bce(t,o,c)}}function gce(t,e){const r=e.schema;if(!r)return;const i=r.classes,n=e.featureTables;if(i&&n)for(const l in i){const c=_ce(n,l);c&&vce(t,r,c)}}function _ce(t,e){for(const r in t){const i=t[r];if(i.class===e)return i}return null}function yce(t,e){for(const r in t){const i=t[r];if(i.class===e)return i}return null}function vce(t,e,r){if(!r.class)return;const i=e.classes?.[r.class];if(!i)throw new Error(`Incorrect data in the EXT_structural_metadata extension: no schema class with name ${r.class}`);const n=r.count;for(const l in i.properties){const c=i.properties[l],o=r.properties?.[l];if(o){const m=xce(t,e,c,n,o);o.data=m}}}function bce(t,e,r){const i=e.class;for(const n in r.properties){const l=e?.properties?.[n];if(l){const c=Sce(t,l,i);l.data=c}}}function xce(t,e,r,i,n){let l=[];const c=n.bufferView,o=t.getTypedArrayForBufferView(c),m=wce(t,r,n,i),b=Ece(t,r,n,i);return r.type==="STRING"||r.componentType==="STRING"?l=SD(i,o,m,b):Ace(r)&&(l=Tce(r,i,o,m)),l}function wce(t,e,r,i){return e.type==="ARRAY"&&typeof e.componentCount>"u"&&typeof r.arrayOffsetBufferView<"u"?ub(t,r.arrayOffsetBufferView,r.offsetType||"UINT32",i):null}function Ece(t,e,r,i){return typeof r.stringOffsetBufferView<"u"?ub(t,r.stringOffsetBufferView,r.offsetType||"UINT32",i):null}function Ace(t){const e=["UINT8","INT16","UINT16","INT32","UINT32","INT64","UINT64","FLOAT32","FLOAT64"];return e.includes(t.type)||typeof t.componentType<"u"&&e.includes(t.componentType)}function Tce(t,e,r,i){const n=t.type==="ARRAY",l=t.componentCount,c="SCALAR",o=t.componentType||t.type,m=CT(c,o),b=r.byteLength/m,A=hb(r,c,o,b);return n?i?AD(A,e,i,r.length,m):l?TD(A,e,l):[]:A}function Sce(t,e,r){const i=t.gltf.json;if(!i.meshes)return[];const n=[];for(const l of i.meshes)for(const c of l.primitives)Cce(t,r,e,n,c);return n}function Cce(t,e,r,i,n){const l={channels:r.channels,...r.texture},c=PT(t,l,n);c&&ED(t,e,c,i,n)}const Pce=Object.freeze(Object.defineProperty({__proto__:null,decode:fce,name:dce},Symbol.toStringTag,{value:"Module"})),Rce="4.3.1",gg=!0,AM=1735152710,MT=12,A1=8,Mce=1313821514,Ice=5130562,kce=0,Bce=0,Lce=1;function Oce(t,e=0){return`${String.fromCharCode(t.getUint8(e+0))}${String.fromCharCode(t.getUint8(e+1))}${String.fromCharCode(t.getUint8(e+2))}${String.fromCharCode(t.getUint8(e+3))}`}function Dce(t,e=0,r={}){const i=new DataView(t),{magic:n=AM}=r,l=i.getUint32(e,!1);return l===n||l===AM}function Nce(t,e,r=0,i={}){const n=new DataView(e),l=Oce(n,r+0),c=n.getUint32(r+4,gg),o=n.getUint32(r+8,gg);switch(Object.assign(t,{header:{byteOffset:r,byteLength:o,hasBinChunk:!1},type:l,version:c,json:{},binChunks:[]}),r+=MT,t.version){case 1:return Fce(t,n,r);case 2:return zce(t,n,r,i={});default:throw new Error(`Invalid GLB version ${t.version}. Only supports version 1 and 2.`)}}function Fce(t,e,r){Ni(t.header.byteLength>MT+A1);const i=e.getUint32(r+0,gg),n=e.getUint32(r+4,gg);return r+=A1,Ni(n===kce),oE(t,e,r,i),r+=i,r+=aE(t,e,r,t.header.byteLength),r}function zce(t,e,r,i){return Ni(t.header.byteLength>MT+A1),jce(t,e,r,i),r+t.header.byteLength}function jce(t,e,r,i){for(;r+8<=t.header.byteLength;){const n=e.getUint32(r+0,gg),l=e.getUint32(r+4,gg);switch(r+=A1,l){case Mce:oE(t,e,r,n);break;case Ice:aE(t,e,r,n);break;case Bce:i.strict||oE(t,e,r,n);break;case Lce:i.strict||aE(t,e,r,n);break}r+=Vy(n,4)}return r}function oE(t,e,r,i){const n=new Uint8Array(e.buffer,r,i),l=new TextDecoder("utf8").decode(n);return t.json=JSON.parse(l),Vy(i,4)}function aE(t,e,r,i){return t.header.hasBinChunk=!0,t.binChunks.push({byteOffset:r,byteLength:i,arrayBuffer:e.buffer}),Vy(i,4)}function PD(t,e){if(t.startsWith("data:")||t.startsWith("http:")||t.startsWith("https:"))return t;const r=e.baseUri||e.uri;if(!r)throw new Error(`'baseUri' must be provided to resolve relative url ${t}`);return r.substr(0,r.lastIndexOf("/")+1)+t}const Uce="B9h9z9tFBBBF8fL9gBB9gLaaaaaFa9gEaaaB9gFaFa9gEaaaFaEMcBFFFGGGEIIILF9wFFFLEFBFKNFaFCx/IFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBF8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBGy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBEn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBIi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBKI9z9iqlBOc+x8ycGBM/qQFTa8jUUUUBCU/EBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAGTkUUUBRNCUoBAG9uC/wgBZHKCUGAKCUG9JyRVAECFJRICBRcGXEXAcAF9PQFAVAFAclAcAVJAF9JyRMGXGXAG9FQBAMCbJHKC9wZRSAKCIrCEJCGrRQANCUGJRfCBRbAIRTEXGXAOATlAQ9PQBCBRISEMATAQJRIGXAS9FQBCBRtCBREEXGXAOAIlCi9PQBCBRISLMANCU/CBJAEJRKGXGXGXGXGXATAECKrJ2BBAtCKZrCEZfIBFGEBMAKhB83EBAKCNJhB83EBSEMAKAI2BIAI2BBHmCKrHYAYCE6HYy86BBAKCFJAICIJAYJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCGJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCEJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCIJAYAmJHY2BBAI2BFHmCKrHPAPCE6HPy86BBAKCLJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCKJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCOJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCNJAYAmJHY2BBAI2BGHmCKrHPAPCE6HPy86BBAKCVJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCcJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCMJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCSJAYAmJHm2BBAI2BEHICKrHYAYCE6HYy86BBAKCQJAmAYJHm2BBAICIrCEZHYAYCE6HYy86BBAKCfJAmAYJHm2BBAICGrCEZHYAYCE6HYy86BBAKCbJAmAYJHK2BBAICEZHIAICE6HIy86BBAKAIJRISGMAKAI2BNAI2BBHmCIrHYAYCb6HYy86BBAKCFJAICNJAYJHY2BBAmCbZHmAmCb6Hmy86BBAKCGJAYAmJHm2BBAI2BFHYCIrHPAPCb6HPy86BBAKCEJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCIJAmAYJHm2BBAI2BGHYCIrHPAPCb6HPy86BBAKCLJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCKJAmAYJHm2BBAI2BEHYCIrHPAPCb6HPy86BBAKCOJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCNJAmAYJHm2BBAI2BIHYCIrHPAPCb6HPy86BBAKCVJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCcJAmAYJHm2BBAI2BLHYCIrHPAPCb6HPy86BBAKCMJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCSJAmAYJHm2BBAI2BKHYCIrHPAPCb6HPy86BBAKCQJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCfJAmAYJHm2BBAI2BOHICIrHYAYCb6HYy86BBAKCbJAmAYJHK2BBAICbZHIAICb6HIy86BBAKAIJRISFMAKAI8pBB83BBAKCNJAICNJ8pBB83BBAICTJRIMAtCGJRtAECTJHEAS9JQBMMGXAIQBCBRISEMGXAM9FQBANAbJ2BBRtCBRKAfREEXAEANCU/CBJAKJ2BBHTCFrCBATCFZl9zAtJHt86BBAEAGJREAKCFJHKAM9HQBMMAfCFJRfAIRTAbCFJHbAG9HQBMMABAcAG9sJANCUGJAMAG9sTkUUUBpANANCUGJAMCaJAG9sJAGTkUUUBpMAMCBAIyAcJRcAIQBMC9+RKSFMCBC99AOAIlAGCAAGCA9Ly6yRKMALCU/EBJ8kUUUUBAKM+OmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUFT+JUUUBpALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM+lLKFaF99GaG99FaG99GXGXAGCI9HQBAF9FQFEXGXGX9DBBB8/9DBBB+/ABCGJHG1BB+yAB1BBHE+yHI+L+TABCFJHL1BBHK+yHO+L+THN9DBBBB9gHVyAN9DBB/+hANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE86BBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG86BBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG86BBABCIJRBAFCaJHFQBSGMMAF9FQBEXGXGX9DBBB8/9DBBB+/ABCIJHG8uFB+yAB8uFBHE+yHI+L+TABCGJHL8uFBHK+yHO+L+THN9DBBBB9gHVyAN9DB/+g6ANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE87FBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG87FBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG87FBABCNJRBAFCaJHFQBMMM/SEIEaE99EaF99GXAF9FQBCBREABRIEXGXGX9D/zI818/AICKJ8uFBHLCEq+y+VHKAI8uFB+y+UHO9DB/+g6+U9DBBB8/9DBBB+/AO9DBBBB9gy+SHN+L9DBBB9P9d9FQBAN+oRVSFMCUUUU94RVMAICIJ8uFBRcAICGJ8uFBRMABALCFJCEZAEqCFWJAV87FBGXGXAKAM+y+UHN9DB/+g6+U9DBBB8/9DBBB+/AN9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRMSFMCUUUU94RMMABALCGJCEZAEqCFWJAM87FBGXGXAKAc+y+UHK9DB/+g6+U9DBBB8/9DBBB+/AK9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRcSFMCUUUU94RcMABALCaJCEZAEqCFWJAc87FBGXGX9DBBU8/AOAO+U+TANAN+U+TAKAK+U+THO9DBBBBAO9DBBBB9gy+R9DB/+g6+U9DBBB8/+SHO+L9DBBB9P9d9FQBAO+oRcSFMCUUUU94RcMABALCEZAEqCFWJAc87FBAICNJRIAECIJREAFCaJHFQBMMM9JBGXAGCGrAF9sHF9FQBEXABAB8oGBHGCNWCN91+yAGCi91CnWCUUU/8EJ+++U84GBABCIJRBAFCaJHFQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEM/lFFFaGXGXAFABqCEZ9FQBABRESFMGXGXAGCT9PQBABRESFMABREEXAEAF8oGBjGBAECIJAFCIJ8oGBjGBAECNJAFCNJ8oGBjGBAECSJAFCSJ8oGBjGBAECTJREAFCTJRFAGC9wJHGCb9LQBMMAGCI9JQBEXAEAF8oGBjGBAFCIJRFAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF2BB86BBAECFJREAFCFJRFAGCaJHGQBMMABMoFFGaGXGXABCEZ9FQBABRESFMAFCgFZC+BwsN9sRIGXGXAGCT9PQBABRESFMABREEXAEAIjGBAECSJAIjGBAECNJAIjGBAECIJAIjGBAECTJREAGC9wJHGCb9LQBMMAGCI9JQBEXAEAIjGBAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF86BBAECFJREAGCaJHGQBMMABMMMFBCUNMIT9kBB",Vce="B9h9z9tFBBBF8dL9gBB9gLaaaaaFa9gEaaaB9gGaaB9gFaFaEQSBBFBFFGEGEGIILF9wFFFLEFBFKNFaFCx/aFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBG8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBIy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBKi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBNn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBcI9z9iqlBMc/j9JSIBTEM9+FLa8jUUUUBCTlRBCBRFEXCBRGCBREEXABCNJAGJAECUaAFAGrCFZHIy86BBAEAIJREAGCFJHGCN9HQBMAFCx+YUUBJAE86BBAFCEWCxkUUBJAB8pEN83EBAFCFJHFCUG9HQBMMkRIbaG97FaK978jUUUUBCU/KBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAG/8cBBCUoBAG9uC/wgBZHKCUGAKCUG9JyRNAECFJRKCBRVGXEXAVAF9PQFANAFAVlAVANJAF9JyRcGXGXAG9FQBAcCbJHIC9wZHMCE9sRSAMCFWRQAICIrCEJCGrRfCBRbEXAKRTCBRtGXEXGXAOATlAf9PQBCBRKSLMALCU/CBJAtAM9sJRmATAfJRKCBREGXAMCoB9JQBAOAKlC/gB9JQBCBRIEXAmAIJREGXGXGXGXGXATAICKrJ2BBHYCEZfIBFGEBMAECBDtDMIBSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIBAKCTJRKMGXGXGXGXGXAYCGrCEZfIBFGEBMAECBDtDMITSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMITAKCTJRKMGXGXGXGXGXAYCIrCEZfIBFGEBMAECBDtDMIASEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIAAKCTJRKMGXGXGXGXGXAYCKrfIBFGEBMAECBDtDMI8wSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCIJAnDeBJAYCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCNJAnDeBJAYCx+YUUBJ2BBJRKSFMAEAKDBBBDMI8wAKCTJRKMAICoBJREAICUFJAM9LQFAERIAOAKlC/fB9LQBMMGXAEAM9PQBAECErRIEXGXAOAKlCi9PQBCBRKSOMAmAEJRYGXGXGXGXGXATAECKrJ2BBAICKZrCEZfIBFGEBMAYCBDtDMIBSEMAYAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAYAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAYAKDBBBDMIBAKCTJRKMAICGJRIAECTJHEAM9JQBMMGXAK9FQBAKRTAtCFJHtCI6QGSFMMCBRKSEMGXAM9FQBALCUGJAbJREALAbJDBGBRnCBRYEXAEALCU/CBJAYJHIDBIBHdCFD9tAdCFDbHPD9OD9hD9RHdAIAMJDBIBHiCFD9tAiAPD9OD9hD9RHiDQBTFtGmEYIPLdKeOnH8ZAIAQJDBIBHpCFD9tApAPD9OD9hD9RHpAIASJDBIBHyCFD9tAyAPD9OD9hD9RHyDQBTFtGmEYIPLdKeOnH8cDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGEAnD9uHnDyBjGBAEAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnA8ZA8cDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNiV8ZcpMyS8cQ8df8eb8fHdApAyDQNiV8ZcpMyS8cQ8df8eb8fHiDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJREAYCTJHYAM9JQBMMAbCIJHbAG9JQBMMABAVAG9sJALCUGJAcAG9s/8cBBALALCUGJAcCaJAG9sJAG/8cBBMAcCBAKyAVJRVAKQBMC9+RKSFMCBC99AOAKlAGCAAGCA9Ly6yRKMALCU/KBJ8kUUUUBAKMNBT+BUUUBM+KmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUF/8MBALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM/xLGEaK978jUUUUBCAlHE8kUUUUBGXGXAGCI9HQBGXAFC98ZHI9FQBABRGCBRLEXAGAGDBBBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMBBAGCTJRGALCIJHLAI9JQBMMAIAF9PQFAEAFCEZHLCGWHGqCBCTAGl/8MBAEABAICGWJHIAG/8cBBGXAL9FQBAEAEDBIBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMIBMAIAEAG/8cBBSFMABAFC98ZHGT+HUUUBAGAF9PQBAEAFCEZHICEWHLJCBCAALl/8MBAEABAGCEWJHGAL/8cBBAEAIT+HUUUBAGAEAL/8cBBMAECAJ8kUUUUBM+yEGGaO97GXAF9FQBCBRGEXABCTJHEAEDBBBHICBDtHLCUU98D8cFCUU98D8cEHKD9OABDBBBHOAIDQILKOSQfbPden8c8d8e8fCggFDtD9OD/6FAOAIDQBFGENVcMTtmYi8ZpyHICTD+sFD/6FHND/gFAICTD+rFCTD+sFD/6FHVD/gFD/kFD/lFHI9DB/+g6DYAVAIALD+2FHLAVCUUUU94DtHcD9OD9RD/kFHVAVD/mFAIAID/mFANALANAcD9OD9RD/kFHIAID/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHLD/kFCTD+rFAVAND/mFALD/kFCggEDtD9OD9QHVAIAND/mFALD/kFCaDbCBDnGCBDnECBDnKCBDnOCBDncCBDnMCBDnfCBDnbD9OHIDQNVi8ZcMpySQ8c8dfb8e8fD9QDMBBABAOAKD9OAVAIDQBFTtGEmYILPdKOenD9QDMBBABCAJRBAGCIJHGAF9JQBMMM94FEa8jUUUUBCAlHE8kUUUUBABAFC98ZHIT+JUUUBGXAIAF9PQBAEAFCEZHLCEWHFJCBCAAFl/8MBAEABAICEWJHBAF/8cBBAEALT+JUUUBABAEAF/8cBBMAECAJ8kUUUUBM/hEIGaF97FaL978jUUUUBCTlRGGXAF9FQBCBREEXAGABDBBBHIABCTJHLDBBBHKDQILKOSQfbPden8c8d8e8fHOCTD+sFHNCID+rFDMIBAB9DBBU8/DY9D/zI818/DYANCEDtD9QD/6FD/nFHNAIAKDQBFGENVcMTtmYi8ZpyHICTD+rFCTD+sFD/6FD/mFHKAKD/mFANAICTD+sFD/6FD/mFHVAVD/mFANAOCTD+rFCTD+sFD/6FD/mFHOAOD/mFD/kFD/kFD/lFCBDtD+4FD/jF9DB/+g6DYHND/mF9DBBX9LDYHID/kFCggEDtHcD9OAVAND/mFAID/kFCTD+rFD9QHVAOAND/mFAID/kFCTD+rFAKAND/mFAID/kFAcD9OD9QHNDQBFTtGEmYILPdKOenHID8dBAGDBIBDyB+t+J83EBABCNJAID8dFAGDBIBDyF+t+J83EBALAVANDQNVi8ZcMpySQ8c8dfb8e8fHND8dBAGDBIBDyG+t+J83EBABCiJAND8dFAGDBIBDyE+t+J83EBABCAJRBAECIJHEAF9JQBMMM/3FGEaF978jUUUUBCoBlREGXAGCGrAF9sHIC98ZHL9FQBCBRGABRFEXAFAFDBBBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMBBAFCTJRFAGCIJHGAL9JQBMMGXALAI9PQBAEAICEZHGCGWHFqCBCoBAFl/8MBAEABALCGWJHLAF/8cBBGXAG9FQBAEAEDBIBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMIBMALAEAF/8cBBMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEMMMFBCUNMIT9tBB",Gce=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),Hce=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]),$ce={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},Wce={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};async function qce(t,e,r,i,n,l="NONE"){const c=await Kce();Yce(c,c.exports[Wce[n]],t,e,r,i,c.exports[$ce[l||"NONE"]])}let fw;async function Kce(){return fw||(fw=Zce()),fw}async function Zce(){let t=Uce;WebAssembly.validate(Gce)&&(t=Vce,console.log("Warning: meshopt_decoder is using experimental SIMD support"));const e=await WebAssembly.instantiate(Xce(t),{});return await e.instance.exports.__wasm_call_ctors(),e.instance}function Xce(t){const e=new Uint8Array(t.length);for(let i=0;i<t.length;++i){const n=t.charCodeAt(i);e[i]=n>96?n-71:n>64?n-65:n>47?n+4:n>46?63:62}let r=0;for(let i=0;i<t.length;++i)e[r++]=e[i]<60?Hce[e[i]]:(e[i]-60)*64+e[++i];return e.buffer.slice(0,r)}function Yce(t,e,r,i,n,l,c){const o=t.exports.sbrk,m=i+3&-4,b=o(m*n),A=o(l.length),R=new Uint8Array(t.exports.memory.buffer);R.set(l,A);const M=e(b,i,n,A,l.length);if(M===0&&c&&c(b,m,n),r.set(R.subarray(b,b+i*n)),o(b-o(0)),M!==0)throw new Error(`Malformed buffer data: ${M}`)}const T1="EXT_meshopt_compression",Jce=T1;async function Qce(t,e){const r=new Vs(t);if(!e?.gltf?.decompressMeshes||!e.gltf?.loadBuffers)return;const i=[];for(const n of t.json.bufferViews||[])i.push(eue(r,n));await Promise.all(i),r.removeExtension(T1)}async function eue(t,e){const r=t.getObjectExtension(e,T1);if(r){const{byteOffset:i=0,byteLength:n=0,byteStride:l,count:c,mode:o,filter:m="NONE",buffer:b}=r,A=t.gltf.buffers[b],R=new Uint8Array(A.arrayBuffer,A.byteOffset+i,n),M=new Uint8Array(t.gltf.buffers[e.buffer].arrayBuffer,e.byteOffset,e.byteLength);await qce(M,c,l,R,o,m),t.removeObjectExtension(e,T1)}}const tue=Object.freeze(Object.defineProperty({__proto__:null,decode:Qce,name:Jce},Symbol.toStringTag,{value:"Module"})),Om="EXT_texture_webp",rue=Om;function iue(t,e){const r=new Vs(t);if(!LX("image/webp")){if(r.getRequiredExtensions().includes(Om))throw new Error(`gltf: Required extension ${Om} not supported by browser`);return}const{json:i}=r;for(const n of i.textures||[]){const l=r.getObjectExtension(n,Om);l&&(n.source=l.source),r.removeObjectExtension(n,Om)}r.removeExtension(Om)}const nue=Object.freeze(Object.defineProperty({__proto__:null,name:rue,preprocess:iue},Symbol.toStringTag,{value:"Module"})),Wv="KHR_texture_basisu",sue=Wv;function oue(t,e){const r=new Vs(t),{json:i}=r;for(const n of i.textures||[]){const l=r.getObjectExtension(n,Wv);l&&(n.source=l.source,r.removeObjectExtension(n,Wv))}r.removeExtension(Wv)}const aue=Object.freeze(Object.defineProperty({__proto__:null,name:sue,preprocess:oue},Symbol.toStringTag,{value:"Module"})),lue="4.3.1",cue={dataType:null,batchType:null,name:"Draco",id:"draco",module:"draco",version:lue,worker:!0,extensions:["drc"],mimeTypes:["application/octet-stream"],binary:!0,tests:["DRACO"],options:{draco:{decoderType:typeof WebAssembly=="object"?"wasm":"js",libraryPath:"libs/",extraAttributes:{},attributeNameEntry:void 0}}};function uue(t,e,r){const i=RD(e.metadata),n=[],l=hue(e.attributes);for(const c in t){const o=t[c],m=TM(c,o,l[c]);n.push(m)}if(r){const c=TM("indices",r);n.push(c)}return{fields:n,metadata:i}}function hue(t){const e={};for(const r in t){const i=t[r];e[i.name||"undefined"]=i}return e}function TM(t,e,r){const i=r?RD(r.metadata):void 0;return eX(t,e,i)}function RD(t){Object.entries(t);const e={};for(const r in t)e[`${r}.string`]=JSON.stringify(t[r]);return e}const SM={POSITION:"POSITION",NORMAL:"NORMAL",COLOR:"COLOR_0",TEX_COORD:"TEXCOORD_0"},due={1:Int8Array,2:Uint8Array,3:Int16Array,4:Uint16Array,5:Int32Array,6:Uint32Array,9:Float32Array},fue=4;class pue{draco;decoder;metadataQuerier;constructor(e){this.draco=e,this.decoder=new this.draco.Decoder,this.metadataQuerier=new this.draco.MetadataQuerier}destroy(){this.draco.destroy(this.decoder),this.draco.destroy(this.metadataQuerier)}parseSync(e,r={}){const i=new this.draco.DecoderBuffer;i.Init(new Int8Array(e),e.byteLength),this._disableAttributeTransforms(r);const n=this.decoder.GetEncodedGeometryType(i),l=n===this.draco.TRIANGULAR_MESH?new this.draco.Mesh:new this.draco.PointCloud;try{let c;switch(n){case this.draco.TRIANGULAR_MESH:c=this.decoder.DecodeBufferToMesh(i,l);break;case this.draco.POINT_CLOUD:c=this.decoder.DecodeBufferToPointCloud(i,l);break;default:throw new Error("DRACO: Unknown geometry type.")}if(!c.ok()||!l.ptr){const R=`DRACO decompression failed: ${c.error_msg()}`;throw new Error(R)}const o=this._getDracoLoaderData(l,n,r),m=this._getMeshData(l,o,r),b=vL(m.attributes),A=uue(m.attributes,o,m.indices);return{loader:"draco",loaderData:o,header:{vertexCount:l.num_points(),boundingBox:b},...m,schema:A}}finally{this.draco.destroy(i),l&&this.draco.destroy(l)}}_getDracoLoaderData(e,r,i){const n=this._getTopLevelMetadata(e),l=this._getDracoAttributes(e,i);return{geometry_type:r,num_attributes:e.num_attributes(),num_points:e.num_points(),num_faces:e instanceof this.draco.Mesh?e.num_faces():0,metadata:n,attributes:l}}_getDracoAttributes(e,r){const i={};for(let n=0;n<e.num_attributes();n++){const l=this.decoder.GetAttribute(e,n),c=this._getAttributeMetadata(e,n);i[l.unique_id()]={unique_id:l.unique_id(),attribute_type:l.attribute_type(),data_type:l.data_type(),num_components:l.num_components(),byte_offset:l.byte_offset(),byte_stride:l.byte_stride(),normalized:l.normalized(),attribute_index:n,metadata:c};const o=this._getQuantizationTransform(l,r);o&&(i[l.unique_id()].quantization_transform=o);const m=this._getOctahedronTransform(l,r);m&&(i[l.unique_id()].octahedron_transform=m)}return i}_getMeshData(e,r,i){const n=this._getMeshAttributes(r,e,i);if(!n.POSITION)throw new Error("DRACO: No position attribute found.");if(e instanceof this.draco.Mesh)switch(i.topology){case"triangle-strip":return{topology:"triangle-strip",mode:4,attributes:n,indices:{value:this._getTriangleStripIndices(e),size:1}};case"triangle-list":default:return{topology:"triangle-list",mode:5,attributes:n,indices:{value:this._getTriangleListIndices(e),size:1}}}return{topology:"point-list",mode:0,attributes:n}}_getMeshAttributes(e,r,i){const n={};for(const l of Object.values(e.attributes)){const c=this._deduceAttributeName(l,i);l.name=c;const o=this._getAttributeValues(r,l);if(o){const{value:m,size:b}=o;n[c]={value:m,size:b,byteOffset:l.byte_offset,byteStride:l.byte_stride,normalized:l.normalized}}}return n}_getTriangleListIndices(e){const r=e.num_faces()*3,i=r*fue,n=this.draco._malloc(i);try{return this.decoder.GetTrianglesUInt32Array(e,i,n),new Uint32Array(this.draco.HEAPF32.buffer,n,r).slice()}finally{this.draco._free(n)}}_getTriangleStripIndices(e){const r=new this.draco.DracoInt32Array;try{return this.decoder.GetTriangleStripsFromMesh(e,r),_ue(r)}finally{this.draco.destroy(r)}}_getAttributeValues(e,r){const i=due[r.data_type];if(!i)return console.warn(`DRACO: Unsupported attribute type ${r.data_type}`),null;const n=r.num_components,l=e.num_points()*n,c=l*i.BYTES_PER_ELEMENT,o=mue(this.draco,i);let m;const b=this.draco._malloc(c);try{const A=this.decoder.GetAttribute(e,r.attribute_index);this.decoder.GetAttributeDataArrayForAllPoints(e,A,o,c,b),m=new i(this.draco.HEAPF32.buffer,b,l).slice()}finally{this.draco._free(b)}return{value:m,size:n}}_deduceAttributeName(e,r){const i=e.unique_id;for(const[c,o]of Object.entries(r.extraAttributes||{}))if(o===i)return c;const n=e.attribute_type;for(const c in SM)if(this.draco[c]===n)return SM[c];const l=r.attributeNameEntry||"name";return e.metadata[l]?e.metadata[l].string:`CUSTOM_ATTRIBUTE_${i}`}_getTopLevelMetadata(e){const r=this.decoder.GetMetadata(e);return this._getDracoMetadata(r)}_getAttributeMetadata(e,r){const i=this.decoder.GetAttributeMetadata(e,r);return this._getDracoMetadata(i)}_getDracoMetadata(e){if(!e||!e.ptr)return{};const r={},i=this.metadataQuerier.NumEntries(e);for(let n=0;n<i;n++){const l=this.metadataQuerier.GetEntryName(e,n);r[l]=this._getDracoMetadataField(e,l)}return r}_getDracoMetadataField(e,r){const i=new this.draco.DracoInt32Array;try{this.metadataQuerier.GetIntEntryArray(e,r,i);const n=gue(i);return{int:this.metadataQuerier.GetIntEntry(e,r),string:this.metadataQuerier.GetStringEntry(e,r),double:this.metadataQuerier.GetDoubleEntry(e,r),intArray:n}}finally{this.draco.destroy(i)}}_disableAttributeTransforms(e){const{quantizedAttributes:r=[],octahedronAttributes:i=[]}=e,n=[...r,...i];for(const l of n)this.decoder.SkipAttributeTransform(this.draco[l])}_getQuantizationTransform(e,r){const{quantizedAttributes:i=[]}=r,n=e.attribute_type();if(i.map(l=>this.decoder[l]).includes(n)){const l=new this.draco.AttributeQuantizationTransform;try{if(l.InitFromAttribute(e))return{quantization_bits:l.quantization_bits(),range:l.range(),min_values:new Float32Array([1,2,3]).map(c=>l.min_value(c))}}finally{this.draco.destroy(l)}}return null}_getOctahedronTransform(e,r){const{octahedronAttributes:i=[]}=r,n=e.attribute_type();if(i.map(l=>this.decoder[l]).includes(n)){const l=new this.draco.AttributeQuantizationTransform;try{if(l.InitFromAttribute(e))return{quantization_bits:l.quantization_bits()}}finally{this.draco.destroy(l)}}return null}}function mue(t,e){switch(e){case Float32Array:return t.DT_FLOAT32;case Int8Array:return t.DT_INT8;case Int16Array:return t.DT_INT16;case Int32Array:return t.DT_INT32;case Uint8Array:return t.DT_UINT8;case Uint16Array:return t.DT_UINT16;case Uint32Array:return t.DT_UINT32;default:return t.DT_INVALID}}function gue(t){const e=t.size(),r=new Int32Array(e);for(let i=0;i<e;i++)r[i]=t.GetValue(i);return r}function _ue(t){const e=t.size(),r=new Int32Array(e);for(let i=0;i<e;i++)r[i]=t.GetValue(i);return r}const yue="1.5.6",vue="1.4.1",pw=`https://www.gstatic.com/draco/versioned/decoders/${yue}`,ya={DECODER:"draco_wasm_wrapper.js",DECODER_WASM:"draco_decoder.wasm",FALLBACK_DECODER:"draco_decoder.js",ENCODER:"draco_encoder.js"},mw={[ya.DECODER]:`${pw}/${ya.DECODER}`,[ya.DECODER_WASM]:`${pw}/${ya.DECODER_WASM}`,[ya.FALLBACK_DECODER]:`${pw}/${ya.FALLBACK_DECODER}`,[ya.ENCODER]:`https://raw.githubusercontent.com/google/draco/${vue}/javascript/${ya.ENCODER}`};let gw;async function bue(t){const e=t.modules||{};return e.draco3d?gw||=e.draco3d.createDecoderModule({}).then(r=>({draco:r})):gw||=xue(t),await gw}async function xue(t){let e,r;switch(t.draco&&t.draco.decoderType){case"js":e=await Tp(mw[ya.FALLBACK_DECODER],"draco",t,ya.FALLBACK_DECODER);break;case"wasm":default:[e,r]=await Promise.all([await Tp(mw[ya.DECODER],"draco",t,ya.DECODER),await Tp(mw[ya.DECODER_WASM],"draco",t,ya.DECODER_WASM)])}return e=e||globalThis.DracoDecoderModule,await wue(e,r)}function wue(t,e){const r={};return e&&(r.wasmBinary=e),new Promise(i=>{t({...r,onModuleLoaded:n=>i({draco:n})})})}const MD={...cue,parse:Eue};async function Eue(t,e){const{draco:r}=await bue(e),i=new pue(r);try{return i.parseSync(t,e?.draco)}finally{i.destroy()}}function Aue(t){const e={};for(const r in t){const i=t[r];if(r!=="indices"){const n=ID(i);e[r]=n}}return e}function ID(t){const{buffer:e,size:r,count:i}=Tue(t);return{value:e,size:r,byteOffset:0,count:i,type:vD(r),componentType:cb(e)}}function Tue(t){let e=t,r=1,i=0;return t&&t.value&&(e=t.value,r=t.size||1),e&&(ArrayBuffer.isView(e)||(e=Sue(e,Float32Array)),i=e.length/r),{buffer:e,size:r,count:i}}function Sue(t,e,r=!1){return t?Array.isArray(t)?new e(t):r&&!(t instanceof e)?new e(t):t:null}const Vd="KHR_draco_mesh_compression",Cue=Vd;function Pue(t,e,r){const i=new Vs(t);for(const n of kD(i))i.getObjectExtension(n,Vd)}async function Rue(t,e,r){if(!e?.gltf?.decompressMeshes)return;const i=new Vs(t),n=[];for(const l of kD(i))i.getObjectExtension(l,Vd)&&n.push(Iue(i,l,e,r));await Promise.all(n),i.removeExtension(Vd)}function Mue(t,e={}){const r=new Vs(t);for(const i of r.json.meshes||[])kue(i),r.addRequiredExtension(Vd)}async function Iue(t,e,r,i){const n=t.getObjectExtension(e,Vd);if(!n)return;const l=t.getTypedArrayForBufferView(n.bufferView),c=DA(l.buffer,l.byteOffset),o={...r};delete o["3d-tiles"];const m=await Uy(c,MD,o,i),b=Aue(m.attributes);for(const[A,R]of Object.entries(b))if(A in e.attributes){const M=e.attributes[A],L=t.getAccessor(M);L?.min&&L?.max&&(R.min=L.min,R.max=L.max)}e.attributes=b,m.indices&&(e.indices=ID(m.indices)),t.removeObjectExtension(e,Vd),Bue(e)}function kue(t,e,r=4,i,n){if(!i.DracoWriter)throw new Error("options.gltf.DracoWriter not provided");const l=i.DracoWriter.encodeSync({attributes:t}),c=n?.parseSync?.({attributes:t}),o=i._addFauxAttributes(c.attributes),m=i.addBufferView(l);return{primitives:[{attributes:o,mode:r,extensions:{[Vd]:{bufferView:m,attributes:o}}}]}}function Bue(t){if(!t.attributes&&Object.keys(t.attributes).length>0)throw new Error("glTF: Empty primitive detected: Draco decompression failure?")}function*kD(t){for(const e of t.json.meshes||[])for(const r of e.primitives)yield r}const Lue=Object.freeze(Object.defineProperty({__proto__:null,decode:Rue,encode:Mue,name:Cue,preprocess:Pue},Symbol.toStringTag,{value:"Module"})),db="KHR_texture_transform",Oue=db,Tv=new et,Due=new kn,Nue=new kn;async function Fue(t,e){if(!new Vs(t).hasExtension(db)||!e.gltf?.loadBuffers)return;const r=t.json.materials||[];for(let i=0;i<r.length;i++)zue(i,t)}function zue(t,e){const r=e.json.materials?.[t],i=[r?.pbrMetallicRoughness?.baseColorTexture,r?.emissiveTexture,r?.normalTexture,r?.occlusionTexture,r?.pbrMetallicRoughness?.metallicRoughnessTexture],n=[];for(const l of i)l&&l?.extensions?.[db]&&jue(e,t,l,n)}function jue(t,e,r,i){const n=Uue(r,i);if(!n)return;const l=t.json.meshes||[];for(const c of l)for(const o of c.primitives){const m=o.material;Number.isFinite(m)&&e===m&&Vue(t,o,n)}}function Uue(t,e){const r=t.extensions?.[db],{texCoord:i=0}=t,{texCoord:n=i}=r;if(e.findIndex(([l,c])=>l===i&&c===n)===-1){const l=$ue(r);return i!==n&&(t.texCoord=n),e.push([i,n]),{originalTexCoord:i,texCoord:n,matrix:l}}return null}function Vue(t,e,r){const{originalTexCoord:i,texCoord:n,matrix:l}=r,c=e.attributes[`TEXCOORD_${i}`];if(Number.isFinite(c)){const o=t.json.accessors?.[c];if(o&&o.bufferView){const m=t.json.bufferViews?.[o.bufferView];if(m){const{arrayBuffer:b,byteOffset:A}=t.buffers[m.buffer],R=(A||0)+(o.byteOffset||0)+(m.byteOffset||0),{ArrayType:M,length:L}=ST(o,m),G=yD[o.componentType],V=_D[o.type],q=m.byteStride||G*V,J=new Float32Array(L);for(let ie=0;ie<o.count;ie++){const ee=new M(b,R+ie*q,2);Tv.set(ee[0],ee[1],1),Tv.transformByMatrix3(l),J.set([Tv[0],Tv[1]],ie*V)}i===n?Gue(o,m,t.buffers,J):Hue(n,o,e,t,J)}}}}function Gue(t,e,r,i){t.componentType=5126,r.push({arrayBuffer:i.buffer,byteOffset:0,byteLength:i.buffer.byteLength}),e.buffer=r.length-1,e.byteLength=i.buffer.byteLength,e.byteOffset=0,delete e.byteStride}function Hue(t,e,r,i,n){i.buffers.push({arrayBuffer:n.buffer,byteOffset:0,byteLength:n.buffer.byteLength});const l=i.json.bufferViews;if(!l)return;l.push({buffer:i.buffers.length-1,byteLength:n.buffer.byteLength,byteOffset:0});const c=i.json.accessors;c&&(c.push({bufferView:l?.length-1,byteOffset:0,componentType:5126,count:e.count,type:"VEC2"}),r.attributes[`TEXCOORD_${t}`]=c.length-1)}function $ue(t){const{offset:e=[0,0],rotation:r=0,scale:i=[1,1]}=t,n=new kn().set(1,0,0,0,1,0,e[0],e[1],1),l=Due.set(Math.cos(r),Math.sin(r),0,-Math.sin(r),Math.cos(r),0,0,0,1),c=Nue.set(i[0],0,0,0,i[1],0,0,0,1);return n.multiplyRight(l).multiplyRight(c)}const Wue=Object.freeze(Object.defineProperty({__proto__:null,decode:Fue,name:Oue},Symbol.toStringTag,{value:"Module"})),wp="KHR_lights_punctual",que=wp;async function Kue(t){const e=new Vs(t),{json:r}=e,i=e.getExtension(wp);i&&(e.json.lights=i.lights,e.removeExtension(wp));for(const n of r.nodes||[]){const l=e.getObjectExtension(n,wp);l&&(n.light=l.light),e.removeObjectExtension(n,wp)}}async function Zue(t){const e=new Vs(t),{json:r}=e;if(r.lights){const i=e.addExtension(wp);il(!i.lights),i.lights=r.lights,delete r.lights}if(e.json.lights){for(const i of e.json.lights){const n=i.node;e.addObjectExtension(n,wp,i)}delete e.json.lights}}const Xue=Object.freeze(Object.defineProperty({__proto__:null,decode:Kue,encode:Zue,name:que},Symbol.toStringTag,{value:"Module"})),Py="KHR_materials_unlit",Yue=Py;async function Jue(t){const e=new Vs(t),{json:r}=e;for(const i of r.materials||[])i.extensions&&i.extensions.KHR_materials_unlit&&(i.unlit=!0),e.removeObjectExtension(i,Py);e.removeExtension(Py)}function Que(t){const e=new Vs(t),{json:r}=e;if(e.materials)for(const i of r.materials||[])i.unlit&&(delete i.unlit,e.addObjectExtension(i,Py,{}),e.addExtension(Py))}const ehe=Object.freeze(Object.defineProperty({__proto__:null,decode:Jue,encode:Que,name:Yue},Symbol.toStringTag,{value:"Module"})),K_="KHR_techniques_webgl",the=K_;async function rhe(t){const e=new Vs(t),{json:r}=e,i=e.getExtension(K_);if(i){const n=nhe(i,e);for(const l of r.materials||[]){const c=e.getObjectExtension(l,K_);c&&(l.technique=Object.assign({},c,n[c.technique]),l.technique.values=she(l.technique,e)),e.removeObjectExtension(l,K_)}e.removeExtension(K_)}}async function ihe(t,e){}function nhe(t,e){const{programs:r=[],shaders:i=[],techniques:n=[]}=t,l=new TextDecoder;return i.forEach(c=>{if(Number.isFinite(c.bufferView))c.code=l.decode(e.getTypedArrayForBufferView(c.bufferView));else throw new Error("KHR_techniques_webgl: no shader code")}),r.forEach(c=>{c.fragmentShader=i[c.fragmentShader],c.vertexShader=i[c.vertexShader]}),n.forEach(c=>{c.program=r[c.program]}),n}function she(t,e){const r=Object.assign({},t.values);return Object.keys(t.uniforms||{}).forEach(i=>{t.uniforms[i].value&&!(i in r)&&(r[i]=t.uniforms[i].value)}),Object.keys(r).forEach(i=>{typeof r[i]=="object"&&r[i].index!==void 0&&(r[i].texture=e.getTexture(r[i].index))}),r}const ohe=Object.freeze(Object.defineProperty({__proto__:null,decode:rhe,encode:ihe,name:the},Symbol.toStringTag,{value:"Module"})),BD=[hce,Dle,tue,nue,aue,Lue,Xue,ehe,ohe,Wue,Pce];function ahe(t,e={},r){const i=BD.filter(n=>LD(n.name,e));for(const n of i)n.preprocess?.(t,e,r)}async function lhe(t,e={},r){const i=BD.filter(n=>LD(n.name,e));for(const n of i)await n.decode?.(t,e,r)}function LD(t,e){const r=e?.gltf?.excludeExtensions||{};return!(t in r&&!r[t])}const _w="KHR_binary_glTF";function che(t){const e=new Vs(t),{json:r}=e;for(const i of r.images||[]){const n=e.getObjectExtension(i,_w);n&&Object.assign(i,n),e.removeObjectExtension(i,_w)}r.buffers&&r.buffers[0]&&delete r.buffers[0].uri,e.removeExtension(_w)}const CM={accessors:"accessor",animations:"animation",buffers:"buffer",bufferViews:"bufferView",images:"image",materials:"material",meshes:"mesh",nodes:"node",samplers:"sampler",scenes:"scene",skins:"skin",textures:"texture"},uhe={accessor:"accessors",animations:"animation",buffer:"buffers",bufferView:"bufferViews",image:"images",material:"materials",mesh:"meshes",node:"nodes",sampler:"samplers",scene:"scenes",skin:"skins",texture:"textures"};class hhe{idToIndexMap={animations:{},accessors:{},buffers:{},bufferViews:{},images:{},materials:{},meshes:{},nodes:{},samplers:{},scenes:{},skins:{},textures:{}};json;normalize(e,r){this.json=e.json;const i=e.json;switch(i.asset&&i.asset.version){case"2.0":return;case void 0:case"1.0":break;default:console.warn(`glTF: Unknown version ${i.asset.version}`);return}if(!r.normalize)throw new Error("glTF v1 is not supported.");console.warn("Converting glTF v1 to glTF v2 format. This is experimental and may fail."),this._addAsset(i),this._convertTopLevelObjectsToArrays(i),che(e),this._convertObjectIdsToArrayIndices(i),this._updateObjects(i),this._updateMaterial(i)}_addAsset(e){e.asset=e.asset||{},e.asset.version="2.0",e.asset.generator=e.asset.generator||"Normalized to glTF 2.0 by loaders.gl"}_convertTopLevelObjectsToArrays(e){for(const r in CM)this._convertTopLevelObjectToArray(e,r)}_convertTopLevelObjectToArray(e,r){const i=e[r];if(!(!i||Array.isArray(i))){e[r]=[];for(const n in i){const l=i[n];l.id=l.id||n;const c=e[r].length;e[r].push(l),this.idToIndexMap[r][n]=c}}}_convertObjectIdsToArrayIndices(e){for(const r in CM)this._convertIdsToIndices(e,r);"scene"in e&&(e.scene=this._convertIdToIndex(e.scene,"scene"));for(const r of e.textures)this._convertTextureIds(r);for(const r of e.meshes)this._convertMeshIds(r);for(const r of e.nodes)this._convertNodeIds(r);for(const r of e.scenes)this._convertSceneIds(r)}_convertTextureIds(e){e.source&&(e.source=this._convertIdToIndex(e.source,"image"))}_convertMeshIds(e){for(const r of e.primitives){const{attributes:i,indices:n,material:l}=r;for(const c in i)i[c]=this._convertIdToIndex(i[c],"accessor");n&&(r.indices=this._convertIdToIndex(n,"accessor")),l&&(r.material=this._convertIdToIndex(l,"material"))}}_convertNodeIds(e){e.children&&(e.children=e.children.map(r=>this._convertIdToIndex(r,"node"))),e.meshes&&(e.meshes=e.meshes.map(r=>this._convertIdToIndex(r,"mesh")))}_convertSceneIds(e){e.nodes&&(e.nodes=e.nodes.map(r=>this._convertIdToIndex(r,"node")))}_convertIdsToIndices(e,r){e[r]||(console.warn(`gltf v1: json doesn't contain attribute ${r}`),e[r]=[]);for(const i of e[r])for(const n in i){const l=i[n],c=this._convertIdToIndex(l,n);i[n]=c}}_convertIdToIndex(e,r){const i=uhe[r];if(i in this.idToIndexMap){const n=this.idToIndexMap[i][e];if(!Number.isFinite(n))throw new Error(`gltf v1: failed to resolve ${r} with id ${e}`);return n}return e}_updateObjects(e){for(const r of this.json.buffers)delete r.type}_updateMaterial(e){for(const r of e.materials){r.pbrMetallicRoughness={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1};const i=r.values?.tex||r.values?.texture2d_0||r.values?.diffuseTex,n=e.textures.findIndex(l=>l.id===i);n!==-1&&(r.pbrMetallicRoughness.baseColorTexture={index:n})}}}function dhe(t,e={}){return new hhe().normalize(t,e)}async function fhe(t,e,r=0,i,n){return phe(t,e,r,i),dhe(t,{normalize:i?.gltf?.normalize}),ahe(t,i,n),i?.gltf?.loadBuffers&&t.json.buffers&&await mhe(t,i,n),i?.gltf?.loadImages&&await ghe(t,i,n),await lhe(t,i,n),t}function phe(t,e,r,i){if(i.uri&&(t.baseUri=i.uri),e instanceof ArrayBuffer&&!Dce(e,r,i)&&(e=new TextDecoder().decode(e)),typeof e=="string")t.json=OK(e);else if(e instanceof ArrayBuffer){const c={};r=Nce(c,e,r,i.glb),il(c.type==="glTF",`Invalid GLB magic string ${c.type}`),t._glb=c,t.json=c.json}else il(!1,"GLTF: must be ArrayBuffer or string");const n=t.json.buffers||[];if(t.buffers=new Array(n.length).fill(null),t._glb&&t._glb.header.hasBinChunk){const{binChunks:c}=t._glb;t.buffers[0]={arrayBuffer:c[0].arrayBuffer,byteOffset:c[0].byteOffset,byteLength:c[0].byteLength}}const l=t.json.images||[];t.images=new Array(l.length).fill({})}async function mhe(t,e,r){const i=t.json.buffers||[];for(let n=0;n<i.length;++n){const l=i[n];if(l.uri){const{fetch:c}=r;il(c);const o=PD(l.uri,e),m=await(await r?.fetch?.(o))?.arrayBuffer?.();t.buffers[n]={arrayBuffer:m,byteOffset:0,byteLength:m.byteLength},delete l.uri}else t.buffers[n]===null&&(t.buffers[n]={arrayBuffer:new ArrayBuffer(l.byteLength),byteOffset:0,byteLength:l.byteLength})}}async function ghe(t,e,r){const i=_he(t),n=t.json.images||[],l=[];for(const c of i)l.push(yhe(t,n[c],c,e,r));return await Promise.all(l)}function _he(t){const e=new Set,r=t.json.textures||[];for(const i of r)i.source!==void 0&&e.add(i.source);return Array.from(e).sort()}async function yhe(t,e,r,i,n){let l;if(e.uri&&!e.hasOwnProperty("bufferView")){const o=PD(e.uri,i),{fetch:m}=n;l=await(await m(o)).arrayBuffer(),e.bufferView={data:l}}if(Number.isFinite(e.bufferView)){const o=xle(t.json,t.buffers,e.bufferView);l=DA(o.buffer,o.byteOffset,o.byteLength)}il(l,"glTF image has no data");let c=await Uy(l,[EL,Yae],{...i,mimeType:e.mimeType,basis:i.basis||{format:gD()}},n);c&&c[0]&&(c={compressed:!0,mipmaps:!1,width:c[0].width,height:c[0].height,data:c[0]}),t.images=t.images||[],t.images[r]=c}const Ry={dataType:null,batchType:null,name:"glTF",id:"gltf",module:"gltf",version:Rce,extensions:["gltf","glb"],mimeTypes:["model/gltf+json","model/gltf-binary"],text:!0,binary:!0,tests:["glTF"],parse:vhe,options:{gltf:{normalize:!0,loadBuffers:!0,loadImages:!0,decompressMeshes:!0},log:console}};async function vhe(t,e={},r){e={...Ry.options,...e},e.gltf={...Ry.options.gltf,...e.gltf};const{byteOffset:i=0}=e;return await fhe({},t,i,e,r)}const bhe={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},xhe={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},Bl={TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,REPEAT:10497,LINEAR:9729,NEAREST_MIPMAP_LINEAR:9986},whe={magFilter:Bl.TEXTURE_MAG_FILTER,minFilter:Bl.TEXTURE_MIN_FILTER,wrapS:Bl.TEXTURE_WRAP_S,wrapT:Bl.TEXTURE_WRAP_T},Ehe={[Bl.TEXTURE_MAG_FILTER]:Bl.LINEAR,[Bl.TEXTURE_MIN_FILTER]:Bl.NEAREST_MIPMAP_LINEAR,[Bl.TEXTURE_WRAP_S]:Bl.REPEAT,[Bl.TEXTURE_WRAP_T]:Bl.REPEAT};function Ahe(){return{id:"default-sampler",parameters:Ehe}}function The(t){return xhe[t]}function She(t){return bhe[t]}class Che{baseUri="";jsonUnprocessed;json;buffers=[];images=[];postProcess(e,r={}){const{json:i,buffers:n=[],images:l=[]}=e,{baseUri:c=""}=e;return il(i),this.baseUri=c,this.buffers=n,this.images=l,this.jsonUnprocessed=i,this.json=this._resolveTree(e.json,r),this.json}_resolveTree(e,r={}){const i={...e};return this.json=i,e.bufferViews&&(i.bufferViews=e.bufferViews.map((n,l)=>this._resolveBufferView(n,l))),e.images&&(i.images=e.images.map((n,l)=>this._resolveImage(n,l))),e.samplers&&(i.samplers=e.samplers.map((n,l)=>this._resolveSampler(n,l))),e.textures&&(i.textures=e.textures.map((n,l)=>this._resolveTexture(n,l))),e.accessors&&(i.accessors=e.accessors.map((n,l)=>this._resolveAccessor(n,l))),e.materials&&(i.materials=e.materials.map((n,l)=>this._resolveMaterial(n,l))),e.meshes&&(i.meshes=e.meshes.map((n,l)=>this._resolveMesh(n,l))),e.nodes&&(i.nodes=e.nodes.map((n,l)=>this._resolveNode(n,l)),i.nodes=i.nodes.map((n,l)=>this._resolveNodeChildren(n))),e.skins&&(i.skins=e.skins.map((n,l)=>this._resolveSkin(n,l))),e.scenes&&(i.scenes=e.scenes.map((n,l)=>this._resolveScene(n,l))),typeof this.json.scene=="number"&&i.scenes&&(i.scene=i.scenes[this.json.scene]),i}getScene(e){return this._get(this.json.scenes,e)}getNode(e){return this._get(this.json.nodes,e)}getSkin(e){return this._get(this.json.skins,e)}getMesh(e){return this._get(this.json.meshes,e)}getMaterial(e){return this._get(this.json.materials,e)}getAccessor(e){return this._get(this.json.accessors,e)}getCamera(e){return this._get(this.json.cameras,e)}getTexture(e){return this._get(this.json.textures,e)}getSampler(e){return this._get(this.json.samplers,e)}getImage(e){return this._get(this.json.images,e)}getBufferView(e){return this._get(this.json.bufferViews,e)}getBuffer(e){return this._get(this.json.buffers,e)}_get(e,r){if(typeof r=="object")return r;const i=e&&e[r];return i||console.warn(`glTF file error: Could not find ${e}[${r}]`),i}_resolveScene(e,r){return{...e,id:e.id||`scene-${r}`,nodes:(e.nodes||[]).map(i=>this.getNode(i))}}_resolveNode(e,r){const i={...e,id:e?.id||`node-${r}`};return e.mesh!==void 0&&(i.mesh=this.getMesh(e.mesh)),e.camera!==void 0&&(i.camera=this.getCamera(e.camera)),e.skin!==void 0&&(i.skin=this.getSkin(e.skin)),e.meshes!==void 0&&e.meshes.length&&(i.mesh=e.meshes.reduce((n,l)=>{const c=this.getMesh(l);return n.id=c.id,n.primitives=n.primitives.concat(c.primitives),n},{primitives:[]})),i}_resolveNodeChildren(e){return e.children&&(e.children=e.children.map(r=>this.getNode(r))),e}_resolveSkin(e,r){const i=typeof e.inverseBindMatrices=="number"?this.getAccessor(e.inverseBindMatrices):void 0;return{...e,id:e.id||`skin-${r}`,inverseBindMatrices:i}}_resolveMesh(e,r){const i={...e,id:e.id||`mesh-${r}`,primitives:[]};return e.primitives&&(i.primitives=e.primitives.map(n=>{const l={...n,attributes:{},indices:void 0,material:void 0},c=n.attributes;for(const o in c)l.attributes[o]=this.getAccessor(c[o]);return n.indices!==void 0&&(l.indices=this.getAccessor(n.indices)),n.material!==void 0&&(l.material=this.getMaterial(n.material)),l})),i}_resolveMaterial(e,r){const i={...e,id:e.id||`material-${r}`};if(i.normalTexture&&(i.normalTexture={...i.normalTexture},i.normalTexture.texture=this.getTexture(i.normalTexture.index)),i.occlusionTexture&&(i.occlusionTexture={...i.occlusionTexture},i.occlusionTexture.texture=this.getTexture(i.occlusionTexture.index)),i.emissiveTexture&&(i.emissiveTexture={...i.emissiveTexture},i.emissiveTexture.texture=this.getTexture(i.emissiveTexture.index)),i.emissiveFactor||(i.emissiveFactor=i.emissiveTexture?[1,1,1]:[0,0,0]),i.pbrMetallicRoughness){i.pbrMetallicRoughness={...i.pbrMetallicRoughness};const n=i.pbrMetallicRoughness;n.baseColorTexture&&(n.baseColorTexture={...n.baseColorTexture},n.baseColorTexture.texture=this.getTexture(n.baseColorTexture.index)),n.metallicRoughnessTexture&&(n.metallicRoughnessTexture={...n.metallicRoughnessTexture},n.metallicRoughnessTexture.texture=this.getTexture(n.metallicRoughnessTexture.index))}return i}_resolveAccessor(e,r){const i=The(e.componentType),n=She(e.type),l=i*n,c={...e,id:e.id||`accessor-${r}`,bytesPerComponent:i,components:n,bytesPerElement:l,value:void 0,bufferView:void 0,sparse:void 0};if(e.bufferView!==void 0&&(c.bufferView=this.getBufferView(e.bufferView)),c.bufferView){const o=c.bufferView.buffer,{ArrayType:m,byteLength:b}=ST(c,c.bufferView),A=(c.bufferView.byteOffset||0)+(c.byteOffset||0)+o.byteOffset;let R=o.arrayBuffer.slice(A,A+b);c.bufferView.byteStride&&(R=this._getValueFromInterleavedBuffer(o,A,c.bufferView.byteStride,c.bytesPerElement,c.count)),c.value=new m(R)}return c}_getValueFromInterleavedBuffer(e,r,i,n,l){const c=new Uint8Array(l*n);for(let o=0;o<l;o++){const m=r+o*i;c.set(new Uint8Array(e.arrayBuffer.slice(m,m+n)),o*n)}return c.buffer}_resolveTexture(e,r){return{...e,id:e.id||`texture-${r}`,sampler:typeof e.sampler=="number"?this.getSampler(e.sampler):Ahe(),source:typeof e.source=="number"?this.getImage(e.source):void 0}}_resolveSampler(e,r){const i={id:e.id||`sampler-${r}`,...e,parameters:{}};for(const n in i){const l=this._enumSamplerParameter(n);l!==void 0&&(i.parameters[l]=i[n])}return i}_enumSamplerParameter(e){return whe[e]}_resolveImage(e,r){const i={...e,id:e.id||`image-${r}`,image:null,bufferView:e.bufferView!==void 0?this.getBufferView(e.bufferView):void 0},n=this.images[r];return n&&(i.image=n),i}_resolveBufferView(e,r){const i=e.buffer,n=this.buffers[i].arrayBuffer;let l=this.buffers[i].byteOffset||0;return e.byteOffset&&(l+=e.byteOffset),{id:`bufferView-${r}`,...e,buffer:this.buffers[i],data:new Uint8Array(n,l,e.byteLength)}}_resolveCamera(e,r){const i={...e,id:e.id||`camera-${r}`};return i.perspective,i.orthographic,i}}function IT(t,e){return new Che().postProcess(t,e)}async function Phe(t){const e=[];return t.scenes.forEach(r=>{r.traverse(i=>{Object.values(i.model.uniforms).forEach(n=>{n.loaded===!1&&e.push(n)})})}),await Rhe(()=>e.some(r=>!r.loaded))}async function Rhe(t){for(;t();)await new Promise(e=>requestAnimationFrame(e))}const Mhe=`#version 300 es
#define SHADER_NAME scenegraph-layer-vertex-shader
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec3 instanceModelMatrixCol0;
in vec3 instanceModelMatrixCol1;
in vec3 instanceModelMatrixCol2;
in vec3 instanceTranslation;
uniform float sizeScale;
uniform float sizeMinPixels;
uniform float sizeMaxPixels;
uniform mat4 sceneModelMatrix;
uniform bool composeModelMatrix;
in vec3 positions;
#ifdef HAS_UV
in vec2 texCoords;
#endif
#ifdef MODULE_PBR
#ifdef HAS_NORMALS
in vec3 normals;
#endif
#endif
out vec4 vColor;
#ifndef MODULE_PBR
#ifdef HAS_UV
out vec2 vTEXCOORD_0;
#endif
#endif
void main(void) {
#if defined(HAS_UV) && !defined(MODULE_PBR)
vTEXCOORD_0 = texCoords;
geometry.uv = texCoords;
#endif
geometry.worldPosition = instancePositions;
geometry.pickingColor = instancePickingColors;
mat3 instanceModelMatrix = mat3(instanceModelMatrixCol0, instanceModelMatrixCol1, instanceModelMatrixCol2);
vec3 normal = vec3(0.0, 0.0, 1.0);
#ifdef MODULE_PBR
#ifdef HAS_NORMALS
normal = instanceModelMatrix * (sceneModelMatrix * vec4(normals, 0.0)).xyz;
#endif
#endif
float originalSize = project_size_to_pixel(sizeScale);
float clampedSize = clamp(originalSize, sizeMinPixels, sizeMaxPixels);
vec3 pos = (instanceModelMatrix * (sceneModelMatrix * vec4(positions, 1.0)).xyz) * sizeScale * (clampedSize / originalSize) + instanceTranslation;
if(composeModelMatrix) {
DECKGL_FILTER_SIZE(pos, geometry);
geometry.normal = project_normal(normal);
geometry.worldPosition += pos;
gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
}
else {
pos = project_size(pos);
DECKGL_FILTER_SIZE(pos, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, geometry.position);
geometry.normal = project_normal(normal);
}
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
#ifdef MODULE_PBR
pbr_vPosition = geometry.position.xyz;
#ifdef HAS_NORMALS
pbr_vNormal = geometry.normal;
#endif
#ifdef HAS_UV
pbr_vUV = texCoords;
#else
pbr_vUV = vec2(0., 0.);
#endif
geometry.uv = pbr_vUV;
#endif
vColor = instanceColors;
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,Ihe=`#version 300 es
#define SHADER_NAME scenegraph-layer-fragment-shader
uniform float opacity;
in vec4 vColor;
out vec4 fragColor;
#ifndef MODULE_PBR
#if defined(HAS_UV) && defined(HAS_BASECOLORMAP)
in vec2 vTEXCOORD_0;
uniform sampler2D u_BaseColorSampler;
#endif
#endif
void main(void) {
#ifdef MODULE_PBR
fragColor = vColor * pbr_filterColor(vec4(0));
geometry.uv = pbr_vUV;
#else
#if defined(HAS_UV) && defined(HAS_BASECOLORMAP)
fragColor = vColor * texture(u_BaseColorSampler, vTEXCOORD_0);
geometry.uv = vTEXCOORD_0;
#else
fragColor = vColor;
#endif
#endif
fragColor.a *= opacity;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,OD=[255,255,255,255],khe={scenegraph:{type:"object",value:null,async:!0},getScene:t=>t&&t.scenes?typeof t.scene=="object"?t.scene:t.scenes[t.scene||0]:t,getAnimator:t=>t&&t.animator,_animations:null,sizeScale:{type:"number",value:1,min:0},sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},getPosition:{type:"accessor",value:t=>t.position},getColor:{type:"accessor",value:OD},_lighting:"flat",_imageBasedLightingEnvironment:void 0,getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},loaders:[Ry]};class kT extends Lg{getShaders(){const e=[uT,fT];return this.props._lighting==="pbr"&&e.push(lT),super.getShaders({vs:Mhe,fs:Ihe,modules:e})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),accessor:"getPosition",transition:!0},instanceColors:{type:"unorm8",size:this.props.colorFormat.length,accessor:"getColor",defaultValue:OD,transition:!0},instanceModelMatrix:dD})}updateState(e){super.updateState(e);const{props:r,oldProps:i}=e;r.scenegraph!==i.scenegraph?this._updateScenegraph():r._animations!==i._animations&&this._applyAnimationsProp(this.state.animator,r._animations)}finalizeState(e){super.finalizeState(e),this.state.scenegraph?.destroy()}get isLoaded(){return!!(this.state?.scenegraph&&super.isLoaded)}_updateScenegraph(){const e=this.props,{device:r}=this.context;let i=null;if(e.scenegraph instanceof v1)i={scenes:[e.scenegraph]};else if(e.scenegraph&&typeof e.scenegraph=="object"){const o=e.scenegraph,m=o.json?IT(o):o,b=ple(r,m,this._getModelOptions());i={gltf:m,...b},Phe(b).then(()=>{this.setNeedsRedraw()}).catch(A=>{this.raiseError(A,"loading glTF")})}const n={layer:this,device:this.context.device},l=e.getScene(i,n),c=e.getAnimator(i,n);if(l instanceof rg){this.state.scenegraph?.destroy(),this._applyAnimationsProp(c,e._animations);const o=[];l.traverse(m=>{m instanceof $2&&o.push(m.model)}),this.setState({scenegraph:l,animator:c,models:o}),this.getAttributeManager().invalidateAll()}else l!==null&&hi.warn("invalid scenegraph:",l)()}_applyAnimationsProp(e,r){if(!e||!r)return;const i=e.getAnimations();Object.keys(r).sort().forEach(n=>{const l=r[n];if(n==="*")i.forEach(c=>{Object.assign(c,l)});else if(Number.isFinite(Number(n))){const c=Number(n);c>=0&&c<i.length?Object.assign(i[c],l):hi.warn(`animation ${n} not found`)()}else{const c=i.find(({name:o})=>o===n);c?Object.assign(c,l):hi.warn(`animation ${n} not found`)()}})}_getModelOptions(){const{_imageBasedLightingEnvironment:e}=this.props;let r;return e&&(typeof e=="function"?r=e({gl:this.context.gl,layer:this}):r=e),{imageBasedLightingEnvironment:r,modelOptions:{id:this.props.id,isInstanced:!0,bufferLayout:this.getAttributeManager().getBufferLayouts(),...this.getShaders()},useTangents:!1}}draw({context:e}){if(!this.state.scenegraph)return;this.props._animations&&this.state.animator&&(this.state.animator.animate(e.timeline.getTime()),this.setNeedsRedraw());const{viewport:r,renderPass:i}=this.context,{sizeScale:n,sizeMinPixels:l,sizeMaxPixels:c,opacity:o,coordinateSystem:m}=this.props,b=this.getNumInstances();this.state.scenegraph.traverse((A,{worldMatrix:R})=>{if(A instanceof $2){const{model:M}=A;M.setInstanceCount(b),M.setUniforms({sizeScale:n,opacity:o,sizeMinPixels:l,sizeMaxPixels:c,composeModelMatrix:fD(r,m),sceneModelMatrix:R,u_Camera:M.uniforms.project_uCameraPosition}),M.draw(i)}})}}kT.defaultProps=khe;kT.layerName="ScenegraphLayer";const Bhe=`#version 300 es
#define SHADER_NAME simple-mesh-layer-vs
uniform float sizeScale;
uniform bool composeModelMatrix;
uniform bool pickFeatureIds;
in vec3 positions;
in vec3 normals;
in vec3 colors;
in vec2 texCoords;
in vec4 uvRegions;
in vec3 featureIdsPickingColors;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec3 instanceModelMatrixCol0;
in vec3 instanceModelMatrixCol1;
in vec3 instanceModelMatrixCol2;
out vec2 vTexCoord;
out vec3 cameraPosition;
out vec3 normals_commonspace;
out vec4 position_commonspace;
out vec4 vColor;
vec2 applyUVRegion(vec2 uv) {
#ifdef HAS_UV_REGIONS
return fract(uv) * (uvRegions.zw - uvRegions.xy) + uvRegions.xy;
#else
return uv;
#endif
}
void main(void) {
vec2 uv = applyUVRegion(texCoords);
geometry.uv = uv;
if (pickFeatureIds) {
geometry.pickingColor = featureIdsPickingColors;
} else {
geometry.pickingColor = instancePickingColors;
}
mat3 instanceModelMatrix = mat3(instanceModelMatrixCol0, instanceModelMatrixCol1, instanceModelMatrixCol2);
vTexCoord = uv;
cameraPosition = project_uCameraPosition;
vColor = vec4(colors * instanceColors.rgb, instanceColors.a);
vec3 pos = (instanceModelMatrix * positions) * sizeScale;
vec3 projectedPosition = project_position(positions);
position_commonspace = vec4(projectedPosition, 1.0);
gl_Position = project_common_position_to_clipspace(position_commonspace);
geometry.position = position_commonspace;
normals_commonspace = project_normal(instanceModelMatrix * normals);
geometry.normal = normals_commonspace;
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
#ifdef MODULE_PBR
pbr_vPosition = geometry.position.xyz;
#ifdef HAS_NORMALS
pbr_vNormal = geometry.normal;
#endif
#ifdef HAS_UV
pbr_vUV = uv;
#else
pbr_vUV = vec2(0., 0.);
#endif
geometry.uv = pbr_vUV;
#endif
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,Lhe=`#version 300 es
#define SHADER_NAME simple-mesh-layer-fs
precision highp float;
uniform bool hasTexture;
uniform sampler2D sampler;
uniform bool flatShading;
uniform float opacity;
in vec2 vTexCoord;
in vec3 cameraPosition;
in vec3 normals_commonspace;
in vec4 position_commonspace;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
#ifdef MODULE_PBR
fragColor = vColor * pbr_filterColor(vec4(0));
geometry.uv = pbr_vUV;
fragColor.a *= opacity;
#else
geometry.uv = vTexCoord;
vec3 normal;
if (flatShading) {
normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
} else {
normal = normals_commonspace;
}
vec4 color = hasTexture ? texture(sampler, vTexCoord) : vColor;
vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);
fragColor = vec4(lightColor, color.a * opacity);
#endif
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;function Ohe(t){const e=t.positions||t.POSITION,r=e.value.length/e.size;t.COLOR_0||t.colors||(t.colors={size:4,value:new Uint8Array(r*4).fill(255),normalized:!0})}const Dhe={pbrMaterial:{type:"object",value:null},featureIds:{type:"array",value:null,optional:!0}};class BT extends TT{getShaders(){const e=super.getShaders();return e.modules.push(lT),{...e,vs:Bhe,fs:Lhe}}initializeState(){const{featureIds:e}=this.props;super.initializeState();const r=this.getAttributeManager();e&&r.add({featureIdsPickingColors:{type:"uint8",size:3,noAlloc:!0,update:this.calculateFeatureIdsPickingColors}})}updateState(e){super.updateState(e);const{props:r,oldProps:i}=e;r.pbrMaterial!==i.pbrMaterial&&this.updatePbrMaterialUniforms(r.pbrMaterial)}draw(e){const{featureIds:r}=this.props;this.state.model&&(this.state.model.setUniforms({u_Camera:this.state.model.uniforms.project_uCameraPosition,pickFeatureIds:!!r}),super.draw(e))}getModel(e){const{id:r,pbrMaterial:i}=this.props,n=this.parseMaterial(i,e);this.setState({parsedPBRMaterial:n});const l=this.getShaders();return Ohe(e.attributes),new jd(this.context.device,{...this.getShaders(),id:r,geometry:e,bufferLayout:this.getAttributeManager().getBufferLayouts(),defines:{...l.defines,...n?.defines,HAS_UV_REGIONS:e.attributes.uvRegions?1:0},parameters:n?.parameters,isInstanced:!0})}updatePbrMaterialUniforms(e){const{model:r}=this.state;if(r){const{mesh:i}=this.props,n=this.parseMaterial(e,i);this.setState({parsedPBRMaterial:n}),r.setBindings(n.bindings),r.setUniforms(n.uniforms)}}parseMaterial(e,r){const i=!!(e.pbrMetallicRoughness&&e.pbrMetallicRoughness.baseColorTexture);return pD(this.context.device,{unlit:i,...e},{NORMAL:r.attributes.normals,TEXCOORD_0:r.attributes.texCoords},{pbrDebug:!1,lights:!0,useTangents:!1})}calculateFeatureIdsPickingColors(e){const r=this.props.featureIds,i=new Uint8ClampedArray(r.length*e.size),n=[];for(let l=0;l<r.length;l++)this.encodePickingColor(r[l],n),i[l*3]=n[0],i[l*3+1]=n[1],i[l*3+2]=n[2];e.value=i}finalizeState(e){super.finalizeState(e),this.state.parsedPBRMaterial?.generatedTextures.forEach(r=>r.destroy()),this.setState({parsedPBRMaterial:null})}}BT.layerName="MeshLayer";BT.defaultProps=Dhe;const Nhe=6378137,Fhe=6378137,zhe=6356752314245179e-9;function fb(t){return t}new et;function jhe(t,e=[],r=fb){return"longitude"in t?(e[0]=r(t.longitude),e[1]=r(t.latitude),e[2]=t.height):"x"in t?(e[0]=r(t.x),e[1]=r(t.y),e[2]=t.z):(e[0]=r(t[0]),e[1]=r(t[1]),e[2]=t[2]),e}function Uhe(t,e=[]){return jhe(t,e,Cs._cartographicRadians?fb:xQ)}function Vhe(t,e,r=fb){return"longitude"in e?(e.longitude=r(t[0]),e.latitude=r(t[1]),e.height=t[2]):"x"in e?(e.x=r(t[0]),e.y=r(t[1]),e.z=t[2]):(e[0]=r(t[0]),e[1]=r(t[1]),e[2]=t[2]),e}function Ghe(t,e){return Vhe(t,e,Cs._cartographicRadians?fb:wQ)}const PM=1e-14,Hhe=new et,RM={up:{south:"east",north:"west",west:"south",east:"north"},down:{south:"west",north:"east",west:"north",east:"south"},south:{up:"west",down:"east",west:"down",east:"up"},north:{up:"east",down:"west",west:"up",east:"down"},west:{up:"north",down:"south",north:"down",south:"up"},east:{up:"south",down:"north",north:"up",south:"down"}},yw={north:[-1,0,0],east:[0,1,0],up:[0,0,1],south:[1,0,0],west:[0,-1,0],down:[0,0,-1]},N_={east:new et,north:new et,up:new et,west:new et,south:new et,down:new et},$he=new et,Whe=new et,qhe=new et;function MM(t,e,r,i,n,l){const c=RM[e]&&RM[e][r];wc(c&&(!i||i===c));let o,m,b;const A=Hhe.copy(n);if(Pc(A.x,0,PM)&&Pc(A.y,0,PM)){const R=Math.sign(A.z);o=$he.fromArray(yw[e]),e!=="east"&&e!=="west"&&o.scale(R),m=Whe.fromArray(yw[r]),r!=="east"&&r!=="west"&&m.scale(R),b=qhe.fromArray(yw[i]),i!=="east"&&i!=="west"&&b.scale(R)}else{const{up:R,east:M,north:L}=N_;M.set(-A.y,A.x,0).normalize(),t.geodeticSurfaceNormal(A,R),L.copy(R).cross(M);const{down:G,west:V,south:q}=N_;G.copy(R).scale(-1),V.copy(M).scale(-1),q.copy(L).scale(-1),o=N_[e],m=N_[r],b=N_[i]}return l[0]=o.x,l[1]=o.y,l[2]=o.z,l[3]=0,l[4]=m.x,l[5]=m.y,l[6]=m.z,l[7]=0,l[8]=b.x,l[9]=b.y,l[10]=b.z,l[11]=0,l[12]=A.x,l[13]=A.y,l[14]=A.z,l[15]=1,l}const Mm=new et,Khe=new et,Zhe=new et;function Xhe(t,e,r=[]){const{oneOverRadii:i,oneOverRadiiSquared:n,centerToleranceSquared:l}=e;Mm.from(t);const c=Mm.x,o=Mm.y,m=Mm.z,b=i.x,A=i.y,R=i.z,M=c*c*b*b,L=o*o*A*A,G=m*m*R*R,V=M+L+G,q=Math.sqrt(1/V);if(!Number.isFinite(q))return;const J=Khe;if(J.copy(t).scale(q),V<l)return J.to(r);const ie=n.x,ee=n.y,me=n.z,Se=Zhe;Se.set(J.x*ie*2,J.y*ee*2,J.z*me*2);let Me=(1-q)*Mm.len()/(.5*Se.len()),Ve=0,Be,$e,at,_t;do{Me-=Ve,Be=1/(1+Me*ie),$e=1/(1+Me*ee),at=1/(1+Me*me);const Nt=Be*Be,sr=$e*$e,Ft=at*at,Ut=Nt*Be,Lt=sr*$e,At=Ft*at;_t=M*Nt+L*sr+G*Ft-1;const Ke=-2*(M*Ut*ie+L*Lt*ee+G*At*me);Ve=_t/Ke}while(Math.abs(_t)>Uee);return Mm.scale([Be,$e,at]).to(r)}const Sv=new et,IM=new et,Yhe=new et,mc=new et,Jhe=new et,Cv=new et;class Fi{constructor(e=0,r=0,i=0){this.centerToleranceSquared=jee,wc(e>=0),wc(r>=0),wc(i>=0),this.radii=new et(e,r,i),this.radiiSquared=new et(e*e,r*r,i*i),this.radiiToTheFourth=new et(e*e*e*e,r*r*r*r,i*i*i*i),this.oneOverRadii=new et(e===0?0:1/e,r===0?0:1/r,i===0?0:1/i),this.oneOverRadiiSquared=new et(e===0?0:1/(e*e),r===0?0:1/(r*r),i===0?0:1/(i*i)),this.minimumRadius=Math.min(e,r,i),this.maximumRadius=Math.max(e,r,i),this.radiiSquared.z!==0&&(this.squaredXOverSquaredZ=this.radiiSquared.x/this.radiiSquared.z),Object.freeze(this)}equals(e){return this===e||!!(e&&this.radii.equals(e.radii))}toString(){return this.radii.toString()}cartographicToCartesian(e,r=[0,0,0]){const i=IM,n=Yhe,[,,l]=e;this.geodeticSurfaceNormalCartographic(e,i),n.copy(this.radiiSquared).scale(i);const c=Math.sqrt(i.dot(n));return n.scale(1/c),i.scale(l),n.add(i),n.to(r)}cartesianToCartographic(e,r=[0,0,0]){Cv.from(e);const i=this.scaleToGeodeticSurface(Cv,mc);if(!i)return;const n=this.geodeticSurfaceNormal(i,IM),l=Jhe;l.copy(Cv).subtract(i);const c=Math.atan2(n.y,n.x),o=Math.asin(n.z),m=Math.sign(iT(l,Cv))*iO(l);return Ghe([c,o,m],r)}eastNorthUpToFixedFrame(e,r=new Kr){return MM(this,"east","north","up",e,r)}localFrameToFixedFrame(e,r,i,n,l=new Kr){return MM(this,e,r,i,n,l)}geocentricSurfaceNormal(e,r=[0,0,0]){return Sv.from(e).normalize().to(r)}geodeticSurfaceNormalCartographic(e,r=[0,0,0]){const i=Uhe(e),n=i[0],l=i[1],c=Math.cos(l);return Sv.set(c*Math.cos(n),c*Math.sin(n),Math.sin(l)).normalize(),Sv.to(r)}geodeticSurfaceNormal(e,r=[0,0,0]){return Sv.from(e).scale(this.oneOverRadiiSquared).normalize().to(r)}scaleToGeodeticSurface(e,r){return Xhe(e,this,r)}scaleToGeocentricSurface(e,r=[0,0,0]){mc.from(e);const i=mc.x,n=mc.y,l=mc.z,c=this.oneOverRadiiSquared,o=1/Math.sqrt(i*i*c.x+n*n*c.y+l*l*c.z);return mc.multiplyScalar(o).to(r)}transformPositionToScaledSpace(e,r=[0,0,0]){return mc.from(e).scale(this.oneOverRadii).to(r)}transformPositionFromScaledSpace(e,r=[0,0,0]){return mc.from(e).scale(this.radii).to(r)}getSurfaceNormalIntersectionWithZAxis(e,r=0,i=[0,0,0]){wc(Pc(this.radii.x,this.radii.y,fO)),wc(this.radii.z>0),mc.from(e);const n=mc.z*(1-this.squaredXOverSquaredZ);if(!(Math.abs(n)>=this.radii.z-r))return mc.set(0,0,n).to(i)}}Fi.WGS84=new Fi(Nhe,Fhe,zhe);class Qhe{item;previous;next;constructor(e,r,i){this.item=e,this.previous=r,this.next=i}}class ede{head=null;tail=null;_length=0;get length(){return this._length}add(e){const r=new Qhe(e,this.tail,null);return this.tail?(this.tail.next=r,this.tail=r):(this.head=r,this.tail=r),++this._length,r}remove(e){e&&(e.previous&&e.next?(e.previous.next=e.next,e.next.previous=e.previous):e.previous?(e.previous.next=null,this.tail=e.previous):e.next?(e.next.previous=null,this.head=e.next):(this.head=null,this.tail=null),e.next=null,e.previous=null,--this._length)}splice(e,r){e!==r&&(this.remove(r),this._insert(e,r))}_insert(e,r){const i=e.next;e.next=r,this.tail===e?this.tail=r:i.previous=r,r.next=i,r.previous=e,++this._length}}class tde{_list;_sentinel;_trimTiles;constructor(){this._list=new ede,this._sentinel=this._list.add("sentinel"),this._trimTiles=!1}reset(){this._list.splice(this._list.tail,this._sentinel)}touch(e){const r=e._cacheNode;r&&this._list.splice(this._sentinel,r)}add(e,r,i){r._cacheNode||(r._cacheNode=this._list.add(r),i&&i(e,r))}unloadTile(e,r,i){const n=r._cacheNode;n&&(this._list.remove(n),r._cacheNode=null,i&&i(e,r))}unloadTiles(e,r){const i=this._trimTiles;this._trimTiles=!1;const n=this._list,l=e.maximumMemoryUsage*1024*1024,c=this._sentinel;let o=n.head;for(;o!==c&&(e.gpuMemoryUsageInBytes>l||i);){const m=o.item;o=o.next,this.unloadTile(e,m,r)}}trim(){this._trimTiles=!0}}function rde(t,e){Ni(t),Ni(e);const{rtcCenter:r,gltfUpAxis:i}=e,{computedTransform:n,boundingVolume:{center:l}}=t;let c=new Kr(n);switch(r&&c.translate(r),i){case"Z":break;case"Y":const A=new Kr().rotateX(Math.PI/2);c=c.multiplyRight(A);break;case"X":const R=new Kr().rotateY(-Math.PI/2);c=c.multiplyRight(R);break}e.isQuantized&&c.translate(e.quantizedVolumeOffset).scale(e.quantizedVolumeScale);const o=new et(l);e.cartesianModelMatrix=c,e.cartesianOrigin=o;const m=Fi.WGS84.cartesianToCartographic(o,new et),b=Fi.WGS84.eastNorthUpToFixedFrame(o).invert();e.cartographicModelMatrix=b.multiplyRight(c),e.cartographicOrigin=m,e.coordinateSystem||(e.modelMatrix=e.cartographicModelMatrix)}const kM=new et,vw=new et,lE=new Dl([new wu,new wu,new wu,new wu,new wu,new wu]);function ide(t,e){const{cameraDirection:r,cameraUp:i,height:n}=t,{metersPerUnit:l}=t.distanceScales,c=qv(t,t.center),o=Fi.WGS84.eastNorthUpToFixedFrame(c),m=t.unprojectPosition(t.cameraPosition),b=Fi.WGS84.cartographicToCartesian(m,new et),A=new et(o.transformAsVector(new et(r).scale(l))).normalize(),R=new et(o.transformAsVector(new et(i).scale(l))).normalize();sde(t);const M=t.constructor,{longitude:L,latitude:G,width:V,bearing:q,zoom:J}=t,ie=new M({longitude:L,latitude:G,height:n,width:V,bearing:q,zoom:J,pitch:0});return{camera:{position:b,direction:A,up:R},viewport:t,topDownViewport:ie,height:n,cullingVolume:lE,frameNumber:e,sseDenominator:1.15}}function nde(t,e,r){if(r===0||t.length<=r)return[t,[]];const i=[],{longitude:n,latitude:l}=e.viewport;for(const[b,A]of t.entries()){const[R,M]=A.header.mbs,L=Math.abs(n-R),G=Math.abs(l-M),V=Math.sqrt(G*G+L*L);i.push([b,V])}const c=i.sort((b,A)=>b[1]-A[1]),o=[];for(let b=0;b<r;b++)o.push(t[c[b][0]]);const m=[];for(let b=r;b<c.length;b++)m.push(t[c[b][0]]);return[o,m]}function sde(t){const e=t.getFrustumPlanes(),r=BM(e.near,t.cameraPosition),i=qv(t,r),n=qv(t,t.cameraPosition,vw);let l=0;lE.planes[l++].fromPointNormal(i,kM.copy(i).subtract(n));for(const c in e){if(c==="near")continue;const o=e[c],m=BM(o,r,vw),b=qv(t,m,vw);lE.planes[l++].fromPointNormal(b,kM.copy(i).subtract(b))}}function BM(t,e,r=new et){const i=t.normal.dot(e);return r.copy(t.normal).scale(t.distance-i).add(e),r}function qv(t,e,r=new et){const i=t.unprojectPosition(e);return Fi.WGS84.cartographicToCartesian(i,r)}const ode=6378137,ade=6378137,cE=6356752314245179e-9,qm=new et;function lde(t,e){if(t instanceof Xy){const{halfAxes:r}=t,i=ude(r);return Math.log2(cE/(i+e[2]))}else if(t instanceof Zy){const{radius:r}=t;return Math.log2(cE/(r+e[2]))}else if(t.width&&t.height){const{width:r,height:i}=t,n=Math.log2(ode/r),l=Math.log2(ade/i);return(n+l)/2}return 1}function DD(t,e,r){Fi.WGS84.cartographicToCartesian([t.xmax,t.ymax,t.zmax],qm);const i=Math.sqrt(Math.pow(qm[0]-r[0],2)+Math.pow(qm[1]-r[1],2)+Math.pow(qm[2]-r[2],2));return Math.log2(cE/(i+e[2]))}function cde(t,e,r){const[i,n,l,c]=t;return DD({xmax:l,ymax:c,zmax:0},e,r)}function ude(t){t.getColumn(0,qm);const e=t.getColumn(1),r=t.getColumn(2);return qm.add(e).add(r).len()}const Ya={UNLOADED:0,LOADING:1,PROCESSING:2,READY:3,EXPIRED:4,FAILED:5};var Rc;(function(t){t[t.ADD=1]="ADD",t[t.REPLACE=2]="REPLACE"})(Rc||(Rc={}));var Ah;(function(t){t.EMPTY="empty",t.SCENEGRAPH="scenegraph",t.POINTCLOUD="pointcloud",t.MESH="mesh"})(Ah||(Ah={}));var _a;(function(t){t.I3S="I3S",t.TILES3D="TILES3D"})(_a||(_a={}));var _g;(function(t){t.GEOMETRIC_ERROR="geometricError",t.MAX_SCREEN_THRESHOLD="maxScreenThreshold"})(_g||(_g={}));const hde={USE_OPTIMIZATION:1};function ND(t){return t!=null}const To=new et,Kv=new et,dde=new et,fde=new et,op=new et,LM=new et,OM=new et,DM=new et;function bw(t,e,r){if(Ni(t,"3D Tile: boundingVolume must be defined"),t.box)return FD(t.box,e,r);if(t.region)return gde(t.region);if(t.sphere)return mde(t.sphere,e,r);throw new Error("3D Tile: boundingVolume must contain a sphere, region, or box")}function pde(t,e){if(t.box)return _de(e);if(t.region){const[r,i,n,l,c,o]=t.region;return[[bc(r),bc(i),c],[bc(n),bc(l),o]]}if(t.sphere)return yde(e);throw new Error("Unkown boundingVolume type")}function FD(t,e,r){const i=new et(t[0],t[1],t[2]);e.transform(i,i);let n=[];if(t.length===10){const b=t.slice(3,6),A=new wy;A.fromArray(t,6);const R=new et([1,0,0]),M=new et([0,1,0]),L=new et([0,0,1]);R.transformByQuaternion(A),R.scale(b[0]),M.transformByQuaternion(A),M.scale(b[1]),L.transformByQuaternion(A),L.scale(b[2]),n=[...R.toArray(),...M.toArray(),...L.toArray()]}else n=[...t.slice(3,6),...t.slice(6,9),...t.slice(9,12)];const l=e.transformAsVector(n.slice(0,3)),c=e.transformAsVector(n.slice(3,6)),o=e.transformAsVector(n.slice(6,9)),m=new kn([l[0],l[1],l[2],c[0],c[1],c[2],o[0],o[1],o[2]]);return ND(r)?(r.center=i,r.halfAxes=m,r):new Xy(i,m)}function mde(t,e,r){const i=new et(t[0],t[1],t[2]);e.transform(i,i);const n=e.getScale(Kv),l=Math.max(Math.max(n[0],n[1]),n[2]),c=t[3]*l;return ND(r)?(r.center=i,r.radius=c,r):new Zy(i,c)}function gde(t){const[e,r,i,n,l,c]=t,o=Fi.WGS84.cartographicToCartesian([bc(e),bc(n),l],dde),m=Fi.WGS84.cartographicToCartesian([bc(i),bc(r),c],fde),b=new et().addVectors(o,m).multiplyByScalar(.5);return Fi.WGS84.cartesianToCartographic(b,op),Fi.WGS84.cartographicToCartesian([bc(i),op[1],op[2]],LM),Fi.WGS84.cartographicToCartesian([op[0],bc(n),op[2]],OM),Fi.WGS84.cartographicToCartesian([op[0],op[1],c],DM),FD([...b,...LM.subtract(b),...OM.subtract(b),...DM.subtract(b)],new Kr)}function _de(t){const e=zD(),{halfAxes:r}=t,i=new et(r.getColumn(0)),n=new et(r.getColumn(1)),l=new et(r.getColumn(2));for(let c=0;c<2;c++){for(let o=0;o<2;o++){for(let m=0;m<2;m++)To.copy(t.center),To.add(i),To.add(n),To.add(l),jD(e,To),l.negate();n.negate()}i.negate()}return e}function yde(t){const e=zD(),{center:r,radius:i}=t,n=Fi.WGS84.scaleToGeodeticSurface(r,To);let l;n?l=Fi.WGS84.geodeticSurfaceNormal(n):l=new et(0,0,1);let c=new et(l[2],-l[1],0);c.len()>0?c.normalize():c=new et(0,1,0);const o=c.clone().cross(l);for(const m of[c,o,l]){Kv.copy(m).scale(i);for(let b=0;b<2;b++)To.copy(r),To.add(Kv),jD(e,To),Kv.negate()}return e}function zD(){return[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]]}function jD(t,e){Fi.WGS84.cartesianToCartographic(e,To),t[0][0]=Math.min(t[0][0],To[0]),t[0][1]=Math.min(t[0][1],To[1]),t[0][2]=Math.min(t[0][2],To[2]),t[1][0]=Math.max(t[1][0],To[0]),t[1][1]=Math.max(t[1][1],To[1]),t[1][2]=Math.max(t[1][2],To[2])}new et;new et;new Kr;new et;new et;new et;function vde(t,e){const r=t*e;return 1-Math.exp(-(r*r))}function bde(t,e){if(t.dynamicScreenSpaceError&&t.dynamicScreenSpaceErrorComputedDensity){const r=t.dynamicScreenSpaceErrorComputedDensity,i=t.dynamicScreenSpaceErrorFactor;return vde(e,r)*i}return 0}function xde(t,e,r){const i=t.tileset,n=t.parent&&t.parent.lodMetricValue||t.lodMetricValue,l=r?n:t.lodMetricValue;if(l===0)return 0;const c=Math.max(t._distanceToCamera,1e-7),{height:o,sseDenominator:m}=e,{viewDistanceScale:b}=i.options;let A=l*o*(b||1)/(c*m);return A-=bde(i,c),A}const xw=new et,NM=new et,Ed=new et,FM=new et,wde=new et,ww=new Kr,zM=new Kr;function Ede(t,e){if(t.lodMetricValue===0||isNaN(t.lodMetricValue))return"DIG";const r=2*UD(t,e);return r<2?"OUT":!t.header.children||r<=t.lodMetricValue?"DRAW":t.header.children?"DIG":"OUT"}function UD(t,e){const{topDownViewport:r}=e,i=t.header.mbs[1],n=t.header.mbs[0],l=t.header.mbs[2],c=t.header.mbs[3],o=[...t.boundingVolume.center],m=r.unprojectPosition(r.cameraPosition);Fi.WGS84.cartographicToCartesian(m,xw),NM.copy(xw).subtract(o).normalize(),Fi.WGS84.eastNorthUpToFixedFrame(o,ww),zM.copy(ww).invert(),Ed.copy(xw).transform(zM);const b=Math.sqrt(Ed[0]*Ed[0]+Ed[1]*Ed[1]),A=b*b/Ed[2];FM.copy([Ed[0],Ed[1],A]);const R=FM.transform(ww).subtract(o).normalize(),M=NM.cross(R).normalize().scale(c).add(o),L=Fi.WGS84.cartesianToCartographic(M),G=r.project([n,i,l]),V=r.project(L);return wde.copy(G).subtract(V).magnitude()}function Ade(t){return{assetGltfUpAxis:t.asset&&t.asset.gltfUpAxis||"Y"}}class jM{_map=new Map;_array;_length;constructor(e=0){this._array=new Array(e),this._length=e}get length(){return this._length}set length(e){this._length=e,e>this._array.length&&(this._array.length=e)}get values(){return this._array}get(e){return Ni(e<this._array.length),this._array[e]}set(e,r){Ni(e>=0),e>=this.length&&(this.length=e+1),this._map.has(this._array[e])&&this._map.delete(this._array[e]),this._array[e]=r,this._map.set(r,e)}delete(e){const r=this._map.get(e);r>=0&&(this._array.splice(r,1),this._map.delete(e),this.length--)}peek(){return this._array[this._length-1]}push(e){if(!this._map.has(e)){const r=this.length++;this._array[r]=e,this._map.set(e,r)}}pop(){const e=this._array[--this.length];return this._map.delete(e),e}reserve(e){Ni(e>=0),e>this._array.length&&(this._array.length=e)}resize(e){Ni(e>=0),this.length=e}trim(e){e==null&&(e=this.length),this._array.length=e}reset(){this._array=[],this._map=new Map,this._length=0}find(e){return this._map.has(e)}}const Tde={loadSiblings:!1,skipLevelOfDetail:!1,updateTransforms:!0,onTraversalEnd:()=>{},viewportTraversersMap:{},basePath:""};class pb{options;root=null;selectedTiles={};requestedTiles={};emptyTiles={};lastUpdate=new Date().getTime();updateDebounceTime=1e3;_traversalStack=new jM;_emptyTraversalStack=new jM;_frameNumber=null;traversalFinished(e){return!0}constructor(e){this.options={...Tde,...e}}traverse(e,r,i){this.root=e,this.options={...this.options,...i},this.reset(),this.updateTile(e,r),this._frameNumber=r.frameNumber,this.executeTraversal(e,r)}reset(){this.requestedTiles={},this.selectedTiles={},this.emptyTiles={},this._traversalStack.reset(),this._emptyTraversalStack.reset()}executeTraversal(e,r){const i=this._traversalStack;for(e._selectionDepth=1,i.push(e);i.length>0;){const l=i.pop();let c=!1;this.canTraverse(l,r)&&(this.updateChildTiles(l,r),c=this.updateAndPushChildren(l,r,i,l.hasRenderContent?l._selectionDepth+1:l._selectionDepth));const o=l.parent,m=!!(!o||o._shouldRefine),b=!c;l.hasRenderContent?l.refine===Rc.ADD?(this.loadTile(l,r),this.selectTile(l,r)):l.refine===Rc.REPLACE&&(this.loadTile(l,r),b&&this.selectTile(l,r)):(this.emptyTiles[l.id]=l,this.loadTile(l,r),b&&this.selectTile(l,r)),this.touchTile(l,r),l._shouldRefine=c&&m}const n=new Date().getTime();(this.traversalFinished(r)||n-this.lastUpdate>this.updateDebounceTime)&&(this.lastUpdate=n,this.options.onTraversalEnd(r))}updateChildTiles(e,r){const i=e.children;for(const n of i)this.updateTile(n,r)}updateAndPushChildren(e,r,i,n){const{loadSiblings:l,skipLevelOfDetail:c}=this.options,o=e.children;o.sort(this.compareDistanceToCamera.bind(this));const m=e.refine===Rc.REPLACE&&e.hasRenderContent&&!c;let b=!1,A=!0;for(const R of o)if(R._selectionDepth=n,R.isVisibleAndInRequestVolume?(i.find(R)&&i.delete(R),i.push(R),b=!0):(m||l)&&(this.loadTile(R,r),this.touchTile(R,r)),m){let M;if(R._inRequestVolume?R.hasRenderContent?M=R.contentAvailable:M=this.executeEmptyTraversal(R,r):M=!1,A=A&&M,!A)return!1}return b||(A=!1),A}updateTile(e,r){this.updateTileVisibility(e,r)}selectTile(e,r){this.shouldSelectTile(e)&&(e._selectedFrame=r.frameNumber,this.selectedTiles[e.id]=e)}loadTile(e,r){this.shouldLoadTile(e)&&(e._requestedFrame=r.frameNumber,e._priority=e._getPriority(),this.requestedTiles[e.id]=e)}touchTile(e,r){e.tileset._cache.touch(e),e._touchedFrame=r.frameNumber}canTraverse(e,r){return e.hasChildren?e.hasTilesetContent?!e.contentExpired:this.shouldRefine(e,r):!1}shouldLoadTile(e){return e.hasUnloadedContent||e.contentExpired}shouldSelectTile(e){return e.contentAvailable&&!this.options.skipLevelOfDetail}shouldRefine(e,r,i=!1){let n=e._screenSpaceError;return i&&(n=e.getScreenSpaceError(r,!0)),n>e.tileset.memoryAdjustedScreenSpaceError}updateTileVisibility(e,r){const i=[];if(this.options.viewportTraversersMap)for(const n in this.options.viewportTraversersMap)this.options.viewportTraversersMap[n]===r.viewport.id&&i.push(n);else i.push(r.viewport.id);e.updateVisibility(r,i)}compareDistanceToCamera(e,r){return e._distanceToCamera-r._distanceToCamera}anyChildrenVisible(e,r){let i=!1;for(const n of e.children)n.updateVisibility(r),i=i||n.isVisibleAndInRequestVolume;return i}executeEmptyTraversal(e,r){let i=!0;const n=this._emptyTraversalStack;for(n.push(e);n.length>0;){const l=n.pop(),c=!l.hasRenderContent&&this.canTraverse(l,r),o=!l.hasRenderContent&&l.children.length===0;if(!c&&!l.contentAvailable&&!o&&(i=!1),this.updateTile(l,r),l.isVisibleAndInRequestVolume||(this.loadTile(l,r),this.touchTile(l,r)),c){const m=l.children;for(const b of m)n.push(b)}}return i}}const UM=new et;function Sde(t){return t!=null}class uE{tileset;header;id;url;parent;refine;type;contentUrl;lodMetricType="geometricError";lodMetricValue=0;boundingVolume=null;content=null;contentState=Ya.UNLOADED;gpuMemoryUsageInBytes=0;children=[];depth=0;viewportIds=[];transform=new Kr;extensions=null;implicitTiling=null;userData={};computedTransform;hasEmptyContent=!1;hasTilesetContent=!1;traverser=new pb({});_cacheNode=null;_frameNumber=null;_expireDate=null;_expiredContent=null;_boundingBox=void 0;_distanceToCamera=0;_screenSpaceError=0;_visibilityPlaneMask;_visible=void 0;_contentBoundingVolume;_viewerRequestVolume;_initialTransform=new Kr;_priority=0;_selectedFrame=0;_requestedFrame=0;_selectionDepth=0;_touchedFrame=0;_centerZDepth=0;_shouldRefine=!1;_stackLength=0;_visitedFrame=0;_inRequestVolume=!1;_lodJudge=null;constructor(e,r,i,n=""){this.header=r,this.tileset=e,this.id=n||r.id,this.url=r.url,this.parent=i,this.refine=this._getRefine(r.refine),this.type=r.type,this.contentUrl=r.contentUrl,this._initializeLodMetric(r),this._initializeTransforms(r),this._initializeBoundingVolumes(r),this._initializeContent(r),this._initializeRenderingState(r),Object.seal(this)}destroy(){this.header=null}isDestroyed(){return this.header===null}get selected(){return this._selectedFrame===this.tileset._frameNumber}get isVisible(){return this._visible}get isVisibleAndInRequestVolume(){return this._visible&&this._inRequestVolume}get hasRenderContent(){return!this.hasEmptyContent&&!this.hasTilesetContent}get hasChildren(){return this.children.length>0||this.header.children&&this.header.children.length>0}get contentReady(){return this.contentState===Ya.READY||this.hasEmptyContent}get contentAvailable(){return!!(this.contentReady&&this.hasRenderContent||this._expiredContent&&!this.contentFailed)}get hasUnloadedContent(){return this.hasRenderContent&&this.contentUnloaded}get contentUnloaded(){return this.contentState===Ya.UNLOADED}get contentExpired(){return this.contentState===Ya.EXPIRED}get contentFailed(){return this.contentState===Ya.FAILED}get distanceToCamera(){return this._distanceToCamera}get screenSpaceError(){return this._screenSpaceError}get boundingBox(){return this._boundingBox||(this._boundingBox=pde(this.header.boundingVolume,this.boundingVolume)),this._boundingBox}getScreenSpaceError(e,r){switch(this.tileset.type){case _a.I3S:return UD(this,e);case _a.TILES3D:return xde(this,e,r);default:throw new Error("Unsupported tileset type")}}unselect(){this._selectedFrame=0}_getGpuMemoryUsageInBytes(){return this.content.gpuMemoryUsageInBytes||this.content.byteLength||0}_getPriority(){const e=this.tileset._traverser,{skipLevelOfDetail:r}=e.options,i=this.refine===Rc.ADD||r;if(i&&!this.isVisible&&this._visible!==void 0||this.tileset._frameNumber-this._touchedFrame>=1||this.contentState===Ya.UNLOADED)return-1;const n=this.parent,l=n&&(!i||this._screenSpaceError===0||n.hasTilesetContent)?n._screenSpaceError:this._screenSpaceError,c=e.root?e.root._screenSpaceError:0;return Math.max(c-l,0)}async loadContent(){if(this.hasEmptyContent)return!1;if(this.content)return!0;this.contentExpired&&(this._expireDate=null),this.contentState=Ya.LOADING;const e=await this.tileset._requestScheduler.scheduleRequest(this.id,this._getPriority.bind(this));if(!e)return this.contentState=Ya.UNLOADED,!1;try{const r=this.tileset.getTileUrl(this.contentUrl),i=this.tileset.loader,n={...this.tileset.loadOptions,[i.id]:{...this.tileset.loadOptions[i.id],isTileset:this.type==="json",...this._getLoaderSpecificOptions(i.id)}};return this.content=await Fd(r,i,n),this.tileset.options.contentLoader&&await this.tileset.options.contentLoader(this),this._isTileset()&&this.tileset._initializeTileHeaders(this.content,this),this.contentState=Ya.READY,this._onContentLoaded(),!0}catch(r){throw this.contentState=Ya.FAILED,r}finally{e.done()}}unloadContent(){return this.content&&this.content.destroy&&this.content.destroy(),this.content=null,this.header.content&&this.header.content.destroy&&this.header.content.destroy(),this.header.content=null,this.contentState=Ya.UNLOADED,!0}updateVisibility(e,r){if(this._frameNumber===e.frameNumber)return;const i=this.parent,n=i?i._visibilityPlaneMask:Dl.MASK_INDETERMINATE;if(this.tileset._traverser.options.updateTransforms){const l=i?i.computedTransform:this.tileset.modelMatrix;this._updateTransform(l)}this._distanceToCamera=this.distanceToTile(e),this._screenSpaceError=this.getScreenSpaceError(e,!1),this._visibilityPlaneMask=this.visibility(e,n),this._visible=this._visibilityPlaneMask!==Dl.MASK_OUTSIDE,this._inRequestVolume=this.insideViewerRequestVolume(e),this._frameNumber=e.frameNumber,this.viewportIds=r}visibility(e,r){const{cullingVolume:i}=e,{boundingVolume:n}=this;return i.computeVisibilityWithPlaneMask(n,r)}contentVisibility(){return!0}distanceToTile(e){const r=this.boundingVolume;return Math.sqrt(Math.max(r.distanceSquaredTo(e.camera.position),0))}cameraSpaceZDepth({camera:e}){const r=this.boundingVolume;return UM.subVectors(r.center,e.position),e.direction.dot(UM)}insideViewerRequestVolume(e){const r=this._viewerRequestVolume;return!r||r.distanceSquaredTo(e.camera.position)<=0}updateExpiration(){if(Sde(this._expireDate)&&this.contentReady&&!this.hasEmptyContent){const e=Date.now();Date.lessThan(this._expireDate,e)&&(this.contentState=Ya.EXPIRED,this._expiredContent=this.content)}}get extras(){return this.header.extras}_initializeLodMetric(e){"lodMetricType"in e?this.lodMetricType=e.lodMetricType:(this.lodMetricType=this.parent&&this.parent.lodMetricType||this.tileset.lodMetricType,console.warn("3D Tile: Required prop lodMetricType is undefined. Using parent lodMetricType")),"lodMetricValue"in e?this.lodMetricValue=e.lodMetricValue:(this.lodMetricValue=this.parent&&this.parent.lodMetricValue||this.tileset.lodMetricValue,console.warn("3D Tile: Required prop lodMetricValue is undefined. Using parent lodMetricValue"))}_initializeTransforms(e){this.transform=e.transform?new Kr(e.transform):new Kr;const r=this.parent,i=this.tileset,n=r&&r.computedTransform?r.computedTransform.clone():i.modelMatrix.clone();this.computedTransform=new Kr(n).multiplyRight(this.transform);const l=r&&r._initialTransform?r._initialTransform.clone():new Kr;this._initialTransform=new Kr(l).multiplyRight(this.transform)}_initializeBoundingVolumes(e){this._contentBoundingVolume=null,this._viewerRequestVolume=null,this._updateBoundingVolume(e)}_initializeContent(e){this.content={_tileset:this.tileset,_tile:this},this.hasEmptyContent=!0,this.contentState=Ya.UNLOADED,this.hasTilesetContent=!1,e.contentUrl&&(this.content=null,this.hasEmptyContent=!1)}_initializeRenderingState(e){this.depth=e.level||(this.parent?this.parent.depth+1:0),this._shouldRefine=!1,this._distanceToCamera=0,this._centerZDepth=0,this._screenSpaceError=0,this._visibilityPlaneMask=Dl.MASK_INDETERMINATE,this._visible=void 0,this._inRequestVolume=!1,this._stackLength=0,this._selectionDepth=0,this._frameNumber=0,this._touchedFrame=0,this._visitedFrame=0,this._selectedFrame=0,this._requestedFrame=0,this._priority=0}_getRefine(e){return e||this.parent&&this.parent.refine||Rc.REPLACE}_isTileset(){return this.contentUrl.indexOf(".json")!==-1}_onContentLoaded(){switch(this.content&&this.content.type){case"vctr":case"geom":this.tileset._traverser.disableSkipLevelOfDetail=!0;break}this._isTileset()?this.hasTilesetContent=!0:this.gpuMemoryUsageInBytes=this._getGpuMemoryUsageInBytes()}_updateBoundingVolume(e){this.boundingVolume=bw(e.boundingVolume,this.computedTransform,this.boundingVolume);const r=e.content;r&&(r.boundingVolume&&(this._contentBoundingVolume=bw(r.boundingVolume,this.computedTransform,this._contentBoundingVolume)),e.viewerRequestVolume&&(this._viewerRequestVolume=bw(e.viewerRequestVolume,this.computedTransform,this._viewerRequestVolume)))}_updateTransform(e=new Kr){const r=e.clone().multiplyRight(this.transform);r.equals(this.computedTransform)||(this.computedTransform=r,this._updateBoundingVolume(this.header))}_getLoaderSpecificOptions(e){switch(e){case"i3s":return{...this.tileset.options.i3s,_tileOptions:{attributeUrls:this.header.attributeUrls,textureUrl:this.header.textureUrl,textureFormat:this.header.textureFormat,textureLoaderOptions:this.header.textureLoaderOptions,materialDefinition:this.header.materialDefinition,isDracoGeometry:this.header.isDracoGeometry,mbs:this.header.mbs},_tilesetOptions:{store:this.tileset.tileset.store,attributeStorageInfo:this.tileset.tileset.attributeStorageInfo,fields:this.tileset.tileset.fields},isTileHeader:!1};case"3d-tiles":case"cesium-ion":default:return Ade(this.tileset.tileset)}}}class Cde extends pb{compareDistanceToCamera(e,r){return r._distanceToCamera===0&&e._distanceToCamera===0?r._centerZDepth-e._centerZDepth:r._distanceToCamera-e._distanceToCamera}updateTileVisibility(e,r){if(super.updateTileVisibility(e,r),!e.isVisibleAndInRequestVolume)return;const i=e.children.length>0;if(e.hasTilesetContent&&i){const c=e.children[0];this.updateTileVisibility(c,r),e._visible=c._visible;return}if(this.meetsScreenSpaceErrorEarly(e,r)){e._visible=!1;return}const n=e.refine===Rc.REPLACE,l=e._optimChildrenWithinParent===hde.USE_OPTIMIZATION;if(n&&l&&i&&!this.anyChildrenVisible(e,r)){e._visible=!1;return}}meetsScreenSpaceErrorEarly(e,r){const{parent:i}=e;return!i||i.hasTilesetContent||i.refine!==Rc.ADD?!1:!this.shouldRefine(e,r,!0)}}class Pde{frameNumberMap=new Map;register(e,r){const i=this.frameNumberMap.get(e)||new Map,n=i.get(r)||0;i.set(r,n+1),this.frameNumberMap.set(e,i)}deregister(e,r){const i=this.frameNumberMap.get(e);if(!i)return;const n=i.get(r)||1;i.set(r,n-1)}isZero(e,r){return(this.frameNumberMap.get(e)?.get(r)||0)===0}}const Ew={REQUESTED:"REQUESTED",COMPLETED:"COMPLETED",ERROR:"ERROR"};class Rde{_statusMap;pendingTilesRegister=new Pde;constructor(){this._statusMap={}}add(e,r,i,n){if(!this._statusMap[r]){const{frameNumber:l,viewport:{id:c}}=n;this._statusMap[r]={request:e,callback:i,key:r,frameState:n,status:Ew.REQUESTED},this.pendingTilesRegister.register(c,l),e().then(o=>{this._statusMap[r].status=Ew.COMPLETED;const{frameNumber:m,viewport:{id:b}}=this._statusMap[r].frameState;this.pendingTilesRegister.deregister(b,m),this._statusMap[r].callback(o,n)}).catch(o=>{this._statusMap[r].status=Ew.ERROR;const{frameNumber:m,viewport:{id:b}}=this._statusMap[r].frameState;this.pendingTilesRegister.deregister(b,m),i(o)})}}update(e,r){if(this._statusMap[e]){const{frameNumber:i,viewport:{id:n}}=this._statusMap[e].frameState;this.pendingTilesRegister.deregister(n,i);const{frameNumber:l,viewport:{id:c}}=r;this.pendingTilesRegister.register(c,l),this._statusMap[e].frameState=r}}find(e){return this._statusMap[e]}hasPendingTiles(e,r){return!this.pendingTilesRegister.isZero(e,r)}}class Mde extends pb{_tileManager;constructor(e){super(e),this._tileManager=new Rde}traversalFinished(e){return!this._tileManager.hasPendingTiles(e.viewport.id,this._frameNumber||0)}shouldRefine(e,r){return e._lodJudge=Ede(e,r),e._lodJudge==="DIG"}updateChildTiles(e,r){const i=e.header.children||[],n=e.children,l=e.tileset;for(const c of i){const o=`${c.id}-${r.viewport.id}`,m=n&&n.find(b=>b.id===o);if(m)m&&this.updateTile(m,r);else{let b=()=>this._loadTile(c.id,l);this._tileManager.find(o)?this._tileManager.update(o,r):(l.tileset.nodePages&&(b=()=>l.tileset.nodePagesTile.formTileFromNodePages(c.id)),this._tileManager.add(b,o,A=>this._onTileLoad(A,e,o),r))}}return!1}async _loadTile(e,r){const{loader:i}=r,n=r.getTileUrl(`${r.url}/nodes/${e}`),l={...r.loadOptions,i3s:{...r.loadOptions.i3s,isTileHeader:!0}};return await Fd(n,i,l)}_onTileLoad(e,r,i){const n=new uE(r.tileset,e,r,i);r.children.push(n);const l=this._tileManager.find(n.id).frameState;this.updateTile(n,l),this._frameNumber===l.frameNumber&&(this.traversalFinished(l)||new Date().getTime()-this.lastUpdate>this.updateDebounceTime)&&this.executeTraversal(n,l)}}const Ide={description:"",ellipsoid:Fi.WGS84,modelMatrix:new Kr,throttleRequests:!0,maxRequests:64,maximumMemoryUsage:32,memoryCacheOverflow:1,maximumTilesSelected:0,debounceTime:0,onTileLoad:()=>{},onTileUnload:()=>{},onTileError:()=>{},onTraversalComplete:t=>t,contentLoader:void 0,viewDistanceScale:1,maximumScreenSpaceError:8,memoryAdjustedScreenSpaceError:!1,loadTiles:!0,updateTransforms:!0,viewportTraversersMap:null,loadOptions:{fetch:{}},attributions:[],basePath:"",i3s:{}},Pv="Tiles In Tileset(s)",Aw="Tiles In Memory",VM="Tiles In View",GM="Tiles To Render",HM="Tiles Loaded",Tw="Tiles Loading",$M="Tiles Unloaded",WM="Failed Tile Loads",qM="Points/Vertices",Sw="Tile Memory Use",KM="Maximum Screen Space Error";class kde{options;loadOptions;type;tileset;loader;url;basePath;modelMatrix;ellipsoid;lodMetricType;lodMetricValue;refine;root=null;roots={};asset={};description="";properties;extras=null;attributions={};credits={};stats;contentFormats={draco:!1,meshopt:!1,dds:!1,ktx2:!1};cartographicCenter=null;cartesianCenter=null;zoom=1;boundingVolume=null;dynamicScreenSpaceErrorComputedDensity=0;maximumMemoryUsage=32;gpuMemoryUsageInBytes=0;memoryAdjustedScreenSpaceError=0;_cacheBytes=0;_cacheOverflowBytes=0;_frameNumber=0;_queryParams={};_extensionsUsed=[];_tiles={};_pendingCount=0;selectedTiles=[];traverseCounter=0;geometricError=0;lastUpdatedVieports=null;_requestedTiles=[];_emptyTiles=[];frameStateData={};_traverser;_cache=new tde;_requestScheduler;updatePromise=null;tilesetInitializationPromise;constructor(e,r){this.options={...Ide,...r},this.tileset=e,this.loader=e.loader,this.type=e.type,this.url=e.url,this.basePath=e.basePath||NA(this.url),this.modelMatrix=this.options.modelMatrix,this.ellipsoid=this.options.ellipsoid,this.lodMetricType=e.lodMetricType,this.lodMetricValue=e.lodMetricValue,this.refine=e.root.refine,this.loadOptions=this.options.loadOptions||{},this._traverser=this._initializeTraverser(),this._requestScheduler=new qK({throttleRequests:this.options.throttleRequests,maxRequests:this.options.maxRequests}),this.memoryAdjustedScreenSpaceError=this.options.maximumScreenSpaceError,this._cacheBytes=this.options.maximumMemoryUsage*1024*1024,this._cacheOverflowBytes=this.options.memoryCacheOverflow*1024*1024,this.stats=new kg({id:this.url}),this._initializeStats(),this.tilesetInitializationPromise=this._initializeTileSet(e)}destroy(){this._destroy()}isLoaded(){return this._pendingCount===0&&this._frameNumber!==0&&this._requestedTiles.length===0}get tiles(){return Object.values(this._tiles)}get frameNumber(){return this._frameNumber}get queryParams(){return new URLSearchParams(this._queryParams).toString()}setProps(e){this.options={...this.options,...e}}getTileUrl(e){if(e.startsWith("data:"))return e;let r=e;return this.queryParams.length&&(r=`${e}${e.includes("?")?"&":"?"}${this.queryParams}`),r}hasExtension(e){return this._extensionsUsed.indexOf(e)>-1}update(e=null){this.tilesetInitializationPromise.then(()=>{!e&&this.lastUpdatedVieports?e=this.lastUpdatedVieports:this.lastUpdatedVieports=e,e&&this.doUpdate(e)})}async selectTiles(e=null){return await this.tilesetInitializationPromise,e&&(this.lastUpdatedVieports=e),this.updatePromise||(this.updatePromise=new Promise(r=>{setTimeout(()=>{this.lastUpdatedVieports&&this.doUpdate(this.lastUpdatedVieports),r(this._frameNumber),this.updatePromise=null},this.options.debounceTime)})),this.updatePromise}adjustScreenSpaceError(){this.gpuMemoryUsageInBytes<this._cacheBytes?this.memoryAdjustedScreenSpaceError=Math.max(this.memoryAdjustedScreenSpaceError/1.02,this.options.maximumScreenSpaceError):this.gpuMemoryUsageInBytes>this._cacheBytes+this._cacheOverflowBytes&&(this.memoryAdjustedScreenSpaceError*=1.02)}doUpdate(e){if("loadTiles"in this.options&&!this.options.loadTiles||this.traverseCounter>0)return;const r=e instanceof Array?e:[e];this._cache.reset(),this._frameNumber++,this.traverseCounter=r.length;const i=[];for(const n of r){const l=n.id;this._needTraverse(l)?i.push(l):this.traverseCounter--}for(const n of r){const l=n.id;if(this.roots[l]||(this.roots[l]=this._initializeTileHeaders(this.tileset,null)),!i.includes(l))continue;const c=ide(n,this._frameNumber);this._traverser.traverse(this.roots[l],c,this.options)}}_needTraverse(e){let r=e;return this.options.viewportTraversersMap&&(r=this.options.viewportTraversersMap[e]),r===e}_onTraversalEnd(e){const r=e.viewport.id;this.frameStateData[r]||(this.frameStateData[r]={selectedTiles:[],_requestedTiles:[],_emptyTiles:[]});const i=this.frameStateData[r],n=Object.values(this._traverser.selectedTiles),[l,c]=nde(n,e,this.options.maximumTilesSelected);i.selectedTiles=l;for(const o of c)o.unselect();i._requestedTiles=Object.values(this._traverser.requestedTiles),i._emptyTiles=Object.values(this._traverser.emptyTiles),this.traverseCounter--,!(this.traverseCounter>0)&&this._updateTiles()}_updateTiles(){this.selectedTiles=[],this._requestedTiles=[],this._emptyTiles=[];for(const e in this.frameStateData){const r=this.frameStateData[e];this.selectedTiles=this.selectedTiles.concat(r.selectedTiles),this._requestedTiles=this._requestedTiles.concat(r._requestedTiles),this._emptyTiles=this._emptyTiles.concat(r._emptyTiles)}this.selectedTiles=this.options.onTraversalComplete(this.selectedTiles);for(const e of this.selectedTiles)this._tiles[e.id]=e;this._loadTiles(),this._unloadTiles(),this._updateStats()}_tilesChanged(e,r){if(e.length!==r.length)return!0;const i=new Set(e.map(c=>c.id)),n=new Set(r.map(c=>c.id));let l=e.filter(c=>!n.has(c.id)).length>0;return l=l||r.filter(c=>!i.has(c.id)).length>0,l}_loadTiles(){for(const e of this._requestedTiles)e.contentUnloaded&&this._loadTile(e)}_unloadTiles(){this._cache.unloadTiles(this,(e,r)=>e._unloadTile(r))}_updateStats(){let e=0,r=0;for(const i of this.selectedTiles)i.contentAvailable&&i.content&&(e++,i.content.pointCount?r+=i.content.pointCount:r+=i.content.vertexCount);this.stats.get(VM).count=this.selectedTiles.length,this.stats.get(GM).count=e,this.stats.get(qM).count=r,this.stats.get(KM).count=this.memoryAdjustedScreenSpaceError}async _initializeTileSet(e){this.type===_a.I3S&&(this.calculateViewPropsI3S(),e.root=await e.root),this.root=this._initializeTileHeaders(e,null),this.type===_a.TILES3D&&(this._initializeTiles3DTileset(e),this.calculateViewPropsTiles3D()),this.type===_a.I3S&&this._initializeI3STileset()}calculateViewPropsI3S(){const e=this.tileset.fullExtent;if(e){const{xmin:i,xmax:n,ymin:l,ymax:c,zmin:o,zmax:m}=e;this.cartographicCenter=new et(i+(n-i)/2,l+(c-l)/2,o+(m-o)/2),this.cartesianCenter=new et,Fi.WGS84.cartographicToCartesian(this.cartographicCenter,this.cartesianCenter),this.zoom=DD(e,this.cartographicCenter,this.cartesianCenter);return}const r=this.tileset.store?.extent;if(r){const[i,n,l,c]=r;this.cartographicCenter=new et(i+(l-i)/2,n+(c-n)/2,0),this.cartesianCenter=new et,Fi.WGS84.cartographicToCartesian(this.cartographicCenter,this.cartesianCenter),this.zoom=cde(r,this.cartographicCenter,this.cartesianCenter);return}console.warn("Extent is not defined in the tileset header"),this.cartographicCenter=new et,this.zoom=1}calculateViewPropsTiles3D(){const e=this.root,{center:r}=e.boundingVolume;if(!r){console.warn("center was not pre-calculated for the root tile"),this.cartographicCenter=new et,this.zoom=1;return}r[0]!==0||r[1]!==0||r[2]!==0?(this.cartographicCenter=new et,Fi.WGS84.cartesianToCartographic(r,this.cartographicCenter)):this.cartographicCenter=new et(0,0,-Fi.WGS84.radii[0]),this.cartesianCenter=r,this.zoom=lde(e.boundingVolume,this.cartographicCenter)}_initializeStats(){this.stats.get(Pv),this.stats.get(Tw),this.stats.get(Aw),this.stats.get(VM),this.stats.get(GM),this.stats.get(HM),this.stats.get($M),this.stats.get(WM),this.stats.get(qM),this.stats.get(Sw,"memory"),this.stats.get(KM)}_initializeTileHeaders(e,r){const i=new uE(this,e.root,r);if(r&&(r.children.push(i),i.depth=r.depth+1),this.type===_a.TILES3D){const n=[];for(n.push(i);n.length>0;){const l=n.pop();this.stats.get(Pv).incrementCount();const c=l.header.children||[];for(const o of c){const m=new uE(this,o,l);if(m.contentUrl?.includes("?session=")){const b=new URL(m.contentUrl).searchParams.get("session");b&&(this._queryParams.session=b)}l.children.push(m),m.depth=l.depth+1,n.push(m)}}}return i}_initializeTraverser(){let e;switch(this.type){case _a.TILES3D:e=Cde;break;case _a.I3S:e=Mde;break;default:e=pb}return new e({basePath:this.basePath,onTraversalEnd:this._onTraversalEnd.bind(this)})}_destroyTileHeaders(e){this._destroySubtree(e)}async _loadTile(e){let r;try{this._onStartTileLoading(),r=await e.loadContent()}catch(i){this._onTileLoadError(e,i instanceof Error?i:new Error("load failed"))}finally{this._onEndTileLoading(),this._onTileLoad(e,r)}}_onTileLoadError(e,r){this.stats.get(WM).incrementCount();const i=r.message||r.toString(),n=e.url;console.error(`A 3D tile failed to load: ${e.url} ${i}`),this.options.onTileError(e,i,n)}_onTileLoad(e,r){if(r){if(this.type===_a.I3S){const i=this.tileset?.nodePagesTile?.nodesInNodePages||0;this.stats.get(Pv).reset(),this.stats.get(Pv).addCount(i)}e&&e.content&&rde(e,e.content),this.updateContentTypes(e),this._addTileToCache(e),this.options.onTileLoad(e)}}updateContentTypes(e){if(this.type===_a.I3S)switch(e.header.isDracoGeometry&&(this.contentFormats.draco=!0),e.header.textureFormat){case"dds":this.contentFormats.dds=!0;break;case"ktx2":this.contentFormats.ktx2=!0;break}else if(this.type===_a.TILES3D){const{extensionsRemoved:r=[]}=e.content?.gltf||{};r.includes("KHR_draco_mesh_compression")&&(this.contentFormats.draco=!0),r.includes("EXT_meshopt_compression")&&(this.contentFormats.meshopt=!0),r.includes("KHR_texture_basisu")&&(this.contentFormats.ktx2=!0)}}_onStartTileLoading(){this._pendingCount++,this.stats.get(Tw).incrementCount()}_onEndTileLoading(){this._pendingCount--,this.stats.get(Tw).decrementCount()}_addTileToCache(e){this._cache.add(this,e,r=>r._updateCacheStats(e))}_updateCacheStats(e){this.stats.get(HM).incrementCount(),this.stats.get(Aw).incrementCount(),this.gpuMemoryUsageInBytes+=e.gpuMemoryUsageInBytes||0,this.stats.get(Sw).count=this.gpuMemoryUsageInBytes,this.options.memoryAdjustedScreenSpaceError&&this.adjustScreenSpaceError()}_unloadTile(e){this.gpuMemoryUsageInBytes-=e.gpuMemoryUsageInBytes||0,this.stats.get(Aw).decrementCount(),this.stats.get($M).incrementCount(),this.stats.get(Sw).count=this.gpuMemoryUsageInBytes,this.options.onTileUnload(e),e.unloadContent()}_destroy(){const e=[];for(this.root&&e.push(this.root);e.length>0;){const r=e.pop();for(const i of r.children)e.push(i);this._destroyTile(r)}this.root=null}_destroySubtree(e){const r=e,i=[];for(i.push(r);i.length>0;){e=i.pop();for(const n of e.children)i.push(n);e!==r&&this._destroyTile(e)}r.children=[]}_destroyTile(e){this._cache.unloadTile(this,e),this._unloadTile(e),e.destroy()}_initializeTiles3DTileset(e){if(e.queryString){const r=new URLSearchParams(e.queryString),i=Object.fromEntries(r.entries());this._queryParams={...this._queryParams,...i}}if(this.asset=e.asset,!this.asset)throw new Error("Tileset must have an asset property.");if(this.asset.version!=="0.0"&&this.asset.version!=="1.0"&&this.asset.version!=="1.1")throw new Error("The tileset must be 3D Tiles version either 0.0 or 1.0 or 1.1.");"tilesetVersion"in this.asset&&(this._queryParams.v=this.asset.tilesetVersion),this.credits={attributions:this.options.attributions||[]},this.description=this.options.description||"",this.properties=e.properties,this.geometricError=e.geometricError,this._extensionsUsed=e.extensionsUsed||[],this.extras=e.extras}_initializeI3STileset(){this.loadOptions.i3s&&"token"in this.loadOptions.i3s&&(this._queryParams.token=this.loadOptions.i3s.token)}}const VD="4.3.1",F_={COMPOSITE:"cmpt",POINT_CLOUD:"pnts",BATCHED_3D_MODEL:"b3dm",INSTANCED_3D_MODEL:"i3dm",GLTF:"glTF"};function GD(t,e,r){Ni(t instanceof ArrayBuffer);const i=new TextDecoder("utf8"),n=new Uint8Array(t,e,r);return i.decode(n)}function Bde(t,e=0){const r=new DataView(t);return`${String.fromCharCode(r.getUint8(e+0))}${String.fromCharCode(r.getUint8(e+1))}${String.fromCharCode(r.getUint8(e+2))}${String.fromCharCode(r.getUint8(e+3))}`}const Lde={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},is={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DOUBLE:5130},ai={...Lde,...is},Cw={[is.DOUBLE]:Float64Array,[is.FLOAT]:Float32Array,[is.UNSIGNED_SHORT]:Uint16Array,[is.UNSIGNED_INT]:Uint32Array,[is.UNSIGNED_BYTE]:Uint8Array,[is.BYTE]:Int8Array,[is.SHORT]:Int16Array,[is.INT]:Int32Array},Ode={DOUBLE:is.DOUBLE,FLOAT:is.FLOAT,UNSIGNED_SHORT:is.UNSIGNED_SHORT,UNSIGNED_INT:is.UNSIGNED_INT,UNSIGNED_BYTE:is.UNSIGNED_BYTE,BYTE:is.BYTE,SHORT:is.SHORT,INT:is.INT},Pw="Failed to convert GL type";class Cu{static fromTypedArray(e){e=ArrayBuffer.isView(e)?e.constructor:e;for(const r in Cw)if(Cw[r]===e)return r;throw new Error(Pw)}static fromName(e){const r=Ode[e];if(!r)throw new Error(Pw);return r}static getArrayType(e){switch(e){case is.UNSIGNED_SHORT_5_6_5:case is.UNSIGNED_SHORT_4_4_4_4:case is.UNSIGNED_SHORT_5_5_5_1:return Uint16Array;default:const r=Cw[e];if(!r)throw new Error(Pw);return r}}static getByteSize(e){return Cu.getArrayType(e).BYTES_PER_ELEMENT}static validate(e){return!!Cu.getArrayType(e)}static createTypedArray(e,r,i=0,n){n===void 0&&(n=(r.byteLength-i)/Cu.getByteSize(e));const l=Cu.getArrayType(e);return new l(r,i,n)}}function Dde(t,e){if(!t)throw new Error(`math.gl assertion failed. ${e}`)}function Nde(t,e=[0,0,0]){const r=t>>11&31,i=t>>5&63,n=t&31;return e[0]=r<<3,e[1]=i<<2,e[2]=n<<3,e}new rT;new et;new rT;new rT;function ZM(t,e=255){return Eh(t,0,e)/e*2-1}function XM(t){return t<0?-1:1}function Fde(t,e,r,i){if(Dde(i),t<0||t>r||e<0||e>r)throw new Error(`x and y must be unsigned normalized integers between 0 and ${r}`);if(i.x=ZM(t,r),i.y=ZM(e,r),i.z=1-(Math.abs(i.x)+Math.abs(i.y)),i.z<0){const n=i.x;i.x=(1-Math.abs(i.y))*XM(n),i.y=(1-Math.abs(n))*XM(i.y)}return i.normalize()}function zde(t,e,r){return Fde(t,e,255,r)}class LT{json;buffer;featuresLength=0;_cachedTypedArrays={};constructor(e,r){this.json=e,this.buffer=r}getExtension(e){return this.json.extensions&&this.json.extensions[e]}hasProperty(e){return!!this.json[e]}getGlobalProperty(e,r=ai.UNSIGNED_INT,i=1){const n=this.json[e];return n&&Number.isFinite(n.byteOffset)?this._getTypedArrayFromBinary(e,r,i,1,n.byteOffset):n}getPropertyArray(e,r,i){const n=this.json[e];return n&&Number.isFinite(n.byteOffset)?("componentType"in n&&(r=Cu.fromName(n.componentType)),this._getTypedArrayFromBinary(e,r,i,this.featuresLength,n.byteOffset)):this._getTypedArrayFromArray(e,r,n)}getProperty(e,r,i,n,l){const c=this.json[e];if(!c)return c;const o=this.getPropertyArray(e,r,i);if(i===1)return o[n];for(let m=0;m<i;++m)l[m]=o[i*n+m];return l}_getTypedArrayFromBinary(e,r,i,n,l){const c=this._cachedTypedArrays;let o=c[e];return o||(o=Cu.createTypedArray(r,this.buffer.buffer,this.buffer.byteOffset+l,n*i),c[e]=o),o}_getTypedArrayFromArray(e,r,i){const n=this._cachedTypedArrays;let l=n[e];return l||(l=Cu.createTypedArray(r,i),n[e]=l),l}}const jde={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Ude={SCALAR:(t,e)=>t[e],VEC2:(t,e)=>[t[2*e+0],t[2*e+1]],VEC3:(t,e)=>[t[3*e+0],t[3*e+1],t[3*e+2]],VEC4:(t,e)=>[t[4*e+0],t[4*e+1],t[4*e+2],t[4*e+3]],MAT2:(t,e)=>[t[4*e+0],t[4*e+1],t[4*e+2],t[4*e+3]],MAT3:(t,e)=>[t[9*e+0],t[9*e+1],t[9*e+2],t[9*e+3],t[9*e+4],t[9*e+5],t[9*e+6],t[9*e+7],t[9*e+8]],MAT4:(t,e)=>[t[16*e+0],t[16*e+1],t[16*e+2],t[16*e+3],t[16*e+4],t[16*e+5],t[16*e+6],t[16*e+7],t[16*e+8],t[16*e+9],t[16*e+10],t[16*e+11],t[16*e+12],t[16*e+13],t[16*e+14],t[16*e+15]]},Vde={SCALAR:(t,e,r)=>{e[r]=t},VEC2:(t,e,r)=>{e[2*r+0]=t[0],e[2*r+1]=t[1]},VEC3:(t,e,r)=>{e[3*r+0]=t[0],e[3*r+1]=t[1],e[3*r+2]=t[2]},VEC4:(t,e,r)=>{e[4*r+0]=t[0],e[4*r+1]=t[1],e[4*r+2]=t[2],e[4*r+3]=t[3]},MAT2:(t,e,r)=>{e[4*r+0]=t[0],e[4*r+1]=t[1],e[4*r+2]=t[2],e[4*r+3]=t[3]},MAT3:(t,e,r)=>{e[9*r+0]=t[0],e[9*r+1]=t[1],e[9*r+2]=t[2],e[9*r+3]=t[3],e[9*r+4]=t[4],e[9*r+5]=t[5],e[9*r+6]=t[6],e[9*r+7]=t[7],e[9*r+8]=t[8],e[9*r+9]=t[9]},MAT4:(t,e,r)=>{e[16*r+0]=t[0],e[16*r+1]=t[1],e[16*r+2]=t[2],e[16*r+3]=t[3],e[16*r+4]=t[4],e[16*r+5]=t[5],e[16*r+6]=t[6],e[16*r+7]=t[7],e[16*r+8]=t[8],e[16*r+9]=t[9],e[16*r+10]=t[10],e[16*r+11]=t[11],e[16*r+12]=t[12],e[16*r+13]=t[13],e[16*r+14]=t[14],e[16*r+15]=t[15]}};function Gde(t,e,r,i){const{componentType:n}=t;Ni(t.componentType);const l=typeof n=="string"?Cu.fromName(n):n,c=jde[t.type],o=Ude[t.type],m=Vde[t.type];return r+=t.byteOffset,{values:Cu.createTypedArray(l,e,r,c*i),type:l,size:c,unpacker:o,packer:m}}const Au=t=>t!==void 0;function Hde(t,e,r){if(!e)return null;let i=t.getExtension("3DTILES_batch_table_hierarchy");const n=e.HIERARCHY;return n&&(console.warn("3D Tile Parser: HIERARCHY is deprecated. Use 3DTILES_batch_table_hierarchy."),e.extensions=e.extensions||{},e.extensions["3DTILES_batch_table_hierarchy"]=n,i=n),i?$de(i,r):null}function $de(t,e){let r,i,n;const l=t.instancesLength,c=t.classes;let o=t.classIds,m=t.parentCounts,b=t.parentIds,A=l;Au(o.byteOffset)&&(o.componentType=defaultValue(o.componentType,GL.UNSIGNED_SHORT),o.type=AttributeType.SCALAR,n=getBinaryAccessor(o),o=n.createArrayBufferView(e.buffer,e.byteOffset+o.byteOffset,l));let R;if(Au(m))for(Au(m.byteOffset)&&(m.componentType=defaultValue(m.componentType,GL.UNSIGNED_SHORT),m.type=AttributeType.SCALAR,n=getBinaryAccessor(m),m=n.createArrayBufferView(e.buffer,e.byteOffset+m.byteOffset,l)),R=new Uint16Array(l),A=0,r=0;r<l;++r)R[r]=A,A+=m[r];Au(b)&&Au(b.byteOffset)&&(b.componentType=defaultValue(b.componentType,GL.UNSIGNED_SHORT),b.type=AttributeType.SCALAR,n=getBinaryAccessor(b),b=n.createArrayBufferView(e.buffer,e.byteOffset+b.byteOffset,A));const M=c.length;for(r=0;r<M;++r){const q=c[r].length,J=c[r].instances,ie=getBinaryProperties(q,J,e);c[r].instances=combine(ie,J)}const L=new Array(M).fill(0),G=new Uint16Array(l);for(r=0;r<l;++r)i=o[r],G[r]=L[i],++L[i];const V={classes:c,classIds:o,classIndexes:G,parentCounts:m,parentIndexes:R,parentIds:b};return Kde(V),V}function z_(t,e,r){if(!t)return;const i=t.parentCounts;return t.parentIds?r(t,e):i>0?Wde(t,e,r):qde(t,e,r)}function Wde(t,e,r){const i=t.classIds,n=t.parentCounts,l=t.parentIds,c=t.parentIndexes,o=i.length,m=scratchVisited;m.length=Math.max(m.length,o);const b=++marker,A=scratchStack;for(A.length=0,A.push(e);A.length>0;){if(e=A.pop(),m[e]===b)continue;m[e]=b;const R=r(t,e);if(Au(R))return R;const M=n[e],L=c[e];for(let G=0;G<M;++G){const V=l[L+G];V!==e&&A.push(V)}}return null}function qde(t,e,r){let i=!0;for(;i;){const n=r(t,e);if(Au(n))return n;const l=t.parentIds[e];i=l!==e,e=l}throw new Error("traverseHierarchySingleParent")}function Kde(t){const e=t.classIds.length;for(let r=0;r<e;++r)HD(t,r,stack)}function HD(t,e,r){const i=t.parentCounts,n=t.parentIds,l=t.parentIndexes,c=t.classIds.length;if(!Au(n))return;assert(e<c,`Parent index ${e} exceeds the total number of instances: ${c}`),assert(r.indexOf(e)===-1,"Circular dependency detected in the batch table hierarchy."),r.push(e);const o=Au(i)?i[e]:1,m=Au(i)?l[e]:e;for(let b=0;b<o;++b){const A=n[m+b];A!==e&&HD(t,A,r)}r.pop(e)}function ga(t){return t!=null}const Rv=(t,e)=>t,Zde={HIERARCHY:!0,extensions:!0,extras:!0};class $D{json;binary;featureCount;_extensions;_properties;_binaryProperties;_hierarchy;constructor(e,r,i,n={}){Ni(i>=0),this.json=e||{},this.binary=r,this.featureCount=i,this._extensions=this.json?.extensions||{},this._properties={};for(const l in this.json)Zde[l]||(this._properties[l]=this.json[l]);this._binaryProperties=this._initializeBinaryProperties(),n["3DTILES_batch_table_hierarchy"]&&(this._hierarchy=Hde(this,this.json,this.binary))}getExtension(e){return this.json&&this.json.extensions&&this.json.extensions[e]}memorySizeInBytes(){return 0}isClass(e,r){if(this._checkBatchId(e),Ni(typeof r=="string",r),this._hierarchy){const i=z_(this._hierarchy,e,(n,l)=>{const c=n.classIds[l];return n.classes[c].name===r});return ga(i)}return!1}isExactClass(e,r){return Ni(typeof r=="string",r),this.getExactClassName(e)===r}getExactClassName(e){if(this._checkBatchId(e),this._hierarchy){const r=this._hierarchy.classIds[e];return this._hierarchy.classes[r].name}}hasProperty(e,r){return this._checkBatchId(e),Ni(typeof r=="string",r),ga(this._properties[r])||this._hasPropertyInHierarchy(e,r)}getPropertyNames(e,r){this._checkBatchId(e),r=ga(r)?r:[],r.length=0;const i=Object.keys(this._properties);return r.push(...i),this._hierarchy&&this._getPropertyNamesInHierarchy(e,r),r}getProperty(e,r){if(this._checkBatchId(e),Ni(typeof r=="string",r),this._binaryProperties){const n=this._binaryProperties[r];if(ga(n))return this._getBinaryProperty(n,e)}const i=this._properties[r];if(ga(i))return Rv(i[e]);if(this._hierarchy){const n=this._getHierarchyProperty(e,r);if(ga(n))return n}}setProperty(e,r,i){const n=this.featureCount;if(this._checkBatchId(e),Ni(typeof r=="string",r),this._binaryProperties){const c=this._binaryProperties[r];if(c){this._setBinaryProperty(c,e,i);return}}if(this._hierarchy&&this._setHierarchyProperty(this,e,r,i))return;let l=this._properties[r];ga(l)||(this._properties[r]=new Array(n),l=this._properties[r]),l[e]=Rv(i)}_checkBatchId(e){if(!(e>=0&&e<this.featureCount))throw new Error("batchId not in range [0, featureCount - 1].")}_getBinaryProperty(e,r){return e.unpack(e.typedArray,r)}_setBinaryProperty(e,r,i){e.pack(i,e.typedArray,r)}_initializeBinaryProperties(){let e=null;for(const r in this._properties){const i=this._properties[r],n=this._initializeBinaryProperty(r,i);n&&(e=e||{},e[r]=n)}return e}_initializeBinaryProperty(e,r){if("byteOffset"in r){const i=r;Ni(this.binary,`Property ${e} requires a batch table binary.`),Ni(i.type,`Property ${e} requires a type.`);const n=Gde(i,this.binary.buffer,this.binary.byteOffset|0,this.featureCount);return{typedArray:n.values,componentCount:n.size,unpack:n.unpacker,pack:n.packer}}return null}_hasPropertyInHierarchy(e,r){if(!this._hierarchy)return!1;const i=z_(this._hierarchy,e,(n,l)=>{const c=n.classIds[l],o=n.classes[c].instances;return ga(o[r])});return ga(i)}_getPropertyNamesInHierarchy(e,r){z_(this._hierarchy,e,(i,n)=>{const l=i.classIds[n],c=i.classes[l].instances;for(const o in c)c.hasOwnProperty(o)&&r.indexOf(o)===-1&&r.push(o)})}_getHierarchyProperty(e,r){return z_(this._hierarchy,e,(i,n)=>{const l=i.classIds[n],c=i.classes[l],o=i.classIndexes[n],m=c.instances[r];return ga(m)?ga(m.typedArray)?this._getBinaryProperty(m,o):Rv(m[o]):null})}_setHierarchyProperty(e,r,i,n){const l=z_(this._hierarchy,r,(c,o)=>{const m=c.classIds[o],b=c.classes[m],A=c.classIndexes[o],R=b.instances[i];return ga(R)?(Ni(o===r,`Inherited property "${i}" is read-only.`),ga(R.typedArray)?this._setBinaryProperty(R,A,n):R[A]=Rv(n),!0):!1});return ga(l)}}const Rw=4;function mb(t,e,r=0){const i=new DataView(e);if(t.magic=i.getUint32(r,!0),r+=Rw,t.version=i.getUint32(r,!0),r+=Rw,t.byteLength=i.getUint32(r,!0),r+=Rw,t.version!==1)throw new Error(`3D Tile Version ${t.version} not supported`);return r}const Im=4,YM="b3dm tile in legacy format.";function OT(t,e,r){const i=new DataView(e);let n;t.header=t.header||{};let l=i.getUint32(r,!0);r+=Im;let c=i.getUint32(r,!0);r+=Im;let o=i.getUint32(r,!0);r+=Im;let m=i.getUint32(r,!0);return r+=Im,o>=570425344?(r-=Im*2,n=l,o=c,m=0,l=0,c=0,console.warn(YM)):m>=570425344&&(r-=Im,n=o,o=l,m=c,l=0,c=0,console.warn(YM)),t.header.featureTableJsonByteLength=l,t.header.featureTableBinaryByteLength=c,t.header.batchTableJsonByteLength=o,t.header.batchTableBinaryByteLength=m,t.header.batchLength=n,r}function DT(t,e,r,i){return r=Xde(t,e,r),r=Yde(t,e,r),r}function Xde(t,e,r,i){const{featureTableJsonByteLength:n,featureTableBinaryByteLength:l,batchLength:c}=t.header||{};if(t.featureTableJson={BATCH_LENGTH:c||0},n&&n>0){const o=GD(e,r,n);t.featureTableJson=JSON.parse(o)}return r+=n||0,t.featureTableBinary=new Uint8Array(e,r,l),r+=l||0,r}function Yde(t,e,r,i){const{batchTableJsonByteLength:n,batchTableBinaryByteLength:l}=t.header||{};if(n&&n>0){const c=GD(e,r,n);t.batchTableJson=JSON.parse(c),r+=n,l&&l>0&&(t.batchTableBinary=new Uint8Array(e,r,l),t.batchTableBinary=new Uint8Array(t.batchTableBinary),r+=l)}return r}function WD(t,e,r){if(!e&&(!t||!t.batchIds||!r))return null;const{batchIds:i,isRGB565:n,pointCount:l=0}=t;if(i&&r){const c=new Uint8ClampedArray(l*3);for(let o=0;o<l;o++){const m=i[o],b=r.getProperty(m,"dimensions").map(A=>A*255);c[o*3]=b[0],c[o*3+1]=b[1],c[o*3+2]=b[2]}return{type:ai.UNSIGNED_BYTE,value:c,size:3,normalized:!0}}if(e&&n){const c=new Uint8ClampedArray(l*3);for(let o=0;o<l;o++){const m=Nde(e[o]);c[o*3]=m[0],c[o*3+1]=m[1],c[o*3+2]=m[2]}return{type:ai.UNSIGNED_BYTE,value:c,size:3,normalized:!0}}return e&&e.length===l*3?{type:ai.UNSIGNED_BYTE,value:e,size:3,normalized:!0}:{type:ai.UNSIGNED_BYTE,value:e||new Uint8ClampedArray,size:4,normalized:!0}}const JM=new et;function Jde(t,e){if(!e)return null;if(t.isOctEncoded16P){const r=new Float32Array((t.pointsLength||0)*3);for(let i=0;i<(t.pointsLength||0);i++)zde(e[i*2],e[i*2+1],JM),JM.toArray(r,i*3);return{type:ai.FLOAT,size:2,value:r}}return{type:ai.FLOAT,size:2,value:e}}function Qde(t,e,r){return t.isQuantized?r["3d-tiles"]&&r["3d-tiles"].decodeQuantizedPositions?(t.isQuantized=!1,efe(t,e)):{type:ai.UNSIGNED_SHORT,value:e,size:3,normalized:!0}:e}function efe(t,e){const r=new et,i=new Float32Array(t.pointCount*3);for(let n=0;n<t.pointCount;n++)r.set(e[n*3],e[n*3+1],e[n*3+2]).scale(1/t.quantizedRange).multiply(t.quantizedVolumeScale).add(t.quantizedVolumeOffset).toArray(i,n*3);return i}async function tfe(t,e,r,i,n){r=mb(t,e,r),r=OT(t,e,r),r=DT(t,e,r),rfe(t);const{featureTable:l,batchTable:c}=ife(t);return await lfe(t,l,c,i,n),nfe(t,l,i),sfe(t,l,c),ofe(t,l),r}function rfe(t){t.attributes={positions:null,colors:null,normals:null,batchIds:null},t.isQuantized=!1,t.isTranslucent=!1,t.isRGB565=!1,t.isOctEncoded16P=!1}function ife(t){const e=new LT(t.featureTableJson,t.featureTableBinary),r=e.getGlobalProperty("POINTS_LENGTH");if(!Number.isFinite(r))throw new Error("POINTS_LENGTH must be defined");e.featuresLength=r,t.featuresLength=r,t.pointsLength=r,t.pointCount=r,t.rtcCenter=e.getGlobalProperty("RTC_CENTER",ai.FLOAT,3);const i=afe(t,e);return{featureTable:e,batchTable:i}}function nfe(t,e,r){if(t.attributes=t.attributes||{positions:null,colors:null,normals:null,batchIds:null},!t.attributes.positions){if(e.hasProperty("POSITION"))t.attributes.positions=e.getPropertyArray("POSITION",ai.FLOAT,3);else if(e.hasProperty("POSITION_QUANTIZED")){const i=e.getPropertyArray("POSITION_QUANTIZED",ai.UNSIGNED_SHORT,3);if(t.isQuantized=!0,t.quantizedRange=65535,t.quantizedVolumeScale=e.getGlobalProperty("QUANTIZED_VOLUME_SCALE",ai.FLOAT,3),!t.quantizedVolumeScale)throw new Error("QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");if(t.quantizedVolumeOffset=e.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",ai.FLOAT,3),!t.quantizedVolumeOffset)throw new Error("QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");t.attributes.positions=Qde(t,i,r)}}if(!t.attributes.positions)throw new Error("Either POSITION or POSITION_QUANTIZED must be defined.")}function sfe(t,e,r){if(t.attributes=t.attributes||{positions:null,colors:null,normals:null,batchIds:null},!t.attributes.colors){let i=null;e.hasProperty("RGBA")?(i=e.getPropertyArray("RGBA",ai.UNSIGNED_BYTE,4),t.isTranslucent=!0):e.hasProperty("RGB")?i=e.getPropertyArray("RGB",ai.UNSIGNED_BYTE,3):e.hasProperty("RGB565")&&(i=e.getPropertyArray("RGB565",ai.UNSIGNED_SHORT,1),t.isRGB565=!0),t.attributes.colors=WD(t,i,r)}e.hasProperty("CONSTANT_RGBA")&&(t.constantRGBA=e.getGlobalProperty("CONSTANT_RGBA",ai.UNSIGNED_BYTE,4))}function ofe(t,e){if(t.attributes=t.attributes||{positions:null,colors:null,normals:null,batchIds:null},!t.attributes.normals){let r=null;e.hasProperty("NORMAL")?r=e.getPropertyArray("NORMAL",ai.FLOAT,3):e.hasProperty("NORMAL_OCT16P")&&(r=e.getPropertyArray("NORMAL_OCT16P",ai.UNSIGNED_BYTE,2),t.isOctEncoded16P=!0),t.attributes.normals=Jde(t,r)}}function afe(t,e){let r=null;if(!t.batchIds&&e.hasProperty("BATCH_ID")&&(t.batchIds=e.getPropertyArray("BATCH_ID",ai.UNSIGNED_SHORT,1),t.batchIds)){const i=e.getGlobalProperty("BATCH_LENGTH");if(!i)throw new Error("Global property: BATCH_LENGTH must be defined when BATCH_ID is defined.");const{batchTableJson:n,batchTableBinary:l}=t;r=new $D(n,l,i)}return r}async function lfe(t,e,r,i,n){let l,c,o;const m=t.batchTableJson&&t.batchTableJson.extensions&&t.batchTableJson.extensions["3DTILES_draco_point_compression"];m&&(o=m.properties);const b=e.getExtension("3DTILES_draco_point_compression");if(b){c=b.properties;const R=b.byteOffset,M=b.byteLength;if(!c||!Number.isFinite(R)||!M)throw new Error("Draco properties, byteOffset, and byteLength must be defined");l=(t.featureTableBinary||[]).slice(R,R+M),t.hasPositions=Number.isFinite(c.POSITION),t.hasColors=Number.isFinite(c.RGB)||Number.isFinite(c.RGBA),t.hasNormals=Number.isFinite(c.NORMAL),t.hasBatchIds=Number.isFinite(c.BATCH_ID),t.isTranslucent=Number.isFinite(c.RGBA)}if(!l)return!0;const A={buffer:l,properties:{...c,...o},batchTableProperties:o};return await cfe(t,A,i,n)}async function cfe(t,e,r,i){if(!i)return;const n={...r,draco:{...r?.draco,extraAttributes:e.batchTableProperties||{}}};delete n["3d-tiles"];const l=await Uy(e.buffer,MD,n,i),c=l.attributes.POSITION&&l.attributes.POSITION.value,o=l.attributes.COLOR_0&&l.attributes.COLOR_0.value,m=l.attributes.NORMAL&&l.attributes.NORMAL.value,b=l.attributes.BATCH_ID&&l.attributes.BATCH_ID.value,A=c&&l.attributes.POSITION.value.quantization,R=m&&l.attributes.NORMAL.value.quantization;if(A){const L=l.POSITION.data.quantization,G=L.range;t.quantizedVolumeScale=new et(G,G,G),t.quantizedVolumeOffset=new et(L.minValues),t.quantizedRange=(1<<L.quantizationBits)-1,t.isQuantizedDraco=!0}R&&(t.octEncodedRange=(1<<l.NORMAL.data.quantization.quantizationBits)-1,t.isOctEncodedDraco=!0);const M={};if(e.batchTableProperties)for(const L of Object.keys(e.batchTableProperties))l.attributes[L]&&l.attributes[L].value&&(M[L.toLowerCase()]=l.attributes[L].value);t.attributes={positions:c,colors:WD(t,o,void 0),normals:m,batchIds:b,...M}}const hE={URI:0,EMBEDDED:1};function qD(t,e,r,i){t.rotateYtoZ=!0;const n=(t.byteOffset||0)+(t.byteLength||0)-r;if(n===0)throw new Error("glTF byte length must be greater than 0.");return t.gltfUpAxis=i?.["3d-tiles"]&&i["3d-tiles"].assetGltfUpAxis?i["3d-tiles"].assetGltfUpAxis:"Y",t.gltfArrayBuffer=DA(e,r,n),t.gltfByteOffset=0,t.gltfByteLength=n,r%4===0||console.warn(`${t.type}: embedded glb is not aligned to a 4-byte boundary.`),(t.byteOffset||0)+(t.byteLength||0)}async function KD(t,e,r,i){const n=r?.["3d-tiles"]||{};if(ufe(t,e),n.loadGLTF){if(!i)return;if(t.gltfUrl){const{fetch:l}=i,c=await l(t.gltfUrl,r);t.gltfArrayBuffer=await c.arrayBuffer(),t.gltfByteOffset=0}if(t.gltfArrayBuffer){const l=await Uy(t.gltfArrayBuffer,Ry,r,i);t.gltf=IT(l),t.gpuMemoryUsageInBytes=bD(t.gltf),delete t.gltfArrayBuffer,delete t.gltfByteOffset,delete t.gltfByteLength}}}function ufe(t,e,r){switch(e){case hE.URI:if(t.gltfArrayBuffer){const i=new Uint8Array(t.gltfArrayBuffer,t.gltfByteOffset),n=new TextDecoder().decode(i);t.gltfUrl=n.replace(/[\s\0]+$/,"")}delete t.gltfArrayBuffer,delete t.gltfByteOffset,delete t.gltfByteLength;break;case hE.EMBEDDED:break;default:throw new Error("b3dm: Illegal glTF format field")}}async function hfe(t,e,r,i,n){r=dfe(t,e,r,i),await KD(t,hE.EMBEDDED,i,n);const l=t?.gltf?.extensions;return l&&l.CESIUM_RTC&&(t.rtcCenter=l.CESIUM_RTC.center),r}function dfe(t,e,r,i,n){r=mb(t,e,r),r=OT(t,e,r),r=DT(t,e,r),r=qD(t,e,r,i);const l=new LT(t.featureTableJson,t.featureTableBinary);return t.rtcCenter=l.getGlobalProperty("RTC_CENTER",ai.FLOAT,3),r}async function ffe(t,e,r,i,n){return r=pfe(t,e,r,i),await KD(t,t.gltfFormat||0,i,n),r}function pfe(t,e,r,i,n){if(r=mb(t,e,r),t.version!==1)throw new Error(`Instanced 3D Model version ${t.version} is not supported`);r=OT(t,e,r);const l=new DataView(e);if(t.gltfFormat=l.getUint32(r,!0),r+=4,r=DT(t,e,r),r=qD(t,e,r,i),!t?.header?.featureTableJsonByteLength||t.header.featureTableJsonByteLength===0)throw new Error("i3dm parser: featureTableJsonByteLength is zero.");const c=new LT(t.featureTableJson,t.featureTableBinary),o=c.getGlobalProperty("INSTANCES_LENGTH");if(c.featuresLength=o,!Number.isFinite(o))throw new Error("i3dm parser: INSTANCES_LENGTH must be defined");t.eastNorthUp=c.getGlobalProperty("EAST_NORTH_UP"),t.rtcCenter=c.getGlobalProperty("RTC_CENTER",ai.FLOAT,3);const m=new $D(t.batchTableJson,t.batchTableBinary,o);return mfe(t,c,m,o),r}function mfe(t,e,r,i){const n=new Array(i),l=new et;new et,new et,new et;const c=new kn,o=new wy,m=new et,b={},A=new Kr,R=[],M=[],L=[],G=[];for(let V=0;V<i;V++){let q;if(e.hasProperty("POSITION"))q=e.getProperty("POSITION",ai.FLOAT,3,V,l);else if(e.hasProperty("POSITION_QUANTIZED")){q=e.getProperty("POSITION_QUANTIZED",ai.UNSIGNED_SHORT,3,V,l);const Me=e.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",ai.FLOAT,3);if(!Me)throw new Error("i3dm parser: QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");const Ve=e.getGlobalProperty("QUANTIZED_VOLUME_SCALE",ai.FLOAT,3);if(!Ve)throw new Error("i3dm parser: QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");const Be=65535;for(let $e=0;$e<3;$e++)q[$e]=q[$e]/Be*Ve[$e]+Me[$e]}if(!q)throw new Error("i3dm: POSITION or POSITION_QUANTIZED must be defined for each instance.");if(l.copy(q),b.translation=l,t.normalUp=e.getProperty("NORMAL_UP",ai.FLOAT,3,V,R),t.normalRight=e.getProperty("NORMAL_RIGHT",ai.FLOAT,3,V,M),t.normalUp){if(!t.normalRight)throw new Error("i3dm: Custom orientation requires both NORMAL_UP and NORMAL_RIGHT.");t.hasCustomOrientation=!0}else{if(t.octNormalUp=e.getProperty("NORMAL_UP_OCT32P",ai.UNSIGNED_SHORT,2,V,R),t.octNormalRight=e.getProperty("NORMAL_RIGHT_OCT32P",ai.UNSIGNED_SHORT,2,V,M),t.octNormalUp)throw t.octNormalRight?new Error("i3dm: oct-encoded orientation not implemented"):new Error("i3dm: oct-encoded orientation requires NORMAL_UP_OCT32P and NORMAL_RIGHT_OCT32P");t.eastNorthUp?(Fi.WGS84.eastNorthUpToFixedFrame(l,A),A.getRotationMatrix3(c)):c.identity()}o.fromMatrix3(c),b.rotation=o,m.set(1,1,1);const J=e.getProperty("SCALE",ai.FLOAT,1,V,L);Number.isFinite(J)&&m.multiplyByScalar(J);const ie=e.getProperty("SCALE_NON_UNIFORM",ai.FLOAT,3,V,R);ie&&m.scale(ie),b.scale=m;let ee=e.getProperty("BATCH_ID",ai.UNSIGNED_SHORT,1,V,G);ee===void 0&&(ee=V);const me=new Kr().fromQuaternion(b.rotation);A.identity(),A.translate(b.translation),A.multiplyRight(me),A.scale(b.scale);const Se=A.clone();n[V]={modelMatrix:Se,batchId:ee}}t.instances=n}async function gfe(t,e,r,i,n,l){r=mb(t,e,r);const c=new DataView(e);for(t.tilesLength=c.getUint32(r,!0),r+=4,t.tiles=[];t.tiles.length<t.tilesLength&&(t.byteLength||0)-r>12;){const o={shape:"tile3d"};t.tiles.push(o),r=await l(e,r,i,n,o)}return r}async function _fe(t,e,r,i){if(t.rotateYtoZ=!0,t.gltfUpAxis=r?.["3d-tiles"]?.assetGltfUpAxis?r["3d-tiles"].assetGltfUpAxis:"Y",r?.["3d-tiles"]?.loadGLTF){if(!i)return e.byteLength;const n=await Uy(e,Ry,r,i);t.gltf=IT(n),t.gpuMemoryUsageInBytes=bD(t.gltf)}else t.gltfArrayBuffer=e;return e.byteLength}async function ZD(t,e=0,r,i,n={shape:"tile3d"}){switch(n.byteOffset=e,n.type=Bde(t,e),n.type){case F_.COMPOSITE:return await gfe(n,t,e,r,i,ZD);case F_.BATCHED_3D_MODEL:return await hfe(n,t,e,r,i);case F_.GLTF:return await _fe(n,t,r,i);case F_.INSTANCED_3D_MODEL:return await ffe(n,t,e,r,i);case F_.POINT_CLOUD:return await tfe(n,t,e,r,i);default:throw new Error(`3DTileLoader: unknown type ${n.type}`)}}const yfe=1952609651,vfe=1;async function bfe(t,e,r){if(new Uint32Array(t.slice(0,4))[0]!==yfe)throw new Error("Wrong subtree file magic number");if(new Uint32Array(t.slice(4,8))[0]!==vfe)throw new Error("Wrong subtree file verson, must be 1");const i=QM(t.slice(8,16)),n=new Uint8Array(t,24,i),l=new TextDecoder("utf8").decode(n),c=JSON.parse(l),o=QM(t.slice(16,24));let m=new ArrayBuffer(0);if(o&&(m=t.slice(24+i)),await Mv(c,c.tileAvailability,m,r),Array.isArray(c.contentAvailability))for(const b of c.contentAvailability)await Mv(c,b,m,r);else await Mv(c,c.contentAvailability,m,r);return await Mv(c,c.childSubtreeAvailability,m,r),c}async function Mv(t,e,r,i){const n=Number.isFinite(e.bitstream)?e.bitstream:e.bufferView;if(typeof n!="number")return;const l=t.bufferViews[n],c=t.buffers[l.buffer];if(!i?.baseUrl)throw new Error("Url is not provided");if(!i.fetch)throw new Error("fetch is not provided");if(c.uri){const m=`${i?.baseUrl||""}/${c.uri}`,b=await(await i.fetch(m)).arrayBuffer();e.explicitBitstream=new Uint8Array(b,l.byteOffset,l.byteLength);return}const o=t.buffers.slice(0,l.buffer).reduce((m,b)=>m+b.byteLength,0);e.explicitBitstream=new Uint8Array(r.slice(o,o+c.byteLength),l.byteOffset,l.byteLength)}function QM(t){const e=new DataView(t),r=e.getUint32(0,!0),i=e.getUint32(4,!0);return r+2**32*i}const XD={dataType:null,batchType:null,id:"3d-tiles-subtree",name:"3D Tiles Subtree",module:"3d-tiles",version:VD,extensions:["subtree"],mimeTypes:["application/octet-stream"],tests:["subtree"],parse:bfe,options:{}};/**
 * @license
 * Copyright 2009 The Closure Library Authors
 * Copyright 2020 Daniel Wirtz / The long.js Authors.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * SPDX-License-Identifier: Apache-2.0
 */var Nl=null;try{Nl=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function Ai(t,e,r){this.low=t|0,this.high=e|0,this.unsigned=!!r}Ai.prototype.__isLong__;Object.defineProperty(Ai.prototype,"__isLong__",{value:!0});function Co(t){return(t&&t.__isLong__)===!0}function eI(t){var e=Math.clz32(t&-t);return t?31-e:e}Ai.isLong=Co;var tI={},rI={};function Dp(t,e){var r,i,n;return e?(t>>>=0,(n=0<=t&&t<256)&&(i=rI[t],i)?i:(r=di(t,0,!0),n&&(rI[t]=r),r)):(t|=0,(n=-128<=t&&t<128)&&(i=tI[t],i)?i:(r=di(t,t<0?-1:0,!1),n&&(tI[t]=r),r))}Ai.fromInt=Dp;function Fl(t,e){if(isNaN(t))return e?Th:Cc;if(e){if(t<0)return Th;if(t>=YD)return e6}else{if(t<=-nI)return xa;if(t+1>=nI)return QD}return t<0?Fl(-t,e).neg():di(t%yg|0,t/yg|0,e)}Ai.fromNumber=Fl;function di(t,e,r){return new Ai(t,e,r)}Ai.fromBits=di;var S1=Math.pow;function NT(t,e,r){if(t.length===0)throw Error("empty string");if(typeof e=="number"?(r=e,e=!1):e=!!e,t==="NaN"||t==="Infinity"||t==="+Infinity"||t==="-Infinity")return e?Th:Cc;if(r=r||10,r<2||36<r)throw RangeError("radix");var i;if((i=t.indexOf("-"))>0)throw Error("interior hyphen");if(i===0)return NT(t.substring(1),e,r).neg();for(var n=Fl(S1(r,8)),l=Cc,c=0;c<t.length;c+=8){var o=Math.min(8,t.length-c),m=parseInt(t.substring(c,c+o),r);if(o<8){var b=Fl(S1(r,o));l=l.mul(b).add(Fl(m))}else l=l.mul(n),l=l.add(Fl(m))}return l.unsigned=e,l}Ai.fromString=NT;function Bc(t,e){return typeof t=="number"?Fl(t,e):typeof t=="string"?NT(t,e):di(t.low,t.high,typeof e=="boolean"?e:t.unsigned)}Ai.fromValue=Bc;var iI=65536,xfe=1<<24,yg=iI*iI,YD=yg*yg,nI=YD/2,sI=Dp(xfe),Cc=Dp(0);Ai.ZERO=Cc;var Th=Dp(0,!0);Ai.UZERO=Th;var Km=Dp(1);Ai.ONE=Km;var JD=Dp(1,!0);Ai.UONE=JD;var dE=Dp(-1);Ai.NEG_ONE=dE;var QD=di(-1,2147483647,!1);Ai.MAX_VALUE=QD;var e6=di(-1,-1,!0);Ai.MAX_UNSIGNED_VALUE=e6;var xa=di(0,-2147483648,!1);Ai.MIN_VALUE=xa;var Bt=Ai.prototype;Bt.toInt=function(){return this.unsigned?this.low>>>0:this.low};Bt.toNumber=function(){return this.unsigned?(this.high>>>0)*yg+(this.low>>>0):this.high*yg+(this.low>>>0)};Bt.toString=function(t){if(t=t||10,t<2||36<t)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(xa)){var e=Fl(t),r=this.div(e),i=r.mul(e).sub(this);return r.toString(t)+i.toInt().toString(t)}else return"-"+this.neg().toString(t);for(var n=Fl(S1(t,6),this.unsigned),l=this,c="";;){var o=l.div(n),m=l.sub(o.mul(n)).toInt()>>>0,b=m.toString(t);if(l=o,l.isZero())return b+c;for(;b.length<6;)b="0"+b;c=""+b+c}};Bt.getHighBits=function(){return this.high};Bt.getHighBitsUnsigned=function(){return this.high>>>0};Bt.getLowBits=function(){return this.low};Bt.getLowBitsUnsigned=function(){return this.low>>>0};Bt.getNumBitsAbs=function(){if(this.isNegative())return this.eq(xa)?64:this.neg().getNumBitsAbs();for(var t=this.high!=0?this.high:this.low,e=31;e>0&&(t&1<<e)==0;e--);return this.high!=0?e+33:e+1};Bt.isZero=function(){return this.high===0&&this.low===0};Bt.eqz=Bt.isZero;Bt.isNegative=function(){return!this.unsigned&&this.high<0};Bt.isPositive=function(){return this.unsigned||this.high>=0};Bt.isOdd=function(){return(this.low&1)===1};Bt.isEven=function(){return(this.low&1)===0};Bt.equals=function(t){return Co(t)||(t=Bc(t)),this.unsigned!==t.unsigned&&this.high>>>31===1&&t.high>>>31===1?!1:this.high===t.high&&this.low===t.low};Bt.eq=Bt.equals;Bt.notEquals=function(t){return!this.eq(t)};Bt.neq=Bt.notEquals;Bt.ne=Bt.notEquals;Bt.lessThan=function(t){return this.comp(t)<0};Bt.lt=Bt.lessThan;Bt.lessThanOrEqual=function(t){return this.comp(t)<=0};Bt.lte=Bt.lessThanOrEqual;Bt.le=Bt.lessThanOrEqual;Bt.greaterThan=function(t){return this.comp(t)>0};Bt.gt=Bt.greaterThan;Bt.greaterThanOrEqual=function(t){return this.comp(t)>=0};Bt.gte=Bt.greaterThanOrEqual;Bt.ge=Bt.greaterThanOrEqual;Bt.compare=function(t){if(Co(t)||(t=Bc(t)),this.eq(t))return 0;var e=this.isNegative(),r=t.isNegative();return e&&!r?-1:!e&&r?1:this.unsigned?t.high>>>0>this.high>>>0||t.high===this.high&&t.low>>>0>this.low>>>0?-1:1:this.sub(t).isNegative()?-1:1};Bt.comp=Bt.compare;Bt.negate=function(){return!this.unsigned&&this.eq(xa)?xa:this.not().add(Km)};Bt.neg=Bt.negate;Bt.add=function(t){Co(t)||(t=Bc(t));var e=this.high>>>16,r=this.high&65535,i=this.low>>>16,n=this.low&65535,l=t.high>>>16,c=t.high&65535,o=t.low>>>16,m=t.low&65535,b=0,A=0,R=0,M=0;return M+=n+m,R+=M>>>16,M&=65535,R+=i+o,A+=R>>>16,R&=65535,A+=r+c,b+=A>>>16,A&=65535,b+=e+l,b&=65535,di(R<<16|M,b<<16|A,this.unsigned)};Bt.subtract=function(t){return Co(t)||(t=Bc(t)),this.add(t.neg())};Bt.sub=Bt.subtract;Bt.multiply=function(t){if(this.isZero())return this;if(Co(t)||(t=Bc(t)),Nl){var e=Nl.mul(this.low,this.high,t.low,t.high);return di(e,Nl.get_high(),this.unsigned)}if(t.isZero())return this.unsigned?Th:Cc;if(this.eq(xa))return t.isOdd()?xa:Cc;if(t.eq(xa))return this.isOdd()?xa:Cc;if(this.isNegative())return t.isNegative()?this.neg().mul(t.neg()):this.neg().mul(t).neg();if(t.isNegative())return this.mul(t.neg()).neg();if(this.lt(sI)&&t.lt(sI))return Fl(this.toNumber()*t.toNumber(),this.unsigned);var r=this.high>>>16,i=this.high&65535,n=this.low>>>16,l=this.low&65535,c=t.high>>>16,o=t.high&65535,m=t.low>>>16,b=t.low&65535,A=0,R=0,M=0,L=0;return L+=l*b,M+=L>>>16,L&=65535,M+=n*b,R+=M>>>16,M&=65535,M+=l*m,R+=M>>>16,M&=65535,R+=i*b,A+=R>>>16,R&=65535,R+=n*m,A+=R>>>16,R&=65535,R+=l*o,A+=R>>>16,R&=65535,A+=r*b+i*m+n*o+l*c,A&=65535,di(M<<16|L,A<<16|R,this.unsigned)};Bt.mul=Bt.multiply;Bt.divide=function(t){if(Co(t)||(t=Bc(t)),t.isZero())throw Error("division by zero");if(Nl){if(!this.unsigned&&this.high===-2147483648&&t.low===-1&&t.high===-1)return this;var e=(this.unsigned?Nl.div_u:Nl.div_s)(this.low,this.high,t.low,t.high);return di(e,Nl.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?Th:Cc;var r,i,n;if(this.unsigned){if(t.unsigned||(t=t.toUnsigned()),t.gt(this))return Th;if(t.gt(this.shru(1)))return JD;n=Th}else{if(this.eq(xa)){if(t.eq(Km)||t.eq(dE))return xa;if(t.eq(xa))return Km;var l=this.shr(1);return r=l.div(t).shl(1),r.eq(Cc)?t.isNegative()?Km:dE:(i=this.sub(t.mul(r)),n=r.add(i.div(t)),n)}else if(t.eq(xa))return this.unsigned?Th:Cc;if(this.isNegative())return t.isNegative()?this.neg().div(t.neg()):this.neg().div(t).neg();if(t.isNegative())return this.div(t.neg()).neg();n=Cc}for(i=this;i.gte(t);){r=Math.max(1,Math.floor(i.toNumber()/t.toNumber()));for(var c=Math.ceil(Math.log(r)/Math.LN2),o=c<=48?1:S1(2,c-48),m=Fl(r),b=m.mul(t);b.isNegative()||b.gt(i);)r-=o,m=Fl(r,this.unsigned),b=m.mul(t);m.isZero()&&(m=Km),n=n.add(m),i=i.sub(b)}return n};Bt.div=Bt.divide;Bt.modulo=function(t){if(Co(t)||(t=Bc(t)),Nl){var e=(this.unsigned?Nl.rem_u:Nl.rem_s)(this.low,this.high,t.low,t.high);return di(e,Nl.get_high(),this.unsigned)}return this.sub(this.div(t).mul(t))};Bt.mod=Bt.modulo;Bt.rem=Bt.modulo;Bt.not=function(){return di(~this.low,~this.high,this.unsigned)};Bt.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32};Bt.clz=Bt.countLeadingZeros;Bt.countTrailingZeros=function(){return this.low?eI(this.low):eI(this.high)+32};Bt.ctz=Bt.countTrailingZeros;Bt.and=function(t){return Co(t)||(t=Bc(t)),di(this.low&t.low,this.high&t.high,this.unsigned)};Bt.or=function(t){return Co(t)||(t=Bc(t)),di(this.low|t.low,this.high|t.high,this.unsigned)};Bt.xor=function(t){return Co(t)||(t=Bc(t)),di(this.low^t.low,this.high^t.high,this.unsigned)};Bt.shiftLeft=function(t){return Co(t)&&(t=t.toInt()),(t&=63)===0?this:t<32?di(this.low<<t,this.high<<t|this.low>>>32-t,this.unsigned):di(0,this.low<<t-32,this.unsigned)};Bt.shl=Bt.shiftLeft;Bt.shiftRight=function(t){return Co(t)&&(t=t.toInt()),(t&=63)===0?this:t<32?di(this.low>>>t|this.high<<32-t,this.high>>t,this.unsigned):di(this.high>>t-32,this.high>=0?0:-1,this.unsigned)};Bt.shr=Bt.shiftRight;Bt.shiftRightUnsigned=function(t){return Co(t)&&(t=t.toInt()),(t&=63)===0?this:t<32?di(this.low>>>t|this.high<<32-t,this.high>>>t,this.unsigned):t===32?di(this.high,0,this.unsigned):di(this.high>>>t-32,0,this.unsigned)};Bt.shru=Bt.shiftRightUnsigned;Bt.shr_u=Bt.shiftRightUnsigned;Bt.rotateLeft=function(t){var e;return Co(t)&&(t=t.toInt()),(t&=63)===0?this:t===32?di(this.high,this.low,this.unsigned):t<32?(e=32-t,di(this.low<<t|this.high>>>e,this.high<<t|this.low>>>e,this.unsigned)):(t-=32,e=32-t,di(this.high<<t|this.low>>>e,this.low<<t|this.high>>>e,this.unsigned))};Bt.rotl=Bt.rotateLeft;Bt.rotateRight=function(t){var e;return Co(t)&&(t=t.toInt()),(t&=63)===0?this:t===32?di(this.high,this.low,this.unsigned):t<32?(e=32-t,di(this.high<<e|this.low>>>t,this.low<<e|this.high>>>t,this.unsigned)):(t-=32,e=32-t,di(this.low<<e|this.high>>>t,this.high<<e|this.low>>>t,this.unsigned))};Bt.rotr=Bt.rotateRight;Bt.toSigned=function(){return this.unsigned?di(this.low,this.high,!1):this};Bt.toUnsigned=function(){return this.unsigned?this:di(this.low,this.high,!0)};Bt.toBytes=function(t){return t?this.toBytesLE():this.toBytesBE()};Bt.toBytesLE=function(){var t=this.high,e=this.low;return[e&255,e>>>8&255,e>>>16&255,e>>>24,t&255,t>>>8&255,t>>>16&255,t>>>24]};Bt.toBytesBE=function(){var t=this.high,e=this.low;return[t>>>24,t>>>16&255,t>>>8&255,t&255,e>>>24,e>>>16&255,e>>>8&255,e&255]};Ai.fromBytes=function(t,e,r){return r?Ai.fromBytesLE(t,e):Ai.fromBytesBE(t,e)};Ai.fromBytesLE=function(t,e){return new Ai(t[0]|t[1]<<8|t[2]<<16|t[3]<<24,t[4]|t[5]<<8|t[6]<<16|t[7]<<24,e)};Ai.fromBytesBE=function(t,e){return new Ai(t[4]<<24|t[5]<<16|t[6]<<8|t[7],t[0]<<24|t[1]<<16|t[2]<<8|t[3],e)};const wfe=16;function t6(t){t==="X"&&(t="");const e=t.padEnd(wfe,"0");return Ai.fromString(e,!0,16)}function Efe(t){if(t.isZero())return"X";let e=t.countTrailingZeros();const r=e%4;e=(e-r)/4;const i=e;e*=4;const n=t.shiftRightUnsigned(e).toString(16).replace(/0+$/,"");return Array(17-i-n.length).join("0")+n}function Afe(t,e){const r=Tfe(t).shiftRightUnsigned(2);return t.add(Ai.fromNumber(2*e+1-4).multiply(r))}function Tfe(t){return t.and(t.not().add(1))}const Sfe=3,Cfe=30,Pfe=2*Cfe+1,oI=180/Math.PI;function Rfe(t){if(t.length===0)throw new Error(`Invalid Hilbert quad key ${t}`);const e=t.split("/"),r=parseInt(e[0],10),i=e[1],n=i.length;let l=0;const c=[0,0];for(let o=n-1;o>=0;o--){l=n-o;const m=i[o];let b=0,A=0;m==="1"?A=1:m==="2"?(b=1,A=1):m==="3"&&(b=1);const R=Math.pow(2,l-1);Ife(R,c,b,A),c[0]+=R*b,c[1]+=R*A}if(r%2===1){const o=c[0];c[0]=c[1],c[1]=o}return{face:r,ij:c,level:l}}function Mfe(t){if(t.isZero())return"";let e=t.toString(2);for(;e.length<Sfe+Pfe;)e="0"+e;const r=e.lastIndexOf("1"),i=e.substring(0,3),n=e.substring(3,r),l=n.length/2,c=Ai.fromString(i,!0,2).toString(10);let o="";if(l!==0)for(o=Ai.fromString(n,!0,2).toString(4);o.length<l;)o="0"+o;return`${c}/${o}`}function r6(t,e,r){const i=1<<e;return[(t[0]+r[0])/i,(t[1]+r[1])/i]}function aI(t){return t>=.5?1/3*(4*t*t-1):1/3*(1-4*(1-t)*(1-t))}function i6(t){return[aI(t[0]),aI(t[1])]}function n6(t,[e,r]){switch(t){case 0:return[1,e,r];case 1:return[-e,1,r];case 2:return[-e,-r,1];case 3:return[-1,-r,-e];case 4:return[r,-1,-e];case 5:return[r,e,-1];default:throw new Error("Invalid face")}}function s6([t,e,r]){const i=Math.atan2(r,Math.sqrt(t*t+e*e));return[Math.atan2(e,t)*oI,i*oI]}function Ife(t,e,r,i){if(i===0){r===1&&(e[0]=t-1-e[0],e[1]=t-1-e[1]);const n=e[0];e[0]=e[1],e[1]=n}}function kfe(t){const e=r6(t.ij,t.level,[.5,.5]),r=i6(e),i=n6(t.face,r);return s6(i)}const Bfe=100;function lI(t){const{face:e,ij:r,level:i}=t,n=[[0,0],[0,1],[1,1],[1,0],[0,0]],l=Math.max(1,Math.ceil(Bfe*Math.pow(2,-i))),c=new Float64Array(4*l*2+2);let o=0,m=0;for(let b=0;b<4;b++){const A=n[b].slice(0),R=n[b+1],M=(R[0]-A[0])/l,L=(R[1]-A[1])/l;for(let G=0;G<l;G++){A[0]+=M,A[1]+=L;const V=r6(r,i,A),q=i6(V),J=n6(e,q),ie=s6(J);Math.abs(ie[1])>89.999&&(ie[0]=m);const ee=ie[0]-m;ie[0]+=ee>180?-360:ee<-180?360:0,c[o++]=ie[0],c[o++]=ie[1],m=ie[0]}}return c[o++]=c[0],c[o++]=c[1],c}function FT(t){const e=Lfe(t);return Rfe(e)}function Lfe(t){if(t.indexOf("/")>0)return t;const e=t6(t);return Mfe(e)}function Ofe(t){const e=FT(t);return kfe(e)}function Dfe(t){let e;if(t.face===2||t.face===5){let r=null,i=0;for(let n=0;n<4;n++){const l=`${t.face}/${n}`,c=FT(l),o=lI(c);(typeof r>"u"||r===null)&&(r=new Float64Array(4*o.length)),r.set(o,i),i+=o.length}e=cI(r)}else{const r=lI(t);e=cI(r)}return e}function cI(t){if(t.length%2!==0)throw new Error("Invalid corners");const e=[],r=[];for(let i=0;i<t.length;i+=2)e.push(t[i]),r.push(t[i+1]);return e.sort((i,n)=>i-n),r.sort((i,n)=>i-n),{west:e[0],east:e[e.length-1],north:r[r.length-1],south:r[0]}}function Nfe(t,e){const r=e?.minimumHeight||0,i=e?.maximumHeight||0,n=FT(t),l=Dfe(n),c=l.west,o=l.south,m=l.east,b=l.north,A=[];return A.push(new et(c,b,r)),A.push(new et(m,b,r)),A.push(new et(m,o,r)),A.push(new et(c,o,r)),A.push(new et(c,b,i)),A.push(new et(m,b,i)),A.push(new et(m,o,i)),A.push(new et(c,o,i)),A}function o6(t){const e=t.token,r={minimumHeight:t.minimumHeight,maximumHeight:t.maximumHeight},i=Nfe(e,r),n=Ofe(e),l=n[0],c=n[1],o=Fi.WGS84.cartographicToCartesian([l,c,r.maximumHeight]),m=new et(o[0],o[1],o[2]);i.push(m);const b=Mae(i);return[...b.center,...b.halfAxes]}const Ffe=4,zfe=8,jfe={QUADTREE:Ffe,OCTREE:zfe};function Ufe(t,e,r){if(t?.box){const i=t6(t.s2VolumeInfo.token),n=Afe(i,e),l=Efe(n),c={...t.s2VolumeInfo};switch(c.token=l,r){case"OCTREE":const o=t.s2VolumeInfo,m=o.maximumHeight-o.minimumHeight,b=m/2,A=o.minimumHeight+m/2;o.minimumHeight=A-b,o.maximumHeight=A+b;break}return{box:o6(c),s2VolumeInfo:c}}}async function a6(t){const{subtree:e,subtreeData:r={level:0,x:0,y:0,z:0},parentData:i={mortonIndex:0,localLevel:-1,localX:0,localY:0,localZ:0},childIndex:n=0,implicitOptions:l,loaderOptions:c,s2VolumeBox:o}=t,{subdivisionScheme:m,subtreeLevels:b,maximumLevel:A,contentUrlTemplate:R,subtreesUriTemplate:M,basePath:L}=l,G={children:[],lodMetricValue:0,contentUrl:""};if(!A)return eL.once(`Missing 'maximumLevel' or 'availableLevels' property. The subtree ${R} won't be loaded...`),G;const V=i.localLevel+1,q=r.level+V;if(q>A)return G;const J=jfe[m],ie=Math.log2(J),ee=n&1,me=n>>1&1,Se=n>>2&1,Me=ap(i.localX,ee,1),Ve=ap(i.localY,me,1),Be=ap(i.localZ,Se,1),$e=ap(r.x,Me,V),at=ap(r.y,Ve,V),_t=ap(r.z,Be,V),Nt=ap(i.mortonIndex,n,ie),sr=V===b&&Mw(e.childSubtreeAvailability,Nt);let Ft,Ut,Lt,At;if(sr){const Ke=`${L}/${M}`,ft=fE(Ke,q,$e,at,_t);Ft=await Fd(ft,XD,c),At=0,Ut={level:q,x:$e,y:at,z:_t},Lt={mortonIndex:0,localLevel:0,localX:0,localY:0,localZ:0}}else Ft=e,At=(J**V-1)/(J-1)+Nt,Ut=r,Lt={mortonIndex:Nt,localLevel:V,localX:Me,localY:Ve,localZ:Be};if(!Mw(Ft.tileAvailability,At))return G;Mw(Ft.contentAvailability,At)&&(G.contentUrl=fE(R,q,$e,at,_t));for(let Ke=0;Ke<J;Ke++){const ft=Ufe(o,Ke,m),Tt=await a6({subtree:Ft,subtreeData:Ut,parentData:Lt,childIndex:Ke,implicitOptions:l,loaderOptions:c,s2VolumeBox:ft});(Tt.contentUrl||Tt.children.length)&&G.children.push(Tt)}return G.contentUrl||G.children.length?Vfe(G,{level:q,x:$e,y:at,z:_t},l,o):G}function Mw(t,e){let r;return Array.isArray(t)?(r=t[0],t.length>1&&eL.once('Not supported extension "3DTILES_multiple_contents" has been detected')):r=t,"constant"in r?!!r.constant:r.explicitBitstream?$fe(e,r.explicitBitstream):!1}function Vfe(t,e,r,i){const{basePath:n,refine:l,getRefine:c,lodMetricType:o,getTileType:m,rootLodMetricValue:b,rootBoundingVolume:A}=r,R=t.contentUrl&&t.contentUrl.replace(`${n}/`,""),M=b/2**e.level,L=i?.box?{box:i.box}:A,G=Gfe(L,e,r.subdivisionScheme);return{children:t.children,contentUrl:t.contentUrl,content:{uri:R},id:t.contentUrl,refine:c(l),type:m(t),lodMetricType:o,lodMetricValue:M,geometricError:M,transform:t.transform,boundingVolume:G}}function Gfe(t,e,r){if(t.region){const{level:i,x:n,y:l,z:c}=e,[o,m,b,A,R,M]=t.region,L=2**i,G=(b-o)/L,[V,q]=[o+G*n,o+G*(n+1)],J=(A-m)/L,[ie,ee]=[m+J*l,m+J*(l+1)];let me,Se;if(r==="OCTREE"){const Me=(M-R)/L;[me,Se]=[R+Me*c,R+Me*(c+1)]}else[me,Se]=[R,M];return{region:[V,ie,q,ee,me,Se]}}if(t.box)return t;throw new Error(`Unsupported bounding volume type ${JSON.stringify(t)}`)}function ap(t,e,r){return(t<<r)+e}function fE(t,e,r,i,n){const l=Hfe({level:e,x:r,y:i,z:n});return t.replace(/{level}|{x}|{y}|{z}/gi,c=>l[c])}function Hfe(t){const e={};for(const r in t)e[`{${r}}`]=t[r];return e}function $fe(t,e){const r=Math.floor(t/8),i=t%8;return(e[r]>>i&1)===1}function zT(t,e=""){if(!e)return Ah.EMPTY;const r=e.split("?")[0].split(".").pop();switch(r){case"pnts":return Ah.POINTCLOUD;case"i3dm":case"b3dm":case"glb":case"gltf":return Ah.SCENEGRAPH;default:return r||Ah.EMPTY}}function jT(t){switch(t){case"REPLACE":case"replace":return Rc.REPLACE;case"ADD":case"add":return Rc.ADD;default:return t}}function pE(t,e){if(/^[a-z][0-9a-z+.-]*:/i.test(e)){const r=new URL(t,`${e}/`);return decodeURI(r.toString())}else if(t.startsWith("/"))return t;return JK(e,t)}function uI(t,e){if(!t)return null;let r;if(t.content){const i=t.content.uri||t.content?.url;typeof i<"u"&&(r=pE(i,e))}return{...t,id:r,contentUrl:r,lodMetricType:_g.GEOMETRIC_ERROR,lodMetricValue:t.geometricError,transformMatrix:t.transform,type:zT(t,r),refine:jT(t.refine)}}async function Wfe(t,e,r){let i=null;const n=dI(t.root);n&&t.root?i=await hI(t.root,t,e,n,r):i=uI(t.root,e);const l=[];for(l.push(i);l.length>0;){const c=l.pop()||{},o=c.children||[],m=[];for(const b of o){const A=dI(b);let R;A?R=await hI(b,t,e,A,r):R=uI(b,e),R&&(m.push(R),l.push(R))}c.children=m}return i}async function hI(t,e,r,i,n){const{subdivisionScheme:l,maximumLevel:c,availableLevels:o,subtreeLevels:m,subtrees:{uri:b}}=i,A=fE(b,0,0,0,0),R=pE(A,r),M=await Fd(R,XD,n),L=t.content?.uri,G=L?pE(L,r):"",V=e?.root?.refine,q=t.geometricError,J=t.boundingVolume.extensions?.["3DTILES_bounding_volume_S2"];if(J){const me={box:o6(J),s2VolumeInfo:J};t.boundingVolume=me}const ie=t.boundingVolume,ee={contentUrlTemplate:G,subtreesUriTemplate:b,subdivisionScheme:l,subtreeLevels:m,maximumLevel:Number.isFinite(o)?o-1:c,refine:V,basePath:r,lodMetricType:_g.GEOMETRIC_ERROR,rootLodMetricValue:q,rootBoundingVolume:ie,getTileType:zT,getRefine:jT};return await qfe(t,r,M,ee,n)}async function qfe(t,e,r,i,n){if(!t)return null;const{children:l,contentUrl:c}=await a6({subtree:r,implicitOptions:i,loaderOptions:n});let o,m=null;return c&&(o=c,m={uri:c.replace(`${e}/`,"")}),{...t,id:o,contentUrl:o,lodMetricType:_g.GEOMETRIC_ERROR,lodMetricValue:t.geometricError,transformMatrix:t.transform,type:zT(t,o),refine:jT(t.refine),content:m||t.content,children:l}}function dI(t){return t?.extensions?.["3DTILES_implicit_tiling"]||t?.implicitTiling}const l6={dataType:null,batchType:null,id:"3d-tiles",name:"3D Tiles",module:"3d-tiles",version:VD,extensions:["cmpt","pnts","b3dm","i3dm"],mimeTypes:["application/octet-stream"],tests:["cmpt","pnts","b3dm","i3dm"],parse:Kfe,options:{"3d-tiles":{loadGLTF:!0,decodeQuantizedPositions:!1,isTileset:"auto",assetGltfUpAxis:null}}};async function Kfe(t,e={},r){const i=e["3d-tiles"]||{};let n;return i.isTileset==="auto"?n=r?.url&&r.url.indexOf(".json")!==-1:n=i.isTileset,n?Zfe(t,e,r):Xfe(t,e,r)}async function Zfe(t,e,r){const i=JSON.parse(new TextDecoder().decode(t)),n=r?.url||"",l=Yfe(n),c=await Wfe(i,l,e||{});return{...i,shape:"tileset3d",loader:l6,url:n,queryString:r?.queryString||"",basePath:l,root:c||i.root,type:_a.TILES3D,lodMetricType:_g.GEOMETRIC_ERROR,lodMetricValue:i.root?.geometricError||0}}async function Xfe(t,e,r){const i={content:{shape:"tile3d",featureIds:null}};return await ZD(t,0,e,r,i.content),i.content}function Yfe(t){return NA(t)}const fI=[0],Jfe={getPointColor:{type:"accessor",value:[0,0,0,255]},pointSize:1,data:"",loader:l6,onTilesetLoad:{type:"function",value:t=>{}},onTileLoad:{type:"function",value:t=>{}},onTileUnload:{type:"function",value:t=>{}},onTileError:{type:"function",value:(t,e,r)=>{}},_getMeshColor:{type:"function",value:t=>[255,255,255]}};class UT extends cD{initializeState(){"onTileLoadFail"in this.props&&hi.removed("onTileLoadFail","onTileError")(),this.state={layerMap:{},tileset3d:null,activeViewports:{},lastUpdatedViewports:null}}get isLoaded(){return!!(this.state?.tileset3d?.isLoaded()&&super.isLoaded)}shouldUpdateState({changeFlags:e}){return e.somethingChanged}updateState({props:e,oldProps:r,changeFlags:i}){if(e.data&&e.data!==r.data&&this._loadTileset(e.data),i.viewportChanged){const{activeViewports:n}=this.state;Object.keys(n).length&&(this._updateTileset(n),this.state.lastUpdatedViewports=n,this.state.activeViewports={})}if(i.propsChanged){const{layerMap:n}=this.state;for(const l in n)n[l].needsUpdate=!0}}activateViewport(e){const{activeViewports:r,lastUpdatedViewports:i}=this.state;this.internalState.viewport=e,r[e.id]=e;const n=i?.[e.id];(!n||!e.equals(n))&&(this.setChangeFlags({viewportChanged:!0}),this.setNeedsUpdate())}getPickingInfo({info:e,sourceLayer:r}){const i=r&&r.props.tile;return e.picked&&(e.object=i),e.sourceTile=i,e}filterSubLayer({layer:e,viewport:r}){const{tile:i}=e.props,{id:n}=r;return i.selected&&i.viewportIds.includes(n)}_updateAutoHighlight(e){const r=e.sourceTile,i=this.state.layerMap[r?.id];i&&i.layer&&i.layer.updateAutoHighlight(e)}async _loadTileset(e){const{loadOptions:r={}}=this.props,i=this.props.loader||this.props.loaders,n=Array.isArray(i)?i[0]:i,l={loadOptions:{...r}};let c=e;if(n.preload){const b=await n.preload(e,r);b.url&&(c=b.url),b.headers&&(l.loadOptions.fetch={...l.loadOptions.fetch,headers:b.headers}),Object.assign(l,b)}const o=await Fd(c,n,l.loadOptions),m=new kde(o,{onTileLoad:this._onTileLoad.bind(this),onTileUnload:this._onTileUnload.bind(this),onTileError:this.props.onTileError,...l});this.setState({tileset3d:m,layerMap:{}}),this._updateTileset(this.state.activeViewports),this.props.onTilesetLoad(m)}_onTileLoad(e){const{lastUpdatedViewports:r}=this.state;this.props.onTileLoad(e),this._updateTileset(r),this.setNeedsUpdate()}_onTileUnload(e){delete this.state.layerMap[e.id],this.props.onTileUnload(e)}_updateTileset(e){if(!e)return;const{tileset3d:r}=this.state,{timeline:i}=this.context,n=Object.keys(e).length;!i||!n||!r||r.selectTiles(Object.values(e)).then(l=>{this.state.frameNumber!==l&&this.setState({frameNumber:l})})}_getSubLayer(e,r){if(!e.content)return null;switch(e.type){case Ah.POINTCLOUD:return this._makePointCloudLayer(e,r);case Ah.SCENEGRAPH:return this._make3DModelLayer(e);case Ah.MESH:return this._makeSimpleMeshLayer(e,r);default:throw new Error(`Tile3DLayer: Failed to render layer of type ${e.content.type}`)}}_makePointCloudLayer(e,r){const{attributes:i,pointCount:n,constantRGBA:l,cartographicOrigin:c,modelMatrix:o}=e.content,{positions:m,normals:b,colors:A}=i;if(!m)return null;const R=r&&r.props.data||{header:{vertexCount:n},attributes:{POSITION:m,NORMAL:b,COLOR_0:A}},{pointSize:M,getPointColor:L}=this.props,G=this.getSubLayerClass("pointcloud",AT);return new G({pointSize:M},this.getSubLayerProps({id:"pointcloud"}),{id:`${this.id}-pointcloud-${e.id}`,tile:e,data:R,coordinateSystem:Qr.METER_OFFSETS,coordinateOrigin:c,modelMatrix:o,getColor:l||L,_offset:0})}_make3DModelLayer(e){const{gltf:r,instances:i,cartographicOrigin:n,modelMatrix:l}=e.content,c=this.getSubLayerClass("scenegraph",kT);return new c({_lighting:"pbr"},this.getSubLayerProps({id:"scenegraph"}),{id:`${this.id}-scenegraph-${e.id}`,tile:e,data:i||fI,scenegraph:r,coordinateSystem:Qr.METER_OFFSETS,coordinateOrigin:n,modelMatrix:l,getTransformMatrix:o=>o.modelMatrix,getPosition:[0,0,0],_offset:0})}_makeSimpleMeshLayer(e,r){const i=e.content,{attributes:n,indices:l,modelMatrix:c,cartographicOrigin:o,coordinateSystem:m=Qr.METER_OFFSETS,material:b,featureIds:A}=i,{_getMeshColor:R}=this.props,M=r&&r.props.mesh||new tg({topology:"triangle-list",attributes:Qfe(n),indices:l}),L=this.getSubLayerClass("mesh",BT);return new L(this.getSubLayerProps({id:"mesh"}),{id:`${this.id}-mesh-${e.id}`,tile:e,mesh:M,data:fI,getColor:R(e),pbrMaterial:b,modelMatrix:c,coordinateOrigin:o,coordinateSystem:m,featureIds:A,_offset:0})}renderLayers(){const{tileset3d:e,layerMap:r}=this.state;return e?e.tiles.map(i=>{const n=r[i.id]=r[i.id]||{tile:i};let{layer:l}=n;return i.selected&&(l?n.needsUpdate&&(l=this._getSubLayer(i,l),n.needsUpdate=!1):l=this._getSubLayer(i)),n.layer=l,l}).filter(Boolean):null}}UT.defaultProps=Jfe;UT.layerName="Tile3DLayer";function Qfe(t){const e={};return e.positions={...t.positions,value:new Float32Array(t.positions.value)},t.normals&&(e.normals=t.normals),t.texCoords&&(e.texCoords=t.texCoords),t.colors&&(e.colors=t.colors),t.uvRegions&&(e.uvRegions=t.uvRegions),e}const Iw=512,epe=Math.PI/180;function c6({map:t,gl:e,deck:r}){if(t.__deck)return t.__deck;const i=r?.props._customRender,n=r?.props.onLoad,l=h6({...r?.props,_customRender:()=>{t.triggerRepaint(),i?.("")}});let c;return(!r||r.props.gl===e)&&(Object.assign(l,{gl:e,width:null,height:null,touchAction:"unset",viewState:My(t)}),r?.isInitialized?pI(r,t):l.onLoad=()=>{n?.(),pI(c,t)}),r?(c=r,r.setProps(l),r.userData.isExternal=!0):(c=new Cy(l),t.on("remove",()=>{u6(t)})),c.userData.mapboxLayers=new Set,t.__deck=c,t.on("render",()=>{c.isInitialized&&ope(c,t)}),c}function pI(t,e){const r=()=>{t.isInitialized?ape(t,e):e.off("move",r)};e.on("move",r)}function u6(t){t.__deck?.finalize(),t.__deck=null}function h6(t){return{...t,parameters:{depthMask:!0,depthTest:!0,blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthFunc:515,blendEquation:32774,...t.parameters},views:t.views||[new _T({id:"mapbox"})]}}function tpe(t,e){t.userData.mapboxLayers.add(e),VT(t)}function rpe(t,e){t.userData.mapboxLayers.delete(e),VT(t)}function ipe(t,e){VT(t)}function npe(t,e,r){let{currentViewport:i}=t.userData,n=!1;i||(i=d6(t,e,!0),t.userData.currentViewport=i,n=!0),t.isInitialized&&t._drawLayers("mapbox-repaint",{viewports:[i],layerFilter:({layer:l})=>r.id===l.id||l.props.operation.includes("terrain"),clearStack:n,clearCanvas:!1})}function My(t){const{lng:e,lat:r}=t.getCenter(),i={longitude:(e+540)%360-180,latitude:r,zoom:t.getZoom(),bearing:t.getBearing(),pitch:t.getPitch(),padding:t.getPadding(),repeat:t.getRenderWorldCopies()};return t.getTerrain?.()&&spe(t,i),i}function spe(t,e){if(t.getFreeCameraOptions){const{position:r}=t.getFreeCameraOptions();if(!r||r.z===void 0)return;const i=t.transform.height,{longitude:n,latitude:l,pitch:c}=e,o=r.x*Iw,m=(1-r.y)*Iw,b=r.z*Iw,A=Ey([n,l]),R=o-A[0],M=m-A[1],L=Math.sqrt(R*R+M*M),G=c*epe,V=1.5*i,q=G<.001?V*Math.cos(G)/b:V*Math.sin(G)/L;e.zoom=Math.log2(q);const J=V*Math.cos(G)/q,ie=b-J;e.position=[0,0,ie/Hv(l)]}else typeof t.transform.elevation=="number"&&(e.position=[0,0,t.transform.elevation])}function d6(t,e,r=!0){return new Mp({id:"mapbox",x:0,y:0,width:t.width,height:t.height,...My(e),nearZMultiplier:r?.02:.1,nearZ:e.transform._nearZ/e.transform.height,farZ:e.transform._farZ/e.transform.height})}function ope(t,e){const{mapboxLayers:r,isExternal:i}=t.userData;if(i){const n=Array.from(r,b=>b.id),l=pg(t.props.layers,Boolean).some(b=>b&&!n.includes(b.id));let c=t.getViewports();const o=c.findIndex(b=>b.id==="mapbox"),m=c.length>1||o<0;(l||m)&&(o>=0&&(c=c.slice(),c[o]=d6(t,e,!1)),t._drawLayers("mapbox-repaint",{viewports:c,layerFilter:b=>(!t.props.layerFilter||t.props.layerFilter(b))&&(b.viewport.id!=="mapbox"||!n.includes(b.layer.id)),clearCanvas:!1}))}t.userData.currentViewport=null}function ape(t,e){t.setProps({viewState:My(e)}),t.needsRedraw({clearRedrawFlags:!0})}function VT(t){if(t.userData.isExternal)return;const e=[];t.userData.mapboxLayers.forEach(r=>{const i=r.props.type,n=new i(r.props);e.push(n)}),t.setProps({layers:e})}class lpe{constructor(e){if(!e.id)throw new Error("Layer must have an unique id");this.id=e.id,this.type="custom",this.renderingMode=e.renderingMode||"3d",this.map=null,this.deck=null,this.props=e}onAdd(e,r){this.map=e,this.deck=c6({map:e,gl:r,deck:this.props.deck}),tpe(this.deck,this)}onRemove(){this.deck&&rpe(this.deck,this)}setProps(e){Object.assign(this.props,e,{id:this.id}),this.deck&&ipe(this.deck)}render(){npe(this.deck,this.map,this)}}const kw="__UNDEFINED__";function Iv(t,e,r,i){if(!t||!e||!t.style||!t.style._loaded)return;const n=pg(i,Boolean);if(r!==i){const o=pg(r,Boolean),m=new Set(o.map(b=>b.id));for(const b of n)m.delete(b.id);for(const b of m)t.getLayer(b)&&t.removeLayer(b)}for(const o of n){const m=t.getLayer(o.id);m?(m.implementation||m).setProps(o.props):t.addLayer(new lpe({id:o.id,deck:e}),o.props.beforeId)}const l=t.style._order,c={};for(const o of n){let{beforeId:m}=o.props;(!m||!l.includes(m))&&(m=kw),c[m]=c[m]||[],c[m].push(o.id)}for(const o in c){const m=c[o];let b=o===kw?l.length:l.indexOf(o),A=o===kw?void 0:o;for(let R=m.length-1;R>=0;R--){const M=m[R],L=l.indexOf(M);L!==b-1&&(t.moveLayer(M,A),L>b&&b++),b--,A=M}}}class cpe{constructor(e){this._handleStyleChange=()=>{Iv(this._map,this._deck,this._props.layers,this._props.layers)},this._updateContainerSize=()=>{if(this._map&&this._container){const{clientWidth:n,clientHeight:l}=this._map.getContainer();Object.assign(this._container.style,{width:`${n}px`,height:`${l}px`})}},this._updateViewState=()=>{const n=this._deck;n&&(n.setProps({viewState:My(this._map)}),n.isInitialized&&n.redraw())},this._handleMouseEvent=n=>{const l=this._deck;if(!l||!l.isInitialized)return;const c={type:n.type,offsetCenter:n.point,srcEvent:n},o=this._lastMouseDownPoint;switch(!n.point&&o&&(c.deltaX=n.originalEvent.clientX-o.clientX,c.deltaY=n.originalEvent.clientY-o.clientY,c.offsetCenter={x:o.x+c.deltaX,y:o.y+c.deltaY}),c.type){case"mousedown":l._onPointerDown(c),this._lastMouseDownPoint={...n.point,clientX:n.originalEvent.clientX,clientY:n.originalEvent.clientY};break;case"dragstart":c.type="panstart",l._onEvent(c);break;case"drag":c.type="panmove",l._onEvent(c);break;case"dragend":c.type="panend",l._onEvent(c);break;case"click":c.tapCount=1,l._onEvent(c);break;case"dblclick":c.type="click",c.tapCount=2,l._onEvent(c);break;case"mousemove":c.type="pointermove",l._onPointerMove(c);break;case"mouseout":c.type="pointerleave",l._onPointerMove(c);break;default:return}};const{interleaved:r=!1,...i}=e;this._interleaved=r,this._props=i}setProps(e){this._interleaved&&e.layers&&Iv(this._map,this._deck,this._props.layers,e.layers),Object.assign(this._props,e),this._deck&&this._deck.setProps(this._interleaved?h6(this._props):this._props)}onAdd(e){return this._map=e,this._interleaved?this._onAddInterleaved(e):this._onAddOverlaid(e)}_onAddOverlaid(e){const r=document.createElement("div");return Object.assign(r.style,{position:"absolute",left:0,top:0,textAlign:"initial",pointerEvents:"none"}),this._container=r,this._deck=new Cy({...this._props,parent:r,viewState:My(e)}),e.on("resize",this._updateContainerSize),e.on("render",this._updateViewState),e.on("mousedown",this._handleMouseEvent),e.on("dragstart",this._handleMouseEvent),e.on("drag",this._handleMouseEvent),e.on("dragend",this._handleMouseEvent),e.on("mousemove",this._handleMouseEvent),e.on("mouseout",this._handleMouseEvent),e.on("click",this._handleMouseEvent),e.on("dblclick",this._handleMouseEvent),this._updateContainerSize(),r}_onAddInterleaved(e){const r=e.painter.context.gl;return r instanceof WebGLRenderingContext&&hi.warn("Incompatible basemap library. See: https://deck.gl/docs/api-reference/mapbox/overview#compatibility")(),this._deck=c6({map:e,gl:r,deck:new Cy({...this._props,gl:r})}),e.on("styledata",this._handleStyleChange),Iv(e,this._deck,[],this._props.layers),document.createElement("div")}onRemove(){const e=this._map;e&&(this._interleaved?this._onRemoveInterleaved(e):this._onRemoveOverlaid(e)),this._deck=void 0,this._map=void 0,this._container=void 0}_onRemoveOverlaid(e){e.off("resize",this._updateContainerSize),e.off("render",this._updateViewState),e.off("mousedown",this._handleMouseEvent),e.off("dragstart",this._handleMouseEvent),e.off("drag",this._handleMouseEvent),e.off("dragend",this._handleMouseEvent),e.off("mousemove",this._handleMouseEvent),e.off("mouseout",this._handleMouseEvent),e.off("click",this._handleMouseEvent),e.off("dblclick",this._handleMouseEvent),this._deck?.finalize()}_onRemoveInterleaved(e){e.off("styledata",this._handleStyleChange),Iv(e,this._deck,this._props.layers,[]),u6(e)}getDefaultPosition(){return"top-left"}pickObject(e){return Ss(this._deck),this._deck.pickObject(e)}pickMultipleObjects(e){return Ss(this._deck),this._deck.pickMultipleObjects(e)}pickObjects(e){return Ss(this._deck),this._deck.pickObjects(e)}finalize(){this._map&&this._map.removeControl(this)}getCanvas(){return this._map?this._interleaved?this._map.getCanvas():this._deck.getCanvas():null}}class f6{olaMaps;apiKey;accessToken;mode;threedTileset;static Marker=tn.Marker;static Popup=tn.Popup;static NavigationControl=tn.NavigationControl;static GeolocateControl=tn.GeolocateControl;static ScaleControl=tn.ScaleControl;static FullscreenControl=tn.FullscreenControl;static AttributionControl=tn.AttributionControl;static TerrainControl=tn.TerrainControl;static LngLat=tn.LngLat;static LngLatBounds=tn.LngLatBounds;static Point=tn.Point;static MercatorCoordinate=tn.MercatorCoordinate;static MapMouseEvent=tn.MapMouseEvent;static MapTouchEvent=tn.MapTouchEvent;static MapWheelEvent=tn.MapWheelEvent;static AJAXError=tn.AJAXError;constructor({apiKey:e,accessToken:r="",mode:i="2d",threedTileset:n=Zq}){this.apiKey=e,this.mode=i,this.threedTileset=n,this.accessToken=r}addOlaLogo(e){if(typeof window>"u")return;const r=document.getElementsByClassName("maplibregl-ctrl-bottom-left");let i="#000";e.style?.includes("dark")&&(i="#FFF");for(let n=0;n<r.length;n++){const l=document.createElement("div");l.style.position="absolute",l.style.bottom="4px",l.style.left="10px",l.style.zIndex="1000",l.innerHTML=Xq(i),r[n].appendChild(l)}}addAttribution(){document.querySelectorAll(".maplibregl-ctrl-bottom-right .maplibregl-ctrl-attrib-inner")?.forEach(e=>{const r=e.querySelector("a");r&&(r.style.display="none");const i="ola-maps-link";if(!e.querySelector(`#${i}`)){const l=document.createElement("a");l.id=i,l.href="https://maps.olakrutrim.com/",l.target="_blank",l.textContent="Ola Maps ",e.appendChild(l)}const n="osm-link";if(!e.querySelector(`#${n}`)){const l=document.createElement("a");l.id=n,l.href="https://www.openstreetmap.org/copyright",l.target="_blank",l.textContent="|  OpenStreetMap contributors",e.appendChild(l)}})}fetchStaticMap(e){try{return fetch(e).then(r=>r.blob())}catch(r){console.log(r)}}async add3dLayer(){if(!this.threedTileset)throw new Error("3d Tileset is not initialized");const e=new UT({id:"tile-3d-layer",data:`${this.threedTileset}?api_key=${this.apiKey}`,beforeId:"poi_railway"}),r=new cpe({interleaved:!0,layers:[e]});r&&this.olaMaps.on("style.load",()=>{this.olaMaps.setFilter("building-3d",["all",["!has","hide_3d"],["!=","render_as_3d",!0]]),this.olaMaps.addControl(r)})}init(e){this.olaMaps=new tn.Map({container:e?.container||"map",center:e?.center||[0,0],zoom:e?.zoom||9,hash:e?.hash||!1,style:e?.style||Kq,transformRequest:(i,n)=>{if(this.accessToken)return{url:i,headers:{Authorization:`Bearer ${this.accessToken}`}};{const l=new URL(i);return n!=="Image"&&l.searchParams.append("api_key",this.apiKey),{url:l.toString()}}},...e}),this.mode==="3d"&&this.add3dLayer(),this.addOlaLogo(e),this.addAttribution();const r={};return Object.getOwnPropertyNames(tn.Map.prototype).forEach(i=>{typeof this.olaMaps[i]=="function"&&(r[i]=this.olaMaps[i].bind(this.olaMaps))}),Object.keys(rv).forEach(i=>{typeof rv[i]=="function"?r[i]=(...n)=>new rv[i](...n):r[i]=rv[i]}),Object.getOwnPropertyNames(this.olaMaps).forEach(i=>{i in r||(r[i]=this.olaMaps[i])}),Object.assign(this.olaMaps,r)}addNavigationControls(e){return new tn.NavigationControl(e)}addGeolocateControls(e){return new tn.GeolocateControl(e)}getMercatorCoordinate(){return tn.MercatorCoordinate}addMarker(e){return new tn.Marker(e)}addPopup(e){return new tn.Popup(e)}getStaticMap(e,r){this.fetchStaticMap(e)?.then(i=>{const n=URL.createObjectURL(i),l=document.createElement("img");l.src=n;const c=document.getElementById(r);c&&!c.querySelector("img")?c?.appendChild(l):console.log("An image already exists in the element.")}).catch(i=>console.error(i))}}typeof window<"u"&&(window.OlaMaps=f6);const Bw="HbWpPdq2B7StVwNqsUEitrJZCXXdMWfHjoX0yutE",upe=()=>{const t=Z.useRef(null),e=Z.useRef(null),r=Z.useRef(null),i=Z.useRef([]),n=Z.useRef(null),[l,c]=Z.useState([]),[o,m]=Z.useState(!0),[b,A]=Z.useState(""),[R,M]=Z.useState([]),[L,G]=Z.useState(!1),[V,q]=Z.useState(null),[J,ie]=Z.useState(null),[ee,me]=Z.useState(!1),[Se,Me]=Z.useState(!1),[Ve,Be]=Z.useState(5),[$e,at]=Z.useState(null),_t=Z.useRef();Z.useEffect(()=>{(async()=>{m(!0);const Lt=await v$();c(Lt),m(!1)})()},[]),Z.useEffect(()=>!t.current||e.current?void 0:((()=>{try{r.current=new f6({apiKey:Bw});const Lt=r.current.init({style:"https://api.olamaps.io/tiles/vector/v1/styles/default-dark-standard/style.json",container:t.current,center:[77.209,28.6139],zoom:12});e.current=Lt,Lt.addControl(new r.current.NavigationControl,"bottom-right"),Lt.on("load",()=>{Nt()})}catch(Lt){console.error("Error initializing Ola Maps:",Lt)}})(),()=>{e.current&&(e.current.remove(),e.current=null)}),[]),Z.useEffect(()=>{navigator.geolocation&&navigator.geolocation.getCurrentPosition(Ut=>{const{latitude:Lt,longitude:At}=Ut.coords;if(q({lat:Lt,lng:At}),e.current&&r.current){if(n.current)n.current.setLngLat([At,Lt]);else{const Ke=document.createElement("div");Ke.className="user-location-marker",Ke.style.width="20px",Ke.style.height="20px",Ke.style.backgroundColor="#3b82f6",Ke.style.borderRadius="50%",Ke.style.border="3px solid white",Ke.style.boxShadow="0 0 10px rgba(59, 130, 246, 0.5)",n.current=r.current.addMarker({element:Ke}).setLngLat([At,Lt]).addTo(e.current)}e.current.flyTo({center:[At,Lt],zoom:14})}},Ut=>{console.error("Error getting location:",Ut)})},[]);const Nt=()=>{if(!e.current||!r.current)return;i.current.forEach(Lt=>Lt.remove()),i.current=[],l.filter(Lt=>{if($e&&Lt.mood!==$e)return!1;if(Se&&V){const Ke=(Lt.location.lat-V.lat)*Math.PI/180,ft=(Lt.location.lng-V.lng)*Math.PI/180,Tt=Math.sin(Ke/2)*Math.sin(Ke/2)+Math.cos(V.lat*Math.PI/180)*Math.cos(Lt.location.lat*Math.PI/180)*Math.sin(ft/2)*Math.sin(ft/2);if(6371*(2*Math.atan2(Math.sqrt(Tt),Math.sqrt(1-Tt)))>Ve)return!1}return!0}).forEach(Lt=>{const At=document.createElement("div");if(At.className="event-marker",At.style.backgroundImage=`url(${Lt.imageUrl})`,At.style.width="40px",At.style.height="40px",At.style.backgroundSize="cover",At.style.borderRadius="50%",At.style.border="2px solid white",At.style.cursor="pointer",At.style.boxShadow="0 4px 6px rgba(0,0,0,0.3)",Lt.attendees>50){const ft=document.createElement("div");ft.className="absolute -inset-2 rounded-full bg-primary/30 animate-ping -z-10",At.appendChild(ft)}At.addEventListener("click",()=>{ie(Lt),me(!0)});const Ke=r.current.addMarker({element:At}).setLngLat([Lt.location.lng,Lt.location.lat]).addTo(e.current);i.current.push(Ke)})};Z.useEffect(()=>{Nt()},[l,$e,Se,Ve,V]),Z.useEffect(()=>{if(_t.current&&clearTimeout(_t.current),b.trim().length<3){M([]);return}return G(!0),_t.current=setTimeout(async()=>{try{const Lt=await(await fetch(`https://api.olamaps.io/places/v1/autocomplete?input=${encodeURIComponent(b)}&api_key=${Bw}`)).json();Lt.predictions&&Array.isArray(Lt.predictions)?M(Lt.predictions.slice(0,5)):M([])}catch(Ut){console.error("Ola Maps search error:",Ut),M([])}finally{G(!1)}},500),()=>{_t.current&&clearTimeout(_t.current)}},[b]);const sr=async Ut=>{try{const At=await(await fetch(`https://api.olamaps.io/places/v1/details?place_id=${Ut.place_id}&api_key=${Bw}`)).json();console.log("Place Details Response:",At);const ft=(At.result?.geometry||At.geometry)?.location;if(ft&&e.current){const Tt=typeof ft.lat=="function"?ft.lat():parseFloat(ft.lat),ze=typeof ft.lng=="function"?ft.lng():parseFloat(ft.lng);!isNaN(Tt)&&!isNaN(ze)?(console.log("Flying to:",{lat:Tt,lng:ze}),e.current.flyTo({center:[ze,Tt],zoom:15,duration:2e3}),r.current.addMarker({}).setLngLat([ze,Tt]).addTo(e.current)):console.error("Invalid coordinates:",ft)}else console.error("Could not find location in response:",At)}catch(Lt){console.error("Error fetching place details:",Lt)}A(""),M([])},Ft=()=>{V&&e.current&&e.current.flyTo({center:[V.lng,V.lat],zoom:15})};return j.jsxs("div",{className:"relative w-full h-full bg-background",children:[j.jsx("div",{ref:t,className:"w-full h-full",style:{minHeight:"100vh"}}),j.jsxs("div",{className:"absolute top-4 left-4 right-4 z-[400]",children:[j.jsxs("div",{className:"relative",children:[j.jsx(v8,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground pointer-events-none"}),j.jsx(Tu,{type:"text",placeholder:"Search for a location in India...",value:b,onChange:Ut=>A(Ut.target.value),className:"pl-9 pr-9 bg-background/80 backdrop-blur-md border-white/20 shadow-lg"}),b&&j.jsx("button",{onClick:()=>{A(""),M([])},className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-muted-foreground hover:text-foreground",children:j.jsx(D1,{className:"h-4 w-4"})})]}),(L||R.length>0)&&j.jsx("div",{className:"absolute top-full left-0 right-0 mt-2 bg-background/90 backdrop-blur-md rounded-lg border border-white/10 shadow-xl overflow-hidden max-h-60 overflow-y-auto",children:L?j.jsxs("div",{className:"p-4 text-center text-sm text-muted-foreground flex items-center justify-center gap-2",children:[j.jsx(O1,{className:"h-4 w-4 animate-spin"}),"Searching with Ola Maps..."]}):R.map(Ut=>j.jsx("button",{className:"w-full text-left px-4 py-3 hover:bg-white/10 transition-colors border-b border-white/5 last:border-0",onClick:()=>sr(Ut),children:j.jsxs("div",{className:"flex items-start gap-2",children:[j.jsx(Pp,{className:"h-4 w-4 text-primary shrink-0 mt-0.5"}),j.jsxs("div",{children:[j.jsx("div",{className:"text-sm font-medium text-foreground",children:Ut.description}),Ut.structured_formatting?.secondary_text&&j.jsx("div",{className:"text-xs text-muted-foreground line-clamp-1",children:Ut.structured_formatting.secondary_text})]})]})},Ut.place_id))})]}),j.jsxs("div",{className:"absolute top-20 left-0 right-0 z-[400] flex flex-col gap-4 pointer-events-none px-4",children:[j.jsxs("div",{className:"flex items-center justify-between pointer-events-auto",children:[j.jsx(q$,{selectedMood:$e,onSelectMood:at}),j.jsx(ao,{variant:"outline",size:"icon",className:"bg-background/80 backdrop-blur-md border-white/20 shadow-lg shrink-0 ml-2",onClick:Ft,children:j.jsx(f8,{className:`h-4 w-4 ${V?"text-primary":"text-muted-foreground"}`})})]}),j.jsx("div",{className:"pointer-events-auto",children:j.jsx(H$,{isActive:Se,onToggle:()=>Me(!Se),radius:Ve,onRadiusChange:Be})})]}),j.jsx("div",{className:"absolute bottom-24 left-4 right-4 z-[400] pointer-events-none",children:j.jsxs("div",{className:"bg-background/80 backdrop-blur-md rounded-full px-4 py-2 border border-white/10 shadow-lg inline-flex items-center gap-3",children:[j.jsxs("div",{className:"flex items-center gap-1.5",children:[j.jsx(Pp,{className:"h-3.5 w-3.5 text-primary"}),j.jsxs("span",{className:"text-xs font-medium",children:[l.length," events"]})]}),j.jsx("div",{className:"w-px h-3 bg-border"}),j.jsx("div",{className:"text-[10px] text-muted-foreground",children:"Powered by Ola Maps "})]})}),j.jsx("div",{className:"absolute bottom-24 right-4 z-[400]",children:j.jsx(Hq,{})}),j.jsx(mB,{event:J,open:ee,onClose:()=>me(!1)})]})};function hpe(t,e){return Z.useReducer((r,i)=>e[r][i]??r,t)}var GT="ScrollArea",[p6]=Sg(GT),[dpe,Gl]=p6(GT),m6=Z.forwardRef((t,e)=>{const{__scopeScrollArea:r,type:i="hover",dir:n,scrollHideDelay:l=600,...c}=t,[o,m]=Z.useState(null),[b,A]=Z.useState(null),[R,M]=Z.useState(null),[L,G]=Z.useState(null),[V,q]=Z.useState(null),[J,ie]=Z.useState(0),[ee,me]=Z.useState(0),[Se,Me]=Z.useState(!1),[Ve,Be]=Z.useState(!1),$e=Bn(e,_t=>m(_t)),at=G1(n);return j.jsx(dpe,{scope:r,type:i,dir:at,scrollHideDelay:l,scrollArea:o,viewport:b,onViewportChange:A,content:R,onContentChange:M,scrollbarX:L,onScrollbarXChange:G,scrollbarXEnabled:Se,onScrollbarXEnabledChange:Me,scrollbarY:V,onScrollbarYChange:q,scrollbarYEnabled:Ve,onScrollbarYEnabledChange:Be,onCornerWidthChange:ie,onCornerHeightChange:me,children:j.jsx(nn.div,{dir:at,...c,ref:$e,style:{position:"relative","--radix-scroll-area-corner-width":J+"px","--radix-scroll-area-corner-height":ee+"px",...t.style}})})});m6.displayName=GT;var g6="ScrollAreaViewport",_6=Z.forwardRef((t,e)=>{const{__scopeScrollArea:r,children:i,nonce:n,...l}=t,c=Gl(g6,r),o=Z.useRef(null),m=Bn(e,o,c.onViewportChange);return j.jsxs(j.Fragment,{children:[j.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}"},nonce:n}),j.jsx(nn.div,{"data-radix-scroll-area-viewport":"",...l,ref:m,style:{overflowX:c.scrollbarXEnabled?"scroll":"hidden",overflowY:c.scrollbarYEnabled?"scroll":"hidden",...t.style},children:j.jsx("div",{ref:c.onContentChange,style:{minWidth:"100%",display:"table"},children:i})})]})});_6.displayName=g6;var Bu="ScrollAreaScrollbar",y6=Z.forwardRef((t,e)=>{const{forceMount:r,...i}=t,n=Gl(Bu,t.__scopeScrollArea),{onScrollbarXEnabledChange:l,onScrollbarYEnabledChange:c}=n,o=t.orientation==="horizontal";return Z.useEffect(()=>(o?l(!0):c(!0),()=>{o?l(!1):c(!1)}),[o,l,c]),n.type==="hover"?j.jsx(fpe,{...i,ref:e,forceMount:r}):n.type==="scroll"?j.jsx(ppe,{...i,ref:e,forceMount:r}):n.type==="auto"?j.jsx(v6,{...i,ref:e,forceMount:r}):n.type==="always"?j.jsx(HT,{...i,ref:e}):null});y6.displayName=Bu;var fpe=Z.forwardRef((t,e)=>{const{forceMount:r,...i}=t,n=Gl(Bu,t.__scopeScrollArea),[l,c]=Z.useState(!1);return Z.useEffect(()=>{const o=n.scrollArea;let m=0;if(o){const b=()=>{window.clearTimeout(m),c(!0)},A=()=>{m=window.setTimeout(()=>c(!1),n.scrollHideDelay)};return o.addEventListener("pointerenter",b),o.addEventListener("pointerleave",A),()=>{window.clearTimeout(m),o.removeEventListener("pointerenter",b),o.removeEventListener("pointerleave",A)}}},[n.scrollArea,n.scrollHideDelay]),j.jsx(Bh,{present:r||l,children:j.jsx(v6,{"data-state":l?"visible":"hidden",...i,ref:e})})}),ppe=Z.forwardRef((t,e)=>{const{forceMount:r,...i}=t,n=Gl(Bu,t.__scopeScrollArea),l=t.orientation==="horizontal",c=_b(()=>m("SCROLL_END"),100),[o,m]=hpe("hidden",{hidden:{SCROLL:"scrolling"},scrolling:{SCROLL_END:"idle",POINTER_ENTER:"interacting"},interacting:{SCROLL:"interacting",POINTER_LEAVE:"idle"},idle:{HIDE:"hidden",SCROLL:"scrolling",POINTER_ENTER:"interacting"}});return Z.useEffect(()=>{if(o==="idle"){const b=window.setTimeout(()=>m("HIDE"),n.scrollHideDelay);return()=>window.clearTimeout(b)}},[o,n.scrollHideDelay,m]),Z.useEffect(()=>{const b=n.viewport,A=l?"scrollLeft":"scrollTop";if(b){let R=b[A];const M=()=>{const L=b[A];R!==L&&(m("SCROLL"),c()),R=L};return b.addEventListener("scroll",M),()=>b.removeEventListener("scroll",M)}},[n.viewport,l,m,c]),j.jsx(Bh,{present:r||o!=="hidden",children:j.jsx(HT,{"data-state":o==="hidden"?"hidden":"visible",...i,ref:e,onPointerEnter:xi(t.onPointerEnter,()=>m("POINTER_ENTER")),onPointerLeave:xi(t.onPointerLeave,()=>m("POINTER_LEAVE"))})})}),v6=Z.forwardRef((t,e)=>{const r=Gl(Bu,t.__scopeScrollArea),{forceMount:i,...n}=t,[l,c]=Z.useState(!1),o=t.orientation==="horizontal",m=_b(()=>{if(r.viewport){const b=r.viewport.offsetWidth<r.viewport.scrollWidth,A=r.viewport.offsetHeight<r.viewport.scrollHeight;c(o?b:A)}},10);return vg(r.viewport,m),vg(r.content,m),j.jsx(Bh,{present:i||l,children:j.jsx(HT,{"data-state":l?"visible":"hidden",...n,ref:e})})}),HT=Z.forwardRef((t,e)=>{const{orientation:r="vertical",...i}=t,n=Gl(Bu,t.__scopeScrollArea),l=Z.useRef(null),c=Z.useRef(0),[o,m]=Z.useState({content:0,viewport:0,scrollbar:{size:0,paddingStart:0,paddingEnd:0}}),b=A6(o.viewport,o.content),A={...i,sizes:o,onSizesChange:m,hasThumb:b>0&&b<1,onThumbChange:M=>l.current=M,onThumbPointerUp:()=>c.current=0,onThumbPointerDown:M=>c.current=M};function R(M,L){return bpe(M,c.current,o,L)}return r==="horizontal"?j.jsx(mpe,{...A,ref:e,onThumbPositionChange:()=>{if(n.viewport&&l.current){const M=n.viewport.scrollLeft,L=mI(M,o,n.dir);l.current.style.transform=`translate3d(${L}px, 0, 0)`}},onWheelScroll:M=>{n.viewport&&(n.viewport.scrollLeft=M)},onDragScroll:M=>{n.viewport&&(n.viewport.scrollLeft=R(M,n.dir))}}):r==="vertical"?j.jsx(gpe,{...A,ref:e,onThumbPositionChange:()=>{if(n.viewport&&l.current){const M=n.viewport.scrollTop,L=mI(M,o);l.current.style.transform=`translate3d(0, ${L}px, 0)`}},onWheelScroll:M=>{n.viewport&&(n.viewport.scrollTop=M)},onDragScroll:M=>{n.viewport&&(n.viewport.scrollTop=R(M))}}):null}),mpe=Z.forwardRef((t,e)=>{const{sizes:r,onSizesChange:i,...n}=t,l=Gl(Bu,t.__scopeScrollArea),[c,o]=Z.useState(),m=Z.useRef(null),b=Bn(e,m,l.onScrollbarXChange);return Z.useEffect(()=>{m.current&&o(getComputedStyle(m.current))},[m]),j.jsx(x6,{"data-orientation":"horizontal",...n,ref:b,sizes:r,style:{bottom:0,left:l.dir==="rtl"?"var(--radix-scroll-area-corner-width)":0,right:l.dir==="ltr"?"var(--radix-scroll-area-corner-width)":0,"--radix-scroll-area-thumb-width":gb(r)+"px",...t.style},onThumbPointerDown:A=>t.onThumbPointerDown(A.x),onDragScroll:A=>t.onDragScroll(A.x),onWheelScroll:(A,R)=>{if(l.viewport){const M=l.viewport.scrollLeft+A.deltaX;t.onWheelScroll(M),S6(M,R)&&A.preventDefault()}},onResize:()=>{m.current&&l.viewport&&c&&i({content:l.viewport.scrollWidth,viewport:l.viewport.offsetWidth,scrollbar:{size:m.current.clientWidth,paddingStart:P1(c.paddingLeft),paddingEnd:P1(c.paddingRight)}})}})}),gpe=Z.forwardRef((t,e)=>{const{sizes:r,onSizesChange:i,...n}=t,l=Gl(Bu,t.__scopeScrollArea),[c,o]=Z.useState(),m=Z.useRef(null),b=Bn(e,m,l.onScrollbarYChange);return Z.useEffect(()=>{m.current&&o(getComputedStyle(m.current))},[m]),j.jsx(x6,{"data-orientation":"vertical",...n,ref:b,sizes:r,style:{top:0,right:l.dir==="ltr"?0:void 0,left:l.dir==="rtl"?0:void 0,bottom:"var(--radix-scroll-area-corner-height)","--radix-scroll-area-thumb-height":gb(r)+"px",...t.style},onThumbPointerDown:A=>t.onThumbPointerDown(A.y),onDragScroll:A=>t.onDragScroll(A.y),onWheelScroll:(A,R)=>{if(l.viewport){const M=l.viewport.scrollTop+A.deltaY;t.onWheelScroll(M),S6(M,R)&&A.preventDefault()}},onResize:()=>{m.current&&l.viewport&&c&&i({content:l.viewport.scrollHeight,viewport:l.viewport.offsetHeight,scrollbar:{size:m.current.clientHeight,paddingStart:P1(c.paddingTop),paddingEnd:P1(c.paddingBottom)}})}})}),[_pe,b6]=p6(Bu),x6=Z.forwardRef((t,e)=>{const{__scopeScrollArea:r,sizes:i,hasThumb:n,onThumbChange:l,onThumbPointerUp:c,onThumbPointerDown:o,onThumbPositionChange:m,onDragScroll:b,onWheelScroll:A,onResize:R,...M}=t,L=Gl(Bu,r),[G,V]=Z.useState(null),q=Bn(e,$e=>V($e)),J=Z.useRef(null),ie=Z.useRef(""),ee=L.viewport,me=i.content-i.viewport,Se=va(A),Me=va(m),Ve=_b(R,10);function Be($e){if(J.current){const at=$e.clientX-J.current.left,_t=$e.clientY-J.current.top;b({x:at,y:_t})}}return Z.useEffect(()=>{const $e=at=>{const _t=at.target;G?.contains(_t)&&Se(at,me)};return document.addEventListener("wheel",$e,{passive:!1}),()=>document.removeEventListener("wheel",$e,{passive:!1})},[ee,G,me,Se]),Z.useEffect(Me,[i,Me]),vg(G,Ve),vg(L.content,Ve),j.jsx(_pe,{scope:r,scrollbar:G,hasThumb:n,onThumbChange:va(l),onThumbPointerUp:va(c),onThumbPositionChange:Me,onThumbPointerDown:va(o),children:j.jsx(nn.div,{...M,ref:q,style:{position:"absolute",...M.style},onPointerDown:xi(t.onPointerDown,$e=>{$e.button===0&&($e.target.setPointerCapture($e.pointerId),J.current=G.getBoundingClientRect(),ie.current=document.body.style.webkitUserSelect,document.body.style.webkitUserSelect="none",L.viewport&&(L.viewport.style.scrollBehavior="auto"),Be($e))}),onPointerMove:xi(t.onPointerMove,Be),onPointerUp:xi(t.onPointerUp,$e=>{const at=$e.target;at.hasPointerCapture($e.pointerId)&&at.releasePointerCapture($e.pointerId),document.body.style.webkitUserSelect=ie.current,L.viewport&&(L.viewport.style.scrollBehavior=""),J.current=null})})})}),C1="ScrollAreaThumb",w6=Z.forwardRef((t,e)=>{const{forceMount:r,...i}=t,n=b6(C1,t.__scopeScrollArea);return j.jsx(Bh,{present:r||n.hasThumb,children:j.jsx(ype,{ref:e,...i})})}),ype=Z.forwardRef((t,e)=>{const{__scopeScrollArea:r,style:i,...n}=t,l=Gl(C1,r),c=b6(C1,r),{onThumbPositionChange:o}=c,m=Bn(e,R=>c.onThumbChange(R)),b=Z.useRef(void 0),A=_b(()=>{b.current&&(b.current(),b.current=void 0)},100);return Z.useEffect(()=>{const R=l.viewport;if(R){const M=()=>{if(A(),!b.current){const L=xpe(R,o);b.current=L,o()}};return o(),R.addEventListener("scroll",M),()=>R.removeEventListener("scroll",M)}},[l.viewport,A,o]),j.jsx(nn.div,{"data-state":c.hasThumb?"visible":"hidden",...n,ref:m,style:{width:"var(--radix-scroll-area-thumb-width)",height:"var(--radix-scroll-area-thumb-height)",...i},onPointerDownCapture:xi(t.onPointerDownCapture,R=>{const L=R.target.getBoundingClientRect(),G=R.clientX-L.left,V=R.clientY-L.top;c.onThumbPointerDown({x:G,y:V})}),onPointerUp:xi(t.onPointerUp,c.onThumbPointerUp)})});w6.displayName=C1;var $T="ScrollAreaCorner",E6=Z.forwardRef((t,e)=>{const r=Gl($T,t.__scopeScrollArea),i=!!(r.scrollbarX&&r.scrollbarY);return r.type!=="scroll"&&i?j.jsx(vpe,{...t,ref:e}):null});E6.displayName=$T;var vpe=Z.forwardRef((t,e)=>{const{__scopeScrollArea:r,...i}=t,n=Gl($T,r),[l,c]=Z.useState(0),[o,m]=Z.useState(0),b=!!(l&&o);return vg(n.scrollbarX,()=>{const A=n.scrollbarX?.offsetHeight||0;n.onCornerHeightChange(A),m(A)}),vg(n.scrollbarY,()=>{const A=n.scrollbarY?.offsetWidth||0;n.onCornerWidthChange(A),c(A)}),b?j.jsx(nn.div,{...i,ref:e,style:{width:l,height:o,position:"absolute",right:n.dir==="ltr"?0:void 0,left:n.dir==="rtl"?0:void 0,bottom:0,...t.style}}):null});function P1(t){return t?parseInt(t,10):0}function A6(t,e){const r=t/e;return isNaN(r)?0:r}function gb(t){const e=A6(t.viewport,t.content),r=t.scrollbar.paddingStart+t.scrollbar.paddingEnd,i=(t.scrollbar.size-r)*e;return Math.max(i,18)}function bpe(t,e,r,i="ltr"){const n=gb(r),l=n/2,c=e||l,o=n-c,m=r.scrollbar.paddingStart+c,b=r.scrollbar.size-r.scrollbar.paddingEnd-o,A=r.content-r.viewport,R=i==="ltr"?[0,A]:[A*-1,0];return T6([m,b],R)(t)}function mI(t,e,r="ltr"){const i=gb(e),n=e.scrollbar.paddingStart+e.scrollbar.paddingEnd,l=e.scrollbar.size-n,c=e.content-e.viewport,o=l-i,m=r==="ltr"?[0,c]:[c*-1,0],b=vA(t,m);return T6([0,c],[0,o])(b)}function T6(t,e){return r=>{if(t[0]===t[1]||e[0]===e[1])return e[0];const i=(e[1]-e[0])/(t[1]-t[0]);return e[0]+i*(r-t[0])}}function S6(t,e){return t>0&&t<e}var xpe=(t,e=()=>{})=>{let r={left:t.scrollLeft,top:t.scrollTop},i=0;return(function n(){const l={left:t.scrollLeft,top:t.scrollTop},c=r.left!==l.left,o=r.top!==l.top;(c||o)&&e(),r=l,i=window.requestAnimationFrame(n)})(),()=>window.cancelAnimationFrame(i)};function _b(t,e){const r=va(t),i=Z.useRef(0);return Z.useEffect(()=>()=>window.clearTimeout(i.current),[]),Z.useCallback(()=>{window.clearTimeout(i.current),i.current=window.setTimeout(r,e)},[r,e])}function vg(t,e){const r=va(e);Mu(()=>{let i=0;if(t){const n=new ResizeObserver(()=>{cancelAnimationFrame(i),i=window.requestAnimationFrame(r)});return n.observe(t),()=>{window.cancelAnimationFrame(i),n.unobserve(t)}}},[t,r])}var wpe=m6,Epe=_6,Ape=E6;function yb({className:t,children:e,...r}){return j.jsxs(wpe,{"data-slot":"scroll-area",className:Ri("relative",t),...r,children:[j.jsx(Epe,{"data-slot":"scroll-area-viewport",className:"focus-visible:ring-ring/50 size-full rounded-[inherit] transition-[color,box-shadow] outline-none focus-visible:ring-[3px] focus-visible:outline-1",children:e}),j.jsx(Tpe,{}),j.jsx(Ape,{})]})}function Tpe({className:t,orientation:e="vertical",...r}){return j.jsx(y6,{"data-slot":"scroll-area-scrollbar",orientation:e,className:Ri("flex touch-none p-px transition-colors select-none",e==="vertical"&&"h-full w-2.5 border-l border-l-transparent",e==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent",t),...r,children:j.jsx(w6,{"data-slot":"scroll-area-thumb",className:"bg-border relative flex-1 rounded-full"})})}function Spe({events:t,onEventSelect:e}){return j.jsx("div",{className:"h-full bg-background",children:j.jsxs("div",{className:"relative h-full flex flex-col",children:[j.jsx("div",{className:"sticky top-0 z-10 bg-card/80 backdrop-blur-xl border-b border-border p-4",children:j.jsxs("div",{className:"flex items-center gap-3",children:[j.jsxs("div",{className:"relative",children:[j.jsx(sg,{className:"h-7 w-7 text-primary"}),j.jsx(AE,{className:"h-3 w-3 text-primary absolute -top-1 -right-1"})]}),j.jsxs("div",{children:[j.jsx("h1",{className:"text-2xl text-foreground",children:"Social Feed"}),j.jsx("p",{className:"text-muted-foreground text-xs",children:"See what your friends are up to"})]})]})}),j.jsx(yb,{className:"flex-1",children:j.jsx("div",{className:"p-4 space-y-5",children:t.map(r=>j.jsxs("div",{onClick:()=>e(r),className:"group cursor-pointer",children:[j.jsxs("div",{className:"flex items-center gap-2 mb-3 px-1",children:[j.jsxs(EA,{className:"h-8 w-8 border-2 border-primary/30",children:[j.jsx(AA,{src:r.host.avatar,alt:r.host.name}),j.jsx(TA,{children:r.host.name[0]})]}),j.jsxs("div",{className:"text-sm",children:[j.jsx("span",{className:"text-foreground",children:r.host.name}),j.jsx("span",{className:"text-muted-foreground",children:" is hosting"})]})]}),j.jsxs("div",{className:"relative bg-card rounded-2xl overflow-hidden border border-border group-hover:border-primary/50 transition-all duration-300 group-hover:shadow-lg group-hover:shadow-primary/10",children:[j.jsxs("div",{className:"relative h-56 overflow-hidden",children:[j.jsx(Nd,{src:r.imageUrl,alt:r.title,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-500"}),j.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/80 via-black/20 to-transparent"}),j.jsx(Mh,{className:"absolute top-3 right-3 bg-primary text-primary-foreground border-0",children:r.mood}),j.jsxs("div",{className:"absolute bottom-0 left-0 right-0 p-4",children:[j.jsx("h3",{className:"text-white text-xl mb-1",children:r.title}),j.jsxs("div",{className:"flex items-center justify-between text-sm",children:[j.jsx("span",{className:"text-primary",children:r.startTime}),j.jsx("span",{className:"text-gray-300",children:r.location.name})]})]})]}),j.jsxs("div",{className:"p-4 flex items-center justify-between border-t border-border",children:[j.jsxs("div",{className:"flex items-center gap-4 text-muted-foreground text-sm",children:[j.jsxs("button",{className:"flex items-center gap-1.5 hover:text-primary transition-colors",children:[j.jsx(YF,{className:"h-4 w-4"}),j.jsx("span",{children:Math.floor(Math.random()*50)+10})]}),j.jsxs("button",{className:"flex items-center gap-1.5 hover:text-primary transition-colors",children:[j.jsx(c8,{className:"h-4 w-4"}),j.jsx("span",{children:Math.floor(Math.random()*20)+5})]}),j.jsxs("div",{className:"flex items-center gap-1.5",children:[j.jsx(sg,{className:"h-4 w-4"}),j.jsxs("span",{children:[r.attendees," going"]})]})]}),j.jsx("div",{className:"text-primary text-sm group-hover:text-primary/80 transition-colors",children:"View Details "})]})]})]},r.id))})})]})})}function Cpe({events:t}){const[e,r]=Z.useState("hosted"),{signOut:i}=jy(),n=t.slice(0,3),l=t.slice(3);return j.jsx("div",{className:"h-full bg-background",children:j.jsx(yb,{className:"h-full relative",children:j.jsxs("div",{className:"pb-20",children:[j.jsxs("div",{className:"p-4 border-b border-border bg-card/80 backdrop-blur-sm",children:[j.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[j.jsxs(EA,{className:"h-20 w-20 border-2 border-primary/30",children:[j.jsx(AA,{src:"https://images.unsplash.com/photo-1667382136327-5f78dc5cf835?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxpbmRpYW4lMjBtYW4lMjBwb3J0cmFpdHxlbnwxfHx8fDE3NjMzNzA5NzN8MA&ixlib=rb-4.1.0&q=80&w=1080",alt:"Profile"}),j.jsx(TA,{children:"AM"})]}),j.jsxs("div",{className:"flex-1 grid grid-cols-3 gap-2 text-center",children:[j.jsxs("div",{children:[j.jsx("div",{className:"text-foreground",children:n.length}),j.jsx("div",{className:"text-muted-foreground text-xs",children:"Hosted"})]}),j.jsxs("div",{children:[j.jsx("div",{className:"text-foreground",children:l.length}),j.jsx("div",{className:"text-muted-foreground text-xs",children:"Attended"})]}),j.jsxs("div",{children:[j.jsx("div",{className:"text-foreground",children:"156"}),j.jsx("div",{className:"text-muted-foreground text-xs",children:"Friends"})]})]})]}),j.jsxs("div",{className:"mb-3",children:[j.jsx("h1",{className:"text-foreground",children:"Arjun Malhotra"}),j.jsx("p",{className:"text-muted-foreground text-sm",children:"Event Curator  Delhi"}),j.jsxs("p",{className:"text-foreground text-sm mt-2",children:[" Creating unforgettable experiences in Delhi",j.jsx("br",{})," Hauz Khas | CP | Khan Market"]})]}),j.jsxs("div",{className:"flex gap-2",children:[j.jsxs(ao,{className:"flex-1 bg-primary hover:bg-primary/90 text-primary-foreground border-0",children:[j.jsx(m8,{className:"h-4 w-4 mr-2"}),"Edit Profile"]}),j.jsx(ao,{variant:"outline",className:"bg-card border-border text-foreground hover:bg-muted",children:j.jsx(UI,{className:"h-4 w-4"})}),j.jsx(ao,{variant:"outline",className:"bg-card border-border text-destructive hover:bg-destructive/10",onClick:()=>i(),children:j.jsx(i8,{className:"h-4 w-4"})})]})]}),j.jsxs("div",{className:"sticky top-0 z-10 bg-card/90 backdrop-blur-md border-b border-border grid grid-cols-2",children:[j.jsxs("button",{onClick:()=>r("hosted"),className:`flex items-center justify-center gap-2 py-3 transition-colors relative ${e==="hosted"?"text-foreground":"text-muted-foreground"}`,children:[j.jsx(ZF,{className:"h-4 w-4"}),j.jsx("span",{className:"text-sm",children:"Hosted"}),e==="hosted"&&j.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-primary"})]}),j.jsxs("button",{onClick:()=>r("attended"),className:`flex items-center justify-center gap-2 py-3 transition-colors relative ${e==="attended"?"text-foreground":"text-muted-foreground"}`,children:[j.jsx(L1,{className:"h-4 w-4"}),j.jsx("span",{className:"text-sm",children:"Attended"}),e==="attended"&&j.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-primary"})]})]}),j.jsxs("div",{className:"p-1",children:[e==="hosted"&&j.jsx("div",{className:"grid grid-cols-3 gap-1",children:n.map(c=>j.jsxs("div",{className:"aspect-square relative group cursor-pointer overflow-hidden",children:[j.jsx(Nd,{src:c.imageUrl,alt:c.title,className:"w-full h-full object-cover"}),j.jsx("div",{className:"absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center p-2",children:j.jsxs("div",{className:"text-white text-center",children:[j.jsx("div",{className:"text-xs mb-1",children:c.title}),j.jsxs("div",{className:"text-[10px] text-gray-300",children:[c.attendees," attendees"]})]})}),j.jsx("div",{className:"absolute top-2 right-2 w-2 h-2 rounded-full bg-primary"})]},c.id))}),e==="attended"&&j.jsx("div",{className:"grid grid-cols-3 gap-1",children:l.map(c=>j.jsxs("div",{className:"aspect-square relative group cursor-pointer overflow-hidden",children:[j.jsx(Nd,{src:c.imageUrl,alt:c.title,className:"w-full h-full object-cover"}),j.jsx("div",{className:"absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center p-2",children:j.jsxs("div",{className:"text-white text-center",children:[j.jsx("div",{className:"text-xs mb-1",children:c.title}),j.jsxs("div",{className:"text-[10px] text-gray-300",children:["by ",c.host.name]})]})}),j.jsx("div",{className:"absolute top-2 right-2 w-2 h-2 rounded-full bg-primary"})]},c.id))})]})]})})})}function Ppe({ticket:t,open:e,onClose:r}){const[i,n]=Z.useState(!1);if(!t)return null;const l=()=>{n(!0),setTimeout(()=>{n(!1),r()},2e3)};return j.jsx(RA,{open:e,onOpenChange:r,children:j.jsx(MA,{className:"bg-card border-border text-foreground max-w-md",children:i?j.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[j.jsx(FI,{className:"h-20 w-20 text-primary mb-4"}),j.jsx("h3",{className:"text-2xl mb-2 text-foreground",children:"Booking Confirmed!"}),j.jsxs("p",{className:"text-muted-foreground text-center",children:["Your ticket has been booked successfully.",j.jsx("br",{}),"Check your email for details."]})]}):j.jsxs(j.Fragment,{children:[j.jsxs(IA,{children:[j.jsx(kA,{className:"text-2xl text-foreground",children:t.title}),j.jsx(BA,{className:"text-muted-foreground",children:"Book your ticket for this event"})]}),j.jsxs("div",{className:"space-y-4 mt-4",children:[j.jsxs("div",{className:"relative h-40 rounded-lg overflow-hidden",children:[j.jsx(Nd,{src:t.imageUrl,alt:t.title,className:"w-full h-full object-cover"}),j.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/60 to-transparent"}),j.jsx("div",{className:"absolute bottom-3 left-3 text-white",children:j.jsx("div",{className:"text-sm text-gray-300",children:t.artist})})]}),j.jsxs("div",{className:"space-y-3 text-sm",children:[j.jsxs("div",{className:"flex items-center gap-3 text-muted-foreground",children:[j.jsx(L1,{className:"h-4 w-4 text-primary"}),j.jsx("span",{children:t.date})]}),j.jsxs("div",{className:"flex items-center gap-3 text-muted-foreground",children:[j.jsx(zI,{className:"h-4 w-4 text-primary"}),j.jsx("span",{children:t.time})]}),j.jsxs("div",{className:"flex items-center gap-3 text-muted-foreground",children:[j.jsx(Pp,{className:"h-4 w-4 text-primary"}),j.jsx("span",{children:t.venue})]}),j.jsxs("div",{className:"flex items-center gap-3 text-muted-foreground",children:[j.jsx(TE,{className:"h-4 w-4 text-primary"}),j.jsxs("span",{children:[t.availableSeats," seats available"]})]})]}),j.jsx("div",{className:"bg-primary/10 border border-primary/30 rounded-lg p-4",children:j.jsxs("div",{className:"flex justify-between items-center",children:[j.jsx("span",{className:"text-muted-foreground",children:"Ticket Price"}),j.jsxs("span",{className:"text-2xl text-foreground",children:["",t.price]})]})}),j.jsxs(ao,{onClick:l,className:"w-full bg-primary hover:bg-primary/90 text-primary-foreground py-6",children:[j.jsx($F,{className:"h-5 w-5 mr-2"}),"Book Ticket Now"]})]})]})})})}function Rpe({tickets:t}){const[e,r]=Z.useState("All"),[i,n]=Z.useState(null),[l,c]=Z.useState(!1),o=["All","Concert","Comedy","DJ Night","Festival"],m=e==="All"?t:t.filter(A=>A.category===e),b=A=>{n(A),c(!0)};return j.jsxs("div",{className:"h-full bg-background",children:[j.jsxs("div",{className:"relative h-full flex flex-col",children:[j.jsxs("div",{className:"sticky top-0 z-10 bg-card/80 backdrop-blur-xl border-b border-border p-4",children:[j.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[j.jsxs("div",{className:"relative",children:[j.jsx(TE,{className:"h-7 w-7 text-primary"}),j.jsx(AE,{className:"h-3 w-3 text-primary absolute -top-1 -right-1"})]}),j.jsx("h1",{className:"text-3xl text-foreground",children:"Live Events"})]}),j.jsx("div",{className:"flex gap-2 overflow-x-auto scrollbar-hide pb-1",children:o.map(A=>j.jsx(Mh,{variant:"outline",className:`cursor-pointer px-4 py-2 whitespace-nowrap transition-all duration-300 ${e===A?"bg-primary text-primary-foreground border-primary":"bg-card text-muted-foreground border-border hover:bg-muted"}`,onClick:()=>r(A),children:A},A))})]}),j.jsx(yb,{className:"flex-1",children:j.jsx("div",{className:"p-4 grid grid-cols-1 gap-5",children:m.map(A=>j.jsxs("div",{onClick:()=>b(A),className:"group relative bg-card border border-border rounded-2xl overflow-hidden cursor-pointer hover:scale-[1.02] transition-all duration-300 hover:shadow-xl hover:shadow-primary/10 hover:border-primary/50",children:[j.jsxs("div",{className:"relative h-52 overflow-hidden",children:[j.jsx(Nd,{src:A.imageUrl,alt:A.title,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-500"}),j.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black via-black/50 to-transparent opacity-80"}),j.jsx("div",{className:"absolute top-4 right-4 bg-primary px-3 py-1.5 rounded-full text-primary-foreground text-xs backdrop-blur-sm shadow-lg",children:A.category}),j.jsxs("div",{className:"absolute bottom-0 left-0 right-0 p-4",children:[j.jsx("h3",{className:"text-white text-xl mb-1",children:A.title}),j.jsx("p",{className:"text-primary text-sm",children:A.artist})]})]}),j.jsxs("div",{className:"p-4 space-y-3",children:[j.jsxs("div",{className:"flex items-center justify-between text-sm",children:[j.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[j.jsx(L1,{className:"h-4 w-4 text-primary"}),j.jsx("span",{children:A.date})]}),j.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[j.jsx(Pp,{className:"h-4 w-4 text-primary"}),j.jsx("span",{className:"text-xs truncate max-w-[120px]",children:A.venue})]})]}),j.jsxs("div",{className:"bg-primary/10 border border-primary/30 rounded-xl p-3 flex items-center justify-between",children:[j.jsxs("div",{children:[j.jsx("div",{className:"text-muted-foreground text-xs",children:"From"}),j.jsxs("div",{className:"text-foreground text-2xl",children:["",A.price]})]}),j.jsxs("div",{className:"text-right",children:[j.jsxs("div",{className:"text-primary text-xs",children:[A.availableSeats," left"]}),j.jsx("div",{className:"text-foreground text-sm",children:"Book Now "})]})]})]})]},A.id))})})]}),j.jsx(Ppe,{ticket:i,open:l,onClose:()=>c(!1)})]})}function Mpe({venue:t,open:e,onClose:r}){const[i,n]=Z.useState(!1);if(!t)return null;const l=()=>{n(!0),setTimeout(()=>{n(!1),r()},2e3)};return j.jsx(RA,{open:e,onOpenChange:r,children:j.jsx(MA,{className:"bg-card border-border text-foreground max-w-md max-h-[90vh] overflow-y-auto",children:i?j.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[j.jsx(FI,{className:"h-20 w-20 text-primary mb-4"}),j.jsx("h3",{className:"text-2xl mb-2 text-foreground",children:"Request Submitted!"}),j.jsxs("p",{className:"text-muted-foreground text-center",children:["Your booking request has been sent.",j.jsx("br",{}),"We'll contact you within 24 hours."]})]}):j.jsxs(j.Fragment,{children:[j.jsxs(IA,{children:[j.jsx(kA,{className:"text-2xl text-foreground",children:t.name}),j.jsx(BA,{className:"text-muted-foreground",children:"Request a booking for this venue"})]}),j.jsxs("div",{className:"space-y-4 mt-4",children:[j.jsxs("div",{className:"relative h-48 rounded-lg overflow-hidden",children:[j.jsx(Nd,{src:t.imageUrl,alt:t.name,className:"w-full h-full object-cover"}),j.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/60 to-transparent"}),j.jsxs(Mh,{className:"absolute top-3 right-3 bg-black/70 backdrop-blur-sm text-white border-primary/50",children:[j.jsx(GI,{className:"h-3 w-3 fill-primary text-primary mr-1"}),t.rating]}),j.jsx("div",{className:"absolute bottom-3 left-3 text-white",children:j.jsx("div",{className:"text-sm text-gray-300",children:t.category})})]}),j.jsxs("div",{className:"space-y-3",children:[j.jsxs("div",{className:"flex items-center gap-3 text-muted-foreground text-sm",children:[j.jsx(Pp,{className:"h-4 w-4 text-primary"}),j.jsx("span",{children:t.location})]}),j.jsxs("div",{className:"flex items-center gap-3 text-muted-foreground text-sm",children:[j.jsx(sg,{className:"h-4 w-4 text-primary"}),j.jsxs("span",{children:["Capacity: ",t.capacity," guests"]})]})]}),j.jsxs("div",{children:[j.jsx("h4",{className:"text-sm text-muted-foreground mb-2",children:"Amenities"}),j.jsx("div",{className:"flex flex-wrap gap-2",children:t.amenities.map((c,o)=>j.jsx(Mh,{variant:"outline",className:"bg-primary/10 text-primary border-primary/30",children:c},o))})]}),j.jsx("div",{className:"bg-primary/10 border border-primary/30 rounded-lg p-4",children:j.jsxs("div",{className:"flex justify-between items-center",children:[j.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[j.jsx(jI,{className:"h-4 w-4 text-primary"}),j.jsx("span",{className:"text-sm",children:"Per Hour"})]}),j.jsxs("span",{className:"text-2xl text-foreground",children:["",t.pricePerHour.toLocaleString()]})]})}),j.jsxs(ao,{onClick:l,className:"w-full bg-primary hover:bg-primary/90 text-primary-foreground py-6",children:[j.jsx(L1,{className:"h-5 w-5 mr-2"}),"Request Booking"]}),j.jsx("p",{className:"text-xs text-muted-foreground text-center",children:"Our team will contact you to confirm availability"})]})]})})})}const gI={"Banquet Hall":"",Rooftop:"",Restaurant:"",Garden:"","Conference Room":""};function Ipe({venues:t}){const[e,r]=Z.useState("All"),[i,n]=Z.useState(null),[l,c]=Z.useState(!1),o=["All","Banquet Hall","Rooftop","Restaurant","Garden","Conference Room"],m=e==="All"?t:t.filter(A=>A.category===e),b=A=>{n(A),c(!0)};return j.jsxs("div",{className:"h-full bg-background",children:[j.jsxs("div",{className:"relative h-full flex flex-col",children:[j.jsxs("div",{className:"sticky top-0 z-10 bg-card/80 backdrop-blur-xl border-b border-border p-4",children:[j.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[j.jsxs("div",{className:"relative",children:[j.jsx(DI,{className:"h-7 w-7 text-primary"}),j.jsx(AE,{className:"h-3 w-3 text-primary absolute -top-1 -right-1"})]}),j.jsx("h1",{className:"text-3xl text-foreground",children:"Premium Venues"})]}),j.jsx("div",{className:"flex gap-2 overflow-x-auto scrollbar-hide pb-1",children:o.map(A=>j.jsxs(Mh,{variant:"outline",className:`cursor-pointer px-3 py-2 whitespace-nowrap transition-all duration-300 ${e===A?"bg-primary text-primary-foreground border-primary":"bg-card text-muted-foreground border-border hover:bg-muted"}`,onClick:()=>r(A),children:[A!=="All"&&j.jsx("span",{className:"mr-1",children:gI[A]}),A]},A))})]}),j.jsx(yb,{className:"flex-1",children:j.jsx("div",{className:"p-4 grid grid-cols-1 gap-5",children:m.map(A=>j.jsxs("div",{onClick:()=>b(A),className:"group relative bg-card border border-border rounded-2xl overflow-hidden cursor-pointer hover:scale-[1.02] transition-all duration-300 hover:shadow-xl hover:shadow-primary/10 hover:border-primary/50",children:[j.jsxs("div",{className:"relative h-48 overflow-hidden",children:[j.jsx(Nd,{src:A.imageUrl,alt:A.name,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-500"}),j.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black via-black/40 to-transparent"}),j.jsx("div",{className:"absolute top-4 right-4 bg-black/60 backdrop-blur-md px-3 py-1.5 rounded-full border border-primary/50 shadow-lg",children:j.jsxs("div",{className:"flex items-center gap-1",children:[j.jsx(GI,{className:"h-4 w-4 fill-primary text-primary"}),j.jsx("span",{className:"text-white",children:A.rating})]})}),j.jsxs("div",{className:"absolute top-4 left-4 bg-primary px-3 py-1.5 rounded-full text-primary-foreground text-xs shadow-lg",children:[gI[A.category]," ",A.category]}),j.jsxs("div",{className:"absolute bottom-0 left-0 right-0 p-4",children:[j.jsx("h3",{className:"text-white text-xl",children:A.name}),j.jsxs("div",{className:"flex items-center gap-1.5 text-primary text-sm mt-1",children:[j.jsx(Pp,{className:"h-3.5 w-3.5"}),j.jsx("span",{children:A.location})]})]})]}),j.jsxs("div",{className:"p-4 space-y-3",children:[j.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[j.jsxs("div",{className:"bg-primary/10 border border-primary/20 rounded-lg p-3",children:[j.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[j.jsx(sg,{className:"h-4 w-4 text-primary"}),j.jsx("span",{className:"text-muted-foreground text-xs",children:"Capacity"})]}),j.jsx("div",{className:"text-foreground",children:A.capacity})]}),j.jsxs("div",{className:"bg-primary/10 border border-primary/20 rounded-lg p-3",children:[j.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[j.jsx(jI,{className:"h-4 w-4 text-primary"}),j.jsx("span",{className:"text-muted-foreground text-xs",children:"Per Hour"})]}),j.jsxs("div",{className:"text-foreground",children:["",A.pricePerHour.toLocaleString()]})]})]}),j.jsx("div",{className:"flex flex-wrap gap-1.5",children:A.amenities.map((R,M)=>j.jsx(Mh,{className:"bg-primary/10 text-primary border-primary/30 text-xs",children:R},M))}),j.jsx("div",{className:"bg-primary/10 border border-primary/30 rounded-lg p-3 text-center group-hover:bg-primary/20 transition-all",children:j.jsx("div",{className:"text-foreground",children:"View Details & Book "})})]})]},A.id))})})]}),j.jsx(Mpe,{venue:i,open:l,onClose:()=>c(!1)})]})}const j_=({children:t,className:e=""})=>j.jsx(U1.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3,ease:[.23,1,.32,1]},className:e,children:t}),C6=Z.createContext(void 0);function kpe({children:t}){const[e,r]=Z.useState("dark");Z.useEffect(()=>{const n=window.document.documentElement;n.classList.remove("light","dark"),n.classList.add(e)},[e]);const i=()=>{r(n=>n==="dark"?"light":"dark")};return j.jsx(C6.Provider,{value:{theme:e,toggleTheme:i},children:t})}function Bpe(){const t=Z.useContext(C6);if(t===void 0)throw new Error("useTheme must be used within a ThemeProvider");return t}function Lpe(){const[t,e]=Z.useState(""),[r,i]=Z.useState(""),[n,l]=Z.useState(!1),[c,o]=Z.useState(""),{signIn:m,signInWithGoogle:b}=jy(),A=I1(),R=async L=>{L.preventDefault(),l(!0),o("");const{error:G}=await m(t,r);G?(o(G.message),l(!1)):A("/")},M=async()=>{l(!0);const{error:L}=await b();L&&(o(L.message),l(!1))};return j.jsx("div",{className:"min-h-screen w-full flex items-center justify-center bg-background p-4",children:j.jsx(U1.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"w-full max-w-md",children:j.jsxs("div",{className:"bg-white/5 backdrop-blur-xl border border-white/10 rounded-2xl p-8 shadow-2xl",children:[j.jsxs("div",{className:"text-center mb-8",children:[j.jsx("h1",{className:"text-3xl font-bold text-gradient mb-2",children:"Welcome Back"}),j.jsx("p",{className:"text-muted-foreground",children:"Sign in to continue to Events"})]}),c&&j.jsx("div",{className:"mb-4 p-3 bg-destructive/10 border border-destructive/50 rounded-lg text-destructive text-sm",children:c}),j.jsxs("form",{onSubmit:R,className:"space-y-4 mb-4",children:[j.jsxs("div",{children:[j.jsx(xc,{htmlFor:"email",children:"Email"}),j.jsxs("div",{className:"relative",children:[j.jsx(VI,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),j.jsx(Tu,{id:"email",type:"email",placeholder:"you@example.com",value:t,onChange:L=>e(L.target.value),className:"pl-10",required:!0})]})]}),j.jsxs("div",{children:[j.jsx(xc,{htmlFor:"password",children:"Password"}),j.jsxs("div",{className:"relative",children:[j.jsx(Dw,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),j.jsx(Tu,{id:"password",type:"password",placeholder:"",value:r,onChange:L=>i(L.target.value),className:"pl-10",required:!0})]})]}),j.jsx(ao,{type:"submit",className:"w-full",disabled:n,children:n?j.jsxs(j.Fragment,{children:[j.jsx(O1,{className:"mr-2 h-4 w-4 animate-spin"}),"Signing in..."]}):"Sign In"})]}),j.jsxs("div",{className:"relative my-6",children:[j.jsx("div",{className:"absolute inset-0 flex items-center",children:j.jsx("div",{className:"w-full border-t border-white/10"})}),j.jsx("div",{className:"relative flex justify-center text-xs",children:j.jsx("span",{className:"bg-background px-2 text-muted-foreground",children:"OR"})})]}),j.jsxs(ao,{variant:"outline",className:"w-full",onClick:M,disabled:n,children:[j.jsx(NI,{className:"mr-2 h-4 w-4"}),"Continue with Google"]}),j.jsxs("p",{className:"mt-6 text-center text-sm text-muted-foreground",children:["Don't have an account?"," ",j.jsx(B1,{to:"/signup",className:"text-primary hover:underline font-medium",children:"Sign up"})]})]})})})}function Ope(){const[t,e]=Z.useState(""),[r,i]=Z.useState(""),[n,l]=Z.useState(""),[c,o]=Z.useState(""),[m,b]=Z.useState(!1),[A,R]=Z.useState(""),{signUp:M,signInWithGoogle:L}=jy(),G=I1(),V=async J=>{if(J.preventDefault(),n!==c){R("Passwords do not match");return}if(n.length<6){R("Password must be at least 6 characters");return}b(!0),R("");const{error:ie}=await M(r,n,t);ie?(R(ie.message),b(!1)):G("/")},q=async()=>{b(!0);const{error:J}=await L();J&&(R(J.message),b(!1))};return j.jsx("div",{className:"min-h-screen w-full flex items-center justify-center bg-background p-4",children:j.jsx(U1.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"w-full max-w-md",children:j.jsxs("div",{className:"bg-white/5 backdrop-blur-xl border border-white/10 rounded-2xl p-8 shadow-2xl",children:[j.jsxs("div",{className:"text-center mb-8",children:[j.jsx("h1",{className:"text-3xl font-bold text-gradient mb-2",children:"Create Account"}),j.jsx("p",{className:"text-muted-foreground",children:"Sign up to discover events"})]}),A&&j.jsx("div",{className:"mb-4 p-3 bg-destructive/10 border border-destructive/50 rounded-lg text-destructive text-sm",children:A}),j.jsxs("form",{onSubmit:V,className:"space-y-4 mb-4",children:[j.jsxs("div",{children:[j.jsx(xc,{htmlFor:"fullName",children:"Full Name"}),j.jsxs("div",{className:"relative",children:[j.jsx(HI,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),j.jsx(Tu,{id:"fullName",type:"text",placeholder:"John Doe",value:t,onChange:J=>e(J.target.value),className:"pl-10",required:!0})]})]}),j.jsxs("div",{children:[j.jsx(xc,{htmlFor:"email",children:"Email"}),j.jsxs("div",{className:"relative",children:[j.jsx(VI,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),j.jsx(Tu,{id:"email",type:"email",placeholder:"you@example.com",value:r,onChange:J=>i(J.target.value),className:"pl-10",required:!0})]})]}),j.jsxs("div",{children:[j.jsx(xc,{htmlFor:"password",children:"Password"}),j.jsxs("div",{className:"relative",children:[j.jsx(Dw,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),j.jsx(Tu,{id:"password",type:"password",placeholder:"",value:n,onChange:J=>l(J.target.value),className:"pl-10",required:!0})]})]}),j.jsxs("div",{children:[j.jsx(xc,{htmlFor:"confirmPassword",children:"Confirm Password"}),j.jsxs("div",{className:"relative",children:[j.jsx(Dw,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),j.jsx(Tu,{id:"confirmPassword",type:"password",placeholder:"",value:c,onChange:J=>o(J.target.value),className:"pl-10",required:!0})]})]}),j.jsx(ao,{type:"submit",className:"w-full",disabled:m,children:m?j.jsxs(j.Fragment,{children:[j.jsx(O1,{className:"mr-2 h-4 w-4 animate-spin"}),"Creating account..."]}):"Sign Up"})]}),j.jsxs("div",{className:"relative my-6",children:[j.jsx("div",{className:"absolute inset-0 flex items-center",children:j.jsx("div",{className:"w-full border-t border-white/10"})}),j.jsx("div",{className:"relative flex justify-center text-xs",children:j.jsx("span",{className:"bg-background px-2 text-muted-foreground",children:"OR"})})]}),j.jsxs(ao,{variant:"outline",className:"w-full",onClick:q,disabled:m,children:[j.jsx(NI,{className:"mr-2 h-4 w-4"}),"Continue with Google"]}),j.jsxs("p",{className:"mt-6 text-center text-sm text-muted-foreground",children:["Already have an account?"," ",j.jsx(B1,{to:"/login",className:"text-primary hover:underline font-medium",children:"Sign in"})]})]})})})}const _I=[{id:"1",title:"Rooftop Sunset Party",startTime:"6:30 PM",location:{lat:28.5355,lng:77.391,name:"Hauz Khas Village"},imageUrl:"https://images.unsplash.com/photo-1696863121919-cf7fa0331d31?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxoYXV6JTIwa2hhcyUyMGRlbGhpfGVufDF8fHx8MTc2MzQ2NDcxOXww&ixlib=rb-4.1.0&q=80&w=1080",host:{name:"Arjun Malhotra",avatar:"https://images.unsplash.com/photo-1667382136327-5f78dc5cf835?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxpbmRpYW4lMjBtYW4lMjBwb3J0cmFpdHxlbnwxfHx8fDE3NjMzNzA5NzN8MA&ixlib=rb-4.1.0&q=80&w=1080",instagram:"@arjunmalhotra"},attendees:24,mood:"Energetic",description:"Join us for an amazing rooftop party with live DJ and Delhi skyline views!"},{id:"2",title:"Coffee & Conversations",startTime:"10:00 AM",location:{lat:28.6315,lng:77.2167,name:"Khan Market"},imageUrl:"https://images.unsplash.com/photo-1549407978-23788293b970?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxjb2ZmZWUlMjBzaG9wJTIwY296eXxlbnwxfHx8fDE3NjMzNjcyNjF8MA&ixlib=rb-4.1.0&q=80&w=1080",host:{name:"Priya Sharma",avatar:"https://images.unsplash.com/photo-1691966929688-72d734848bcd?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxpbmRpYW4lMjB3b21hbiUyMHByb2ZpbGV8ZW58MXx8fHwxNzYzNDY0NzE4fDA&ixlib=rb-4.1.0&q=80&w=1080",instagram:"@priyasharma"},attendees:8,mood:"Chill",description:"Casual coffee meetup for entrepreneurs and creatives at Khan Market"},{id:"3",title:"Art Gallery Opening",startTime:"7:00 PM",location:{lat:28.6289,lng:77.2065,name:"Connaught Place"},imageUrl:"https://images.unsplash.com/photo-1722165923691-dc77d229a31a?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxjb25uYXVnaHQlMjBwbGFjZSUyMGRlbGhpfGVufDF8fHx8MTc2MzQ2NDcxOXww&ixlib=rb-4.1.0&q=80&w=1080",host:{name:"Kavya Reddy",avatar:"https://images.unsplash.com/photo-1691966929688-72d734848bcd?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxpbmRpYW4lMjB3b21hbiUyMHByb2ZpbGV8ZW58MXx8fHwxNzYzNDY0NzE4fDA&ixlib=rb-4.1.0&q=80&w=1080",instagram:"@kavyareddy"},attendees:32,mood:"Creative",description:"Contemporary art exhibition at CP with wine and light bites"},{id:"4",title:"Candlelit Dinner Experience",startTime:"8:00 PM",location:{lat:28.5244,lng:77.1855,name:"Garden of Five Senses"},imageUrl:"https://images.unsplash.com/photo-1760669348865-75d0e9733604?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxzdW5zZXQlMjBkaW5uZXIlMjByb21hbnRpY3xlbnwxfHx8fDE3NjM0MTI5MTB8MA&ixlib=rb-4.1.0&q=80&w=1080",host:{name:"Rohan Kapoor",avatar:"https://images.unsplash.com/photo-1667382136327-5f78dc5cf835?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxpbmRpYW4lMjBtYW4lMjBwb3J0cmFpdHxlbnwxfHx8fDE3NjMzNzA5NzN8MA&ixlib=rb-4.1.0&q=80&w=1080",instagram:"@rohankapoor"},attendees:12,mood:"Romantic",description:"Intimate dinner gathering with sunset views at Garden of Five Senses"},{id:"5",title:"India Gate Morning Yoga",startTime:"6:30 AM",location:{lat:28.6129,lng:77.2295,name:"India Gate"},imageUrl:"https://images.unsplash.com/photo-1688781298681-ae1f2d470b31?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxpbmRpYSUyMGdhdGUlMjBkZWxoaXxlbnwxfHx8fDE3NjM0NDY0MDd8MA&ixlib=rb-4.1.0&q=80&w=1080",host:{name:"Ananya Singh",avatar:"https://images.unsplash.com/photo-1691966929688-72d734848bcd?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxpbmRpYW4lMjB3b21hbiUyMHByb2ZpbGV8ZW58MXx8fHwxNzYzNDY0NzE4fDA&ixlib=rb-4.1.0&q=80&w=1080",instagram:"@ananyasingh"},attendees:28,mood:"Chill",description:"Start your day with meditation and yoga at India Gate lawns"},{id:"6",title:"Qutub Minar Heritage Walk",startTime:"5:00 PM",location:{lat:28.5244,lng:77.1855,name:"Qutub Minar"},imageUrl:"https://images.unsplash.com/photo-1667849521212-e9843b89f322?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxxdXR1YiUyMG1pbmFyJTIwZGVsaGl8ZW58MXx8fHwxNzYzNDYzNjcxfDA&ixlib=rb-4.1.0&q=80&w=1080",host:{name:"Vikram Mehta",avatar:"https://images.unsplash.com/photo-1667382136327-5f78dc5cf835?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxpbmRpYW4lMjBtYW4lMjBwb3J0cmFpdHxlbnwxfHx8fDE3NjMzNzA5NzN8MA&ixlib=rb-4.1.0&q=80&w=1080",instagram:"@vikrammehta"},attendees:16,mood:"Creative",description:"Explore Delhi's heritage with a guided walk around Qutub Minar complex"}],Dpe=[{id:"t1",title:"Neon Nights Festival",artist:"DJ Nucleya",date:"Nov 25, 2025",time:"8:00 PM",venue:"Jawaharlal Nehru Stadium",imageUrl:"https://images.unsplash.com/photo-1611939341783-a44f2cbd3bbd?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxjb25jZXJ0JTIwc3RhZ2UlMjBsaWdodHMlMjBwdXJwbGV8ZW58MXx8fHwxNzYzNDYzNjg5fDA&ixlib=rb-4.1.0&q=80&w=1080",price:1999,category:"Concert",availableSeats:450},{id:"t2",title:"Laugh Riot Comedy Night",artist:"Zakir Khan",date:"Nov 22, 2025",time:"7:30 PM",venue:"Kamani Auditorium",imageUrl:"https://images.unsplash.com/photo-1702351002798-6ccc7598494a?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxzdGFuZHVwJTIwY29tZWR5JTIwbWljcm9waG9uZXxlbnwxfHx8fDE3NjM0NjM2ODl8MA&ixlib=rb-4.1.0&q=80&w=1080",price:799,category:"Comedy",availableSeats:120},{id:"t3",title:"Bass Drop Night",artist:"KSHMR",date:"Nov 28, 2025",time:"9:00 PM",venue:"Warehouse Club, Aerocity",imageUrl:"https://images.unsplash.com/photo-1676969609758-b3bdfe8e0b53?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxkaiUyMHBhcnR5JTIwY2x1YiUyMG5lb258ZW58MXx8fHwxNzYzNDYzNjkwfDA&ixlib=rb-4.1.0&q=80&w=1080",price:1499,category:"DJ Night",availableSeats:300},{id:"t4",title:"Indie Music Fest",artist:"Various Artists",date:"Dec 01, 2025",time:"4:00 PM",venue:"Garden of Five Senses",imageUrl:"https://images.unsplash.com/photo-1524368535928-5b5e00ddc76b?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxtdXNpYyUyMGZlc3RpdmFsJTIwY3Jvd2R8ZW58MXx8fHwxNzYzMzU0OTg0fDA&ixlib=rb-4.1.0&q=80&w=1080",price:2499,category:"Festival",availableSeats:800},{id:"t5",title:"Stand Up Special",artist:"Biswa Kalyan Rath",date:"Nov 24, 2025",time:"8:00 PM",venue:"NCPA, CP",imageUrl:"https://images.unsplash.com/photo-1702351002798-6ccc7598494a?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxzdGFuZHVwJTIwY29tZWR5JTIwbWljcm9waG9uZXxlbnwxfHx8fDE3NjM0NjM2ODl8MA&ixlib=rb-4.1.0&q=80&w=1080",price:899,category:"Comedy",availableSeats:200},{id:"t6",title:"Electronic Sunset",artist:"Lost Stories",date:"Nov 30, 2025",time:"6:00 PM",venue:"Habitat Centre",imageUrl:"https://images.unsplash.com/photo-1611939341783-a44f2cbd3bbd?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxjb25jZXJ0JTIwc3RhZ2UlMjBsaWdodHMlMjBwdXJwbGV8ZW58MXx8fHwxNzYzNDYzNjg5fDA&ixlib=rb-4.1.0&q=80&w=1080",price:1299,category:"Concert",availableSeats:350}],Npe=[{id:"v1",name:"The Grand Ballroom",location:"Vasant Kunj",rating:4.8,imageUrl:"https://images.unsplash.com/photo-1761110787206-2cc164e4913c?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxldmVudCUyMHZlbnVlJTIwbHV4dXJ5JTIwaGFsbHxlbnwxfHx8fDE3NjM0NjM2OTF8MA&ixlib=rb-4.1.0&q=80&w=1080",capacity:"300-500",pricePerHour:15e3,amenities:["AC","Catering","Parking","AV Equipment"],category:"Banquet Hall"},{id:"v2",name:"Crystal Palace",location:"Chattarpur",rating:4.9,imageUrl:"https://images.unsplash.com/photo-1625619080917-7d6ff39e0675?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHx3ZWRkaW5nJTIwdmVudWUlMjBiYWxscm9vbXxlbnwxfHx8fDE3NjMzODkwMDZ8MA&ixlib=rb-4.1.0&q=80&w=1080",capacity:"400-600",pricePerHour:2e4,amenities:["Decor","Catering","Valet","DJ Setup"],category:"Banquet Hall"},{id:"v3",name:"Sky Lounge",location:"Aerocity",rating:4.7,imageUrl:"https://images.unsplash.com/photo-1738774801506-40bc473bda41?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxyb29mdG9wJTIwdmVudWUlMjB0ZXJyYWNlfGVufDF8fHx8MTc2MzQ2MzY5MXww&ixlib=rb-4.1.0&q=80&w=1080",capacity:"100-200",pricePerHour:12e3,amenities:["Open Air","Bar","City View","Music System"],category:"Rooftop"},{id:"v4",name:"Heritage Restaurant",location:"Hauz Khas",rating:4.6,imageUrl:"https://images.unsplash.com/photo-1759769583908-7cd4e3310ce6?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxyZXN0YXVyYW50JTIwdmVudWUlMjBkaW5pbmd8ZW58MXx8fHwxNzYzNDYzNjkyfDA&ixlib=rb-4.1.0&q=80&w=1080",capacity:"50-100",pricePerHour:8e3,amenities:["Private Dining","Chef","Wine Selection","Parking"],category:"Restaurant"},{id:"v5",name:"Garden Vista",location:"South Delhi",rating:4.8,imageUrl:"https://images.unsplash.com/photo-1761110787206-2cc164e4913c?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxldmVudCUyMHZlbnVlJTIwbHV4dXJ5JTIwaGFsbHxlbnwxfHx8fDE3NjM0NjM2OTF8MA&ixlib=rb-4.1.0&q=80&w=1080",capacity:"200-300",pricePerHour:1e4,amenities:["Garden","Lawn","Gazebo","Lighting"],category:"Garden"},{id:"v6",name:"Business Hub",location:"Connaught Place",rating:4.5,imageUrl:"https://images.unsplash.com/photo-1625619080917-7d6ff39e0675?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHx3ZWRkaW5nJTIwdmVudWUlMjBiYWxscm9vbXxlbnwxfHx8fDE3NjMzODkwMDZ8MA&ixlib=rb-4.1.0&q=80&w=1080",capacity:"30-50",pricePerHour:5e3,amenities:["Projector","WiFi","Coffee","Whiteboard"],category:"Conference Room"}];function Fpe(){const[t,e]=Z.useState(null),[r,i]=Z.useState(!1),{theme:n,toggleTheme:l}=Bpe(),c=m=>{e(m),i(!0)},o=()=>{i(!1),setTimeout(()=>e(null),300)};return j.jsxs("div",{className:"h-screen w-full max-w-lg mx-auto bg-background flex flex-col overflow-hidden",children:[j.jsx("div",{className:"absolute top-4 right-4 z-50",children:j.jsx(ao,{size:"icon",variant:"outline",onClick:l,className:"bg-card border-border hover:bg-accent",children:n==="dark"?j.jsx(E8,{className:"h-5 w-5 text-primary"}):j.jsx(h8,{className:"h-5 w-5 text-primary"})})}),j.jsxs(UV,{defaultValue:"map",className:"flex-1 flex flex-col h-full",children:[j.jsx("div",{className:"flex-1 overflow-hidden relative",children:j.jsxs(kz,{mode:"wait",children:[j.jsx(P_,{value:"social",className:"absolute inset-0 m-0",children:j.jsx(j_,{className:"h-full",children:j.jsx(Spe,{events:_I,onEventSelect:c})})}),j.jsx(P_,{value:"map",className:"absolute inset-0 m-0",children:j.jsx(j_,{className:"h-full",children:j.jsx(upe,{})})}),j.jsx(P_,{value:"tickets",className:"absolute inset-0 m-0",children:j.jsx(j_,{className:"h-full",children:j.jsx(Rpe,{tickets:Dpe})})}),j.jsx(P_,{value:"venues",className:"absolute inset-0 m-0",children:j.jsx(j_,{className:"h-full",children:j.jsx(Ipe,{venues:Npe})})}),j.jsx(P_,{value:"profile",className:"absolute inset-0 m-0",children:j.jsx(j_,{className:"h-full",children:j.jsx(Cpe,{events:_I})})})]})}),j.jsxs(VV,{className:"w-full h-20 bg-background/60 backdrop-blur-2xl border-t border-white/10 grid grid-cols-5 rounded-none p-2 shrink-0 shadow-[0_-4px_24px_rgba(0,0,0,0.3)]",children:[j.jsxs(C_,{value:"social",className:"flex-col gap-1 text-muted-foreground rounded-xl data-[state=active]:bg-primary data-[state=active]:text-primary-foreground data-[state=active]:shadow-[0_0_20px_rgba(120,119,198,0.5)] transition-all duration-300",children:[j.jsx(sg,{className:"h-5 w-5"}),j.jsx("span",{className:"text-[10px] font-medium",children:"Social"})]}),j.jsxs(C_,{value:"map",className:"flex-col gap-1 text-muted-foreground rounded-xl data-[state=active]:bg-primary data-[state=active]:text-primary-foreground data-[state=active]:shadow-[0_0_20px_rgba(120,119,198,0.5)] transition-all duration-300",children:[j.jsx(a8,{className:"h-5 w-5"}),j.jsx("span",{className:"text-[10px] font-medium",children:"Map"})]}),j.jsxs(C_,{value:"tickets",className:"flex-col gap-1 text-muted-foreground rounded-xl data-[state=active]:bg-primary data-[state=active]:text-primary-foreground data-[state=active]:shadow-[0_0_20px_rgba(120,119,198,0.5)] transition-all duration-300",children:[j.jsx(TE,{className:"h-5 w-5"}),j.jsx("span",{className:"text-[10px] font-medium",children:"Tickets"})]}),j.jsxs(C_,{value:"venues",className:"flex-col gap-1 text-muted-foreground rounded-xl data-[state=active]:bg-primary data-[state=active]:text-primary-foreground data-[state=active]:shadow-[0_0_20px_rgba(120,119,198,0.5)] transition-all duration-300",children:[j.jsx(DI,{className:"h-5 w-5"}),j.jsx("span",{className:"text-[10px] font-medium",children:"Venues"})]}),j.jsxs(C_,{value:"profile",className:"flex-col gap-1 text-muted-foreground rounded-xl data-[state=active]:bg-primary data-[state=active]:text-primary-foreground data-[state=active]:shadow-[0_0_20px_rgba(120,119,198,0.5)] transition-all duration-300",children:[j.jsx(HI,{className:"h-5 w-5"}),j.jsx("span",{className:"text-[10px] font-medium",children:"Profile"})]})]})]}),j.jsx(mB,{event:t,open:r,onClose:o})]})}function zpe({children:t}){const{user:e,loading:r}=jy();return r?j.jsx("div",{className:"h-screen w-full flex items-center justify-center bg-background",children:j.jsxs("div",{className:"text-center",children:[j.jsx("div",{className:"inline-block h-8 w-8 animate-spin rounded-full border-4 border-solid border-primary border-r-transparent"}),j.jsx("p",{className:"mt-4 text-muted-foreground",children:"Loading..."})]})}):e?j.jsx(j.Fragment,{children:t}):j.jsx(QN,{to:"/login",replace:!0})}function jpe(){return j.jsx(kpe,{children:j.jsx(Vq,{children:j.jsxs(tF,{children:[j.jsx(kv,{path:"/login",element:j.jsx(Lpe,{})}),j.jsx(kv,{path:"/signup",element:j.jsx(Ope,{})}),j.jsx(kv,{path:"/*",element:j.jsx(zpe,{children:j.jsx(Fpe,{})})})]})})})}cN.createRoot(document.getElementById("root")).render(j.jsx(AF,{basename:"/Events_App",children:j.jsx(jpe,{})}));
