function GB(t,e){for(var r=0;r<e.length;r++){const i=e[r];if(typeof i!="string"&&!Array.isArray(i)){for(const s in i)if(s!=="default"&&!(s in t)){const l=Object.getOwnPropertyDescriptor(i,s);l&&Object.defineProperty(t,s,l.get?l:{enumerable:!0,get:()=>i[s]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const l of s)if(l.type==="childList")for(const h of l.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&i(h)}).observe(document,{childList:!0,subtree:!0});function r(s){const l={};return s.integrity&&(l.integrity=s.integrity),s.referrerPolicy&&(l.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?l.credentials="include":s.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function i(s){if(s.ep)return;s.ep=!0;const l=r(s);fetch(s.href,l)}})();function mM(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var cv={exports:{}},Cg={},uv={exports:{}},jr={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var sA;function HB(){if(sA)return jr;sA=1;var t=Symbol.for("react.element"),e=Symbol.for("react.portal"),r=Symbol.for("react.fragment"),i=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),l=Symbol.for("react.provider"),h=Symbol.for("react.context"),a=Symbol.for("react.forward_ref"),v=Symbol.for("react.suspense"),T=Symbol.for("react.memo"),C=Symbol.for("react.lazy"),k=Symbol.iterator;function L(Ue){return Ue===null||typeof Ue!="object"?null:(Ue=k&&Ue[k]||Ue["@@iterator"],typeof Ue=="function"?Ue:null)}var O={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},K=Object.assign,$={};function ne(Ue,dt,Gt){this.props=Ue,this.context=dt,this.refs=$,this.updater=Gt||O}ne.prototype.isReactComponent={},ne.prototype.setState=function(Ue,dt){if(typeof Ue!="object"&&typeof Ue!="function"&&Ue!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,Ue,dt,"setState")},ne.prototype.forceUpdate=function(Ue){this.updater.enqueueForceUpdate(this,Ue,"forceUpdate")};function oe(){}oe.prototype=ne.prototype;function fe(Ue,dt,Gt){this.props=Ue,this.context=dt,this.refs=$,this.updater=Gt||O}var ue=fe.prototype=new oe;ue.constructor=fe,K(ue,ne.prototype),ue.isPureReactComponent=!0;var we=Array.isArray,De=Object.prototype.hasOwnProperty,Fe={current:null},Ke={key:!0,ref:!0,__self:!0,__source:!0};function ze(Ue,dt,Gt){var Jt,Tr={},gr=null,Ht=null;if(dt!=null)for(Jt in dt.ref!==void 0&&(Ht=dt.ref),dt.key!==void 0&&(gr=""+dt.key),dt)De.call(dt,Jt)&&!Ke.hasOwnProperty(Jt)&&(Tr[Jt]=dt[Jt]);var dr=arguments.length-2;if(dr===1)Tr.children=Gt;else if(1<dr){for(var er=Array(dr),Lr=0;Lr<dr;Lr++)er[Lr]=arguments[Lr+2];Tr.children=er}if(Ue&&Ue.defaultProps)for(Jt in dr=Ue.defaultProps,dr)Tr[Jt]===void 0&&(Tr[Jt]=dr[Jt]);return{$$typeof:t,type:Ue,key:gr,ref:Ht,props:Tr,_owner:Fe.current}}function it(Ue,dt){return{$$typeof:t,type:Ue.type,key:dt,ref:Ue.ref,props:Ue.props,_owner:Ue._owner}}function lt(Ue){return typeof Ue=="object"&&Ue!==null&&Ue.$$typeof===t}function ht(Ue){var dt={"=":"=0",":":"=2"};return"$"+Ue.replace(/[=:]/g,function(Gt){return dt[Gt]})}var vt=/\/+/g;function Nt(Ue,dt){return typeof Ue=="object"&&Ue!==null&&Ue.key!=null?ht(""+Ue.key):dt.toString(36)}function Lt(Ue,dt,Gt,Jt,Tr){var gr=typeof Ue;(gr==="undefined"||gr==="boolean")&&(Ue=null);var Ht=!1;if(Ue===null)Ht=!0;else switch(gr){case"string":case"number":Ht=!0;break;case"object":switch(Ue.$$typeof){case t:case e:Ht=!0}}if(Ht)return Ht=Ue,Tr=Tr(Ht),Ue=Jt===""?"."+Nt(Ht,0):Jt,we(Tr)?(Gt="",Ue!=null&&(Gt=Ue.replace(vt,"$&/")+"/"),Lt(Tr,dt,Gt,"",function(Lr){return Lr})):Tr!=null&&(lt(Tr)&&(Tr=it(Tr,Gt+(!Tr.key||Ht&&Ht.key===Tr.key?"":(""+Tr.key).replace(vt,"$&/")+"/")+Ue)),dt.push(Tr)),1;if(Ht=0,Jt=Jt===""?".":Jt+":",we(Ue))for(var dr=0;dr<Ue.length;dr++){gr=Ue[dr];var er=Jt+Nt(gr,dr);Ht+=Lt(gr,dt,Gt,er,Tr)}else if(er=L(Ue),typeof er=="function")for(Ue=er.call(Ue),dr=0;!(gr=Ue.next()).done;)gr=gr.value,er=Jt+Nt(gr,dr++),Ht+=Lt(gr,dt,Gt,er,Tr);else if(gr==="object")throw dt=String(Ue),Error("Objects are not valid as a React child (found: "+(dt==="[object Object]"?"object with keys {"+Object.keys(Ue).join(", ")+"}":dt)+"). If you meant to render a collection of children, use an array instead.");return Ht}function qt(Ue,dt,Gt){if(Ue==null)return Ue;var Jt=[],Tr=0;return Lt(Ue,Jt,"","",function(gr){return dt.call(Gt,gr,Tr++)}),Jt}function Qt(Ue){if(Ue._status===-1){var dt=Ue._result;dt=dt(),dt.then(function(Gt){(Ue._status===0||Ue._status===-1)&&(Ue._status=1,Ue._result=Gt)},function(Gt){(Ue._status===0||Ue._status===-1)&&(Ue._status=2,Ue._result=Gt)}),Ue._status===-1&&(Ue._status=0,Ue._result=dt)}if(Ue._status===1)return Ue._result.default;throw Ue._result}var Ot={current:null},tt={transition:null},wt={ReactCurrentDispatcher:Ot,ReactCurrentBatchConfig:tt,ReactCurrentOwner:Fe};function Bt(){throw Error("act(...) is not supported in production builds of React.")}return jr.Children={map:qt,forEach:function(Ue,dt,Gt){qt(Ue,function(){dt.apply(this,arguments)},Gt)},count:function(Ue){var dt=0;return qt(Ue,function(){dt++}),dt},toArray:function(Ue){return qt(Ue,function(dt){return dt})||[]},only:function(Ue){if(!lt(Ue))throw Error("React.Children.only expected to receive a single React element child.");return Ue}},jr.Component=ne,jr.Fragment=r,jr.Profiler=s,jr.PureComponent=fe,jr.StrictMode=i,jr.Suspense=v,jr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=wt,jr.act=Bt,jr.cloneElement=function(Ue,dt,Gt){if(Ue==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+Ue+".");var Jt=K({},Ue.props),Tr=Ue.key,gr=Ue.ref,Ht=Ue._owner;if(dt!=null){if(dt.ref!==void 0&&(gr=dt.ref,Ht=Fe.current),dt.key!==void 0&&(Tr=""+dt.key),Ue.type&&Ue.type.defaultProps)var dr=Ue.type.defaultProps;for(er in dt)De.call(dt,er)&&!Ke.hasOwnProperty(er)&&(Jt[er]=dt[er]===void 0&&dr!==void 0?dr[er]:dt[er])}var er=arguments.length-2;if(er===1)Jt.children=Gt;else if(1<er){dr=Array(er);for(var Lr=0;Lr<er;Lr++)dr[Lr]=arguments[Lr+2];Jt.children=dr}return{$$typeof:t,type:Ue.type,key:Tr,ref:gr,props:Jt,_owner:Ht}},jr.createContext=function(Ue){return Ue={$$typeof:h,_currentValue:Ue,_currentValue2:Ue,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},Ue.Provider={$$typeof:l,_context:Ue},Ue.Consumer=Ue},jr.createElement=ze,jr.createFactory=function(Ue){var dt=ze.bind(null,Ue);return dt.type=Ue,dt},jr.createRef=function(){return{current:null}},jr.forwardRef=function(Ue){return{$$typeof:a,render:Ue}},jr.isValidElement=lt,jr.lazy=function(Ue){return{$$typeof:C,_payload:{_status:-1,_result:Ue},_init:Qt}},jr.memo=function(Ue,dt){return{$$typeof:T,type:Ue,compare:dt===void 0?null:dt}},jr.startTransition=function(Ue){var dt=tt.transition;tt.transition={};try{Ue()}finally{tt.transition=dt}},jr.unstable_act=Bt,jr.useCallback=function(Ue,dt){return Ot.current.useCallback(Ue,dt)},jr.useContext=function(Ue){return Ot.current.useContext(Ue)},jr.useDebugValue=function(){},jr.useDeferredValue=function(Ue){return Ot.current.useDeferredValue(Ue)},jr.useEffect=function(Ue,dt){return Ot.current.useEffect(Ue,dt)},jr.useId=function(){return Ot.current.useId()},jr.useImperativeHandle=function(Ue,dt,Gt){return Ot.current.useImperativeHandle(Ue,dt,Gt)},jr.useInsertionEffect=function(Ue,dt){return Ot.current.useInsertionEffect(Ue,dt)},jr.useLayoutEffect=function(Ue,dt){return Ot.current.useLayoutEffect(Ue,dt)},jr.useMemo=function(Ue,dt){return Ot.current.useMemo(Ue,dt)},jr.useReducer=function(Ue,dt,Gt){return Ot.current.useReducer(Ue,dt,Gt)},jr.useRef=function(Ue){return Ot.current.useRef(Ue)},jr.useState=function(Ue){return Ot.current.useState(Ue)},jr.useSyncExternalStore=function(Ue,dt,Gt){return Ot.current.useSyncExternalStore(Ue,dt,Gt)},jr.useTransition=function(){return Ot.current.useTransition()},jr.version="18.3.1",jr}var oA;function o1(){return oA||(oA=1,uv.exports=HB()),uv.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var aA;function WB(){if(aA)return Cg;aA=1;var t=o1(),e=Symbol.for("react.element"),r=Symbol.for("react.fragment"),i=Object.prototype.hasOwnProperty,s=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function h(a,v,T){var C,k={},L=null,O=null;T!==void 0&&(L=""+T),v.key!==void 0&&(L=""+v.key),v.ref!==void 0&&(O=v.ref);for(C in v)i.call(v,C)&&!l.hasOwnProperty(C)&&(k[C]=v[C]);if(a&&a.defaultProps)for(C in v=a.defaultProps,v)k[C]===void 0&&(k[C]=v[C]);return{$$typeof:e,type:a,key:L,ref:O,props:k,_owner:s.current}}return Cg.Fragment=r,Cg.jsx=h,Cg.jsxs=h,Cg}var lA;function qB(){return lA||(lA=1,cv.exports=WB()),cv.exports}var H=qB(),Sy={},hv={exports:{}},ia={},dv={exports:{}},pv={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var cA;function $B(){return cA||(cA=1,(function(t){function e(tt,wt){var Bt=tt.length;tt.push(wt);e:for(;0<Bt;){var Ue=Bt-1>>>1,dt=tt[Ue];if(0<s(dt,wt))tt[Ue]=wt,tt[Bt]=dt,Bt=Ue;else break e}}function r(tt){return tt.length===0?null:tt[0]}function i(tt){if(tt.length===0)return null;var wt=tt[0],Bt=tt.pop();if(Bt!==wt){tt[0]=Bt;e:for(var Ue=0,dt=tt.length,Gt=dt>>>1;Ue<Gt;){var Jt=2*(Ue+1)-1,Tr=tt[Jt],gr=Jt+1,Ht=tt[gr];if(0>s(Tr,Bt))gr<dt&&0>s(Ht,Tr)?(tt[Ue]=Ht,tt[gr]=Bt,Ue=gr):(tt[Ue]=Tr,tt[Jt]=Bt,Ue=Jt);else if(gr<dt&&0>s(Ht,Bt))tt[Ue]=Ht,tt[gr]=Bt,Ue=gr;else break e}}return wt}function s(tt,wt){var Bt=tt.sortIndex-wt.sortIndex;return Bt!==0?Bt:tt.id-wt.id}if(typeof performance=="object"&&typeof performance.now=="function"){var l=performance;t.unstable_now=function(){return l.now()}}else{var h=Date,a=h.now();t.unstable_now=function(){return h.now()-a}}var v=[],T=[],C=1,k=null,L=3,O=!1,K=!1,$=!1,ne=typeof setTimeout=="function"?setTimeout:null,oe=typeof clearTimeout=="function"?clearTimeout:null,fe=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function ue(tt){for(var wt=r(T);wt!==null;){if(wt.callback===null)i(T);else if(wt.startTime<=tt)i(T),wt.sortIndex=wt.expirationTime,e(v,wt);else break;wt=r(T)}}function we(tt){if($=!1,ue(tt),!K)if(r(v)!==null)K=!0,Qt(De);else{var wt=r(T);wt!==null&&Ot(we,wt.startTime-tt)}}function De(tt,wt){K=!1,$&&($=!1,oe(ze),ze=-1),O=!0;var Bt=L;try{for(ue(wt),k=r(v);k!==null&&(!(k.expirationTime>wt)||tt&&!ht());){var Ue=k.callback;if(typeof Ue=="function"){k.callback=null,L=k.priorityLevel;var dt=Ue(k.expirationTime<=wt);wt=t.unstable_now(),typeof dt=="function"?k.callback=dt:k===r(v)&&i(v),ue(wt)}else i(v);k=r(v)}if(k!==null)var Gt=!0;else{var Jt=r(T);Jt!==null&&Ot(we,Jt.startTime-wt),Gt=!1}return Gt}finally{k=null,L=Bt,O=!1}}var Fe=!1,Ke=null,ze=-1,it=5,lt=-1;function ht(){return!(t.unstable_now()-lt<it)}function vt(){if(Ke!==null){var tt=t.unstable_now();lt=tt;var wt=!0;try{wt=Ke(!0,tt)}finally{wt?Nt():(Fe=!1,Ke=null)}}else Fe=!1}var Nt;if(typeof fe=="function")Nt=function(){fe(vt)};else if(typeof MessageChannel<"u"){var Lt=new MessageChannel,qt=Lt.port2;Lt.port1.onmessage=vt,Nt=function(){qt.postMessage(null)}}else Nt=function(){ne(vt,0)};function Qt(tt){Ke=tt,Fe||(Fe=!0,Nt())}function Ot(tt,wt){ze=ne(function(){tt(t.unstable_now())},wt)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(tt){tt.callback=null},t.unstable_continueExecution=function(){K||O||(K=!0,Qt(De))},t.unstable_forceFrameRate=function(tt){0>tt||125<tt?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):it=0<tt?Math.floor(1e3/tt):5},t.unstable_getCurrentPriorityLevel=function(){return L},t.unstable_getFirstCallbackNode=function(){return r(v)},t.unstable_next=function(tt){switch(L){case 1:case 2:case 3:var wt=3;break;default:wt=L}var Bt=L;L=wt;try{return tt()}finally{L=Bt}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(tt,wt){switch(tt){case 1:case 2:case 3:case 4:case 5:break;default:tt=3}var Bt=L;L=tt;try{return wt()}finally{L=Bt}},t.unstable_scheduleCallback=function(tt,wt,Bt){var Ue=t.unstable_now();switch(typeof Bt=="object"&&Bt!==null?(Bt=Bt.delay,Bt=typeof Bt=="number"&&0<Bt?Ue+Bt:Ue):Bt=Ue,tt){case 1:var dt=-1;break;case 2:dt=250;break;case 5:dt=1073741823;break;case 4:dt=1e4;break;default:dt=5e3}return dt=Bt+dt,tt={id:C++,callback:wt,priorityLevel:tt,startTime:Bt,expirationTime:dt,sortIndex:-1},Bt>Ue?(tt.sortIndex=Bt,e(T,tt),r(v)===null&&tt===r(T)&&($?(oe(ze),ze=-1):$=!0,Ot(we,Bt-Ue))):(tt.sortIndex=dt,e(v,tt),K||O||(K=!0,Qt(De))),tt},t.unstable_shouldYield=ht,t.unstable_wrapCallback=function(tt){var wt=L;return function(){var Bt=L;L=wt;try{return tt.apply(this,arguments)}finally{L=Bt}}}})(pv)),pv}var uA;function ZB(){return uA||(uA=1,dv.exports=$B()),dv.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hA;function XB(){if(hA)return ia;hA=1;var t=o1(),e=ZB();function r(p){for(var g="https://reactjs.org/docs/error-decoder.html?invariant="+p,A=1;A<arguments.length;A++)g+="&args[]="+encodeURIComponent(arguments[A]);return"Minified React error #"+p+"; visit "+g+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var i=new Set,s={};function l(p,g){h(p,g),h(p+"Capture",g)}function h(p,g){for(s[p]=g,p=0;p<g.length;p++)i.add(g[p])}var a=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),v=Object.prototype.hasOwnProperty,T=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,C={},k={};function L(p){return v.call(k,p)?!0:v.call(C,p)?!1:T.test(p)?k[p]=!0:(C[p]=!0,!1)}function O(p,g,A,P){if(A!==null&&A.type===0)return!1;switch(typeof g){case"function":case"symbol":return!0;case"boolean":return P?!1:A!==null?!A.acceptsBooleans:(p=p.toLowerCase().slice(0,5),p!=="data-"&&p!=="aria-");default:return!1}}function K(p,g,A,P){if(g===null||typeof g>"u"||O(p,g,A,P))return!0;if(P)return!1;if(A!==null)switch(A.type){case 3:return!g;case 4:return g===!1;case 5:return isNaN(g);case 6:return isNaN(g)||1>g}return!1}function $(p,g,A,P,N,j,se){this.acceptsBooleans=g===2||g===3||g===4,this.attributeName=P,this.attributeNamespace=N,this.mustUseProperty=A,this.propertyName=p,this.type=g,this.sanitizeURL=j,this.removeEmptyString=se}var ne={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(p){ne[p]=new $(p,0,!1,p,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(p){var g=p[0];ne[g]=new $(g,1,!1,p[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(p){ne[p]=new $(p,2,!1,p.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(p){ne[p]=new $(p,2,!1,p,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(p){ne[p]=new $(p,3,!1,p.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(p){ne[p]=new $(p,3,!0,p,null,!1,!1)}),["capture","download"].forEach(function(p){ne[p]=new $(p,4,!1,p,null,!1,!1)}),["cols","rows","size","span"].forEach(function(p){ne[p]=new $(p,6,!1,p,null,!1,!1)}),["rowSpan","start"].forEach(function(p){ne[p]=new $(p,5,!1,p.toLowerCase(),null,!1,!1)});var oe=/[\-:]([a-z])/g;function fe(p){return p[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(p){var g=p.replace(oe,fe);ne[g]=new $(g,1,!1,p,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(p){var g=p.replace(oe,fe);ne[g]=new $(g,1,!1,p,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(p){var g=p.replace(oe,fe);ne[g]=new $(g,1,!1,p,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(p){ne[p]=new $(p,1,!1,p.toLowerCase(),null,!1,!1)}),ne.xlinkHref=new $("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(p){ne[p]=new $(p,1,!1,p.toLowerCase(),null,!0,!0)});function ue(p,g,A,P){var N=ne.hasOwnProperty(g)?ne[g]:null;(N!==null?N.type!==0:P||!(2<g.length)||g[0]!=="o"&&g[0]!=="O"||g[1]!=="n"&&g[1]!=="N")&&(K(g,A,N,P)&&(A=null),P||N===null?L(g)&&(A===null?p.removeAttribute(g):p.setAttribute(g,""+A)):N.mustUseProperty?p[N.propertyName]=A===null?N.type===3?!1:"":A:(g=N.attributeName,P=N.attributeNamespace,A===null?p.removeAttribute(g):(N=N.type,A=N===3||N===4&&A===!0?"":""+A,P?p.setAttributeNS(P,g,A):p.setAttribute(g,A))))}var we=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,De=Symbol.for("react.element"),Fe=Symbol.for("react.portal"),Ke=Symbol.for("react.fragment"),ze=Symbol.for("react.strict_mode"),it=Symbol.for("react.profiler"),lt=Symbol.for("react.provider"),ht=Symbol.for("react.context"),vt=Symbol.for("react.forward_ref"),Nt=Symbol.for("react.suspense"),Lt=Symbol.for("react.suspense_list"),qt=Symbol.for("react.memo"),Qt=Symbol.for("react.lazy"),Ot=Symbol.for("react.offscreen"),tt=Symbol.iterator;function wt(p){return p===null||typeof p!="object"?null:(p=tt&&p[tt]||p["@@iterator"],typeof p=="function"?p:null)}var Bt=Object.assign,Ue;function dt(p){if(Ue===void 0)try{throw Error()}catch(A){var g=A.stack.trim().match(/\n( *(at )?)/);Ue=g&&g[1]||""}return`
`+Ue+p}var Gt=!1;function Jt(p,g){if(!p||Gt)return"";Gt=!0;var A=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(g)if(g=function(){throw Error()},Object.defineProperty(g.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(g,[])}catch(ot){var P=ot}Reflect.construct(p,[],g)}else{try{g.call()}catch(ot){P=ot}p.call(g.prototype)}else{try{throw Error()}catch(ot){P=ot}p()}}catch(ot){if(ot&&P&&typeof ot.stack=="string"){for(var N=ot.stack.split(`
`),j=P.stack.split(`
`),se=N.length-1,Ae=j.length-1;1<=se&&0<=Ae&&N[se]!==j[Ae];)Ae--;for(;1<=se&&0<=Ae;se--,Ae--)if(N[se]!==j[Ae]){if(se!==1||Ae!==1)do if(se--,Ae--,0>Ae||N[se]!==j[Ae]){var Ie=`
`+N[se].replace(" at new "," at ");return p.displayName&&Ie.includes("<anonymous>")&&(Ie=Ie.replace("<anonymous>",p.displayName)),Ie}while(1<=se&&0<=Ae);break}}}finally{Gt=!1,Error.prepareStackTrace=A}return(p=p?p.displayName||p.name:"")?dt(p):""}function Tr(p){switch(p.tag){case 5:return dt(p.type);case 16:return dt("Lazy");case 13:return dt("Suspense");case 19:return dt("SuspenseList");case 0:case 2:case 15:return p=Jt(p.type,!1),p;case 11:return p=Jt(p.type.render,!1),p;case 1:return p=Jt(p.type,!0),p;default:return""}}function gr(p){if(p==null)return null;if(typeof p=="function")return p.displayName||p.name||null;if(typeof p=="string")return p;switch(p){case Ke:return"Fragment";case Fe:return"Portal";case it:return"Profiler";case ze:return"StrictMode";case Nt:return"Suspense";case Lt:return"SuspenseList"}if(typeof p=="object")switch(p.$$typeof){case ht:return(p.displayName||"Context")+".Consumer";case lt:return(p._context.displayName||"Context")+".Provider";case vt:var g=p.render;return p=p.displayName,p||(p=g.displayName||g.name||"",p=p!==""?"ForwardRef("+p+")":"ForwardRef"),p;case qt:return g=p.displayName||null,g!==null?g:gr(p.type)||"Memo";case Qt:g=p._payload,p=p._init;try{return gr(p(g))}catch{}}return null}function Ht(p){var g=p.type;switch(p.tag){case 24:return"Cache";case 9:return(g.displayName||"Context")+".Consumer";case 10:return(g._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return p=g.render,p=p.displayName||p.name||"",g.displayName||(p!==""?"ForwardRef("+p+")":"ForwardRef");case 7:return"Fragment";case 5:return g;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return gr(g);case 8:return g===ze?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof g=="function")return g.displayName||g.name||null;if(typeof g=="string")return g}return null}function dr(p){switch(typeof p){case"boolean":case"number":case"string":case"undefined":return p;case"object":return p;default:return""}}function er(p){var g=p.type;return(p=p.nodeName)&&p.toLowerCase()==="input"&&(g==="checkbox"||g==="radio")}function Lr(p){var g=er(p)?"checked":"value",A=Object.getOwnPropertyDescriptor(p.constructor.prototype,g),P=""+p[g];if(!p.hasOwnProperty(g)&&typeof A<"u"&&typeof A.get=="function"&&typeof A.set=="function"){var N=A.get,j=A.set;return Object.defineProperty(p,g,{configurable:!0,get:function(){return N.call(this)},set:function(se){P=""+se,j.call(this,se)}}),Object.defineProperty(p,g,{enumerable:A.enumerable}),{getValue:function(){return P},setValue:function(se){P=""+se},stopTracking:function(){p._valueTracker=null,delete p[g]}}}}function yn(p){p._valueTracker||(p._valueTracker=Lr(p))}function yi(p){if(!p)return!1;var g=p._valueTracker;if(!g)return!0;var A=g.getValue(),P="";return p&&(P=er(p)?p.checked?"true":"false":p.value),p=P,p!==A?(g.setValue(p),!0):!1}function qr(p){if(p=p||(typeof document<"u"?document:void 0),typeof p>"u")return null;try{return p.activeElement||p.body}catch{return p.body}}function ri(p,g){var A=g.checked;return Bt({},g,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:A??p._wrapperState.initialChecked})}function vn(p,g){var A=g.defaultValue==null?"":g.defaultValue,P=g.checked!=null?g.checked:g.defaultChecked;A=dr(g.value!=null?g.value:A),p._wrapperState={initialChecked:P,initialValue:A,controlled:g.type==="checkbox"||g.type==="radio"?g.checked!=null:g.value!=null}}function Li(p,g){g=g.checked,g!=null&&ue(p,"checked",g,!1)}function Mn(p,g){Li(p,g);var A=dr(g.value),P=g.type;if(A!=null)P==="number"?(A===0&&p.value===""||p.value!=A)&&(p.value=""+A):p.value!==""+A&&(p.value=""+A);else if(P==="submit"||P==="reset"){p.removeAttribute("value");return}g.hasOwnProperty("value")?Yn(p,g.type,A):g.hasOwnProperty("defaultValue")&&Yn(p,g.type,dr(g.defaultValue)),g.checked==null&&g.defaultChecked!=null&&(p.defaultChecked=!!g.defaultChecked)}function bs(p,g,A){if(g.hasOwnProperty("value")||g.hasOwnProperty("defaultValue")){var P=g.type;if(!(P!=="submit"&&P!=="reset"||g.value!==void 0&&g.value!==null))return;g=""+p._wrapperState.initialValue,A||g===p.value||(p.value=g),p.defaultValue=g}A=p.name,A!==""&&(p.name=""),p.defaultChecked=!!p._wrapperState.initialChecked,A!==""&&(p.name=A)}function Yn(p,g,A){(g!=="number"||qr(p.ownerDocument)!==p)&&(A==null?p.defaultValue=""+p._wrapperState.initialValue:p.defaultValue!==""+A&&(p.defaultValue=""+A))}var Jn=Array.isArray;function mi(p,g,A,P){if(p=p.options,g){g={};for(var N=0;N<A.length;N++)g["$"+A[N]]=!0;for(A=0;A<p.length;A++)N=g.hasOwnProperty("$"+p[A].value),p[A].selected!==N&&(p[A].selected=N),N&&P&&(p[A].defaultSelected=!0)}else{for(A=""+dr(A),g=null,N=0;N<p.length;N++){if(p[N].value===A){p[N].selected=!0,P&&(p[N].defaultSelected=!0);return}g!==null||p[N].disabled||(g=p[N])}g!==null&&(g.selected=!0)}}function Js(p,g){if(g.dangerouslySetInnerHTML!=null)throw Error(r(91));return Bt({},g,{value:void 0,defaultValue:void 0,children:""+p._wrapperState.initialValue})}function _o(p,g){var A=g.value;if(A==null){if(A=g.children,g=g.defaultValue,A!=null){if(g!=null)throw Error(r(92));if(Jn(A)){if(1<A.length)throw Error(r(93));A=A[0]}g=A}g==null&&(g=""),A=g}p._wrapperState={initialValue:dr(A)}}function Go(p,g){var A=dr(g.value),P=dr(g.defaultValue);A!=null&&(A=""+A,A!==p.value&&(p.value=A),g.defaultValue==null&&p.defaultValue!==A&&(p.defaultValue=A)),P!=null&&(p.defaultValue=""+P)}function yo(p){var g=p.textContent;g===p._wrapperState.initialValue&&g!==""&&g!==null&&(p.value=g)}function vo(p){switch(p){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Ds(p,g){return p==null||p==="http://www.w3.org/1999/xhtml"?vo(g):p==="http://www.w3.org/2000/svg"&&g==="foreignObject"?"http://www.w3.org/1999/xhtml":p}var Qs,ke=(function(p){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(g,A,P,N){MSApp.execUnsafeLocalFunction(function(){return p(g,A,P,N)})}:p})(function(p,g){if(p.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in p)p.innerHTML=g;else{for(Qs=Qs||document.createElement("div"),Qs.innerHTML="<svg>"+g.valueOf().toString()+"</svg>",g=Qs.firstChild;p.firstChild;)p.removeChild(p.firstChild);for(;g.firstChild;)p.appendChild(g.firstChild)}});function Q(p,g){if(g){var A=p.firstChild;if(A&&A===p.lastChild&&A.nodeType===3){A.nodeValue=g;return}}p.textContent=g}var ee={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},ae=["Webkit","ms","Moz","O"];Object.keys(ee).forEach(function(p){ae.forEach(function(g){g=g+p.charAt(0).toUpperCase()+p.substring(1),ee[g]=ee[p]})});function be(p,g,A){return g==null||typeof g=="boolean"||g===""?"":A||typeof g!="number"||g===0||ee.hasOwnProperty(p)&&ee[p]?(""+g).trim():g+"px"}function Se(p,g){p=p.style;for(var A in g)if(g.hasOwnProperty(A)){var P=A.indexOf("--")===0,N=be(A,g[A],P);A==="float"&&(A="cssFloat"),P?p.setProperty(A,N):p[A]=N}}var Oe=Bt({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Ze(p,g){if(g){if(Oe[p]&&(g.children!=null||g.dangerouslySetInnerHTML!=null))throw Error(r(137,p));if(g.dangerouslySetInnerHTML!=null){if(g.children!=null)throw Error(r(60));if(typeof g.dangerouslySetInnerHTML!="object"||!("__html"in g.dangerouslySetInnerHTML))throw Error(r(61))}if(g.style!=null&&typeof g.style!="object")throw Error(r(62))}}function Be(p,g){if(p.indexOf("-")===-1)return typeof g.is=="string";switch(p){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var nt=null;function pt(p){return p=p.target||p.srcElement||window,p.correspondingUseElement&&(p=p.correspondingUseElement),p.nodeType===3?p.parentNode:p}var at=null,Ft=null,Le=null;function or(p){if(p=Nc(p)){if(typeof at!="function")throw Error(r(280));var g=p.stateNode;g&&(g=ku(g),at(p.stateNode,p.type,g))}}function Sr(p){Ft?Le?Le.push(p):Le=[p]:Ft=p}function Wt(){if(Ft){var p=Ft,g=Le;if(Le=Ft=null,or(p),g)for(p=0;p<g.length;p++)or(g[p])}}function _r(p,g){return p(g)}function $r(){}var Si=!1;function Di(p,g,A){if(Si)return p(g,A);Si=!0;try{return _r(p,g,A)}finally{Si=!1,(Ft!==null||Le!==null)&&($r(),Wt())}}function ui(p,g){var A=p.stateNode;if(A===null)return null;var P=ku(A);if(P===null)return null;A=P[g];e:switch(g){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(P=!P.disabled)||(p=p.type,P=!(p==="button"||p==="input"||p==="select"||p==="textarea")),p=!P;break e;default:p=!1}if(p)return null;if(A&&typeof A!="function")throw Error(r(231,g,typeof A));return A}var Er=!1;if(a)try{var Pr={};Object.defineProperty(Pr,"passive",{get:function(){Er=!0}}),window.addEventListener("test",Pr,Pr),window.removeEventListener("test",Pr,Pr)}catch{Er=!1}function Ni(p,g,A,P,N,j,se,Ae,Ie){var ot=Array.prototype.slice.call(arguments,3);try{g.apply(A,ot)}catch(xt){this.onError(xt)}}var _t=!1,Ci=null,si=!1,Ns=null,Ha={onError:function(p){_t=!0,Ci=p}};function Tt(p,g,A,P,N,j,se,Ae,Ie){_t=!1,Ci=null,Ni.apply(Ha,arguments)}function Cr(p,g,A,P,N,j,se,Ae,Ie){if(Tt.apply(this,arguments),_t){if(_t){var ot=Ci;_t=!1,Ci=null}else throw Error(r(198));si||(si=!0,Ns=ot)}}function cr(p){var g=p,A=p;if(p.alternate)for(;g.return;)g=g.return;else{p=g;do g=p,(g.flags&4098)!==0&&(A=g.return),p=g.return;while(p)}return g.tag===3?A:null}function Hi(p){if(p.tag===13){var g=p.memoizedState;if(g===null&&(p=p.alternate,p!==null&&(g=p.memoizedState)),g!==null)return g.dehydrated}return null}function eo(p){if(cr(p)!==p)throw Error(r(188))}function Un(p){var g=p.alternate;if(!g){if(g=cr(p),g===null)throw Error(r(188));return g!==p?null:p}for(var A=p,P=g;;){var N=A.return;if(N===null)break;var j=N.alternate;if(j===null){if(P=N.return,P!==null){A=P;continue}break}if(N.child===j.child){for(j=N.child;j;){if(j===A)return eo(N),p;if(j===P)return eo(N),g;j=j.sibling}throw Error(r(188))}if(A.return!==P.return)A=N,P=j;else{for(var se=!1,Ae=N.child;Ae;){if(Ae===A){se=!0,A=N,P=j;break}if(Ae===P){se=!0,P=N,A=j;break}Ae=Ae.sibling}if(!se){for(Ae=j.child;Ae;){if(Ae===A){se=!0,A=j,P=N;break}if(Ae===P){se=!0,P=j,A=N;break}Ae=Ae.sibling}if(!se)throw Error(r(189))}}if(A.alternate!==P)throw Error(r(190))}if(A.tag!==3)throw Error(r(188));return A.stateNode.current===A?p:g}function hr(p){return p=Un(p),p!==null?bo(p):null}function bo(p){if(p.tag===5||p.tag===6)return p;for(p=p.child;p!==null;){var g=bo(p);if(g!==null)return g;p=p.sibling}return null}var xs=e.unstable_scheduleCallback,ha=e.unstable_cancelCallback,to=e.unstable_shouldYield,Wa=e.unstable_requestPaint,br=e.unstable_now,Pn=e.unstable_getCurrentPriorityLevel,Mi=e.unstable_ImmediatePriority,Dr=e.unstable_UserBlockingPriority,Qn=e.unstable_NormalPriority,xo=e.unstable_LowPriority,es=e.unstable_IdlePriority,Wi=null,en=null;function fc(p){if(en&&typeof en.onCommitFiberRoot=="function")try{en.onCommitFiberRoot(Wi,p,void 0,(p.current.flags&128)===128)}catch{}}var Rn=Math.clz32?Math.clz32:mc,ws=Math.log,wo=Math.LN2;function mc(p){return p>>>=0,p===0?32:31-(ws(p)/wo|0)|0}var qa=64,$a=4194304;function da(p){switch(p&-p){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return p&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return p&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return p}}function Eo(p,g){var A=p.pendingLanes;if(A===0)return 0;var P=0,N=p.suspendedLanes,j=p.pingedLanes,se=A&268435455;if(se!==0){var Ae=se&~N;Ae!==0?P=da(Ae):(j&=se,j!==0&&(P=da(j)))}else se=A&~N,se!==0?P=da(se):j!==0&&(P=da(j));if(P===0)return 0;if(g!==0&&g!==P&&(g&N)===0&&(N=P&-P,j=g&-g,N>=j||N===16&&(j&4194240)!==0))return g;if((P&4)!==0&&(P|=A&16),g=p.entangledLanes,g!==0)for(p=p.entanglements,g&=P;0<g;)A=31-Rn(g),N=1<<A,P|=p[A],g&=~N;return P}function ts(p,g){switch(p){case 1:case 2:case 4:return g+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return g+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function du(p,g){for(var A=p.suspendedLanes,P=p.pingedLanes,N=p.expirationTimes,j=p.pendingLanes;0<j;){var se=31-Rn(j),Ae=1<<se,Ie=N[se];Ie===-1?((Ae&A)===0||(Ae&P)!==0)&&(N[se]=ts(Ae,g)):Ie<=g&&(p.expiredLanes|=Ae),j&=~Ae}}function Za(p){return p=p.pendingLanes&-1073741825,p!==0?p:p&1073741824?1073741824:0}function Ao(){var p=qa;return qa<<=1,(qa&4194240)===0&&(qa=64),p}function Xa(p){for(var g=[],A=0;31>A;A++)g.push(p);return g}function pa(p,g,A){p.pendingLanes|=g,g!==536870912&&(p.suspendedLanes=0,p.pingedLanes=0),p=p.eventTimes,g=31-Rn(g),p[g]=A}function vd(p,g){var A=p.pendingLanes&~g;p.pendingLanes=g,p.suspendedLanes=0,p.pingedLanes=0,p.expiredLanes&=g,p.mutableReadLanes&=g,p.entangledLanes&=g,g=p.entanglements;var P=p.eventTimes;for(p=p.expirationTimes;0<A;){var N=31-Rn(A),j=1<<N;g[N]=0,P[N]=-1,p[N]=-1,A&=~j}}function ie(p,g){var A=p.entangledLanes|=g;for(p=p.entanglements;A;){var P=31-Rn(A),N=1<<P;N&g|p[P]&g&&(p[P]|=g),A&=~N}}var ce=0;function Ce(p){return p&=-p,1<p?4<p?(p&268435455)!==0?16:536870912:4:1}var He,mt,Xt,xr,Gr,ar=!1,xi=[],Oi=null,To=null,Fi=null,zi=new Map,ln=new Map,hi=[],oi="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function bd(p,g){switch(p){case"focusin":case"focusout":Oi=null;break;case"dragenter":case"dragleave":To=null;break;case"mouseover":case"mouseout":Fi=null;break;case"pointerover":case"pointerout":zi.delete(g.pointerId);break;case"gotpointercapture":case"lostpointercapture":ln.delete(g.pointerId)}}function cn(p,g,A,P,N,j){return p===null||p.nativeEvent!==j?(p={blockedOn:g,domEventName:A,eventSystemFlags:P,nativeEvent:j,targetContainers:[N]},g!==null&&(g=Nc(g),g!==null&&mt(g)),p):(p.eventSystemFlags|=P,g=p.targetContainers,N!==null&&g.indexOf(N)===-1&&g.push(N),p)}function Os(p,g,A,P,N){switch(g){case"focusin":return Oi=cn(Oi,p,g,A,P,N),!0;case"dragenter":return To=cn(To,p,g,A,P,N),!0;case"mouseover":return Fi=cn(Fi,p,g,A,P,N),!0;case"pointerover":var j=N.pointerId;return zi.set(j,cn(zi.get(j)||null,p,g,A,P,N)),!0;case"gotpointercapture":return j=N.pointerId,ln.set(j,cn(ln.get(j)||null,p,g,A,P,N)),!0}return!1}function In(p){var g=Aa(p.target);if(g!==null){var A=cr(g);if(A!==null){if(g=A.tag,g===13){if(g=Hi(A),g!==null){p.blockedOn=g,Gr(p.priority,function(){Xt(A)});return}}else if(g===3&&A.stateNode.current.memoizedState.isDehydrated){p.blockedOn=A.tag===3?A.stateNode.containerInfo:null;return}}}p.blockedOn=null}function ii(p){if(p.blockedOn!==null)return!1;for(var g=p.targetContainers;0<g.length;){var A=Ya(p.domEventName,p.eventSystemFlags,g[0],p.nativeEvent);if(A===null){A=p.nativeEvent;var P=new A.constructor(A.type,A);nt=P,A.target.dispatchEvent(P),nt=null}else return g=Nc(A),g!==null&&mt(g),p.blockedOn=A,!1;g.shift()}return!0}function Ka(p,g,A){ii(p)&&A.delete(g)}function lr(){ar=!1,Oi!==null&&ii(Oi)&&(Oi=null),To!==null&&ii(To)&&(To=null),Fi!==null&&ii(Fi)&&(Fi=null),zi.forEach(Ka),ln.forEach(Ka)}function pr(p,g){p.blockedOn===g&&(p.blockedOn=null,ar||(ar=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,lr)))}function Fs(p){function g(N){return pr(N,p)}if(0<xi.length){pr(xi[0],p);for(var A=1;A<xi.length;A++){var P=xi[A];P.blockedOn===p&&(P.blockedOn=null)}}for(Oi!==null&&pr(Oi,p),To!==null&&pr(To,p),Fi!==null&&pr(Fi,p),zi.forEach(g),ln.forEach(g),A=0;A<hi.length;A++)P=hi[A],P.blockedOn===p&&(P.blockedOn=null);for(;0<hi.length&&(A=hi[0],A.blockedOn===null);)In(A),A.blockedOn===null&&hi.shift()}var Rr=we.ReactCurrentBatchConfig,jn=!0;function Ho(p,g,A,P){var N=ce,j=Rr.transition;Rr.transition=null;try{ce=1,gc(p,g,A,P)}finally{ce=N,Rr.transition=j}}function Wo(p,g,A,P){var N=ce,j=Rr.transition;Rr.transition=null;try{ce=4,gc(p,g,A,P)}finally{ce=N,Rr.transition=j}}function gc(p,g,A,P){if(jn){var N=Ya(p,g,A,P);if(N===null)Dl(p,g,P,_c,A),bd(p,P);else if(Os(N,p,g,A,P))P.stopPropagation();else if(bd(p,P),g&4&&-1<oi.indexOf(p)){for(;N!==null;){var j=Nc(N);if(j!==null&&He(j),j=Ya(p,g,A,P),j===null&&Dl(p,g,P,_c,A),j===N)break;N=j}N!==null&&P.stopPropagation()}else Dl(p,g,P,null,A)}}var _c=null;function Ya(p,g,A,P){if(_c=null,p=pt(P),p=Aa(p),p!==null)if(g=cr(p),g===null)p=null;else if(A=g.tag,A===13){if(p=Hi(g),p!==null)return p;p=null}else if(A===3){if(g.stateNode.current.memoizedState.isDehydrated)return g.tag===3?g.stateNode.containerInfo:null;p=null}else g!==p&&(p=null);return _c=p,null}function yc(p){switch(p){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Pn()){case Mi:return 1;case Dr:return 4;case Qn:case xo:return 16;case es:return 536870912;default:return 16}default:return 16}}var So=null,vc=null,Ml=null;function ro(){if(Ml)return Ml;var p,g=vc,A=g.length,P,N="value"in So?So.value:So.textContent,j=N.length;for(p=0;p<A&&g[p]===N[p];p++);var se=A-p;for(P=1;P<=se&&g[A-P]===N[j-P];P++);return Ml=N.slice(p,1<P?1-P:void 0)}function qi(p){var g=p.keyCode;return"charCode"in p?(p=p.charCode,p===0&&g===13&&(p=13)):p=g,p===10&&(p=13),32<=p||p===13?p:0}function fa(){return!0}function bc(){return!1}function un(p){function g(A,P,N,j,se){this._reactName=A,this._targetInst=N,this.type=P,this.nativeEvent=j,this.target=se,this.currentTarget=null;for(var Ae in p)p.hasOwnProperty(Ae)&&(A=p[Ae],this[Ae]=A?A(j):j[Ae]);return this.isDefaultPrevented=(j.defaultPrevented!=null?j.defaultPrevented:j.returnValue===!1)?fa:bc,this.isPropagationStopped=bc,this}return Bt(g.prototype,{preventDefault:function(){this.defaultPrevented=!0;var A=this.nativeEvent;A&&(A.preventDefault?A.preventDefault():typeof A.returnValue!="unknown"&&(A.returnValue=!1),this.isDefaultPrevented=fa)},stopPropagation:function(){var A=this.nativeEvent;A&&(A.stopPropagation?A.stopPropagation():typeof A.cancelBubble!="unknown"&&(A.cancelBubble=!0),this.isPropagationStopped=fa)},persist:function(){},isPersistent:fa}),g}var di={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(p){return p.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},uh=un(di),ma=Bt({},di,{view:0,detail:0}),xd=un(ma),wd,Ja,$i,Qa=Bt({},ma,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:xc,button:0,buttons:0,relatedTarget:function(p){return p.relatedTarget===void 0?p.fromElement===p.srcElement?p.toElement:p.fromElement:p.relatedTarget},movementX:function(p){return"movementX"in p?p.movementX:(p!==$i&&($i&&p.type==="mousemove"?(wd=p.screenX-$i.screenX,Ja=p.screenY-$i.screenY):Ja=wd=0,$i=p),wd)},movementY:function(p){return"movementY"in p?p.movementY:Ja}}),Co=un(Qa),pu=Bt({},Qa,{dataTransfer:0}),fu=un(pu),mu=Bt({},ma,{relatedTarget:0}),bn=un(mu),Qp=Bt({},di,{animationName:0,elapsedTime:0,pseudoElement:0}),hh=un(Qp),zm=Bt({},di,{clipboardData:function(p){return"clipboardData"in p?p.clipboardData:window.clipboardData}}),Ed=un(zm),Um=Bt({},di,{data:0}),ef=un(Um),dh={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Ad={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Pl={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Td(p){var g=this.nativeEvent;return g.getModifierState?g.getModifierState(p):(p=Pl[p])?!!g[p]:!1}function xc(){return Td}var Mo=Bt({},ma,{key:function(p){if(p.key){var g=dh[p.key]||p.key;if(g!=="Unidentified")return g}return p.type==="keypress"?(p=qi(p),p===13?"Enter":String.fromCharCode(p)):p.type==="keydown"||p.type==="keyup"?Ad[p.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:xc,charCode:function(p){return p.type==="keypress"?qi(p):0},keyCode:function(p){return p.type==="keydown"||p.type==="keyup"?p.keyCode:0},which:function(p){return p.type==="keypress"?qi(p):p.type==="keydown"||p.type==="keyup"?p.keyCode:0}}),jm=un(Mo),ph=Bt({},Qa,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),wc=un(ph),gu=Bt({},ma,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:xc}),Vm=un(gu),fh=Bt({},di,{propertyName:0,elapsedTime:0,pseudoElement:0}),Gm=un(fh),Rl=Bt({},Qa,{deltaX:function(p){return"deltaX"in p?p.deltaX:"wheelDeltaX"in p?-p.wheelDeltaX:0},deltaY:function(p){return"deltaY"in p?p.deltaY:"wheelDeltaY"in p?-p.wheelDeltaY:"wheelDelta"in p?-p.wheelDelta:0},deltaZ:0,deltaMode:0}),tf=un(Rl),Sd=[9,13,27,32],Cd=a&&"CompositionEvent"in window,Ec=null;a&&"documentMode"in document&&(Ec=document.documentMode);var Md=a&&"TextEvent"in window&&!Ec,Pd=a&&(!Cd||Ec&&8<Ec&&11>=Ec),_u=" ",Rd=!1;function Id(p,g){switch(p){case"keyup":return Sd.indexOf(g.keyCode)!==-1;case"keydown":return g.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function el(p){return p=p.detail,typeof p=="object"&&"data"in p?p.data:null}var tl=!1;function kd(p,g){switch(p){case"compositionend":return el(g);case"keypress":return g.which!==32?null:(Rd=!0,_u);case"textInput":return p=g.data,p===_u&&Rd?null:p;default:return null}}function yu(p,g){if(tl)return p==="compositionend"||!Cd&&Id(p,g)?(p=ro(),Ml=vc=So=null,tl=!1,p):null;switch(p){case"paste":return null;case"keypress":if(!(g.ctrlKey||g.altKey||g.metaKey)||g.ctrlKey&&g.altKey){if(g.char&&1<g.char.length)return g.char;if(g.which)return String.fromCharCode(g.which)}return null;case"compositionend":return Pd&&g.locale!=="ko"?null:g.data;default:return null}}var Hm={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Ac(p){var g=p&&p.nodeName&&p.nodeName.toLowerCase();return g==="input"?!!Hm[p.type]:g==="textarea"}function Bd(p,g,A,P){Sr(P),g=Cu(g,"onChange"),0<g.length&&(A=new uh("onChange","change",null,A,P),p.push({event:A,listeners:g}))}var vu=null,Tc=null;function rf(p){af(p,0)}function Sc(p){var g=Ol(p);if(yi(g))return p}function Ld(p,g){if(p==="change")return g}var Dd=!1;if(a){var Cc;if(a){var Po="oninput"in document;if(!Po){var Fr=document.createElement("div");Fr.setAttribute("oninput","return;"),Po=typeof Fr.oninput=="function"}Cc=Po}else Cc=!1;Dd=Cc&&(!document.documentMode||9<document.documentMode)}function mh(){vu&&(vu.detachEvent("onpropertychange",gh),Tc=vu=null)}function gh(p){if(p.propertyName==="value"&&Sc(Tc)){var g=[];Bd(g,Tc,p,pt(p)),Di(rf,g)}}function nf(p,g,A){p==="focusin"?(mh(),vu=g,Tc=A,vu.attachEvent("onpropertychange",gh)):p==="focusout"&&mh()}function Nd(p){if(p==="selectionchange"||p==="keyup"||p==="keydown")return Sc(Tc)}function Il(p,g){if(p==="click")return Sc(g)}function Od(p,g){if(p==="input"||p==="change")return Sc(g)}function Wm(p,g){return p===g&&(p!==0||1/p===1/g)||p!==p&&g!==g}var Ro=typeof Object.is=="function"?Object.is:Wm;function bu(p,g){if(Ro(p,g))return!0;if(typeof p!="object"||p===null||typeof g!="object"||g===null)return!1;var A=Object.keys(p),P=Object.keys(g);if(A.length!==P.length)return!1;for(P=0;P<A.length;P++){var N=A[P];if(!v.call(g,N)||!Ro(p[N],g[N]))return!1}return!0}function sf(p){for(;p&&p.firstChild;)p=p.firstChild;return p}function Fd(p,g){var A=sf(p);p=0;for(var P;A;){if(A.nodeType===3){if(P=p+A.textContent.length,p<=g&&P>=g)return{node:A,offset:g-p};p=P}e:{for(;A;){if(A.nextSibling){A=A.nextSibling;break e}A=A.parentNode}A=void 0}A=sf(A)}}function of(p,g){return p&&g?p===g?!0:p&&p.nodeType===3?!1:g&&g.nodeType===3?of(p,g.parentNode):"contains"in p?p.contains(g):p.compareDocumentPosition?!!(p.compareDocumentPosition(g)&16):!1:!1}function zd(){for(var p=window,g=qr();g instanceof p.HTMLIFrameElement;){try{var A=typeof g.contentWindow.location.href=="string"}catch{A=!1}if(A)p=g.contentWindow;else break;g=qr(p.document)}return g}function Mc(p){var g=p&&p.nodeName&&p.nodeName.toLowerCase();return g&&(g==="input"&&(p.type==="text"||p.type==="search"||p.type==="tel"||p.type==="url"||p.type==="password")||g==="textarea"||p.contentEditable==="true")}function _h(p){var g=zd(),A=p.focusedElem,P=p.selectionRange;if(g!==A&&A&&A.ownerDocument&&of(A.ownerDocument.documentElement,A)){if(P!==null&&Mc(A)){if(g=P.start,p=P.end,p===void 0&&(p=g),"selectionStart"in A)A.selectionStart=g,A.selectionEnd=Math.min(p,A.value.length);else if(p=(g=A.ownerDocument||document)&&g.defaultView||window,p.getSelection){p=p.getSelection();var N=A.textContent.length,j=Math.min(P.start,N);P=P.end===void 0?j:Math.min(P.end,N),!p.extend&&j>P&&(N=P,P=j,j=N),N=Fd(A,j);var se=Fd(A,P);N&&se&&(p.rangeCount!==1||p.anchorNode!==N.node||p.anchorOffset!==N.offset||p.focusNode!==se.node||p.focusOffset!==se.offset)&&(g=g.createRange(),g.setStart(N.node,N.offset),p.removeAllRanges(),j>P?(p.addRange(g),p.extend(se.node,se.offset)):(g.setEnd(se.node,se.offset),p.addRange(g)))}}for(g=[],p=A;p=p.parentNode;)p.nodeType===1&&g.push({element:p,left:p.scrollLeft,top:p.scrollTop});for(typeof A.focus=="function"&&A.focus(),A=0;A<g.length;A++)p=g[A],p.element.scrollLeft=p.left,p.element.scrollTop=p.top}}var yh=a&&"documentMode"in document&&11>=document.documentMode,rl=null,ga=null,_a=null,il=!1;function zs(p,g,A){var P=A.window===A?A.document:A.nodeType===9?A:A.ownerDocument;il||rl==null||rl!==qr(P)||(P=rl,"selectionStart"in P&&Mc(P)?P={start:P.selectionStart,end:P.selectionEnd}:(P=(P.ownerDocument&&P.ownerDocument.defaultView||window).getSelection(),P={anchorNode:P.anchorNode,anchorOffset:P.anchorOffset,focusNode:P.focusNode,focusOffset:P.focusOffset}),_a&&bu(_a,P)||(_a=P,P=Cu(ga,"onSelect"),0<P.length&&(g=new uh("onSelect","select",null,g,A),p.push({event:g,listeners:P}),g.target=rl)))}function xu(p,g){var A={};return A[p.toLowerCase()]=g.toLowerCase(),A["Webkit"+p]="webkit"+g,A["Moz"+p]="moz"+g,A}var kl={animationend:xu("Animation","AnimationEnd"),animationiteration:xu("Animation","AnimationIteration"),animationstart:xu("Animation","AnimationStart"),transitionend:xu("Transition","TransitionEnd")},wu={},nl={};a&&(nl=document.createElement("div").style,"AnimationEvent"in window||(delete kl.animationend.animation,delete kl.animationiteration.animation,delete kl.animationstart.animation),"TransitionEvent"in window||delete kl.transitionend.transition);function Bl(p){if(wu[p])return wu[p];if(!kl[p])return p;var g=kl[p],A;for(A in g)if(g.hasOwnProperty(A)&&A in nl)return wu[p]=g[A];return p}var Eu=Bl("animationend"),Pc=Bl("animationiteration"),Au=Bl("animationstart"),Ud=Bl("transitionend"),Ll=new Map,ya="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function va(p,g){Ll.set(p,g),l(g,[p])}for(var Tu=0;Tu<ya.length;Tu++){var Ir=ya[Tu],Su=Ir.toLowerCase(),qm=Ir[0].toUpperCase()+Ir.slice(1);va(Su,"on"+qm)}va(Eu,"onAnimationEnd"),va(Pc,"onAnimationIteration"),va(Au,"onAnimationStart"),va("dblclick","onDoubleClick"),va("focusin","onFocus"),va("focusout","onBlur"),va(Ud,"onTransitionEnd"),h("onMouseEnter",["mouseout","mouseover"]),h("onMouseLeave",["mouseout","mouseover"]),h("onPointerEnter",["pointerout","pointerover"]),h("onPointerLeave",["pointerout","pointerover"]),l("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),l("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),l("onBeforeInput",["compositionend","keypress","textInput","paste"]),l("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Rc="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),sl=new Set("cancel close invalid load scroll toggle".split(" ").concat(Rc));function jd(p,g,A){var P=p.type||"unknown-event";p.currentTarget=A,Cr(P,g,void 0,p),p.currentTarget=null}function af(p,g){g=(g&4)!==0;for(var A=0;A<p.length;A++){var P=p[A],N=P.event;P=P.listeners;e:{var j=void 0;if(g)for(var se=P.length-1;0<=se;se--){var Ae=P[se],Ie=Ae.instance,ot=Ae.currentTarget;if(Ae=Ae.listener,Ie!==j&&N.isPropagationStopped())break e;jd(N,Ae,ot),j=Ie}else for(se=0;se<P.length;se++){if(Ae=P[se],Ie=Ae.instance,ot=Ae.currentTarget,Ae=Ae.listener,Ie!==j&&N.isPropagationStopped())break e;jd(N,Ae,ot),j=Ie}}}if(si)throw p=Ns,si=!1,Ns=null,p}function gi(p,g){var A=g[wa];A===void 0&&(A=g[wa]=new Set);var P=p+"__bubble";A.has(P)||(kc(g,p,2,!1),A.add(P))}function Vd(p,g,A){var P=0;g&&(P|=4),kc(A,p,P,g)}var Ic="_reactListening"+Math.random().toString(36).slice(2);function ol(p){if(!p[Ic]){p[Ic]=!0,i.forEach(function(A){A!=="selectionchange"&&(sl.has(A)||Vd(A,!1,p),Vd(A,!0,p))});var g=p.nodeType===9?p:p.ownerDocument;g===null||g[Ic]||(g[Ic]=!0,Vd("selectionchange",!1,g))}}function kc(p,g,A,P){switch(yc(g)){case 1:var N=Ho;break;case 4:N=Wo;break;default:N=gc}A=N.bind(null,g,A,p),N=void 0,!Er||g!=="touchstart"&&g!=="touchmove"&&g!=="wheel"||(N=!0),P?N!==void 0?p.addEventListener(g,A,{capture:!0,passive:N}):p.addEventListener(g,A,!0):N!==void 0?p.addEventListener(g,A,{passive:N}):p.addEventListener(g,A,!1)}function Dl(p,g,A,P,N){var j=P;if((g&1)===0&&(g&2)===0&&P!==null)e:for(;;){if(P===null)return;var se=P.tag;if(se===3||se===4){var Ae=P.stateNode.containerInfo;if(Ae===N||Ae.nodeType===8&&Ae.parentNode===N)break;if(se===4)for(se=P.return;se!==null;){var Ie=se.tag;if((Ie===3||Ie===4)&&(Ie=se.stateNode.containerInfo,Ie===N||Ie.nodeType===8&&Ie.parentNode===N))return;se=se.return}for(;Ae!==null;){if(se=Aa(Ae),se===null)return;if(Ie=se.tag,Ie===5||Ie===6){P=j=se;continue e}Ae=Ae.parentNode}}P=P.return}Di(function(){var ot=j,xt=pt(A),yt=[];e:{var gt=Ll.get(p);if(gt!==void 0){var jt=uh,Zt=p;switch(p){case"keypress":if(qi(A)===0)break e;case"keydown":case"keyup":jt=jm;break;case"focusin":Zt="focus",jt=bn;break;case"focusout":Zt="blur",jt=bn;break;case"beforeblur":case"afterblur":jt=bn;break;case"click":if(A.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":jt=Co;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":jt=fu;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":jt=Vm;break;case Eu:case Pc:case Au:jt=hh;break;case Ud:jt=Gm;break;case"scroll":jt=xd;break;case"wheel":jt=tf;break;case"copy":case"cut":case"paste":jt=Ed;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":jt=wc}var rr=(g&4)!==0,Ui=!rr&&p==="scroll",Ye=rr?gt!==null?gt+"Capture":null:gt;rr=[];for(var je=ot,rt;je!==null;){rt=je;var Mt=rt.stateNode;if(rt.tag===5&&Mt!==null&&(rt=Mt,Ye!==null&&(Mt=ui(je,Ye),Mt!=null&&rr.push(Nl(je,Mt,rt)))),Ui)break;je=je.return}0<rr.length&&(gt=new jt(gt,Zt,null,A,xt),yt.push({event:gt,listeners:rr}))}}if((g&7)===0){e:{if(gt=p==="mouseover"||p==="pointerover",jt=p==="mouseout"||p==="pointerout",gt&&A!==nt&&(Zt=A.relatedTarget||A.fromElement)&&(Aa(Zt)||Zt[Zo]))break e;if((jt||gt)&&(gt=xt.window===xt?xt:(gt=xt.ownerDocument)?gt.defaultView||gt.parentWindow:window,jt?(Zt=A.relatedTarget||A.toElement,jt=ot,Zt=Zt?Aa(Zt):null,Zt!==null&&(Ui=cr(Zt),Zt!==Ui||Zt.tag!==5&&Zt.tag!==6)&&(Zt=null)):(jt=null,Zt=ot),jt!==Zt)){if(rr=Co,Mt="onMouseLeave",Ye="onMouseEnter",je="mouse",(p==="pointerout"||p==="pointerover")&&(rr=wc,Mt="onPointerLeave",Ye="onPointerEnter",je="pointer"),Ui=jt==null?gt:Ol(jt),rt=Zt==null?gt:Ol(Zt),gt=new rr(Mt,je+"leave",jt,A,xt),gt.target=Ui,gt.relatedTarget=rt,Mt=null,Aa(xt)===ot&&(rr=new rr(Ye,je+"enter",Zt,A,xt),rr.target=rt,rr.relatedTarget=Ui,Mt=rr),Ui=Mt,jt&&Zt)t:{for(rr=jt,Ye=Zt,je=0,rt=rr;rt;rt=qo(rt))je++;for(rt=0,Mt=Ye;Mt;Mt=qo(Mt))rt++;for(;0<je-rt;)rr=qo(rr),je--;for(;0<rt-je;)Ye=qo(Ye),rt--;for(;je--;){if(rr===Ye||Ye!==null&&rr===Ye.alternate)break t;rr=qo(rr),Ye=qo(Ye)}rr=null}else rr=null;jt!==null&&Bc(yt,gt,jt,rr,!1),Zt!==null&&Ui!==null&&Bc(yt,Ui,Zt,rr,!0)}}e:{if(gt=ot?Ol(ot):window,jt=gt.nodeName&&gt.nodeName.toLowerCase(),jt==="select"||jt==="input"&&gt.type==="file")var Kt=Ld;else if(Ac(gt))if(Dd)Kt=Od;else{Kt=Nd;var fr=nf}else(jt=gt.nodeName)&&jt.toLowerCase()==="input"&&(gt.type==="checkbox"||gt.type==="radio")&&(Kt=Il);if(Kt&&(Kt=Kt(p,ot))){Bd(yt,Kt,A,xt);break e}fr&&fr(p,gt,ot),p==="focusout"&&(fr=gt._wrapperState)&&fr.controlled&&gt.type==="number"&&Yn(gt,"number",gt.value)}switch(fr=ot?Ol(ot):window,p){case"focusin":(Ac(fr)||fr.contentEditable==="true")&&(rl=fr,ga=ot,_a=null);break;case"focusout":_a=ga=rl=null;break;case"mousedown":il=!0;break;case"contextmenu":case"mouseup":case"dragend":il=!1,zs(yt,A,xt);break;case"selectionchange":if(yh)break;case"keydown":case"keyup":zs(yt,A,xt)}var mr;if(Cd)e:{switch(p){case"compositionstart":var wr="onCompositionStart";break e;case"compositionend":wr="onCompositionEnd";break e;case"compositionupdate":wr="onCompositionUpdate";break e}wr=void 0}else tl?Id(p,A)&&(wr="onCompositionEnd"):p==="keydown"&&A.keyCode===229&&(wr="onCompositionStart");wr&&(Pd&&A.locale!=="ko"&&(tl||wr!=="onCompositionStart"?wr==="onCompositionEnd"&&tl&&(mr=ro()):(So=xt,vc="value"in So?So.value:So.textContent,tl=!0)),fr=Cu(ot,wr),0<fr.length&&(wr=new ef(wr,p,null,A,xt),yt.push({event:wr,listeners:fr}),mr?wr.data=mr:(mr=el(A),mr!==null&&(wr.data=mr)))),(mr=Md?kd(p,A):yu(p,A))&&(ot=Cu(ot,"onBeforeInput"),0<ot.length&&(xt=new ef("onBeforeInput","beforeinput",null,A,xt),yt.push({event:xt,listeners:ot}),xt.data=mr))}af(yt,g)})}function Nl(p,g,A){return{instance:p,listener:g,currentTarget:A}}function Cu(p,g){for(var A=g+"Capture",P=[];p!==null;){var N=p,j=N.stateNode;N.tag===5&&j!==null&&(N=j,j=ui(p,A),j!=null&&P.unshift(Nl(p,j,N)),j=ui(p,g),j!=null&&P.push(Nl(p,j,N))),p=p.return}return P}function qo(p){if(p===null)return null;do p=p.return;while(p&&p.tag!==5);return p||null}function Bc(p,g,A,P,N){for(var j=g._reactName,se=[];A!==null&&A!==P;){var Ae=A,Ie=Ae.alternate,ot=Ae.stateNode;if(Ie!==null&&Ie===P)break;Ae.tag===5&&ot!==null&&(Ae=ot,N?(Ie=ui(A,j),Ie!=null&&se.unshift(Nl(A,Ie,Ae))):N||(Ie=ui(A,j),Ie!=null&&se.push(Nl(A,Ie,Ae)))),A=A.return}se.length!==0&&p.push({event:g,listeners:se})}var Mu=/\r\n?/g,vh=/\u0000|\uFFFD/g;function bh(p){return(typeof p=="string"?p:""+p).replace(Mu,`
`).replace(vh,"")}function $o(p,g,A){if(g=bh(g),bh(p)!==g&&A)throw Error(r(425))}function Lc(){}var Dc=null,ba=null;function Pu(p,g){return p==="textarea"||p==="noscript"||typeof g.children=="string"||typeof g.children=="number"||typeof g.dangerouslySetInnerHTML=="object"&&g.dangerouslySetInnerHTML!==null&&g.dangerouslySetInnerHTML.__html!=null}var xh=typeof setTimeout=="function"?setTimeout:void 0,lf=typeof clearTimeout=="function"?clearTimeout:void 0,Ru=typeof Promise=="function"?Promise:void 0,Gd=typeof queueMicrotask=="function"?queueMicrotask:typeof Ru<"u"?function(p){return Ru.resolve(null).then(p).catch($m)}:xh;function $m(p){setTimeout(function(){throw p})}function Iu(p,g){var A=g,P=0;do{var N=A.nextSibling;if(p.removeChild(A),N&&N.nodeType===8)if(A=N.data,A==="/$"){if(P===0){p.removeChild(N),Fs(g);return}P--}else A!=="$"&&A!=="$?"&&A!=="$!"||P++;A=N}while(A);Fs(g)}function Yr(p){for(;p!=null;p=p.nextSibling){var g=p.nodeType;if(g===1||g===3)break;if(g===8){if(g=p.data,g==="$"||g==="$!"||g==="$?")break;if(g==="/$")return null}}return p}function Io(p){p=p.previousSibling;for(var g=0;p;){if(p.nodeType===8){var A=p.data;if(A==="$"||A==="$!"||A==="$?"){if(g===0)return p;g--}else A==="/$"&&g++}p=p.previousSibling}return null}var kn=Math.random().toString(36).slice(2),Us="__reactFiber$"+kn,xa="__reactProps$"+kn,Zo="__reactContainer$"+kn,wa="__reactEvents$"+kn,wh="__reactListeners$"+kn,Ea="__reactHandles$"+kn;function Aa(p){var g=p[Us];if(g)return g;for(var A=p.parentNode;A;){if(g=A[Zo]||A[Us]){if(A=g.alternate,g.child!==null||A!==null&&A.child!==null)for(p=Io(p);p!==null;){if(A=p[Us])return A;p=Io(p)}return g}p=A,A=p.parentNode}return null}function Nc(p){return p=p[Us]||p[Zo],!p||p.tag!==5&&p.tag!==6&&p.tag!==13&&p.tag!==3?null:p}function Ol(p){if(p.tag===5||p.tag===6)return p.stateNode;throw Error(r(33))}function ku(p){return p[xa]||null}var Eh=[],Fl=-1;function xn(p){return{current:p}}function Jr(p){0>Fl||(p.current=Eh[Fl],Eh[Fl]=null,Fl--)}function Br(p,g){Fl++,Eh[Fl]=p.current,p.current=g}var js={},wn=xn(js),rs=xn(!1),al=js;function ko(p,g){var A=p.type.contextTypes;if(!A)return js;var P=p.stateNode;if(P&&P.__reactInternalMemoizedUnmaskedChildContext===g)return P.__reactInternalMemoizedMaskedChildContext;var N={},j;for(j in A)N[j]=g[j];return P&&(p=p.stateNode,p.__reactInternalMemoizedUnmaskedChildContext=g,p.__reactInternalMemoizedMaskedChildContext=N),N}function Vn(p){return p=p.childContextTypes,p!=null}function Ta(){Jr(rs),Jr(wn)}function Hd(p,g,A){if(wn.current!==js)throw Error(r(168));Br(wn,g),Br(rs,A)}function is(p,g,A){var P=p.stateNode;if(g=g.childContextTypes,typeof P.getChildContext!="function")return A;P=P.getChildContext();for(var N in P)if(!(N in g))throw Error(r(108,Ht(p)||"Unknown",N));return Bt({},A,P)}function Es(p){return p=(p=p.stateNode)&&p.__reactInternalMemoizedMergedChildContext||js,al=wn.current,Br(wn,p),Br(rs,rs.current),!0}function zl(p,g,A){var P=p.stateNode;if(!P)throw Error(r(169));A?(p=is(p,g,al),P.__reactInternalMemoizedMergedChildContext=p,Jr(rs),Jr(wn),Br(wn,p)):Jr(rs),Br(rs,A)}var hn=null,Sa=!1,Wd=!1;function Oc(p){hn===null?hn=[p]:hn.push(p)}function Zm(p){Sa=!0,Oc(p)}function ll(){if(!Wd&&hn!==null){Wd=!0;var p=0,g=ce;try{var A=hn;for(ce=1;p<A.length;p++){var P=A[p];do P=P(!0);while(P!==null)}hn=null,Sa=!1}catch(N){throw hn!==null&&(hn=hn.slice(p+1)),xs(Mi,ll),N}finally{ce=g,Wd=!1}}return null}var Xo=[],Ko=0,As=null,Dt=0,Ts=[],ns=0,Ca=null,Ss=1,ss="";function Yo(p,g){Xo[Ko++]=Dt,Xo[Ko++]=As,As=p,Dt=g}function kr(p,g,A){Ts[ns++]=Ss,Ts[ns++]=ss,Ts[ns++]=Ca,Ca=p;var P=Ss;p=ss;var N=32-Rn(P)-1;P&=~(1<<N),A+=1;var j=32-Rn(g)+N;if(30<j){var se=N-N%5;j=(P&(1<<se)-1).toString(32),P>>=se,N-=se,Ss=1<<32-Rn(g)+N|A<<N|P,ss=j+p}else Ss=1<<j|A<<N|P,ss=p}function Fc(p){p.return!==null&&(Yo(p,1),kr(p,1,0))}function qd(p){for(;p===As;)As=Xo[--Ko],Xo[Ko]=null,Dt=Xo[--Ko],Xo[Ko]=null;for(;p===Ca;)Ca=Ts[--ns],Ts[ns]=null,ss=Ts[--ns],Ts[ns]=null,Ss=Ts[--ns],Ts[ns]=null}var Gn=null,Vs=null,vi=!1,Gs=null;function Ah(p,g){var A=zo(5,null,null,0);A.elementType="DELETED",A.stateNode=g,A.return=p,g=p.deletions,g===null?(p.deletions=[A],p.flags|=16):g.push(A)}function $d(p,g){switch(p.tag){case 5:var A=p.type;return g=g.nodeType!==1||A.toLowerCase()!==g.nodeName.toLowerCase()?null:g,g!==null?(p.stateNode=g,Gn=p,Vs=Yr(g.firstChild),!0):!1;case 6:return g=p.pendingProps===""||g.nodeType!==3?null:g,g!==null?(p.stateNode=g,Gn=p,Vs=null,!0):!1;case 13:return g=g.nodeType!==8?null:g,g!==null?(A=Ca!==null?{id:Ss,overflow:ss}:null,p.memoizedState={dehydrated:g,treeContext:A,retryLane:1073741824},A=zo(18,null,null,0),A.stateNode=g,A.return=p,p.child=A,Gn=p,Vs=null,!0):!1;default:return!1}}function Th(p){return(p.mode&1)!==0&&(p.flags&128)===0}function Bu(p){if(vi){var g=Vs;if(g){var A=g;if(!$d(p,g)){if(Th(p))throw Error(r(418));g=Yr(A.nextSibling);var P=Gn;g&&$d(p,g)?Ah(P,A):(p.flags=p.flags&-4097|2,vi=!1,Gn=p)}}else{if(Th(p))throw Error(r(418));p.flags=p.flags&-4097|2,vi=!1,Gn=p}}}function Zd(p){for(p=p.return;p!==null&&p.tag!==5&&p.tag!==3&&p.tag!==13;)p=p.return;Gn=p}function Lu(p){if(p!==Gn)return!1;if(!vi)return Zd(p),vi=!0,!1;var g;if((g=p.tag!==3)&&!(g=p.tag!==5)&&(g=p.type,g=g!=="head"&&g!=="body"&&!Pu(p.type,p.memoizedProps)),g&&(g=Vs)){if(Th(p))throw io(),Error(r(418));for(;g;)Ah(p,g),g=Yr(g.nextSibling)}if(Zd(p),p.tag===13){if(p=p.memoizedState,p=p!==null?p.dehydrated:null,!p)throw Error(r(317));e:{for(p=p.nextSibling,g=0;p;){if(p.nodeType===8){var A=p.data;if(A==="/$"){if(g===0){Vs=Yr(p.nextSibling);break e}g--}else A!=="$"&&A!=="$!"&&A!=="$?"||g++}p=p.nextSibling}Vs=null}}else Vs=Gn?Yr(p.stateNode.nextSibling):null;return!0}function io(){for(var p=Vs;p;)p=Yr(p.nextSibling)}function Qr(){Vs=Gn=null,vi=!1}function cl(p){Gs===null?Gs=[p]:Gs.push(p)}var Xd=we.ReactCurrentBatchConfig;function zc(p,g,A){if(p=A.ref,p!==null&&typeof p!="function"&&typeof p!="object"){if(A._owner){if(A=A._owner,A){if(A.tag!==1)throw Error(r(309));var P=A.stateNode}if(!P)throw Error(r(147,p));var N=P,j=""+p;return g!==null&&g.ref!==null&&typeof g.ref=="function"&&g.ref._stringRef===j?g.ref:(g=function(se){var Ae=N.refs;se===null?delete Ae[j]:Ae[j]=se},g._stringRef=j,g)}if(typeof p!="string")throw Error(r(284));if(!A._owner)throw Error(r(290,p))}return p}function Uc(p,g){throw p=Object.prototype.toString.call(g),Error(r(31,p==="[object Object]"?"object with keys {"+Object.keys(g).join(", ")+"}":p))}function Sh(p){var g=p._init;return g(p._payload)}function Kd(p){function g(Ye,je){if(p){var rt=Ye.deletions;rt===null?(Ye.deletions=[je],Ye.flags|=16):rt.push(je)}}function A(Ye,je){if(!p)return null;for(;je!==null;)g(Ye,je),je=je.sibling;return null}function P(Ye,je){for(Ye=new Map;je!==null;)je.key!==null?Ye.set(je.key,je):Ye.set(je.index,je),je=je.sibling;return Ye}function N(Ye,je){return Ye=ql(Ye,je),Ye.index=0,Ye.sibling=null,Ye}function j(Ye,je,rt){return Ye.index=rt,p?(rt=Ye.alternate,rt!==null?(rt=rt.index,rt<je?(Ye.flags|=2,je):rt):(Ye.flags|=2,je)):(Ye.flags|=1048576,je)}function se(Ye){return p&&Ye.alternate===null&&(Ye.flags|=2),Ye}function Ae(Ye,je,rt,Mt){return je===null||je.tag!==6?(je=vg(rt,Ye.mode,Mt),je.return=Ye,je):(je=N(je,rt),je.return=Ye,je)}function Ie(Ye,je,rt,Mt){var Kt=rt.type;return Kt===Ke?xt(Ye,je,rt.props.children,Mt,rt.key):je!==null&&(je.elementType===Kt||typeof Kt=="object"&&Kt!==null&&Kt.$$typeof===Qt&&Sh(Kt)===je.type)?(Mt=N(je,rt.props),Mt.ref=zc(Ye,je,rt),Mt.return=Ye,Mt):(Mt=bf(rt.type,rt.key,rt.props,null,Ye.mode,Mt),Mt.ref=zc(Ye,je,rt),Mt.return=Ye,Mt)}function ot(Ye,je,rt,Mt){return je===null||je.tag!==4||je.stateNode.containerInfo!==rt.containerInfo||je.stateNode.implementation!==rt.implementation?(je=bg(rt,Ye.mode,Mt),je.return=Ye,je):(je=N(je,rt.children||[]),je.return=Ye,je)}function xt(Ye,je,rt,Mt,Kt){return je===null||je.tag!==7?(je=qu(rt,Ye.mode,Mt,Kt),je.return=Ye,je):(je=N(je,rt),je.return=Ye,je)}function yt(Ye,je,rt){if(typeof je=="string"&&je!==""||typeof je=="number")return je=vg(""+je,Ye.mode,rt),je.return=Ye,je;if(typeof je=="object"&&je!==null){switch(je.$$typeof){case De:return rt=bf(je.type,je.key,je.props,null,Ye.mode,rt),rt.ref=zc(Ye,null,je),rt.return=Ye,rt;case Fe:return je=bg(je,Ye.mode,rt),je.return=Ye,je;case Qt:var Mt=je._init;return yt(Ye,Mt(je._payload),rt)}if(Jn(je)||wt(je))return je=qu(je,Ye.mode,rt,null),je.return=Ye,je;Uc(Ye,je)}return null}function gt(Ye,je,rt,Mt){var Kt=je!==null?je.key:null;if(typeof rt=="string"&&rt!==""||typeof rt=="number")return Kt!==null?null:Ae(Ye,je,""+rt,Mt);if(typeof rt=="object"&&rt!==null){switch(rt.$$typeof){case De:return rt.key===Kt?Ie(Ye,je,rt,Mt):null;case Fe:return rt.key===Kt?ot(Ye,je,rt,Mt):null;case Qt:return Kt=rt._init,gt(Ye,je,Kt(rt._payload),Mt)}if(Jn(rt)||wt(rt))return Kt!==null?null:xt(Ye,je,rt,Mt,null);Uc(Ye,rt)}return null}function jt(Ye,je,rt,Mt,Kt){if(typeof Mt=="string"&&Mt!==""||typeof Mt=="number")return Ye=Ye.get(rt)||null,Ae(je,Ye,""+Mt,Kt);if(typeof Mt=="object"&&Mt!==null){switch(Mt.$$typeof){case De:return Ye=Ye.get(Mt.key===null?rt:Mt.key)||null,Ie(je,Ye,Mt,Kt);case Fe:return Ye=Ye.get(Mt.key===null?rt:Mt.key)||null,ot(je,Ye,Mt,Kt);case Qt:var fr=Mt._init;return jt(Ye,je,rt,fr(Mt._payload),Kt)}if(Jn(Mt)||wt(Mt))return Ye=Ye.get(rt)||null,xt(je,Ye,Mt,Kt,null);Uc(je,Mt)}return null}function Zt(Ye,je,rt,Mt){for(var Kt=null,fr=null,mr=je,wr=je=0,Nn=null;mr!==null&&wr<rt.length;wr++){mr.index>wr?(Nn=mr,mr=null):Nn=mr.sibling;var Vr=gt(Ye,mr,rt[wr],Mt);if(Vr===null){mr===null&&(mr=Nn);break}p&&mr&&Vr.alternate===null&&g(Ye,mr),je=j(Vr,je,wr),fr===null?Kt=Vr:fr.sibling=Vr,fr=Vr,mr=Nn}if(wr===rt.length)return A(Ye,mr),vi&&Yo(Ye,wr),Kt;if(mr===null){for(;wr<rt.length;wr++)mr=yt(Ye,rt[wr],Mt),mr!==null&&(je=j(mr,je,wr),fr===null?Kt=mr:fr.sibling=mr,fr=mr);return vi&&Yo(Ye,wr),Kt}for(mr=P(Ye,mr);wr<rt.length;wr++)Nn=jt(mr,Ye,wr,rt[wr],Mt),Nn!==null&&(p&&Nn.alternate!==null&&mr.delete(Nn.key===null?wr:Nn.key),je=j(Nn,je,wr),fr===null?Kt=Nn:fr.sibling=Nn,fr=Nn);return p&&mr.forEach(function(Xl){return g(Ye,Xl)}),vi&&Yo(Ye,wr),Kt}function rr(Ye,je,rt,Mt){var Kt=wt(rt);if(typeof Kt!="function")throw Error(r(150));if(rt=Kt.call(rt),rt==null)throw Error(r(151));for(var fr=Kt=null,mr=je,wr=je=0,Nn=null,Vr=rt.next();mr!==null&&!Vr.done;wr++,Vr=rt.next()){mr.index>wr?(Nn=mr,mr=null):Nn=mr.sibling;var Xl=gt(Ye,mr,Vr.value,Mt);if(Xl===null){mr===null&&(mr=Nn);break}p&&mr&&Xl.alternate===null&&g(Ye,mr),je=j(Xl,je,wr),fr===null?Kt=Xl:fr.sibling=Xl,fr=Xl,mr=Nn}if(Vr.done)return A(Ye,mr),vi&&Yo(Ye,wr),Kt;if(mr===null){for(;!Vr.done;wr++,Vr=rt.next())Vr=yt(Ye,Vr.value,Mt),Vr!==null&&(je=j(Vr,je,wr),fr===null?Kt=Vr:fr.sibling=Vr,fr=Vr);return vi&&Yo(Ye,wr),Kt}for(mr=P(Ye,mr);!Vr.done;wr++,Vr=rt.next())Vr=jt(mr,Ye,wr,Vr.value,Mt),Vr!==null&&(p&&Vr.alternate!==null&&mr.delete(Vr.key===null?wr:Vr.key),je=j(Vr,je,wr),fr===null?Kt=Vr:fr.sibling=Vr,fr=Vr);return p&&mr.forEach(function(Z1){return g(Ye,Z1)}),vi&&Yo(Ye,wr),Kt}function Ui(Ye,je,rt,Mt){if(typeof rt=="object"&&rt!==null&&rt.type===Ke&&rt.key===null&&(rt=rt.props.children),typeof rt=="object"&&rt!==null){switch(rt.$$typeof){case De:e:{for(var Kt=rt.key,fr=je;fr!==null;){if(fr.key===Kt){if(Kt=rt.type,Kt===Ke){if(fr.tag===7){A(Ye,fr.sibling),je=N(fr,rt.props.children),je.return=Ye,Ye=je;break e}}else if(fr.elementType===Kt||typeof Kt=="object"&&Kt!==null&&Kt.$$typeof===Qt&&Sh(Kt)===fr.type){A(Ye,fr.sibling),je=N(fr,rt.props),je.ref=zc(Ye,fr,rt),je.return=Ye,Ye=je;break e}A(Ye,fr);break}else g(Ye,fr);fr=fr.sibling}rt.type===Ke?(je=qu(rt.props.children,Ye.mode,Mt,rt.key),je.return=Ye,Ye=je):(Mt=bf(rt.type,rt.key,rt.props,null,Ye.mode,Mt),Mt.ref=zc(Ye,je,rt),Mt.return=Ye,Ye=Mt)}return se(Ye);case Fe:e:{for(fr=rt.key;je!==null;){if(je.key===fr)if(je.tag===4&&je.stateNode.containerInfo===rt.containerInfo&&je.stateNode.implementation===rt.implementation){A(Ye,je.sibling),je=N(je,rt.children||[]),je.return=Ye,Ye=je;break e}else{A(Ye,je);break}else g(Ye,je);je=je.sibling}je=bg(rt,Ye.mode,Mt),je.return=Ye,Ye=je}return se(Ye);case Qt:return fr=rt._init,Ui(Ye,je,fr(rt._payload),Mt)}if(Jn(rt))return Zt(Ye,je,rt,Mt);if(wt(rt))return rr(Ye,je,rt,Mt);Uc(Ye,rt)}return typeof rt=="string"&&rt!==""||typeof rt=="number"?(rt=""+rt,je!==null&&je.tag===6?(A(Ye,je.sibling),je=N(je,rt),je.return=Ye,Ye=je):(A(Ye,je),je=vg(rt,Ye.mode,Mt),je.return=Ye,Ye=je),se(Ye)):A(Ye,je)}return Ui}var os=Kd(!0),Du=Kd(!1),zt=xn(null),tr=null,Ma=null,Jo=null;function jc(){Jo=Ma=tr=null}function Bn(p){var g=zt.current;Jr(zt),p._currentValue=g}function Ch(p,g,A){for(;p!==null;){var P=p.alternate;if((p.childLanes&g)!==g?(p.childLanes|=g,P!==null&&(P.childLanes|=g)):P!==null&&(P.childLanes&g)!==g&&(P.childLanes|=g),p===A)break;p=p.return}}function Ln(p,g){tr=p,Jo=Ma=null,p=p.dependencies,p!==null&&p.firstContext!==null&&((p.lanes&g)!==0&&(ao=!0),p.firstContext=null)}function no(p){var g=p._currentValue;if(Jo!==p)if(p={context:p,memoizedValue:g,next:null},Ma===null){if(tr===null)throw Error(r(308));Ma=p,tr.dependencies={lanes:0,firstContext:p}}else Ma=Ma.next=p;return g}var Bo=null;function Zr(p){Bo===null?Bo=[p]:Bo.push(p)}function Pi(p,g,A,P){var N=g.interleaved;return N===null?(A.next=A,Zr(g)):(A.next=N.next,N.next=A),g.interleaved=A,so(p,P)}function so(p,g){p.lanes|=g;var A=p.alternate;for(A!==null&&(A.lanes|=g),A=p,p=p.return;p!==null;)p.childLanes|=g,A=p.alternate,A!==null&&(A.childLanes|=g),A=p,p=p.return;return A.tag===3?A.stateNode:null}var Hs=!1;function ul(p){p.updateQueue={baseState:p.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Mh(p,g){p=p.updateQueue,g.updateQueue===p&&(g.updateQueue={baseState:p.baseState,firstBaseUpdate:p.firstBaseUpdate,lastBaseUpdate:p.lastBaseUpdate,shared:p.shared,effects:p.effects})}function Cs(p,g){return{eventTime:p,lane:g,tag:0,payload:null,callback:null,next:null}}function Ms(p,g,A){var P=p.updateQueue;if(P===null)return null;if(P=P.shared,(Or&2)!==0){var N=P.pending;return N===null?g.next=g:(g.next=N.next,N.next=g),P.pending=g,so(p,A)}return N=P.interleaved,N===null?(g.next=g,Zr(P)):(g.next=N.next,N.next=g),P.interleaved=g,so(p,A)}function hl(p,g,A){if(g=g.updateQueue,g!==null&&(g=g.shared,(A&4194240)!==0)){var P=g.lanes;P&=p.pendingLanes,A|=P,g.lanes=A,ie(p,A)}}function Nu(p,g){var A=p.updateQueue,P=p.alternate;if(P!==null&&(P=P.updateQueue,A===P)){var N=null,j=null;if(A=A.firstBaseUpdate,A!==null){do{var se={eventTime:A.eventTime,lane:A.lane,tag:A.tag,payload:A.payload,callback:A.callback,next:null};j===null?N=j=se:j=j.next=se,A=A.next}while(A!==null);j===null?N=j=g:j=j.next=g}else N=j=g;A={baseState:P.baseState,firstBaseUpdate:N,lastBaseUpdate:j,shared:P.shared,effects:P.effects},p.updateQueue=A;return}p=A.lastBaseUpdate,p===null?A.firstBaseUpdate=g:p.next=g,A.lastBaseUpdate=g}function Qo(p,g,A,P){var N=p.updateQueue;Hs=!1;var j=N.firstBaseUpdate,se=N.lastBaseUpdate,Ae=N.shared.pending;if(Ae!==null){N.shared.pending=null;var Ie=Ae,ot=Ie.next;Ie.next=null,se===null?j=ot:se.next=ot,se=Ie;var xt=p.alternate;xt!==null&&(xt=xt.updateQueue,Ae=xt.lastBaseUpdate,Ae!==se&&(Ae===null?xt.firstBaseUpdate=ot:Ae.next=ot,xt.lastBaseUpdate=Ie))}if(j!==null){var yt=N.baseState;se=0,xt=ot=Ie=null,Ae=j;do{var gt=Ae.lane,jt=Ae.eventTime;if((P&gt)===gt){xt!==null&&(xt=xt.next={eventTime:jt,lane:0,tag:Ae.tag,payload:Ae.payload,callback:Ae.callback,next:null});e:{var Zt=p,rr=Ae;switch(gt=g,jt=A,rr.tag){case 1:if(Zt=rr.payload,typeof Zt=="function"){yt=Zt.call(jt,yt,gt);break e}yt=Zt;break e;case 3:Zt.flags=Zt.flags&-65537|128;case 0:if(Zt=rr.payload,gt=typeof Zt=="function"?Zt.call(jt,yt,gt):Zt,gt==null)break e;yt=Bt({},yt,gt);break e;case 2:Hs=!0}}Ae.callback!==null&&Ae.lane!==0&&(p.flags|=64,gt=N.effects,gt===null?N.effects=[Ae]:gt.push(Ae))}else jt={eventTime:jt,lane:gt,tag:Ae.tag,payload:Ae.payload,callback:Ae.callback,next:null},xt===null?(ot=xt=jt,Ie=yt):xt=xt.next=jt,se|=gt;if(Ae=Ae.next,Ae===null){if(Ae=N.shared.pending,Ae===null)break;gt=Ae,Ae=gt.next,gt.next=null,N.lastBaseUpdate=gt,N.shared.pending=null}}while(!0);if(xt===null&&(Ie=yt),N.baseState=Ie,N.firstBaseUpdate=ot,N.lastBaseUpdate=xt,g=N.shared.interleaved,g!==null){N=g;do se|=N.lane,N=N.next;while(N!==g)}else j===null&&(N.shared.lanes=0);Hc|=se,p.lanes=se,p.memoizedState=yt}}function Ph(p,g,A){if(p=g.effects,g.effects=null,p!==null)for(g=0;g<p.length;g++){var P=p[g],N=P.callback;if(N!==null){if(P.callback=null,P=A,typeof N!="function")throw Error(r(191,N));N.call(P)}}}var Ul={},Ws=xn(Ul),jl=xn(Ul),b=xn(Ul);function n(p){if(p===Ul)throw Error(r(174));return p}function d(p,g){switch(Br(b,g),Br(jl,p),Br(Ws,Ul),p=g.nodeType,p){case 9:case 11:g=(g=g.documentElement)?g.namespaceURI:Ds(null,"");break;default:p=p===8?g.parentNode:g,g=p.namespaceURI||null,p=p.tagName,g=Ds(g,p)}Jr(Ws),Br(Ws,g)}function m(){Jr(Ws),Jr(jl),Jr(b)}function y(p){n(b.current);var g=n(Ws.current),A=Ds(g,p.type);g!==A&&(Br(jl,p),Br(Ws,A))}function x(p){jl.current===p&&(Jr(Ws),Jr(jl))}var S=xn(0);function I(p){for(var g=p;g!==null;){if(g.tag===13){var A=g.memoizedState;if(A!==null&&(A=A.dehydrated,A===null||A.data==="$?"||A.data==="$!"))return g}else if(g.tag===19&&g.memoizedProps.revealOrder!==void 0){if((g.flags&128)!==0)return g}else if(g.child!==null){g.child.return=g,g=g.child;continue}if(g===p)break;for(;g.sibling===null;){if(g.return===null||g.return===p)return null;g=g.return}g.sibling.return=g.return,g=g.sibling}return null}var B=[];function F(){for(var p=0;p<B.length;p++)B[p]._workInProgressVersionPrimary=null;B.length=0}var U=we.ReactCurrentDispatcher,W=we.ReactCurrentBatchConfig,G=0,q=null,J=null,le=null,de=!1,pe=!1,ge=0,xe=0;function _e(){throw Error(r(321))}function Te(p,g){if(g===null)return!1;for(var A=0;A<g.length&&A<p.length;A++)if(!Ro(p[A],g[A]))return!1;return!0}function Pe(p,g,A,P,N,j){if(G=j,q=g,g.memoizedState=null,g.updateQueue=null,g.lanes=0,U.current=p===null||p.memoizedState===null?nn:Ou,p=A(P,N),pe){j=0;do{if(pe=!1,ge=0,25<=j)throw Error(r(301));j+=1,le=J=null,g.updateQueue=null,U.current=Vc,p=A(P,N)}while(pe)}if(U.current=us,g=J!==null&&J.next!==null,G=0,le=J=q=null,de=!1,g)throw Error(r(300));return p}function ve(){var p=ge!==0;return ge=0,p}function Re(){var p={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return le===null?q.memoizedState=le=p:le=le.next=p,le}function $e(){if(J===null){var p=q.alternate;p=p!==null?p.memoizedState:null}else p=J.next;var g=le===null?q.memoizedState:le.next;if(g!==null)le=g,J=p;else{if(p===null)throw Error(r(310));J=p,p={memoizedState:J.memoizedState,baseState:J.baseState,baseQueue:J.baseQueue,queue:J.queue,next:null},le===null?q.memoizedState=le=p:le=le.next=p}return le}function We(p,g){return typeof g=="function"?g(p):g}function qe(p){var g=$e(),A=g.queue;if(A===null)throw Error(r(311));A.lastRenderedReducer=p;var P=J,N=P.baseQueue,j=A.pending;if(j!==null){if(N!==null){var se=N.next;N.next=j.next,j.next=se}P.baseQueue=N=j,A.pending=null}if(N!==null){j=N.next,P=P.baseState;var Ae=se=null,Ie=null,ot=j;do{var xt=ot.lane;if((G&xt)===xt)Ie!==null&&(Ie=Ie.next={lane:0,action:ot.action,hasEagerState:ot.hasEagerState,eagerState:ot.eagerState,next:null}),P=ot.hasEagerState?ot.eagerState:p(P,ot.action);else{var yt={lane:xt,action:ot.action,hasEagerState:ot.hasEagerState,eagerState:ot.eagerState,next:null};Ie===null?(Ae=Ie=yt,se=P):Ie=Ie.next=yt,q.lanes|=xt,Hc|=xt}ot=ot.next}while(ot!==null&&ot!==j);Ie===null?se=P:Ie.next=Ae,Ro(P,g.memoizedState)||(ao=!0),g.memoizedState=P,g.baseState=se,g.baseQueue=Ie,A.lastRenderedState=P}if(p=A.interleaved,p!==null){N=p;do j=N.lane,q.lanes|=j,Hc|=j,N=N.next;while(N!==p)}else N===null&&(A.lanes=0);return[g.memoizedState,A.dispatch]}function Qe(p){var g=$e(),A=g.queue;if(A===null)throw Error(r(311));A.lastRenderedReducer=p;var P=A.dispatch,N=A.pending,j=g.memoizedState;if(N!==null){A.pending=null;var se=N=N.next;do j=p(j,se.action),se=se.next;while(se!==N);Ro(j,g.memoizedState)||(ao=!0),g.memoizedState=j,g.baseQueue===null&&(g.baseState=j),A.lastRenderedState=j}return[j,P]}function bt(){}function Et(p,g){var A=q,P=$e(),N=g(),j=!Ro(P.memoizedState,N);if(j&&(P.memoizedState=N,ao=!0),P=P.queue,tn(Ar.bind(null,A,P,p),[p]),P.getSnapshot!==g||j||le!==null&&le.memoizedState.tag&1){if(A.flags|=2048,ai(9,Ut.bind(null,A,P,N,g),void 0,null),fn===null)throw Error(r(349));(G&30)!==0||ut(A,g,N)}return N}function ut(p,g,A){p.flags|=16384,p={getSnapshot:g,value:A},g=q.updateQueue,g===null?(g={lastEffect:null,stores:null},q.updateQueue=g,g.stores=[p]):(A=g.stores,A===null?g.stores=[p]:A.push(p))}function Ut(p,g,A,P){g.value=A,g.getSnapshot=P,Ur(g)&&ei(p)}function Ar(p,g,A){return A(function(){Ur(g)&&ei(p)})}function Ur(p){var g=p.getSnapshot;p=p.value;try{var A=g();return!Ro(p,A)}catch{return!0}}function ei(p){var g=so(p,1);g!==null&&La(g,p,1,-1)}function Xr(p){var g=Re();return typeof p=="function"&&(p=p()),g.memoizedState=g.baseState=p,p={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:We,lastRenderedState:p},g.queue=p,p=p.dispatch=cs.bind(null,q,p),[g.memoizedState,p]}function ai(p,g,A,P){return p={tag:p,create:g,destroy:A,deps:P,next:null},g=q.updateQueue,g===null?(g={lastEffect:null,stores:null},q.updateQueue=g,g.lastEffect=p.next=p):(A=g.lastEffect,A===null?g.lastEffect=p.next=p:(P=A.next,A.next=p,p.next=P,g.lastEffect=p)),p}function wi(){return $e().memoizedState}function yr(p,g,A,P){var N=Re();q.flags|=p,N.memoizedState=ai(1|g,A,void 0,P===void 0?null:P)}function Hr(p,g,A,P){var N=$e();P=P===void 0?null:P;var j=void 0;if(J!==null){var se=J.memoizedState;if(j=se.destroy,P!==null&&Te(P,se.deps)){N.memoizedState=ai(g,A,j,P);return}}q.flags|=p,N.memoizedState=ai(1|g,A,j,P)}function Zi(p,g){return yr(8390656,8,p,g)}function tn(p,g){return Hr(2048,8,p,g)}function dn(p,g){return Hr(4,2,p,g)}function as(p,g){return Hr(4,4,p,g)}function oo(p,g){if(typeof g=="function")return p=p(),g(p),function(){g(null)};if(g!=null)return p=p(),g.current=p,function(){g.current=null}}function Pa(p,g,A){return A=A!=null?A.concat([p]):null,Hr(4,4,oo.bind(null,g,p),A)}function ea(){}function Vl(p,g){var A=$e();g=g===void 0?null:g;var P=A.memoizedState;return P!==null&&g!==null&&Te(g,P[1])?P[0]:(A.memoizedState=[p,g],p)}function Gl(p,g){var A=$e();g=g===void 0?null:g;var P=A.memoizedState;return P!==null&&g!==null&&Te(g,P[1])?P[0]:(p=p(),A.memoizedState=[p,g],p)}function dl(p,g,A){return(G&21)===0?(p.baseState&&(p.baseState=!1,ao=!0),p.memoizedState=A):(Ro(A,g)||(A=Ao(),q.lanes|=A,Hc|=A,p.baseState=!0),g)}function Hl(p,g){var A=ce;ce=A!==0&&4>A?A:4,p(!0);var P=W.transition;W.transition={};try{p(!1),g()}finally{ce=A,W.transition=P}}function ls(){return $e().memoizedState}function Lo(p,g,A){var P=ml(p);if(A={lane:P,action:A,hasEagerState:!1,eagerState:null,next:null},Ra(p))Xi(g,A);else if(A=Pi(p,g,A,P),A!==null){var N=Dn();La(A,p,P,N),rn(A,g,P)}}function cs(p,g,A){var P=ml(p),N={lane:P,action:A,hasEagerState:!1,eagerState:null,next:null};if(Ra(p))Xi(g,N);else{var j=p.alternate;if(p.lanes===0&&(j===null||j.lanes===0)&&(j=g.lastRenderedReducer,j!==null))try{var se=g.lastRenderedState,Ae=j(se,A);if(N.hasEagerState=!0,N.eagerState=Ae,Ro(Ae,se)){var Ie=g.interleaved;Ie===null?(N.next=N,Zr(g)):(N.next=Ie.next,Ie.next=N),g.interleaved=N;return}}catch{}finally{}A=Pi(p,g,N,P),A!==null&&(N=Dn(),La(A,p,P,N),rn(A,g,P))}}function Ra(p){var g=p.alternate;return p===q||g!==null&&g===q}function Xi(p,g){pe=de=!0;var A=p.pending;A===null?g.next=g:(g.next=A.next,A.next=g),p.pending=g}function rn(p,g,A){if((A&4194240)!==0){var P=g.lanes;P&=p.pendingLanes,A|=P,g.lanes=A,ie(p,A)}}var us={readContext:no,useCallback:_e,useContext:_e,useEffect:_e,useImperativeHandle:_e,useInsertionEffect:_e,useLayoutEffect:_e,useMemo:_e,useReducer:_e,useRef:_e,useState:_e,useDebugValue:_e,useDeferredValue:_e,useTransition:_e,useMutableSource:_e,useSyncExternalStore:_e,useId:_e,unstable_isNewReconciler:!1},nn={readContext:no,useCallback:function(p,g){return Re().memoizedState=[p,g===void 0?null:g],p},useContext:no,useEffect:Zi,useImperativeHandle:function(p,g,A){return A=A!=null?A.concat([p]):null,yr(4194308,4,oo.bind(null,g,p),A)},useLayoutEffect:function(p,g){return yr(4194308,4,p,g)},useInsertionEffect:function(p,g){return yr(4,2,p,g)},useMemo:function(p,g){var A=Re();return g=g===void 0?null:g,p=p(),A.memoizedState=[p,g],p},useReducer:function(p,g,A){var P=Re();return g=A!==void 0?A(g):g,P.memoizedState=P.baseState=g,p={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:p,lastRenderedState:g},P.queue=p,p=p.dispatch=Lo.bind(null,q,p),[P.memoizedState,p]},useRef:function(p){var g=Re();return p={current:p},g.memoizedState=p},useState:Xr,useDebugValue:ea,useDeferredValue:function(p){return Re().memoizedState=p},useTransition:function(){var p=Xr(!1),g=p[0];return p=Hl.bind(null,p[1]),Re().memoizedState=p,[g,p]},useMutableSource:function(){},useSyncExternalStore:function(p,g,A){var P=q,N=Re();if(vi){if(A===void 0)throw Error(r(407));A=A()}else{if(A=g(),fn===null)throw Error(r(349));(G&30)!==0||ut(P,g,A)}N.memoizedState=A;var j={value:A,getSnapshot:g};return N.queue=j,Zi(Ar.bind(null,P,j,p),[p]),P.flags|=2048,ai(9,Ut.bind(null,P,j,A,g),void 0,null),A},useId:function(){var p=Re(),g=fn.identifierPrefix;if(vi){var A=ss,P=Ss;A=(P&~(1<<32-Rn(P)-1)).toString(32)+A,g=":"+g+"R"+A,A=ge++,0<A&&(g+="H"+A.toString(32)),g+=":"}else A=xe++,g=":"+g+"r"+A.toString(32)+":";return p.memoizedState=g},unstable_isNewReconciler:!1},Ou={readContext:no,useCallback:Vl,useContext:no,useEffect:tn,useImperativeHandle:Pa,useInsertionEffect:dn,useLayoutEffect:as,useMemo:Gl,useReducer:qe,useRef:wi,useState:function(){return qe(We)},useDebugValue:ea,useDeferredValue:function(p){var g=$e();return dl(g,J.memoizedState,p)},useTransition:function(){var p=qe(We)[0],g=$e().memoizedState;return[p,g]},useMutableSource:bt,useSyncExternalStore:Et,useId:ls,unstable_isNewReconciler:!1},Vc={readContext:no,useCallback:Vl,useContext:no,useEffect:tn,useImperativeHandle:Pa,useInsertionEffect:dn,useLayoutEffect:as,useMemo:Gl,useReducer:Qe,useRef:wi,useState:function(){return Qe(We)},useDebugValue:ea,useDeferredValue:function(p){var g=$e();return J===null?g.memoizedState=p:dl(g,J.memoizedState,p)},useTransition:function(){var p=Qe(We)[0],g=$e().memoizedState;return[p,g]},useMutableSource:bt,useSyncExternalStore:Et,useId:ls,unstable_isNewReconciler:!1};function pn(p,g){if(p&&p.defaultProps){g=Bt({},g),p=p.defaultProps;for(var A in p)g[A]===void 0&&(g[A]=p[A]);return g}return g}function qs(p,g,A,P){g=p.memoizedState,A=A(P,g),A=A==null?g:Bt({},g,A),p.memoizedState=A,p.lanes===0&&(p.updateQueue.baseState=A)}var Do={isMounted:function(p){return(p=p._reactInternals)?cr(p)===p:!1},enqueueSetState:function(p,g,A){p=p._reactInternals;var P=Dn(),N=ml(p),j=Cs(P,N);j.payload=g,A!=null&&(j.callback=A),g=Ms(p,j,N),g!==null&&(La(g,p,N,P),hl(g,p,N))},enqueueReplaceState:function(p,g,A){p=p._reactInternals;var P=Dn(),N=ml(p),j=Cs(P,N);j.tag=1,j.payload=g,A!=null&&(j.callback=A),g=Ms(p,j,N),g!==null&&(La(g,p,N,P),hl(g,p,N))},enqueueForceUpdate:function(p,g){p=p._reactInternals;var A=Dn(),P=ml(p),N=Cs(A,P);N.tag=2,g!=null&&(N.callback=g),g=Ms(p,N,P),g!==null&&(La(g,p,P,A),hl(g,p,P))}};function Yd(p,g,A,P,N,j,se){return p=p.stateNode,typeof p.shouldComponentUpdate=="function"?p.shouldComponentUpdate(P,j,se):g.prototype&&g.prototype.isPureReactComponent?!bu(A,P)||!bu(N,j):!0}function Ps(p,g,A){var P=!1,N=js,j=g.contextType;return typeof j=="object"&&j!==null?j=no(j):(N=Vn(g)?al:wn.current,P=g.contextTypes,j=(P=P!=null)?ko(p,N):js),g=new g(A,j),p.memoizedState=g.state!==null&&g.state!==void 0?g.state:null,g.updater=Do,p.stateNode=g,g._reactInternals=p,P&&(p=p.stateNode,p.__reactInternalMemoizedUnmaskedChildContext=N,p.__reactInternalMemoizedMaskedChildContext=j),g}function Jd(p,g,A,P){p=g.state,typeof g.componentWillReceiveProps=="function"&&g.componentWillReceiveProps(A,P),typeof g.UNSAFE_componentWillReceiveProps=="function"&&g.UNSAFE_componentWillReceiveProps(A,P),g.state!==p&&Do.enqueueReplaceState(g,g.state,null)}function Fu(p,g,A,P){var N=p.stateNode;N.props=A,N.state=p.memoizedState,N.refs={},ul(p);var j=g.contextType;typeof j=="object"&&j!==null?N.context=no(j):(j=Vn(g)?al:wn.current,N.context=ko(p,j)),N.state=p.memoizedState,j=g.getDerivedStateFromProps,typeof j=="function"&&(qs(p,g,j,A),N.state=p.memoizedState),typeof g.getDerivedStateFromProps=="function"||typeof N.getSnapshotBeforeUpdate=="function"||typeof N.UNSAFE_componentWillMount!="function"&&typeof N.componentWillMount!="function"||(g=N.state,typeof N.componentWillMount=="function"&&N.componentWillMount(),typeof N.UNSAFE_componentWillMount=="function"&&N.UNSAFE_componentWillMount(),g!==N.state&&Do.enqueueReplaceState(N,N.state,null),Qo(p,A,N,P),N.state=p.memoizedState),typeof N.componentDidMount=="function"&&(p.flags|=4194308)}function Ia(p,g){try{var A="",P=g;do A+=Tr(P),P=P.return;while(P);var N=A}catch(j){N=`
Error generating stack: `+j.message+`
`+j.stack}return{value:p,source:g,stack:N,digest:null}}function Gc(p,g,A){return{value:p,source:null,stack:A??null,digest:g??null}}function ta(p,g){try{console.error(g.value)}catch(A){setTimeout(function(){throw A})}}var ka=typeof WeakMap=="function"?WeakMap:Map;function Xm(p,g,A){A=Cs(-1,A),A.tag=3,A.payload={element:null};var P=g.value;return A.callback=function(){ff||(ff=!0,dg=P),ta(p,g)},A}function G_(p,g,A){A=Cs(-1,A),A.tag=3;var P=p.type.getDerivedStateFromError;if(typeof P=="function"){var N=g.value;A.payload=function(){return P(N)},A.callback=function(){ta(p,g)}}var j=p.stateNode;return j!==null&&typeof j.componentDidCatch=="function"&&(A.callback=function(){ta(p,g),typeof P!="function"&&(Fo===null?Fo=new Set([this]):Fo.add(this));var se=g.stack;this.componentDidCatch(g.value,{componentStack:se!==null?se:""})}),A}function cf(p,g,A){var P=p.pingCache;if(P===null){P=p.pingCache=new ka;var N=new Set;P.set(g,N)}else N=P.get(g),N===void 0&&(N=new Set,P.set(g,N));N.has(A)||(N.add(A),p=hy.bind(null,p,g,A),g.then(p,p))}function Km(p){do{var g;if((g=p.tag===13)&&(g=p.memoizedState,g=g!==null?g.dehydrated!==null:!0),g)return p;p=p.return}while(p!==null);return null}function H_(p,g,A,P,N){return(p.mode&1)===0?(p===g?p.flags|=65536:(p.flags|=128,A.flags|=131072,A.flags&=-52805,A.tag===1&&(A.alternate===null?A.tag=17:(g=Cs(-1,1),g.tag=2,Ms(A,g,1))),A.lanes|=1),p):(p.flags|=65536,p.lanes=N,p)}var W_=we.ReactCurrentOwner,ao=!1;function hs(p,g,A,P){g.child=p===null?Du(g,null,A,P):os(g,p.child,A,P)}function q_(p,g,A,P,N){A=A.render;var j=g.ref;return Ln(g,N),P=Pe(p,g,A,P,j,N),A=ve(),p!==null&&!ao?(g.updateQueue=p.updateQueue,g.flags&=-2053,p.lanes&=~N,No(p,g,N)):(vi&&A&&Fc(g),g.flags|=1,hs(p,g,P,N),g.child)}function uf(p,g,A,P,N){if(p===null){var j=A.type;return typeof j=="function"&&!mp(j)&&j.defaultProps===void 0&&A.compare===null&&A.defaultProps===void 0?(g.tag=15,g.type=j,Ym(p,g,j,P,N)):(p=bf(A.type,null,P,g,g.mode,N),p.ref=g.ref,p.return=g,g.child=p)}if(j=p.child,(p.lanes&N)===0){var se=j.memoizedProps;if(A=A.compare,A=A!==null?A:bu,A(se,P)&&p.ref===g.ref)return No(p,g,N)}return g.flags|=1,p=ql(j,P),p.ref=g.ref,p.return=g,g.child=p}function Ym(p,g,A,P,N){if(p!==null){var j=p.memoizedProps;if(bu(j,P)&&p.ref===g.ref)if(ao=!1,g.pendingProps=P=j,(p.lanes&N)!==0)(p.flags&131072)!==0&&(ao=!0);else return g.lanes=p.lanes,No(p,g,N)}return Qm(p,g,A,P,N)}function Jm(p,g,A){var P=g.pendingProps,N=P.children,j=p!==null?p.memoizedState:null;if(P.mode==="hidden")if((g.mode&1)===0)g.memoizedState={baseLanes:0,cachePool:null,transitions:null},Br(Vu,Oo),Oo|=A;else{if((A&1073741824)===0)return p=j!==null?j.baseLanes|A:A,g.lanes=g.childLanes=1073741824,g.memoizedState={baseLanes:p,cachePool:null,transitions:null},g.updateQueue=null,Br(Vu,Oo),Oo|=p,null;g.memoizedState={baseLanes:0,cachePool:null,transitions:null},P=j!==null?j.baseLanes:A,Br(Vu,Oo),Oo|=P}else j!==null?(P=j.baseLanes|A,g.memoizedState=null):P=A,Br(Vu,Oo),Oo|=P;return hs(p,g,N,A),g.child}function zu(p,g){var A=g.ref;(p===null&&A!==null||p!==null&&p.ref!==A)&&(g.flags|=512,g.flags|=2097152)}function Qm(p,g,A,P,N){var j=Vn(A)?al:wn.current;return j=ko(g,j),Ln(g,N),A=Pe(p,g,A,P,j,N),P=ve(),p!==null&&!ao?(g.updateQueue=p.updateQueue,g.flags&=-2053,p.lanes&=~N,No(p,g,N)):(vi&&P&&Fc(g),g.flags|=1,hs(p,g,A,N),g.child)}function Rh(p,g,A,P,N){if(Vn(A)){var j=!0;Es(g)}else j=!1;if(Ln(g,N),g.stateNode===null)kh(p,g),Ps(g,A,P),Fu(g,A,P,N),P=!0;else if(p===null){var se=g.stateNode,Ae=g.memoizedProps;se.props=Ae;var Ie=se.context,ot=A.contextType;typeof ot=="object"&&ot!==null?ot=no(ot):(ot=Vn(A)?al:wn.current,ot=ko(g,ot));var xt=A.getDerivedStateFromProps,yt=typeof xt=="function"||typeof se.getSnapshotBeforeUpdate=="function";yt||typeof se.UNSAFE_componentWillReceiveProps!="function"&&typeof se.componentWillReceiveProps!="function"||(Ae!==P||Ie!==ot)&&Jd(g,se,P,ot),Hs=!1;var gt=g.memoizedState;se.state=gt,Qo(g,P,se,N),Ie=g.memoizedState,Ae!==P||gt!==Ie||rs.current||Hs?(typeof xt=="function"&&(qs(g,A,xt,P),Ie=g.memoizedState),(Ae=Hs||Yd(g,A,Ae,P,gt,Ie,ot))?(yt||typeof se.UNSAFE_componentWillMount!="function"&&typeof se.componentWillMount!="function"||(typeof se.componentWillMount=="function"&&se.componentWillMount(),typeof se.UNSAFE_componentWillMount=="function"&&se.UNSAFE_componentWillMount()),typeof se.componentDidMount=="function"&&(g.flags|=4194308)):(typeof se.componentDidMount=="function"&&(g.flags|=4194308),g.memoizedProps=P,g.memoizedState=Ie),se.props=P,se.state=Ie,se.context=ot,P=Ae):(typeof se.componentDidMount=="function"&&(g.flags|=4194308),P=!1)}else{se=g.stateNode,Mh(p,g),Ae=g.memoizedProps,ot=g.type===g.elementType?Ae:pn(g.type,Ae),se.props=ot,yt=g.pendingProps,gt=se.context,Ie=A.contextType,typeof Ie=="object"&&Ie!==null?Ie=no(Ie):(Ie=Vn(A)?al:wn.current,Ie=ko(g,Ie));var jt=A.getDerivedStateFromProps;(xt=typeof jt=="function"||typeof se.getSnapshotBeforeUpdate=="function")||typeof se.UNSAFE_componentWillReceiveProps!="function"&&typeof se.componentWillReceiveProps!="function"||(Ae!==yt||gt!==Ie)&&Jd(g,se,P,Ie),Hs=!1,gt=g.memoizedState,se.state=gt,Qo(g,P,se,N);var Zt=g.memoizedState;Ae!==yt||gt!==Zt||rs.current||Hs?(typeof jt=="function"&&(qs(g,A,jt,P),Zt=g.memoizedState),(ot=Hs||Yd(g,A,ot,P,gt,Zt,Ie)||!1)?(xt||typeof se.UNSAFE_componentWillUpdate!="function"&&typeof se.componentWillUpdate!="function"||(typeof se.componentWillUpdate=="function"&&se.componentWillUpdate(P,Zt,Ie),typeof se.UNSAFE_componentWillUpdate=="function"&&se.UNSAFE_componentWillUpdate(P,Zt,Ie)),typeof se.componentDidUpdate=="function"&&(g.flags|=4),typeof se.getSnapshotBeforeUpdate=="function"&&(g.flags|=1024)):(typeof se.componentDidUpdate!="function"||Ae===p.memoizedProps&&gt===p.memoizedState||(g.flags|=4),typeof se.getSnapshotBeforeUpdate!="function"||Ae===p.memoizedProps&&gt===p.memoizedState||(g.flags|=1024),g.memoizedProps=P,g.memoizedState=Zt),se.props=P,se.state=Zt,se.context=Ie,P=ot):(typeof se.componentDidUpdate!="function"||Ae===p.memoizedProps&&gt===p.memoizedState||(g.flags|=4),typeof se.getSnapshotBeforeUpdate!="function"||Ae===p.memoizedProps&&gt===p.memoizedState||(g.flags|=1024),P=!1)}return Ih(p,g,A,P,j,N)}function Ih(p,g,A,P,N,j){zu(p,g);var se=(g.flags&128)!==0;if(!P&&!se)return N&&zl(g,A,!1),No(p,g,j);P=g.stateNode,W_.current=g;var Ae=se&&typeof A.getDerivedStateFromError!="function"?null:P.render();return g.flags|=1,p!==null&&se?(g.child=os(g,p.child,null,j),g.child=os(g,null,Ae,j)):hs(p,g,Ae,j),g.memoizedState=P.state,N&&zl(g,A,!0),g.child}function Qd(p){var g=p.stateNode;g.pendingContext?Hd(p,g.pendingContext,g.pendingContext!==g.context):g.context&&Hd(p,g.context,!1),d(p,g.containerInfo)}function eg(p,g,A,P,N){return Qr(),cl(N),g.flags|=256,hs(p,g,A,P),g.child}var hf={dehydrated:null,treeContext:null,retryLane:0};function tg(p){return{baseLanes:p,cachePool:null,transitions:null}}function $_(p,g,A){var P=g.pendingProps,N=S.current,j=!1,se=(g.flags&128)!==0,Ae;if((Ae=se)||(Ae=p!==null&&p.memoizedState===null?!1:(N&2)!==0),Ae?(j=!0,g.flags&=-129):(p===null||p.memoizedState!==null)&&(N|=1),Br(S,N&1),p===null)return Bu(g),p=g.memoizedState,p!==null&&(p=p.dehydrated,p!==null)?((g.mode&1)===0?g.lanes=1:p.data==="$!"?g.lanes=8:g.lanes=1073741824,null):(se=P.children,p=P.fallback,j?(P=g.mode,j=g.child,se={mode:"hidden",children:se},(P&1)===0&&j!==null?(j.childLanes=0,j.pendingProps=se):j=xf(se,P,0,null),p=qu(p,P,A,null),j.return=g,p.return=g,j.sibling=p,g.child=j,g.child.memoizedState=tg(A),g.memoizedState=hf,p):df(g,se));if(N=p.memoizedState,N!==null&&(Ae=N.dehydrated,Ae!==null))return Z_(p,g,se,P,Ae,N,A);if(j){j=P.fallback,se=g.mode,N=p.child,Ae=N.sibling;var Ie={mode:"hidden",children:P.children};return(se&1)===0&&g.child!==N?(P=g.child,P.childLanes=0,P.pendingProps=Ie,g.deletions=null):(P=ql(N,Ie),P.subtreeFlags=N.subtreeFlags&14680064),Ae!==null?j=ql(Ae,j):(j=qu(j,se,A,null),j.flags|=2),j.return=g,P.return=g,P.sibling=j,g.child=P,P=j,j=g.child,se=p.child.memoizedState,se=se===null?tg(A):{baseLanes:se.baseLanes|A,cachePool:null,transitions:se.transitions},j.memoizedState=se,j.childLanes=p.childLanes&~A,g.memoizedState=hf,P}return j=p.child,p=j.sibling,P=ql(j,{mode:"visible",children:P.children}),(g.mode&1)===0&&(P.lanes=A),P.return=g,P.sibling=null,p!==null&&(A=g.deletions,A===null?(g.deletions=[p],g.flags|=16):A.push(p)),g.child=P,g.memoizedState=null,P}function df(p,g){return g=xf({mode:"visible",children:g},p.mode,0,null),g.return=p,p.child=g}function ep(p,g,A,P){return P!==null&&cl(P),os(g,p.child,null,A),p=df(g,g.pendingProps.children),p.flags|=2,g.memoizedState=null,p}function Z_(p,g,A,P,N,j,se){if(A)return g.flags&256?(g.flags&=-257,P=Gc(Error(r(422))),ep(p,g,se,P)):g.memoizedState!==null?(g.child=p.child,g.flags|=128,null):(j=P.fallback,N=g.mode,P=xf({mode:"visible",children:P.children},N,0,null),j=qu(j,N,se,null),j.flags|=2,P.return=g,j.return=g,P.sibling=j,g.child=P,(g.mode&1)!==0&&os(g,p.child,null,se),g.child.memoizedState=tg(se),g.memoizedState=hf,j);if((g.mode&1)===0)return ep(p,g,se,null);if(N.data==="$!"){if(P=N.nextSibling&&N.nextSibling.dataset,P)var Ae=P.dgst;return P=Ae,j=Error(r(419)),P=Gc(j,P,void 0),ep(p,g,se,P)}if(Ae=(se&p.childLanes)!==0,ao||Ae){if(P=fn,P!==null){switch(se&-se){case 4:N=2;break;case 16:N=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:N=32;break;case 536870912:N=268435456;break;default:N=0}N=(N&(P.suspendedLanes|se))!==0?0:N,N!==0&&N!==j.retryLane&&(j.retryLane=N,so(p,N),La(P,p,N,-1))}return hp(),P=Gc(Error(r(421))),ep(p,g,se,P)}return N.data==="$?"?(g.flags|=128,g.child=p.child,g=G1.bind(null,p),N._reactRetry=g,null):(p=j.treeContext,Vs=Yr(N.nextSibling),Gn=g,vi=!0,Gs=null,p!==null&&(Ts[ns++]=Ss,Ts[ns++]=ss,Ts[ns++]=Ca,Ss=p.id,ss=p.overflow,Ca=g),g=df(g,P.children),g.flags|=4096,g)}function X_(p,g,A){p.lanes|=g;var P=p.alternate;P!==null&&(P.lanes|=g),Ch(p.return,g,A)}function tp(p,g,A,P,N){var j=p.memoizedState;j===null?p.memoizedState={isBackwards:g,rendering:null,renderingStartTime:0,last:P,tail:A,tailMode:N}:(j.isBackwards=g,j.rendering=null,j.renderingStartTime=0,j.last=P,j.tail=A,j.tailMode=N)}function rg(p,g,A){var P=g.pendingProps,N=P.revealOrder,j=P.tail;if(hs(p,g,P.children,A),P=S.current,(P&2)!==0)P=P&1|2,g.flags|=128;else{if(p!==null&&(p.flags&128)!==0)e:for(p=g.child;p!==null;){if(p.tag===13)p.memoizedState!==null&&X_(p,A,g);else if(p.tag===19)X_(p,A,g);else if(p.child!==null){p.child.return=p,p=p.child;continue}if(p===g)break e;for(;p.sibling===null;){if(p.return===null||p.return===g)break e;p=p.return}p.sibling.return=p.return,p=p.sibling}P&=1}if(Br(S,P),(g.mode&1)===0)g.memoizedState=null;else switch(N){case"forwards":for(A=g.child,N=null;A!==null;)p=A.alternate,p!==null&&I(p)===null&&(N=A),A=A.sibling;A=N,A===null?(N=g.child,g.child=null):(N=A.sibling,A.sibling=null),tp(g,!1,N,A,j);break;case"backwards":for(A=null,N=g.child,g.child=null;N!==null;){if(p=N.alternate,p!==null&&I(p)===null){g.child=N;break}p=N.sibling,N.sibling=A,A=N,N=p}tp(g,!0,A,null,j);break;case"together":tp(g,!1,null,null,void 0);break;default:g.memoizedState=null}return g.child}function kh(p,g){(g.mode&1)===0&&p!==null&&(p.alternate=null,g.alternate=null,g.flags|=2)}function No(p,g,A){if(p!==null&&(g.dependencies=p.dependencies),Hc|=g.lanes,(A&g.childLanes)===0)return null;if(p!==null&&g.child!==p.child)throw Error(r(153));if(g.child!==null){for(p=g.child,A=ql(p,p.pendingProps),g.child=A,A.return=g;p.sibling!==null;)p=p.sibling,A=A.sibling=ql(p,p.pendingProps),A.return=g;A.sibling=null}return g.child}function $s(p,g,A){switch(g.tag){case 3:Qd(g),Qr();break;case 5:y(g);break;case 1:Vn(g.type)&&Es(g);break;case 4:d(g,g.stateNode.containerInfo);break;case 10:var P=g.type._context,N=g.memoizedProps.value;Br(zt,P._currentValue),P._currentValue=N;break;case 13:if(P=g.memoizedState,P!==null)return P.dehydrated!==null?(Br(S,S.current&1),g.flags|=128,null):(A&g.child.childLanes)!==0?$_(p,g,A):(Br(S,S.current&1),p=No(p,g,A),p!==null?p.sibling:null);Br(S,S.current&1);break;case 19:if(P=(A&g.childLanes)!==0,(p.flags&128)!==0){if(P)return rg(p,g,A);g.flags|=128}if(N=g.memoizedState,N!==null&&(N.rendering=null,N.tail=null,N.lastEffect=null),Br(S,S.current),P)break;return null;case 22:case 23:return g.lanes=0,Jm(p,g,A)}return No(p,g,A)}var ig,rp,K_,ng;ig=function(p,g){for(var A=g.child;A!==null;){if(A.tag===5||A.tag===6)p.appendChild(A.stateNode);else if(A.tag!==4&&A.child!==null){A.child.return=A,A=A.child;continue}if(A===g)break;for(;A.sibling===null;){if(A.return===null||A.return===g)return;A=A.return}A.sibling.return=A.return,A=A.sibling}},rp=function(){},K_=function(p,g,A,P){var N=p.memoizedProps;if(N!==P){p=g.stateNode,n(Ws.current);var j=null;switch(A){case"input":N=ri(p,N),P=ri(p,P),j=[];break;case"select":N=Bt({},N,{value:void 0}),P=Bt({},P,{value:void 0}),j=[];break;case"textarea":N=Js(p,N),P=Js(p,P),j=[];break;default:typeof N.onClick!="function"&&typeof P.onClick=="function"&&(p.onclick=Lc)}Ze(A,P);var se;A=null;for(ot in N)if(!P.hasOwnProperty(ot)&&N.hasOwnProperty(ot)&&N[ot]!=null)if(ot==="style"){var Ae=N[ot];for(se in Ae)Ae.hasOwnProperty(se)&&(A||(A={}),A[se]="")}else ot!=="dangerouslySetInnerHTML"&&ot!=="children"&&ot!=="suppressContentEditableWarning"&&ot!=="suppressHydrationWarning"&&ot!=="autoFocus"&&(s.hasOwnProperty(ot)?j||(j=[]):(j=j||[]).push(ot,null));for(ot in P){var Ie=P[ot];if(Ae=N?.[ot],P.hasOwnProperty(ot)&&Ie!==Ae&&(Ie!=null||Ae!=null))if(ot==="style")if(Ae){for(se in Ae)!Ae.hasOwnProperty(se)||Ie&&Ie.hasOwnProperty(se)||(A||(A={}),A[se]="");for(se in Ie)Ie.hasOwnProperty(se)&&Ae[se]!==Ie[se]&&(A||(A={}),A[se]=Ie[se])}else A||(j||(j=[]),j.push(ot,A)),A=Ie;else ot==="dangerouslySetInnerHTML"?(Ie=Ie?Ie.__html:void 0,Ae=Ae?Ae.__html:void 0,Ie!=null&&Ae!==Ie&&(j=j||[]).push(ot,Ie)):ot==="children"?typeof Ie!="string"&&typeof Ie!="number"||(j=j||[]).push(ot,""+Ie):ot!=="suppressContentEditableWarning"&&ot!=="suppressHydrationWarning"&&(s.hasOwnProperty(ot)?(Ie!=null&&ot==="onScroll"&&gi("scroll",p),j||Ae===Ie||(j=[])):(j=j||[]).push(ot,Ie))}A&&(j=j||[]).push("style",A);var ot=j;(g.updateQueue=ot)&&(g.flags|=4)}},ng=function(p,g,A,P){A!==P&&(g.flags|=4)};function ip(p,g){if(!vi)switch(p.tailMode){case"hidden":g=p.tail;for(var A=null;g!==null;)g.alternate!==null&&(A=g),g=g.sibling;A===null?p.tail=null:A.sibling=null;break;case"collapsed":A=p.tail;for(var P=null;A!==null;)A.alternate!==null&&(P=A),A=A.sibling;P===null?g||p.tail===null?p.tail=null:p.tail.sibling=null:P.sibling=null}}function Rs(p){var g=p.alternate!==null&&p.alternate.child===p.child,A=0,P=0;if(g)for(var N=p.child;N!==null;)A|=N.lanes|N.childLanes,P|=N.subtreeFlags&14680064,P|=N.flags&14680064,N.return=p,N=N.sibling;else for(N=p.child;N!==null;)A|=N.lanes|N.childLanes,P|=N.subtreeFlags,P|=N.flags,N.return=p,N=N.sibling;return p.subtreeFlags|=P,p.childLanes=A,g}function Y_(p,g,A){var P=g.pendingProps;switch(qd(g),g.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Rs(g),null;case 1:return Vn(g.type)&&Ta(),Rs(g),null;case 3:return P=g.stateNode,m(),Jr(rs),Jr(wn),F(),P.pendingContext&&(P.context=P.pendingContext,P.pendingContext=null),(p===null||p.child===null)&&(Lu(g)?g.flags|=4:p===null||p.memoizedState.isDehydrated&&(g.flags&256)===0||(g.flags|=1024,Gs!==null&&(fg(Gs),Gs=null))),rp(p,g),Rs(g),null;case 5:x(g);var N=n(b.current);if(A=g.type,p!==null&&g.stateNode!=null)K_(p,g,A,P,N),p.ref!==g.ref&&(g.flags|=512,g.flags|=2097152);else{if(!P){if(g.stateNode===null)throw Error(r(166));return Rs(g),null}if(p=n(Ws.current),Lu(g)){P=g.stateNode,A=g.type;var j=g.memoizedProps;switch(P[Us]=g,P[xa]=j,p=(g.mode&1)!==0,A){case"dialog":gi("cancel",P),gi("close",P);break;case"iframe":case"object":case"embed":gi("load",P);break;case"video":case"audio":for(N=0;N<Rc.length;N++)gi(Rc[N],P);break;case"source":gi("error",P);break;case"img":case"image":case"link":gi("error",P),gi("load",P);break;case"details":gi("toggle",P);break;case"input":vn(P,j),gi("invalid",P);break;case"select":P._wrapperState={wasMultiple:!!j.multiple},gi("invalid",P);break;case"textarea":_o(P,j),gi("invalid",P)}Ze(A,j),N=null;for(var se in j)if(j.hasOwnProperty(se)){var Ae=j[se];se==="children"?typeof Ae=="string"?P.textContent!==Ae&&(j.suppressHydrationWarning!==!0&&$o(P.textContent,Ae,p),N=["children",Ae]):typeof Ae=="number"&&P.textContent!==""+Ae&&(j.suppressHydrationWarning!==!0&&$o(P.textContent,Ae,p),N=["children",""+Ae]):s.hasOwnProperty(se)&&Ae!=null&&se==="onScroll"&&gi("scroll",P)}switch(A){case"input":yn(P),bs(P,j,!0);break;case"textarea":yn(P),yo(P);break;case"select":case"option":break;default:typeof j.onClick=="function"&&(P.onclick=Lc)}P=N,g.updateQueue=P,P!==null&&(g.flags|=4)}else{se=N.nodeType===9?N:N.ownerDocument,p==="http://www.w3.org/1999/xhtml"&&(p=vo(A)),p==="http://www.w3.org/1999/xhtml"?A==="script"?(p=se.createElement("div"),p.innerHTML="<script><\/script>",p=p.removeChild(p.firstChild)):typeof P.is=="string"?p=se.createElement(A,{is:P.is}):(p=se.createElement(A),A==="select"&&(se=p,P.multiple?se.multiple=!0:P.size&&(se.size=P.size))):p=se.createElementNS(p,A),p[Us]=g,p[xa]=P,ig(p,g,!1,!1),g.stateNode=p;e:{switch(se=Be(A,P),A){case"dialog":gi("cancel",p),gi("close",p),N=P;break;case"iframe":case"object":case"embed":gi("load",p),N=P;break;case"video":case"audio":for(N=0;N<Rc.length;N++)gi(Rc[N],p);N=P;break;case"source":gi("error",p),N=P;break;case"img":case"image":case"link":gi("error",p),gi("load",p),N=P;break;case"details":gi("toggle",p),N=P;break;case"input":vn(p,P),N=ri(p,P),gi("invalid",p);break;case"option":N=P;break;case"select":p._wrapperState={wasMultiple:!!P.multiple},N=Bt({},P,{value:void 0}),gi("invalid",p);break;case"textarea":_o(p,P),N=Js(p,P),gi("invalid",p);break;default:N=P}Ze(A,N),Ae=N;for(j in Ae)if(Ae.hasOwnProperty(j)){var Ie=Ae[j];j==="style"?Se(p,Ie):j==="dangerouslySetInnerHTML"?(Ie=Ie?Ie.__html:void 0,Ie!=null&&ke(p,Ie)):j==="children"?typeof Ie=="string"?(A!=="textarea"||Ie!=="")&&Q(p,Ie):typeof Ie=="number"&&Q(p,""+Ie):j!=="suppressContentEditableWarning"&&j!=="suppressHydrationWarning"&&j!=="autoFocus"&&(s.hasOwnProperty(j)?Ie!=null&&j==="onScroll"&&gi("scroll",p):Ie!=null&&ue(p,j,Ie,se))}switch(A){case"input":yn(p),bs(p,P,!1);break;case"textarea":yn(p),yo(p);break;case"option":P.value!=null&&p.setAttribute("value",""+dr(P.value));break;case"select":p.multiple=!!P.multiple,j=P.value,j!=null?mi(p,!!P.multiple,j,!1):P.defaultValue!=null&&mi(p,!!P.multiple,P.defaultValue,!0);break;default:typeof N.onClick=="function"&&(p.onclick=Lc)}switch(A){case"button":case"input":case"select":case"textarea":P=!!P.autoFocus;break e;case"img":P=!0;break e;default:P=!1}}P&&(g.flags|=4)}g.ref!==null&&(g.flags|=512,g.flags|=2097152)}return Rs(g),null;case 6:if(p&&g.stateNode!=null)ng(p,g,p.memoizedProps,P);else{if(typeof P!="string"&&g.stateNode===null)throw Error(r(166));if(A=n(b.current),n(Ws.current),Lu(g)){if(P=g.stateNode,A=g.memoizedProps,P[Us]=g,(j=P.nodeValue!==A)&&(p=Gn,p!==null))switch(p.tag){case 3:$o(P.nodeValue,A,(p.mode&1)!==0);break;case 5:p.memoizedProps.suppressHydrationWarning!==!0&&$o(P.nodeValue,A,(p.mode&1)!==0)}j&&(g.flags|=4)}else P=(A.nodeType===9?A:A.ownerDocument).createTextNode(P),P[Us]=g,g.stateNode=P}return Rs(g),null;case 13:if(Jr(S),P=g.memoizedState,p===null||p.memoizedState!==null&&p.memoizedState.dehydrated!==null){if(vi&&Vs!==null&&(g.mode&1)!==0&&(g.flags&128)===0)io(),Qr(),g.flags|=98560,j=!1;else if(j=Lu(g),P!==null&&P.dehydrated!==null){if(p===null){if(!j)throw Error(r(318));if(j=g.memoizedState,j=j!==null?j.dehydrated:null,!j)throw Error(r(317));j[Us]=g}else Qr(),(g.flags&128)===0&&(g.memoizedState=null),g.flags|=4;Rs(g),j=!1}else Gs!==null&&(fg(Gs),Gs=null),j=!0;if(!j)return g.flags&65536?g:null}return(g.flags&128)!==0?(g.lanes=A,g):(P=P!==null,P!==(p!==null&&p.memoizedState!==null)&&P&&(g.child.flags|=8192,(g.mode&1)!==0&&(p===null||(S.current&1)!==0?Ii===0&&(Ii=3):hp())),g.updateQueue!==null&&(g.flags|=4),Rs(g),null);case 4:return m(),rp(p,g),p===null&&ol(g.stateNode.containerInfo),Rs(g),null;case 10:return Bn(g.type._context),Rs(g),null;case 17:return Vn(g.type)&&Ta(),Rs(g),null;case 19:if(Jr(S),j=g.memoizedState,j===null)return Rs(g),null;if(P=(g.flags&128)!==0,se=j.rendering,se===null)if(P)ip(j,!1);else{if(Ii!==0||p!==null&&(p.flags&128)!==0)for(p=g.child;p!==null;){if(se=I(p),se!==null){for(g.flags|=128,ip(j,!1),P=se.updateQueue,P!==null&&(g.updateQueue=P,g.flags|=4),g.subtreeFlags=0,P=A,A=g.child;A!==null;)j=A,p=P,j.flags&=14680066,se=j.alternate,se===null?(j.childLanes=0,j.lanes=p,j.child=null,j.subtreeFlags=0,j.memoizedProps=null,j.memoizedState=null,j.updateQueue=null,j.dependencies=null,j.stateNode=null):(j.childLanes=se.childLanes,j.lanes=se.lanes,j.child=se.child,j.subtreeFlags=0,j.deletions=null,j.memoizedProps=se.memoizedProps,j.memoizedState=se.memoizedState,j.updateQueue=se.updateQueue,j.type=se.type,p=se.dependencies,j.dependencies=p===null?null:{lanes:p.lanes,firstContext:p.firstContext}),A=A.sibling;return Br(S,S.current&1|2),g.child}p=p.sibling}j.tail!==null&&br()>zh&&(g.flags|=128,P=!0,ip(j,!1),g.lanes=4194304)}else{if(!P)if(p=I(se),p!==null){if(g.flags|=128,P=!0,A=p.updateQueue,A!==null&&(g.updateQueue=A,g.flags|=4),ip(j,!0),j.tail===null&&j.tailMode==="hidden"&&!se.alternate&&!vi)return Rs(g),null}else 2*br()-j.renderingStartTime>zh&&A!==1073741824&&(g.flags|=128,P=!0,ip(j,!1),g.lanes=4194304);j.isBackwards?(se.sibling=g.child,g.child=se):(A=j.last,A!==null?A.sibling=se:g.child=se,j.last=se)}return j.tail!==null?(g=j.tail,j.rendering=g,j.tail=g.sibling,j.renderingStartTime=br(),g.sibling=null,A=S.current,Br(S,P?A&1|2:A&1),g):(Rs(g),null);case 22:case 23:return _g(),P=g.memoizedState!==null,p!==null&&p.memoizedState!==null!==P&&(g.flags|=8192),P&&(g.mode&1)!==0?(Oo&1073741824)!==0&&(Rs(g),g.subtreeFlags&6&&(g.flags|=8192)):Rs(g),null;case 24:return null;case 25:return null}throw Error(r(156,g.tag))}function j1(p,g){switch(qd(g),g.tag){case 1:return Vn(g.type)&&Ta(),p=g.flags,p&65536?(g.flags=p&-65537|128,g):null;case 3:return m(),Jr(rs),Jr(wn),F(),p=g.flags,(p&65536)!==0&&(p&128)===0?(g.flags=p&-65537|128,g):null;case 5:return x(g),null;case 13:if(Jr(S),p=g.memoizedState,p!==null&&p.dehydrated!==null){if(g.alternate===null)throw Error(r(340));Qr()}return p=g.flags,p&65536?(g.flags=p&-65537|128,g):null;case 19:return Jr(S),null;case 4:return m(),null;case 10:return Bn(g.type._context),null;case 22:case 23:return _g(),null;case 24:return null;default:return null}}var Bh=!1,ds=!1,J_=typeof WeakSet=="function"?WeakSet:Set,$t=null;function Lh(p,g){var A=p.ref;if(A!==null)if(typeof A=="function")try{A(null)}catch(P){sn(p,g,P)}else A.current=null}function sg(p,g,A){try{A()}catch(P){sn(p,g,P)}}var pf=!1;function og(p,g){if(Dc=jn,p=zd(),Mc(p)){if("selectionStart"in p)var A={start:p.selectionStart,end:p.selectionEnd};else e:{A=(A=p.ownerDocument)&&A.defaultView||window;var P=A.getSelection&&A.getSelection();if(P&&P.rangeCount!==0){A=P.anchorNode;var N=P.anchorOffset,j=P.focusNode;P=P.focusOffset;try{A.nodeType,j.nodeType}catch{A=null;break e}var se=0,Ae=-1,Ie=-1,ot=0,xt=0,yt=p,gt=null;t:for(;;){for(var jt;yt!==A||N!==0&&yt.nodeType!==3||(Ae=se+N),yt!==j||P!==0&&yt.nodeType!==3||(Ie=se+P),yt.nodeType===3&&(se+=yt.nodeValue.length),(jt=yt.firstChild)!==null;)gt=yt,yt=jt;for(;;){if(yt===p)break t;if(gt===A&&++ot===N&&(Ae=se),gt===j&&++xt===P&&(Ie=se),(jt=yt.nextSibling)!==null)break;yt=gt,gt=yt.parentNode}yt=jt}A=Ae===-1||Ie===-1?null:{start:Ae,end:Ie}}else A=null}A=A||{start:0,end:0}}else A=null;for(ba={focusedElem:p,selectionRange:A},jn=!1,$t=g;$t!==null;)if(g=$t,p=g.child,(g.subtreeFlags&1028)!==0&&p!==null)p.return=g,$t=p;else for(;$t!==null;){g=$t;try{var Zt=g.alternate;if((g.flags&1024)!==0)switch(g.tag){case 0:case 11:case 15:break;case 1:if(Zt!==null){var rr=Zt.memoizedProps,Ui=Zt.memoizedState,Ye=g.stateNode,je=Ye.getSnapshotBeforeUpdate(g.elementType===g.type?rr:pn(g.type,rr),Ui);Ye.__reactInternalSnapshotBeforeUpdate=je}break;case 3:var rt=g.stateNode.containerInfo;rt.nodeType===1?rt.textContent="":rt.nodeType===9&&rt.documentElement&&rt.removeChild(rt.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(r(163))}}catch(Mt){sn(g,g.return,Mt)}if(p=g.sibling,p!==null){p.return=g.return,$t=p;break}$t=g.return}return Zt=pf,pf=!1,Zt}function Dh(p,g,A){var P=g.updateQueue;if(P=P!==null?P.lastEffect:null,P!==null){var N=P=P.next;do{if((N.tag&p)===p){var j=N.destroy;N.destroy=void 0,j!==void 0&&sg(g,A,j)}N=N.next}while(N!==P)}}function pl(p,g){if(g=g.updateQueue,g=g!==null?g.lastEffect:null,g!==null){var A=g=g.next;do{if((A.tag&p)===p){var P=A.create;A.destroy=P()}A=A.next}while(A!==g)}}function Uu(p){var g=p.ref;if(g!==null){var A=p.stateNode;switch(p.tag){case 5:p=A;break;default:p=A}typeof g=="function"?g(p):g.current=p}}function Q_(p){var g=p.alternate;g!==null&&(p.alternate=null,Q_(g)),p.child=null,p.deletions=null,p.sibling=null,p.tag===5&&(g=p.stateNode,g!==null&&(delete g[Us],delete g[xa],delete g[wa],delete g[wh],delete g[Ea])),p.stateNode=null,p.return=null,p.dependencies=null,p.memoizedProps=null,p.memoizedState=null,p.pendingProps=null,p.stateNode=null,p.updateQueue=null}function ey(p){return p.tag===5||p.tag===3||p.tag===4}function ty(p){e:for(;;){for(;p.sibling===null;){if(p.return===null||ey(p.return))return null;p=p.return}for(p.sibling.return=p.return,p=p.sibling;p.tag!==5&&p.tag!==6&&p.tag!==18;){if(p.flags&2||p.child===null||p.tag===4)continue e;p.child.return=p,p=p.child}if(!(p.flags&2))return p.stateNode}}function ag(p,g,A){var P=p.tag;if(P===5||P===6)p=p.stateNode,g?A.nodeType===8?A.parentNode.insertBefore(p,g):A.insertBefore(p,g):(A.nodeType===8?(g=A.parentNode,g.insertBefore(p,A)):(g=A,g.appendChild(p)),A=A._reactRootContainer,A!=null||g.onclick!==null||(g.onclick=Lc));else if(P!==4&&(p=p.child,p!==null))for(ag(p,g,A),p=p.sibling;p!==null;)ag(p,g,A),p=p.sibling}function lg(p,g,A){var P=p.tag;if(P===5||P===6)p=p.stateNode,g?A.insertBefore(p,g):A.appendChild(p);else if(P!==4&&(p=p.child,p!==null))for(lg(p,g,A),p=p.sibling;p!==null;)lg(p,g,A),p=p.sibling}var ps=null,Ba=!1;function fl(p,g,A){for(A=A.child;A!==null;)ry(p,g,A),A=A.sibling}function ry(p,g,A){if(en&&typeof en.onCommitFiberUnmount=="function")try{en.onCommitFiberUnmount(Wi,A)}catch{}switch(A.tag){case 5:ds||Lh(A,g);case 6:var P=ps,N=Ba;ps=null,fl(p,g,A),ps=P,Ba=N,ps!==null&&(Ba?(p=ps,A=A.stateNode,p.nodeType===8?p.parentNode.removeChild(A):p.removeChild(A)):ps.removeChild(A.stateNode));break;case 18:ps!==null&&(Ba?(p=ps,A=A.stateNode,p.nodeType===8?Iu(p.parentNode,A):p.nodeType===1&&Iu(p,A),Fs(p)):Iu(ps,A.stateNode));break;case 4:P=ps,N=Ba,ps=A.stateNode.containerInfo,Ba=!0,fl(p,g,A),ps=P,Ba=N;break;case 0:case 11:case 14:case 15:if(!ds&&(P=A.updateQueue,P!==null&&(P=P.lastEffect,P!==null))){N=P=P.next;do{var j=N,se=j.destroy;j=j.tag,se!==void 0&&((j&2)!==0||(j&4)!==0)&&sg(A,g,se),N=N.next}while(N!==P)}fl(p,g,A);break;case 1:if(!ds&&(Lh(A,g),P=A.stateNode,typeof P.componentWillUnmount=="function"))try{P.props=A.memoizedProps,P.state=A.memoizedState,P.componentWillUnmount()}catch(Ae){sn(A,g,Ae)}fl(p,g,A);break;case 21:fl(p,g,A);break;case 22:A.mode&1?(ds=(P=ds)||A.memoizedState!==null,fl(p,g,A),ds=P):fl(p,g,A);break;default:fl(p,g,A)}}function cg(p){var g=p.updateQueue;if(g!==null){p.updateQueue=null;var A=p.stateNode;A===null&&(A=p.stateNode=new J_),g.forEach(function(P){var N=fp.bind(null,p,P);A.has(P)||(A.add(P),P.then(N,N))})}}function Zs(p,g){var A=g.deletions;if(A!==null)for(var P=0;P<A.length;P++){var N=A[P];try{var j=p,se=g,Ae=se;e:for(;Ae!==null;){switch(Ae.tag){case 5:ps=Ae.stateNode,Ba=!1;break e;case 3:ps=Ae.stateNode.containerInfo,Ba=!0;break e;case 4:ps=Ae.stateNode.containerInfo,Ba=!0;break e}Ae=Ae.return}if(ps===null)throw Error(r(160));ry(j,se,N),ps=null,Ba=!1;var Ie=N.alternate;Ie!==null&&(Ie.return=null),N.return=null}catch(ot){sn(N,g,ot)}}if(g.subtreeFlags&12854)for(g=g.child;g!==null;)iy(g,p),g=g.sibling}function iy(p,g){var A=p.alternate,P=p.flags;switch(p.tag){case 0:case 11:case 14:case 15:if(Zs(g,p),ti(p),P&4){try{Dh(3,p,p.return),pl(3,p)}catch(rr){sn(p,p.return,rr)}try{Dh(5,p,p.return)}catch(rr){sn(p,p.return,rr)}}break;case 1:Zs(g,p),ti(p),P&512&&A!==null&&Lh(A,A.return);break;case 5:if(Zs(g,p),ti(p),P&512&&A!==null&&Lh(A,A.return),p.flags&32){var N=p.stateNode;try{Q(N,"")}catch(rr){sn(p,p.return,rr)}}if(P&4&&(N=p.stateNode,N!=null)){var j=p.memoizedProps,se=A!==null?A.memoizedProps:j,Ae=p.type,Ie=p.updateQueue;if(p.updateQueue=null,Ie!==null)try{Ae==="input"&&j.type==="radio"&&j.name!=null&&Li(N,j),Be(Ae,se);var ot=Be(Ae,j);for(se=0;se<Ie.length;se+=2){var xt=Ie[se],yt=Ie[se+1];xt==="style"?Se(N,yt):xt==="dangerouslySetInnerHTML"?ke(N,yt):xt==="children"?Q(N,yt):ue(N,xt,yt,ot)}switch(Ae){case"input":Mn(N,j);break;case"textarea":Go(N,j);break;case"select":var gt=N._wrapperState.wasMultiple;N._wrapperState.wasMultiple=!!j.multiple;var jt=j.value;jt!=null?mi(N,!!j.multiple,jt,!1):gt!==!!j.multiple&&(j.defaultValue!=null?mi(N,!!j.multiple,j.defaultValue,!0):mi(N,!!j.multiple,j.multiple?[]:"",!1))}N[xa]=j}catch(rr){sn(p,p.return,rr)}}break;case 6:if(Zs(g,p),ti(p),P&4){if(p.stateNode===null)throw Error(r(162));N=p.stateNode,j=p.memoizedProps;try{N.nodeValue=j}catch(rr){sn(p,p.return,rr)}}break;case 3:if(Zs(g,p),ti(p),P&4&&A!==null&&A.memoizedState.isDehydrated)try{Fs(g.containerInfo)}catch(rr){sn(p,p.return,rr)}break;case 4:Zs(g,p),ti(p);break;case 13:Zs(g,p),ti(p),N=p.child,N.flags&8192&&(j=N.memoizedState!==null,N.stateNode.isHidden=j,!j||N.alternate!==null&&N.alternate.memoizedState!==null||(hg=br())),P&4&&cg(p);break;case 22:if(xt=A!==null&&A.memoizedState!==null,p.mode&1?(ds=(ot=ds)||xt,Zs(g,p),ds=ot):Zs(g,p),ti(p),P&8192){if(ot=p.memoizedState!==null,(p.stateNode.isHidden=ot)&&!xt&&(p.mode&1)!==0)for($t=p,xt=p.child;xt!==null;){for(yt=$t=xt;$t!==null;){switch(gt=$t,jt=gt.child,gt.tag){case 0:case 11:case 14:case 15:Dh(4,gt,gt.return);break;case 1:Lh(gt,gt.return);var Zt=gt.stateNode;if(typeof Zt.componentWillUnmount=="function"){P=gt,A=gt.return;try{g=P,Zt.props=g.memoizedProps,Zt.state=g.memoizedState,Zt.componentWillUnmount()}catch(rr){sn(P,A,rr)}}break;case 5:Lh(gt,gt.return);break;case 22:if(gt.memoizedState!==null){sp(yt);continue}}jt!==null?(jt.return=gt,$t=jt):sp(yt)}xt=xt.sibling}e:for(xt=null,yt=p;;){if(yt.tag===5){if(xt===null){xt=yt;try{N=yt.stateNode,ot?(j=N.style,typeof j.setProperty=="function"?j.setProperty("display","none","important"):j.display="none"):(Ae=yt.stateNode,Ie=yt.memoizedProps.style,se=Ie!=null&&Ie.hasOwnProperty("display")?Ie.display:null,Ae.style.display=be("display",se))}catch(rr){sn(p,p.return,rr)}}}else if(yt.tag===6){if(xt===null)try{yt.stateNode.nodeValue=ot?"":yt.memoizedProps}catch(rr){sn(p,p.return,rr)}}else if((yt.tag!==22&&yt.tag!==23||yt.memoizedState===null||yt===p)&&yt.child!==null){yt.child.return=yt,yt=yt.child;continue}if(yt===p)break e;for(;yt.sibling===null;){if(yt.return===null||yt.return===p)break e;xt===yt&&(xt=null),yt=yt.return}xt===yt&&(xt=null),yt.sibling.return=yt.return,yt=yt.sibling}}break;case 19:Zs(g,p),ti(p),P&4&&cg(p);break;case 21:break;default:Zs(g,p),ti(p)}}function ti(p){var g=p.flags;if(g&2){try{e:{for(var A=p.return;A!==null;){if(ey(A)){var P=A;break e}A=A.return}throw Error(r(160))}switch(P.tag){case 5:var N=P.stateNode;P.flags&32&&(Q(N,""),P.flags&=-33);var j=ty(p);lg(p,j,N);break;case 3:case 4:var se=P.stateNode.containerInfo,Ae=ty(p);ag(p,Ae,se);break;default:throw Error(r(161))}}catch(Ie){sn(p,p.return,Ie)}p.flags&=-3}g&4096&&(p.flags&=-4097)}function Nh(p,g,A){$t=p,ug(p)}function ug(p,g,A){for(var P=(p.mode&1)!==0;$t!==null;){var N=$t,j=N.child;if(N.tag===22&&P){var se=N.memoizedState!==null||Bh;if(!se){var Ae=N.alternate,Ie=Ae!==null&&Ae.memoizedState!==null||ds;Ae=Bh;var ot=ds;if(Bh=se,(ds=Ie)&&!ot)for($t=N;$t!==null;)se=$t,Ie=se.child,se.tag===22&&se.memoizedState!==null?Oh(N):Ie!==null?(Ie.return=se,$t=Ie):Oh(N);for(;j!==null;)$t=j,ug(j),j=j.sibling;$t=N,Bh=Ae,ds=ot}np(p)}else(N.subtreeFlags&8772)!==0&&j!==null?(j.return=N,$t=j):np(p)}}function np(p){for(;$t!==null;){var g=$t;if((g.flags&8772)!==0){var A=g.alternate;try{if((g.flags&8772)!==0)switch(g.tag){case 0:case 11:case 15:ds||pl(5,g);break;case 1:var P=g.stateNode;if(g.flags&4&&!ds)if(A===null)P.componentDidMount();else{var N=g.elementType===g.type?A.memoizedProps:pn(g.type,A.memoizedProps);P.componentDidUpdate(N,A.memoizedState,P.__reactInternalSnapshotBeforeUpdate)}var j=g.updateQueue;j!==null&&Ph(g,j,P);break;case 3:var se=g.updateQueue;if(se!==null){if(A=null,g.child!==null)switch(g.child.tag){case 5:A=g.child.stateNode;break;case 1:A=g.child.stateNode}Ph(g,se,A)}break;case 5:var Ae=g.stateNode;if(A===null&&g.flags&4){A=Ae;var Ie=g.memoizedProps;switch(g.type){case"button":case"input":case"select":case"textarea":Ie.autoFocus&&A.focus();break;case"img":Ie.src&&(A.src=Ie.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(g.memoizedState===null){var ot=g.alternate;if(ot!==null){var xt=ot.memoizedState;if(xt!==null){var yt=xt.dehydrated;yt!==null&&Fs(yt)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(r(163))}ds||g.flags&512&&Uu(g)}catch(gt){sn(g,g.return,gt)}}if(g===p){$t=null;break}if(A=g.sibling,A!==null){A.return=g.return,$t=A;break}$t=g.return}}function sp(p){for(;$t!==null;){var g=$t;if(g===p){$t=null;break}var A=g.sibling;if(A!==null){A.return=g.return,$t=A;break}$t=g.return}}function Oh(p){for(;$t!==null;){var g=$t;try{switch(g.tag){case 0:case 11:case 15:var A=g.return;try{pl(4,g)}catch(Ie){sn(g,A,Ie)}break;case 1:var P=g.stateNode;if(typeof P.componentDidMount=="function"){var N=g.return;try{P.componentDidMount()}catch(Ie){sn(g,N,Ie)}}var j=g.return;try{Uu(g)}catch(Ie){sn(g,j,Ie)}break;case 5:var se=g.return;try{Uu(g)}catch(Ie){sn(g,se,Ie)}}}catch(Ie){sn(g,g.return,Ie)}if(g===p){$t=null;break}var Ae=g.sibling;if(Ae!==null){Ae.return=g.return,$t=Ae;break}$t=g.return}}var ny=Math.ceil,op=we.ReactCurrentDispatcher,ju=we.ReactCurrentOwner,lo=we.ReactCurrentBatchConfig,Or=0,fn=null,Ri=null,mn=0,Oo=0,Vu=xn(0),Ii=0,ap=null,Hc=0,Wc=0,lp=0,Fh=null,Xs=null,hg=0,zh=1/0,Wl=null,ff=!1,dg=null,Fo=null,mf=!1,qc=null,cp=0,up=0,gf=null,_f=-1,Uh=0;function Dn(){return(Or&6)!==0?br():_f!==-1?_f:_f=br()}function ml(p){return(p.mode&1)===0?1:(Or&2)!==0&&mn!==0?mn&-mn:Xd.transition!==null?(Uh===0&&(Uh=Ao()),Uh):(p=ce,p!==0||(p=window.event,p=p===void 0?16:yc(p.type)),p)}function La(p,g,A,P){if(50<up)throw up=0,gf=null,Error(r(185));pa(p,A,P),((Or&2)===0||p!==fn)&&(p===fn&&((Or&2)===0&&(Wc|=A),Ii===4&&ra(p,mn)),co(p,P),A===1&&Or===0&&(g.mode&1)===0&&(zh=br()+500,Sa&&ll()))}function co(p,g){var A=p.callbackNode;du(p,g);var P=Eo(p,p===fn?mn:0);if(P===0)A!==null&&ha(A),p.callbackNode=null,p.callbackPriority=0;else if(g=P&-P,p.callbackPriority!==g){if(A!=null&&ha(A),g===1)p.tag===0?Zm(mg.bind(null,p)):Oc(mg.bind(null,p)),Gd(function(){(Or&6)===0&&ll()}),A=null;else{switch(Ce(P)){case 1:A=Mi;break;case 4:A=Dr;break;case 16:A=Qn;break;case 536870912:A=es;break;default:A=Qn}A=vf(A,pg.bind(null,p))}p.callbackPriority=g,p.callbackNode=A}}function pg(p,g){if(_f=-1,Uh=0,(Or&6)!==0)throw Error(r(327));var A=p.callbackNode;if(jh()&&p.callbackNode!==A)return null;var P=Eo(p,p===fn?mn:0);if(P===0)return null;if((P&30)!==0||(P&p.expiredLanes)!==0||g)g=dp(p,P);else{g=P;var N=Or;Or|=2;var j=yg();(fn!==p||mn!==g)&&(Wl=null,zh=br()+500,Hu(p,g));do try{ay();break}catch(Ae){sy(p,Ae)}while(!0);jc(),op.current=j,Or=N,Ri!==null?g=0:(fn=null,mn=0,g=Ii)}if(g!==0){if(g===2&&(N=Za(p),N!==0&&(P=N,g=yf(p,N))),g===1)throw A=ap,Hu(p,0),ra(p,P),co(p,br()),A;if(g===6)ra(p,P);else{if(N=p.current.alternate,(P&30)===0&&!V1(N)&&(g=dp(p,P),g===2&&(j=Za(p),j!==0&&(P=j,g=yf(p,j))),g===1))throw A=ap,Hu(p,0),ra(p,P),co(p,br()),A;switch(p.finishedWork=N,p.finishedLanes=P,g){case 0:case 1:throw Error(r(345));case 2:Wu(p,Xs,Wl);break;case 3:if(ra(p,P),(P&130023424)===P&&(g=hg+500-br(),10<g)){if(Eo(p,0)!==0)break;if(N=p.suspendedLanes,(N&P)!==P){Dn(),p.pingedLanes|=p.suspendedLanes&N;break}p.timeoutHandle=xh(Wu.bind(null,p,Xs,Wl),g);break}Wu(p,Xs,Wl);break;case 4:if(ra(p,P),(P&4194240)===P)break;for(g=p.eventTimes,N=-1;0<P;){var se=31-Rn(P);j=1<<se,se=g[se],se>N&&(N=se),P&=~j}if(P=N,P=br()-P,P=(120>P?120:480>P?480:1080>P?1080:1920>P?1920:3e3>P?3e3:4320>P?4320:1960*ny(P/1960))-P,10<P){p.timeoutHandle=xh(Wu.bind(null,p,Xs,Wl),P);break}Wu(p,Xs,Wl);break;case 5:Wu(p,Xs,Wl);break;default:throw Error(r(329))}}}return co(p,br()),p.callbackNode===A?pg.bind(null,p):null}function yf(p,g){var A=Fh;return p.current.memoizedState.isDehydrated&&(Hu(p,g).flags|=256),p=dp(p,g),p!==2&&(g=Xs,Xs=A,g!==null&&fg(g)),p}function fg(p){Xs===null?Xs=p:Xs.push.apply(Xs,p)}function V1(p){for(var g=p;;){if(g.flags&16384){var A=g.updateQueue;if(A!==null&&(A=A.stores,A!==null))for(var P=0;P<A.length;P++){var N=A[P],j=N.getSnapshot;N=N.value;try{if(!Ro(j(),N))return!1}catch{return!1}}}if(A=g.child,g.subtreeFlags&16384&&A!==null)A.return=g,g=A;else{if(g===p)break;for(;g.sibling===null;){if(g.return===null||g.return===p)return!0;g=g.return}g.sibling.return=g.return,g=g.sibling}}return!0}function ra(p,g){for(g&=~lp,g&=~Wc,p.suspendedLanes|=g,p.pingedLanes&=~g,p=p.expirationTimes;0<g;){var A=31-Rn(g),P=1<<A;p[A]=-1,g&=~P}}function mg(p){if((Or&6)!==0)throw Error(r(327));jh();var g=Eo(p,0);if((g&1)===0)return co(p,br()),null;var A=dp(p,g);if(p.tag!==0&&A===2){var P=Za(p);P!==0&&(g=P,A=yf(p,P))}if(A===1)throw A=ap,Hu(p,0),ra(p,g),co(p,br()),A;if(A===6)throw Error(r(345));return p.finishedWork=p.current.alternate,p.finishedLanes=g,Wu(p,Xs,Wl),co(p,br()),null}function gg(p,g){var A=Or;Or|=1;try{return p(g)}finally{Or=A,Or===0&&(zh=br()+500,Sa&&ll())}}function Gu(p){qc!==null&&qc.tag===0&&(Or&6)===0&&jh();var g=Or;Or|=1;var A=lo.transition,P=ce;try{if(lo.transition=null,ce=1,p)return p()}finally{ce=P,lo.transition=A,Or=g,(Or&6)===0&&ll()}}function _g(){Oo=Vu.current,Jr(Vu)}function Hu(p,g){p.finishedWork=null,p.finishedLanes=0;var A=p.timeoutHandle;if(A!==-1&&(p.timeoutHandle=-1,lf(A)),Ri!==null)for(A=Ri.return;A!==null;){var P=A;switch(qd(P),P.tag){case 1:P=P.type.childContextTypes,P!=null&&Ta();break;case 3:m(),Jr(rs),Jr(wn),F();break;case 5:x(P);break;case 4:m();break;case 13:Jr(S);break;case 19:Jr(S);break;case 10:Bn(P.type._context);break;case 22:case 23:_g()}A=A.return}if(fn=p,Ri=p=ql(p.current,null),mn=Oo=g,Ii=0,ap=null,lp=Wc=Hc=0,Xs=Fh=null,Bo!==null){for(g=0;g<Bo.length;g++)if(A=Bo[g],P=A.interleaved,P!==null){A.interleaved=null;var N=P.next,j=A.pending;if(j!==null){var se=j.next;j.next=N,P.next=se}A.pending=P}Bo=null}return p}function sy(p,g){do{var A=Ri;try{if(jc(),U.current=us,de){for(var P=q.memoizedState;P!==null;){var N=P.queue;N!==null&&(N.pending=null),P=P.next}de=!1}if(G=0,le=J=q=null,pe=!1,ge=0,ju.current=null,A===null||A.return===null){Ii=1,ap=g,Ri=null;break}e:{var j=p,se=A.return,Ae=A,Ie=g;if(g=mn,Ae.flags|=32768,Ie!==null&&typeof Ie=="object"&&typeof Ie.then=="function"){var ot=Ie,xt=Ae,yt=xt.tag;if((xt.mode&1)===0&&(yt===0||yt===11||yt===15)){var gt=xt.alternate;gt?(xt.updateQueue=gt.updateQueue,xt.memoizedState=gt.memoizedState,xt.lanes=gt.lanes):(xt.updateQueue=null,xt.memoizedState=null)}var jt=Km(se);if(jt!==null){jt.flags&=-257,H_(jt,se,Ae,j,g),jt.mode&1&&cf(j,ot,g),g=jt,Ie=ot;var Zt=g.updateQueue;if(Zt===null){var rr=new Set;rr.add(Ie),g.updateQueue=rr}else Zt.add(Ie);break e}else{if((g&1)===0){cf(j,ot,g),hp();break e}Ie=Error(r(426))}}else if(vi&&Ae.mode&1){var Ui=Km(se);if(Ui!==null){(Ui.flags&65536)===0&&(Ui.flags|=256),H_(Ui,se,Ae,j,g),cl(Ia(Ie,Ae));break e}}j=Ie=Ia(Ie,Ae),Ii!==4&&(Ii=2),Fh===null?Fh=[j]:Fh.push(j),j=se;do{switch(j.tag){case 3:j.flags|=65536,g&=-g,j.lanes|=g;var Ye=Xm(j,Ie,g);Nu(j,Ye);break e;case 1:Ae=Ie;var je=j.type,rt=j.stateNode;if((j.flags&128)===0&&(typeof je.getDerivedStateFromError=="function"||rt!==null&&typeof rt.componentDidCatch=="function"&&(Fo===null||!Fo.has(rt)))){j.flags|=65536,g&=-g,j.lanes|=g;var Mt=G_(j,Ae,g);Nu(j,Mt);break e}}j=j.return}while(j!==null)}pp(A)}catch(Kt){g=Kt,Ri===A&&A!==null&&(Ri=A=A.return);continue}break}while(!0)}function yg(){var p=op.current;return op.current=us,p===null?us:p}function hp(){(Ii===0||Ii===3||Ii===2)&&(Ii=4),fn===null||(Hc&268435455)===0&&(Wc&268435455)===0||ra(fn,mn)}function dp(p,g){var A=Or;Or|=2;var P=yg();(fn!==p||mn!==g)&&(Wl=null,Hu(p,g));do try{oy();break}catch(N){sy(p,N)}while(!0);if(jc(),Or=A,op.current=P,Ri!==null)throw Error(r(261));return fn=null,mn=0,Ii}function oy(){for(;Ri!==null;)ly(Ri)}function ay(){for(;Ri!==null&&!to();)ly(Ri)}function ly(p){var g=gn(p.alternate,p,Oo);p.memoizedProps=p.pendingProps,g===null?pp(p):Ri=g,ju.current=null}function pp(p){var g=p;do{var A=g.alternate;if(p=g.return,(g.flags&32768)===0){if(A=Y_(A,g,Oo),A!==null){Ri=A;return}}else{if(A=j1(A,g),A!==null){A.flags&=32767,Ri=A;return}if(p!==null)p.flags|=32768,p.subtreeFlags=0,p.deletions=null;else{Ii=6,Ri=null;return}}if(g=g.sibling,g!==null){Ri=g;return}Ri=g=p}while(g!==null);Ii===0&&(Ii=5)}function Wu(p,g,A){var P=ce,N=lo.transition;try{lo.transition=null,ce=1,cy(p,g,A,P)}finally{lo.transition=N,ce=P}return null}function cy(p,g,A,P){do jh();while(qc!==null);if((Or&6)!==0)throw Error(r(327));A=p.finishedWork;var N=p.finishedLanes;if(A===null)return null;if(p.finishedWork=null,p.finishedLanes=0,A===p.current)throw Error(r(177));p.callbackNode=null,p.callbackPriority=0;var j=A.lanes|A.childLanes;if(vd(p,j),p===fn&&(Ri=fn=null,mn=0),(A.subtreeFlags&2064)===0&&(A.flags&2064)===0||mf||(mf=!0,vf(Qn,function(){return jh(),null})),j=(A.flags&15990)!==0,(A.subtreeFlags&15990)!==0||j){j=lo.transition,lo.transition=null;var se=ce;ce=1;var Ae=Or;Or|=4,ju.current=null,og(p,A),iy(A,p),_h(ba),jn=!!Dc,ba=Dc=null,p.current=A,Nh(A),Wa(),Or=Ae,ce=se,lo.transition=j}else p.current=A;if(mf&&(mf=!1,qc=p,cp=N),j=p.pendingLanes,j===0&&(Fo=null),fc(A.stateNode),co(p,br()),g!==null)for(P=p.onRecoverableError,A=0;A<g.length;A++)N=g[A],P(N.value,{componentStack:N.stack,digest:N.digest});if(ff)throw ff=!1,p=dg,dg=null,p;return(cp&1)!==0&&p.tag!==0&&jh(),j=p.pendingLanes,(j&1)!==0?p===gf?up++:(up=0,gf=p):up=0,ll(),null}function jh(){if(qc!==null){var p=Ce(cp),g=lo.transition,A=ce;try{if(lo.transition=null,ce=16>p?16:p,qc===null)var P=!1;else{if(p=qc,qc=null,cp=0,(Or&6)!==0)throw Error(r(331));var N=Or;for(Or|=4,$t=p.current;$t!==null;){var j=$t,se=j.child;if(($t.flags&16)!==0){var Ae=j.deletions;if(Ae!==null){for(var Ie=0;Ie<Ae.length;Ie++){var ot=Ae[Ie];for($t=ot;$t!==null;){var xt=$t;switch(xt.tag){case 0:case 11:case 15:Dh(8,xt,j)}var yt=xt.child;if(yt!==null)yt.return=xt,$t=yt;else for(;$t!==null;){xt=$t;var gt=xt.sibling,jt=xt.return;if(Q_(xt),xt===ot){$t=null;break}if(gt!==null){gt.return=jt,$t=gt;break}$t=jt}}}var Zt=j.alternate;if(Zt!==null){var rr=Zt.child;if(rr!==null){Zt.child=null;do{var Ui=rr.sibling;rr.sibling=null,rr=Ui}while(rr!==null)}}$t=j}}if((j.subtreeFlags&2064)!==0&&se!==null)se.return=j,$t=se;else e:for(;$t!==null;){if(j=$t,(j.flags&2048)!==0)switch(j.tag){case 0:case 11:case 15:Dh(9,j,j.return)}var Ye=j.sibling;if(Ye!==null){Ye.return=j.return,$t=Ye;break e}$t=j.return}}var je=p.current;for($t=je;$t!==null;){se=$t;var rt=se.child;if((se.subtreeFlags&2064)!==0&&rt!==null)rt.return=se,$t=rt;else e:for(se=je;$t!==null;){if(Ae=$t,(Ae.flags&2048)!==0)try{switch(Ae.tag){case 0:case 11:case 15:pl(9,Ae)}}catch(Kt){sn(Ae,Ae.return,Kt)}if(Ae===se){$t=null;break e}var Mt=Ae.sibling;if(Mt!==null){Mt.return=Ae.return,$t=Mt;break e}$t=Ae.return}}if(Or=N,ll(),en&&typeof en.onPostCommitFiberRoot=="function")try{en.onPostCommitFiberRoot(Wi,p)}catch{}P=!0}return P}finally{ce=A,lo.transition=g}}return!1}function uy(p,g,A){g=Ia(A,g),g=Xm(p,g,1),p=Ms(p,g,1),g=Dn(),p!==null&&(pa(p,1,g),co(p,g))}function sn(p,g,A){if(p.tag===3)uy(p,p,A);else for(;g!==null;){if(g.tag===3){uy(g,p,A);break}else if(g.tag===1){var P=g.stateNode;if(typeof g.type.getDerivedStateFromError=="function"||typeof P.componentDidCatch=="function"&&(Fo===null||!Fo.has(P))){p=Ia(A,p),p=G_(g,p,1),g=Ms(g,p,1),p=Dn(),g!==null&&(pa(g,1,p),co(g,p));break}}g=g.return}}function hy(p,g,A){var P=p.pingCache;P!==null&&P.delete(g),g=Dn(),p.pingedLanes|=p.suspendedLanes&A,fn===p&&(mn&A)===A&&(Ii===4||Ii===3&&(mn&130023424)===mn&&500>br()-hg?Hu(p,0):lp|=A),co(p,g)}function dy(p,g){g===0&&((p.mode&1)===0?g=1:(g=$a,$a<<=1,($a&130023424)===0&&($a=4194304)));var A=Dn();p=so(p,g),p!==null&&(pa(p,g,A),co(p,A))}function G1(p){var g=p.memoizedState,A=0;g!==null&&(A=g.retryLane),dy(p,A)}function fp(p,g){var A=0;switch(p.tag){case 13:var P=p.stateNode,N=p.memoizedState;N!==null&&(A=N.retryLane);break;case 19:P=p.stateNode;break;default:throw Error(r(314))}P!==null&&P.delete(g),dy(p,A)}var gn;gn=function(p,g,A){if(p!==null)if(p.memoizedProps!==g.pendingProps||rs.current)ao=!0;else{if((p.lanes&A)===0&&(g.flags&128)===0)return ao=!1,$s(p,g,A);ao=(p.flags&131072)!==0}else ao=!1,vi&&(g.flags&1048576)!==0&&kr(g,Dt,g.index);switch(g.lanes=0,g.tag){case 2:var P=g.type;kh(p,g),p=g.pendingProps;var N=ko(g,wn.current);Ln(g,A),N=Pe(null,g,P,p,N,A);var j=ve();return g.flags|=1,typeof N=="object"&&N!==null&&typeof N.render=="function"&&N.$$typeof===void 0?(g.tag=1,g.memoizedState=null,g.updateQueue=null,Vn(P)?(j=!0,Es(g)):j=!1,g.memoizedState=N.state!==null&&N.state!==void 0?N.state:null,ul(g),N.updater=Do,g.stateNode=N,N._reactInternals=g,Fu(g,P,p,A),g=Ih(null,g,P,!0,j,A)):(g.tag=0,vi&&j&&Fc(g),hs(null,g,N,A),g=g.child),g;case 16:P=g.elementType;e:{switch(kh(p,g),p=g.pendingProps,N=P._init,P=N(P._payload),g.type=P,N=g.tag=H1(P),p=pn(P,p),N){case 0:g=Qm(null,g,P,p,A);break e;case 1:g=Rh(null,g,P,p,A);break e;case 11:g=q_(null,g,P,p,A);break e;case 14:g=uf(null,g,P,pn(P.type,p),A);break e}throw Error(r(306,P,""))}return g;case 0:return P=g.type,N=g.pendingProps,N=g.elementType===P?N:pn(P,N),Qm(p,g,P,N,A);case 1:return P=g.type,N=g.pendingProps,N=g.elementType===P?N:pn(P,N),Rh(p,g,P,N,A);case 3:e:{if(Qd(g),p===null)throw Error(r(387));P=g.pendingProps,j=g.memoizedState,N=j.element,Mh(p,g),Qo(g,P,null,A);var se=g.memoizedState;if(P=se.element,j.isDehydrated)if(j={element:P,isDehydrated:!1,cache:se.cache,pendingSuspenseBoundaries:se.pendingSuspenseBoundaries,transitions:se.transitions},g.updateQueue.baseState=j,g.memoizedState=j,g.flags&256){N=Ia(Error(r(423)),g),g=eg(p,g,P,A,N);break e}else if(P!==N){N=Ia(Error(r(424)),g),g=eg(p,g,P,A,N);break e}else for(Vs=Yr(g.stateNode.containerInfo.firstChild),Gn=g,vi=!0,Gs=null,A=Du(g,null,P,A),g.child=A;A;)A.flags=A.flags&-3|4096,A=A.sibling;else{if(Qr(),P===N){g=No(p,g,A);break e}hs(p,g,P,A)}g=g.child}return g;case 5:return y(g),p===null&&Bu(g),P=g.type,N=g.pendingProps,j=p!==null?p.memoizedProps:null,se=N.children,Pu(P,N)?se=null:j!==null&&Pu(P,j)&&(g.flags|=32),zu(p,g),hs(p,g,se,A),g.child;case 6:return p===null&&Bu(g),null;case 13:return $_(p,g,A);case 4:return d(g,g.stateNode.containerInfo),P=g.pendingProps,p===null?g.child=os(g,null,P,A):hs(p,g,P,A),g.child;case 11:return P=g.type,N=g.pendingProps,N=g.elementType===P?N:pn(P,N),q_(p,g,P,N,A);case 7:return hs(p,g,g.pendingProps,A),g.child;case 8:return hs(p,g,g.pendingProps.children,A),g.child;case 12:return hs(p,g,g.pendingProps.children,A),g.child;case 10:e:{if(P=g.type._context,N=g.pendingProps,j=g.memoizedProps,se=N.value,Br(zt,P._currentValue),P._currentValue=se,j!==null)if(Ro(j.value,se)){if(j.children===N.children&&!rs.current){g=No(p,g,A);break e}}else for(j=g.child,j!==null&&(j.return=g);j!==null;){var Ae=j.dependencies;if(Ae!==null){se=j.child;for(var Ie=Ae.firstContext;Ie!==null;){if(Ie.context===P){if(j.tag===1){Ie=Cs(-1,A&-A),Ie.tag=2;var ot=j.updateQueue;if(ot!==null){ot=ot.shared;var xt=ot.pending;xt===null?Ie.next=Ie:(Ie.next=xt.next,xt.next=Ie),ot.pending=Ie}}j.lanes|=A,Ie=j.alternate,Ie!==null&&(Ie.lanes|=A),Ch(j.return,A,g),Ae.lanes|=A;break}Ie=Ie.next}}else if(j.tag===10)se=j.type===g.type?null:j.child;else if(j.tag===18){if(se=j.return,se===null)throw Error(r(341));se.lanes|=A,Ae=se.alternate,Ae!==null&&(Ae.lanes|=A),Ch(se,A,g),se=j.sibling}else se=j.child;if(se!==null)se.return=j;else for(se=j;se!==null;){if(se===g){se=null;break}if(j=se.sibling,j!==null){j.return=se.return,se=j;break}se=se.return}j=se}hs(p,g,N.children,A),g=g.child}return g;case 9:return N=g.type,P=g.pendingProps.children,Ln(g,A),N=no(N),P=P(N),g.flags|=1,hs(p,g,P,A),g.child;case 14:return P=g.type,N=pn(P,g.pendingProps),N=pn(P.type,N),uf(p,g,P,N,A);case 15:return Ym(p,g,g.type,g.pendingProps,A);case 17:return P=g.type,N=g.pendingProps,N=g.elementType===P?N:pn(P,N),kh(p,g),g.tag=1,Vn(P)?(p=!0,Es(g)):p=!1,Ln(g,A),Ps(g,P,N),Fu(g,P,N,A),Ih(null,g,P,!0,p,A);case 19:return rg(p,g,A);case 22:return Jm(p,g,A)}throw Error(r(156,g.tag))};function vf(p,g){return xs(p,g)}function py(p,g,A,P){this.tag=p,this.key=A,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=g,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=P,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function zo(p,g,A,P){return new py(p,g,A,P)}function mp(p){return p=p.prototype,!(!p||!p.isReactComponent)}function H1(p){if(typeof p=="function")return mp(p)?1:0;if(p!=null){if(p=p.$$typeof,p===vt)return 11;if(p===qt)return 14}return 2}function ql(p,g){var A=p.alternate;return A===null?(A=zo(p.tag,g,p.key,p.mode),A.elementType=p.elementType,A.type=p.type,A.stateNode=p.stateNode,A.alternate=p,p.alternate=A):(A.pendingProps=g,A.type=p.type,A.flags=0,A.subtreeFlags=0,A.deletions=null),A.flags=p.flags&14680064,A.childLanes=p.childLanes,A.lanes=p.lanes,A.child=p.child,A.memoizedProps=p.memoizedProps,A.memoizedState=p.memoizedState,A.updateQueue=p.updateQueue,g=p.dependencies,A.dependencies=g===null?null:{lanes:g.lanes,firstContext:g.firstContext},A.sibling=p.sibling,A.index=p.index,A.ref=p.ref,A}function bf(p,g,A,P,N,j){var se=2;if(P=p,typeof p=="function")mp(p)&&(se=1);else if(typeof p=="string")se=5;else e:switch(p){case Ke:return qu(A.children,N,j,g);case ze:se=8,N|=8;break;case it:return p=zo(12,A,g,N|2),p.elementType=it,p.lanes=j,p;case Nt:return p=zo(13,A,g,N),p.elementType=Nt,p.lanes=j,p;case Lt:return p=zo(19,A,g,N),p.elementType=Lt,p.lanes=j,p;case Ot:return xf(A,N,j,g);default:if(typeof p=="object"&&p!==null)switch(p.$$typeof){case lt:se=10;break e;case ht:se=9;break e;case vt:se=11;break e;case qt:se=14;break e;case Qt:se=16,P=null;break e}throw Error(r(130,p==null?p:typeof p,""))}return g=zo(se,A,g,N),g.elementType=p,g.type=P,g.lanes=j,g}function qu(p,g,A,P){return p=zo(7,p,P,g),p.lanes=A,p}function xf(p,g,A,P){return p=zo(22,p,P,g),p.elementType=Ot,p.lanes=A,p.stateNode={isHidden:!1},p}function vg(p,g,A){return p=zo(6,p,null,g),p.lanes=A,p}function bg(p,g,A){return g=zo(4,p.children!==null?p.children:[],p.key,g),g.lanes=A,g.stateNode={containerInfo:p.containerInfo,pendingChildren:null,implementation:p.implementation},g}function W1(p,g,A,P,N){this.tag=g,this.containerInfo=p,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Xa(0),this.expirationTimes=Xa(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Xa(0),this.identifierPrefix=P,this.onRecoverableError=N,this.mutableSourceEagerHydrationData=null}function xg(p,g,A,P,N,j,se,Ae,Ie){return p=new W1(p,g,A,Ae,Ie),g===1?(g=1,j===!0&&(g|=8)):g=0,j=zo(3,null,null,g),p.current=j,j.stateNode=p,j.memoizedState={element:P,isDehydrated:A,cache:null,transitions:null,pendingSuspenseBoundaries:null},ul(j),p}function q1(p,g,A){var P=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Fe,key:P==null?null:""+P,children:p,containerInfo:g,implementation:A}}function fy(p){if(!p)return js;p=p._reactInternals;e:{if(cr(p)!==p||p.tag!==1)throw Error(r(170));var g=p;do{switch(g.tag){case 3:g=g.stateNode.context;break e;case 1:if(Vn(g.type)){g=g.stateNode.__reactInternalMemoizedMergedChildContext;break e}}g=g.return}while(g!==null);throw Error(r(171))}if(p.tag===1){var A=p.type;if(Vn(A))return is(p,A,g)}return g}function my(p,g,A,P,N,j,se,Ae,Ie){return p=xg(A,P,!0,p,N,j,se,Ae,Ie),p.context=fy(null),A=p.current,P=Dn(),N=ml(A),j=Cs(P,N),j.callback=g??null,Ms(A,j,N),p.current.lanes=N,pa(p,N,P),co(p,P),p}function wf(p,g,A,P){var N=g.current,j=Dn(),se=ml(N);return A=fy(A),g.context===null?g.context=A:g.pendingContext=A,g=Cs(j,se),g.payload={element:p},P=P===void 0?null:P,P!==null&&(g.callback=P),p=Ms(N,g,se),p!==null&&(La(p,N,se,j),hl(p,N,se)),se}function Ef(p){if(p=p.current,!p.child)return null;switch(p.child.tag){case 5:return p.child.stateNode;default:return p.child.stateNode}}function wg(p,g){if(p=p.memoizedState,p!==null&&p.dehydrated!==null){var A=p.retryLane;p.retryLane=A!==0&&A<g?A:g}}function gp(p,g){wg(p,g),(p=p.alternate)&&wg(p,g)}function gy(){return null}var $l=typeof reportError=="function"?reportError:function(p){console.error(p)};function $u(p){this._internalRoot=p}Zl.prototype.render=$u.prototype.render=function(p){var g=this._internalRoot;if(g===null)throw Error(r(409));wf(p,g,null,null)},Zl.prototype.unmount=$u.prototype.unmount=function(){var p=this._internalRoot;if(p!==null){this._internalRoot=null;var g=p.containerInfo;Gu(function(){wf(null,p,null,null)}),g[Zo]=null}};function Zl(p){this._internalRoot=p}Zl.prototype.unstable_scheduleHydration=function(p){if(p){var g=xr();p={blockedOn:null,target:p,priority:g};for(var A=0;A<hi.length&&g!==0&&g<hi[A].priority;A++);hi.splice(A,0,p),A===0&&In(p)}};function Vh(p){return!(!p||p.nodeType!==1&&p.nodeType!==9&&p.nodeType!==11)}function Zu(p){return!(!p||p.nodeType!==1&&p.nodeType!==9&&p.nodeType!==11&&(p.nodeType!==8||p.nodeValue!==" react-mount-point-unstable "))}function _y(){}function $1(p,g,A,P,N){if(N){if(typeof P=="function"){var j=P;P=function(){var ot=Ef(se);j.call(ot)}}var se=my(g,P,p,0,null,!1,!1,"",_y);return p._reactRootContainer=se,p[Zo]=se.current,ol(p.nodeType===8?p.parentNode:p),Gu(),se}for(;N=p.lastChild;)p.removeChild(N);if(typeof P=="function"){var Ae=P;P=function(){var ot=Ef(Ie);Ae.call(ot)}}var Ie=xg(p,0,!1,null,null,!1,!1,"",_y);return p._reactRootContainer=Ie,p[Zo]=Ie.current,ol(p.nodeType===8?p.parentNode:p),Gu(function(){wf(g,Ie,A,P)}),Ie}function _p(p,g,A,P,N){var j=A._reactRootContainer;if(j){var se=j;if(typeof N=="function"){var Ae=N;N=function(){var Ie=Ef(se);Ae.call(Ie)}}wf(g,se,p,N)}else se=$1(A,g,p,N,P);return Ef(se)}He=function(p){switch(p.tag){case 3:var g=p.stateNode;if(g.current.memoizedState.isDehydrated){var A=da(g.pendingLanes);A!==0&&(ie(g,A|1),co(g,br()),(Or&6)===0&&(zh=br()+500,ll()))}break;case 13:Gu(function(){var P=so(p,1);if(P!==null){var N=Dn();La(P,p,1,N)}}),gp(p,1)}},mt=function(p){if(p.tag===13){var g=so(p,134217728);if(g!==null){var A=Dn();La(g,p,134217728,A)}gp(p,134217728)}},Xt=function(p){if(p.tag===13){var g=ml(p),A=so(p,g);if(A!==null){var P=Dn();La(A,p,g,P)}gp(p,g)}},xr=function(){return ce},Gr=function(p,g){var A=ce;try{return ce=p,g()}finally{ce=A}},at=function(p,g,A){switch(g){case"input":if(Mn(p,A),g=A.name,A.type==="radio"&&g!=null){for(A=p;A.parentNode;)A=A.parentNode;for(A=A.querySelectorAll("input[name="+JSON.stringify(""+g)+'][type="radio"]'),g=0;g<A.length;g++){var P=A[g];if(P!==p&&P.form===p.form){var N=ku(P);if(!N)throw Error(r(90));yi(P),Mn(P,N)}}}break;case"textarea":Go(p,A);break;case"select":g=A.value,g!=null&&mi(p,!!A.multiple,g,!1)}},_r=gg,$r=Gu;var yy={usingClientEntryPoint:!1,Events:[Nc,Ol,ku,Sr,Wt,gg]},yp={findFiberByHostInstance:Aa,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},vy={bundleType:yp.bundleType,version:yp.version,rendererPackageName:yp.rendererPackageName,rendererConfig:yp.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:we.ReactCurrentDispatcher,findHostInstanceByFiber:function(p){return p=hr(p),p===null?null:p.stateNode},findFiberByHostInstance:yp.findFiberByHostInstance||gy,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var vp=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!vp.isDisabled&&vp.supportsFiber)try{Wi=vp.inject(vy),en=vp}catch{}}return ia.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=yy,ia.createPortal=function(p,g){var A=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Vh(g))throw Error(r(200));return q1(p,g,null,A)},ia.createRoot=function(p,g){if(!Vh(p))throw Error(r(299));var A=!1,P="",N=$l;return g!=null&&(g.unstable_strictMode===!0&&(A=!0),g.identifierPrefix!==void 0&&(P=g.identifierPrefix),g.onRecoverableError!==void 0&&(N=g.onRecoverableError)),g=xg(p,1,!1,null,null,A,!1,P,N),p[Zo]=g.current,ol(p.nodeType===8?p.parentNode:p),new $u(g)},ia.findDOMNode=function(p){if(p==null)return null;if(p.nodeType===1)return p;var g=p._reactInternals;if(g===void 0)throw typeof p.render=="function"?Error(r(188)):(p=Object.keys(p).join(","),Error(r(268,p)));return p=hr(g),p=p===null?null:p.stateNode,p},ia.flushSync=function(p){return Gu(p)},ia.hydrate=function(p,g,A){if(!Zu(g))throw Error(r(200));return _p(null,p,g,!0,A)},ia.hydrateRoot=function(p,g,A){if(!Vh(p))throw Error(r(405));var P=A!=null&&A.hydratedSources||null,N=!1,j="",se=$l;if(A!=null&&(A.unstable_strictMode===!0&&(N=!0),A.identifierPrefix!==void 0&&(j=A.identifierPrefix),A.onRecoverableError!==void 0&&(se=A.onRecoverableError)),g=my(g,null,p,1,A??null,N,!1,j,se),p[Zo]=g.current,ol(p),P)for(p=0;p<P.length;p++)A=P[p],N=A._getVersion,N=N(A._source),g.mutableSourceEagerHydrationData==null?g.mutableSourceEagerHydrationData=[A,N]:g.mutableSourceEagerHydrationData.push(A,N);return new Zl(g)},ia.render=function(p,g,A){if(!Zu(g))throw Error(r(200));return _p(null,p,g,!1,A)},ia.unmountComponentAtNode=function(p){if(!Zu(p))throw Error(r(40));return p._reactRootContainer?(Gu(function(){_p(null,null,p,!1,function(){p._reactRootContainer=null,p[Zo]=null})}),!0):!1},ia.unstable_batchedUpdates=gg,ia.unstable_renderSubtreeIntoContainer=function(p,g,A,P){if(!Zu(A))throw Error(r(200));if(p==null||p._reactInternals===void 0)throw Error(r(38));return _p(p,g,A,!1,P)},ia.version="18.3.1-next-f1338f8080-20240426",ia}var dA;function gM(){if(dA)return hv.exports;dA=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}return t(),hv.exports=XB(),hv.exports}var pA;function KB(){if(pA)return Sy;pA=1;var t=gM();return Sy.createRoot=t.createRoot,Sy.hydrateRoot=t.hydrateRoot,Sy}var YB=KB(),te=o1();const Jh=mM(te),uw=GB({__proto__:null,default:Jh},[te]);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const JB=t=>t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),QB=t=>t.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,r,i)=>i?i.toUpperCase():r.toLowerCase()),fA=t=>{const e=QB(t);return e.charAt(0).toUpperCase()+e.slice(1)},_M=(...t)=>t.filter((e,r,i)=>!!e&&e.trim()!==""&&i.indexOf(e)===r).join(" ").trim();/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var e6={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const t6=te.forwardRef(({color:t="currentColor",size:e=24,strokeWidth:r=2,absoluteStrokeWidth:i,className:s="",children:l,iconNode:h,...a},v)=>te.createElement("svg",{ref:v,...e6,width:e,height:e,stroke:t,strokeWidth:i?Number(r)*24/Number(e):r,className:_M("lucide",s),...a},[...h.map(([T,C])=>te.createElement(T,C)),...Array.isArray(l)?l:[l]]));/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gi=(t,e)=>{const r=te.forwardRef(({className:i,...s},l)=>te.createElement(t6,{ref:l,iconNode:e,className:_M(`lucide-${JB(fA(t))}`,`lucide-${t}`,i),...s}));return r.displayName=fA(t),r};/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const r6=[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]],yM=Gi("building-2",r6);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const i6=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],a1=Gi("calendar",i6);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const n6=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],vM=Gi("circle-check-big",n6);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const s6=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]],bM=Gi("clock",s6);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const o6=[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]],a6=Gi("credit-card",o6);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const l6=[["path",{d:"M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z",key:"96xj49"}]],c6=Gi("flame",l6);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const u6=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"M15 3v18",key:"14nvp0"}]],h6=Gi("grid-3x3",u6);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const d6=[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]],p6=Gi("heart",d6);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const f6=[["path",{d:"M6 3h12",key:"ggurg9"}],["path",{d:"M6 8h12",key:"6g4wlu"}],["path",{d:"m6 13 8.5 8",key:"u1kupk"}],["path",{d:"M6 13h3",key:"wdp6ag"}],["path",{d:"M9 13c6.667 0 6.667-10 0-10",key:"1nkvk2"}]],xM=Gi("indian-rupee",f6);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const m6=[["rect",{width:"20",height:"20",x:"2",y:"2",rx:"5",ry:"5",key:"2e1cvw"}],["path",{d:"M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z",key:"9exkf1"}],["line",{x1:"17.5",x2:"17.51",y1:"6.5",y2:"6.5",key:"r4j83e"}]],wM=Gi("instagram",m6);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const g6=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],_6=Gi("loader-circle",g6);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const y6=[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]],Hp=Gi("map-pin",y6);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const v6=[["path",{d:"M14.106 5.553a2 2 0 0 0 1.788 0l3.659-1.83A1 1 0 0 1 21 4.619v12.764a1 1 0 0 1-.553.894l-4.553 2.277a2 2 0 0 1-1.788 0l-4.212-2.106a2 2 0 0 0-1.788 0l-3.659 1.83A1 1 0 0 1 3 19.381V6.618a1 1 0 0 1 .553-.894l4.553-2.277a2 2 0 0 1 1.788 0z",key:"169xi5"}],["path",{d:"M15 5.764v15",key:"1pn4in"}],["path",{d:"M9 3.236v15",key:"1uimfh"}]],b6=Gi("map",v6);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const x6=[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]],w6=Gi("message-circle",x6);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const E6=[["path",{d:"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z",key:"a7tn18"}]],A6=Gi("moon",E6);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const T6=[["polygon",{points:"3 11 22 2 13 21 11 13 3 11",key:"1ltx0t"}]],S6=Gi("navigation",T6);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const C6=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],M6=Gi("pen",C6);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const P6=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],R6=Gi("plus",P6);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const I6=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]],k6=Gi("search",I6);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B6=[["path",{d:"M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z",key:"4pj2yx"}],["path",{d:"M20 3v4",key:"1olli1"}],["path",{d:"M22 5h-4",key:"1gvqau"}],["path",{d:"M4 17v2",key:"vumght"}],["path",{d:"M5 18H3",key:"zchphs"}]],hw=Gi("sparkles",B6);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const L6=[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]],EM=Gi("star",L6);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const D6=[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]],N6=Gi("sun",D6);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O6=[["path",{d:"M2 9a3 3 0 0 1 0 6v2a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-2a3 3 0 0 1 0-6V7a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2Z",key:"qn84l0"}],["path",{d:"M13 5v2",key:"dyzc3o"}],["path",{d:"M13 17v2",key:"1ont0d"}],["path",{d:"M13 11v2",key:"1wjjxi"}]],dw=Gi("ticket",O6);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const F6=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],z6=Gi("user",F6);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U6=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]],fm=Gi("users",U6);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const j6=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],pw=Gi("x",j6),fw=te.createContext({});function mw(t){const e=te.useRef(null);return e.current===null&&(e.current=t()),e.current}const gw=typeof window<"u",AM=gw?te.useLayoutEffect:te.useEffect,l1=te.createContext(null);function _w(t,e){t.indexOf(e)===-1&&t.push(e)}function yw(t,e){const r=t.indexOf(e);r>-1&&t.splice(r,1)}const ih=(t,e,r)=>r>e?e:r<t?t:r;let vw=()=>{};const nh={},TM=t=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(t);function SM(t){return typeof t=="object"&&t!==null}const CM=t=>/^0[^.\s]+$/u.test(t);function bw(t){let e;return()=>(e===void 0&&(e=t()),e)}const Al=t=>t,V6=(t,e)=>r=>e(t(r)),C_=(...t)=>t.reduce(V6),u_=(t,e,r)=>{const i=e-t;return i===0?1:(r-t)/i};class xw{constructor(){this.subscriptions=[]}add(e){return _w(this.subscriptions,e),()=>yw(this.subscriptions,e)}notify(e,r,i){const s=this.subscriptions.length;if(s)if(s===1)this.subscriptions[0](e,r,i);else for(let l=0;l<s;l++){const h=this.subscriptions[l];h&&h(e,r,i)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const au=t=>t*1e3,bl=t=>t/1e3;function MM(t,e){return e?t*(1e3/e):0}const PM=(t,e,r)=>(((1-3*r+3*e)*t+(3*r-6*e))*t+3*e)*t,G6=1e-7,H6=12;function W6(t,e,r,i,s){let l,h,a=0;do h=e+(r-e)/2,l=PM(h,i,s)-t,l>0?r=h:e=h;while(Math.abs(l)>G6&&++a<H6);return h}function M_(t,e,r,i){if(t===e&&r===i)return Al;const s=l=>W6(l,0,1,t,r);return l=>l===0||l===1?l:PM(s(l),e,i)}const RM=t=>e=>e<=.5?t(2*e)/2:(2-t(2*(1-e)))/2,IM=t=>e=>1-t(1-e),kM=M_(.33,1.53,.69,.99),ww=IM(kM),BM=RM(ww),LM=t=>(t*=2)<1?.5*ww(t):.5*(2-Math.pow(2,-10*(t-1))),Ew=t=>1-Math.sin(Math.acos(t)),DM=IM(Ew),NM=RM(Ew),q6=M_(.42,0,1,1),$6=M_(0,0,.58,1),OM=M_(.42,0,.58,1),Z6=t=>Array.isArray(t)&&typeof t[0]!="number",FM=t=>Array.isArray(t)&&typeof t[0]=="number",X6={linear:Al,easeIn:q6,easeInOut:OM,easeOut:$6,circIn:Ew,circInOut:NM,circOut:DM,backIn:ww,backInOut:BM,backOut:kM,anticipate:LM},K6=t=>typeof t=="string",mA=t=>{if(FM(t)){vw(t.length===4);const[e,r,i,s]=t;return M_(e,r,i,s)}else if(K6(t))return X6[t];return t},Cy=["setup","read","resolveKeyframes","preUpdate","update","preRender","render","postRender"];function Y6(t,e){let r=new Set,i=new Set,s=!1,l=!1;const h=new WeakSet;let a={delta:0,timestamp:0,isProcessing:!1};function v(C){h.has(C)&&(T.schedule(C),t()),C(a)}const T={schedule:(C,k=!1,L=!1)=>{const K=L&&s?r:i;return k&&h.add(C),K.has(C)||K.add(C),C},cancel:C=>{i.delete(C),h.delete(C)},process:C=>{if(a=C,s){l=!0;return}s=!0,[r,i]=[i,r],r.forEach(v),r.clear(),s=!1,l&&(l=!1,T.process(C))}};return T}const J6=40;function zM(t,e){let r=!1,i=!0;const s={delta:0,timestamp:0,isProcessing:!1},l=()=>r=!0,h=Cy.reduce((ue,we)=>(ue[we]=Y6(l),ue),{}),{setup:a,read:v,resolveKeyframes:T,preUpdate:C,update:k,preRender:L,render:O,postRender:K}=h,$=()=>{const ue=nh.useManualTiming?s.timestamp:performance.now();r=!1,nh.useManualTiming||(s.delta=i?1e3/60:Math.max(Math.min(ue-s.timestamp,J6),1)),s.timestamp=ue,s.isProcessing=!0,a.process(s),v.process(s),T.process(s),C.process(s),k.process(s),L.process(s),O.process(s),K.process(s),s.isProcessing=!1,r&&e&&(i=!1,t($))},ne=()=>{r=!0,i=!0,s.isProcessing||t($)};return{schedule:Cy.reduce((ue,we)=>{const De=h[we];return ue[we]=(Fe,Ke=!1,ze=!1)=>(r||ne(),De.schedule(Fe,Ke,ze)),ue},{}),cancel:ue=>{for(let we=0;we<Cy.length;we++)h[Cy[we]].cancel(ue)},state:s,steps:h}}const{schedule:on,cancel:ld,state:Ys,steps:fv}=zM(typeof requestAnimationFrame<"u"?requestAnimationFrame:Al,!0);let m0;function Q6(){m0=void 0}const ca={now:()=>(m0===void 0&&ca.set(Ys.isProcessing||nh.useManualTiming?Ys.timestamp:performance.now()),m0),set:t=>{m0=t,queueMicrotask(Q6)}},UM=t=>e=>typeof e=="string"&&e.startsWith(t),Aw=UM("--"),eL=UM("var(--"),Tw=t=>eL(t)?tL.test(t.split("/*")[0].trim()):!1,tL=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,Mm={test:t=>typeof t=="number",parse:parseFloat,transform:t=>t},h_={...Mm,transform:t=>ih(0,1,t)},My={...Mm,default:1},Yg=t=>Math.round(t*1e5)/1e5,Sw=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function rL(t){return t==null}const iL=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,Cw=(t,e)=>r=>!!(typeof r=="string"&&iL.test(r)&&r.startsWith(t)||e&&!rL(r)&&Object.prototype.hasOwnProperty.call(r,e)),jM=(t,e,r)=>i=>{if(typeof i!="string")return i;const[s,l,h,a]=i.match(Sw);return{[t]:parseFloat(s),[e]:parseFloat(l),[r]:parseFloat(h),alpha:a!==void 0?parseFloat(a):1}},nL=t=>ih(0,255,t),mv={...Mm,transform:t=>Math.round(nL(t))},kp={test:Cw("rgb","red"),parse:jM("red","green","blue"),transform:({red:t,green:e,blue:r,alpha:i=1})=>"rgba("+mv.transform(t)+", "+mv.transform(e)+", "+mv.transform(r)+", "+Yg(h_.transform(i))+")"};function sL(t){let e="",r="",i="",s="";return t.length>5?(e=t.substring(1,3),r=t.substring(3,5),i=t.substring(5,7),s=t.substring(7,9)):(e=t.substring(1,2),r=t.substring(2,3),i=t.substring(3,4),s=t.substring(4,5),e+=e,r+=r,i+=i,s+=s),{red:parseInt(e,16),green:parseInt(r,16),blue:parseInt(i,16),alpha:s?parseInt(s,16)/255:1}}const Wb={test:Cw("#"),parse:sL,transform:kp.transform},P_=t=>({test:e=>typeof e=="string"&&e.endsWith(t)&&e.split(" ").length===1,parse:parseFloat,transform:e=>`${e}${t}`}),Qh=P_("deg"),lu=P_("%"),Mr=P_("px"),oL=P_("vh"),aL=P_("vw"),gA={...lu,parse:t=>lu.parse(t)/100,transform:t=>lu.transform(t*100)},qf={test:Cw("hsl","hue"),parse:jM("hue","saturation","lightness"),transform:({hue:t,saturation:e,lightness:r,alpha:i=1})=>"hsla("+Math.round(t)+", "+lu.transform(Yg(e))+", "+lu.transform(Yg(r))+", "+Yg(h_.transform(i))+")"},Xn={test:t=>kp.test(t)||Wb.test(t)||qf.test(t),parse:t=>kp.test(t)?kp.parse(t):qf.test(t)?qf.parse(t):Wb.parse(t),transform:t=>typeof t=="string"?t:t.hasOwnProperty("red")?kp.transform(t):qf.transform(t),getAnimatableNone:t=>{const e=Xn.parse(t);return e.alpha=0,Xn.transform(e)}},lL=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function cL(t){return isNaN(t)&&typeof t=="string"&&(t.match(Sw)?.length||0)+(t.match(lL)?.length||0)>0}const VM="number",GM="color",uL="var",hL="var(",_A="${}",dL=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function d_(t){const e=t.toString(),r=[],i={color:[],number:[],var:[]},s=[];let l=0;const a=e.replace(dL,v=>(Xn.test(v)?(i.color.push(l),s.push(GM),r.push(Xn.parse(v))):v.startsWith(hL)?(i.var.push(l),s.push(uL),r.push(v)):(i.number.push(l),s.push(VM),r.push(parseFloat(v))),++l,_A)).split(_A);return{values:r,split:a,indexes:i,types:s}}function HM(t){return d_(t).values}function WM(t){const{split:e,types:r}=d_(t),i=e.length;return s=>{let l="";for(let h=0;h<i;h++)if(l+=e[h],s[h]!==void 0){const a=r[h];a===VM?l+=Yg(s[h]):a===GM?l+=Xn.transform(s[h]):l+=s[h]}return l}}const pL=t=>typeof t=="number"?0:Xn.test(t)?Xn.getAnimatableNone(t):t;function fL(t){const e=HM(t);return WM(t)(e.map(pL))}const cd={test:cL,parse:HM,createTransformer:WM,getAnimatableNone:fL};function gv(t,e,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?t+(e-t)*6*r:r<1/2?e:r<2/3?t+(e-t)*(2/3-r)*6:t}function mL({hue:t,saturation:e,lightness:r,alpha:i}){t/=360,e/=100,r/=100;let s=0,l=0,h=0;if(!e)s=l=h=r;else{const a=r<.5?r*(1+e):r+e-r*e,v=2*r-a;s=gv(v,a,t+1/3),l=gv(v,a,t),h=gv(v,a,t-1/3)}return{red:Math.round(s*255),green:Math.round(l*255),blue:Math.round(h*255),alpha:i}}function R0(t,e){return r=>r>0?e:t}const _n=(t,e,r)=>t+(e-t)*r,_v=(t,e,r)=>{const i=t*t,s=r*(e*e-i)+i;return s<0?0:Math.sqrt(s)},gL=[Wb,kp,qf],_L=t=>gL.find(e=>e.test(t));function yA(t){const e=_L(t);if(!e)return!1;let r=e.parse(t);return e===qf&&(r=mL(r)),r}const vA=(t,e)=>{const r=yA(t),i=yA(e);if(!r||!i)return R0(t,e);const s={...r};return l=>(s.red=_v(r.red,i.red,l),s.green=_v(r.green,i.green,l),s.blue=_v(r.blue,i.blue,l),s.alpha=_n(r.alpha,i.alpha,l),kp.transform(s))},qb=new Set(["none","hidden"]);function yL(t,e){return qb.has(t)?r=>r<=0?t:e:r=>r>=1?e:t}function vL(t,e){return r=>_n(t,e,r)}function Mw(t){return typeof t=="number"?vL:typeof t=="string"?Tw(t)?R0:Xn.test(t)?vA:wL:Array.isArray(t)?qM:typeof t=="object"?Xn.test(t)?vA:bL:R0}function qM(t,e){const r=[...t],i=r.length,s=t.map((l,h)=>Mw(l)(l,e[h]));return l=>{for(let h=0;h<i;h++)r[h]=s[h](l);return r}}function bL(t,e){const r={...t,...e},i={};for(const s in r)t[s]!==void 0&&e[s]!==void 0&&(i[s]=Mw(t[s])(t[s],e[s]));return s=>{for(const l in i)r[l]=i[l](s);return r}}function xL(t,e){const r=[],i={color:0,var:0,number:0};for(let s=0;s<e.values.length;s++){const l=e.types[s],h=t.indexes[l][i[l]],a=t.values[h]??0;r[s]=a,i[l]++}return r}const wL=(t,e)=>{const r=cd.createTransformer(e),i=d_(t),s=d_(e);return i.indexes.var.length===s.indexes.var.length&&i.indexes.color.length===s.indexes.color.length&&i.indexes.number.length>=s.indexes.number.length?qb.has(t)&&!s.values.length||qb.has(e)&&!i.values.length?yL(t,e):C_(qM(xL(i,s),s.values),r):R0(t,e)};function $M(t,e,r){return typeof t=="number"&&typeof e=="number"&&typeof r=="number"?_n(t,e,r):Mw(t)(t,e)}const EL=t=>{const e=({timestamp:r})=>t(r);return{start:(r=!0)=>on.update(e,r),stop:()=>ld(e),now:()=>Ys.isProcessing?Ys.timestamp:ca.now()}},ZM=(t,e,r=10)=>{let i="";const s=Math.max(Math.round(e/r),2);for(let l=0;l<s;l++)i+=Math.round(t(l/(s-1))*1e4)/1e4+", ";return`linear(${i.substring(0,i.length-2)})`},I0=2e4;function Pw(t){let e=0;const r=50;let i=t.next(e);for(;!i.done&&e<I0;)e+=r,i=t.next(e);return e>=I0?1/0:e}function AL(t,e=100,r){const i=r({...t,keyframes:[0,e]}),s=Math.min(Pw(i),I0);return{type:"keyframes",ease:l=>i.next(s*l).value/e,duration:bl(s)}}const TL=5;function XM(t,e,r){const i=Math.max(e-TL,0);return MM(r-t(i),e-i)}const Tn={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},yv=.001;function SL({duration:t=Tn.duration,bounce:e=Tn.bounce,velocity:r=Tn.velocity,mass:i=Tn.mass}){let s,l,h=1-e;h=ih(Tn.minDamping,Tn.maxDamping,h),t=ih(Tn.minDuration,Tn.maxDuration,bl(t)),h<1?(s=T=>{const C=T*h,k=C*t,L=C-r,O=$b(T,h),K=Math.exp(-k);return yv-L/O*K},l=T=>{const k=T*h*t,L=k*r+r,O=Math.pow(h,2)*Math.pow(T,2)*t,K=Math.exp(-k),$=$b(Math.pow(T,2),h);return(-s(T)+yv>0?-1:1)*((L-O)*K)/$}):(s=T=>{const C=Math.exp(-T*t),k=(T-r)*t+1;return-yv+C*k},l=T=>{const C=Math.exp(-T*t),k=(r-T)*(t*t);return C*k});const a=5/t,v=ML(s,l,a);if(t=au(t),isNaN(v))return{stiffness:Tn.stiffness,damping:Tn.damping,duration:t};{const T=Math.pow(v,2)*i;return{stiffness:T,damping:h*2*Math.sqrt(i*T),duration:t}}}const CL=12;function ML(t,e,r){let i=r;for(let s=1;s<CL;s++)i=i-t(i)/e(i);return i}function $b(t,e){return t*Math.sqrt(1-e*e)}const PL=["duration","bounce"],RL=["stiffness","damping","mass"];function bA(t,e){return e.some(r=>t[r]!==void 0)}function IL(t){let e={velocity:Tn.velocity,stiffness:Tn.stiffness,damping:Tn.damping,mass:Tn.mass,isResolvedFromDuration:!1,...t};if(!bA(t,RL)&&bA(t,PL))if(t.visualDuration){const r=t.visualDuration,i=2*Math.PI/(r*1.2),s=i*i,l=2*ih(.05,1,1-(t.bounce||0))*Math.sqrt(s);e={...e,mass:Tn.mass,stiffness:s,damping:l}}else{const r=SL(t);e={...e,...r,mass:Tn.mass},e.isResolvedFromDuration=!0}return e}function k0(t=Tn.visualDuration,e=Tn.bounce){const r=typeof t!="object"?{visualDuration:t,keyframes:[0,1],bounce:e}:t;let{restSpeed:i,restDelta:s}=r;const l=r.keyframes[0],h=r.keyframes[r.keyframes.length-1],a={done:!1,value:l},{stiffness:v,damping:T,mass:C,duration:k,velocity:L,isResolvedFromDuration:O}=IL({...r,velocity:-bl(r.velocity||0)}),K=L||0,$=T/(2*Math.sqrt(v*C)),ne=h-l,oe=bl(Math.sqrt(v/C)),fe=Math.abs(ne)<5;i||(i=fe?Tn.restSpeed.granular:Tn.restSpeed.default),s||(s=fe?Tn.restDelta.granular:Tn.restDelta.default);let ue;if($<1){const De=$b(oe,$);ue=Fe=>{const Ke=Math.exp(-$*oe*Fe);return h-Ke*((K+$*oe*ne)/De*Math.sin(De*Fe)+ne*Math.cos(De*Fe))}}else if($===1)ue=De=>h-Math.exp(-oe*De)*(ne+(K+oe*ne)*De);else{const De=oe*Math.sqrt($*$-1);ue=Fe=>{const Ke=Math.exp(-$*oe*Fe),ze=Math.min(De*Fe,300);return h-Ke*((K+$*oe*ne)*Math.sinh(ze)+De*ne*Math.cosh(ze))/De}}const we={calculatedDuration:O&&k||null,next:De=>{const Fe=ue(De);if(O)a.done=De>=k;else{let Ke=De===0?K:0;$<1&&(Ke=De===0?au(K):XM(ue,De,Fe));const ze=Math.abs(Ke)<=i,it=Math.abs(h-Fe)<=s;a.done=ze&&it}return a.value=a.done?h:Fe,a},toString:()=>{const De=Math.min(Pw(we),I0),Fe=ZM(Ke=>we.next(De*Ke).value,De,30);return De+"ms "+Fe},toTransition:()=>{}};return we}k0.applyToOptions=t=>{const e=AL(t,100,k0);return t.ease=e.ease,t.duration=au(e.duration),t.type="keyframes",t};function Zb({keyframes:t,velocity:e=0,power:r=.8,timeConstant:i=325,bounceDamping:s=10,bounceStiffness:l=500,modifyTarget:h,min:a,max:v,restDelta:T=.5,restSpeed:C}){const k=t[0],L={done:!1,value:k},O=ze=>a!==void 0&&ze<a||v!==void 0&&ze>v,K=ze=>a===void 0?v:v===void 0||Math.abs(a-ze)<Math.abs(v-ze)?a:v;let $=r*e;const ne=k+$,oe=h===void 0?ne:h(ne);oe!==ne&&($=oe-k);const fe=ze=>-$*Math.exp(-ze/i),ue=ze=>oe+fe(ze),we=ze=>{const it=fe(ze),lt=ue(ze);L.done=Math.abs(it)<=T,L.value=L.done?oe:lt};let De,Fe;const Ke=ze=>{O(L.value)&&(De=ze,Fe=k0({keyframes:[L.value,K(L.value)],velocity:XM(ue,ze,L.value),damping:s,stiffness:l,restDelta:T,restSpeed:C}))};return Ke(0),{calculatedDuration:null,next:ze=>{let it=!1;return!Fe&&De===void 0&&(it=!0,we(ze),Ke(ze)),De!==void 0&&ze>=De?Fe.next(ze-De):(!it&&we(ze),L)}}}function kL(t,e,r){const i=[],s=r||nh.mix||$M,l=t.length-1;for(let h=0;h<l;h++){let a=s(t[h],t[h+1]);if(e){const v=Array.isArray(e)?e[h]||Al:e;a=C_(v,a)}i.push(a)}return i}function BL(t,e,{clamp:r=!0,ease:i,mixer:s}={}){const l=t.length;if(vw(l===e.length),l===1)return()=>e[0];if(l===2&&e[0]===e[1])return()=>e[1];const h=t[0]===t[1];t[0]>t[l-1]&&(t=[...t].reverse(),e=[...e].reverse());const a=kL(e,i,s),v=a.length,T=C=>{if(h&&C<t[0])return e[0];let k=0;if(v>1)for(;k<t.length-2&&!(C<t[k+1]);k++);const L=u_(t[k],t[k+1],C);return a[k](L)};return r?C=>T(ih(t[0],t[l-1],C)):T}function LL(t,e){const r=t[t.length-1];for(let i=1;i<=e;i++){const s=u_(0,e,i);t.push(_n(r,1,s))}}function DL(t){const e=[0];return LL(e,t.length-1),e}function NL(t,e){return t.map(r=>r*e)}function OL(t,e){return t.map(()=>e||OM).splice(0,t.length-1)}function Jg({duration:t=300,keyframes:e,times:r,ease:i="easeInOut"}){const s=Z6(i)?i.map(mA):mA(i),l={done:!1,value:e[0]},h=NL(r&&r.length===e.length?r:DL(e),t),a=BL(h,e,{ease:Array.isArray(s)?s:OL(e,s)});return{calculatedDuration:t,next:v=>(l.value=a(v),l.done=v>=t,l)}}const FL=t=>t!==null;function Rw(t,{repeat:e,repeatType:r="loop"},i,s=1){const l=t.filter(FL),a=s<0||e&&r!=="loop"&&e%2===1?0:l.length-1;return!a||i===void 0?l[a]:i}const zL={decay:Zb,inertia:Zb,tween:Jg,keyframes:Jg,spring:k0};function KM(t){typeof t.type=="string"&&(t.type=zL[t.type])}class Iw{constructor(){this.updateFinished()}get finished(){return this._finished}updateFinished(){this._finished=new Promise(e=>{this.resolve=e})}notifyFinished(){this.resolve()}then(e,r){return this.finished.then(e,r)}}const UL=t=>t/100;class kw extends Iw{constructor(e){super(),this.state="idle",this.startTime=null,this.isStopped=!1,this.currentTime=0,this.holdTime=null,this.playbackSpeed=1,this.stop=()=>{const{motionValue:r}=this.options;r&&r.updatedAt!==ca.now()&&this.tick(ca.now()),this.isStopped=!0,this.state!=="idle"&&(this.teardown(),this.options.onStop?.())},this.options=e,this.initAnimation(),this.play(),e.autoplay===!1&&this.pause()}initAnimation(){const{options:e}=this;KM(e);const{type:r=Jg,repeat:i=0,repeatDelay:s=0,repeatType:l,velocity:h=0}=e;let{keyframes:a}=e;const v=r||Jg;v!==Jg&&typeof a[0]!="number"&&(this.mixKeyframes=C_(UL,$M(a[0],a[1])),a=[0,100]);const T=v({...e,keyframes:a});l==="mirror"&&(this.mirroredGenerator=v({...e,keyframes:[...a].reverse(),velocity:-h})),T.calculatedDuration===null&&(T.calculatedDuration=Pw(T));const{calculatedDuration:C}=T;this.calculatedDuration=C,this.resolvedDuration=C+s,this.totalDuration=this.resolvedDuration*(i+1)-s,this.generator=T}updateTime(e){const r=Math.round(e-this.startTime)*this.playbackSpeed;this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=r}tick(e,r=!1){const{generator:i,totalDuration:s,mixKeyframes:l,mirroredGenerator:h,resolvedDuration:a,calculatedDuration:v}=this;if(this.startTime===null)return i.next(0);const{delay:T=0,keyframes:C,repeat:k,repeatType:L,repeatDelay:O,type:K,onUpdate:$,finalKeyframe:ne}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,e):this.speed<0&&(this.startTime=Math.min(e-s/this.speed,this.startTime)),r?this.currentTime=e:this.updateTime(e);const oe=this.currentTime-T*(this.playbackSpeed>=0?1:-1),fe=this.playbackSpeed>=0?oe<0:oe>s;this.currentTime=Math.max(oe,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=s);let ue=this.currentTime,we=i;if(k){const ze=Math.min(this.currentTime,s)/a;let it=Math.floor(ze),lt=ze%1;!lt&&ze>=1&&(lt=1),lt===1&&it--,it=Math.min(it,k+1),!!(it%2)&&(L==="reverse"?(lt=1-lt,O&&(lt-=O/a)):L==="mirror"&&(we=h)),ue=ih(0,1,lt)*a}const De=fe?{done:!1,value:C[0]}:we.next(ue);l&&(De.value=l(De.value));let{done:Fe}=De;!fe&&v!==null&&(Fe=this.playbackSpeed>=0?this.currentTime>=s:this.currentTime<=0);const Ke=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&Fe);return Ke&&K!==Zb&&(De.value=Rw(C,this.options,ne,this.speed)),$&&$(De.value),Ke&&this.finish(),De}then(e,r){return this.finished.then(e,r)}get duration(){return bl(this.calculatedDuration)}get iterationDuration(){const{delay:e=0}=this.options||{};return this.duration+bl(e)}get time(){return bl(this.currentTime)}set time(e){e=au(e),this.currentTime=e,this.startTime===null||this.holdTime!==null||this.playbackSpeed===0?this.holdTime=e:this.driver&&(this.startTime=this.driver.now()-e/this.playbackSpeed),this.driver?.start(!1)}get speed(){return this.playbackSpeed}set speed(e){this.updateTime(ca.now());const r=this.playbackSpeed!==e;this.playbackSpeed=e,r&&(this.time=bl(this.currentTime))}play(){if(this.isStopped)return;const{driver:e=EL,startTime:r}=this.options;this.driver||(this.driver=e(s=>this.tick(s))),this.options.onPlay?.();const i=this.driver.now();this.state==="finished"?(this.updateFinished(),this.startTime=i):this.holdTime!==null?this.startTime=i-this.holdTime:this.startTime||(this.startTime=r??i),this.state==="finished"&&this.speed<0&&(this.startTime+=this.calculatedDuration),this.holdTime=null,this.state="running",this.driver.start()}pause(){this.state="paused",this.updateTime(ca.now()),this.holdTime=this.currentTime}complete(){this.state!=="running"&&this.play(),this.state="finished",this.holdTime=null}finish(){this.notifyFinished(),this.teardown(),this.state="finished",this.options.onComplete?.()}cancel(){this.holdTime=null,this.startTime=0,this.tick(0),this.teardown(),this.options.onCancel?.()}teardown(){this.state="idle",this.stopDriver(),this.startTime=this.holdTime=null}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(e){return this.startTime=0,this.tick(e,!0)}attachTimeline(e){return this.options.allowFlatten&&(this.options.type="keyframes",this.options.ease="linear",this.initAnimation()),this.driver?.stop(),e.observe(this)}}function jL(t){for(let e=1;e<t.length;e++)t[e]??(t[e]=t[e-1])}const Bp=t=>t*180/Math.PI,Xb=t=>{const e=Bp(Math.atan2(t[1],t[0]));return Kb(e)},VL={x:4,y:5,translateX:4,translateY:5,scaleX:0,scaleY:3,scale:t=>(Math.abs(t[0])+Math.abs(t[3]))/2,rotate:Xb,rotateZ:Xb,skewX:t=>Bp(Math.atan(t[1])),skewY:t=>Bp(Math.atan(t[2])),skew:t=>(Math.abs(t[1])+Math.abs(t[2]))/2},Kb=t=>(t=t%360,t<0&&(t+=360),t),xA=Xb,wA=t=>Math.sqrt(t[0]*t[0]+t[1]*t[1]),EA=t=>Math.sqrt(t[4]*t[4]+t[5]*t[5]),HL={x:12,y:13,z:14,translateX:12,translateY:13,translateZ:14,scaleX:wA,scaleY:EA,scale:t=>(wA(t)+EA(t))/2,rotateX:t=>Kb(Bp(Math.atan2(t[6],t[5]))),rotateY:t=>Kb(Bp(Math.atan2(-t[2],t[0]))),rotateZ:xA,rotate:xA,skewX:t=>Bp(Math.atan(t[4])),skewY:t=>Bp(Math.atan(t[1])),skew:t=>(Math.abs(t[1])+Math.abs(t[4]))/2};function Yb(t){return t.includes("scale")?1:0}function Jb(t,e){if(!t||t==="none")return Yb(e);const r=t.match(/^matrix3d\(([-\d.e\s,]+)\)$/u);let i,s;if(r)i=HL,s=r;else{const a=t.match(/^matrix\(([-\d.e\s,]+)\)$/u);i=VL,s=a}if(!s)return Yb(e);const l=i[e],h=s[1].split(",").map(qL);return typeof l=="function"?l(h):h[l]}const WL=(t,e)=>{const{transform:r="none"}=getComputedStyle(t);return Jb(r,e)};function qL(t){return parseFloat(t.trim())}const Pm=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],Rm=new Set(Pm),AA=t=>t===Mm||t===Mr,$L=new Set(["x","y","z"]),ZL=Pm.filter(t=>!$L.has(t));function XL(t){const e=[];return ZL.forEach(r=>{const i=t.getValue(r);i!==void 0&&(e.push([r,i.get()]),i.set(r.startsWith("scale")?1:0))}),e}const zp={width:({x:t},{paddingLeft:e="0",paddingRight:r="0"})=>t.max-t.min-parseFloat(e)-parseFloat(r),height:({y:t},{paddingTop:e="0",paddingBottom:r="0"})=>t.max-t.min-parseFloat(e)-parseFloat(r),top:(t,{top:e})=>parseFloat(e),left:(t,{left:e})=>parseFloat(e),bottom:({y:t},{top:e})=>parseFloat(e)+(t.max-t.min),right:({x:t},{left:e})=>parseFloat(e)+(t.max-t.min),x:(t,{transform:e})=>Jb(e,"x"),y:(t,{transform:e})=>Jb(e,"y")};zp.translateX=zp.x;zp.translateY=zp.y;const Up=new Set;let Qb=!1,ex=!1,tx=!1;function YM(){if(ex){const t=Array.from(Up).filter(i=>i.needsMeasurement),e=new Set(t.map(i=>i.element)),r=new Map;e.forEach(i=>{const s=XL(i);s.length&&(r.set(i,s),i.render())}),t.forEach(i=>i.measureInitialState()),e.forEach(i=>{i.render();const s=r.get(i);s&&s.forEach(([l,h])=>{i.getValue(l)?.set(h)})}),t.forEach(i=>i.measureEndState()),t.forEach(i=>{i.suspendedScrollY!==void 0&&window.scrollTo(0,i.suspendedScrollY)})}ex=!1,Qb=!1,Up.forEach(t=>t.complete(tx)),Up.clear()}function JM(){Up.forEach(t=>{t.readKeyframes(),t.needsMeasurement&&(ex=!0)})}function KL(){tx=!0,JM(),YM(),tx=!1}class Bw{constructor(e,r,i,s,l,h=!1){this.state="pending",this.isAsync=!1,this.needsMeasurement=!1,this.unresolvedKeyframes=[...e],this.onComplete=r,this.name=i,this.motionValue=s,this.element=l,this.isAsync=h}scheduleResolve(){this.state="scheduled",this.isAsync?(Up.add(this),Qb||(Qb=!0,on.read(JM),on.resolveKeyframes(YM))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:e,name:r,element:i,motionValue:s}=this;if(e[0]===null){const l=s?.get(),h=e[e.length-1];if(l!==void 0)e[0]=l;else if(i&&r){const a=i.readValue(r,h);a!=null&&(e[0]=a)}e[0]===void 0&&(e[0]=h),s&&l===void 0&&s.set(e[0])}jL(e)}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(e=!1){this.state="complete",this.onComplete(this.unresolvedKeyframes,this.finalKeyframe,e),Up.delete(this)}cancel(){this.state==="scheduled"&&(Up.delete(this),this.state="pending")}resume(){this.state==="pending"&&this.scheduleResolve()}}const YL=t=>t.startsWith("--");function JL(t,e,r){YL(e)?t.style.setProperty(e,r):t.style[e]=r}const QL=bw(()=>window.ScrollTimeline!==void 0),eD={};function tD(t,e){const r=bw(t);return()=>eD[e]??r()}const QM=tD(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),Hg=([t,e,r,i])=>`cubic-bezier(${t}, ${e}, ${r}, ${i})`,TA={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:Hg([0,.65,.55,1]),circOut:Hg([.55,0,1,.45]),backIn:Hg([.31,.01,.66,-.59]),backOut:Hg([.33,1.53,.69,.99])};function eP(t,e){if(t)return typeof t=="function"?QM()?ZM(t,e):"ease-out":FM(t)?Hg(t):Array.isArray(t)?t.map(r=>eP(r,e)||TA.easeOut):TA[t]}function rD(t,e,r,{delay:i=0,duration:s=300,repeat:l=0,repeatType:h="loop",ease:a="easeOut",times:v}={},T=void 0){const C={[e]:r};v&&(C.offset=v);const k=eP(a,s);Array.isArray(k)&&(C.easing=k);const L={delay:i,duration:s,easing:Array.isArray(k)?"linear":k,fill:"both",iterations:l+1,direction:h==="reverse"?"alternate":"normal"};return T&&(L.pseudoElement=T),t.animate(C,L)}function tP(t){return typeof t=="function"&&"applyToOptions"in t}function iD({type:t,...e}){return tP(t)&&QM()?t.applyToOptions(e):(e.duration??(e.duration=300),e.ease??(e.ease="easeOut"),e)}class nD extends Iw{constructor(e){if(super(),this.finishedTime=null,this.isStopped=!1,!e)return;const{element:r,name:i,keyframes:s,pseudoElement:l,allowFlatten:h=!1,finalKeyframe:a,onComplete:v}=e;this.isPseudoElement=!!l,this.allowFlatten=h,this.options=e,vw(typeof e.type!="string");const T=iD(e);this.animation=rD(r,i,s,T,l),T.autoplay===!1&&this.animation.pause(),this.animation.onfinish=()=>{if(this.finishedTime=this.time,!l){const C=Rw(s,this.options,a,this.speed);this.updateMotionValue?this.updateMotionValue(C):JL(r,i,C),this.animation.cancel()}v?.(),this.notifyFinished()}}play(){this.isStopped||(this.animation.play(),this.state==="finished"&&this.updateFinished())}pause(){this.animation.pause()}complete(){this.animation.finish?.()}cancel(){try{this.animation.cancel()}catch{}}stop(){if(this.isStopped)return;this.isStopped=!0;const{state:e}=this;e==="idle"||e==="finished"||(this.updateMotionValue?this.updateMotionValue():this.commitStyles(),this.isPseudoElement||this.cancel())}commitStyles(){this.isPseudoElement||this.animation.commitStyles?.()}get duration(){const e=this.animation.effect?.getComputedTiming?.().duration||0;return bl(Number(e))}get iterationDuration(){const{delay:e=0}=this.options||{};return this.duration+bl(e)}get time(){return bl(Number(this.animation.currentTime)||0)}set time(e){this.finishedTime=null,this.animation.currentTime=au(e)}get speed(){return this.animation.playbackRate}set speed(e){e<0&&(this.finishedTime=null),this.animation.playbackRate=e}get state(){return this.finishedTime!==null?"finished":this.animation.playState}get startTime(){return Number(this.animation.startTime)}set startTime(e){this.animation.startTime=e}attachTimeline({timeline:e,observe:r}){return this.allowFlatten&&this.animation.effect?.updateTiming({easing:"linear"}),this.animation.onfinish=null,e&&QL()?(this.animation.timeline=e,Al):r(this)}}const rP={anticipate:LM,backInOut:BM,circInOut:NM};function sD(t){return t in rP}function oD(t){typeof t.ease=="string"&&sD(t.ease)&&(t.ease=rP[t.ease])}const SA=10;class aD extends nD{constructor(e){oD(e),KM(e),super(e),e.startTime&&(this.startTime=e.startTime),this.options=e}updateMotionValue(e){const{motionValue:r,onUpdate:i,onComplete:s,element:l,...h}=this.options;if(!r)return;if(e!==void 0){r.set(e);return}const a=new kw({...h,autoplay:!1}),v=au(this.finishedTime??this.time);r.setWithVelocity(a.sample(v-SA).value,a.sample(v).value,SA),a.stop()}}const CA=(t,e)=>e==="zIndex"?!1:!!(typeof t=="number"||Array.isArray(t)||typeof t=="string"&&(cd.test(t)||t==="0")&&!t.startsWith("url("));function lD(t){const e=t[0];if(t.length===1)return!0;for(let r=0;r<t.length;r++)if(t[r]!==e)return!0}function cD(t,e,r,i){const s=t[0];if(s===null)return!1;if(e==="display"||e==="visibility")return!0;const l=t[t.length-1],h=CA(s,e),a=CA(l,e);return!h||!a?!1:lD(t)||(r==="spring"||tP(r))&&i}function rx(t){t.duration=0,t.type="keyframes"}const uD=new Set(["opacity","clipPath","filter","transform"]),hD=bw(()=>Object.hasOwnProperty.call(Element.prototype,"animate"));function dD(t){const{motionValue:e,name:r,repeatDelay:i,repeatType:s,damping:l,type:h}=t;if(!(e?.owner?.current instanceof HTMLElement))return!1;const{onUpdate:v,transformTemplate:T}=e.owner.getProps();return hD()&&r&&uD.has(r)&&(r!=="transform"||!T)&&!v&&!i&&s!=="mirror"&&l!==0&&h!=="inertia"}const pD=40;class fD extends Iw{constructor({autoplay:e=!0,delay:r=0,type:i="keyframes",repeat:s=0,repeatDelay:l=0,repeatType:h="loop",keyframes:a,name:v,motionValue:T,element:C,...k}){super(),this.stop=()=>{this._animation&&(this._animation.stop(),this.stopTimeline?.()),this.keyframeResolver?.cancel()},this.createdAt=ca.now();const L={autoplay:e,delay:r,type:i,repeat:s,repeatDelay:l,repeatType:h,name:v,motionValue:T,element:C,...k},O=C?.KeyframeResolver||Bw;this.keyframeResolver=new O(a,(K,$,ne)=>this.onKeyframesResolved(K,$,L,!ne),v,T,C),this.keyframeResolver?.scheduleResolve()}onKeyframesResolved(e,r,i,s){this.keyframeResolver=void 0;const{name:l,type:h,velocity:a,delay:v,isHandoff:T,onUpdate:C}=i;this.resolvedAt=ca.now(),cD(e,l,h,a)||((nh.instantAnimations||!v)&&C?.(Rw(e,i,r)),e[0]=e[e.length-1],rx(i),i.repeat=0);const L={startTime:s?this.resolvedAt?this.resolvedAt-this.createdAt>pD?this.resolvedAt:this.createdAt:this.createdAt:void 0,finalKeyframe:r,...i,keyframes:e},O=!T&&dD(L)?new aD({...L,element:L.motionValue.owner.current}):new kw(L);O.finished.then(()=>this.notifyFinished()).catch(Al),this.pendingTimeline&&(this.stopTimeline=O.attachTimeline(this.pendingTimeline),this.pendingTimeline=void 0),this._animation=O}get finished(){return this._animation?this.animation.finished:this._finished}then(e,r){return this.finished.finally(e).then(()=>{})}get animation(){return this._animation||(this.keyframeResolver?.resume(),KL()),this._animation}get duration(){return this.animation.duration}get iterationDuration(){return this.animation.iterationDuration}get time(){return this.animation.time}set time(e){this.animation.time=e}get speed(){return this.animation.speed}get state(){return this.animation.state}set speed(e){this.animation.speed=e}get startTime(){return this.animation.startTime}attachTimeline(e){return this._animation?this.stopTimeline=this.animation.attachTimeline(e):this.pendingTimeline=e,()=>this.stop()}play(){this.animation.play()}pause(){this.animation.pause()}complete(){this.animation.complete()}cancel(){this._animation&&this.animation.cancel(),this.keyframeResolver?.cancel()}}const mD=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function gD(t){const e=mD.exec(t);if(!e)return[,];const[,r,i,s]=e;return[`--${r??i}`,s]}function iP(t,e,r=1){const[i,s]=gD(t);if(!i)return;const l=window.getComputedStyle(e).getPropertyValue(i);if(l){const h=l.trim();return TM(h)?parseFloat(h):h}return Tw(s)?iP(s,e,r+1):s}function Lw(t,e){return t?.[e]??t?.default??t}const nP=new Set(["width","height","top","left","right","bottom",...Pm]),_D={test:t=>t==="auto",parse:t=>t},sP=t=>e=>e.test(t),oP=[Mm,Mr,lu,Qh,aL,oL,_D],MA=t=>oP.find(sP(t));function yD(t){return typeof t=="number"?t===0:t!==null?t==="none"||t==="0"||CM(t):!0}const vD=new Set(["brightness","contrast","saturate","opacity"]);function bD(t){const[e,r]=t.slice(0,-1).split("(");if(e==="drop-shadow")return t;const[i]=r.match(Sw)||[];if(!i)return t;const s=r.replace(i,"");let l=vD.has(e)?1:0;return i!==r&&(l*=100),e+"("+l+s+")"}const xD=/\b([a-z-]*)\(.*?\)/gu,ix={...cd,getAnimatableNone:t=>{const e=t.match(xD);return e?e.map(bD).join(" "):t}},PA={...Mm,transform:Math.round},wD={rotate:Qh,rotateX:Qh,rotateY:Qh,rotateZ:Qh,scale:My,scaleX:My,scaleY:My,scaleZ:My,skew:Qh,skewX:Qh,skewY:Qh,distance:Mr,translateX:Mr,translateY:Mr,translateZ:Mr,x:Mr,y:Mr,z:Mr,perspective:Mr,transformPerspective:Mr,opacity:h_,originX:gA,originY:gA,originZ:Mr},Dw={borderWidth:Mr,borderTopWidth:Mr,borderRightWidth:Mr,borderBottomWidth:Mr,borderLeftWidth:Mr,borderRadius:Mr,radius:Mr,borderTopLeftRadius:Mr,borderTopRightRadius:Mr,borderBottomRightRadius:Mr,borderBottomLeftRadius:Mr,width:Mr,maxWidth:Mr,height:Mr,maxHeight:Mr,top:Mr,right:Mr,bottom:Mr,left:Mr,padding:Mr,paddingTop:Mr,paddingRight:Mr,paddingBottom:Mr,paddingLeft:Mr,margin:Mr,marginTop:Mr,marginRight:Mr,marginBottom:Mr,marginLeft:Mr,backgroundPositionX:Mr,backgroundPositionY:Mr,...wD,zIndex:PA,fillOpacity:h_,strokeOpacity:h_,numOctaves:PA},ED={...Dw,color:Xn,backgroundColor:Xn,outlineColor:Xn,fill:Xn,stroke:Xn,borderColor:Xn,borderTopColor:Xn,borderRightColor:Xn,borderBottomColor:Xn,borderLeftColor:Xn,filter:ix,WebkitFilter:ix},aP=t=>ED[t];function lP(t,e){let r=aP(t);return r!==ix&&(r=cd),r.getAnimatableNone?r.getAnimatableNone(e):void 0}const AD=new Set(["auto","none","0"]);function TD(t,e,r){let i=0,s;for(;i<t.length&&!s;){const l=t[i];typeof l=="string"&&!AD.has(l)&&d_(l).values.length&&(s=t[i]),i++}if(s&&r)for(const l of e)t[l]=lP(r,s)}class SD extends Bw{constructor(e,r,i,s,l){super(e,r,i,s,l,!0)}readKeyframes(){const{unresolvedKeyframes:e,element:r,name:i}=this;if(!r||!r.current)return;super.readKeyframes();for(let v=0;v<e.length;v++){let T=e[v];if(typeof T=="string"&&(T=T.trim(),Tw(T))){const C=iP(T,r.current);C!==void 0&&(e[v]=C),v===e.length-1&&(this.finalKeyframe=T)}}if(this.resolveNoneKeyframes(),!nP.has(i)||e.length!==2)return;const[s,l]=e,h=MA(s),a=MA(l);if(h!==a)if(AA(h)&&AA(a))for(let v=0;v<e.length;v++){const T=e[v];typeof T=="string"&&(e[v]=parseFloat(T))}else zp[i]&&(this.needsMeasurement=!0)}resolveNoneKeyframes(){const{unresolvedKeyframes:e,name:r}=this,i=[];for(let s=0;s<e.length;s++)(e[s]===null||yD(e[s]))&&i.push(s);i.length&&TD(e,i,r)}measureInitialState(){const{element:e,unresolvedKeyframes:r,name:i}=this;if(!e||!e.current)return;i==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=zp[i](e.measureViewportBox(),window.getComputedStyle(e.current)),r[0]=this.measuredOrigin;const s=r[r.length-1];s!==void 0&&e.getValue(i,s).jump(s,!1)}measureEndState(){const{element:e,name:r,unresolvedKeyframes:i}=this;if(!e||!e.current)return;const s=e.getValue(r);s&&s.jump(this.measuredOrigin,!1);const l=i.length-1,h=i[l];i[l]=zp[r](e.measureViewportBox(),window.getComputedStyle(e.current)),h!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=h),this.removedTransforms?.length&&this.removedTransforms.forEach(([a,v])=>{e.getValue(a).set(v)}),this.resolveNoneKeyframes()}}function CD(t,e,r){if(t instanceof EventTarget)return[t];if(typeof t=="string"){let i=document;const s=r?.[t]??i.querySelectorAll(t);return s?Array.from(s):[]}return Array.from(t)}const cP=(t,e)=>e&&typeof t=="number"?e.transform(t):t;function uP(t){return SM(t)&&"offsetHeight"in t}const RA=30,MD=t=>!isNaN(parseFloat(t));class PD{constructor(e,r={}){this.canTrackVelocity=null,this.events={},this.updateAndNotify=i=>{const s=ca.now();if(this.updatedAt!==s&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(i),this.current!==this.prev&&(this.events.change?.notify(this.current),this.dependents))for(const l of this.dependents)l.dirty()},this.hasAnimated=!1,this.setCurrent(e),this.owner=r.owner}setCurrent(e){this.current=e,this.updatedAt=ca.now(),this.canTrackVelocity===null&&e!==void 0&&(this.canTrackVelocity=MD(this.current))}setPrevFrameValue(e=this.current){this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt}onChange(e){return this.on("change",e)}on(e,r){this.events[e]||(this.events[e]=new xw);const i=this.events[e].add(r);return e==="change"?()=>{i(),on.read(()=>{this.events.change.getSize()||this.stop()})}:i}clearListeners(){for(const e in this.events)this.events[e].clear()}attach(e,r){this.passiveEffect=e,this.stopPassiveEffect=r}set(e){this.passiveEffect?this.passiveEffect(e,this.updateAndNotify):this.updateAndNotify(e)}setWithVelocity(e,r,i){this.set(r),this.prev=void 0,this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt-i}jump(e,r=!0){this.updateAndNotify(e),this.prev=e,this.prevUpdatedAt=this.prevFrameValue=void 0,r&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}dirty(){this.events.change?.notify(this.current)}addDependent(e){this.dependents||(this.dependents=new Set),this.dependents.add(e)}removeDependent(e){this.dependents&&this.dependents.delete(e)}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const e=ca.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||e-this.updatedAt>RA)return 0;const r=Math.min(this.updatedAt-this.prevUpdatedAt,RA);return MM(parseFloat(this.current)-parseFloat(this.prevFrameValue),r)}start(e){return this.stop(),new Promise(r=>{this.hasAnimated=!0,this.animation=e(r),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.dependents?.clear(),this.events.destroy?.notify(),this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function mm(t,e){return new PD(t,e)}const{schedule:Nw}=zM(queueMicrotask,!1),ec={x:!1,y:!1};function hP(){return ec.x||ec.y}function RD(t){return t==="x"||t==="y"?ec[t]?null:(ec[t]=!0,()=>{ec[t]=!1}):ec.x||ec.y?null:(ec.x=ec.y=!0,()=>{ec.x=ec.y=!1})}function dP(t,e){const r=CD(t),i=new AbortController,s={passive:!0,...e,signal:i.signal};return[r,s,()=>i.abort()]}function IA(t){return!(t.pointerType==="touch"||hP())}function ID(t,e,r={}){const[i,s,l]=dP(t,r),h=a=>{if(!IA(a))return;const{target:v}=a,T=e(v,a);if(typeof T!="function"||!v)return;const C=k=>{IA(k)&&(T(k),v.removeEventListener("pointerleave",C))};v.addEventListener("pointerleave",C,s)};return i.forEach(a=>{a.addEventListener("pointerenter",h,s)}),l}const pP=(t,e)=>e?t===e?!0:pP(t,e.parentElement):!1,Ow=t=>t.pointerType==="mouse"?typeof t.button!="number"||t.button<=0:t.isPrimary!==!1,kD=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function BD(t){return kD.has(t.tagName)||t.tabIndex!==-1}const g0=new WeakSet;function kA(t){return e=>{e.key==="Enter"&&t(e)}}function vv(t,e){t.dispatchEvent(new PointerEvent("pointer"+e,{isPrimary:!0,bubbles:!0}))}const LD=(t,e)=>{const r=t.currentTarget;if(!r)return;const i=kA(()=>{if(g0.has(r))return;vv(r,"down");const s=kA(()=>{vv(r,"up")}),l=()=>vv(r,"cancel");r.addEventListener("keyup",s,e),r.addEventListener("blur",l,e)});r.addEventListener("keydown",i,e),r.addEventListener("blur",()=>r.removeEventListener("keydown",i),e)};function BA(t){return Ow(t)&&!hP()}function DD(t,e,r={}){const[i,s,l]=dP(t,r),h=a=>{const v=a.currentTarget;if(!BA(a))return;g0.add(v);const T=e(v,a),C=(O,K)=>{window.removeEventListener("pointerup",k),window.removeEventListener("pointercancel",L),g0.has(v)&&g0.delete(v),BA(O)&&typeof T=="function"&&T(O,{success:K})},k=O=>{C(O,v===window||v===document||r.useGlobalTarget||pP(v,O.target))},L=O=>{C(O,!1)};window.addEventListener("pointerup",k,s),window.addEventListener("pointercancel",L,s)};return i.forEach(a=>{(r.useGlobalTarget?window:a).addEventListener("pointerdown",h,s),uP(a)&&(a.addEventListener("focus",T=>LD(T,s)),!BD(a)&&!a.hasAttribute("tabindex")&&(a.tabIndex=0))}),l}function fP(t){return SM(t)&&"ownerSVGElement"in t}function ND(t){return fP(t)&&t.tagName==="svg"}const mo=t=>!!(t&&t.getVelocity),OD=[...oP,Xn,cd],FD=t=>OD.find(sP(t)),Fw=te.createContext({transformPagePoint:t=>t,isStatic:!1,reducedMotion:"never"});function LA(t,e){if(typeof t=="function")return t(e);t!=null&&(t.current=e)}function zD(...t){return e=>{let r=!1;const i=t.map(s=>{const l=LA(s,e);return!r&&typeof l=="function"&&(r=!0),l});if(r)return()=>{for(let s=0;s<i.length;s++){const l=i[s];typeof l=="function"?l():LA(t[s],null)}}}}function UD(...t){return te.useCallback(zD(...t),t)}class jD extends te.Component{getSnapshotBeforeUpdate(e){const r=this.props.childRef.current;if(r&&e.isPresent&&!this.props.isPresent){const i=r.offsetParent,s=uP(i)&&i.offsetWidth||0,l=this.props.sizeRef.current;l.height=r.offsetHeight||0,l.width=r.offsetWidth||0,l.top=r.offsetTop,l.left=r.offsetLeft,l.right=s-l.width-l.left}return null}componentDidUpdate(){}render(){return this.props.children}}function VD({children:t,isPresent:e,anchorX:r,root:i}){const s=te.useId(),l=te.useRef(null),h=te.useRef({width:0,height:0,top:0,left:0,right:0}),{nonce:a}=te.useContext(Fw),v=UD(l,t?.ref);return te.useInsertionEffect(()=>{const{width:T,height:C,top:k,left:L,right:O}=h.current;if(e||!l.current||!T||!C)return;const K=r==="left"?`left: ${L}`:`right: ${O}`;l.current.dataset.motionPopId=s;const $=document.createElement("style");a&&($.nonce=a);const ne=i??document.head;return ne.appendChild($),$.sheet&&$.sheet.insertRule(`
          [data-motion-pop-id="${s}"] {
            position: absolute !important;
            width: ${T}px !important;
            height: ${C}px !important;
            ${K}px !important;
            top: ${k}px !important;
          }
        `),()=>{ne.contains($)&&ne.removeChild($)}},[e]),H.jsx(jD,{isPresent:e,childRef:l,sizeRef:h,children:te.cloneElement(t,{ref:v})})}const GD=({children:t,initial:e,isPresent:r,onExitComplete:i,custom:s,presenceAffectsLayout:l,mode:h,anchorX:a,root:v})=>{const T=mw(HD),C=te.useId();let k=!0,L=te.useMemo(()=>(k=!1,{id:C,initial:e,isPresent:r,custom:s,onExitComplete:O=>{T.set(O,!0);for(const K of T.values())if(!K)return;i&&i()},register:O=>(T.set(O,!1),()=>T.delete(O))}),[r,T,i]);return l&&k&&(L={...L}),te.useMemo(()=>{T.forEach((O,K)=>T.set(K,!1))},[r]),te.useEffect(()=>{!r&&!T.size&&i&&i()},[r]),h==="popLayout"&&(t=H.jsx(VD,{isPresent:r,anchorX:a,root:v,children:t})),H.jsx(l1.Provider,{value:L,children:t})};function HD(){return new Map}function mP(t=!0){const e=te.useContext(l1);if(e===null)return[!0,null];const{isPresent:r,onExitComplete:i,register:s}=e,l=te.useId();te.useEffect(()=>{if(t)return s(l)},[t]);const h=te.useCallback(()=>t&&i&&i(l),[l,i,t]);return!r&&i?[!1,h]:[!0]}const Py=t=>t.key||"";function DA(t){const e=[];return te.Children.forEach(t,r=>{te.isValidElement(r)&&e.push(r)}),e}const WD=({children:t,custom:e,initial:r=!0,onExitComplete:i,presenceAffectsLayout:s=!0,mode:l="sync",propagate:h=!1,anchorX:a="left",root:v})=>{const[T,C]=mP(h),k=te.useMemo(()=>DA(t),[t]),L=h&&!T?[]:k.map(Py),O=te.useRef(!0),K=te.useRef(k),$=mw(()=>new Map),[ne,oe]=te.useState(k),[fe,ue]=te.useState(k);AM(()=>{O.current=!1,K.current=k;for(let Fe=0;Fe<fe.length;Fe++){const Ke=Py(fe[Fe]);L.includes(Ke)?$.delete(Ke):$.get(Ke)!==!0&&$.set(Ke,!1)}},[fe,L.length,L.join("-")]);const we=[];if(k!==ne){let Fe=[...k];for(let Ke=0;Ke<fe.length;Ke++){const ze=fe[Ke],it=Py(ze);L.includes(it)||(Fe.splice(Ke,0,ze),we.push(ze))}return l==="wait"&&we.length&&(Fe=we),ue(DA(Fe)),oe(k),null}const{forceRender:De}=te.useContext(fw);return H.jsx(H.Fragment,{children:fe.map(Fe=>{const Ke=Py(Fe),ze=h&&!T?!1:k===fe||L.includes(Ke),it=()=>{if($.has(Ke))$.set(Ke,!0);else return;let lt=!0;$.forEach(ht=>{ht||(lt=!1)}),lt&&(De?.(),ue(K.current),h&&C?.(),i&&i())};return H.jsx(GD,{isPresent:ze,initial:!O.current||r?void 0:!1,custom:e,presenceAffectsLayout:s,mode:l,root:v,onExitComplete:ze?void 0:it,anchorX:a,children:Fe},Ke)})})},gP=te.createContext({strict:!1}),NA={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},gm={};for(const t in NA)gm[t]={isEnabled:e=>NA[t].some(r=>!!e[r])};function qD(t){for(const e in t)gm[e]={...gm[e],...t[e]}}const $D=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function B0(t){return t.startsWith("while")||t.startsWith("drag")&&t!=="draggable"||t.startsWith("layout")||t.startsWith("onTap")||t.startsWith("onPan")||t.startsWith("onLayout")||$D.has(t)}let _P=t=>!B0(t);function ZD(t){typeof t=="function"&&(_P=e=>e.startsWith("on")?!B0(e):t(e))}try{ZD(require("@emotion/is-prop-valid").default)}catch{}function XD(t,e,r){const i={};for(const s in t)s==="values"&&typeof t.values=="object"||(_P(s)||r===!0&&B0(s)||!e&&!B0(s)||t.draggable&&s.startsWith("onDrag"))&&(i[s]=t[s]);return i}const c1=te.createContext({});function u1(t){return t!==null&&typeof t=="object"&&typeof t.start=="function"}function p_(t){return typeof t=="string"||Array.isArray(t)}const zw=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],Uw=["initial",...zw];function h1(t){return u1(t.animate)||Uw.some(e=>p_(t[e]))}function yP(t){return!!(h1(t)||t.variants)}function KD(t,e){if(h1(t)){const{initial:r,animate:i}=t;return{initial:r===!1||p_(r)?r:void 0,animate:p_(i)?i:void 0}}return t.inherit!==!1?e:{}}function YD(t){const{initial:e,animate:r}=KD(t,te.useContext(c1));return te.useMemo(()=>({initial:e,animate:r}),[OA(e),OA(r)])}function OA(t){return Array.isArray(t)?t.join(" "):t}const f_={};function JD(t){for(const e in t)f_[e]=t[e],Aw(e)&&(f_[e].isCSSVariable=!0)}function vP(t,{layout:e,layoutId:r}){return Rm.has(t)||t.startsWith("origin")||(e||r!==void 0)&&(!!f_[t]||t==="opacity")}const QD={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},eN=Pm.length;function tN(t,e,r){let i="",s=!0;for(let l=0;l<eN;l++){const h=Pm[l],a=t[h];if(a===void 0)continue;let v=!0;if(typeof a=="number"?v=a===(h.startsWith("scale")?1:0):v=parseFloat(a)===0,!v||r){const T=cP(a,Dw[h]);if(!v){s=!1;const C=QD[h]||h;i+=`${C}(${T}) `}r&&(e[h]=T)}}return i=i.trim(),r?i=r(e,s?"":i):s&&(i="none"),i}function jw(t,e,r){const{style:i,vars:s,transformOrigin:l}=t;let h=!1,a=!1;for(const v in e){const T=e[v];if(Rm.has(v)){h=!0;continue}else if(Aw(v)){s[v]=T;continue}else{const C=cP(T,Dw[v]);v.startsWith("origin")?(a=!0,l[v]=C):i[v]=C}}if(e.transform||(h||r?i.transform=tN(e,t.transform,r):i.transform&&(i.transform="none")),a){const{originX:v="50%",originY:T="50%",originZ:C=0}=l;i.transformOrigin=`${v} ${T} ${C}`}}const Vw=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function bP(t,e,r){for(const i in e)!mo(e[i])&&!vP(i,r)&&(t[i]=e[i])}function rN({transformTemplate:t},e){return te.useMemo(()=>{const r=Vw();return jw(r,e,t),Object.assign({},r.vars,r.style)},[e])}function iN(t,e){const r=t.style||{},i={};return bP(i,r,t),Object.assign(i,rN(t,e)),i}function nN(t,e){const r={},i=iN(t,e);return t.drag&&t.dragListener!==!1&&(r.draggable=!1,i.userSelect=i.WebkitUserSelect=i.WebkitTouchCallout="none",i.touchAction=t.drag===!0?"none":`pan-${t.drag==="x"?"y":"x"}`),t.tabIndex===void 0&&(t.onTap||t.onTapStart||t.whileTap)&&(r.tabIndex=0),r.style=i,r}const sN={offset:"stroke-dashoffset",array:"stroke-dasharray"},oN={offset:"strokeDashoffset",array:"strokeDasharray"};function aN(t,e,r=1,i=0,s=!0){t.pathLength=1;const l=s?sN:oN;t[l.offset]=Mr.transform(-i);const h=Mr.transform(e),a=Mr.transform(r);t[l.array]=`${h} ${a}`}function xP(t,{attrX:e,attrY:r,attrScale:i,pathLength:s,pathSpacing:l=1,pathOffset:h=0,...a},v,T,C){if(jw(t,a,T),v){t.style.viewBox&&(t.attrs.viewBox=t.style.viewBox);return}t.attrs=t.style,t.style={};const{attrs:k,style:L}=t;k.transform&&(L.transform=k.transform,delete k.transform),(L.transform||k.transformOrigin)&&(L.transformOrigin=k.transformOrigin??"50% 50%",delete k.transformOrigin),L.transform&&(L.transformBox=C?.transformBox??"fill-box",delete k.transformBox),e!==void 0&&(k.x=e),r!==void 0&&(k.y=r),i!==void 0&&(k.scale=i),s!==void 0&&aN(k,s,l,h,!1)}const wP=()=>({...Vw(),attrs:{}}),EP=t=>typeof t=="string"&&t.toLowerCase()==="svg";function lN(t,e,r,i){const s=te.useMemo(()=>{const l=wP();return xP(l,e,EP(i),t.transformTemplate,t.style),{...l.attrs,style:{...l.style}}},[e]);if(t.style){const l={};bP(l,t.style,t),s.style={...l,...s.style}}return s}const cN=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function Gw(t){return typeof t!="string"||t.includes("-")?!1:!!(cN.indexOf(t)>-1||/[A-Z]/u.test(t))}function uN(t,e,r,{latestValues:i},s,l=!1){const a=(Gw(t)?lN:nN)(e,i,s,t),v=XD(e,typeof t=="string",l),T=t!==te.Fragment?{...v,...a,ref:r}:{},{children:C}=e,k=te.useMemo(()=>mo(C)?C.get():C,[C]);return te.createElement(t,{...T,children:k})}function FA(t){const e=[{},{}];return t?.values.forEach((r,i)=>{e[0][i]=r.get(),e[1][i]=r.getVelocity()}),e}function Hw(t,e,r,i){if(typeof e=="function"){const[s,l]=FA(i);e=e(r!==void 0?r:t.custom,s,l)}if(typeof e=="string"&&(e=t.variants&&t.variants[e]),typeof e=="function"){const[s,l]=FA(i);e=e(r!==void 0?r:t.custom,s,l)}return e}function _0(t){return mo(t)?t.get():t}function hN({scrapeMotionValuesFromProps:t,createRenderState:e},r,i,s){return{latestValues:dN(r,i,s,t),renderState:e()}}function dN(t,e,r,i){const s={},l=i(t,{});for(const L in l)s[L]=_0(l[L]);let{initial:h,animate:a}=t;const v=h1(t),T=yP(t);e&&T&&!v&&t.inherit!==!1&&(h===void 0&&(h=e.initial),a===void 0&&(a=e.animate));let C=r?r.initial===!1:!1;C=C||h===!1;const k=C?a:h;if(k&&typeof k!="boolean"&&!u1(k)){const L=Array.isArray(k)?k:[k];for(let O=0;O<L.length;O++){const K=Hw(t,L[O]);if(K){const{transitionEnd:$,transition:ne,...oe}=K;for(const fe in oe){let ue=oe[fe];if(Array.isArray(ue)){const we=C?ue.length-1:0;ue=ue[we]}ue!==null&&(s[fe]=ue)}for(const fe in $)s[fe]=$[fe]}}}return s}const AP=t=>(e,r)=>{const i=te.useContext(c1),s=te.useContext(l1),l=()=>hN(t,e,i,s);return r?l():mw(l)};function Ww(t,e,r){const{style:i}=t,s={};for(const l in i)(mo(i[l])||e.style&&mo(e.style[l])||vP(l,t)||r?.getValue(l)?.liveStyle!==void 0)&&(s[l]=i[l]);return s}const pN=AP({scrapeMotionValuesFromProps:Ww,createRenderState:Vw});function TP(t,e,r){const i=Ww(t,e,r);for(const s in t)if(mo(t[s])||mo(e[s])){const l=Pm.indexOf(s)!==-1?"attr"+s.charAt(0).toUpperCase()+s.substring(1):s;i[l]=t[s]}return i}const fN=AP({scrapeMotionValuesFromProps:TP,createRenderState:wP}),mN=Symbol.for("motionComponentSymbol");function $f(t){return t&&typeof t=="object"&&Object.prototype.hasOwnProperty.call(t,"current")}function gN(t,e,r){return te.useCallback(i=>{i&&t.onMount&&t.onMount(i),e&&(i?e.mount(i):e.unmount()),r&&(typeof r=="function"?r(i):$f(r)&&(r.current=i))},[e])}const qw=t=>t.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),_N="framerAppearId",SP="data-"+qw(_N),CP=te.createContext({});function yN(t,e,r,i,s){const{visualElement:l}=te.useContext(c1),h=te.useContext(gP),a=te.useContext(l1),v=te.useContext(Fw).reducedMotion,T=te.useRef(null);i=i||h.renderer,!T.current&&i&&(T.current=i(t,{visualState:e,parent:l,props:r,presenceContext:a,blockInitialAnimation:a?a.initial===!1:!1,reducedMotionConfig:v}));const C=T.current,k=te.useContext(CP);C&&!C.projection&&s&&(C.type==="html"||C.type==="svg")&&vN(T.current,r,s,k);const L=te.useRef(!1);te.useInsertionEffect(()=>{C&&L.current&&C.update(r,a)});const O=r[SP],K=te.useRef(!!O&&!window.MotionHandoffIsComplete?.(O)&&window.MotionHasOptimisedAnimation?.(O));return AM(()=>{C&&(L.current=!0,window.MotionIsMounted=!0,C.updateFeatures(),C.scheduleRenderMicrotask(),K.current&&C.animationState&&C.animationState.animateChanges())}),te.useEffect(()=>{C&&(!K.current&&C.animationState&&C.animationState.animateChanges(),K.current&&(queueMicrotask(()=>{window.MotionHandoffMarkAsComplete?.(O)}),K.current=!1),C.enteringChildren=void 0)}),C}function vN(t,e,r,i){const{layoutId:s,layout:l,drag:h,dragConstraints:a,layoutScroll:v,layoutRoot:T,layoutCrossfade:C}=e;t.projection=new r(t.latestValues,e["data-framer-portal-id"]?void 0:MP(t.parent)),t.projection.setOptions({layoutId:s,layout:l,alwaysMeasureLayout:!!h||a&&$f(a),visualElement:t,animationType:typeof l=="string"?l:"both",initialPromotionConfig:i,crossfade:C,layoutScroll:v,layoutRoot:T})}function MP(t){if(t)return t.options.allowProjection!==!1?t.projection:MP(t.parent)}function bv(t,{forwardMotionProps:e=!1}={},r,i){r&&qD(r);const s=Gw(t)?fN:pN;function l(a,v){let T;const C={...te.useContext(Fw),...a,layoutId:bN(a)},{isStatic:k}=C,L=YD(a),O=s(a,k);if(!k&&gw){xN();const K=wN(C);T=K.MeasureLayout,L.visualElement=yN(t,O,C,i,K.ProjectionNode)}return H.jsxs(c1.Provider,{value:L,children:[T&&L.visualElement?H.jsx(T,{visualElement:L.visualElement,...C}):null,uN(t,a,gN(O,L.visualElement,v),O,k,e)]})}l.displayName=`motion.${typeof t=="string"?t:`create(${t.displayName??t.name??""})`}`;const h=te.forwardRef(l);return h[mN]=t,h}function bN({layoutId:t}){const e=te.useContext(fw).id;return e&&t!==void 0?e+"-"+t:t}function xN(t,e){te.useContext(gP).strict}function wN(t){const{drag:e,layout:r}=gm;if(!e&&!r)return{};const i={...e,...r};return{MeasureLayout:e?.isEnabled(t)||r?.isEnabled(t)?i.MeasureLayout:void 0,ProjectionNode:i.ProjectionNode}}function EN(t,e){if(typeof Proxy>"u")return bv;const r=new Map,i=(l,h)=>bv(l,h,t,e),s=(l,h)=>i(l,h);return new Proxy(s,{get:(l,h)=>h==="create"?i:(r.has(h)||r.set(h,bv(h,void 0,t,e)),r.get(h))})}function PP({top:t,left:e,right:r,bottom:i}){return{x:{min:e,max:r},y:{min:t,max:i}}}function AN({x:t,y:e}){return{top:e.min,right:t.max,bottom:e.max,left:t.min}}function TN(t,e){if(!e)return t;const r=e({x:t.left,y:t.top}),i=e({x:t.right,y:t.bottom});return{top:r.y,left:r.x,bottom:i.y,right:i.x}}function xv(t){return t===void 0||t===1}function nx({scale:t,scaleX:e,scaleY:r}){return!xv(t)||!xv(e)||!xv(r)}function Pp(t){return nx(t)||RP(t)||t.z||t.rotate||t.rotateX||t.rotateY||t.skewX||t.skewY}function RP(t){return zA(t.x)||zA(t.y)}function zA(t){return t&&t!=="0%"}function L0(t,e,r){const i=t-r,s=e*i;return r+s}function UA(t,e,r,i,s){return s!==void 0&&(t=L0(t,s,i)),L0(t,r,i)+e}function sx(t,e=0,r=1,i,s){t.min=UA(t.min,e,r,i,s),t.max=UA(t.max,e,r,i,s)}function IP(t,{x:e,y:r}){sx(t.x,e.translate,e.scale,e.originPoint),sx(t.y,r.translate,r.scale,r.originPoint)}const jA=.999999999999,VA=1.0000000000001;function SN(t,e,r,i=!1){const s=r.length;if(!s)return;e.x=e.y=1;let l,h;for(let a=0;a<s;a++){l=r[a],h=l.projectionDelta;const{visualElement:v}=l.options;v&&v.props.style&&v.props.style.display==="contents"||(i&&l.options.layoutScroll&&l.scroll&&l!==l.root&&Xf(t,{x:-l.scroll.offset.x,y:-l.scroll.offset.y}),h&&(e.x*=h.x.scale,e.y*=h.y.scale,IP(t,h)),i&&Pp(l.latestValues)&&Xf(t,l.latestValues))}e.x<VA&&e.x>jA&&(e.x=1),e.y<VA&&e.y>jA&&(e.y=1)}function Zf(t,e){t.min=t.min+e,t.max=t.max+e}function GA(t,e,r,i,s=.5){const l=_n(t.min,t.max,s);sx(t,e,r,l,i)}function Xf(t,e){GA(t.x,e.x,e.scaleX,e.scale,e.originX),GA(t.y,e.y,e.scaleY,e.scale,e.originY)}function kP(t,e){return PP(TN(t.getBoundingClientRect(),e))}function CN(t,e,r){const i=kP(t,r),{scroll:s}=e;return s&&(Zf(i.x,s.offset.x),Zf(i.y,s.offset.y)),i}const HA=()=>({translate:0,scale:1,origin:0,originPoint:0}),Kf=()=>({x:HA(),y:HA()}),WA=()=>({min:0,max:0}),zn=()=>({x:WA(),y:WA()}),ox={current:null},BP={current:!1};function MN(){if(BP.current=!0,!!gw)if(window.matchMedia){const t=window.matchMedia("(prefers-reduced-motion)"),e=()=>ox.current=t.matches;t.addEventListener("change",e),e()}else ox.current=!1}const PN=new WeakMap;function RN(t,e,r){for(const i in e){const s=e[i],l=r[i];if(mo(s))t.addValue(i,s);else if(mo(l))t.addValue(i,mm(s,{owner:t}));else if(l!==s)if(t.hasValue(i)){const h=t.getValue(i);h.liveStyle===!0?h.jump(s):h.hasAnimated||h.set(s)}else{const h=t.getStaticValue(i);t.addValue(i,mm(h!==void 0?h:s,{owner:t}))}}for(const i in r)e[i]===void 0&&t.removeValue(i);return e}const qA=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class IN{scrapeMotionValuesFromProps(e,r,i){return{}}constructor({parent:e,props:r,presenceContext:i,reducedMotionConfig:s,blockInitialAnimation:l,visualState:h},a={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=Bw,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const L=ca.now();this.renderScheduledAt<L&&(this.renderScheduledAt=L,on.render(this.render,!1,!0))};const{latestValues:v,renderState:T}=h;this.latestValues=v,this.baseTarget={...v},this.initialValues=r.initial?{...v}:{},this.renderState=T,this.parent=e,this.props=r,this.presenceContext=i,this.depth=e?e.depth+1:0,this.reducedMotionConfig=s,this.options=a,this.blockInitialAnimation=!!l,this.isControllingVariants=h1(r),this.isVariantNode=yP(r),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(e&&e.current);const{willChange:C,...k}=this.scrapeMotionValuesFromProps(r,{},this);for(const L in k){const O=k[L];v[L]!==void 0&&mo(O)&&O.set(v[L])}}mount(e){this.current=e,PN.set(e,this),this.projection&&!this.projection.instance&&this.projection.mount(e),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((r,i)=>this.bindToMotionValue(i,r)),BP.current||MN(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:ox.current,this.parent?.addChild(this),this.update(this.props,this.presenceContext)}unmount(){this.projection&&this.projection.unmount(),ld(this.notifyUpdate),ld(this.render),this.valueSubscriptions.forEach(e=>e()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent?.removeChild(this);for(const e in this.events)this.events[e].clear();for(const e in this.features){const r=this.features[e];r&&(r.unmount(),r.isMounted=!1)}this.current=null}addChild(e){this.children.add(e),this.enteringChildren??(this.enteringChildren=new Set),this.enteringChildren.add(e)}removeChild(e){this.children.delete(e),this.enteringChildren&&this.enteringChildren.delete(e)}bindToMotionValue(e,r){this.valueSubscriptions.has(e)&&this.valueSubscriptions.get(e)();const i=Rm.has(e);i&&this.onBindTransform&&this.onBindTransform();const s=r.on("change",h=>{this.latestValues[e]=h,this.props.onUpdate&&on.preRender(this.notifyUpdate),i&&this.projection&&(this.projection.isTransformDirty=!0),this.scheduleRender()});let l;window.MotionCheckAppearSync&&(l=window.MotionCheckAppearSync(this,e,r)),this.valueSubscriptions.set(e,()=>{s(),l&&l(),r.owner&&r.stop()})}sortNodePosition(e){return!this.current||!this.sortInstanceNodePosition||this.type!==e.type?0:this.sortInstanceNodePosition(this.current,e.current)}updateFeatures(){let e="animation";for(e in gm){const r=gm[e];if(!r)continue;const{isEnabled:i,Feature:s}=r;if(!this.features[e]&&s&&i(this.props)&&(this.features[e]=new s(this)),this.features[e]){const l=this.features[e];l.isMounted?l.update():(l.mount(),l.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):zn()}getStaticValue(e){return this.latestValues[e]}setStaticValue(e,r){this.latestValues[e]=r}update(e,r){(e.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=e,this.prevPresenceContext=this.presenceContext,this.presenceContext=r;for(let i=0;i<qA.length;i++){const s=qA[i];this.propEventSubscriptions[s]&&(this.propEventSubscriptions[s](),delete this.propEventSubscriptions[s]);const l="on"+s,h=e[l];h&&(this.propEventSubscriptions[s]=this.on(s,h))}this.prevMotionValues=RN(this,this.scrapeMotionValuesFromProps(e,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(e){return this.props.variants?this.props.variants[e]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(e){const r=this.getClosestVariantNode();if(r)return r.variantChildren&&r.variantChildren.add(e),()=>r.variantChildren.delete(e)}addValue(e,r){const i=this.values.get(e);r!==i&&(i&&this.removeValue(e),this.bindToMotionValue(e,r),this.values.set(e,r),this.latestValues[e]=r.get())}removeValue(e){this.values.delete(e);const r=this.valueSubscriptions.get(e);r&&(r(),this.valueSubscriptions.delete(e)),delete this.latestValues[e],this.removeValueFromRenderState(e,this.renderState)}hasValue(e){return this.values.has(e)}getValue(e,r){if(this.props.values&&this.props.values[e])return this.props.values[e];let i=this.values.get(e);return i===void 0&&r!==void 0&&(i=mm(r===null?void 0:r,{owner:this}),this.addValue(e,i)),i}readValue(e,r){let i=this.latestValues[e]!==void 0||!this.current?this.latestValues[e]:this.getBaseTargetFromProps(this.props,e)??this.readValueFromInstance(this.current,e,this.options);return i!=null&&(typeof i=="string"&&(TM(i)||CM(i))?i=parseFloat(i):!FD(i)&&cd.test(r)&&(i=lP(e,r)),this.setBaseTarget(e,mo(i)?i.get():i)),mo(i)?i.get():i}setBaseTarget(e,r){this.baseTarget[e]=r}getBaseTarget(e){const{initial:r}=this.props;let i;if(typeof r=="string"||typeof r=="object"){const l=Hw(this.props,r,this.presenceContext?.custom);l&&(i=l[e])}if(r&&i!==void 0)return i;const s=this.getBaseTargetFromProps(this.props,e);return s!==void 0&&!mo(s)?s:this.initialValues[e]!==void 0&&i===void 0?void 0:this.baseTarget[e]}on(e,r){return this.events[e]||(this.events[e]=new xw),this.events[e].add(r)}notify(e,...r){this.events[e]&&this.events[e].notify(...r)}scheduleRenderMicrotask(){Nw.render(this.render)}}class LP extends IN{constructor(){super(...arguments),this.KeyframeResolver=SD}sortInstanceNodePosition(e,r){return e.compareDocumentPosition(r)&2?1:-1}getBaseTargetFromProps(e,r){return e.style?e.style[r]:void 0}removeValueFromRenderState(e,{vars:r,style:i}){delete r[e],delete i[e]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:e}=this.props;mo(e)&&(this.childSubscription=e.on("change",r=>{this.current&&(this.current.textContent=`${r}`)}))}}function DP(t,{style:e,vars:r},i,s){const l=t.style;let h;for(h in e)l[h]=e[h];s?.applyProjectionStyles(l,i);for(h in r)l.setProperty(h,r[h])}function kN(t){return window.getComputedStyle(t)}class BN extends LP{constructor(){super(...arguments),this.type="html",this.renderInstance=DP}readValueFromInstance(e,r){if(Rm.has(r))return this.projection?.isProjecting?Yb(r):WL(e,r);{const i=kN(e),s=(Aw(r)?i.getPropertyValue(r):i[r])||0;return typeof s=="string"?s.trim():s}}measureInstanceViewportBox(e,{transformPagePoint:r}){return kP(e,r)}build(e,r,i){jw(e,r,i.transformTemplate)}scrapeMotionValuesFromProps(e,r,i){return Ww(e,r,i)}}const NP=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function LN(t,e,r,i){DP(t,e,void 0,i);for(const s in e.attrs)t.setAttribute(NP.has(s)?s:qw(s),e.attrs[s])}class DN extends LP{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=zn}getBaseTargetFromProps(e,r){return e[r]}readValueFromInstance(e,r){if(Rm.has(r)){const i=aP(r);return i&&i.default||0}return r=NP.has(r)?r:qw(r),e.getAttribute(r)}scrapeMotionValuesFromProps(e,r,i){return TP(e,r,i)}build(e,r,i){xP(e,r,this.isSVGTag,i.transformTemplate,i.style)}renderInstance(e,r,i,s){LN(e,r,i,s)}mount(e){this.isSVGTag=EP(e.tagName),super.mount(e)}}const NN=(t,e)=>Gw(t)?new DN(e):new BN(e,{allowProjection:t!==te.Fragment});function sm(t,e,r){const i=t.getProps();return Hw(i,e,r!==void 0?r:i.custom,t)}const ax=t=>Array.isArray(t);function ON(t,e,r){t.hasValue(e)?t.getValue(e).set(r):t.addValue(e,mm(r))}function FN(t){return ax(t)?t[t.length-1]||0:t}function zN(t,e){const r=sm(t,e);let{transitionEnd:i={},transition:s={},...l}=r||{};l={...l,...i};for(const h in l){const a=FN(l[h]);ON(t,h,a)}}function UN(t){return!!(mo(t)&&t.add)}function lx(t,e){const r=t.getValue("willChange");if(UN(r))return r.add(e);if(!r&&nh.WillChange){const i=new nh.WillChange("auto");t.addValue("willChange",i),i.add(e)}}function OP(t){return t.props[SP]}const jN=t=>t!==null;function VN(t,{repeat:e,repeatType:r="loop"},i){const s=t.filter(jN),l=e&&r!=="loop"&&e%2===1?0:s.length-1;return s[l]}const GN={type:"spring",stiffness:500,damping:25,restSpeed:10},HN=t=>({type:"spring",stiffness:550,damping:t===0?2*Math.sqrt(550):30,restSpeed:10}),WN={type:"keyframes",duration:.8},qN={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},$N=(t,{keyframes:e})=>e.length>2?WN:Rm.has(t)?t.startsWith("scale")?HN(e[1]):GN:qN;function ZN({when:t,delay:e,delayChildren:r,staggerChildren:i,staggerDirection:s,repeat:l,repeatType:h,repeatDelay:a,from:v,elapsed:T,...C}){return!!Object.keys(C).length}const $w=(t,e,r,i={},s,l)=>h=>{const a=Lw(i,t)||{},v=a.delay||i.delay||0;let{elapsed:T=0}=i;T=T-au(v);const C={keyframes:Array.isArray(r)?r:[null,r],ease:"easeOut",velocity:e.getVelocity(),...a,delay:-T,onUpdate:L=>{e.set(L),a.onUpdate&&a.onUpdate(L)},onComplete:()=>{h(),a.onComplete&&a.onComplete()},name:t,motionValue:e,element:l?void 0:s};ZN(a)||Object.assign(C,$N(t,C)),C.duration&&(C.duration=au(C.duration)),C.repeatDelay&&(C.repeatDelay=au(C.repeatDelay)),C.from!==void 0&&(C.keyframes[0]=C.from);let k=!1;if((C.type===!1||C.duration===0&&!C.repeatDelay)&&(rx(C),C.delay===0&&(k=!0)),(nh.instantAnimations||nh.skipAnimations)&&(k=!0,rx(C),C.delay=0),C.allowFlatten=!a.type&&!a.ease,k&&!l&&e.get()!==void 0){const L=VN(C.keyframes,a);if(L!==void 0){on.update(()=>{C.onUpdate(L),C.onComplete()});return}}return a.isSync?new kw(C):new fD(C)};function XN({protectedKeys:t,needsAnimating:e},r){const i=t.hasOwnProperty(r)&&e[r]!==!0;return e[r]=!1,i}function FP(t,e,{delay:r=0,transitionOverride:i,type:s}={}){let{transition:l=t.getDefaultTransition(),transitionEnd:h,...a}=e;i&&(l=i);const v=[],T=s&&t.animationState&&t.animationState.getState()[s];for(const C in a){const k=t.getValue(C,t.latestValues[C]??null),L=a[C];if(L===void 0||T&&XN(T,C))continue;const O={delay:r,...Lw(l||{},C)},K=k.get();if(K!==void 0&&!k.isAnimating&&!Array.isArray(L)&&L===K&&!O.velocity)continue;let $=!1;if(window.MotionHandoffAnimation){const oe=OP(t);if(oe){const fe=window.MotionHandoffAnimation(oe,C,on);fe!==null&&(O.startTime=fe,$=!0)}}lx(t,C),k.start($w(C,k,L,t.shouldReduceMotion&&nP.has(C)?{type:!1}:O,t,$));const ne=k.animation;ne&&v.push(ne)}return h&&Promise.all(v).then(()=>{on.update(()=>{h&&zN(t,h)})}),v}function zP(t,e,r,i=0,s=1){const l=Array.from(t).sort((T,C)=>T.sortNodePosition(C)).indexOf(e),h=t.size,a=(h-1)*i;return typeof r=="function"?r(l,h):s===1?l*i:a-l*i}function cx(t,e,r={}){const i=sm(t,e,r.type==="exit"?t.presenceContext?.custom:void 0);let{transition:s=t.getDefaultTransition()||{}}=i||{};r.transitionOverride&&(s=r.transitionOverride);const l=i?()=>Promise.all(FP(t,i,r)):()=>Promise.resolve(),h=t.variantChildren&&t.variantChildren.size?(v=0)=>{const{delayChildren:T=0,staggerChildren:C,staggerDirection:k}=s;return KN(t,e,v,T,C,k,r)}:()=>Promise.resolve(),{when:a}=s;if(a){const[v,T]=a==="beforeChildren"?[l,h]:[h,l];return v().then(()=>T())}else return Promise.all([l(),h(r.delay)])}function KN(t,e,r=0,i=0,s=0,l=1,h){const a=[];for(const v of t.variantChildren)v.notify("AnimationStart",e),a.push(cx(v,e,{...h,delay:r+(typeof i=="function"?0:i)+zP(t.variantChildren,v,i,s,l)}).then(()=>v.notify("AnimationComplete",e)));return Promise.all(a)}function YN(t,e,r={}){t.notify("AnimationStart",e);let i;if(Array.isArray(e)){const s=e.map(l=>cx(t,l,r));i=Promise.all(s)}else if(typeof e=="string")i=cx(t,e,r);else{const s=typeof e=="function"?sm(t,e,r.custom):e;i=Promise.all(FP(t,s,r))}return i.then(()=>{t.notify("AnimationComplete",e)})}function UP(t,e){if(!Array.isArray(e))return!1;const r=e.length;if(r!==t.length)return!1;for(let i=0;i<r;i++)if(e[i]!==t[i])return!1;return!0}const JN=Uw.length;function jP(t){if(!t)return;if(!t.isControllingVariants){const r=t.parent?jP(t.parent)||{}:{};return t.props.initial!==void 0&&(r.initial=t.props.initial),r}const e={};for(let r=0;r<JN;r++){const i=Uw[r],s=t.props[i];(p_(s)||s===!1)&&(e[i]=s)}return e}const QN=[...zw].reverse(),eO=zw.length;function tO(t){return e=>Promise.all(e.map(({animation:r,options:i})=>YN(t,r,i)))}function rO(t){let e=tO(t),r=$A(),i=!0;const s=v=>(T,C)=>{const k=sm(t,C,v==="exit"?t.presenceContext?.custom:void 0);if(k){const{transition:L,transitionEnd:O,...K}=k;T={...T,...K,...O}}return T};function l(v){e=v(t)}function h(v){const{props:T}=t,C=jP(t.parent)||{},k=[],L=new Set;let O={},K=1/0;for(let ne=0;ne<eO;ne++){const oe=QN[ne],fe=r[oe],ue=T[oe]!==void 0?T[oe]:C[oe],we=p_(ue),De=oe===v?fe.isActive:null;De===!1&&(K=ne);let Fe=ue===C[oe]&&ue!==T[oe]&&we;if(Fe&&i&&t.manuallyAnimateOnMount&&(Fe=!1),fe.protectedKeys={...O},!fe.isActive&&De===null||!ue&&!fe.prevProp||u1(ue)||typeof ue=="boolean")continue;const Ke=iO(fe.prevProp,ue);let ze=Ke||oe===v&&fe.isActive&&!Fe&&we||ne>K&&we,it=!1;const lt=Array.isArray(ue)?ue:[ue];let ht=lt.reduce(s(oe),{});De===!1&&(ht={});const{prevResolvedValues:vt={}}=fe,Nt={...vt,...ht},Lt=Ot=>{ze=!0,L.has(Ot)&&(it=!0,L.delete(Ot)),fe.needsAnimating[Ot]=!0;const tt=t.getValue(Ot);tt&&(tt.liveStyle=!1)};for(const Ot in Nt){const tt=ht[Ot],wt=vt[Ot];if(O.hasOwnProperty(Ot))continue;let Bt=!1;ax(tt)&&ax(wt)?Bt=!UP(tt,wt):Bt=tt!==wt,Bt?tt!=null?Lt(Ot):L.add(Ot):tt!==void 0&&L.has(Ot)?Lt(Ot):fe.protectedKeys[Ot]=!0}fe.prevProp=ue,fe.prevResolvedValues=ht,fe.isActive&&(O={...O,...ht}),i&&t.blockInitialAnimation&&(ze=!1);const qt=Fe&&Ke;ze&&(!qt||it)&&k.push(...lt.map(Ot=>{const tt={type:oe};if(typeof Ot=="string"&&i&&!qt&&t.manuallyAnimateOnMount&&t.parent){const{parent:wt}=t,Bt=sm(wt,Ot);if(wt.enteringChildren&&Bt){const{delayChildren:Ue}=Bt.transition||{};tt.delay=zP(wt.enteringChildren,t,Ue)}}return{animation:Ot,options:tt}}))}if(L.size){const ne={};if(typeof T.initial!="boolean"){const oe=sm(t,Array.isArray(T.initial)?T.initial[0]:T.initial);oe&&oe.transition&&(ne.transition=oe.transition)}L.forEach(oe=>{const fe=t.getBaseTarget(oe),ue=t.getValue(oe);ue&&(ue.liveStyle=!0),ne[oe]=fe??null}),k.push({animation:ne})}let $=!!k.length;return i&&(T.initial===!1||T.initial===T.animate)&&!t.manuallyAnimateOnMount&&($=!1),i=!1,$?e(k):Promise.resolve()}function a(v,T){if(r[v].isActive===T)return Promise.resolve();t.variantChildren?.forEach(k=>k.animationState?.setActive(v,T)),r[v].isActive=T;const C=h(v);for(const k in r)r[k].protectedKeys={};return C}return{animateChanges:h,setActive:a,setAnimateFunction:l,getState:()=>r,reset:()=>{r=$A()}}}function iO(t,e){return typeof e=="string"?e!==t:Array.isArray(e)?!UP(e,t):!1}function Ap(t=!1){return{isActive:t,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function $A(){return{animate:Ap(!0),whileInView:Ap(),whileHover:Ap(),whileTap:Ap(),whileDrag:Ap(),whileFocus:Ap(),exit:Ap()}}class gd{constructor(e){this.isMounted=!1,this.node=e}update(){}}class nO extends gd{constructor(e){super(e),e.animationState||(e.animationState=rO(e))}updateAnimationControlsSubscription(){const{animate:e}=this.node.getProps();u1(e)&&(this.unmountControls=e.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:e}=this.node.getProps(),{animate:r}=this.node.prevProps||{};e!==r&&this.updateAnimationControlsSubscription()}unmount(){this.node.animationState.reset(),this.unmountControls?.()}}let sO=0;class oO extends gd{constructor(){super(...arguments),this.id=sO++}update(){if(!this.node.presenceContext)return;const{isPresent:e,onExitComplete:r}=this.node.presenceContext,{isPresent:i}=this.node.prevPresenceContext||{};if(!this.node.animationState||e===i)return;const s=this.node.animationState.setActive("exit",!e);r&&!e&&s.then(()=>{r(this.id)})}mount(){const{register:e,onExitComplete:r}=this.node.presenceContext||{};r&&r(this.id),e&&(this.unmount=e(this.id))}unmount(){}}const aO={animation:{Feature:nO},exit:{Feature:oO}};function m_(t,e,r,i={passive:!0}){return t.addEventListener(e,r,i),()=>t.removeEventListener(e,r)}function R_(t){return{point:{x:t.pageX,y:t.pageY}}}const lO=t=>e=>Ow(e)&&t(e,R_(e));function Qg(t,e,r,i){return m_(t,e,lO(r),i)}const VP=1e-4,cO=1-VP,uO=1+VP,GP=.01,hO=0-GP,dO=0+GP;function Vo(t){return t.max-t.min}function pO(t,e,r){return Math.abs(t-e)<=r}function ZA(t,e,r,i=.5){t.origin=i,t.originPoint=_n(e.min,e.max,t.origin),t.scale=Vo(r)/Vo(e),t.translate=_n(r.min,r.max,t.origin)-t.originPoint,(t.scale>=cO&&t.scale<=uO||isNaN(t.scale))&&(t.scale=1),(t.translate>=hO&&t.translate<=dO||isNaN(t.translate))&&(t.translate=0)}function e_(t,e,r,i){ZA(t.x,e.x,r.x,i?i.originX:void 0),ZA(t.y,e.y,r.y,i?i.originY:void 0)}function XA(t,e,r){t.min=r.min+e.min,t.max=t.min+Vo(e)}function fO(t,e,r){XA(t.x,e.x,r.x),XA(t.y,e.y,r.y)}function KA(t,e,r){t.min=e.min-r.min,t.max=t.min+Vo(e)}function t_(t,e,r){KA(t.x,e.x,r.x),KA(t.y,e.y,r.y)}function yl(t){return[t("x"),t("y")]}const HP=({current:t})=>t?t.ownerDocument.defaultView:null,YA=(t,e)=>Math.abs(t-e);function mO(t,e){const r=YA(t.x,e.x),i=YA(t.y,e.y);return Math.sqrt(r**2+i**2)}class WP{constructor(e,r,{transformPagePoint:i,contextWindow:s=window,dragSnapToOrigin:l=!1,distanceThreshold:h=3}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const L=Ev(this.lastMoveEventInfo,this.history),O=this.startEvent!==null,K=mO(L.offset,{x:0,y:0})>=this.distanceThreshold;if(!O&&!K)return;const{point:$}=L,{timestamp:ne}=Ys;this.history.push({...$,timestamp:ne});const{onStart:oe,onMove:fe}=this.handlers;O||(oe&&oe(this.lastMoveEvent,L),this.startEvent=this.lastMoveEvent),fe&&fe(this.lastMoveEvent,L)},this.handlePointerMove=(L,O)=>{this.lastMoveEvent=L,this.lastMoveEventInfo=wv(O,this.transformPagePoint),on.update(this.updatePoint,!0)},this.handlePointerUp=(L,O)=>{this.end();const{onEnd:K,onSessionEnd:$,resumeAnimation:ne}=this.handlers;if(this.dragSnapToOrigin&&ne&&ne(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const oe=Ev(L.type==="pointercancel"?this.lastMoveEventInfo:wv(O,this.transformPagePoint),this.history);this.startEvent&&K&&K(L,oe),$&&$(L,oe)},!Ow(e))return;this.dragSnapToOrigin=l,this.handlers=r,this.transformPagePoint=i,this.distanceThreshold=h,this.contextWindow=s||window;const a=R_(e),v=wv(a,this.transformPagePoint),{point:T}=v,{timestamp:C}=Ys;this.history=[{...T,timestamp:C}];const{onSessionStart:k}=r;k&&k(e,Ev(v,this.history)),this.removeListeners=C_(Qg(this.contextWindow,"pointermove",this.handlePointerMove),Qg(this.contextWindow,"pointerup",this.handlePointerUp),Qg(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(e){this.handlers=e}end(){this.removeListeners&&this.removeListeners(),ld(this.updatePoint)}}function wv(t,e){return e?{point:e(t.point)}:t}function JA(t,e){return{x:t.x-e.x,y:t.y-e.y}}function Ev({point:t},e){return{point:t,delta:JA(t,qP(e)),offset:JA(t,gO(e)),velocity:_O(e,.1)}}function gO(t){return t[0]}function qP(t){return t[t.length-1]}function _O(t,e){if(t.length<2)return{x:0,y:0};let r=t.length-1,i=null;const s=qP(t);for(;r>=0&&(i=t[r],!(s.timestamp-i.timestamp>au(e)));)r--;if(!i)return{x:0,y:0};const l=bl(s.timestamp-i.timestamp);if(l===0)return{x:0,y:0};const h={x:(s.x-i.x)/l,y:(s.y-i.y)/l};return h.x===1/0&&(h.x=0),h.y===1/0&&(h.y=0),h}function yO(t,{min:e,max:r},i){return e!==void 0&&t<e?t=i?_n(e,t,i.min):Math.max(t,e):r!==void 0&&t>r&&(t=i?_n(r,t,i.max):Math.min(t,r)),t}function QA(t,e,r){return{min:e!==void 0?t.min+e:void 0,max:r!==void 0?t.max+r-(t.max-t.min):void 0}}function vO(t,{top:e,left:r,bottom:i,right:s}){return{x:QA(t.x,r,s),y:QA(t.y,e,i)}}function e3(t,e){let r=e.min-t.min,i=e.max-t.max;return e.max-e.min<t.max-t.min&&([r,i]=[i,r]),{min:r,max:i}}function bO(t,e){return{x:e3(t.x,e.x),y:e3(t.y,e.y)}}function xO(t,e){let r=.5;const i=Vo(t),s=Vo(e);return s>i?r=u_(e.min,e.max-i,t.min):i>s&&(r=u_(t.min,t.max-s,e.min)),ih(0,1,r)}function wO(t,e){const r={};return e.min!==void 0&&(r.min=e.min-t.min),e.max!==void 0&&(r.max=e.max-t.min),r}const ux=.35;function EO(t=ux){return t===!1?t=0:t===!0&&(t=ux),{x:t3(t,"left","right"),y:t3(t,"top","bottom")}}function t3(t,e,r){return{min:r3(t,e),max:r3(t,r)}}function r3(t,e){return typeof t=="number"?t:t[e]||0}const AO=new WeakMap;class TO{constructor(e){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=zn(),this.latestPointerEvent=null,this.latestPanInfo=null,this.visualElement=e}start(e,{snapToCursor:r=!1,distanceThreshold:i}={}){const{presenceContext:s}=this.visualElement;if(s&&s.isPresent===!1)return;const l=k=>{const{dragSnapToOrigin:L}=this.getProps();L?this.pauseAnimation():this.stopAnimation(),r&&this.snapToCursor(R_(k).point)},h=(k,L)=>{const{drag:O,dragPropagation:K,onDragStart:$}=this.getProps();if(O&&!K&&(this.openDragLock&&this.openDragLock(),this.openDragLock=RD(O),!this.openDragLock))return;this.latestPointerEvent=k,this.latestPanInfo=L,this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),yl(oe=>{let fe=this.getAxisMotionValue(oe).get()||0;if(lu.test(fe)){const{projection:ue}=this.visualElement;if(ue&&ue.layout){const we=ue.layout.layoutBox[oe];we&&(fe=Vo(we)*(parseFloat(fe)/100))}}this.originPoint[oe]=fe}),$&&on.postRender(()=>$(k,L)),lx(this.visualElement,"transform");const{animationState:ne}=this.visualElement;ne&&ne.setActive("whileDrag",!0)},a=(k,L)=>{this.latestPointerEvent=k,this.latestPanInfo=L;const{dragPropagation:O,dragDirectionLock:K,onDirectionLock:$,onDrag:ne}=this.getProps();if(!O&&!this.openDragLock)return;const{offset:oe}=L;if(K&&this.currentDirection===null){this.currentDirection=SO(oe),this.currentDirection!==null&&$&&$(this.currentDirection);return}this.updateAxis("x",L.point,oe),this.updateAxis("y",L.point,oe),this.visualElement.render(),ne&&ne(k,L)},v=(k,L)=>{this.latestPointerEvent=k,this.latestPanInfo=L,this.stop(k,L),this.latestPointerEvent=null,this.latestPanInfo=null},T=()=>yl(k=>this.getAnimationState(k)==="paused"&&this.getAxisMotionValue(k).animation?.play()),{dragSnapToOrigin:C}=this.getProps();this.panSession=new WP(e,{onSessionStart:l,onStart:h,onMove:a,onSessionEnd:v,resumeAnimation:T},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:C,distanceThreshold:i,contextWindow:HP(this.visualElement)})}stop(e,r){const i=e||this.latestPointerEvent,s=r||this.latestPanInfo,l=this.isDragging;if(this.cancel(),!l||!s||!i)return;const{velocity:h}=s;this.startAnimation(h);const{onDragEnd:a}=this.getProps();a&&on.postRender(()=>a(i,s))}cancel(){this.isDragging=!1;const{projection:e,animationState:r}=this.visualElement;e&&(e.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:i}=this.getProps();!i&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),r&&r.setActive("whileDrag",!1)}updateAxis(e,r,i){const{drag:s}=this.getProps();if(!i||!Ry(e,s,this.currentDirection))return;const l=this.getAxisMotionValue(e);let h=this.originPoint[e]+i[e];this.constraints&&this.constraints[e]&&(h=yO(h,this.constraints[e],this.elastic[e])),l.set(h)}resolveConstraints(){const{dragConstraints:e,dragElastic:r}=this.getProps(),i=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):this.visualElement.projection?.layout,s=this.constraints;e&&$f(e)?this.constraints||(this.constraints=this.resolveRefConstraints()):e&&i?this.constraints=vO(i.layoutBox,e):this.constraints=!1,this.elastic=EO(r),s!==this.constraints&&i&&this.constraints&&!this.hasMutatedConstraints&&yl(l=>{this.constraints!==!1&&this.getAxisMotionValue(l)&&(this.constraints[l]=wO(i.layoutBox[l],this.constraints[l]))})}resolveRefConstraints(){const{dragConstraints:e,onMeasureDragConstraints:r}=this.getProps();if(!e||!$f(e))return!1;const i=e.current,{projection:s}=this.visualElement;if(!s||!s.layout)return!1;const l=CN(i,s.root,this.visualElement.getTransformPagePoint());let h=bO(s.layout.layoutBox,l);if(r){const a=r(AN(h));this.hasMutatedConstraints=!!a,a&&(h=PP(a))}return h}startAnimation(e){const{drag:r,dragMomentum:i,dragElastic:s,dragTransition:l,dragSnapToOrigin:h,onDragTransitionEnd:a}=this.getProps(),v=this.constraints||{},T=yl(C=>{if(!Ry(C,r,this.currentDirection))return;let k=v&&v[C]||{};h&&(k={min:0,max:0});const L=s?200:1e6,O=s?40:1e7,K={type:"inertia",velocity:i?e[C]:0,bounceStiffness:L,bounceDamping:O,timeConstant:750,restDelta:1,restSpeed:10,...l,...k};return this.startAxisValueAnimation(C,K)});return Promise.all(T).then(a)}startAxisValueAnimation(e,r){const i=this.getAxisMotionValue(e);return lx(this.visualElement,e),i.start($w(e,i,0,r,this.visualElement,!1))}stopAnimation(){yl(e=>this.getAxisMotionValue(e).stop())}pauseAnimation(){yl(e=>this.getAxisMotionValue(e).animation?.pause())}getAnimationState(e){return this.getAxisMotionValue(e).animation?.state}getAxisMotionValue(e){const r=`_drag${e.toUpperCase()}`,i=this.visualElement.getProps(),s=i[r];return s||this.visualElement.getValue(e,(i.initial?i.initial[e]:void 0)||0)}snapToCursor(e){yl(r=>{const{drag:i}=this.getProps();if(!Ry(r,i,this.currentDirection))return;const{projection:s}=this.visualElement,l=this.getAxisMotionValue(r);if(s&&s.layout){const{min:h,max:a}=s.layout.layoutBox[r];l.set(e[r]-_n(h,a,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:e,dragConstraints:r}=this.getProps(),{projection:i}=this.visualElement;if(!$f(r)||!i||!this.constraints)return;this.stopAnimation();const s={x:0,y:0};yl(h=>{const a=this.getAxisMotionValue(h);if(a&&this.constraints!==!1){const v=a.get();s[h]=xO({min:v,max:v},this.constraints[h])}});const{transformTemplate:l}=this.visualElement.getProps();this.visualElement.current.style.transform=l?l({},""):"none",i.root&&i.root.updateScroll(),i.updateLayout(),this.resolveConstraints(),yl(h=>{if(!Ry(h,e,null))return;const a=this.getAxisMotionValue(h),{min:v,max:T}=this.constraints[h];a.set(_n(v,T,s[h]))})}addListeners(){if(!this.visualElement.current)return;AO.set(this.visualElement,this);const e=this.visualElement.current,r=Qg(e,"pointerdown",v=>{const{drag:T,dragListener:C=!0}=this.getProps();T&&C&&this.start(v)}),i=()=>{const{dragConstraints:v}=this.getProps();$f(v)&&v.current&&(this.constraints=this.resolveRefConstraints())},{projection:s}=this.visualElement,l=s.addEventListener("measure",i);s&&!s.layout&&(s.root&&s.root.updateScroll(),s.updateLayout()),on.read(i);const h=m_(window,"resize",()=>this.scalePositionWithinConstraints()),a=s.addEventListener("didUpdate",(({delta:v,hasLayoutChanged:T})=>{this.isDragging&&T&&(yl(C=>{const k=this.getAxisMotionValue(C);k&&(this.originPoint[C]+=v[C].translate,k.set(k.get()+v[C].translate))}),this.visualElement.render())}));return()=>{h(),r(),l(),a&&a()}}getProps(){const e=this.visualElement.getProps(),{drag:r=!1,dragDirectionLock:i=!1,dragPropagation:s=!1,dragConstraints:l=!1,dragElastic:h=ux,dragMomentum:a=!0}=e;return{...e,drag:r,dragDirectionLock:i,dragPropagation:s,dragConstraints:l,dragElastic:h,dragMomentum:a}}}function Ry(t,e,r){return(e===!0||e===t)&&(r===null||r===t)}function SO(t,e=10){let r=null;return Math.abs(t.y)>e?r="y":Math.abs(t.x)>e&&(r="x"),r}class CO extends gd{constructor(e){super(e),this.removeGroupControls=Al,this.removeListeners=Al,this.controls=new TO(e)}mount(){const{dragControls:e}=this.node.getProps();e&&(this.removeGroupControls=e.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||Al}unmount(){this.removeGroupControls(),this.removeListeners()}}const i3=t=>(e,r)=>{t&&on.postRender(()=>t(e,r))};class MO extends gd{constructor(){super(...arguments),this.removePointerDownListener=Al}onPointerDown(e){this.session=new WP(e,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:HP(this.node)})}createPanHandlers(){const{onPanSessionStart:e,onPanStart:r,onPan:i,onPanEnd:s}=this.node.getProps();return{onSessionStart:i3(e),onStart:i3(r),onMove:i,onEnd:(l,h)=>{delete this.session,s&&on.postRender(()=>s(l,h))}}}mount(){this.removePointerDownListener=Qg(this.node.current,"pointerdown",e=>this.onPointerDown(e))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const y0={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function n3(t,e){return e.max===e.min?0:t/(e.max-e.min)*100}const Mg={correct:(t,e)=>{if(!e.target)return t;if(typeof t=="string")if(Mr.test(t))t=parseFloat(t);else return t;const r=n3(t,e.target.x),i=n3(t,e.target.y);return`${r}% ${i}%`}},PO={correct:(t,{treeScale:e,projectionDelta:r})=>{const i=t,s=cd.parse(t);if(s.length>5)return i;const l=cd.createTransformer(t),h=typeof s[0]!="number"?1:0,a=r.x.scale*e.x,v=r.y.scale*e.y;s[0+h]/=a,s[1+h]/=v;const T=_n(a,v,.5);return typeof s[2+h]=="number"&&(s[2+h]/=T),typeof s[3+h]=="number"&&(s[3+h]/=T),l(s)}};let Av=!1;class RO extends te.Component{componentDidMount(){const{visualElement:e,layoutGroup:r,switchLayoutGroup:i,layoutId:s}=this.props,{projection:l}=e;JD(IO),l&&(r.group&&r.group.add(l),i&&i.register&&s&&i.register(l),Av&&l.root.didUpdate(),l.addEventListener("animationComplete",()=>{this.safeToRemove()}),l.setOptions({...l.options,onExitComplete:()=>this.safeToRemove()})),y0.hasEverUpdated=!0}getSnapshotBeforeUpdate(e){const{layoutDependency:r,visualElement:i,drag:s,isPresent:l}=this.props,{projection:h}=i;return h&&(h.isPresent=l,Av=!0,s||e.layoutDependency!==r||r===void 0||e.isPresent!==l?h.willUpdate():this.safeToRemove(),e.isPresent!==l&&(l?h.promote():h.relegate()||on.postRender(()=>{const a=h.getStack();(!a||!a.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:e}=this.props.visualElement;e&&(e.root.didUpdate(),Nw.postRender(()=>{!e.currentAnimation&&e.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:e,layoutGroup:r,switchLayoutGroup:i}=this.props,{projection:s}=e;Av=!0,s&&(s.scheduleCheckAfterUnmount(),r&&r.group&&r.group.remove(s),i&&i.deregister&&i.deregister(s))}safeToRemove(){const{safeToRemove:e}=this.props;e&&e()}render(){return null}}function $P(t){const[e,r]=mP(),i=te.useContext(fw);return H.jsx(RO,{...t,layoutGroup:i,switchLayoutGroup:te.useContext(CP),isPresent:e,safeToRemove:r})}const IO={borderRadius:{...Mg,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:Mg,borderTopRightRadius:Mg,borderBottomLeftRadius:Mg,borderBottomRightRadius:Mg,boxShadow:PO};function kO(t,e,r){const i=mo(t)?t:mm(t);return i.start($w("",i,e,r)),i.animation}const BO=(t,e)=>t.depth-e.depth;class LO{constructor(){this.children=[],this.isDirty=!1}add(e){_w(this.children,e),this.isDirty=!0}remove(e){yw(this.children,e),this.isDirty=!0}forEach(e){this.isDirty&&this.children.sort(BO),this.isDirty=!1,this.children.forEach(e)}}function DO(t,e){const r=ca.now(),i=({timestamp:s})=>{const l=s-r;l>=e&&(ld(i),t(l-e))};return on.setup(i,!0),()=>ld(i)}const ZP=["TopLeft","TopRight","BottomLeft","BottomRight"],NO=ZP.length,s3=t=>typeof t=="string"?parseFloat(t):t,o3=t=>typeof t=="number"||Mr.test(t);function OO(t,e,r,i,s,l){s?(t.opacity=_n(0,r.opacity??1,FO(i)),t.opacityExit=_n(e.opacity??1,0,zO(i))):l&&(t.opacity=_n(e.opacity??1,r.opacity??1,i));for(let h=0;h<NO;h++){const a=`border${ZP[h]}Radius`;let v=a3(e,a),T=a3(r,a);if(v===void 0&&T===void 0)continue;v||(v=0),T||(T=0),v===0||T===0||o3(v)===o3(T)?(t[a]=Math.max(_n(s3(v),s3(T),i),0),(lu.test(T)||lu.test(v))&&(t[a]+="%")):t[a]=T}(e.rotate||r.rotate)&&(t.rotate=_n(e.rotate||0,r.rotate||0,i))}function a3(t,e){return t[e]!==void 0?t[e]:t.borderRadius}const FO=XP(0,.5,DM),zO=XP(.5,.95,Al);function XP(t,e,r){return i=>i<t?0:i>e?1:r(u_(t,e,i))}function l3(t,e){t.min=e.min,t.max=e.max}function _l(t,e){l3(t.x,e.x),l3(t.y,e.y)}function c3(t,e){t.translate=e.translate,t.scale=e.scale,t.originPoint=e.originPoint,t.origin=e.origin}function u3(t,e,r,i,s){return t-=e,t=L0(t,1/r,i),s!==void 0&&(t=L0(t,1/s,i)),t}function UO(t,e=0,r=1,i=.5,s,l=t,h=t){if(lu.test(e)&&(e=parseFloat(e),e=_n(h.min,h.max,e/100)-h.min),typeof e!="number")return;let a=_n(l.min,l.max,i);t===l&&(a-=e),t.min=u3(t.min,e,r,a,s),t.max=u3(t.max,e,r,a,s)}function h3(t,e,[r,i,s],l,h){UO(t,e[r],e[i],e[s],e.scale,l,h)}const jO=["x","scaleX","originX"],VO=["y","scaleY","originY"];function d3(t,e,r,i){h3(t.x,e,jO,r?r.x:void 0,i?i.x:void 0),h3(t.y,e,VO,r?r.y:void 0,i?i.y:void 0)}function p3(t){return t.translate===0&&t.scale===1}function KP(t){return p3(t.x)&&p3(t.y)}function f3(t,e){return t.min===e.min&&t.max===e.max}function GO(t,e){return f3(t.x,e.x)&&f3(t.y,e.y)}function m3(t,e){return Math.round(t.min)===Math.round(e.min)&&Math.round(t.max)===Math.round(e.max)}function YP(t,e){return m3(t.x,e.x)&&m3(t.y,e.y)}function g3(t){return Vo(t.x)/Vo(t.y)}function _3(t,e){return t.translate===e.translate&&t.scale===e.scale&&t.originPoint===e.originPoint}class HO{constructor(){this.members=[]}add(e){_w(this.members,e),e.scheduleRender()}remove(e){if(yw(this.members,e),e===this.prevLead&&(this.prevLead=void 0),e===this.lead){const r=this.members[this.members.length-1];r&&this.promote(r)}}relegate(e){const r=this.members.findIndex(s=>e===s);if(r===0)return!1;let i;for(let s=r;s>=0;s--){const l=this.members[s];if(l.isPresent!==!1){i=l;break}}return i?(this.promote(i),!0):!1}promote(e,r){const i=this.lead;if(e!==i&&(this.prevLead=i,this.lead=e,e.show(),i)){i.instance&&i.scheduleRender(),e.scheduleRender(),e.resumeFrom=i,r&&(e.resumeFrom.preserveOpacity=!0),i.snapshot&&(e.snapshot=i.snapshot,e.snapshot.latestValues=i.animationValues||i.latestValues),e.root&&e.root.isUpdating&&(e.isLayoutDirty=!0);const{crossfade:s}=e.options;s===!1&&i.hide()}}exitAnimationComplete(){this.members.forEach(e=>{const{options:r,resumingFrom:i}=e;r.onExitComplete&&r.onExitComplete(),i&&i.options.onExitComplete&&i.options.onExitComplete()})}scheduleRender(){this.members.forEach(e=>{e.instance&&e.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function WO(t,e,r){let i="";const s=t.x.translate/e.x,l=t.y.translate/e.y,h=r?.z||0;if((s||l||h)&&(i=`translate3d(${s}px, ${l}px, ${h}px) `),(e.x!==1||e.y!==1)&&(i+=`scale(${1/e.x}, ${1/e.y}) `),r){const{transformPerspective:T,rotate:C,rotateX:k,rotateY:L,skewX:O,skewY:K}=r;T&&(i=`perspective(${T}px) ${i}`),C&&(i+=`rotate(${C}deg) `),k&&(i+=`rotateX(${k}deg) `),L&&(i+=`rotateY(${L}deg) `),O&&(i+=`skewX(${O}deg) `),K&&(i+=`skewY(${K}deg) `)}const a=t.x.scale*e.x,v=t.y.scale*e.y;return(a!==1||v!==1)&&(i+=`scale(${a}, ${v})`),i||"none"}const Tv=["","X","Y","Z"],qO=1e3;let $O=0;function Sv(t,e,r,i){const{latestValues:s}=e;s[t]&&(r[t]=s[t],e.setStaticValue(t,0),i&&(i[t]=0))}function JP(t){if(t.hasCheckedOptimisedAppear=!0,t.root===t)return;const{visualElement:e}=t.options;if(!e)return;const r=OP(e);if(window.MotionHasOptimisedAnimation(r,"transform")){const{layout:s,layoutId:l}=t.options;window.MotionCancelOptimisedAnimation(r,"transform",on,!(s||l))}const{parent:i}=t;i&&!i.hasCheckedOptimisedAppear&&JP(i)}function QP({attachResizeListener:t,defaultParent:e,measureScroll:r,checkIsScrollRoot:i,resetTransform:s}){return class{constructor(h={},a=e?.()){this.id=$O++,this.animationId=0,this.animationCommitId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,this.nodes.forEach(KO),this.nodes.forEach(eF),this.nodes.forEach(tF),this.nodes.forEach(YO)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=h,this.root=a?a.root||a:this,this.path=a?[...a.path,a]:[],this.parent=a,this.depth=a?a.depth+1:0;for(let v=0;v<this.path.length;v++)this.path[v].shouldResetTransform=!0;this.root===this&&(this.nodes=new LO)}addEventListener(h,a){return this.eventHandlers.has(h)||this.eventHandlers.set(h,new xw),this.eventHandlers.get(h).add(a)}notifyListeners(h,...a){const v=this.eventHandlers.get(h);v&&v.notify(...a)}hasListeners(h){return this.eventHandlers.has(h)}mount(h){if(this.instance)return;this.isSVG=fP(h)&&!ND(h),this.instance=h;const{layoutId:a,layout:v,visualElement:T}=this.options;if(T&&!T.current&&T.mount(h),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),this.root.hasTreeAnimated&&(v||a)&&(this.isLayoutDirty=!0),t){let C,k=0;const L=()=>this.root.updateBlockedByResize=!1;on.read(()=>{k=window.innerWidth}),t(h,()=>{const O=window.innerWidth;O!==k&&(k=O,this.root.updateBlockedByResize=!0,C&&C(),C=DO(L,250),y0.hasAnimatedSinceResize&&(y0.hasAnimatedSinceResize=!1,this.nodes.forEach(b3)))})}a&&this.root.registerSharedNode(a,this),this.options.animate!==!1&&T&&(a||v)&&this.addEventListener("didUpdate",({delta:C,hasLayoutChanged:k,hasRelativeLayoutChanged:L,layout:O})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const K=this.options.transition||T.getDefaultTransition()||oF,{onLayoutAnimationStart:$,onLayoutAnimationComplete:ne}=T.getProps(),oe=!this.targetLayout||!YP(this.targetLayout,O),fe=!k&&L;if(this.options.layoutRoot||this.resumeFrom||fe||k&&(oe||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0);const ue={...Lw(K,"layout"),onPlay:$,onComplete:ne};(T.shouldReduceMotion||this.options.layoutRoot)&&(ue.delay=0,ue.type=!1),this.startAnimation(ue),this.setAnimationOrigin(C,fe)}else k||b3(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=O})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const h=this.getStack();h&&h.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,this.eventHandlers.clear(),ld(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(rF),this.animationId++)}getTransformTemplate(){const{visualElement:h}=this.options;return h&&h.getProps().transformTemplate}willUpdate(h=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&JP(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let C=0;C<this.path.length;C++){const k=this.path[C];k.shouldResetTransform=!0,k.updateScroll("snapshot"),k.options.layoutRoot&&k.willUpdate(!1)}const{layoutId:a,layout:v}=this.options;if(a===void 0&&!v)return;const T=this.getTransformTemplate();this.prevTransformTemplateValue=T?T(this.latestValues,""):void 0,this.updateSnapshot(),h&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(y3);return}if(this.animationId<=this.animationCommitId){this.nodes.forEach(v3);return}this.animationCommitId=this.animationId,this.isUpdating?(this.isUpdating=!1,this.nodes.forEach(QO),this.nodes.forEach(ZO),this.nodes.forEach(XO)):this.nodes.forEach(v3),this.clearAllSnapshots();const a=ca.now();Ys.delta=ih(0,1e3/60,a-Ys.timestamp),Ys.timestamp=a,Ys.isProcessing=!0,fv.update.process(Ys),fv.preRender.process(Ys),fv.render.process(Ys),Ys.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,Nw.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(JO),this.sharedNodes.forEach(iF)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,on.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){on.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure(),this.snapshot&&!Vo(this.snapshot.measuredBox.x)&&!Vo(this.snapshot.measuredBox.y)&&(this.snapshot=void 0))}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let v=0;v<this.path.length;v++)this.path[v].updateScroll();const h=this.layout;this.layout=this.measure(!1),this.layoutCorrected=zn(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:a}=this.options;a&&a.notify("LayoutMeasure",this.layout.layoutBox,h?h.layoutBox:void 0)}updateScroll(h="measure"){let a=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===h&&(a=!1),a&&this.instance){const v=i(this.instance);this.scroll={animationId:this.root.animationId,phase:h,isRoot:v,offset:r(this.instance),wasRoot:this.scroll?this.scroll.isRoot:v}}}resetTransform(){if(!s)return;const h=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,a=this.projectionDelta&&!KP(this.projectionDelta),v=this.getTransformTemplate(),T=v?v(this.latestValues,""):void 0,C=T!==this.prevTransformTemplateValue;h&&this.instance&&(a||Pp(this.latestValues)||C)&&(s(this.instance,T),this.shouldResetTransform=!1,this.scheduleRender())}measure(h=!0){const a=this.measurePageBox();let v=this.removeElementScroll(a);return h&&(v=this.removeTransform(v)),aF(v),{animationId:this.root.animationId,measuredBox:a,layoutBox:v,latestValues:{},source:this.id}}measurePageBox(){const{visualElement:h}=this.options;if(!h)return zn();const a=h.measureViewportBox();if(!(this.scroll?.wasRoot||this.path.some(lF))){const{scroll:T}=this.root;T&&(Zf(a.x,T.offset.x),Zf(a.y,T.offset.y))}return a}removeElementScroll(h){const a=zn();if(_l(a,h),this.scroll?.wasRoot)return a;for(let v=0;v<this.path.length;v++){const T=this.path[v],{scroll:C,options:k}=T;T!==this.root&&C&&k.layoutScroll&&(C.wasRoot&&_l(a,h),Zf(a.x,C.offset.x),Zf(a.y,C.offset.y))}return a}applyTransform(h,a=!1){const v=zn();_l(v,h);for(let T=0;T<this.path.length;T++){const C=this.path[T];!a&&C.options.layoutScroll&&C.scroll&&C!==C.root&&Xf(v,{x:-C.scroll.offset.x,y:-C.scroll.offset.y}),Pp(C.latestValues)&&Xf(v,C.latestValues)}return Pp(this.latestValues)&&Xf(v,this.latestValues),v}removeTransform(h){const a=zn();_l(a,h);for(let v=0;v<this.path.length;v++){const T=this.path[v];if(!T.instance||!Pp(T.latestValues))continue;nx(T.latestValues)&&T.updateSnapshot();const C=zn(),k=T.measurePageBox();_l(C,k),d3(a,T.latestValues,T.snapshot?T.snapshot.layoutBox:void 0,C)}return Pp(this.latestValues)&&d3(a,this.latestValues),a}setTargetDelta(h){this.targetDelta=h,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(h){this.options={...this.options,...h,crossfade:h.crossfade!==void 0?h.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==Ys.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(h=!1){const a=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=a.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=a.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=a.isSharedProjectionDirty);const v=!!this.resumingFrom||this!==a;if(!(h||v&&this.isSharedProjectionDirty||this.isProjectionDirty||this.parent?.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:C,layoutId:k}=this.options;if(!(!this.layout||!(C||k))){if(this.resolvedRelativeTargetAt=Ys.timestamp,!this.targetDelta&&!this.relativeTarget){const L=this.getClosestProjectingParent();L&&L.layout&&this.animationProgress!==1?(this.relativeParent=L,this.forceRelativeParentToResolveTarget(),this.relativeTarget=zn(),this.relativeTargetOrigin=zn(),t_(this.relativeTargetOrigin,this.layout.layoutBox,L.layout.layoutBox),_l(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)&&(this.target||(this.target=zn(),this.targetWithTransforms=zn()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),fO(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):_l(this.target,this.layout.layoutBox),IP(this.target,this.targetDelta)):_l(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget)){this.attemptToResolveRelativeTarget=!1;const L=this.getClosestProjectingParent();L&&!!L.resumingFrom==!!this.resumingFrom&&!L.options.layoutScroll&&L.target&&this.animationProgress!==1?(this.relativeParent=L,this.forceRelativeParentToResolveTarget(),this.relativeTarget=zn(),this.relativeTargetOrigin=zn(),t_(this.relativeTargetOrigin,this.target,L.target),_l(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}}}getClosestProjectingParent(){if(!(!this.parent||nx(this.parent.latestValues)||RP(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){const h=this.getLead(),a=!!this.resumingFrom||this!==h;let v=!0;if((this.isProjectionDirty||this.parent?.isProjectionDirty)&&(v=!1),a&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(v=!1),this.resolvedRelativeTargetAt===Ys.timestamp&&(v=!1),v)return;const{layout:T,layoutId:C}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(T||C))return;_l(this.layoutCorrected,this.layout.layoutBox);const k=this.treeScale.x,L=this.treeScale.y;SN(this.layoutCorrected,this.treeScale,this.path,a),h.layout&&!h.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(h.target=h.layout.layoutBox,h.targetWithTransforms=zn());const{target:O}=h;if(!O){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(c3(this.prevProjectionDelta.x,this.projectionDelta.x),c3(this.prevProjectionDelta.y,this.projectionDelta.y)),e_(this.projectionDelta,this.layoutCorrected,O,this.latestValues),(this.treeScale.x!==k||this.treeScale.y!==L||!_3(this.projectionDelta.x,this.prevProjectionDelta.x)||!_3(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",O))}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(h=!0){if(this.options.visualElement?.scheduleRender(),h){const a=this.getStack();a&&a.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=Kf(),this.projectionDelta=Kf(),this.projectionDeltaWithTransform=Kf()}setAnimationOrigin(h,a=!1){const v=this.snapshot,T=v?v.latestValues:{},C={...this.latestValues},k=Kf();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!a;const L=zn(),O=v?v.source:void 0,K=this.layout?this.layout.source:void 0,$=O!==K,ne=this.getStack(),oe=!ne||ne.members.length<=1,fe=!!($&&!oe&&this.options.crossfade===!0&&!this.path.some(sF));this.animationProgress=0;let ue;this.mixTargetDelta=we=>{const De=we/1e3;x3(k.x,h.x,De),x3(k.y,h.y,De),this.setTargetDelta(k),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(t_(L,this.layout.layoutBox,this.relativeParent.layout.layoutBox),nF(this.relativeTarget,this.relativeTargetOrigin,L,De),ue&&GO(this.relativeTarget,ue)&&(this.isProjectionDirty=!1),ue||(ue=zn()),_l(ue,this.relativeTarget)),$&&(this.animationValues=C,OO(C,T,this.latestValues,De,fe,oe)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=De},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(h){this.notifyListeners("animationStart"),this.currentAnimation?.stop(),this.resumingFrom?.currentAnimation?.stop(),this.pendingAnimation&&(ld(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=on.update(()=>{y0.hasAnimatedSinceResize=!0,this.motionValue||(this.motionValue=mm(0)),this.currentAnimation=kO(this.motionValue,[0,1e3],{...h,velocity:0,isSync:!0,onUpdate:a=>{this.mixTargetDelta(a),h.onUpdate&&h.onUpdate(a)},onStop:()=>{},onComplete:()=>{h.onComplete&&h.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const h=this.getStack();h&&h.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(qO),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const h=this.getLead();let{targetWithTransforms:a,target:v,layout:T,latestValues:C}=h;if(!(!a||!v||!T)){if(this!==h&&this.layout&&T&&eR(this.options.animationType,this.layout.layoutBox,T.layoutBox)){v=this.target||zn();const k=Vo(this.layout.layoutBox.x);v.x.min=h.target.x.min,v.x.max=v.x.min+k;const L=Vo(this.layout.layoutBox.y);v.y.min=h.target.y.min,v.y.max=v.y.min+L}_l(a,v),Xf(a,C),e_(this.projectionDeltaWithTransform,this.layoutCorrected,a,C)}}registerSharedNode(h,a){this.sharedNodes.has(h)||this.sharedNodes.set(h,new HO),this.sharedNodes.get(h).add(a);const T=a.options.initialPromotionConfig;a.promote({transition:T?T.transition:void 0,preserveFollowOpacity:T&&T.shouldPreserveFollowOpacity?T.shouldPreserveFollowOpacity(a):void 0})}isLead(){const h=this.getStack();return h?h.lead===this:!0}getLead(){const{layoutId:h}=this.options;return h?this.getStack()?.lead||this:this}getPrevLead(){const{layoutId:h}=this.options;return h?this.getStack()?.prevLead:void 0}getStack(){const{layoutId:h}=this.options;if(h)return this.root.sharedNodes.get(h)}promote({needsReset:h,transition:a,preserveFollowOpacity:v}={}){const T=this.getStack();T&&T.promote(this,v),h&&(this.projectionDelta=void 0,this.needsReset=!0),a&&this.setOptions({transition:a})}relegate(){const h=this.getStack();return h?h.relegate(this):!1}resetSkewAndRotation(){const{visualElement:h}=this.options;if(!h)return;let a=!1;const{latestValues:v}=h;if((v.z||v.rotate||v.rotateX||v.rotateY||v.rotateZ||v.skewX||v.skewY)&&(a=!0),!a)return;const T={};v.z&&Sv("z",h,T,this.animationValues);for(let C=0;C<Tv.length;C++)Sv(`rotate${Tv[C]}`,h,T,this.animationValues),Sv(`skew${Tv[C]}`,h,T,this.animationValues);h.render();for(const C in T)h.setStaticValue(C,T[C]),this.animationValues&&(this.animationValues[C]=T[C]);h.scheduleRender()}applyProjectionStyles(h,a){if(!this.instance||this.isSVG)return;if(!this.isVisible){h.visibility="hidden";return}const v=this.getTransformTemplate();if(this.needsReset){this.needsReset=!1,h.visibility="",h.opacity="",h.pointerEvents=_0(a?.pointerEvents)||"",h.transform=v?v(this.latestValues,""):"none";return}const T=this.getLead();if(!this.projectionDelta||!this.layout||!T.target){this.options.layoutId&&(h.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,h.pointerEvents=_0(a?.pointerEvents)||""),this.hasProjected&&!Pp(this.latestValues)&&(h.transform=v?v({},""):"none",this.hasProjected=!1);return}h.visibility="";const C=T.animationValues||T.latestValues;this.applyTransformsToTarget();let k=WO(this.projectionDeltaWithTransform,this.treeScale,C);v&&(k=v(C,k)),h.transform=k;const{x:L,y:O}=this.projectionDelta;h.transformOrigin=`${L.origin*100}% ${O.origin*100}% 0`,T.animationValues?h.opacity=T===this?C.opacity??this.latestValues.opacity??1:this.preserveOpacity?this.latestValues.opacity:C.opacityExit:h.opacity=T===this?C.opacity!==void 0?C.opacity:"":C.opacityExit!==void 0?C.opacityExit:0;for(const K in f_){if(C[K]===void 0)continue;const{correct:$,applyTo:ne,isCSSVariable:oe}=f_[K],fe=k==="none"?C[K]:$(C[K],T);if(ne){const ue=ne.length;for(let we=0;we<ue;we++)h[ne[we]]=fe}else oe?this.options.visualElement.renderState.vars[K]=fe:h[K]=fe}this.options.layoutId&&(h.pointerEvents=T===this?_0(a?.pointerEvents)||"":"none")}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(h=>h.currentAnimation?.stop()),this.root.nodes.forEach(y3),this.root.sharedNodes.clear()}}}function ZO(t){t.updateLayout()}function XO(t){const e=t.resumeFrom?.snapshot||t.snapshot;if(t.isLead()&&t.layout&&e&&t.hasListeners("didUpdate")){const{layoutBox:r,measuredBox:i}=t.layout,{animationType:s}=t.options,l=e.source!==t.layout.source;s==="size"?yl(C=>{const k=l?e.measuredBox[C]:e.layoutBox[C],L=Vo(k);k.min=r[C].min,k.max=k.min+L}):eR(s,e.layoutBox,r)&&yl(C=>{const k=l?e.measuredBox[C]:e.layoutBox[C],L=Vo(r[C]);k.max=k.min+L,t.relativeTarget&&!t.currentAnimation&&(t.isProjectionDirty=!0,t.relativeTarget[C].max=t.relativeTarget[C].min+L)});const h=Kf();e_(h,r,e.layoutBox);const a=Kf();l?e_(a,t.applyTransform(i,!0),e.measuredBox):e_(a,r,e.layoutBox);const v=!KP(h);let T=!1;if(!t.resumeFrom){const C=t.getClosestProjectingParent();if(C&&!C.resumeFrom){const{snapshot:k,layout:L}=C;if(k&&L){const O=zn();t_(O,e.layoutBox,k.layoutBox);const K=zn();t_(K,r,L.layoutBox),YP(O,K)||(T=!0),C.options.layoutRoot&&(t.relativeTarget=K,t.relativeTargetOrigin=O,t.relativeParent=C)}}}t.notifyListeners("didUpdate",{layout:r,snapshot:e,delta:a,layoutDelta:h,hasLayoutChanged:v,hasRelativeLayoutChanged:T})}else if(t.isLead()){const{onExitComplete:r}=t.options;r&&r()}t.options.transition=void 0}function KO(t){t.parent&&(t.isProjecting()||(t.isProjectionDirty=t.parent.isProjectionDirty),t.isSharedProjectionDirty||(t.isSharedProjectionDirty=!!(t.isProjectionDirty||t.parent.isProjectionDirty||t.parent.isSharedProjectionDirty)),t.isTransformDirty||(t.isTransformDirty=t.parent.isTransformDirty))}function YO(t){t.isProjectionDirty=t.isSharedProjectionDirty=t.isTransformDirty=!1}function JO(t){t.clearSnapshot()}function y3(t){t.clearMeasurements()}function v3(t){t.isLayoutDirty=!1}function QO(t){const{visualElement:e}=t.options;e&&e.getProps().onBeforeLayoutMeasure&&e.notify("BeforeLayoutMeasure"),t.resetTransform()}function b3(t){t.finishAnimation(),t.targetDelta=t.relativeTarget=t.target=void 0,t.isProjectionDirty=!0}function eF(t){t.resolveTargetDelta()}function tF(t){t.calcProjection()}function rF(t){t.resetSkewAndRotation()}function iF(t){t.removeLeadSnapshot()}function x3(t,e,r){t.translate=_n(e.translate,0,r),t.scale=_n(e.scale,1,r),t.origin=e.origin,t.originPoint=e.originPoint}function w3(t,e,r,i){t.min=_n(e.min,r.min,i),t.max=_n(e.max,r.max,i)}function nF(t,e,r,i){w3(t.x,e.x,r.x,i),w3(t.y,e.y,r.y,i)}function sF(t){return t.animationValues&&t.animationValues.opacityExit!==void 0}const oF={duration:.45,ease:[.4,0,.1,1]},E3=t=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(t),A3=E3("applewebkit/")&&!E3("chrome/")?Math.round:Al;function T3(t){t.min=A3(t.min),t.max=A3(t.max)}function aF(t){T3(t.x),T3(t.y)}function eR(t,e,r){return t==="position"||t==="preserve-aspect"&&!pO(g3(e),g3(r),.2)}function lF(t){return t!==t.root&&t.scroll?.wasRoot}const cF=QP({attachResizeListener:(t,e)=>m_(t,"resize",e),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),Cv={current:void 0},tR=QP({measureScroll:t=>({x:t.scrollLeft,y:t.scrollTop}),defaultParent:()=>{if(!Cv.current){const t=new cF({});t.mount(window),t.setOptions({layoutScroll:!0}),Cv.current=t}return Cv.current},resetTransform:(t,e)=>{t.style.transform=e!==void 0?e:"none"},checkIsScrollRoot:t=>window.getComputedStyle(t).position==="fixed"}),uF={pan:{Feature:MO},drag:{Feature:CO,ProjectionNode:tR,MeasureLayout:$P}};function S3(t,e,r){const{props:i}=t;t.animationState&&i.whileHover&&t.animationState.setActive("whileHover",r==="Start");const s="onHover"+r,l=i[s];l&&on.postRender(()=>l(e,R_(e)))}class hF extends gd{mount(){const{current:e}=this.node;e&&(this.unmount=ID(e,(r,i)=>(S3(this.node,i,"Start"),s=>S3(this.node,s,"End"))))}unmount(){}}class dF extends gd{constructor(){super(...arguments),this.isActive=!1}onFocus(){let e=!1;try{e=this.node.current.matches(":focus-visible")}catch{e=!0}!e||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=C_(m_(this.node.current,"focus",()=>this.onFocus()),m_(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function C3(t,e,r){const{props:i}=t;if(t.current instanceof HTMLButtonElement&&t.current.disabled)return;t.animationState&&i.whileTap&&t.animationState.setActive("whileTap",r==="Start");const s="onTap"+(r==="End"?"":r),l=i[s];l&&on.postRender(()=>l(e,R_(e)))}class pF extends gd{mount(){const{current:e}=this.node;e&&(this.unmount=DD(e,(r,i)=>(C3(this.node,i,"Start"),(s,{success:l})=>C3(this.node,s,l?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const hx=new WeakMap,Mv=new WeakMap,fF=t=>{const e=hx.get(t.target);e&&e(t)},mF=t=>{t.forEach(fF)};function gF({root:t,...e}){const r=t||document;Mv.has(r)||Mv.set(r,{});const i=Mv.get(r),s=JSON.stringify(e);return i[s]||(i[s]=new IntersectionObserver(mF,{root:t,...e})),i[s]}function _F(t,e,r){const i=gF(e);return hx.set(t,r),i.observe(t),()=>{hx.delete(t),i.unobserve(t)}}const yF={some:0,all:1};class vF extends gd{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:e={}}=this.node.getProps(),{root:r,margin:i,amount:s="some",once:l}=e,h={root:r?r.current:void 0,rootMargin:i,threshold:typeof s=="number"?s:yF[s]},a=v=>{const{isIntersecting:T}=v;if(this.isInView===T||(this.isInView=T,l&&!T&&this.hasEnteredView))return;T&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",T);const{onViewportEnter:C,onViewportLeave:k}=this.node.getProps(),L=T?C:k;L&&L(v)};return _F(this.node.current,h,a)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:e,prevProps:r}=this.node;["amount","margin","root"].some(bF(e,r))&&this.startObserver()}unmount(){}}function bF({viewport:t={}},{viewport:e={}}={}){return r=>t[r]!==e[r]}const xF={inView:{Feature:vF},tap:{Feature:pF},focus:{Feature:dF},hover:{Feature:hF}},wF={layout:{ProjectionNode:tR,MeasureLayout:$P}},EF={...aO,...xF,...uF,...wF},rR=EN(EF,NN);function _i(t,e,{checkForDefaultPrevented:r=!0}={}){return function(s){if(t?.(s),r===!1||!s.defaultPrevented)return e?.(s)}}function AF(t,e){const r=te.createContext(e),i=l=>{const{children:h,...a}=l,v=te.useMemo(()=>a,Object.values(a));return H.jsx(r.Provider,{value:v,children:h})};i.displayName=t+"Provider";function s(l){const h=te.useContext(r);if(h)return h;if(e!==void 0)return e;throw new Error(`\`${l}\` must be used within \`${t}\``)}return[i,s]}function Im(t,e=[]){let r=[];function i(l,h){const a=te.createContext(h),v=r.length;r=[...r,h];const T=k=>{const{scope:L,children:O,...K}=k,$=L?.[t]?.[v]||a,ne=te.useMemo(()=>K,Object.values(K));return H.jsx($.Provider,{value:ne,children:O})};T.displayName=l+"Provider";function C(k,L){const O=L?.[t]?.[v]||a,K=te.useContext(O);if(K)return K;if(h!==void 0)return h;throw new Error(`\`${k}\` must be used within \`${l}\``)}return[T,C]}const s=()=>{const l=r.map(h=>te.createContext(h));return function(a){const v=a?.[t]||l;return te.useMemo(()=>({[`__scope${t}`]:{...a,[t]:v}}),[a,v])}};return s.scopeName=t,[i,TF(s,...e)]}function TF(...t){const e=t[0];if(t.length===1)return e;const r=()=>{const i=t.map(s=>({useScope:s(),scopeName:s.scopeName}));return function(l){const h=i.reduce((a,{useScope:v,scopeName:T})=>{const k=v(l)[`__scope${T}`];return{...a,...k}},{});return te.useMemo(()=>({[`__scope${e.scopeName}`]:h}),[h])}};return r.scopeName=e.scopeName,r}function M3(t,e){if(typeof t=="function")return t(e);t!=null&&(t.current=e)}function I_(...t){return e=>{let r=!1;const i=t.map(s=>{const l=M3(s,e);return!r&&typeof l=="function"&&(r=!0),l});if(r)return()=>{for(let s=0;s<i.length;s++){const l=i[s];typeof l=="function"?l():M3(t[s],null)}}}}function Cn(...t){return te.useCallback(I_(...t),t)}function P3(t){const e=SF(t),r=te.forwardRef((i,s)=>{const{children:l,...h}=i,a=te.Children.toArray(l),v=a.find(MF);if(v){const T=v.props.children,C=a.map(k=>k===v?te.Children.count(T)>1?te.Children.only(null):te.isValidElement(T)?T.props.children:null:k);return H.jsx(e,{...h,ref:s,children:te.isValidElement(T)?te.cloneElement(T,void 0,C):null})}return H.jsx(e,{...h,ref:s,children:l})});return r.displayName=`${t}.Slot`,r}function SF(t){const e=te.forwardRef((r,i)=>{const{children:s,...l}=r;if(te.isValidElement(s)){const h=RF(s),a=PF(l,s.props);return s.type!==te.Fragment&&(a.ref=i?I_(i,h):h),te.cloneElement(s,a)}return te.Children.count(s)>1?te.Children.only(null):null});return e.displayName=`${t}.SlotClone`,e}var CF=Symbol("radix.slottable");function MF(t){return te.isValidElement(t)&&typeof t.type=="function"&&"__radixId"in t.type&&t.type.__radixId===CF}function PF(t,e){const r={...e};for(const i in e){const s=t[i],l=e[i];/^on[A-Z]/.test(i)?s&&l?r[i]=(...a)=>{const v=l(...a);return s(...a),v}:s&&(r[i]=s):i==="style"?r[i]={...s,...l}:i==="className"&&(r[i]=[s,l].filter(Boolean).join(" "))}return{...t,...r}}function RF(t){let e=Object.getOwnPropertyDescriptor(t.props,"ref")?.get,r=e&&"isReactWarning"in e&&e.isReactWarning;return r?t.ref:(e=Object.getOwnPropertyDescriptor(t,"ref")?.get,r=e&&"isReactWarning"in e&&e.isReactWarning,r?t.props.ref:t.props.ref||t.ref)}function iR(t){const e=t+"CollectionProvider",[r,i]=Im(e),[s,l]=r(e,{collectionRef:{current:null},itemMap:new Map}),h=$=>{const{scope:ne,children:oe}=$,fe=Jh.useRef(null),ue=Jh.useRef(new Map).current;return H.jsx(s,{scope:ne,itemMap:ue,collectionRef:fe,children:oe})};h.displayName=e;const a=t+"CollectionSlot",v=P3(a),T=Jh.forwardRef(($,ne)=>{const{scope:oe,children:fe}=$,ue=l(a,oe),we=Cn(ne,ue.collectionRef);return H.jsx(v,{ref:we,children:fe})});T.displayName=a;const C=t+"CollectionItemSlot",k="data-radix-collection-item",L=P3(C),O=Jh.forwardRef(($,ne)=>{const{scope:oe,children:fe,...ue}=$,we=Jh.useRef(null),De=Cn(ne,we),Fe=l(C,oe);return Jh.useEffect(()=>(Fe.itemMap.set(we,{ref:we,...ue}),()=>void Fe.itemMap.delete(we))),H.jsx(L,{[k]:"",ref:De,children:fe})});O.displayName=C;function K($){const ne=l(t+"CollectionConsumer",$);return Jh.useCallback(()=>{const fe=ne.collectionRef.current;if(!fe)return[];const ue=Array.from(fe.querySelectorAll(`[${k}]`));return Array.from(ne.itemMap.values()).sort((Fe,Ke)=>ue.indexOf(Fe.ref.current)-ue.indexOf(Ke.ref.current))},[ne.collectionRef,ne.itemMap])}return[{Provider:h,Slot:T,ItemSlot:O},K,i]}var cu=globalThis?.document?te.useLayoutEffect:()=>{},IF=uw[" useId ".trim().toString()]||(()=>{}),kF=0;function r_(t){const[e,r]=te.useState(IF());return cu(()=>{r(i=>i??String(kF++))},[t]),t||(e?`radix-${e}`:"")}var nR=gM();const BF=mM(nR);function LF(t){const e=DF(t),r=te.forwardRef((i,s)=>{const{children:l,...h}=i,a=te.Children.toArray(l),v=a.find(OF);if(v){const T=v.props.children,C=a.map(k=>k===v?te.Children.count(T)>1?te.Children.only(null):te.isValidElement(T)?T.props.children:null:k);return H.jsx(e,{...h,ref:s,children:te.isValidElement(T)?te.cloneElement(T,void 0,C):null})}return H.jsx(e,{...h,ref:s,children:l})});return r.displayName=`${t}.Slot`,r}function DF(t){const e=te.forwardRef((r,i)=>{const{children:s,...l}=r;if(te.isValidElement(s)){const h=zF(s),a=FF(l,s.props);return s.type!==te.Fragment&&(a.ref=i?I_(i,h):h),te.cloneElement(s,a)}return te.Children.count(s)>1?te.Children.only(null):null});return e.displayName=`${t}.SlotClone`,e}var NF=Symbol("radix.slottable");function OF(t){return te.isValidElement(t)&&typeof t.type=="function"&&"__radixId"in t.type&&t.type.__radixId===NF}function FF(t,e){const r={...e};for(const i in e){const s=t[i],l=e[i];/^on[A-Z]/.test(i)?s&&l?r[i]=(...a)=>{const v=l(...a);return s(...a),v}:s&&(r[i]=s):i==="style"?r[i]={...s,...l}:i==="className"&&(r[i]=[s,l].filter(Boolean).join(" "))}return{...t,...r}}function zF(t){let e=Object.getOwnPropertyDescriptor(t.props,"ref")?.get,r=e&&"isReactWarning"in e&&e.isReactWarning;return r?t.ref:(e=Object.getOwnPropertyDescriptor(t,"ref")?.get,r=e&&"isReactWarning"in e&&e.isReactWarning,r?t.props.ref:t.props.ref||t.ref)}var UF=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],Qi=UF.reduce((t,e)=>{const r=LF(`Primitive.${e}`),i=te.forwardRef((s,l)=>{const{asChild:h,...a}=s,v=h?r:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),H.jsx(v,{...a,ref:l})});return i.displayName=`Primitive.${e}`,{...t,[e]:i}},{});function jF(t,e){t&&nR.flushSync(()=>t.dispatchEvent(e))}function la(t){const e=te.useRef(t);return te.useEffect(()=>{e.current=t}),te.useMemo(()=>(...r)=>e.current?.(...r),[])}var VF=uw[" useInsertionEffect ".trim().toString()]||cu;function d1({prop:t,defaultProp:e,onChange:r=()=>{},caller:i}){const[s,l,h]=GF({defaultProp:e,onChange:r}),a=t!==void 0,v=a?t:s;{const C=te.useRef(t!==void 0);te.useEffect(()=>{const k=C.current;k!==a&&console.warn(`${i} is changing from ${k?"controlled":"uncontrolled"} to ${a?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),C.current=a},[a,i])}const T=te.useCallback(C=>{if(a){const k=HF(C)?C(t):C;k!==t&&h.current?.(k)}else l(C)},[a,t,l,h]);return[v,T]}function GF({defaultProp:t,onChange:e}){const[r,i]=te.useState(t),s=te.useRef(r),l=te.useRef(e);return VF(()=>{l.current=e},[e]),te.useEffect(()=>{s.current!==r&&(l.current?.(r),s.current=r)},[r,s]),[r,i,l]}function HF(t){return typeof t=="function"}var WF=te.createContext(void 0);function p1(t){const e=te.useContext(WF);return t||e||"ltr"}var Pv="rovingFocusGroup.onEntryFocus",qF={bubbles:!1,cancelable:!0},k_="RovingFocusGroup",[dx,sR,$F]=iR(k_),[ZF,oR]=Im(k_,[$F]),[XF,KF]=ZF(k_),aR=te.forwardRef((t,e)=>H.jsx(dx.Provider,{scope:t.__scopeRovingFocusGroup,children:H.jsx(dx.Slot,{scope:t.__scopeRovingFocusGroup,children:H.jsx(YF,{...t,ref:e})})}));aR.displayName=k_;var YF=te.forwardRef((t,e)=>{const{__scopeRovingFocusGroup:r,orientation:i,loop:s=!1,dir:l,currentTabStopId:h,defaultCurrentTabStopId:a,onCurrentTabStopIdChange:v,onEntryFocus:T,preventScrollOnEntryFocus:C=!1,...k}=t,L=te.useRef(null),O=Cn(e,L),K=p1(l),[$,ne]=d1({prop:h,defaultProp:a??null,onChange:v,caller:k_}),[oe,fe]=te.useState(!1),ue=la(T),we=sR(r),De=te.useRef(!1),[Fe,Ke]=te.useState(0);return te.useEffect(()=>{const ze=L.current;if(ze)return ze.addEventListener(Pv,ue),()=>ze.removeEventListener(Pv,ue)},[ue]),H.jsx(XF,{scope:r,orientation:i,dir:K,loop:s,currentTabStopId:$,onItemFocus:te.useCallback(ze=>ne(ze),[ne]),onItemShiftTab:te.useCallback(()=>fe(!0),[]),onFocusableItemAdd:te.useCallback(()=>Ke(ze=>ze+1),[]),onFocusableItemRemove:te.useCallback(()=>Ke(ze=>ze-1),[]),children:H.jsx(Qi.div,{tabIndex:oe||Fe===0?-1:0,"data-orientation":i,...k,ref:O,style:{outline:"none",...t.style},onMouseDown:_i(t.onMouseDown,()=>{De.current=!0}),onFocus:_i(t.onFocus,ze=>{const it=!De.current;if(ze.target===ze.currentTarget&&it&&!oe){const lt=new CustomEvent(Pv,qF);if(ze.currentTarget.dispatchEvent(lt),!lt.defaultPrevented){const ht=we().filter(Qt=>Qt.focusable),vt=ht.find(Qt=>Qt.active),Nt=ht.find(Qt=>Qt.id===$),qt=[vt,Nt,...ht].filter(Boolean).map(Qt=>Qt.ref.current);uR(qt,C)}}De.current=!1}),onBlur:_i(t.onBlur,()=>fe(!1))})})}),lR="RovingFocusGroupItem",cR=te.forwardRef((t,e)=>{const{__scopeRovingFocusGroup:r,focusable:i=!0,active:s=!1,tabStopId:l,children:h,...a}=t,v=r_(),T=l||v,C=KF(lR,r),k=C.currentTabStopId===T,L=sR(r),{onFocusableItemAdd:O,onFocusableItemRemove:K,currentTabStopId:$}=C;return te.useEffect(()=>{if(i)return O(),()=>K()},[i,O,K]),H.jsx(dx.ItemSlot,{scope:r,id:T,focusable:i,active:s,children:H.jsx(Qi.span,{tabIndex:k?0:-1,"data-orientation":C.orientation,...a,ref:e,onMouseDown:_i(t.onMouseDown,ne=>{i?C.onItemFocus(T):ne.preventDefault()}),onFocus:_i(t.onFocus,()=>C.onItemFocus(T)),onKeyDown:_i(t.onKeyDown,ne=>{if(ne.key==="Tab"&&ne.shiftKey){C.onItemShiftTab();return}if(ne.target!==ne.currentTarget)return;const oe=e8(ne,C.orientation,C.dir);if(oe!==void 0){if(ne.metaKey||ne.ctrlKey||ne.altKey||ne.shiftKey)return;ne.preventDefault();let ue=L().filter(we=>we.focusable).map(we=>we.ref.current);if(oe==="last")ue.reverse();else if(oe==="prev"||oe==="next"){oe==="prev"&&ue.reverse();const we=ue.indexOf(ne.currentTarget);ue=C.loop?t8(ue,we+1):ue.slice(we+1)}setTimeout(()=>uR(ue))}}),children:typeof h=="function"?h({isCurrentTabStop:k,hasTabStop:$!=null}):h})})});cR.displayName=lR;var JF={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function QF(t,e){return e!=="rtl"?t:t==="ArrowLeft"?"ArrowRight":t==="ArrowRight"?"ArrowLeft":t}function e8(t,e,r){const i=QF(t.key,r);if(!(e==="vertical"&&["ArrowLeft","ArrowRight"].includes(i))&&!(e==="horizontal"&&["ArrowUp","ArrowDown"].includes(i)))return JF[i]}function uR(t,e=!1){const r=document.activeElement;for(const i of t)if(i===r||(i.focus({preventScroll:e}),document.activeElement!==r))return}function t8(t,e){return t.map((r,i)=>t[(e+i)%t.length])}var r8=aR,i8=cR;function n8(t,e){return te.useReducer((r,i)=>e[r][i]??r,t)}var lh=t=>{const{present:e,children:r}=t,i=s8(e),s=typeof r=="function"?r({present:i.isPresent}):te.Children.only(r),l=Cn(i.ref,o8(s));return typeof r=="function"||i.isPresent?te.cloneElement(s,{ref:l}):null};lh.displayName="Presence";function s8(t){const[e,r]=te.useState(),i=te.useRef(null),s=te.useRef(t),l=te.useRef("none"),h=t?"mounted":"unmounted",[a,v]=n8(h,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return te.useEffect(()=>{const T=Iy(i.current);l.current=a==="mounted"?T:"none"},[a]),cu(()=>{const T=i.current,C=s.current;if(C!==t){const L=l.current,O=Iy(T);t?v("MOUNT"):O==="none"||T?.display==="none"?v("UNMOUNT"):v(C&&L!==O?"ANIMATION_OUT":"UNMOUNT"),s.current=t}},[t,v]),cu(()=>{if(e){let T;const C=e.ownerDocument.defaultView??window,k=O=>{const $=Iy(i.current).includes(CSS.escape(O.animationName));if(O.target===e&&$&&(v("ANIMATION_END"),!s.current)){const ne=e.style.animationFillMode;e.style.animationFillMode="forwards",T=C.setTimeout(()=>{e.style.animationFillMode==="forwards"&&(e.style.animationFillMode=ne)})}},L=O=>{O.target===e&&(l.current=Iy(i.current))};return e.addEventListener("animationstart",L),e.addEventListener("animationcancel",k),e.addEventListener("animationend",k),()=>{C.clearTimeout(T),e.removeEventListener("animationstart",L),e.removeEventListener("animationcancel",k),e.removeEventListener("animationend",k)}}else v("ANIMATION_END")},[e,v]),{isPresent:["mounted","unmountSuspended"].includes(a),ref:te.useCallback(T=>{i.current=T?getComputedStyle(T):null,r(T)},[])}}function Iy(t){return t?.animationName||"none"}function o8(t){let e=Object.getOwnPropertyDescriptor(t.props,"ref")?.get,r=e&&"isReactWarning"in e&&e.isReactWarning;return r?t.ref:(e=Object.getOwnPropertyDescriptor(t,"ref")?.get,r=e&&"isReactWarning"in e&&e.isReactWarning,r?t.props.ref:t.props.ref||t.ref)}var f1="Tabs",[a8]=Im(f1,[oR]),hR=oR(),[l8,Zw]=a8(f1),dR=te.forwardRef((t,e)=>{const{__scopeTabs:r,value:i,onValueChange:s,defaultValue:l,orientation:h="horizontal",dir:a,activationMode:v="automatic",...T}=t,C=p1(a),[k,L]=d1({prop:i,onChange:s,defaultProp:l??"",caller:f1});return H.jsx(l8,{scope:r,baseId:r_(),value:k,onValueChange:L,orientation:h,dir:C,activationMode:v,children:H.jsx(Qi.div,{dir:C,"data-orientation":h,...T,ref:e})})});dR.displayName=f1;var pR="TabsList",fR=te.forwardRef((t,e)=>{const{__scopeTabs:r,loop:i=!0,...s}=t,l=Zw(pR,r),h=hR(r);return H.jsx(r8,{asChild:!0,...h,orientation:l.orientation,dir:l.dir,loop:i,children:H.jsx(Qi.div,{role:"tablist","aria-orientation":l.orientation,...s,ref:e})})});fR.displayName=pR;var mR="TabsTrigger",gR=te.forwardRef((t,e)=>{const{__scopeTabs:r,value:i,disabled:s=!1,...l}=t,h=Zw(mR,r),a=hR(r),v=vR(h.baseId,i),T=bR(h.baseId,i),C=i===h.value;return H.jsx(i8,{asChild:!0,...a,focusable:!s,active:C,children:H.jsx(Qi.button,{type:"button",role:"tab","aria-selected":C,"aria-controls":T,"data-state":C?"active":"inactive","data-disabled":s?"":void 0,disabled:s,id:v,...l,ref:e,onMouseDown:_i(t.onMouseDown,k=>{!s&&k.button===0&&k.ctrlKey===!1?h.onValueChange(i):k.preventDefault()}),onKeyDown:_i(t.onKeyDown,k=>{[" ","Enter"].includes(k.key)&&h.onValueChange(i)}),onFocus:_i(t.onFocus,()=>{const k=h.activationMode!=="manual";!C&&!s&&k&&h.onValueChange(i)})})})});gR.displayName=mR;var _R="TabsContent",yR=te.forwardRef((t,e)=>{const{__scopeTabs:r,value:i,forceMount:s,children:l,...h}=t,a=Zw(_R,r),v=vR(a.baseId,i),T=bR(a.baseId,i),C=i===a.value,k=te.useRef(C);return te.useEffect(()=>{const L=requestAnimationFrame(()=>k.current=!1);return()=>cancelAnimationFrame(L)},[]),H.jsx(lh,{present:s||C,children:({present:L})=>H.jsx(Qi.div,{"data-state":C?"active":"inactive","data-orientation":a.orientation,role:"tabpanel","aria-labelledby":v,hidden:!L,id:T,tabIndex:0,...h,ref:e,style:{...t.style,animationDuration:k.current?"0s":void 0},children:L&&l})})});yR.displayName=_R;function vR(t,e){return`${t}-trigger-${e}`}function bR(t,e){return`${t}-content-${e}`}var c8=dR,u8=fR,h8=gR,d8=yR;function xR(t){var e,r,i="";if(typeof t=="string"||typeof t=="number")i+=t;else if(typeof t=="object")if(Array.isArray(t)){var s=t.length;for(e=0;e<s;e++)t[e]&&(r=xR(t[e]))&&(i&&(i+=" "),i+=r)}else for(r in t)t[r]&&(i&&(i+=" "),i+=r);return i}function wR(){for(var t,e,r=0,i="",s=arguments.length;r<s;r++)(t=arguments[r])&&(e=xR(t))&&(i&&(i+=" "),i+=e);return i}const p8=(t,e)=>{const r=new Array(t.length+e.length);for(let i=0;i<t.length;i++)r[i]=t[i];for(let i=0;i<e.length;i++)r[t.length+i]=e[i];return r},f8=(t,e)=>({classGroupId:t,validator:e}),ER=(t=new Map,e=null,r)=>({nextPart:t,validators:e,classGroupId:r}),D0="-",R3=[],m8="arbitrary..",g8=t=>{const e=y8(t),{conflictingClassGroups:r,conflictingClassGroupModifiers:i}=t;return{getClassGroupId:h=>{if(h.startsWith("[")&&h.endsWith("]"))return _8(h);const a=h.split(D0),v=a[0]===""&&a.length>1?1:0;return AR(a,v,e)},getConflictingClassGroupIds:(h,a)=>{if(a){const v=i[h],T=r[h];return v?T?p8(T,v):v:T||R3}return r[h]||R3}}},AR=(t,e,r)=>{if(t.length-e===0)return r.classGroupId;const s=t[e],l=r.nextPart.get(s);if(l){const T=AR(t,e+1,l);if(T)return T}const h=r.validators;if(h===null)return;const a=e===0?t.join(D0):t.slice(e).join(D0),v=h.length;for(let T=0;T<v;T++){const C=h[T];if(C.validator(a))return C.classGroupId}},_8=t=>t.slice(1,-1).indexOf(":")===-1?void 0:(()=>{const e=t.slice(1,-1),r=e.indexOf(":"),i=e.slice(0,r);return i?m8+i:void 0})(),y8=t=>{const{theme:e,classGroups:r}=t;return v8(r,e)},v8=(t,e)=>{const r=ER();for(const i in t){const s=t[i];Xw(s,r,i,e)}return r},Xw=(t,e,r,i)=>{const s=t.length;for(let l=0;l<s;l++){const h=t[l];b8(h,e,r,i)}},b8=(t,e,r,i)=>{if(typeof t=="string"){x8(t,e,r);return}if(typeof t=="function"){w8(t,e,r,i);return}E8(t,e,r,i)},x8=(t,e,r)=>{const i=t===""?e:TR(e,t);i.classGroupId=r},w8=(t,e,r,i)=>{if(A8(t)){Xw(t(i),e,r,i);return}e.validators===null&&(e.validators=[]),e.validators.push(f8(r,t))},E8=(t,e,r,i)=>{const s=Object.entries(t),l=s.length;for(let h=0;h<l;h++){const[a,v]=s[h];Xw(v,TR(e,a),r,i)}},TR=(t,e)=>{let r=t;const i=e.split(D0),s=i.length;for(let l=0;l<s;l++){const h=i[l];let a=r.nextPart.get(h);a||(a=ER(),r.nextPart.set(h,a)),r=a}return r},A8=t=>"isThemeGetter"in t&&t.isThemeGetter===!0,T8=t=>{if(t<1)return{get:()=>{},set:()=>{}};let e=0,r=Object.create(null),i=Object.create(null);const s=(l,h)=>{r[l]=h,e++,e>t&&(e=0,i=r,r=Object.create(null))};return{get(l){let h=r[l];if(h!==void 0)return h;if((h=i[l])!==void 0)return s(l,h),h},set(l,h){l in r?r[l]=h:s(l,h)}}},px="!",I3=":",S8=[],k3=(t,e,r,i,s)=>({modifiers:t,hasImportantModifier:e,baseClassName:r,maybePostfixModifierPosition:i,isExternal:s}),C8=t=>{const{prefix:e,experimentalParseClassName:r}=t;let i=s=>{const l=[];let h=0,a=0,v=0,T;const C=s.length;for(let $=0;$<C;$++){const ne=s[$];if(h===0&&a===0){if(ne===I3){l.push(s.slice(v,$)),v=$+1;continue}if(ne==="/"){T=$;continue}}ne==="["?h++:ne==="]"?h--:ne==="("?a++:ne===")"&&a--}const k=l.length===0?s:s.slice(v);let L=k,O=!1;k.endsWith(px)?(L=k.slice(0,-1),O=!0):k.startsWith(px)&&(L=k.slice(1),O=!0);const K=T&&T>v?T-v:void 0;return k3(l,O,L,K)};if(e){const s=e+I3,l=i;i=h=>h.startsWith(s)?l(h.slice(s.length)):k3(S8,!1,h,void 0,!0)}if(r){const s=i;i=l=>r({className:l,parseClassName:s})}return i},M8=t=>{const e=new Map;return t.orderSensitiveModifiers.forEach((r,i)=>{e.set(r,1e6+i)}),r=>{const i=[];let s=[];for(let l=0;l<r.length;l++){const h=r[l],a=h[0]==="[",v=e.has(h);a||v?(s.length>0&&(s.sort(),i.push(...s),s=[]),i.push(h)):s.push(h)}return s.length>0&&(s.sort(),i.push(...s)),i}},P8=t=>({cache:T8(t.cacheSize),parseClassName:C8(t),sortModifiers:M8(t),...g8(t)}),R8=/\s+/,I8=(t,e)=>{const{parseClassName:r,getClassGroupId:i,getConflictingClassGroupIds:s,sortModifiers:l}=e,h=[],a=t.trim().split(R8);let v="";for(let T=a.length-1;T>=0;T-=1){const C=a[T],{isExternal:k,modifiers:L,hasImportantModifier:O,baseClassName:K,maybePostfixModifierPosition:$}=r(C);if(k){v=C+(v.length>0?" "+v:v);continue}let ne=!!$,oe=i(ne?K.substring(0,$):K);if(!oe){if(!ne){v=C+(v.length>0?" "+v:v);continue}if(oe=i(K),!oe){v=C+(v.length>0?" "+v:v);continue}ne=!1}const fe=L.length===0?"":L.length===1?L[0]:l(L).join(":"),ue=O?fe+px:fe,we=ue+oe;if(h.indexOf(we)>-1)continue;h.push(we);const De=s(oe,ne);for(let Fe=0;Fe<De.length;++Fe){const Ke=De[Fe];h.push(ue+Ke)}v=C+(v.length>0?" "+v:v)}return v},k8=(...t)=>{let e=0,r,i,s="";for(;e<t.length;)(r=t[e++])&&(i=SR(r))&&(s&&(s+=" "),s+=i);return s},SR=t=>{if(typeof t=="string")return t;let e,r="";for(let i=0;i<t.length;i++)t[i]&&(e=SR(t[i]))&&(r&&(r+=" "),r+=e);return r},B8=(t,...e)=>{let r,i,s,l;const h=v=>{const T=e.reduce((C,k)=>k(C),t());return r=P8(T),i=r.cache.get,s=r.cache.set,l=a,a(v)},a=v=>{const T=i(v);if(T)return T;const C=I8(v,r);return s(v,C),C};return l=h,(...v)=>l(k8(...v))},L8=[],_s=t=>{const e=r=>r[t]||L8;return e.isThemeGetter=!0,e},CR=/^\[(?:(\w[\w-]*):)?(.+)\]$/i,MR=/^\((?:(\w[\w-]*):)?(.+)\)$/i,D8=/^\d+\/\d+$/,N8=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,O8=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,F8=/^(rgba?|hsla?|hwb|(ok)?(lab|lch)|color-mix)\(.+\)$/,z8=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,U8=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,If=t=>D8.test(t),zr=t=>!!t&&!Number.isNaN(Number(t)),Wh=t=>!!t&&Number.isInteger(Number(t)),Rv=t=>t.endsWith("%")&&zr(t.slice(0,-1)),Ku=t=>N8.test(t),j8=()=>!0,V8=t=>O8.test(t)&&!F8.test(t),PR=()=>!1,G8=t=>z8.test(t),H8=t=>U8.test(t),W8=t=>!ir(t)&&!nr(t),q8=t=>km(t,kR,PR),ir=t=>CR.test(t),Tp=t=>km(t,BR,V8),Iv=t=>km(t,Y8,zr),B3=t=>km(t,RR,PR),$8=t=>km(t,IR,H8),ky=t=>km(t,LR,G8),nr=t=>MR.test(t),Pg=t=>Bm(t,BR),Z8=t=>Bm(t,J8),L3=t=>Bm(t,RR),X8=t=>Bm(t,kR),K8=t=>Bm(t,IR),By=t=>Bm(t,LR,!0),km=(t,e,r)=>{const i=CR.exec(t);return i?i[1]?e(i[1]):r(i[2]):!1},Bm=(t,e,r=!1)=>{const i=MR.exec(t);return i?i[1]?e(i[1]):r:!1},RR=t=>t==="position"||t==="percentage",IR=t=>t==="image"||t==="url",kR=t=>t==="length"||t==="size"||t==="bg-size",BR=t=>t==="length",Y8=t=>t==="number",J8=t=>t==="family-name",LR=t=>t==="shadow",Q8=()=>{const t=_s("color"),e=_s("font"),r=_s("text"),i=_s("font-weight"),s=_s("tracking"),l=_s("leading"),h=_s("breakpoint"),a=_s("container"),v=_s("spacing"),T=_s("radius"),C=_s("shadow"),k=_s("inset-shadow"),L=_s("text-shadow"),O=_s("drop-shadow"),K=_s("blur"),$=_s("perspective"),ne=_s("aspect"),oe=_s("ease"),fe=_s("animate"),ue=()=>["auto","avoid","all","avoid-page","page","left","right","column"],we=()=>["center","top","bottom","left","right","top-left","left-top","top-right","right-top","bottom-right","right-bottom","bottom-left","left-bottom"],De=()=>[...we(),nr,ir],Fe=()=>["auto","hidden","clip","visible","scroll"],Ke=()=>["auto","contain","none"],ze=()=>[nr,ir,v],it=()=>[If,"full","auto",...ze()],lt=()=>[Wh,"none","subgrid",nr,ir],ht=()=>["auto",{span:["full",Wh,nr,ir]},Wh,nr,ir],vt=()=>[Wh,"auto",nr,ir],Nt=()=>["auto","min","max","fr",nr,ir],Lt=()=>["start","end","center","between","around","evenly","stretch","baseline","center-safe","end-safe"],qt=()=>["start","end","center","stretch","center-safe","end-safe"],Qt=()=>["auto",...ze()],Ot=()=>[If,"auto","full","dvw","dvh","lvw","lvh","svw","svh","min","max","fit",...ze()],tt=()=>[t,nr,ir],wt=()=>[...we(),L3,B3,{position:[nr,ir]}],Bt=()=>["no-repeat",{repeat:["","x","y","space","round"]}],Ue=()=>["auto","cover","contain",X8,q8,{size:[nr,ir]}],dt=()=>[Rv,Pg,Tp],Gt=()=>["","none","full",T,nr,ir],Jt=()=>["",zr,Pg,Tp],Tr=()=>["solid","dashed","dotted","double"],gr=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],Ht=()=>[zr,Rv,L3,B3],dr=()=>["","none",K,nr,ir],er=()=>["none",zr,nr,ir],Lr=()=>["none",zr,nr,ir],yn=()=>[zr,nr,ir],yi=()=>[If,"full",...ze()];return{cacheSize:500,theme:{animate:["spin","ping","pulse","bounce"],aspect:["video"],blur:[Ku],breakpoint:[Ku],color:[j8],container:[Ku],"drop-shadow":[Ku],ease:["in","out","in-out"],font:[W8],"font-weight":["thin","extralight","light","normal","medium","semibold","bold","extrabold","black"],"inset-shadow":[Ku],leading:["none","tight","snug","normal","relaxed","loose"],perspective:["dramatic","near","normal","midrange","distant","none"],radius:[Ku],shadow:[Ku],spacing:["px",zr],text:[Ku],"text-shadow":[Ku],tracking:["tighter","tight","normal","wide","wider","widest"]},classGroups:{aspect:[{aspect:["auto","square",If,ir,nr,ne]}],container:["container"],columns:[{columns:[zr,ir,nr,a]}],"break-after":[{"break-after":ue()}],"break-before":[{"break-before":ue()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],sr:["sr-only","not-sr-only"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:De()}],overflow:[{overflow:Fe()}],"overflow-x":[{"overflow-x":Fe()}],"overflow-y":[{"overflow-y":Fe()}],overscroll:[{overscroll:Ke()}],"overscroll-x":[{"overscroll-x":Ke()}],"overscroll-y":[{"overscroll-y":Ke()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:it()}],"inset-x":[{"inset-x":it()}],"inset-y":[{"inset-y":it()}],start:[{start:it()}],end:[{end:it()}],top:[{top:it()}],right:[{right:it()}],bottom:[{bottom:it()}],left:[{left:it()}],visibility:["visible","invisible","collapse"],z:[{z:[Wh,"auto",nr,ir]}],basis:[{basis:[If,"full","auto",a,...ze()]}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["nowrap","wrap","wrap-reverse"]}],flex:[{flex:[zr,If,"auto","initial","none",ir]}],grow:[{grow:["",zr,nr,ir]}],shrink:[{shrink:["",zr,nr,ir]}],order:[{order:[Wh,"first","last","none",nr,ir]}],"grid-cols":[{"grid-cols":lt()}],"col-start-end":[{col:ht()}],"col-start":[{"col-start":vt()}],"col-end":[{"col-end":vt()}],"grid-rows":[{"grid-rows":lt()}],"row-start-end":[{row:ht()}],"row-start":[{"row-start":vt()}],"row-end":[{"row-end":vt()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":Nt()}],"auto-rows":[{"auto-rows":Nt()}],gap:[{gap:ze()}],"gap-x":[{"gap-x":ze()}],"gap-y":[{"gap-y":ze()}],"justify-content":[{justify:[...Lt(),"normal"]}],"justify-items":[{"justify-items":[...qt(),"normal"]}],"justify-self":[{"justify-self":["auto",...qt()]}],"align-content":[{content:["normal",...Lt()]}],"align-items":[{items:[...qt(),{baseline:["","last"]}]}],"align-self":[{self:["auto",...qt(),{baseline:["","last"]}]}],"place-content":[{"place-content":Lt()}],"place-items":[{"place-items":[...qt(),"baseline"]}],"place-self":[{"place-self":["auto",...qt()]}],p:[{p:ze()}],px:[{px:ze()}],py:[{py:ze()}],ps:[{ps:ze()}],pe:[{pe:ze()}],pt:[{pt:ze()}],pr:[{pr:ze()}],pb:[{pb:ze()}],pl:[{pl:ze()}],m:[{m:Qt()}],mx:[{mx:Qt()}],my:[{my:Qt()}],ms:[{ms:Qt()}],me:[{me:Qt()}],mt:[{mt:Qt()}],mr:[{mr:Qt()}],mb:[{mb:Qt()}],ml:[{ml:Qt()}],"space-x":[{"space-x":ze()}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":ze()}],"space-y-reverse":["space-y-reverse"],size:[{size:Ot()}],w:[{w:[a,"screen",...Ot()]}],"min-w":[{"min-w":[a,"screen","none",...Ot()]}],"max-w":[{"max-w":[a,"screen","none","prose",{screen:[h]},...Ot()]}],h:[{h:["screen","lh",...Ot()]}],"min-h":[{"min-h":["screen","lh","none",...Ot()]}],"max-h":[{"max-h":["screen","lh",...Ot()]}],"font-size":[{text:["base",r,Pg,Tp]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:[i,nr,Iv]}],"font-stretch":[{"font-stretch":["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded",Rv,ir]}],"font-family":[{font:[Z8,ir,e]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:[s,nr,ir]}],"line-clamp":[{"line-clamp":[zr,"none",nr,Iv]}],leading:[{leading:[l,...ze()]}],"list-image":[{"list-image":["none",nr,ir]}],"list-style-position":[{list:["inside","outside"]}],"list-style-type":[{list:["disc","decimal","none",nr,ir]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"placeholder-color":[{placeholder:tt()}],"text-color":[{text:tt()}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...Tr(),"wavy"]}],"text-decoration-thickness":[{decoration:[zr,"from-font","auto",nr,Tp]}],"text-decoration-color":[{decoration:tt()}],"underline-offset":[{"underline-offset":[zr,"auto",nr,ir]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:ze()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",nr,ir]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],wrap:[{wrap:["break-word","anywhere","normal"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",nr,ir]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:wt()}],"bg-repeat":[{bg:Bt()}],"bg-size":[{bg:Ue()}],"bg-image":[{bg:["none",{linear:[{to:["t","tr","r","br","b","bl","l","tl"]},Wh,nr,ir],radial:["",nr,ir],conic:[Wh,nr,ir]},K8,$8]}],"bg-color":[{bg:tt()}],"gradient-from-pos":[{from:dt()}],"gradient-via-pos":[{via:dt()}],"gradient-to-pos":[{to:dt()}],"gradient-from":[{from:tt()}],"gradient-via":[{via:tt()}],"gradient-to":[{to:tt()}],rounded:[{rounded:Gt()}],"rounded-s":[{"rounded-s":Gt()}],"rounded-e":[{"rounded-e":Gt()}],"rounded-t":[{"rounded-t":Gt()}],"rounded-r":[{"rounded-r":Gt()}],"rounded-b":[{"rounded-b":Gt()}],"rounded-l":[{"rounded-l":Gt()}],"rounded-ss":[{"rounded-ss":Gt()}],"rounded-se":[{"rounded-se":Gt()}],"rounded-ee":[{"rounded-ee":Gt()}],"rounded-es":[{"rounded-es":Gt()}],"rounded-tl":[{"rounded-tl":Gt()}],"rounded-tr":[{"rounded-tr":Gt()}],"rounded-br":[{"rounded-br":Gt()}],"rounded-bl":[{"rounded-bl":Gt()}],"border-w":[{border:Jt()}],"border-w-x":[{"border-x":Jt()}],"border-w-y":[{"border-y":Jt()}],"border-w-s":[{"border-s":Jt()}],"border-w-e":[{"border-e":Jt()}],"border-w-t":[{"border-t":Jt()}],"border-w-r":[{"border-r":Jt()}],"border-w-b":[{"border-b":Jt()}],"border-w-l":[{"border-l":Jt()}],"divide-x":[{"divide-x":Jt()}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":Jt()}],"divide-y-reverse":["divide-y-reverse"],"border-style":[{border:[...Tr(),"hidden","none"]}],"divide-style":[{divide:[...Tr(),"hidden","none"]}],"border-color":[{border:tt()}],"border-color-x":[{"border-x":tt()}],"border-color-y":[{"border-y":tt()}],"border-color-s":[{"border-s":tt()}],"border-color-e":[{"border-e":tt()}],"border-color-t":[{"border-t":tt()}],"border-color-r":[{"border-r":tt()}],"border-color-b":[{"border-b":tt()}],"border-color-l":[{"border-l":tt()}],"divide-color":[{divide:tt()}],"outline-style":[{outline:[...Tr(),"none","hidden"]}],"outline-offset":[{"outline-offset":[zr,nr,ir]}],"outline-w":[{outline:["",zr,Pg,Tp]}],"outline-color":[{outline:tt()}],shadow:[{shadow:["","none",C,By,ky]}],"shadow-color":[{shadow:tt()}],"inset-shadow":[{"inset-shadow":["none",k,By,ky]}],"inset-shadow-color":[{"inset-shadow":tt()}],"ring-w":[{ring:Jt()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:tt()}],"ring-offset-w":[{"ring-offset":[zr,Tp]}],"ring-offset-color":[{"ring-offset":tt()}],"inset-ring-w":[{"inset-ring":Jt()}],"inset-ring-color":[{"inset-ring":tt()}],"text-shadow":[{"text-shadow":["none",L,By,ky]}],"text-shadow-color":[{"text-shadow":tt()}],opacity:[{opacity:[zr,nr,ir]}],"mix-blend":[{"mix-blend":[...gr(),"plus-darker","plus-lighter"]}],"bg-blend":[{"bg-blend":gr()}],"mask-clip":[{"mask-clip":["border","padding","content","fill","stroke","view"]},"mask-no-clip"],"mask-composite":[{mask:["add","subtract","intersect","exclude"]}],"mask-image-linear-pos":[{"mask-linear":[zr]}],"mask-image-linear-from-pos":[{"mask-linear-from":Ht()}],"mask-image-linear-to-pos":[{"mask-linear-to":Ht()}],"mask-image-linear-from-color":[{"mask-linear-from":tt()}],"mask-image-linear-to-color":[{"mask-linear-to":tt()}],"mask-image-t-from-pos":[{"mask-t-from":Ht()}],"mask-image-t-to-pos":[{"mask-t-to":Ht()}],"mask-image-t-from-color":[{"mask-t-from":tt()}],"mask-image-t-to-color":[{"mask-t-to":tt()}],"mask-image-r-from-pos":[{"mask-r-from":Ht()}],"mask-image-r-to-pos":[{"mask-r-to":Ht()}],"mask-image-r-from-color":[{"mask-r-from":tt()}],"mask-image-r-to-color":[{"mask-r-to":tt()}],"mask-image-b-from-pos":[{"mask-b-from":Ht()}],"mask-image-b-to-pos":[{"mask-b-to":Ht()}],"mask-image-b-from-color":[{"mask-b-from":tt()}],"mask-image-b-to-color":[{"mask-b-to":tt()}],"mask-image-l-from-pos":[{"mask-l-from":Ht()}],"mask-image-l-to-pos":[{"mask-l-to":Ht()}],"mask-image-l-from-color":[{"mask-l-from":tt()}],"mask-image-l-to-color":[{"mask-l-to":tt()}],"mask-image-x-from-pos":[{"mask-x-from":Ht()}],"mask-image-x-to-pos":[{"mask-x-to":Ht()}],"mask-image-x-from-color":[{"mask-x-from":tt()}],"mask-image-x-to-color":[{"mask-x-to":tt()}],"mask-image-y-from-pos":[{"mask-y-from":Ht()}],"mask-image-y-to-pos":[{"mask-y-to":Ht()}],"mask-image-y-from-color":[{"mask-y-from":tt()}],"mask-image-y-to-color":[{"mask-y-to":tt()}],"mask-image-radial":[{"mask-radial":[nr,ir]}],"mask-image-radial-from-pos":[{"mask-radial-from":Ht()}],"mask-image-radial-to-pos":[{"mask-radial-to":Ht()}],"mask-image-radial-from-color":[{"mask-radial-from":tt()}],"mask-image-radial-to-color":[{"mask-radial-to":tt()}],"mask-image-radial-shape":[{"mask-radial":["circle","ellipse"]}],"mask-image-radial-size":[{"mask-radial":[{closest:["side","corner"],farthest:["side","corner"]}]}],"mask-image-radial-pos":[{"mask-radial-at":we()}],"mask-image-conic-pos":[{"mask-conic":[zr]}],"mask-image-conic-from-pos":[{"mask-conic-from":Ht()}],"mask-image-conic-to-pos":[{"mask-conic-to":Ht()}],"mask-image-conic-from-color":[{"mask-conic-from":tt()}],"mask-image-conic-to-color":[{"mask-conic-to":tt()}],"mask-mode":[{mask:["alpha","luminance","match"]}],"mask-origin":[{"mask-origin":["border","padding","content","fill","stroke","view"]}],"mask-position":[{mask:wt()}],"mask-repeat":[{mask:Bt()}],"mask-size":[{mask:Ue()}],"mask-type":[{"mask-type":["alpha","luminance"]}],"mask-image":[{mask:["none",nr,ir]}],filter:[{filter:["","none",nr,ir]}],blur:[{blur:dr()}],brightness:[{brightness:[zr,nr,ir]}],contrast:[{contrast:[zr,nr,ir]}],"drop-shadow":[{"drop-shadow":["","none",O,By,ky]}],"drop-shadow-color":[{"drop-shadow":tt()}],grayscale:[{grayscale:["",zr,nr,ir]}],"hue-rotate":[{"hue-rotate":[zr,nr,ir]}],invert:[{invert:["",zr,nr,ir]}],saturate:[{saturate:[zr,nr,ir]}],sepia:[{sepia:["",zr,nr,ir]}],"backdrop-filter":[{"backdrop-filter":["","none",nr,ir]}],"backdrop-blur":[{"backdrop-blur":dr()}],"backdrop-brightness":[{"backdrop-brightness":[zr,nr,ir]}],"backdrop-contrast":[{"backdrop-contrast":[zr,nr,ir]}],"backdrop-grayscale":[{"backdrop-grayscale":["",zr,nr,ir]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[zr,nr,ir]}],"backdrop-invert":[{"backdrop-invert":["",zr,nr,ir]}],"backdrop-opacity":[{"backdrop-opacity":[zr,nr,ir]}],"backdrop-saturate":[{"backdrop-saturate":[zr,nr,ir]}],"backdrop-sepia":[{"backdrop-sepia":["",zr,nr,ir]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":ze()}],"border-spacing-x":[{"border-spacing-x":ze()}],"border-spacing-y":[{"border-spacing-y":ze()}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["","all","colors","opacity","shadow","transform","none",nr,ir]}],"transition-behavior":[{transition:["normal","discrete"]}],duration:[{duration:[zr,"initial",nr,ir]}],ease:[{ease:["linear","initial",oe,nr,ir]}],delay:[{delay:[zr,nr,ir]}],animate:[{animate:["none",fe,nr,ir]}],backface:[{backface:["hidden","visible"]}],perspective:[{perspective:[$,nr,ir]}],"perspective-origin":[{"perspective-origin":De()}],rotate:[{rotate:er()}],"rotate-x":[{"rotate-x":er()}],"rotate-y":[{"rotate-y":er()}],"rotate-z":[{"rotate-z":er()}],scale:[{scale:Lr()}],"scale-x":[{"scale-x":Lr()}],"scale-y":[{"scale-y":Lr()}],"scale-z":[{"scale-z":Lr()}],"scale-3d":["scale-3d"],skew:[{skew:yn()}],"skew-x":[{"skew-x":yn()}],"skew-y":[{"skew-y":yn()}],transform:[{transform:[nr,ir,"","none","gpu","cpu"]}],"transform-origin":[{origin:De()}],"transform-style":[{transform:["3d","flat"]}],translate:[{translate:yi()}],"translate-x":[{"translate-x":yi()}],"translate-y":[{"translate-y":yi()}],"translate-z":[{"translate-z":yi()}],"translate-none":["translate-none"],accent:[{accent:tt()}],appearance:[{appearance:["none","auto"]}],"caret-color":[{caret:tt()}],"color-scheme":[{scheme:["normal","dark","light","light-dark","only-dark","only-light"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",nr,ir]}],"field-sizing":[{"field-sizing":["fixed","content"]}],"pointer-events":[{"pointer-events":["auto","none"]}],resize:[{resize:["none","","y","x"]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":ze()}],"scroll-mx":[{"scroll-mx":ze()}],"scroll-my":[{"scroll-my":ze()}],"scroll-ms":[{"scroll-ms":ze()}],"scroll-me":[{"scroll-me":ze()}],"scroll-mt":[{"scroll-mt":ze()}],"scroll-mr":[{"scroll-mr":ze()}],"scroll-mb":[{"scroll-mb":ze()}],"scroll-ml":[{"scroll-ml":ze()}],"scroll-p":[{"scroll-p":ze()}],"scroll-px":[{"scroll-px":ze()}],"scroll-py":[{"scroll-py":ze()}],"scroll-ps":[{"scroll-ps":ze()}],"scroll-pe":[{"scroll-pe":ze()}],"scroll-pt":[{"scroll-pt":ze()}],"scroll-pr":[{"scroll-pr":ze()}],"scroll-pb":[{"scroll-pb":ze()}],"scroll-pl":[{"scroll-pl":ze()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",nr,ir]}],fill:[{fill:["none",...tt()]}],"stroke-w":[{stroke:[zr,Pg,Tp,Iv]}],stroke:[{stroke:["none",...tt()]}],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-x","border-w-y","border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-x","border-color-y","border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],translate:["translate-x","translate-y","translate-none"],"translate-none":["translate","translate-x","translate-y","translate-z"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]},orderSensitiveModifiers:["*","**","after","backdrop","before","details-content","file","first-letter","first-line","marker","placeholder","selection"]}},e9=B8(Q8);function Vi(...t){return e9(wR(t))}function t9({className:t,...e}){return H.jsx(c8,{"data-slot":"tabs",className:Vi("flex flex-col gap-2",t),...e})}function r9({className:t,...e}){return H.jsx(u8,{"data-slot":"tabs-list",className:Vi("bg-muted text-muted-foreground inline-flex h-9 w-fit items-center justify-center rounded-xl p-[3px] flex",t),...e})}function Rg({className:t,...e}){return H.jsx(h8,{"data-slot":"tabs-trigger",className:Vi("data-[state=active]:bg-card dark:data-[state=active]:text-foreground focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:outline-ring dark:data-[state=active]:border-input dark:data-[state=active]:bg-input/30 text-foreground dark:text-muted-foreground inline-flex h-[calc(100%-1px)] flex-1 items-center justify-center gap-1.5 rounded-xl border border-transparent px-2 py-1 text-sm font-medium whitespace-nowrap transition-[color,box-shadow] focus-visible:ring-[3px] focus-visible:outline-1 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",t),...e})}function Ig({className:t,...e}){return H.jsx(d8,{"data-slot":"tabs-content",className:Vi("flex-1 outline-none",t),...e})}var i9=Symbol.for("react.lazy"),N0=uw[" use ".trim().toString()];function n9(t){return typeof t=="object"&&t!==null&&"then"in t}function DR(t){return t!=null&&typeof t=="object"&&"$$typeof"in t&&t.$$typeof===i9&&"_payload"in t&&n9(t._payload)}function Kw(t){const e=s9(t),r=te.forwardRef((i,s)=>{let{children:l,...h}=i;DR(l)&&typeof N0=="function"&&(l=N0(l._payload));const a=te.Children.toArray(l),v=a.find(a9);if(v){const T=v.props.children,C=a.map(k=>k===v?te.Children.count(T)>1?te.Children.only(null):te.isValidElement(T)?T.props.children:null:k);return H.jsx(e,{...h,ref:s,children:te.isValidElement(T)?te.cloneElement(T,void 0,C):null})}return H.jsx(e,{...h,ref:s,children:l})});return r.displayName=`${t}.Slot`,r}var NR=Kw("Slot");function s9(t){const e=te.forwardRef((r,i)=>{let{children:s,...l}=r;if(DR(s)&&typeof N0=="function"&&(s=N0(s._payload)),te.isValidElement(s)){const h=c9(s),a=l9(l,s.props);return s.type!==te.Fragment&&(a.ref=i?I_(i,h):h),te.cloneElement(s,a)}return te.Children.count(s)>1?te.Children.only(null):null});return e.displayName=`${t}.SlotClone`,e}var o9=Symbol("radix.slottable");function a9(t){return te.isValidElement(t)&&typeof t.type=="function"&&"__radixId"in t.type&&t.type.__radixId===o9}function l9(t,e){const r={...e};for(const i in e){const s=t[i],l=e[i];/^on[A-Z]/.test(i)?s&&l?r[i]=(...a)=>{const v=l(...a);return s(...a),v}:s&&(r[i]=s):i==="style"?r[i]={...s,...l}:i==="className"&&(r[i]=[s,l].filter(Boolean).join(" "))}return{...t,...r}}function c9(t){let e=Object.getOwnPropertyDescriptor(t.props,"ref")?.get,r=e&&"isReactWarning"in e&&e.isReactWarning;return r?t.ref:(e=Object.getOwnPropertyDescriptor(t,"ref")?.get,r=e&&"isReactWarning"in e&&e.isReactWarning,r?t.props.ref:t.props.ref||t.ref)}const D3=t=>typeof t=="boolean"?`${t}`:t===0?"0":t,N3=wR,OR=(t,e)=>r=>{var i;if(e?.variants==null)return N3(t,r?.class,r?.className);const{variants:s,defaultVariants:l}=e,h=Object.keys(s).map(T=>{const C=r?.[T],k=l?.[T];if(C===null)return null;const L=D3(C)||D3(k);return s[T][L]}),a=r&&Object.entries(r).reduce((T,C)=>{let[k,L]=C;return L===void 0||(T[k]=L),T},{}),v=e==null||(i=e.compoundVariants)===null||i===void 0?void 0:i.reduce((T,C)=>{let{class:k,className:L,...O}=C;return Object.entries(O).every(K=>{let[$,ne]=K;return Array.isArray(ne)?ne.includes({...l,...a}[$]):{...l,...a}[$]===ne})?[...T,k,L]:T},[]);return N3(t,h,v,r?.class,r?.className)},u9=OR("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all duration-300 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:scale-[1.02] active:scale-[0.98]",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90 hover:shadow-[0_0_20px_rgba(120,119,198,0.4)]",destructive:"bg-destructive text-white hover:bg-destructive/90 hover:shadow-[0_0_20px_rgba(239,68,68,0.4)] focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background text-foreground hover:bg-accent hover:text-accent-foreground hover:border-white/20 dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9 rounded-md"}},defaultVariants:{variant:"default",size:"default"}});function lc({className:t,variant:e,size:r,asChild:i=!1,...s}){const l=i?NR:"button";return H.jsx(l,{"data-slot":"button",className:Vi(u9({variant:e,size:r,className:t})),...s})}function v0({className:t,type:e,...r}){return H.jsx("input",{type:e,"data-slot":"input",className:Vi("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border px-3 py-1 text-base bg-input-background transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",t),...r})}const O0=[{id:"1",title:"Rooftop Sunset Party",startTime:"6:30 PM",location:{lat:28.5355,lng:77.391,name:"Hauz Khas Village"},imageUrl:"https://images.unsplash.com/photo-1696863121919-cf7fa0331d31?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxoYXV6JTIwa2hhcyUyMGRlbGhpfGVufDF8fHx8MTc2MzQ2NDcxOXww&ixlib=rb-4.1.0&q=80&w=1080",host:{name:"Arjun Malhotra",avatar:"https://images.unsplash.com/photo-1667382136327-5f78dc5cf835?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxpbmRpYW4lMjBtYW4lMjBwb3J0cmFpdHxlbnwxfHx8fDE3NjMzNzA5NzN8MA&ixlib=rb-4.1.0&q=80&w=1080",instagram:"@arjunmalhotra"},attendees:24,mood:"Energetic",description:"Join us for an amazing rooftop party with live DJ and Delhi skyline views!"},{id:"2",title:"Coffee & Conversations",startTime:"10:00 AM",location:{lat:28.6315,lng:77.2167,name:"Khan Market"},imageUrl:"https://images.unsplash.com/photo-1549407978-23788293b970?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxjb2ZmZWUlMjBzaG9wJTIwY296eXxlbnwxfHx8fDE3NjMzNjcyNjF8MA&ixlib=rb-4.1.0&q=80&w=1080",host:{name:"Priya Sharma",avatar:"https://images.unsplash.com/photo-1691966929688-72d734848bcd?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxpbmRpYW4lMjB3b21hbiUyMHByb2ZpbGV8ZW58MXx8fHwxNzYzNDY0NzE4fDA&ixlib=rb-4.1.0&q=80&w=1080",instagram:"@priyasharma"},attendees:8,mood:"Chill",description:"Casual coffee meetup for entrepreneurs and creatives at Khan Market"},{id:"3",title:"Art Gallery Opening",startTime:"7:00 PM",location:{lat:28.6289,lng:77.2065,name:"Connaught Place"},imageUrl:"https://images.unsplash.com/photo-1722165923691-dc77d229a31a?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxjb25uYXVnaHQlMjBwbGFjZSUyMGRlbGhpfGVufDF8fHx8MTc2MzQ2NDcxOXww&ixlib=rb-4.1.0&q=80&w=1080",host:{name:"Kavya Reddy",avatar:"https://images.unsplash.com/photo-1691966929688-72d734848bcd?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxpbmRpYW4lMjB3b21hbiUyMHByb2ZpbGV8ZW58MXx8fHwxNzYzNDY0NzE4fDA&ixlib=rb-4.1.0&q=80&w=1080",instagram:"@kavyareddy"},attendees:32,mood:"Creative",description:"Contemporary art exhibition at CP with wine and light bites"},{id:"4",title:"Candlelit Dinner Experience",startTime:"8:00 PM",location:{lat:28.5244,lng:77.1855,name:"Garden of Five Senses"},imageUrl:"https://images.unsplash.com/photo-1760669348865-75d0e9733604?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxzdW5zZXQlMjBkaW5uZXIlMjByb21hbnRpY3xlbnwxfHx8fDE3NjM0MTI5MTB8MA&ixlib=rb-4.1.0&q=80&w=1080",host:{name:"Rohan Kapoor",avatar:"https://images.unsplash.com/photo-1667382136327-5f78dc5cf835?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxpbmRpYW4lMjBtYW4lMjBwb3J0cmFpdHxlbnwxfHx8fDE3NjMzNzA5NzN8MA&ixlib=rb-4.1.0&q=80&w=1080",instagram:"@rohankapoor"},attendees:12,mood:"Romantic",description:"Intimate dinner gathering with sunset views at Garden of Five Senses"},{id:"5",title:"India Gate Morning Yoga",startTime:"6:30 AM",location:{lat:28.6129,lng:77.2295,name:"India Gate"},imageUrl:"https://images.unsplash.com/photo-1688781298681-ae1f2d470b31?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxpbmRpYSUyMGdhdGUlMjBkZWxoaXxlbnwxfHx8fDE3NjM0NDY0MDd8MA&ixlib=rb-4.1.0&q=80&w=1080",host:{name:"Ananya Singh",avatar:"https://images.unsplash.com/photo-1691966929688-72d734848bcd?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxpbmRpYW4lMjB3b21hbiUyMHByb2ZpbGV8ZW58MXx8fHwxNzYzNDY0NzE4fDA&ixlib=rb-4.1.0&q=80&w=1080",instagram:"@ananyasingh"},attendees:28,mood:"Chill",description:"Start your day with meditation and yoga at India Gate lawns"},{id:"6",title:"Qutub Minar Heritage Walk",startTime:"5:00 PM",location:{lat:28.5244,lng:77.1855,name:"Qutub Minar"},imageUrl:"https://images.unsplash.com/photo-1667849521212-e9843b89f322?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxxdXR1YiUyMG1pbmFyJTIwZGVsaGl8ZW58MXx8fHwxNzYzNDYzNjcxfDA&ixlib=rb-4.1.0&q=80&w=1080",host:{name:"Vikram Mehta",avatar:"https://images.unsplash.com/photo-1667382136327-5f78dc5cf835?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxpbmRpYW4lMjBtYW4lMjBwb3J0cmFpdHxlbnwxfHx8fDE3NjMzNzA5NzN8MA&ixlib=rb-4.1.0&q=80&w=1080",instagram:"@vikrammehta"},attendees:16,mood:"Creative",description:"Explore Delhi's heritage with a guided walk around Qutub Minar complex"}];function Yw(t,[e,r]){return Math.min(r,Math.max(e,t))}function h9(t){const e=te.useRef({value:t,previous:t});return te.useMemo(()=>(e.current.value!==t&&(e.current.previous=e.current.value,e.current.value=t),e.current.previous),[t])}function d9(t){const[e,r]=te.useState(void 0);return cu(()=>{if(t){r({width:t.offsetWidth,height:t.offsetHeight});const i=new ResizeObserver(s=>{if(!Array.isArray(s)||!s.length)return;const l=s[0];let h,a;if("borderBoxSize"in l){const v=l.borderBoxSize,T=Array.isArray(v)?v[0]:v;h=T.inlineSize,a=T.blockSize}else h=t.offsetWidth,a=t.offsetHeight;r({width:h,height:a})});return i.observe(t,{box:"border-box"}),()=>i.unobserve(t)}else r(void 0)},[t]),e}var FR=["PageUp","PageDown"],zR=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],UR={"from-left":["Home","PageDown","ArrowDown","ArrowLeft"],"from-right":["Home","PageDown","ArrowDown","ArrowRight"],"from-bottom":["Home","PageDown","ArrowDown","ArrowLeft"],"from-top":["Home","PageDown","ArrowUp","ArrowLeft"]},Lm="Slider",[fx,p9,f9]=iR(Lm),[jR]=Im(Lm,[f9]),[m9,m1]=jR(Lm),VR=te.forwardRef((t,e)=>{const{name:r,min:i=0,max:s=100,step:l=1,orientation:h="horizontal",disabled:a=!1,minStepsBetweenThumbs:v=0,defaultValue:T=[i],value:C,onValueChange:k=()=>{},onValueCommit:L=()=>{},inverted:O=!1,form:K,...$}=t,ne=te.useRef(new Set),oe=te.useRef(0),ue=h==="horizontal"?g9:_9,[we=[],De]=d1({prop:C,defaultProp:T,onChange:ht=>{[...ne.current][oe.current]?.focus(),k(ht)}}),Fe=te.useRef(we);function Ke(ht){const vt=w9(we,ht);lt(ht,vt)}function ze(ht){lt(ht,oe.current)}function it(){const ht=Fe.current[oe.current];we[oe.current]!==ht&&L(we)}function lt(ht,vt,{commit:Nt}={commit:!1}){const Lt=S9(l),qt=C9(Math.round((ht-i)/l)*l+i,Lt),Qt=Yw(qt,[i,s]);De((Ot=[])=>{const tt=b9(Ot,Qt,vt);if(T9(tt,v*l)){oe.current=tt.indexOf(Qt);const wt=String(tt)!==String(Ot);return wt&&Nt&&L(tt),wt?tt:Ot}else return Ot})}return H.jsx(m9,{scope:t.__scopeSlider,name:r,disabled:a,min:i,max:s,valueIndexToChangeRef:oe,thumbs:ne.current,values:we,orientation:h,form:K,children:H.jsx(fx.Provider,{scope:t.__scopeSlider,children:H.jsx(fx.Slot,{scope:t.__scopeSlider,children:H.jsx(ue,{"aria-disabled":a,"data-disabled":a?"":void 0,...$,ref:e,onPointerDown:_i($.onPointerDown,()=>{a||(Fe.current=we)}),min:i,max:s,inverted:O,onSlideStart:a?void 0:Ke,onSlideMove:a?void 0:ze,onSlideEnd:a?void 0:it,onHomeKeyDown:()=>!a&&lt(i,0,{commit:!0}),onEndKeyDown:()=>!a&&lt(s,we.length-1,{commit:!0}),onStepKeyDown:({event:ht,direction:vt})=>{if(!a){const qt=FR.includes(ht.key)||ht.shiftKey&&zR.includes(ht.key)?10:1,Qt=oe.current,Ot=we[Qt],tt=l*qt*vt;lt(Ot+tt,Qt,{commit:!0})}}})})})})});VR.displayName=Lm;var[GR,HR]=jR(Lm,{startEdge:"left",endEdge:"right",size:"width",direction:1}),g9=te.forwardRef((t,e)=>{const{min:r,max:i,dir:s,inverted:l,onSlideStart:h,onSlideMove:a,onSlideEnd:v,onStepKeyDown:T,...C}=t,[k,L]=te.useState(null),O=Cn(e,ue=>L(ue)),K=te.useRef(void 0),$=p1(s),ne=$==="ltr",oe=ne&&!l||!ne&&l;function fe(ue){const we=K.current||k.getBoundingClientRect(),De=[0,we.width],Ke=Jw(De,oe?[r,i]:[i,r]);return K.current=we,Ke(ue-we.left)}return H.jsx(GR,{scope:t.__scopeSlider,startEdge:oe?"left":"right",endEdge:oe?"right":"left",direction:oe?1:-1,size:"width",children:H.jsx(WR,{dir:$,"data-orientation":"horizontal",...C,ref:O,style:{...C.style,"--radix-slider-thumb-transform":"translateX(-50%)"},onSlideStart:ue=>{const we=fe(ue.clientX);h?.(we)},onSlideMove:ue=>{const we=fe(ue.clientX);a?.(we)},onSlideEnd:()=>{K.current=void 0,v?.()},onStepKeyDown:ue=>{const De=UR[oe?"from-left":"from-right"].includes(ue.key);T?.({event:ue,direction:De?-1:1})}})})}),_9=te.forwardRef((t,e)=>{const{min:r,max:i,inverted:s,onSlideStart:l,onSlideMove:h,onSlideEnd:a,onStepKeyDown:v,...T}=t,C=te.useRef(null),k=Cn(e,C),L=te.useRef(void 0),O=!s;function K($){const ne=L.current||C.current.getBoundingClientRect(),oe=[0,ne.height],ue=Jw(oe,O?[i,r]:[r,i]);return L.current=ne,ue($-ne.top)}return H.jsx(GR,{scope:t.__scopeSlider,startEdge:O?"bottom":"top",endEdge:O?"top":"bottom",size:"height",direction:O?1:-1,children:H.jsx(WR,{"data-orientation":"vertical",...T,ref:k,style:{...T.style,"--radix-slider-thumb-transform":"translateY(50%)"},onSlideStart:$=>{const ne=K($.clientY);l?.(ne)},onSlideMove:$=>{const ne=K($.clientY);h?.(ne)},onSlideEnd:()=>{L.current=void 0,a?.()},onStepKeyDown:$=>{const oe=UR[O?"from-bottom":"from-top"].includes($.key);v?.({event:$,direction:oe?-1:1})}})})}),WR=te.forwardRef((t,e)=>{const{__scopeSlider:r,onSlideStart:i,onSlideMove:s,onSlideEnd:l,onHomeKeyDown:h,onEndKeyDown:a,onStepKeyDown:v,...T}=t,C=m1(Lm,r);return H.jsx(Qi.span,{...T,ref:e,onKeyDown:_i(t.onKeyDown,k=>{k.key==="Home"?(h(k),k.preventDefault()):k.key==="End"?(a(k),k.preventDefault()):FR.concat(zR).includes(k.key)&&(v(k),k.preventDefault())}),onPointerDown:_i(t.onPointerDown,k=>{const L=k.target;L.setPointerCapture(k.pointerId),k.preventDefault(),C.thumbs.has(L)?L.focus():i(k)}),onPointerMove:_i(t.onPointerMove,k=>{k.target.hasPointerCapture(k.pointerId)&&s(k)}),onPointerUp:_i(t.onPointerUp,k=>{const L=k.target;L.hasPointerCapture(k.pointerId)&&(L.releasePointerCapture(k.pointerId),l(k))})})}),qR="SliderTrack",$R=te.forwardRef((t,e)=>{const{__scopeSlider:r,...i}=t,s=m1(qR,r);return H.jsx(Qi.span,{"data-disabled":s.disabled?"":void 0,"data-orientation":s.orientation,...i,ref:e})});$R.displayName=qR;var mx="SliderRange",ZR=te.forwardRef((t,e)=>{const{__scopeSlider:r,...i}=t,s=m1(mx,r),l=HR(mx,r),h=te.useRef(null),a=Cn(e,h),v=s.values.length,T=s.values.map(L=>YR(L,s.min,s.max)),C=v>1?Math.min(...T):0,k=100-Math.max(...T);return H.jsx(Qi.span,{"data-orientation":s.orientation,"data-disabled":s.disabled?"":void 0,...i,ref:a,style:{...t.style,[l.startEdge]:C+"%",[l.endEdge]:k+"%"}})});ZR.displayName=mx;var gx="SliderThumb",XR=te.forwardRef((t,e)=>{const r=p9(t.__scopeSlider),[i,s]=te.useState(null),l=Cn(e,a=>s(a)),h=te.useMemo(()=>i?r().findIndex(a=>a.ref.current===i):-1,[r,i]);return H.jsx(y9,{...t,ref:l,index:h})}),y9=te.forwardRef((t,e)=>{const{__scopeSlider:r,index:i,name:s,...l}=t,h=m1(gx,r),a=HR(gx,r),[v,T]=te.useState(null),C=Cn(e,fe=>T(fe)),k=v?h.form||!!v.closest("form"):!0,L=d9(v),O=h.values[i],K=O===void 0?0:YR(O,h.min,h.max),$=x9(i,h.values.length),ne=L?.[a.size],oe=ne?E9(ne,K,a.direction):0;return te.useEffect(()=>{if(v)return h.thumbs.add(v),()=>{h.thumbs.delete(v)}},[v,h.thumbs]),H.jsxs("span",{style:{transform:"var(--radix-slider-thumb-transform)",position:"absolute",[a.startEdge]:`calc(${K}% + ${oe}px)`},children:[H.jsx(fx.ItemSlot,{scope:t.__scopeSlider,children:H.jsx(Qi.span,{role:"slider","aria-label":t["aria-label"]||$,"aria-valuemin":h.min,"aria-valuenow":O,"aria-valuemax":h.max,"aria-orientation":h.orientation,"data-orientation":h.orientation,"data-disabled":h.disabled?"":void 0,tabIndex:h.disabled?void 0:0,...l,ref:C,style:O===void 0?{display:"none"}:t.style,onFocus:_i(t.onFocus,()=>{h.valueIndexToChangeRef.current=i})})}),k&&H.jsx(KR,{name:s??(h.name?h.name+(h.values.length>1?"[]":""):void 0),form:h.form,value:O},i)]})});XR.displayName=gx;var v9="RadioBubbleInput",KR=te.forwardRef(({__scopeSlider:t,value:e,...r},i)=>{const s=te.useRef(null),l=Cn(s,i),h=h9(e);return te.useEffect(()=>{const a=s.current;if(!a)return;const v=window.HTMLInputElement.prototype,C=Object.getOwnPropertyDescriptor(v,"value").set;if(h!==e&&C){const k=new Event("input",{bubbles:!0});C.call(a,e),a.dispatchEvent(k)}},[h,e]),H.jsx(Qi.input,{style:{display:"none"},...r,ref:l,defaultValue:e})});KR.displayName=v9;function b9(t=[],e,r){const i=[...t];return i[r]=e,i.sort((s,l)=>s-l)}function YR(t,e,r){const l=100/(r-e)*(t-e);return Yw(l,[0,100])}function x9(t,e){return e>2?`Value ${t+1} of ${e}`:e===2?["Minimum","Maximum"][t]:void 0}function w9(t,e){if(t.length===1)return 0;const r=t.map(s=>Math.abs(s-e)),i=Math.min(...r);return r.indexOf(i)}function E9(t,e,r){const i=t/2,l=Jw([0,50],[0,i]);return(i-l(e)*r)*r}function A9(t){return t.slice(0,-1).map((e,r)=>t[r+1]-e)}function T9(t,e){if(e>0){const r=A9(t);return Math.min(...r)>=e}return!0}function Jw(t,e){return r=>{if(t[0]===t[1]||e[0]===e[1])return e[0];const i=(e[1]-e[0])/(t[1]-t[0]);return e[0]+i*(r-t[0])}}function S9(t){return(String(t).split(".")[1]||"").length}function C9(t,e){const r=Math.pow(10,e);return Math.round(t*r)/r}var M9=VR,P9=$R,R9=ZR,I9=XR;function k9({className:t,defaultValue:e,value:r,min:i=0,max:s=100,...l}){const h=te.useMemo(()=>Array.isArray(r)?r:Array.isArray(e)?e:[i,s],[r,e,i,s]);return H.jsxs(M9,{"data-slot":"slider",defaultValue:e,value:r,min:i,max:s,className:Vi("relative flex w-full touch-none items-center select-none data-[disabled]:opacity-50 data-[orientation=vertical]:h-full data-[orientation=vertical]:min-h-44 data-[orientation=vertical]:w-auto data-[orientation=vertical]:flex-col",t),...l,children:[H.jsx(P9,{"data-slot":"slider-track",className:Vi("bg-muted relative grow overflow-hidden rounded-full data-[orientation=horizontal]:h-4 data-[orientation=horizontal]:w-full data-[orientation=vertical]:h-full data-[orientation=vertical]:w-1.5"),children:H.jsx(R9,{"data-slot":"slider-range",className:Vi("bg-primary absolute data-[orientation=horizontal]:h-full data-[orientation=vertical]:w-full")})}),Array.from({length:h.length},(a,v)=>H.jsx(I9,{"data-slot":"slider-thumb",className:"border-primary bg-background ring-ring/50 block size-4 shrink-0 rounded-full border shadow-sm transition-[color,box-shadow] hover:ring-4 focus-visible:ring-4 focus-visible:outline-hidden disabled:pointer-events-none disabled:opacity-50"},v))]})}const B9=({isActive:t,onToggle:e,radius:r,onRadiusChange:i})=>H.jsxs("div",{className:"flex flex-col items-end gap-4",children:[H.jsxs("button",{onClick:e,className:Vi("relative group flex items-center justify-center w-12 h-12 rounded-full transition-all duration-300 shadow-lg backdrop-blur-md border border-white/20",t?"bg-primary text-primary-foreground shadow-[0_0_20px_rgba(249,115,22,0.5)]":"bg-background/80 text-muted-foreground hover:bg-background"),children:[H.jsx(c6,{className:Vi("w-6 h-6 transition-all",t&&"animate-pulse")}),H.jsx("span",{className:"absolute right-full mr-3 px-2 py-1 rounded-md bg-background/90 text-xs font-medium opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap pointer-events-none",children:"Torch Mode"})]}),t&&H.jsxs(rR.div,{initial:{opacity:0,y:-10,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:-10,scale:.95},className:"bg-background/90 backdrop-blur-md p-4 rounded-2xl border border-white/10 shadow-xl w-64",children:[H.jsxs("div",{className:"flex justify-between items-center mb-3",children:[H.jsx("span",{className:"text-sm font-medium",children:"Search Radius"}),H.jsxs("span",{className:"text-xs text-muted-foreground",children:[r," km"]})]}),H.jsx(k9,{value:[r],onValueChange:s=>i(s[0]),max:20,step:1,className:"w-full"})]})]}),L9=OR("inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function sh({className:t,variant:e,asChild:r=!1,...i}){const s=r?NR:"span";return H.jsx(s,{"data-slot":"badge",className:Vi(L9({variant:e}),t),...i})}const D9=[{id:"Chill",label:"Chill",color:"bg-blue-500/20 text-blue-300 border-blue-500/50"},{id:"Energetic",label:"Energetic",color:"bg-orange-500/20 text-orange-300 border-orange-500/50"},{id:"Creative",label:"Creative",color:"bg-purple-500/20 text-purple-300 border-purple-500/50"},{id:"Romantic",label:"Romantic",color:"bg-pink-500/20 text-pink-300 border-pink-500/50"},{id:"Intellectual",label:"Intellectual",color:"bg-emerald-500/20 text-emerald-300 border-emerald-500/50"}],N9=({selectedMood:t,onSelectMood:e})=>H.jsxs("div",{className:"flex gap-2 overflow-x-auto pb-2 scrollbar-hide mask-linear-fade",children:[H.jsx(sh,{variant:"outline",className:Vi("cursor-pointer transition-all hover:bg-white/10 px-4 py-1.5 h-8",t?"bg-black/40 border-white/10 text-muted-foreground":"bg-white/20 border-white/40"),onClick:()=>e(null),children:"All"}),D9.map(r=>H.jsx(sh,{variant:"outline",className:Vi("cursor-pointer transition-all hover:bg-white/10 px-4 py-1.5 h-8 border",t===r.id?r.color:"bg-black/40 border-white/10 text-muted-foreground"),onClick:()=>e(r.id===t?null:r.id),children:r.label},r.id))]});function O9(t,e=[]){let r=[];function i(l,h){const a=te.createContext(h);a.displayName=l+"Context";const v=r.length;r=[...r,h];const T=k=>{const{scope:L,children:O,...K}=k,$=L?.[t]?.[v]||a,ne=te.useMemo(()=>K,Object.values(K));return H.jsx($.Provider,{value:ne,children:O})};T.displayName=l+"Provider";function C(k,L){const O=L?.[t]?.[v]||a,K=te.useContext(O);if(K)return K;if(h!==void 0)return h;throw new Error(`\`${k}\` must be used within \`${l}\``)}return[T,C]}const s=()=>{const l=r.map(h=>te.createContext(h));return function(a){const v=a?.[t]||l;return te.useMemo(()=>({[`__scope${t}`]:{...a,[t]:v}}),[a,v])}};return s.scopeName=t,[i,F9(s,...e)]}function F9(...t){const e=t[0];if(t.length===1)return e;const r=()=>{const i=t.map(s=>({useScope:s(),scopeName:s.scopeName}));return function(l){const h=i.reduce((a,{useScope:v,scopeName:T})=>{const k=v(l)[`__scope${T}`];return{...a,...k}},{});return te.useMemo(()=>({[`__scope${e.scopeName}`]:h}),[h])}};return r.scopeName=e.scopeName,r}var z9=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],Qw=z9.reduce((t,e)=>{const r=Kw(`Primitive.${e}`),i=te.forwardRef((s,l)=>{const{asChild:h,...a}=s,v=h?r:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),H.jsx(v,{...a,ref:l})});return i.displayName=`Primitive.${e}`,{...t,[e]:i}},{}),kv={exports:{}},Bv={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var O3;function U9(){if(O3)return Bv;O3=1;var t=o1();function e(k,L){return k===L&&(k!==0||1/k===1/L)||k!==k&&L!==L}var r=typeof Object.is=="function"?Object.is:e,i=t.useState,s=t.useEffect,l=t.useLayoutEffect,h=t.useDebugValue;function a(k,L){var O=L(),K=i({inst:{value:O,getSnapshot:L}}),$=K[0].inst,ne=K[1];return l(function(){$.value=O,$.getSnapshot=L,v($)&&ne({inst:$})},[k,O,L]),s(function(){return v($)&&ne({inst:$}),k(function(){v($)&&ne({inst:$})})},[k]),h(O),O}function v(k){var L=k.getSnapshot;k=k.value;try{var O=L();return!r(k,O)}catch{return!0}}function T(k,L){return L()}var C=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?T:a;return Bv.useSyncExternalStore=t.useSyncExternalStore!==void 0?t.useSyncExternalStore:C,Bv}var F3;function j9(){return F3||(F3=1,kv.exports=U9()),kv.exports}var V9=j9();function G9(){return V9.useSyncExternalStore(H9,()=>!0,()=>!1)}function H9(){return()=>{}}var e2="Avatar",[W9]=O9(e2),[q9,JR]=W9(e2),QR=te.forwardRef((t,e)=>{const{__scopeAvatar:r,...i}=t,[s,l]=te.useState("idle");return H.jsx(q9,{scope:r,imageLoadingStatus:s,onImageLoadingStatusChange:l,children:H.jsx(Qw.span,{...i,ref:e})})});QR.displayName=e2;var eI="AvatarImage",tI=te.forwardRef((t,e)=>{const{__scopeAvatar:r,src:i,onLoadingStatusChange:s=()=>{},...l}=t,h=JR(eI,r),a=$9(i,l),v=la(T=>{s(T),h.onImageLoadingStatusChange(T)});return cu(()=>{a!=="idle"&&v(a)},[a,v]),a==="loaded"?H.jsx(Qw.img,{...l,ref:e,src:i}):null});tI.displayName=eI;var rI="AvatarFallback",iI=te.forwardRef((t,e)=>{const{__scopeAvatar:r,delayMs:i,...s}=t,l=JR(rI,r),[h,a]=te.useState(i===void 0);return te.useEffect(()=>{if(i!==void 0){const v=window.setTimeout(()=>a(!0),i);return()=>window.clearTimeout(v)}},[i]),h&&l.imageLoadingStatus!=="loaded"?H.jsx(Qw.span,{...s,ref:e}):null});iI.displayName=rI;function z3(t,e){return t?e?(t.src!==e&&(t.src=e),t.complete&&t.naturalWidth>0?"loaded":"loading"):"error":"idle"}function $9(t,{referrerPolicy:e,crossOrigin:r}){const i=G9(),s=te.useRef(null),l=i?(s.current||(s.current=new window.Image),s.current):null,[h,a]=te.useState(()=>z3(l,t));return cu(()=>{a(z3(l,t))},[l,t]),cu(()=>{const v=k=>()=>{a(k)};if(!l)return;const T=v("loaded"),C=v("error");return l.addEventListener("load",T),l.addEventListener("error",C),e&&(l.referrerPolicy=e),typeof r=="string"&&(l.crossOrigin=r),()=>{l.removeEventListener("load",T),l.removeEventListener("error",C)}},[l,r,e]),h}var Z9=QR,X9=tI,K9=iI;function t2({className:t,...e}){return H.jsx(Z9,{"data-slot":"avatar",className:Vi("relative flex size-10 shrink-0 overflow-hidden rounded-full",t),...e})}function r2({className:t,...e}){return H.jsx(X9,{"data-slot":"avatar-image",className:Vi("aspect-square size-full",t),...e})}function i2({className:t,...e}){return H.jsx(K9,{"data-slot":"avatar-fallback",className:Vi("bg-muted flex size-full items-center justify-center rounded-full",t),...e})}const Y9="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODgiIGhlaWdodD0iODgiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjMDAwIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBvcGFjaXR5PSIuMyIgZmlsbD0ibm9uZSIgc3Ryb2tlLXdpZHRoPSIzLjciPjxyZWN0IHg9IjE2IiB5PSIxNiIgd2lkdGg9IjU2IiBoZWlnaHQ9IjU2IiByeD0iNiIvPjxwYXRoIGQ9Im0xNiA1OCAxNi0xOCAzMiAzMiIvPjxjaXJjbGUgY3g9IjUzIiBjeT0iMzUiIHI9IjciLz48L3N2Zz4KCg==";function ud(t){const[e,r]=te.useState(!1),i=()=>{r(!0)},{src:s,alt:l,style:h,className:a,...v}=t;return e?H.jsx("div",{className:`inline-block bg-gray-100 text-center align-middle ${a??""}`,style:h,children:H.jsx("div",{className:"flex items-center justify-center w-full h-full",children:H.jsx("img",{src:Y9,alt:"Error loading image",...v,"data-original-url":s})})}):H.jsx("img",{src:s,alt:l,className:a,style:h,...v,onError:i})}function nI({event:t,open:e,onClose:r}){return!t||!e?null:H.jsxs(H.Fragment,{children:[H.jsx("div",{className:"fixed inset-0 bg-black/50 z-40 animate-in fade-in",onClick:r}),H.jsxs("div",{className:"fixed bottom-0 left-0 right-0 z-50 bg-card rounded-t-3xl border-t border-border animate-in slide-in-from-bottom duration-300 max-w-lg mx-auto",children:[H.jsxs("div",{className:"relative h-48 rounded-t-3xl overflow-hidden",children:[H.jsx(ud,{src:t.imageUrl,alt:t.title,className:"w-full h-full object-cover"}),H.jsx(lc,{size:"icon",variant:"ghost",className:"absolute top-4 right-4 bg-black/50 hover:bg-black/70 text-white rounded-full",onClick:r,children:H.jsx(pw,{className:"h-5 w-5"})}),H.jsx(sh,{variant:"outline",className:"absolute top-4 left-4 bg-primary/20 text-primary border-primary/50",children:t.mood})]}),H.jsxs("div",{className:"p-6 space-y-4",children:[H.jsx("h2",{className:"text-foreground text-2xl",children:t.title}),H.jsxs("div",{className:"flex items-center gap-4 text-muted-foreground text-sm",children:[H.jsxs("div",{className:"flex items-center gap-1.5",children:[H.jsx(bM,{className:"h-4 w-4"}),H.jsx("span",{children:t.startTime})]}),H.jsxs("div",{className:"flex items-center gap-1.5",children:[H.jsx(Hp,{className:"h-4 w-4"}),H.jsx("span",{children:t.location.name})]})]}),t.description&&H.jsx("p",{className:"text-muted-foreground text-sm",children:t.description}),H.jsxs("div",{className:"flex items-center justify-between py-3 border-t border-b border-border",children:[H.jsxs("div",{className:"flex items-center gap-3",children:[H.jsxs(t2,{className:"h-10 w-10",children:[H.jsx(r2,{src:t.host.avatar,alt:t.host.name}),H.jsx(i2,{children:t.host.name[0]})]}),H.jsxs("div",{children:[H.jsx("div",{className:"text-foreground text-sm",children:"Hosted by"}),H.jsx("div",{className:"text-foreground",children:t.host.name})]})]}),t.host.instagram&&H.jsxs(lc,{variant:"ghost",size:"sm",className:"text-primary hover:text-primary/80",children:[H.jsx(wM,{className:"h-4 w-4 mr-1"}),t.host.instagram]})]}),H.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[H.jsx(fm,{className:"h-5 w-5"}),H.jsxs("span",{className:"text-sm",children:[H.jsx("span",{className:"text-foreground",children:t.attendees})," people attending"]})]}),H.jsx(lc,{className:"w-full bg-primary hover:bg-primary/90 text-primary-foreground py-6",children:"RSVP to Event"})]})]})]})}function J9(t,e=globalThis?.document){const r=la(t);te.useEffect(()=>{const i=s=>{s.key==="Escape"&&r(s)};return e.addEventListener("keydown",i,{capture:!0}),()=>e.removeEventListener("keydown",i,{capture:!0})},[r,e])}var Q9="DismissableLayer",_x="dismissableLayer.update",ez="dismissableLayer.pointerDownOutside",tz="dismissableLayer.focusOutside",U3,sI=te.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),oI=te.forwardRef((t,e)=>{const{disableOutsidePointerEvents:r=!1,onEscapeKeyDown:i,onPointerDownOutside:s,onFocusOutside:l,onInteractOutside:h,onDismiss:a,...v}=t,T=te.useContext(sI),[C,k]=te.useState(null),L=C?.ownerDocument??globalThis?.document,[,O]=te.useState({}),K=Cn(e,Ke=>k(Ke)),$=Array.from(T.layers),[ne]=[...T.layersWithOutsidePointerEventsDisabled].slice(-1),oe=$.indexOf(ne),fe=C?$.indexOf(C):-1,ue=T.layersWithOutsidePointerEventsDisabled.size>0,we=fe>=oe,De=nz(Ke=>{const ze=Ke.target,it=[...T.branches].some(lt=>lt.contains(ze));!we||it||(s?.(Ke),h?.(Ke),Ke.defaultPrevented||a?.())},L),Fe=sz(Ke=>{const ze=Ke.target;[...T.branches].some(lt=>lt.contains(ze))||(l?.(Ke),h?.(Ke),Ke.defaultPrevented||a?.())},L);return J9(Ke=>{fe===T.layers.size-1&&(i?.(Ke),!Ke.defaultPrevented&&a&&(Ke.preventDefault(),a()))},L),te.useEffect(()=>{if(C)return r&&(T.layersWithOutsidePointerEventsDisabled.size===0&&(U3=L.body.style.pointerEvents,L.body.style.pointerEvents="none"),T.layersWithOutsidePointerEventsDisabled.add(C)),T.layers.add(C),j3(),()=>{r&&T.layersWithOutsidePointerEventsDisabled.size===1&&(L.body.style.pointerEvents=U3)}},[C,L,r,T]),te.useEffect(()=>()=>{C&&(T.layers.delete(C),T.layersWithOutsidePointerEventsDisabled.delete(C),j3())},[C,T]),te.useEffect(()=>{const Ke=()=>O({});return document.addEventListener(_x,Ke),()=>document.removeEventListener(_x,Ke)},[]),H.jsx(Qi.div,{...v,ref:K,style:{pointerEvents:ue?we?"auto":"none":void 0,...t.style},onFocusCapture:_i(t.onFocusCapture,Fe.onFocusCapture),onBlurCapture:_i(t.onBlurCapture,Fe.onBlurCapture),onPointerDownCapture:_i(t.onPointerDownCapture,De.onPointerDownCapture)})});oI.displayName=Q9;var rz="DismissableLayerBranch",iz=te.forwardRef((t,e)=>{const r=te.useContext(sI),i=te.useRef(null),s=Cn(e,i);return te.useEffect(()=>{const l=i.current;if(l)return r.branches.add(l),()=>{r.branches.delete(l)}},[r.branches]),H.jsx(Qi.div,{...t,ref:s})});iz.displayName=rz;function nz(t,e=globalThis?.document){const r=la(t),i=te.useRef(!1),s=te.useRef(()=>{});return te.useEffect(()=>{const l=a=>{if(a.target&&!i.current){let v=function(){aI(ez,r,T,{discrete:!0})};const T={originalEvent:a};a.pointerType==="touch"?(e.removeEventListener("click",s.current),s.current=v,e.addEventListener("click",s.current,{once:!0})):v()}else e.removeEventListener("click",s.current);i.current=!1},h=window.setTimeout(()=>{e.addEventListener("pointerdown",l)},0);return()=>{window.clearTimeout(h),e.removeEventListener("pointerdown",l),e.removeEventListener("click",s.current)}},[e,r]),{onPointerDownCapture:()=>i.current=!0}}function sz(t,e=globalThis?.document){const r=la(t),i=te.useRef(!1);return te.useEffect(()=>{const s=l=>{l.target&&!i.current&&aI(tz,r,{originalEvent:l},{discrete:!1})};return e.addEventListener("focusin",s),()=>e.removeEventListener("focusin",s)},[e,r]),{onFocusCapture:()=>i.current=!0,onBlurCapture:()=>i.current=!1}}function j3(){const t=new CustomEvent(_x);document.dispatchEvent(t)}function aI(t,e,r,{discrete:i}){const s=r.originalEvent.target,l=new CustomEvent(t,{bubbles:!1,cancelable:!0,detail:r});e&&s.addEventListener(t,e,{once:!0}),i?jF(s,l):s.dispatchEvent(l)}var Lv="focusScope.autoFocusOnMount",Dv="focusScope.autoFocusOnUnmount",V3={bubbles:!1,cancelable:!0},oz="FocusScope",lI=te.forwardRef((t,e)=>{const{loop:r=!1,trapped:i=!1,onMountAutoFocus:s,onUnmountAutoFocus:l,...h}=t,[a,v]=te.useState(null),T=la(s),C=la(l),k=te.useRef(null),L=Cn(e,$=>v($)),O=te.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;te.useEffect(()=>{if(i){let $=function(ue){if(O.paused||!a)return;const we=ue.target;a.contains(we)?k.current=we:ed(k.current,{select:!0})},ne=function(ue){if(O.paused||!a)return;const we=ue.relatedTarget;we!==null&&(a.contains(we)||ed(k.current,{select:!0}))},oe=function(ue){if(document.activeElement===document.body)for(const De of ue)De.removedNodes.length>0&&ed(a)};document.addEventListener("focusin",$),document.addEventListener("focusout",ne);const fe=new MutationObserver(oe);return a&&fe.observe(a,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",$),document.removeEventListener("focusout",ne),fe.disconnect()}}},[i,a,O.paused]),te.useEffect(()=>{if(a){H3.add(O);const $=document.activeElement;if(!a.contains($)){const oe=new CustomEvent(Lv,V3);a.addEventListener(Lv,T),a.dispatchEvent(oe),oe.defaultPrevented||(az(dz(cI(a)),{select:!0}),document.activeElement===$&&ed(a))}return()=>{a.removeEventListener(Lv,T),setTimeout(()=>{const oe=new CustomEvent(Dv,V3);a.addEventListener(Dv,C),a.dispatchEvent(oe),oe.defaultPrevented||ed($??document.body,{select:!0}),a.removeEventListener(Dv,C),H3.remove(O)},0)}}},[a,T,C,O]);const K=te.useCallback($=>{if(!r&&!i||O.paused)return;const ne=$.key==="Tab"&&!$.altKey&&!$.ctrlKey&&!$.metaKey,oe=document.activeElement;if(ne&&oe){const fe=$.currentTarget,[ue,we]=lz(fe);ue&&we?!$.shiftKey&&oe===we?($.preventDefault(),r&&ed(ue,{select:!0})):$.shiftKey&&oe===ue&&($.preventDefault(),r&&ed(we,{select:!0})):oe===fe&&$.preventDefault()}},[r,i,O.paused]);return H.jsx(Qi.div,{tabIndex:-1,...h,ref:L,onKeyDown:K})});lI.displayName=oz;function az(t,{select:e=!1}={}){const r=document.activeElement;for(const i of t)if(ed(i,{select:e}),document.activeElement!==r)return}function lz(t){const e=cI(t),r=G3(e,t),i=G3(e.reverse(),t);return[r,i]}function cI(t){const e=[],r=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT,{acceptNode:i=>{const s=i.tagName==="INPUT"&&i.type==="hidden";return i.disabled||i.hidden||s?NodeFilter.FILTER_SKIP:i.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;r.nextNode();)e.push(r.currentNode);return e}function G3(t,e){for(const r of t)if(!cz(r,{upTo:e}))return r}function cz(t,{upTo:e}){if(getComputedStyle(t).visibility==="hidden")return!0;for(;t;){if(e!==void 0&&t===e)return!1;if(getComputedStyle(t).display==="none")return!0;t=t.parentElement}return!1}function uz(t){return t instanceof HTMLInputElement&&"select"in t}function ed(t,{select:e=!1}={}){if(t&&t.focus){const r=document.activeElement;t.focus({preventScroll:!0}),t!==r&&uz(t)&&e&&t.select()}}var H3=hz();function hz(){let t=[];return{add(e){const r=t[0];e!==r&&r?.pause(),t=W3(t,e),t.unshift(e)},remove(e){t=W3(t,e),t[0]?.resume()}}}function W3(t,e){const r=[...t],i=r.indexOf(e);return i!==-1&&r.splice(i,1),r}function dz(t){return t.filter(e=>e.tagName!=="A")}var pz="Portal",uI=te.forwardRef((t,e)=>{const{container:r,...i}=t,[s,l]=te.useState(!1);cu(()=>l(!0),[]);const h=r||s&&globalThis?.document?.body;return h?BF.createPortal(H.jsx(Qi.div,{...i,ref:e}),h):null});uI.displayName=pz;var Nv=0;function fz(){te.useEffect(()=>{const t=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",t[0]??q3()),document.body.insertAdjacentElement("beforeend",t[1]??q3()),Nv++,()=>{Nv===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(e=>e.remove()),Nv--}},[])}function q3(){const t=document.createElement("span");return t.setAttribute("data-radix-focus-guard",""),t.tabIndex=0,t.style.outline="none",t.style.opacity="0",t.style.position="fixed",t.style.pointerEvents="none",t}var ru=function(){return ru=Object.assign||function(e){for(var r,i=1,s=arguments.length;i<s;i++){r=arguments[i];for(var l in r)Object.prototype.hasOwnProperty.call(r,l)&&(e[l]=r[l])}return e},ru.apply(this,arguments)};function hI(t,e){var r={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(r[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,i=Object.getOwnPropertySymbols(t);s<i.length;s++)e.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(t,i[s])&&(r[i[s]]=t[i[s]]);return r}function mz(t,e,r){if(r||arguments.length===2)for(var i=0,s=e.length,l;i<s;i++)(l||!(i in e))&&(l||(l=Array.prototype.slice.call(e,0,i)),l[i]=e[i]);return t.concat(l||Array.prototype.slice.call(e))}var b0="right-scroll-bar-position",x0="width-before-scroll-bar",gz="with-scroll-bars-hidden",_z="--removed-body-scroll-bar-size";function Ov(t,e){return typeof t=="function"?t(e):t&&(t.current=e),t}function yz(t,e){var r=te.useState(function(){return{value:t,callback:e,facade:{get current(){return r.value},set current(i){var s=r.value;s!==i&&(r.value=i,r.callback(i,s))}}}})[0];return r.callback=e,r.facade}var vz=typeof window<"u"?te.useLayoutEffect:te.useEffect,$3=new WeakMap;function bz(t,e){var r=yz(null,function(i){return t.forEach(function(s){return Ov(s,i)})});return vz(function(){var i=$3.get(r);if(i){var s=new Set(i),l=new Set(t),h=r.current;s.forEach(function(a){l.has(a)||Ov(a,null)}),l.forEach(function(a){s.has(a)||Ov(a,h)})}$3.set(r,t)},[t]),r}function xz(t){return t}function wz(t,e){e===void 0&&(e=xz);var r=[],i=!1,s={read:function(){if(i)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return r.length?r[r.length-1]:t},useMedium:function(l){var h=e(l,i);return r.push(h),function(){r=r.filter(function(a){return a!==h})}},assignSyncMedium:function(l){for(i=!0;r.length;){var h=r;r=[],h.forEach(l)}r={push:function(a){return l(a)},filter:function(){return r}}},assignMedium:function(l){i=!0;var h=[];if(r.length){var a=r;r=[],a.forEach(l),h=r}var v=function(){var C=h;h=[],C.forEach(l)},T=function(){return Promise.resolve().then(v)};T(),r={push:function(C){h.push(C),T()},filter:function(C){return h=h.filter(C),r}}}};return s}function Ez(t){t===void 0&&(t={});var e=wz(null);return e.options=ru({async:!0,ssr:!1},t),e}var dI=function(t){var e=t.sideCar,r=hI(t,["sideCar"]);if(!e)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var i=e.read();if(!i)throw new Error("Sidecar medium not found");return te.createElement(i,ru({},r))};dI.isSideCarExport=!0;function Az(t,e){return t.useMedium(e),dI}var pI=Ez(),Fv=function(){},g1=te.forwardRef(function(t,e){var r=te.useRef(null),i=te.useState({onScrollCapture:Fv,onWheelCapture:Fv,onTouchMoveCapture:Fv}),s=i[0],l=i[1],h=t.forwardProps,a=t.children,v=t.className,T=t.removeScrollBar,C=t.enabled,k=t.shards,L=t.sideCar,O=t.noRelative,K=t.noIsolation,$=t.inert,ne=t.allowPinchZoom,oe=t.as,fe=oe===void 0?"div":oe,ue=t.gapMode,we=hI(t,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noRelative","noIsolation","inert","allowPinchZoom","as","gapMode"]),De=L,Fe=bz([r,e]),Ke=ru(ru({},we),s);return te.createElement(te.Fragment,null,C&&te.createElement(De,{sideCar:pI,removeScrollBar:T,shards:k,noRelative:O,noIsolation:K,inert:$,setCallbacks:l,allowPinchZoom:!!ne,lockRef:r,gapMode:ue}),h?te.cloneElement(te.Children.only(a),ru(ru({},Ke),{ref:Fe})):te.createElement(fe,ru({},Ke,{className:v,ref:Fe}),a))});g1.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};g1.classNames={fullWidth:x0,zeroRight:b0};var Tz=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function Sz(){if(!document)return null;var t=document.createElement("style");t.type="text/css";var e=Tz();return e&&t.setAttribute("nonce",e),t}function Cz(t,e){t.styleSheet?t.styleSheet.cssText=e:t.appendChild(document.createTextNode(e))}function Mz(t){var e=document.head||document.getElementsByTagName("head")[0];e.appendChild(t)}var Pz=function(){var t=0,e=null;return{add:function(r){t==0&&(e=Sz())&&(Cz(e,r),Mz(e)),t++},remove:function(){t--,!t&&e&&(e.parentNode&&e.parentNode.removeChild(e),e=null)}}},Rz=function(){var t=Pz();return function(e,r){te.useEffect(function(){return t.add(e),function(){t.remove()}},[e&&r])}},fI=function(){var t=Rz(),e=function(r){var i=r.styles,s=r.dynamic;return t(i,s),null};return e},Iz={left:0,top:0,right:0,gap:0},zv=function(t){return parseInt(t||"",10)||0},kz=function(t){var e=window.getComputedStyle(document.body),r=e[t==="padding"?"paddingLeft":"marginLeft"],i=e[t==="padding"?"paddingTop":"marginTop"],s=e[t==="padding"?"paddingRight":"marginRight"];return[zv(r),zv(i),zv(s)]},Bz=function(t){if(t===void 0&&(t="margin"),typeof window>"u")return Iz;var e=kz(t),r=document.documentElement.clientWidth,i=window.innerWidth;return{left:e[0],top:e[1],right:e[2],gap:Math.max(0,i-r+e[2]-e[0])}},Lz=fI(),om="data-scroll-locked",Dz=function(t,e,r,i){var s=t.left,l=t.top,h=t.right,a=t.gap;return r===void 0&&(r="margin"),`
  .`.concat(gz,` {
   overflow: hidden `).concat(i,`;
   padding-right: `).concat(a,"px ").concat(i,`;
  }
  body[`).concat(om,`] {
    overflow: hidden `).concat(i,`;
    overscroll-behavior: contain;
    `).concat([e&&"position: relative ".concat(i,";"),r==="margin"&&`
    padding-left: `.concat(s,`px;
    padding-top: `).concat(l,`px;
    padding-right: `).concat(h,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(a,"px ").concat(i,`;
    `),r==="padding"&&"padding-right: ".concat(a,"px ").concat(i,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(b0,` {
    right: `).concat(a,"px ").concat(i,`;
  }
  
  .`).concat(x0,` {
    margin-right: `).concat(a,"px ").concat(i,`;
  }
  
  .`).concat(b0," .").concat(b0,` {
    right: 0 `).concat(i,`;
  }
  
  .`).concat(x0," .").concat(x0,` {
    margin-right: 0 `).concat(i,`;
  }
  
  body[`).concat(om,`] {
    `).concat(_z,": ").concat(a,`px;
  }
`)},Z3=function(){var t=parseInt(document.body.getAttribute(om)||"0",10);return isFinite(t)?t:0},Nz=function(){te.useEffect(function(){return document.body.setAttribute(om,(Z3()+1).toString()),function(){var t=Z3()-1;t<=0?document.body.removeAttribute(om):document.body.setAttribute(om,t.toString())}},[])},Oz=function(t){var e=t.noRelative,r=t.noImportant,i=t.gapMode,s=i===void 0?"margin":i;Nz();var l=te.useMemo(function(){return Bz(s)},[s]);return te.createElement(Lz,{styles:Dz(l,!e,s,r?"":"!important")})},yx=!1;if(typeof window<"u")try{var Ly=Object.defineProperty({},"passive",{get:function(){return yx=!0,!0}});window.addEventListener("test",Ly,Ly),window.removeEventListener("test",Ly,Ly)}catch{yx=!1}var kf=yx?{passive:!1}:!1,Fz=function(t){return t.tagName==="TEXTAREA"},mI=function(t,e){if(!(t instanceof Element))return!1;var r=window.getComputedStyle(t);return r[e]!=="hidden"&&!(r.overflowY===r.overflowX&&!Fz(t)&&r[e]==="visible")},zz=function(t){return mI(t,"overflowY")},Uz=function(t){return mI(t,"overflowX")},X3=function(t,e){var r=e.ownerDocument,i=e;do{typeof ShadowRoot<"u"&&i instanceof ShadowRoot&&(i=i.host);var s=gI(t,i);if(s){var l=_I(t,i),h=l[1],a=l[2];if(h>a)return!0}i=i.parentNode}while(i&&i!==r.body);return!1},jz=function(t){var e=t.scrollTop,r=t.scrollHeight,i=t.clientHeight;return[e,r,i]},Vz=function(t){var e=t.scrollLeft,r=t.scrollWidth,i=t.clientWidth;return[e,r,i]},gI=function(t,e){return t==="v"?zz(e):Uz(e)},_I=function(t,e){return t==="v"?jz(e):Vz(e)},Gz=function(t,e){return t==="h"&&e==="rtl"?-1:1},Hz=function(t,e,r,i,s){var l=Gz(t,window.getComputedStyle(e).direction),h=l*i,a=r.target,v=e.contains(a),T=!1,C=h>0,k=0,L=0;do{if(!a)break;var O=_I(t,a),K=O[0],$=O[1],ne=O[2],oe=$-ne-l*K;(K||oe)&&gI(t,a)&&(k+=oe,L+=K);var fe=a.parentNode;a=fe&&fe.nodeType===Node.DOCUMENT_FRAGMENT_NODE?fe.host:fe}while(!v&&a!==document.body||v&&(e.contains(a)||e===a));return(C&&Math.abs(k)<1||!C&&Math.abs(L)<1)&&(T=!0),T},Dy=function(t){return"changedTouches"in t?[t.changedTouches[0].clientX,t.changedTouches[0].clientY]:[0,0]},K3=function(t){return[t.deltaX,t.deltaY]},Y3=function(t){return t&&"current"in t?t.current:t},Wz=function(t,e){return t[0]===e[0]&&t[1]===e[1]},qz=function(t){return`
  .block-interactivity-`.concat(t,` {pointer-events: none;}
  .allow-interactivity-`).concat(t,` {pointer-events: all;}
`)},$z=0,Bf=[];function Zz(t){var e=te.useRef([]),r=te.useRef([0,0]),i=te.useRef(),s=te.useState($z++)[0],l=te.useState(fI)[0],h=te.useRef(t);te.useEffect(function(){h.current=t},[t]),te.useEffect(function(){if(t.inert){document.body.classList.add("block-interactivity-".concat(s));var $=mz([t.lockRef.current],(t.shards||[]).map(Y3),!0).filter(Boolean);return $.forEach(function(ne){return ne.classList.add("allow-interactivity-".concat(s))}),function(){document.body.classList.remove("block-interactivity-".concat(s)),$.forEach(function(ne){return ne.classList.remove("allow-interactivity-".concat(s))})}}},[t.inert,t.lockRef.current,t.shards]);var a=te.useCallback(function($,ne){if("touches"in $&&$.touches.length===2||$.type==="wheel"&&$.ctrlKey)return!h.current.allowPinchZoom;var oe=Dy($),fe=r.current,ue="deltaX"in $?$.deltaX:fe[0]-oe[0],we="deltaY"in $?$.deltaY:fe[1]-oe[1],De,Fe=$.target,Ke=Math.abs(ue)>Math.abs(we)?"h":"v";if("touches"in $&&Ke==="h"&&Fe.type==="range")return!1;var ze=X3(Ke,Fe);if(!ze)return!0;if(ze?De=Ke:(De=Ke==="v"?"h":"v",ze=X3(Ke,Fe)),!ze)return!1;if(!i.current&&"changedTouches"in $&&(ue||we)&&(i.current=De),!De)return!0;var it=i.current||De;return Hz(it,ne,$,it==="h"?ue:we)},[]),v=te.useCallback(function($){var ne=$;if(!(!Bf.length||Bf[Bf.length-1]!==l)){var oe="deltaY"in ne?K3(ne):Dy(ne),fe=e.current.filter(function(De){return De.name===ne.type&&(De.target===ne.target||ne.target===De.shadowParent)&&Wz(De.delta,oe)})[0];if(fe&&fe.should){ne.cancelable&&ne.preventDefault();return}if(!fe){var ue=(h.current.shards||[]).map(Y3).filter(Boolean).filter(function(De){return De.contains(ne.target)}),we=ue.length>0?a(ne,ue[0]):!h.current.noIsolation;we&&ne.cancelable&&ne.preventDefault()}}},[]),T=te.useCallback(function($,ne,oe,fe){var ue={name:$,delta:ne,target:oe,should:fe,shadowParent:Xz(oe)};e.current.push(ue),setTimeout(function(){e.current=e.current.filter(function(we){return we!==ue})},1)},[]),C=te.useCallback(function($){r.current=Dy($),i.current=void 0},[]),k=te.useCallback(function($){T($.type,K3($),$.target,a($,t.lockRef.current))},[]),L=te.useCallback(function($){T($.type,Dy($),$.target,a($,t.lockRef.current))},[]);te.useEffect(function(){return Bf.push(l),t.setCallbacks({onScrollCapture:k,onWheelCapture:k,onTouchMoveCapture:L}),document.addEventListener("wheel",v,kf),document.addEventListener("touchmove",v,kf),document.addEventListener("touchstart",C,kf),function(){Bf=Bf.filter(function($){return $!==l}),document.removeEventListener("wheel",v,kf),document.removeEventListener("touchmove",v,kf),document.removeEventListener("touchstart",C,kf)}},[]);var O=t.removeScrollBar,K=t.inert;return te.createElement(te.Fragment,null,K?te.createElement(l,{styles:qz(s)}):null,O?te.createElement(Oz,{noRelative:t.noRelative,gapMode:t.gapMode}):null)}function Xz(t){for(var e=null;t!==null;)t instanceof ShadowRoot&&(e=t.host,t=t.host),t=t.parentNode;return e}const Kz=Az(pI,Zz);var yI=te.forwardRef(function(t,e){return te.createElement(g1,ru({},t,{ref:e,sideCar:Kz}))});yI.classNames=g1.classNames;var Yz=function(t){if(typeof document>"u")return null;var e=Array.isArray(t)?t[0]:t;return e.ownerDocument.body},Lf=new WeakMap,Ny=new WeakMap,Oy={},Uv=0,vI=function(t){return t&&(t.host||vI(t.parentNode))},Jz=function(t,e){return e.map(function(r){if(t.contains(r))return r;var i=vI(r);return i&&t.contains(i)?i:(console.error("aria-hidden",r,"in not contained inside",t,". Doing nothing"),null)}).filter(function(r){return!!r})},Qz=function(t,e,r,i){var s=Jz(e,Array.isArray(t)?t:[t]);Oy[r]||(Oy[r]=new WeakMap);var l=Oy[r],h=[],a=new Set,v=new Set(s),T=function(k){!k||a.has(k)||(a.add(k),T(k.parentNode))};s.forEach(T);var C=function(k){!k||v.has(k)||Array.prototype.forEach.call(k.children,function(L){if(a.has(L))C(L);else try{var O=L.getAttribute(i),K=O!==null&&O!=="false",$=(Lf.get(L)||0)+1,ne=(l.get(L)||0)+1;Lf.set(L,$),l.set(L,ne),h.push(L),$===1&&K&&Ny.set(L,!0),ne===1&&L.setAttribute(r,"true"),K||L.setAttribute(i,"true")}catch(oe){console.error("aria-hidden: cannot operate on ",L,oe)}})};return C(e),a.clear(),Uv++,function(){h.forEach(function(k){var L=Lf.get(k)-1,O=l.get(k)-1;Lf.set(k,L),l.set(k,O),L||(Ny.has(k)||k.removeAttribute(i),Ny.delete(k)),O||k.removeAttribute(r)}),Uv--,Uv||(Lf=new WeakMap,Lf=new WeakMap,Ny=new WeakMap,Oy={})}},e7=function(t,e,r){r===void 0&&(r="data-aria-hidden");var i=Array.from(Array.isArray(t)?t:[t]),s=Yz(t);return s?(i.push.apply(i,Array.from(s.querySelectorAll("[aria-live], script"))),Qz(i,s,r,"aria-hidden")):function(){return null}};function t7(t){const e=r7(t),r=te.forwardRef((i,s)=>{const{children:l,...h}=i,a=te.Children.toArray(l),v=a.find(n7);if(v){const T=v.props.children,C=a.map(k=>k===v?te.Children.count(T)>1?te.Children.only(null):te.isValidElement(T)?T.props.children:null:k);return H.jsx(e,{...h,ref:s,children:te.isValidElement(T)?te.cloneElement(T,void 0,C):null})}return H.jsx(e,{...h,ref:s,children:l})});return r.displayName=`${t}.Slot`,r}function r7(t){const e=te.forwardRef((r,i)=>{const{children:s,...l}=r;if(te.isValidElement(s)){const h=o7(s),a=s7(l,s.props);return s.type!==te.Fragment&&(a.ref=i?I_(i,h):h),te.cloneElement(s,a)}return te.Children.count(s)>1?te.Children.only(null):null});return e.displayName=`${t}.SlotClone`,e}var i7=Symbol("radix.slottable");function n7(t){return te.isValidElement(t)&&typeof t.type=="function"&&"__radixId"in t.type&&t.type.__radixId===i7}function s7(t,e){const r={...e};for(const i in e){const s=t[i],l=e[i];/^on[A-Z]/.test(i)?s&&l?r[i]=(...a)=>{const v=l(...a);return s(...a),v}:s&&(r[i]=s):i==="style"?r[i]={...s,...l}:i==="className"&&(r[i]=[s,l].filter(Boolean).join(" "))}return{...t,...r}}function o7(t){let e=Object.getOwnPropertyDescriptor(t.props,"ref")?.get,r=e&&"isReactWarning"in e&&e.isReactWarning;return r?t.ref:(e=Object.getOwnPropertyDescriptor(t,"ref")?.get,r=e&&"isReactWarning"in e&&e.isReactWarning,r?t.props.ref:t.props.ref||t.ref)}var _1="Dialog",[bI]=Im(_1),[a7,dc]=bI(_1),xI=t=>{const{__scopeDialog:e,children:r,open:i,defaultOpen:s,onOpenChange:l,modal:h=!0}=t,a=te.useRef(null),v=te.useRef(null),[T,C]=d1({prop:i,defaultProp:s??!1,onChange:l,caller:_1});return H.jsx(a7,{scope:e,triggerRef:a,contentRef:v,contentId:r_(),titleId:r_(),descriptionId:r_(),open:T,onOpenChange:C,onOpenToggle:te.useCallback(()=>C(k=>!k),[C]),modal:h,children:r})};xI.displayName=_1;var wI="DialogTrigger",EI=te.forwardRef((t,e)=>{const{__scopeDialog:r,...i}=t,s=dc(wI,r),l=Cn(e,s.triggerRef);return H.jsx(Qi.button,{type:"button","aria-haspopup":"dialog","aria-expanded":s.open,"aria-controls":s.contentId,"data-state":o2(s.open),...i,ref:l,onClick:_i(t.onClick,s.onOpenToggle)})});EI.displayName=wI;var n2="DialogPortal",[l7,AI]=bI(n2,{forceMount:void 0}),TI=t=>{const{__scopeDialog:e,forceMount:r,children:i,container:s}=t,l=dc(n2,e);return H.jsx(l7,{scope:e,forceMount:r,children:te.Children.map(i,h=>H.jsx(lh,{present:r||l.open,children:H.jsx(uI,{asChild:!0,container:s,children:h})}))})};TI.displayName=n2;var F0="DialogOverlay",SI=te.forwardRef((t,e)=>{const r=AI(F0,t.__scopeDialog),{forceMount:i=r.forceMount,...s}=t,l=dc(F0,t.__scopeDialog);return l.modal?H.jsx(lh,{present:i||l.open,children:H.jsx(u7,{...s,ref:e})}):null});SI.displayName=F0;var c7=t7("DialogOverlay.RemoveScroll"),u7=te.forwardRef((t,e)=>{const{__scopeDialog:r,...i}=t,s=dc(F0,r);return H.jsx(yI,{as:c7,allowPinchZoom:!0,shards:[s.contentRef],children:H.jsx(Qi.div,{"data-state":o2(s.open),...i,ref:e,style:{pointerEvents:"auto",...i.style}})})}),Wp="DialogContent",CI=te.forwardRef((t,e)=>{const r=AI(Wp,t.__scopeDialog),{forceMount:i=r.forceMount,...s}=t,l=dc(Wp,t.__scopeDialog);return H.jsx(lh,{present:i||l.open,children:l.modal?H.jsx(h7,{...s,ref:e}):H.jsx(d7,{...s,ref:e})})});CI.displayName=Wp;var h7=te.forwardRef((t,e)=>{const r=dc(Wp,t.__scopeDialog),i=te.useRef(null),s=Cn(e,r.contentRef,i);return te.useEffect(()=>{const l=i.current;if(l)return e7(l)},[]),H.jsx(MI,{...t,ref:s,trapFocus:r.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:_i(t.onCloseAutoFocus,l=>{l.preventDefault(),r.triggerRef.current?.focus()}),onPointerDownOutside:_i(t.onPointerDownOutside,l=>{const h=l.detail.originalEvent,a=h.button===0&&h.ctrlKey===!0;(h.button===2||a)&&l.preventDefault()}),onFocusOutside:_i(t.onFocusOutside,l=>l.preventDefault())})}),d7=te.forwardRef((t,e)=>{const r=dc(Wp,t.__scopeDialog),i=te.useRef(!1),s=te.useRef(!1);return H.jsx(MI,{...t,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:l=>{t.onCloseAutoFocus?.(l),l.defaultPrevented||(i.current||r.triggerRef.current?.focus(),l.preventDefault()),i.current=!1,s.current=!1},onInteractOutside:l=>{t.onInteractOutside?.(l),l.defaultPrevented||(i.current=!0,l.detail.originalEvent.type==="pointerdown"&&(s.current=!0));const h=l.target;r.triggerRef.current?.contains(h)&&l.preventDefault(),l.detail.originalEvent.type==="focusin"&&s.current&&l.preventDefault()}})}),MI=te.forwardRef((t,e)=>{const{__scopeDialog:r,trapFocus:i,onOpenAutoFocus:s,onCloseAutoFocus:l,...h}=t,a=dc(Wp,r),v=te.useRef(null),T=Cn(e,v);return fz(),H.jsxs(H.Fragment,{children:[H.jsx(lI,{asChild:!0,loop:!0,trapped:i,onMountAutoFocus:s,onUnmountAutoFocus:l,children:H.jsx(oI,{role:"dialog",id:a.contentId,"aria-describedby":a.descriptionId,"aria-labelledby":a.titleId,"data-state":o2(a.open),...h,ref:T,onDismiss:()=>a.onOpenChange(!1)})}),H.jsxs(H.Fragment,{children:[H.jsx(p7,{titleId:a.titleId}),H.jsx(m7,{contentRef:v,descriptionId:a.descriptionId})]})]})}),s2="DialogTitle",PI=te.forwardRef((t,e)=>{const{__scopeDialog:r,...i}=t,s=dc(s2,r);return H.jsx(Qi.h2,{id:s.titleId,...i,ref:e})});PI.displayName=s2;var RI="DialogDescription",II=te.forwardRef((t,e)=>{const{__scopeDialog:r,...i}=t,s=dc(RI,r);return H.jsx(Qi.p,{id:s.descriptionId,...i,ref:e})});II.displayName=RI;var kI="DialogClose",BI=te.forwardRef((t,e)=>{const{__scopeDialog:r,...i}=t,s=dc(kI,r);return H.jsx(Qi.button,{type:"button",...i,ref:e,onClick:_i(t.onClick,()=>s.onOpenChange(!1))})});BI.displayName=kI;function o2(t){return t?"open":"closed"}var LI="DialogTitleWarning",[Coe,DI]=AF(LI,{contentName:Wp,titleName:s2,docsSlug:"dialog"}),p7=({titleId:t})=>{const e=DI(LI),r=`\`${e.contentName}\` requires a \`${e.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${e.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${e.docsSlug}`;return te.useEffect(()=>{t&&(document.getElementById(t)||console.error(r))},[r,t]),null},f7="DialogDescriptionWarning",m7=({contentRef:t,descriptionId:e})=>{const i=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${DI(f7).contentName}}.`;return te.useEffect(()=>{const s=t.current?.getAttribute("aria-describedby");e&&s&&(document.getElementById(e)||console.warn(i))},[i,t,e]),null},g7=xI,_7=EI,y7=TI,v7=SI,b7=CI,x7=PI,w7=II,E7=BI;function a2({...t}){return H.jsx(g7,{"data-slot":"dialog",...t})}function A7({...t}){return H.jsx(_7,{"data-slot":"dialog-trigger",...t})}function T7({...t}){return H.jsx(y7,{"data-slot":"dialog-portal",...t})}function S7({className:t,...e}){return H.jsx(v7,{"data-slot":"dialog-overlay",className:Vi("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",t),...e})}function l2({className:t,children:e,...r}){return H.jsxs(T7,{"data-slot":"dialog-portal",children:[H.jsx(S7,{}),H.jsxs(b7,{"data-slot":"dialog-content",className:Vi("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",t),...r,children:[e,H.jsxs(E7,{className:"ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",children:[H.jsx(pw,{}),H.jsx("span",{className:"sr-only",children:"Close"})]})]})]})}function c2({className:t,...e}){return H.jsx("div",{"data-slot":"dialog-header",className:Vi("flex flex-col gap-2 text-center sm:text-left",t),...e})}function u2({className:t,...e}){return H.jsx(x7,{"data-slot":"dialog-title",className:Vi("text-lg leading-none font-semibold",t),...e})}function h2({className:t,...e}){return H.jsx(w7,{"data-slot":"dialog-description",className:Vi("text-muted-foreground text-sm",t),...e})}var C7=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],M7=C7.reduce((t,e)=>{const r=Kw(`Primitive.${e}`),i=te.forwardRef((s,l)=>{const{asChild:h,...a}=s,v=h?r:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),H.jsx(v,{...a,ref:l})});return i.displayName=`Primitive.${e}`,{...t,[e]:i}},{}),P7="Label",NI=te.forwardRef((t,e)=>H.jsx(M7.label,{...t,ref:e,onMouseDown:r=>{r.target.closest("button, input, select, textarea")||(t.onMouseDown?.(r),!r.defaultPrevented&&r.detail>1&&r.preventDefault())}}));NI.displayName=P7;var R7=NI;function Fy({className:t,...e}){return H.jsx(R7,{"data-slot":"label",className:Vi("flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",t),...e})}function I7({className:t,...e}){return H.jsx("textarea",{"data-slot":"textarea",className:Vi("resize-none border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-input-background px-3 py-2 text-base transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),...e})}const k7=()=>H.jsxs(a2,{children:[H.jsx(A7,{asChild:!0,children:H.jsx(lc,{size:"icon",className:"h-14 w-14 rounded-full bg-primary hover:bg-primary/90 shadow-[0_0_20px_rgba(249,115,22,0.4)] border border-white/20",children:H.jsx(R6,{className:"h-6 w-6"})})}),H.jsxs(l2,{className:"sm:max-w-[425px] bg-background/95 backdrop-blur-xl border-white/10",children:[H.jsxs(c2,{children:[H.jsx(u2,{children:"Host an Event"}),H.jsx(h2,{children:"Create a new event to gather people."})]}),H.jsxs("div",{className:"grid gap-4 py-4",children:[H.jsxs("div",{className:"grid gap-2",children:[H.jsx(Fy,{htmlFor:"name",children:"Event Name"}),H.jsx(v0,{id:"name",placeholder:"e.g., Sunset Yoga",className:"bg-white/5 border-white/10"})]}),H.jsxs("div",{className:"grid gap-2",children:[H.jsx(Fy,{htmlFor:"description",children:"Description"}),H.jsx(I7,{id:"description",placeholder:"What's the vibe?",className:"bg-white/5 border-white/10"})]}),H.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[H.jsxs("div",{className:"grid gap-2",children:[H.jsx(Fy,{htmlFor:"date",children:"Date"}),H.jsx(v0,{id:"date",type:"date",className:"bg-white/5 border-white/10"})]}),H.jsxs("div",{className:"grid gap-2",children:[H.jsx(Fy,{htmlFor:"time",children:"Time"}),H.jsx(v0,{id:"time",type:"time",className:"bg-white/5 border-white/10"})]})]})]}),H.jsx("div",{className:"flex justify-end",children:H.jsx(lc,{type:"submit",children:"Create Event"})})]})]});(function(){try{if(typeof document<"u"){var t=document.createElement("style");t.appendChild(document.createTextNode(`.maplibregl-map{font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif;overflow:hidden;position:relative;-webkit-tap-highlight-color:rgb(0,0,0,0)}.maplibregl-canvas{left:0;position:absolute;top:0}.maplibregl-map:fullscreen{height:100%;width:100%}.maplibregl-ctrl-group button.maplibregl-ctrl-compass{touch-action:none}.maplibregl-canvas-container.maplibregl-interactive,.maplibregl-ctrl-group button.maplibregl-ctrl-compass{cursor:grab;-webkit-user-select:none;-moz-user-select:none;user-select:none}.maplibregl-canvas-container.maplibregl-interactive.maplibregl-track-pointer{cursor:pointer}.maplibregl-canvas-container.maplibregl-interactive:active,.maplibregl-ctrl-group button.maplibregl-ctrl-compass:active{cursor:grabbing}.maplibregl-canvas-container.maplibregl-touch-zoom-rotate,.maplibregl-canvas-container.maplibregl-touch-zoom-rotate .maplibregl-canvas{touch-action:pan-x pan-y}.maplibregl-canvas-container.maplibregl-touch-drag-pan,.maplibregl-canvas-container.maplibregl-touch-drag-pan .maplibregl-canvas{touch-action:pinch-zoom}.maplibregl-canvas-container.maplibregl-touch-zoom-rotate.maplibregl-touch-drag-pan,.maplibregl-canvas-container.maplibregl-touch-zoom-rotate.maplibregl-touch-drag-pan .maplibregl-canvas{touch-action:none}.maplibregl-canvas-container.maplibregl-touch-drag-pan.maplibregl-cooperative-gestures,.maplibregl-canvas-container.maplibregl-touch-drag-pan.maplibregl-cooperative-gestures .maplibregl-canvas{touch-action:pan-x pan-y}.maplibregl-ctrl-bottom-left,.maplibregl-ctrl-bottom-right,.maplibregl-ctrl-top-left,.maplibregl-ctrl-top-right{pointer-events:none;position:absolute;z-index:2}.maplibregl-ctrl-top-left{left:0;top:0}.maplibregl-ctrl-top-right{right:0;top:0}.maplibregl-ctrl-bottom-left{bottom:0;left:0}.maplibregl-ctrl-bottom-right{bottom:0;right:0}.maplibregl-ctrl{clear:both;pointer-events:auto;transform:translate(0)}.maplibregl-ctrl-top-left .maplibregl-ctrl{float:left;margin:10px 0 0 10px}.maplibregl-ctrl-top-right .maplibregl-ctrl{float:right;margin:10px 10px 0 0}.maplibregl-ctrl-bottom-left .maplibregl-ctrl{float:left;margin:0 0 10px 10px}.maplibregl-ctrl-bottom-right .maplibregl-ctrl{float:right;margin:0 10px 10px 0}.maplibregl-ctrl-group{background:#fff;border-radius:4px}.maplibregl-ctrl-group:not(:empty){box-shadow:0 0 0 2px #0000001a}@media (forced-colors:active){.maplibregl-ctrl-group:not(:empty){box-shadow:0 0 0 2px ButtonText}}.maplibregl-ctrl-group button{background-color:transparent;border:0;box-sizing:border-box;cursor:pointer;display:block;height:29px;outline:none;padding:0;width:29px}.maplibregl-ctrl-group button+button{border-top:1px solid #ddd}.maplibregl-ctrl button .maplibregl-ctrl-icon{background-position:50%;background-repeat:no-repeat;display:block;height:100%;width:100%}@media (forced-colors:active){.maplibregl-ctrl-icon{background-color:transparent}.maplibregl-ctrl-group button+button{border-top:1px solid ButtonText}}.maplibregl-ctrl button::-moz-focus-inner{border:0;padding:0}.maplibregl-ctrl-attrib-button:focus,.maplibregl-ctrl-group button:focus{box-shadow:0 0 2px 2px #0096ff}.maplibregl-ctrl button:disabled{cursor:not-allowed}.maplibregl-ctrl button:disabled .maplibregl-ctrl-icon{opacity:.25}@media (hover:hover){.maplibregl-ctrl button:not(:disabled):hover{background-color:#0000000d}}.maplibregl-ctrl button:not(:disabled):active{background-color:#0000000d}.maplibregl-ctrl-group button:focus:focus-visible{box-shadow:0 0 2px 2px #0096ff}.maplibregl-ctrl-group button:focus:not(:focus-visible){box-shadow:none}.maplibregl-ctrl-group button:focus:first-child{border-radius:4px 4px 0 0}.maplibregl-ctrl-group button:focus:last-child{border-radius:0 0 4px 4px}.maplibregl-ctrl-group button:focus:only-child{border-radius:inherit}.maplibregl-ctrl button.maplibregl-ctrl-zoom-out .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23333' viewBox='0 0 29 29'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-zoom-in .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23333' viewBox='0 0 29 29'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5'/%3E%3C/svg%3E")}@media (forced-colors:active){.maplibregl-ctrl button.maplibregl-ctrl-zoom-out .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23fff' viewBox='0 0 29 29'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-zoom-in .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23fff' viewBox='0 0 29 29'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5'/%3E%3C/svg%3E")}}@media (forced-colors:active) and (prefers-color-scheme:light){.maplibregl-ctrl button.maplibregl-ctrl-zoom-out .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 29 29'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-zoom-in .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 29 29'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5'/%3E%3C/svg%3E")}}.maplibregl-ctrl button.maplibregl-ctrl-fullscreen .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23333' viewBox='0 0 29 29'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-shrink .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 29 29'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1z'/%3E%3C/svg%3E")}@media (forced-colors:active){.maplibregl-ctrl button.maplibregl-ctrl-fullscreen .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23fff' viewBox='0 0 29 29'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-shrink .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23fff' viewBox='0 0 29 29'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1z'/%3E%3C/svg%3E")}}@media (forced-colors:active) and (prefers-color-scheme:light){.maplibregl-ctrl button.maplibregl-ctrl-fullscreen .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 29 29'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-shrink .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 29 29'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1z'/%3E%3C/svg%3E")}}.maplibregl-ctrl button.maplibregl-ctrl-compass .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23333' viewBox='0 0 29 29'%3E%3Cpath d='m10.5 14 4-8 4 8z'/%3E%3Cpath fill='%23ccc' d='m10.5 16 4 8 4-8z'/%3E%3C/svg%3E")}@media (forced-colors:active){.maplibregl-ctrl button.maplibregl-ctrl-compass .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23fff' viewBox='0 0 29 29'%3E%3Cpath d='m10.5 14 4-8 4 8z'/%3E%3Cpath fill='%23ccc' d='m10.5 16 4 8 4-8z'/%3E%3C/svg%3E")}}@media (forced-colors:active) and (prefers-color-scheme:light){.maplibregl-ctrl button.maplibregl-ctrl-compass .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 29 29'%3E%3Cpath d='m10.5 14 4-8 4 8z'/%3E%3Cpath fill='%23ccc' d='m10.5 16 4 8 4-8z'/%3E%3C/svg%3E")}}.maplibregl-ctrl button.maplibregl-ctrl-globe .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='22' height='22' fill='none' stroke='%23333' viewBox='0 0 22 22'%3E%3Ccircle cx='11' cy='11' r='8.5'/%3E%3Cpath d='M17.5 11c0 4.819-3.02 8.5-6.5 8.5S4.5 15.819 4.5 11 7.52 2.5 11 2.5s6.5 3.681 6.5 8.5Z'/%3E%3Cpath d='M13.5 11c0 2.447-.331 4.64-.853 6.206-.262.785-.562 1.384-.872 1.777-.314.399-.58.517-.775.517s-.461-.118-.775-.517c-.31-.393-.61-.992-.872-1.777C8.831 15.64 8.5 13.446 8.5 11s.331-4.64.853-6.206c.262-.785.562-1.384.872-1.777.314-.399.58-.517.775-.517s.461.118.775.517c.31.393.61.992.872 1.777.522 1.565.853 3.76.853 6.206Z'/%3E%3Cpath d='M11 7.5c-1.909 0-3.622-.166-4.845-.428-.616-.132-1.08-.283-1.379-.434a1.3 1.3 0 0 1-.224-.138q.07-.058.224-.138c.299-.151.763-.302 1.379-.434C7.378 5.666 9.091 5.5 11 5.5s3.622.166 4.845.428c.616.132 1.08.283 1.379.434.105.053.177.1.224.138q-.07.058-.224.138c-.299.151-.763.302-1.379.434-1.223.262-2.936.428-4.845.428ZM4.486 6.436ZM11 16.5c-1.909 0-3.622-.166-4.845-.428-.616-.132-1.08-.283-1.379-.434a1.3 1.3 0 0 1-.224-.138 1.3 1.3 0 0 1 .224-.138c.299-.151.763-.302 1.379-.434C7.378 14.666 9.091 14.5 11 14.5s3.622.166 4.845.428c.616.132 1.08.283 1.379.434.105.053.177.1.224.138a1.3 1.3 0 0 1-.224.138c-.299.151-.763.302-1.379.434-1.223.262-2.936.428-4.845.428Zm-6.514-1.064ZM11 12.5c-2.46 0-4.672-.222-6.255-.574-.796-.177-1.406-.38-1.805-.59a1.5 1.5 0 0 1-.39-.272.3.3 0 0 1-.047-.064.3.3 0 0 1 .048-.064c.066-.073.189-.167.389-.272.399-.21 1.009-.413 1.805-.59C6.328 9.722 8.54 9.5 11 9.5s4.672.222 6.256.574c.795.177 1.405.38 1.804.59.2.105.323.2.39.272a.3.3 0 0 1 .047.064.3.3 0 0 1-.048.064 1.4 1.4 0 0 1-.389.272c-.399.21-1.009.413-1.804.59-1.584.352-3.796.574-6.256.574Zm-8.501-1.51v.002zm0 .018v.002zm17.002.002v-.002zm0-.018v-.002z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-globe-enabled .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='22' height='22' fill='none' stroke='%2333b5e5' viewBox='0 0 22 22'%3E%3Ccircle cx='11' cy='11' r='8.5'/%3E%3Cpath d='M17.5 11c0 4.819-3.02 8.5-6.5 8.5S4.5 15.819 4.5 11 7.52 2.5 11 2.5s6.5 3.681 6.5 8.5Z'/%3E%3Cpath d='M13.5 11c0 2.447-.331 4.64-.853 6.206-.262.785-.562 1.384-.872 1.777-.314.399-.58.517-.775.517s-.461-.118-.775-.517c-.31-.393-.61-.992-.872-1.777C8.831 15.64 8.5 13.446 8.5 11s.331-4.64.853-6.206c.262-.785.562-1.384.872-1.777.314-.399.58-.517.775-.517s.461.118.775.517c.31.393.61.992.872 1.777.522 1.565.853 3.76.853 6.206Z'/%3E%3Cpath d='M11 7.5c-1.909 0-3.622-.166-4.845-.428-.616-.132-1.08-.283-1.379-.434a1.3 1.3 0 0 1-.224-.138q.07-.058.224-.138c.299-.151.763-.302 1.379-.434C7.378 5.666 9.091 5.5 11 5.5s3.622.166 4.845.428c.616.132 1.08.283 1.379.434.105.053.177.1.224.138q-.07.058-.224.138c-.299.151-.763.302-1.379.434-1.223.262-2.936.428-4.845.428ZM4.486 6.436ZM11 16.5c-1.909 0-3.622-.166-4.845-.428-.616-.132-1.08-.283-1.379-.434a1.3 1.3 0 0 1-.224-.138 1.3 1.3 0 0 1 .224-.138c.299-.151.763-.302 1.379-.434C7.378 14.666 9.091 14.5 11 14.5s3.622.166 4.845.428c.616.132 1.08.283 1.379.434.105.053.177.1.224.138a1.3 1.3 0 0 1-.224.138c-.299.151-.763.302-1.379.434-1.223.262-2.936.428-4.845.428Zm-6.514-1.064ZM11 12.5c-2.46 0-4.672-.222-6.255-.574-.796-.177-1.406-.38-1.805-.59a1.5 1.5 0 0 1-.39-.272.3.3 0 0 1-.047-.064.3.3 0 0 1 .048-.064c.066-.073.189-.167.389-.272.399-.21 1.009-.413 1.805-.59C6.328 9.722 8.54 9.5 11 9.5s4.672.222 6.256.574c.795.177 1.405.38 1.804.59.2.105.323.2.39.272a.3.3 0 0 1 .047.064.3.3 0 0 1-.048.064 1.4 1.4 0 0 1-.389.272c-.399.21-1.009.413-1.804.59-1.584.352-3.796.574-6.256.574Zm-8.501-1.51v.002zm0 .018v.002zm17.002.002v-.002zm0-.018v-.002z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-terrain .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='22' height='22' fill='%23333' viewBox='0 0 22 22'%3E%3Cpath d='m1.754 13.406 4.453-4.851 3.09 3.09 3.281 3.277.969-.969-3.309-3.312 3.844-4.121 6.148 6.886h1.082v-.855l-7.207-8.07-4.84 5.187L6.169 6.57l-5.48 5.965v.871ZM.688 16.844h20.625v1.375H.688Zm0 0'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-terrain-enabled .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='22' height='22' fill='%2333b5e5' viewBox='0 0 22 22'%3E%3Cpath d='m1.754 13.406 4.453-4.851 3.09 3.09 3.281 3.277.969-.969-3.309-3.312 3.844-4.121 6.148 6.886h1.082v-.855l-7.207-8.07-4.84 5.187L6.169 6.57l-5.48 5.965v.871ZM.688 16.844h20.625v1.375H.688Zm0 0'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23333' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate:disabled .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23aaa' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath fill='red' d='m14 5 1 1-9 9-1-1z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-active .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%2333b5e5' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-active-error .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23e58978' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-background .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%2333b5e5' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-background-error .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23e54e33' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-waiting .maplibregl-ctrl-icon{animation:maplibregl-spin 2s linear infinite}@media (forced-colors:active){.maplibregl-ctrl button.maplibregl-ctrl-geolocate .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23fff' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate:disabled .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23999' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath fill='red' d='m14 5 1 1-9 9-1-1z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-active .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%2333b5e5' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-active-error .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23e58978' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-background .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%2333b5e5' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-background-error .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23e54e33' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3C/svg%3E")}}@media (forced-colors:active) and (prefers-color-scheme:light){.maplibregl-ctrl button.maplibregl-ctrl-geolocate .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate:disabled .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23666' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath fill='red' d='m14 5 1 1-9 9-1-1z'/%3E%3C/svg%3E")}}@keyframes maplibregl-spin{0%{transform:rotate(0)}to{transform:rotate(1turn)}}a.maplibregl-ctrl-logo{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='88' height='23' fill='none'%3E%3Cpath fill='%23000' fill-opacity='.4' fill-rule='evenodd' d='M17.408 16.796h-1.827l2.501-12.095h.198l3.324 6.533.988 2.19.988-2.19 3.258-6.533h.181l2.6 12.095h-1.81l-1.218-5.644-.362-1.71-.658 1.71-2.929 5.644h-.098l-2.914-5.644-.757-1.71-.345 1.71zm1.958-3.42-.726 3.663a1.255 1.255 0 0 1-1.232 1.011h-1.827a1.255 1.255 0 0 1-1.229-1.509l2.501-12.095a1.255 1.255 0 0 1 1.23-1.001h.197a1.25 1.25 0 0 1 1.12.685l3.19 6.273 3.125-6.263a1.25 1.25 0 0 1 1.123-.695h.181a1.255 1.255 0 0 1 1.227.991l1.443 6.71a5 5 0 0 1 .314-.787l.009-.016a4.6 4.6 0 0 1 1.777-1.887c.782-.46 1.668-.667 2.611-.667a4.6 4.6 0 0 1 1.7.32l.306.134c.21-.16.474-.256.759-.256h1.694a1.255 1.255 0 0 1 1.212.925 1.255 1.255 0 0 1 1.212-.925h1.711c.284 0 .545.094.755.252.613-.3 1.312-.45 2.075-.45 1.356 0 2.557.445 3.482 1.4q.47.48.763 1.064V4.701a1.255 1.255 0 0 1 1.255-1.255h1.86A1.255 1.255 0 0 1 54.44 4.7v9.194h2.217c.19 0 .37.043.532.118v-4.77c0-.356.147-.678.385-.906a2.42 2.42 0 0 1-.682-1.71c0-.665.267-1.253.735-1.7a2.45 2.45 0 0 1 1.722-.674 2.43 2.43 0 0 1 1.705.675q.318.302.504.683V4.7a1.255 1.255 0 0 1 1.255-1.255h1.744A1.255 1.255 0 0 1 65.812 4.7v3.335a4.8 4.8 0 0 1 1.526-.246c.938 0 1.817.214 2.59.69a4.47 4.47 0 0 1 1.67 1.743v-.98a1.255 1.255 0 0 1 1.256-1.256h1.777c.233 0 .451.064.639.174a3.4 3.4 0 0 1 1.567-.372c.346 0 .861.02 1.285.232a1.25 1.25 0 0 1 .689 1.004 4.7 4.7 0 0 1 .853-.588c.795-.44 1.675-.647 2.61-.647 1.385 0 2.65.39 3.525 1.396.836.938 1.168 2.173 1.168 3.528q-.001.515-.056 1.051a1.255 1.255 0 0 1-.947 1.09l.408.952a1.255 1.255 0 0 1-.477 1.552c-.418.268-.92.463-1.458.612-.613.171-1.304.244-2.049.244-1.06 0-2.043-.207-2.886-.698l-.015-.008c-.798-.48-1.419-1.135-1.818-1.963l-.004-.008a5.8 5.8 0 0 1-.548-2.512q0-.429.053-.843a1.3 1.3 0 0 1-.333-.086l-.166-.004c-.223 0-.426.062-.643.228-.03.024-.142.139-.142.59v3.883a1.255 1.255 0 0 1-1.256 1.256h-1.777a1.255 1.255 0 0 1-1.256-1.256V15.69l-.032.057a4.8 4.8 0 0 1-1.86 1.833 5.04 5.04 0 0 1-2.484.634 4.5 4.5 0 0 1-1.935-.424 1.25 1.25 0 0 1-.764.258h-1.71a1.255 1.255 0 0 1-1.256-1.255V7.687a2.4 2.4 0 0 1-.428.625c.253.23.412.561.412.93v7.553a1.255 1.255 0 0 1-1.256 1.255h-1.843a1.25 1.25 0 0 1-.894-.373c-.228.23-.544.373-.894.373H51.32a1.255 1.255 0 0 1-1.256-1.255v-1.251l-.061.117a4.7 4.7 0 0 1-1.782 1.884 4.77 4.77 0 0 1-2.485.67 5.6 5.6 0 0 1-1.485-.188l.009 2.764a1.255 1.255 0 0 1-1.255 1.259h-1.729a1.255 1.255 0 0 1-1.255-1.255v-3.537a1.255 1.255 0 0 1-1.167.793h-1.679a1.25 1.25 0 0 1-.77-.263 4.5 4.5 0 0 1-1.945.429c-.885 0-1.724-.21-2.495-.632l-.017-.01a5 5 0 0 1-1.081-.836 1.255 1.255 0 0 1-1.254 1.312h-1.81a1.255 1.255 0 0 1-1.228-.99l-.782-3.625-2.044 3.939a1.25 1.25 0 0 1-1.115.676h-.098a1.25 1.25 0 0 1-1.116-.68l-2.061-3.994zM35.92 16.63l.207-.114.223-.15q.493-.356.735-.785l.061-.118.033 1.332h1.678V9.242h-1.694l-.033 1.267q-.133-.329-.526-.658l-.032-.028a3.2 3.2 0 0 0-.668-.428l-.27-.12a3.3 3.3 0 0 0-1.235-.23q-1.136-.001-1.974.493a3.36 3.36 0 0 0-1.3 1.382q-.445.89-.444 2.074 0 1.2.51 2.107a3.8 3.8 0 0 0 1.382 1.381 3.9 3.9 0 0 0 1.893.477q.795 0 1.455-.33zm-2.789-5.38q-.576.675-.575 1.762 0 1.102.559 1.794.576.675 1.645.675a2.25 2.25 0 0 0 .934-.19 2.2 2.2 0 0 0 .468-.29l.178-.161a2.2 2.2 0 0 0 .397-.561q.244-.5.244-1.15v-.115q0-.708-.296-1.267l-.043-.077a2.2 2.2 0 0 0-.633-.709l-.13-.086-.047-.028a2.1 2.1 0 0 0-1.073-.285q-1.052 0-1.629.692zm2.316 2.706c.163-.17.28-.407.28-.83v-.114c0-.292-.06-.508-.15-.68a.96.96 0 0 0-.353-.389.85.85 0 0 0-.464-.127c-.4 0-.56.114-.664.239l-.01.012c-.148.174-.275.45-.275.945 0 .506.122.801.27.99.097.11.266.224.68.224.303 0 .504-.09.687-.269zm7.545 1.705a2.6 2.6 0 0 0 .331.423q.319.33.755.548l.173.074q.65.255 1.49.255 1.02 0 1.844-.493a3.45 3.45 0 0 0 1.316-1.4q.493-.904.493-2.089 0-1.909-.988-2.913-.988-1.02-2.584-1.02-.898 0-1.575.347a3 3 0 0 0-.415.262l-.199.166a3.4 3.4 0 0 0-.64.82V9.242h-1.712v11.553h1.729l-.017-5.134zm.53-1.138q.206.29.48.5l.155.11.053.034q.51.296 1.119.297 1.07 0 1.645-.675.577-.69.576-1.762 0-1.119-.576-1.777-.558-.675-1.645-.675-.435 0-.835.16a2 2 0 0 0-.284.136 2 2 0 0 0-.363.254 2.2 2.2 0 0 0-.46.569l-.082.162a2.6 2.6 0 0 0-.213 1.072v.115q0 .707.296 1.267l.135.211zm.964-.818a1.1 1.1 0 0 0 .367.385.94.94 0 0 0 .476.118c.423 0 .59-.117.687-.23.159-.194.28-.478.28-.95 0-.53-.133-.8-.266-.952l-.021-.025c-.078-.094-.231-.221-.68-.221a1 1 0 0 0-.503.135l-.012.007a.86.86 0 0 0-.335.343c-.073.133-.132.324-.132.614v.115a1.4 1.4 0 0 0 .14.66zm15.7-6.222q.347-.346.346-.856a1.05 1.05 0 0 0-.345-.79 1.18 1.18 0 0 0-.84-.329q-.51 0-.855.33a1.05 1.05 0 0 0-.346.79q0 .51.346.855.345.346.856.346.51 0 .839-.346zm4.337 9.314.033-1.332q.191.403.59.747l.098.081a4 4 0 0 0 .316.224l.223.122a3.2 3.2 0 0 0 1.44.322 3.8 3.8 0 0 0 1.875-.477 3.5 3.5 0 0 0 1.382-1.366q.527-.89.526-2.09 0-1.184-.444-2.073a3.24 3.24 0 0 0-1.283-1.399q-.823-.51-1.942-.51a3.5 3.5 0 0 0-1.527.344l-.086.043-.165.09a3 3 0 0 0-.33.214q-.432.315-.656.707a2 2 0 0 0-.099.198l.082-1.283V4.701h-1.744v12.095zm.473-2.509a2.5 2.5 0 0 0 .566.7q.117.098.245.18l.144.08a2.1 2.1 0 0 0 .975.232q1.07 0 1.645-.675.576-.69.576-1.778 0-1.102-.576-1.777-.56-.691-1.645-.692a2.2 2.2 0 0 0-1.015.235q-.22.113-.415.282l-.15.142a2.1 2.1 0 0 0-.42.594q-.223.479-.223 1.1v.115q0 .705.293 1.26zm2.616-.293c.157-.191.28-.479.28-.967 0-.51-.13-.79-.276-.961l-.021-.026c-.082-.1-.232-.225-.67-.225a.87.87 0 0 0-.681.279l-.012.011c-.154.155-.274.38-.274.807v.115c0 .285.057.499.144.669a1.1 1.1 0 0 0 .367.405c.137.082.28.123.455.123.423 0 .59-.118.686-.23zm8.266-3.013q.345-.13.724-.14l.069-.002q.493 0 .642.099l.247-1.794q-.196-.099-.717-.099a2.3 2.3 0 0 0-.545.063 2 2 0 0 0-.411.148 2.2 2.2 0 0 0-.4.249 2.5 2.5 0 0 0-.485.499 2.7 2.7 0 0 0-.32.581l-.05.137v-1.48h-1.778v7.553h1.777v-3.884q0-.546.159-.943a1.5 1.5 0 0 1 .466-.636 2.5 2.5 0 0 1 .399-.253 2 2 0 0 1 .224-.099zm9.784 2.656.05-.922q0-1.743-.856-2.698-.838-.97-2.584-.97-1.119-.001-2.007.493a3.46 3.46 0 0 0-1.4 1.382q-.493.906-.493 2.106 0 1.07.428 1.975.428.89 1.332 1.432.906.526 2.255.526.973 0 1.668-.185l.044-.012.135-.04q.613-.184.984-.421l-.542-1.267q-.3.162-.642.274l-.297.087q-.51.131-1.3.131-.954 0-1.497-.444a1.6 1.6 0 0 1-.192-.193q-.366-.44-.512-1.234l-.004-.021zm-5.427-1.256-.003.022h3.752v-.138q-.011-.727-.288-1.118a1 1 0 0 0-.156-.176q-.46-.428-1.316-.428-.986 0-1.494.604-.379.45-.494 1.234zm-27.053 2.77V4.7h-1.86v12.095h5.333V15.15zm7.103-5.908v7.553h-1.843V9.242h1.843z'/%3E%3Cpath fill='%23fff' d='m19.63 11.151-.757-1.71-.345 1.71-1.12 5.644h-1.827L18.083 4.7h.197l3.325 6.533.988 2.19.988-2.19L26.839 4.7h.181l2.6 12.095h-1.81l-1.218-5.644-.362-1.71-.658 1.71-2.93 5.644h-.098l-2.913-5.644zm14.836 5.81q-1.02 0-1.893-.478a3.8 3.8 0 0 1-1.381-1.382q-.51-.906-.51-2.106 0-1.185.444-2.074a3.36 3.36 0 0 1 1.3-1.382q.839-.494 1.974-.494a3.3 3.3 0 0 1 1.234.231 3.3 3.3 0 0 1 .97.575q.396.33.527.659l.033-1.267h1.694v7.553H37.18l-.033-1.332q-.279.593-1.02 1.053a3.17 3.17 0 0 1-1.662.444zm.296-1.482q.938 0 1.58-.642.642-.66.642-1.711v-.115q0-.708-.296-1.267a2.2 2.2 0 0 0-.807-.872 2.1 2.1 0 0 0-1.119-.313q-1.053 0-1.629.692-.575.675-.575 1.76 0 1.103.559 1.795.577.675 1.645.675zm6.521-6.237h1.711v1.4q.906-1.597 2.83-1.597 1.596 0 2.584 1.02.988 1.005.988 2.914 0 1.185-.493 2.09a3.46 3.46 0 0 1-1.316 1.399 3.5 3.5 0 0 1-1.844.493q-.954 0-1.662-.329a2.67 2.67 0 0 1-1.086-.97l.017 5.134h-1.728zm4.048 6.22q1.07 0 1.645-.674.577-.69.576-1.762 0-1.119-.576-1.777-.558-.675-1.645-.675-.592 0-1.12.296-.51.28-.822.823-.296.527-.296 1.234v.115q0 .708.296 1.267.313.543.823.855.51.296 1.119.297z'/%3E%3Cpath fill='%23e1e3e9' d='M51.325 4.7h1.86v10.45h3.473v1.646h-5.333zm7.12 4.542h1.843v7.553h-1.843zm.905-1.415a1.16 1.16 0 0 1-.856-.346 1.17 1.17 0 0 1-.346-.856 1.05 1.05 0 0 1 .346-.79q.346-.329.856-.329.494 0 .839.33a1.05 1.05 0 0 1 .345.79 1.16 1.16 0 0 1-.345.855q-.33.346-.84.346zm7.875 9.133a3.17 3.17 0 0 1-1.662-.444q-.723-.46-1.004-1.053l-.033 1.332h-1.71V4.701h1.743v4.657l-.082 1.283q.279-.658 1.086-1.119a3.5 3.5 0 0 1 1.778-.477q1.119 0 1.942.51a3.24 3.24 0 0 1 1.283 1.4q.445.888.444 2.072 0 1.201-.526 2.09a3.5 3.5 0 0 1-1.382 1.366 3.8 3.8 0 0 1-1.876.477zm-.296-1.481q1.069 0 1.645-.675.577-.69.577-1.778 0-1.102-.577-1.776-.56-.691-1.645-.692a2.12 2.12 0 0 0-1.58.659q-.642.641-.642 1.694v.115q0 .71.296 1.267a2.4 2.4 0 0 0 .807.872 2.1 2.1 0 0 0 1.119.313zm5.927-6.237h1.777v1.481q.263-.757.856-1.217a2.14 2.14 0 0 1 1.349-.46q.527 0 .724.098l-.247 1.794q-.149-.099-.642-.099-.774 0-1.416.494-.626.493-.626 1.58v3.883h-1.777V9.242zm9.534 7.718q-1.35 0-2.255-.526-.904-.543-1.332-1.432a4.6 4.6 0 0 1-.428-1.975q0-1.2.493-2.106a3.46 3.46 0 0 1 1.4-1.382q.889-.495 2.007-.494 1.744 0 2.584.97.855.956.856 2.7 0 .444-.05.92h-5.43q.18 1.005.708 1.45.542.443 1.497.443.79 0 1.3-.131a4 4 0 0 0 .938-.362l.542 1.267q-.411.263-1.119.46-.708.198-1.711.197zm1.596-4.558q.016-1.02-.444-1.432-.46-.428-1.316-.428-1.728 0-1.991 1.86z'/%3E%3Cpath d='M5.074 15.948a.484.657 0 0 0-.486.659v1.84a.484.657 0 0 0 .486.659h4.101a.484.657 0 0 0 .486-.659v-1.84a.484.657 0 0 0-.486-.659zm3.56 1.16H5.617v.838h3.017z' style='fill:%23fff;fill-rule:evenodd;stroke-width:1.03600001'/%3E%3Cg style='stroke-width:1.12603545'%3E%3Cpath d='M-9.408-1.416c-3.833-.025-7.056 2.912-7.08 6.615-.02 3.08 1.653 4.832 3.107 6.268.903.892 1.721 1.74 2.32 2.902l-.525-.004c-.543-.003-.992.304-1.24.639a1.87 1.87 0 0 0-.362 1.121l-.011 1.877c-.003.402.104.787.347 1.125.244.338.688.653 1.23.656l4.142.028c.542.003.99-.306 1.238-.641a1.87 1.87 0 0 0 .363-1.121l.012-1.875a1.87 1.87 0 0 0-.348-1.127c-.243-.338-.688-.653-1.23-.656l-.518-.004c.597-1.145 1.425-1.983 2.348-2.87 1.473-1.414 3.18-3.149 3.2-6.226-.016-3.59-2.923-6.684-6.993-6.707m-.006 1.1v.002c3.274.02 5.92 2.532 5.9 5.6-.017 2.706-1.39 4.026-2.863 5.44-1.034.994-2.118 2.033-2.814 3.633-.018.041-.052.055-.075.065q-.013.004-.02.01a.34.34 0 0 1-.226.084.34.34 0 0 1-.224-.086l-.092-.077c-.699-1.615-1.768-2.669-2.781-3.67-1.454-1.435-2.797-2.762-2.78-5.478.02-3.067 2.7-5.545 5.975-5.523m-.02 2.826c-1.62-.01-2.944 1.315-2.955 2.96-.01 1.646 1.295 2.988 2.916 2.999h.002c1.621.01 2.943-1.316 2.953-2.961.011-1.646-1.294-2.988-2.916-2.998m-.005 1.1c1.017.006 1.829.83 1.822 1.89s-.83 1.874-1.848 1.867c-1.018-.006-1.829-.83-1.822-1.89s.83-1.874 1.848-1.868m-2.155 11.857 4.14.025c.271.002.49.305.487.676l-.013 1.875c-.003.37-.224.67-.495.668l-4.14-.025c-.27-.002-.487-.306-.485-.676l.012-1.875c.003-.37.224-.67.494-.668' style='color:%23000;font-style:normal;font-variant:normal;font-weight:400;font-stretch:normal;font-size:medium;line-height:normal;font-family:sans-serif;font-variant-ligatures:normal;font-variant-position:normal;font-variant-caps:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-feature-settings:normal;text-indent:0;text-align:start;text-decoration:none;text-decoration-line:none;text-decoration-style:solid;text-decoration-color:%23000;letter-spacing:normal;word-spacing:normal;text-transform:none;writing-mode:lr-tb;direction:ltr;text-orientation:mixed;dominant-baseline:auto;baseline-shift:baseline;text-anchor:start;white-space:normal;shape-padding:0;clip-rule:evenodd;display:inline;overflow:visible;visibility:visible;opacity:1;isolation:auto;mix-blend-mode:normal;color-interpolation:sRGB;color-interpolation-filters:linearRGB;solid-color:%23000;solid-opacity:1;vector-effect:none;fill:%23000;fill-opacity:.4;fill-rule:evenodd;stroke:none;stroke-width:2.47727823;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;color-rendering:auto;image-rendering:auto;shape-rendering:auto;text-rendering:auto' transform='translate(15.553 2.85)scale(.88807)'/%3E%3Cpath d='M-9.415-.316C-12.69-.338-15.37 2.14-15.39 5.207c-.017 2.716 1.326 4.041 2.78 5.477 1.013 1 2.081 2.055 2.78 3.67l.092.076a.34.34 0 0 0 .225.086.34.34 0 0 0 .227-.083l.019-.01c.022-.009.057-.024.074-.064.697-1.6 1.78-2.64 2.814-3.634 1.473-1.414 2.847-2.733 2.864-5.44.02-3.067-2.627-5.58-5.901-5.601m-.057 8.784c1.621.011 2.944-1.315 2.955-2.96.01-1.646-1.295-2.988-2.916-2.999-1.622-.01-2.945 1.315-2.955 2.96s1.295 2.989 2.916 3' style='clip-rule:evenodd;fill:%23e1e3e9;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:2.47727823;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:.4' transform='translate(15.553 2.85)scale(.88807)'/%3E%3Cpath d='M-11.594 15.465c-.27-.002-.492.297-.494.668l-.012 1.876c-.003.371.214.673.485.675l4.14.027c.271.002.492-.298.495-.668l.012-1.877c.003-.37-.215-.672-.485-.674z' style='clip-rule:evenodd;fill:%23fff;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:2.47727823;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:.4' transform='translate(15.553 2.85)scale(.88807)'/%3E%3C/g%3E%3C/svg%3E");background-repeat:no-repeat;cursor:pointer;display:block;height:23px;margin:0 0 -4px -4px;overflow:hidden;width:88px}a.maplibregl-ctrl-logo.maplibregl-compact{width:14px}@media (forced-colors:active){a.maplibregl-ctrl-logo{background-color:transparent;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='88' height='23' fill='none'%3E%3Cpath fill='%23000' fill-opacity='.4' fill-rule='evenodd' d='M17.408 16.796h-1.827l2.501-12.095h.198l3.324 6.533.988 2.19.988-2.19 3.258-6.533h.181l2.6 12.095h-1.81l-1.218-5.644-.362-1.71-.658 1.71-2.929 5.644h-.098l-2.914-5.644-.757-1.71-.345 1.71zm1.958-3.42-.726 3.663a1.255 1.255 0 0 1-1.232 1.011h-1.827a1.255 1.255 0 0 1-1.229-1.509l2.501-12.095a1.255 1.255 0 0 1 1.23-1.001h.197a1.25 1.25 0 0 1 1.12.685l3.19 6.273 3.125-6.263a1.25 1.25 0 0 1 1.123-.695h.181a1.255 1.255 0 0 1 1.227.991l1.443 6.71a5 5 0 0 1 .314-.787l.009-.016a4.6 4.6 0 0 1 1.777-1.887c.782-.46 1.668-.667 2.611-.667a4.6 4.6 0 0 1 1.7.32l.306.134c.21-.16.474-.256.759-.256h1.694a1.255 1.255 0 0 1 1.212.925 1.255 1.255 0 0 1 1.212-.925h1.711c.284 0 .545.094.755.252.613-.3 1.312-.45 2.075-.45 1.356 0 2.557.445 3.482 1.4q.47.48.763 1.064V4.701a1.255 1.255 0 0 1 1.255-1.255h1.86A1.255 1.255 0 0 1 54.44 4.7v9.194h2.217c.19 0 .37.043.532.118v-4.77c0-.356.147-.678.385-.906a2.42 2.42 0 0 1-.682-1.71c0-.665.267-1.253.735-1.7a2.45 2.45 0 0 1 1.722-.674 2.43 2.43 0 0 1 1.705.675q.318.302.504.683V4.7a1.255 1.255 0 0 1 1.255-1.255h1.744A1.255 1.255 0 0 1 65.812 4.7v3.335a4.8 4.8 0 0 1 1.526-.246c.938 0 1.817.214 2.59.69a4.47 4.47 0 0 1 1.67 1.743v-.98a1.255 1.255 0 0 1 1.256-1.256h1.777c.233 0 .451.064.639.174a3.4 3.4 0 0 1 1.567-.372c.346 0 .861.02 1.285.232a1.25 1.25 0 0 1 .689 1.004 4.7 4.7 0 0 1 .853-.588c.795-.44 1.675-.647 2.61-.647 1.385 0 2.65.39 3.525 1.396.836.938 1.168 2.173 1.168 3.528q-.001.515-.056 1.051a1.255 1.255 0 0 1-.947 1.09l.408.952a1.255 1.255 0 0 1-.477 1.552c-.418.268-.92.463-1.458.612-.613.171-1.304.244-2.049.244-1.06 0-2.043-.207-2.886-.698l-.015-.008c-.798-.48-1.419-1.135-1.818-1.963l-.004-.008a5.8 5.8 0 0 1-.548-2.512q0-.429.053-.843a1.3 1.3 0 0 1-.333-.086l-.166-.004c-.223 0-.426.062-.643.228-.03.024-.142.139-.142.59v3.883a1.255 1.255 0 0 1-1.256 1.256h-1.777a1.255 1.255 0 0 1-1.256-1.256V15.69l-.032.057a4.8 4.8 0 0 1-1.86 1.833 5.04 5.04 0 0 1-2.484.634 4.5 4.5 0 0 1-1.935-.424 1.25 1.25 0 0 1-.764.258h-1.71a1.255 1.255 0 0 1-1.256-1.255V7.687a2.4 2.4 0 0 1-.428.625c.253.23.412.561.412.93v7.553a1.255 1.255 0 0 1-1.256 1.255h-1.843a1.25 1.25 0 0 1-.894-.373c-.228.23-.544.373-.894.373H51.32a1.255 1.255 0 0 1-1.256-1.255v-1.251l-.061.117a4.7 4.7 0 0 1-1.782 1.884 4.77 4.77 0 0 1-2.485.67 5.6 5.6 0 0 1-1.485-.188l.009 2.764a1.255 1.255 0 0 1-1.255 1.259h-1.729a1.255 1.255 0 0 1-1.255-1.255v-3.537a1.255 1.255 0 0 1-1.167.793h-1.679a1.25 1.25 0 0 1-.77-.263 4.5 4.5 0 0 1-1.945.429c-.885 0-1.724-.21-2.495-.632l-.017-.01a5 5 0 0 1-1.081-.836 1.255 1.255 0 0 1-1.254 1.312h-1.81a1.255 1.255 0 0 1-1.228-.99l-.782-3.625-2.044 3.939a1.25 1.25 0 0 1-1.115.676h-.098a1.25 1.25 0 0 1-1.116-.68l-2.061-3.994zM35.92 16.63l.207-.114.223-.15q.493-.356.735-.785l.061-.118.033 1.332h1.678V9.242h-1.694l-.033 1.267q-.133-.329-.526-.658l-.032-.028a3.2 3.2 0 0 0-.668-.428l-.27-.12a3.3 3.3 0 0 0-1.235-.23q-1.136-.001-1.974.493a3.36 3.36 0 0 0-1.3 1.382q-.445.89-.444 2.074 0 1.2.51 2.107a3.8 3.8 0 0 0 1.382 1.381 3.9 3.9 0 0 0 1.893.477q.795 0 1.455-.33zm-2.789-5.38q-.576.675-.575 1.762 0 1.102.559 1.794.576.675 1.645.675a2.25 2.25 0 0 0 .934-.19 2.2 2.2 0 0 0 .468-.29l.178-.161a2.2 2.2 0 0 0 .397-.561q.244-.5.244-1.15v-.115q0-.708-.296-1.267l-.043-.077a2.2 2.2 0 0 0-.633-.709l-.13-.086-.047-.028a2.1 2.1 0 0 0-1.073-.285q-1.052 0-1.629.692zm2.316 2.706c.163-.17.28-.407.28-.83v-.114c0-.292-.06-.508-.15-.68a.96.96 0 0 0-.353-.389.85.85 0 0 0-.464-.127c-.4 0-.56.114-.664.239l-.01.012c-.148.174-.275.45-.275.945 0 .506.122.801.27.99.097.11.266.224.68.224.303 0 .504-.09.687-.269zm7.545 1.705a2.6 2.6 0 0 0 .331.423q.319.33.755.548l.173.074q.65.255 1.49.255 1.02 0 1.844-.493a3.45 3.45 0 0 0 1.316-1.4q.493-.904.493-2.089 0-1.909-.988-2.913-.988-1.02-2.584-1.02-.898 0-1.575.347a3 3 0 0 0-.415.262l-.199.166a3.4 3.4 0 0 0-.64.82V9.242h-1.712v11.553h1.729l-.017-5.134zm.53-1.138q.206.29.48.5l.155.11.053.034q.51.296 1.119.297 1.07 0 1.645-.675.577-.69.576-1.762 0-1.119-.576-1.777-.558-.675-1.645-.675-.435 0-.835.16a2 2 0 0 0-.284.136 2 2 0 0 0-.363.254 2.2 2.2 0 0 0-.46.569l-.082.162a2.6 2.6 0 0 0-.213 1.072v.115q0 .707.296 1.267l.135.211zm.964-.818a1.1 1.1 0 0 0 .367.385.94.94 0 0 0 .476.118c.423 0 .59-.117.687-.23.159-.194.28-.478.28-.95 0-.53-.133-.8-.266-.952l-.021-.025c-.078-.094-.231-.221-.68-.221a1 1 0 0 0-.503.135l-.012.007a.86.86 0 0 0-.335.343c-.073.133-.132.324-.132.614v.115a1.4 1.4 0 0 0 .14.66zm15.7-6.222q.347-.346.346-.856a1.05 1.05 0 0 0-.345-.79 1.18 1.18 0 0 0-.84-.329q-.51 0-.855.33a1.05 1.05 0 0 0-.346.79q0 .51.346.855.345.346.856.346.51 0 .839-.346zm4.337 9.314.033-1.332q.191.403.59.747l.098.081a4 4 0 0 0 .316.224l.223.122a3.2 3.2 0 0 0 1.44.322 3.8 3.8 0 0 0 1.875-.477 3.5 3.5 0 0 0 1.382-1.366q.527-.89.526-2.09 0-1.184-.444-2.073a3.24 3.24 0 0 0-1.283-1.399q-.823-.51-1.942-.51a3.5 3.5 0 0 0-1.527.344l-.086.043-.165.09a3 3 0 0 0-.33.214q-.432.315-.656.707a2 2 0 0 0-.099.198l.082-1.283V4.701h-1.744v12.095zm.473-2.509a2.5 2.5 0 0 0 .566.7q.117.098.245.18l.144.08a2.1 2.1 0 0 0 .975.232q1.07 0 1.645-.675.576-.69.576-1.778 0-1.102-.576-1.777-.56-.691-1.645-.692a2.2 2.2 0 0 0-1.015.235q-.22.113-.415.282l-.15.142a2.1 2.1 0 0 0-.42.594q-.223.479-.223 1.1v.115q0 .705.293 1.26zm2.616-.293c.157-.191.28-.479.28-.967 0-.51-.13-.79-.276-.961l-.021-.026c-.082-.1-.232-.225-.67-.225a.87.87 0 0 0-.681.279l-.012.011c-.154.155-.274.38-.274.807v.115c0 .285.057.499.144.669a1.1 1.1 0 0 0 .367.405c.137.082.28.123.455.123.423 0 .59-.118.686-.23zm8.266-3.013q.345-.13.724-.14l.069-.002q.493 0 .642.099l.247-1.794q-.196-.099-.717-.099a2.3 2.3 0 0 0-.545.063 2 2 0 0 0-.411.148 2.2 2.2 0 0 0-.4.249 2.5 2.5 0 0 0-.485.499 2.7 2.7 0 0 0-.32.581l-.05.137v-1.48h-1.778v7.553h1.777v-3.884q0-.546.159-.943a1.5 1.5 0 0 1 .466-.636 2.5 2.5 0 0 1 .399-.253 2 2 0 0 1 .224-.099zm9.784 2.656.05-.922q0-1.743-.856-2.698-.838-.97-2.584-.97-1.119-.001-2.007.493a3.46 3.46 0 0 0-1.4 1.382q-.493.906-.493 2.106 0 1.07.428 1.975.428.89 1.332 1.432.906.526 2.255.526.973 0 1.668-.185l.044-.012.135-.04q.613-.184.984-.421l-.542-1.267q-.3.162-.642.274l-.297.087q-.51.131-1.3.131-.954 0-1.497-.444a1.6 1.6 0 0 1-.192-.193q-.366-.44-.512-1.234l-.004-.021zm-5.427-1.256-.003.022h3.752v-.138q-.011-.727-.288-1.118a1 1 0 0 0-.156-.176q-.46-.428-1.316-.428-.986 0-1.494.604-.379.45-.494 1.234zm-27.053 2.77V4.7h-1.86v12.095h5.333V15.15zm7.103-5.908v7.553h-1.843V9.242h1.843z'/%3E%3Cpath fill='%23fff' d='m19.63 11.151-.757-1.71-.345 1.71-1.12 5.644h-1.827L18.083 4.7h.197l3.325 6.533.988 2.19.988-2.19L26.839 4.7h.181l2.6 12.095h-1.81l-1.218-5.644-.362-1.71-.658 1.71-2.93 5.644h-.098l-2.913-5.644zm14.836 5.81q-1.02 0-1.893-.478a3.8 3.8 0 0 1-1.381-1.382q-.51-.906-.51-2.106 0-1.185.444-2.074a3.36 3.36 0 0 1 1.3-1.382q.839-.494 1.974-.494a3.3 3.3 0 0 1 1.234.231 3.3 3.3 0 0 1 .97.575q.396.33.527.659l.033-1.267h1.694v7.553H37.18l-.033-1.332q-.279.593-1.02 1.053a3.17 3.17 0 0 1-1.662.444zm.296-1.482q.938 0 1.58-.642.642-.66.642-1.711v-.115q0-.708-.296-1.267a2.2 2.2 0 0 0-.807-.872 2.1 2.1 0 0 0-1.119-.313q-1.053 0-1.629.692-.575.675-.575 1.76 0 1.103.559 1.795.577.675 1.645.675zm6.521-6.237h1.711v1.4q.906-1.597 2.83-1.597 1.596 0 2.584 1.02.988 1.005.988 2.914 0 1.185-.493 2.09a3.46 3.46 0 0 1-1.316 1.399 3.5 3.5 0 0 1-1.844.493q-.954 0-1.662-.329a2.67 2.67 0 0 1-1.086-.97l.017 5.134h-1.728zm4.048 6.22q1.07 0 1.645-.674.577-.69.576-1.762 0-1.119-.576-1.777-.558-.675-1.645-.675-.592 0-1.12.296-.51.28-.822.823-.296.527-.296 1.234v.115q0 .708.296 1.267.313.543.823.855.51.296 1.119.297z'/%3E%3Cpath fill='%23e1e3e9' d='M51.325 4.7h1.86v10.45h3.473v1.646h-5.333zm7.12 4.542h1.843v7.553h-1.843zm.905-1.415a1.16 1.16 0 0 1-.856-.346 1.17 1.17 0 0 1-.346-.856 1.05 1.05 0 0 1 .346-.79q.346-.329.856-.329.494 0 .839.33a1.05 1.05 0 0 1 .345.79 1.16 1.16 0 0 1-.345.855q-.33.346-.84.346zm7.875 9.133a3.17 3.17 0 0 1-1.662-.444q-.723-.46-1.004-1.053l-.033 1.332h-1.71V4.701h1.743v4.657l-.082 1.283q.279-.658 1.086-1.119a3.5 3.5 0 0 1 1.778-.477q1.119 0 1.942.51a3.24 3.24 0 0 1 1.283 1.4q.445.888.444 2.072 0 1.201-.526 2.09a3.5 3.5 0 0 1-1.382 1.366 3.8 3.8 0 0 1-1.876.477zm-.296-1.481q1.069 0 1.645-.675.577-.69.577-1.778 0-1.102-.577-1.776-.56-.691-1.645-.692a2.12 2.12 0 0 0-1.58.659q-.642.641-.642 1.694v.115q0 .71.296 1.267a2.4 2.4 0 0 0 .807.872 2.1 2.1 0 0 0 1.119.313zm5.927-6.237h1.777v1.481q.263-.757.856-1.217a2.14 2.14 0 0 1 1.349-.46q.527 0 .724.098l-.247 1.794q-.149-.099-.642-.099-.774 0-1.416.494-.626.493-.626 1.58v3.883h-1.777V9.242zm9.534 7.718q-1.35 0-2.255-.526-.904-.543-1.332-1.432a4.6 4.6 0 0 1-.428-1.975q0-1.2.493-2.106a3.46 3.46 0 0 1 1.4-1.382q.889-.495 2.007-.494 1.744 0 2.584.97.855.956.856 2.7 0 .444-.05.92h-5.43q.18 1.005.708 1.45.542.443 1.497.443.79 0 1.3-.131a4 4 0 0 0 .938-.362l.542 1.267q-.411.263-1.119.46-.708.198-1.711.197zm1.596-4.558q.016-1.02-.444-1.432-.46-.428-1.316-.428-1.728 0-1.991 1.86z'/%3E%3Cpath d='M5.074 15.948a.484.657 0 0 0-.486.659v1.84a.484.657 0 0 0 .486.659h4.101a.484.657 0 0 0 .486-.659v-1.84a.484.657 0 0 0-.486-.659zm3.56 1.16H5.617v.838h3.017z' style='fill:%23fff;fill-rule:evenodd;stroke-width:1.03600001'/%3E%3Cg style='stroke-width:1.12603545'%3E%3Cpath d='M-9.408-1.416c-3.833-.025-7.056 2.912-7.08 6.615-.02 3.08 1.653 4.832 3.107 6.268.903.892 1.721 1.74 2.32 2.902l-.525-.004c-.543-.003-.992.304-1.24.639a1.87 1.87 0 0 0-.362 1.121l-.011 1.877c-.003.402.104.787.347 1.125.244.338.688.653 1.23.656l4.142.028c.542.003.99-.306 1.238-.641a1.87 1.87 0 0 0 .363-1.121l.012-1.875a1.87 1.87 0 0 0-.348-1.127c-.243-.338-.688-.653-1.23-.656l-.518-.004c.597-1.145 1.425-1.983 2.348-2.87 1.473-1.414 3.18-3.149 3.2-6.226-.016-3.59-2.923-6.684-6.993-6.707m-.006 1.1v.002c3.274.02 5.92 2.532 5.9 5.6-.017 2.706-1.39 4.026-2.863 5.44-1.034.994-2.118 2.033-2.814 3.633-.018.041-.052.055-.075.065q-.013.004-.02.01a.34.34 0 0 1-.226.084.34.34 0 0 1-.224-.086l-.092-.077c-.699-1.615-1.768-2.669-2.781-3.67-1.454-1.435-2.797-2.762-2.78-5.478.02-3.067 2.7-5.545 5.975-5.523m-.02 2.826c-1.62-.01-2.944 1.315-2.955 2.96-.01 1.646 1.295 2.988 2.916 2.999h.002c1.621.01 2.943-1.316 2.953-2.961.011-1.646-1.294-2.988-2.916-2.998m-.005 1.1c1.017.006 1.829.83 1.822 1.89s-.83 1.874-1.848 1.867c-1.018-.006-1.829-.83-1.822-1.89s.83-1.874 1.848-1.868m-2.155 11.857 4.14.025c.271.002.49.305.487.676l-.013 1.875c-.003.37-.224.67-.495.668l-4.14-.025c-.27-.002-.487-.306-.485-.676l.012-1.875c.003-.37.224-.67.494-.668' style='color:%23000;font-style:normal;font-variant:normal;font-weight:400;font-stretch:normal;font-size:medium;line-height:normal;font-family:sans-serif;font-variant-ligatures:normal;font-variant-position:normal;font-variant-caps:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-feature-settings:normal;text-indent:0;text-align:start;text-decoration:none;text-decoration-line:none;text-decoration-style:solid;text-decoration-color:%23000;letter-spacing:normal;word-spacing:normal;text-transform:none;writing-mode:lr-tb;direction:ltr;text-orientation:mixed;dominant-baseline:auto;baseline-shift:baseline;text-anchor:start;white-space:normal;shape-padding:0;clip-rule:evenodd;display:inline;overflow:visible;visibility:visible;opacity:1;isolation:auto;mix-blend-mode:normal;color-interpolation:sRGB;color-interpolation-filters:linearRGB;solid-color:%23000;solid-opacity:1;vector-effect:none;fill:%23000;fill-opacity:.4;fill-rule:evenodd;stroke:none;stroke-width:2.47727823;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;color-rendering:auto;image-rendering:auto;shape-rendering:auto;text-rendering:auto' transform='translate(15.553 2.85)scale(.88807)'/%3E%3Cpath d='M-9.415-.316C-12.69-.338-15.37 2.14-15.39 5.207c-.017 2.716 1.326 4.041 2.78 5.477 1.013 1 2.081 2.055 2.78 3.67l.092.076a.34.34 0 0 0 .225.086.34.34 0 0 0 .227-.083l.019-.01c.022-.009.057-.024.074-.064.697-1.6 1.78-2.64 2.814-3.634 1.473-1.414 2.847-2.733 2.864-5.44.02-3.067-2.627-5.58-5.901-5.601m-.057 8.784c1.621.011 2.944-1.315 2.955-2.96.01-1.646-1.295-2.988-2.916-2.999-1.622-.01-2.945 1.315-2.955 2.96s1.295 2.989 2.916 3' style='clip-rule:evenodd;fill:%23e1e3e9;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:2.47727823;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:.4' transform='translate(15.553 2.85)scale(.88807)'/%3E%3Cpath d='M-11.594 15.465c-.27-.002-.492.297-.494.668l-.012 1.876c-.003.371.214.673.485.675l4.14.027c.271.002.492-.298.495-.668l.012-1.877c.003-.37-.215-.672-.485-.674z' style='clip-rule:evenodd;fill:%23fff;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:2.47727823;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:.4' transform='translate(15.553 2.85)scale(.88807)'/%3E%3C/g%3E%3C/svg%3E")}}@media (forced-colors:active) and (prefers-color-scheme:light){a.maplibregl-ctrl-logo{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='88' height='23' fill='none'%3E%3Cpath fill='%23000' fill-opacity='.4' fill-rule='evenodd' d='M17.408 16.796h-1.827l2.501-12.095h.198l3.324 6.533.988 2.19.988-2.19 3.258-6.533h.181l2.6 12.095h-1.81l-1.218-5.644-.362-1.71-.658 1.71-2.929 5.644h-.098l-2.914-5.644-.757-1.71-.345 1.71zm1.958-3.42-.726 3.663a1.255 1.255 0 0 1-1.232 1.011h-1.827a1.255 1.255 0 0 1-1.229-1.509l2.501-12.095a1.255 1.255 0 0 1 1.23-1.001h.197a1.25 1.25 0 0 1 1.12.685l3.19 6.273 3.125-6.263a1.25 1.25 0 0 1 1.123-.695h.181a1.255 1.255 0 0 1 1.227.991l1.443 6.71a5 5 0 0 1 .314-.787l.009-.016a4.6 4.6 0 0 1 1.777-1.887c.782-.46 1.668-.667 2.611-.667a4.6 4.6 0 0 1 1.7.32l.306.134c.21-.16.474-.256.759-.256h1.694a1.255 1.255 0 0 1 1.212.925 1.255 1.255 0 0 1 1.212-.925h1.711c.284 0 .545.094.755.252.613-.3 1.312-.45 2.075-.45 1.356 0 2.557.445 3.482 1.4q.47.48.763 1.064V4.701a1.255 1.255 0 0 1 1.255-1.255h1.86A1.255 1.255 0 0 1 54.44 4.7v9.194h2.217c.19 0 .37.043.532.118v-4.77c0-.356.147-.678.385-.906a2.42 2.42 0 0 1-.682-1.71c0-.665.267-1.253.735-1.7a2.45 2.45 0 0 1 1.722-.674 2.43 2.43 0 0 1 1.705.675q.318.302.504.683V4.7a1.255 1.255 0 0 1 1.255-1.255h1.744A1.255 1.255 0 0 1 65.812 4.7v3.335a4.8 4.8 0 0 1 1.526-.246c.938 0 1.817.214 2.59.69a4.47 4.47 0 0 1 1.67 1.743v-.98a1.255 1.255 0 0 1 1.256-1.256h1.777c.233 0 .451.064.639.174a3.4 3.4 0 0 1 1.567-.372c.346 0 .861.02 1.285.232a1.25 1.25 0 0 1 .689 1.004 4.7 4.7 0 0 1 .853-.588c.795-.44 1.675-.647 2.61-.647 1.385 0 2.65.39 3.525 1.396.836.938 1.168 2.173 1.168 3.528q-.001.515-.056 1.051a1.255 1.255 0 0 1-.947 1.09l.408.952a1.255 1.255 0 0 1-.477 1.552c-.418.268-.92.463-1.458.612-.613.171-1.304.244-2.049.244-1.06 0-2.043-.207-2.886-.698l-.015-.008c-.798-.48-1.419-1.135-1.818-1.963l-.004-.008a5.8 5.8 0 0 1-.548-2.512q0-.429.053-.843a1.3 1.3 0 0 1-.333-.086l-.166-.004c-.223 0-.426.062-.643.228-.03.024-.142.139-.142.59v3.883a1.255 1.255 0 0 1-1.256 1.256h-1.777a1.255 1.255 0 0 1-1.256-1.256V15.69l-.032.057a4.8 4.8 0 0 1-1.86 1.833 5.04 5.04 0 0 1-2.484.634 4.5 4.5 0 0 1-1.935-.424 1.25 1.25 0 0 1-.764.258h-1.71a1.255 1.255 0 0 1-1.256-1.255V7.687a2.4 2.4 0 0 1-.428.625c.253.23.412.561.412.93v7.553a1.255 1.255 0 0 1-1.256 1.255h-1.843a1.25 1.25 0 0 1-.894-.373c-.228.23-.544.373-.894.373H51.32a1.255 1.255 0 0 1-1.256-1.255v-1.251l-.061.117a4.7 4.7 0 0 1-1.782 1.884 4.77 4.77 0 0 1-2.485.67 5.6 5.6 0 0 1-1.485-.188l.009 2.764a1.255 1.255 0 0 1-1.255 1.259h-1.729a1.255 1.255 0 0 1-1.255-1.255v-3.537a1.255 1.255 0 0 1-1.167.793h-1.679a1.25 1.25 0 0 1-.77-.263 4.5 4.5 0 0 1-1.945.429c-.885 0-1.724-.21-2.495-.632l-.017-.01a5 5 0 0 1-1.081-.836 1.255 1.255 0 0 1-1.254 1.312h-1.81a1.255 1.255 0 0 1-1.228-.99l-.782-3.625-2.044 3.939a1.25 1.25 0 0 1-1.115.676h-.098a1.25 1.25 0 0 1-1.116-.68l-2.061-3.994zM35.92 16.63l.207-.114.223-.15q.493-.356.735-.785l.061-.118.033 1.332h1.678V9.242h-1.694l-.033 1.267q-.133-.329-.526-.658l-.032-.028a3.2 3.2 0 0 0-.668-.428l-.27-.12a3.3 3.3 0 0 0-1.235-.23q-1.136-.001-1.974.493a3.36 3.36 0 0 0-1.3 1.382q-.445.89-.444 2.074 0 1.2.51 2.107a3.8 3.8 0 0 0 1.382 1.381 3.9 3.9 0 0 0 1.893.477q.795 0 1.455-.33zm-2.789-5.38q-.576.675-.575 1.762 0 1.102.559 1.794.576.675 1.645.675a2.25 2.25 0 0 0 .934-.19 2.2 2.2 0 0 0 .468-.29l.178-.161a2.2 2.2 0 0 0 .397-.561q.244-.5.244-1.15v-.115q0-.708-.296-1.267l-.043-.077a2.2 2.2 0 0 0-.633-.709l-.13-.086-.047-.028a2.1 2.1 0 0 0-1.073-.285q-1.052 0-1.629.692zm2.316 2.706c.163-.17.28-.407.28-.83v-.114c0-.292-.06-.508-.15-.68a.96.96 0 0 0-.353-.389.85.85 0 0 0-.464-.127c-.4 0-.56.114-.664.239l-.01.012c-.148.174-.275.45-.275.945 0 .506.122.801.27.99.097.11.266.224.68.224.303 0 .504-.09.687-.269zm7.545 1.705a2.6 2.6 0 0 0 .331.423q.319.33.755.548l.173.074q.65.255 1.49.255 1.02 0 1.844-.493a3.45 3.45 0 0 0 1.316-1.4q.493-.904.493-2.089 0-1.909-.988-2.913-.988-1.02-2.584-1.02-.898 0-1.575.347a3 3 0 0 0-.415.262l-.199.166a3.4 3.4 0 0 0-.64.82V9.242h-1.712v11.553h1.729l-.017-5.134zm.53-1.138q.206.29.48.5l.155.11.053.034q.51.296 1.119.297 1.07 0 1.645-.675.577-.69.576-1.762 0-1.119-.576-1.777-.558-.675-1.645-.675-.435 0-.835.16a2 2 0 0 0-.284.136 2 2 0 0 0-.363.254 2.2 2.2 0 0 0-.46.569l-.082.162a2.6 2.6 0 0 0-.213 1.072v.115q0 .707.296 1.267l.135.211zm.964-.818a1.1 1.1 0 0 0 .367.385.94.94 0 0 0 .476.118c.423 0 .59-.117.687-.23.159-.194.28-.478.28-.95 0-.53-.133-.8-.266-.952l-.021-.025c-.078-.094-.231-.221-.68-.221a1 1 0 0 0-.503.135l-.012.007a.86.86 0 0 0-.335.343c-.073.133-.132.324-.132.614v.115a1.4 1.4 0 0 0 .14.66zm15.7-6.222q.347-.346.346-.856a1.05 1.05 0 0 0-.345-.79 1.18 1.18 0 0 0-.84-.329q-.51 0-.855.33a1.05 1.05 0 0 0-.346.79q0 .51.346.855.345.346.856.346.51 0 .839-.346zm4.337 9.314.033-1.332q.191.403.59.747l.098.081a4 4 0 0 0 .316.224l.223.122a3.2 3.2 0 0 0 1.44.322 3.8 3.8 0 0 0 1.875-.477 3.5 3.5 0 0 0 1.382-1.366q.527-.89.526-2.09 0-1.184-.444-2.073a3.24 3.24 0 0 0-1.283-1.399q-.823-.51-1.942-.51a3.5 3.5 0 0 0-1.527.344l-.086.043-.165.09a3 3 0 0 0-.33.214q-.432.315-.656.707a2 2 0 0 0-.099.198l.082-1.283V4.701h-1.744v12.095zm.473-2.509a2.5 2.5 0 0 0 .566.7q.117.098.245.18l.144.08a2.1 2.1 0 0 0 .975.232q1.07 0 1.645-.675.576-.69.576-1.778 0-1.102-.576-1.777-.56-.691-1.645-.692a2.2 2.2 0 0 0-1.015.235q-.22.113-.415.282l-.15.142a2.1 2.1 0 0 0-.42.594q-.223.479-.223 1.1v.115q0 .705.293 1.26zm2.616-.293c.157-.191.28-.479.28-.967 0-.51-.13-.79-.276-.961l-.021-.026c-.082-.1-.232-.225-.67-.225a.87.87 0 0 0-.681.279l-.012.011c-.154.155-.274.38-.274.807v.115c0 .285.057.499.144.669a1.1 1.1 0 0 0 .367.405c.137.082.28.123.455.123.423 0 .59-.118.686-.23zm8.266-3.013q.345-.13.724-.14l.069-.002q.493 0 .642.099l.247-1.794q-.196-.099-.717-.099a2.3 2.3 0 0 0-.545.063 2 2 0 0 0-.411.148 2.2 2.2 0 0 0-.4.249 2.5 2.5 0 0 0-.485.499 2.7 2.7 0 0 0-.32.581l-.05.137v-1.48h-1.778v7.553h1.777v-3.884q0-.546.159-.943a1.5 1.5 0 0 1 .466-.636 2.5 2.5 0 0 1 .399-.253 2 2 0 0 1 .224-.099zm9.784 2.656.05-.922q0-1.743-.856-2.698-.838-.97-2.584-.97-1.119-.001-2.007.493a3.46 3.46 0 0 0-1.4 1.382q-.493.906-.493 2.106 0 1.07.428 1.975.428.89 1.332 1.432.906.526 2.255.526.973 0 1.668-.185l.044-.012.135-.04q.613-.184.984-.421l-.542-1.267q-.3.162-.642.274l-.297.087q-.51.131-1.3.131-.954 0-1.497-.444a1.6 1.6 0 0 1-.192-.193q-.366-.44-.512-1.234l-.004-.021zm-5.427-1.256-.003.022h3.752v-.138q-.011-.727-.288-1.118a1 1 0 0 0-.156-.176q-.46-.428-1.316-.428-.986 0-1.494.604-.379.45-.494 1.234zm-27.053 2.77V4.7h-1.86v12.095h5.333V15.15zm7.103-5.908v7.553h-1.843V9.242h1.843z'/%3E%3Cpath fill='%23fff' d='m19.63 11.151-.757-1.71-.345 1.71-1.12 5.644h-1.827L18.083 4.7h.197l3.325 6.533.988 2.19.988-2.19L26.839 4.7h.181l2.6 12.095h-1.81l-1.218-5.644-.362-1.71-.658 1.71-2.93 5.644h-.098l-2.913-5.644zm14.836 5.81q-1.02 0-1.893-.478a3.8 3.8 0 0 1-1.381-1.382q-.51-.906-.51-2.106 0-1.185.444-2.074a3.36 3.36 0 0 1 1.3-1.382q.839-.494 1.974-.494a3.3 3.3 0 0 1 1.234.231 3.3 3.3 0 0 1 .97.575q.396.33.527.659l.033-1.267h1.694v7.553H37.18l-.033-1.332q-.279.593-1.02 1.053a3.17 3.17 0 0 1-1.662.444zm.296-1.482q.938 0 1.58-.642.642-.66.642-1.711v-.115q0-.708-.296-1.267a2.2 2.2 0 0 0-.807-.872 2.1 2.1 0 0 0-1.119-.313q-1.053 0-1.629.692-.575.675-.575 1.76 0 1.103.559 1.795.577.675 1.645.675zm6.521-6.237h1.711v1.4q.906-1.597 2.83-1.597 1.596 0 2.584 1.02.988 1.005.988 2.914 0 1.185-.493 2.09a3.46 3.46 0 0 1-1.316 1.399 3.5 3.5 0 0 1-1.844.493q-.954 0-1.662-.329a2.67 2.67 0 0 1-1.086-.97l.017 5.134h-1.728zm4.048 6.22q1.07 0 1.645-.674.577-.69.576-1.762 0-1.119-.576-1.777-.558-.675-1.645-.675-.592 0-1.12.296-.51.28-.822.823-.296.527-.296 1.234v.115q0 .708.296 1.267.313.543.823.855.51.296 1.119.297z'/%3E%3Cpath fill='%23e1e3e9' d='M51.325 4.7h1.86v10.45h3.473v1.646h-5.333zm7.12 4.542h1.843v7.553h-1.843zm.905-1.415a1.16 1.16 0 0 1-.856-.346 1.17 1.17 0 0 1-.346-.856 1.05 1.05 0 0 1 .346-.79q.346-.329.856-.329.494 0 .839.33a1.05 1.05 0 0 1 .345.79 1.16 1.16 0 0 1-.345.855q-.33.346-.84.346zm7.875 9.133a3.17 3.17 0 0 1-1.662-.444q-.723-.46-1.004-1.053l-.033 1.332h-1.71V4.701h1.743v4.657l-.082 1.283q.279-.658 1.086-1.119a3.5 3.5 0 0 1 1.778-.477q1.119 0 1.942.51a3.24 3.24 0 0 1 1.283 1.4q.445.888.444 2.072 0 1.201-.526 2.09a3.5 3.5 0 0 1-1.382 1.366 3.8 3.8 0 0 1-1.876.477zm-.296-1.481q1.069 0 1.645-.675.577-.69.577-1.778 0-1.102-.577-1.776-.56-.691-1.645-.692a2.12 2.12 0 0 0-1.58.659q-.642.641-.642 1.694v.115q0 .71.296 1.267a2.4 2.4 0 0 0 .807.872 2.1 2.1 0 0 0 1.119.313zm5.927-6.237h1.777v1.481q.263-.757.856-1.217a2.14 2.14 0 0 1 1.349-.46q.527 0 .724.098l-.247 1.794q-.149-.099-.642-.099-.774 0-1.416.494-.626.493-.626 1.58v3.883h-1.777V9.242zm9.534 7.718q-1.35 0-2.255-.526-.904-.543-1.332-1.432a4.6 4.6 0 0 1-.428-1.975q0-1.2.493-2.106a3.46 3.46 0 0 1 1.4-1.382q.889-.495 2.007-.494 1.744 0 2.584.97.855.956.856 2.7 0 .444-.05.92h-5.43q.18 1.005.708 1.45.542.443 1.497.443.79 0 1.3-.131a4 4 0 0 0 .938-.362l.542 1.267q-.411.263-1.119.46-.708.198-1.711.197zm1.596-4.558q.016-1.02-.444-1.432-.46-.428-1.316-.428-1.728 0-1.991 1.86z'/%3E%3Cpath d='M5.074 15.948a.484.657 0 0 0-.486.659v1.84a.484.657 0 0 0 .486.659h4.101a.484.657 0 0 0 .486-.659v-1.84a.484.657 0 0 0-.486-.659zm3.56 1.16H5.617v.838h3.017z' style='fill:%23fff;fill-rule:evenodd;stroke-width:1.03600001'/%3E%3Cg style='stroke-width:1.12603545'%3E%3Cpath d='M-9.408-1.416c-3.833-.025-7.056 2.912-7.08 6.615-.02 3.08 1.653 4.832 3.107 6.268.903.892 1.721 1.74 2.32 2.902l-.525-.004c-.543-.003-.992.304-1.24.639a1.87 1.87 0 0 0-.362 1.121l-.011 1.877c-.003.402.104.787.347 1.125.244.338.688.653 1.23.656l4.142.028c.542.003.99-.306 1.238-.641a1.87 1.87 0 0 0 .363-1.121l.012-1.875a1.87 1.87 0 0 0-.348-1.127c-.243-.338-.688-.653-1.23-.656l-.518-.004c.597-1.145 1.425-1.983 2.348-2.87 1.473-1.414 3.18-3.149 3.2-6.226-.016-3.59-2.923-6.684-6.993-6.707m-.006 1.1v.002c3.274.02 5.92 2.532 5.9 5.6-.017 2.706-1.39 4.026-2.863 5.44-1.034.994-2.118 2.033-2.814 3.633-.018.041-.052.055-.075.065q-.013.004-.02.01a.34.34 0 0 1-.226.084.34.34 0 0 1-.224-.086l-.092-.077c-.699-1.615-1.768-2.669-2.781-3.67-1.454-1.435-2.797-2.762-2.78-5.478.02-3.067 2.7-5.545 5.975-5.523m-.02 2.826c-1.62-.01-2.944 1.315-2.955 2.96-.01 1.646 1.295 2.988 2.916 2.999h.002c1.621.01 2.943-1.316 2.953-2.961.011-1.646-1.294-2.988-2.916-2.998m-.005 1.1c1.017.006 1.829.83 1.822 1.89s-.83 1.874-1.848 1.867c-1.018-.006-1.829-.83-1.822-1.89s.83-1.874 1.848-1.868m-2.155 11.857 4.14.025c.271.002.49.305.487.676l-.013 1.875c-.003.37-.224.67-.495.668l-4.14-.025c-.27-.002-.487-.306-.485-.676l.012-1.875c.003-.37.224-.67.494-.668' style='color:%23000;font-style:normal;font-variant:normal;font-weight:400;font-stretch:normal;font-size:medium;line-height:normal;font-family:sans-serif;font-variant-ligatures:normal;font-variant-position:normal;font-variant-caps:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-feature-settings:normal;text-indent:0;text-align:start;text-decoration:none;text-decoration-line:none;text-decoration-style:solid;text-decoration-color:%23000;letter-spacing:normal;word-spacing:normal;text-transform:none;writing-mode:lr-tb;direction:ltr;text-orientation:mixed;dominant-baseline:auto;baseline-shift:baseline;text-anchor:start;white-space:normal;shape-padding:0;clip-rule:evenodd;display:inline;overflow:visible;visibility:visible;opacity:1;isolation:auto;mix-blend-mode:normal;color-interpolation:sRGB;color-interpolation-filters:linearRGB;solid-color:%23000;solid-opacity:1;vector-effect:none;fill:%23000;fill-opacity:.4;fill-rule:evenodd;stroke:none;stroke-width:2.47727823;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;color-rendering:auto;image-rendering:auto;shape-rendering:auto;text-rendering:auto' transform='translate(15.553 2.85)scale(.88807)'/%3E%3Cpath d='M-9.415-.316C-12.69-.338-15.37 2.14-15.39 5.207c-.017 2.716 1.326 4.041 2.78 5.477 1.013 1 2.081 2.055 2.78 3.67l.092.076a.34.34 0 0 0 .225.086.34.34 0 0 0 .227-.083l.019-.01c.022-.009.057-.024.074-.064.697-1.6 1.78-2.64 2.814-3.634 1.473-1.414 2.847-2.733 2.864-5.44.02-3.067-2.627-5.58-5.901-5.601m-.057 8.784c1.621.011 2.944-1.315 2.955-2.96.01-1.646-1.295-2.988-2.916-2.999-1.622-.01-2.945 1.315-2.955 2.96s1.295 2.989 2.916 3' style='clip-rule:evenodd;fill:%23e1e3e9;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:2.47727823;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:.4' transform='translate(15.553 2.85)scale(.88807)'/%3E%3Cpath d='M-11.594 15.465c-.27-.002-.492.297-.494.668l-.012 1.876c-.003.371.214.673.485.675l4.14.027c.271.002.492-.298.495-.668l.012-1.877c.003-.37-.215-.672-.485-.674z' style='clip-rule:evenodd;fill:%23fff;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:2.47727823;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:.4' transform='translate(15.553 2.85)scale(.88807)'/%3E%3C/g%3E%3C/svg%3E")}}.maplibregl-ctrl.maplibregl-ctrl-attrib{background-color:#ffffff80;margin:0;padding:0 5px}@media screen{.maplibregl-ctrl-attrib.maplibregl-compact{background-color:#fff;border-radius:12px;box-sizing:content-box;color:#000;margin:10px;min-height:20px;padding:2px 24px 2px 0;position:relative}.maplibregl-ctrl-attrib.maplibregl-compact-show{padding:2px 28px 2px 8px;visibility:visible}.maplibregl-ctrl-bottom-left>.maplibregl-ctrl-attrib.maplibregl-compact-show,.maplibregl-ctrl-top-left>.maplibregl-ctrl-attrib.maplibregl-compact-show{border-radius:12px;padding:2px 8px 2px 28px}.maplibregl-ctrl-attrib.maplibregl-compact .maplibregl-ctrl-attrib-inner{display:none}.maplibregl-ctrl-attrib-button{background-color:#ffffff80;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' fill-rule='evenodd' viewBox='0 0 20 20'%3E%3Cpath d='M4 10a6 6 0 1 0 12 0 6 6 0 1 0-12 0m5-3a1 1 0 1 0 2 0 1 1 0 1 0-2 0m0 3a1 1 0 1 1 2 0v3a1 1 0 1 1-2 0'/%3E%3C/svg%3E");border:0;border-radius:12px;box-sizing:border-box;cursor:pointer;display:none;height:24px;outline:none;position:absolute;right:0;top:0;width:24px}.maplibregl-ctrl-attrib summary.maplibregl-ctrl-attrib-button{-webkit-appearance:none;-moz-appearance:none;appearance:none;list-style:none}.maplibregl-ctrl-attrib summary.maplibregl-ctrl-attrib-button::-webkit-details-marker{display:none}.maplibregl-ctrl-bottom-left .maplibregl-ctrl-attrib-button,.maplibregl-ctrl-top-left .maplibregl-ctrl-attrib-button{left:0}.maplibregl-ctrl-attrib.maplibregl-compact .maplibregl-ctrl-attrib-button,.maplibregl-ctrl-attrib.maplibregl-compact-show .maplibregl-ctrl-attrib-inner{display:block}.maplibregl-ctrl-attrib.maplibregl-compact-show .maplibregl-ctrl-attrib-button{background-color:#0000000d}.maplibregl-ctrl-bottom-right>.maplibregl-ctrl-attrib.maplibregl-compact:after{bottom:0;right:0}.maplibregl-ctrl-top-right>.maplibregl-ctrl-attrib.maplibregl-compact:after{right:0;top:0}.maplibregl-ctrl-top-left>.maplibregl-ctrl-attrib.maplibregl-compact:after{left:0;top:0}.maplibregl-ctrl-bottom-left>.maplibregl-ctrl-attrib.maplibregl-compact:after{bottom:0;left:0}}@media screen and (forced-colors:active){.maplibregl-ctrl-attrib.maplibregl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' fill='%23fff' fill-rule='evenodd' viewBox='0 0 20 20'%3E%3Cpath d='M4 10a6 6 0 1 0 12 0 6 6 0 1 0-12 0m5-3a1 1 0 1 0 2 0 1 1 0 1 0-2 0m0 3a1 1 0 1 1 2 0v3a1 1 0 1 1-2 0'/%3E%3C/svg%3E")}}@media screen and (forced-colors:active) and (prefers-color-scheme:light){.maplibregl-ctrl-attrib.maplibregl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' fill-rule='evenodd' viewBox='0 0 20 20'%3E%3Cpath d='M4 10a6 6 0 1 0 12 0 6 6 0 1 0-12 0m5-3a1 1 0 1 0 2 0 1 1 0 1 0-2 0m0 3a1 1 0 1 1 2 0v3a1 1 0 1 1-2 0'/%3E%3C/svg%3E")}}.maplibregl-ctrl-attrib a{color:#000000bf;text-decoration:none}.maplibregl-ctrl-attrib a:hover{color:inherit;text-decoration:underline}.maplibregl-attrib-empty{display:none}.maplibregl-ctrl-scale{background-color:#ffffffbf;border:2px solid #333;border-top:#333;box-sizing:border-box;color:#333;font-size:10px;padding:0 5px}.maplibregl-popup{display:flex;left:0;pointer-events:none;position:absolute;top:0;will-change:transform}.maplibregl-popup-anchor-top,.maplibregl-popup-anchor-top-left,.maplibregl-popup-anchor-top-right{flex-direction:column}.maplibregl-popup-anchor-bottom,.maplibregl-popup-anchor-bottom-left,.maplibregl-popup-anchor-bottom-right{flex-direction:column-reverse}.maplibregl-popup-anchor-left{flex-direction:row}.maplibregl-popup-anchor-right{flex-direction:row-reverse}.maplibregl-popup-tip{border:10px solid transparent;height:0;width:0;z-index:1}.maplibregl-popup-anchor-top .maplibregl-popup-tip{align-self:center;border-bottom-color:#fff;border-top:none}.maplibregl-popup-anchor-top-left .maplibregl-popup-tip{align-self:flex-start;border-bottom-color:#fff;border-left:none;border-top:none}.maplibregl-popup-anchor-top-right .maplibregl-popup-tip{align-self:flex-end;border-bottom-color:#fff;border-right:none;border-top:none}.maplibregl-popup-anchor-bottom .maplibregl-popup-tip{align-self:center;border-bottom:none;border-top-color:#fff}.maplibregl-popup-anchor-bottom-left .maplibregl-popup-tip{align-self:flex-start;border-bottom:none;border-left:none;border-top-color:#fff}.maplibregl-popup-anchor-bottom-right .maplibregl-popup-tip{align-self:flex-end;border-bottom:none;border-right:none;border-top-color:#fff}.maplibregl-popup-anchor-left .maplibregl-popup-tip{align-self:center;border-left:none;border-right-color:#fff}.maplibregl-popup-anchor-right .maplibregl-popup-tip{align-self:center;border-left-color:#fff;border-right:none}.maplibregl-popup-close-button{background-color:transparent;border:0;border-radius:0 3px 0 0;cursor:pointer;position:absolute;right:0;top:0}.maplibregl-popup-close-button:hover{background-color:#0000000d}.maplibregl-popup-content{background:#fff;border-radius:3px;box-shadow:0 1px 2px #0000001a;padding:15px 10px;pointer-events:auto;position:relative}.maplibregl-popup-anchor-top-left .maplibregl-popup-content{border-top-left-radius:0}.maplibregl-popup-anchor-top-right .maplibregl-popup-content{border-top-right-radius:0}.maplibregl-popup-anchor-bottom-left .maplibregl-popup-content{border-bottom-left-radius:0}.maplibregl-popup-anchor-bottom-right .maplibregl-popup-content{border-bottom-right-radius:0}.maplibregl-popup-track-pointer{display:none}.maplibregl-popup-track-pointer *{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.maplibregl-map:hover .maplibregl-popup-track-pointer{display:flex}.maplibregl-map:active .maplibregl-popup-track-pointer{display:none}.maplibregl-marker{left:0;position:absolute;top:0;transition:opacity .2s;will-change:transform}.maplibregl-user-location-dot,.maplibregl-user-location-dot:before{background-color:#1da1f2;border-radius:50%;height:15px;width:15px}.maplibregl-user-location-dot:before{animation:maplibregl-user-location-dot-pulse 2s infinite;content:"";position:absolute}.maplibregl-user-location-dot:after{border:2px solid #fff;border-radius:50%;box-shadow:0 0 3px #00000059;box-sizing:border-box;content:"";height:19px;left:-2px;position:absolute;top:-2px;width:19px}@keyframes maplibregl-user-location-dot-pulse{0%{opacity:1;transform:scale(1)}70%{opacity:0;transform:scale(3)}to{opacity:0;transform:scale(1)}}.maplibregl-user-location-dot-stale{background-color:#aaa}.maplibregl-user-location-dot-stale:after{display:none}.maplibregl-user-location-accuracy-circle{background-color:#1da1f233;border-radius:100%;height:1px;width:1px}.maplibregl-crosshair,.maplibregl-crosshair .maplibregl-interactive,.maplibregl-crosshair .maplibregl-interactive:active{cursor:crosshair}.maplibregl-boxzoom{background:#fff;border:2px dotted #202020;height:0;left:0;opacity:.5;position:absolute;top:0;width:0}.maplibregl-cooperative-gesture-screen{align-items:center;background:#0006;color:#fff;display:flex;font-size:1.4em;inset:0;justify-content:center;line-height:1.2;opacity:0;padding:1rem;pointer-events:none;position:absolute;transition:opacity 1s ease 1s;z-index:99999}.maplibregl-cooperative-gesture-screen.maplibregl-show{opacity:1;transition:opacity .05s}.maplibregl-cooperative-gesture-screen .maplibregl-mobile-message{display:none}@media (hover:none),(pointer:coarse){.maplibregl-cooperative-gesture-screen .maplibregl-desktop-message{display:none}.maplibregl-cooperative-gesture-screen .maplibregl-mobile-message{display:block}}.maplibregl-pseudo-fullscreen{height:100%!important;left:0!important;position:fixed!important;top:0!important;width:100%!important;z-index:99999}.psv-navbar{display:none!important}`)),document.head.appendChild(t)}}catch(e){console.error("vite-plugin-css-injected-by-js",e)}})();function OI(t,e){for(var r=0;r<e.length;r++){const i=e[r];if(typeof i!="string"&&!Array.isArray(i)){for(const s in i)if(s!=="default"&&!(s in t)){const l=Object.getOwnPropertyDescriptor(i,s);l&&Object.defineProperty(t,s,l.get?l:{enumerable:!0,get:()=>i[s]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}function FI(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var vx={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v5.6.2/LICENSE.txt
 */var B7=vx.exports,J3;function L7(){return J3||(J3=1,(function(t,e){(function(r,i){t.exports=i()})(B7,(function(){var r={},i={};function s(h,a,v){if(i[h]=v,h==="index"){var T="var sharedModule = {}; ("+i.shared+")(sharedModule); ("+i.worker+")(sharedModule);",C={};return i.shared(C),i.index(r,C),typeof window<"u"&&r.setWorkerUrl(window.URL.createObjectURL(new Blob([T],{type:"text/javascript"}))),r}}s("shared",["exports"],(function(h){function a(u,o,c,f){return new(c||(c=Promise))((function(_,w){function E(D){try{R(f.next(D))}catch(z){w(z)}}function M(D){try{R(f.throw(D))}catch(z){w(z)}}function R(D){var z;D.done?_(D.value):(z=D.value,z instanceof c?z:new c((function(V){V(z)}))).then(E,M)}R((f=f.apply(u,o||[])).next())}))}function v(u,o){this.x=u,this.y=o}function T(u){return u&&u.__esModule&&Object.prototype.hasOwnProperty.call(u,"default")?u.default:u}var C,k;typeof SuppressedError=="function"&&SuppressedError,v.prototype={clone(){return new v(this.x,this.y)},add(u){return this.clone()._add(u)},sub(u){return this.clone()._sub(u)},multByPoint(u){return this.clone()._multByPoint(u)},divByPoint(u){return this.clone()._divByPoint(u)},mult(u){return this.clone()._mult(u)},div(u){return this.clone()._div(u)},rotate(u){return this.clone()._rotate(u)},rotateAround(u,o){return this.clone()._rotateAround(u,o)},matMult(u){return this.clone()._matMult(u)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(u){return this.x===u.x&&this.y===u.y},dist(u){return Math.sqrt(this.distSqr(u))},distSqr(u){const o=u.x-this.x,c=u.y-this.y;return o*o+c*c},angle(){return Math.atan2(this.y,this.x)},angleTo(u){return Math.atan2(this.y-u.y,this.x-u.x)},angleWith(u){return this.angleWithSep(u.x,u.y)},angleWithSep(u,o){return Math.atan2(this.x*o-this.y*u,this.x*u+this.y*o)},_matMult(u){const o=u[2]*this.x+u[3]*this.y;return this.x=u[0]*this.x+u[1]*this.y,this.y=o,this},_add(u){return this.x+=u.x,this.y+=u.y,this},_sub(u){return this.x-=u.x,this.y-=u.y,this},_mult(u){return this.x*=u,this.y*=u,this},_div(u){return this.x/=u,this.y/=u,this},_multByPoint(u){return this.x*=u.x,this.y*=u.y,this},_divByPoint(u){return this.x/=u.x,this.y/=u.y,this},_unit(){return this._div(this.mag()),this},_perp(){const u=this.y;return this.y=this.x,this.x=-u,this},_rotate(u){const o=Math.cos(u),c=Math.sin(u),f=c*this.x+o*this.y;return this.x=o*this.x-c*this.y,this.y=f,this},_rotateAround(u,o){const c=Math.cos(u),f=Math.sin(u),_=o.y+f*(this.x-o.x)+c*(this.y-o.y);return this.x=o.x+c*(this.x-o.x)-f*(this.y-o.y),this.y=_,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:v},v.convert=function(u){if(u instanceof v)return u;if(Array.isArray(u))return new v(+u[0],+u[1]);if(u.x!==void 0&&u.y!==void 0)return new v(+u.x,+u.y);throw new Error("Expected [x, y] or {x, y} point format")};var L=(function(){if(k)return C;function u(o,c,f,_){this.cx=3*o,this.bx=3*(f-o)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*c,this.by=3*(_-c)-this.cy,this.ay=1-this.cy-this.by,this.p1x=o,this.p1y=c,this.p2x=f,this.p2y=_}return k=1,C=u,u.prototype={sampleCurveX:function(o){return((this.ax*o+this.bx)*o+this.cx)*o},sampleCurveY:function(o){return((this.ay*o+this.by)*o+this.cy)*o},sampleCurveDerivativeX:function(o){return(3*this.ax*o+2*this.bx)*o+this.cx},solveCurveX:function(o,c){if(c===void 0&&(c=1e-6),o<0)return 0;if(o>1)return 1;for(var f=o,_=0;_<8;_++){var w=this.sampleCurveX(f)-o;if(Math.abs(w)<c)return f;var E=this.sampleCurveDerivativeX(f);if(Math.abs(E)<1e-6)break;f-=w/E}var M=0,R=1;for(f=o,_=0;_<20&&(w=this.sampleCurveX(f),!(Math.abs(w-o)<c));_++)o>w?M=f:R=f,f=.5*(R-M)+M;return f},solve:function(o,c){return this.sampleCurveY(this.solveCurveX(o,c))}},C})(),O=T(L);let K,$;function ne(){return K==null&&(K=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),K}function oe(){if($==null&&($=!1,ne())){const u=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(u){for(let c=0;c<25;c++){const f=4*c;u.fillStyle=`rgb(${f},${f+1},${f+2})`,u.fillRect(c%5,Math.floor(c/5),1,1)}const o=u.getImageData(0,0,5,5).data;for(let c=0;c<100;c++)if(c%4!=3&&o[c]!==c){$=!0;break}}}return $||!1}var fe=1e-6,ue=typeof Float32Array<"u"?Float32Array:Array;function we(){var u=new ue(9);return ue!=Float32Array&&(u[1]=0,u[2]=0,u[3]=0,u[5]=0,u[6]=0,u[7]=0),u[0]=1,u[4]=1,u[8]=1,u}function De(u){return u[0]=1,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=1,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[10]=1,u[11]=0,u[12]=0,u[13]=0,u[14]=0,u[15]=1,u}function Fe(){var u=new ue(3);return ue!=Float32Array&&(u[0]=0,u[1]=0,u[2]=0),u}function Ke(u){return Math.hypot(u[0],u[1],u[2])}function ze(u,o,c){var f=new ue(3);return f[0]=u,f[1]=o,f[2]=c,f}function it(u,o,c){return u[0]=o[0]+c[0],u[1]=o[1]+c[1],u[2]=o[2]+c[2],u}function lt(u,o,c){return u[0]=o[0]*c,u[1]=o[1]*c,u[2]=o[2]*c,u}function ht(u,o,c){var f=o[0],_=o[1],w=o[2],E=c[0],M=c[1],R=c[2];return u[0]=_*R-w*M,u[1]=w*E-f*R,u[2]=f*M-_*E,u}Math.hypot||(Math.hypot=function(){for(var u=0,o=arguments.length;o--;)u+=arguments[o]*arguments[o];return Math.sqrt(u)});var vt,Nt=Ke;function Lt(u,o,c){var f=o[0],_=o[1],w=o[2],E=o[3];return u[0]=c[0]*f+c[4]*_+c[8]*w+c[12]*E,u[1]=c[1]*f+c[5]*_+c[9]*w+c[13]*E,u[2]=c[2]*f+c[6]*_+c[10]*w+c[14]*E,u[3]=c[3]*f+c[7]*_+c[11]*w+c[15]*E,u}function qt(){var u=new ue(4);return ue!=Float32Array&&(u[0]=0,u[1]=0,u[2]=0),u[3]=1,u}function Qt(u,o,c,f){var _=.5*Math.PI/180;o*=_,c*=_,f*=_;var w=Math.sin(o),E=Math.cos(o),M=Math.sin(c),R=Math.cos(c),D=Math.sin(f),z=Math.cos(f);return u[0]=w*R*z-E*M*D,u[1]=E*M*z+w*R*D,u[2]=E*R*D-w*M*z,u[3]=E*R*z+w*M*D,u}function Ot(){var u=new ue(2);return ue!=Float32Array&&(u[0]=0,u[1]=0),u}function tt(u,o){var c=new ue(2);return c[0]=u,c[1]=o,c}Fe(),vt=new ue(4),ue!=Float32Array&&(vt[0]=0,vt[1]=0,vt[2]=0,vt[3]=0),Fe(),ze(1,0,0),ze(0,1,0),qt(),qt(),we(),Ot();const wt=8192;function Bt(u,o,c){return o*(wt/(u.tileSize*Math.pow(2,c-u.tileID.overscaledZ)))}function Ue(u,o){return(u%o+o)%o}function dt(u,o,c){return u*(1-c)+o*c}function Gt(u){if(u<=0)return 0;if(u>=1)return 1;const o=u*u,c=o*u;return 4*(u<.5?c:3*(u-o)+c-.75)}function Jt(u,o,c,f){const _=new O(u,o,c,f);return w=>_.solve(w)}const Tr=Jt(.25,.1,.25,1);function gr(u,o,c){return Math.min(c,Math.max(o,u))}function Ht(u,o,c){const f=c-o,_=((u-o)%f+f)%f+o;return _===o?c:_}function dr(u,...o){for(const c of o)for(const f in c)u[f]=c[f];return u}let er=1;function Lr(u,o,c){const f={};for(const _ in u)f[_]=o.call(this,u[_],_,u);return f}function yn(u,o,c){const f={};for(const _ in u)o.call(this,u[_],_,u)&&(f[_]=u[_]);return f}function yi(u){return Array.isArray(u)?u.map(yi):typeof u=="object"&&u?Lr(u,yi):u}const qr={};function ri(u){qr[u]||(typeof console<"u"&&console.warn(u),qr[u]=!0)}function vn(u,o,c){return(c.y-u.y)*(o.x-u.x)>(o.y-u.y)*(c.x-u.x)}function Li(u){return typeof WorkerGlobalScope<"u"&&u!==void 0&&u instanceof WorkerGlobalScope}let Mn=null;function bs(u){return typeof ImageBitmap<"u"&&u instanceof ImageBitmap}const Yn="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Jn(u,o,c,f,_){return a(this,void 0,void 0,(function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const w=new VideoFrame(u,{timestamp:0});try{const E=w?.format;if(!E||!E.startsWith("BGR")&&!E.startsWith("RGB"))throw new Error(`Unrecognized format ${E}`);const M=E.startsWith("BGR"),R=new Uint8ClampedArray(f*_*4);if(yield w.copyTo(R,(function(D,z,V,Z,X){const Y=4*Math.max(-z,0),re=(Math.max(0,V)-V)*Z*4+Y,he=4*Z,ye=Math.max(0,z),Ne=Math.max(0,V);return{rect:{x:ye,y:Ne,width:Math.min(D.width,z+Z)-ye,height:Math.min(D.height,V+X)-Ne},layout:[{offset:re,stride:he}]}})(u,o,c,f,_)),M)for(let D=0;D<R.length;D+=4){const z=R[D];R[D]=R[D+2],R[D+2]=z}return R}finally{w.close()}}))}let mi,Js;function _o(u,o,c,f){return u.addEventListener(o,c,f),{unsubscribe:()=>{u.removeEventListener(o,c,f)}}}function Go(u){return u*Math.PI/180}function yo(u){return u/Math.PI*180}const vo={touchstart:!0,touchmove:!0,touchmoveWindow:!0,touchend:!0,touchcancel:!0},Ds={dblclick:!0,click:!0,mouseover:!0,mouseout:!0,mousedown:!0,mousemove:!0,mousemoveWindow:!0,mouseup:!0,mouseupWindow:!0,contextmenu:!0,wheel:!0},Qs="AbortError";function ke(){return new Error(Qs)}const Q={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function ee(u){return Q.REGISTERED_PROTOCOLS[u.substring(0,u.indexOf("://"))]}const ae="global-dispatcher";class be extends Error{constructor(o,c,f,_){super(`AJAXError: ${c} (${o}): ${f}`),this.status=o,this.statusText=c,this.url=f,this.body=_}}const Se=()=>Li(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,Oe=function(u,o){if(/:\/\//.test(u.url)&&!/^https?:|^file:/.test(u.url)){const f=ee(u.url);if(f)return f(u,o);if(Li(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:u,targetMapId:ae},o)}if(!(/^file:/.test(c=u.url)||/^file:/.test(Se())&&!/^\w+:/.test(c))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return(function(f,_){return a(this,void 0,void 0,(function*(){const w=new Request(f.url,{method:f.method||"GET",body:f.body,credentials:f.credentials,headers:f.headers,cache:f.cache,referrer:Se(),signal:_.signal});let E,M;f.type!=="json"||w.headers.has("Accept")||w.headers.set("Accept","application/json");try{E=yield fetch(w)}catch(D){throw new be(0,D.message,f.url,new Blob)}if(!E.ok){const D=yield E.blob();throw new be(E.status,E.statusText,f.url,D)}M=f.type==="arrayBuffer"||f.type==="image"?E.arrayBuffer():f.type==="json"?E.json():E.text();const R=yield M;if(_.signal.aborted)throw ke();return{data:R,cacheControl:E.headers.get("Cache-Control"),expires:E.headers.get("Expires")}}))})(u,o);if(Li(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:u,mustQueue:!0,targetMapId:ae},o)}var c;return(function(f,_){return new Promise(((w,E)=>{var M;const R=new XMLHttpRequest;R.open(f.method||"GET",f.url,!0),f.type!=="arrayBuffer"&&f.type!=="image"||(R.responseType="arraybuffer");for(const D in f.headers)R.setRequestHeader(D,f.headers[D]);f.type==="json"&&(R.responseType="text",!((M=f.headers)===null||M===void 0)&&M.Accept||R.setRequestHeader("Accept","application/json")),R.withCredentials=f.credentials==="include",R.onerror=()=>{E(new Error(R.statusText))},R.onload=()=>{if(!_.signal.aborted)if((R.status>=200&&R.status<300||R.status===0)&&R.response!==null){let D=R.response;if(f.type==="json")try{D=JSON.parse(R.response)}catch(z){return void E(z)}w({data:D,cacheControl:R.getResponseHeader("Cache-Control"),expires:R.getResponseHeader("Expires")})}else{const D=new Blob([R.response],{type:R.getResponseHeader("Content-Type")});E(new be(R.status,R.statusText,f.url,D))}},_.signal.addEventListener("abort",(()=>{R.abort(),E(ke())})),R.send(f.body)}))})(u,o)};function Ze(u){if(!u||u.indexOf("://")<=0||u.indexOf("data:image/")===0||u.indexOf("blob:")===0)return!0;const o=new URL(u),c=window.location;return o.protocol===c.protocol&&o.host===c.host}function Be(u,o,c){c[u]&&c[u].indexOf(o)!==-1||(c[u]=c[u]||[],c[u].push(o))}function nt(u,o,c){if(c&&c[u]){const f=c[u].indexOf(o);f!==-1&&c[u].splice(f,1)}}class pt{constructor(o,c={}){dr(this,c),this.type=o}}class at extends pt{constructor(o,c={}){super("error",dr({error:o},c))}}class Ft{on(o,c){return this._listeners=this._listeners||{},Be(o,c,this._listeners),{unsubscribe:()=>{this.off(o,c)}}}off(o,c){return nt(o,c,this._listeners),nt(o,c,this._oneTimeListeners),this}once(o,c){return c?(this._oneTimeListeners=this._oneTimeListeners||{},Be(o,c,this._oneTimeListeners),this):new Promise((f=>this.once(o,f)))}fire(o,c){typeof o=="string"&&(o=new pt(o,c||{}));const f=o.type;if(this.listens(f)){o.target=this;const _=this._listeners&&this._listeners[f]?this._listeners[f].slice():[];for(const M of _)M.call(this,o);const w=this._oneTimeListeners&&this._oneTimeListeners[f]?this._oneTimeListeners[f].slice():[];for(const M of w)nt(f,M,this._oneTimeListeners),M.call(this,o);const E=this._eventedParent;E&&(dr(o,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),E.fire(o))}else o instanceof at&&console.error(o.error);return this}listens(o){return this._listeners&&this._listeners[o]&&this._listeners[o].length>0||this._oneTimeListeners&&this._oneTimeListeners[o]&&this._oneTimeListeners[o].length>0||this._eventedParent&&this._eventedParent.listens(o)}setEventedParent(o,c){return this._eventedParent=o,this._eventedParentData=c,this}}var Le={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const or=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Sr(u,o){const c={};for(const f in u)f!=="ref"&&(c[f]=u[f]);return or.forEach((f=>{f in o&&(c[f]=o[f])})),c}function Wt(u,o){if(Array.isArray(u)){if(!Array.isArray(o)||u.length!==o.length)return!1;for(let c=0;c<u.length;c++)if(!Wt(u[c],o[c]))return!1;return!0}if(typeof u=="object"&&u!==null&&o!==null){if(typeof o!="object"||Object.keys(u).length!==Object.keys(o).length)return!1;for(const c in u)if(!Wt(u[c],o[c]))return!1;return!0}return u===o}function _r(u,o){u.push(o)}function $r(u,o,c){_r(c,{command:"addSource",args:[u,o[u]]})}function Si(u,o,c){_r(o,{command:"removeSource",args:[u]}),c[u]=!0}function Di(u,o,c,f){Si(u,c,f),$r(u,o,c)}function ui(u,o,c){let f;for(f in u[c])if(Object.prototype.hasOwnProperty.call(u[c],f)&&f!=="data"&&!Wt(u[c][f],o[c][f]))return!1;for(f in o[c])if(Object.prototype.hasOwnProperty.call(o[c],f)&&f!=="data"&&!Wt(u[c][f],o[c][f]))return!1;return!0}function Er(u,o,c,f,_,w){u=u||{},o=o||{};for(const E in u)Object.prototype.hasOwnProperty.call(u,E)&&(Wt(u[E],o[E])||c.push({command:w,args:[f,E,o[E],_]}));for(const E in o)Object.prototype.hasOwnProperty.call(o,E)&&!Object.prototype.hasOwnProperty.call(u,E)&&(Wt(u[E],o[E])||c.push({command:w,args:[f,E,o[E],_]}))}function Pr(u){return u.id}function Ni(u,o){return u[o.id]=o,u}class _t{constructor(o,c,f,_){this.message=(o?`${o}: `:"")+f,_&&(this.identifier=_),c!=null&&c.__line__&&(this.line=c.__line__)}}function Ci(u,...o){for(const c of o)for(const f in c)u[f]=c[f];return u}class si extends Error{constructor(o,c){super(c),this.message=c,this.key=o}}class Ns{constructor(o,c=[]){this.parent=o,this.bindings={};for(const[f,_]of c)this.bindings[f]=_}concat(o){return new Ns(this,o)}get(o){if(this.bindings[o])return this.bindings[o];if(this.parent)return this.parent.get(o);throw new Error(`${o} not found in scope.`)}has(o){return!!this.bindings[o]||!!this.parent&&this.parent.has(o)}}const Ha={kind:"null"},Tt={kind:"number"},Cr={kind:"string"},cr={kind:"boolean"},Hi={kind:"color"},eo={kind:"projectionDefinition"},Un={kind:"object"},hr={kind:"value"},bo={kind:"collator"},xs={kind:"formatted"},ha={kind:"padding"},to={kind:"colorArray"},Wa={kind:"numberArray"},br={kind:"resolvedImage"},Pn={kind:"variableAnchorOffsetCollection"};function Mi(u,o){return{kind:"array",itemType:u,N:o}}function Dr(u){if(u.kind==="array"){const o=Dr(u.itemType);return typeof u.N=="number"?`array<${o}, ${u.N}>`:u.itemType.kind==="value"?"array":`array<${o}>`}return u.kind}const Qn=[Ha,Tt,Cr,cr,Hi,eo,xs,Un,Mi(hr),ha,Wa,to,br,Pn];function xo(u,o){if(o.kind==="error")return null;if(u.kind==="array"){if(o.kind==="array"&&(o.N===0&&o.itemType.kind==="value"||!xo(u.itemType,o.itemType))&&(typeof u.N!="number"||u.N===o.N))return null}else{if(u.kind===o.kind)return null;if(u.kind==="value"){for(const c of Qn)if(!xo(c,o))return null}}return`Expected ${Dr(u)} but found ${Dr(o)} instead.`}function es(u,o){return o.some((c=>c.kind===u.kind))}function Wi(u,o){return o.some((c=>c==="null"?u===null:c==="array"?Array.isArray(u):c==="object"?u&&!Array.isArray(u)&&typeof u=="object":c===typeof u))}function en(u,o){return u.kind==="array"&&o.kind==="array"?u.itemType.kind===o.itemType.kind&&typeof u.N=="number":u.kind===o.kind}const fc=.96422,Rn=.82521,ws=4/29,wo=6/29,mc=3*wo*wo,qa=wo*wo*wo,$a=Math.PI/180,da=180/Math.PI;function Eo(u){return(u%=360)<0&&(u+=360),u}function ts([u,o,c,f]){let _,w;const E=Za((.2225045*(u=du(u))+.7168786*(o=du(o))+.0606169*(c=du(c)))/1);u===o&&o===c?_=w=E:(_=Za((.4360747*u+.3850649*o+.1430804*c)/fc),w=Za((.0139322*u+.0971045*o+.7141733*c)/Rn));const M=116*E-16;return[M<0?0:M,500*(_-E),200*(E-w),f]}function du(u){return u<=.04045?u/12.92:Math.pow((u+.055)/1.055,2.4)}function Za(u){return u>qa?Math.pow(u,1/3):u/mc+ws}function Ao([u,o,c,f]){let _=(u+16)/116,w=isNaN(o)?_:_+o/500,E=isNaN(c)?_:_-c/200;return _=1*pa(_),w=fc*pa(w),E=Rn*pa(E),[Xa(3.1338561*w-1.6168667*_-.4906146*E),Xa(-.9787684*w+1.9161415*_+.033454*E),Xa(.0719453*w-.2289914*_+1.4052427*E),f]}function Xa(u){return(u=u<=.00304?12.92*u:1.055*Math.pow(u,1/2.4)-.055)<0?0:u>1?1:u}function pa(u){return u>wo?u*u*u:mc*(u-ws)}const vd=Object.hasOwn||function(u,o){return Object.prototype.hasOwnProperty.call(u,o)};function ie(u,o){return vd(u,o)?u[o]:void 0}function ce(u){return parseInt(u.padEnd(2,u),16)/255}function Ce(u,o){return He(o?u/100:u,0,1)}function He(u,o,c){return Math.min(Math.max(o,u),c)}function mt(u){return!u.some(Number.isNaN)}const Xt={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function xr(u,o,c){return u+c*(o-u)}function Gr(u,o,c){return u.map(((f,_)=>xr(f,o[_],c)))}class ar{constructor(o,c,f,_=1,w=!0){this.r=o,this.g=c,this.b=f,this.a=_,w||(this.r*=_,this.g*=_,this.b*=_,_||this.overwriteGetter("rgb",[o,c,f,_]))}static parse(o){if(o instanceof ar)return o;if(typeof o!="string")return;const c=(function(f){if((f=f.toLowerCase().trim())==="transparent")return[0,0,0,0];const _=ie(Xt,f);if(_){const[E,M,R]=_;return[E/255,M/255,R/255,1]}if(f.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(f)){const E=f.length<6?1:2;let M=1;return[ce(f.slice(M,M+=E)),ce(f.slice(M,M+=E)),ce(f.slice(M,M+=E)),ce(f.slice(M,M+E)||"ff")]}if(f.startsWith("rgb")){const E=f.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(E){const[M,R,D,z,V,Z,X,Y,re,he,ye,Ne]=E,Ee=[z||" ",X||" ",he].join("");if(Ee==="  "||Ee==="  /"||Ee===",,"||Ee===",,,"){const Me=[D,Z,re].join(""),Xe=Me==="%%%"?100:Me===""?255:0;if(Xe){const st=[He(+R/Xe,0,1),He(+V/Xe,0,1),He(+Y/Xe,0,1),ye?Ce(+ye,Ne):1];if(mt(st))return st}}return}}const w=f.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(w){const[E,M,R,D,z,V,Z,X,Y]=w,re=[R||" ",z||" ",Z].join("");if(re==="  "||re==="  /"||re===",,"||re===",,,"){const he=[+M,He(+D,0,100),He(+V,0,100),X?Ce(+X,Y):1];if(mt(he))return(function([ye,Ne,Ee,Me]){function Xe(st){const ft=(st+ye/30)%12,It=Ne*Math.min(Ee,1-Ee);return Ee-It*Math.max(-1,Math.min(ft-3,9-ft,1))}return ye=Eo(ye),Ne/=100,Ee/=100,[Xe(0),Xe(8),Xe(4),Me]})(he)}}})(o);return c?new ar(...c,!1):void 0}get rgb(){const{r:o,g:c,b:f,a:_}=this,w=_||1/0;return this.overwriteGetter("rgb",[o/w,c/w,f/w,_])}get hcl(){return this.overwriteGetter("hcl",(function(o){const[c,f,_,w]=ts(o),E=Math.sqrt(f*f+_*_);return[Math.round(1e4*E)?Eo(Math.atan2(_,f)*da):NaN,E,c,w]})(this.rgb))}get lab(){return this.overwriteGetter("lab",ts(this.rgb))}overwriteGetter(o,c){return Object.defineProperty(this,o,{value:c}),c}toString(){const[o,c,f,_]=this.rgb;return`rgba(${[o,c,f].map((w=>Math.round(255*w))).join(",")},${_})`}static interpolate(o,c,f,_="rgb"){switch(_){case"rgb":{const[w,E,M,R]=Gr(o.rgb,c.rgb,f);return new ar(w,E,M,R,!1)}case"hcl":{const[w,E,M,R]=o.hcl,[D,z,V,Z]=c.hcl;let X,Y;if(isNaN(w)||isNaN(D))isNaN(w)?isNaN(D)?X=NaN:(X=D,M!==1&&M!==0||(Y=z)):(X=w,V!==1&&V!==0||(Y=E));else{let Ee=D-w;D>w&&Ee>180?Ee-=360:D<w&&w-D>180&&(Ee+=360),X=w+f*Ee}const[re,he,ye,Ne]=(function([Ee,Me,Xe,st]){return Ee=isNaN(Ee)?0:Ee*$a,Ao([Xe,Math.cos(Ee)*Me,Math.sin(Ee)*Me,st])})([X,Y??xr(E,z,f),xr(M,V,f),xr(R,Z,f)]);return new ar(re,he,ye,Ne,!1)}case"lab":{const[w,E,M,R]=Ao(Gr(o.lab,c.lab,f));return new ar(w,E,M,R,!1)}}}}ar.black=new ar(0,0,0,1),ar.white=new ar(1,1,1,1),ar.transparent=new ar(0,0,0,0),ar.red=new ar(1,0,0,1);class xi{constructor(o,c,f){this.sensitivity=o?c?"variant":"case":c?"accent":"base",this.locale=f,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(o,c){return this.collator.compare(o,c)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const Oi=["bottom","center","top"];class To{constructor(o,c,f,_,w,E){this.text=o,this.image=c,this.scale=f,this.fontStack=_,this.textColor=w,this.verticalAlign=E}}class Fi{constructor(o){this.sections=o}static fromString(o){return new Fi([new To(o,null,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some((o=>o.text.length!==0||o.image&&o.image.name.length!==0))}static factory(o){return o instanceof Fi?o:Fi.fromString(o)}toString(){return this.sections.length===0?"":this.sections.map((o=>o.text)).join("")}}class zi{constructor(o){this.values=o.slice()}static parse(o){if(o instanceof zi)return o;if(typeof o=="number")return new zi([o,o,o,o]);if(Array.isArray(o)&&!(o.length<1||o.length>4)){for(const c of o)if(typeof c!="number")return;switch(o.length){case 1:o=[o[0],o[0],o[0],o[0]];break;case 2:o=[o[0],o[1],o[0],o[1]];break;case 3:o=[o[0],o[1],o[2],o[1]]}return new zi(o)}}toString(){return JSON.stringify(this.values)}static interpolate(o,c,f){return new zi(Gr(o.values,c.values,f))}}class ln{constructor(o){this.values=o.slice()}static parse(o){if(o instanceof ln)return o;if(typeof o=="number")return new ln([o]);if(Array.isArray(o)){for(const c of o)if(typeof c!="number")return;return new ln(o)}}toString(){return JSON.stringify(this.values)}static interpolate(o,c,f){return new ln(Gr(o.values,c.values,f))}}class hi{constructor(o){this.values=o.slice()}static parse(o){if(o instanceof hi)return o;if(typeof o=="string"){const f=ar.parse(o);return f?new hi([f]):void 0}if(!Array.isArray(o))return;const c=[];for(const f of o){if(typeof f!="string")return;const _=ar.parse(f);if(!_)return;c.push(_)}return new hi(c)}toString(){return JSON.stringify(this.values)}static interpolate(o,c,f,_="rgb"){const w=[];if(o.values.length!=c.values.length)throw new Error(`colorArray: Arrays have mismatched length (${o.values.length} vs. ${c.values.length}), cannot interpolate.`);for(let E=0;E<o.values.length;E++)w.push(ar.interpolate(o.values[E],c.values[E],f,_));return new hi(w)}}class oi extends Error{constructor(o){super(o),this.name="RuntimeError"}toJSON(){return this.message}}const bd=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class cn{constructor(o){this.values=o.slice()}static parse(o){if(o instanceof cn)return o;if(Array.isArray(o)&&!(o.length<1)&&o.length%2==0){for(let c=0;c<o.length;c+=2){const f=o[c],_=o[c+1];if(typeof f!="string"||!bd.has(f)||!Array.isArray(_)||_.length!==2||typeof _[0]!="number"||typeof _[1]!="number")return}return new cn(o)}}toString(){return JSON.stringify(this.values)}static interpolate(o,c,f){const _=o.values,w=c.values;if(_.length!==w.length)throw new oi(`Cannot interpolate values of different length. from: ${o.toString()}, to: ${c.toString()}`);const E=[];for(let M=0;M<_.length;M+=2){if(_[M]!==w[M])throw new oi(`Cannot interpolate values containing mismatched anchors. from[${M}]: ${_[M]}, to[${M}]: ${w[M]}`);E.push(_[M]);const[R,D]=_[M+1],[z,V]=w[M+1];E.push([xr(R,z,f),xr(D,V,f)])}return new cn(E)}}class Os{constructor(o){this.name=o.name,this.available=o.available}toString(){return this.name}static fromString(o){return o?new Os({name:o,available:!1}):null}}class In{constructor(o,c,f){this.from=o,this.to=c,this.transition=f}static interpolate(o,c,f){return new In(o,c,f)}static parse(o){return o instanceof In?o:Array.isArray(o)&&o.length===3&&typeof o[0]=="string"&&typeof o[1]=="string"&&typeof o[2]=="number"?new In(o[0],o[1],o[2]):typeof o=="object"&&typeof o.from=="string"&&typeof o.to=="string"&&typeof o.transition=="number"?new In(o.from,o.to,o.transition):typeof o=="string"?new In(o,o,1):void 0}}function ii(u,o,c,f){return typeof u=="number"&&u>=0&&u<=255&&typeof o=="number"&&o>=0&&o<=255&&typeof c=="number"&&c>=0&&c<=255?f===void 0||typeof f=="number"&&f>=0&&f<=1?null:`Invalid rgba value [${[u,o,c,f].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof f=="number"?[u,o,c,f]:[u,o,c]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Ka(u){if(u===null||typeof u=="string"||typeof u=="boolean"||typeof u=="number"||u instanceof In||u instanceof ar||u instanceof xi||u instanceof Fi||u instanceof zi||u instanceof ln||u instanceof hi||u instanceof cn||u instanceof Os)return!0;if(Array.isArray(u)){for(const o of u)if(!Ka(o))return!1;return!0}if(typeof u=="object"){for(const o in u)if(!Ka(u[o]))return!1;return!0}return!1}function lr(u){if(u===null)return Ha;if(typeof u=="string")return Cr;if(typeof u=="boolean")return cr;if(typeof u=="number")return Tt;if(u instanceof ar)return Hi;if(u instanceof In)return eo;if(u instanceof xi)return bo;if(u instanceof Fi)return xs;if(u instanceof zi)return ha;if(u instanceof ln)return Wa;if(u instanceof hi)return to;if(u instanceof cn)return Pn;if(u instanceof Os)return br;if(Array.isArray(u)){const o=u.length;let c;for(const f of u){const _=lr(f);if(c){if(c===_)continue;c=hr;break}c=_}return Mi(c||hr,o)}return Un}function pr(u){const o=typeof u;return u===null?"":o==="string"||o==="number"||o==="boolean"?String(u):u instanceof ar||u instanceof In||u instanceof Fi||u instanceof zi||u instanceof ln||u instanceof hi||u instanceof cn||u instanceof Os?u.toString():JSON.stringify(u)}class Fs{constructor(o,c){this.type=o,this.value=c}static parse(o,c){if(o.length!==2)return c.error(`'literal' expression requires exactly one argument, but found ${o.length-1} instead.`);if(!Ka(o[1]))return c.error("invalid value");const f=o[1];let _=lr(f);const w=c.expectedType;return _.kind!=="array"||_.N!==0||!w||w.kind!=="array"||typeof w.N=="number"&&w.N!==0||(_=w),new Fs(_,f)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const Rr={string:Cr,number:Tt,boolean:cr,object:Un};class jn{constructor(o,c){this.type=o,this.args=c}static parse(o,c){if(o.length<2)return c.error("Expected at least one argument.");let f,_=1;const w=o[0];if(w==="array"){let M,R;if(o.length>2){const D=o[1];if(typeof D!="string"||!(D in Rr)||D==="object")return c.error('The item type argument of "array" must be one of string, number, boolean',1);M=Rr[D],_++}else M=hr;if(o.length>3){if(o[2]!==null&&(typeof o[2]!="number"||o[2]<0||o[2]!==Math.floor(o[2])))return c.error('The length argument to "array" must be a positive integer literal',2);R=o[2],_++}f=Mi(M,R)}else{if(!Rr[w])throw new Error(`Types doesn't contain name = ${w}`);f=Rr[w]}const E=[];for(;_<o.length;_++){const M=c.parse(o[_],_,hr);if(!M)return null;E.push(M)}return new jn(f,E)}evaluate(o){for(let c=0;c<this.args.length;c++){const f=this.args[c].evaluate(o);if(!xo(this.type,lr(f)))return f;if(c===this.args.length-1)throw new oi(`Expected value to be of type ${Dr(this.type)}, but found ${Dr(lr(f))} instead.`)}throw new Error}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every((o=>o.outputDefined()))}}const Ho={"to-boolean":cr,"to-color":Hi,"to-number":Tt,"to-string":Cr};class Wo{constructor(o,c){this.type=o,this.args=c}static parse(o,c){if(o.length<2)return c.error("Expected at least one argument.");const f=o[0];if(!Ho[f])throw new Error(`Can't parse ${f} as it is not part of the known types`);if((f==="to-boolean"||f==="to-string")&&o.length!==2)return c.error("Expected one argument.");const _=Ho[f],w=[];for(let E=1;E<o.length;E++){const M=c.parse(o[E],E,hr);if(!M)return null;w.push(M)}return new Wo(_,w)}evaluate(o){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(o);case"color":{let c,f;for(const _ of this.args){if(c=_.evaluate(o),f=null,c instanceof ar)return c;if(typeof c=="string"){const w=o.parseColor(c);if(w)return w}else if(Array.isArray(c)&&(f=c.length<3||c.length>4?`Invalid rgba value ${JSON.stringify(c)}: expected an array containing either three or four numeric values.`:ii(c[0],c[1],c[2],c[3]),!f))return new ar(c[0]/255,c[1]/255,c[2]/255,c[3])}throw new oi(f||`Could not parse color from value '${typeof c=="string"?c:JSON.stringify(c)}'`)}case"padding":{let c;for(const f of this.args){c=f.evaluate(o);const _=zi.parse(c);if(_)return _}throw new oi(`Could not parse padding from value '${typeof c=="string"?c:JSON.stringify(c)}'`)}case"numberArray":{let c;for(const f of this.args){c=f.evaluate(o);const _=ln.parse(c);if(_)return _}throw new oi(`Could not parse numberArray from value '${typeof c=="string"?c:JSON.stringify(c)}'`)}case"colorArray":{let c;for(const f of this.args){c=f.evaluate(o);const _=hi.parse(c);if(_)return _}throw new oi(`Could not parse colorArray from value '${typeof c=="string"?c:JSON.stringify(c)}'`)}case"variableAnchorOffsetCollection":{let c;for(const f of this.args){c=f.evaluate(o);const _=cn.parse(c);if(_)return _}throw new oi(`Could not parse variableAnchorOffsetCollection from value '${typeof c=="string"?c:JSON.stringify(c)}'`)}case"number":{let c=null;for(const f of this.args){if(c=f.evaluate(o),c===null)return 0;const _=Number(c);if(!isNaN(_))return _}throw new oi(`Could not convert ${JSON.stringify(c)} to number.`)}case"formatted":return Fi.fromString(pr(this.args[0].evaluate(o)));case"resolvedImage":return Os.fromString(pr(this.args[0].evaluate(o)));case"projectionDefinition":return this.args[0].evaluate(o);default:return pr(this.args[0].evaluate(o))}}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every((o=>o.outputDefined()))}}const gc=["Unknown","Point","LineString","Polygon"];class _c{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?gc[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(o){let c=this._parseColorCache.get(o);return c||(c=ar.parse(o),this._parseColorCache.set(o,c)),c}}class Ya{constructor(o,c,f=[],_,w=new Ns,E=[]){this.registry=o,this.path=f,this.key=f.map((M=>`[${M}]`)).join(""),this.scope=w,this.errors=E,this.expectedType=_,this._isConstant=c}parse(o,c,f,_,w={}){return c?this.concat(c,f,_)._parse(o,w):this._parse(o,w)}_parse(o,c){function f(_,w,E){return E==="assert"?new jn(w,[_]):E==="coerce"?new Wo(w,[_]):_}if(o!==null&&typeof o!="string"&&typeof o!="boolean"&&typeof o!="number"||(o=["literal",o]),Array.isArray(o)){if(o.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const _=o[0];if(typeof _!="string")return this.error(`Expression name must be a string, but found ${typeof _} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const w=this.registry[_];if(w){let E=w.parse(o,this);if(!E)return null;if(this.expectedType){const M=this.expectedType,R=E.type;if(M.kind!=="string"&&M.kind!=="number"&&M.kind!=="boolean"&&M.kind!=="object"&&M.kind!=="array"||R.kind!=="value"){if(M.kind==="projectionDefinition"&&["string","array"].includes(R.kind)||["color","formatted","resolvedImage"].includes(M.kind)&&["value","string"].includes(R.kind)||["padding","numberArray"].includes(M.kind)&&["value","number","array"].includes(R.kind)||M.kind==="colorArray"&&["value","string","array"].includes(R.kind)||M.kind==="variableAnchorOffsetCollection"&&["value","array"].includes(R.kind))E=f(E,M,c.typeAnnotation||"coerce");else if(this.checkSubtype(M,R))return null}else E=f(E,M,c.typeAnnotation||"assert")}if(!(E instanceof Fs)&&E.type.kind!=="resolvedImage"&&this._isConstant(E)){const M=new _c;try{E=new Fs(E.type,E.evaluate(M))}catch(R){return this.error(R.message),null}}return E}return this.error(`Unknown expression "${_}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(o===void 0?"'undefined' value invalid. Use null instead.":typeof o=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof o} instead.`)}concat(o,c,f){const _=typeof o=="number"?this.path.concat(o):this.path,w=f?this.scope.concat(f):this.scope;return new Ya(this.registry,this._isConstant,_,c||null,w,this.errors)}error(o,...c){const f=`${this.key}${c.map((_=>`[${_}]`)).join("")}`;this.errors.push(new si(f,o))}checkSubtype(o,c){const f=xo(o,c);return f&&this.error(f),f}}class yc{constructor(o,c){this.type=c.type,this.bindings=[].concat(o),this.result=c}evaluate(o){return this.result.evaluate(o)}eachChild(o){for(const c of this.bindings)o(c[1]);o(this.result)}static parse(o,c){if(o.length<4)return c.error(`Expected at least 3 arguments, but found ${o.length-1} instead.`);const f=[];for(let w=1;w<o.length-1;w+=2){const E=o[w];if(typeof E!="string")return c.error(`Expected string, but found ${typeof E} instead.`,w);if(/[^a-zA-Z0-9_]/.test(E))return c.error("Variable names must contain only alphanumeric characters or '_'.",w);const M=c.parse(o[w+1],w+1);if(!M)return null;f.push([E,M])}const _=c.parse(o[o.length-1],o.length-1,c.expectedType,f);return _?new yc(f,_):null}outputDefined(){return this.result.outputDefined()}}class So{constructor(o,c){this.type=c.type,this.name=o,this.boundExpression=c}static parse(o,c){if(o.length!==2||typeof o[1]!="string")return c.error("'var' expression requires exactly one string literal argument.");const f=o[1];return c.scope.has(f)?new So(f,c.scope.get(f)):c.error(`Unknown variable "${f}". Make sure "${f}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(o){return this.boundExpression.evaluate(o)}eachChild(){}outputDefined(){return!1}}class vc{constructor(o,c,f){this.type=o,this.index=c,this.input=f}static parse(o,c){if(o.length!==3)return c.error(`Expected 2 arguments, but found ${o.length-1} instead.`);const f=c.parse(o[1],1,Tt),_=c.parse(o[2],2,Mi(c.expectedType||hr));return f&&_?new vc(_.type.itemType,f,_):null}evaluate(o){const c=this.index.evaluate(o),f=this.input.evaluate(o);if(c<0)throw new oi(`Array index out of bounds: ${c} < 0.`);if(c>=f.length)throw new oi(`Array index out of bounds: ${c} > ${f.length-1}.`);if(c!==Math.floor(c))throw new oi(`Array index must be an integer, but found ${c} instead.`);return f[c]}eachChild(o){o(this.index),o(this.input)}outputDefined(){return!1}}class Ml{constructor(o,c){this.type=cr,this.needle=o,this.haystack=c}static parse(o,c){if(o.length!==3)return c.error(`Expected 2 arguments, but found ${o.length-1} instead.`);const f=c.parse(o[1],1,hr),_=c.parse(o[2],2,hr);return f&&_?es(f.type,[cr,Cr,Tt,Ha,hr])?new Ml(f,_):c.error(`Expected first argument to be of type boolean, string, number or null, but found ${Dr(f.type)} instead`):null}evaluate(o){const c=this.needle.evaluate(o),f=this.haystack.evaluate(o);if(!f)return!1;if(!Wi(c,["boolean","string","number","null"]))throw new oi(`Expected first argument to be of type boolean, string, number or null, but found ${Dr(lr(c))} instead.`);if(!Wi(f,["string","array"]))throw new oi(`Expected second argument to be of type array or string, but found ${Dr(lr(f))} instead.`);return f.indexOf(c)>=0}eachChild(o){o(this.needle),o(this.haystack)}outputDefined(){return!0}}class ro{constructor(o,c,f){this.type=Tt,this.needle=o,this.haystack=c,this.fromIndex=f}static parse(o,c){if(o.length<=2||o.length>=5)return c.error(`Expected 3 or 4 arguments, but found ${o.length-1} instead.`);const f=c.parse(o[1],1,hr),_=c.parse(o[2],2,hr);if(!f||!_)return null;if(!es(f.type,[cr,Cr,Tt,Ha,hr]))return c.error(`Expected first argument to be of type boolean, string, number or null, but found ${Dr(f.type)} instead`);if(o.length===4){const w=c.parse(o[3],3,Tt);return w?new ro(f,_,w):null}return new ro(f,_)}evaluate(o){const c=this.needle.evaluate(o),f=this.haystack.evaluate(o);if(!Wi(c,["boolean","string","number","null"]))throw new oi(`Expected first argument to be of type boolean, string, number or null, but found ${Dr(lr(c))} instead.`);let _;if(this.fromIndex&&(_=this.fromIndex.evaluate(o)),Wi(f,["string"])){const w=f.indexOf(c,_);return w===-1?-1:[...f.slice(0,w)].length}if(Wi(f,["array"]))return f.indexOf(c,_);throw new oi(`Expected second argument to be of type array or string, but found ${Dr(lr(f))} instead.`)}eachChild(o){o(this.needle),o(this.haystack),this.fromIndex&&o(this.fromIndex)}outputDefined(){return!1}}class qi{constructor(o,c,f,_,w,E){this.inputType=o,this.type=c,this.input=f,this.cases=_,this.outputs=w,this.otherwise=E}static parse(o,c){if(o.length<5)return c.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if(o.length%2!=1)return c.error("Expected an even number of arguments.");let f,_;c.expectedType&&c.expectedType.kind!=="value"&&(_=c.expectedType);const w={},E=[];for(let D=2;D<o.length-1;D+=2){let z=o[D];const V=o[D+1];Array.isArray(z)||(z=[z]);const Z=c.concat(D);if(z.length===0)return Z.error("Expected at least one branch label.");for(const Y of z){if(typeof Y!="number"&&typeof Y!="string")return Z.error("Branch labels must be numbers or strings.");if(typeof Y=="number"&&Math.abs(Y)>Number.MAX_SAFE_INTEGER)return Z.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof Y=="number"&&Math.floor(Y)!==Y)return Z.error("Numeric branch labels must be integer values.");if(f){if(Z.checkSubtype(f,lr(Y)))return null}else f=lr(Y);if(w[String(Y)]!==void 0)return Z.error("Branch labels must be unique.");w[String(Y)]=E.length}const X=c.parse(V,D,_);if(!X)return null;_=_||X.type,E.push(X)}const M=c.parse(o[1],1,hr);if(!M)return null;const R=c.parse(o[o.length-1],o.length-1,_);return R?M.type.kind!=="value"&&c.concat(1).checkSubtype(f,M.type)?null:new qi(f,_,M,w,E,R):null}evaluate(o){const c=this.input.evaluate(o);return(lr(c)===this.inputType&&this.outputs[this.cases[c]]||this.otherwise).evaluate(o)}eachChild(o){o(this.input),this.outputs.forEach(o),o(this.otherwise)}outputDefined(){return this.outputs.every((o=>o.outputDefined()))&&this.otherwise.outputDefined()}}class fa{constructor(o,c,f){this.type=o,this.branches=c,this.otherwise=f}static parse(o,c){if(o.length<4)return c.error(`Expected at least 3 arguments, but found only ${o.length-1}.`);if(o.length%2!=0)return c.error("Expected an odd number of arguments.");let f;c.expectedType&&c.expectedType.kind!=="value"&&(f=c.expectedType);const _=[];for(let E=1;E<o.length-1;E+=2){const M=c.parse(o[E],E,cr);if(!M)return null;const R=c.parse(o[E+1],E+1,f);if(!R)return null;_.push([M,R]),f=f||R.type}const w=c.parse(o[o.length-1],o.length-1,f);if(!w)return null;if(!f)throw new Error("Can't infer output type");return new fa(f,_,w)}evaluate(o){for(const[c,f]of this.branches)if(c.evaluate(o))return f.evaluate(o);return this.otherwise.evaluate(o)}eachChild(o){for(const[c,f]of this.branches)o(c),o(f);o(this.otherwise)}outputDefined(){return this.branches.every((([o,c])=>c.outputDefined()))&&this.otherwise.outputDefined()}}class bc{constructor(o,c,f,_){this.type=o,this.input=c,this.beginIndex=f,this.endIndex=_}static parse(o,c){if(o.length<=2||o.length>=5)return c.error(`Expected 3 or 4 arguments, but found ${o.length-1} instead.`);const f=c.parse(o[1],1,hr),_=c.parse(o[2],2,Tt);if(!f||!_)return null;if(!es(f.type,[Mi(hr),Cr,hr]))return c.error(`Expected first argument to be of type array or string, but found ${Dr(f.type)} instead`);if(o.length===4){const w=c.parse(o[3],3,Tt);return w?new bc(f.type,f,_,w):null}return new bc(f.type,f,_)}evaluate(o){const c=this.input.evaluate(o),f=this.beginIndex.evaluate(o);let _;if(this.endIndex&&(_=this.endIndex.evaluate(o)),Wi(c,["string"]))return[...c].slice(f,_).join("");if(Wi(c,["array"]))return c.slice(f,_);throw new oi(`Expected first argument to be of type array or string, but found ${Dr(lr(c))} instead.`)}eachChild(o){o(this.input),o(this.beginIndex),this.endIndex&&o(this.endIndex)}outputDefined(){return!1}}function un(u,o){const c=u.length-1;let f,_,w=0,E=c,M=0;for(;w<=E;)if(M=Math.floor((w+E)/2),f=u[M],_=u[M+1],f<=o){if(M===c||o<_)return M;w=M+1}else{if(!(f>o))throw new oi("Input is not a number.");E=M-1}return 0}class di{constructor(o,c,f){this.type=o,this.input=c,this.labels=[],this.outputs=[];for(const[_,w]of f)this.labels.push(_),this.outputs.push(w)}static parse(o,c){if(o.length-1<4)return c.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if((o.length-1)%2!=0)return c.error("Expected an even number of arguments.");const f=c.parse(o[1],1,Tt);if(!f)return null;const _=[];let w=null;c.expectedType&&c.expectedType.kind!=="value"&&(w=c.expectedType);for(let E=1;E<o.length;E+=2){const M=E===1?-1/0:o[E],R=o[E+1],D=E,z=E+1;if(typeof M!="number")return c.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',D);if(_.length&&_[_.length-1][0]>=M)return c.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',D);const V=c.parse(R,z,w);if(!V)return null;w=w||V.type,_.push([M,V])}return new di(w,f,_)}evaluate(o){const c=this.labels,f=this.outputs;if(c.length===1)return f[0].evaluate(o);const _=this.input.evaluate(o);if(_<=c[0])return f[0].evaluate(o);const w=c.length;return _>=c[w-1]?f[w-1].evaluate(o):f[un(c,_)].evaluate(o)}eachChild(o){o(this.input);for(const c of this.outputs)o(c)}outputDefined(){return this.outputs.every((o=>o.outputDefined()))}}function uh(u){return u&&u.__esModule&&Object.prototype.hasOwnProperty.call(u,"default")?u.default:u}var ma,xd,wd=(function(){if(xd)return ma;function u(o,c,f,_){this.cx=3*o,this.bx=3*(f-o)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*c,this.by=3*(_-c)-this.cy,this.ay=1-this.cy-this.by,this.p1x=o,this.p1y=c,this.p2x=f,this.p2y=_}return xd=1,ma=u,u.prototype={sampleCurveX:function(o){return((this.ax*o+this.bx)*o+this.cx)*o},sampleCurveY:function(o){return((this.ay*o+this.by)*o+this.cy)*o},sampleCurveDerivativeX:function(o){return(3*this.ax*o+2*this.bx)*o+this.cx},solveCurveX:function(o,c){if(c===void 0&&(c=1e-6),o<0)return 0;if(o>1)return 1;for(var f=o,_=0;_<8;_++){var w=this.sampleCurveX(f)-o;if(Math.abs(w)<c)return f;var E=this.sampleCurveDerivativeX(f);if(Math.abs(E)<1e-6)break;f-=w/E}var M=0,R=1;for(f=o,_=0;_<20&&(w=this.sampleCurveX(f),!(Math.abs(w-o)<c));_++)o>w?M=f:R=f,f=.5*(R-M)+M;return f},solve:function(o,c){return this.sampleCurveY(this.solveCurveX(o,c))}},ma})(),Ja=uh(wd);class $i{constructor(o,c,f,_,w){this.type=o,this.operator=c,this.interpolation=f,this.input=_,this.labels=[],this.outputs=[];for(const[E,M]of w)this.labels.push(E),this.outputs.push(M)}static interpolationFactor(o,c,f,_){let w=0;if(o.name==="exponential")w=Qa(c,o.base,f,_);else if(o.name==="linear")w=Qa(c,1,f,_);else if(o.name==="cubic-bezier"){const E=o.controlPoints;w=new Ja(E[0],E[1],E[2],E[3]).solve(Qa(c,1,f,_))}return w}static parse(o,c){let[f,_,w,...E]=o;if(!Array.isArray(_)||_.length===0)return c.error("Expected an interpolation type expression.",1);if(_[0]==="linear")_={name:"linear"};else if(_[0]==="exponential"){const D=_[1];if(typeof D!="number")return c.error("Exponential interpolation requires a numeric base.",1,1);_={name:"exponential",base:D}}else{if(_[0]!=="cubic-bezier")return c.error(`Unknown interpolation type ${String(_[0])}`,1,0);{const D=_.slice(1);if(D.length!==4||D.some((z=>typeof z!="number"||z<0||z>1)))return c.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);_={name:"cubic-bezier",controlPoints:D}}}if(o.length-1<4)return c.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if((o.length-1)%2!=0)return c.error("Expected an even number of arguments.");if(w=c.parse(w,2,Tt),!w)return null;const M=[];let R=null;f!=="interpolate-hcl"&&f!=="interpolate-lab"||c.expectedType==to?c.expectedType&&c.expectedType.kind!=="value"&&(R=c.expectedType):R=Hi;for(let D=0;D<E.length;D+=2){const z=E[D],V=E[D+1],Z=D+3,X=D+4;if(typeof z!="number")return c.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',Z);if(M.length&&M[M.length-1][0]>=z)return c.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',Z);const Y=c.parse(V,X,R);if(!Y)return null;R=R||Y.type,M.push([z,Y])}return en(R,Tt)||en(R,eo)||en(R,Hi)||en(R,ha)||en(R,Wa)||en(R,to)||en(R,Pn)||en(R,Mi(Tt))?new $i(R,f,_,w,M):c.error(`Type ${Dr(R)} is not interpolatable.`)}evaluate(o){const c=this.labels,f=this.outputs;if(c.length===1)return f[0].evaluate(o);const _=this.input.evaluate(o);if(_<=c[0])return f[0].evaluate(o);const w=c.length;if(_>=c[w-1])return f[w-1].evaluate(o);const E=un(c,_),M=$i.interpolationFactor(this.interpolation,_,c[E],c[E+1]),R=f[E].evaluate(o),D=f[E+1].evaluate(o);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return xr(R,D,M);case"color":return ar.interpolate(R,D,M);case"padding":return zi.interpolate(R,D,M);case"colorArray":return hi.interpolate(R,D,M);case"numberArray":return ln.interpolate(R,D,M);case"variableAnchorOffsetCollection":return cn.interpolate(R,D,M);case"array":return Gr(R,D,M);case"projectionDefinition":return In.interpolate(R,D,M)}case"interpolate-hcl":switch(this.type.kind){case"color":return ar.interpolate(R,D,M,"hcl");case"colorArray":return hi.interpolate(R,D,M,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return ar.interpolate(R,D,M,"lab");case"colorArray":return hi.interpolate(R,D,M,"lab")}}}eachChild(o){o(this.input);for(const c of this.outputs)o(c)}outputDefined(){return this.outputs.every((o=>o.outputDefined()))}}function Qa(u,o,c,f){const _=f-c,w=u-c;return _===0?0:o===1?w/_:(Math.pow(o,w)-1)/(Math.pow(o,_)-1)}const Co={color:ar.interpolate,number:xr,padding:zi.interpolate,numberArray:ln.interpolate,colorArray:hi.interpolate,variableAnchorOffsetCollection:cn.interpolate,array:Gr};class pu{constructor(o,c){this.type=o,this.args=c}static parse(o,c){if(o.length<2)return c.error("Expected at least one argument.");let f=null;const _=c.expectedType;_&&_.kind!=="value"&&(f=_);const w=[];for(const M of o.slice(1)){const R=c.parse(M,1+w.length,f,void 0,{typeAnnotation:"omit"});if(!R)return null;f=f||R.type,w.push(R)}if(!f)throw new Error("No output type");const E=_&&w.some((M=>xo(_,M.type)));return new pu(E?hr:f,w)}evaluate(o){let c,f=null,_=0;for(const w of this.args)if(_++,f=w.evaluate(o),f&&f instanceof Os&&!f.available&&(c||(c=f.name),f=null,_===this.args.length&&(f=c)),f!==null)break;return f}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every((o=>o.outputDefined()))}}function fu(u,o){return u==="=="||u==="!="?o.kind==="boolean"||o.kind==="string"||o.kind==="number"||o.kind==="null"||o.kind==="value":o.kind==="string"||o.kind==="number"||o.kind==="value"}function mu(u,o,c,f){return f.compare(o,c)===0}function bn(u,o,c){const f=u!=="=="&&u!=="!=";return class zI{constructor(w,E,M){this.type=cr,this.lhs=w,this.rhs=E,this.collator=M,this.hasUntypedArgument=w.type.kind==="value"||E.type.kind==="value"}static parse(w,E){if(w.length!==3&&w.length!==4)return E.error("Expected two or three arguments.");const M=w[0];let R=E.parse(w[1],1,hr);if(!R)return null;if(!fu(M,R.type))return E.concat(1).error(`"${M}" comparisons are not supported for type '${Dr(R.type)}'.`);let D=E.parse(w[2],2,hr);if(!D)return null;if(!fu(M,D.type))return E.concat(2).error(`"${M}" comparisons are not supported for type '${Dr(D.type)}'.`);if(R.type.kind!==D.type.kind&&R.type.kind!=="value"&&D.type.kind!=="value")return E.error(`Cannot compare types '${Dr(R.type)}' and '${Dr(D.type)}'.`);f&&(R.type.kind==="value"&&D.type.kind!=="value"?R=new jn(D.type,[R]):R.type.kind!=="value"&&D.type.kind==="value"&&(D=new jn(R.type,[D])));let z=null;if(w.length===4){if(R.type.kind!=="string"&&D.type.kind!=="string"&&R.type.kind!=="value"&&D.type.kind!=="value")return E.error("Cannot use collator to compare non-string types.");if(z=E.parse(w[3],3,bo),!z)return null}return new zI(R,D,z)}evaluate(w){const E=this.lhs.evaluate(w),M=this.rhs.evaluate(w);if(f&&this.hasUntypedArgument){const R=lr(E),D=lr(M);if(R.kind!==D.kind||R.kind!=="string"&&R.kind!=="number")throw new oi(`Expected arguments for "${u}" to be (string, string) or (number, number), but found (${R.kind}, ${D.kind}) instead.`)}if(this.collator&&!f&&this.hasUntypedArgument){const R=lr(E),D=lr(M);if(R.kind!=="string"||D.kind!=="string")return o(w,E,M)}return this.collator?c(w,E,M,this.collator.evaluate(w)):o(w,E,M)}eachChild(w){w(this.lhs),w(this.rhs),this.collator&&w(this.collator)}outputDefined(){return!0}}}const Qp=bn("==",(function(u,o,c){return o===c}),mu),hh=bn("!=",(function(u,o,c){return o!==c}),(function(u,o,c,f){return!mu(0,o,c,f)})),zm=bn("<",(function(u,o,c){return o<c}),(function(u,o,c,f){return f.compare(o,c)<0})),Ed=bn(">",(function(u,o,c){return o>c}),(function(u,o,c,f){return f.compare(o,c)>0})),Um=bn("<=",(function(u,o,c){return o<=c}),(function(u,o,c,f){return f.compare(o,c)<=0})),ef=bn(">=",(function(u,o,c){return o>=c}),(function(u,o,c,f){return f.compare(o,c)>=0}));class dh{constructor(o,c,f){this.type=bo,this.locale=f,this.caseSensitive=o,this.diacriticSensitive=c}static parse(o,c){if(o.length!==2)return c.error("Expected one argument.");const f=o[1];if(typeof f!="object"||Array.isArray(f))return c.error("Collator options argument must be an object.");const _=c.parse(f["case-sensitive"]!==void 0&&f["case-sensitive"],1,cr);if(!_)return null;const w=c.parse(f["diacritic-sensitive"]!==void 0&&f["diacritic-sensitive"],1,cr);if(!w)return null;let E=null;return f.locale&&(E=c.parse(f.locale,1,Cr),!E)?null:new dh(_,w,E)}evaluate(o){return new xi(this.caseSensitive.evaluate(o),this.diacriticSensitive.evaluate(o),this.locale?this.locale.evaluate(o):null)}eachChild(o){o(this.caseSensitive),o(this.diacriticSensitive),this.locale&&o(this.locale)}outputDefined(){return!1}}class Ad{constructor(o,c,f,_,w){this.type=Cr,this.number=o,this.locale=c,this.currency=f,this.minFractionDigits=_,this.maxFractionDigits=w}static parse(o,c){if(o.length!==3)return c.error("Expected two arguments.");const f=c.parse(o[1],1,Tt);if(!f)return null;const _=o[2];if(typeof _!="object"||Array.isArray(_))return c.error("NumberFormat options argument must be an object.");let w=null;if(_.locale&&(w=c.parse(_.locale,1,Cr),!w))return null;let E=null;if(_.currency&&(E=c.parse(_.currency,1,Cr),!E))return null;let M=null;if(_["min-fraction-digits"]&&(M=c.parse(_["min-fraction-digits"],1,Tt),!M))return null;let R=null;return _["max-fraction-digits"]&&(R=c.parse(_["max-fraction-digits"],1,Tt),!R)?null:new Ad(f,w,E,M,R)}evaluate(o){return new Intl.NumberFormat(this.locale?this.locale.evaluate(o):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(o):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(o):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(o):void 0}).format(this.number.evaluate(o))}eachChild(o){o(this.number),this.locale&&o(this.locale),this.currency&&o(this.currency),this.minFractionDigits&&o(this.minFractionDigits),this.maxFractionDigits&&o(this.maxFractionDigits)}outputDefined(){return!1}}class Pl{constructor(o){this.type=xs,this.sections=o}static parse(o,c){if(o.length<2)return c.error("Expected at least one argument.");const f=o[1];if(!Array.isArray(f)&&typeof f=="object")return c.error("First argument must be an image or text section.");const _=[];let w=!1;for(let E=1;E<=o.length-1;++E){const M=o[E];if(w&&typeof M=="object"&&!Array.isArray(M)){w=!1;let R=null;if(M["font-scale"]&&(R=c.parse(M["font-scale"],1,Tt),!R))return null;let D=null;if(M["text-font"]&&(D=c.parse(M["text-font"],1,Mi(Cr)),!D))return null;let z=null;if(M["text-color"]&&(z=c.parse(M["text-color"],1,Hi),!z))return null;let V=null;if(M["vertical-align"]){if(typeof M["vertical-align"]=="string"&&!Oi.includes(M["vertical-align"]))return c.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${M["vertical-align"]}' instead.`);if(V=c.parse(M["vertical-align"],1,Cr),!V)return null}const Z=_[_.length-1];Z.scale=R,Z.font=D,Z.textColor=z,Z.verticalAlign=V}else{const R=c.parse(o[E],1,hr);if(!R)return null;const D=R.type.kind;if(D!=="string"&&D!=="value"&&D!=="null"&&D!=="resolvedImage")return c.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");w=!0,_.push({content:R,scale:null,font:null,textColor:null,verticalAlign:null})}}return new Pl(_)}evaluate(o){return new Fi(this.sections.map((c=>{const f=c.content.evaluate(o);return lr(f)===br?new To("",f,null,null,null,c.verticalAlign?c.verticalAlign.evaluate(o):null):new To(pr(f),null,c.scale?c.scale.evaluate(o):null,c.font?c.font.evaluate(o).join(","):null,c.textColor?c.textColor.evaluate(o):null,c.verticalAlign?c.verticalAlign.evaluate(o):null)})))}eachChild(o){for(const c of this.sections)o(c.content),c.scale&&o(c.scale),c.font&&o(c.font),c.textColor&&o(c.textColor),c.verticalAlign&&o(c.verticalAlign)}outputDefined(){return!1}}class Td{constructor(o){this.type=br,this.input=o}static parse(o,c){if(o.length!==2)return c.error("Expected two arguments.");const f=c.parse(o[1],1,Cr);return f?new Td(f):c.error("No image name provided.")}evaluate(o){const c=this.input.evaluate(o),f=Os.fromString(c);return f&&o.availableImages&&(f.available=o.availableImages.indexOf(c)>-1),f}eachChild(o){o(this.input)}outputDefined(){return!1}}class xc{constructor(o){this.type=Tt,this.input=o}static parse(o,c){if(o.length!==2)return c.error(`Expected 1 argument, but found ${o.length-1} instead.`);const f=c.parse(o[1],1);return f?f.type.kind!=="array"&&f.type.kind!=="string"&&f.type.kind!=="value"?c.error(`Expected argument of type string or array, but found ${Dr(f.type)} instead.`):new xc(f):null}evaluate(o){const c=this.input.evaluate(o);if(typeof c=="string")return[...c].length;if(Array.isArray(c))return c.length;throw new oi(`Expected value to be of type string or array, but found ${Dr(lr(c))} instead.`)}eachChild(o){o(this.input)}outputDefined(){return!1}}const Mo=8192;function jm(u,o){const c=(180+u[0])/360,f=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+u[1]*Math.PI/360)))/360,_=Math.pow(2,o.z);return[Math.round(c*_*Mo),Math.round(f*_*Mo)]}function ph(u,o){const c=Math.pow(2,o.z);return[(_=(u[0]/Mo+o.x)/c,360*_-180),(f=(u[1]/Mo+o.y)/c,360/Math.PI*Math.atan(Math.exp((180-360*f)*Math.PI/180))-90)];var f,_}function wc(u,o){u[0]=Math.min(u[0],o[0]),u[1]=Math.min(u[1],o[1]),u[2]=Math.max(u[2],o[0]),u[3]=Math.max(u[3],o[1])}function gu(u,o){return!(u[0]<=o[0]||u[2]>=o[2]||u[1]<=o[1]||u[3]>=o[3])}function Vm(u,o,c){const f=u[0]-o[0],_=u[1]-o[1],w=u[0]-c[0],E=u[1]-c[1];return f*E-w*_==0&&f*w<=0&&_*E<=0}function fh(u,o,c,f){return(_=[f[0]-c[0],f[1]-c[1]])[0]*(w=[o[0]-u[0],o[1]-u[1]])[1]-_[1]*w[0]!=0&&!(!Ec(u,o,c,f)||!Ec(c,f,u,o));var _,w}function Gm(u,o,c){for(const f of c)for(let _=0;_<f.length-1;++_)if(fh(u,o,f[_],f[_+1]))return!0;return!1}function Rl(u,o,c=!1){let f=!1;for(const M of o)for(let R=0;R<M.length-1;R++){if(Vm(u,M[R],M[R+1]))return c;(w=M[R])[1]>(_=u)[1]!=(E=M[R+1])[1]>_[1]&&_[0]<(E[0]-w[0])*(_[1]-w[1])/(E[1]-w[1])+w[0]&&(f=!f)}var _,w,E;return f}function tf(u,o){for(const c of o)if(Rl(u,c))return!0;return!1}function Sd(u,o){for(const c of u)if(!Rl(c,o))return!1;for(let c=0;c<u.length-1;++c)if(Gm(u[c],u[c+1],o))return!1;return!0}function Cd(u,o){for(const c of o)if(Sd(u,c))return!0;return!1}function Ec(u,o,c,f){const _=f[0]-c[0],w=f[1]-c[1],E=(u[0]-c[0])*w-_*(u[1]-c[1]),M=(o[0]-c[0])*w-_*(o[1]-c[1]);return E>0&&M<0||E<0&&M>0}function Md(u,o,c){const f=[];for(let _=0;_<u.length;_++){const w=[];for(let E=0;E<u[_].length;E++){const M=jm(u[_][E],c);wc(o,M),w.push(M)}f.push(w)}return f}function Pd(u,o,c){const f=[];for(let _=0;_<u.length;_++){const w=Md(u[_],o,c);f.push(w)}return f}function _u(u,o,c,f){if(u[0]<c[0]||u[0]>c[2]){const _=.5*f;let w=u[0]-c[0]>_?-f:c[0]-u[0]>_?f:0;w===0&&(w=u[0]-c[2]>_?-f:c[2]-u[0]>_?f:0),u[0]+=w}wc(o,u)}function Rd(u,o,c,f){const _=Math.pow(2,f.z)*Mo,w=[f.x*Mo,f.y*Mo],E=[];for(const M of u)for(const R of M){const D=[R.x+w[0],R.y+w[1]];_u(D,o,c,_),E.push(D)}return E}function Id(u,o,c,f){const _=Math.pow(2,f.z)*Mo,w=[f.x*Mo,f.y*Mo],E=[];for(const R of u){const D=[];for(const z of R){const V=[z.x+w[0],z.y+w[1]];wc(o,V),D.push(V)}E.push(D)}if(o[2]-o[0]<=_/2){(M=o)[0]=M[1]=1/0,M[2]=M[3]=-1/0;for(const R of E)for(const D of R)_u(D,o,c,_)}var M;return E}class el{constructor(o,c){this.type=cr,this.geojson=o,this.geometries=c}static parse(o,c){if(o.length!==2)return c.error(`'within' expression requires exactly one argument, but found ${o.length-1} instead.`);if(Ka(o[1])){const f=o[1];if(f.type==="FeatureCollection"){const _=[];for(const w of f.features){const{type:E,coordinates:M}=w.geometry;E==="Polygon"&&_.push(M),E==="MultiPolygon"&&_.push(...M)}if(_.length)return new el(f,{type:"MultiPolygon",coordinates:_})}else if(f.type==="Feature"){const _=f.geometry.type;if(_==="Polygon"||_==="MultiPolygon")return new el(f,f.geometry)}else if(f.type==="Polygon"||f.type==="MultiPolygon")return new el(f,f)}return c.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(o){if(o.geometry()!=null&&o.canonicalID()!=null){if(o.geometryType()==="Point")return(function(c,f){const _=[1/0,1/0,-1/0,-1/0],w=[1/0,1/0,-1/0,-1/0],E=c.canonicalID();if(f.type==="Polygon"){const M=Md(f.coordinates,w,E),R=Rd(c.geometry(),_,w,E);if(!gu(_,w))return!1;for(const D of R)if(!Rl(D,M))return!1}if(f.type==="MultiPolygon"){const M=Pd(f.coordinates,w,E),R=Rd(c.geometry(),_,w,E);if(!gu(_,w))return!1;for(const D of R)if(!tf(D,M))return!1}return!0})(o,this.geometries);if(o.geometryType()==="LineString")return(function(c,f){const _=[1/0,1/0,-1/0,-1/0],w=[1/0,1/0,-1/0,-1/0],E=c.canonicalID();if(f.type==="Polygon"){const M=Md(f.coordinates,w,E),R=Id(c.geometry(),_,w,E);if(!gu(_,w))return!1;for(const D of R)if(!Sd(D,M))return!1}if(f.type==="MultiPolygon"){const M=Pd(f.coordinates,w,E),R=Id(c.geometry(),_,w,E);if(!gu(_,w))return!1;for(const D of R)if(!Cd(D,M))return!1}return!0})(o,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let tl=class{constructor(u=[],o=(c,f)=>c<f?-1:c>f?1:0){if(this.data=u,this.length=this.data.length,this.compare=o,this.length>0)for(let c=(this.length>>1)-1;c>=0;c--)this._down(c)}push(u){this.data.push(u),this._up(this.length++)}pop(){if(this.length===0)return;const u=this.data[0],o=this.data.pop();return--this.length>0&&(this.data[0]=o,this._down(0)),u}peek(){return this.data[0]}_up(u){const{data:o,compare:c}=this,f=o[u];for(;u>0;){const _=u-1>>1,w=o[_];if(c(f,w)>=0)break;o[u]=w,u=_}o[u]=f}_down(u){const{data:o,compare:c}=this,f=this.length>>1,_=o[u];for(;u<f;){let w=1+(u<<1);const E=w+1;if(E<this.length&&c(o[E],o[w])<0&&(w=E),c(o[w],_)>=0)break;o[u]=o[w],u=w}o[u]=_}};function kd(u,o,c=0,f=u.length-1,_=Hm){for(;f>c;){if(f-c>600){const R=f-c+1,D=o-c+1,z=Math.log(R),V=.5*Math.exp(2*z/3),Z=.5*Math.sqrt(z*V*(R-V)/R)*(D-R/2<0?-1:1);kd(u,o,Math.max(c,Math.floor(o-D*V/R+Z)),Math.min(f,Math.floor(o+(R-D)*V/R+Z)),_)}const w=u[o];let E=c,M=f;for(yu(u,c,o),_(u[f],w)>0&&yu(u,c,f);E<M;){for(yu(u,E,M),E++,M--;_(u[E],w)<0;)E++;for(;_(u[M],w)>0;)M--}_(u[c],w)===0?yu(u,c,M):(M++,yu(u,M,f)),M<=o&&(c=M+1),o<=M&&(f=M-1)}}function yu(u,o,c){const f=u[o];u[o]=u[c],u[c]=f}function Hm(u,o){return u<o?-1:u>o?1:0}function Ac(u,o){if(u.length<=1)return[u];const c=[];let f,_;for(const w of u){const E=vu(w);E!==0&&(w.area=Math.abs(E),_===void 0&&(_=E<0),_===E<0?(f&&c.push(f),f=[w]):f.push(w))}if(f&&c.push(f),o>1)for(let w=0;w<c.length;w++)c[w].length<=o||(kd(c[w],o,1,c[w].length-1,Bd),c[w]=c[w].slice(0,o));return c}function Bd(u,o){return o.area-u.area}function vu(u){let o=0;for(let c,f,_=0,w=u.length,E=w-1;_<w;E=_++)c=u[_],f=u[E],o+=(f.x-c.x)*(c.y+f.y);return o}const Tc=1/298.257223563,rf=Tc*(2-Tc),Sc=Math.PI/180;class Ld{constructor(o){const c=6378.137*Sc*1e3,f=Math.cos(o*Sc),_=1/(1-rf*(1-f*f)),w=Math.sqrt(_);this.kx=c*w*f,this.ky=c*w*_*(1-rf)}distance(o,c){const f=this.wrap(o[0]-c[0])*this.kx,_=(o[1]-c[1])*this.ky;return Math.sqrt(f*f+_*_)}pointOnLine(o,c){let f,_,w,E,M=1/0;for(let R=0;R<o.length-1;R++){let D=o[R][0],z=o[R][1],V=this.wrap(o[R+1][0]-D)*this.kx,Z=(o[R+1][1]-z)*this.ky,X=0;V===0&&Z===0||(X=(this.wrap(c[0]-D)*this.kx*V+(c[1]-z)*this.ky*Z)/(V*V+Z*Z),X>1?(D=o[R+1][0],z=o[R+1][1]):X>0&&(D+=V/this.kx*X,z+=Z/this.ky*X)),V=this.wrap(c[0]-D)*this.kx,Z=(c[1]-z)*this.ky;const Y=V*V+Z*Z;Y<M&&(M=Y,f=D,_=z,w=R,E=X)}return{point:[f,_],index:w,t:Math.max(0,Math.min(1,E))}}wrap(o){for(;o<-180;)o+=360;for(;o>180;)o-=360;return o}}function Dd(u,o){return o[0]-u[0]}function Cc(u){return u[1]-u[0]+1}function Po(u,o){return u[1]>=u[0]&&u[1]<o}function Fr(u,o){if(u[0]>u[1])return[null,null];const c=Cc(u);if(o){if(c===2)return[u,null];const _=Math.floor(c/2);return[[u[0],u[0]+_],[u[0]+_,u[1]]]}if(c===1)return[u,null];const f=Math.floor(c/2)-1;return[[u[0],u[0]+f],[u[0]+f+1,u[1]]]}function mh(u,o){if(!Po(o,u.length))return[1/0,1/0,-1/0,-1/0];const c=[1/0,1/0,-1/0,-1/0];for(let f=o[0];f<=o[1];++f)wc(c,u[f]);return c}function gh(u){const o=[1/0,1/0,-1/0,-1/0];for(const c of u)for(const f of c)wc(o,f);return o}function nf(u){return u[0]!==-1/0&&u[1]!==-1/0&&u[2]!==1/0&&u[3]!==1/0}function Nd(u,o,c){if(!nf(u)||!nf(o))return NaN;let f=0,_=0;return u[2]<o[0]&&(f=o[0]-u[2]),u[0]>o[2]&&(f=u[0]-o[2]),u[1]>o[3]&&(_=u[1]-o[3]),u[3]<o[1]&&(_=o[1]-u[3]),c.distance([0,0],[f,_])}function Il(u,o,c){const f=c.pointOnLine(o,u);return c.distance(u,f.point)}function Od(u,o,c,f,_){const w=Math.min(Il(u,[c,f],_),Il(o,[c,f],_)),E=Math.min(Il(c,[u,o],_),Il(f,[u,o],_));return Math.min(w,E)}function Wm(u,o,c,f,_){if(!Po(o,u.length)||!Po(f,c.length))return 1/0;let w=1/0;for(let E=o[0];E<o[1];++E){const M=u[E],R=u[E+1];for(let D=f[0];D<f[1];++D){const z=c[D],V=c[D+1];if(fh(M,R,z,V))return 0;w=Math.min(w,Od(M,R,z,V,_))}}return w}function Ro(u,o,c,f,_){if(!Po(o,u.length)||!Po(f,c.length))return NaN;let w=1/0;for(let E=o[0];E<=o[1];++E)for(let M=f[0];M<=f[1];++M)if(w=Math.min(w,_.distance(u[E],c[M])),w===0)return w;return w}function bu(u,o,c){if(Rl(u,o,!0))return 0;let f=1/0;for(const _ of o){const w=_[0],E=_[_.length-1];if(w!==E&&(f=Math.min(f,Il(u,[E,w],c)),f===0))return f;const M=c.pointOnLine(_,u);if(f=Math.min(f,c.distance(u,M.point)),f===0)return f}return f}function sf(u,o,c,f){if(!Po(o,u.length))return NaN;for(let w=o[0];w<=o[1];++w)if(Rl(u[w],c,!0))return 0;let _=1/0;for(let w=o[0];w<o[1];++w){const E=u[w],M=u[w+1];for(const R of c)for(let D=0,z=R.length,V=z-1;D<z;V=D++){const Z=R[V],X=R[D];if(fh(E,M,Z,X))return 0;_=Math.min(_,Od(E,M,Z,X,f))}}return _}function Fd(u,o){for(const c of u)for(const f of c)if(Rl(f,o,!0))return!0;return!1}function of(u,o,c,f=1/0){const _=gh(u),w=gh(o);if(f!==1/0&&Nd(_,w,c)>=f)return f;if(gu(_,w)){if(Fd(u,o))return 0}else if(Fd(o,u))return 0;let E=1/0;for(const M of u)for(let R=0,D=M.length,z=D-1;R<D;z=R++){const V=M[z],Z=M[R];for(const X of o)for(let Y=0,re=X.length,he=re-1;Y<re;he=Y++){const ye=X[he],Ne=X[Y];if(fh(V,Z,ye,Ne))return 0;E=Math.min(E,Od(V,Z,ye,Ne,c))}}return E}function zd(u,o,c,f,_,w){if(!w)return;const E=Nd(mh(f,w),_,c);E<o&&u.push([E,w,[0,0]])}function Mc(u,o,c,f,_,w,E){if(!w||!E)return;const M=Nd(mh(f,w),mh(_,E),c);M<o&&u.push([M,w,E])}function _h(u,o,c,f,_=1/0){let w=Math.min(f.distance(u[0],c[0][0]),_);if(w===0)return w;const E=new tl([[0,[0,u.length-1],[0,0]]],Dd),M=gh(c);for(;E.length>0;){const R=E.pop();if(R[0]>=w)continue;const D=R[1],z=o?50:100;if(Cc(D)<=z){if(!Po(D,u.length))return NaN;if(o){const V=sf(u,D,c,f);if(isNaN(V)||V===0)return V;w=Math.min(w,V)}else for(let V=D[0];V<=D[1];++V){const Z=bu(u[V],c,f);if(w=Math.min(w,Z),w===0)return 0}}else{const V=Fr(D,o);zd(E,w,f,u,M,V[0]),zd(E,w,f,u,M,V[1])}}return w}function yh(u,o,c,f,_,w=1/0){let E=Math.min(w,_.distance(u[0],c[0]));if(E===0)return E;const M=new tl([[0,[0,u.length-1],[0,c.length-1]]],Dd);for(;M.length>0;){const R=M.pop();if(R[0]>=E)continue;const D=R[1],z=R[2],V=o?50:100,Z=f?50:100;if(Cc(D)<=V&&Cc(z)<=Z){if(!Po(D,u.length)&&Po(z,c.length))return NaN;let X;if(o&&f)X=Wm(u,D,c,z,_),E=Math.min(E,X);else if(o&&!f){const Y=u.slice(D[0],D[1]+1);for(let re=z[0];re<=z[1];++re)if(X=Il(c[re],Y,_),E=Math.min(E,X),E===0)return E}else if(!o&&f){const Y=c.slice(z[0],z[1]+1);for(let re=D[0];re<=D[1];++re)if(X=Il(u[re],Y,_),E=Math.min(E,X),E===0)return E}else X=Ro(u,D,c,z,_),E=Math.min(E,X)}else{const X=Fr(D,o),Y=Fr(z,f);Mc(M,E,_,u,c,X[0],Y[0]),Mc(M,E,_,u,c,X[0],Y[1]),Mc(M,E,_,u,c,X[1],Y[0]),Mc(M,E,_,u,c,X[1],Y[1])}}return E}function rl(u){return u.type==="MultiPolygon"?u.coordinates.map((o=>({type:"Polygon",coordinates:o}))):u.type==="MultiLineString"?u.coordinates.map((o=>({type:"LineString",coordinates:o}))):u.type==="MultiPoint"?u.coordinates.map((o=>({type:"Point",coordinates:o}))):[u]}class ga{constructor(o,c){this.type=Tt,this.geojson=o,this.geometries=c}static parse(o,c){if(o.length!==2)return c.error(`'distance' expression requires exactly one argument, but found ${o.length-1} instead.`);if(Ka(o[1])){const f=o[1];if(f.type==="FeatureCollection")return new ga(f,f.features.map((_=>rl(_.geometry))).flat());if(f.type==="Feature")return new ga(f,rl(f.geometry));if("type"in f&&"coordinates"in f)return new ga(f,rl(f))}return c.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(o){if(o.geometry()!=null&&o.canonicalID()!=null){if(o.geometryType()==="Point")return(function(c,f){const _=c.geometry(),w=_.flat().map((R=>ph([R.x,R.y],c.canonical)));if(_.length===0)return NaN;const E=new Ld(w[0][1]);let M=1/0;for(const R of f){switch(R.type){case"Point":M=Math.min(M,yh(w,!1,[R.coordinates],!1,E,M));break;case"LineString":M=Math.min(M,yh(w,!1,R.coordinates,!0,E,M));break;case"Polygon":M=Math.min(M,_h(w,!1,R.coordinates,E,M))}if(M===0)return M}return M})(o,this.geometries);if(o.geometryType()==="LineString")return(function(c,f){const _=c.geometry(),w=_.flat().map((R=>ph([R.x,R.y],c.canonical)));if(_.length===0)return NaN;const E=new Ld(w[0][1]);let M=1/0;for(const R of f){switch(R.type){case"Point":M=Math.min(M,yh(w,!0,[R.coordinates],!1,E,M));break;case"LineString":M=Math.min(M,yh(w,!0,R.coordinates,!0,E,M));break;case"Polygon":M=Math.min(M,_h(w,!0,R.coordinates,E,M))}if(M===0)return M}return M})(o,this.geometries);if(o.geometryType()==="Polygon")return(function(c,f){const _=c.geometry();if(_.length===0||_[0].length===0)return NaN;const w=Ac(_,0).map((R=>R.map((D=>D.map((z=>ph([z.x,z.y],c.canonical))))))),E=new Ld(w[0][0][0][1]);let M=1/0;for(const R of f)for(const D of w){switch(R.type){case"Point":M=Math.min(M,_h([R.coordinates],!1,D,E,M));break;case"LineString":M=Math.min(M,_h(R.coordinates,!0,D,E,M));break;case"Polygon":M=Math.min(M,of(D,R.coordinates,E,M))}if(M===0)return M}return M})(o,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class _a{constructor(o){this.type=hr,this.key=o}static parse(o,c){if(o.length!==2)return c.error(`Expected 1 argument, but found ${o.length-1} instead.`);const f=o[1];return f==null?c.error("Global state property must be defined."):typeof f!="string"?c.error(`Global state property must be string, but found ${typeof o[1]} instead.`):new _a(f)}evaluate(o){var c;const f=(c=o.globals)===null||c===void 0?void 0:c.globalState;return f&&Object.keys(f).length!==0?ie(f,this.key):null}eachChild(){}outputDefined(){return!1}}const il={"==":Qp,"!=":hh,">":Ed,"<":zm,">=":ef,"<=":Um,array:jn,at:vc,boolean:jn,case:fa,coalesce:pu,collator:dh,format:Pl,image:Td,in:Ml,"index-of":ro,interpolate:$i,"interpolate-hcl":$i,"interpolate-lab":$i,length:xc,let:yc,literal:Fs,match:qi,number:jn,"number-format":Ad,object:jn,slice:bc,step:di,string:jn,"to-boolean":Wo,"to-color":Wo,"to-number":Wo,"to-string":Wo,var:So,within:el,distance:ga,"global-state":_a};class zs{constructor(o,c,f,_){this.name=o,this.type=c,this._evaluate=f,this.args=_}evaluate(o){return this._evaluate(o,this.args)}eachChild(o){this.args.forEach(o)}outputDefined(){return!1}static parse(o,c){const f=o[0],_=zs.definitions[f];if(!_)return c.error(`Unknown expression "${f}". If you wanted a literal array, use ["literal", [...]].`,0);const w=Array.isArray(_)?_[0]:_.type,E=Array.isArray(_)?[[_[1],_[2]]]:_.overloads,M=E.filter((([D])=>!Array.isArray(D)||D.length===o.length-1));let R=null;for(const[D,z]of M){R=new Ya(c.registry,Bl,c.path,null,c.scope);const V=[];let Z=!1;for(let X=1;X<o.length;X++){const Y=o[X],re=Array.isArray(D)?D[X-1]:D.type,he=R.parse(Y,1+V.length,re);if(!he){Z=!0;break}V.push(he)}if(!Z)if(Array.isArray(D)&&D.length!==V.length)R.error(`Expected ${D.length} arguments, but found ${V.length} instead.`);else{for(let X=0;X<V.length;X++){const Y=Array.isArray(D)?D[X]:D.type,re=V[X];R.concat(X+1).checkSubtype(Y,re.type)}if(R.errors.length===0)return new zs(f,w,z,V)}}if(M.length===1)c.errors.push(...R.errors);else{const D=(M.length?M:E).map((([V])=>{return Z=V,Array.isArray(Z)?`(${Z.map(Dr).join(", ")})`:`(${Dr(Z.type)}...)`;var Z})).join(" | "),z=[];for(let V=1;V<o.length;V++){const Z=c.parse(o[V],1+z.length);if(!Z)return null;z.push(Dr(Z.type))}c.error(`Expected arguments of type ${D}, but found (${z.join(", ")}) instead.`)}return null}static register(o,c){zs.definitions=c;for(const f in c)o[f]=zs}}function xu(u,[o,c,f,_]){o=o.evaluate(u),c=c.evaluate(u),f=f.evaluate(u);const w=_?_.evaluate(u):1,E=ii(o,c,f,w);if(E)throw new oi(E);return new ar(o/255,c/255,f/255,w,!1)}function kl(u,o){return u in o}function wu(u,o){const c=o[u];return c===void 0?null:c}function nl(u){return{type:u}}function Bl(u){if(u instanceof So)return Bl(u.boundExpression);if(u instanceof zs&&u.name==="error"||u instanceof dh||u instanceof el||u instanceof ga||u instanceof _a)return!1;const o=u instanceof Wo||u instanceof jn;let c=!0;return u.eachChild((f=>{c=o?c&&Bl(f):c&&f instanceof Fs})),!!c&&Eu(u)&&Au(u,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"])}function Eu(u){if(u instanceof zs&&(u.name==="get"&&u.args.length===1||u.name==="feature-state"||u.name==="has"&&u.args.length===1||u.name==="properties"||u.name==="geometry-type"||u.name==="id"||/^filter-/.test(u.name))||u instanceof el||u instanceof ga)return!1;let o=!0;return u.eachChild((c=>{o&&!Eu(c)&&(o=!1)})),o}function Pc(u){if(u instanceof zs&&u.name==="feature-state")return!1;let o=!0;return u.eachChild((c=>{o&&!Pc(c)&&(o=!1)})),o}function Au(u,o){if(u instanceof zs&&o.indexOf(u.name)>=0)return!1;let c=!0;return u.eachChild((f=>{c&&!Au(f,o)&&(c=!1)})),c}function Ud(u){return{result:"success",value:u}}function Ll(u){return{result:"error",value:u}}function ya(u){return u["property-type"]==="data-driven"||u["property-type"]==="cross-faded-data-driven"}function va(u){return!!u.expression&&u.expression.parameters.indexOf("zoom")>-1}function Tu(u){return!!u.expression&&u.expression.interpolated}function Ir(u){return u instanceof Number?"number":u instanceof String?"string":u instanceof Boolean?"boolean":Array.isArray(u)?"array":u===null?"null":typeof u}function Su(u){return typeof u=="object"&&u!==null&&!Array.isArray(u)&&lr(u)===Un}function qm(u){return u}function Rc(u,o){const c=u.stops&&typeof u.stops[0][0]=="object",f=c||!(c||u.property!==void 0),_=u.type||(Tu(o)?"exponential":"interval"),w=(function(z){switch(z.type){case"color":return ar.parse;case"padding":return zi.parse;case"numberArray":return ln.parse;case"colorArray":return hi.parse;default:return null}})(o);if(w&&((u=Ci({},u)).stops&&(u.stops=u.stops.map((z=>[z[0],w(z[1])]))),u.default=w(u.default?u.default:o.default)),u.colorSpace&&(E=u.colorSpace)!=="rgb"&&E!=="hcl"&&E!=="lab")throw new Error(`Unknown color space: "${u.colorSpace}"`);var E;const M=(function(z){switch(z){case"exponential":return gi;case"interval":return af;case"categorical":return jd;case"identity":return Vd;default:throw new Error(`Unknown function type "${z}"`)}})(_);let R,D;if(_==="categorical"){R=Object.create(null);for(const z of u.stops)R[z[0]]=z[1];D=typeof u.stops[0][0]}if(c){const z={},V=[];for(let Y=0;Y<u.stops.length;Y++){const re=u.stops[Y],he=re[0].zoom;z[he]===void 0&&(z[he]={zoom:he,type:u.type,property:u.property,default:u.default,stops:[]},V.push(he)),z[he].stops.push([re[0].value,re[1]])}const Z=[];for(const Y of V)Z.push([z[Y].zoom,Rc(z[Y],o)]);const X={name:"linear"};return{kind:"composite",interpolationType:X,interpolationFactor:$i.interpolationFactor.bind(void 0,X),zoomStops:Z.map((Y=>Y[0])),evaluate:({zoom:Y},re)=>gi({stops:Z,base:u.base},o,Y).evaluate(Y,re)}}if(f){const z=_==="exponential"?{name:"exponential",base:u.base!==void 0?u.base:1}:null;return{kind:"camera",interpolationType:z,interpolationFactor:$i.interpolationFactor.bind(void 0,z),zoomStops:u.stops.map((V=>V[0])),evaluate:({zoom:V})=>M(u,o,V,R,D)}}return{kind:"source",evaluate(z,V){const Z=V&&V.properties?V.properties[u.property]:void 0;return Z===void 0?sl(u.default,o.default):M(u,o,Z,R,D)}}}function sl(u,o,c){return u!==void 0?u:o!==void 0?o:c!==void 0?c:void 0}function jd(u,o,c,f,_){return sl(typeof c===_?f[c]:void 0,u.default,o.default)}function af(u,o,c){if(Ir(c)!=="number")return sl(u.default,o.default);const f=u.stops.length;if(f===1||c<=u.stops[0][0])return u.stops[0][1];if(c>=u.stops[f-1][0])return u.stops[f-1][1];const _=un(u.stops.map((w=>w[0])),c);return u.stops[_][1]}function gi(u,o,c){const f=u.base!==void 0?u.base:1;if(Ir(c)!=="number")return sl(u.default,o.default);const _=u.stops.length;if(_===1||c<=u.stops[0][0])return u.stops[0][1];if(c>=u.stops[_-1][0])return u.stops[_-1][1];const w=un(u.stops.map((z=>z[0])),c),E=(function(z,V,Z,X){const Y=X-Z,re=z-Z;return Y===0?0:V===1?re/Y:(Math.pow(V,re)-1)/(Math.pow(V,Y)-1)})(c,f,u.stops[w][0],u.stops[w+1][0]),M=u.stops[w][1],R=u.stops[w+1][1],D=Co[o.type]||qm;return typeof M.evaluate=="function"?{evaluate(...z){const V=M.evaluate.apply(void 0,z),Z=R.evaluate.apply(void 0,z);if(V!==void 0&&Z!==void 0)return D(V,Z,E,u.colorSpace)}}:D(M,R,E,u.colorSpace)}function Vd(u,o,c){switch(o.type){case"color":c=ar.parse(c);break;case"formatted":c=Fi.fromString(c.toString());break;case"resolvedImage":c=Os.fromString(c.toString());break;case"padding":c=zi.parse(c);break;case"colorArray":c=hi.parse(c);break;case"numberArray":c=ln.parse(c);break;default:Ir(c)===o.type||o.type==="enum"&&o.values[c]||(c=void 0)}return sl(c,u.default,o.default)}zs.register(il,{error:[{kind:"error"},[Cr],(u,[o])=>{throw new oi(o.evaluate(u))}],typeof:[Cr,[hr],(u,[o])=>Dr(lr(o.evaluate(u)))],"to-rgba":[Mi(Tt,4),[Hi],(u,[o])=>{const[c,f,_,w]=o.evaluate(u).rgb;return[255*c,255*f,255*_,w]}],rgb:[Hi,[Tt,Tt,Tt],xu],rgba:[Hi,[Tt,Tt,Tt,Tt],xu],has:{type:cr,overloads:[[[Cr],(u,[o])=>kl(o.evaluate(u),u.properties())],[[Cr,Un],(u,[o,c])=>kl(o.evaluate(u),c.evaluate(u))]]},get:{type:hr,overloads:[[[Cr],(u,[o])=>wu(o.evaluate(u),u.properties())],[[Cr,Un],(u,[o,c])=>wu(o.evaluate(u),c.evaluate(u))]]},"feature-state":[hr,[Cr],(u,[o])=>wu(o.evaluate(u),u.featureState||{})],properties:[Un,[],u=>u.properties()],"geometry-type":[Cr,[],u=>u.geometryType()],id:[hr,[],u=>u.id()],zoom:[Tt,[],u=>u.globals.zoom],"heatmap-density":[Tt,[],u=>u.globals.heatmapDensity||0],elevation:[Tt,[],u=>u.globals.elevation||0],"line-progress":[Tt,[],u=>u.globals.lineProgress||0],accumulated:[hr,[],u=>u.globals.accumulated===void 0?null:u.globals.accumulated],"+":[Tt,nl(Tt),(u,o)=>{let c=0;for(const f of o)c+=f.evaluate(u);return c}],"*":[Tt,nl(Tt),(u,o)=>{let c=1;for(const f of o)c*=f.evaluate(u);return c}],"-":{type:Tt,overloads:[[[Tt,Tt],(u,[o,c])=>o.evaluate(u)-c.evaluate(u)],[[Tt],(u,[o])=>-o.evaluate(u)]]},"/":[Tt,[Tt,Tt],(u,[o,c])=>o.evaluate(u)/c.evaluate(u)],"%":[Tt,[Tt,Tt],(u,[o,c])=>o.evaluate(u)%c.evaluate(u)],ln2:[Tt,[],()=>Math.LN2],pi:[Tt,[],()=>Math.PI],e:[Tt,[],()=>Math.E],"^":[Tt,[Tt,Tt],(u,[o,c])=>Math.pow(o.evaluate(u),c.evaluate(u))],sqrt:[Tt,[Tt],(u,[o])=>Math.sqrt(o.evaluate(u))],log10:[Tt,[Tt],(u,[o])=>Math.log(o.evaluate(u))/Math.LN10],ln:[Tt,[Tt],(u,[o])=>Math.log(o.evaluate(u))],log2:[Tt,[Tt],(u,[o])=>Math.log(o.evaluate(u))/Math.LN2],sin:[Tt,[Tt],(u,[o])=>Math.sin(o.evaluate(u))],cos:[Tt,[Tt],(u,[o])=>Math.cos(o.evaluate(u))],tan:[Tt,[Tt],(u,[o])=>Math.tan(o.evaluate(u))],asin:[Tt,[Tt],(u,[o])=>Math.asin(o.evaluate(u))],acos:[Tt,[Tt],(u,[o])=>Math.acos(o.evaluate(u))],atan:[Tt,[Tt],(u,[o])=>Math.atan(o.evaluate(u))],min:[Tt,nl(Tt),(u,o)=>Math.min(...o.map((c=>c.evaluate(u))))],max:[Tt,nl(Tt),(u,o)=>Math.max(...o.map((c=>c.evaluate(u))))],abs:[Tt,[Tt],(u,[o])=>Math.abs(o.evaluate(u))],round:[Tt,[Tt],(u,[o])=>{const c=o.evaluate(u);return c<0?-Math.round(-c):Math.round(c)}],floor:[Tt,[Tt],(u,[o])=>Math.floor(o.evaluate(u))],ceil:[Tt,[Tt],(u,[o])=>Math.ceil(o.evaluate(u))],"filter-==":[cr,[Cr,hr],(u,[o,c])=>u.properties()[o.value]===c.value],"filter-id-==":[cr,[hr],(u,[o])=>u.id()===o.value],"filter-type-==":[cr,[Cr],(u,[o])=>u.geometryType()===o.value],"filter-<":[cr,[Cr,hr],(u,[o,c])=>{const f=u.properties()[o.value],_=c.value;return typeof f==typeof _&&f<_}],"filter-id-<":[cr,[hr],(u,[o])=>{const c=u.id(),f=o.value;return typeof c==typeof f&&c<f}],"filter->":[cr,[Cr,hr],(u,[o,c])=>{const f=u.properties()[o.value],_=c.value;return typeof f==typeof _&&f>_}],"filter-id->":[cr,[hr],(u,[o])=>{const c=u.id(),f=o.value;return typeof c==typeof f&&c>f}],"filter-<=":[cr,[Cr,hr],(u,[o,c])=>{const f=u.properties()[o.value],_=c.value;return typeof f==typeof _&&f<=_}],"filter-id-<=":[cr,[hr],(u,[o])=>{const c=u.id(),f=o.value;return typeof c==typeof f&&c<=f}],"filter->=":[cr,[Cr,hr],(u,[o,c])=>{const f=u.properties()[o.value],_=c.value;return typeof f==typeof _&&f>=_}],"filter-id->=":[cr,[hr],(u,[o])=>{const c=u.id(),f=o.value;return typeof c==typeof f&&c>=f}],"filter-has":[cr,[hr],(u,[o])=>o.value in u.properties()],"filter-has-id":[cr,[],u=>u.id()!==null&&u.id()!==void 0],"filter-type-in":[cr,[Mi(Cr)],(u,[o])=>o.value.indexOf(u.geometryType())>=0],"filter-id-in":[cr,[Mi(hr)],(u,[o])=>o.value.indexOf(u.id())>=0],"filter-in-small":[cr,[Cr,Mi(hr)],(u,[o,c])=>c.value.indexOf(u.properties()[o.value])>=0],"filter-in-large":[cr,[Cr,Mi(hr)],(u,[o,c])=>(function(f,_,w,E){for(;w<=E;){const M=w+E>>1;if(_[M]===f)return!0;_[M]>f?E=M-1:w=M+1}return!1})(u.properties()[o.value],c.value,0,c.value.length-1)],all:{type:cr,overloads:[[[cr,cr],(u,[o,c])=>o.evaluate(u)&&c.evaluate(u)],[nl(cr),(u,o)=>{for(const c of o)if(!c.evaluate(u))return!1;return!0}]]},any:{type:cr,overloads:[[[cr,cr],(u,[o,c])=>o.evaluate(u)||c.evaluate(u)],[nl(cr),(u,o)=>{for(const c of o)if(c.evaluate(u))return!0;return!1}]]},"!":[cr,[cr],(u,[o])=>!o.evaluate(u)],"is-supported-script":[cr,[Cr],(u,[o])=>{const c=u.globals&&u.globals.isSupportedScript;return!c||c(o.evaluate(u))}],upcase:[Cr,[Cr],(u,[o])=>o.evaluate(u).toUpperCase()],downcase:[Cr,[Cr],(u,[o])=>o.evaluate(u).toLowerCase()],concat:[Cr,nl(hr),(u,o)=>o.map((c=>pr(c.evaluate(u)))).join("")],"resolved-locale":[Cr,[bo],(u,[o])=>o.evaluate(u).resolvedLocale()]});class Ic{constructor(o,c){this.expression=o,this._warningHistory={},this._evaluator=new _c,this._defaultValue=c?(function(f){if(f.type==="color"&&Su(f.default))return new ar(0,0,0,0);switch(f.type){case"color":return ar.parse(f.default)||null;case"padding":return zi.parse(f.default)||null;case"numberArray":return ln.parse(f.default)||null;case"colorArray":return hi.parse(f.default)||null;case"variableAnchorOffsetCollection":return cn.parse(f.default)||null;case"projectionDefinition":return In.parse(f.default)||null;default:return f.default===void 0?null:f.default}})(c):null,this._enumValues=c&&c.type==="enum"?c.values:null}evaluateWithoutErrorHandling(o,c,f,_,w,E){return this._evaluator.globals=o,this._evaluator.feature=c,this._evaluator.featureState=f,this._evaluator.canonical=_,this._evaluator.availableImages=w||null,this._evaluator.formattedSection=E,this.expression.evaluate(this._evaluator)}evaluate(o,c,f,_,w,E){this._evaluator.globals=o,this._evaluator.feature=c||null,this._evaluator.featureState=f||null,this._evaluator.canonical=_,this._evaluator.availableImages=w||null,this._evaluator.formattedSection=E||null;try{const M=this.expression.evaluate(this._evaluator);if(M==null||typeof M=="number"&&M!=M)return this._defaultValue;if(this._enumValues&&!(M in this._enumValues))throw new oi(`Expected value to be one of ${Object.keys(this._enumValues).map((R=>JSON.stringify(R))).join(", ")}, but found ${JSON.stringify(M)} instead.`);return M}catch(M){return this._warningHistory[M.message]||(this._warningHistory[M.message]=!0,typeof console<"u"&&console.warn(M.message)),this._defaultValue}}}function ol(u){return Array.isArray(u)&&u.length>0&&typeof u[0]=="string"&&u[0]in il}function kc(u,o){const c=new Ya(il,Bl,[],o?(function(_){const w={color:Hi,string:Cr,number:Tt,enum:Cr,boolean:cr,formatted:xs,padding:ha,numberArray:Wa,colorArray:to,projectionDefinition:eo,resolvedImage:br,variableAnchorOffsetCollection:Pn};return _.type==="array"?Mi(w[_.value]||hr,_.length):w[_.type]})(o):void 0),f=c.parse(u,void 0,void 0,void 0,o&&o.type==="string"?{typeAnnotation:"coerce"}:void 0);return f?Ud(new Ic(f,o)):Ll(c.errors)}class Dl{constructor(o,c){this.kind=o,this._styleExpression=c,this.isStateDependent=o!=="constant"&&!Pc(c.expression),this.globalStateRefs=Mu(c.expression)}evaluateWithoutErrorHandling(o,c,f,_,w,E){return this._styleExpression.evaluateWithoutErrorHandling(o,c,f,_,w,E)}evaluate(o,c,f,_,w,E){return this._styleExpression.evaluate(o,c,f,_,w,E)}}class Nl{constructor(o,c,f,_){this.kind=o,this.zoomStops=f,this._styleExpression=c,this.isStateDependent=o!=="camera"&&!Pc(c.expression),this.globalStateRefs=Mu(c.expression),this.interpolationType=_}evaluateWithoutErrorHandling(o,c,f,_,w,E){return this._styleExpression.evaluateWithoutErrorHandling(o,c,f,_,w,E)}evaluate(o,c,f,_,w,E){return this._styleExpression.evaluate(o,c,f,_,w,E)}interpolationFactor(o,c,f){return this.interpolationType?$i.interpolationFactor(this.interpolationType,o,c,f):0}}function Cu(u,o){const c=kc(u,o);if(c.result==="error")return c;const f=c.value.expression,_=Eu(f);if(!_&&!ya(o))return Ll([new si("","data expressions not supported")]);const w=Au(f,["zoom"]);if(!w&&!va(o))return Ll([new si("","zoom expressions not supported")]);const E=Bc(f);return E||w?E instanceof si?Ll([E]):E instanceof $i&&!Tu(o)?Ll([new si("",'"interpolate" expressions cannot be used with this property')]):Ud(E?new Nl(_?"camera":"composite",c.value,E.labels,E instanceof $i?E.interpolation:void 0):new Dl(_?"constant":"source",c.value)):Ll([new si("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class qo{constructor(o,c){this._parameters=o,this._specification=c,Ci(this,Rc(this._parameters,this._specification))}static deserialize(o){return new qo(o._parameters,o._specification)}static serialize(o){return{_parameters:o._parameters,_specification:o._specification}}}function Bc(u){let o=null;if(u instanceof yc)o=Bc(u.result);else if(u instanceof pu){for(const c of u.args)if(o=Bc(c),o)break}else(u instanceof di||u instanceof $i)&&u.input instanceof zs&&u.input.name==="zoom"&&(o=u);return o instanceof si||u.eachChild((c=>{const f=Bc(c);f instanceof si?o=f:!o&&f?o=new si("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):o&&f&&o!==f&&(o=new si("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),o}function Mu(u,o=new Set){return u instanceof _a&&o.add(u.key),u.eachChild((c=>{Mu(c,o)})),o}function vh(u){if(u===!0||u===!1)return!0;if(!Array.isArray(u)||u.length===0)return!1;switch(u[0]){case"has":return u.length>=2&&u[1]!=="$id"&&u[1]!=="$type";case"in":return u.length>=3&&(typeof u[1]!="string"||Array.isArray(u[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return u.length!==3||Array.isArray(u[1])||Array.isArray(u[2]);case"any":case"all":for(const o of u.slice(1))if(!vh(o)&&typeof o!="boolean")return!1;return!0;default:return!0}}const bh={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function $o(u){if(u==null)return{filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set};vh(u)||(u=ba(u));const o=kc(u,bh);if(o.result==="error")throw new Error(o.value.map((c=>`${c.key}: ${c.message}`)).join(", "));return{filter:(c,f,_)=>o.value.evaluate(c,f,{},_),needGeometry:Dc(u),getGlobalStateRefs:()=>Mu(o.value.expression)}}function Lc(u,o){return u<o?-1:u>o?1:0}function Dc(u){if(!Array.isArray(u))return!1;if(u[0]==="within"||u[0]==="distance")return!0;for(let o=1;o<u.length;o++)if(Dc(u[o]))return!0;return!1}function ba(u){if(!u)return!0;const o=u[0];return u.length<=1?o!=="any":o==="=="?Pu(u[1],u[2],"=="):o==="!="?Ru(Pu(u[1],u[2],"==")):o==="<"||o===">"||o==="<="||o===">="?Pu(u[1],u[2],o):o==="any"?(c=u.slice(1),["any"].concat(c.map(ba))):o==="all"?["all"].concat(u.slice(1).map(ba)):o==="none"?["all"].concat(u.slice(1).map(ba).map(Ru)):o==="in"?xh(u[1],u.slice(2)):o==="!in"?Ru(xh(u[1],u.slice(2))):o==="has"?lf(u[1]):o!=="!has"||Ru(lf(u[1]));var c}function Pu(u,o,c){switch(u){case"$type":return[`filter-type-${c}`,o];case"$id":return[`filter-id-${c}`,o];default:return[`filter-${c}`,u,o]}}function xh(u,o){if(o.length===0)return!1;switch(u){case"$type":return["filter-type-in",["literal",o]];case"$id":return["filter-id-in",["literal",o]];default:return o.length>200&&!o.some((c=>typeof c!=typeof o[0]))?["filter-in-large",u,["literal",o.sort(Lc)]]:["filter-in-small",u,["literal",o]]}}function lf(u){switch(u){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",u]}}function Ru(u){return["!",u]}function Gd(u){const o=typeof u;if(o==="number"||o==="boolean"||o==="string"||u==null)return JSON.stringify(u);if(Array.isArray(u)){let _="[";for(const w of u)_+=`${Gd(w)},`;return`${_}]`}const c=Object.keys(u).sort();let f="{";for(let _=0;_<c.length;_++)f+=`${JSON.stringify(c[_])}:${Gd(u[c[_]])},`;return`${f}}`}function $m(u){let o="";for(const c of or)o+=`/${Gd(u[c])}`;return o}function Iu(u){const o=u.value;return o?[new _t(u.key,o,"constants have been deprecated as of v8")]:[]}function Yr(u){return u instanceof Number||u instanceof String||u instanceof Boolean?u.valueOf():u}function Io(u){if(Array.isArray(u))return u.map(Io);if(u instanceof Object&&!(u instanceof Number||u instanceof String||u instanceof Boolean)){const o={};for(const c in u)o[c]=Io(u[c]);return o}return Yr(u)}function kn(u){const o=u.key,c=u.value,f=u.valueSpec||{},_=u.objectElementValidators||{},w=u.style,E=u.styleSpec,M=u.validateSpec;let R=[];const D=Ir(c);if(D!=="object")return[new _t(o,c,`object expected, ${D} found`)];for(const z in c){const V=z.split(".")[0],Z=ie(f,V)||f["*"];let X;if(ie(_,V))X=_[V];else if(ie(f,V))X=M;else if(_["*"])X=_["*"];else{if(!f["*"]){R.push(new _t(o,c[z],`unknown property "${z}"`));continue}X=M}R=R.concat(X({key:(o&&`${o}.`)+z,value:c[z],valueSpec:Z,style:w,styleSpec:E,object:c,objectKey:z,validateSpec:M},c))}for(const z in f)_[z]||f[z].required&&f[z].default===void 0&&c[z]===void 0&&R.push(new _t(o,c,`missing required property "${z}"`));return R}function Us(u){const o=u.value,c=u.valueSpec,f=u.style,_=u.styleSpec,w=u.key,E=u.arrayElementValidator||u.validateSpec;if(Ir(o)!=="array")return[new _t(w,o,`array expected, ${Ir(o)} found`)];if(c.length&&o.length!==c.length)return[new _t(w,o,`array length ${c.length} expected, length ${o.length} found`)];if(c["min-length"]&&o.length<c["min-length"])return[new _t(w,o,`array length at least ${c["min-length"]} expected, length ${o.length} found`)];let M={type:c.value,values:c.values};_.$version<7&&(M.function=c.function),Ir(c.value)==="object"&&(M=c.value);let R=[];for(let D=0;D<o.length;D++)R=R.concat(E({array:o,arrayIndex:D,value:o[D],valueSpec:M,validateSpec:u.validateSpec,style:f,styleSpec:_,key:`${w}[${D}]`}));return R}function xa(u){const o=u.key,c=u.value,f=u.valueSpec;let _=Ir(c);return _==="number"&&c!=c&&(_="NaN"),_!=="number"?[new _t(o,c,`number expected, ${_} found`)]:"minimum"in f&&c<f.minimum?[new _t(o,c,`${c} is less than the minimum value ${f.minimum}`)]:"maximum"in f&&c>f.maximum?[new _t(o,c,`${c} is greater than the maximum value ${f.maximum}`)]:[]}function Zo(u){const o=u.valueSpec,c=Yr(u.value.type);let f,_,w,E={};const M=c!=="categorical"&&u.value.property===void 0,R=!M,D=Ir(u.value.stops)==="array"&&Ir(u.value.stops[0])==="array"&&Ir(u.value.stops[0][0])==="object",z=kn({key:u.key,value:u.value,valueSpec:u.styleSpec.function,validateSpec:u.validateSpec,style:u.style,styleSpec:u.styleSpec,objectElementValidators:{stops:function(X){if(c==="identity")return[new _t(X.key,X.value,'identity function may not have a "stops" property')];let Y=[];const re=X.value;return Y=Y.concat(Us({key:X.key,value:re,valueSpec:X.valueSpec,validateSpec:X.validateSpec,style:X.style,styleSpec:X.styleSpec,arrayElementValidator:V})),Ir(re)==="array"&&re.length===0&&Y.push(new _t(X.key,re,"array must have at least one stop")),Y},default:function(X){return X.validateSpec({key:X.key,value:X.value,valueSpec:o,validateSpec:X.validateSpec,style:X.style,styleSpec:X.styleSpec})}}});return c==="identity"&&M&&z.push(new _t(u.key,u.value,'missing required property "property"')),c==="identity"||u.value.stops||z.push(new _t(u.key,u.value,'missing required property "stops"')),c==="exponential"&&u.valueSpec.expression&&!Tu(u.valueSpec)&&z.push(new _t(u.key,u.value,"exponential functions not supported")),u.styleSpec.$version>=8&&(R&&!ya(u.valueSpec)?z.push(new _t(u.key,u.value,"property functions not supported")):M&&!va(u.valueSpec)&&z.push(new _t(u.key,u.value,"zoom functions not supported"))),c!=="categorical"&&!D||u.value.property!==void 0||z.push(new _t(u.key,u.value,'"property" property is required')),z;function V(X){let Y=[];const re=X.value,he=X.key;if(Ir(re)!=="array")return[new _t(he,re,`array expected, ${Ir(re)} found`)];if(re.length!==2)return[new _t(he,re,`array length 2 expected, length ${re.length} found`)];if(D){if(Ir(re[0])!=="object")return[new _t(he,re,`object expected, ${Ir(re[0])} found`)];if(re[0].zoom===void 0)return[new _t(he,re,"object stop key must have zoom")];if(re[0].value===void 0)return[new _t(he,re,"object stop key must have value")];if(w&&w>Yr(re[0].zoom))return[new _t(he,re[0].zoom,"stop zoom values must appear in ascending order")];Yr(re[0].zoom)!==w&&(w=Yr(re[0].zoom),_=void 0,E={}),Y=Y.concat(kn({key:`${he}[0]`,value:re[0],valueSpec:{zoom:{}},validateSpec:X.validateSpec,style:X.style,styleSpec:X.styleSpec,objectElementValidators:{zoom:xa,value:Z}}))}else Y=Y.concat(Z({key:`${he}[0]`,value:re[0],validateSpec:X.validateSpec,style:X.style,styleSpec:X.styleSpec},re));return ol(Io(re[1]))?Y.concat([new _t(`${he}[1]`,re[1],"expressions are not allowed in function stops.")]):Y.concat(X.validateSpec({key:`${he}[1]`,value:re[1],valueSpec:o,validateSpec:X.validateSpec,style:X.style,styleSpec:X.styleSpec}))}function Z(X,Y){const re=Ir(X.value),he=Yr(X.value),ye=X.value!==null?X.value:Y;if(f){if(re!==f)return[new _t(X.key,ye,`${re} stop domain type must match previous stop domain type ${f}`)]}else f=re;if(re!=="number"&&re!=="string"&&re!=="boolean")return[new _t(X.key,ye,"stop domain value must be a number, string, or boolean")];if(re!=="number"&&c!=="categorical"){let Ne=`number expected, ${re} found`;return ya(o)&&c===void 0&&(Ne+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new _t(X.key,ye,Ne)]}return c!=="categorical"||re!=="number"||isFinite(he)&&Math.floor(he)===he?c!=="categorical"&&re==="number"&&_!==void 0&&he<_?[new _t(X.key,ye,"stop domain values must appear in ascending order")]:(_=he,c==="categorical"&&he in E?[new _t(X.key,ye,"stop domain values must be unique")]:(E[he]=!0,[])):[new _t(X.key,ye,`integer expected, found ${he}`)]}}function wa(u){const o=(u.expressionContext==="property"?Cu:kc)(Io(u.value),u.valueSpec);if(o.result==="error")return o.value.map((f=>new _t(`${u.key}${f.key}`,u.value,f.message)));const c=o.value.expression||o.value._styleExpression.expression;if(u.expressionContext==="property"&&u.propertyKey==="text-font"&&!c.outputDefined())return[new _t(u.key,u.value,`Invalid data expression for "${u.propertyKey}". Output values must be contained as literals within the expression.`)];if(u.expressionContext==="property"&&u.propertyType==="layout"&&!Pc(c))return[new _t(u.key,u.value,'"feature-state" data expressions are not supported with layout properties.')];if(u.expressionContext==="filter"&&!Pc(c))return[new _t(u.key,u.value,'"feature-state" data expressions are not supported with filters.')];if(u.expressionContext&&u.expressionContext.indexOf("cluster")===0){if(!Au(c,["zoom","feature-state"]))return[new _t(u.key,u.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(u.expressionContext==="cluster-initial"&&!Eu(c))return[new _t(u.key,u.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function wh(u){const o=u.key,c=u.value,f=Ir(c);return f!=="string"?[new _t(o,c,`color expected, ${f} found`)]:ar.parse(String(c))?[]:[new _t(o,c,`color expected, "${c}" found`)]}function Ea(u){const o=u.key,c=u.value,f=u.valueSpec,_=[];return Array.isArray(f.values)?f.values.indexOf(Yr(c))===-1&&_.push(new _t(o,c,`expected one of [${f.values.join(", ")}], ${JSON.stringify(c)} found`)):Object.keys(f.values).indexOf(Yr(c))===-1&&_.push(new _t(o,c,`expected one of [${Object.keys(f.values).join(", ")}], ${JSON.stringify(c)} found`)),_}function Aa(u){return vh(Io(u.value))?wa(Ci({},u,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Nc(u)}function Nc(u){const o=u.value,c=u.key;if(Ir(o)!=="array")return[new _t(c,o,`array expected, ${Ir(o)} found`)];const f=u.styleSpec;let _,w=[];if(o.length<1)return[new _t(c,o,"filter array must have at least 1 element")];switch(w=w.concat(Ea({key:`${c}[0]`,value:o[0],valueSpec:f.filter_operator,style:u.style,styleSpec:u.styleSpec})),Yr(o[0])){case"<":case"<=":case">":case">=":o.length>=2&&Yr(o[1])==="$type"&&w.push(new _t(c,o,`"$type" cannot be use with operator "${o[0]}"`));case"==":case"!=":o.length!==3&&w.push(new _t(c,o,`filter array for operator "${o[0]}" must have 3 elements`));case"in":case"!in":o.length>=2&&(_=Ir(o[1]),_!=="string"&&w.push(new _t(`${c}[1]`,o[1],`string expected, ${_} found`)));for(let E=2;E<o.length;E++)_=Ir(o[E]),Yr(o[1])==="$type"?w=w.concat(Ea({key:`${c}[${E}]`,value:o[E],valueSpec:f.geometry_type,style:u.style,styleSpec:u.styleSpec})):_!=="string"&&_!=="number"&&_!=="boolean"&&w.push(new _t(`${c}[${E}]`,o[E],`string, number, or boolean expected, ${_} found`));break;case"any":case"all":case"none":for(let E=1;E<o.length;E++)w=w.concat(Nc({key:`${c}[${E}]`,value:o[E],style:u.style,styleSpec:u.styleSpec}));break;case"has":case"!has":_=Ir(o[1]),o.length!==2?w.push(new _t(c,o,`filter array for "${o[0]}" operator must have 2 elements`)):_!=="string"&&w.push(new _t(`${c}[1]`,o[1],`string expected, ${_} found`))}return w}function Ol(u,o){const c=u.key,f=u.validateSpec,_=u.style,w=u.styleSpec,E=u.value,M=u.objectKey,R=w[`${o}_${u.layerType}`];if(!R)return[];const D=M.match(/^(.*)-transition$/);if(o==="paint"&&D&&R[D[1]]&&R[D[1]].transition)return f({key:c,value:E,valueSpec:w.transition,style:_,styleSpec:w});const z=u.valueSpec||R[M];if(!z)return[new _t(c,E,`unknown property "${M}"`)];let V;if(Ir(E)==="string"&&ya(z)&&!z.tokens&&(V=/^{([^}]+)}$/.exec(E)))return[new _t(c,E,`"${M}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(V[1])} }\`.`)];const Z=[];return u.layerType==="symbol"&&(M==="text-field"&&_&&!_.glyphs&&Z.push(new _t(c,E,'use of "text-field" requires a style "glyphs" property')),M==="text-font"&&Su(Io(E))&&Yr(E.type)==="identity"&&Z.push(new _t(c,E,'"text-font" does not support identity functions'))),Z.concat(f({key:u.key,value:E,valueSpec:z,style:_,styleSpec:w,expressionContext:"property",propertyType:o,propertyKey:M}))}function ku(u){return Ol(u,"paint")}function Eh(u){return Ol(u,"layout")}function Fl(u){let o=[];const c=u.value,f=u.key,_=u.style,w=u.styleSpec;if(Ir(c)!=="object")return[new _t(f,c,`object expected, ${Ir(c)} found`)];c.type||c.ref||o.push(new _t(f,c,'either "type" or "ref" is required'));let E=Yr(c.type);const M=Yr(c.ref);if(c.id){const R=Yr(c.id);for(let D=0;D<u.arrayIndex;D++){const z=_.layers[D];Yr(z.id)===R&&o.push(new _t(f,c.id,`duplicate layer id "${c.id}", previously used at line ${z.id.__line__}`))}}if("ref"in c){let R;["type","source","source-layer","filter","layout"].forEach((D=>{D in c&&o.push(new _t(f,c[D],`"${D}" is prohibited for ref layers`))})),_.layers.forEach((D=>{Yr(D.id)===M&&(R=D)})),R?R.ref?o.push(new _t(f,c.ref,"ref cannot reference another ref layer")):E=Yr(R.type):o.push(new _t(f,c.ref,`ref layer "${M}" not found`))}else if(E!=="background")if(c.source){const R=_.sources&&_.sources[c.source],D=R&&Yr(R.type);R?D==="vector"&&E==="raster"?o.push(new _t(f,c.source,`layer "${c.id}" requires a raster source`)):D!=="raster-dem"&&E==="hillshade"||D!=="raster-dem"&&E==="color-relief"?o.push(new _t(f,c.source,`layer "${c.id}" requires a raster-dem source`)):D==="raster"&&E!=="raster"?o.push(new _t(f,c.source,`layer "${c.id}" requires a vector source`)):D!=="vector"||c["source-layer"]?D==="raster-dem"&&E!=="hillshade"&&E!=="color-relief"?o.push(new _t(f,c.source,"raster-dem source can only be used with layer type 'hillshade' or 'color-relief'.")):E!=="line"||!c.paint||!c.paint["line-gradient"]||D==="geojson"&&R.lineMetrics||o.push(new _t(f,c,`layer "${c.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):o.push(new _t(f,c,`layer "${c.id}" must specify a "source-layer"`)):o.push(new _t(f,c.source,`source "${c.source}" not found`))}else o.push(new _t(f,c,'missing required property "source"'));return o=o.concat(kn({key:f,value:c,valueSpec:w.layer,style:u.style,styleSpec:u.styleSpec,validateSpec:u.validateSpec,objectElementValidators:{"*":()=>[],type:()=>u.validateSpec({key:`${f}.type`,value:c.type,valueSpec:w.layer.type,style:u.style,styleSpec:u.styleSpec,validateSpec:u.validateSpec,object:c,objectKey:"type"}),filter:Aa,layout:R=>kn({layer:c,key:R.key,value:R.value,style:R.style,styleSpec:R.styleSpec,validateSpec:R.validateSpec,objectElementValidators:{"*":D=>Eh(Ci({layerType:E},D))}}),paint:R=>kn({layer:c,key:R.key,value:R.value,style:R.style,styleSpec:R.styleSpec,validateSpec:R.validateSpec,objectElementValidators:{"*":D=>ku(Ci({layerType:E},D))}})}})),o}function xn(u){const o=u.value,c=u.key,f=Ir(o);return f!=="string"?[new _t(c,o,`string expected, ${f} found`)]:[]}const Jr={promoteId:function({key:u,value:o}){if(Ir(o)==="string")return xn({key:u,value:o});{const c=[];for(const f in o)c.push(...xn({key:`${u}.${f}`,value:o[f]}));return c}}};function Br(u){const o=u.value,c=u.key,f=u.styleSpec,_=u.style,w=u.validateSpec;if(!o.type)return[new _t(c,o,'"type" is required')];const E=Yr(o.type);let M;switch(E){case"vector":case"raster":return M=kn({key:c,value:o,valueSpec:f[`source_${E.replace("-","_")}`],style:u.style,styleSpec:f,objectElementValidators:Jr,validateSpec:w}),M;case"raster-dem":return M=(function(R){var D;const z=(D=R.sourceName)!==null&&D!==void 0?D:"",V=R.value,Z=R.styleSpec,X=Z.source_raster_dem,Y=R.style;let re=[];const he=Ir(V);if(V===void 0)return re;if(he!=="object")return re.push(new _t("source_raster_dem",V,`object expected, ${he} found`)),re;const ye=Yr(V.encoding)==="custom",Ne=["redFactor","greenFactor","blueFactor","baseShift"],Ee=R.value.encoding?`"${R.value.encoding}"`:"Default";for(const Me in V)!ye&&Ne.includes(Me)?re.push(new _t(Me,V[Me],`In "${z}": "${Me}" is only valid when "encoding" is set to "custom". ${Ee} encoding found`)):X[Me]?re=re.concat(R.validateSpec({key:Me,value:V[Me],valueSpec:X[Me],validateSpec:R.validateSpec,style:Y,styleSpec:Z})):re.push(new _t(Me,V[Me],`unknown property "${Me}"`));return re})({sourceName:c,value:o,style:u.style,styleSpec:f,validateSpec:w}),M;case"geojson":if(M=kn({key:c,value:o,valueSpec:f.source_geojson,style:_,styleSpec:f,validateSpec:w,objectElementValidators:Jr}),o.cluster)for(const R in o.clusterProperties){const[D,z]=o.clusterProperties[R],V=typeof D=="string"?[D,["accumulated"],["get",R]]:D;M.push(...wa({key:`${c}.${R}.map`,value:z,expressionContext:"cluster-map"})),M.push(...wa({key:`${c}.${R}.reduce`,value:V,expressionContext:"cluster-reduce"}))}return M;case"video":return kn({key:c,value:o,valueSpec:f.source_video,style:_,validateSpec:w,styleSpec:f});case"image":return kn({key:c,value:o,valueSpec:f.source_image,style:_,validateSpec:w,styleSpec:f});case"canvas":return[new _t(c,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Ea({key:`${c}.type`,value:o.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function js(u){const o=u.value,c=u.styleSpec,f=c.light,_=u.style;let w=[];const E=Ir(o);if(o===void 0)return w;if(E!=="object")return w=w.concat([new _t("light",o,`object expected, ${E} found`)]),w;for(const M in o){const R=M.match(/^(.*)-transition$/);w=w.concat(R&&f[R[1]]&&f[R[1]].transition?u.validateSpec({key:M,value:o[M],valueSpec:c.transition,validateSpec:u.validateSpec,style:_,styleSpec:c}):f[M]?u.validateSpec({key:M,value:o[M],valueSpec:f[M],validateSpec:u.validateSpec,style:_,styleSpec:c}):[new _t(M,o[M],`unknown property "${M}"`)])}return w}function wn(u){const o=u.value,c=u.styleSpec,f=c.sky,_=u.style,w=Ir(o);if(o===void 0)return[];if(w!=="object")return[new _t("sky",o,`object expected, ${w} found`)];let E=[];for(const M in o)E=E.concat(f[M]?u.validateSpec({key:M,value:o[M],valueSpec:f[M],style:_,styleSpec:c}):[new _t(M,o[M],`unknown property "${M}"`)]);return E}function rs(u){const o=u.value,c=u.styleSpec,f=c.terrain,_=u.style;let w=[];const E=Ir(o);if(o===void 0)return w;if(E!=="object")return w=w.concat([new _t("terrain",o,`object expected, ${E} found`)]),w;for(const M in o)w=w.concat(f[M]?u.validateSpec({key:M,value:o[M],valueSpec:f[M],validateSpec:u.validateSpec,style:_,styleSpec:c}):[new _t(M,o[M],`unknown property "${M}"`)]);return w}function al(u){let o=[];const c=u.value,f=u.key;if(Array.isArray(c)){const _=[],w=[];for(const E in c)c[E].id&&_.includes(c[E].id)&&o.push(new _t(f,c,`all the sprites' ids must be unique, but ${c[E].id} is duplicated`)),_.push(c[E].id),c[E].url&&w.includes(c[E].url)&&o.push(new _t(f,c,`all the sprites' URLs must be unique, but ${c[E].url} is duplicated`)),w.push(c[E].url),o=o.concat(kn({key:`${f}[${E}]`,value:c[E],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:u.validateSpec}));return o}return xn({key:f,value:c})}function ko(u){return o=u.value,o&&o.constructor===Object?[]:[new _t(u.key,u.value,`object expected, ${Ir(u.value)} found`)];var o}const Vn={"*":()=>[],array:Us,boolean:function(u){const o=u.value,c=u.key,f=Ir(o);return f!=="boolean"?[new _t(c,o,`boolean expected, ${f} found`)]:[]},number:xa,color:wh,constants:Iu,enum:Ea,filter:Aa,function:Zo,layer:Fl,object:kn,source:Br,light:js,sky:wn,terrain:rs,projection:function(u){const o=u.value,c=u.styleSpec,f=c.projection,_=u.style,w=Ir(o);if(o===void 0)return[];if(w!=="object")return[new _t("projection",o,`object expected, ${w} found`)];let E=[];for(const M in o)E=E.concat(f[M]?u.validateSpec({key:M,value:o[M],valueSpec:f[M],style:_,styleSpec:c}):[new _t(M,o[M],`unknown property "${M}"`)]);return E},projectionDefinition:function(u){const o=u.key;let c=u.value;c=c instanceof String?c.valueOf():c;const f=Ir(c);return f!=="array"||(function(_){return Array.isArray(_)&&_.length===3&&typeof _[0]=="string"&&typeof _[1]=="string"&&typeof _[2]=="number"})(c)||(function(_){return!!["interpolate","step","literal"].includes(_[0])})(c)?["array","string"].includes(f)?[]:[new _t(o,c,`projection expected, invalid type "${f}" found`)]:[new _t(o,c,`projection expected, invalid array ${JSON.stringify(c)} found`)]},string:xn,formatted:function(u){return xn(u).length===0?[]:wa(u)},resolvedImage:function(u){return xn(u).length===0?[]:wa(u)},padding:function(u){const o=u.key,c=u.value;if(Ir(c)==="array"){if(c.length<1||c.length>4)return[new _t(o,c,`padding requires 1 to 4 values; ${c.length} values found`)];const f={type:"number"};let _=[];for(let w=0;w<c.length;w++)_=_.concat(u.validateSpec({key:`${o}[${w}]`,value:c[w],validateSpec:u.validateSpec,valueSpec:f}));return _}return xa({key:o,value:c,valueSpec:{}})},numberArray:function(u){const o=u.key,c=u.value;if(Ir(c)==="array"){const f={type:"number"};if(c.length<1)return[new _t(o,c,"array length at least 1 expected, length 0 found")];let _=[];for(let w=0;w<c.length;w++)_=_.concat(u.validateSpec({key:`${o}[${w}]`,value:c[w],validateSpec:u.validateSpec,valueSpec:f}));return _}return xa({key:o,value:c,valueSpec:{}})},colorArray:function(u){const o=u.key,c=u.value;if(Ir(c)==="array"){if(c.length<1)return[new _t(o,c,"array length at least 1 expected, length 0 found")];let f=[];for(let _=0;_<c.length;_++)f=f.concat(wh({key:`${o}[${_}]`,value:c[_]}));return f}return wh({key:o,value:c})},variableAnchorOffsetCollection:function(u){const o=u.key,c=u.value,f=Ir(c),_=u.styleSpec;if(f!=="array"||c.length<1||c.length%2!=0)return[new _t(o,c,"variableAnchorOffsetCollection requires a non-empty array of even length")];let w=[];for(let E=0;E<c.length;E+=2)w=w.concat(Ea({key:`${o}[${E}]`,value:c[E],valueSpec:_.layout_symbol["text-anchor"]})),w=w.concat(Us({key:`${o}[${E+1}]`,value:c[E+1],valueSpec:{length:2,value:"number"},validateSpec:u.validateSpec,style:u.style,styleSpec:_}));return w},sprite:al,state:ko};function Ta(u){const o=u.value,c=u.valueSpec,f=u.styleSpec;return u.validateSpec=Ta,c.expression&&Su(Yr(o))?Zo(u):c.expression&&ol(Io(o))?wa(u):c.type&&Vn[c.type]?Vn[c.type](u):kn(Ci({},u,{valueSpec:c.type?f[c.type]:c}))}function Hd(u){const o=u.value,c=u.key,f=xn(u);return f.length||(o.indexOf("{fontstack}")===-1&&f.push(new _t(c,o,'"glyphs" url must include a "{fontstack}" token')),o.indexOf("{range}")===-1&&f.push(new _t(c,o,'"glyphs" url must include a "{range}" token'))),f}function is(u,o=Le){let c=[];return c=c.concat(Ta({key:"",value:u,valueSpec:o.$root,styleSpec:o,style:u,validateSpec:Ta,objectElementValidators:{glyphs:Hd,"*":()=>[]}})),u.constants&&(c=c.concat(Iu({key:"constants",value:u.constants}))),zl(c)}function Es(u){return function(o){return u({...o,validateSpec:Ta})}}function zl(u){return[].concat(u).sort(((o,c)=>o.line-c.line))}function hn(u){return function(...o){return zl(u.apply(this,o))}}is.source=hn(Es(Br)),is.sprite=hn(Es(al)),is.glyphs=hn(Es(Hd)),is.light=hn(Es(js)),is.sky=hn(Es(wn)),is.terrain=hn(Es(rs)),is.state=hn(Es(ko)),is.layer=hn(Es(Fl)),is.filter=hn(Es(Aa)),is.paintProperty=hn(Es(ku)),is.layoutProperty=hn(Es(Eh));const Sa=is,Wd=Sa.light,Oc=Sa.sky,Zm=Sa.paintProperty,ll=Sa.layoutProperty;function Xo(u,o){let c=!1;if(o&&o.length)for(const f of o)u.fire(new at(new Error(f.message))),c=!0;return c}class Ko{constructor(o,c,f){const _=this.cells=[];if(o instanceof ArrayBuffer){this.arrayBuffer=o;const E=new Int32Array(this.arrayBuffer);o=E[0],this.d=(c=E[1])+2*(f=E[2]);for(let R=0;R<this.d*this.d;R++){const D=E[3+R],z=E[3+R+1];_.push(D===z?null:E.subarray(D,z))}const M=E[3+_.length+1];this.keys=E.subarray(E[3+_.length],M),this.bboxes=E.subarray(M),this.insert=this._insertReadonly}else{this.d=c+2*f;for(let E=0;E<this.d*this.d;E++)_.push([]);this.keys=[],this.bboxes=[]}this.n=c,this.extent=o,this.padding=f,this.scale=c/o,this.uid=0;const w=f/c*o;this.min=-w,this.max=o+w}insert(o,c,f,_,w){this._forEachCell(c,f,_,w,this._insertCell,this.uid++,void 0,void 0),this.keys.push(o),this.bboxes.push(c),this.bboxes.push(f),this.bboxes.push(_),this.bboxes.push(w)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(o,c,f,_,w,E){this.cells[w].push(E)}query(o,c,f,_,w){const E=this.min,M=this.max;if(o<=E&&c<=E&&M<=f&&M<=_&&!w)return Array.prototype.slice.call(this.keys);{const R=[];return this._forEachCell(o,c,f,_,this._queryCell,R,{},w),R}}_queryCell(o,c,f,_,w,E,M,R){const D=this.cells[w];if(D!==null){const z=this.keys,V=this.bboxes;for(let Z=0;Z<D.length;Z++){const X=D[Z];if(M[X]===void 0){const Y=4*X;(R?R(V[Y+0],V[Y+1],V[Y+2],V[Y+3]):o<=V[Y+2]&&c<=V[Y+3]&&f>=V[Y+0]&&_>=V[Y+1])?(M[X]=!0,E.push(z[X])):M[X]=!1}}}}_forEachCell(o,c,f,_,w,E,M,R){const D=this._convertToCellCoord(o),z=this._convertToCellCoord(c),V=this._convertToCellCoord(f),Z=this._convertToCellCoord(_);for(let X=D;X<=V;X++)for(let Y=z;Y<=Z;Y++){const re=this.d*Y+X;if((!R||R(this._convertFromCellCoord(X),this._convertFromCellCoord(Y),this._convertFromCellCoord(X+1),this._convertFromCellCoord(Y+1)))&&w.call(this,o,c,f,_,re,E,M,R))return}}_convertFromCellCoord(o){return(o-this.padding)/this.scale}_convertToCellCoord(o){return Math.max(0,Math.min(this.d-1,Math.floor(o*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const o=this.cells,c=3+this.cells.length+1+1;let f=0;for(let E=0;E<this.cells.length;E++)f+=this.cells[E].length;const _=new Int32Array(c+f+this.keys.length+this.bboxes.length);_[0]=this.extent,_[1]=this.n,_[2]=this.padding;let w=c;for(let E=0;E<o.length;E++){const M=o[E];_[3+E]=w,_.set(M,w),w+=M.length}return _[3+o.length]=w,_.set(this.keys,w),w+=this.keys.length,_[3+o.length+1]=w,_.set(this.bboxes,w),w+=this.bboxes.length,_.buffer}static serialize(o,c){const f=o.toArrayBuffer();return c&&c.push(f),{buffer:f}}static deserialize(o){return new Ko(o.buffer)}}const As={};function Dt(u,o,c={}){if(As[u])throw new Error(`${u} is already registered.`);Object.defineProperty(o,"_classRegistryKey",{value:u,writeable:!1}),As[u]={klass:o,omit:c.omit||[],shallow:c.shallow||[]}}Dt("Object",Object),Dt("Set",Set),Dt("TransferableGridIndex",Ko),Dt("Color",ar),Dt("Error",Error),Dt("AJAXError",be),Dt("ResolvedImage",Os),Dt("StylePropertyFunction",qo),Dt("StyleExpression",Ic,{omit:["_evaluator"]}),Dt("ZoomDependentExpression",Nl),Dt("ZoomConstantExpression",Dl),Dt("CompoundExpression",zs,{omit:["_evaluate"]});for(const u in il)il[u]._classRegistryKey||Dt(`Expression_${u}`,il[u]);function Ts(u){return u&&typeof ArrayBuffer<"u"&&(u instanceof ArrayBuffer||u.constructor&&u.constructor.name==="ArrayBuffer")}function ns(u){return u.$name||u.constructor._classRegistryKey}function Ca(u){return!(function(o){if(o===null||typeof o!="object")return!1;const c=ns(o);return!(!c||c==="Object")})(u)&&(u==null||typeof u=="boolean"||typeof u=="number"||typeof u=="string"||u instanceof Boolean||u instanceof Number||u instanceof String||u instanceof Date||u instanceof RegExp||u instanceof Blob||u instanceof Error||Ts(u)||bs(u)||ArrayBuffer.isView(u)||u instanceof ImageData)}function Ss(u,o){if(Ca(u))return(Ts(u)||bs(u))&&o&&o.push(u),ArrayBuffer.isView(u)&&o&&o.push(u.buffer),u instanceof ImageData&&o&&o.push(u.data.buffer),u;if(Array.isArray(u)){const w=[];for(const E of u)w.push(Ss(E,o));return w}if(typeof u!="object")throw new Error("can't serialize object of type "+typeof u);const c=ns(u);if(!c)throw new Error(`can't serialize object of unregistered class ${u.constructor.name}`);if(!As[c])throw new Error(`${c} is not registered.`);const{klass:f}=As[c],_=f.serialize?f.serialize(u,o):{};if(f.serialize){if(o&&_===o[o.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const w in u){if(!u.hasOwnProperty(w)||As[c].omit.indexOf(w)>=0)continue;const E=u[w];_[w]=As[c].shallow.indexOf(w)>=0?E:Ss(E,o)}u instanceof Error&&(_.message=u.message)}if(_.$name)throw new Error("$name property is reserved for worker serialization logic.");return c!=="Object"&&(_.$name=c),_}function ss(u){if(Ca(u))return u;if(Array.isArray(u))return u.map(ss);if(typeof u!="object")throw new Error("can't deserialize object of type "+typeof u);const o=ns(u)||"Object";if(!As[o])throw new Error(`can't deserialize unregistered class ${o}`);const{klass:c}=As[o];if(!c)throw new Error(`can't deserialize unregistered class ${o}`);if(c.deserialize)return c.deserialize(u);const f=Object.create(c.prototype);for(const _ of Object.keys(u)){if(_==="$name")continue;const w=u[_];f[_]=As[o].shallow.indexOf(_)>=0?w:ss(w)}return f}class Yo{constructor(){this.first=!0}update(o,c){const f=Math.floor(o);return this.first?(this.first=!1,this.lastIntegerZoom=f,this.lastIntegerZoomTime=0,this.lastZoom=o,this.lastFloorZoom=f,!0):(this.lastFloorZoom>f?(this.lastIntegerZoom=f+1,this.lastIntegerZoomTime=c):this.lastFloorZoom<f&&(this.lastIntegerZoom=f,this.lastIntegerZoomTime=c),o!==this.lastZoom&&(this.lastZoom=o,this.lastFloorZoom=f,!0))}}const kr={"Latin-1 Supplement":u=>u>=128&&u<=255,"Hangul Jamo":u=>u>=4352&&u<=4607,Khmer:u=>u>=6016&&u<=6143,"General Punctuation":u=>u>=8192&&u<=8303,"Letterlike Symbols":u=>u>=8448&&u<=8527,"Number Forms":u=>u>=8528&&u<=8591,"Miscellaneous Technical":u=>u>=8960&&u<=9215,"Control Pictures":u=>u>=9216&&u<=9279,"Optical Character Recognition":u=>u>=9280&&u<=9311,"Enclosed Alphanumerics":u=>u>=9312&&u<=9471,"Geometric Shapes":u=>u>=9632&&u<=9727,"Miscellaneous Symbols":u=>u>=9728&&u<=9983,"Miscellaneous Symbols and Arrows":u=>u>=11008&&u<=11263,"Ideographic Description Characters":u=>u>=12272&&u<=12287,"CJK Symbols and Punctuation":u=>u>=12288&&u<=12351,Hiragana:u=>u>=12352&&u<=12447,Katakana:u=>u>=12448&&u<=12543,Kanbun:u=>u>=12688&&u<=12703,"CJK Strokes":u=>u>=12736&&u<=12783,"Enclosed CJK Letters and Months":u=>u>=12800&&u<=13055,"CJK Compatibility":u=>u>=13056&&u<=13311,"Yijing Hexagram Symbols":u=>u>=19904&&u<=19967,"CJK Unified Ideographs":u=>u>=19968&&u<=40959,"Hangul Syllables":u=>u>=44032&&u<=55215,"Private Use Area":u=>u>=57344&&u<=63743,"Vertical Forms":u=>u>=65040&&u<=65055,"CJK Compatibility Forms":u=>u>=65072&&u<=65103,"Small Form Variants":u=>u>=65104&&u<=65135,"Halfwidth and Fullwidth Forms":u=>u>=65280&&u<=65519};function Fc(u){for(const o of u)if(Ah(o.charCodeAt(0)))return!0;return!1}function qd(u){for(const o of u)if(!vi(o.charCodeAt(0)))return!1;return!0}function Gn(u){const o=u.map((c=>{try{return new RegExp(`\\p{sc=${c}}`,"u").source}catch{return null}})).filter((c=>c));return new RegExp(o.join("|"),"u")}const Vs=Gn(["Arab","Dupl","Mong","Ougr","Syrc"]);function vi(u){return!Vs.test(String.fromCodePoint(u))}const Gs=Gn(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function Ah(u){return!(u!==746&&u!==747&&(u<4352||!(kr["CJK Compatibility Forms"](u)&&!(u>=65097&&u<=65103)||kr["CJK Compatibility"](u)||kr["CJK Strokes"](u)||!(!kr["CJK Symbols and Punctuation"](u)||u>=12296&&u<=12305||u>=12308&&u<=12319||u===12336)||kr["Enclosed CJK Letters and Months"](u)||kr["Ideographic Description Characters"](u)||kr.Kanbun(u)||kr.Katakana(u)&&u!==12540||!(!kr["Halfwidth and Fullwidth Forms"](u)||u===65288||u===65289||u===65293||u>=65306&&u<=65310||u===65339||u===65341||u===65343||u>=65371&&u<=65503||u===65507||u>=65512&&u<=65519)||!(!kr["Small Form Variants"](u)||u>=65112&&u<=65118||u>=65123&&u<=65126)||kr["Vertical Forms"](u)||kr["Yijing Hexagram Symbols"](u)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(u))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(u))||Gs.test(String.fromCodePoint(u)))))}function $d(u){return!(Ah(u)||(function(o){return!!(kr["Latin-1 Supplement"](o)&&(o===167||o===169||o===174||o===177||o===188||o===189||o===190||o===215||o===247)||kr["General Punctuation"](o)&&(o===8214||o===8224||o===8225||o===8240||o===8241||o===8251||o===8252||o===8258||o===8263||o===8264||o===8265||o===8273)||kr["Letterlike Symbols"](o)||kr["Number Forms"](o)||kr["Miscellaneous Technical"](o)&&(o>=8960&&o<=8967||o>=8972&&o<=8991||o>=8996&&o<=9e3||o===9003||o>=9085&&o<=9114||o>=9150&&o<=9165||o===9167||o>=9169&&o<=9179||o>=9186&&o<=9215)||kr["Control Pictures"](o)&&o!==9251||kr["Optical Character Recognition"](o)||kr["Enclosed Alphanumerics"](o)||kr["Geometric Shapes"](o)||kr["Miscellaneous Symbols"](o)&&!(o>=9754&&o<=9759)||kr["Miscellaneous Symbols and Arrows"](o)&&(o>=11026&&o<=11055||o>=11088&&o<=11097||o>=11192&&o<=11243)||kr["CJK Symbols and Punctuation"](o)||kr.Katakana(o)||kr["Private Use Area"](o)||kr["CJK Compatibility Forms"](o)||kr["Small Form Variants"](o)||kr["Halfwidth and Fullwidth Forms"](o)||o===8734||o===8756||o===8757||o>=9984&&o<=10087||o>=10102&&o<=10131||o===65532||o===65533)})(u))}const Th=Gn(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function Bu(u){return Th.test(String.fromCodePoint(u))}function Zd(u,o){return!(!o&&Bu(u)||u>=2304&&u<=3583||u>=3840&&u<=4255||kr.Khmer(u))}function Lu(u){for(const o of u)if(Bu(o.charCodeAt(0)))return!0;return!1}const io=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(u){this.pluginStatus=u.pluginStatus,this.pluginURL=u.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(u){if(io.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=u.applyArabicShaping,this.processBidirectionalText=u.processBidirectionalText,this.processStyledBidirectionalText=u.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getRTLTextPluginStatus(){return this.pluginStatus}syncState(u,o){return a(this,void 0,void 0,(function*(){if(this.isParsed())return this.getState();if(u.pluginStatus!=="loading")return this.setState(u),u;const c=u.pluginURL,f=new Promise((w=>{this.loadScriptResolve=w}));o(c);const _=new Promise((w=>setTimeout((()=>w()),this.TIMEOUT)));if(yield Promise.race([f,_]),this.isParsed()){const w={pluginStatus:"loaded",pluginURL:c};return this.setState(w),w}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${c}`)}))}};class Qr{constructor(o,c){this.zoom=o,c?(this.now=c.now||0,this.fadeDuration=c.fadeDuration||0,this.zoomHistory=c.zoomHistory||new Yo,this.transition=c.transition||{},this.globalState=c.globalState||{}):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Yo,this.transition={},this.globalState={})}isSupportedScript(o){return(function(c,f){for(const _ of c)if(!Zd(_.charCodeAt(0),f))return!1;return!0})(o,io.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const o=this.zoom,c=o-Math.floor(o),f=this.crossFadingFactor();return o>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:c+(1-c)*f}:{fromScale:.5,toScale:1,t:1-(1-f)*c}}}class cl{constructor(o,c){this.property=o,this.value=c,this.expression=(function(f,_){if(Su(f))return new qo(f,_);if(ol(f)){const w=Cu(f,_);if(w.result==="error")throw new Error(w.value.map((E=>`${E.key}: ${E.message}`)).join(", "));return w.value}{let w=f;return _.type==="color"&&typeof f=="string"?w=ar.parse(f):_.type!=="padding"||typeof f!="number"&&!Array.isArray(f)?_.type!=="numberArray"||typeof f!="number"&&!Array.isArray(f)?_.type!=="colorArray"||typeof f!="string"&&!Array.isArray(f)?_.type==="variableAnchorOffsetCollection"&&Array.isArray(f)?w=cn.parse(f):_.type==="projectionDefinition"&&typeof f=="string"&&(w=In.parse(f)):w=hi.parse(f):w=ln.parse(f):w=zi.parse(f),{globalStateRefs:new Set,kind:"constant",evaluate:()=>w}}})(c===void 0?o.specification.default:c,o.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}getGlobalStateRefs(){return this.expression.globalStateRefs||new Set}possiblyEvaluate(o,c,f){return this.property.possiblyEvaluate(this,o,c,f)}}class Xd{constructor(o){this.property=o,this.value=new cl(o,void 0)}transitioned(o,c){return new Uc(this.property,this.value,c,dr({},o.transition,this.transition),o.now)}untransitioned(){return new Uc(this.property,this.value,null,{},0)}}class zc{constructor(o){this._properties=o,this._values=Object.create(o.defaultTransitionablePropertyValues)}getValue(o){return yi(this._values[o].value.value)}setValue(o,c){Object.prototype.hasOwnProperty.call(this._values,o)||(this._values[o]=new Xd(this._values[o].property)),this._values[o].value=new cl(this._values[o].property,c===null?void 0:yi(c))}getTransition(o){return yi(this._values[o].transition)}setTransition(o,c){Object.prototype.hasOwnProperty.call(this._values,o)||(this._values[o]=new Xd(this._values[o].property)),this._values[o].transition=yi(c)||void 0}serialize(){const o={};for(const c of Object.keys(this._values)){const f=this.getValue(c);f!==void 0&&(o[c]=f);const _=this.getTransition(c);_!==void 0&&(o[`${c}-transition`]=_)}return o}transitioned(o,c){const f=new Sh(this._properties);for(const _ of Object.keys(this._values))f._values[_]=this._values[_].transitioned(o,c._values[_]);return f}untransitioned(){const o=new Sh(this._properties);for(const c of Object.keys(this._values))o._values[c]=this._values[c].untransitioned();return o}}class Uc{constructor(o,c,f,_,w){this.property=o,this.value=c,this.begin=w+_.delay||0,this.end=this.begin+_.duration||0,o.specification.transition&&(_.delay||_.duration)&&(this.prior=f)}possiblyEvaluate(o,c,f){const _=o.now||0,w=this.value.possiblyEvaluate(o,c,f),E=this.prior;if(E){if(_>this.end)return this.prior=null,w;if(this.value.isDataDriven())return this.prior=null,w;if(_<this.begin)return E.possiblyEvaluate(o,c,f);{const M=(_-this.begin)/(this.end-this.begin);return this.property.interpolate(E.possiblyEvaluate(o,c,f),w,Gt(M))}}return w}}class Sh{constructor(o){this._properties=o,this._values=Object.create(o.defaultTransitioningPropertyValues)}possiblyEvaluate(o,c,f){const _=new Du(this._properties);for(const w of Object.keys(this._values))_._values[w]=this._values[w].possiblyEvaluate(o,c,f);return _}hasTransition(){for(const o of Object.keys(this._values))if(this._values[o].prior)return!0;return!1}}class Kd{constructor(o){this._properties=o,this._values=Object.create(o.defaultPropertyValues)}hasValue(o){return this._values[o].value!==void 0}getValue(o){return yi(this._values[o].value)}setValue(o,c){this._values[o]=new cl(this._values[o].property,c===null?void 0:yi(c))}serialize(){const o={};for(const c of Object.keys(this._values)){const f=this.getValue(c);f!==void 0&&(o[c]=f)}return o}possiblyEvaluate(o,c,f){const _=new Du(this._properties);for(const w of Object.keys(this._values))_._values[w]=this._values[w].possiblyEvaluate(o,c,f);return _}}class os{constructor(o,c,f){this.property=o,this.value=c,this.parameters=f}isConstant(){return this.value.kind==="constant"}constantOr(o){return this.value.kind==="constant"?this.value.value:o}evaluate(o,c,f,_){return this.property.evaluate(this.value,this.parameters,o,c,f,_)}}class Du{constructor(o){this._properties=o,this._values=Object.create(o.defaultPossiblyEvaluatedValues)}get(o){return this._values[o]}}class zt{constructor(o){this.specification=o}possiblyEvaluate(o,c){if(o.isDataDriven())throw new Error("Value should not be data driven");return o.expression.evaluate(c)}interpolate(o,c,f){const _=Co[this.specification.type];return _?_(o,c,f):o}}class tr{constructor(o,c){this.specification=o,this.overrides=c}possiblyEvaluate(o,c,f,_){return new os(this,o.expression.kind==="constant"||o.expression.kind==="camera"?{kind:"constant",value:o.expression.evaluate(c,null,{},f,_)}:o.expression,c)}interpolate(o,c,f){if(o.value.kind!=="constant"||c.value.kind!=="constant")return o;if(o.value.value===void 0||c.value.value===void 0)return new os(this,{kind:"constant",value:void 0},o.parameters);const _=Co[this.specification.type];if(_){const w=_(o.value.value,c.value.value,f);return new os(this,{kind:"constant",value:w},o.parameters)}return o}evaluate(o,c,f,_,w,E){return o.kind==="constant"?o.value:o.evaluate(c,f,_,w,E)}}class Ma extends tr{possiblyEvaluate(o,c,f,_){if(o.value===void 0)return new os(this,{kind:"constant",value:void 0},c);if(o.expression.kind==="constant"){const w=o.expression.evaluate(c,null,{},f,_),E=o.property.specification.type==="resolvedImage"&&typeof w!="string"?w.name:w,M=this._calculate(E,E,E,c);return new os(this,{kind:"constant",value:M},c)}if(o.expression.kind==="camera"){const w=this._calculate(o.expression.evaluate({zoom:c.zoom-1}),o.expression.evaluate({zoom:c.zoom}),o.expression.evaluate({zoom:c.zoom+1}),c);return new os(this,{kind:"constant",value:w},c)}return new os(this,o.expression,c)}evaluate(o,c,f,_,w,E){if(o.kind==="source"){const M=o.evaluate(c,f,_,w,E);return this._calculate(M,M,M,c)}return o.kind==="composite"?this._calculate(o.evaluate({zoom:Math.floor(c.zoom)-1},f,_),o.evaluate({zoom:Math.floor(c.zoom)},f,_),o.evaluate({zoom:Math.floor(c.zoom)+1},f,_),c):o.value}_calculate(o,c,f,_){return _.zoom>_.zoomHistory.lastIntegerZoom?{from:o,to:c}:{from:f,to:c}}interpolate(o){return o}}class Jo{constructor(o){this.specification=o}possiblyEvaluate(o,c,f,_){if(o.value!==void 0){if(o.expression.kind==="constant"){const w=o.expression.evaluate(c,null,{},f,_);return this._calculate(w,w,w,c)}return this._calculate(o.expression.evaluate(new Qr(Math.floor(c.zoom-1),c)),o.expression.evaluate(new Qr(Math.floor(c.zoom),c)),o.expression.evaluate(new Qr(Math.floor(c.zoom+1),c)),c)}}_calculate(o,c,f,_){return _.zoom>_.zoomHistory.lastIntegerZoom?{from:o,to:c}:{from:f,to:c}}interpolate(o){return o}}class jc{constructor(o){this.specification=o}possiblyEvaluate(o,c,f,_){return!!o.expression.evaluate(c,null,{},f,_)}interpolate(){return!1}}class Bn{constructor(o){this.properties=o,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const c in o){const f=o[c];f.specification.overridable&&this.overridableProperties.push(c);const _=this.defaultPropertyValues[c]=new cl(f,void 0),w=this.defaultTransitionablePropertyValues[c]=new Xd(f);this.defaultTransitioningPropertyValues[c]=w.untransitioned(),this.defaultPossiblyEvaluatedValues[c]=_.possiblyEvaluate({})}}}Dt("DataDrivenProperty",tr),Dt("DataConstantProperty",zt),Dt("CrossFadedDataDrivenProperty",Ma),Dt("CrossFadedProperty",Jo),Dt("ColorRampProperty",jc);const Ch="-transition";class Ln extends Ft{constructor(o,c){if(super(),this.id=o.id,this.type=o.type,this._featureFilter={filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set},o.type!=="custom"&&(this.metadata=o.metadata,this.minzoom=o.minzoom,this.maxzoom=o.maxzoom,o.type!=="background"&&(this.source=o.source,this.sourceLayer=o["source-layer"],this.filter=o.filter,this._featureFilter=$o(o.filter)),c.layout&&(this._unevaluatedLayout=new Kd(c.layout)),c.paint)){this._transitionablePaint=new zc(c.paint);for(const f in o.paint)this.setPaintProperty(f,o.paint[f],{validate:!1});for(const f in o.layout)this.setLayoutProperty(f,o.layout[f],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Du(c.paint)}}setFilter(o){this.filter=o,this._featureFilter=$o(o)}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(o){return o==="visibility"?this.visibility:this._unevaluatedLayout.getValue(o)}getLayoutAffectingGlobalStateRefs(){const o=new Set;if(this._unevaluatedLayout)for(const c in this._unevaluatedLayout._values){const f=this._unevaluatedLayout._values[c];for(const _ of f.getGlobalStateRefs())o.add(_)}for(const c of this._featureFilter.getGlobalStateRefs())o.add(c);return o}setLayoutProperty(o,c,f={}){c!=null&&this._validate(ll,`layers.${this.id}.layout.${o}`,o,c,f)||(o!=="visibility"?this._unevaluatedLayout.setValue(o,c):this.visibility=c)}getPaintProperty(o){return o.endsWith(Ch)?this._transitionablePaint.getTransition(o.slice(0,-11)):this._transitionablePaint.getValue(o)}setPaintProperty(o,c,f={}){if(c!=null&&this._validate(Zm,`layers.${this.id}.paint.${o}`,o,c,f))return!1;if(o.endsWith(Ch))return this._transitionablePaint.setTransition(o.slice(0,-11),c||void 0),!1;{const _=this._transitionablePaint._values[o],w=_.property.specification["property-type"]==="cross-faded-data-driven",E=_.value.isDataDriven(),M=_.value;this._transitionablePaint.setValue(o,c),this._handleSpecialPaintPropertyUpdate(o);const R=this._transitionablePaint._values[o].value;return R.isDataDriven()||E||w||this._handleOverridablePaintPropertyUpdate(o,M,R)}}_handleSpecialPaintPropertyUpdate(o){}_handleOverridablePaintPropertyUpdate(o,c,f){return!1}isHidden(o){return!!(this.minzoom&&o<this.minzoom)||!!(this.maxzoom&&o>=this.maxzoom)||this.visibility==="none"}updateTransitions(o){this._transitioningPaint=this._transitionablePaint.transitioned(o,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(o,c){o.getCrossfadeParameters&&(this._crossfadeParameters=o.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(o,void 0,c)),this.paint=this._transitioningPaint.possiblyEvaluate(o,void 0,c)}serialize(){const o={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(o.layout=o.layout||{},o.layout.visibility=this.visibility),yn(o,((c,f)=>!(c===void 0||f==="layout"&&!Object.keys(c).length||f==="paint"&&!Object.keys(c).length)))}_validate(o,c,f,_,w={}){return(!w||w.validate!==!1)&&Xo(this,o.call(Sa,{key:c,layerType:this.type,objectKey:f,value:_,styleSpec:Le,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const o in this.paint._values){const c=this.paint.get(o);if(c instanceof os&&ya(c.property.specification)&&(c.value.kind==="source"||c.value.kind==="composite")&&c.value.isStateDependent)return!0}return!1}}const no={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Bo{constructor(o,c){this._structArray=o,this._pos1=c*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Zr{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(o,c){return o._trim(),c&&(o.isTransferred=!0,c.push(o.arrayBuffer)),{length:o.length,arrayBuffer:o.arrayBuffer}}static deserialize(o){const c=Object.create(this.prototype);return c.arrayBuffer=o.arrayBuffer,c.length=o.length,c.capacity=o.arrayBuffer.byteLength/c.bytesPerElement,c._refreshViews(),c}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(o){this.reserve(o),this.length=o}reserve(o){if(o>this.capacity){this.capacity=Math.max(o,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const c=this.uint8;this._refreshViews(),c&&this.uint8.set(c)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Pi(u,o=1){let c=0,f=0;return{members:u.map((_=>{const w=no[_.type].BYTES_PER_ELEMENT,E=c=so(c,Math.max(o,w)),M=_.components||1;return f=Math.max(f,w),c+=w*M,{name:_.name,type:_.type,components:M,offset:E}})),size:so(c,Math.max(f,o)),alignment:o}}function so(u,o){return Math.ceil(u/o)*o}class Hs extends Zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,c){const f=this.length;return this.resize(f+1),this.emplace(f,o,c)}emplace(o,c,f){const _=2*o;return this.int16[_+0]=c,this.int16[_+1]=f,o}}Hs.prototype.bytesPerElement=4,Dt("StructArrayLayout2i4",Hs);class ul extends Zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,c,f){const _=this.length;return this.resize(_+1),this.emplace(_,o,c,f)}emplace(o,c,f,_){const w=3*o;return this.int16[w+0]=c,this.int16[w+1]=f,this.int16[w+2]=_,o}}ul.prototype.bytesPerElement=6,Dt("StructArrayLayout3i6",ul);class Mh extends Zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,c,f,_){const w=this.length;return this.resize(w+1),this.emplace(w,o,c,f,_)}emplace(o,c,f,_,w){const E=4*o;return this.int16[E+0]=c,this.int16[E+1]=f,this.int16[E+2]=_,this.int16[E+3]=w,o}}Mh.prototype.bytesPerElement=8,Dt("StructArrayLayout4i8",Mh);class Cs extends Zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,c,f,_,w,E){const M=this.length;return this.resize(M+1),this.emplace(M,o,c,f,_,w,E)}emplace(o,c,f,_,w,E,M){const R=6*o;return this.int16[R+0]=c,this.int16[R+1]=f,this.int16[R+2]=_,this.int16[R+3]=w,this.int16[R+4]=E,this.int16[R+5]=M,o}}Cs.prototype.bytesPerElement=12,Dt("StructArrayLayout2i4i12",Cs);class Ms extends Zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,c,f,_,w,E){const M=this.length;return this.resize(M+1),this.emplace(M,o,c,f,_,w,E)}emplace(o,c,f,_,w,E,M){const R=4*o,D=8*o;return this.int16[R+0]=c,this.int16[R+1]=f,this.uint8[D+4]=_,this.uint8[D+5]=w,this.uint8[D+6]=E,this.uint8[D+7]=M,o}}Ms.prototype.bytesPerElement=8,Dt("StructArrayLayout2i4ub8",Ms);class hl extends Zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,c){const f=this.length;return this.resize(f+1),this.emplace(f,o,c)}emplace(o,c,f){const _=2*o;return this.float32[_+0]=c,this.float32[_+1]=f,o}}hl.prototype.bytesPerElement=8,Dt("StructArrayLayout2f8",hl);class Nu extends Zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,c,f,_,w,E,M,R,D,z){const V=this.length;return this.resize(V+1),this.emplace(V,o,c,f,_,w,E,M,R,D,z)}emplace(o,c,f,_,w,E,M,R,D,z,V){const Z=10*o;return this.uint16[Z+0]=c,this.uint16[Z+1]=f,this.uint16[Z+2]=_,this.uint16[Z+3]=w,this.uint16[Z+4]=E,this.uint16[Z+5]=M,this.uint16[Z+6]=R,this.uint16[Z+7]=D,this.uint16[Z+8]=z,this.uint16[Z+9]=V,o}}Nu.prototype.bytesPerElement=20,Dt("StructArrayLayout10ui20",Nu);class Qo extends Zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,c,f,_,w,E,M,R,D,z,V,Z){const X=this.length;return this.resize(X+1),this.emplace(X,o,c,f,_,w,E,M,R,D,z,V,Z)}emplace(o,c,f,_,w,E,M,R,D,z,V,Z,X){const Y=12*o;return this.int16[Y+0]=c,this.int16[Y+1]=f,this.int16[Y+2]=_,this.int16[Y+3]=w,this.uint16[Y+4]=E,this.uint16[Y+5]=M,this.uint16[Y+6]=R,this.uint16[Y+7]=D,this.int16[Y+8]=z,this.int16[Y+9]=V,this.int16[Y+10]=Z,this.int16[Y+11]=X,o}}Qo.prototype.bytesPerElement=24,Dt("StructArrayLayout4i4ui4i24",Qo);class Ph extends Zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,c,f){const _=this.length;return this.resize(_+1),this.emplace(_,o,c,f)}emplace(o,c,f,_){const w=3*o;return this.float32[w+0]=c,this.float32[w+1]=f,this.float32[w+2]=_,o}}Ph.prototype.bytesPerElement=12,Dt("StructArrayLayout3f12",Ph);class Ul extends Zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(o){const c=this.length;return this.resize(c+1),this.emplace(c,o)}emplace(o,c){return this.uint32[1*o+0]=c,o}}Ul.prototype.bytesPerElement=4,Dt("StructArrayLayout1ul4",Ul);class Ws extends Zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,c,f,_,w,E,M,R,D){const z=this.length;return this.resize(z+1),this.emplace(z,o,c,f,_,w,E,M,R,D)}emplace(o,c,f,_,w,E,M,R,D,z){const V=10*o,Z=5*o;return this.int16[V+0]=c,this.int16[V+1]=f,this.int16[V+2]=_,this.int16[V+3]=w,this.int16[V+4]=E,this.int16[V+5]=M,this.uint32[Z+3]=R,this.uint16[V+8]=D,this.uint16[V+9]=z,o}}Ws.prototype.bytesPerElement=20,Dt("StructArrayLayout6i1ul2ui20",Ws);class jl extends Zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,c,f,_,w,E){const M=this.length;return this.resize(M+1),this.emplace(M,o,c,f,_,w,E)}emplace(o,c,f,_,w,E,M){const R=6*o;return this.int16[R+0]=c,this.int16[R+1]=f,this.int16[R+2]=_,this.int16[R+3]=w,this.int16[R+4]=E,this.int16[R+5]=M,o}}jl.prototype.bytesPerElement=12,Dt("StructArrayLayout2i2i2i12",jl);class b extends Zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,c,f,_,w){const E=this.length;return this.resize(E+1),this.emplace(E,o,c,f,_,w)}emplace(o,c,f,_,w,E){const M=4*o,R=8*o;return this.float32[M+0]=c,this.float32[M+1]=f,this.float32[M+2]=_,this.int16[R+6]=w,this.int16[R+7]=E,o}}b.prototype.bytesPerElement=16,Dt("StructArrayLayout2f1f2i16",b);class n extends Zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,c,f,_,w,E){const M=this.length;return this.resize(M+1),this.emplace(M,o,c,f,_,w,E)}emplace(o,c,f,_,w,E,M){const R=16*o,D=4*o,z=8*o;return this.uint8[R+0]=c,this.uint8[R+1]=f,this.float32[D+1]=_,this.float32[D+2]=w,this.int16[z+6]=E,this.int16[z+7]=M,o}}n.prototype.bytesPerElement=16,Dt("StructArrayLayout2ub2f2i16",n);class d extends Zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,c,f){const _=this.length;return this.resize(_+1),this.emplace(_,o,c,f)}emplace(o,c,f,_){const w=3*o;return this.uint16[w+0]=c,this.uint16[w+1]=f,this.uint16[w+2]=_,o}}d.prototype.bytesPerElement=6,Dt("StructArrayLayout3ui6",d);class m extends Zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,c,f,_,w,E,M,R,D,z,V,Z,X,Y,re,he,ye){const Ne=this.length;return this.resize(Ne+1),this.emplace(Ne,o,c,f,_,w,E,M,R,D,z,V,Z,X,Y,re,he,ye)}emplace(o,c,f,_,w,E,M,R,D,z,V,Z,X,Y,re,he,ye,Ne){const Ee=24*o,Me=12*o,Xe=48*o;return this.int16[Ee+0]=c,this.int16[Ee+1]=f,this.uint16[Ee+2]=_,this.uint16[Ee+3]=w,this.uint32[Me+2]=E,this.uint32[Me+3]=M,this.uint32[Me+4]=R,this.uint16[Ee+10]=D,this.uint16[Ee+11]=z,this.uint16[Ee+12]=V,this.float32[Me+7]=Z,this.float32[Me+8]=X,this.uint8[Xe+36]=Y,this.uint8[Xe+37]=re,this.uint8[Xe+38]=he,this.uint32[Me+10]=ye,this.int16[Ee+22]=Ne,o}}m.prototype.bytesPerElement=48,Dt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",m);class y extends Zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,c,f,_,w,E,M,R,D,z,V,Z,X,Y,re,he,ye,Ne,Ee,Me,Xe,st,ft,It,At,Pt,Yt,St){const Rt=this.length;return this.resize(Rt+1),this.emplace(Rt,o,c,f,_,w,E,M,R,D,z,V,Z,X,Y,re,he,ye,Ne,Ee,Me,Xe,st,ft,It,At,Pt,Yt,St)}emplace(o,c,f,_,w,E,M,R,D,z,V,Z,X,Y,re,he,ye,Ne,Ee,Me,Xe,st,ft,It,At,Pt,Yt,St,Rt){const ct=32*o,ur=16*o;return this.int16[ct+0]=c,this.int16[ct+1]=f,this.int16[ct+2]=_,this.int16[ct+3]=w,this.int16[ct+4]=E,this.int16[ct+5]=M,this.int16[ct+6]=R,this.int16[ct+7]=D,this.uint16[ct+8]=z,this.uint16[ct+9]=V,this.uint16[ct+10]=Z,this.uint16[ct+11]=X,this.uint16[ct+12]=Y,this.uint16[ct+13]=re,this.uint16[ct+14]=he,this.uint16[ct+15]=ye,this.uint16[ct+16]=Ne,this.uint16[ct+17]=Ee,this.uint16[ct+18]=Me,this.uint16[ct+19]=Xe,this.uint16[ct+20]=st,this.uint16[ct+21]=ft,this.uint16[ct+22]=It,this.uint32[ur+12]=At,this.float32[ur+13]=Pt,this.float32[ur+14]=Yt,this.uint16[ct+30]=St,this.uint16[ct+31]=Rt,o}}y.prototype.bytesPerElement=64,Dt("StructArrayLayout8i15ui1ul2f2ui64",y);class x extends Zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o){const c=this.length;return this.resize(c+1),this.emplace(c,o)}emplace(o,c){return this.float32[1*o+0]=c,o}}x.prototype.bytesPerElement=4,Dt("StructArrayLayout1f4",x);class S extends Zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,c,f){const _=this.length;return this.resize(_+1),this.emplace(_,o,c,f)}emplace(o,c,f,_){const w=3*o;return this.uint16[6*o+0]=c,this.float32[w+1]=f,this.float32[w+2]=_,o}}S.prototype.bytesPerElement=12,Dt("StructArrayLayout1ui2f12",S);class I extends Zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,c,f){const _=this.length;return this.resize(_+1),this.emplace(_,o,c,f)}emplace(o,c,f,_){const w=4*o;return this.uint32[2*o+0]=c,this.uint16[w+2]=f,this.uint16[w+3]=_,o}}I.prototype.bytesPerElement=8,Dt("StructArrayLayout1ul2ui8",I);class B extends Zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,c){const f=this.length;return this.resize(f+1),this.emplace(f,o,c)}emplace(o,c,f){const _=2*o;return this.uint16[_+0]=c,this.uint16[_+1]=f,o}}B.prototype.bytesPerElement=4,Dt("StructArrayLayout2ui4",B);class F extends Zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o){const c=this.length;return this.resize(c+1),this.emplace(c,o)}emplace(o,c){return this.uint16[1*o+0]=c,o}}F.prototype.bytesPerElement=2,Dt("StructArrayLayout1ui2",F);class U extends Zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,c,f,_){const w=this.length;return this.resize(w+1),this.emplace(w,o,c,f,_)}emplace(o,c,f,_,w){const E=4*o;return this.float32[E+0]=c,this.float32[E+1]=f,this.float32[E+2]=_,this.float32[E+3]=w,o}}U.prototype.bytesPerElement=16,Dt("StructArrayLayout4f16",U);class W extends Bo{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new v(this.anchorPointX,this.anchorPointY)}}W.prototype.size=20;class G extends Ws{get(o){return new W(this,o)}}Dt("CollisionBoxArray",G);class q extends Bo{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(o){this._structArray.uint8[this._pos1+37]=o}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(o){this._structArray.uint8[this._pos1+38]=o}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(o){this._structArray.uint32[this._pos4+10]=o}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}q.prototype.size=48;class J extends m{get(o){return new q(this,o)}}Dt("PlacedSymbolArray",J);class le extends Bo{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(o){this._structArray.uint32[this._pos4+12]=o}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}le.prototype.size=64;class de extends y{get(o){return new le(this,o)}}Dt("SymbolInstanceArray",de);class pe extends x{getoffsetX(o){return this.float32[1*o+0]}}Dt("GlyphOffsetArray",pe);class ge extends ul{getx(o){return this.int16[3*o+0]}gety(o){return this.int16[3*o+1]}gettileUnitDistanceFromAnchor(o){return this.int16[3*o+2]}}Dt("SymbolLineVertexArray",ge);class xe extends Bo{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}xe.prototype.size=12;class _e extends S{get(o){return new xe(this,o)}}Dt("TextAnchorOffsetArray",_e);class Te extends Bo{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}Te.prototype.size=8;class Pe extends I{get(o){return new Te(this,o)}}Dt("FeatureIndexArray",Pe);class ve extends Hs{}class Re extends Hs{}class $e extends Hs{}class We extends Cs{}class qe extends Ms{}class Qe extends hl{}class bt extends Nu{}class Et extends Qo{}class ut extends Ph{}class Ut extends Ul{}class Ar extends jl{}class Ur extends n{}class ei extends d{}class Xr extends B{}const ai=Pi([{name:"a_pos",components:2,type:"Int16"}],4),{members:wi}=ai;class yr{constructor(o=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=o}prepareSegment(o,c,f,_){const w=this.segments[this.segments.length-1];return o>yr.MAX_VERTEX_ARRAY_LENGTH&&ri(`Max vertices per segment is ${yr.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${o}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${yr.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!w||w.vertexLength+o>yr.MAX_VERTEX_ARRAY_LENGTH||w.sortKey!==_?this.createNewSegment(c,f,_):w}createNewSegment(o,c,f){const _={vertexOffset:o.length,primitiveOffset:c.length,vertexLength:0,primitiveLength:0,vaos:{}};return f!==void 0&&(_.sortKey=f),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(_),_}getOrCreateLatestSegment(o,c,f){return this.prepareSegment(0,o,c,f)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(const o of this.segments)for(const c in o.vaos)o.vaos[c].destroy()}static simpleSegment(o,c,f,_){return new yr([{vertexOffset:o,primitiveOffset:c,vertexLength:f,primitiveLength:_,vaos:{},sortKey:0}])}}function Hr(u,o){return 256*(u=gr(Math.floor(u),0,255))+gr(Math.floor(o),0,255)}yr.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Dt("SegmentVector",yr);const Zi=Pi([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var tn,dn,as,oo={exports:{}},Pa={exports:{}},ea={exports:{}},Vl=(function(){if(as)return oo.exports;as=1;var u=(tn||(tn=1,Pa.exports=function(c,f){var _,w,E,M,R,D,z,V;for(w=c.length-(_=3&c.length),E=f,R=3432918353,D=461845907,V=0;V<w;)z=255&c.charCodeAt(V)|(255&c.charCodeAt(++V))<<8|(255&c.charCodeAt(++V))<<16|(255&c.charCodeAt(++V))<<24,++V,E=27492+(65535&(M=5*(65535&(E=(E^=z=(65535&(z=(z=(65535&z)*R+(((z>>>16)*R&65535)<<16)&4294967295)<<15|z>>>17))*D+(((z>>>16)*D&65535)<<16)&4294967295)<<13|E>>>19))+((5*(E>>>16)&65535)<<16)&4294967295))+((58964+(M>>>16)&65535)<<16);switch(z=0,_){case 3:z^=(255&c.charCodeAt(V+2))<<16;case 2:z^=(255&c.charCodeAt(V+1))<<8;case 1:E^=z=(65535&(z=(z=(65535&(z^=255&c.charCodeAt(V)))*R+(((z>>>16)*R&65535)<<16)&4294967295)<<15|z>>>17))*D+(((z>>>16)*D&65535)<<16)&4294967295}return E^=c.length,E=2246822507*(65535&(E^=E>>>16))+((2246822507*(E>>>16)&65535)<<16)&4294967295,E=3266489909*(65535&(E^=E>>>13))+((3266489909*(E>>>16)&65535)<<16)&4294967295,(E^=E>>>16)>>>0}),Pa.exports),o=(dn||(dn=1,ea.exports=function(c,f){for(var _,w=c.length,E=f^w,M=0;w>=4;)_=1540483477*(65535&(_=255&c.charCodeAt(M)|(255&c.charCodeAt(++M))<<8|(255&c.charCodeAt(++M))<<16|(255&c.charCodeAt(++M))<<24))+((1540483477*(_>>>16)&65535)<<16),E=1540483477*(65535&E)+((1540483477*(E>>>16)&65535)<<16)^(_=1540483477*(65535&(_^=_>>>24))+((1540483477*(_>>>16)&65535)<<16)),w-=4,++M;switch(w){case 3:E^=(255&c.charCodeAt(M+2))<<16;case 2:E^=(255&c.charCodeAt(M+1))<<8;case 1:E=1540483477*(65535&(E^=255&c.charCodeAt(M)))+((1540483477*(E>>>16)&65535)<<16)}return E=1540483477*(65535&(E^=E>>>13))+((1540483477*(E>>>16)&65535)<<16),(E^=E>>>15)>>>0}),ea.exports);return oo.exports=u,oo.exports.murmur3=u,oo.exports.murmur2=o,oo.exports})(),Gl=T(Vl);class dl{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(o,c,f,_){this.ids.push(Hl(o)),this.positions.push(c,f,_)}getPositions(o){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const c=Hl(o);let f=0,_=this.ids.length-1;for(;f<_;){const E=f+_>>1;this.ids[E]>=c?_=E:f=E+1}const w=[];for(;this.ids[f]===c;)w.push({index:this.positions[3*f],start:this.positions[3*f+1],end:this.positions[3*f+2]}),f++;return w}static serialize(o,c){const f=new Float64Array(o.ids),_=new Uint32Array(o.positions);return ls(f,_,0,f.length-1),c&&c.push(f.buffer,_.buffer),{ids:f,positions:_}}static deserialize(o){const c=new dl;return c.ids=o.ids,c.positions=o.positions,c.indexed=!0,c}}function Hl(u){const o=+u;return!isNaN(o)&&o<=Number.MAX_SAFE_INTEGER?o:Gl(String(u))}function ls(u,o,c,f){for(;c<f;){const _=u[c+f>>1];let w=c-1,E=f+1;for(;;){do w++;while(u[w]<_);do E--;while(u[E]>_);if(w>=E)break;Lo(u,w,E),Lo(o,3*w,3*E),Lo(o,3*w+1,3*E+1),Lo(o,3*w+2,3*E+2)}E-c<f-E?(ls(u,o,c,E),c=E+1):(ls(u,o,E+1,f),f=E)}}function Lo(u,o,c){const f=u[o];u[o]=u[c],u[c]=f}Dt("FeaturePositionMap",dl);class cs{constructor(o,c){this.gl=o.gl,this.location=c}}class Ra extends cs{constructor(o,c){super(o,c),this.current=0}set(o){this.current!==o&&(this.current=o,this.gl.uniform1f(this.location,o))}}class Xi extends cs{constructor(o,c){super(o,c),this.current=[0,0,0,0]}set(o){o[0]===this.current[0]&&o[1]===this.current[1]&&o[2]===this.current[2]&&o[3]===this.current[3]||(this.current=o,this.gl.uniform4f(this.location,o[0],o[1],o[2],o[3]))}}class rn extends cs{constructor(o,c){super(o,c),this.current=ar.transparent}set(o){o.r===this.current.r&&o.g===this.current.g&&o.b===this.current.b&&o.a===this.current.a||(this.current=o,this.gl.uniform4f(this.location,o.r,o.g,o.b,o.a))}}const us=new Float32Array(16);function nn(u){return[Hr(255*u.r,255*u.g),Hr(255*u.b,255*u.a)]}class Ou{constructor(o,c,f){this.value=o,this.uniformNames=c.map((_=>`u_${_}`)),this.type=f}setUniform(o,c,f){o.set(f.constantOr(this.value))}getBinding(o,c,f){return this.type==="color"?new rn(o,c):new Ra(o,c)}}class Vc{constructor(o,c){this.uniformNames=c.map((f=>`u_${f}`)),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(o,c){this.pixelRatioFrom=c.pixelRatio,this.pixelRatioTo=o.pixelRatio,this.patternFrom=c.tlbr,this.patternTo=o.tlbr}setUniform(o,c,f,_){const w=_==="u_pattern_to"?this.patternTo:_==="u_pattern_from"?this.patternFrom:_==="u_pixel_ratio_to"?this.pixelRatioTo:_==="u_pixel_ratio_from"?this.pixelRatioFrom:null;w&&o.set(w)}getBinding(o,c,f){return f.substr(0,9)==="u_pattern"?new Xi(o,c):new Ra(o,c)}}class pn{constructor(o,c,f,_){this.expression=o,this.type=f,this.maxValue=0,this.paintVertexAttributes=c.map((w=>({name:`a_${w}`,type:"Float32",components:f==="color"?2:1,offset:0}))),this.paintVertexArray=new _}populatePaintArray(o,c,f,_,w){const E=this.paintVertexArray.length,M=this.expression.evaluate(new Qr(0),c,{},_,[],w);this.paintVertexArray.resize(o),this._setPaintValue(E,o,M)}updatePaintArray(o,c,f,_){const w=this.expression.evaluate({zoom:0},f,_);this._setPaintValue(o,c,w)}_setPaintValue(o,c,f){if(this.type==="color"){const _=nn(f);for(let w=o;w<c;w++)this.paintVertexArray.emplace(w,_[0],_[1])}else{for(let _=o;_<c;_++)this.paintVertexArray.emplace(_,f);this.maxValue=Math.max(this.maxValue,Math.abs(f))}}upload(o){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=o.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class qs{constructor(o,c,f,_,w,E){this.expression=o,this.uniformNames=c.map((M=>`u_${M}_t`)),this.type=f,this.useIntegerZoom=_,this.zoom=w,this.maxValue=0,this.paintVertexAttributes=c.map((M=>({name:`a_${M}`,type:"Float32",components:f==="color"?4:2,offset:0}))),this.paintVertexArray=new E}populatePaintArray(o,c,f,_,w){const E=this.expression.evaluate(new Qr(this.zoom),c,{},_,[],w),M=this.expression.evaluate(new Qr(this.zoom+1),c,{},_,[],w),R=this.paintVertexArray.length;this.paintVertexArray.resize(o),this._setPaintValue(R,o,E,M)}updatePaintArray(o,c,f,_){const w=this.expression.evaluate({zoom:this.zoom},f,_),E=this.expression.evaluate({zoom:this.zoom+1},f,_);this._setPaintValue(o,c,w,E)}_setPaintValue(o,c,f,_){if(this.type==="color"){const w=nn(f),E=nn(_);for(let M=o;M<c;M++)this.paintVertexArray.emplace(M,w[0],w[1],E[0],E[1])}else{for(let w=o;w<c;w++)this.paintVertexArray.emplace(w,f,_);this.maxValue=Math.max(this.maxValue,Math.abs(f),Math.abs(_))}}upload(o){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=o.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(o,c){const f=this.useIntegerZoom?Math.floor(c.zoom):c.zoom,_=gr(this.expression.interpolationFactor(f,this.zoom,this.zoom+1),0,1);o.set(_)}getBinding(o,c,f){return new Ra(o,c)}}class Do{constructor(o,c,f,_,w,E){this.expression=o,this.type=c,this.useIntegerZoom=f,this.zoom=_,this.layerId=E,this.zoomInPaintVertexArray=new w,this.zoomOutPaintVertexArray=new w}populatePaintArray(o,c,f){const _=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(o),this.zoomOutPaintVertexArray.resize(o),this._setPaintValues(_,o,c.patterns&&c.patterns[this.layerId],f)}updatePaintArray(o,c,f,_,w){this._setPaintValues(o,c,f.patterns&&f.patterns[this.layerId],w)}_setPaintValues(o,c,f,_){if(!_||!f)return;const{min:w,mid:E,max:M}=f,R=_[w],D=_[E],z=_[M];if(R&&D&&z)for(let V=o;V<c;V++)this.zoomInPaintVertexArray.emplace(V,D.tl[0],D.tl[1],D.br[0],D.br[1],R.tl[0],R.tl[1],R.br[0],R.br[1],D.pixelRatio,R.pixelRatio),this.zoomOutPaintVertexArray.emplace(V,D.tl[0],D.tl[1],D.br[0],D.br[1],z.tl[0],z.tl[1],z.br[0],z.br[1],D.pixelRatio,z.pixelRatio)}upload(o){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=o.createVertexBuffer(this.zoomInPaintVertexArray,Zi.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=o.createVertexBuffer(this.zoomOutPaintVertexArray,Zi.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Yd{constructor(o,c,f){this.binders={},this._buffers=[];const _=[];for(const w in o.paint._values){if(!f(w))continue;const E=o.paint.get(w);if(!(E instanceof os&&ya(E.property.specification)))continue;const M=Jd(w,o.type),R=E.value,D=E.property.specification.type,z=E.property.useIntegerZoom,V=E.property.specification["property-type"],Z=V==="cross-faded"||V==="cross-faded-data-driven";if(R.kind==="constant")this.binders[w]=Z?new Vc(R.value,M):new Ou(R.value,M,D),_.push(`/u_${w}`);else if(R.kind==="source"||Z){const X=Fu(w,D,"source");this.binders[w]=Z?new Do(R,D,z,c,X,o.id):new pn(R,M,D,X),_.push(`/a_${w}`)}else{const X=Fu(w,D,"composite");this.binders[w]=new qs(R,M,D,z,c,X),_.push(`/z_${w}`)}}this.cacheKey=_.sort().join("")}getMaxValue(o){const c=this.binders[o];return c instanceof pn||c instanceof qs?c.maxValue:0}populatePaintArrays(o,c,f,_,w){for(const E in this.binders){const M=this.binders[E];(M instanceof pn||M instanceof qs||M instanceof Do)&&M.populatePaintArray(o,c,f,_,w)}}setConstantPatternPositions(o,c){for(const f in this.binders){const _=this.binders[f];_ instanceof Vc&&_.setConstantPatternPositions(o,c)}}updatePaintArrays(o,c,f,_,w){let E=!1;for(const M in o){const R=c.getPositions(M);for(const D of R){const z=f.feature(D.index);for(const V in this.binders){const Z=this.binders[V];if((Z instanceof pn||Z instanceof qs||Z instanceof Do)&&Z.expression.isStateDependent===!0){const X=_.paint.get(V);Z.expression=X.value,Z.updatePaintArray(D.start,D.end,z,o[M],w),E=!0}}}}return E}defines(){const o=[];for(const c in this.binders){const f=this.binders[c];(f instanceof Ou||f instanceof Vc)&&o.push(...f.uniformNames.map((_=>`#define HAS_UNIFORM_${_}`)))}return o}getBinderAttributes(){const o=[];for(const c in this.binders){const f=this.binders[c];if(f instanceof pn||f instanceof qs)for(let _=0;_<f.paintVertexAttributes.length;_++)o.push(f.paintVertexAttributes[_].name);else if(f instanceof Do)for(let _=0;_<Zi.members.length;_++)o.push(Zi.members[_].name)}return o}getBinderUniforms(){const o=[];for(const c in this.binders){const f=this.binders[c];if(f instanceof Ou||f instanceof Vc||f instanceof qs)for(const _ of f.uniformNames)o.push(_)}return o}getPaintVertexBuffers(){return this._buffers}getUniforms(o,c){const f=[];for(const _ in this.binders){const w=this.binders[_];if(w instanceof Ou||w instanceof Vc||w instanceof qs){for(const E of w.uniformNames)if(c[E]){const M=w.getBinding(o,c[E],E);f.push({name:E,property:_,binding:M})}}}return f}setUniforms(o,c,f,_){for(const{name:w,property:E,binding:M}of c)this.binders[E].setUniform(M,_,f.get(E),w)}updatePaintBuffers(o){this._buffers=[];for(const c in this.binders){const f=this.binders[c];if(o&&f instanceof Do){const _=o.fromScale===2?f.zoomInPaintVertexBuffer:f.zoomOutPaintVertexBuffer;_&&this._buffers.push(_)}else(f instanceof pn||f instanceof qs)&&f.paintVertexBuffer&&this._buffers.push(f.paintVertexBuffer)}}upload(o){for(const c in this.binders){const f=this.binders[c];(f instanceof pn||f instanceof qs||f instanceof Do)&&f.upload(o)}this.updatePaintBuffers()}destroy(){for(const o in this.binders){const c=this.binders[o];(c instanceof pn||c instanceof qs||c instanceof Do)&&c.destroy()}}}class Ps{constructor(o,c,f=()=>!0){this.programConfigurations={};for(const _ of o)this.programConfigurations[_.id]=new Yd(_,c,f);this.needsUpload=!1,this._featureMap=new dl,this._bufferOffset=0}populatePaintArrays(o,c,f,_,w,E){for(const M in this.programConfigurations)this.programConfigurations[M].populatePaintArrays(o,c,_,w,E);c.id!==void 0&&this._featureMap.add(c.id,f,this._bufferOffset,o),this._bufferOffset=o,this.needsUpload=!0}updatePaintArrays(o,c,f,_){for(const w of f)this.needsUpload=this.programConfigurations[w.id].updatePaintArrays(o,this._featureMap,c,w,_)||this.needsUpload}get(o){return this.programConfigurations[o]}upload(o){if(this.needsUpload){for(const c in this.programConfigurations)this.programConfigurations[c].upload(o);this.needsUpload=!1}}destroy(){for(const o in this.programConfigurations)this.programConfigurations[o].destroy()}}function Jd(u,o){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[u]||[u.replace(`${o}-`,"").replace(/-/g,"_")]}function Fu(u,o,c){const f={color:{source:hl,composite:U},number:{source:x,composite:hl}},_=(function(w){return{"line-pattern":{source:bt,composite:bt},"fill-pattern":{source:bt,composite:bt},"fill-extrusion-pattern":{source:bt,composite:bt}}[w]})(u);return _&&_[c]||f[o][c]}Dt("ConstantBinder",Ou),Dt("CrossFadedConstantBinder",Vc),Dt("SourceExpressionBinder",pn),Dt("CrossFadedCompositeBinder",Do),Dt("CompositeExpressionBinder",qs),Dt("ProgramConfiguration",Yd,{omit:["_buffers"]}),Dt("ProgramConfigurationSet",Ps);const Ia=Math.pow(2,14)-1,Gc=-Ia-1;function ta(u){const o=wt/u.extent,c=u.loadGeometry();for(let f=0;f<c.length;f++){const _=c[f];for(let w=0;w<_.length;w++){const E=_[w],M=Math.round(E.x*o),R=Math.round(E.y*o);E.x=gr(M,Gc,Ia),E.y=gr(R,Gc,Ia),(M<E.x||M>E.x+1||R<E.y||R>E.y+1)&&ri("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return c}function ka(u,o){return{type:u.type,id:u.id,properties:u.properties,geometry:o?ta(u):[]}}const Xm=-32768;function G_(u,o,c,f,_){u.emplaceBack(Xm+8*o+f,Xm+8*c+_)}class cf{constructor(o){this.zoom=o.zoom,this.globalState=o.globalState,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map((c=>c.id)),this.index=o.index,this.hasPattern=!1,this.layoutVertexArray=new Re,this.indexArray=new ei,this.segments=new yr,this.programConfigurations=new Ps(o.layers,o.zoom),this.stateDependentLayerIds=this.layers.filter((c=>c.isStateDependent())).map((c=>c.id))}populate(o,c,f){const _=this.layers[0],w=[];let E=null,M=!1,R=_.type==="heatmap";if(_.type==="circle"){const z=_;E=z.layout.get("circle-sort-key"),M=!E.isConstant(),R=R||z.paint.get("circle-pitch-alignment")==="map"}const D=R?c.subdivisionGranularity.circle:1;for(const{feature:z,id:V,index:Z,sourceLayerIndex:X}of o){const Y=this.layers[0]._featureFilter.needGeometry,re=ka(z,Y);if(!this.layers[0]._featureFilter.filter(new Qr(this.zoom,{globalState:this.globalState}),re,f))continue;const he=M?E.evaluate(re,{},f):void 0,ye={id:V,properties:z.properties,type:z.type,sourceLayerIndex:X,index:Z,geometry:Y?re.geometry:ta(z),patterns:{},sortKey:he};w.push(ye)}M&&w.sort(((z,V)=>z.sortKey-V.sortKey));for(const z of w){const{geometry:V,index:Z,sourceLayerIndex:X}=z,Y=o[Z].feature;this.addFeature(z,V,Z,f,D),c.featureIndex.insert(Y,V,Z,X,this.index)}}update(o,c,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,c,this.stateDependentLayers,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,wi),this.indexBuffer=o.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(o,c,f,_,w=1){let E;switch(w){case 1:E=[0,7];break;case 3:E=[0,2,5,7];break;case 5:E=[0,1,3,4,6,7];break;case 7:E=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${w}; valid values are 1, 3, 5, 7.`)}const M=E.length;for(const R of c)for(const D of R){const z=D.x,V=D.y;if(z<0||z>=wt||V<0||V>=wt)continue;const Z=this.segments.prepareSegment(M*M,this.layoutVertexArray,this.indexArray,o.sortKey),X=Z.vertexLength;for(let Y=0;Y<M;Y++)for(let re=0;re<M;re++)G_(this.layoutVertexArray,z,V,E[re],E[Y]);for(let Y=0;Y<M-1;Y++)for(let re=0;re<M-1;re++){const he=X+Y*M+re,ye=X+(Y+1)*M+re;this.indexArray.emplaceBack(he,ye+1,he+1),this.indexArray.emplaceBack(he,ye,ye+1)}Z.vertexLength+=M*M,Z.primitiveLength+=(M-1)*(M-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,f,{},_)}}function Km(u,o){for(let c=0;c<u.length;c++)if(zu(o,u[c]))return!0;for(let c=0;c<o.length;c++)if(zu(u,o[c]))return!0;return!!hs(u,o)}function H_(u,o,c){return!!zu(u,o)||!!uf(o,u,c)}function W_(u,o){if(u.length===1)return Jm(o,u[0]);for(let c=0;c<o.length;c++){const f=o[c];for(let _=0;_<f.length;_++)if(zu(u,f[_]))return!0}for(let c=0;c<u.length;c++)if(Jm(o,u[c]))return!0;for(let c=0;c<o.length;c++)if(hs(u,o[c]))return!0;return!1}function ao(u,o,c){if(u.length>1){if(hs(u,o))return!0;for(let f=0;f<o.length;f++)if(uf(o[f],u,c))return!0}for(let f=0;f<u.length;f++)if(uf(u[f],o,c))return!0;return!1}function hs(u,o){if(u.length===0||o.length===0)return!1;for(let c=0;c<u.length-1;c++){const f=u[c],_=u[c+1];for(let w=0;w<o.length-1;w++)if(q_(f,_,o[w],o[w+1]))return!0}return!1}function q_(u,o,c,f){return vn(u,c,f)!==vn(o,c,f)&&vn(u,o,c)!==vn(u,o,f)}function uf(u,o,c){const f=c*c;if(o.length===1)return u.distSqr(o[0])<f;for(let _=1;_<o.length;_++)if(Ym(u,o[_-1],o[_])<f)return!0;return!1}function Ym(u,o,c){const f=o.distSqr(c);if(f===0)return u.distSqr(o);const _=((u.x-o.x)*(c.x-o.x)+(u.y-o.y)*(c.y-o.y))/f;return u.distSqr(_<0?o:_>1?c:c.sub(o)._mult(_)._add(o))}function Jm(u,o){let c,f,_,w=!1;for(let E=0;E<u.length;E++){c=u[E];for(let M=0,R=c.length-1;M<c.length;R=M++)f=c[M],_=c[R],f.y>o.y!=_.y>o.y&&o.x<(_.x-f.x)*(o.y-f.y)/(_.y-f.y)+f.x&&(w=!w)}return w}function zu(u,o){let c=!1;for(let f=0,_=u.length-1;f<u.length;_=f++){const w=u[f],E=u[_];w.y>o.y!=E.y>o.y&&o.x<(E.x-w.x)*(o.y-w.y)/(E.y-w.y)+w.x&&(c=!c)}return c}function Qm(u,o,c){const f=c[0],_=c[2];if(u.x<f.x&&o.x<f.x||u.x>_.x&&o.x>_.x||u.y<f.y&&o.y<f.y||u.y>_.y&&o.y>_.y)return!1;const w=vn(u,o,c[0]);return w!==vn(u,o,c[1])||w!==vn(u,o,c[2])||w!==vn(u,o,c[3])}function Rh(u,o,c){const f=o.paint.get(u).value;return f.kind==="constant"?f.value:c.programConfigurations.get(o.id).getMaxValue(u)}function Ih(u){return Math.sqrt(u[0]*u[0]+u[1]*u[1])}function Qd(u,o,c,f,_){if(!o[0]&&!o[1])return u;const w=v.convert(o)._mult(_);c==="viewport"&&w._rotate(-f);const E=[];for(let M=0;M<u.length;M++)E.push(u[M].sub(w));return E}let eg,hf;Dt("CircleBucket",cf,{omit:["layers"]});var tg={get paint(){return hf=hf||new Bn({"circle-radius":new tr(Le.paint_circle["circle-radius"]),"circle-color":new tr(Le.paint_circle["circle-color"]),"circle-blur":new tr(Le.paint_circle["circle-blur"]),"circle-opacity":new tr(Le.paint_circle["circle-opacity"]),"circle-translate":new zt(Le.paint_circle["circle-translate"]),"circle-translate-anchor":new zt(Le.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new zt(Le.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new zt(Le.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new tr(Le.paint_circle["circle-stroke-width"]),"circle-stroke-color":new tr(Le.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new tr(Le.paint_circle["circle-stroke-opacity"])})},get layout(){return eg=eg||new Bn({"circle-sort-key":new tr(Le.layout_circle["circle-sort-key"])})}};class $_ extends Ln{constructor(o){super(o,tg)}createBucket(o){return new cf(o)}queryRadius(o){const c=o;return Rh("circle-radius",this,c)+Rh("circle-stroke-width",this,c)+Ih(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:o,feature:c,featureState:f,geometry:_,transform:w,pixelsToTileUnits:E,unwrappedTileID:M,getElevation:R}){const D=Qd(o,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-w.bearingInRadians,E),z=this.paint.get("circle-radius").evaluate(c,f)+this.paint.get("circle-stroke-width").evaluate(c,f),V=this.paint.get("circle-pitch-alignment")==="map",Z=V?D:(function(Y,re,he,ye){return Y.map((Ne=>df(Ne,re,he,ye)))})(D,w,M,R),X=V?z*E:z;for(const Y of _)for(const re of Y){const he=V?re:df(re,w,M,R);let ye=X;const Ne=w.projectTileCoordinates(re.x,re.y,M,R).signedDistanceFromCamera;if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?ye*=Ne/w.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(ye*=w.cameraToCenterDistance/Ne),H_(Z,he,ye))return!0}return!1}}function df(u,o,c,f){const _=o.projectTileCoordinates(u.x,u.y,c,f).point;return new v((.5*_.x+.5)*o.width,(.5*-_.y+.5)*o.height)}class ep extends cf{}let Z_;Dt("HeatmapBucket",ep,{omit:["layers"]});var X_={get paint(){return Z_=Z_||new Bn({"heatmap-radius":new tr(Le.paint_heatmap["heatmap-radius"]),"heatmap-weight":new tr(Le.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new zt(Le.paint_heatmap["heatmap-intensity"]),"heatmap-color":new jc(Le.paint_heatmap["heatmap-color"]),"heatmap-opacity":new zt(Le.paint_heatmap["heatmap-opacity"])})}};function tp(u,{width:o,height:c},f,_){if(_){if(_ instanceof Uint8ClampedArray)_=new Uint8Array(_.buffer);else if(_.length!==o*c*f)throw new RangeError(`mismatched image size. expected: ${_.length} but got: ${o*c*f}`)}else _=new Uint8Array(o*c*f);return u.width=o,u.height=c,u.data=_,u}function rg(u,{width:o,height:c},f){if(o===u.width&&c===u.height)return;const _=tp({},{width:o,height:c},f);kh(u,_,{x:0,y:0},{x:0,y:0},{width:Math.min(u.width,o),height:Math.min(u.height,c)},f),u.width=o,u.height=c,u.data=_.data}function kh(u,o,c,f,_,w){if(_.width===0||_.height===0)return o;if(_.width>u.width||_.height>u.height||c.x>u.width-_.width||c.y>u.height-_.height)throw new RangeError("out of range source coordinates for image copy");if(_.width>o.width||_.height>o.height||f.x>o.width-_.width||f.y>o.height-_.height)throw new RangeError("out of range destination coordinates for image copy");const E=u.data,M=o.data;if(E===M)throw new Error("srcData equals dstData, so image is already copied");for(let R=0;R<_.height;R++){const D=((c.y+R)*u.width+c.x)*w,z=((f.y+R)*o.width+f.x)*w;for(let V=0;V<_.width*w;V++)M[z+V]=E[D+V]}return o}class No{constructor(o,c){tp(this,o,1,c)}resize(o){rg(this,o,1)}clone(){return new No({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(o,c,f,_,w){kh(o,c,f,_,w,1)}}class $s{constructor(o,c){tp(this,o,4,c)}resize(o){rg(this,o,4)}replace(o,c){c?this.data.set(o):this.data=o instanceof Uint8ClampedArray?new Uint8Array(o.buffer):o}clone(){return new $s({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(o,c,f,_,w){kh(o,c,f,_,w,4)}setPixel(o,c,f){const _=4*(o*this.width+c);this.data[_+0]=Math.round(255*f.r/f.a),this.data[_+1]=Math.round(255*f.g/f.a),this.data[_+2]=Math.round(255*f.b/f.a),this.data[_+3]=Math.round(255*f.a)}}function ig(u){const o={},c=u.resolution||256,f=u.clips?u.clips.length:1,_=u.image||new $s({width:c,height:f});if(Math.log(c)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${c}`);const w=(E,M,R)=>{o[u.evaluationKey]=R;const D=u.expression.evaluate(o);_.setPixel(E/4/c,M/4,D)};if(u.clips)for(let E=0,M=0;E<f;++E,M+=4*c)for(let R=0,D=0;R<c;R++,D+=4){const z=R/(c-1),{start:V,end:Z}=u.clips[E];w(M,D,V*(1-z)+Z*z)}else for(let E=0,M=0;E<c;E++,M+=4)w(0,M,E/(c-1));return _}Dt("AlphaImage",No),Dt("RGBAImage",$s);const rp="big-fb";class K_ extends Ln{createBucket(o){return new ep(o)}constructor(o){super(o,X_),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(o){o==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=ig({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(rp)&&this.heatmapFbos.delete(rp)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let ng;var ip={get paint(){return ng=ng||new Bn({"hillshade-illumination-direction":new zt(Le.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-altitude":new zt(Le.paint_hillshade["hillshade-illumination-altitude"]),"hillshade-illumination-anchor":new zt(Le.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new zt(Le.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new zt(Le.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new zt(Le.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new zt(Le.paint_hillshade["hillshade-accent-color"]),"hillshade-method":new zt(Le.paint_hillshade["hillshade-method"])})}};class Rs extends Ln{constructor(o){super(o,ip),this.recalculate({zoom:0,zoomHistory:{}},void 0)}getIlluminationProperties(){let o=this.paint.get("hillshade-illumination-direction").values,c=this.paint.get("hillshade-illumination-altitude").values,f=this.paint.get("hillshade-highlight-color").values,_=this.paint.get("hillshade-shadow-color").values;const w=Math.max(o.length,c.length,f.length,_.length);o=o.concat(Array(w-o.length).fill(o.at(-1))),c=c.concat(Array(w-c.length).fill(c.at(-1))),f=f.concat(Array(w-f.length).fill(f.at(-1))),_=_.concat(Array(w-_.length).fill(_.at(-1)));const E=c.map(Go);return{directionRadians:o.map(Go),altitudeRadians:E,shadowColor:_,highlightColor:f}}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}let Y_;var j1={get paint(){return Y_=Y_||new Bn({"color-relief-opacity":new zt(Le["paint_color-relief"]["color-relief-opacity"]),"color-relief-color":new jc(Le["paint_color-relief"]["color-relief-color"])})}};class Bh{constructor(o,c,f,_){this.context=o,this.format=f,this.texture=o.gl.createTexture(),this.update(c,_)}update(o,c,f){const{width:_,height:w}=o,E=!(this.size&&this.size[0]===_&&this.size[1]===w||f),{context:M}=this,{gl:R}=M;if(this.useMipmap=!!(c&&c.useMipmap),R.bindTexture(R.TEXTURE_2D,this.texture),M.pixelStoreUnpackFlipY.set(!1),M.pixelStoreUnpack.set(1),M.pixelStoreUnpackPremultiplyAlpha.set(this.format===R.RGBA&&(!c||c.premultiply!==!1)),E)this.size=[_,w],o instanceof HTMLImageElement||o instanceof HTMLCanvasElement||o instanceof HTMLVideoElement||o instanceof ImageData||bs(o)?R.texImage2D(R.TEXTURE_2D,0,this.format,this.format,R.UNSIGNED_BYTE,o):R.texImage2D(R.TEXTURE_2D,0,this.format,_,w,0,this.format,R.UNSIGNED_BYTE,o.data);else{const{x:D,y:z}=f||{x:0,y:0};o instanceof HTMLImageElement||o instanceof HTMLCanvasElement||o instanceof HTMLVideoElement||o instanceof ImageData||bs(o)?R.texSubImage2D(R.TEXTURE_2D,0,D,z,R.RGBA,R.UNSIGNED_BYTE,o):R.texSubImage2D(R.TEXTURE_2D,0,D,z,_,w,R.RGBA,R.UNSIGNED_BYTE,o.data)}this.useMipmap&&this.isSizePowerOfTwo()&&R.generateMipmap(R.TEXTURE_2D),M.pixelStoreUnpackFlipY.setDefault(),M.pixelStoreUnpack.setDefault(),M.pixelStoreUnpackPremultiplyAlpha.setDefault()}bind(o,c,f){const{context:_}=this,{gl:w}=_;w.bindTexture(w.TEXTURE_2D,this.texture),f!==w.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(f=w.LINEAR),o!==this.filter&&(w.texParameteri(w.TEXTURE_2D,w.TEXTURE_MAG_FILTER,o),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_MIN_FILTER,f||o),this.filter=o),c!==this.wrap&&(w.texParameteri(w.TEXTURE_2D,w.TEXTURE_WRAP_S,c),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_WRAP_T,c),this.wrap=c)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:o}=this.context;o.deleteTexture(this.texture),this.texture=null}}class ds{constructor(o,c,f,_=1,w=1,E=1,M=0){if(this.uid=o,c.height!==c.width)throw new RangeError("DEM tiles must be square");if(f&&!["mapbox","terrarium","custom"].includes(f))return void ri(`"${f}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=c.height;const R=this.dim=c.height-2;switch(this.data=new Uint32Array(c.data.buffer),f){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=_,this.greenFactor=w,this.blueFactor=E,this.baseShift=M;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let D=0;D<R;D++)this.data[this._idx(-1,D)]=this.data[this._idx(0,D)],this.data[this._idx(R,D)]=this.data[this._idx(R-1,D)],this.data[this._idx(D,-1)]=this.data[this._idx(D,0)],this.data[this._idx(D,R)]=this.data[this._idx(D,R-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(R,-1)]=this.data[this._idx(R-1,0)],this.data[this._idx(-1,R)]=this.data[this._idx(0,R-1)],this.data[this._idx(R,R)]=this.data[this._idx(R-1,R-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let D=0;D<R;D++)for(let z=0;z<R;z++){const V=this.get(D,z);V>this.max&&(this.max=V),V<this.min&&(this.min=V)}}get(o,c){const f=new Uint8Array(this.data.buffer),_=4*this._idx(o,c);return this.unpack(f[_],f[_+1],f[_+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(o,c){if(o<-1||o>=this.dim+1||c<-1||c>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(c+1)*this.stride+(o+1)}unpack(o,c,f){return o*this.redFactor+c*this.greenFactor+f*this.blueFactor-this.baseShift}pack(o){return J_(o,this.getUnpackVector())}getPixels(){return new $s({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(o,c,f){if(this.dim!==o.dim)throw new Error("dem dimension mismatch");let _=c*this.dim,w=c*this.dim+this.dim,E=f*this.dim,M=f*this.dim+this.dim;switch(c){case-1:_=w-1;break;case 1:w=_+1}switch(f){case-1:E=M-1;break;case 1:M=E+1}const R=-c*this.dim,D=-f*this.dim;for(let z=E;z<M;z++)for(let V=_;V<w;V++)this.data[this._idx(V,z)]=o.data[this._idx(V+R,z+D)]}}function J_(u,o){const c=o[0],f=o[1],_=o[2],w=o[3],E=Math.min(c,f,_),M=Math.round((u+w)/E);return{r:Math.floor(M*E/c)%256,g:Math.floor(M*E/f)%256,b:Math.floor(M*E/_)%256}}Dt("DEMData",ds);class $t extends Ln{constructor(o){super(o,j1)}_createColorRamp(o){const c={elevationStops:[],colorStops:[]},f=this._transitionablePaint._values["color-relief-color"].value.expression;if(f instanceof Dl&&f._styleExpression.expression instanceof $i){this.colorRampExpression=f;const E=f._styleExpression.expression;c.elevationStops=E.labels,c.colorStops=[];for(const M of c.elevationStops)c.colorStops.push(E.evaluate({globals:{elevation:M}}))}if(c.elevationStops.length<1&&(c.elevationStops=[0],c.colorStops=[ar.transparent]),c.elevationStops.length<2&&(c.elevationStops.push(c.elevationStops[0]+1),c.colorStops.push(c.colorStops[0])),c.elevationStops.length<=o)return c;const _={elevationStops:[],colorStops:[]},w=(c.elevationStops.length-1)/(o-1);for(let E=0;E<c.elevationStops.length-.5;E+=w)_.elevationStops.push(c.elevationStops[Math.round(E)]),_.colorStops.push(c.colorStops[Math.round(E)]);return ri(`Too many colors in specification of ${this.id} color-relief layer, may not render properly.`),_}_colorRampChanged(){return this.colorRampExpression!=this._transitionablePaint._values["color-relief-color"].value.expression}getColorRampTextures(o,c,f){if(this.colorRampTextures&&!this._colorRampChanged())return this.colorRampTextures;const _=this._createColorRamp(c),w=new $s({width:_.colorStops.length,height:1}),E=new $s({width:_.colorStops.length,height:1});for(let M=0;M<_.elevationStops.length;M++){const R=J_(_.elevationStops[M],f);E.setPixel(0,M,new ar(R.r/255,R.g/255,R.b/255,1)),w.setPixel(0,M,_.colorStops[M])}return this.colorRampTextures={elevationTexture:new Bh(o,E,o.gl.RGBA),colorTexture:new Bh(o,w,o.gl.RGBA)},this.colorRampTextures}hasOffscreenPass(){return this.visibility!=="none"&&!!this.colorRampTextures}}const Lh=Pi([{name:"a_pos",components:2,type:"Int16"}],4),{members:sg}=Lh;function pf(u,o,c){const f=c.patternDependencies;let _=!1;for(const w of o){const E=w.paint.get(`${u}-pattern`);E.isConstant()||(_=!0);const M=E.constantOr(null);M&&(_=!0,f[M.to]=!0,f[M.from]=!0)}return _}function og(u,o,c,f,_){const w=_.patternDependencies;for(const E of o){const M=E.paint.get(`${u}-pattern`).value;if(M.kind!=="constant"){let R=M.evaluate({zoom:f-1},c,{},_.availableImages),D=M.evaluate({zoom:f},c,{},_.availableImages),z=M.evaluate({zoom:f+1},c,{},_.availableImages);R=R&&R.name?R.name:R,D=D&&D.name?D.name:D,z=z&&z.name?z.name:z,w[R]=!0,w[D]=!0,w[z]=!0,c.patterns[E.id]={min:R,mid:D,max:z}}}return c}function Dh(u,o,c,f,_){let w;if(_===(function(E,M,R,D){let z=0;for(let V=M,Z=R-D;V<R;V+=D)z+=(E[Z]-E[V])*(E[V+1]+E[Z+1]),Z=V;return z})(u,o,c,f)>0)for(let E=o;E<c;E+=f)w=op(E/f|0,u[E],u[E+1],w);else for(let E=c-f;E>=o;E-=f)w=op(E/f|0,u[E],u[E+1],w);return w&&Nh(w,w.next)&&(ju(w),w=w.next),w}function pl(u,o){if(!u)return u;o||(o=u);let c,f=u;do if(c=!1,f.steiner||!Nh(f,f.next)&&ti(f.prev,f,f.next)!==0)f=f.next;else{if(ju(f),f=o=f.prev,f===f.next)break;c=!0}while(c||f!==o);return o}function Uu(u,o,c,f,_,w,E){if(!u)return;!E&&w&&(function(R,D,z,V){let Z=R;do Z.z===0&&(Z.z=fl(Z.x,Z.y,D,z,V)),Z.prevZ=Z.prev,Z.nextZ=Z.next,Z=Z.next;while(Z!==R);Z.prevZ.nextZ=null,Z.prevZ=null,(function(X){let Y,re=1;do{let he,ye=X;X=null;let Ne=null;for(Y=0;ye;){Y++;let Ee=ye,Me=0;for(let st=0;st<re&&(Me++,Ee=Ee.nextZ,Ee);st++);let Xe=re;for(;Me>0||Xe>0&&Ee;)Me!==0&&(Xe===0||!Ee||ye.z<=Ee.z)?(he=ye,ye=ye.nextZ,Me--):(he=Ee,Ee=Ee.nextZ,Xe--),Ne?Ne.nextZ=he:X=he,he.prevZ=Ne,Ne=he;ye=Ee}Ne.nextZ=null,re*=2}while(Y>1)})(Z)})(u,f,_,w);let M=u;for(;u.prev!==u.next;){const R=u.prev,D=u.next;if(w?ey(u,f,_,w):Q_(u))o.push(R.i,u.i,D.i),ju(u),u=D.next,M=D.next;else if((u=D)===M){E?E===1?Uu(u=ty(pl(u),o),o,c,f,_,w,2):E===2&&ag(u,o,c,f,_,w):Uu(pl(u),o,c,f,_,w,1);break}}}function Q_(u){const o=u.prev,c=u,f=u.next;if(ti(o,c,f)>=0)return!1;const _=o.x,w=c.x,E=f.x,M=o.y,R=c.y,D=f.y,z=Math.min(_,w,E),V=Math.min(M,R,D),Z=Math.max(_,w,E),X=Math.max(M,R,D);let Y=f.next;for(;Y!==o;){if(Y.x>=z&&Y.x<=Z&&Y.y>=V&&Y.y<=X&&Zs(_,M,w,R,E,D,Y.x,Y.y)&&ti(Y.prev,Y,Y.next)>=0)return!1;Y=Y.next}return!0}function ey(u,o,c,f){const _=u.prev,w=u,E=u.next;if(ti(_,w,E)>=0)return!1;const M=_.x,R=w.x,D=E.x,z=_.y,V=w.y,Z=E.y,X=Math.min(M,R,D),Y=Math.min(z,V,Z),re=Math.max(M,R,D),he=Math.max(z,V,Z),ye=fl(X,Y,o,c,f),Ne=fl(re,he,o,c,f);let Ee=u.prevZ,Me=u.nextZ;for(;Ee&&Ee.z>=ye&&Me&&Me.z<=Ne;){if(Ee.x>=X&&Ee.x<=re&&Ee.y>=Y&&Ee.y<=he&&Ee!==_&&Ee!==E&&Zs(M,z,R,V,D,Z,Ee.x,Ee.y)&&ti(Ee.prev,Ee,Ee.next)>=0||(Ee=Ee.prevZ,Me.x>=X&&Me.x<=re&&Me.y>=Y&&Me.y<=he&&Me!==_&&Me!==E&&Zs(M,z,R,V,D,Z,Me.x,Me.y)&&ti(Me.prev,Me,Me.next)>=0))return!1;Me=Me.nextZ}for(;Ee&&Ee.z>=ye;){if(Ee.x>=X&&Ee.x<=re&&Ee.y>=Y&&Ee.y<=he&&Ee!==_&&Ee!==E&&Zs(M,z,R,V,D,Z,Ee.x,Ee.y)&&ti(Ee.prev,Ee,Ee.next)>=0)return!1;Ee=Ee.prevZ}for(;Me&&Me.z<=Ne;){if(Me.x>=X&&Me.x<=re&&Me.y>=Y&&Me.y<=he&&Me!==_&&Me!==E&&Zs(M,z,R,V,D,Z,Me.x,Me.y)&&ti(Me.prev,Me,Me.next)>=0)return!1;Me=Me.nextZ}return!0}function ty(u,o){let c=u;do{const f=c.prev,_=c.next.next;!Nh(f,_)&&ug(f,c,c.next,_)&&Oh(f,_)&&Oh(_,f)&&(o.push(f.i,c.i,_.i),ju(c),ju(c.next),c=u=_),c=c.next}while(c!==u);return pl(c)}function ag(u,o,c,f,_,w){let E=u;do{let M=E.next.next;for(;M!==E.prev;){if(E.i!==M.i&&iy(E,M)){let R=ny(E,M);return E=pl(E,E.next),R=pl(R,R.next),Uu(E,o,c,f,_,w,0),void Uu(R,o,c,f,_,w,0)}M=M.next}E=E.next}while(E!==u)}function lg(u,o){let c=u.x-o.x;return c===0&&(c=u.y-o.y,c===0)&&(c=(u.next.y-u.y)/(u.next.x-u.x)-(o.next.y-o.y)/(o.next.x-o.x)),c}function ps(u,o){const c=(function(_,w){let E=w;const M=_.x,R=_.y;let D,z=-1/0;if(Nh(_,E))return E;do{if(Nh(_,E.next))return E.next;if(R<=E.y&&R>=E.next.y&&E.next.y!==E.y){const re=E.x+(R-E.y)*(E.next.x-E.x)/(E.next.y-E.y);if(re<=M&&re>z&&(z=re,D=E.x<E.next.x?E:E.next,re===M))return D}E=E.next}while(E!==w);if(!D)return null;const V=D,Z=D.x,X=D.y;let Y=1/0;E=D;do{if(M>=E.x&&E.x>=Z&&M!==E.x&&cg(R<X?M:z,R,Z,X,R<X?z:M,R,E.x,E.y)){const re=Math.abs(R-E.y)/(M-E.x);Oh(E,_)&&(re<Y||re===Y&&(E.x>D.x||E.x===D.x&&Ba(D,E)))&&(D=E,Y=re)}E=E.next}while(E!==V);return D})(u,o);if(!c)return o;const f=ny(c,u);return pl(f,f.next),pl(c,c.next)}function Ba(u,o){return ti(u.prev,u,o.prev)<0&&ti(o.next,u,u.next)<0}function fl(u,o,c,f,_){return(u=1431655765&((u=858993459&((u=252645135&((u=16711935&((u=(u-c)*_|0)|u<<8))|u<<4))|u<<2))|u<<1))|(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=(o-f)*_|0)|o<<8))|o<<4))|o<<2))|o<<1))<<1}function ry(u){let o=u,c=u;do(o.x<c.x||o.x===c.x&&o.y<c.y)&&(c=o),o=o.next;while(o!==u);return c}function cg(u,o,c,f,_,w,E,M){return(_-E)*(o-M)>=(u-E)*(w-M)&&(u-E)*(f-M)>=(c-E)*(o-M)&&(c-E)*(w-M)>=(_-E)*(f-M)}function Zs(u,o,c,f,_,w,E,M){return!(u===E&&o===M)&&cg(u,o,c,f,_,w,E,M)}function iy(u,o){return u.next.i!==o.i&&u.prev.i!==o.i&&!(function(c,f){let _=c;do{if(_.i!==c.i&&_.next.i!==c.i&&_.i!==f.i&&_.next.i!==f.i&&ug(_,_.next,c,f))return!0;_=_.next}while(_!==c);return!1})(u,o)&&(Oh(u,o)&&Oh(o,u)&&(function(c,f){let _=c,w=!1;const E=(c.x+f.x)/2,M=(c.y+f.y)/2;do _.y>M!=_.next.y>M&&_.next.y!==_.y&&E<(_.next.x-_.x)*(M-_.y)/(_.next.y-_.y)+_.x&&(w=!w),_=_.next;while(_!==c);return w})(u,o)&&(ti(u.prev,u,o.prev)||ti(u,o.prev,o))||Nh(u,o)&&ti(u.prev,u,u.next)>0&&ti(o.prev,o,o.next)>0)}function ti(u,o,c){return(o.y-u.y)*(c.x-o.x)-(o.x-u.x)*(c.y-o.y)}function Nh(u,o){return u.x===o.x&&u.y===o.y}function ug(u,o,c,f){const _=sp(ti(u,o,c)),w=sp(ti(u,o,f)),E=sp(ti(c,f,u)),M=sp(ti(c,f,o));return _!==w&&E!==M||!(_!==0||!np(u,c,o))||!(w!==0||!np(u,f,o))||!(E!==0||!np(c,u,f))||!(M!==0||!np(c,o,f))}function np(u,o,c){return o.x<=Math.max(u.x,c.x)&&o.x>=Math.min(u.x,c.x)&&o.y<=Math.max(u.y,c.y)&&o.y>=Math.min(u.y,c.y)}function sp(u){return u>0?1:u<0?-1:0}function Oh(u,o){return ti(u.prev,u,u.next)<0?ti(u,o,u.next)>=0&&ti(u,u.prev,o)>=0:ti(u,o,u.prev)<0||ti(u,u.next,o)<0}function ny(u,o){const c=lo(u.i,u.x,u.y),f=lo(o.i,o.x,o.y),_=u.next,w=o.prev;return u.next=o,o.prev=u,c.next=_,_.prev=c,f.next=c,c.prev=f,w.next=f,f.prev=w,f}function op(u,o,c,f){const _=lo(u,o,c);return f?(_.next=f.next,_.prev=f,f.next.prev=_,f.next=_):(_.prev=_,_.next=_),_}function ju(u){u.next.prev=u.prev,u.prev.next=u.next,u.prevZ&&(u.prevZ.nextZ=u.nextZ),u.nextZ&&(u.nextZ.prevZ=u.prevZ)}function lo(u,o,c){return{i:u,x:o,y:c,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class Or{constructor(o,c){if(c>o)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=o,this._minGranularity=c}getGranularityForZoomLevel(o){return Math.max(Math.floor(this._baseZoomGranularity/(1<<o)),this._minGranularity,1)}}class fn{constructor(o){this.fill=o.fill,this.line=o.line,this.tile=o.tile,this.stencil=o.stencil,this.circle=o.circle}}fn.noSubdivision=new fn({fill:new Or(0,0),line:new Or(0,0),tile:new Or(0,0),stencil:new Or(0,0),circle:1}),Dt("SubdivisionGranularityExpression",Or),Dt("SubdivisionGranularitySetting",fn);const Ri=-32768,mn=32767;class Oo{constructor(o,c){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=o,this._granularityCellSize=wt/o,this._canonical=c}_getKey(o,c){return(o+=32768)<<16|c+32768}_vertexToIndex(o,c){if(o<-32768||c<-32768||o>32767||c>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");const f=0|Math.round(o),_=0|Math.round(c),w=this._getKey(f,_);if(this._vertexDictionary.has(w))return this._vertexDictionary.get(w);const E=this._vertexBuffer.length/2;return this._vertexDictionary.set(w,E),this._vertexBuffer.push(f,_),E}_subdivideTrianglesScanline(o){if(this._granularity<2)return(function(_,w){const E=[];for(let M=0;M<w.length;M+=3){const R=w[M],D=w[M+1],z=w[M+2],V=_[2*R],Z=_[2*R+1];(_[2*D]-V)*(_[2*z+1]-Z)-(_[2*D+1]-Z)*(_[2*z]-V)>0?(E.push(R),E.push(z),E.push(D)):(E.push(R),E.push(D),E.push(z))}return E})(this._vertexBuffer,o);const c=[],f=o.length;for(let _=0;_<f;_+=3){const w=[o[_+0],o[_+1],o[_+2]],E=[this._vertexBuffer[2*o[_+0]+0],this._vertexBuffer[2*o[_+0]+1],this._vertexBuffer[2*o[_+1]+0],this._vertexBuffer[2*o[_+1]+1],this._vertexBuffer[2*o[_+2]+0],this._vertexBuffer[2*o[_+2]+1]];let M=1/0,R=1/0,D=-1/0,z=-1/0;for(let re=0;re<3;re++){const he=E[2*re],ye=E[2*re+1];M=Math.min(M,he),D=Math.max(D,he),R=Math.min(R,ye),z=Math.max(z,ye)}if(M===D||R===z)continue;const V=Math.floor(M/this._granularityCellSize),Z=Math.ceil(D/this._granularityCellSize),X=Math.floor(R/this._granularityCellSize),Y=Math.ceil(z/this._granularityCellSize);if(V!==Z||X!==Y)for(let re=X;re<Y;re++){const he=this._scanlineGenerateVertexRingForCellRow(re,E,w);ap(this._vertexBuffer,he,c)}else c.push(...w)}return c}_scanlineGenerateVertexRingForCellRow(o,c,f){const _=o*this._granularityCellSize,w=_+this._granularityCellSize,E=[];for(let M=0;M<3;M++){const R=c[2*M],D=c[2*M+1],z=c[2*(M+1)%6],V=c[(2*(M+1)+1)%6],Z=c[2*(M+2)%6],X=c[(2*(M+2)+1)%6],Y=z-R,re=V-D,he=Y===0,ye=re===0,Ne=(_-D)/re,Ee=(w-D)/re,Me=Math.min(Ne,Ee),Xe=Math.max(Ne,Ee);if(!ye&&(Me>=1||Xe<=0)||ye&&(D<_||D>w)){V>=_&&V<=w&&E.push(f[(M+1)%3]);continue}!ye&&Me>0&&E.push(this._vertexToIndex(R+Y*Me,D+re*Me));const st=R+Y*Math.max(Me,0),ft=R+Y*Math.min(Xe,1);he||this._generateIntraEdgeVertices(E,R,D,z,V,st,ft),!ye&&Xe<1&&E.push(this._vertexToIndex(R+Y*Xe,D+re*Xe)),(ye||V>=_&&V<=w)&&E.push(f[(M+1)%3]),!ye&&(V<=_||V>=w)&&this._generateInterEdgeVertices(E,R,D,z,V,Z,X,ft,_,w)}return E}_generateIntraEdgeVertices(o,c,f,_,w,E,M){const R=_-c,D=w-f,z=D===0,V=z?Math.min(c,_):Math.min(E,M),Z=z?Math.max(c,_):Math.max(E,M),X=Math.floor(V/this._granularityCellSize)+1,Y=Math.ceil(Z/this._granularityCellSize)-1;if(z?c<_:E<M)for(let re=X;re<=Y;re++){const he=re*this._granularityCellSize;o.push(this._vertexToIndex(he,f+D*(he-c)/R))}else for(let re=Y;re>=X;re--){const he=re*this._granularityCellSize;o.push(this._vertexToIndex(he,f+D*(he-c)/R))}}_generateInterEdgeVertices(o,c,f,_,w,E,M,R,D,z){const V=w-f,Z=E-_,X=M-w,Y=(D-w)/X,re=(z-w)/X,he=Math.min(Y,re),ye=Math.max(Y,re),Ne=_+Z*he;let Ee=Math.floor(Math.min(Ne,R)/this._granularityCellSize)+1,Me=Math.ceil(Math.max(Ne,R)/this._granularityCellSize)-1,Xe=R<Ne;const st=X===0;if(st&&(M===D||M===z))return;if(st||he>=1||ye<=0){const It=f-M,At=E+(c-E)*Math.min((D-M)/It,(z-M)/It);Ee=Math.floor(Math.min(At,R)/this._granularityCellSize)+1,Me=Math.ceil(Math.max(At,R)/this._granularityCellSize)-1,Xe=R<At}const ft=V>0?z:D;if(Xe)for(let It=Ee;It<=Me;It++)o.push(this._vertexToIndex(It*this._granularityCellSize,ft));else for(let It=Me;It>=Ee;It--)o.push(this._vertexToIndex(It*this._granularityCellSize,ft))}_generateOutline(o){const c=[];for(const f of o){const _=Ii(f,this._granularity,!0),w=this._pointArrayToIndices(_),E=[];for(let M=1;M<w.length;M++)E.push(w[M-1]),E.push(w[M]);c.push(E)}return c}_handlePoles(o){let c=!1,f=!1;this._canonical&&(this._canonical.y===0&&(c=!0),this._canonical.y===(1<<this._canonical.z)-1&&(f=!0)),(c||f)&&this._fillPoles(o,c,f)}_ensureNoPoleVertices(){const o=this._vertexBuffer;for(let c=0;c<o.length;c+=2){const f=o[c+1];f===Ri&&(o[c+1]=-32767),f===mn&&(o[c+1]=32766)}}_generatePoleQuad(o,c,f,_,w,E){_>w!=(E===Ri)?(o.push(c),o.push(f),o.push(this._vertexToIndex(_,E)),o.push(f),o.push(this._vertexToIndex(w,E)),o.push(this._vertexToIndex(_,E))):(o.push(f),o.push(c),o.push(this._vertexToIndex(_,E)),o.push(this._vertexToIndex(w,E)),o.push(f),o.push(this._vertexToIndex(_,E)))}_fillPoles(o,c,f){const _=this._vertexBuffer,w=wt,E=o.length;for(let M=2;M<E;M+=3){const R=o[M-2],D=o[M-1],z=o[M],V=_[2*R],Z=_[2*R+1],X=_[2*D],Y=_[2*D+1],re=_[2*z],he=_[2*z+1];c&&(Z===0&&Y===0&&this._generatePoleQuad(o,R,D,V,X,Ri),Y===0&&he===0&&this._generatePoleQuad(o,D,z,X,re,Ri),he===0&&Z===0&&this._generatePoleQuad(o,z,R,re,V,Ri)),f&&(Z===w&&Y===w&&this._generatePoleQuad(o,R,D,V,X,mn),Y===w&&he===w&&this._generatePoleQuad(o,D,z,X,re,mn),he===w&&Z===w&&this._generatePoleQuad(o,z,R,re,V,mn))}}_initializeVertices(o){for(let c=0;c<o.length;c+=2)this._vertexToIndex(o[c],o[c+1])}subdividePolygonInternal(o,c){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;const{flattened:f,holeIndices:_}=(function(M){const R=[],D=[];for(const z of M)if(z.length!==0){z!==M[0]&&R.push(D.length/2);for(let V=0;V<z.length;V++)D.push(z[V].x),D.push(z[V].y)}return{flattened:D,holeIndices:R}})(o);let w;this._initializeVertices(f);try{const M=(function(D,z,V=2){const Z=z&&z.length,X=Z?z[0]*V:D.length;let Y=Dh(D,0,X,V,!0);const re=[];if(!Y||Y.next===Y.prev)return re;let he,ye,Ne;if(Z&&(Y=(function(Ee,Me,Xe,st){const ft=[];for(let It=0,At=Me.length;It<At;It++){const Pt=Dh(Ee,Me[It]*st,It<At-1?Me[It+1]*st:Ee.length,st,!1);Pt===Pt.next&&(Pt.steiner=!0),ft.push(ry(Pt))}ft.sort(lg);for(let It=0;It<ft.length;It++)Xe=ps(ft[It],Xe);return Xe})(D,z,Y,V)),D.length>80*V){he=D[0],ye=D[1];let Ee=he,Me=ye;for(let Xe=V;Xe<X;Xe+=V){const st=D[Xe],ft=D[Xe+1];st<he&&(he=st),ft<ye&&(ye=ft),st>Ee&&(Ee=st),ft>Me&&(Me=ft)}Ne=Math.max(Ee-he,Me-ye),Ne=Ne!==0?32767/Ne:0}return Uu(Y,re,V,he,ye,Ne,0),re})(f,_),R=this._convertIndices(f,M);w=this._subdivideTrianglesScanline(R)}catch(M){console.error(M)}let E=[];return c&&(E=this._generateOutline(o)),this._ensureNoPoleVertices(),this._handlePoles(w),{verticesFlattened:this._vertexBuffer,indicesTriangles:w,indicesLineList:E}}_convertIndices(o,c){const f=[];for(let _=0;_<c.length;_++)f.push(this._vertexToIndex(o[2*c[_]],o[2*c[_]+1]));return f}_pointArrayToIndices(o){const c=[];for(let f=0;f<o.length;f++){const _=o[f];c.push(this._vertexToIndex(_.x,_.y))}return c}}function Vu(u,o,c,f=!0){return new Oo(c,o).subdividePolygonInternal(u,f)}function Ii(u,o,c=!1){if(!u||u.length<1)return[];if(u.length<2)return[];const f=u[0],_=u[u.length-1],w=c&&(f.x!==_.x||f.y!==_.y);if(o<2)return w?[...u,u[0]]:[...u];const E=Math.floor(wt/o),M=[];M.push(new v(u[0].x,u[0].y));const R=u.length,D=w?R:R-1;for(let z=0;z<D;z++){const V=u[z],Z=z<R-1?u[z+1]:u[0],X=V.x,Y=V.y,re=Z.x,he=Z.y,ye=X!==re,Ne=Y!==he;if(!ye&&!Ne)continue;const Ee=re-X,Me=he-Y,Xe=Math.abs(Ee),st=Math.abs(Me);let ft=X,It=Y;for(;;){const Pt=Ee>0?(Math.floor(ft/E)+1)*E:(Math.ceil(ft/E)-1)*E,Yt=Me>0?(Math.floor(It/E)+1)*E:(Math.ceil(It/E)-1)*E,St=Math.abs(ft-Pt),Rt=Math.abs(It-Yt),ct=Math.abs(ft-re),ur=Math.abs(It-he),vr=ye?St/Xe:Number.POSITIVE_INFINITY,sr=Ne?Rt/st:Number.POSITIVE_INFINITY;if((ct<=St||!ye)&&(ur<=Rt||!Ne))break;if(vr<sr&&ye||!Ne){ft=Pt,It+=Me*vr;const Vt=new v(ft,Math.round(It));M[M.length-1].x===Vt.x&&M[M.length-1].y===Vt.y||M.push(Vt)}else{ft+=Ee*sr,It=Yt;const Vt=new v(Math.round(ft),It);M[M.length-1].x===Vt.x&&M[M.length-1].y===Vt.y||M.push(Vt)}}const At=new v(re,he);M[M.length-1].x===At.x&&M[M.length-1].y===At.y||M.push(At)}return M}function ap(u,o,c){if(o.length===0)throw new Error("Subdivision vertex ring is empty.");let f=0,_=u[2*o[0]];for(let R=1;R<o.length;R++){const D=u[2*o[R]];D<_&&(_=D,f=R)}const w=o.length;let E=f,M=(E+1)%w;for(;;){const R=E-1>=0?E-1:w-1,D=(M+1)%w,z=u[2*o[R]],V=u[2*o[D]],Z=u[2*o[E]],X=u[2*o[E]+1],Y=u[2*o[M]+1];let re=!1;if(z<V)re=!0;else if(z>V)re=!1;else{const he=Y-X,ye=-(u[2*o[M]]-Z),Ne=X<Y?1:-1;((z-Z)*he+(u[2*o[R]+1]-X)*ye)*Ne>((V-Z)*he+(u[2*o[D]+1]-X)*ye)*Ne&&(re=!0)}if(re){const he=o[R],ye=o[E],Ne=o[M];he!==ye&&he!==Ne&&ye!==Ne&&c.push(Ne,ye,he),E--,E<0&&(E=w-1)}else{const he=o[D],ye=o[E],Ne=o[M];he!==ye&&he!==Ne&&ye!==Ne&&c.push(Ne,ye,he),M++,M>=w&&(M=0)}if(R===D)break}}function Hc(u,o,c,f,_,w,E,M,R){const D=_.length/2,z=E&&M&&R;if(D<yr.MAX_VERTEX_ARRAY_LENGTH){const V=o.prepareSegment(D,c,f),Z=V.vertexLength;for(let re=0;re<w.length;re+=3)f.emplaceBack(Z+w[re],Z+w[re+1],Z+w[re+2]);let X,Y;V.vertexLength+=D,V.primitiveLength+=w.length/3,z&&(Y=E.prepareSegment(D,c,M),X=Y.vertexLength,Y.vertexLength+=D);for(let re=0;re<_.length;re+=2)u(_[re],_[re+1]);if(z)for(let re=0;re<R.length;re++){const he=R[re];for(let ye=1;ye<he.length;ye+=2)M.emplaceBack(X+he[ye-1],X+he[ye]);Y.primitiveLength+=he.length/2}}else(function(V,Z,X,Y,re,he){const ye=[];for(let st=0;st<Y.length/2;st++)ye.push(-1);const Ne={count:0};let Ee=0,Me=V.getOrCreateLatestSegment(Z,X),Xe=Me.vertexLength;for(let st=2;st<re.length;st+=3){const ft=re[st-2],It=re[st-1],At=re[st];let Pt=ye[ft]<Ee,Yt=ye[It]<Ee,St=ye[At]<Ee;Me.vertexLength+((Pt?1:0)+(Yt?1:0)+(St?1:0))>yr.MAX_VERTEX_ARRAY_LENGTH&&(Me=V.createNewSegment(Z,X),Ee=Ne.count,Pt=!0,Yt=!0,St=!0,Xe=0);const Rt=Wc(ye,Y,he,Ne,ft,Pt,Me),ct=Wc(ye,Y,he,Ne,It,Yt,Me),ur=Wc(ye,Y,he,Ne,At,St,Me);X.emplaceBack(Xe+Rt-Ee,Xe+ct-Ee,Xe+ur-Ee),Me.primitiveLength++}})(o,c,f,_,w,u),z&&(function(V,Z,X,Y,re,he){const ye=[];for(let st=0;st<Y.length/2;st++)ye.push(-1);const Ne={count:0};let Ee=0,Me=V.getOrCreateLatestSegment(Z,X),Xe=Me.vertexLength;for(let st=0;st<re.length;st++){const ft=re[st];for(let It=1;It<re[st].length;It+=2){const At=ft[It-1],Pt=ft[It];let Yt=ye[At]<Ee,St=ye[Pt]<Ee;Me.vertexLength+((Yt?1:0)+(St?1:0))>yr.MAX_VERTEX_ARRAY_LENGTH&&(Me=V.createNewSegment(Z,X),Ee=Ne.count,Yt=!0,St=!0,Xe=0);const Rt=Wc(ye,Y,he,Ne,At,Yt,Me),ct=Wc(ye,Y,he,Ne,Pt,St,Me);X.emplaceBack(Xe+Rt-Ee,Xe+ct-Ee),Me.primitiveLength++}}})(E,c,M,_,R,u),o.forceNewSegmentOnNextPrepare(),E?.forceNewSegmentOnNextPrepare()}function Wc(u,o,c,f,_,w,E){if(w){const M=f.count;return c(o[2*_],o[2*_+1]),u[_]=f.count,f.count++,E.vertexLength++,M}return u[_]}class lp{constructor(o){this.zoom=o.zoom,this.globalState=o.globalState,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map((c=>c.id)),this.index=o.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new $e,this.indexArray=new ei,this.indexArray2=new Xr,this.programConfigurations=new Ps(o.layers,o.zoom),this.segments=new yr,this.segments2=new yr,this.stateDependentLayerIds=this.layers.filter((c=>c.isStateDependent())).map((c=>c.id))}populate(o,c,f){this.hasPattern=pf("fill",this.layers,c);const _=this.layers[0].layout.get("fill-sort-key"),w=!_.isConstant(),E=[];for(const{feature:M,id:R,index:D,sourceLayerIndex:z}of o){const V=this.layers[0]._featureFilter.needGeometry,Z=ka(M,V);if(!this.layers[0]._featureFilter.filter(new Qr(this.zoom,{globalState:this.globalState}),Z,f))continue;const X=w?_.evaluate(Z,{},f,c.availableImages):void 0,Y={id:R,properties:M.properties,type:M.type,sourceLayerIndex:z,index:D,geometry:V?Z.geometry:ta(M),patterns:{},sortKey:X};E.push(Y)}w&&E.sort(((M,R)=>M.sortKey-R.sortKey));for(const M of E){const{geometry:R,index:D,sourceLayerIndex:z}=M;if(this.hasPattern){const V=og("fill",this.layers,M,this.zoom,c);this.patternFeatures.push(V)}else this.addFeature(M,R,D,f,{},c.subdivisionGranularity);c.featureIndex.insert(o[D].feature,R,D,z,this.index)}}update(o,c,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,c,this.stateDependentLayers,f)}addFeatures(o,c,f){for(const _ of this.patternFeatures)this.addFeature(_,_.geometry,_.index,c,f,o.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,sg),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.indexBuffer2=o.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(o,c,f,_,w,E){for(const M of Ac(c,500)){const R=Vu(M,_,E.fill.getGranularityForZoomLevel(_.z)),D=this.layoutVertexArray;Hc(((z,V)=>{D.emplaceBack(z,V)}),this.segments,this.layoutVertexArray,this.indexArray,R.verticesFlattened,R.indicesTriangles,this.segments2,this.indexArray2,R.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,f,w,_)}}let Fh,Xs;Dt("FillBucket",lp,{omit:["layers","patternFeatures"]});var hg={get paint(){return Xs=Xs||new Bn({"fill-antialias":new zt(Le.paint_fill["fill-antialias"]),"fill-opacity":new tr(Le.paint_fill["fill-opacity"]),"fill-color":new tr(Le.paint_fill["fill-color"]),"fill-outline-color":new tr(Le.paint_fill["fill-outline-color"]),"fill-translate":new zt(Le.paint_fill["fill-translate"]),"fill-translate-anchor":new zt(Le.paint_fill["fill-translate-anchor"]),"fill-pattern":new Ma(Le.paint_fill["fill-pattern"])})},get layout(){return Fh=Fh||new Bn({"fill-sort-key":new tr(Le.layout_fill["fill-sort-key"])})}};class zh extends Ln{constructor(o){super(o,hg)}recalculate(o,c){super.recalculate(o,c);const f=this.paint._values["fill-outline-color"];f.value.kind==="constant"&&f.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(o){return new lp(o)}queryRadius(){return Ih(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:o,geometry:c,transform:f,pixelsToTileUnits:_}){return W_(Qd(o,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-f.bearingInRadians,_),c)}isTileClipped(){return!0}}const Wl=Pi([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),ff=Pi([{name:"a_centroid",components:2,type:"Int16"}],4),{members:dg}=Wl;class Fo{constructor(o,c,f,_,w){this.properties={},this.extent=f,this.type=0,this.id=void 0,this._pbf=o,this._geometry=-1,this._keys=_,this._values=w,o.readFields(mf,this,c)}loadGeometry(){const o=this._pbf;o.pos=this._geometry;const c=o.readVarint()+o.pos,f=[];let _,w=1,E=0,M=0,R=0;for(;o.pos<c;){if(E<=0){const D=o.readVarint();w=7&D,E=D>>3}if(E--,w===1||w===2)M+=o.readSVarint(),R+=o.readSVarint(),w===1&&(_&&f.push(_),_=[]),_&&_.push(new v(M,R));else{if(w!==7)throw new Error(`unknown command ${w}`);_&&_.push(_[0].clone())}}return _&&f.push(_),f}bbox(){const o=this._pbf;o.pos=this._geometry;const c=o.readVarint()+o.pos;let f=1,_=0,w=0,E=0,M=1/0,R=-1/0,D=1/0,z=-1/0;for(;o.pos<c;){if(_<=0){const V=o.readVarint();f=7&V,_=V>>3}if(_--,f===1||f===2)w+=o.readSVarint(),E+=o.readSVarint(),w<M&&(M=w),w>R&&(R=w),E<D&&(D=E),E>z&&(z=E);else if(f!==7)throw new Error(`unknown command ${f}`)}return[M,D,R,z]}toGeoJSON(o,c,f){const _=this.extent*Math.pow(2,f),w=this.extent*o,E=this.extent*c,M=this.loadGeometry();function R(Z){return[360*(Z.x+w)/_-180,360/Math.PI*Math.atan(Math.exp((1-2*(Z.y+E)/_)*Math.PI))-90]}function D(Z){return Z.map(R)}let z;if(this.type===1){const Z=[];for(const Y of M)Z.push(Y[0]);const X=D(Z);z=Z.length===1?{type:"Point",coordinates:X[0]}:{type:"MultiPoint",coordinates:X}}else if(this.type===2){const Z=M.map(D);z=Z.length===1?{type:"LineString",coordinates:Z[0]}:{type:"MultiLineString",coordinates:Z}}else{if(this.type!==3)throw new Error("unknown feature type");{const Z=(function(Y){const re=Y.length;if(re<=1)return[Y];const he=[];let ye,Ne;for(let Ee=0;Ee<re;Ee++){const Me=qc(Y[Ee]);Me!==0&&(Ne===void 0&&(Ne=Me<0),Ne===Me<0?(ye&&he.push(ye),ye=[Y[Ee]]):ye&&ye.push(Y[Ee]))}return ye&&he.push(ye),he})(M),X=[];for(const Y of Z)X.push(Y.map(D));z=X.length===1?{type:"Polygon",coordinates:X[0]}:{type:"MultiPolygon",coordinates:X}}}const V={type:"Feature",geometry:z,properties:this.properties};return this.id!=null&&(V.id=this.id),V}}function mf(u,o,c){u===1?o.id=c.readVarint():u===2?(function(f,_){const w=f.readVarint()+f.pos;for(;f.pos<w;){const E=_._keys[f.readVarint()],M=_._values[f.readVarint()];_.properties[E]=M}})(c,o):u===3?o.type=c.readVarint():u===4&&(o._geometry=c.pos)}function qc(u){let o=0;for(let c,f,_=0,w=u.length,E=w-1;_<w;E=_++)c=u[_],f=u[E],o+=(f.x-c.x)*(c.y+f.y);return o}Fo.types=["Unknown","Point","LineString","Polygon"];class cp{constructor(o,c){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=o,this._keys=[],this._values=[],this._features=[],o.readFields(up,this,c),this.length=this._features.length}feature(o){if(o<0||o>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[o];const c=this._pbf.readVarint()+this._pbf.pos;return new Fo(this._pbf,c,this.extent,this._keys,this._values)}}function up(u,o,c){u===15?o.version=c.readVarint():u===1?o.name=c.readString():u===5?o.extent=c.readVarint():u===2?o._features.push(c.pos):u===3?o._keys.push(c.readString()):u===4&&o._values.push((function(f){let _=null;const w=f.readVarint()+f.pos;for(;f.pos<w;){const E=f.readVarint()>>3;_=E===1?f.readString():E===2?f.readFloat():E===3?f.readDouble():E===4?f.readVarint64():E===5?f.readVarint():E===6?f.readSVarint():E===7?f.readBoolean():null}if(_==null)throw new Error("unknown feature value");return _})(c))}class gf{constructor(o,c){this.layers=o.readFields(_f,{},c)}}function _f(u,o,c){if(u===3){const f=new cp(c,c.readVarint()+c.pos);f.length&&(o[f.name]=f)}}const Uh=Math.pow(2,13);function Dn(u,o,c,f,_,w,E,M){u.emplaceBack(o,c,2*Math.floor(f*Uh)+E,_*Uh*2,w*Uh*2,Math.round(M))}class ml{constructor(o){this.zoom=o.zoom,this.globalState=o.globalState,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map((c=>c.id)),this.index=o.index,this.hasPattern=!1,this.layoutVertexArray=new We,this.centroidVertexArray=new ve,this.indexArray=new ei,this.programConfigurations=new Ps(o.layers,o.zoom),this.segments=new yr,this.stateDependentLayerIds=this.layers.filter((c=>c.isStateDependent())).map((c=>c.id))}populate(o,c,f){this.features=[],this.hasPattern=pf("fill-extrusion",this.layers,c);for(const{feature:_,id:w,index:E,sourceLayerIndex:M}of o){const R=this.layers[0]._featureFilter.needGeometry,D=ka(_,R);if(!this.layers[0]._featureFilter.filter(new Qr(this.zoom,{globalState:this.globalState}),D,f))continue;const z={id:w,sourceLayerIndex:M,index:E,geometry:R?D.geometry:ta(_),properties:_.properties,type:_.type,patterns:{}};this.hasPattern?this.features.push(og("fill-extrusion",this.layers,z,this.zoom,c)):this.addFeature(z,z.geometry,E,f,{},c.subdivisionGranularity),c.featureIndex.insert(_,z.geometry,E,M,this.index,!0)}}addFeatures(o,c,f){for(const _ of this.features){const{geometry:w}=_;this.addFeature(_,w,_.index,c,f,o.subdivisionGranularity)}}update(o,c,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,c,this.stateDependentLayers,f)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,dg),this.centroidVertexBuffer=o.createVertexBuffer(this.centroidVertexArray,ff.members,!0),this.indexBuffer=o.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(o,c,f,_,w,E){for(const M of Ac(c,500)){const R={x:0,y:0,sampleCount:0},D=this.layoutVertexArray.length;this.processPolygon(R,_,o,M,E);const z=this.layoutVertexArray.length-D,V=Math.floor(R.x/R.sampleCount),Z=Math.floor(R.y/R.sampleCount);for(let X=0;X<z;X++)this.centroidVertexArray.emplaceBack(V,Z)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,f,w,_)}processPolygon(o,c,f,_,w){if(_.length<1||pg(_[0]))return;for(const V of _)V.length!==0&&La(o,V);const E={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},M=w.fill.getGranularityForZoomLevel(c.z),R=Fo.types[f.type]==="Polygon";for(const V of _){if(V.length===0||pg(V))continue;const Z=Ii(V,M,R);this._generateSideFaces(Z,E)}if(!R)return;const D=Vu(_,c,M,!1),z=this.layoutVertexArray;Hc(((V,Z)=>{Dn(z,V,Z,0,0,1,1,0)}),this.segments,this.layoutVertexArray,this.indexArray,D.verticesFlattened,D.indicesTriangles)}_generateSideFaces(o,c){let f=0;for(let _=1;_<o.length;_++){const w=o[_],E=o[_-1];if(co(w,E))continue;c.segment.vertexLength+4>yr.MAX_VERTEX_ARRAY_LENGTH&&(c.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const M=w.sub(E)._perp()._unit(),R=E.dist(w);f+R>32768&&(f=0),Dn(this.layoutVertexArray,w.x,w.y,M.x,M.y,0,0,f),Dn(this.layoutVertexArray,w.x,w.y,M.x,M.y,0,1,f),f+=R,Dn(this.layoutVertexArray,E.x,E.y,M.x,M.y,0,0,f),Dn(this.layoutVertexArray,E.x,E.y,M.x,M.y,0,1,f);const D=c.segment.vertexLength;this.indexArray.emplaceBack(D,D+2,D+1),this.indexArray.emplaceBack(D+1,D+2,D+3),c.segment.vertexLength+=4,c.segment.primitiveLength+=2}}}function La(u,o){for(let c=0;c<o.length;c++){const f=o[c];c===o.length-1&&o[0].x===f.x&&o[0].y===f.y||(u.x+=f.x,u.y+=f.y,u.sampleCount++)}}function co(u,o){return u.x===o.x&&(u.x<0||u.x>wt)||u.y===o.y&&(u.y<0||u.y>wt)}function pg(u){return u.every((o=>o.x<0))||u.every((o=>o.x>wt))||u.every((o=>o.y<0))||u.every((o=>o.y>wt))}let yf;Dt("FillExtrusionBucket",ml,{omit:["layers","features"]});var fg={get paint(){return yf=yf||new Bn({"fill-extrusion-opacity":new zt(Le["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new tr(Le["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new zt(Le["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new zt(Le["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Ma(Le["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new tr(Le["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new tr(Le["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new zt(Le["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class V1 extends Ln{constructor(o){super(o,fg)}createBucket(o){return new ml(o)}queryRadius(){return Ih(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:o,feature:c,featureState:f,geometry:_,transform:w,pixelsToTileUnits:E,pixelPosMatrix:M}){const R=Qd(o,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-w.bearingInRadians,E),D=this.paint.get("fill-extrusion-height").evaluate(c,f),z=this.paint.get("fill-extrusion-base").evaluate(c,f),V=(function(X,Y){const re=[];for(const he of X){const ye=[he.x,he.y,0,1];Lt(ye,ye,Y),re.push(new v(ye[0]/ye[3],ye[1]/ye[3]))}return re})(R,M),Z=(function(X,Y,re,he){const ye=[],Ne=[],Ee=he[8]*Y,Me=he[9]*Y,Xe=he[10]*Y,st=he[11]*Y,ft=he[8]*re,It=he[9]*re,At=he[10]*re,Pt=he[11]*re;for(const Yt of X){const St=[],Rt=[];for(const ct of Yt){const ur=ct.x,vr=ct.y,sr=he[0]*ur+he[4]*vr+he[12],Vt=he[1]*ur+he[5]*vr+he[13],Nr=he[2]*ur+he[6]*vr+he[14],Ki=he[3]*ur+he[7]*vr+he[15],On=Nr+Xe,ks=Ki+st,Na=sr+ft,Uo=Vt+It,fs=Nr+At,ji=Ki+Pt,Hn=new v((sr+Ee)/ks,(Vt+Me)/ks);Hn.z=On/ks,St.push(Hn);const ms=new v(Na/ji,Uo/ji);ms.z=fs/ji,Rt.push(ms)}ye.push(St),Ne.push(Rt)}return[ye,Ne]})(_,z,D,M);return(function(X,Y,re){let he=1/0;W_(re,Y)&&(he=mg(re,Y[0]));for(let ye=0;ye<Y.length;ye++){const Ne=Y[ye],Ee=X[ye];for(let Me=0;Me<Ne.length-1;Me++){const Xe=Ne[Me],st=[Xe,Ne[Me+1],Ee[Me+1],Ee[Me],Xe];Km(re,st)&&(he=Math.min(he,mg(re,st)))}}return he!==1/0&&he})(Z[0],Z[1],V)}}function ra(u,o){return u.x*o.x+u.y*o.y}function mg(u,o){if(u.length===1){let c=0;const f=o[c++];let _;for(;!_||f.equals(_);)if(_=o[c++],!_)return 1/0;for(;c<o.length;c++){const w=o[c],E=u[0],M=_.sub(f),R=w.sub(f),D=E.sub(f),z=ra(M,M),V=ra(M,R),Z=ra(R,R),X=ra(D,M),Y=ra(D,R),re=z*Z-V*V,he=(Z*X-V*Y)/re,ye=(z*Y-V*X)/re,Ne=f.z*(1-he-ye)+_.z*he+w.z*ye;if(isFinite(Ne))return Ne}return 1/0}{let c=1/0;for(const f of o)c=Math.min(c,f.z);return c}}const gg=Pi([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Gu}=gg,_g=Pi([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:Hu}=_g,sy=Math.cos(Math.PI/180*37.5),yg=Math.pow(2,14)/.5;class hp{constructor(o){this.zoom=o.zoom,this.globalState=o.globalState,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map((c=>c.id)),this.index=o.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((c=>{this.gradients[c.id]={}})),this.layoutVertexArray=new qe,this.layoutVertexArray2=new Qe,this.indexArray=new ei,this.programConfigurations=new Ps(o.layers,o.zoom),this.segments=new yr,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((c=>c.isStateDependent())).map((c=>c.id))}populate(o,c,f){this.hasPattern=pf("line",this.layers,c);const _=this.layers[0].layout.get("line-sort-key"),w=!_.isConstant(),E=[];for(const{feature:M,id:R,index:D,sourceLayerIndex:z}of o){const V=this.layers[0]._featureFilter.needGeometry,Z=ka(M,V);if(!this.layers[0]._featureFilter.filter(new Qr(this.zoom,{globalState:this.globalState}),Z,f))continue;const X=w?_.evaluate(Z,{},f):void 0,Y={id:R,properties:M.properties,type:M.type,sourceLayerIndex:z,index:D,geometry:V?Z.geometry:ta(M),patterns:{},sortKey:X};E.push(Y)}w&&E.sort(((M,R)=>M.sortKey-R.sortKey));for(const M of E){const{geometry:R,index:D,sourceLayerIndex:z}=M;if(this.hasPattern){const V=og("line",this.layers,M,this.zoom,c);this.patternFeatures.push(V)}else this.addFeature(M,R,D,f,{},c.subdivisionGranularity);c.featureIndex.insert(o[D].feature,R,D,z,this.index)}}update(o,c,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,c,this.stateDependentLayers,f)}addFeatures(o,c,f){for(const _ of this.patternFeatures)this.addFeature(_,_.geometry,_.index,c,f,o.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=o.createVertexBuffer(this.layoutVertexArray2,Hu)),this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,Gu),this.indexBuffer=o.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(o){if(o.properties&&Object.prototype.hasOwnProperty.call(o.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(o.properties,"mapbox_clip_end"))return{start:+o.properties.mapbox_clip_start,end:+o.properties.mapbox_clip_end}}addFeature(o,c,f,_,w,E){const M=this.layers[0].layout,R=M.get("line-join").evaluate(o,{}),D=M.get("line-cap"),z=M.get("line-miter-limit"),V=M.get("line-round-limit");this.lineClips=this.lineFeatureClips(o);for(const Z of c)this.addLine(Z,o,R,D,z,V,_,E);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,f,w,_)}addLine(o,c,f,_,w,E,M,R){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,o=Ii(o,M?R.line.getGranularityForZoomLevel(M.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Ee=0;Ee<o.length-1;Ee++)this.totalDistance+=o[Ee].dist(o[Ee+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const D=Fo.types[c.type]==="Polygon";let z=o.length;for(;z>=2&&o[z-1].equals(o[z-2]);)z--;let V=0;for(;V<z-1&&o[V].equals(o[V+1]);)V++;if(z<(D?3:2))return;f==="bevel"&&(w=1.05);const Z=this.overscaling<=16?122880/(512*this.overscaling):0,X=this.segments.prepareSegment(10*z,this.layoutVertexArray,this.indexArray);let Y,re,he,ye,Ne;this.e1=this.e2=-1,D&&(Y=o[z-2],Ne=o[V].sub(Y)._unit()._perp());for(let Ee=V;Ee<z;Ee++){if(he=Ee===z-1?D?o[V+1]:void 0:o[Ee+1],he&&o[Ee].equals(he))continue;Ne&&(ye=Ne),Y&&(re=Y),Y=o[Ee],Ne=he?he.sub(Y)._unit()._perp():ye,ye=ye||Ne;let Me=ye.add(Ne);Me.x===0&&Me.y===0||Me._unit();const Xe=ye.x*Ne.x+ye.y*Ne.y,st=Me.x*Ne.x+Me.y*Ne.y,ft=st!==0?1/st:1/0,It=2*Math.sqrt(2-2*st),At=st<sy&&re&&he,Pt=ye.x*Ne.y-ye.y*Ne.x>0;if(At&&Ee>V){const Rt=Y.dist(re);if(Rt>2*Z){const ct=Y.sub(Y.sub(re)._mult(Z/Rt)._round());this.updateDistance(re,ct),this.addCurrentVertex(ct,ye,0,0,X),re=ct}}const Yt=re&&he;let St=Yt?f:D?"butt":_;if(Yt&&St==="round"&&(ft<E?St="miter":ft<=2&&(St="fakeround")),St==="miter"&&ft>w&&(St="bevel"),St==="bevel"&&(ft>2&&(St="flipbevel"),ft<w&&(St="miter")),re&&this.updateDistance(re,Y),St==="miter")Me._mult(ft),this.addCurrentVertex(Y,Me,0,0,X);else if(St==="flipbevel"){if(ft>100)Me=Ne.mult(-1);else{const Rt=ft*ye.add(Ne).mag()/ye.sub(Ne).mag();Me._perp()._mult(Rt*(Pt?-1:1))}this.addCurrentVertex(Y,Me,0,0,X),this.addCurrentVertex(Y,Me.mult(-1),0,0,X)}else if(St==="bevel"||St==="fakeround"){const Rt=-Math.sqrt(ft*ft-1),ct=Pt?Rt:0,ur=Pt?0:Rt;if(re&&this.addCurrentVertex(Y,ye,ct,ur,X),St==="fakeround"){const vr=Math.round(180*It/Math.PI/20);for(let sr=1;sr<vr;sr++){let Vt=sr/vr;if(Vt!==.5){const Ki=Vt-.5;Vt+=Vt*Ki*(Vt-1)*((1.0904+Xe*(Xe*(3.55645-1.43519*Xe)-3.2452))*Ki*Ki+(.848013+Xe*(.215638*Xe-1.06021)))}const Nr=Ne.sub(ye)._mult(Vt)._add(ye)._unit()._mult(Pt?-1:1);this.addHalfVertex(Y,Nr.x,Nr.y,!1,Pt,0,X)}}he&&this.addCurrentVertex(Y,Ne,-ct,-ur,X)}else if(St==="butt")this.addCurrentVertex(Y,Me,0,0,X);else if(St==="square"){const Rt=re?1:-1;this.addCurrentVertex(Y,Me,Rt,Rt,X)}else St==="round"&&(re&&(this.addCurrentVertex(Y,ye,0,0,X),this.addCurrentVertex(Y,ye,1,1,X,!0)),he&&(this.addCurrentVertex(Y,Ne,-1,-1,X,!0),this.addCurrentVertex(Y,Ne,0,0,X)));if(At&&Ee<z-1){const Rt=Y.dist(he);if(Rt>2*Z){const ct=Y.add(he.sub(Y)._mult(Z/Rt)._round());this.updateDistance(Y,ct),this.addCurrentVertex(ct,Ne,0,0,X),Y=ct}}}}addCurrentVertex(o,c,f,_,w,E=!1){const M=c.y*_-c.x,R=-c.y-c.x*_;this.addHalfVertex(o,c.x+c.y*f,c.y-c.x*f,E,!1,f,w),this.addHalfVertex(o,M,R,E,!0,-_,w),this.distance>yg/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(o,c,f,_,w,E))}addHalfVertex({x:o,y:c},f,_,w,E,M,R){const D=.5*(this.lineClips?this.scaledDistance*(yg-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((o<<1)+(w?1:0),(c<<1)+(E?1:0),Math.round(63*f)+128,Math.round(63*_)+128,1+(M===0?0:M<0?-1:1)|(63&D)<<2,D>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const z=R.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,z,this.e2),R.primitiveLength++),E?this.e2=z:this.e1=z}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(o,c){this.distance+=o.dist(c),this.updateScaledDistance()}}let dp,oy;Dt("LineBucket",hp,{omit:["layers","patternFeatures"]});var ay={get paint(){return oy=oy||new Bn({"line-opacity":new tr(Le.paint_line["line-opacity"]),"line-color":new tr(Le.paint_line["line-color"]),"line-translate":new zt(Le.paint_line["line-translate"]),"line-translate-anchor":new zt(Le.paint_line["line-translate-anchor"]),"line-width":new tr(Le.paint_line["line-width"]),"line-gap-width":new tr(Le.paint_line["line-gap-width"]),"line-offset":new tr(Le.paint_line["line-offset"]),"line-blur":new tr(Le.paint_line["line-blur"]),"line-dasharray":new Jo(Le.paint_line["line-dasharray"]),"line-pattern":new Ma(Le.paint_line["line-pattern"]),"line-gradient":new jc(Le.paint_line["line-gradient"])})},get layout(){return dp=dp||new Bn({"line-cap":new zt(Le.layout_line["line-cap"]),"line-join":new tr(Le.layout_line["line-join"]),"line-miter-limit":new zt(Le.layout_line["line-miter-limit"]),"line-round-limit":new zt(Le.layout_line["line-round-limit"]),"line-sort-key":new tr(Le.layout_line["line-sort-key"])})}};class ly extends tr{possiblyEvaluate(o,c){return c=new Qr(Math.floor(c.zoom),{now:c.now,fadeDuration:c.fadeDuration,zoomHistory:c.zoomHistory,transition:c.transition}),super.possiblyEvaluate(o,c)}evaluate(o,c,f,_){return c=dr({},c,{zoom:Math.floor(c.zoom)}),super.evaluate(o,c,f,_)}}let pp;class Wu extends Ln{constructor(o){super(o,ay),this.gradientVersion=0,pp||(pp=new ly(ay.paint.properties["line-width"].specification),pp.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(o){if(o==="line-gradient"){const c=this.gradientExpression();this.stepInterpolant=!!(function(f){return f._styleExpression!==void 0})(c)&&c._styleExpression.expression instanceof di,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(o,c){super.recalculate(o,c),this.paint._values["line-floorwidth"]=pp.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,o)}createBucket(o){return new hp(o)}queryRadius(o){const c=o,f=cy(Rh("line-width",this,c),Rh("line-gap-width",this,c)),_=Rh("line-offset",this,c);return f/2+Math.abs(_)+Ih(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:o,feature:c,featureState:f,geometry:_,transform:w,pixelsToTileUnits:E}){const M=Qd(o,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-w.bearingInRadians,E),R=E/2*cy(this.paint.get("line-width").evaluate(c,f),this.paint.get("line-gap-width").evaluate(c,f)),D=this.paint.get("line-offset").evaluate(c,f);return D&&(_=(function(z,V){const Z=[];for(let X=0;X<z.length;X++){const Y=z[X],re=[];for(let he=0;he<Y.length;he++){const ye=Y[he-1],Ne=Y[he],Ee=Y[he+1],Me=he===0?new v(0,0):Ne.sub(ye)._unit()._perp(),Xe=he===Y.length-1?new v(0,0):Ee.sub(Ne)._unit()._perp(),st=Me._add(Xe)._unit(),ft=st.x*Xe.x+st.y*Xe.y;ft!==0&&st._mult(1/ft),re.push(st._mult(V)._add(Ne))}Z.push(re)}return Z})(_,D*E)),(function(z,V,Z){for(let X=0;X<V.length;X++){const Y=V[X];if(z.length>=3){for(let re=0;re<Y.length;re++)if(zu(z,Y[re]))return!0}if(ao(z,Y,Z))return!0}return!1})(M,_,R)}isTileClipped(){return!0}}function cy(u,o){return o>0?o+2*u:u}const jh=Pi([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),uy=Pi([{name:"a_projected_pos",components:3,type:"Float32"}],4);Pi([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const sn=Pi([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);Pi([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const hy=Pi([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),dy=Pi([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function G1(u,o,c){return u.sections.forEach((f=>{f.text=(function(_,w,E){const M=w.layout.get("text-transform").evaluate(E,{});return M==="uppercase"?_=_.toLocaleUpperCase():M==="lowercase"&&(_=_.toLocaleLowerCase()),io.applyArabicShaping&&(_=io.applyArabicShaping(_)),_})(f.text,o,c)})),u}Pi([{name:"triangle",components:3,type:"Uint16"}]),Pi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Pi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),Pi([{type:"Float32",name:"offsetX"}]),Pi([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),Pi([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const fp={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var gn=24;const vf=4294967296,py=1/vf,zo=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");class mp{constructor(o=new Uint8Array(16)){this.buf=ArrayBuffer.isView(o)?o:new Uint8Array(o),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(o,c,f=this.length){for(;this.pos<f;){const _=this.readVarint(),w=_>>3,E=this.pos;this.type=7&_,o(w,c,this),this.pos===E&&this.skip(_)}return c}readMessage(o,c){return this.readFields(o,c,this.readVarint()+this.pos)}readFixed32(){const o=this.dataView.getUint32(this.pos,!0);return this.pos+=4,o}readSFixed32(){const o=this.dataView.getInt32(this.pos,!0);return this.pos+=4,o}readFixed64(){const o=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*vf;return this.pos+=8,o}readSFixed64(){const o=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*vf;return this.pos+=8,o}readFloat(){const o=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,o}readDouble(){const o=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,o}readVarint(o){const c=this.buf;let f,_;return _=c[this.pos++],f=127&_,_<128?f:(_=c[this.pos++],f|=(127&_)<<7,_<128?f:(_=c[this.pos++],f|=(127&_)<<14,_<128?f:(_=c[this.pos++],f|=(127&_)<<21,_<128?f:(_=c[this.pos],f|=(15&_)<<28,(function(w,E,M){const R=M.buf;let D,z;if(z=R[M.pos++],D=(112&z)>>4,z<128||(z=R[M.pos++],D|=(127&z)<<3,z<128)||(z=R[M.pos++],D|=(127&z)<<10,z<128)||(z=R[M.pos++],D|=(127&z)<<17,z<128)||(z=R[M.pos++],D|=(127&z)<<24,z<128)||(z=R[M.pos++],D|=(1&z)<<31,z<128))return H1(w,D,E);throw new Error("Expected varint not more than 10 bytes")})(f,o,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const o=this.readVarint();return o%2==1?(o+1)/-2:o/2}readBoolean(){return!!this.readVarint()}readString(){const o=this.readVarint()+this.pos,c=this.pos;return this.pos=o,o-c>=12&&zo?zo.decode(this.buf.subarray(c,o)):(function(f,_,w){let E="",M=_;for(;M<w;){const R=f[M];let D,z,V,Z=null,X=R>239?4:R>223?3:R>191?2:1;if(M+X>w)break;X===1?R<128&&(Z=R):X===2?(D=f[M+1],(192&D)==128&&(Z=(31&R)<<6|63&D,Z<=127&&(Z=null))):X===3?(D=f[M+1],z=f[M+2],(192&D)==128&&(192&z)==128&&(Z=(15&R)<<12|(63&D)<<6|63&z,(Z<=2047||Z>=55296&&Z<=57343)&&(Z=null))):X===4&&(D=f[M+1],z=f[M+2],V=f[M+3],(192&D)==128&&(192&z)==128&&(192&V)==128&&(Z=(15&R)<<18|(63&D)<<12|(63&z)<<6|63&V,(Z<=65535||Z>=1114112)&&(Z=null))),Z===null?(Z=65533,X=1):Z>65535&&(Z-=65536,E+=String.fromCharCode(Z>>>10&1023|55296),Z=56320|1023&Z),E+=String.fromCharCode(Z),M+=X}return E})(this.buf,c,o)}readBytes(){const o=this.readVarint()+this.pos,c=this.buf.subarray(this.pos,o);return this.pos=o,c}readPackedVarint(o=[],c){const f=this.readPackedEnd();for(;this.pos<f;)o.push(this.readVarint(c));return o}readPackedSVarint(o=[]){const c=this.readPackedEnd();for(;this.pos<c;)o.push(this.readSVarint());return o}readPackedBoolean(o=[]){const c=this.readPackedEnd();for(;this.pos<c;)o.push(this.readBoolean());return o}readPackedFloat(o=[]){const c=this.readPackedEnd();for(;this.pos<c;)o.push(this.readFloat());return o}readPackedDouble(o=[]){const c=this.readPackedEnd();for(;this.pos<c;)o.push(this.readDouble());return o}readPackedFixed32(o=[]){const c=this.readPackedEnd();for(;this.pos<c;)o.push(this.readFixed32());return o}readPackedSFixed32(o=[]){const c=this.readPackedEnd();for(;this.pos<c;)o.push(this.readSFixed32());return o}readPackedFixed64(o=[]){const c=this.readPackedEnd();for(;this.pos<c;)o.push(this.readFixed64());return o}readPackedSFixed64(o=[]){const c=this.readPackedEnd();for(;this.pos<c;)o.push(this.readSFixed64());return o}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(o){const c=7&o;if(c===0)for(;this.buf[this.pos++]>127;);else if(c===2)this.pos=this.readVarint()+this.pos;else if(c===5)this.pos+=4;else{if(c!==1)throw new Error(`Unimplemented type: ${c}`);this.pos+=8}}writeTag(o,c){this.writeVarint(o<<3|c)}realloc(o){let c=this.length||16;for(;c<this.pos+o;)c*=2;if(c!==this.length){const f=new Uint8Array(c);f.set(this.buf),this.buf=f,this.dataView=new DataView(f.buffer),this.length=c}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(o){this.realloc(4),this.dataView.setInt32(this.pos,o,!0),this.pos+=4}writeSFixed32(o){this.realloc(4),this.dataView.setInt32(this.pos,o,!0),this.pos+=4}writeFixed64(o){this.realloc(8),this.dataView.setInt32(this.pos,-1&o,!0),this.dataView.setInt32(this.pos+4,Math.floor(o*py),!0),this.pos+=8}writeSFixed64(o){this.realloc(8),this.dataView.setInt32(this.pos,-1&o,!0),this.dataView.setInt32(this.pos+4,Math.floor(o*py),!0),this.pos+=8}writeVarint(o){(o=+o||0)>268435455||o<0?(function(c,f){let _,w;if(c>=0?(_=c%4294967296|0,w=c/4294967296|0):(_=~(-c%4294967296),w=~(-c/4294967296),4294967295^_?_=_+1|0:(_=0,w=w+1|0)),c>=18446744073709552e3||c<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");f.realloc(10),(function(E,M,R){R.buf[R.pos++]=127&E|128,E>>>=7,R.buf[R.pos++]=127&E|128,E>>>=7,R.buf[R.pos++]=127&E|128,E>>>=7,R.buf[R.pos++]=127&E|128,R.buf[R.pos]=127&(E>>>=7)})(_,0,f),(function(E,M){const R=(7&E)<<4;M.buf[M.pos++]|=R|((E>>>=3)?128:0),E&&(M.buf[M.pos++]=127&E|((E>>>=7)?128:0),E&&(M.buf[M.pos++]=127&E|((E>>>=7)?128:0),E&&(M.buf[M.pos++]=127&E|((E>>>=7)?128:0),E&&(M.buf[M.pos++]=127&E|((E>>>=7)?128:0),E&&(M.buf[M.pos++]=127&E)))))})(w,f)})(o,this):(this.realloc(4),this.buf[this.pos++]=127&o|(o>127?128:0),o<=127||(this.buf[this.pos++]=127&(o>>>=7)|(o>127?128:0),o<=127||(this.buf[this.pos++]=127&(o>>>=7)|(o>127?128:0),o<=127||(this.buf[this.pos++]=o>>>7&127))))}writeSVarint(o){this.writeVarint(o<0?2*-o-1:2*o)}writeBoolean(o){this.writeVarint(+o)}writeString(o){o=String(o),this.realloc(4*o.length),this.pos++;const c=this.pos;this.pos=(function(_,w,E){for(let M,R,D=0;D<w.length;D++){if(M=w.charCodeAt(D),M>55295&&M<57344){if(!R){M>56319||D+1===w.length?(_[E++]=239,_[E++]=191,_[E++]=189):R=M;continue}if(M<56320){_[E++]=239,_[E++]=191,_[E++]=189,R=M;continue}M=R-55296<<10|M-56320|65536,R=null}else R&&(_[E++]=239,_[E++]=191,_[E++]=189,R=null);M<128?_[E++]=M:(M<2048?_[E++]=M>>6|192:(M<65536?_[E++]=M>>12|224:(_[E++]=M>>18|240,_[E++]=M>>12&63|128),_[E++]=M>>6&63|128),_[E++]=63&M|128)}return E})(this.buf,o,this.pos);const f=this.pos-c;f>=128&&ql(c,f,this),this.pos=c-1,this.writeVarint(f),this.pos+=f}writeFloat(o){this.realloc(4),this.dataView.setFloat32(this.pos,o,!0),this.pos+=4}writeDouble(o){this.realloc(8),this.dataView.setFloat64(this.pos,o,!0),this.pos+=8}writeBytes(o){const c=o.length;this.writeVarint(c),this.realloc(c);for(let f=0;f<c;f++)this.buf[this.pos++]=o[f]}writeRawMessage(o,c){this.pos++;const f=this.pos;o(c,this);const _=this.pos-f;_>=128&&ql(f,_,this),this.pos=f-1,this.writeVarint(_),this.pos+=_}writeMessage(o,c,f){this.writeTag(o,2),this.writeRawMessage(c,f)}writePackedVarint(o,c){c.length&&this.writeMessage(o,bf,c)}writePackedSVarint(o,c){c.length&&this.writeMessage(o,qu,c)}writePackedBoolean(o,c){c.length&&this.writeMessage(o,bg,c)}writePackedFloat(o,c){c.length&&this.writeMessage(o,xf,c)}writePackedDouble(o,c){c.length&&this.writeMessage(o,vg,c)}writePackedFixed32(o,c){c.length&&this.writeMessage(o,W1,c)}writePackedSFixed32(o,c){c.length&&this.writeMessage(o,xg,c)}writePackedFixed64(o,c){c.length&&this.writeMessage(o,q1,c)}writePackedSFixed64(o,c){c.length&&this.writeMessage(o,fy,c)}writeBytesField(o,c){this.writeTag(o,2),this.writeBytes(c)}writeFixed32Field(o,c){this.writeTag(o,5),this.writeFixed32(c)}writeSFixed32Field(o,c){this.writeTag(o,5),this.writeSFixed32(c)}writeFixed64Field(o,c){this.writeTag(o,1),this.writeFixed64(c)}writeSFixed64Field(o,c){this.writeTag(o,1),this.writeSFixed64(c)}writeVarintField(o,c){this.writeTag(o,0),this.writeVarint(c)}writeSVarintField(o,c){this.writeTag(o,0),this.writeSVarint(c)}writeStringField(o,c){this.writeTag(o,2),this.writeString(c)}writeFloatField(o,c){this.writeTag(o,5),this.writeFloat(c)}writeDoubleField(o,c){this.writeTag(o,1),this.writeDouble(c)}writeBooleanField(o,c){this.writeVarintField(o,+c)}}function H1(u,o,c){return c?4294967296*o+(u>>>0):4294967296*(o>>>0)+(u>>>0)}function ql(u,o,c){const f=o<=16383?1:o<=2097151?2:o<=268435455?3:Math.floor(Math.log(o)/(7*Math.LN2));c.realloc(f);for(let _=c.pos-1;_>=u;_--)c.buf[_+f]=c.buf[_]}function bf(u,o){for(let c=0;c<u.length;c++)o.writeVarint(u[c])}function qu(u,o){for(let c=0;c<u.length;c++)o.writeSVarint(u[c])}function xf(u,o){for(let c=0;c<u.length;c++)o.writeFloat(u[c])}function vg(u,o){for(let c=0;c<u.length;c++)o.writeDouble(u[c])}function bg(u,o){for(let c=0;c<u.length;c++)o.writeBoolean(u[c])}function W1(u,o){for(let c=0;c<u.length;c++)o.writeFixed32(u[c])}function xg(u,o){for(let c=0;c<u.length;c++)o.writeSFixed32(u[c])}function q1(u,o){for(let c=0;c<u.length;c++)o.writeFixed64(u[c])}function fy(u,o){for(let c=0;c<u.length;c++)o.writeSFixed64(u[c])}function my(u,o,c){u===1&&c.readMessage(wf,o)}function wf(u,o,c){if(u===3){const{id:f,bitmap:_,width:w,height:E,left:M,top:R,advance:D}=c.readMessage(Ef,{});o.push({id:f,bitmap:new No({width:w+6,height:E+6},_),metrics:{width:w,height:E,left:M,top:R,advance:D}})}}function Ef(u,o,c){u===1?o.id=c.readVarint():u===2?o.bitmap=c.readBytes():u===3?o.width=c.readVarint():u===4?o.height=c.readVarint():u===5?o.left=c.readSVarint():u===6?o.top=c.readSVarint():u===7&&(o.advance=c.readVarint())}function wg(u){let o=0,c=0;for(const E of u)o+=E.w*E.h,c=Math.max(c,E.w);u.sort(((E,M)=>M.h-E.h));const f=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(o/.95)),c),h:1/0}];let _=0,w=0;for(const E of u)for(let M=f.length-1;M>=0;M--){const R=f[M];if(!(E.w>R.w||E.h>R.h)){if(E.x=R.x,E.y=R.y,w=Math.max(w,E.y+E.h),_=Math.max(_,E.x+E.w),E.w===R.w&&E.h===R.h){const D=f.pop();D&&M<f.length&&(f[M]=D)}else E.h===R.h?(R.x+=E.w,R.w-=E.w):E.w===R.w?(R.y+=E.h,R.h-=E.h):(f.push({x:R.x+E.w,y:R.y,w:R.w-E.w,h:E.h}),R.y+=E.h,R.h-=E.h);break}}return{w:_,h:w,fill:o/(_*w)||0}}class gp{constructor(o,{pixelRatio:c,version:f,stretchX:_,stretchY:w,content:E,textFitWidth:M,textFitHeight:R}){this.paddedRect=o,this.pixelRatio=c,this.stretchX=_,this.stretchY=w,this.content=E,this.version=f,this.textFitWidth=M,this.textFitHeight=R}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class gy{constructor(o,c){const f={},_={};this.haveRenderCallbacks=[];const w=[];this.addImages(o,f,w),this.addImages(c,_,w);const{w:E,h:M}=wg(w),R=new $s({width:E||1,height:M||1});for(const D in o){const z=o[D],V=f[D].paddedRect;$s.copy(z.data,R,{x:0,y:0},{x:V.x+1,y:V.y+1},z.data)}for(const D in c){const z=c[D],V=_[D].paddedRect,Z=V.x+1,X=V.y+1,Y=z.data.width,re=z.data.height;$s.copy(z.data,R,{x:0,y:0},{x:Z,y:X},z.data),$s.copy(z.data,R,{x:0,y:re-1},{x:Z,y:X-1},{width:Y,height:1}),$s.copy(z.data,R,{x:0,y:0},{x:Z,y:X+re},{width:Y,height:1}),$s.copy(z.data,R,{x:Y-1,y:0},{x:Z-1,y:X},{width:1,height:re}),$s.copy(z.data,R,{x:0,y:0},{x:Z+Y,y:X},{width:1,height:re})}this.image=R,this.iconPositions=f,this.patternPositions=_}addImages(o,c,f){for(const _ in o){const w=o[_],E={x:0,y:0,w:w.data.width+2,h:w.data.height+2};f.push(E),c[_]=new gp(E,w),w.hasRenderCallback&&this.haveRenderCallbacks.push(_)}}patchUpdatedImages(o,c){o.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const f in o.updatedImages)this.patchUpdatedImage(this.iconPositions[f],o.getImage(f),c),this.patchUpdatedImage(this.patternPositions[f],o.getImage(f),c)}patchUpdatedImage(o,c,f){if(!o||!c||o.version===c.version)return;o.version=c.version;const[_,w]=o.tl;f.update(c.data,void 0,{x:_,y:w})}}var $l;Dt("ImagePosition",gp),Dt("ImageAtlas",gy),h.ao=void 0,($l=h.ao||(h.ao={}))[$l.none=0]="none",$l[$l.horizontal=1]="horizontal",$l[$l.vertical=2]="vertical",$l[$l.horizontalOnly=3]="horizontalOnly";class $u{constructor(){this.scale=1,this.fontStack="",this.imageName=null,this.verticalAlign="bottom"}static forText(o,c,f){const _=new $u;return _.scale=o||1,_.fontStack=c,_.verticalAlign=f||"bottom",_}static forImage(o,c){const f=new $u;return f.imageName=o,f.verticalAlign=c||"bottom",f}}class Zl{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(o,c){const f=new Zl;for(let _=0;_<o.sections.length;_++){const w=o.sections[_];w.image?f.addImageSection(w):f.addTextSection(w,c)}return f}length(){return this.text.length}getSection(o){return this.sections[this.sectionIndex[o]]}getSectionIndex(o){return this.sectionIndex[o]}getCharCode(o){return this.text.charCodeAt(o)}verticalizePunctuation(){this.text=(function(o){let c="";for(let f=0;f<o.length;f++){const _=o.charCodeAt(f+1)||null,w=o.charCodeAt(f-1)||null;c+=_&&$d(_)&&!fp[o[f+1]]||w&&$d(w)&&!fp[o[f-1]]||!fp[o[f]]?o[f]:fp[o[f]]}return c})(this.text)}trim(){let o=0;for(let f=0;f<this.text.length&&Zu[this.text.charCodeAt(f)];f++)o++;let c=this.text.length;for(let f=this.text.length-1;f>=0&&f>=o&&Zu[this.text.charCodeAt(f)];f--)c--;this.text=this.text.substring(o,c),this.sectionIndex=this.sectionIndex.slice(o,c)}substring(o,c){const f=new Zl;return f.text=this.text.substring(o,c),f.sectionIndex=this.sectionIndex.slice(o,c),f.sections=this.sections,f}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((o,c)=>Math.max(o,this.sections[c].scale)),0)}getMaxImageSize(o){let c=0,f=0;for(let _=0;_<this.length();_++){const w=this.getSection(_);if(w.imageName){const E=o[w.imageName];if(!E)continue;const M=E.displaySize;c=Math.max(c,M[0]),f=Math.max(f,M[1])}}return{maxImageWidth:c,maxImageHeight:f}}addTextSection(o,c){this.text+=o.text,this.sections.push($u.forText(o.scale,o.fontStack||c,o.verticalAlign));const f=this.sections.length-1;for(let _=0;_<o.text.length;++_)this.sectionIndex.push(f)}addImageSection(o){const c=o.image?o.image.name:"";if(c.length===0)return void ri("Can't add FormattedSection with an empty image.");const f=this.getNextImageSectionCharCode();f?(this.text+=String.fromCharCode(f),this.sections.push($u.forImage(c,o.verticalAlign)),this.sectionIndex.push(this.sections.length-1)):ri("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Vh(u,o,c,f,_,w,E,M,R,D,z,V,Z,X,Y){const re=Zl.fromFeature(u,_);let he;V===h.ao.vertical&&re.verticalizePunctuation();const{processBidirectionalText:ye,processStyledBidirectionalText:Ne}=io;if(ye&&re.sections.length===1){he=[];const Xe=ye(re.toString(),p(re,D,w,o,f,X));for(const st of Xe){const ft=new Zl;ft.text=st,ft.sections=re.sections;for(let It=0;It<st.length;It++)ft.sectionIndex.push(0);he.push(ft)}}else if(Ne){he=[];const Xe=Ne(re.text,re.sectionIndex,p(re,D,w,o,f,X));for(const st of Xe){const ft=new Zl;ft.text=st[0],ft.sectionIndex=st[1],ft.sections=re.sections,he.push(ft)}}else he=(function(Xe,st){const ft=[],It=Xe.text;let At=0;for(const Pt of st)ft.push(Xe.substring(At,Pt)),At=Pt;return At<It.length&&ft.push(Xe.substring(At,It.length)),ft})(re,p(re,D,w,o,f,X));const Ee=[],Me={positionedLines:Ee,text:re.toString(),top:z[1],bottom:z[1],left:z[0],right:z[0],writingMode:V,iconsInText:!1,verticalizable:!1};return(function(Xe,st,ft,It,At,Pt,Yt,St,Rt,ct,ur,vr){let sr=0,Vt=0,Nr=0,Ki=0;const On=St==="right"?1:St==="left"?0:.5,ks=gn/vr;let Na=0;for(const ji of At){ji.trim();const Hn=ji.getMaxScale(),ms={positionedGlyphs:[],lineOffset:0};Xe.positionedLines[Na]=ms;const gs=ms.positionedGlyphs;let uo=0;if(!ji.length()){Vt+=Pt,++Na;continue}const Oa=A(It,ji,ks);for(let jo=0;jo<ji.length();jo++){const Fn=ji.getSection(jo),qn=ji.getSectionIndex(jo),$n=ji.getCharCode(jo),En=N(Rt,ur,$n);let Ei;if(Fn.imageName){if(Xe.iconsInText=!0,Fn.scale=Fn.scale*ks,Ei=se(Fn,En,Hn,Oa,It),!Ei)continue;uo=Math.max(uo,Ei.imageOffset)}else if(Ei=j(Fn,$n,En,Oa,st,ft),!Ei)continue;const{rect:Kl,metrics:Sf,baselineOffset:Yl}=Ei;gs.push({glyph:$n,imageName:Fn.imageName,x:sr,y:Vt+Yl+-17,vertical:En,scale:Fn.scale,fontStack:Fn.fontStack,sectionIndex:qn,metrics:Sf,rect:Kl}),En?(Xe.verticalizable=!0,sr+=(Fn.imageName?Sf.advance:gn)*Fn.scale+ct):sr+=Sf.advance*Fn.scale+ct}gs.length!==0&&(Nr=Math.max(sr-ct,Nr),Ae(gs,0,gs.length-1,On)),sr=0,ms.lineOffset=Math.max(uo,(Hn-1)*gn);const Wn=Pt*Hn+uo;Vt+=Wn,Ki=Math.max(Wn,Ki),++Na}const{horizontalAlign:Uo,verticalAlign:fs}=g(Yt);(function(ji,Hn,ms,gs,uo,Oa,Wn,jo,Fn){const qn=(Hn-ms)*uo;let $n=0;$n=Oa!==Wn?-jo*gs- -17:-gs*Fn*Wn+.5*Wn;for(const En of ji)for(const Ei of En.positionedGlyphs)Ei.x+=qn,Ei.y+=$n})(Xe.positionedLines,On,Uo,fs,Nr,Ki,Pt,Vt,At.length),Xe.top+=-fs*Vt,Xe.bottom=Xe.top+Vt,Xe.left+=-Uo*Nr,Xe.right=Xe.left+Nr})(Me,o,c,f,he,E,M,R,V,D,Z,Y),!(function(Xe){for(const st of Xe)if(st.positionedGlyphs.length!==0)return!1;return!0})(Ee)&&Me}const Zu={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},_y={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},$1={40:!0};function _p(u,o,c,f,_,w){if(o.imageName){const E=f[o.imageName];return E?E.displaySize[0]*o.scale*gn/w+_:0}{const E=c[o.fontStack],M=E&&E[u];return M?M.metrics.advance*o.scale+_:0}}function yy(u,o,c,f){const _=Math.pow(u-o,2);return f?u<o?_/2:2*_:_+Math.abs(c)*c}function yp(u,o,c){let f=0;return u===10&&(f-=1e4),c&&(f+=150),u!==40&&u!==65288||(f+=50),o!==41&&o!==65289||(f+=50),f}function vy(u,o,c,f,_,w){let E=null,M=yy(o,c,_,w);for(const R of f){const D=yy(o-R.x,c,_,w)+R.badness;D<=M&&(E=R,M=D)}return{index:u,x:o,priorBreak:E,badness:M}}function vp(u){return u?vp(u.priorBreak).concat(u.index):[]}function p(u,o,c,f,_,w){if(!u)return[];const E=[],M=(function(V,Z,X,Y,re,he){let ye=0;for(let Ne=0;Ne<V.length();Ne++){const Ee=V.getSection(Ne);ye+=_p(V.getCharCode(Ne),Ee,Y,re,Z,he)}return ye/Math.max(1,Math.ceil(ye/X))})(u,o,c,f,_,w),R=u.text.indexOf("")>=0;let D=0;for(let V=0;V<u.length();V++){const Z=u.getSection(V),X=u.getCharCode(V);if(Zu[X]||(D+=_p(X,Z,f,_,o,w)),V<u.length()-1){const Y=!((z=X)<11904)&&(!!kr["CJK Compatibility Forms"](z)||!!kr["CJK Compatibility"](z)||!!kr["CJK Strokes"](z)||!!kr["CJK Symbols and Punctuation"](z)||!!kr["Enclosed CJK Letters and Months"](z)||!!kr["Halfwidth and Fullwidth Forms"](z)||!!kr["Ideographic Description Characters"](z)||!!kr["Vertical Forms"](z)||Gs.test(String.fromCodePoint(z)));(_y[X]||Y||Z.imageName||V!==u.length()-2&&$1[u.getCharCode(V+1)])&&E.push(vy(V+1,D,M,E,yp(X,u.getCharCode(V+1),Y&&R),!1))}}var z;return vp(vy(u.length(),D,M,E,0,!0))}function g(u){let o=.5,c=.5;switch(u){case"right":case"top-right":case"bottom-right":o=1;break;case"left":case"top-left":case"bottom-left":o=0}switch(u){case"bottom":case"bottom-right":case"bottom-left":c=1;break;case"top":case"top-right":case"top-left":c=0}return{horizontalAlign:o,verticalAlign:c}}function A(u,o,c){const f=o.getMaxScale()*gn,{maxImageWidth:_,maxImageHeight:w}=o.getMaxImageSize(u),E=Math.max(f,w*c);return{verticalLineContentWidth:Math.max(f,_*c),horizontalLineContentHeight:E}}function P(u){switch(u){case"top":return 0;case"center":return .5;default:return 1}}function N(u,o,c){return!(u===h.ao.horizontal||!o&&!Ah(c)||o&&(Zu[c]||(f=c,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(f)))));var f}function j(u,o,c,f,_,w){const E=w[u.fontStack],M=(function(D,z,V,Z){if(D&&D.rect)return D;const X=z[V.fontStack],Y=X&&X[Z];return Y?{rect:null,metrics:Y.metrics}:null})(E&&E[o],_,u,o);if(M===null)return null;let R;if(c)R=f.verticalLineContentWidth-u.scale*gn;else{const D=P(u.verticalAlign);R=(f.horizontalLineContentHeight-u.scale*gn)*D}return{rect:M.rect,metrics:M.metrics,baselineOffset:R}}function se(u,o,c,f,_){const w=_[u.imageName];if(!w)return null;const E=w.paddedRect,M=w.displaySize,R={width:M[0],height:M[1],left:1,top:-3,advance:o?M[1]:M[0]};let D;if(o)D=f.verticalLineContentWidth-M[1]*u.scale;else{const z=P(u.verticalAlign);D=(f.horizontalLineContentHeight-M[1]*u.scale)*z}return{rect:E,metrics:R,baselineOffset:D,imageOffset:(o?M[0]:M[1])*u.scale-gn*c}}function Ae(u,o,c,f){if(f===0)return;const _=u[c],w=(u[c].x+_.metrics.advance*_.scale)*f;for(let E=o;E<=c;E++)u[E].x-=w}function Ie(u,o,c){const{horizontalAlign:f,verticalAlign:_}=g(c),w=o[0]-u.displaySize[0]*f,E=o[1]-u.displaySize[1]*_;return{image:u,top:E,bottom:E+u.displaySize[1],left:w,right:w+u.displaySize[0]}}function ot(u){var o,c;let f=u.left,_=u.top,w=u.right-f,E=u.bottom-_;const M=(o=u.image.textFitWidth)!==null&&o!==void 0?o:"stretchOrShrink",R=(c=u.image.textFitHeight)!==null&&c!==void 0?c:"stretchOrShrink",D=(u.image.content[2]-u.image.content[0])/(u.image.content[3]-u.image.content[1]);if(R==="proportional"){if(M==="stretchOnly"&&w/E<D||M==="proportional"){const z=Math.ceil(E*D);f*=z/w,w=z}}else if(M==="proportional"&&R==="stretchOnly"&&D!==0&&w/E>D){const z=Math.ceil(w/D);_*=z/E,E=z}return{x1:f,y1:_,x2:f+w,y2:_+E}}function xt(u,o,c,f,_,w){const E=u.image;let M;if(E.content){const he=E.content,ye=E.pixelRatio||1;M=[he[0]/ye,he[1]/ye,E.displaySize[0]-he[2]/ye,E.displaySize[1]-he[3]/ye]}const R=o.left*w,D=o.right*w;let z,V,Z,X;c==="width"||c==="both"?(X=_[0]+R-f[3],V=_[0]+D+f[1]):(X=_[0]+(R+D-E.displaySize[0])/2,V=X+E.displaySize[0]);const Y=o.top*w,re=o.bottom*w;return c==="height"||c==="both"?(z=_[1]+Y-f[0],Z=_[1]+re+f[2]):(z=_[1]+(Y+re-E.displaySize[1])/2,Z=z+E.displaySize[1]),{image:E,top:z,right:V,bottom:Z,left:X,collisionPadding:M}}const yt=128,gt=32640;function jt(u,o){const{expression:c}=o;if(c.kind==="constant")return{kind:"constant",layoutSize:c.evaluate(new Qr(u+1))};if(c.kind==="source")return{kind:"source"};{const{zoomStops:f,interpolationType:_}=c;let w=0;for(;w<f.length&&f[w]<=u;)w++;w=Math.max(0,w-1);let E=w;for(;E<f.length&&f[E]<u+1;)E++;E=Math.min(f.length-1,E);const M=f[w],R=f[E];return c.kind==="composite"?{kind:"composite",minZoom:M,maxZoom:R,interpolationType:_}:{kind:"camera",minZoom:M,maxZoom:R,minSize:c.evaluate(new Qr(M)),maxSize:c.evaluate(new Qr(R)),interpolationType:_}}}function Zt(u,o,c){let f="never";const _=u.get(o);return _?f=_:u.get(c)&&(f="always"),f}const rr=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Ui(u,o,c,f,_,w,E,M,R,D,z,V,Z){const X=M?Math.min(gt,Math.round(M[0])):0,Y=M?Math.min(gt,Math.round(M[1])):0;u.emplaceBack(o,c,Math.round(32*f),Math.round(32*_),w,E,(X<<1)+(R?1:0),Y,16*D,16*z,256*V,256*Z)}function Ye(u,o,c){u.emplaceBack(o.x,o.y,c),u.emplaceBack(o.x,o.y,c),u.emplaceBack(o.x,o.y,c),u.emplaceBack(o.x,o.y,c)}function je(u){for(const o of u.sections)if(Lu(o.text))return!0;return!1}class rt{constructor(o){this.layoutVertexArray=new Et,this.indexArray=new ei,this.programConfigurations=o,this.segments=new yr,this.dynamicLayoutVertexArray=new ut,this.opacityVertexArray=new Ut,this.hasVisibleVertices=!1,this.placedSymbolArray=new J}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(o,c,f,_){this.isEmpty()||(f&&(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,jh.members),this.indexBuffer=o.createIndexBuffer(this.indexArray,c),this.dynamicLayoutVertexBuffer=o.createVertexBuffer(this.dynamicLayoutVertexArray,uy.members,!0),this.opacityVertexBuffer=o.createVertexBuffer(this.opacityVertexArray,rr,!0),this.opacityVertexBuffer.itemSize=1),(f||_)&&this.programConfigurations.upload(o))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Dt("SymbolBuffers",rt);class Mt{constructor(o,c,f){this.layoutVertexArray=new o,this.layoutAttributes=c,this.indexArray=new f,this.segments=new yr,this.collisionVertexArray=new Ur}upload(o){this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=o.createVertexBuffer(this.collisionVertexArray,sn.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Dt("CollisionBuffers",Mt);class Kt{constructor(o){this.collisionBoxArray=o.collisionBoxArray,this.zoom=o.zoom,this.globalState=o.globalState,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map((E=>E.id)),this.index=o.index,this.pixelRatio=o.pixelRatio,this.sourceLayerIndex=o.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];const c=this.layers[0]._unevaluatedLayout._values;this.textSizeData=jt(this.zoom,c["text-size"]),this.iconSizeData=jt(this.zoom,c["icon-size"]);const f=this.layers[0].layout,_=f.get("symbol-sort-key"),w=f.get("symbol-z-order");this.canOverlap=Zt(f,"text-overlap","text-allow-overlap")!=="never"||Zt(f,"icon-overlap","icon-allow-overlap")!=="never"||f.get("text-ignore-placement")||f.get("icon-ignore-placement"),this.sortFeaturesByKey=w!=="viewport-y"&&!_.isConstant(),this.sortFeaturesByY=(w==="viewport-y"||w==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,f.get("symbol-placement")==="point"&&(this.writingModes=f.get("text-writing-mode").map((E=>h.ao[E]))),this.stateDependentLayerIds=this.layers.filter((E=>E.isStateDependent())).map((E=>E.id)),this.sourceID=o.sourceID}createArrays(){this.text=new rt(new Ps(this.layers,this.zoom,(o=>/^text/.test(o)))),this.icon=new rt(new Ps(this.layers,this.zoom,(o=>/^icon/.test(o)))),this.glyphOffsetArray=new pe,this.lineVertexArray=new ge,this.symbolInstances=new de,this.textAnchorOffsets=new _e}calculateGlyphDependencies(o,c,f,_,w){for(let E=0;E<o.length;E++)if(c[o.charCodeAt(E)]=!0,(f||_)&&w){const M=fp[o.charAt(E)];M&&(c[M.charCodeAt(0)]=!0)}}populate(o,c,f){const _=this.layers[0],w=_.layout,E=w.get("text-font"),M=w.get("text-field"),R=w.get("icon-image"),D=(M.value.kind!=="constant"||M.value.value instanceof Fi&&!M.value.value.isEmpty()||M.value.value.toString().length>0)&&(E.value.kind!=="constant"||E.value.value.length>0),z=R.value.kind!=="constant"||!!R.value.value||Object.keys(R.parameters).length>0,V=w.get("symbol-sort-key");if(this.features=[],!D&&!z)return;const Z=c.iconDependencies,X=c.glyphDependencies,Y=c.availableImages,re=new Qr(this.zoom,{globalState:this.globalState});for(const{feature:he,id:ye,index:Ne,sourceLayerIndex:Ee}of o){const Me=_._featureFilter.needGeometry,Xe=ka(he,Me);if(!_._featureFilter.filter(re,Xe,f))continue;let st,ft;if(Me||(Xe.geometry=ta(he)),D){const At=_.getValueAndResolveTokens("text-field",Xe,f,Y),Pt=Fi.factory(At),Yt=this.hasRTLText=this.hasRTLText||je(Pt);(!Yt||io.getRTLTextPluginStatus()==="unavailable"||Yt&&io.isParsed())&&(st=G1(Pt,_,Xe))}if(z){const At=_.getValueAndResolveTokens("icon-image",Xe,f,Y);ft=At instanceof Os?At:Os.fromString(At)}if(!st&&!ft)continue;const It=this.sortFeaturesByKey?V.evaluate(Xe,{},f):void 0;if(this.features.push({id:ye,text:st,icon:ft,index:Ne,sourceLayerIndex:Ee,geometry:Xe.geometry,properties:he.properties,type:Fo.types[he.type],sortKey:It}),ft&&(Z[ft.name]=!0),st){const At=E.evaluate(Xe,{},f).join(","),Pt=w.get("text-rotation-alignment")!=="viewport"&&w.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(h.ao.vertical)>=0;for(const Yt of st.sections)if(Yt.image)Z[Yt.image.name]=!0;else{const St=Fc(st.toString()),Rt=Yt.fontStack||At,ct=X[Rt]=X[Rt]||{};this.calculateGlyphDependencies(Yt.text,ct,Pt,this.allowVerticalPlacement,St)}}}w.get("symbol-placement")==="line"&&(this.features=(function(he){const ye={},Ne={},Ee=[];let Me=0;function Xe(At){Ee.push(he[At]),Me++}function st(At,Pt,Yt){const St=Ne[At];return delete Ne[At],Ne[Pt]=St,Ee[St].geometry[0].pop(),Ee[St].geometry[0]=Ee[St].geometry[0].concat(Yt[0]),St}function ft(At,Pt,Yt){const St=ye[Pt];return delete ye[Pt],ye[At]=St,Ee[St].geometry[0].shift(),Ee[St].geometry[0]=Yt[0].concat(Ee[St].geometry[0]),St}function It(At,Pt,Yt){const St=Yt?Pt[0][Pt[0].length-1]:Pt[0][0];return`${At}:${St.x}:${St.y}`}for(let At=0;At<he.length;At++){const Pt=he[At],Yt=Pt.geometry,St=Pt.text?Pt.text.toString():null;if(!St){Xe(At);continue}const Rt=It(St,Yt),ct=It(St,Yt,!0);if(Rt in Ne&&ct in ye&&Ne[Rt]!==ye[ct]){const ur=ft(Rt,ct,Yt),vr=st(Rt,ct,Ee[ur].geometry);delete ye[Rt],delete Ne[ct],Ne[It(St,Ee[vr].geometry,!0)]=vr,Ee[ur].geometry=null}else Rt in Ne?st(Rt,ct,Yt):ct in ye?ft(Rt,ct,Yt):(Xe(At),ye[Rt]=Me-1,Ne[ct]=Me-1)}return Ee.filter((At=>At.geometry))})(this.features)),this.sortFeaturesByKey&&this.features.sort(((he,ye)=>he.sortKey-ye.sortKey))}update(o,c,f){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(o,c,this.layers,f),this.icon.programConfigurations.updatePaintArrays(o,c,this.layers,f))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(o){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(o),this.iconCollisionBox.upload(o)),this.text.upload(o,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(o,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(o,c){const f=this.lineVertexArray.length;if(o.segment!==void 0){let _=o.dist(c[o.segment+1]),w=o.dist(c[o.segment]);const E={};for(let M=o.segment+1;M<c.length;M++)E[M]={x:c[M].x,y:c[M].y,tileUnitDistanceFromAnchor:_},M<c.length-1&&(_+=c[M+1].dist(c[M]));for(let M=o.segment||0;M>=0;M--)E[M]={x:c[M].x,y:c[M].y,tileUnitDistanceFromAnchor:w},M>0&&(w+=c[M-1].dist(c[M]));for(let M=0;M<c.length;M++){const R=E[M];this.lineVertexArray.emplaceBack(R.x,R.y,R.tileUnitDistanceFromAnchor)}}return{lineStartIndex:f,lineLength:this.lineVertexArray.length-f}}addSymbols(o,c,f,_,w,E,M,R,D,z,V,Z){const X=o.indexArray,Y=o.layoutVertexArray,re=o.segments.prepareSegment(4*c.length,Y,X,this.canOverlap?E.sortKey:void 0),he=this.glyphOffsetArray.length,ye=re.vertexLength,Ne=this.allowVerticalPlacement&&M===h.ao.vertical?Math.PI/2:0,Ee=E.text&&E.text.sections;for(let Me=0;Me<c.length;Me++){const{tl:Xe,tr:st,bl:ft,br:It,tex:At,pixelOffsetTL:Pt,pixelOffsetBR:Yt,minFontScaleX:St,minFontScaleY:Rt,glyphOffset:ct,isSDF:ur,sectionIndex:vr}=c[Me],sr=re.vertexLength,Vt=ct[1];Ui(Y,R.x,R.y,Xe.x,Vt+Xe.y,At.x,At.y,f,ur,Pt.x,Pt.y,St,Rt),Ui(Y,R.x,R.y,st.x,Vt+st.y,At.x+At.w,At.y,f,ur,Yt.x,Pt.y,St,Rt),Ui(Y,R.x,R.y,ft.x,Vt+ft.y,At.x,At.y+At.h,f,ur,Pt.x,Yt.y,St,Rt),Ui(Y,R.x,R.y,It.x,Vt+It.y,At.x+At.w,At.y+At.h,f,ur,Yt.x,Yt.y,St,Rt),Ye(o.dynamicLayoutVertexArray,R,Ne),X.emplaceBack(sr,sr+2,sr+1),X.emplaceBack(sr+1,sr+2,sr+3),re.vertexLength+=4,re.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(ct[0]),Me!==c.length-1&&vr===c[Me+1].sectionIndex||o.programConfigurations.populatePaintArrays(Y.length,E,E.index,{},Z,Ee&&Ee[vr])}o.placedSymbolArray.emplaceBack(R.x,R.y,he,this.glyphOffsetArray.length-he,ye,D,z,R.segment,f?f[0]:0,f?f[1]:0,_[0],_[1],M,0,!1,0,V)}_addCollisionDebugVertex(o,c,f,_,w,E){return c.emplaceBack(0,0),o.emplaceBack(f.x,f.y,_,w,Math.round(E.x),Math.round(E.y))}addCollisionDebugVertices(o,c,f,_,w,E,M){const R=w.segments.prepareSegment(4,w.layoutVertexArray,w.indexArray),D=R.vertexLength,z=w.layoutVertexArray,V=w.collisionVertexArray,Z=M.anchorX,X=M.anchorY;this._addCollisionDebugVertex(z,V,E,Z,X,new v(o,c)),this._addCollisionDebugVertex(z,V,E,Z,X,new v(f,c)),this._addCollisionDebugVertex(z,V,E,Z,X,new v(f,_)),this._addCollisionDebugVertex(z,V,E,Z,X,new v(o,_)),R.vertexLength+=4;const Y=w.indexArray;Y.emplaceBack(D,D+1),Y.emplaceBack(D+1,D+2),Y.emplaceBack(D+2,D+3),Y.emplaceBack(D+3,D),R.primitiveLength+=4}addDebugCollisionBoxes(o,c,f,_){for(let w=o;w<c;w++){const E=this.collisionBoxArray.get(w);this.addCollisionDebugVertices(E.x1,E.y1,E.x2,E.y2,_?this.textCollisionBox:this.iconCollisionBox,E.anchorPoint,f)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Mt(Ar,hy.members,Xr),this.iconCollisionBox=new Mt(Ar,hy.members,Xr);for(let o=0;o<this.symbolInstances.length;o++){const c=this.symbolInstances.get(o);this.addDebugCollisionBoxes(c.textBoxStartIndex,c.textBoxEndIndex,c,!0),this.addDebugCollisionBoxes(c.verticalTextBoxStartIndex,c.verticalTextBoxEndIndex,c,!0),this.addDebugCollisionBoxes(c.iconBoxStartIndex,c.iconBoxEndIndex,c,!1),this.addDebugCollisionBoxes(c.verticalIconBoxStartIndex,c.verticalIconBoxEndIndex,c,!1)}}_deserializeCollisionBoxesForSymbol(o,c,f,_,w,E,M,R,D){const z={};for(let V=c;V<f;V++){const Z=o.get(V);z.textBox={x1:Z.x1,y1:Z.y1,x2:Z.x2,y2:Z.y2,anchorPointX:Z.anchorPointX,anchorPointY:Z.anchorPointY},z.textFeatureIndex=Z.featureIndex;break}for(let V=_;V<w;V++){const Z=o.get(V);z.verticalTextBox={x1:Z.x1,y1:Z.y1,x2:Z.x2,y2:Z.y2,anchorPointX:Z.anchorPointX,anchorPointY:Z.anchorPointY},z.verticalTextFeatureIndex=Z.featureIndex;break}for(let V=E;V<M;V++){const Z=o.get(V);z.iconBox={x1:Z.x1,y1:Z.y1,x2:Z.x2,y2:Z.y2,anchorPointX:Z.anchorPointX,anchorPointY:Z.anchorPointY},z.iconFeatureIndex=Z.featureIndex;break}for(let V=R;V<D;V++){const Z=o.get(V);z.verticalIconBox={x1:Z.x1,y1:Z.y1,x2:Z.x2,y2:Z.y2,anchorPointX:Z.anchorPointX,anchorPointY:Z.anchorPointY},z.verticalIconFeatureIndex=Z.featureIndex;break}return z}deserializeCollisionBoxes(o){this.collisionArrays=[];for(let c=0;c<this.symbolInstances.length;c++){const f=this.symbolInstances.get(c);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(o,f.textBoxStartIndex,f.textBoxEndIndex,f.verticalTextBoxStartIndex,f.verticalTextBoxEndIndex,f.iconBoxStartIndex,f.iconBoxEndIndex,f.verticalIconBoxStartIndex,f.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(o,c){const f=o.placedSymbolArray.get(c),_=f.vertexStartIndex+4*f.numGlyphs;for(let w=f.vertexStartIndex;w<_;w+=4)o.indexArray.emplaceBack(w,w+2,w+1),o.indexArray.emplaceBack(w+1,w+2,w+3)}getSortedSymbolIndexes(o){if(this.sortedAngle===o&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const c=Math.sin(o),f=Math.cos(o),_=[],w=[],E=[];for(let M=0;M<this.symbolInstances.length;++M){E.push(M);const R=this.symbolInstances.get(M);_.push(0|Math.round(c*R.anchorX+f*R.anchorY)),w.push(R.featureIndex)}return E.sort(((M,R)=>_[M]-_[R]||w[R]-w[M])),E}addToSortKeyRanges(o,c){const f=this.sortKeyRanges[this.sortKeyRanges.length-1];f&&f.sortKey===c?f.symbolInstanceEnd=o+1:this.sortKeyRanges.push({sortKey:c,symbolInstanceStart:o,symbolInstanceEnd:o+1})}sortFeatures(o){if(this.sortFeaturesByY&&this.sortedAngle!==o&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(o),this.sortedAngle=o,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const c of this.symbolInstanceIndexes){const f=this.symbolInstances.get(c);this.featureSortOrder.push(f.featureIndex),[f.rightJustifiedTextSymbolIndex,f.centerJustifiedTextSymbolIndex,f.leftJustifiedTextSymbolIndex].forEach(((_,w,E)=>{_>=0&&E.indexOf(_)===w&&this.addIndicesForPlacedSymbol(this.text,_)})),f.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,f.verticalPlacedTextSymbolIndex),f.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,f.placedIconSymbolIndex),f.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,f.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let fr,mr;Dt("SymbolBucket",Kt,{omit:["layers","collisionBoxArray","features","compareText"]}),Kt.MAX_GLYPHS=65535,Kt.addDynamicAttributes=Ye;var wr={get paint(){return mr=mr||new Bn({"icon-opacity":new tr(Le.paint_symbol["icon-opacity"]),"icon-color":new tr(Le.paint_symbol["icon-color"]),"icon-halo-color":new tr(Le.paint_symbol["icon-halo-color"]),"icon-halo-width":new tr(Le.paint_symbol["icon-halo-width"]),"icon-halo-blur":new tr(Le.paint_symbol["icon-halo-blur"]),"icon-translate":new zt(Le.paint_symbol["icon-translate"]),"icon-translate-anchor":new zt(Le.paint_symbol["icon-translate-anchor"]),"text-opacity":new tr(Le.paint_symbol["text-opacity"]),"text-color":new tr(Le.paint_symbol["text-color"],{runtimeType:Hi,getOverride:u=>u.textColor,hasOverride:u=>!!u.textColor}),"text-halo-color":new tr(Le.paint_symbol["text-halo-color"]),"text-halo-width":new tr(Le.paint_symbol["text-halo-width"]),"text-halo-blur":new tr(Le.paint_symbol["text-halo-blur"]),"text-translate":new zt(Le.paint_symbol["text-translate"]),"text-translate-anchor":new zt(Le.paint_symbol["text-translate-anchor"])})},get layout(){return fr=fr||new Bn({"symbol-placement":new zt(Le.layout_symbol["symbol-placement"]),"symbol-spacing":new zt(Le.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new zt(Le.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new tr(Le.layout_symbol["symbol-sort-key"]),"symbol-z-order":new zt(Le.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new zt(Le.layout_symbol["icon-allow-overlap"]),"icon-overlap":new zt(Le.layout_symbol["icon-overlap"]),"icon-ignore-placement":new zt(Le.layout_symbol["icon-ignore-placement"]),"icon-optional":new zt(Le.layout_symbol["icon-optional"]),"icon-rotation-alignment":new zt(Le.layout_symbol["icon-rotation-alignment"]),"icon-size":new tr(Le.layout_symbol["icon-size"]),"icon-text-fit":new zt(Le.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new zt(Le.layout_symbol["icon-text-fit-padding"]),"icon-image":new tr(Le.layout_symbol["icon-image"]),"icon-rotate":new tr(Le.layout_symbol["icon-rotate"]),"icon-padding":new tr(Le.layout_symbol["icon-padding"]),"icon-keep-upright":new zt(Le.layout_symbol["icon-keep-upright"]),"icon-offset":new tr(Le.layout_symbol["icon-offset"]),"icon-anchor":new tr(Le.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new zt(Le.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new zt(Le.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new zt(Le.layout_symbol["text-rotation-alignment"]),"text-field":new tr(Le.layout_symbol["text-field"]),"text-font":new tr(Le.layout_symbol["text-font"]),"text-size":new tr(Le.layout_symbol["text-size"]),"text-max-width":new tr(Le.layout_symbol["text-max-width"]),"text-line-height":new zt(Le.layout_symbol["text-line-height"]),"text-letter-spacing":new tr(Le.layout_symbol["text-letter-spacing"]),"text-justify":new tr(Le.layout_symbol["text-justify"]),"text-radial-offset":new tr(Le.layout_symbol["text-radial-offset"]),"text-variable-anchor":new zt(Le.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new tr(Le.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new tr(Le.layout_symbol["text-anchor"]),"text-max-angle":new zt(Le.layout_symbol["text-max-angle"]),"text-writing-mode":new zt(Le.layout_symbol["text-writing-mode"]),"text-rotate":new tr(Le.layout_symbol["text-rotate"]),"text-padding":new zt(Le.layout_symbol["text-padding"]),"text-keep-upright":new zt(Le.layout_symbol["text-keep-upright"]),"text-transform":new tr(Le.layout_symbol["text-transform"]),"text-offset":new tr(Le.layout_symbol["text-offset"]),"text-allow-overlap":new zt(Le.layout_symbol["text-allow-overlap"]),"text-overlap":new zt(Le.layout_symbol["text-overlap"]),"text-ignore-placement":new zt(Le.layout_symbol["text-ignore-placement"]),"text-optional":new zt(Le.layout_symbol["text-optional"])})}};class Nn{constructor(o){if(o.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=o.property.overrides?o.property.overrides.runtimeType:Ha,this.defaultValue=o}evaluate(o){if(o.formattedSection){const c=this.defaultValue.property.overrides;if(c&&c.hasOverride(o.formattedSection))return c.getOverride(o.formattedSection)}return o.feature&&o.featureState?this.defaultValue.evaluate(o.feature,o.featureState):this.defaultValue.property.specification.default}eachChild(o){this.defaultValue.isConstant()||o(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Dt("FormatSectionOverride",Nn,{omit:["defaultValue"]});class Vr extends Ln{constructor(o){super(o,wr)}recalculate(o,c){if(super.recalculate(o,c),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const f=this.layout.get("text-writing-mode");if(f){const _=[];for(const w of f)_.indexOf(w)<0&&_.push(w);this.layout._values["text-writing-mode"]=_}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(o,c,f,_){const w=this.layout.get(o).evaluate(c,{},f,_),E=this._unevaluatedLayout._values[o];return E.isDataDriven()||ol(E.value)||!w?w:(function(M,R){return R.replace(/{([^{}]+)}/g,((D,z)=>M&&z in M?String(M[z]):""))})(c.properties,w)}createBucket(o){return new Kt(o)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const o of wr.paint.overridableProperties){if(!Vr.hasPaintOverride(this.layout,o))continue;const c=this.paint.get(o),f=new Nn(c),_=new Ic(f,c.property.specification);let w=null;w=c.value.kind==="constant"||c.value.kind==="source"?new Dl("source",_):new Nl("composite",_,c.value.zoomStops),this.paint._values[o]=new os(c.property,w,c.parameters)}}_handleOverridablePaintPropertyUpdate(o,c,f){return!(!this.layout||c.isDataDriven()||f.isDataDriven())&&Vr.hasPaintOverride(this.layout,o)}static hasPaintOverride(o,c){const f=o.get("text-field"),_=wr.paint.properties[c];let w=!1;const E=M=>{for(const R of M)if(_.overrides&&_.overrides.hasOverride(R))return void(w=!0)};if(f.value.kind==="constant"&&f.value.value instanceof Fi)E(f.value.value.sections);else if(f.value.kind==="source"){const M=D=>{w||(D instanceof Fs&&lr(D.value)===xs?E(D.value.sections):D instanceof Pl?E(D.sections):D.eachChild(M))},R=f.value;R._styleExpression&&M(R._styleExpression.expression)}return w}}let Xl;var Z1={get paint(){return Xl=Xl||new Bn({"background-color":new zt(Le.paint_background["background-color"]),"background-pattern":new Jo(Le.paint_background["background-pattern"]),"background-opacity":new zt(Le.paint_background["background-opacity"])})}};class gB extends Ln{constructor(o){super(o,Z1)}}let AE;var _B={get paint(){return AE=AE||new Bn({"raster-opacity":new zt(Le.paint_raster["raster-opacity"]),"raster-hue-rotate":new zt(Le.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new zt(Le.paint_raster["raster-brightness-min"]),"raster-brightness-max":new zt(Le.paint_raster["raster-brightness-max"]),"raster-saturation":new zt(Le.paint_raster["raster-saturation"]),"raster-contrast":new zt(Le.paint_raster["raster-contrast"]),"raster-resampling":new zt(Le.paint_raster["raster-resampling"]),"raster-fade-duration":new zt(Le.paint_raster["raster-fade-duration"])})}};class yB extends Ln{constructor(o){super(o,_B)}}class vB extends Ln{constructor(o){super(o,{}),this.onAdd=c=>{this.implementation.onAdd&&this.implementation.onAdd(c,c.painter.context.gl)},this.onRemove=c=>{this.implementation.onRemove&&this.implementation.onRemove(c,c.painter.context.gl)},this.implementation=o}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class bB{constructor(o){this._methodToThrottle=o,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._methodToThrottle()}),0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const xB={once:!0},X1=63710088e-1;class Gh{constructor(o,c){if(isNaN(o)||isNaN(c))throw new Error(`Invalid LngLat object: (${o}, ${c})`);if(this.lng=+o,this.lat=+c,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Gh(Ht(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(o){const c=Math.PI/180,f=this.lat*c,_=o.lat*c,w=Math.sin(f)*Math.sin(_)+Math.cos(f)*Math.cos(_)*Math.cos((o.lng-this.lng)*c);return X1*Math.acos(Math.min(w,1))}static convert(o){if(o instanceof Gh)return o;if(Array.isArray(o)&&(o.length===2||o.length===3))return new Gh(Number(o[0]),Number(o[1]));if(!Array.isArray(o)&&typeof o=="object"&&o!==null)return new Gh(Number("lng"in o?o.lng:o.lon),Number(o.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const TE=2*Math.PI*X1;function SE(u){return TE*Math.cos(u*Math.PI/180)}function CE(u){return(180+u)/360}function ME(u){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+u*Math.PI/360)))/360}function PE(u,o){return u/SE(o)}function K1(u){return 360/Math.PI*Math.atan(Math.exp((180-360*u)*Math.PI/180))-90}function RE(u,o){return u*SE(K1(o))}class Eg{constructor(o,c,f=0){this.x=+o,this.y=+c,this.z=+f}static fromLngLat(o,c=0){const f=Gh.convert(o);return new Eg(CE(f.lng),ME(f.lat),PE(c,f.lat))}toLngLat(){return new Gh(360*this.x-180,K1(this.y))}toAltitude(){return RE(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/TE*(o=K1(this.y),1/Math.cos(o*Math.PI/180));var o}}function IE(u,o,c){var f=2*Math.PI*6378137/256/Math.pow(2,c);return[u*f-2*Math.PI*6378137/2,o*f-2*Math.PI*6378137/2]}class Y1{constructor(o,c,f){if(!(function(_,w,E){return!(_<0||_>25||E<0||E>=Math.pow(2,_)||w<0||w>=Math.pow(2,_))})(o,c,f))throw new Error(`x=${c}, y=${f}, z=${o} outside of bounds. 0<=x<${Math.pow(2,o)}, 0<=y<${Math.pow(2,o)} 0<=z<=25 `);this.z=o,this.x=c,this.y=f,this.key=Af(0,o,o,c,f)}equals(o){return this.z===o.z&&this.x===o.x&&this.y===o.y}url(o,c,f){const _=(E=this.y,M=this.z,R=IE(256*(w=this.x),256*(E=Math.pow(2,M)-E-1),M),D=IE(256*(w+1),256*(E+1),M),R[0]+","+R[1]+","+D[0]+","+D[1]);var w,E,M,R,D;const z=(function(V,Z,X){let Y,re="";for(let he=V;he>0;he--)Y=1<<he-1,re+=(Z&Y?1:0)+(X&Y?2:0);return re})(this.z,this.x,this.y);return o[(this.x+this.y)%o.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(f==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,c>1?"@2x":"").replace(/{quadkey}/g,z).replace(/{bbox-epsg-3857}/g,_)}isChildOf(o){const c=this.z-o.z;return c>0&&o.x===this.x>>c&&o.y===this.y>>c}getTilePoint(o){const c=Math.pow(2,this.z);return new v((o.x*c-this.x)*wt,(o.y*c-this.y)*wt)}toString(){return`${this.z}/${this.x}/${this.y}`}}class kE{constructor(o,c){this.wrap=o,this.canonical=c,this.key=Af(o,c.z,c.z,c.x,c.y)}}class Da{constructor(o,c,f,_,w){if(this.terrainRttPosMatrix32f=null,o<f)throw new Error(`overscaledZ should be >= z; overscaledZ = ${o}; z = ${f}`);this.overscaledZ=o,this.wrap=c,this.canonical=new Y1(f,+_,+w),this.key=Af(c,o,f,_,w)}clone(){return new Da(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(o){return this.overscaledZ===o.overscaledZ&&this.wrap===o.wrap&&this.canonical.equals(o.canonical)}scaledTo(o){if(o>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${o}; overscaledZ = ${this.overscaledZ}`);const c=this.canonical.z-o;return o>this.canonical.z?new Da(o,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Da(o,this.wrap,o,this.canonical.x>>c,this.canonical.y>>c)}calculateScaledKey(o,c){if(o>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${o}; overscaledZ = ${this.overscaledZ}`);const f=this.canonical.z-o;return o>this.canonical.z?Af(this.wrap*+c,o,this.canonical.z,this.canonical.x,this.canonical.y):Af(this.wrap*+c,o,o,this.canonical.x>>f,this.canonical.y>>f)}isChildOf(o){if(o.wrap!==this.wrap)return!1;const c=this.canonical.z-o.canonical.z;return o.overscaledZ===0||o.overscaledZ<this.overscaledZ&&o.canonical.x===this.canonical.x>>c&&o.canonical.y===this.canonical.y>>c}children(o){if(this.overscaledZ>=o)return[new Da(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const c=this.canonical.z+1,f=2*this.canonical.x,_=2*this.canonical.y;return[new Da(c,this.wrap,c,f,_),new Da(c,this.wrap,c,f+1,_),new Da(c,this.wrap,c,f,_+1),new Da(c,this.wrap,c,f+1,_+1)]}isLessThan(o){return this.wrap<o.wrap||!(this.wrap>o.wrap)&&(this.overscaledZ<o.overscaledZ||!(this.overscaledZ>o.overscaledZ)&&(this.canonical.x<o.canonical.x||!(this.canonical.x>o.canonical.x)&&this.canonical.y<o.canonical.y))}wrapped(){return new Da(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(o){return new Da(this.overscaledZ,o,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new kE(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(o){return this.canonical.getTilePoint(new Eg(o.x-this.wrap,o.y))}}function Af(u,o,c,f,_){(u*=2)<0&&(u=-1*u-1);const w=1<<c;return(w*w*u+w*_+f).toString(36)+c.toString(36)+o.toString(36)}function Ag(u,o){return o?u.properties[o]:u.id}Dt("CanonicalTileID",Y1),Dt("OverscaledTileID",Da,{omit:["terrainRttPosMatrix32f"]});class bp{constructor(){this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0}extend(o){return this.minX=Math.min(this.minX,o.x),this.minY=Math.min(this.minY,o.y),this.maxX=Math.max(this.maxX,o.x),this.maxY=Math.max(this.maxY,o.y),this}expandBy(o){return this.minX-=o,this.minY-=o,this.maxX+=o,this.maxY+=o,(this.minX>this.maxX||this.minY>this.maxY)&&(this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0),this}shrinkBy(o){return this.expandBy(-o)}map(o){const c=new bp;return c.extend(o(new v(this.minX,this.minY))),c.extend(o(new v(this.maxX,this.minY))),c.extend(o(new v(this.minX,this.maxY))),c.extend(o(new v(this.maxX,this.maxY))),c}static fromPoints(o){const c=new bp;for(const f of o)c.extend(f);return c}contains(o){return o.x>=this.minX&&o.x<=this.maxX&&o.y>=this.minY&&o.y<=this.maxY}empty(){return this.minX>this.maxX}width(){return this.maxX-this.minX}height(){return this.maxY-this.minY}covers(o){return!this.empty()&&!o.empty()&&o.minX>=this.minX&&o.maxX<=this.maxX&&o.minY>=this.minY&&o.maxY<=this.maxY}intersects(o){return!this.empty()&&!o.empty()&&o.minX<=this.maxX&&o.maxX>=this.minX&&o.minY<=this.maxY&&o.maxY>=this.minY}}class BE{constructor(o){this._stringToNumber={},this._numberToString=[];for(let c=0;c<o.length;c++){const f=o[c];this._stringToNumber[f]=c,this._numberToString[c]=f}}encode(o){return this._stringToNumber[o]}decode(o){if(o>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${o} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[o]}}class LE{constructor(o,c,f,_,w){this.type="Feature",this._vectorTileFeature=o,o._z=c,o._x=f,o._y=_,this.properties=o.properties,this.id=w}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(o){this._geometry=o}toJSON(){const o={geometry:this.geometry};for(const c in this)c!=="_geometry"&&c!=="_vectorTileFeature"&&(o[c]=this[c]);return o}}class DE{constructor(o,c){this.tileID=o,this.x=o.canonical.x,this.y=o.canonical.y,this.z=o.canonical.z,this.grid=new Ko(wt,16,0),this.grid3D=new Ko(wt,16,0),this.featureIndexArray=new Pe,this.promoteId=c}insert(o,c,f,_,w,E){const M=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(f,_,w);const R=E?this.grid3D:this.grid;for(let D=0;D<c.length;D++){const z=c[D],V=[1/0,1/0,-1/0,-1/0];for(let Z=0;Z<z.length;Z++){const X=z[Z];V[0]=Math.min(V[0],X.x),V[1]=Math.min(V[1],X.y),V[2]=Math.max(V[2],X.x),V[3]=Math.max(V[3],X.y)}V[0]<wt&&V[1]<wt&&V[2]>=0&&V[3]>=0&&R.insert(M,V[0],V[1],V[2],V[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new gf(new mp(this.rawTileData)).layers,this.sourceLayerCoder=new BE(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(o,c,f,_){this.loadVTLayers();const w=o.params,E=wt/o.tileSize/o.scale,M=$o(w.filter),R=o.queryGeometry,D=o.queryPadding*E,z=bp.fromPoints(R),V=this.grid.query(z.minX-D,z.minY-D,z.maxX+D,z.maxY+D),Z=bp.fromPoints(o.cameraQueryGeometry).expandBy(D),X=this.grid3D.query(Z.minX,Z.minY,Z.maxX,Z.maxY,((he,ye,Ne,Ee)=>(function(Me,Xe,st,ft,It){for(const Pt of Me)if(Xe<=Pt.x&&st<=Pt.y&&ft>=Pt.x&&It>=Pt.y)return!0;const At=[new v(Xe,st),new v(Xe,It),new v(ft,It),new v(ft,st)];if(Me.length>2){for(const Pt of At)if(zu(Me,Pt))return!0}for(let Pt=0;Pt<Me.length-1;Pt++)if(Qm(Me[Pt],Me[Pt+1],At))return!0;return!1})(o.cameraQueryGeometry,he-D,ye-D,Ne+D,Ee+D)));for(const he of X)V.push(he);V.sort(wB);const Y={};let re;for(let he=0;he<V.length;he++){const ye=V[he];if(ye===re)continue;re=ye;const Ne=this.featureIndexArray.get(ye);let Ee=null;this.loadMatchingFeature(Y,Ne.bucketIndex,Ne.sourceLayerIndex,Ne.featureIndex,M,w.layers,w.availableImages,c,f,_,((Me,Xe,st)=>(Ee||(Ee=ta(Me)),Xe.queryIntersectsFeature({queryGeometry:R,feature:Me,featureState:st,geometry:Ee,zoom:this.z,transform:o.transform,pixelsToTileUnits:E,pixelPosMatrix:o.pixelPosMatrix,unwrappedTileID:this.tileID.toUnwrapped(),getElevation:o.getElevation}))))}return Y}loadMatchingFeature(o,c,f,_,w,E,M,R,D,z,V){const Z=this.bucketLayerIDs[c];if(E&&!Z.some((he=>E.has(he))))return;const X=this.sourceLayerCoder.decode(f),Y=this.vtLayers[X].feature(_);if(w.needGeometry){const he=ka(Y,!0);if(!w.filter(new Qr(this.tileID.overscaledZ),he,this.tileID.canonical))return}else if(!w.filter(new Qr(this.tileID.overscaledZ),Y))return;const re=this.getId(Y,X);for(let he=0;he<Z.length;he++){const ye=Z[he];if(E&&!E.has(ye))continue;const Ne=R[ye];if(!Ne)continue;let Ee={};re&&z&&(Ee=z.getState(Ne.sourceLayer||"_geojsonTileLayer",re));const Me=dr({},D[ye]);Me.paint=NE(Me.paint,Ne.paint,Y,Ee,M),Me.layout=NE(Me.layout,Ne.layout,Y,Ee,M);const Xe=!V||V(Y,Ne,Ee);if(!Xe)continue;const st=new LE(Y,this.z,this.x,this.y,re);st.layer=Me;let ft=o[ye];ft===void 0&&(ft=o[ye]=[]),ft.push({featureIndex:_,feature:st,intersectionZ:Xe})}}lookupSymbolFeatures(o,c,f,_,w,E,M,R){const D={};this.loadVTLayers();const z=$o(w);for(const V of o)this.loadMatchingFeature(D,f,_,V,z,E,M,R,c);return D}hasLayer(o){for(const c of this.bucketLayerIDs)for(const f of c)if(o===f)return!0;return!1}getId(o,c){var f;let _=o.id;return this.promoteId&&(_=o.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[c]],typeof _=="boolean"&&(_=Number(_)),_===void 0&&!((f=o.properties)===null||f===void 0)&&f.cluster&&this.promoteId&&(_=Number(o.properties.cluster_id))),_}}function NE(u,o,c,f,_){return Lr(u,((w,E)=>{const M=o instanceof Du?o.get(E):null;return M&&M.evaluate?M.evaluate(c,f,_):M}))}function wB(u,o){return o-u}function OE(u,o,c,f,_){const w=[];for(let E=0;E<u.length;E++){const M=u[E];let R;for(let D=0;D<M.length-1;D++){let z=M[D],V=M[D+1];z.x<o&&V.x<o||(z.x<o?z=new v(o,z.y+(o-z.x)/(V.x-z.x)*(V.y-z.y))._round():V.x<o&&(V=new v(o,z.y+(o-z.x)/(V.x-z.x)*(V.y-z.y))._round()),z.y<c&&V.y<c||(z.y<c?z=new v(z.x+(c-z.y)/(V.y-z.y)*(V.x-z.x),c)._round():V.y<c&&(V=new v(z.x+(c-z.y)/(V.y-z.y)*(V.x-z.x),c)._round()),z.x>=f&&V.x>=f||(z.x>=f?z=new v(f,z.y+(f-z.x)/(V.x-z.x)*(V.y-z.y))._round():V.x>=f&&(V=new v(f,z.y+(f-z.x)/(V.x-z.x)*(V.y-z.y))._round()),z.y>=_&&V.y>=_||(z.y>=_?z=new v(z.x+(_-z.y)/(V.y-z.y)*(V.x-z.x),_)._round():V.y>=_&&(V=new v(z.x+(_-z.y)/(V.y-z.y)*(V.x-z.x),_)._round()),R&&z.equals(R[R.length-1])||(R=[z],w.push(R)),R.push(V)))))}}return w}Dt("FeatureIndex",DE,{omit:["rawTileData","sourceLayerCoder"]});class Hh extends v{constructor(o,c,f,_){super(o,c),this.angle=f,_!==void 0&&(this.segment=_)}clone(){return new Hh(this.x,this.y,this.angle,this.segment)}}function FE(u,o,c,f,_){if(o.segment===void 0||c===0)return!0;let w=o,E=o.segment+1,M=0;for(;M>-c/2;){if(E--,E<0)return!1;M-=u[E].dist(w),w=u[E]}M+=u[E].dist(u[E+1]),E++;const R=[];let D=0;for(;M<c/2;){const z=u[E],V=u[E+1];if(!V)return!1;let Z=u[E-1].angleTo(z)-z.angleTo(V);for(Z=Math.abs((Z+3*Math.PI)%(2*Math.PI)-Math.PI),R.push({distance:M,angleDelta:Z}),D+=Z;M-R[0].distance>f;)D-=R.shift().angleDelta;if(D>_)return!1;E++,M+=z.dist(V)}return!0}function zE(u){let o=0;for(let c=0;c<u.length-1;c++)o+=u[c].dist(u[c+1]);return o}function UE(u,o,c){return u?.6*o*c:0}function jE(u,o){return Math.max(u?u.right-u.left:0,o?o.right-o.left:0)}function EB(u,o,c,f,_,w){const E=UE(c,_,w),M=jE(c,f)*w;let R=0;const D=zE(u)/2;for(let z=0;z<u.length-1;z++){const V=u[z],Z=u[z+1],X=V.dist(Z);if(R+X>D){const Y=(D-R)/X,re=Co.number(V.x,Z.x,Y),he=Co.number(V.y,Z.y,Y),ye=new Hh(re,he,Z.angleTo(V),z);return ye._round(),!E||FE(u,ye,M,E,o)?ye:void 0}R+=X}}function AB(u,o,c,f,_,w,E,M,R){const D=UE(f,w,E),z=jE(f,_),V=z*E,Z=u[0].x===0||u[0].x===R||u[0].y===0||u[0].y===R;return o-V<o/4&&(o=V+o/4),VE(u,Z?o/2*M%o:(z/2+2*w)*E*M%o,o,D,c,V,Z,!1,R)}function VE(u,o,c,f,_,w,E,M,R){const D=w/2,z=zE(u);let V=0,Z=o-c,X=[];for(let Y=0;Y<u.length-1;Y++){const re=u[Y],he=u[Y+1],ye=re.dist(he),Ne=he.angleTo(re);for(;Z+c<V+ye;){Z+=c;const Ee=(Z-V)/ye,Me=Co.number(re.x,he.x,Ee),Xe=Co.number(re.y,he.y,Ee);if(Me>=0&&Me<R&&Xe>=0&&Xe<R&&Z-D>=0&&Z+D<=z){const st=new Hh(Me,Xe,Ne,Y);st._round(),f&&!FE(u,st,w,f,_)||X.push(st)}}V+=ye}return M||X.length||E||(X=VE(u,V/2,c,f,_,w,E,!0,R)),X}function GE(u,o,c,f){const _=[],w=u.image,E=w.pixelRatio,M=w.paddedRect.w-2,R=w.paddedRect.h-2;let D={x1:u.left,y1:u.top,x2:u.right,y2:u.bottom};const z=w.stretchX||[[0,M]],V=w.stretchY||[[0,R]],Z=(ct,ur)=>ct+ur[1]-ur[0],X=z.reduce(Z,0),Y=V.reduce(Z,0),re=M-X,he=R-Y;let ye=0,Ne=X,Ee=0,Me=Y,Xe=0,st=re,ft=0,It=he;if(w.content&&f){const ct=w.content,ur=ct[2]-ct[0],vr=ct[3]-ct[1];(w.textFitWidth||w.textFitHeight)&&(D=ot(u)),ye=by(z,0,ct[0]),Ee=by(V,0,ct[1]),Ne=by(z,ct[0],ct[2]),Me=by(V,ct[1],ct[3]),Xe=ct[0]-ye,ft=ct[1]-Ee,st=ur-Ne,It=vr-Me}const At=D.x1,Pt=D.y1,Yt=D.x2-At,St=D.y2-Pt,Rt=(ct,ur,vr,sr)=>{const Vt=xy(ct.stretch-ye,Ne,Yt,At),Nr=wy(ct.fixed-Xe,st,ct.stretch,X),Ki=xy(ur.stretch-Ee,Me,St,Pt),On=wy(ur.fixed-ft,It,ur.stretch,Y),ks=xy(vr.stretch-ye,Ne,Yt,At),Na=wy(vr.fixed-Xe,st,vr.stretch,X),Uo=xy(sr.stretch-Ee,Me,St,Pt),fs=wy(sr.fixed-ft,It,sr.stretch,Y),ji=new v(Vt,Ki),Hn=new v(ks,Ki),ms=new v(ks,Uo),gs=new v(Vt,Uo),uo=new v(Nr/E,On/E),Oa=new v(Na/E,fs/E),Wn=o*Math.PI/180;if(Wn){const qn=Math.sin(Wn),$n=Math.cos(Wn),En=[$n,-qn,qn,$n];ji._matMult(En),Hn._matMult(En),gs._matMult(En),ms._matMult(En)}const jo=ct.stretch+ct.fixed,Fn=ur.stretch+ur.fixed;return{tl:ji,tr:Hn,bl:gs,br:ms,tex:{x:w.paddedRect.x+1+jo,y:w.paddedRect.y+1+Fn,w:vr.stretch+vr.fixed-jo,h:sr.stretch+sr.fixed-Fn},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:uo,pixelOffsetBR:Oa,minFontScaleX:st/E/Yt,minFontScaleY:It/E/St,isSDF:c}};if(f&&(w.stretchX||w.stretchY)){const ct=HE(z,re,X),ur=HE(V,he,Y);for(let vr=0;vr<ct.length-1;vr++){const sr=ct[vr],Vt=ct[vr+1];for(let Nr=0;Nr<ur.length-1;Nr++)_.push(Rt(sr,ur[Nr],Vt,ur[Nr+1]))}}else _.push(Rt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:M+1},{fixed:0,stretch:R+1}));return _}function by(u,o,c){let f=0;for(const _ of u)f+=Math.max(o,Math.min(c,_[1]))-Math.max(o,Math.min(c,_[0]));return f}function HE(u,o,c){const f=[{fixed:-1,stretch:0}];for(const[_,w]of u){const E=f[f.length-1];f.push({fixed:_-E.stretch,stretch:E.stretch}),f.push({fixed:_-E.stretch,stretch:E.stretch+(w-_)})}return f.push({fixed:o+1,stretch:c}),f}function xy(u,o,c,f){return u/o*c+f}function wy(u,o,c,f){return u-o*c/f}Dt("Anchor",Hh);class Ey{constructor(o,c,f,_,w,E,M,R,D,z){var V;if(this.boxStartIndex=o.length,D){let Z=E.top,X=E.bottom;const Y=E.collisionPadding;Y&&(Z-=Y[1],X+=Y[3]);let re=X-Z;re>0&&(re=Math.max(10,re),this.circleDiameter=re)}else{const Z=!((V=E.image)===null||V===void 0)&&V.content&&(E.image.textFitWidth||E.image.textFitHeight)?ot(E):{x1:E.left,y1:E.top,x2:E.right,y2:E.bottom};Z.y1=Z.y1*M-R[0],Z.y2=Z.y2*M+R[2],Z.x1=Z.x1*M-R[3],Z.x2=Z.x2*M+R[1];const X=E.collisionPadding;if(X&&(Z.x1-=X[0]*M,Z.y1-=X[1]*M,Z.x2+=X[2]*M,Z.y2+=X[3]*M),z){const Y=new v(Z.x1,Z.y1),re=new v(Z.x2,Z.y1),he=new v(Z.x1,Z.y2),ye=new v(Z.x2,Z.y2),Ne=z*Math.PI/180;Y._rotate(Ne),re._rotate(Ne),he._rotate(Ne),ye._rotate(Ne),Z.x1=Math.min(Y.x,re.x,he.x,ye.x),Z.x2=Math.max(Y.x,re.x,he.x,ye.x),Z.y1=Math.min(Y.y,re.y,he.y,ye.y),Z.y2=Math.max(Y.y,re.y,he.y,ye.y)}o.emplaceBack(c.x,c.y,Z.x1,Z.y1,Z.x2,Z.y2,f,_,w)}this.boxEndIndex=o.length}}class TB{constructor(o=[],c=(f,_)=>f<_?-1:f>_?1:0){if(this.data=o,this.length=this.data.length,this.compare=c,this.length>0)for(let f=(this.length>>1)-1;f>=0;f--)this._down(f)}push(o){this.data.push(o),this._up(this.length++)}pop(){if(this.length===0)return;const o=this.data[0],c=this.data.pop();return--this.length>0&&(this.data[0]=c,this._down(0)),o}peek(){return this.data[0]}_up(o){const{data:c,compare:f}=this,_=c[o];for(;o>0;){const w=o-1>>1,E=c[w];if(f(_,E)>=0)break;c[o]=E,o=w}c[o]=_}_down(o){const{data:c,compare:f}=this,_=this.length>>1,w=c[o];for(;o<_;){let E=1+(o<<1);const M=E+1;if(M<this.length&&f(c[M],c[E])<0&&(E=M),f(c[E],w)>=0)break;c[o]=c[E],o=E}c[o]=w}}function SB(u,o=1,c=!1){const f=bp.fromPoints(u[0]),_=Math.min(f.width(),f.height());let w=_/2;const E=new TB([],CB),{minX:M,minY:R,maxX:D,maxY:z}=f;if(_===0)return new v(M,R);for(let X=M;X<D;X+=_)for(let Y=R;Y<z;Y+=_)E.push(new Tf(X+w,Y+w,w,u));let V=(function(X){let Y=0,re=0,he=0;const ye=X[0];for(let Ne=0,Ee=ye.length,Me=Ee-1;Ne<Ee;Me=Ne++){const Xe=ye[Ne],st=ye[Me],ft=Xe.x*st.y-st.x*Xe.y;re+=(Xe.x+st.x)*ft,he+=(Xe.y+st.y)*ft,Y+=3*ft}return new Tf(re/Y,he/Y,0,X)})(u),Z=E.length;for(;E.length;){const X=E.pop();(X.d>V.d||!V.d)&&(V=X,c&&console.log("found best %d after %d probes",Math.round(1e4*X.d)/1e4,Z)),X.max-V.d<=o||(w=X.h/2,E.push(new Tf(X.p.x-w,X.p.y-w,w,u)),E.push(new Tf(X.p.x+w,X.p.y-w,w,u)),E.push(new Tf(X.p.x-w,X.p.y+w,w,u)),E.push(new Tf(X.p.x+w,X.p.y+w,w,u)),Z+=4)}return c&&(console.log(`num probes: ${Z}`),console.log(`best distance: ${V.d}`)),V.p}function CB(u,o){return o.max-u.max}function Tf(u,o,c,f){this.p=new v(u,o),this.h=c,this.d=(function(_,w){let E=!1,M=1/0;for(let R=0;R<w.length;R++){const D=w[R];for(let z=0,V=D.length,Z=V-1;z<V;Z=z++){const X=D[z],Y=D[Z];X.y>_.y!=Y.y>_.y&&_.x<(Y.x-X.x)*(_.y-X.y)/(Y.y-X.y)+X.x&&(E=!E),M=Math.min(M,Ym(_,X,Y))}}return(E?1:-1)*Math.sqrt(M)})(this.p,f),this.max=this.d+this.h*Math.SQRT2}var Is;h.aE=void 0,(Is=h.aE||(h.aE={}))[Is.center=1]="center",Is[Is.left=2]="left",Is[Is.right=3]="right",Is[Is.top=4]="top",Is[Is.bottom=5]="bottom",Is[Is["top-left"]=6]="top-left",Is[Is["top-right"]=7]="top-right",Is[Is["bottom-left"]=8]="bottom-left",Is[Is["bottom-right"]=9]="bottom-right";const J1=Number.POSITIVE_INFINITY;function WE(u,o){return o[1]!==J1?(function(c,f,_){let w=0,E=0;switch(f=Math.abs(f),_=Math.abs(_),c){case"top-right":case"top-left":case"top":E=_-7;break;case"bottom-right":case"bottom-left":case"bottom":E=7-_}switch(c){case"top-right":case"bottom-right":case"right":w=-f;break;case"top-left":case"bottom-left":case"left":w=f}return[w,E]})(u,o[0],o[1]):(function(c,f){let _=0,w=0;f<0&&(f=0);const E=f/Math.SQRT2;switch(c){case"top-right":case"top-left":w=E-7;break;case"bottom-right":case"bottom-left":w=7-E;break;case"bottom":w=7-f;break;case"top":w=f-7}switch(c){case"top-right":case"bottom-right":_=-E;break;case"top-left":case"bottom-left":_=E;break;case"left":_=f;break;case"right":_=-f}return[_,w]})(u,o[0])}function qE(u,o,c){var f;const _=u.layout,w=(f=_.get("text-variable-anchor-offset"))===null||f===void 0?void 0:f.evaluate(o,{},c);if(w){const M=w.values,R=[];for(let D=0;D<M.length;D+=2){const z=R[D]=M[D],V=M[D+1].map((Z=>Z*gn));z.startsWith("top")?V[1]-=7:z.startsWith("bottom")&&(V[1]+=7),R[D+1]=V}return new cn(R)}const E=_.get("text-variable-anchor");if(E){let M;M=u._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[_.get("text-radial-offset").evaluate(o,{},c)*gn,J1]:_.get("text-offset").evaluate(o,{},c).map((D=>D*gn));const R=[];for(const D of E)R.push(D,WE(D,M));return new cn(R)}return null}function Q1(u){switch(u){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function MB(u,o,c,f,_,w,E,M,R,D,z,V){let Z=w.textMaxSize.evaluate(o,{});Z===void 0&&(Z=E);const X=u.layers[0].layout,Y=X.get("icon-offset").evaluate(o,{},z),re=ZE(c.horizontal),he=E/24,ye=u.tilePixelRatio*he,Ne=u.tilePixelRatio*Z/24,Ee=u.tilePixelRatio*M,Me=u.tilePixelRatio*X.get("symbol-spacing"),Xe=X.get("text-padding")*u.tilePixelRatio,st=(function(vr,sr,Vt,Nr=1){const Ki=vr.get("icon-padding").evaluate(sr,{},Vt),On=Ki&&Ki.values;return[On[0]*Nr,On[1]*Nr,On[2]*Nr,On[3]*Nr]})(X,o,z,u.tilePixelRatio),ft=X.get("text-max-angle")/180*Math.PI,It=X.get("text-rotation-alignment")!=="viewport"&&X.get("symbol-placement")!=="point",At=X.get("icon-rotation-alignment")==="map"&&X.get("symbol-placement")!=="point",Pt=X.get("symbol-placement"),Yt=Me/2,St=X.get("icon-text-fit");let Rt;f&&St!=="none"&&(u.allowVerticalPlacement&&c.vertical&&(Rt=xt(f,c.vertical,St,X.get("icon-text-fit-padding"),Y,he)),re&&(f=xt(f,re,St,X.get("icon-text-fit-padding"),Y,he)));const ct=z?V.line.getGranularityForZoomLevel(z.z):1,ur=(vr,sr)=>{sr.x<0||sr.x>=wt||sr.y<0||sr.y>=wt||(function(Vt,Nr,Ki,On,ks,Na,Uo,fs,ji,Hn,ms,gs,uo,Oa,Wn,jo,Fn,qn,$n,En,Ei,Kl,Sf,Yl,IB){const Cf=Vt.addToLineVertexArray(Nr,Ki);let xp,Mf,Pf,Rf,JE=0,QE=0,eA=0,tA=0,av=-1,lv=-1;const Xu={};let rA=Gl("");if(Vt.allowVerticalPlacement&&On.vertical){const Ks=fs.layout.get("text-rotate").evaluate(Ei,{},Yl)+90;Pf=new Ey(ji,Nr,Hn,ms,gs,On.vertical,uo,Oa,Wn,Ks),Uo&&(Rf=new Ey(ji,Nr,Hn,ms,gs,Uo,Fn,qn,Wn,Ks))}if(ks){const Ks=fs.layout.get("icon-rotate").evaluate(Ei,{}),gl=fs.layout.get("icon-text-fit")!=="none",wp=GE(ks,Ks,Sf,gl),$c=Uo?GE(Uo,Ks,Sf,gl):void 0;Mf=new Ey(ji,Nr,Hn,ms,gs,ks,Fn,qn,!1,Ks),JE=4*wp.length;const Ep=Vt.iconSizeData;let Zc=null;Ep.kind==="source"?(Zc=[yt*fs.layout.get("icon-size").evaluate(Ei,{})],Zc[0]>gt&&ri(`${Vt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):Ep.kind==="composite"&&(Zc=[yt*Kl.compositeIconSizes[0].evaluate(Ei,{},Yl),yt*Kl.compositeIconSizes[1].evaluate(Ei,{},Yl)],(Zc[0]>gt||Zc[1]>gt)&&ri(`${Vt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),Vt.addSymbols(Vt.icon,wp,Zc,En,$n,Ei,h.ao.none,Nr,Cf.lineStartIndex,Cf.lineLength,-1,Yl),av=Vt.icon.placedSymbolArray.length-1,$c&&(QE=4*$c.length,Vt.addSymbols(Vt.icon,$c,Zc,En,$n,Ei,h.ao.vertical,Nr,Cf.lineStartIndex,Cf.lineLength,-1,Yl),lv=Vt.icon.placedSymbolArray.length-1)}const iA=Object.keys(On.horizontal);for(const Ks of iA){const gl=On.horizontal[Ks];if(!xp){rA=Gl(gl.text);const $c=fs.layout.get("text-rotate").evaluate(Ei,{},Yl);xp=new Ey(ji,Nr,Hn,ms,gs,gl,uo,Oa,Wn,$c)}const wp=gl.positionedLines.length===1;if(eA+=$E(Vt,Nr,gl,Na,fs,Wn,Ei,jo,Cf,On.vertical?h.ao.horizontal:h.ao.horizontalOnly,wp?iA:[Ks],Xu,av,Kl,Yl),wp)break}On.vertical&&(tA+=$E(Vt,Nr,On.vertical,Na,fs,Wn,Ei,jo,Cf,h.ao.vertical,["vertical"],Xu,lv,Kl,Yl));const kB=xp?xp.boxStartIndex:Vt.collisionBoxArray.length,BB=xp?xp.boxEndIndex:Vt.collisionBoxArray.length,LB=Pf?Pf.boxStartIndex:Vt.collisionBoxArray.length,DB=Pf?Pf.boxEndIndex:Vt.collisionBoxArray.length,NB=Mf?Mf.boxStartIndex:Vt.collisionBoxArray.length,OB=Mf?Mf.boxEndIndex:Vt.collisionBoxArray.length,FB=Rf?Rf.boxStartIndex:Vt.collisionBoxArray.length,zB=Rf?Rf.boxEndIndex:Vt.collisionBoxArray.length;let Jl=-1;const Ty=(Ks,gl)=>Ks&&Ks.circleDiameter?Math.max(Ks.circleDiameter,gl):gl;Jl=Ty(xp,Jl),Jl=Ty(Pf,Jl),Jl=Ty(Mf,Jl),Jl=Ty(Rf,Jl);const nA=Jl>-1?1:0;nA&&(Jl*=IB/gn),Vt.glyphOffsetArray.length>=Kt.MAX_GLYPHS&&ri("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Ei.sortKey!==void 0&&Vt.addToSortKeyRanges(Vt.symbolInstances.length,Ei.sortKey);const UB=qE(fs,Ei,Yl),[jB,VB]=(function(Ks,gl){const wp=Ks.length,$c=gl?.values;if($c?.length>0)for(let Ep=0;Ep<$c.length;Ep+=2){const Zc=$c[Ep+1];Ks.emplaceBack(h.aE[$c[Ep]],Zc[0],Zc[1])}return[wp,Ks.length]})(Vt.textAnchorOffsets,UB);Vt.symbolInstances.emplaceBack(Nr.x,Nr.y,Xu.right>=0?Xu.right:-1,Xu.center>=0?Xu.center:-1,Xu.left>=0?Xu.left:-1,Xu.vertical||-1,av,lv,rA,kB,BB,LB,DB,NB,OB,FB,zB,Hn,eA,tA,JE,QE,nA,0,uo,Jl,jB,VB)})(u,sr,vr,c,f,_,Rt,u.layers[0],u.collisionBoxArray,o.index,o.sourceLayerIndex,u.index,ye,[Xe,Xe,Xe,Xe],It,R,Ee,st,At,Y,o,w,D,z,E)};if(Pt==="line")for(const vr of OE(o.geometry,0,0,wt,wt)){const sr=Ii(vr,ct),Vt=AB(sr,Me,ft,c.vertical||re,f,24,Ne,u.overscaling,wt);for(const Nr of Vt)re&&PB(u,re.text,Yt,Nr)||ur(sr,Nr)}else if(Pt==="line-center"){for(const vr of o.geometry)if(vr.length>1){const sr=Ii(vr,ct),Vt=EB(sr,ft,c.vertical||re,f,24,Ne);Vt&&ur(sr,Vt)}}else if(o.type==="Polygon")for(const vr of Ac(o.geometry,0)){const sr=SB(vr,16);ur(Ii(vr[0],ct,!0),new Hh(sr.x,sr.y,0))}else if(o.type==="LineString")for(const vr of o.geometry){const sr=Ii(vr,ct);ur(sr,new Hh(sr[0].x,sr[0].y,0))}else if(o.type==="Point")for(const vr of o.geometry)for(const sr of vr)ur([sr],new Hh(sr.x,sr.y,0))}function $E(u,o,c,f,_,w,E,M,R,D,z,V,Z,X,Y){const re=(function(Ne,Ee,Me,Xe,st,ft,It,At){const Pt=Xe.layout.get("text-rotate").evaluate(ft,{})*Math.PI/180,Yt=[];for(const St of Ee.positionedLines)for(const Rt of St.positionedGlyphs){if(!Rt.rect)continue;const ct=Rt.rect||{};let ur=4,vr=!0,sr=1,Vt=0;const Nr=(st||At)&&Rt.vertical,Ki=Rt.metrics.advance*Rt.scale/2;if(At&&Ee.verticalizable&&(Vt=St.lineOffset/2-(Rt.imageName?-(gn-Rt.metrics.width*Rt.scale)/2:(Rt.scale-1)*gn)),Rt.imageName){const qn=It[Rt.imageName];vr=qn.sdf,sr=qn.pixelRatio,ur=1/sr}const On=st?[Rt.x+Ki,Rt.y]:[0,0];let ks=st?[0,0]:[Rt.x+Ki+Me[0],Rt.y+Me[1]-Vt],Na=[0,0];Nr&&(Na=ks,ks=[0,0]);const Uo=Rt.metrics.isDoubleResolution?2:1,fs=(Rt.metrics.left-ur)*Rt.scale-Ki+ks[0],ji=(-Rt.metrics.top-ur)*Rt.scale+ks[1],Hn=fs+ct.w/Uo*Rt.scale/sr,ms=ji+ct.h/Uo*Rt.scale/sr,gs=new v(fs,ji),uo=new v(Hn,ji),Oa=new v(fs,ms),Wn=new v(Hn,ms);if(Nr){const qn=new v(-Ki,Ki- -17),$n=-Math.PI/2,En=12-Ki,Ei=new v(22-En,-(Rt.imageName?En:0)),Kl=new v(...Na);gs._rotateAround($n,qn)._add(Ei)._add(Kl),uo._rotateAround($n,qn)._add(Ei)._add(Kl),Oa._rotateAround($n,qn)._add(Ei)._add(Kl),Wn._rotateAround($n,qn)._add(Ei)._add(Kl)}if(Pt){const qn=Math.sin(Pt),$n=Math.cos(Pt),En=[$n,-qn,qn,$n];gs._matMult(En),uo._matMult(En),Oa._matMult(En),Wn._matMult(En)}const jo=new v(0,0),Fn=new v(0,0);Yt.push({tl:gs,tr:uo,bl:Oa,br:Wn,tex:ct,writingMode:Ee.writingMode,glyphOffset:On,sectionIndex:Rt.sectionIndex,isSDF:vr,pixelOffsetTL:jo,pixelOffsetBR:Fn,minFontScaleX:0,minFontScaleY:0})}return Yt})(0,c,M,_,w,E,f,u.allowVerticalPlacement),he=u.textSizeData;let ye=null;he.kind==="source"?(ye=[yt*_.layout.get("text-size").evaluate(E,{})],ye[0]>gt&&ri(`${u.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):he.kind==="composite"&&(ye=[yt*X.compositeTextSizes[0].evaluate(E,{},Y),yt*X.compositeTextSizes[1].evaluate(E,{},Y)],(ye[0]>gt||ye[1]>gt)&&ri(`${u.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),u.addSymbols(u.text,re,ye,M,w,E,D,o,R.lineStartIndex,R.lineLength,Z,Y);for(const Ne of z)V[Ne]=u.text.placedSymbolArray.length-1;return 4*re.length}function ZE(u){for(const o in u)return u[o];return null}function PB(u,o,c,f){const _=u.compareText;if(o in _){const w=_[o];for(let E=w.length-1;E>=0;E--)if(f.dist(w[E])<c)return!0}else _[o]=[];return _[o].push(f),!1}const XE=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class ev{static from(o){if(!(o instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[c,f]=new Uint8Array(o,0,2);if(c!==219)throw new Error("Data does not appear to be in a KDBush format.");const _=f>>4;if(_!==1)throw new Error(`Got v${_} data when expected v1.`);const w=XE[15&f];if(!w)throw new Error("Unrecognized array type.");const[E]=new Uint16Array(o,2,1),[M]=new Uint32Array(o,4,1);return new ev(M,E,w,o)}constructor(o,c=64,f=Float64Array,_){if(isNaN(o)||o<0)throw new Error(`Unpexpected numItems value: ${o}.`);this.numItems=+o,this.nodeSize=Math.min(Math.max(+c,2),65535),this.ArrayType=f,this.IndexArrayType=o<65536?Uint16Array:Uint32Array;const w=XE.indexOf(this.ArrayType),E=2*o*this.ArrayType.BYTES_PER_ELEMENT,M=o*this.IndexArrayType.BYTES_PER_ELEMENT,R=(8-M%8)%8;if(w<0)throw new Error(`Unexpected typed array class: ${f}.`);_&&_ instanceof ArrayBuffer?(this.data=_,this.ids=new this.IndexArrayType(this.data,8,o),this.coords=new this.ArrayType(this.data,8+M+R,2*o),this._pos=2*o,this._finished=!0):(this.data=new ArrayBuffer(8+E+M+R),this.ids=new this.IndexArrayType(this.data,8,o),this.coords=new this.ArrayType(this.data,8+M+R,2*o),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+w]),new Uint16Array(this.data,2,1)[0]=c,new Uint32Array(this.data,4,1)[0]=o)}add(o,c){const f=this._pos>>1;return this.ids[f]=f,this.coords[this._pos++]=o,this.coords[this._pos++]=c,f}finish(){const o=this._pos>>1;if(o!==this.numItems)throw new Error(`Added ${o} items when expected ${this.numItems}.`);return tv(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(o,c,f,_){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:w,coords:E,nodeSize:M}=this,R=[0,w.length-1,0],D=[];for(;R.length;){const z=R.pop()||0,V=R.pop()||0,Z=R.pop()||0;if(V-Z<=M){for(let he=Z;he<=V;he++){const ye=E[2*he],Ne=E[2*he+1];ye>=o&&ye<=f&&Ne>=c&&Ne<=_&&D.push(w[he])}continue}const X=Z+V>>1,Y=E[2*X],re=E[2*X+1];Y>=o&&Y<=f&&re>=c&&re<=_&&D.push(w[X]),(z===0?o<=Y:c<=re)&&(R.push(Z),R.push(X-1),R.push(1-z)),(z===0?f>=Y:_>=re)&&(R.push(X+1),R.push(V),R.push(1-z))}return D}within(o,c,f){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:_,coords:w,nodeSize:E}=this,M=[0,_.length-1,0],R=[],D=f*f;for(;M.length;){const z=M.pop()||0,V=M.pop()||0,Z=M.pop()||0;if(V-Z<=E){for(let he=Z;he<=V;he++)YE(w[2*he],w[2*he+1],o,c)<=D&&R.push(_[he]);continue}const X=Z+V>>1,Y=w[2*X],re=w[2*X+1];YE(Y,re,o,c)<=D&&R.push(_[X]),(z===0?o-f<=Y:c-f<=re)&&(M.push(Z),M.push(X-1),M.push(1-z)),(z===0?o+f>=Y:c+f>=re)&&(M.push(X+1),M.push(V),M.push(1-z))}return R}}function tv(u,o,c,f,_,w){if(_-f<=c)return;const E=f+_>>1;KE(u,o,E,f,_,w),tv(u,o,c,f,E-1,1-w),tv(u,o,c,E+1,_,1-w)}function KE(u,o,c,f,_,w){for(;_>f;){if(_-f>600){const D=_-f+1,z=c-f+1,V=Math.log(D),Z=.5*Math.exp(2*V/3),X=.5*Math.sqrt(V*Z*(D-Z)/D)*(z-D/2<0?-1:1);KE(u,o,c,Math.max(f,Math.floor(c-z*Z/D+X)),Math.min(_,Math.floor(c+(D-z)*Z/D+X)),w)}const E=o[2*c+w];let M=f,R=_;for(Tg(u,o,f,c),o[2*_+w]>E&&Tg(u,o,f,_);M<R;){for(Tg(u,o,M,R),M++,R--;o[2*M+w]<E;)M++;for(;o[2*R+w]>E;)R--}o[2*f+w]===E?Tg(u,o,f,R):(R++,Tg(u,o,R,_)),R<=c&&(f=R+1),c<=R&&(_=R-1)}}function Tg(u,o,c,f){rv(u,c,f),rv(o,2*c,2*f),rv(o,2*c+1,2*f+1)}function rv(u,o,c){const f=u[o];u[o]=u[c],u[c]=f}function YE(u,o,c,f){const _=u-c,w=o-f;return _*_+w*w}var iv;h.cx=void 0,(iv=h.cx||(h.cx={})).create="create",iv.load="load",iv.fullLoad="fullLoad";let Ay=null,Sg=[];const nv=1e3/60,sv="loadTime",ov="fullLoadTime",RB={mark(u){performance.mark(u)},frame(u){const o=u;Ay!=null&&Sg.push(o-Ay),Ay=o},clearMetrics(){Ay=null,Sg=[],performance.clearMeasures(sv),performance.clearMeasures(ov);for(const u in h.cx)performance.clearMarks(h.cx[u])},getPerformanceMetrics(){performance.measure(sv,h.cx.create,h.cx.load),performance.measure(ov,h.cx.create,h.cx.fullLoad);const u=performance.getEntriesByName(sv)[0].duration,o=performance.getEntriesByName(ov)[0].duration,c=Sg.length,f=1/(Sg.reduce(((w,E)=>w+E),0)/c/1e3),_=Sg.filter((w=>w>nv)).reduce(((w,E)=>w+(E-nv)/nv),0);return{loadTime:u,fullLoadTime:o,fps:f,percentDroppedFrames:_/(c+_)*100,totalFrames:c}}};h.$=wt,h.A=ue,h.B=function([u,o,c]){return o+=90,o*=Math.PI/180,c*=Math.PI/180,{x:u*Math.cos(o)*Math.sin(c),y:u*Math.sin(o)*Math.sin(c),z:u*Math.cos(c)}},h.C=Co,h.D=zt,h.E=Ft,h.F=Qr,h.G=Oc,h.H=function(u){if(Mn==null){const o=u.navigator?u.navigator.userAgent:null;Mn=!!u.safari||!(!o||!(/\b(iPad|iPhone|iPod)\b/.test(o)||o.match("Safari")&&!o.match("Chrome")))}return Mn},h.I=gp,h.J=class{constructor(u,o){this.target=u,this.mapId=o,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new bB((()=>this.process())),this.subscription=_o(this.target,"message",(c=>this.receive(c)),!1),this.globalScope=Li(self)?u:window}registerMessageHandler(u,o){this.messageHandlers[u]=o}sendAsync(u,o){return new Promise(((c,f)=>{const _=Math.round(1e18*Math.random()).toString(36).substring(0,10),w=o?_o(o.signal,"abort",(()=>{w?.unsubscribe(),delete this.resolveRejects[_];const R={id:_,type:"<cancel>",origin:location.origin,targetMapId:u.targetMapId,sourceMapId:this.mapId};this.target.postMessage(R)}),xB):null;this.resolveRejects[_]={resolve:R=>{w?.unsubscribe(),c(R)},reject:R=>{w?.unsubscribe(),f(R)}};const E=[],M=Object.assign(Object.assign({},u),{id:_,sourceMapId:this.mapId,origin:location.origin,data:Ss(u.data,E)});this.target.postMessage(M,{transfer:E})}))}receive(u){const o=u.data,c=o.id;if(!(o.origin!=="file://"&&location.origin!=="file://"&&o.origin!=="resource://android"&&location.origin!=="resource://android"&&o.origin!==location.origin||o.targetMapId&&this.mapId!==o.targetMapId)){if(o.type==="<cancel>"){delete this.tasks[c];const f=this.abortControllers[c];return delete this.abortControllers[c],void(f&&f.abort())}if(Li(self)||o.mustQueue)return this.tasks[c]=o,this.taskQueue.push(c),void this.invoker.trigger();this.processTask(c,o)}}process(){if(this.taskQueue.length===0)return;const u=this.taskQueue.shift(),o=this.tasks[u];delete this.tasks[u],this.taskQueue.length>0&&this.invoker.trigger(),o&&this.processTask(u,o)}processTask(u,o){return a(this,void 0,void 0,(function*(){if(o.type==="<response>"){const _=this.resolveRejects[u];return delete this.resolveRejects[u],_?void(o.error?_.reject(ss(o.error)):_.resolve(ss(o.data))):void 0}if(!this.messageHandlers[o.type])return void this.completeTask(u,new Error(`Could not find a registered handler for ${o.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const c=ss(o.data),f=new AbortController;this.abortControllers[u]=f;try{const _=yield this.messageHandlers[o.type](o.sourceMapId,c,f);this.completeTask(u,null,_)}catch(_){this.completeTask(u,_)}}))}completeTask(u,o,c){const f=[];delete this.abortControllers[u];const _={id:u,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:o?Ss(o):null,data:Ss(c,f)};this.target.postMessage(_,{transfer:f})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},h.K=ae,h.L=function(){var u=new ue(16);return ue!=Float32Array&&(u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[11]=0,u[12]=0,u[13]=0,u[14]=0),u[0]=1,u[5]=1,u[10]=1,u[15]=1,u},h.M=function(u,o,c){var f,_,w,E,M,R,D,z,V,Z,X,Y,re=c[0],he=c[1],ye=c[2];return o===u?(u[12]=o[0]*re+o[4]*he+o[8]*ye+o[12],u[13]=o[1]*re+o[5]*he+o[9]*ye+o[13],u[14]=o[2]*re+o[6]*he+o[10]*ye+o[14],u[15]=o[3]*re+o[7]*he+o[11]*ye+o[15]):(_=o[1],w=o[2],E=o[3],M=o[4],R=o[5],D=o[6],z=o[7],V=o[8],Z=o[9],X=o[10],Y=o[11],u[0]=f=o[0],u[1]=_,u[2]=w,u[3]=E,u[4]=M,u[5]=R,u[6]=D,u[7]=z,u[8]=V,u[9]=Z,u[10]=X,u[11]=Y,u[12]=f*re+M*he+V*ye+o[12],u[13]=_*re+R*he+Z*ye+o[13],u[14]=w*re+D*he+X*ye+o[14],u[15]=E*re+z*he+Y*ye+o[15]),u},h.N=function(u,o,c){var f=c[0],_=c[1],w=c[2];return u[0]=o[0]*f,u[1]=o[1]*f,u[2]=o[2]*f,u[3]=o[3]*f,u[4]=o[4]*_,u[5]=o[5]*_,u[6]=o[6]*_,u[7]=o[7]*_,u[8]=o[8]*w,u[9]=o[9]*w,u[10]=o[10]*w,u[11]=o[11]*w,u[12]=o[12],u[13]=o[13],u[14]=o[14],u[15]=o[15],u},h.O=function(u,o,c){var f=o[0],_=o[1],w=o[2],E=o[3],M=o[4],R=o[5],D=o[6],z=o[7],V=o[8],Z=o[9],X=o[10],Y=o[11],re=o[12],he=o[13],ye=o[14],Ne=o[15],Ee=c[0],Me=c[1],Xe=c[2],st=c[3];return u[0]=Ee*f+Me*M+Xe*V+st*re,u[1]=Ee*_+Me*R+Xe*Z+st*he,u[2]=Ee*w+Me*D+Xe*X+st*ye,u[3]=Ee*E+Me*z+Xe*Y+st*Ne,u[4]=(Ee=c[4])*f+(Me=c[5])*M+(Xe=c[6])*V+(st=c[7])*re,u[5]=Ee*_+Me*R+Xe*Z+st*he,u[6]=Ee*w+Me*D+Xe*X+st*ye,u[7]=Ee*E+Me*z+Xe*Y+st*Ne,u[8]=(Ee=c[8])*f+(Me=c[9])*M+(Xe=c[10])*V+(st=c[11])*re,u[9]=Ee*_+Me*R+Xe*Z+st*he,u[10]=Ee*w+Me*D+Xe*X+st*ye,u[11]=Ee*E+Me*z+Xe*Y+st*Ne,u[12]=(Ee=c[12])*f+(Me=c[13])*M+(Xe=c[14])*V+(st=c[15])*re,u[13]=Ee*_+Me*R+Xe*Z+st*he,u[14]=Ee*w+Me*D+Xe*X+st*ye,u[15]=Ee*E+Me*z+Xe*Y+st*Ne,u},h.P=v,h.Q=function(u,o){const c={};for(let f=0;f<o.length;f++){const _=o[f];_ in u&&(c[_]=u[_])}return c},h.R=$s,h.S=Gh,h.T=Bh,h.U=ME,h.V=CE,h.W=ne,h.X=oe,h.Y=Jn,h.Z=Da,h._=a,h.a=Q,h.a$=Nt,h.a0=function(u,o){var c,f,_,w;if(!u)return o??{};if(!o)return u;const E=Object.assign({},u);if(o.removeAll&&(E.removeAll=!0),o.remove){const M=new Set(E.remove?E.remove.concat(o.remove):o.remove);E.remove=Array.from(M.values())}if(o.add){const M=E.add?E.add.concat(o.add):o.add,R=new Map(M.map((D=>[D.id,D])));E.add=Array.from(R.values())}if(o.update){const M=new Map((c=E.update)===null||c===void 0?void 0:c.map((R=>[R.id,R])));for(const R of o.update){const D=(f=M.get(R.id))!==null&&f!==void 0?f:{id:R.id};R.newGeometry&&(D.newGeometry=R.newGeometry),R.addOrUpdateProperties&&(D.addOrUpdateProperties=((_=D.addOrUpdateProperties)!==null&&_!==void 0?_:[]).concat(R.addOrUpdateProperties)),R.removeProperties&&(D.removeProperties=((w=D.removeProperties)!==null&&w!==void 0?w:[]).concat(R.removeProperties)),R.removeAllProperties&&(D.removeAllProperties=!0),M.set(R.id,D)}E.update=Array.from(M.values())}return E},h.a1=Eg,h.a2=bp,h.a3=25,h.a4=Y1,h.a5=u=>{const o=window.document.createElement("video");return o.muted=!0,new Promise((c=>{o.onloadstart=()=>{c(o)};for(const f of u){const _=window.document.createElement("source");Ze(f)||(o.crossOrigin="Anonymous"),_.src=f,o.appendChild(_)}}))},h.a6=_t,h.a7=function(){return er++},h.a8=G,h.a9=Kt,h.aA=function(u){let o=1/0,c=1/0,f=-1/0,_=-1/0;for(const w of u)o=Math.min(o,w.x),c=Math.min(c,w.y),f=Math.max(f,w.x),_=Math.max(_,w.y);return[o,c,f,_]},h.aB=gn,h.aC=Bt,h.aD=function(u,o,c,f,_=!1){if(!c[0]&&!c[1])return[0,0];const w=_?f==="map"?-u.bearingInRadians:0:f==="viewport"?u.bearingInRadians:0;if(w){const E=Math.sin(w),M=Math.cos(w);c=[c[0]*M-c[1]*E,c[0]*E+c[1]*M]}return[_?c[0]:Bt(o,c[0],u.zoom),_?c[1]:Bt(o,c[1],u.zoom)]},h.aF=Zt,h.aG=Q1,h.aH=g,h.aI=ev,h.aJ=Pi,h.aK=fn,h.aL=ve,h.aM=yr,h.aN=ei,h.aO=Ht,h.aP=yo,h.aQ=RE,h.aR=lt,h.aS=it,h.aT=function(u){var o=new ue(3);return o[0]=u[0],o[1]=u[1],o[2]=u[2],o},h.aU=function(u,o,c){return u[0]=o[0]-c[0],u[1]=o[1]-c[1],u[2]=o[2]-c[2],u},h.aV=function(u,o){var c=o[0],f=o[1],_=o[2],w=c*c+f*f+_*_;return w>0&&(w=1/Math.sqrt(w)),u[0]=o[0]*w,u[1]=o[1]*w,u[2]=o[2]*w,u},h.aW=ht,h.aX=function(u,o){return u[0]*o[0]+u[1]*o[1]+u[2]*o[2]},h.aY=function(u,o,c){return u[0]=o[0]*c[0],u[1]=o[1]*c[1],u[2]=o[2]*c[2],u[3]=o[3]*c[3],u},h.aZ=Ke,h.a_=function(u,o,c){const f=o[0]*c[0]+o[1]*c[1]+o[2]*c[2];return f===0?null:(-(u[0]*c[0]+u[1]*c[1]+u[2]*c[2])-c[3])/f},h.aa=$o,h.ab=ka,h.ac=LE,h.ad=function(u){const o={};if(u.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((c,f,_,w)=>{const E=_||w;return o[f]=!E||E.toLowerCase(),""})),o["max-age"]){const c=parseInt(o["max-age"],10);isNaN(c)?delete o["max-age"]:o["max-age"]=c}return o},h.ae=Go,h.af=function(u){return Math.pow(2,u)},h.ag=De,h.ah=gr,h.ai=85.051129,h.aj=PE,h.ak=function(u){return Math.log(u)/Math.LN2},h.al=function(u){var o=u[0],c=u[1];return o*o+c*c},h.am=function(u,o){const c=[];for(const f in u)f in o||c.push(f);return c},h.an=function(u,o){let c=0,f=0;if(u.kind==="constant")f=u.layoutSize;else if(u.kind!=="source"){const{interpolationType:_,minZoom:w,maxZoom:E}=u,M=_?gr($i.interpolationFactor(_,o,w,E),0,1):0;u.kind==="camera"?f=Co.number(u.minSize,u.maxSize,M):c=M}return{uSizeT:c,uSize:f}},h.ap=function(u,{uSize:o,uSizeT:c},{lowerSize:f,upperSize:_}){return u.kind==="source"?f/yt:u.kind==="composite"?Co.number(f/yt,_/yt,c):o},h.aq=function(u,o){var c=o[0],f=o[1],_=o[2],w=o[3],E=o[4],M=o[5],R=o[6],D=o[7],z=o[8],V=o[9],Z=o[10],X=o[11],Y=o[12],re=o[13],he=o[14],ye=o[15],Ne=c*M-f*E,Ee=c*R-_*E,Me=c*D-w*E,Xe=f*R-_*M,st=f*D-w*M,ft=_*D-w*R,It=z*re-V*Y,At=z*he-Z*Y,Pt=z*ye-X*Y,Yt=V*he-Z*re,St=V*ye-X*re,Rt=Z*ye-X*he,ct=Ne*Rt-Ee*St+Me*Yt+Xe*Pt-st*At+ft*It;return ct?(u[0]=(M*Rt-R*St+D*Yt)*(ct=1/ct),u[1]=(_*St-f*Rt-w*Yt)*ct,u[2]=(re*ft-he*st+ye*Xe)*ct,u[3]=(Z*st-V*ft-X*Xe)*ct,u[4]=(R*Pt-E*Rt-D*At)*ct,u[5]=(c*Rt-_*Pt+w*At)*ct,u[6]=(he*Me-Y*ft-ye*Ee)*ct,u[7]=(z*ft-Z*Me+X*Ee)*ct,u[8]=(E*St-M*Pt+D*It)*ct,u[9]=(f*Pt-c*St-w*It)*ct,u[10]=(Y*st-re*Me+ye*Ne)*ct,u[11]=(V*Me-z*st-X*Ne)*ct,u[12]=(M*At-E*Yt-R*It)*ct,u[13]=(c*Yt-f*At+_*It)*ct,u[14]=(re*Ee-Y*Xe-he*Ne)*ct,u[15]=(z*Xe-V*Ee+Z*Ne)*ct,u):null},h.ar=Ot,h.as=function(u){return Math.hypot(u[0],u[1])},h.at=function(u){return u[0]=0,u[1]=0,u},h.au=function(u,o,c){return u[0]=o[0]*c,u[1]=o[1]*c,u},h.av=Ye,h.aw=Lt,h.ax=function(u,o,c,f){const _=o.y-u.y,w=o.x-u.x,E=f.y-c.y,M=f.x-c.x,R=E*w-M*_;if(R===0)return null;const D=(M*(u.y-c.y)-E*(u.x-c.x))/R;return new v(u.x+D*w,u.y+D*_)},h.ay=OE,h.az=Km,h.b=bs,h.b$=class extends b{},h.b0=function(u,o,c){return u[0]=o[0]*c,u[1]=o[1]*c,u[2]=o[2]*c,u[3]=o[3]*c,u},h.b1=function(u,o){return u[0]*o[0]+u[1]*o[1]+u[2]*o[2]+u[3]},h.b2=kE,h.b3=Af,h.b4=function(u,o,c,f,_){var w,E=1/Math.tan(o/2);return u[0]=E/c,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=E,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[11]=-1,u[12]=0,u[13]=0,u[15]=0,_!=null&&_!==1/0?(u[10]=(_+f)*(w=1/(f-_)),u[14]=2*_*f*w):(u[10]=-1,u[14]=-2*f),u},h.b5=function(u){var o=new ue(16);return o[0]=u[0],o[1]=u[1],o[2]=u[2],o[3]=u[3],o[4]=u[4],o[5]=u[5],o[6]=u[6],o[7]=u[7],o[8]=u[8],o[9]=u[9],o[10]=u[10],o[11]=u[11],o[12]=u[12],o[13]=u[13],o[14]=u[14],o[15]=u[15],o},h.b6=function(u,o,c){var f=Math.sin(c),_=Math.cos(c),w=o[0],E=o[1],M=o[2],R=o[3],D=o[4],z=o[5],V=o[6],Z=o[7];return o!==u&&(u[8]=o[8],u[9]=o[9],u[10]=o[10],u[11]=o[11],u[12]=o[12],u[13]=o[13],u[14]=o[14],u[15]=o[15]),u[0]=w*_+D*f,u[1]=E*_+z*f,u[2]=M*_+V*f,u[3]=R*_+Z*f,u[4]=D*_-w*f,u[5]=z*_-E*f,u[6]=V*_-M*f,u[7]=Z*_-R*f,u},h.b7=function(u,o,c){var f=Math.sin(c),_=Math.cos(c),w=o[4],E=o[5],M=o[6],R=o[7],D=o[8],z=o[9],V=o[10],Z=o[11];return o!==u&&(u[0]=o[0],u[1]=o[1],u[2]=o[2],u[3]=o[3],u[12]=o[12],u[13]=o[13],u[14]=o[14],u[15]=o[15]),u[4]=w*_+D*f,u[5]=E*_+z*f,u[6]=M*_+V*f,u[7]=R*_+Z*f,u[8]=D*_-w*f,u[9]=z*_-E*f,u[10]=V*_-M*f,u[11]=Z*_-R*f,u},h.b8=function(){const u=new Float32Array(16);return De(u),u},h.b9=function(){const u=new Float64Array(16);return De(u),u},h.bA=function(u,o){const c=Ue(u,360),f=Ue(o,360),_=f-c,w=f>c?_-360:_+360;return Math.abs(_)<Math.abs(w)?_:w},h.bB=function(u){return u[0]=0,u[1]=0,u[2]=0,u},h.bC=function(u,o,c,f){const _=Math.sqrt(u*u+o*o),w=Math.sqrt(c*c+f*f);u/=_,o/=_,c/=w,f/=w;const E=Math.acos(u*c+o*f);return-o*c+u*f>0?E:-E},h.bD=function(u,o){const c=Ue(u,2*Math.PI),f=Ue(o,2*Math.PI);return Math.min(Math.abs(c-f),Math.abs(c-f+2*Math.PI),Math.abs(c-f-2*Math.PI))},h.bE=function(){const u={},o=Le.$version;for(const c in Le.$root){const f=Le.$root[c];if(f.required){let _=null;_=c==="version"?o:f.type==="array"?[]:{},_!=null&&(u[c]=_)}}return u},h.bF=Yo,h.bG=Se,h.bH=function u(o,c){if(Array.isArray(o)){if(!Array.isArray(c)||o.length!==c.length)return!1;for(let f=0;f<o.length;f++)if(!u(o[f],c[f]))return!1;return!0}if(typeof o=="object"&&o!==null&&c!==null){if(typeof c!="object"||Object.keys(o).length!==Object.keys(c).length)return!1;for(const f in o)if(!u(o[f],c[f]))return!1;return!0}return o===c},h.bI=function(u){u=u.slice();const o=Object.create(null);for(let c=0;c<u.length;c++)o[u[c].id]=u[c];for(let c=0;c<u.length;c++)"ref"in u[c]&&(u[c]=Sr(u[c],o[u[c].ref]));return u},h.bJ=function(u){if(u.type==="custom")return new vB(u);switch(u.type){case"background":return new gB(u);case"circle":return new $_(u);case"color-relief":return new $t(u);case"fill":return new zh(u);case"fill-extrusion":return new V1(u);case"heatmap":return new K_(u);case"hillshade":return new Rs(u);case"line":return new Wu(u);case"raster":return new yB(u);case"symbol":return new Vr(u)}},h.bK=yi,h.bL=function(u,o){if(!u)return[{command:"setStyle",args:[o]}];let c=[];try{if(!Wt(u.version,o.version))return[{command:"setStyle",args:[o]}];Wt(u.center,o.center)||c.push({command:"setCenter",args:[o.center]}),Wt(u.state,o.state)||c.push({command:"setGlobalState",args:[o.state]}),Wt(u.centerAltitude,o.centerAltitude)||c.push({command:"setCenterAltitude",args:[o.centerAltitude]}),Wt(u.zoom,o.zoom)||c.push({command:"setZoom",args:[o.zoom]}),Wt(u.bearing,o.bearing)||c.push({command:"setBearing",args:[o.bearing]}),Wt(u.pitch,o.pitch)||c.push({command:"setPitch",args:[o.pitch]}),Wt(u.roll,o.roll)||c.push({command:"setRoll",args:[o.roll]}),Wt(u.sprite,o.sprite)||c.push({command:"setSprite",args:[o.sprite]}),Wt(u.glyphs,o.glyphs)||c.push({command:"setGlyphs",args:[o.glyphs]}),Wt(u.transition,o.transition)||c.push({command:"setTransition",args:[o.transition]}),Wt(u.light,o.light)||c.push({command:"setLight",args:[o.light]}),Wt(u.terrain,o.terrain)||c.push({command:"setTerrain",args:[o.terrain]}),Wt(u.sky,o.sky)||c.push({command:"setSky",args:[o.sky]}),Wt(u.projection,o.projection)||c.push({command:"setProjection",args:[o.projection]});const f={},_=[];(function(E,M,R,D){let z;for(z in M=M||{},E=E||{})Object.prototype.hasOwnProperty.call(E,z)&&(Object.prototype.hasOwnProperty.call(M,z)||Si(z,R,D));for(z in M)Object.prototype.hasOwnProperty.call(M,z)&&(Object.prototype.hasOwnProperty.call(E,z)?Wt(E[z],M[z])||(E[z].type==="geojson"&&M[z].type==="geojson"&&ui(E,M,z)?_r(R,{command:"setGeoJSONSourceData",args:[z,M[z].data]}):Di(z,M,R,D)):$r(z,M,R))})(u.sources,o.sources,_,f);const w=[];u.layers&&u.layers.forEach((E=>{"source"in E&&f[E.source]?c.push({command:"removeLayer",args:[E.id]}):w.push(E)})),c=c.concat(_),(function(E,M,R){M=M||[];const D=(E=E||[]).map(Pr),z=M.map(Pr),V=E.reduce(Ni,{}),Z=M.reduce(Ni,{}),X=D.slice(),Y=Object.create(null);let re,he,ye,Ne,Ee;for(let Me=0,Xe=0;Me<D.length;Me++)re=D[Me],Object.prototype.hasOwnProperty.call(Z,re)?Xe++:(_r(R,{command:"removeLayer",args:[re]}),X.splice(X.indexOf(re,Xe),1));for(let Me=0,Xe=0;Me<z.length;Me++)re=z[z.length-1-Me],X[X.length-1-Me]!==re&&(Object.prototype.hasOwnProperty.call(V,re)?(_r(R,{command:"removeLayer",args:[re]}),X.splice(X.lastIndexOf(re,X.length-Xe),1)):Xe++,Ne=X[X.length-Me],_r(R,{command:"addLayer",args:[Z[re],Ne]}),X.splice(X.length-Me,0,re),Y[re]=!0);for(let Me=0;Me<z.length;Me++)if(re=z[Me],he=V[re],ye=Z[re],!Y[re]&&!Wt(he,ye))if(Wt(he.source,ye.source)&&Wt(he["source-layer"],ye["source-layer"])&&Wt(he.type,ye.type)){for(Ee in Er(he.layout,ye.layout,R,re,null,"setLayoutProperty"),Er(he.paint,ye.paint,R,re,null,"setPaintProperty"),Wt(he.filter,ye.filter)||_r(R,{command:"setFilter",args:[re,ye.filter]}),Wt(he.minzoom,ye.minzoom)&&Wt(he.maxzoom,ye.maxzoom)||_r(R,{command:"setLayerZoomRange",args:[re,ye.minzoom,ye.maxzoom]}),he)Object.prototype.hasOwnProperty.call(he,Ee)&&Ee!=="layout"&&Ee!=="paint"&&Ee!=="filter"&&Ee!=="metadata"&&Ee!=="minzoom"&&Ee!=="maxzoom"&&(Ee.indexOf("paint.")===0?Er(he[Ee],ye[Ee],R,re,Ee.slice(6),"setPaintProperty"):Wt(he[Ee],ye[Ee])||_r(R,{command:"setLayerProperty",args:[re,Ee,ye[Ee]]}));for(Ee in ye)Object.prototype.hasOwnProperty.call(ye,Ee)&&!Object.prototype.hasOwnProperty.call(he,Ee)&&Ee!=="layout"&&Ee!=="paint"&&Ee!=="filter"&&Ee!=="metadata"&&Ee!=="minzoom"&&Ee!=="maxzoom"&&(Ee.indexOf("paint.")===0?Er(he[Ee],ye[Ee],R,re,Ee.slice(6),"setPaintProperty"):Wt(he[Ee],ye[Ee])||_r(R,{command:"setLayerProperty",args:[re,Ee,ye[Ee]]}))}else _r(R,{command:"removeLayer",args:[re]}),Ne=X[X.lastIndexOf(re)+1],_r(R,{command:"addLayer",args:[ye,Ne]})})(w,o.layers,c)}catch(f){console.warn("Unable to compute style diff:",f),c=[{command:"setStyle",args:[o]}]}return c},h.bM=function(u){const o=[],c=u.id;return c===void 0&&o.push({message:`layers.${c}: missing required property "id"`}),u.render===void 0&&o.push({message:`layers.${c}: missing required method "render"`}),u.renderingMode&&u.renderingMode!=="2d"&&u.renderingMode!=="3d"&&o.push({message:`layers.${c}: property "renderingMode" must be either "2d" or "3d"`}),o},h.bN=Lr,h.bO=yn,h.bP=class extends cs{constructor(u,o){super(u,o),this.current=0}set(u){this.current!==u&&(this.current=u,this.gl.uniform1i(this.location,u))}},h.bQ=rn,h.bR=class extends cs{constructor(u,o){super(u,o),this.current=us}set(u){if(u[12]!==this.current[12]||u[0]!==this.current[0])return this.current=u,void this.gl.uniformMatrix4fv(this.location,!1,u);for(let o=1;o<16;o++)if(u[o]!==this.current[o]){this.current=u,this.gl.uniformMatrix4fv(this.location,!1,u);break}}},h.bS=Xi,h.bT=class extends cs{constructor(u,o){super(u,o),this.current=[0,0,0]}set(u){u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]||(this.current=u,this.gl.uniform3f(this.location,u[0],u[1],u[2]))}},h.bU=class extends cs{constructor(u,o){super(u,o),this.current=[0,0]}set(u){u[0]===this.current[0]&&u[1]===this.current[1]||(this.current=u,this.gl.uniform2f(this.location,u[0],u[1]))}},h.bV=we,h.bW=function(u,o){var c=Math.sin(o),f=Math.cos(o);return u[0]=f,u[1]=c,u[2]=0,u[3]=-c,u[4]=f,u[5]=0,u[6]=0,u[7]=0,u[8]=1,u},h.bX=function(u,o,c){var f=o[0],_=o[1],w=o[2];return u[0]=f*c[0]+_*c[3]+w*c[6],u[1]=f*c[1]+_*c[4]+w*c[7],u[2]=f*c[2]+_*c[5]+w*c[8],u},h.bY=function(u,o,c,f,_,w,E){var M=1/(o-c),R=1/(f-_),D=1/(w-E);return u[0]=-2*M,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=-2*R,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[10]=2*D,u[11]=0,u[12]=(o+c)*M,u[13]=(_+f)*R,u[14]=(E+w)*D,u[15]=1,u},h.bZ=class extends cs{constructor(u,o){super(u,o),this.current=new Array}set(u){if(u!=this.current){this.current=u;const o=new Float32Array(4*u.length);for(let c=0;c<u.length;c++)o[4*c]=u[c].r,o[4*c+1]=u[c].g,o[4*c+2]=u[c].b,o[4*c+3]=u[c].a;this.gl.uniform4fv(this.location,o)}}},h.b_=class extends cs{constructor(u,o){super(u,o),this.current=new Array}set(u){if(u!=this.current){this.current=u;const o=new Float32Array(u);this.gl.uniform1fv(this.location,o)}}},h.ba=function(){return new Float64Array(16)},h.bb=function(u,o,c){const f=new Float64Array(4);return Qt(f,u,o-90,c),f},h.bc=function(u,o,c,f){var _,w,E,M,R,D=o[0],z=o[1],V=o[2],Z=o[3],X=c[0],Y=c[1],re=c[2],he=c[3];return(w=D*X+z*Y+V*re+Z*he)<0&&(w=-w,X=-X,Y=-Y,re=-re,he=-he),1-w>fe?(_=Math.acos(w),E=Math.sin(_),M=Math.sin((1-f)*_)/E,R=Math.sin(f*_)/E):(M=1-f,R=f),u[0]=M*D+R*X,u[1]=M*z+R*Y,u[2]=M*V+R*re,u[3]=M*Z+R*he,u},h.bd=function(u){const o=new Float64Array(9);var c,f,_,w,E,M,R,D,z,V,Z,X,Y,re,he,ye,Ne,Ee;V=(_=(f=u)[0])*(R=_+_),Z=(w=f[1])*R,Y=(E=f[2])*R,re=E*(D=w+w),ye=(M=f[3])*R,Ne=M*D,Ee=M*(z=E+E),(c=o)[0]=1-(X=w*D)-(he=E*z),c[3]=Z-Ee,c[6]=Y+Ne,c[1]=Z+Ee,c[4]=1-V-he,c[7]=re-ye,c[2]=Y-Ne,c[5]=re+ye,c[8]=1-V-X;const Me=yo(-Math.asin(gr(o[2],-1,1)));let Xe,st;return Math.hypot(o[5],o[8])<.001?(Xe=0,st=-yo(Math.atan2(o[3],o[4]))):(Xe=yo(o[5]===0&&o[8]===0?0:Math.atan2(o[5],o[8])),st=yo(o[1]===0&&o[0]===0?0:Math.atan2(o[1],o[0]))),{roll:Xe,pitch:Me+90,bearing:st}},h.be=function(u,o){return u.roll==o.roll&&u.pitch==o.pitch&&u.bearing==o.bearing},h.bf=ar,h.bg=Ra,h.bh=Ri,h.bi=mn,h.bj=Or,h.bk=dt,h.bl=Gt,h.bm=In,h.bn=function(u,o,c,f,_){return dt(f,_,gr((u-o)/(c-o),0,1))},h.bo=Ue,h.bp=function(){return new Float64Array(3)},h.bq=function(u,o,c,f){return u[0]=o[0]+c[0]*f,u[1]=o[1]+c[1]*f,u[2]=o[2]+c[2]*f,u},h.br=Qt,h.bs=function(u,o,c){var f=c[0],_=c[1],w=c[2],E=o[0],M=o[1],R=o[2],D=_*R-w*M,z=w*E-f*R,V=f*M-_*E,Z=_*V-w*z,X=w*D-f*V,Y=f*z-_*D,re=2*c[3];return z*=re,V*=re,X*=2,Y*=2,u[0]=E+(D*=re)+(Z*=2),u[1]=M+z+X,u[2]=R+V+Y,u},h.bt=function(u,o,c){const f=(_=[u[0],u[1],u[2],o[0],o[1],o[2],c[0],c[1],c[2]])[0]*((z=_[8])*(E=_[4])-(M=_[5])*(D=_[7]))+_[1]*(-z*(w=_[3])+M*(R=_[6]))+_[2]*(D*w-E*R);var _,w,E,M,R,D,z;if(f===0)return null;const V=ht([],[o[0],o[1],o[2]],[c[0],c[1],c[2]]),Z=ht([],[c[0],c[1],c[2]],[u[0],u[1],u[2]]),X=ht([],[u[0],u[1],u[2]],[o[0],o[1],o[2]]),Y=lt([],V,-u[3]);return it(Y,Y,lt([],Z,-o[3])),it(Y,Y,lt([],X,-c[3])),lt(Y,Y,1/f),Y},h.bu=X1,h.bv=function(){return new Float64Array(4)},h.bw=function(u,o,c,f){var _=[],w=[];return _[0]=o[0]-c[0],_[1]=o[1]-c[1],_[2]=o[2]-c[2],w[0]=_[0]*Math.cos(f)-_[1]*Math.sin(f),w[1]=_[0]*Math.sin(f)+_[1]*Math.cos(f),w[2]=_[2],u[0]=w[0]+c[0],u[1]=w[1]+c[1],u[2]=w[2]+c[2],u},h.bx=function(u,o,c,f){var _=[],w=[];return _[0]=o[0]-c[0],_[1]=o[1]-c[1],_[2]=o[2]-c[2],w[0]=_[0],w[1]=_[1]*Math.cos(f)-_[2]*Math.sin(f),w[2]=_[1]*Math.sin(f)+_[2]*Math.cos(f),u[0]=w[0]+c[0],u[1]=w[1]+c[1],u[2]=w[2]+c[2],u},h.by=function(u,o,c,f){var _=[],w=[];return _[0]=o[0]-c[0],_[1]=o[1]-c[1],_[2]=o[2]-c[2],w[0]=_[2]*Math.sin(f)+_[0]*Math.cos(f),w[1]=_[1],w[2]=_[2]*Math.cos(f)-_[0]*Math.sin(f),u[0]=w[0]+c[0],u[1]=w[1]+c[1],u[2]=w[2]+c[2],u},h.bz=function(u,o,c){var f=Math.sin(c),_=Math.cos(c),w=o[0],E=o[1],M=o[2],R=o[3],D=o[8],z=o[9],V=o[10],Z=o[11];return o!==u&&(u[4]=o[4],u[5]=o[5],u[6]=o[6],u[7]=o[7],u[12]=o[12],u[13]=o[13],u[14]=o[14],u[15]=o[15]),u[0]=w*_-D*f,u[1]=E*_-z*f,u[2]=M*_-V*f,u[3]=R*_-Z*f,u[8]=w*f+D*_,u[9]=E*f+z*_,u[10]=M*f+V*_,u[11]=R*f+Z*_,u},h.c=ke,h.c0=dy,h.c1=class extends d{},h.c2=rp,h.c3=function(u){return u<=1?1:Math.pow(2,Math.ceil(Math.log(u)/Math.LN2))},h.c4=ig,h.c5=function(u,o,c){var f=o[0],_=o[1],w=o[2],E=c[3]*f+c[7]*_+c[11]*w+c[15];return u[0]=(c[0]*f+c[4]*_+c[8]*w+c[12])/(E=E||1),u[1]=(c[1]*f+c[5]*_+c[9]*w+c[13])/E,u[2]=(c[2]*f+c[6]*_+c[10]*w+c[14])/E,u},h.c6=class extends Mh{},h.c7=class extends F{},h.c8=function(u,o){return u[0]===o[0]&&u[1]===o[1]&&u[2]===o[2]&&u[3]===o[3]&&u[4]===o[4]&&u[5]===o[5]&&u[6]===o[6]&&u[7]===o[7]&&u[8]===o[8]&&u[9]===o[9]&&u[10]===o[10]&&u[11]===o[11]&&u[12]===o[12]&&u[13]===o[13]&&u[14]===o[14]&&u[15]===o[15]},h.c9=function(u,o){var c=u[0],f=u[1],_=u[2],w=u[3],E=u[4],M=u[5],R=u[6],D=u[7],z=u[8],V=u[9],Z=u[10],X=u[11],Y=u[12],re=u[13],he=u[14],ye=u[15],Ne=o[0],Ee=o[1],Me=o[2],Xe=o[3],st=o[4],ft=o[5],It=o[6],At=o[7],Pt=o[8],Yt=o[9],St=o[10],Rt=o[11],ct=o[12],ur=o[13],vr=o[14],sr=o[15];return Math.abs(c-Ne)<=fe*Math.max(1,Math.abs(c),Math.abs(Ne))&&Math.abs(f-Ee)<=fe*Math.max(1,Math.abs(f),Math.abs(Ee))&&Math.abs(_-Me)<=fe*Math.max(1,Math.abs(_),Math.abs(Me))&&Math.abs(w-Xe)<=fe*Math.max(1,Math.abs(w),Math.abs(Xe))&&Math.abs(E-st)<=fe*Math.max(1,Math.abs(E),Math.abs(st))&&Math.abs(M-ft)<=fe*Math.max(1,Math.abs(M),Math.abs(ft))&&Math.abs(R-It)<=fe*Math.max(1,Math.abs(R),Math.abs(It))&&Math.abs(D-At)<=fe*Math.max(1,Math.abs(D),Math.abs(At))&&Math.abs(z-Pt)<=fe*Math.max(1,Math.abs(z),Math.abs(Pt))&&Math.abs(V-Yt)<=fe*Math.max(1,Math.abs(V),Math.abs(Yt))&&Math.abs(Z-St)<=fe*Math.max(1,Math.abs(Z),Math.abs(St))&&Math.abs(X-Rt)<=fe*Math.max(1,Math.abs(X),Math.abs(Rt))&&Math.abs(Y-ct)<=fe*Math.max(1,Math.abs(Y),Math.abs(ct))&&Math.abs(re-ur)<=fe*Math.max(1,Math.abs(re),Math.abs(ur))&&Math.abs(he-vr)<=fe*Math.max(1,Math.abs(he),Math.abs(vr))&&Math.abs(ye-sr)<=fe*Math.max(1,Math.abs(ye),Math.abs(sr))},h.cA=function(u,o){Q.REGISTERED_PROTOCOLS[u]=o},h.cB=function(u){delete Q.REGISTERED_PROTOCOLS[u]},h.cC=function(u,o){const c={};for(let _=0;_<u.length;_++){const w=o&&o[u[_].id]||$m(u[_]);o&&(o[u[_].id]=w);let E=c[w];E||(E=c[w]=[]),E.push(u[_])}const f=[];for(const _ in c)f.push(c[_]);return f},h.cD=Dt,h.cE=BE,h.cF=DE,h.cG=gy,h.cH=function(u){u.bucket.createArrays(),u.bucket.tilePixelRatio=wt/(512*u.bucket.overscaling),u.bucket.compareText={},u.bucket.iconsNeedLinear=!1;const o=u.bucket.layers[0],c=o.layout,f=o._unevaluatedLayout._values,_={layoutIconSize:f["icon-size"].possiblyEvaluate(new Qr(u.bucket.zoom+1),u.canonical),layoutTextSize:f["text-size"].possiblyEvaluate(new Qr(u.bucket.zoom+1),u.canonical),textMaxSize:f["text-size"].possiblyEvaluate(new Qr(18))};if(u.bucket.textSizeData.kind==="composite"){const{minZoom:D,maxZoom:z}=u.bucket.textSizeData;_.compositeTextSizes=[f["text-size"].possiblyEvaluate(new Qr(D),u.canonical),f["text-size"].possiblyEvaluate(new Qr(z),u.canonical)]}if(u.bucket.iconSizeData.kind==="composite"){const{minZoom:D,maxZoom:z}=u.bucket.iconSizeData;_.compositeIconSizes=[f["icon-size"].possiblyEvaluate(new Qr(D),u.canonical),f["icon-size"].possiblyEvaluate(new Qr(z),u.canonical)]}const w=c.get("text-line-height")*gn,E=c.get("text-rotation-alignment")!=="viewport"&&c.get("symbol-placement")!=="point",M=c.get("text-keep-upright"),R=c.get("text-size");for(const D of u.bucket.features){const z=c.get("text-font").evaluate(D,{},u.canonical).join(","),V=R.evaluate(D,{},u.canonical),Z=_.layoutTextSize.evaluate(D,{},u.canonical),X=_.layoutIconSize.evaluate(D,{},u.canonical),Y={horizontal:{},vertical:void 0},re=D.text;let he,ye=[0,0];if(re){const Me=re.toString(),Xe=c.get("text-letter-spacing").evaluate(D,{},u.canonical)*gn,st=qd(Me)?Xe:0,ft=c.get("text-anchor").evaluate(D,{},u.canonical),It=qE(o,D,u.canonical);if(!It){const St=c.get("text-radial-offset").evaluate(D,{},u.canonical);ye=St?WE(ft,[St*gn,J1]):c.get("text-offset").evaluate(D,{},u.canonical).map((Rt=>Rt*gn))}let At=E?"center":c.get("text-justify").evaluate(D,{},u.canonical);const Pt=c.get("symbol-placement")==="point"?c.get("text-max-width").evaluate(D,{},u.canonical)*gn:1/0,Yt=()=>{u.bucket.allowVerticalPlacement&&Fc(Me)&&(Y.vertical=Vh(re,u.glyphMap,u.glyphPositions,u.imagePositions,z,Pt,w,ft,"left",st,ye,h.ao.vertical,!0,Z,V))};if(!E&&It){const St=new Set;if(At==="auto")for(let ct=0;ct<It.values.length;ct+=2)St.add(Q1(It.values[ct]));else St.add(At);let Rt=!1;for(const ct of St)if(!Y.horizontal[ct])if(Rt)Y.horizontal[ct]=Y.horizontal[0];else{const ur=Vh(re,u.glyphMap,u.glyphPositions,u.imagePositions,z,Pt,w,"center",ct,st,ye,h.ao.horizontal,!1,Z,V);ur&&(Y.horizontal[ct]=ur,Rt=ur.positionedLines.length===1)}Yt()}else{At==="auto"&&(At=Q1(ft));const St=Vh(re,u.glyphMap,u.glyphPositions,u.imagePositions,z,Pt,w,ft,At,st,ye,h.ao.horizontal,!1,Z,V);St&&(Y.horizontal[At]=St),Yt(),Fc(Me)&&E&&M&&(Y.vertical=Vh(re,u.glyphMap,u.glyphPositions,u.imagePositions,z,Pt,w,ft,At,st,ye,h.ao.vertical,!1,Z,V))}}let Ne=!1;if(D.icon&&D.icon.name){const Me=u.imageMap[D.icon.name];Me&&(he=Ie(u.imagePositions[D.icon.name],c.get("icon-offset").evaluate(D,{},u.canonical),c.get("icon-anchor").evaluate(D,{},u.canonical)),Ne=!!Me.sdf,u.bucket.sdfIcons===void 0?u.bucket.sdfIcons=Ne:u.bucket.sdfIcons!==Ne&&ri("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Me.pixelRatio!==u.bucket.pixelRatio||c.get("icon-rotate").constantOr(1)!==0)&&(u.bucket.iconsNeedLinear=!0))}const Ee=ZE(Y.horizontal)||Y.vertical;u.bucket.iconsInText=!!Ee&&Ee.iconsInText,(Ee||he)&&MB(u.bucket,D,Y,he,u.imageMap,_,Z,X,ye,Ne,u.canonical,u.subdivisionGranularity)}u.showCollisionBoxes&&u.bucket.generateCollisionDebugBuffers()},h.cI=hp,h.cJ=lp,h.cK=ml,h.cL=gf,h.cM=mp,h.cN=class{constructor(u){this._marks={start:[u.url,"start"].join("#"),end:[u.url,"end"].join("#"),measure:u.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let u=performance.getEntriesByName(this._marks.measure);return u.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),u=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),u}},h.cO=function(u,o,c,f,_){return a(this,void 0,void 0,(function*(){if(oe())try{return yield Jn(u,o,c,f,_)}catch{}return(function(w,E,M,R,D){const z=w.width,V=w.height;mi&&Js||(mi=new OffscreenCanvas(z,V),Js=mi.getContext("2d",{willReadFrequently:!0})),mi.width=z,mi.height=V,Js.drawImage(w,0,0,z,V);const Z=Js.getImageData(E,M,R,D);return Js.clearRect(0,0,z,V),Z.data})(u,o,c,f,_)}))},h.cP=ds,h.cQ=T,h.cR=cp,h.cS=Fo,h.cT=kc,h.cU=function(u,o){const c=new Map;if(u!=null)if(u.type==="Feature")c.set(Ag(u,o),u);else for(const f of u.features)c.set(Ag(f,o),f);return c},h.cV=function(u,o){if(u==null)return!0;if(u.type==="Feature")return Ag(u,o)!=null;if(u.type==="FeatureCollection"){const c=new Set;for(const f of u.features){const _=Ag(f,o);if(_==null||c.has(_))return!1;c.add(_)}return!0}return!1},h.cW=function(u,o,c){var f,_,w,E;if(o.removeAll&&u.clear(),o.remove)for(const M of o.remove)u.delete(M);if(o.add)for(const M of o.add){const R=Ag(M,c);R!=null&&u.set(R,M)}if(o.update)for(const M of o.update){let R=u.get(M.id);if(R==null)continue;const D=!M.removeAllProperties&&(((f=M.removeProperties)===null||f===void 0?void 0:f.length)>0||((_=M.addOrUpdateProperties)===null||_===void 0?void 0:_.length)>0);if((M.newGeometry||M.removeAllProperties||D)&&(R=Object.assign({},R),u.set(M.id,R),D&&(R.properties=Object.assign({},R.properties))),M.newGeometry&&(R.geometry=M.newGeometry),M.removeAllProperties)R.properties={};else if(((w=M.removeProperties)===null||w===void 0?void 0:w.length)>0)for(const z of M.removeProperties)Object.prototype.hasOwnProperty.call(R.properties,z)&&delete R.properties[z];if(((E=M.addOrUpdateProperties)===null||E===void 0?void 0:E.length)>0)for(const{key:z,value:V}of M.addOrUpdateProperties)R.properties[z]=V}},h.cX=io,h.ca=function(u,o){return u[0]=o[0],u[1]=o[1],u[2]=o[2],u[3]=o[3],u[4]=o[4],u[5]=o[5],u[6]=o[6],u[7]=o[7],u[8]=o[8],u[9]=o[9],u[10]=o[10],u[11]=o[11],u[12]=o[12],u[13]=o[13],u[14]=o[14],u[15]=o[15],u},h.cb=u=>u.type==="symbol",h.cc=u=>u.type==="circle",h.cd=u=>u.type==="heatmap",h.ce=u=>u.type==="line",h.cf=u=>u.type==="fill",h.cg=u=>u.type==="fill-extrusion",h.ch=u=>u.type==="hillshade",h.ci=u=>u.type==="color-relief",h.cj=u=>u.type==="raster",h.ck=u=>u.type==="background",h.cl=u=>u.type==="custom",h.cm=Jt,h.cn=function(u,o,c){const f=tt(o.x-c.x,o.y-c.y),_=tt(u.x-c.x,u.y-c.y);var w,E;return yo(Math.atan2(f[0]*_[1]-f[1]*_[0],(w=f)[0]*(E=_)[0]+w[1]*E[1]))},h.co=Tr,h.cp=function(u,o){return Ds[o]&&(u instanceof MouseEvent||u instanceof WheelEvent)},h.cq=function(u,o){return vo[o]&&"touches"in u},h.cr=function(u){return vo[u]||Ds[u]},h.cs=function(u,o,c){var f=o[0],_=o[1];return u[0]=c[0]*f+c[4]*_+c[12],u[1]=c[1]*f+c[5]*_+c[13],u},h.ct=function(u,o){const{x:c,y:f}=Eg.fromLngLat(o);return!(u<0||u>25||f<0||f>=1||c<0||c>=1)},h.cu=function(u,o){return u[0]=o[0],u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=o[1],u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[10]=o[2],u[11]=0,u[12]=0,u[13]=0,u[14]=0,u[15]=1,u},h.cv=class extends ul{},h.cw=RB,h.cy=function(u){return u.message===Qs},h.cz=be,h.d=Ze,h.e=dr,h.f=u=>a(void 0,void 0,void 0,(function*(){if(u.byteLength===0)return createImageBitmap(new ImageData(1,1));const o=new Blob([new Uint8Array(u)],{type:"image/png"});try{return createImageBitmap(o)}catch(c){throw new Error(`Could not load image because of ${c.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}})),h.g=ee,h.h=u=>new Promise(((o,c)=>{const f=new Image;f.onload=()=>{o(f),URL.revokeObjectURL(f.src),f.onload=null,window.requestAnimationFrame((()=>{f.src=Yn}))},f.onerror=()=>c(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const _=new Blob([new Uint8Array(u)],{type:"image/png"});f.src=u.byteLength?URL.createObjectURL(_):Yn})),h.i=Li,h.j=(u,o)=>Oe(dr(u,{type:"json"}),o),h.k=at,h.l=pt,h.m=Oe,h.n=(u,o)=>Oe(dr(u,{type:"arrayBuffer"}),o),h.o=function(u){return new mp(u).readFields(my,[])},h.p=wg,h.q=No,h.r=Bn,h.s=_o,h.t=zc,h.u=kr,h.v=Le,h.w=ri,h.x=Wd,h.y=Xo,h.z=Sa})),s("worker",["./shared"],(function(h){class a{constructor(Q){this.keyCache={},Q&&this.replace(Q)}replace(Q){this._layerConfigs={},this._layers={},this.update(Q,[])}update(Q,ee){for(const be of Q){this._layerConfigs[be.id]=be;const Se=this._layers[be.id]=h.bJ(be);Se._featureFilter=h.aa(Se.filter),this.keyCache[be.id]&&delete this.keyCache[be.id]}for(const be of ee)delete this.keyCache[be],delete this._layerConfigs[be],delete this._layers[be];this.familiesBySource={};const ae=h.cC(Object.values(this._layerConfigs),this.keyCache);for(const be of ae){const Se=be.map((at=>this._layers[at.id])),Oe=Se[0];if(Oe.visibility==="none")continue;const Ze=Oe.source||"";let Be=this.familiesBySource[Ze];Be||(Be=this.familiesBySource[Ze]={});const nt=Oe.sourceLayer||"_geojsonTileLayer";let pt=Be[nt];pt||(pt=Be[nt]=[]),pt.push(Se)}}}class v{constructor(Q){const ee={},ae=[];for(const Ze in Q){const Be=Q[Ze],nt=ee[Ze]={};for(const pt in Be){const at=Be[+pt];if(!at||at.bitmap.width===0||at.bitmap.height===0)continue;const Ft={x:0,y:0,w:at.bitmap.width+2,h:at.bitmap.height+2};ae.push(Ft),nt[pt]={rect:Ft,metrics:at.metrics}}}const{w:be,h:Se}=h.p(ae),Oe=new h.q({width:be||1,height:Se||1});for(const Ze in Q){const Be=Q[Ze];for(const nt in Be){const pt=Be[+nt];if(!pt||pt.bitmap.width===0||pt.bitmap.height===0)continue;const at=ee[Ze][nt].rect;h.q.copy(pt.bitmap,Oe,{x:0,y:0},{x:at.x+1,y:at.y+1},pt.bitmap)}}this.image=Oe,this.positions=ee}}h.cD("GlyphAtlas",v);class T{constructor(Q){this.tileID=new h.Z(Q.tileID.overscaledZ,Q.tileID.wrap,Q.tileID.canonical.z,Q.tileID.canonical.x,Q.tileID.canonical.y),this.uid=Q.uid,this.zoom=Q.zoom,this.pixelRatio=Q.pixelRatio,this.tileSize=Q.tileSize,this.source=Q.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=Q.showCollisionBoxes,this.collectResourceTiming=!!Q.collectResourceTiming,this.returnDependencies=!!Q.returnDependencies,this.promoteId=Q.promoteId,this.inFlightDependencies=[],this.globalState=Q.globalState}parse(Q,ee,ae,be,Se){return h._(this,void 0,void 0,(function*(){this.status="parsing",this.data=Q,this.collisionBoxArray=new h.a8;const Oe=new h.cE(Object.keys(Q.layers).sort()),Ze=new h.cF(this.tileID,this.promoteId);Ze.bucketLayerIDs=[];const Be={},nt={featureIndex:Ze,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:ae,subdivisionGranularity:Se},pt=ee.familiesBySource[this.source];for(const Er in pt){const Pr=Q.layers[Er];if(!Pr)continue;Pr.version===1&&h.w(`Vector tile source "${this.source}" layer "${Er}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Ni=Oe.encode(Er),_t=[];for(let Ci=0;Ci<Pr.length;Ci++){const si=Pr.feature(Ci),Ns=Ze.getId(si,Er);_t.push({feature:si,id:Ns,index:Ci,sourceLayerIndex:Ni})}for(const Ci of pt[Er]){const si=Ci[0];si.source!==this.source&&h.w(`layer.source = ${si.source} does not equal this.source = ${this.source}`),si.minzoom&&this.zoom<Math.floor(si.minzoom)||si.maxzoom&&this.zoom>=si.maxzoom||si.visibility!=="none"&&(C(Ci,this.zoom,ae),(Be[si.id]=si.createBucket({index:Ze.bucketLayerIDs.length,layers:Ci,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Ni,sourceID:this.source,globalState:this.globalState})).populate(_t,nt,this.tileID.canonical),Ze.bucketLayerIDs.push(Ci.map((Ns=>Ns.id))))}}const at=h.bN(nt.glyphDependencies,(Er=>Object.keys(Er).map(Number)));this.inFlightDependencies.forEach((Er=>Er?.abort())),this.inFlightDependencies=[];let Ft=Promise.resolve({});if(Object.keys(at).length){const Er=new AbortController;this.inFlightDependencies.push(Er),Ft=be.sendAsync({type:"GG",data:{stacks:at,source:this.source,tileID:this.tileID,type:"glyphs"}},Er)}const Le=Object.keys(nt.iconDependencies);let or=Promise.resolve({});if(Le.length){const Er=new AbortController;this.inFlightDependencies.push(Er),or=be.sendAsync({type:"GI",data:{icons:Le,source:this.source,tileID:this.tileID,type:"icons"}},Er)}const Sr=Object.keys(nt.patternDependencies);let Wt=Promise.resolve({});if(Sr.length){const Er=new AbortController;this.inFlightDependencies.push(Er),Wt=be.sendAsync({type:"GI",data:{icons:Sr,source:this.source,tileID:this.tileID,type:"patterns"}},Er)}const[_r,$r,Si]=yield Promise.all([Ft,or,Wt]),Di=new v(_r),ui=new h.cG($r,Si);for(const Er in Be){const Pr=Be[Er];Pr instanceof h.a9?(C(Pr.layers,this.zoom,ae),h.cH({bucket:Pr,glyphMap:_r,glyphPositions:Di.positions,imageMap:$r,imagePositions:ui.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:nt.subdivisionGranularity})):Pr.hasPattern&&(Pr instanceof h.cI||Pr instanceof h.cJ||Pr instanceof h.cK)&&(C(Pr.layers,this.zoom,ae),Pr.addFeatures(nt,this.tileID.canonical,ui.patternPositions))}return this.status="done",{buckets:Object.values(Be).filter((Er=>!Er.isEmpty())),featureIndex:Ze,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Di.image,imageAtlas:ui,glyphMap:this.returnDependencies?_r:null,iconMap:this.returnDependencies?$r:null,glyphPositions:this.returnDependencies?Di.positions:null}}))}}function C(ke,Q,ee){const ae=new h.F(Q);for(const be of ke)be.recalculate(ae,ee)}class k{constructor(Q,ee,ae){this.actor=Q,this.layerIndex=ee,this.availableImages=ae,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(Q,ee){return h._(this,void 0,void 0,(function*(){const ae=yield h.n(Q.request,ee);try{return{vectorTile:new h.cL(new h.cM(ae.data)),rawData:ae.data,cacheControl:ae.cacheControl,expires:ae.expires}}catch(be){const Se=new Uint8Array(ae.data);let Oe=`Unable to parse the tile at ${Q.request.url}, `;throw Oe+=Se[0]===31&&Se[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${be.message}`,new Error(Oe)}}))}loadTile(Q){return h._(this,void 0,void 0,(function*(){const ee=Q.uid,ae=!!(Q&&Q.request&&Q.request.collectResourceTiming)&&new h.cN(Q.request),be=new T(Q);this.loading[ee]=be;const Se=new AbortController;be.abort=Se;try{const Oe=yield this.loadVectorTile(Q,Se);if(delete this.loading[ee],!Oe)return null;const Ze=Oe.rawData,Be={};Oe.expires&&(Be.expires=Oe.expires),Oe.cacheControl&&(Be.cacheControl=Oe.cacheControl);const nt={};if(ae){const at=ae.finish();at&&(nt.resourceTiming=JSON.parse(JSON.stringify(at)))}be.vectorTile=Oe.vectorTile;const pt=be.parse(Oe.vectorTile,this.layerIndex,this.availableImages,this.actor,Q.subdivisionGranularity);this.loaded[ee]=be,this.fetching[ee]={rawTileData:Ze,cacheControl:Be,resourceTiming:nt};try{const at=yield pt;return h.e({rawTileData:Ze.slice(0)},at,Be,nt)}finally{delete this.fetching[ee]}}catch(Oe){throw delete this.loading[ee],be.status="done",this.loaded[ee]=be,Oe}}))}reloadTile(Q){return h._(this,void 0,void 0,(function*(){const ee=Q.uid;if(!this.loaded||!this.loaded[ee])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const ae=this.loaded[ee];if(ae.showCollisionBoxes=Q.showCollisionBoxes,ae.globalState=Q.globalState,ae.status==="parsing"){const be=yield ae.parse(ae.vectorTile,this.layerIndex,this.availableImages,this.actor,Q.subdivisionGranularity);let Se;if(this.fetching[ee]){const{rawTileData:Oe,cacheControl:Ze,resourceTiming:Be}=this.fetching[ee];delete this.fetching[ee],Se=h.e({rawTileData:Oe.slice(0)},be,Ze,Be)}else Se=be;return Se}if(ae.status==="done"&&ae.vectorTile)return ae.parse(ae.vectorTile,this.layerIndex,this.availableImages,this.actor,Q.subdivisionGranularity)}))}abortTile(Q){return h._(this,void 0,void 0,(function*(){const ee=this.loading,ae=Q.uid;ee&&ee[ae]&&ee[ae].abort&&(ee[ae].abort.abort(),delete ee[ae])}))}removeTile(Q){return h._(this,void 0,void 0,(function*(){this.loaded&&this.loaded[Q.uid]&&delete this.loaded[Q.uid]}))}}class L{constructor(){this.loaded={}}loadTile(Q){return h._(this,void 0,void 0,(function*(){const{uid:ee,encoding:ae,rawImageData:be,redFactor:Se,greenFactor:Oe,blueFactor:Ze,baseShift:Be}=Q,nt=be.width+2,pt=be.height+2,at=h.b(be)?new h.R({width:nt,height:pt},yield h.cO(be,-1,-1,nt,pt)):be,Ft=new h.cP(ee,at,ae,Se,Oe,Ze,Be);return this.loaded=this.loaded||{},this.loaded[ee]=Ft,Ft}))}removeTile(Q){const ee=this.loaded,ae=Q.uid;ee&&ee[ae]&&delete ee[ae]}}var O,K,$=(function(){if(K)return O;function ke(ee,ae){if(ee.length!==0){Q(ee[0],ae);for(var be=1;be<ee.length;be++)Q(ee[be],!ae)}}function Q(ee,ae){for(var be=0,Se=0,Oe=0,Ze=ee.length,Be=Ze-1;Oe<Ze;Be=Oe++){var nt=(ee[Oe][0]-ee[Be][0])*(ee[Be][1]+ee[Oe][1]),pt=be+nt;Se+=Math.abs(be)>=Math.abs(nt)?be-pt+nt:nt-pt+be,be=pt}be+Se>=0!=!!ae&&ee.reverse()}return K=1,O=function ee(ae,be){var Se,Oe=ae&&ae.type;if(Oe==="FeatureCollection")for(Se=0;Se<ae.features.length;Se++)ee(ae.features[Se],be);else if(Oe==="GeometryCollection")for(Se=0;Se<ae.geometries.length;Se++)ee(ae.geometries[Se],be);else if(Oe==="Feature")ee(ae.geometry,be);else if(Oe==="Polygon")ke(ae.coordinates,be);else if(Oe==="MultiPolygon")for(Se=0;Se<ae.coordinates.length;Se++)ke(ae.coordinates[Se],be);return ae}})(),ne=h.cQ($);class oe extends h.cS{constructor(Q,ee){super(new h.cM,0,ee,[],[]),this.feature=Q,this.type=Q.type,this.properties=Q.tags?Q.tags:{},"id"in Q&&(typeof Q.id=="string"?this.id=parseInt(Q.id,10):typeof Q.id!="number"||isNaN(Q.id)||(this.id=Q.id))}loadGeometry(){const Q=[],ee=this.feature.type===1?[this.feature.geometry]:this.feature.geometry;for(const ae of ee){const be=[];for(const Se of ae)be.push(new h.P(Se[0],Se[1]));Q.push(be)}return Q}}class fe extends h.cR{constructor(Q,ee){super(new h.cM),this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.version=ee?ee.version:1,this.extent=ee?ee.extent:4096,this.length=Q.length,this.features=Q}feature(Q){return new oe(this.features[Q],this.extent)}}function ue(ke,Q){Q.writeVarintField(15,ke.version||1),Q.writeStringField(1,ke.name||""),Q.writeVarintField(5,ke.extent||4096);const ee={keys:[],values:[],keycache:{},valuecache:{}};for(let Se=0;Se<ke.length;Se++)ee.feature=ke.feature(Se),Q.writeMessage(2,we,ee);const ae=ee.keys;for(const Se of ae)Q.writeStringField(3,Se);const be=ee.values;for(const Se of be)Q.writeMessage(4,it,Se)}function we(ke,Q){if(!ke.feature)return;const ee=ke.feature;ee.id!==void 0&&Q.writeVarintField(1,ee.id),Q.writeMessage(2,De,ke),Q.writeVarintField(3,ee.type),Q.writeMessage(4,ze,ee)}function De(ke,Q){for(const ee in ke.feature?.properties){let ae=ke.feature.properties[ee],be=ke.keycache[ee];if(ae===null)continue;be===void 0&&(ke.keys.push(ee),be=ke.keys.length-1,ke.keycache[ee]=be),Q.writeVarint(be),typeof ae!="string"&&typeof ae!="boolean"&&typeof ae!="number"&&(ae=JSON.stringify(ae));const Se=typeof ae+":"+ae;let Oe=ke.valuecache[Se];Oe===void 0&&(ke.values.push(ae),Oe=ke.values.length-1,ke.valuecache[Se]=Oe),Q.writeVarint(Oe)}}function Fe(ke,Q){return(Q<<3)+(7&ke)}function Ke(ke){return ke<<1^ke>>31}function ze(ke,Q){const ee=ke.loadGeometry(),ae=ke.type;let be=0,Se=0;for(const Oe of ee){let Ze=1;ae===1&&(Ze=Oe.length),Q.writeVarint(Fe(1,Ze));const Be=ae===3?Oe.length-1:Oe.length;for(let nt=0;nt<Be;nt++){nt===1&&ae!==1&&Q.writeVarint(Fe(2,Be-1));const pt=Oe[nt].x-be,at=Oe[nt].y-Se;Q.writeVarint(Ke(pt)),Q.writeVarint(Ke(at)),be+=pt,Se+=at}ke.type===3&&Q.writeVarint(Fe(7,1))}}function it(ke,Q){const ee=typeof ke;ee==="string"?Q.writeStringField(1,ke):ee==="boolean"?Q.writeBooleanField(7,ke):ee==="number"&&(ke%1!=0?Q.writeDoubleField(3,ke):ke<0?Q.writeSVarintField(6,ke):Q.writeVarintField(5,ke))}const lt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ke=>ke},ht=Math.fround||(vt=new Float32Array(1),ke=>(vt[0]=+ke,vt[0]));var vt;class Nt{constructor(Q){this.options=Object.assign(Object.create(lt),Q),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(Q){const{log:ee,minZoom:ae,maxZoom:be}=this.options;ee&&console.time("total time");const Se=`prepare ${Q.length} points`;ee&&console.time(Se),this.points=Q;const Oe=[];for(let Be=0;Be<Q.length;Be++){const nt=Q[Be];if(!nt.geometry)continue;const[pt,at]=nt.geometry.coordinates,Ft=ht(Qt(pt)),Le=ht(Ot(at));Oe.push(Ft,Le,1/0,Be,-1,1),this.options.reduce&&Oe.push(0)}let Ze=this.trees[be+1]=this._createTree(Oe);ee&&console.timeEnd(Se);for(let Be=be;Be>=ae;Be--){const nt=+Date.now();Ze=this.trees[Be]=this._createTree(this._cluster(Ze,Be)),ee&&console.log("z%d: %d clusters in %dms",Be,Ze.numItems,+Date.now()-nt)}return ee&&console.timeEnd("total time"),this}getClusters(Q,ee){let ae=((Q[0]+180)%360+360)%360-180;const be=Math.max(-90,Math.min(90,Q[1]));let Se=Q[2]===180?180:((Q[2]+180)%360+360)%360-180;const Oe=Math.max(-90,Math.min(90,Q[3]));if(Q[2]-Q[0]>=360)ae=-180,Se=180;else if(ae>Se){const at=this.getClusters([ae,be,180,Oe],ee),Ft=this.getClusters([-180,be,Se,Oe],ee);return at.concat(Ft)}const Ze=this.trees[this._limitZoom(ee)],Be=Ze.range(Qt(ae),Ot(Oe),Qt(Se),Ot(be)),nt=Ze.data,pt=[];for(const at of Be){const Ft=this.stride*at;pt.push(nt[Ft+5]>1?Lt(nt,Ft,this.clusterProps):this.points[nt[Ft+3]])}return pt}getChildren(Q){const ee=this._getOriginId(Q),ae=this._getOriginZoom(Q),be="No cluster with the specified id.",Se=this.trees[ae];if(!Se)throw new Error(be);const Oe=Se.data;if(ee*this.stride>=Oe.length)throw new Error(be);const Ze=this.options.radius/(this.options.extent*Math.pow(2,ae-1)),Be=Se.within(Oe[ee*this.stride],Oe[ee*this.stride+1],Ze),nt=[];for(const pt of Be){const at=pt*this.stride;Oe[at+4]===Q&&nt.push(Oe[at+5]>1?Lt(Oe,at,this.clusterProps):this.points[Oe[at+3]])}if(nt.length===0)throw new Error(be);return nt}getLeaves(Q,ee,ae){const be=[];return this._appendLeaves(be,Q,ee=ee||10,ae=ae||0,0),be}getTile(Q,ee,ae){const be=this.trees[this._limitZoom(Q)],Se=Math.pow(2,Q),{extent:Oe,radius:Ze}=this.options,Be=Ze/Oe,nt=(ae-Be)/Se,pt=(ae+1+Be)/Se,at={features:[]};return this._addTileFeatures(be.range((ee-Be)/Se,nt,(ee+1+Be)/Se,pt),be.data,ee,ae,Se,at),ee===0&&this._addTileFeatures(be.range(1-Be/Se,nt,1,pt),be.data,Se,ae,Se,at),ee===Se-1&&this._addTileFeatures(be.range(0,nt,Be/Se,pt),be.data,-1,ae,Se,at),at.features.length?at:null}getClusterExpansionZoom(Q){let ee=this._getOriginZoom(Q)-1;for(;ee<=this.options.maxZoom;){const ae=this.getChildren(Q);if(ee++,ae.length!==1)break;Q=ae[0].properties.cluster_id}return ee}_appendLeaves(Q,ee,ae,be,Se){const Oe=this.getChildren(ee);for(const Ze of Oe){const Be=Ze.properties;if(Be&&Be.cluster?Se+Be.point_count<=be?Se+=Be.point_count:Se=this._appendLeaves(Q,Be.cluster_id,ae,be,Se):Se<be?Se++:Q.push(Ze),Q.length===ae)break}return Se}_createTree(Q){const ee=new h.aI(Q.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ae=0;ae<Q.length;ae+=this.stride)ee.add(Q[ae],Q[ae+1]);return ee.finish(),ee.data=Q,ee}_addTileFeatures(Q,ee,ae,be,Se,Oe){for(const Ze of Q){const Be=Ze*this.stride,nt=ee[Be+5]>1;let pt,at,Ft;if(nt)pt=qt(ee,Be,this.clusterProps),at=ee[Be],Ft=ee[Be+1];else{const Sr=this.points[ee[Be+3]];pt=Sr.properties;const[Wt,_r]=Sr.geometry.coordinates;at=Qt(Wt),Ft=Ot(_r)}const Le={type:1,geometry:[[Math.round(this.options.extent*(at*Se-ae)),Math.round(this.options.extent*(Ft*Se-be))]],tags:pt};let or;or=nt||this.options.generateId?ee[Be+3]:this.points[ee[Be+3]].id,or!==void 0&&(Le.id=or),Oe.features.push(Le)}}_limitZoom(Q){return Math.max(this.options.minZoom,Math.min(Math.floor(+Q),this.options.maxZoom+1))}_cluster(Q,ee){const{radius:ae,extent:be,reduce:Se,minPoints:Oe}=this.options,Ze=ae/(be*Math.pow(2,ee)),Be=Q.data,nt=[],pt=this.stride;for(let at=0;at<Be.length;at+=pt){if(Be[at+2]<=ee)continue;Be[at+2]=ee;const Ft=Be[at],Le=Be[at+1],or=Q.within(Be[at],Be[at+1],Ze),Sr=Be[at+5];let Wt=Sr;for(const _r of or){const $r=_r*pt;Be[$r+2]>ee&&(Wt+=Be[$r+5])}if(Wt>Sr&&Wt>=Oe){let _r,$r=Ft*Sr,Si=Le*Sr,Di=-1;const ui=(at/pt<<5)+(ee+1)+this.points.length;for(const Er of or){const Pr=Er*pt;if(Be[Pr+2]<=ee)continue;Be[Pr+2]=ee;const Ni=Be[Pr+5];$r+=Be[Pr]*Ni,Si+=Be[Pr+1]*Ni,Be[Pr+4]=ui,Se&&(_r||(_r=this._map(Be,at,!0),Di=this.clusterProps.length,this.clusterProps.push(_r)),Se(_r,this._map(Be,Pr)))}Be[at+4]=ui,nt.push($r/Wt,Si/Wt,1/0,ui,-1,Wt),Se&&nt.push(Di)}else{for(let _r=0;_r<pt;_r++)nt.push(Be[at+_r]);if(Wt>1)for(const _r of or){const $r=_r*pt;if(!(Be[$r+2]<=ee)){Be[$r+2]=ee;for(let Si=0;Si<pt;Si++)nt.push(Be[$r+Si])}}}}return nt}_getOriginId(Q){return Q-this.points.length>>5}_getOriginZoom(Q){return(Q-this.points.length)%32}_map(Q,ee,ae){if(Q[ee+5]>1){const Oe=this.clusterProps[Q[ee+6]];return ae?Object.assign({},Oe):Oe}const be=this.points[Q[ee+3]].properties,Se=this.options.map(be);return ae&&Se===be?Object.assign({},Se):Se}}function Lt(ke,Q,ee){return{type:"Feature",id:ke[Q+3],properties:qt(ke,Q,ee),geometry:{type:"Point",coordinates:[(ae=ke[Q],360*(ae-.5)),tt(ke[Q+1])]}};var ae}function qt(ke,Q,ee){const ae=ke[Q+5],be=ae>=1e4?`${Math.round(ae/1e3)}k`:ae>=1e3?Math.round(ae/100)/10+"k":ae,Se=ke[Q+6],Oe=Se===-1?{}:Object.assign({},ee[Se]);return Object.assign(Oe,{cluster:!0,cluster_id:ke[Q+3],point_count:ae,point_count_abbreviated:be})}function Qt(ke){return ke/360+.5}function Ot(ke){const Q=Math.sin(ke*Math.PI/180),ee=.5-.25*Math.log((1+Q)/(1-Q))/Math.PI;return ee<0?0:ee>1?1:ee}function tt(ke){const Q=(180-360*ke)*Math.PI/180;return 360*Math.atan(Math.exp(Q))/Math.PI-90}function wt(ke,Q,ee,ae){let be=ae;const Se=Q+(ee-Q>>1);let Oe,Ze=ee-Q;const Be=ke[Q],nt=ke[Q+1],pt=ke[ee],at=ke[ee+1];for(let Ft=Q+3;Ft<ee;Ft+=3){const Le=Bt(ke[Ft],ke[Ft+1],Be,nt,pt,at);if(Le>be)Oe=Ft,be=Le;else if(Le===be){const or=Math.abs(Ft-Se);or<Ze&&(Oe=Ft,Ze=or)}}be>ae&&(Oe-Q>3&&wt(ke,Q,Oe,ae),ke[Oe+2]=be,ee-Oe>3&&wt(ke,Oe,ee,ae))}function Bt(ke,Q,ee,ae,be,Se){let Oe=be-ee,Ze=Se-ae;if(Oe!==0||Ze!==0){const Be=((ke-ee)*Oe+(Q-ae)*Ze)/(Oe*Oe+Ze*Ze);Be>1?(ee=be,ae=Se):Be>0&&(ee+=Oe*Be,ae+=Ze*Be)}return Oe=ke-ee,Ze=Q-ae,Oe*Oe+Ze*Ze}function Ue(ke,Q,ee,ae){const be={id:ke??null,type:Q,geometry:ee,tags:ae,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(Q==="Point"||Q==="MultiPoint"||Q==="LineString")dt(be,ee);else if(Q==="Polygon")dt(be,ee[0]);else if(Q==="MultiLineString")for(const Se of ee)dt(be,Se);else if(Q==="MultiPolygon")for(const Se of ee)dt(be,Se[0]);return be}function dt(ke,Q){for(let ee=0;ee<Q.length;ee+=3)ke.minX=Math.min(ke.minX,Q[ee]),ke.minY=Math.min(ke.minY,Q[ee+1]),ke.maxX=Math.max(ke.maxX,Q[ee]),ke.maxY=Math.max(ke.maxY,Q[ee+1])}function Gt(ke,Q,ee,ae){if(!Q.geometry)return;const be=Q.geometry.coordinates;if(be&&be.length===0)return;const Se=Q.geometry.type,Oe=Math.pow(ee.tolerance/((1<<ee.maxZoom)*ee.extent),2);let Ze=[],Be=Q.id;if(ee.promoteId?Be=Q.properties[ee.promoteId]:ee.generateId&&(Be=ae||0),Se==="Point")Jt(be,Ze);else if(Se==="MultiPoint")for(const nt of be)Jt(nt,Ze);else if(Se==="LineString")Tr(be,Ze,Oe,!1);else if(Se==="MultiLineString"){if(ee.lineMetrics){for(const nt of be)Ze=[],Tr(nt,Ze,Oe,!1),ke.push(Ue(Be,"LineString",Ze,Q.properties));return}gr(be,Ze,Oe,!1)}else if(Se==="Polygon")gr(be,Ze,Oe,!0);else{if(Se!=="MultiPolygon"){if(Se==="GeometryCollection"){for(const nt of Q.geometry.geometries)Gt(ke,{id:Be,geometry:nt,properties:Q.properties},ee,ae);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const nt of be){const pt=[];gr(nt,pt,Oe,!0),Ze.push(pt)}}ke.push(Ue(Be,Se,Ze,Q.properties))}function Jt(ke,Q){Q.push(Ht(ke[0]),dr(ke[1]),0)}function Tr(ke,Q,ee,ae){let be,Se,Oe=0;for(let Be=0;Be<ke.length;Be++){const nt=Ht(ke[Be][0]),pt=dr(ke[Be][1]);Q.push(nt,pt,0),Be>0&&(Oe+=ae?(be*pt-nt*Se)/2:Math.sqrt(Math.pow(nt-be,2)+Math.pow(pt-Se,2))),be=nt,Se=pt}const Ze=Q.length-3;Q[2]=1,wt(Q,0,Ze,ee),Q[Ze+2]=1,Q.size=Math.abs(Oe),Q.start=0,Q.end=Q.size}function gr(ke,Q,ee,ae){for(let be=0;be<ke.length;be++){const Se=[];Tr(ke[be],Se,ee,ae),Q.push(Se)}}function Ht(ke){return ke/360+.5}function dr(ke){const Q=Math.sin(ke*Math.PI/180),ee=.5-.25*Math.log((1+Q)/(1-Q))/Math.PI;return ee<0?0:ee>1?1:ee}function er(ke,Q,ee,ae,be,Se,Oe,Ze){if(ae/=Q,Se>=(ee/=Q)&&Oe<ae)return ke;if(Oe<ee||Se>=ae)return null;const Be=[];for(const nt of ke){const pt=nt.geometry;let at=nt.type;const Ft=be===0?nt.minX:nt.minY,Le=be===0?nt.maxX:nt.maxY;if(Ft>=ee&&Le<ae){Be.push(nt);continue}if(Le<ee||Ft>=ae)continue;let or=[];if(at==="Point"||at==="MultiPoint")Lr(pt,or,ee,ae,be);else if(at==="LineString")yn(pt,or,ee,ae,be,!1,Ze.lineMetrics);else if(at==="MultiLineString")qr(pt,or,ee,ae,be,!1);else if(at==="Polygon")qr(pt,or,ee,ae,be,!0);else if(at==="MultiPolygon")for(const Sr of pt){const Wt=[];qr(Sr,Wt,ee,ae,be,!0),Wt.length&&or.push(Wt)}if(or.length){if(Ze.lineMetrics&&at==="LineString"){for(const Sr of or)Be.push(Ue(nt.id,at,Sr,nt.tags));continue}at!=="LineString"&&at!=="MultiLineString"||(or.length===1?(at="LineString",or=or[0]):at="MultiLineString"),at!=="Point"&&at!=="MultiPoint"||(at=or.length===3?"Point":"MultiPoint"),Be.push(Ue(nt.id,at,or,nt.tags))}}return Be.length?Be:null}function Lr(ke,Q,ee,ae,be){for(let Se=0;Se<ke.length;Se+=3){const Oe=ke[Se+be];Oe>=ee&&Oe<=ae&&ri(Q,ke[Se],ke[Se+1],ke[Se+2])}}function yn(ke,Q,ee,ae,be,Se,Oe){let Ze=yi(ke);const Be=be===0?vn:Li;let nt,pt,at=ke.start;for(let Wt=0;Wt<ke.length-3;Wt+=3){const _r=ke[Wt],$r=ke[Wt+1],Si=ke[Wt+2],Di=ke[Wt+3],ui=ke[Wt+4],Er=be===0?_r:$r,Pr=be===0?Di:ui;let Ni=!1;Oe&&(nt=Math.sqrt(Math.pow(_r-Di,2)+Math.pow($r-ui,2))),Er<ee?Pr>ee&&(pt=Be(Ze,_r,$r,Di,ui,ee),Oe&&(Ze.start=at+nt*pt)):Er>ae?Pr<ae&&(pt=Be(Ze,_r,$r,Di,ui,ae),Oe&&(Ze.start=at+nt*pt)):ri(Ze,_r,$r,Si),Pr<ee&&Er>=ee&&(pt=Be(Ze,_r,$r,Di,ui,ee),Ni=!0),Pr>ae&&Er<=ae&&(pt=Be(Ze,_r,$r,Di,ui,ae),Ni=!0),!Se&&Ni&&(Oe&&(Ze.end=at+nt*pt),Q.push(Ze),Ze=yi(ke)),Oe&&(at+=nt)}let Ft=ke.length-3;const Le=ke[Ft],or=ke[Ft+1],Sr=be===0?Le:or;Sr>=ee&&Sr<=ae&&ri(Ze,Le,or,ke[Ft+2]),Ft=Ze.length-3,Se&&Ft>=3&&(Ze[Ft]!==Ze[0]||Ze[Ft+1]!==Ze[1])&&ri(Ze,Ze[0],Ze[1],Ze[2]),Ze.length&&Q.push(Ze)}function yi(ke){const Q=[];return Q.size=ke.size,Q.start=ke.start,Q.end=ke.end,Q}function qr(ke,Q,ee,ae,be,Se){for(const Oe of ke)yn(Oe,Q,ee,ae,be,Se,!1)}function ri(ke,Q,ee,ae){ke.push(Q,ee,ae)}function vn(ke,Q,ee,ae,be,Se){const Oe=(Se-Q)/(ae-Q);return ri(ke,Se,ee+(be-ee)*Oe,1),Oe}function Li(ke,Q,ee,ae,be,Se){const Oe=(Se-ee)/(be-ee);return ri(ke,Q+(ae-Q)*Oe,Se,1),Oe}function Mn(ke,Q){const ee=[];for(let ae=0;ae<ke.length;ae++){const be=ke[ae],Se=be.type;let Oe;if(Se==="Point"||Se==="MultiPoint"||Se==="LineString")Oe=bs(be.geometry,Q);else if(Se==="MultiLineString"||Se==="Polygon"){Oe=[];for(const Ze of be.geometry)Oe.push(bs(Ze,Q))}else if(Se==="MultiPolygon"){Oe=[];for(const Ze of be.geometry){const Be=[];for(const nt of Ze)Be.push(bs(nt,Q));Oe.push(Be)}}ee.push(Ue(be.id,Se,Oe,be.tags))}return ee}function bs(ke,Q){const ee=[];ee.size=ke.size,ke.start!==void 0&&(ee.start=ke.start,ee.end=ke.end);for(let ae=0;ae<ke.length;ae+=3)ee.push(ke[ae]+Q,ke[ae+1],ke[ae+2]);return ee}function Yn(ke,Q){if(ke.transformed)return ke;const ee=1<<ke.z,ae=ke.x,be=ke.y;for(const Se of ke.features){const Oe=Se.geometry,Ze=Se.type;if(Se.geometry=[],Ze===1)for(let Be=0;Be<Oe.length;Be+=2)Se.geometry.push(Jn(Oe[Be],Oe[Be+1],Q,ee,ae,be));else for(let Be=0;Be<Oe.length;Be++){const nt=[];for(let pt=0;pt<Oe[Be].length;pt+=2)nt.push(Jn(Oe[Be][pt],Oe[Be][pt+1],Q,ee,ae,be));Se.geometry.push(nt)}}return ke.transformed=!0,ke}function Jn(ke,Q,ee,ae,be,Se){return[Math.round(ee*(ke*ae-be)),Math.round(ee*(Q*ae-Se))]}function mi(ke,Q,ee,ae,be){const Se=Q===be.maxZoom?0:be.tolerance/((1<<Q)*be.extent),Oe={features:[],numPoints:0,numSimplified:0,numFeatures:ke.length,source:null,x:ee,y:ae,z:Q,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Ze of ke)Js(Oe,Ze,Se,be);return Oe}function Js(ke,Q,ee,ae){const be=Q.geometry,Se=Q.type,Oe=[];if(ke.minX=Math.min(ke.minX,Q.minX),ke.minY=Math.min(ke.minY,Q.minY),ke.maxX=Math.max(ke.maxX,Q.maxX),ke.maxY=Math.max(ke.maxY,Q.maxY),Se==="Point"||Se==="MultiPoint")for(let Ze=0;Ze<be.length;Ze+=3)Oe.push(be[Ze],be[Ze+1]),ke.numPoints++,ke.numSimplified++;else if(Se==="LineString")_o(Oe,be,ke,ee,!1,!1);else if(Se==="MultiLineString"||Se==="Polygon")for(let Ze=0;Ze<be.length;Ze++)_o(Oe,be[Ze],ke,ee,Se==="Polygon",Ze===0);else if(Se==="MultiPolygon")for(let Ze=0;Ze<be.length;Ze++){const Be=be[Ze];for(let nt=0;nt<Be.length;nt++)_o(Oe,Be[nt],ke,ee,!0,nt===0)}if(Oe.length){let Ze=Q.tags||null;if(Se==="LineString"&&ae.lineMetrics){Ze={};for(const nt in Q.tags)Ze[nt]=Q.tags[nt];Ze.mapbox_clip_start=be.start/be.size,Ze.mapbox_clip_end=be.end/be.size}const Be={geometry:Oe,type:Se==="Polygon"||Se==="MultiPolygon"?3:Se==="LineString"||Se==="MultiLineString"?2:1,tags:Ze};Q.id!==null&&(Be.id=Q.id),ke.features.push(Be)}}function _o(ke,Q,ee,ae,be,Se){const Oe=ae*ae;if(ae>0&&Q.size<(be?Oe:ae))return void(ee.numPoints+=Q.length/3);const Ze=[];for(let Be=0;Be<Q.length;Be+=3)(ae===0||Q[Be+2]>Oe)&&(ee.numSimplified++,Ze.push(Q[Be],Q[Be+1])),ee.numPoints++;be&&(function(Be,nt){let pt=0;for(let at=0,Ft=Be.length,Le=Ft-2;at<Ft;Le=at,at+=2)pt+=(Be[at]-Be[Le])*(Be[at+1]+Be[Le+1]);if(pt>0===nt)for(let at=0,Ft=Be.length;at<Ft/2;at+=2){const Le=Be[at],or=Be[at+1];Be[at]=Be[Ft-2-at],Be[at+1]=Be[Ft-1-at],Be[Ft-2-at]=Le,Be[Ft-1-at]=or}})(Ze,Se),ke.push(Ze)}const Go={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class yo{constructor(Q,ee){const ae=(ee=this.options=(function(Se,Oe){for(const Ze in Oe)Se[Ze]=Oe[Ze];return Se})(Object.create(Go),ee)).debug;if(ae&&console.time("preprocess data"),ee.maxZoom<0||ee.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ee.promoteId&&ee.generateId)throw new Error("promoteId and generateId cannot be used together.");let be=(function(Se,Oe){const Ze=[];if(Se.type==="FeatureCollection")for(let Be=0;Be<Se.features.length;Be++)Gt(Ze,Se.features[Be],Oe,Be);else Gt(Ze,Se.type==="Feature"?Se:{geometry:Se},Oe);return Ze})(Q,ee);this.tiles={},this.tileCoords=[],ae&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ee.indexMaxZoom,ee.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),be=(function(Se,Oe){const Ze=Oe.buffer/Oe.extent;let Be=Se;const nt=er(Se,1,-1-Ze,Ze,0,-1,2,Oe),pt=er(Se,1,1-Ze,2+Ze,0,-1,2,Oe);return(nt||pt)&&(Be=er(Se,1,-Ze,1+Ze,0,-1,2,Oe)||[],nt&&(Be=Mn(nt,1).concat(Be)),pt&&(Be=Be.concat(Mn(pt,-1)))),Be})(be,ee),be.length&&this.splitTile(be,0,0,0),ae&&(be.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(Q,ee,ae,be,Se,Oe,Ze){const Be=[Q,ee,ae,be],nt=this.options,pt=nt.debug;for(;Be.length;){be=Be.pop(),ae=Be.pop(),ee=Be.pop(),Q=Be.pop();const at=1<<ee,Ft=vo(ee,ae,be);let Le=this.tiles[Ft];if(!Le&&(pt>1&&console.time("creation"),Le=this.tiles[Ft]=mi(Q,ee,ae,be,nt),this.tileCoords.push({z:ee,x:ae,y:be}),pt)){pt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ee,ae,be,Le.numFeatures,Le.numPoints,Le.numSimplified),console.timeEnd("creation"));const Ni=`z${ee}`;this.stats[Ni]=(this.stats[Ni]||0)+1,this.total++}if(Le.source=Q,Se==null){if(ee===nt.indexMaxZoom||Le.numPoints<=nt.indexMaxPoints)continue}else{if(ee===nt.maxZoom||ee===Se)continue;if(Se!=null){const Ni=Se-ee;if(ae!==Oe>>Ni||be!==Ze>>Ni)continue}}if(Le.source=null,Q.length===0)continue;pt>1&&console.time("clipping");const or=.5*nt.buffer/nt.extent,Sr=.5-or,Wt=.5+or,_r=1+or;let $r=null,Si=null,Di=null,ui=null,Er=er(Q,at,ae-or,ae+Wt,0,Le.minX,Le.maxX,nt),Pr=er(Q,at,ae+Sr,ae+_r,0,Le.minX,Le.maxX,nt);Q=null,Er&&($r=er(Er,at,be-or,be+Wt,1,Le.minY,Le.maxY,nt),Si=er(Er,at,be+Sr,be+_r,1,Le.minY,Le.maxY,nt),Er=null),Pr&&(Di=er(Pr,at,be-or,be+Wt,1,Le.minY,Le.maxY,nt),ui=er(Pr,at,be+Sr,be+_r,1,Le.minY,Le.maxY,nt),Pr=null),pt>1&&console.timeEnd("clipping"),Be.push($r||[],ee+1,2*ae,2*be),Be.push(Si||[],ee+1,2*ae,2*be+1),Be.push(Di||[],ee+1,2*ae+1,2*be),Be.push(ui||[],ee+1,2*ae+1,2*be+1)}}getTile(Q,ee,ae){Q=+Q,ee=+ee,ae=+ae;const be=this.options,{extent:Se,debug:Oe}=be;if(Q<0||Q>24)return null;const Ze=1<<Q,Be=vo(Q,ee=ee+Ze&Ze-1,ae);if(this.tiles[Be])return Yn(this.tiles[Be],Se);Oe>1&&console.log("drilling down to z%d-%d-%d",Q,ee,ae);let nt,pt=Q,at=ee,Ft=ae;for(;!nt&&pt>0;)pt--,at>>=1,Ft>>=1,nt=this.tiles[vo(pt,at,Ft)];return nt&&nt.source?(Oe>1&&(console.log("found parent tile z%d-%d-%d",pt,at,Ft),console.time("drilling down")),this.splitTile(nt.source,pt,at,Ft,Q,ee,ae),Oe>1&&console.timeEnd("drilling down"),this.tiles[Be]?Yn(this.tiles[Be],Se):null):null}}function vo(ke,Q,ee){return 32*((1<<ke)*ee+Q)+ke}class Ds extends k{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(Q,ee){return h._(this,void 0,void 0,(function*(){const ae=Q.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const be=this._geoJSONIndex.getTile(ae.z,ae.x,ae.y);if(!be)return null;const Se=new fe(be.features,{version:2,extent:h.$});let Oe=(function(Ze){const Be=new h.cM;return(function(nt,pt){for(const at in nt.layers)pt.writeMessage(3,ue,nt.layers[at])})(Ze,Be),Be.finish()})(Se);return Oe.byteOffset===0&&Oe.byteLength===Oe.buffer.byteLength||(Oe=new Uint8Array(Oe)),{vectorTile:Se,rawData:Oe.buffer}}))}loadData(Q){return h._(this,void 0,void 0,(function*(){var ee;(ee=this._pendingRequest)===null||ee===void 0||ee.abort();const ae=!!(Q&&Q.request&&Q.request.collectResourceTiming)&&new h.cN(Q.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(Q,this._pendingRequest);const be=yield this._pendingData;this._geoJSONIndex=Q.cluster?new Nt((function({superclusterOptions:Oe,clusterProperties:Ze}){if(!Ze||!Oe)return Oe;const Be={},nt={},pt={accumulated:null,zoom:0},at={properties:null},Ft=Object.keys(Ze);for(const Le of Ft){const[or,Sr]=Ze[Le],Wt=h.cT(Sr),_r=h.cT(typeof or=="string"?[or,["accumulated"],["get",Le]]:or);Be[Le]=Wt.value,nt[Le]=_r.value}return Oe.map=Le=>{at.properties=Le;const or={};for(const Sr of Ft)or[Sr]=Be[Sr].evaluate(pt,at);return or},Oe.reduce=(Le,or)=>{at.properties=or;for(const Sr of Ft)pt.accumulated=Le[Sr],Le[Sr]=nt[Sr].evaluate(pt,at)},Oe})(Q)).load(be.features):(function(Oe,Ze){return new yo(Oe,Ze)})(be,Q.geojsonVtOptions),this.loaded={};const Se={data:be};if(ae){const Oe=ae.finish();Oe&&(Se.resourceTiming={},Se.resourceTiming[Q.source]=JSON.parse(JSON.stringify(Oe)))}return Se}catch(be){if(delete this._pendingRequest,h.cy(be))return{abandoned:!0};throw be}}))}getData(){return h._(this,void 0,void 0,(function*(){return this._pendingData}))}reloadTile(Q){const ee=this.loaded;return ee&&ee[Q.uid]?super.reloadTile(Q):this.loadTile(Q)}loadAndProcessGeoJSON(Q,ee){return h._(this,void 0,void 0,(function*(){let ae=yield this.loadGeoJSON(Q,ee);if(delete this._pendingRequest,typeof ae!="object")throw new Error(`Input data given to '${Q.source}' is not a valid GeoJSON object.`);if(ne(ae,!0),Q.filter){const be=h.cT(Q.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(be.result==="error")throw new Error(be.value.map((Se=>`${Se.key}: ${Se.message}`)).join(", "));ae={type:"FeatureCollection",features:ae.features.filter((Se=>be.value.evaluate({zoom:0},Se)))}}return ae}))}loadGeoJSON(Q,ee){return h._(this,void 0,void 0,(function*(){const{promoteId:ae}=Q;if(Q.request){const be=yield h.j(Q.request,ee);return this._dataUpdateable=h.cV(be.data,ae)?h.cU(be.data,ae):void 0,be.data}if(typeof Q.data=="string")try{const be=JSON.parse(Q.data);return this._dataUpdateable=h.cV(be,ae)?h.cU(be,ae):void 0,be}catch{throw new Error(`Input data given to '${Q.source}' is not a valid GeoJSON object.`)}if(!Q.dataDiff)throw new Error(`Input data given to '${Q.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${Q.source}`);return h.cW(this._dataUpdateable,Q.dataDiff,ae),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}}))}removeSource(Q){return h._(this,void 0,void 0,(function*(){this._pendingRequest&&this._pendingRequest.abort()}))}getClusterExpansionZoom(Q){return this._geoJSONIndex.getClusterExpansionZoom(Q.clusterId)}getClusterChildren(Q){return this._geoJSONIndex.getChildren(Q.clusterId)}getClusterLeaves(Q){return this._geoJSONIndex.getLeaves(Q.clusterId,Q.limit,Q.offset)}}class Qs{constructor(Q){this.self=Q,this.actor=new h.J(Q),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(ee,ae)=>{if(this.externalWorkerSourceTypes[ee])throw new Error(`Worker source with name "${ee}" already registered.`);this.externalWorkerSourceTypes[ee]=ae},this.self.addProtocol=h.cA,this.self.removeProtocol=h.cB,this.self.registerRTLTextPlugin=ee=>{h.cX.setMethods(ee)},this.actor.registerMessageHandler("LDT",((ee,ae)=>this._getDEMWorkerSource(ee,ae.source).loadTile(ae))),this.actor.registerMessageHandler("RDT",((ee,ae)=>h._(this,void 0,void 0,(function*(){this._getDEMWorkerSource(ee,ae.source).removeTile(ae)})))),this.actor.registerMessageHandler("GCEZ",((ee,ae)=>h._(this,void 0,void 0,(function*(){return this._getWorkerSource(ee,ae.type,ae.source).getClusterExpansionZoom(ae)})))),this.actor.registerMessageHandler("GCC",((ee,ae)=>h._(this,void 0,void 0,(function*(){return this._getWorkerSource(ee,ae.type,ae.source).getClusterChildren(ae)})))),this.actor.registerMessageHandler("GCL",((ee,ae)=>h._(this,void 0,void 0,(function*(){return this._getWorkerSource(ee,ae.type,ae.source).getClusterLeaves(ae)})))),this.actor.registerMessageHandler("LD",((ee,ae)=>this._getWorkerSource(ee,ae.type,ae.source).loadData(ae))),this.actor.registerMessageHandler("GD",((ee,ae)=>this._getWorkerSource(ee,ae.type,ae.source).getData())),this.actor.registerMessageHandler("LT",((ee,ae)=>this._getWorkerSource(ee,ae.type,ae.source).loadTile(ae))),this.actor.registerMessageHandler("RT",((ee,ae)=>this._getWorkerSource(ee,ae.type,ae.source).reloadTile(ae))),this.actor.registerMessageHandler("AT",((ee,ae)=>this._getWorkerSource(ee,ae.type,ae.source).abortTile(ae))),this.actor.registerMessageHandler("RMT",((ee,ae)=>this._getWorkerSource(ee,ae.type,ae.source).removeTile(ae))),this.actor.registerMessageHandler("RS",((ee,ae)=>h._(this,void 0,void 0,(function*(){if(!this.workerSources[ee]||!this.workerSources[ee][ae.type]||!this.workerSources[ee][ae.type][ae.source])return;const be=this.workerSources[ee][ae.type][ae.source];delete this.workerSources[ee][ae.type][ae.source],be.removeSource!==void 0&&be.removeSource(ae)})))),this.actor.registerMessageHandler("RM",(ee=>h._(this,void 0,void 0,(function*(){delete this.layerIndexes[ee],delete this.availableImages[ee],delete this.workerSources[ee],delete this.demWorkerSources[ee]})))),this.actor.registerMessageHandler("SR",((ee,ae)=>h._(this,void 0,void 0,(function*(){this.referrer=ae})))),this.actor.registerMessageHandler("SRPS",((ee,ae)=>this._syncRTLPluginState(ee,ae))),this.actor.registerMessageHandler("IS",((ee,ae)=>h._(this,void 0,void 0,(function*(){this.self.importScripts(ae)})))),this.actor.registerMessageHandler("SI",((ee,ae)=>this._setImages(ee,ae))),this.actor.registerMessageHandler("UL",((ee,ae)=>h._(this,void 0,void 0,(function*(){this._getLayerIndex(ee).update(ae.layers,ae.removedIds)})))),this.actor.registerMessageHandler("SL",((ee,ae)=>h._(this,void 0,void 0,(function*(){this._getLayerIndex(ee).replace(ae)}))))}_setImages(Q,ee){return h._(this,void 0,void 0,(function*(){this.availableImages[Q]=ee;for(const ae in this.workerSources[Q]){const be=this.workerSources[Q][ae];for(const Se in be)be[Se].availableImages=ee}}))}_syncRTLPluginState(Q,ee){return h._(this,void 0,void 0,(function*(){return yield h.cX.syncState(ee,this.self.importScripts)}))}_getAvailableImages(Q){let ee=this.availableImages[Q];return ee||(ee=[]),ee}_getLayerIndex(Q){let ee=this.layerIndexes[Q];return ee||(ee=this.layerIndexes[Q]=new a),ee}_getWorkerSource(Q,ee,ae){if(this.workerSources[Q]||(this.workerSources[Q]={}),this.workerSources[Q][ee]||(this.workerSources[Q][ee]={}),!this.workerSources[Q][ee][ae]){const be={sendAsync:(Se,Oe)=>(Se.targetMapId=Q,this.actor.sendAsync(Se,Oe))};switch(ee){case"vector":this.workerSources[Q][ee][ae]=new k(be,this._getLayerIndex(Q),this._getAvailableImages(Q));break;case"geojson":this.workerSources[Q][ee][ae]=new Ds(be,this._getLayerIndex(Q),this._getAvailableImages(Q));break;default:this.workerSources[Q][ee][ae]=new this.externalWorkerSourceTypes[ee](be,this._getLayerIndex(Q),this._getAvailableImages(Q))}}return this.workerSources[Q][ee][ae]}_getDEMWorkerSource(Q,ee){return this.demWorkerSources[Q]||(this.demWorkerSources[Q]={}),this.demWorkerSources[Q][ee]||(this.demWorkerSources[Q][ee]=new L),this.demWorkerSources[Q][ee]}}return h.i(self)&&(self.worker=new Qs(self)),Qs})),s("index",["exports","./shared"],(function(h,a){var v="5.6.2";function T(){var b=new a.A(4);return a.A!=Float32Array&&(b[1]=0,b[2]=0),b[0]=1,b[3]=1,b}let C,k;const L={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(b,n,d){const m=requestAnimationFrame((x=>{y(),n(x)})),{unsubscribe:y}=a.s(b.signal,"abort",(()=>{y(),cancelAnimationFrame(m),d(a.c())}),!1)},frameAsync(b){return new Promise(((n,d)=>{this.frame(b,n,d)}))},getImageData(b,n=0){return this.getImageCanvasContext(b).getImageData(-n,-n,b.width+2*n,b.height+2*n)},getImageCanvasContext(b){const n=window.document.createElement("canvas"),d=n.getContext("2d",{willReadFrequently:!0});if(!d)throw new Error("failed to create canvas 2d context");return n.width=b.width,n.height=b.height,d.drawImage(b,0,0,b.width,b.height),d},resolveURL:b=>(C||(C=document.createElement("a")),C.href=b,C.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(k==null&&(k=matchMedia("(prefers-reduced-motion: reduce)")),k.matches)}};class O{static testProp(n){if(!O.docStyle)return n[0];for(let d=0;d<n.length;d++)if(n[d]in O.docStyle)return n[d];return n[0]}static create(n,d,m){const y=window.document.createElement(n);return d!==void 0&&(y.className=d),m&&m.appendChild(y),y}static createNS(n,d){return window.document.createElementNS(n,d)}static disableDrag(){O.docStyle&&O.selectProp&&(O.userSelect=O.docStyle[O.selectProp],O.docStyle[O.selectProp]="none")}static enableDrag(){O.docStyle&&O.selectProp&&(O.docStyle[O.selectProp]=O.userSelect)}static setTransform(n,d){n.style[O.transformProp]=d}static addEventListener(n,d,m,y={}){n.addEventListener(d,m,"passive"in y?y:y.capture)}static removeEventListener(n,d,m,y={}){n.removeEventListener(d,m,"passive"in y?y:y.capture)}static suppressClickInternal(n){n.preventDefault(),n.stopPropagation(),window.removeEventListener("click",O.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",O.suppressClickInternal,!0),window.setTimeout((()=>{window.removeEventListener("click",O.suppressClickInternal,!0)}),0)}static getScale(n){const d=n.getBoundingClientRect();return{x:d.width/n.offsetWidth||1,y:d.height/n.offsetHeight||1,boundingClientRect:d}}static getPoint(n,d,m){const y=d.boundingClientRect;return new a.P((m.clientX-y.left)/d.x-n.clientLeft,(m.clientY-y.top)/d.y-n.clientTop)}static mousePos(n,d){const m=O.getScale(n);return O.getPoint(n,m,d)}static touchPos(n,d){const m=[],y=O.getScale(n);for(let x=0;x<d.length;x++)m.push(O.getPoint(n,y,d[x]));return m}static mouseButton(n){return n.button}static remove(n){n.parentNode&&n.parentNode.removeChild(n)}static sanitize(n){const d=new DOMParser().parseFromString(n,"text/html").body||document.createElement("body"),m=d.querySelectorAll("script");for(const y of m)y.remove();return O.clean(d),d.innerHTML}static isPossiblyDangerous(n,d){const m=d.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(n)||!m.includes("javascript:")&&!m.includes("data:"))||!!n.startsWith("on")||void 0}static clean(n){const d=n.children;for(const m of d)O.removeAttributes(m),O.clean(m)}static removeAttributes(n){for(const{name:d,value:m}of n.attributes)O.isPossiblyDangerous(d,m)&&n.removeAttribute(d)}}O.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,O.selectProp=O.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),O.transformProp=O.testProp(["transform","WebkitTransform"]);const K={supported:!1,testSupport:function(b){!oe&&ne&&(fe?ue(b):$=b)}};let $,ne,oe=!1,fe=!1;function ue(b){const n=b.createTexture();b.bindTexture(b.TEXTURE_2D,n);try{if(b.texImage2D(b.TEXTURE_2D,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,ne),b.isContextLost())return;K.supported=!0}catch{}b.deleteTexture(n),oe=!0}var we;typeof document<"u"&&(ne=document.createElement("img"),ne.onload=()=>{$&&ue($),$=null,fe=!0},ne.onerror=()=>{oe=!0,$=null},ne.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),(function(b){let n,d,m,y;b.resetRequestQueue=()=>{n=[],d=0,m=0,y={}},b.addThrottleControl=B=>{const F=m++;return y[F]=B,F},b.removeThrottleControl=B=>{delete y[B],S()},b.getImage=(B,F,U=!0)=>new Promise(((W,G)=>{K.supported&&(B.headers||(B.headers={}),B.headers.accept="image/webp,*/*"),a.e(B,{type:"image"}),n.push({abortController:F,requestParameters:B,supportImageRefresh:U,state:"queued",onError:q=>{G(q)},onSuccess:q=>{W(q)}}),S()}));const x=B=>a._(this,void 0,void 0,(function*(){B.state="running";const{requestParameters:F,supportImageRefresh:U,onError:W,onSuccess:G,abortController:q}=B,J=U===!1&&!a.i(self)&&!a.g(F.url)&&(!F.headers||Object.keys(F.headers).reduce(((pe,ge)=>pe&&ge==="accept"),!0));d++;const le=J?I(F,q):a.m(F,q);try{const pe=yield le;delete B.abortController,B.state="completed",pe.data instanceof HTMLImageElement||a.b(pe.data)?G(pe):pe.data&&G({data:yield(de=pe.data,typeof createImageBitmap=="function"?a.f(de):a.h(de)),cacheControl:pe.cacheControl,expires:pe.expires})}catch(pe){delete B.abortController,W(pe)}finally{d--,S()}var de})),S=()=>{const B=(()=>{for(const F of Object.keys(y))if(y[F]())return!0;return!1})()?a.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:a.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let F=d;F<B&&n.length>0;F++){const U=n.shift();U.abortController.signal.aborted?F--:x(U)}},I=(B,F)=>new Promise(((U,W)=>{const G=new Image,q=B.url,J=B.credentials;J&&J==="include"?G.crossOrigin="use-credentials":(J&&J==="same-origin"||!a.d(q))&&(G.crossOrigin="anonymous"),F.signal.addEventListener("abort",(()=>{G.src="",W(a.c())})),G.fetchPriority="high",G.onload=()=>{G.onerror=G.onload=null,U({data:G})},G.onerror=()=>{G.onerror=G.onload=null,F.signal.aborted||W(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},G.src=q}))})(we||(we={})),we.resetRequestQueue();class De{constructor(n){this._transformRequestFn=n??null}transformRequest(n,d){return this._transformRequestFn&&this._transformRequestFn(n,d)||{url:n}}setTransformRequest(n){this._transformRequestFn=n}}function Fe(b){const n=[];if(typeof b=="string")n.push({id:"default",url:b});else if(b&&b.length>0){const d=[];for(const{id:m,url:y}of b){const x=`${m}${y}`;d.indexOf(x)===-1&&(d.push(x),n.push({id:m,url:y}))}}return n}function Ke(b,n,d){try{const m=new URL(b);return m.pathname+=`${n}${d}`,m.toString()}catch{throw new Error(`Invalid sprite URL "${b}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}function ze(b){const{userImage:n}=b;return!!(n&&n.render&&n.render())&&(b.data.replace(new Uint8Array(n.data.buffer)),!0)}class it extends a.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new a.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(n){if(this.loaded!==n&&(this.loaded=n,n)){for(const{ids:d,promiseResolve:m}of this.requestors)m(this._getImagesForIds(d));this.requestors=[]}}getImage(n){const d=this.images[n];if(d&&!d.data&&d.spriteData){const m=d.spriteData;d.data=new a.R({width:m.width,height:m.height},m.context.getImageData(m.x,m.y,m.width,m.height).data),d.spriteData=null}return d}addImage(n,d){if(this.images[n])throw new Error(`Image id ${n} already exist, use updateImage instead`);this._validate(n,d)&&(this.images[n]=d)}_validate(n,d){let m=!0;const y=d.data||d.spriteData;return this._validateStretch(d.stretchX,y&&y.width)||(this.fire(new a.k(new Error(`Image "${n}" has invalid "stretchX" value`))),m=!1),this._validateStretch(d.stretchY,y&&y.height)||(this.fire(new a.k(new Error(`Image "${n}" has invalid "stretchY" value`))),m=!1),this._validateContent(d.content,d)||(this.fire(new a.k(new Error(`Image "${n}" has invalid "content" value`))),m=!1),m}_validateStretch(n,d){if(!n)return!0;let m=0;for(const y of n){if(y[0]<m||y[1]<y[0]||d<y[1])return!1;m=y[1]}return!0}_validateContent(n,d){if(!n)return!0;if(n.length!==4)return!1;const m=d.spriteData,y=m&&m.width||d.data.width,x=m&&m.height||d.data.height;return!(n[0]<0||y<n[0]||n[1]<0||x<n[1]||n[2]<0||y<n[2]||n[3]<0||x<n[3]||n[2]<n[0]||n[3]<n[1])}updateImage(n,d,m=!0){const y=this.getImage(n);if(m&&(y.data.width!==d.data.width||y.data.height!==d.data.height))throw new Error(`size mismatch between old image (${y.data.width}x${y.data.height}) and new image (${d.data.width}x${d.data.height}).`);d.version=y.version+1,this.images[n]=d,this.updatedImages[n]=!0}removeImage(n){const d=this.images[n];delete this.images[n],delete this.patterns[n],d.userImage&&d.userImage.onRemove&&d.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(n){return new Promise(((d,m)=>{let y=!0;if(!this.isLoaded())for(const x of n)this.images[x]||(y=!1);this.isLoaded()||y?d(this._getImagesForIds(n)):this.requestors.push({ids:n,promiseResolve:d})}))}_getImagesForIds(n){const d={};for(const m of n){let y=this.getImage(m);y||(this.fire(new a.l("styleimagemissing",{id:m})),y=this.getImage(m)),y?d[m]={data:y.data.clone(),pixelRatio:y.pixelRatio,sdf:y.sdf,version:y.version,stretchX:y.stretchX,stretchY:y.stretchY,content:y.content,textFitWidth:y.textFitWidth,textFitHeight:y.textFitHeight,hasRenderCallback:!!(y.userImage&&y.userImage.render)}:a.w(`Image "${m}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return d}getPixelSize(){const{width:n,height:d}=this.atlasImage;return{width:n,height:d}}getPattern(n){const d=this.patterns[n],m=this.getImage(n);if(!m)return null;if(d&&d.position.version===m.version)return d.position;if(d)d.position.version=m.version;else{const y={w:m.data.width+2,h:m.data.height+2,x:0,y:0},x=new a.I(y,m);this.patterns[n]={bin:y,position:x}}return this._updatePatternAtlas(),this.patterns[n].position}bind(n){const d=n.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new a.T(n,this.atlasImage,d.RGBA),this.atlasTexture.bind(d.LINEAR,d.CLAMP_TO_EDGE)}_updatePatternAtlas(){const n=[];for(const x in this.patterns)n.push(this.patterns[x].bin);const{w:d,h:m}=a.p(n),y=this.atlasImage;y.resize({width:d||1,height:m||1});for(const x in this.patterns){const{bin:S}=this.patterns[x],I=S.x+1,B=S.y+1,F=this.getImage(x).data,U=F.width,W=F.height;a.R.copy(F,y,{x:0,y:0},{x:I,y:B},{width:U,height:W}),a.R.copy(F,y,{x:0,y:W-1},{x:I,y:B-1},{width:U,height:1}),a.R.copy(F,y,{x:0,y:0},{x:I,y:B+W},{width:U,height:1}),a.R.copy(F,y,{x:U-1,y:0},{x:I-1,y:B},{width:1,height:W}),a.R.copy(F,y,{x:0,y:0},{x:I+U,y:B},{width:1,height:W})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(n){for(const d of n){if(this.callbackDispatchedThisFrame[d])continue;this.callbackDispatchedThisFrame[d]=!0;const m=this.getImage(d);m||a.w(`Image with ID: "${d}" was not found`),ze(m)&&this.updateImage(d,m)}}}const lt=1e20;function ht(b,n,d,m,y,x,S,I,B){for(let F=n;F<n+m;F++)vt(b,d*x+F,x,y,S,I,B);for(let F=d;F<d+y;F++)vt(b,F*x+n,1,m,S,I,B)}function vt(b,n,d,m,y,x,S){x[0]=0,S[0]=-lt,S[1]=lt,y[0]=b[n];for(let I=1,B=0,F=0;I<m;I++){y[I]=b[n+I*d];const U=I*I;do{const W=x[B];F=(y[I]-y[W]+U-W*W)/(I-W)/2}while(F<=S[B]&&--B>-1);B++,x[B]=I,S[B]=F,S[B+1]=lt}for(let I=0,B=0;I<m;I++){for(;S[B+1]<I;)B++;const F=x[B],U=I-F;b[n+I*d]=y[F]+U*U}}class Nt{constructor(n,d){this.requestManager=n,this.localIdeographFontFamily=d,this.entries={}}setURL(n){this.url=n}getGlyphs(n){return a._(this,void 0,void 0,(function*(){const d=[];for(const x in n)for(const S of n[x])d.push(this._getAndCacheGlyphsPromise(x,S));const m=yield Promise.all(d),y={};for(const{stack:x,id:S,glyph:I}of m)y[x]||(y[x]={}),y[x][S]=I&&{id:I.id,bitmap:I.bitmap.clone(),metrics:I.metrics};return y}))}_getAndCacheGlyphsPromise(n,d){return a._(this,void 0,void 0,(function*(){let m=this.entries[n];m||(m=this.entries[n]={glyphs:{},requests:{},ranges:{}});let y=m.glyphs[d];if(y!==void 0)return{stack:n,id:d,glyph:y};if(y=this._tinySDF(m,n,d),y)return m.glyphs[d]=y,{stack:n,id:d,glyph:y};const x=Math.floor(d/256);if(256*x>65535)throw new Error("glyphs > 65535 not supported");if(m.ranges[x])return{stack:n,id:d,glyph:y};if(!this.url)throw new Error("glyphsUrl is not set");if(!m.requests[x]){const I=Nt.loadGlyphRange(n,x,this.url,this.requestManager);m.requests[x]=I}const S=yield m.requests[x];for(const I in S)this._doesCharSupportLocalGlyph(+I)||(m.glyphs[+I]=S[+I]);return m.ranges[x]=!0,{stack:n,id:d,glyph:S[d]||null}}))}_doesCharSupportLocalGlyph(n){return!!this.localIdeographFontFamily&&(new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(n))||a.u["CJK Unified Ideographs"](n)||a.u["Hangul Syllables"](n)||a.u.Hiragana(n)||a.u.Katakana(n)||a.u["CJK Symbols and Punctuation"](n)||a.u["Halfwidth and Fullwidth Forms"](n))}_tinySDF(n,d,m){const y=this.localIdeographFontFamily;if(!y||!this._doesCharSupportLocalGlyph(m))return;let x=n.tinySDF;if(!x){let I="400";/bold/i.test(d)?I="900":/medium/i.test(d)?I="500":/light/i.test(d)&&(I="200"),x=n.tinySDF=new Nt.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:y,fontWeight:I})}const S=x.draw(String.fromCharCode(m));return{id:m,bitmap:new a.q({width:S.width||60,height:S.height||60},S.data),metrics:{width:S.glyphWidth/2||24,height:S.glyphHeight/2||24,left:S.glyphLeft/2+.5||0,top:S.glyphTop/2-27.5||-8,advance:S.glyphAdvance/2||24,isDoubleResolution:!0}}}}Nt.loadGlyphRange=function(b,n,d,m){return a._(this,void 0,void 0,(function*(){const y=256*n,x=y+255,S=m.transformRequest(d.replace("{fontstack}",b).replace("{range}",`${y}-${x}`),"Glyphs"),I=yield a.n(S,new AbortController);if(!I||!I.data)throw new Error(`Could not load glyph range. range: ${n}, ${y}-${x}`);const B={};for(const F of a.o(I.data))B[F.id]=F;return B}))},Nt.TinySDF=class{constructor({fontSize:b=24,buffer:n=3,radius:d=8,cutoff:m=.25,fontFamily:y="sans-serif",fontWeight:x="normal",fontStyle:S="normal",lang:I=null}={}){this.buffer=n,this.cutoff=m,this.radius=d,this.lang=I;const B=this.size=b+4*n,F=this._createCanvas(B),U=this.ctx=F.getContext("2d",{willReadFrequently:!0});U.font=`${S} ${x} ${b}px ${y}`,U.textBaseline="alphabetic",U.textAlign="left",U.fillStyle="black",this.gridOuter=new Float64Array(B*B),this.gridInner=new Float64Array(B*B),this.f=new Float64Array(B),this.z=new Float64Array(B+1),this.v=new Uint16Array(B)}_createCanvas(b){const n=document.createElement("canvas");return n.width=n.height=b,n}draw(b){const{width:n,actualBoundingBoxAscent:d,actualBoundingBoxDescent:m,actualBoundingBoxLeft:y,actualBoundingBoxRight:x}=this.ctx.measureText(b),S=Math.ceil(d),I=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(x-y))),B=Math.min(this.size-this.buffer,S+Math.ceil(m)),F=I+2*this.buffer,U=B+2*this.buffer,W=Math.max(F*U,0),G=new Uint8ClampedArray(W),q={data:G,width:F,height:U,glyphWidth:I,glyphHeight:B,glyphTop:S,glyphLeft:0,glyphAdvance:n};if(I===0||B===0)return q;const{ctx:J,buffer:le,gridInner:de,gridOuter:pe}=this;this.lang&&(J.lang=this.lang),J.clearRect(le,le,I,B),J.fillText(b,le,le+S);const ge=J.getImageData(le,le,I,B);pe.fill(lt,0,W),de.fill(0,0,W);for(let xe=0;xe<B;xe++)for(let _e=0;_e<I;_e++){const Te=ge.data[4*(xe*I+_e)+3]/255;if(Te===0)continue;const Pe=(xe+le)*F+_e+le;if(Te===1)pe[Pe]=0,de[Pe]=lt;else{const ve=.5-Te;pe[Pe]=ve>0?ve*ve:0,de[Pe]=ve<0?ve*ve:0}}ht(pe,0,0,F,U,F,this.f,this.v,this.z),ht(de,le,le,I,B,F,this.f,this.v,this.z);for(let xe=0;xe<W;xe++){const _e=Math.sqrt(pe[xe])-Math.sqrt(de[xe]);G[xe]=Math.round(255-255*(_e/this.radius+this.cutoff))}return q}};class Lt{constructor(){this.specification=a.v.light.position}possiblyEvaluate(n,d){return a.B(n.expression.evaluate(d))}interpolate(n,d,m){return{x:a.C.number(n.x,d.x,m),y:a.C.number(n.y,d.y,m),z:a.C.number(n.z,d.z,m)}}}let qt;class Qt extends a.E{constructor(n){super(),qt=qt||new a.r({anchor:new a.D(a.v.light.anchor),position:new Lt,color:new a.D(a.v.light.color),intensity:new a.D(a.v.light.intensity)}),this._transitionable=new a.t(qt),this.setLight(n),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(n,d={}){if(!this._validate(a.x,n,d))for(const m in n){const y=n[m];m.endsWith("-transition")?this._transitionable.setTransition(m.slice(0,-11),y):this._transitionable.setValue(m,y)}}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,d,m){return(!m||m.validate!==!1)&&a.y(this,n.call(a.z,{value:d,style:{glyphs:!0,sprite:!0},styleSpec:a.v}))}}const Ot=new a.r({"sky-color":new a.D(a.v.sky["sky-color"]),"horizon-color":new a.D(a.v.sky["horizon-color"]),"fog-color":new a.D(a.v.sky["fog-color"]),"fog-ground-blend":new a.D(a.v.sky["fog-ground-blend"]),"horizon-fog-blend":new a.D(a.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new a.D(a.v.sky["sky-horizon-blend"]),"atmosphere-blend":new a.D(a.v.sky["atmosphere-blend"])});class tt extends a.E{constructor(n){super(),this._transitionable=new a.t(Ot),this.setSky(n),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new a.F(0))}setSky(n,d={}){if(!this._validate(a.G,n,d)){n||(n={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const m in n){const y=n[m];m.endsWith("-transition")?this._transitionable.setTransition(m.slice(0,-11),y):this._transitionable.setValue(m,y)}}}getSky(){return this._transitionable.serialize()}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,d,m={}){return m?.validate!==!1&&a.y(this,n.call(a.z,a.e({value:d,style:{glyphs:!0,sprite:!0},styleSpec:a.v})))}calculateFogBlendOpacity(n){return n<60?0:n<70?(n-60)/10:1}}class wt{constructor(n,d){this.width=n,this.height=d,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(n,d){const m=n.join(",")+String(d);return this.dashEntry[m]||(this.dashEntry[m]=this.addDash(n,d)),this.dashEntry[m]}getDashRanges(n,d,m){const y=[];let x=n.length%2==1?-n[n.length-1]*m:0,S=n[0]*m,I=!0;y.push({left:x,right:S,isDash:I,zeroLength:n[0]===0});let B=n[0];for(let F=1;F<n.length;F++){I=!I;const U=n[F];x=B*m,B+=U,S=B*m,y.push({left:x,right:S,isDash:I,zeroLength:U===0})}return y}addRoundDash(n,d,m){const y=d/2;for(let x=-m;x<=m;x++){const S=this.width*(this.nextRow+m+x);let I=0,B=n[I];for(let F=0;F<this.width;F++){F/B.right>1&&(B=n[++I]);const U=Math.abs(F-B.left),W=Math.abs(F-B.right),G=Math.min(U,W);let q;const J=x/m*(y+1);if(B.isDash){const le=y-Math.abs(J);q=Math.sqrt(G*G+le*le)}else q=y-Math.sqrt(G*G+J*J);this.data[S+F]=Math.max(0,Math.min(255,q+128))}}}addRegularDash(n){for(let I=n.length-1;I>=0;--I){const B=n[I],F=n[I+1];B.zeroLength?n.splice(I,1):F&&F.isDash===B.isDash&&(F.left=B.left,n.splice(I,1))}const d=n[0],m=n[n.length-1];d.isDash===m.isDash&&(d.left=m.left-this.width,m.right=d.right+this.width);const y=this.width*this.nextRow;let x=0,S=n[x];for(let I=0;I<this.width;I++){I/S.right>1&&(S=n[++x]);const B=Math.abs(I-S.left),F=Math.abs(I-S.right),U=Math.min(B,F);this.data[y+I]=Math.max(0,Math.min(255,(S.isDash?U:-U)+128))}}addDash(n,d){const m=d?7:0,y=2*m+1;if(this.nextRow+y>this.height)return a.w("LineAtlas out of space"),null;let x=0;for(let I=0;I<n.length;I++)x+=n[I];if(x!==0){const I=this.width/x,B=this.getDashRanges(n,this.width,I);d?this.addRoundDash(B,I,m):this.addRegularDash(B)}const S={y:(this.nextRow+m+.5)/this.height,height:2*m/this.height,width:x};return this.nextRow+=y,this.dirty=!0,S}bind(n){const d=n.gl;this.texture?(d.bindTexture(d.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,d.texSubImage2D(d.TEXTURE_2D,0,0,0,this.width,this.height,d.ALPHA,d.UNSIGNED_BYTE,this.data))):(this.texture=d.createTexture(),d.bindTexture(d.TEXTURE_2D,this.texture),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.REPEAT),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.REPEAT),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.LINEAR),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.LINEAR),d.texImage2D(d.TEXTURE_2D,0,d.ALPHA,this.width,this.height,0,d.ALPHA,d.UNSIGNED_BYTE,this.data))}}const Bt="maplibre_preloaded_worker_pool";class Ue{constructor(){this.active={}}acquire(n){if(!this.workers)for(this.workers=[];this.workers.length<Ue.workerCount;)this.workers.push(new Worker(a.a.WORKER_URL));return this.active[n]=!0,this.workers.slice()}release(n){delete this.active[n],this.numActive()===0&&(this.workers.forEach((d=>{d.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[Bt]}numActive(){return Object.keys(this.active).length}}const dt=Math.floor(L.hardwareConcurrency/2);let Gt,Jt;function Tr(){return Gt||(Gt=new Ue),Gt}Ue.workerCount=a.H(globalThis)?Math.max(Math.min(dt,3),1):1;class gr{constructor(n,d){this.workerPool=n,this.actors=[],this.currentActor=0,this.id=d;const m=this.workerPool.acquire(d);for(let y=0;y<m.length;y++){const x=new a.J(m[y],d);x.name=`Worker ${y}`,this.actors.push(x)}if(!this.actors.length)throw new Error("No actors found")}broadcast(n,d){const m=[];for(const y of this.actors)m.push(y.sendAsync({type:n,data:d}));return Promise.all(m)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(n=!0){this.actors.forEach((d=>{d.remove()})),this.actors=[],n&&this.workerPool.release(this.id)}registerMessageHandler(n,d){for(const m of this.actors)m.registerMessageHandler(n,d)}}function Ht(){return Jt||(Jt=new gr(Tr(),a.K),Jt.registerMessageHandler("GR",((b,n,d)=>a.m(n,d)))),Jt}function dr(b,n){const d=a.L();return a.M(d,d,[1,1,0]),a.N(d,d,[.5*b.width,.5*b.height,1]),b.calculatePosMatrix?a.O(d,d,b.calculatePosMatrix(n.toUnwrapped())):d}function er(b,n,d,m,y,x,S){var I;const B=(function(G,q,J){if(G)for(const le of G){const de=q[le];if(de&&de.source===J&&de.type==="fill-extrusion")return!0}else for(const le in q){const de=q[le];if(de.source===J&&de.type==="fill-extrusion")return!0}return!1})((I=y?.layers)!==null&&I!==void 0?I:null,n,b.id),F=x.maxPitchScaleFactor(),U=b.tilesIn(m,F,B);U.sort(Lr);const W=[];for(const G of U)W.push({wrappedTileID:G.tileID.wrapped().key,queryResults:G.tile.queryRenderedFeatures(n,d,b._state,G.queryGeometry,G.cameraQueryGeometry,G.scale,y,x,F,dr(b.transform,G.tileID),S?(q,J)=>S(G.tileID,q,J):void 0)});return(function(G,q){for(const J in G)for(const le of G[J])yn(le,q);return G})((function(G){const q={},J={};for(const le of G){const de=le.queryResults,pe=le.wrappedTileID,ge=J[pe]=J[pe]||{};for(const xe in de){const _e=de[xe],Te=ge[xe]=ge[xe]||{},Pe=q[xe]=q[xe]||[];for(const ve of _e)Te[ve.featureIndex]||(Te[ve.featureIndex]=!0,Pe.push(ve))}}return q})(W),b)}function Lr(b,n){const d=b.tileID,m=n.tileID;return d.overscaledZ-m.overscaledZ||d.canonical.y-m.canonical.y||d.wrap-m.wrap||d.canonical.x-m.canonical.x}function yn(b,n){const d=b.feature,m=n.getFeatureState(d.layer["source-layer"],d.id);d.source=d.layer.source,d.layer["source-layer"]&&(d.sourceLayer=d.layer["source-layer"]),d.state=m}function yi(b,n,d){return a._(this,void 0,void 0,(function*(){let m=b;if(b.url?m=(yield a.j(n.transformRequest(b.url,"Source"),d)).data:yield L.frameAsync(d),!m)return null;const y=a.Q(a.e(m,b),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in m&&m.vector_layers&&(y.vectorLayerIds=m.vector_layers.map((x=>x.id))),y}))}class qr{constructor(n,d){n&&(d?this.setSouthWest(n).setNorthEast(d):Array.isArray(n)&&(n.length===4?this.setSouthWest([n[0],n[1]]).setNorthEast([n[2],n[3]]):this.setSouthWest(n[0]).setNorthEast(n[1])))}setNorthEast(n){return this._ne=n instanceof a.S?new a.S(n.lng,n.lat):a.S.convert(n),this}setSouthWest(n){return this._sw=n instanceof a.S?new a.S(n.lng,n.lat):a.S.convert(n),this}extend(n){const d=this._sw,m=this._ne;let y,x;if(n instanceof a.S)y=n,x=n;else{if(!(n instanceof qr))return Array.isArray(n)?n.length===4||n.every(Array.isArray)?this.extend(qr.convert(n)):this.extend(a.S.convert(n)):n&&("lng"in n||"lon"in n)&&"lat"in n?this.extend(a.S.convert(n)):this;if(y=n._sw,x=n._ne,!y||!x)return this}return d||m?(d.lng=Math.min(y.lng,d.lng),d.lat=Math.min(y.lat,d.lat),m.lng=Math.max(x.lng,m.lng),m.lat=Math.max(x.lat,m.lat)):(this._sw=new a.S(y.lng,y.lat),this._ne=new a.S(x.lng,x.lat)),this}getCenter(){return new a.S((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new a.S(this.getWest(),this.getNorth())}getSouthEast(){return new a.S(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(n){const{lng:d,lat:m}=a.S.convert(n);let y=this._sw.lng<=d&&d<=this._ne.lng;return this._sw.lng>this._ne.lng&&(y=this._sw.lng>=d&&d>=this._ne.lng),this._sw.lat<=m&&m<=this._ne.lat&&y}static convert(n){return n instanceof qr?n:n&&new qr(n)}static fromLngLat(n,d=0){const m=360*d/40075017,y=m/Math.cos(Math.PI/180*n.lat);return new qr(new a.S(n.lng-y,n.lat-m),new a.S(n.lng+y,n.lat+m))}adjustAntiMeridian(){const n=new a.S(this._sw.lng,this._sw.lat),d=new a.S(this._ne.lng,this._ne.lat);return new qr(n,n.lng>d.lng?new a.S(d.lng+360,d.lat):d)}}class ri{constructor(n,d,m){this.bounds=qr.convert(this.validateBounds(n)),this.minzoom=d||0,this.maxzoom=m||24}validateBounds(n){return Array.isArray(n)&&n.length===4?[Math.max(-180,n[0]),Math.max(-90,n[1]),Math.min(180,n[2]),Math.min(90,n[3])]:[-180,-90,180,90]}contains(n){const d=Math.pow(2,n.z),m=Math.floor(a.V(this.bounds.getWest())*d),y=Math.floor(a.U(this.bounds.getNorth())*d),x=Math.ceil(a.V(this.bounds.getEast())*d),S=Math.ceil(a.U(this.bounds.getSouth())*d);return n.x>=m&&n.x<x&&n.y>=y&&n.y<S}}class vn extends a.E{constructor(n,d,m,y){if(super(),this.id=n,this.dispatcher=m,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,a.e(this,a.Q(d,["url","scheme","tileSize","promoteId"])),this._options=a.e({type:"vector"},d),this._collectResourceTiming=d.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(y)}load(){return a._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new a.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const n=yield yi(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),n&&(a.e(this,n),n.bounds&&(this.tileBounds=new ri(n.bounds,this.minzoom,this.maxzoom)),this.fire(new a.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.l("data",{dataType:"source",sourceDataType:"content"})))}catch(n){this._tileJSONRequest=null,this.fire(new a.k(n))}}))}loaded(){return this._loaded}hasTile(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)}onAdd(n){this.map=n,this.load()}setSourceProperty(n){this._tileJSONRequest&&this._tileJSONRequest.abort(),n(),this.load()}setTiles(n){return this.setSourceProperty((()=>{this._options.tiles=n})),this}setUrl(n){return this.setSourceProperty((()=>{this.url=n,this._options.url=n})),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return a.e({},this._options)}loadTile(n){return a._(this,void 0,void 0,(function*(){const d=n.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),m={request:this.map._requestManager.transformRequest(d,"Tile"),uid:n.uid,tileID:n.tileID,zoom:n.tileID.overscaledZ,tileSize:this.tileSize*n.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity,globalState:this.map.getGlobalState()};m.request.collectResourceTiming=this._collectResourceTiming;let y="RT";if(n.actor&&n.state!=="expired"){if(n.state==="loading")return new Promise(((x,S)=>{n.reloadPromise={resolve:x,reject:S}}))}else n.actor=this.dispatcher.getActor(),y="LT";n.abortController=new AbortController;try{const x=yield n.actor.sendAsync({type:y,data:m},n.abortController);if(delete n.abortController,n.aborted)return;this._afterTileLoadWorkerResponse(n,x)}catch(x){if(delete n.abortController,n.aborted)return;if(x&&x.status!==404)throw x;this._afterTileLoadWorkerResponse(n,null)}}))}_afterTileLoadWorkerResponse(n,d){if(d&&d.resourceTiming&&(n.resourceTiming=d.resourceTiming),d&&this.map._refreshExpiredTiles&&n.setExpiryData(d),n.loadVectorData(d,this.map.painter),n.reloadPromise){const m=n.reloadPromise;n.reloadPromise=null,this.loadTile(n).then(m.resolve).catch(m.reject)}}abortTile(n){return a._(this,void 0,void 0,(function*(){n.abortController&&(n.abortController.abort(),delete n.abortController),n.actor&&(yield n.actor.sendAsync({type:"AT",data:{uid:n.uid,type:this.type,source:this.id}}))}))}unloadTile(n){return a._(this,void 0,void 0,(function*(){n.unloadVectorData(),n.actor&&(yield n.actor.sendAsync({type:"RMT",data:{uid:n.uid,type:this.type,source:this.id}}))}))}hasTransition(){return!1}}class Li extends a.E{constructor(n,d,m,y){super(),this.id=n,this.dispatcher=m,this.setEventedParent(y),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=a.e({type:"raster"},d),a.e(this,a.Q(d,["url","scheme","tileSize"]))}load(){return a._(this,arguments,void 0,(function*(n=!1){this._loaded=!1,this.fire(new a.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const d=yield yi(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,d&&(a.e(this,d),d.bounds&&(this.tileBounds=new ri(d.bounds,this.minzoom,this.maxzoom)),this.fire(new a.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.l("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:n})))}catch(d){this._tileJSONRequest=null,this.fire(new a.k(d))}}))}loaded(){return this._loaded}onAdd(n){this.map=n,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(n){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),n(),this.load(!0)}setTiles(n){return this.setSourceProperty((()=>{this._options.tiles=n})),this}setUrl(n){return this.setSourceProperty((()=>{this.url=n,this._options.url=n})),this}serialize(){return a.e({},this._options)}hasTile(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)}loadTile(n){return a._(this,void 0,void 0,(function*(){const d=n.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);n.abortController=new AbortController;try{const m=yield we.getImage(this.map._requestManager.transformRequest(d,"Tile"),n.abortController,this.map._refreshExpiredTiles);if(delete n.abortController,n.aborted)return void(n.state="unloaded");if(m&&m.data){this.map._refreshExpiredTiles&&(m.cacheControl||m.expires)&&n.setExpiryData({cacheControl:m.cacheControl,expires:m.expires});const y=this.map.painter.context,x=y.gl,S=m.data;n.texture=this.map.painter.getTileTexture(S.width),n.texture?n.texture.update(S,{useMipmap:!0}):(n.texture=new a.T(y,S,x.RGBA,{useMipmap:!0}),n.texture.bind(x.LINEAR,x.CLAMP_TO_EDGE,x.LINEAR_MIPMAP_NEAREST)),n.state="loaded"}}catch(m){if(delete n.abortController,n.aborted)n.state="unloaded";else if(m)throw n.state="errored",m}}))}abortTile(n){return a._(this,void 0,void 0,(function*(){n.abortController&&(n.abortController.abort(),delete n.abortController)}))}unloadTile(n){return a._(this,void 0,void 0,(function*(){n.texture&&this.map.painter.saveTileTexture(n.texture)}))}hasTransition(){return!1}}class Mn extends Li{constructor(n,d,m,y){super(n,d,m,y),this.type="raster-dem",this.maxzoom=22,this._options=a.e({type:"raster-dem"},d),this.encoding=d.encoding||"mapbox",this.redFactor=d.redFactor,this.greenFactor=d.greenFactor,this.blueFactor=d.blueFactor,this.baseShift=d.baseShift}loadTile(n){return a._(this,void 0,void 0,(function*(){const d=n.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),m=this.map._requestManager.transformRequest(d,"Tile");n.neighboringTiles=this._getNeighboringTiles(n.tileID),n.abortController=new AbortController;try{const y=yield we.getImage(m,n.abortController,this.map._refreshExpiredTiles);if(delete n.abortController,n.aborted)return void(n.state="unloaded");if(y&&y.data){const x=y.data;this.map._refreshExpiredTiles&&(y.cacheControl||y.expires)&&n.setExpiryData({cacheControl:y.cacheControl,expires:y.expires});const S=a.b(x)&&a.W()?x:yield this.readImageNow(x),I={type:this.type,uid:n.uid,source:this.id,rawImageData:S,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!n.actor||n.state==="expired"){n.actor=this.dispatcher.getActor();const B=yield n.actor.sendAsync({type:"LDT",data:I});n.dem=B,n.needsHillshadePrepare=!0,n.needsTerrainPrepare=!0,n.state="loaded"}}}catch(y){if(delete n.abortController,n.aborted)n.state="unloaded";else if(y)throw n.state="errored",y}}))}readImageNow(n){return a._(this,void 0,void 0,(function*(){if(typeof VideoFrame<"u"&&a.X()){const d=n.width+2,m=n.height+2;try{return new a.R({width:d,height:m},yield a.Y(n,-1,-1,d,m))}catch{}}return L.getImageData(n,1)}))}_getNeighboringTiles(n){const d=n.canonical,m=Math.pow(2,d.z),y=(d.x-1+m)%m,x=d.x===0?n.wrap-1:n.wrap,S=(d.x+1+m)%m,I=d.x+1===m?n.wrap+1:n.wrap,B={};return B[new a.Z(n.overscaledZ,x,d.z,y,d.y).key]={backfilled:!1},B[new a.Z(n.overscaledZ,I,d.z,S,d.y).key]={backfilled:!1},d.y>0&&(B[new a.Z(n.overscaledZ,x,d.z,y,d.y-1).key]={backfilled:!1},B[new a.Z(n.overscaledZ,n.wrap,d.z,d.x,d.y-1).key]={backfilled:!1},B[new a.Z(n.overscaledZ,I,d.z,S,d.y-1).key]={backfilled:!1}),d.y+1<m&&(B[new a.Z(n.overscaledZ,x,d.z,y,d.y+1).key]={backfilled:!1},B[new a.Z(n.overscaledZ,n.wrap,d.z,d.x,d.y+1).key]={backfilled:!1},B[new a.Z(n.overscaledZ,I,d.z,S,d.y+1).key]={backfilled:!1}),B}unloadTile(n){return a._(this,void 0,void 0,(function*(){n.demTexture&&this.map.painter.saveTileTexture(n.demTexture),n.fbo&&(n.fbo.destroy(),delete n.fbo),n.dem&&delete n.dem,delete n.neighboringTiles,n.state="unloaded",n.actor&&(yield n.actor.sendAsync({type:"RDT",data:{type:this.type,uid:n.uid,source:this.id}}))}))}}class bs extends a.E{constructor(n,d,m,y){super(),this.id=n,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._isUpdatingWorker=!1,this._pendingWorkerUpdate={data:d.data},this.actor=m.getActor(),this.setEventedParent(y),this._data=d.data,this._options=a.e({},d),this._collectResourceTiming=d.collectResourceTiming,d.maxzoom!==void 0&&(this.maxzoom=d.maxzoom),d.type&&(this.type=d.type),d.attribution&&(this.attribution=d.attribution),this.promoteId=d.promoteId,d.clusterMaxZoom!==void 0&&this.maxzoom<=d.clusterMaxZoom&&a.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${d.clusterMaxZoom}".`),this.workerOptions=a.e({source:this.id,cluster:d.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(d.buffer!==void 0?d.buffer:128),tolerance:this._pixelsToTileUnits(d.tolerance!==void 0?d.tolerance:.375),extent:a.$,maxZoom:this.maxzoom,lineMetrics:d.lineMetrics||!1,generateId:d.generateId||!1},superclusterOptions:{maxZoom:this._getClusterMaxZoom(d.clusterMaxZoom),minPoints:Math.max(2,d.clusterMinPoints||2),extent:a.$,radius:this._pixelsToTileUnits(d.clusterRadius||50),log:!1,generateId:d.generateId||!1},clusterProperties:d.clusterProperties,filter:d.filter},d.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}_pixelsToTileUnits(n){return n*(a.$/this.tileSize)}_getClusterMaxZoom(n){const d=n?Math.round(n):this.maxzoom-1;return Number.isInteger(n)||n===void 0||a.w(`Integer expected for option 'clusterMaxZoom': provided value "${n}" rounded to "${d}"`),d}load(){return a._(this,void 0,void 0,(function*(){yield this._updateWorkerData()}))}onAdd(n){this.map=n,this.load()}setData(n){return this._data=n,this._pendingWorkerUpdate={data:n},this._updateWorkerData(),this}updateData(n){return this._pendingWorkerUpdate.diff=a.a0(this._pendingWorkerUpdate.diff,n),this._updateWorkerData(),this}getData(){return a._(this,void 0,void 0,(function*(){const n=a.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:n})}))}getCoordinatesFromGeometry(n){return n.type==="GeometryCollection"?n.geometries.map((d=>d.coordinates)).flat(1/0):n.coordinates.flat(1/0)}getBounds(){return a._(this,void 0,void 0,(function*(){const n=new qr,d=yield this.getData();let m;switch(d.type){case"FeatureCollection":m=d.features.map((y=>this.getCoordinatesFromGeometry(y.geometry))).flat(1/0);break;case"Feature":m=this.getCoordinatesFromGeometry(d.geometry);break;default:m=this.getCoordinatesFromGeometry(d)}if(m.length==0)return n;for(let y=0;y<m.length-1;y+=2)n.extend([m[y],m[y+1]]);return n}))}setClusterOptions(n){return this.workerOptions.cluster=n.cluster,n&&(n.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(n.clusterRadius)),n.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=this._getClusterMaxZoom(n.clusterMaxZoom))),this._updateWorkerData(),this}getClusterExpansionZoom(n){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:n,source:this.id}})}getClusterChildren(n){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:n,source:this.id}})}getClusterLeaves(n,d,m){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:n,limit:d,offset:m}})}_updateWorkerData(){return a._(this,void 0,void 0,(function*(){if(this._isUpdatingWorker)return;const{data:n,diff:d}=this._pendingWorkerUpdate;if(!n&&!d)return void a.w(`No data or diff provided to GeoJSONSource ${this.id}.`);const m=a.e({type:this.type},this.workerOptions);n?(typeof n=="string"?(m.request=this.map._requestManager.transformRequest(L.resolveURL(n),"Source"),m.request.collectResourceTiming=this._collectResourceTiming):m.data=JSON.stringify(n),this._pendingWorkerUpdate.data=void 0):d&&(m.dataDiff=d,this._pendingWorkerUpdate.diff=void 0),this._isUpdatingWorker=!0,this.fire(new a.l("dataloading",{dataType:"source"}));try{const y=yield this.actor.sendAsync({type:"LD",data:m});if(this._isUpdatingWorker=!1,this._removed||y.abandoned)return void this.fire(new a.l("dataabort",{dataType:"source"}));this._data=y.data;let x=null;y.resourceTiming&&y.resourceTiming[this.id]&&(x=y.resourceTiming[this.id].slice(0));const S={dataType:"source"};this._collectResourceTiming&&x&&x.length>0&&a.e(S,{resourceTiming:x}),this.fire(new a.l("data",Object.assign(Object.assign({},S),{sourceDataType:"metadata"}))),this.fire(new a.l("data",Object.assign(Object.assign({},S),{sourceDataType:"content"})))}catch(y){if(this._isUpdatingWorker=!1,this._removed)return void this.fire(new a.l("dataabort",{dataType:"source"}));this.fire(new a.k(y))}finally{(this._pendingWorkerUpdate.data||this._pendingWorkerUpdate.diff)&&this._updateWorkerData()}}))}loaded(){return!this._isUpdatingWorker&&this._pendingWorkerUpdate.data===void 0&&this._pendingWorkerUpdate.diff===void 0}loadTile(n){return a._(this,void 0,void 0,(function*(){const d=n.actor?"RT":"LT";n.actor=this.actor;const m={type:this.type,uid:n.uid,tileID:n.tileID,zoom:n.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity,globalState:this.map.getGlobalState()};n.abortController=new AbortController;const y=yield this.actor.sendAsync({type:d,data:m},n.abortController);delete n.abortController,n.unloadVectorData(),n.aborted||n.loadVectorData(y,this.map.painter,d==="RT")}))}abortTile(n){return a._(this,void 0,void 0,(function*(){n.abortController&&(n.abortController.abort(),delete n.abortController),n.aborted=!0}))}unloadTile(n){return a._(this,void 0,void 0,(function*(){n.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:n.uid,type:this.type,source:this.id}})}))}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return a.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}class Yn extends a.E{constructor(n,d,m,y){super(),this.flippedWindingOrder=!1,this.id=n,this.dispatcher=m,this.coordinates=d.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(y),this.options=d}load(n){return a._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new a.l("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const d=yield we.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,d&&d.data&&(this.image=d.data,n&&(this.coordinates=n),this._finishLoading())}catch(d){this._request=null,this._loaded=!0,this.fire(new a.k(d))}}))}loaded(){return this._loaded}updateImage(n){return n.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=n.url,this.load(n.coordinates).finally((()=>{this.texture=null})),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new a.l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(n){this.map=n,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(n){this.coordinates=n;const d=n.map(a.a1.fromLngLat);var m;return this.tileID=(function(y){const x=a.a2.fromPoints(y),S=x.width(),I=x.height(),B=Math.max(S,I),F=Math.max(0,Math.floor(-Math.log(B)/Math.LN2)),U=Math.pow(2,F);return new a.a4(F,Math.floor((x.minX+x.maxX)/2*U),Math.floor((x.minY+x.maxY)/2*U))})(d),this.terrainTileRanges=this._getOverlappingTileRanges(d),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=d.map((y=>this.tileID.getTilePoint(y)._round())),this.flippedWindingOrder=((m=this.tileCoords)[1].x-m[0].x)*(m[2].y-m[0].y)-(m[1].y-m[0].y)*(m[2].x-m[0].x)<0,this.fire(new a.l("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const n=this.map.painter.context,d=n.gl;this.texture||(this.texture=new a.T(n,this.image,d.RGBA),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE));let m=!1;for(const y in this.tiles){const x=this.tiles[y];x.state!=="loaded"&&(x.state="loaded",x.texture=this.texture,m=!0)}m&&this.fire(new a.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(n){return a._(this,void 0,void 0,(function*(){this.tileID&&this.tileID.equals(n.tileID.canonical)?(this.tiles[String(n.tileID.wrap)]=n,n.buckets={}):n.state="errored"}))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}_getOverlappingTileRanges(n){const{minX:d,minY:m,maxX:y,maxY:x}=a.a2.fromPoints(n),S={};for(let I=0;I<=a.a3;I++){const B=Math.pow(2,I),F=Math.floor(d*B),U=Math.floor(m*B),W=Math.floor(y*B),G=Math.floor(x*B);S[I]={minTileX:F,minTileY:U,maxTileX:W,maxTileY:G}}return S}}class Jn extends Yn{constructor(n,d,m,y){super(n,d,m,y),this.roundZoom=!0,this.type="video",this.options=d}load(){return a._(this,void 0,void 0,(function*(){this._loaded=!1;const n=this.options;this.urls=[];for(const d of n.urls)this.urls.push(this.map._requestManager.transformRequest(d,"Source").url);try{const d=yield a.a5(this.urls);if(this._loaded=!0,!d)return;this.video=d,this.video.loop=!0,this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading()}catch(d){this.fire(new a.k(d))}}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(n){if(this.video){const d=this.video.seekable;n<d.start(0)||n>d.end(0)?this.fire(new a.k(new a.a6(`sources.${this.id}`,null,`Playback for this video can be set only between the ${d.start(0)} and ${d.end(0)}-second mark.`))):this.video.currentTime=n}}getVideo(){return this.video}onAdd(n){this.map||(this.map=n,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const n=this.map.painter.context,d=n.gl;this.texture?this.video.paused||(this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE),d.texSubImage2D(d.TEXTURE_2D,0,0,0,d.RGBA,d.UNSIGNED_BYTE,this.video)):(this.texture=new a.T(n,this.video,d.RGBA),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE));let m=!1;for(const y in this.tiles){const x=this.tiles[y];x.state!=="loaded"&&(x.state="loaded",x.texture=this.texture,m=!0)}m&&this.fire(new a.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class mi extends Yn{constructor(n,d,m,y){super(n,d,m,y),d.coordinates?Array.isArray(d.coordinates)&&d.coordinates.length===4&&!d.coordinates.some((x=>!Array.isArray(x)||x.length!==2||x.some((S=>typeof S!="number"))))||this.fire(new a.k(new a.a6(`sources.${n}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new a.k(new a.a6(`sources.${n}`,null,'missing required property "coordinates"'))),d.animate&&typeof d.animate!="boolean"&&this.fire(new a.k(new a.a6(`sources.${n}`,null,'optional "animate" property must be a boolean value'))),d.canvas?typeof d.canvas=="string"||d.canvas instanceof HTMLCanvasElement||this.fire(new a.k(new a.a6(`sources.${n}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new a.k(new a.a6(`sources.${n}`,null,'missing required property "canvas"'))),this.options=d,this.animate=d.animate===void 0||d.animate}load(){return a._(this,void 0,void 0,(function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new a.k(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}))}getCanvas(){return this.canvas}onAdd(n){this.map=n,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let n=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,n=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,n=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const d=this.map.painter.context,m=d.gl;this.texture?(n||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new a.T(d,this.canvas,m.RGBA,{premultiply:!0});let y=!1;for(const x in this.tiles){const S=this.tiles[x];S.state!=="loaded"&&(S.state="loaded",S.texture=this.texture,y=!0)}y&&this.fire(new a.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const n of[this.canvas.width,this.canvas.height])if(isNaN(n)||n<=0)return!0;return!1}}const Js={},_o=b=>{switch(b){case"geojson":return bs;case"image":return Yn;case"raster":return Li;case"raster-dem":return Mn;case"vector":return vn;case"video":return Jn;case"canvas":return mi}return Js[b]},Go="RTLPluginLoaded";class yo extends a.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=Ht()}_syncState(n){return this.status=n,this.dispatcher.broadcast("SRPS",{pluginStatus:n,pluginURL:this.url}).catch((d=>{throw this.status="error",d}))}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(n){return a._(this,arguments,void 0,(function*(d,m=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=L.resolveURL(d),!this.url)throw new Error(`requested url ${d} is invalid`);if(this.status==="unavailable"){if(!m)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()}))}_requestImport(){return a._(this,void 0,void 0,(function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new a.l(Go))}))}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let vo=null;function Ds(){return vo||(vo=new yo),vo}class Qs{constructor(n,d){this.timeAdded=0,this.fadeEndTime=0,this.tileID=n,this.uid=a.a7(),this.uses=0,this.tileSize=d,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(n){const d=n+this.timeAdded;d<this.fadeEndTime||(this.fadeEndTime=d)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(n){this.demTexture&&n.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(n,d,m){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",n){n.featureIndex&&(this.latestFeatureIndex=n.featureIndex,n.rawTileData?(this.latestRawTileData=n.rawTileData,this.latestFeatureIndex.rawTileData=n.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=n.collisionBoxArray,this.buckets=(function(y,x){const S={};if(!x)return S;for(const I of y){const B=I.layerIds.map((F=>x.getLayer(F))).filter(Boolean);if(B.length!==0){I.layers=B,I.stateDependentLayerIds&&(I.stateDependentLayers=I.stateDependentLayerIds.map((F=>B.filter((U=>U.id===F))[0])));for(const F of B)S[F.id]=I}}return S})(n.buckets,d?.style),this.hasSymbolBuckets=!1;for(const y in this.buckets){const x=this.buckets[y];if(x instanceof a.a9){if(this.hasSymbolBuckets=!0,!m)break;x.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const y in this.buckets){const x=this.buckets[y];if(x instanceof a.a9&&x.hasRTLText){this.hasRTLText=!0,Ds().lazyLoad();break}}this.queryPadding=0;for(const y in this.buckets){const x=this.buckets[y];this.queryPadding=Math.max(this.queryPadding,d.style.getLayer(y).queryRadius(x))}n.imageAtlas&&(this.imageAtlas=n.imageAtlas),n.glyphAtlasImage&&(this.glyphAtlasImage=n.glyphAtlasImage)}else this.collisionBoxArray=new a.a8}unloadVectorData(){for(const n in this.buckets)this.buckets[n].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(n){return this.buckets[n.id]}upload(n){for(const m in this.buckets){const y=this.buckets[m];y.uploadPending()&&y.upload(n)}const d=n.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new a.T(n,this.imageAtlas.image,d.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new a.T(n,this.glyphAtlasImage,d.ALPHA),this.glyphAtlasImage=null)}prepare(n){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(n,this.imageAtlasTexture)}queryRenderedFeatures(n,d,m,y,x,S,I,B,F,U,W){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:y,cameraQueryGeometry:x,scale:S,tileSize:this.tileSize,pixelPosMatrix:U,transform:B,params:I,queryPadding:this.queryPadding*F,getElevation:W},n,d,m):{}}querySourceFeatures(n,d){const m=this.latestFeatureIndex;if(!m||!m.rawTileData)return;const y=m.loadVTLayers(),x=d&&d.sourceLayer?d.sourceLayer:"",S=y._geojsonTileLayer||y[x];if(!S)return;const I=a.aa(d&&d.filter),{z:B,x:F,y:U}=this.tileID.canonical,W={z:B,x:F,y:U};for(let G=0;G<S.length;G++){const q=S.feature(G);if(I.needGeometry){const de=a.ab(q,!0);if(!I.filter(new a.F(this.tileID.overscaledZ),de,this.tileID.canonical))continue}else if(!I.filter(new a.F(this.tileID.overscaledZ),q))continue;const J=m.getId(q,x),le=new a.ac(q,B,F,U,J);le.tile=W,n.push(le)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(n){const d=this.expirationTime;if(n.cacheControl){const m=a.ad(n.cacheControl);m["max-age"]&&(this.expirationTime=Date.now()+1e3*m["max-age"])}else n.expires&&(this.expirationTime=new Date(n.expires).getTime());if(this.expirationTime){const m=Date.now();let y=!1;if(this.expirationTime>m)y=!1;else if(d)if(this.expirationTime<d)y=!0;else{const x=this.expirationTime-d;x?this.expirationTime=m+Math.max(x,3e4):y=!0}else y=!0;y?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(n,d){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(n).length===0)return;const m=this.latestFeatureIndex.loadVTLayers();for(const y in this.buckets){if(!d.style.hasLayer(y))continue;const x=this.buckets[y],S=x.layers[0].sourceLayer||"_geojsonTileLayer",I=m[S],B=n[S];if(!I||!B||Object.keys(B).length===0)continue;x.update(B,I,this.imageAtlas&&this.imageAtlas.patternPositions||{});const F=d&&d.style&&d.style.getLayer(y);F&&(this.queryPadding=Math.max(this.queryPadding,F.queryRadius(x)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<L.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(n){this.symbolFadeHoldUntil=L.now()+n}setDependencies(n,d){const m={};for(const y of d)m[y]=!0;this.dependencies[n]=m}hasDependency(n,d){for(const m of n){const y=this.dependencies[m];if(y){for(const x of d)if(y[x])return!0}}return!1}}class ke{constructor(n,d){this.max=n,this.onRemove=d,this.reset()}reset(){for(const n in this.data)for(const d of this.data[n])d.timeout&&clearTimeout(d.timeout),this.onRemove(d.value);return this.data={},this.order=[],this}add(n,d,m){const y=n.wrapped().key;this.data[y]===void 0&&(this.data[y]=[]);const x={value:d,timeout:void 0};if(m!==void 0&&(x.timeout=setTimeout((()=>{this.remove(n,x)}),m)),this.data[y].push(x),this.order.push(y),this.order.length>this.max){const S=this._getAndRemoveByKey(this.order[0]);S&&this.onRemove(S)}return this}has(n){return n.wrapped().key in this.data}getAndRemove(n){return this.has(n)?this._getAndRemoveByKey(n.wrapped().key):null}_getAndRemoveByKey(n){const d=this.data[n].shift();return d.timeout&&clearTimeout(d.timeout),this.data[n].length===0&&delete this.data[n],this.order.splice(this.order.indexOf(n),1),d.value}getByKey(n){const d=this.data[n];return d?d[0].value:null}get(n){return this.has(n)?this.data[n.wrapped().key][0].value:null}remove(n,d){if(!this.has(n))return this;const m=n.wrapped().key,y=d===void 0?0:this.data[m].indexOf(d),x=this.data[m][y];return this.data[m].splice(y,1),x.timeout&&clearTimeout(x.timeout),this.data[m].length===0&&delete this.data[m],this.onRemove(x.value),this.order.splice(this.order.indexOf(m),1),this}setMaxSize(n){for(this.max=n;this.order.length>this.max;){const d=this._getAndRemoveByKey(this.order[0]);d&&this.onRemove(d)}return this}filter(n){const d=[];for(const m in this.data)for(const y of this.data[m])n(y.value)||d.push(y);for(const m of d)this.remove(m.value.tileID,m)}}class Q{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(n,d,m){const y=String(d);if(this.stateChanges[n]=this.stateChanges[n]||{},this.stateChanges[n][y]=this.stateChanges[n][y]||{},a.e(this.stateChanges[n][y],m),this.deletedStates[n]===null){this.deletedStates[n]={};for(const x in this.state[n])x!==y&&(this.deletedStates[n][x]=null)}else if(this.deletedStates[n]&&this.deletedStates[n][y]===null){this.deletedStates[n][y]={};for(const x in this.state[n][y])m[x]||(this.deletedStates[n][y][x]=null)}else for(const x in m)this.deletedStates[n]&&this.deletedStates[n][y]&&this.deletedStates[n][y][x]===null&&delete this.deletedStates[n][y][x]}removeFeatureState(n,d,m){if(this.deletedStates[n]===null)return;const y=String(d);if(this.deletedStates[n]=this.deletedStates[n]||{},m&&d!==void 0)this.deletedStates[n][y]!==null&&(this.deletedStates[n][y]=this.deletedStates[n][y]||{},this.deletedStates[n][y][m]=null);else if(d!==void 0)if(this.stateChanges[n]&&this.stateChanges[n][y])for(m in this.deletedStates[n][y]={},this.stateChanges[n][y])this.deletedStates[n][y][m]=null;else this.deletedStates[n][y]=null;else this.deletedStates[n]=null}getState(n,d){const m=String(d),y=a.e({},(this.state[n]||{})[m],(this.stateChanges[n]||{})[m]);if(this.deletedStates[n]===null)return{};if(this.deletedStates[n]){const x=this.deletedStates[n][d];if(x===null)return{};for(const S in x)delete y[S]}return y}initializeTileState(n,d){n.setFeatureState(this.state,d)}coalesceChanges(n,d){const m={};for(const y in this.stateChanges){this.state[y]=this.state[y]||{};const x={};for(const S in this.stateChanges[y])this.state[y][S]||(this.state[y][S]={}),a.e(this.state[y][S],this.stateChanges[y][S]),x[S]=this.state[y][S];m[y]=x}for(const y in this.deletedStates){this.state[y]=this.state[y]||{};const x={};if(this.deletedStates[y]===null)for(const S in this.state[y])x[S]={},this.state[y][S]={};else for(const S in this.deletedStates[y]){if(this.deletedStates[y][S]===null)this.state[y][S]={};else for(const I of Object.keys(this.deletedStates[y][S]))delete this.state[y][S][I];x[S]=this.state[y][S]}m[y]=m[y]||{},a.e(m[y],x)}if(this.stateChanges={},this.deletedStates={},Object.keys(m).length!==0)for(const y in n)n[y].setFeatureState(m,d)}}const ee=89.25;function ae(b,n){const d=a.ah(n.lat,-a.ai,a.ai);return new a.P(a.V(n.lng)*b,a.U(d)*b)}function be(b,n){return new a.a1(n.x/b,n.y/b).toLngLat()}function Se(b){return b.cameraToCenterDistance*Math.min(.85*Math.tan(a.ae(90-b.pitch)),Math.tan(a.ae(ee-b.pitch)))}function Oe(b,n){const d=b.canonical,m=n/a.af(d.z),y=d.x+Math.pow(2,d.z)*b.wrap,x=a.ag(new Float64Array(16));return a.M(x,x,[y*m,d.y*m,0]),a.N(x,x,[m/a.$,m/a.$,1]),x}function Ze(b,n,d,m,y){const x=a.a1.fromLngLat(b,n),S=y*a.aj(1,b.lat),I=S*Math.cos(a.ae(d)),B=Math.sqrt(S*S-I*I),F=B*Math.sin(a.ae(-m)),U=B*Math.cos(a.ae(-m));return new a.a1(x.x+F,x.y+U,x.z+I)}function Be(b,n,d){const m=n.intersectsFrustum(b);if(!d||m===0)return m;const y=n.intersectsPlane(d);return y===0?0:m===2&&y===2?2:1}function nt(b,n,d){let m=0;const y=(d-n)/10;for(let x=0;x<10;x++)m+=y*Math.pow(Math.cos(n+(x+.5)/10*(d-n)),b);return m}function pt(b,n){return function(d,m,y,x,S){const I=2*((b-1)/a.ak(Math.cos(a.ae(ee-S))/Math.cos(a.ae(ee)))-1),B=Math.acos(y/x),F=2*nt(I-1,0,a.ae(S/2)),U=Math.min(a.ae(ee),B+a.ae(S/2)),W=nt(I-1,Math.min(U,B-a.ae(S/2)),U),G=Math.atan(m/y),q=Math.hypot(m,y);let J=d;return J+=a.ak(x/q/Math.max(.5,Math.cos(a.ae(S/2)))),J+=I*a.ak(Math.cos(G))/2,J-=a.ak(Math.max(1,W/F/n))/2,J}}const at=pt(9.314,3);function Ft(b,n){const d=(n.roundZoom?Math.round:Math.floor)(b.zoom+a.ak(b.tileSize/n.tileSize));return Math.max(0,d)}function Le(b,n){const d=b.getCameraFrustum(),m=b.getClippingPlane(),y=b.screenPointToMercatorCoordinate(b.getCameraPoint()),x=a.a1.fromLngLat(b.center,b.elevation);y.z=x.z+Math.cos(b.pitchInRadians)*b.cameraToCenterDistance/b.worldSize;const S=b.getCoveringTilesDetailsProvider(),I=S.allowVariableZoom(b,n),B=Ft(b,n),F=n.minzoom||0,U=n.maxzoom!==void 0?n.maxzoom:b.maxZoom,W=Math.min(Math.max(0,B),U),G=Math.pow(2,W),q=[G*y.x,G*y.y,0],J=[G*x.x,G*x.y,0],le=Math.hypot(x.x-y.x,x.y-y.y),de=Math.abs(x.z-y.z),pe=Math.hypot(le,de),ge=Te=>({zoom:0,x:0,y:0,wrap:Te,fullyVisible:!1}),xe=[],_e=[];if(b.renderWorldCopies&&S.allowWorldCopies())for(let Te=1;Te<=3;Te++)xe.push(ge(-Te)),xe.push(ge(Te));for(xe.push(ge(0));xe.length>0;){const Te=xe.pop(),Pe=Te.x,ve=Te.y;let Re=Te.fullyVisible;const $e={x:Pe,y:ve,z:Te.zoom},We=S.getTileBoundingVolume($e,Te.wrap,b.elevation,n);if(!Re){const Et=Be(d,We,m);if(Et===0)continue;Re=Et===2}const qe=S.distanceToTile2d(y.x,y.y,$e,We);let Qe=B;I&&(Qe=(n.calculateTileZoom||at)(b.zoom+a.ak(b.tileSize/n.tileSize),qe,de,pe,b.fov)),Qe=(n.roundZoom?Math.round:Math.floor)(Qe),Qe=Math.max(0,Qe);const bt=Math.min(Qe,U);if(Te.wrap=S.getWrap(x,$e,Te.wrap),Te.zoom>=bt){if(Te.zoom<F)continue;const Et=W-Te.zoom,ut=q[0]-.5-(Pe<<Et),Ut=q[1]-.5-(ve<<Et),Ar=n.reparseOverscaled?Math.max(Te.zoom,Qe):Te.zoom;_e.push({tileID:new a.Z(Te.zoom===U?Ar:Te.zoom,Te.wrap,Te.zoom,Pe,ve),distanceSq:a.al([J[0]-.5-Pe,J[1]-.5-ve]),tileDistanceToCamera:Math.sqrt(ut*ut+Ut*Ut)})}else for(let Et=0;Et<4;Et++)xe.push({zoom:Te.zoom+1,x:(Pe<<1)+Et%2,y:(ve<<1)+(Et>>1),wrap:Te.wrap,fullyVisible:Re})}return _e.sort(((Te,Pe)=>Te.distanceSq-Pe.distanceSq)).map((Te=>Te.tileID))}const or=a.a2.fromPoints([new a.P(0,0),new a.P(a.$,a.$)]);class Sr extends a.E{constructor(n,d,m){super(),this.id=n,this.dispatcher=m,this.on("data",(y=>this._dataHandler(y))),this.on("dataloading",(()=>{this._sourceErrored=!1})),this.on("error",(()=>{this._sourceErrored=this._source.loaded()})),this._source=((y,x,S,I)=>{const B=new(_o(x.type))(y,x,S,I);if(B.id!==y)throw new Error(`Expected Source id to be ${y} instead of ${B.id}`);return B})(n,d,m,this),this._tiles={},this._cache=new ke(0,(y=>this._unloadTile(y))),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Q,this._didEmitContent=!1,this._updated=!1}onAdd(n){this.map=n,this._maxTileCacheSize=n?n._maxTileCacheSize:null,this._maxTileCacheZoomLevels=n?n._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(n)}onRemove(n){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(n)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const n in this._tiles){const d=this._tiles[n];if(d.state!=="loaded"&&d.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const n=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,n&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(n,d,m){return a._(this,void 0,void 0,(function*(){try{yield this._source.loadTile(n),this._tileLoaded(n,d,m)}catch(y){n.state="errored",y.status!==404?this._source.fire(new a.k(y,{tile:n})):this.update(this.transform,this.terrain)}}))}_unloadTile(n){this._source.unloadTile&&this._source.unloadTile(n)}_abortTile(n){this._source.abortTile&&this._source.abortTile(n),this._source.fire(new a.l("dataabort",{tile:n,coord:n.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(n){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const d in this._tiles){const m=this._tiles[d];m.upload(n),m.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map((n=>n.tileID)).sort(Wt).map((n=>n.key))}getRenderableIds(n){const d=[];for(const m in this._tiles)this._isIdRenderable(m,n)&&d.push(this._tiles[m]);return n?d.sort(((m,y)=>{const x=m.tileID,S=y.tileID,I=new a.P(x.canonical.x,x.canonical.y)._rotate(-this.transform.bearingInRadians),B=new a.P(S.canonical.x,S.canonical.y)._rotate(-this.transform.bearingInRadians);return x.overscaledZ-S.overscaledZ||B.y-I.y||B.x-I.x})).map((m=>m.tileID.key)):d.map((m=>m.tileID)).sort(Wt).map((m=>m.key))}hasRenderableParent(n){const d=this.findLoadedParent(n,0);return!!d&&this._isIdRenderable(d.tileID.key)}_isIdRenderable(n,d){return this._tiles[n]&&this._tiles[n].hasData()&&!this._coveredTiles[n]&&(d||!this._tiles[n].holdingForFade())}reload(n){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const d in this._tiles)n?this._reloadTile(d,"expired"):this._tiles[d].state!=="errored"&&this._reloadTile(d,"reloading")}}_reloadTile(n,d){return a._(this,void 0,void 0,(function*(){const m=this._tiles[n];m&&(m.state!=="loading"&&(m.state=d),yield this._loadTile(m,n,d))}))}_tileLoaded(n,d,m){n.timeAdded=L.now(),m==="expired"&&(n.refreshedUponExpiration=!0),this._setTileReloadTimer(d,n),this.getSource().type==="raster-dem"&&n.dem&&this._backfillDEM(n),this._state.initializeTileState(n,this.map?this.map.painter:null),n.aborted||this._source.fire(new a.l("data",{dataType:"source",tile:n,coord:n.tileID}))}_backfillDEM(n){const d=this.getRenderableIds();for(let y=0;y<d.length;y++){const x=d[y];if(n.neighboringTiles&&n.neighboringTiles[x]){const S=this.getTileByID(x);m(n,S),m(S,n)}}function m(y,x){y.needsHillshadePrepare=!0,y.needsTerrainPrepare=!0;let S=x.tileID.canonical.x-y.tileID.canonical.x;const I=x.tileID.canonical.y-y.tileID.canonical.y,B=Math.pow(2,y.tileID.canonical.z),F=x.tileID.key;S===0&&I===0||Math.abs(I)>1||(Math.abs(S)>1&&(Math.abs(S+B)===1?S+=B:Math.abs(S-B)===1&&(S-=B)),x.dem&&y.dem&&(y.dem.backfillBorder(x.dem,S,I),y.neighboringTiles&&y.neighboringTiles[F]&&(y.neighboringTiles[F].backfilled=!0)))}}getTile(n){return this.getTileByID(n.key)}getTileByID(n){return this._tiles[n]}_retainLoadedChildren(n,d,m,y){for(const x in this._tiles){let S=this._tiles[x];if(y[x]||!S.hasData()||S.tileID.overscaledZ<=d||S.tileID.overscaledZ>m)continue;let I=S.tileID;for(;S&&S.tileID.overscaledZ>d+1;){const F=S.tileID.scaledTo(S.tileID.overscaledZ-1);S=this._tiles[F.key],S&&S.hasData()&&(I=F)}let B=I;for(;B.overscaledZ>d;)if(B=B.scaledTo(B.overscaledZ-1),n[B.key]||n[B.canonical.key]){y[I.key]=I;break}}}findLoadedParent(n,d){if(n.key in this._loadedParentTiles){const m=this._loadedParentTiles[n.key];return m&&m.tileID.overscaledZ>=d?m:null}for(let m=n.overscaledZ-1;m>=d;m--){const y=n.scaledTo(m),x=this._getLoadedTile(y);if(x)return x}}findLoadedSibling(n){return this._getLoadedTile(n)}_getLoadedTile(n){const d=this._tiles[n.key];return d&&d.hasData()?d:this._cache.getByKey(n.wrapped().key)}updateCacheSize(n){const d=Math.ceil(n.width/this._source.tileSize)+1,m=Math.ceil(n.height/this._source.tileSize)+1,y=Math.floor(d*m*(this._maxTileCacheZoomLevels===null?a.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),x=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,y):y;this._cache.setMaxSize(x)}handleWrapJump(n){const d=Math.round((n-(this._prevLng===void 0?n:this._prevLng))/360);if(this._prevLng=n,d){const m={};for(const y in this._tiles){const x=this._tiles[y];x.tileID=x.tileID.unwrapTo(x.tileID.wrap+d),m[x.tileID.key]=x}this._tiles=m;for(const y in this._timers)clearTimeout(this._timers[y]),delete this._timers[y];for(const y in this._tiles)this._setTileReloadTimer(y,this._tiles[y])}}_updateCoveredAndRetainedTiles(n,d,m,y,x,S){const I={},B={},F=Object.keys(n),U=L.now();for(const W of F){const G=n[W],q=this._tiles[W];if(!q||q.fadeEndTime!==0&&q.fadeEndTime<=U)continue;const J=this.findLoadedParent(G,d),le=this.findLoadedSibling(G),de=J||le||null;de&&(this._addTile(de.tileID),I[de.tileID.key]=de.tileID),B[W]=G}this._retainLoadedChildren(B,y,m,n);for(const W in I)n[W]||(this._coveredTiles[W]=!0,n[W]=I[W]);if(S){const W={},G={};for(const q of x)this._tiles[q.key].hasData()?W[q.key]=q:G[q.key]=q;for(const q in G){const J=G[q].children(this._source.maxzoom);this._tiles[J[0].key]&&this._tiles[J[1].key]&&this._tiles[J[2].key]&&this._tiles[J[3].key]&&(W[J[0].key]=n[J[0].key]=J[0],W[J[1].key]=n[J[1].key]=J[1],W[J[2].key]=n[J[2].key]=J[2],W[J[3].key]=n[J[3].key]=J[3],delete G[q])}for(const q in G){const J=G[q],le=this.findLoadedParent(J,this._source.minzoom),de=this.findLoadedSibling(J),pe=le||de||null;if(pe){W[pe.tileID.key]=n[pe.tileID.key]=pe.tileID;for(const ge in W)W[ge].isChildOf(pe.tileID)&&delete W[ge]}}for(const q in this._tiles)W[q]||(this._coveredTiles[q]=!0)}}update(n,d){if(!this._sourceLoaded||this._paused)return;let m;this.transform=n,this.terrain=d,this.updateCacheSize(n),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?m=n.getVisibleUnwrappedCoordinates(this._source.tileID).map((U=>new a.Z(U.canonical.z,U.wrap,U.canonical.z,U.canonical.x,U.canonical.y))):(m=Le(n,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:d,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(m=m.filter((U=>this._source.hasTile(U))))):m=[];const y=Ft(n,this._source),x=Math.max(y-Sr.maxOverzooming,this._source.minzoom),S=Math.max(y+Sr.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const U={};for(const W of m)if(W.canonical.z>this._source.minzoom){const G=W.scaledTo(W.canonical.z-1);U[G.key]=G;const q=W.scaledTo(Math.max(this._source.minzoom,Math.min(W.canonical.z,5)));U[q.key]=q}m=m.concat(Object.values(U))}const I=m.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,I&&this.fire(new a.l("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const B=this._updateRetainedTiles(m,y);_r(this._source.type)&&this._updateCoveredAndRetainedTiles(B,x,S,y,m,d);for(const U in B)this._tiles[U].clearFadeHold();const F=a.am(this._tiles,B);for(const U of F){const W=this._tiles[U];W.hasSymbolBuckets&&!W.holdingForFade()?W.setHoldDuration(this.map._fadeDuration):W.hasSymbolBuckets&&!W.symbolFadeFinished()||this._removeTile(U)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const n in this._tiles)this._tiles[n].holdingForFade()&&this._removeTile(n)}_updateRetainedTiles(n,d){var m;const y={},x={},S=Math.max(d-Sr.maxOverzooming,this._source.minzoom),I=Math.max(d+Sr.maxUnderzooming,this._source.minzoom),B={};for(const F of n){const U=this._addTile(F);y[F.key]=F,U.hasData()||d<this._source.maxzoom&&(B[F.key]=F)}this._retainLoadedChildren(B,d,I,y);for(const F of n){let U=this._tiles[F.key];if(U.hasData())continue;if(d+1>this._source.maxzoom){const G=F.children(this._source.maxzoom)[0],q=this.getTile(G);if(q&&q.hasData()){y[G.key]=G;continue}}else{const G=F.children(this._source.maxzoom);if(y[G[0].key]&&y[G[1].key]&&y[G[2].key]&&y[G[3].key])continue}let W=U.wasRequested();for(let G=F.overscaledZ-1;G>=S;--G){const q=F.scaledTo(G);if(x[q.key])break;if(x[q.key]=!0,U=this.getTile(q),!U&&W&&(U=this._addTile(q)),U){const J=U.hasData();if((J||!(!((m=this.map)===null||m===void 0)&&m.cancelPendingTileRequestsWhileZooming)||W)&&(y[q.key]=q),W=U.wasRequested(),J)break}}}return y}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const n in this._tiles){const d=[];let m,y=this._tiles[n].tileID;for(;y.overscaledZ>0;){if(y.key in this._loadedParentTiles){m=this._loadedParentTiles[y.key];break}d.push(y.key);const x=y.scaledTo(y.overscaledZ-1);if(m=this._getLoadedTile(x),m)break;y=x}for(const x of d)this._loadedParentTiles[x]=m}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const n in this._tiles){const d=this._tiles[n].tileID,m=this._getLoadedTile(d);this._loadedSiblingTiles[d.key]=m}}_addTile(n){let d=this._tiles[n.key];if(d)return d;d=this._cache.getAndRemove(n),d&&(this._setTileReloadTimer(n.key,d),d.tileID=n,this._state.initializeTileState(d,this.map?this.map.painter:null),this._cacheTimers[n.key]&&(clearTimeout(this._cacheTimers[n.key]),delete this._cacheTimers[n.key],this._setTileReloadTimer(n.key,d)));const m=d;return d||(d=new Qs(n,this._source.tileSize*n.overscaleFactor()),this._loadTile(d,n.key,d.state)),d.uses++,this._tiles[n.key]=d,m||this._source.fire(new a.l("dataloading",{tile:d,coord:d.tileID,dataType:"source"})),d}_setTileReloadTimer(n,d){n in this._timers&&(clearTimeout(this._timers[n]),delete this._timers[n]);const m=d.getExpiryTimeout();m&&(this._timers[n]=setTimeout((()=>{this._reloadTile(n,"expired"),delete this._timers[n]}),m))}refreshTiles(n){for(const d in this._tiles)(this._isIdRenderable(d)||this._tiles[d].state=="errored")&&n.some((m=>m.equals(this._tiles[d].tileID.canonical)))&&this._reloadTile(d,"expired")}_removeTile(n){const d=this._tiles[n];d&&(d.uses--,delete this._tiles[n],this._timers[n]&&(clearTimeout(this._timers[n]),delete this._timers[n]),d.uses>0||(d.hasData()&&d.state!=="reloading"?this._cache.add(d.tileID,d,d.getExpiryTimeout()):(d.aborted=!0,this._abortTile(d),this._unloadTile(d))))}_dataHandler(n){const d=n.sourceDataType;n.dataType==="source"&&d==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&n.dataType==="source"&&d==="content"&&(this.reload(n.sourceDataChanged),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const n in this._tiles)this._removeTile(n);this._cache.reset()}tilesIn(n,d,m){const y=[],x=this.transform;if(!x)return y;const S=x.getCoveringTilesDetailsProvider().allowWorldCopies(),I=m?x.getCameraQueryGeometry(n):n,B=q=>x.screenPointToMercatorCoordinate(q,this.terrain),F=this.transformBbox(n,B,!S),U=this.transformBbox(I,B,!S),W=this.getIds(),G=a.a2.fromPoints(U);for(let q=0;q<W.length;q++){const J=this._tiles[W[q]];if(J.holdingForFade())continue;const le=S?[J.tileID]:[J.tileID.unwrapTo(-1),J.tileID.unwrapTo(0)],de=Math.pow(2,x.zoom-J.tileID.overscaledZ),pe=d*J.queryPadding*a.$/J.tileSize/de;for(const ge of le){const xe=G.map((_e=>ge.getTilePoint(new a.a1(_e.x,_e.y))));if(xe.expandBy(pe),xe.intersects(or)){const _e=F.map((Pe=>ge.getTilePoint(Pe))),Te=U.map((Pe=>ge.getTilePoint(Pe)));y.push({tile:J,tileID:S?ge:ge.unwrapTo(0),queryGeometry:_e,cameraQueryGeometry:Te,scale:de})}}}return y}transformBbox(n,d,m){let y=n.map(d);if(m){const x=a.a2.fromPoints(n);x.shrinkBy(.001*Math.min(x.width(),x.height()));const S=x.map(d);a.a2.fromPoints(y).covers(S)||(y=y.map((I=>I.x>.5?new a.a1(I.x-1,I.y,I.z):I)))}return y}getVisibleCoordinates(n){const d=this.getRenderableIds(n).map((m=>this._tiles[m].tileID));return this.transform&&this.transform.populateCache(d),d}hasTransition(){if(this._source.hasTransition())return!0;if(_r(this._source.type)){const n=L.now();for(const d in this._tiles)if(this._tiles[d].fadeEndTime>=n)return!0}return!1}setFeatureState(n,d,m){this._state.updateState(n=n||"_geojsonTileLayer",d,m)}removeFeatureState(n,d,m){this._state.removeFeatureState(n=n||"_geojsonTileLayer",d,m)}getFeatureState(n,d){return this._state.getState(n=n||"_geojsonTileLayer",d)}setDependencies(n,d,m){const y=this._tiles[n];y&&y.setDependencies(d,m)}reloadTilesForDependencies(n,d){for(const m in this._tiles)this._tiles[m].hasDependency(n,d)&&this._reloadTile(m,"reloading");this._cache.filter((m=>!m.hasDependency(n,d)))}}function Wt(b,n){const d=Math.abs(2*b.wrap)-+(b.wrap<0),m=Math.abs(2*n.wrap)-+(n.wrap<0);return b.overscaledZ-n.overscaledZ||m-d||n.canonical.y-b.canonical.y||n.canonical.x-b.canonical.x}function _r(b){return b==="raster"||b==="image"||b==="video"}Sr.maxOverzooming=10,Sr.maxUnderzooming=3;class $r{constructor(n,d){this.reset(n,d)}reset(n,d){this.points=n||[],this._distances=[0];for(let m=1;m<this.points.length;m++)this._distances[m]=this._distances[m-1]+this.points[m].dist(this.points[m-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(d||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(n){if(this.points.length===1)return this.points[0];n=a.ah(n,0,1);let d=1,m=this._distances[d];const y=n*this.paddedLength+this.padding;for(;m<y&&d<this._distances.length;)m=this._distances[++d];const x=d-1,S=this._distances[x],I=m-S,B=I>0?(y-S)/I:0;return this.points[x].mult(1-B).add(this.points[d].mult(B))}}function Si(b,n){let d=!0;return b==="always"||b!=="never"&&n!=="never"||(d=!1),d}class Di{constructor(n,d,m){const y=this.boxCells=[],x=this.circleCells=[];this.xCellCount=Math.ceil(n/m),this.yCellCount=Math.ceil(d/m);for(let S=0;S<this.xCellCount*this.yCellCount;S++)y.push([]),x.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=n,this.height=d,this.xScale=this.xCellCount/n,this.yScale=this.yCellCount/d,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(n,d,m,y,x){this._forEachCell(d,m,y,x,this._insertBoxCell,this.boxUid++),this.boxKeys.push(n),this.bboxes.push(d),this.bboxes.push(m),this.bboxes.push(y),this.bboxes.push(x)}insertCircle(n,d,m,y){this._forEachCell(d-y,m-y,d+y,m+y,this._insertCircleCell,this.circleUid++),this.circleKeys.push(n),this.circles.push(d),this.circles.push(m),this.circles.push(y)}_insertBoxCell(n,d,m,y,x,S){this.boxCells[x].push(S)}_insertCircleCell(n,d,m,y,x,S){this.circleCells[x].push(S)}_query(n,d,m,y,x,S,I){if(m<0||n>this.width||y<0||d>this.height)return[];const B=[];if(n<=0&&d<=0&&this.width<=m&&this.height<=y){if(x)return[{key:null,x1:n,y1:d,x2:m,y2:y}];for(let F=0;F<this.boxKeys.length;F++)B.push({key:this.boxKeys[F],x1:this.bboxes[4*F],y1:this.bboxes[4*F+1],x2:this.bboxes[4*F+2],y2:this.bboxes[4*F+3]});for(let F=0;F<this.circleKeys.length;F++){const U=this.circles[3*F],W=this.circles[3*F+1],G=this.circles[3*F+2];B.push({key:this.circleKeys[F],x1:U-G,y1:W-G,x2:U+G,y2:W+G})}}else this._forEachCell(n,d,m,y,this._queryCell,B,{hitTest:x,overlapMode:S,seenUids:{box:{},circle:{}}},I);return B}query(n,d,m,y){return this._query(n,d,m,y,!1,null)}hitTest(n,d,m,y,x,S){return this._query(n,d,m,y,!0,x,S).length>0}hitTestCircle(n,d,m,y,x){const S=n-m,I=n+m,B=d-m,F=d+m;if(I<0||S>this.width||F<0||B>this.height)return!1;const U=[];return this._forEachCell(S,B,I,F,this._queryCellCircle,U,{hitTest:!0,overlapMode:y,circle:{x:n,y:d,radius:m},seenUids:{box:{},circle:{}}},x),U.length>0}_queryCell(n,d,m,y,x,S,I,B){const{seenUids:F,hitTest:U,overlapMode:W}=I,G=this.boxCells[x];if(G!==null){const J=this.bboxes;for(const le of G)if(!F.box[le]){F.box[le]=!0;const de=4*le,pe=this.boxKeys[le];if(n<=J[de+2]&&d<=J[de+3]&&m>=J[de+0]&&y>=J[de+1]&&(!B||B(pe))&&(!U||!Si(W,pe.overlapMode))&&(S.push({key:pe,x1:J[de],y1:J[de+1],x2:J[de+2],y2:J[de+3]}),U))return!0}}const q=this.circleCells[x];if(q!==null){const J=this.circles;for(const le of q)if(!F.circle[le]){F.circle[le]=!0;const de=3*le,pe=this.circleKeys[le];if(this._circleAndRectCollide(J[de],J[de+1],J[de+2],n,d,m,y)&&(!B||B(pe))&&(!U||!Si(W,pe.overlapMode))){const ge=J[de],xe=J[de+1],_e=J[de+2];if(S.push({key:pe,x1:ge-_e,y1:xe-_e,x2:ge+_e,y2:xe+_e}),U)return!0}}}return!1}_queryCellCircle(n,d,m,y,x,S,I,B){const{circle:F,seenUids:U,overlapMode:W}=I,G=this.boxCells[x];if(G!==null){const J=this.bboxes;for(const le of G)if(!U.box[le]){U.box[le]=!0;const de=4*le,pe=this.boxKeys[le];if(this._circleAndRectCollide(F.x,F.y,F.radius,J[de+0],J[de+1],J[de+2],J[de+3])&&(!B||B(pe))&&!Si(W,pe.overlapMode))return S.push(!0),!0}}const q=this.circleCells[x];if(q!==null){const J=this.circles;for(const le of q)if(!U.circle[le]){U.circle[le]=!0;const de=3*le,pe=this.circleKeys[le];if(this._circlesCollide(J[de],J[de+1],J[de+2],F.x,F.y,F.radius)&&(!B||B(pe))&&!Si(W,pe.overlapMode))return S.push(!0),!0}}}_forEachCell(n,d,m,y,x,S,I,B){const F=this._convertToXCellCoord(n),U=this._convertToYCellCoord(d),W=this._convertToXCellCoord(m),G=this._convertToYCellCoord(y);for(let q=F;q<=W;q++)for(let J=U;J<=G;J++)if(x.call(this,n,d,m,y,this.xCellCount*J+q,S,I,B))return}_convertToXCellCoord(n){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(n*this.xScale)))}_convertToYCellCoord(n){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(n*this.yScale)))}_circlesCollide(n,d,m,y,x,S){const I=y-n,B=x-d,F=m+S;return F*F>I*I+B*B}_circleAndRectCollide(n,d,m,y,x,S,I){const B=(S-y)/2,F=Math.abs(n-(y+B));if(F>B+m)return!1;const U=(I-x)/2,W=Math.abs(d-(x+U));if(W>U+m)return!1;if(F<=B||W<=U)return!0;const G=F-B,q=W-U;return G*G+q*q<=m*m}}function ui(b,n,d){const m=a.L();if(!b){const{vecSouth:W,vecEast:G}=Pr(n),q=T();q[0]=G[0],q[1]=G[1],q[2]=W[0],q[3]=W[1],y=q,(U=(S=(x=q)[0])*(F=x[3])-(B=x[2])*(I=x[1]))&&(y[0]=F*(U=1/U),y[1]=-I*U,y[2]=-B*U,y[3]=S*U),m[0]=q[0],m[1]=q[1],m[4]=q[2],m[5]=q[3]}var y,x,S,I,B,F,U;return a.N(m,m,[1/d,1/d,1]),m}function Er(b,n,d,m){if(b){const y=a.L();if(!n){const{vecSouth:x,vecEast:S}=Pr(d);y[0]=S[0],y[1]=S[1],y[4]=x[0],y[5]=x[1]}return a.N(y,y,[m,m,1]),y}return d.pixelsToClipSpaceMatrix}function Pr(b){const n=Math.cos(b.rollInRadians),d=Math.sin(b.rollInRadians),m=Math.cos(b.pitchInRadians),y=Math.cos(b.bearingInRadians),x=Math.sin(b.bearingInRadians),S=a.ar();S[0]=-y*m*d-x*n,S[1]=-x*m*d+y*n;const I=a.as(S);I<1e-9?a.at(S):a.au(S,S,1/I);const B=a.ar();B[0]=y*m*n-x*d,B[1]=x*m*n+y*d;const F=a.as(B);return F<1e-9?a.at(B):a.au(B,B,1/F),{vecEast:B,vecSouth:S}}function Ni(b,n,d,m){let y;m?(y=[b,n,m(b,n),1],a.aw(y,y,d)):(y=[b,n,0,1],Wa(y,y,d));const x=y[3];return{point:new a.P(y[0]/x,y[1]/x),signedDistanceFromCamera:x,isOccluded:!1}}function _t(b,n){return .5+b/n*.5}function Ci(b,n){return b.x>=-n[0]&&b.x<=n[0]&&b.y>=-n[1]&&b.y<=n[1]}function si(b,n,d,m,y,x,S,I,B,F,U,W,G){const q=d?b.textSizeData:b.iconSizeData,J=a.an(q,n.transform.zoom),le=[256/n.width*2+1,256/n.height*2+1],de=d?b.text.dynamicLayoutVertexArray:b.icon.dynamicLayoutVertexArray;de.clear();const pe=b.lineVertexArray,ge=d?b.text.placedSymbolArray:b.icon.placedSymbolArray,xe=n.transform.width/n.transform.height;let _e=!1;for(let Te=0;Te<ge.length;Te++){const Pe=ge.get(Te);if(Pe.hidden||Pe.writingMode===a.ao.vertical&&!_e){to(Pe.numGlyphs,de);continue}_e=!1;const ve=new a.P(Pe.anchorX,Pe.anchorY),Re={getElevation:G,pitchedLabelPlaneMatrix:m,lineVertexArray:pe,pitchWithMap:x,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:n.transform,tileAnchorPoint:ve,unwrappedTileID:B,width:F,height:U,translation:W},$e=Un(Pe.anchorX,Pe.anchorY,Re);if(!Ci($e.point,le)){to(Pe.numGlyphs,de);continue}const We=_t(n.transform.cameraToCenterDistance,$e.signedDistanceFromCamera),qe=a.ap(q,J,Pe),Qe=x?qe*n.transform.getPitchedTextCorrection(Pe.anchorX,Pe.anchorY,B)/We:qe*We,bt=Tt({projectionContext:Re,pitchedLabelPlaneMatrixInverse:y,symbol:Pe,fontSize:Qe,flip:!1,keepUpright:S,glyphOffsetArray:b.glyphOffsetArray,dynamicLayoutVertexArray:de,aspectRatio:xe,rotateToLine:I});_e=bt.useVertical,(bt.notEnoughRoom||_e||bt.needsFlipping&&Tt({projectionContext:Re,pitchedLabelPlaneMatrixInverse:y,symbol:Pe,fontSize:Qe,flip:!0,keepUpright:S,glyphOffsetArray:b.glyphOffsetArray,dynamicLayoutVertexArray:de,aspectRatio:xe,rotateToLine:I}).notEnoughRoom)&&to(Pe.numGlyphs,de)}d?b.text.dynamicLayoutVertexBuffer.updateData(de):b.icon.dynamicLayoutVertexBuffer.updateData(de)}function Ns(b,n,d,m,y,x,S,I){const B=x.glyphStartIndex+x.numGlyphs,F=x.lineStartIndex,U=x.lineStartIndex+x.lineLength,W=n.getoffsetX(x.glyphStartIndex),G=n.getoffsetX(B-1),q=xs(b*W,d,m,y,x.segment,F,U,I,S);if(!q)return null;const J=xs(b*G,d,m,y,x.segment,F,U,I,S);return J?I.projectionCache.anyProjectionOccluded?null:{first:q,last:J}:null}function Ha(b,n,d,m){return b===a.ao.horizontal&&Math.abs(d.y-n.y)>Math.abs(d.x-n.x)*m?{useVertical:!0}:(b===a.ao.vertical?n.y<d.y:n.x>d.x)?{needsFlipping:!0}:null}function Tt(b){const{projectionContext:n,pitchedLabelPlaneMatrixInverse:d,symbol:m,fontSize:y,flip:x,keepUpright:S,glyphOffsetArray:I,dynamicLayoutVertexArray:B,aspectRatio:F,rotateToLine:U}=b,W=y/24,G=m.lineOffsetX*W,q=m.lineOffsetY*W;let J;if(m.numGlyphs>1){const le=m.glyphStartIndex+m.numGlyphs,de=m.lineStartIndex,pe=m.lineStartIndex+m.lineLength,ge=Ns(W,I,G,q,x,m,U,n);if(!ge)return{notEnoughRoom:!0};const xe=eo(ge.first.point.x,ge.first.point.y,n,d),_e=eo(ge.last.point.x,ge.last.point.y,n,d);if(S&&!x){const Te=Ha(m.writingMode,xe,_e,F);if(Te)return Te}J=[ge.first];for(let Te=m.glyphStartIndex+1;Te<le-1;Te++){const Pe=xs(W*I.getoffsetX(Te),G,q,x,m.segment,de,pe,n,U);if(!Pe)return{notEnoughRoom:!0};J.push(Pe)}J.push(ge.last)}else{if(S&&!x){const de=Hi(n.tileAnchorPoint.x,n.tileAnchorPoint.y,n).point,pe=m.lineStartIndex+m.segment+1,ge=new a.P(n.lineVertexArray.getx(pe),n.lineVertexArray.gety(pe)),xe=Hi(ge.x,ge.y,n),_e=xe.signedDistanceFromCamera>0?xe.point:Cr(n.tileAnchorPoint,ge,de,1,n),Te=eo(de.x,de.y,n,d),Pe=eo(_e.x,_e.y,n,d),ve=Ha(m.writingMode,Te,Pe,F);if(ve)return ve}const le=xs(W*I.getoffsetX(m.glyphStartIndex),G,q,x,m.segment,m.lineStartIndex,m.lineStartIndex+m.lineLength,n,U);if(!le||n.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};J=[le]}for(const le of J)a.av(B,le.point,le.angle);return{}}function Cr(b,n,d,m,y){const x=b.add(b.sub(n)._unit()),S=Hi(x.x,x.y,y).point,I=d.sub(S);return d.add(I._mult(m/I.mag()))}function cr(b,n,d){const m=n.projectionCache;if(m.projections[b])return m.projections[b];const y=new a.P(n.lineVertexArray.getx(b),n.lineVertexArray.gety(b)),x=Hi(y.x,y.y,n);if(x.signedDistanceFromCamera>0)return m.projections[b]=x.point,m.anyProjectionOccluded=m.anyProjectionOccluded||x.isOccluded,x.point;const S=b-d.direction;return Cr(d.distanceFromAnchor===0?n.tileAnchorPoint:new a.P(n.lineVertexArray.getx(S),n.lineVertexArray.gety(S)),y,d.previousVertex,d.absOffsetX-d.distanceFromAnchor+1,n)}function Hi(b,n,d){const m=b+d.translation[0],y=n+d.translation[1];let x;return d.pitchWithMap?(x=Ni(m,y,d.pitchedLabelPlaneMatrix,d.getElevation),x.isOccluded=!1):(x=d.transform.projectTileCoordinates(m,y,d.unwrappedTileID,d.getElevation),x.point.x=(.5*x.point.x+.5)*d.width,x.point.y=(.5*-x.point.y+.5)*d.height),x}function eo(b,n,d,m){if(d.pitchWithMap){const y=[b,n,0,1];return a.aw(y,y,m),d.transform.projectTileCoordinates(y[0]/y[3],y[1]/y[3],d.unwrappedTileID,d.getElevation).point}return{x:b/d.width*2-1,y:1-n/d.height*2}}function Un(b,n,d){return d.transform.projectTileCoordinates(b,n,d.unwrappedTileID,d.getElevation)}function hr(b,n,d){return b._unit()._perp()._mult(n*d)}function bo(b,n,d,m,y,x,S,I,B){if(I.projectionCache.offsets[b])return I.projectionCache.offsets[b];const F=d.add(n);if(b+B.direction<m||b+B.direction>=y)return I.projectionCache.offsets[b]=F,F;const U=cr(b+B.direction,I,B),W=hr(U.sub(d),S,B.direction),G=d.add(W),q=U.add(W);return I.projectionCache.offsets[b]=a.ax(x,F,G,q)||F,I.projectionCache.offsets[b]}function xs(b,n,d,m,y,x,S,I,B){const F=m?b-n:b+n;let U=F>0?1:-1,W=0;m&&(U*=-1,W=Math.PI),U<0&&(W+=Math.PI);let G,q=U>0?x+y:x+y+1;I.projectionCache.cachedAnchorPoint?G=I.projectionCache.cachedAnchorPoint:(G=Hi(I.tileAnchorPoint.x,I.tileAnchorPoint.y,I).point,I.projectionCache.cachedAnchorPoint=G);let J,le,de=G,pe=G,ge=0,xe=0;const _e=Math.abs(F),Te=[];let Pe;for(;ge+xe<=_e;){if(q+=U,q<x||q>=S)return null;ge+=xe,pe=de,le=J;const $e={absOffsetX:_e,direction:U,distanceFromAnchor:ge,previousVertex:pe};if(de=cr(q,I,$e),d===0)Te.push(pe),Pe=de.sub(pe);else{let We;const qe=de.sub(pe);We=qe.mag()===0?hr(cr(q+U,I,$e).sub(de),d,U):hr(qe,d,U),le||(le=pe.add(We)),J=bo(q,We,de,x,S,le,d,I,$e),Te.push(le),Pe=J.sub(le)}xe=Pe.mag()}const ve=Pe._mult((_e-ge)/xe)._add(le||pe),Re=W+Math.atan2(de.y-pe.y,de.x-pe.x);return Te.push(ve),{point:ve,angle:B?Re:0,path:Te}}const ha=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function to(b,n){for(let d=0;d<b;d++){const m=n.length;n.resize(m+4),n.float32.set(ha,3*m)}}function Wa(b,n,d){const m=n[0],y=n[1];return b[0]=d[0]*m+d[4]*y+d[12],b[1]=d[1]*m+d[5]*y+d[13],b[3]=d[3]*m+d[7]*y+d[15],b}const br=100;class Pn{constructor(n,d=new Di(n.width+200,n.height+200,25),m=new Di(n.width+200,n.height+200,25)){this.transform=n,this.grid=d,this.ignoredGrid=m,this.pitchFactor=Math.cos(n.pitch*Math.PI/180)*n.cameraToCenterDistance,this.screenRightBoundary=n.width+br,this.screenBottomBoundary=n.height+br,this.gridRightBoundary=n.width+200,this.gridBottomBoundary=n.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(n,d,m,y,x,S,I,B,F,U,W,G){const q=this.projectAndGetPerspectiveRatio(n.anchorPointX+B[0],n.anchorPointY+B[1],x,U,G),J=m*q.perspectiveRatio;let le;if(S||I)le=this._projectCollisionBox(n,J,y,x,S,I,B,q,U,W,G);else{const Pe=q.x+(W?W.x*J:0),ve=q.y+(W?W.y*J:0);le={allPointsOccluded:!1,box:[Pe+n.x1*J,ve+n.y1*J,Pe+n.x2*J,ve+n.y2*J]}}const[de,pe,ge,xe]=le.box,_e=S?le.allPointsOccluded:q.isOccluded;let Te=_e;return Te||(Te=q.perspectiveRatio<this.perspectiveRatioCutoff),Te||(Te=!this.isInsideGrid(de,pe,ge,xe)),Te||d!=="always"&&this.grid.hitTest(de,pe,ge,xe,d,F)?{box:[de,pe,ge,xe],placeable:!1,offscreen:!1,occluded:_e}:{box:[de,pe,ge,xe],placeable:!0,offscreen:this.isOffscreen(de,pe,ge,xe),occluded:_e}}placeCollisionCircles(n,d,m,y,x,S,I,B,F,U,W,G,q,J){const le=[],de=new a.P(d.anchorX,d.anchorY),pe=this.getPerspectiveRatio(de.x,de.y,S,J),ge=(F?x*this.transform.getPitchedTextCorrection(d.anchorX,d.anchorY,S)/pe:x*pe)/a.aB,xe={getElevation:J,pitchedLabelPlaneMatrix:I,lineVertexArray:m,pitchWithMap:F,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:de,unwrappedTileID:S,width:this.transform.width,height:this.transform.height,translation:q},_e=Ns(ge,y,d.lineOffsetX*ge,d.lineOffsetY*ge,!1,d,!1,xe);let Te=!1,Pe=!1,ve=!0;if(_e){const Re=.5*W*pe+G,$e=new a.P(-100,-100),We=new a.P(this.screenRightBoundary,this.screenBottomBoundary),qe=new $r,Qe=_e.first,bt=_e.last;let Et=[];for(let Ar=Qe.path.length-1;Ar>=1;Ar--)Et.push(Qe.path[Ar]);for(let Ar=1;Ar<bt.path.length;Ar++)Et.push(bt.path[Ar]);const ut=2.5*Re;if(F){const Ar=this.projectPathToScreenSpace(Et,xe);Et=Ar.some((Ur=>Ur.signedDistanceFromCamera<=0))?[]:Ar.map((Ur=>Ur.point))}let Ut=[];if(Et.length>0){const Ar=Et[0].clone(),Ur=Et[0].clone();for(let ei=1;ei<Et.length;ei++)Ar.x=Math.min(Ar.x,Et[ei].x),Ar.y=Math.min(Ar.y,Et[ei].y),Ur.x=Math.max(Ur.x,Et[ei].x),Ur.y=Math.max(Ur.y,Et[ei].y);Ut=Ar.x>=$e.x&&Ur.x<=We.x&&Ar.y>=$e.y&&Ur.y<=We.y?[Et]:Ur.x<$e.x||Ar.x>We.x||Ur.y<$e.y||Ar.y>We.y?[]:a.ay([Et],$e.x,$e.y,We.x,We.y)}for(const Ar of Ut){qe.reset(Ar,.25*Re);let Ur=0;Ur=qe.length<=.5*Re?1:Math.ceil(qe.paddedLength/ut)+1;for(let ei=0;ei<Ur;ei++){const Xr=ei/Math.max(Ur-1,1),ai=qe.lerp(Xr),wi=ai.x+br,yr=ai.y+br;le.push(wi,yr,Re,0);const Hr=wi-Re,Zi=yr-Re,tn=wi+Re,dn=yr+Re;if(ve=ve&&this.isOffscreen(Hr,Zi,tn,dn),Pe=Pe||this.isInsideGrid(Hr,Zi,tn,dn),n!=="always"&&this.grid.hitTestCircle(wi,yr,Re,n,U)&&(Te=!0,!B))return{circles:[],offscreen:!1,collisionDetected:Te}}}}return{circles:!B&&Te||!Pe||pe<this.perspectiveRatioCutoff?[]:le,offscreen:ve,collisionDetected:Te}}projectPathToScreenSpace(n,d){const m=(function(y,x){const S=a.L();return a.aq(S,x.pitchedLabelPlaneMatrix),y.map((I=>{const B=Ni(I.x,I.y,S,x.getElevation),F=x.transform.projectTileCoordinates(B.point.x,B.point.y,x.unwrappedTileID,x.getElevation);return F.point.x=(.5*F.point.x+.5)*x.width,F.point.y=(.5*-F.point.y+.5)*x.height,F}))})(n,d);return(function(y){let x=0,S=0,I=0,B=0;for(let F=0;F<y.length;F++)y[F].isOccluded?(I=F+1,B=0):(B++,B>S&&(S=B,x=I));return y.slice(x,x+S)})(m)}queryRenderedSymbols(n){if(n.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const d=[],m=new a.a2;for(const W of n){const G=new a.P(W.x+br,W.y+br);m.extend(G),d.push(G)}const{minX:y,minY:x,maxX:S,maxY:I}=m,B=this.grid.query(y,x,S,I).concat(this.ignoredGrid.query(y,x,S,I)),F={},U={};for(const W of B){const G=W.key;if(F[G.bucketInstanceId]===void 0&&(F[G.bucketInstanceId]={}),F[G.bucketInstanceId][G.featureIndex])continue;const q=[new a.P(W.x1,W.y1),new a.P(W.x2,W.y1),new a.P(W.x2,W.y2),new a.P(W.x1,W.y2)];a.az(d,q)&&(F[G.bucketInstanceId][G.featureIndex]=!0,U[G.bucketInstanceId]===void 0&&(U[G.bucketInstanceId]=[]),U[G.bucketInstanceId].push(G.featureIndex))}return U}insertCollisionBox(n,d,m,y,x,S){(m?this.ignoredGrid:this.grid).insert({bucketInstanceId:y,featureIndex:x,collisionGroupID:S,overlapMode:d},n[0],n[1],n[2],n[3])}insertCollisionCircles(n,d,m,y,x,S){const I=m?this.ignoredGrid:this.grid,B={bucketInstanceId:y,featureIndex:x,collisionGroupID:S,overlapMode:d};for(let F=0;F<n.length;F+=4)I.insertCircle(B,n[F],n[F+1],n[F+2])}projectAndGetPerspectiveRatio(n,d,m,y,x){if(x){let S;y?(S=[n,d,y(n,d),1],a.aw(S,S,x)):(S=[n,d,0,1],Wa(S,S,x));const I=S[3];return{x:(S[0]/I+1)/2*this.transform.width+br,y:(-S[1]/I+1)/2*this.transform.height+br,perspectiveRatio:.5+this.transform.cameraToCenterDistance/I*.5,isOccluded:!1,signedDistanceFromCamera:I}}{const S=this.transform.projectTileCoordinates(n,d,m,y);return{x:(S.point.x+1)/2*this.transform.width+br,y:(1-S.point.y)/2*this.transform.height+br,perspectiveRatio:.5+this.transform.cameraToCenterDistance/S.signedDistanceFromCamera*.5,isOccluded:S.isOccluded,signedDistanceFromCamera:S.signedDistanceFromCamera}}}getPerspectiveRatio(n,d,m,y){const x=this.transform.projectTileCoordinates(n,d,m,y);return .5+this.transform.cameraToCenterDistance/x.signedDistanceFromCamera*.5}isOffscreen(n,d,m,y){return m<br||n>=this.screenRightBoundary||y<br||d>this.screenBottomBoundary}isInsideGrid(n,d,m,y){return m>=0&&n<this.gridRightBoundary&&y>=0&&d<this.gridBottomBoundary}getViewportMatrix(){const n=a.ag([]);return a.M(n,n,[-100,-100,0]),n}_projectCollisionBox(n,d,m,y,x,S,I,B,F,U,W){let G=1,q=0,J=0,le=1;const de=n.anchorPointX+I[0],pe=n.anchorPointY+I[1];if(S&&!x){const Et=this.projectAndGetPerspectiveRatio(de+1,pe,y,F,W),ut=Et.x-B.x,Ut=Math.atan((Et.y-B.y)/ut)+(ut<0?Math.PI:0),Ar=Math.sin(Ut),Ur=Math.cos(Ut);G=Ur,q=Ar,J=-Ar,le=Ur}else if(!S&&x){const Et=Pr(this.transform);G=Et.vecEast[0],q=Et.vecEast[1],J=Et.vecSouth[0],le=Et.vecSouth[1]}let ge=B.x,xe=B.y,_e=d;x&&(ge=de,xe=pe,_e=Math.pow(2,-(this.transform.zoom-m.overscaledZ)),_e*=this.transform.getPitchedTextCorrection(de,pe,y),U||(_e*=a.ah(.5+B.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),U&&(ge+=G*U.x*_e+J*U.y*_e,xe+=q*U.x*_e+le*U.y*_e);const Te=n.x1*_e,Pe=n.x2*_e,ve=(Te+Pe)/2,Re=n.y1*_e,$e=n.y2*_e,We=(Re+$e)/2,qe=[{offsetX:Te,offsetY:Re},{offsetX:ve,offsetY:Re},{offsetX:Pe,offsetY:Re},{offsetX:Pe,offsetY:We},{offsetX:Pe,offsetY:$e},{offsetX:ve,offsetY:$e},{offsetX:Te,offsetY:$e},{offsetX:Te,offsetY:We}];let Qe=[];for(const{offsetX:Et,offsetY:ut}of qe)Qe.push(new a.P(ge+G*Et+J*ut,xe+q*Et+le*ut));let bt=!1;if(x){const Et=Qe.map((ut=>this.projectAndGetPerspectiveRatio(ut.x,ut.y,y,F,W)));bt=Et.some((ut=>!ut.isOccluded)),Qe=Et.map((ut=>new a.P(ut.x,ut.y)))}else bt=!0;return{box:a.aA(Qe),allPointsOccluded:!bt}}}class Mi{constructor(n,d,m,y){this.opacity=n?Math.max(0,Math.min(1,n.opacity+(n.placed?d:-d))):y&&m?1:0,this.placed=m}isHidden(){return this.opacity===0&&!this.placed}}class Dr{constructor(n,d,m,y,x){this.text=new Mi(n?n.text:null,d,m,x),this.icon=new Mi(n?n.icon:null,d,y,x)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Qn{constructor(n,d,m){this.text=n,this.icon=d,this.skipFade=m}}class xo{constructor(n,d,m,y,x){this.bucketInstanceId=n,this.featureIndex=d,this.sourceLayerIndex=m,this.bucketIndex=y,this.tileID=x}}class es{constructor(n){this.crossSourceCollisions=n,this.maxGroupID=0,this.collisionGroups={}}get(n){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[n]){const d=++this.maxGroupID;this.collisionGroups[n]={ID:d,predicate:m=>m.collisionGroupID===d}}return this.collisionGroups[n]}}function Wi(b,n,d,m,y){const{horizontalAlign:x,verticalAlign:S}=a.aH(b);return new a.P(-(x-.5)*n+m[0]*y,-(S-.5)*d+m[1]*y)}class en{constructor(n,d,m,y,x){this.transform=n.clone(),this.terrain=d,this.collisionIndex=new Pn(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=m,this.retainedQueryData={},this.collisionGroups=new es(y),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=x,x&&(x.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(n){const d=this.terrain;return d?(m,y)=>d.getElevation(n,m,y):null}getBucketParts(n,d,m,y){const x=m.getBucket(d),S=m.latestFeatureIndex;if(!x||!S||d.id!==x.layerIds[0])return;const I=m.collisionBoxArray,B=x.layers[0].layout,F=x.layers[0].paint,U=Math.pow(2,this.transform.zoom-m.tileID.overscaledZ),W=m.tileSize/a.$,G=m.tileID.toUnwrapped(),q=B.get("text-rotation-alignment")==="map",J=a.aC(m,1,this.transform.zoom),le=a.aD(this.collisionIndex.transform,m,F.get("text-translate"),F.get("text-translate-anchor")),de=a.aD(this.collisionIndex.transform,m,F.get("icon-translate"),F.get("icon-translate-anchor")),pe=ui(q,this.transform,J);this.retainedQueryData[x.bucketInstanceId]=new xo(x.bucketInstanceId,S,x.sourceLayerIndex,x.index,m.tileID);const ge={bucket:x,layout:B,translationText:le,translationIcon:de,unwrappedTileID:G,pitchedLabelPlaneMatrix:pe,scale:U,textPixelRatio:W,holdingForFade:m.holdingForFade(),collisionBoxArray:I,partiallyEvaluatedTextSize:a.an(x.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(x.sourceID)};if(y)for(const xe of x.sortKeyRanges){const{sortKey:_e,symbolInstanceStart:Te,symbolInstanceEnd:Pe}=xe;n.push({sortKey:_e,symbolInstanceStart:Te,symbolInstanceEnd:Pe,parameters:ge})}else n.push({symbolInstanceStart:0,symbolInstanceEnd:x.symbolInstances.length,parameters:ge})}attemptAnchorPlacement(n,d,m,y,x,S,I,B,F,U,W,G,q,J,le,de,pe,ge,xe,_e){const Te=a.aE[n.textAnchor],Pe=[n.textOffset0,n.textOffset1],ve=Wi(Te,m,y,Pe,x),Re=this.collisionIndex.placeCollisionBox(d,G,B,F,U,I,S,de,W.predicate,xe,ve,_e);if((!ge||this.collisionIndex.placeCollisionBox(ge,G,B,F,U,I,S,pe,W.predicate,xe,ve,_e).placeable)&&Re.placeable){let $e;if(this.prevPlacement&&this.prevPlacement.variableOffsets[q.crossTileID]&&this.prevPlacement.placements[q.crossTileID]&&this.prevPlacement.placements[q.crossTileID].text&&($e=this.prevPlacement.variableOffsets[q.crossTileID].anchor),q.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[q.crossTileID]={textOffset:Pe,width:m,height:y,anchor:Te,textBoxScale:x,prevAnchor:$e},this.markUsedJustification(J,Te,q,le),J.allowVerticalPlacement&&(this.markUsedOrientation(J,le,q),this.placedOrientations[q.crossTileID]=le),{shift:ve,placedGlyphBoxes:Re}}}placeLayerBucketPart(n,d,m){const{bucket:y,layout:x,translationText:S,translationIcon:I,unwrappedTileID:B,pitchedLabelPlaneMatrix:F,textPixelRatio:U,holdingForFade:W,collisionBoxArray:G,partiallyEvaluatedTextSize:q,collisionGroup:J}=n.parameters,le=x.get("text-optional"),de=x.get("icon-optional"),pe=a.aF(x,"text-overlap","text-allow-overlap"),ge=pe==="always",xe=a.aF(x,"icon-overlap","icon-allow-overlap"),_e=xe==="always",Te=x.get("text-rotation-alignment")==="map",Pe=x.get("text-pitch-alignment")==="map",ve=x.get("icon-text-fit")!=="none",Re=x.get("symbol-z-order")==="viewport-y",$e=ge&&(_e||!y.hasIconData()||de),We=_e&&(ge||!y.hasTextData()||le);!y.collisionArrays&&G&&y.deserializeCollisionBoxes(G);const qe=this.retainedQueryData[y.bucketInstanceId].tileID,Qe=this._getTerrainElevationFunc(qe),bt=this.transform.getFastPathSimpleProjectionMatrix(qe),Et=(ut,Ut,Ar)=>{var Ur,ei;if(d[ut.crossTileID])return;if(W)return void(this.placements[ut.crossTileID]=new Qn(!1,!1,!1));let Xr=!1,ai=!1,wi=!0,yr=null,Hr={box:null,placeable:!1,offscreen:null,occluded:!1},Zi={placeable:!1},tn=null,dn=null,as=null,oo=0,Pa=0,ea=0;Ut.textFeatureIndex?oo=Ut.textFeatureIndex:ut.useRuntimeCollisionCircles&&(oo=ut.featureIndex),Ut.verticalTextFeatureIndex&&(Pa=Ut.verticalTextFeatureIndex);const Vl=Ut.textBox;if(Vl){const ls=Xi=>{let rn=a.ao.horizontal;if(y.allowVerticalPlacement&&!Xi&&this.prevPlacement){const us=this.prevPlacement.placedOrientations[ut.crossTileID];us&&(this.placedOrientations[ut.crossTileID]=us,rn=us,this.markUsedOrientation(y,rn,ut))}return rn},Lo=(Xi,rn)=>{if(y.allowVerticalPlacement&&ut.numVerticalGlyphVertices>0&&Ut.verticalTextBox){for(const us of y.writingModes)if(us===a.ao.vertical?(Hr=rn(),Zi=Hr):Hr=Xi(),Hr&&Hr.placeable)break}else Hr=Xi()},cs=ut.textAnchorOffsetStartIndex,Ra=ut.textAnchorOffsetEndIndex;if(Ra===cs){const Xi=(rn,us)=>{const nn=this.collisionIndex.placeCollisionBox(rn,pe,U,qe,B,Pe,Te,S,J.predicate,Qe,void 0,bt);return nn&&nn.placeable&&(this.markUsedOrientation(y,us,ut),this.placedOrientations[ut.crossTileID]=us),nn};Lo((()=>Xi(Vl,a.ao.horizontal)),(()=>{const rn=Ut.verticalTextBox;return y.allowVerticalPlacement&&ut.numVerticalGlyphVertices>0&&rn?Xi(rn,a.ao.vertical):{box:null,offscreen:null}})),ls(Hr&&Hr.placeable)}else{let Xi=a.aE[(ei=(Ur=this.prevPlacement)===null||Ur===void 0?void 0:Ur.variableOffsets[ut.crossTileID])===null||ei===void 0?void 0:ei.anchor];const rn=(nn,Ou,Vc)=>{const pn=nn.x2-nn.x1,qs=nn.y2-nn.y1,Do=ut.textBoxScale,Yd=ve&&xe==="never"?Ou:null;let Ps=null,Jd=pe==="never"?1:2,Fu="never";Xi&&Jd++;for(let Ia=0;Ia<Jd;Ia++){for(let Gc=cs;Gc<Ra;Gc++){const ta=y.textAnchorOffsets.get(Gc);if(Xi&&ta.textAnchor!==Xi)continue;const ka=this.attemptAnchorPlacement(ta,nn,pn,qs,Do,Te,Pe,U,qe,B,J,Fu,ut,y,Vc,S,I,Yd,Qe);if(ka&&(Ps=ka.placedGlyphBoxes,Ps&&Ps.placeable))return Xr=!0,yr=ka.shift,Ps}Xi?Xi=null:Fu=pe}return m&&!Ps&&(Ps={box:this.collisionIndex.placeCollisionBox(Vl,"always",U,qe,B,Pe,Te,S,J.predicate,Qe,void 0,bt).box,offscreen:!1,placeable:!1,occluded:!1}),Ps};Lo((()=>rn(Vl,Ut.iconBox,a.ao.horizontal)),(()=>{const nn=Ut.verticalTextBox;return y.allowVerticalPlacement&&(!Hr||!Hr.placeable)&&ut.numVerticalGlyphVertices>0&&nn?rn(nn,Ut.verticalIconBox,a.ao.vertical):{box:null,occluded:!0,offscreen:null}})),Hr&&(Xr=Hr.placeable,wi=Hr.offscreen);const us=ls(Hr&&Hr.placeable);if(!Xr&&this.prevPlacement){const nn=this.prevPlacement.variableOffsets[ut.crossTileID];nn&&(this.variableOffsets[ut.crossTileID]=nn,this.markUsedJustification(y,nn.anchor,ut,us))}}}if(tn=Hr,Xr=tn&&tn.placeable,wi=tn&&tn.offscreen,ut.useRuntimeCollisionCircles){const ls=y.text.placedSymbolArray.get(ut.centerJustifiedTextSymbolIndex),Lo=a.ap(y.textSizeData,q,ls),cs=x.get("text-padding");dn=this.collisionIndex.placeCollisionCircles(pe,ls,y.lineVertexArray,y.glyphOffsetArray,Lo,B,F,m,Pe,J.predicate,ut.collisionCircleDiameter,cs,S,Qe),dn.circles.length&&dn.collisionDetected&&!m&&a.w("Collisions detected, but collision boxes are not shown"),Xr=ge||dn.circles.length>0&&!dn.collisionDetected,wi=wi&&dn.offscreen}if(Ut.iconFeatureIndex&&(ea=Ut.iconFeatureIndex),Ut.iconBox){const ls=Lo=>this.collisionIndex.placeCollisionBox(Lo,xe,U,qe,B,Pe,Te,I,J.predicate,Qe,ve&&yr?yr:void 0,bt);Zi&&Zi.placeable&&Ut.verticalIconBox?(as=ls(Ut.verticalIconBox),ai=as.placeable):(as=ls(Ut.iconBox),ai=as.placeable),wi=wi&&as.offscreen}const Gl=le||ut.numHorizontalGlyphVertices===0&&ut.numVerticalGlyphVertices===0,dl=de||ut.numIconVertices===0;Gl||dl?dl?Gl||(ai=ai&&Xr):Xr=ai&&Xr:ai=Xr=ai&&Xr;const Hl=ai&&as.placeable;if(Xr&&tn.placeable&&this.collisionIndex.insertCollisionBox(tn.box,pe,x.get("text-ignore-placement"),y.bucketInstanceId,Zi&&Zi.placeable&&Pa?Pa:oo,J.ID),Hl&&this.collisionIndex.insertCollisionBox(as.box,xe,x.get("icon-ignore-placement"),y.bucketInstanceId,ea,J.ID),dn&&Xr&&this.collisionIndex.insertCollisionCircles(dn.circles,pe,x.get("text-ignore-placement"),y.bucketInstanceId,oo,J.ID),m&&this.storeCollisionData(y.bucketInstanceId,Ar,Ut,tn,as,dn),ut.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(y.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[ut.crossTileID]=new Qn((Xr||$e)&&!tn?.occluded,(ai||We)&&!as?.occluded,wi||y.justReloaded),d[ut.crossTileID]=!0};if(Re){if(n.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const ut=y.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let Ut=ut.length-1;Ut>=0;--Ut){const Ar=ut[Ut];Et(y.symbolInstances.get(Ar),y.collisionArrays[Ar],Ar)}}else for(let ut=n.symbolInstanceStart;ut<n.symbolInstanceEnd;ut++)Et(y.symbolInstances.get(ut),y.collisionArrays[ut],ut);y.justReloaded=!1}storeCollisionData(n,d,m,y,x,S){if(m.textBox||m.iconBox){let I,B;this.collisionBoxArrays.has(n)?I=this.collisionBoxArrays.get(n):(I=new Map,this.collisionBoxArrays.set(n,I)),I.has(d)?B=I.get(d):(B={text:null,icon:null},I.set(d,B)),m.textBox&&(B.text=y.box),m.iconBox&&(B.icon=x.box)}if(S){let I=this.collisionCircleArrays[n];I===void 0&&(I=this.collisionCircleArrays[n]=[]);for(let B=0;B<S.circles.length;B+=4)I.push(S.circles[B+0]-br),I.push(S.circles[B+1]-br),I.push(S.circles[B+2]),I.push(S.collisionDetected?1:0)}}markUsedJustification(n,d,m,y){let x;x=y===a.ao.vertical?m.verticalPlacedTextSymbolIndex:{left:m.leftJustifiedTextSymbolIndex,center:m.centerJustifiedTextSymbolIndex,right:m.rightJustifiedTextSymbolIndex}[a.aG(d)];const S=[m.leftJustifiedTextSymbolIndex,m.centerJustifiedTextSymbolIndex,m.rightJustifiedTextSymbolIndex,m.verticalPlacedTextSymbolIndex];for(const I of S)I>=0&&(n.text.placedSymbolArray.get(I).crossTileID=x>=0&&I!==x?0:m.crossTileID)}markUsedOrientation(n,d,m){const y=d===a.ao.horizontal||d===a.ao.horizontalOnly?d:0,x=d===a.ao.vertical?d:0,S=[m.leftJustifiedTextSymbolIndex,m.centerJustifiedTextSymbolIndex,m.rightJustifiedTextSymbolIndex];for(const I of S)n.text.placedSymbolArray.get(I).placedOrientation=y;m.verticalPlacedTextSymbolIndex&&(n.text.placedSymbolArray.get(m.verticalPlacedTextSymbolIndex).placedOrientation=x)}commit(n){this.commitTime=n,this.zoomAtLastRecencyCheck=this.transform.zoom;const d=this.prevPlacement;let m=!1;this.prevZoomAdjustment=d?d.zoomAdjustment(this.transform.zoom):0;const y=d?d.symbolFadeChange(n):1,x=d?d.opacities:{},S=d?d.variableOffsets:{},I=d?d.placedOrientations:{};for(const B in this.placements){const F=this.placements[B],U=x[B];U?(this.opacities[B]=new Dr(U,y,F.text,F.icon),m=m||F.text!==U.text.placed||F.icon!==U.icon.placed):(this.opacities[B]=new Dr(null,y,F.text,F.icon,F.skipFade),m=m||F.text||F.icon)}for(const B in x){const F=x[B];if(!this.opacities[B]){const U=new Dr(F,y,!1,!1);U.isHidden()||(this.opacities[B]=U,m=m||F.text.placed||F.icon.placed)}}for(const B in S)this.variableOffsets[B]||!this.opacities[B]||this.opacities[B].isHidden()||(this.variableOffsets[B]=S[B]);for(const B in I)this.placedOrientations[B]||!this.opacities[B]||this.opacities[B].isHidden()||(this.placedOrientations[B]=I[B]);if(d&&d.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");m?this.lastPlacementChangeTime=n:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=d?d.lastPlacementChangeTime:n)}updateLayerOpacities(n,d){const m={};for(const y of d){const x=y.getBucket(n);x&&y.latestFeatureIndex&&n.id===x.layerIds[0]&&this.updateBucketOpacities(x,y.tileID,m,y.collisionBoxArray)}}updateBucketOpacities(n,d,m,y){n.hasTextData()&&(n.text.opacityVertexArray.clear(),n.text.hasVisibleVertices=!1),n.hasIconData()&&(n.icon.opacityVertexArray.clear(),n.icon.hasVisibleVertices=!1),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexArray.clear(),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexArray.clear();const x=n.layers[0],S=x.layout,I=new Dr(null,0,!1,!1,!0),B=S.get("text-allow-overlap"),F=S.get("icon-allow-overlap"),U=x._unevaluatedLayout.hasValue("text-variable-anchor")||x._unevaluatedLayout.hasValue("text-variable-anchor-offset"),W=S.get("text-rotation-alignment")==="map",G=S.get("text-pitch-alignment")==="map",q=S.get("icon-text-fit")!=="none",J=new Dr(null,0,B&&(F||!n.hasIconData()||S.get("icon-optional")),F&&(B||!n.hasTextData()||S.get("text-optional")),!0);!n.collisionArrays&&y&&(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData())&&n.deserializeCollisionBoxes(y);const le=(pe,ge,xe)=>{for(let _e=0;_e<ge/4;_e++)pe.opacityVertexArray.emplaceBack(xe);pe.hasVisibleVertices=pe.hasVisibleVertices||xe!==ts},de=this.collisionBoxArrays.get(n.bucketInstanceId);for(let pe=0;pe<n.symbolInstances.length;pe++){const ge=n.symbolInstances.get(pe),{numHorizontalGlyphVertices:xe,numVerticalGlyphVertices:_e,crossTileID:Te}=ge;let Pe=this.opacities[Te];m[Te]?Pe=I:Pe||(Pe=J,this.opacities[Te]=Pe),m[Te]=!0;const ve=ge.numIconVertices>0,Re=this.placedOrientations[ge.crossTileID],$e=Re===a.ao.vertical,We=Re===a.ao.horizontal||Re===a.ao.horizontalOnly;if(xe>0||_e>0){const Qe=Eo(Pe.text);le(n.text,xe,$e?ts:Qe),le(n.text,_e,We?ts:Qe);const bt=Pe.text.isHidden();[ge.rightJustifiedTextSymbolIndex,ge.centerJustifiedTextSymbolIndex,ge.leftJustifiedTextSymbolIndex].forEach((Ut=>{Ut>=0&&(n.text.placedSymbolArray.get(Ut).hidden=bt||$e?1:0)})),ge.verticalPlacedTextSymbolIndex>=0&&(n.text.placedSymbolArray.get(ge.verticalPlacedTextSymbolIndex).hidden=bt||We?1:0);const Et=this.variableOffsets[ge.crossTileID];Et&&this.markUsedJustification(n,Et.anchor,ge,Re);const ut=this.placedOrientations[ge.crossTileID];ut&&(this.markUsedJustification(n,"left",ge,ut),this.markUsedOrientation(n,ut,ge))}if(ve){const Qe=Eo(Pe.icon),bt=!(q&&ge.verticalPlacedIconSymbolIndex&&$e);ge.placedIconSymbolIndex>=0&&(le(n.icon,ge.numIconVertices,bt?Qe:ts),n.icon.placedSymbolArray.get(ge.placedIconSymbolIndex).hidden=Pe.icon.isHidden()),ge.verticalPlacedIconSymbolIndex>=0&&(le(n.icon,ge.numVerticalIconVertices,bt?ts:Qe),n.icon.placedSymbolArray.get(ge.verticalPlacedIconSymbolIndex).hidden=Pe.icon.isHidden())}const qe=de&&de.has(pe)?de.get(pe):{text:null,icon:null};if(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData()){const Qe=n.collisionArrays[pe];if(Qe){let bt=new a.P(0,0);if(Qe.textBox||Qe.verticalTextBox){let Et=!0;if(U){const ut=this.variableOffsets[Te];ut?(bt=Wi(ut.anchor,ut.width,ut.height,ut.textOffset,ut.textBoxScale),W&&bt._rotate(G?-this.transform.bearingInRadians:this.transform.bearingInRadians)):Et=!1}if(Qe.textBox||Qe.verticalTextBox){let ut;Qe.textBox&&(ut=$e),Qe.verticalTextBox&&(ut=We),fc(n.textCollisionBox.collisionVertexArray,Pe.text.placed,!Et||ut,qe.text,bt.x,bt.y)}}if(Qe.iconBox||Qe.verticalIconBox){const Et=!!(!We&&Qe.verticalIconBox);let ut;Qe.iconBox&&(ut=Et),Qe.verticalIconBox&&(ut=!Et),fc(n.iconCollisionBox.collisionVertexArray,Pe.icon.placed,ut,qe.icon,q?bt.x:0,q?bt.y:0)}}}}if(n.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[n.bucketInstanceId]&&(this.retainedQueryData[n.bucketInstanceId].featureSortOrder=n.featureSortOrder),n.hasTextData()&&n.text.opacityVertexBuffer&&n.text.opacityVertexBuffer.updateData(n.text.opacityVertexArray),n.hasIconData()&&n.icon.opacityVertexBuffer&&n.icon.opacityVertexBuffer.updateData(n.icon.opacityVertexArray),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexBuffer&&n.iconCollisionBox.collisionVertexBuffer.updateData(n.iconCollisionBox.collisionVertexArray),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexBuffer&&n.textCollisionBox.collisionVertexBuffer.updateData(n.textCollisionBox.collisionVertexArray),n.text.opacityVertexArray.length!==n.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${n.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${n.text.layoutVertexArray.length}) / 4`);if(n.icon.opacityVertexArray.length!==n.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${n.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${n.icon.layoutVertexArray.length}) / 4`);n.bucketInstanceId in this.collisionCircleArrays&&(n.collisionCircleArray=this.collisionCircleArrays[n.bucketInstanceId],delete this.collisionCircleArrays[n.bucketInstanceId])}symbolFadeChange(n){return this.fadeDuration===0?1:(n-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(n){return Math.max(0,(this.transform.zoom-n)/1.5)}hasTransitions(n){return this.stale||n-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(n,d){const m=this.zoomAtLastRecencyCheck===d?1-this.zoomAdjustment(d):1;return this.zoomAtLastRecencyCheck=d,this.commitTime+this.fadeDuration*m>n}setStale(){this.stale=!0}}function fc(b,n,d,m,y,x){m&&m.length!==0||(m=[0,0,0,0]);const S=m[0]-br,I=m[1]-br,B=m[2]-br,F=m[3]-br;b.emplaceBack(n?1:0,d?1:0,y||0,x||0,S,I),b.emplaceBack(n?1:0,d?1:0,y||0,x||0,B,I),b.emplaceBack(n?1:0,d?1:0,y||0,x||0,B,F),b.emplaceBack(n?1:0,d?1:0,y||0,x||0,S,F)}const Rn=Math.pow(2,25),ws=Math.pow(2,24),wo=Math.pow(2,17),mc=Math.pow(2,16),qa=Math.pow(2,9),$a=Math.pow(2,8),da=Math.pow(2,1);function Eo(b){if(b.opacity===0&&!b.placed)return 0;if(b.opacity===1&&b.placed)return 4294967295;const n=b.placed?1:0,d=Math.floor(127*b.opacity);return d*Rn+n*ws+d*wo+n*mc+d*qa+n*$a+d*da+n}const ts=0;class du{constructor(n){this._sortAcrossTiles=n.layout.get("symbol-z-order")!=="viewport-y"&&!n.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(n,d,m,y,x){const S=this._bucketParts;for(;this._currentTileIndex<n.length;)if(d.getBucketParts(S,y,n[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,x())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,S.sort(((I,B)=>I.sortKey-B.sortKey)));this._currentPartIndex<S.length;)if(d.placeLayerBucketPart(S[this._currentPartIndex],this._seenCrossTileIDs,m),this._currentPartIndex++,x())return!0;return!1}}class Za{constructor(n,d,m,y,x,S,I,B){this.placement=new en(n,d,S,I,B),this._currentPlacementIndex=m.length-1,this._forceFullPlacement=y,this._showCollisionBoxes=x,this._done=!1}isDone(){return this._done}continuePlacement(n,d,m){const y=L.now(),x=()=>!this._forceFullPlacement&&L.now()-y>2;for(;this._currentPlacementIndex>=0;){const S=d[n[this._currentPlacementIndex]],I=this.placement.collisionIndex.transform.zoom;if(S.type==="symbol"&&(!S.minzoom||S.minzoom<=I)&&(!S.maxzoom||S.maxzoom>I)){if(this._inProgressLayer||(this._inProgressLayer=new du(S)),this._inProgressLayer.continuePlacement(m[S.source],this.placement,this._showCollisionBoxes,S,x))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(n){return this.placement.commit(n),this.placement}}const Ao=512/a.$/2;class Xa{constructor(n,d,m){this.tileID=n,this.bucketInstanceId=m,this._symbolsByKey={};const y=new Map;for(let x=0;x<d.length;x++){const S=d.get(x),I=S.key,B=y.get(I);B?B.push(S):y.set(I,[S])}for(const[x,S]of y){const I={positions:S.map((B=>({x:Math.floor(B.anchorX*Ao),y:Math.floor(B.anchorY*Ao)}))),crossTileIDs:S.map((B=>B.crossTileID))};if(I.positions.length>128){const B=new a.aI(I.positions.length,16,Uint16Array);for(const{x:F,y:U}of I.positions)B.add(F,U);B.finish(),delete I.positions,I.index=B}this._symbolsByKey[x]=I}}getScaledCoordinates(n,d){const{x:m,y,z:x}=this.tileID.canonical,{x:S,y:I,z:B}=d.canonical,F=Ao/Math.pow(2,B-x),U=(I*a.$+n.anchorY)*F,W=y*a.$*Ao;return{x:Math.floor((S*a.$+n.anchorX)*F-m*a.$*Ao),y:Math.floor(U-W)}}findMatches(n,d,m){const y=this.tileID.canonical.z<d.canonical.z?1:Math.pow(2,this.tileID.canonical.z-d.canonical.z);for(let x=0;x<n.length;x++){const S=n.get(x);if(S.crossTileID)continue;const I=this._symbolsByKey[S.key];if(!I)continue;const B=this.getScaledCoordinates(S,d);if(I.index){const F=I.index.range(B.x-y,B.y-y,B.x+y,B.y+y).sort();for(const U of F){const W=I.crossTileIDs[U];if(!m[W]){m[W]=!0,S.crossTileID=W;break}}}else if(I.positions)for(let F=0;F<I.positions.length;F++){const U=I.positions[F],W=I.crossTileIDs[F];if(Math.abs(U.x-B.x)<=y&&Math.abs(U.y-B.y)<=y&&!m[W]){m[W]=!0,S.crossTileID=W;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map((({crossTileIDs:n})=>n))}}class pa{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class vd{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(n){const d=Math.round((n-this.lng)/360);if(d!==0)for(const m in this.indexes){const y=this.indexes[m],x={};for(const S in y){const I=y[S];I.tileID=I.tileID.unwrapTo(I.tileID.wrap+d),x[I.tileID.key]=I}this.indexes[m]=x}this.lng=n}addBucket(n,d,m){if(this.indexes[n.overscaledZ]&&this.indexes[n.overscaledZ][n.key]){if(this.indexes[n.overscaledZ][n.key].bucketInstanceId===d.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(n.overscaledZ,this.indexes[n.overscaledZ][n.key])}for(let x=0;x<d.symbolInstances.length;x++)d.symbolInstances.get(x).crossTileID=0;this.usedCrossTileIDs[n.overscaledZ]||(this.usedCrossTileIDs[n.overscaledZ]={});const y=this.usedCrossTileIDs[n.overscaledZ];for(const x in this.indexes){const S=this.indexes[x];if(Number(x)>n.overscaledZ)for(const I in S){const B=S[I];B.tileID.isChildOf(n)&&B.findMatches(d.symbolInstances,n,y)}else{const I=S[n.scaledTo(Number(x)).key];I&&I.findMatches(d.symbolInstances,n,y)}}for(let x=0;x<d.symbolInstances.length;x++){const S=d.symbolInstances.get(x);S.crossTileID||(S.crossTileID=m.generate(),y[S.crossTileID]=!0)}return this.indexes[n.overscaledZ]===void 0&&(this.indexes[n.overscaledZ]={}),this.indexes[n.overscaledZ][n.key]=new Xa(n,d.symbolInstances,d.bucketInstanceId),!0}removeBucketCrossTileIDs(n,d){for(const m of d.getCrossTileIDsLists())for(const y of m)delete this.usedCrossTileIDs[n][y]}removeStaleBuckets(n){let d=!1;for(const m in this.indexes){const y=this.indexes[m];for(const x in y)n[y[x].bucketInstanceId]||(this.removeBucketCrossTileIDs(m,y[x]),delete y[x],d=!0)}return d}}class ie{constructor(){this.layerIndexes={},this.crossTileIDs=new pa,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(n,d,m){let y=this.layerIndexes[n.id];y===void 0&&(y=this.layerIndexes[n.id]=new vd);let x=!1;const S={};y.handleWrapJump(m);for(const I of d){const B=I.getBucket(n);B&&n.id===B.layerIds[0]&&(B.bucketInstanceId||(B.bucketInstanceId=++this.maxBucketInstanceId),y.addBucket(I.tileID,B,this.crossTileIDs)&&(x=!0),S[B.bucketInstanceId]=!0)}return y.removeStaleBuckets(S)&&(x=!0),x}pruneUnusedLayers(n){const d={};n.forEach((m=>{d[m]=!0}));for(const m in this.layerIndexes)d[m]||delete this.layerIndexes[m]}}var ce="void main() {fragColor=vec4(1.0);}";const Ce={prelude:He(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
out highp vec4 fragColor;`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c
);}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
#ifdef GLOBE
if ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}
#endif
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;`),projectionMercator:He("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:He("",`#define GLOBE_RADIUS 6371008.8
uniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos
);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); 
if (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len
);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}`),background:He(`uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:He(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:He(`in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {
#ifdef GLOBE
vec3 center_vector=projectToSphere(circle_center);
#endif
float angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {
#ifdef GLOBE
vec4 projected_center=interpolateProjection(circle_center,center_vector,ele);
#else
vec4 projected_center=projectTileWithElevation(circle_center,ele);
#endif
corner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}
#ifdef GLOBE
vec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);
#else
gl_Position=projectTileWithElevation(corner_position,ele);
#endif
} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:He(ce,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:He(`uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);
#ifdef GLOBE
vec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);
#else
gl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));
#endif
}`),heatmapTexture:He(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:He("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:He("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),colorRelief:He(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;uniform vec4 u_unpack;uniform sampler2D u_elevation_stops;uniform sampler2D u_color_stops;uniform int u_color_ramp_size;uniform float u_opacity;in vec2 v_pos;float getElevation(vec2 coord) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}float getElevationStop(int stop) {float x=(float(stop)+0.5)/float(u_color_ramp_size);vec4 data=texture(u_elevation_stops,vec2(x,0))*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {float el=getElevation(v_pos);int r=(u_color_ramp_size-1);int l=0;float el_l=getElevationStop(l);float el_r=getElevationStop(r);while(r-l > 1){int m=(r+l)/2;float el_m=getElevationStop(m);if(el < el_m){r=m;el_r=el_m;}else
{l=m;el_l=el_m;}}float x=(float(l)+(el-el_l)/(el_r-el_l)+0.5)/float(u_color_ramp_size);fragColor=u_opacity*texture(u_color_stops,vec2(x,0));
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_dimension;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_pos/8192.0)*scale+epsilon;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),debug:He("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:He(ce,`in vec2 a_pos;void main() {
#ifdef GLOBE
gl_Position=projectTileFor3D(a_pos,0.0);
#else
gl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);
#endif
}`),fill:He(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
fragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_fill_translate;in vec2 a_pos;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);}`),fillOutline:He(`in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillOutlinePattern:He(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillPattern:He(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:He(`in vec4 v_color;void main() {fragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
out vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);
#ifdef GLOBE
mat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);
#endif
directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:He(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
#ifdef GLOBE
out vec3 v_sphere_pos;
#endif
out vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:He(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {vec2 epsilon=1.0/u_dimension;float tileSize=u_dimension.x-2.0;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))*tileSize/pow(2.0,exaggeration+(28.2562-u_zoom));fragColor=clamp(vec4(deriv.x/8.0+0.5,deriv.y/8.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:He(`uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform float u_exaggeration;uniform vec4 u_accent;uniform int u_method;uniform float u_altitudes[NUM_ILLUMINATION_SOURCES];uniform float u_azimuths[NUM_ILLUMINATION_SOURCES];uniform vec4 u_shadows[NUM_ILLUMINATION_SOURCES];uniform vec4 u_highlights[NUM_ILLUMINATION_SOURCES];
#define PI 3.141592653589793
#define STANDARD 0
#define COMBINED 1
#define IGOR 2
#define MULTIDIRECTIONAL 3
#define BASIC 4
float get_aspect(vec2 deriv){return deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);}void igor_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float aspect=get_aspect(deriv);float azimuth=u_azimuths[0]+PI;float slope_stength=atan(length(deriv))*2.0/PI;float aspect_strength=1.0-abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);float shadow_strength=slope_stength*aspect_strength;float highlight_strength=slope_stength*(1.0-aspect_strength);fragColor=u_shadows[0]*shadow_strength+u_highlights[0]*highlight_strength;}void standard_hillshade(vec2 deriv){float azimuth=u_azimuths[0]+PI;float slope=atan(0.625*length(deriv));float aspect=get_aspect(deriv);float intensity=u_exaggeration;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadows[0],u_highlights[0],shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;}void basic_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor=u_highlights[0]*(2.0*shade-1.0);}else
{fragColor=u_shadows[0]*(1.0-2.0*shade);}}void multidirectional_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;fragColor=vec4(0,0,0,0);for(int i=0; i < NUM_ILLUMINATION_SOURCES; i++){float cos_alt=cos(u_altitudes[i]);float sin_alt=sin(u_altitudes[i]);float cos_az=-cos(u_azimuths[i]);float sin_az=-sin(u_azimuths[i]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor+=u_highlights[i]*(2.0*shade-1.0)/float(NUM_ILLUMINATION_SOURCES);}else
{fragColor+=u_shadows[i]*(1.0-2.0*shade)/float(NUM_ILLUMINATION_SOURCES);}}}void combined_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=acos((sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv)));cang=clamp(cang,0.0,PI/2.0);float shade=cang*atan(length(deriv))*4.0/PI/PI;float highlight=(PI/2.0-cang)*atan(length(deriv))*4.0/PI/PI;fragColor=u_shadows[0]*shade+u_highlights[0]*highlight;}void main() {vec4 pixel=texture(u_image,v_pos);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));vec2 deriv=((pixel.rg*8.0)-4.0)/scaleFactor;if (u_method==BASIC) {basic_hillshade(deriv);} else if (u_method==COMBINED) {combined_hillshade(deriv);} else if (u_method==IGOR) {igor_hillshade(deriv);} else if (u_method==MULTIDIRECTIONAL) {multidirectional_hillshade(deriv);} else if (u_method==STANDARD) {standard_hillshade(deriv);} else {standard_hillshade(deriv);}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:He(`uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:He(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:He(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:He(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:He(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;
#ifdef GLOBE
if (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}
#endif
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),symbolIcon:He(`uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:He(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:He(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:He("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:He("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:He("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:He("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:He(`in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758
);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}`,"in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:He("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function He(b,n){const d=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,m=n.match(/in ([\w]+) ([\w]+)/g),y=b.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),x=n.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),S=x?x.concat(y):y,I={};return{fragmentSource:b=b.replace(d,((B,F,U,W,G)=>(I[G]=!0,F==="define"?`
#ifndef HAS_UNIFORM_u_${G}
in ${U} ${W} ${G};
#else
uniform ${U} ${W} u_${G};
#endif
`:`
#ifdef HAS_UNIFORM_u_${G}
    ${U} ${W} ${G} = u_${G};
#endif
`))),vertexSource:n=n.replace(d,((B,F,U,W,G)=>{const q=W==="float"?"vec2":"vec4",J=G.match(/color/)?"color":q;return I[G]?F==="define"?`
#ifndef HAS_UNIFORM_u_${G}
uniform lowp float u_${G}_t;
in ${U} ${q} a_${G};
out ${U} ${W} ${G};
#else
uniform ${U} ${W} u_${G};
#endif
`:J==="vec4"?`
#ifndef HAS_UNIFORM_u_${G}
    ${G} = a_${G};
#else
    ${U} ${W} ${G} = u_${G};
#endif
`:`
#ifndef HAS_UNIFORM_u_${G}
    ${G} = unpack_mix_${J}(a_${G}, u_${G}_t);
#else
    ${U} ${W} ${G} = u_${G};
#endif
`:F==="define"?`
#ifndef HAS_UNIFORM_u_${G}
uniform lowp float u_${G}_t;
in ${U} ${q} a_${G};
#else
uniform ${U} ${W} u_${G};
#endif
`:J==="vec4"?`
#ifndef HAS_UNIFORM_u_${G}
    ${U} ${W} ${G} = a_${G};
#else
    ${U} ${W} ${G} = u_${G};
#endif
`:`
#ifndef HAS_UNIFORM_u_${G}
    ${U} ${W} ${G} = unpack_mix_${J}(a_${G}, u_${G}_t);
#else
    ${U} ${W} ${G} = u_${G};
#endif
`})),staticAttributes:m,staticUniforms:S}}class mt{constructor(n,d,m){this.vertexBuffer=n,this.indexBuffer=d,this.segments=m}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var Xt=a.aJ([{name:"a_pos",type:"Int16",components:2}]);const xr="#define PROJECTION_MERCATOR",Gr="mercator";class ar{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return Gr}get shaderDefine(){return xr}get shaderPreludeCode(){return Ce.projectionMercator}get vertexShaderPreludeCode(){return Ce.projectionMercator.vertexSource}get subdivisionGranularity(){return a.aK.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(n){}getMeshFromTileID(n,d,m,y,x){if(this._cachedMesh)return this._cachedMesh;const S=new a.aL;S.emplaceBack(0,0),S.emplaceBack(a.$,0),S.emplaceBack(0,a.$),S.emplaceBack(a.$,a.$);const I=n.createVertexBuffer(S,Xt.members),B=a.aM.simpleSegment(0,0,4,2),F=new a.aN;F.emplaceBack(1,0,2),F.emplaceBack(1,2,3);const U=n.createIndexBuffer(F);return this._cachedMesh=new mt(I,U,B),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(n){}}class xi{constructor(n=0,d=0,m=0,y=0){if(isNaN(n)||n<0||isNaN(d)||d<0||isNaN(m)||m<0||isNaN(y)||y<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=n,this.bottom=d,this.left=m,this.right=y}interpolate(n,d,m){return d.top!=null&&n.top!=null&&(this.top=a.C.number(n.top,d.top,m)),d.bottom!=null&&n.bottom!=null&&(this.bottom=a.C.number(n.bottom,d.bottom,m)),d.left!=null&&n.left!=null&&(this.left=a.C.number(n.left,d.left,m)),d.right!=null&&n.right!=null&&(this.right=a.C.number(n.right,d.right,m)),this}getCenter(n,d){const m=a.ah((this.left+n-this.right)/2,0,n),y=a.ah((this.top+d-this.bottom)/2,0,d);return new a.P(m,y)}equals(n){return this.top===n.top&&this.bottom===n.bottom&&this.left===n.left&&this.right===n.right}clone(){return new xi(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Oi(b,n){if(!b.renderWorldCopies||b.lngRange)return;const d=n.lng-b.center.lng;n.lng+=d>180?-360:d<-180?360:0}function To(b){return Math.max(0,Math.floor(b))}class Fi{constructor(n,d,m,y,x,S){this._callbacks=n,this._tileSize=512,this._renderWorldCopies=S===void 0||!!S,this._minZoom=d||0,this._maxZoom=m||22,this._minPitch=y??0,this._maxPitch=x??60,this.setMaxBounds(),this._width=0,this._height=0,this._center=new a.S(0,0),this._elevation=0,this._zoom=0,this._tileZoom=To(this._zoom),this._scale=a.af(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new xi,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(n,d,m){this._latRange=n.latRange,this._lngRange=n.lngRange,this._width=n.width,this._height=n.height,this._center=n.center,this._elevation=n.elevation,this._minElevationForCurrentTile=n.minElevationForCurrentTile,this._zoom=n.zoom,this._tileZoom=To(this._zoom),this._scale=a.af(this._zoom),this._bearingInRadians=n.bearingInRadians,this._fovInRadians=n.fovInRadians,this._pitchInRadians=n.pitchInRadians,this._rollInRadians=n.rollInRadians,this._unmodified=n.unmodified,this._edgeInsets=new xi(n.padding.top,n.padding.bottom,n.padding.left,n.padding.right),this._minZoom=n.minZoom,this._maxZoom=n.maxZoom,this._minPitch=n.minPitch,this._maxPitch=n.maxPitch,this._renderWorldCopies=n.renderWorldCopies,this._cameraToCenterDistance=n.cameraToCenterDistance,this._nearZ=n.nearZ,this._farZ=n.farZ,this._autoCalculateNearFarZ=!m&&n.autoCalculateNearFarZ,d&&this._constrain(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(n){this._minElevationForCurrentTile=n}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(n){this._minZoom!==n&&(this._minZoom=n,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(n){this._maxZoom!==n&&(this._maxZoom=n,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(n){this._minPitch!==n&&(this._minPitch=n,this.setPitch(Math.max(this.pitch,n)))}get maxPitch(){return this._maxPitch}setMaxPitch(n){this._maxPitch!==n&&(this._maxPitch=n,this.setPitch(Math.min(this.pitch,n)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(n){n===void 0?n=!0:n===null&&(n=!1),this._renderWorldCopies=n}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new a.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(n){const d=a.aO(n,-180,180)*Math.PI/180;var m,y,x,S,I,B,F,U,W;this._bearingInRadians!==d&&(this._unmodified=!1,this._bearingInRadians=d,this._calcMatrices(),this._rotationMatrix=T(),m=this._rotationMatrix,x=-this._bearingInRadians,S=(y=this._rotationMatrix)[0],I=y[1],B=y[2],F=y[3],U=Math.sin(x),W=Math.cos(x),m[0]=S*W+B*U,m[1]=I*W+F*U,m[2]=S*-U+B*W,m[3]=I*-U+F*W)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(n){const d=a.ah(n,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==d&&(this._unmodified=!1,this._pitchInRadians=d,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(n){const d=n/180*Math.PI;this._rollInRadians!==d&&(this._unmodified=!1,this._rollInRadians=d,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return a.aP(this._fovInRadians)}setFov(n){n=a.ah(n,.1,150),this.fov!==n&&(this._unmodified=!1,this._fovInRadians=a.ae(n),this._calcMatrices())}get zoom(){return this._zoom}setZoom(n){const d=this.getConstrained(this._center,n).zoom;this._zoom!==d&&(this._unmodified=!1,this._zoom=d,this._tileZoom=Math.max(0,Math.floor(d)),this._scale=a.af(d),this._constrain(),this._calcMatrices())}get center(){return this._center}setCenter(n){n.lat===this._center.lat&&n.lng===this._center.lng||(this._unmodified=!1,this._center=n,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(n){n!==this._elevation&&(this._elevation=n,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(n){this._edgeInsets.equals(n)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,n,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(n,d){this._autoCalculateNearFarZ=!1,this._nearZ=n,this._farZ=d,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(n){return this._edgeInsets.equals(n)}interpolatePadding(n,d,m){this._unmodified=!1,this._edgeInsets.interpolate(n,d,m),this._constrain(),this._calcMatrices()}resize(n,d,m=!0){this._width=n,this._height=d,m&&this._constrain(),this._calcMatrices()}getMaxBounds(){return this._latRange&&this._latRange.length===2&&this._lngRange&&this._lngRange.length===2?new qr([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(n){n?(this._lngRange=[n.getWest(),n.getEast()],this._latRange=[n.getSouth(),n.getNorth()],this._constrain()):(this._lngRange=null,this._latRange=[-a.ai,a.ai])}getConstrained(n,d){return this._callbacks.getConstrained(n,d)}getCameraQueryGeometry(n,d){if(d.length===1)return[d[0],n];{const{minX:m,minY:y,maxX:x,maxY:S}=a.a2.fromPoints(d).extend(n);return[new a.P(m,y),new a.P(x,y),new a.P(x,S),new a.P(m,S),new a.P(m,y)]}}_constrain(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;const n=this._unmodified,{center:d,zoom:m}=this.getConstrained(this.center,this.zoom);this.setCenter(d),this.setZoom(m),this._unmodified=n,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let n=a.ag(new Float64Array(16));a.N(n,n,[this._width/2,-this._height/2,1]),a.M(n,n,[1,-1,0]),this._clipSpaceToPixelsMatrix=n,n=a.ag(new Float64Array(16)),a.N(n,n,[1,-1,1]),a.M(n,n,[-1,-1,0]),a.N(n,n,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=n,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(n,d,m,y){const x=m!==void 0?m:this.bearing,S=y=y!==void 0?y:this.pitch,I=a.a1.fromLngLat(n,d),B=-Math.cos(a.ae(S)),F=Math.sin(a.ae(S)),U=F*Math.sin(a.ae(x)),W=-F*Math.cos(a.ae(x));let G=this.elevation;const q=d-G;let J;B*q>=0||Math.abs(B)<.1?(J=1e4,G=d+J*B):J=-q/B;let le,de,pe=a.aQ(1,I.y),ge=0;do{if(ge+=1,ge>10)break;de=J/pe,le=new a.a1(I.x+U*de,I.y+W*de),pe=1/le.meterInMercatorCoordinateUnits()}while(Math.abs(J-de*pe)>1e-12);return{center:le.toLngLat(),elevation:G,zoom:a.ak(this.height/2/Math.tan(this.fovInRadians/2)/de/this.tileSize)}}recalculateZoomAndCenter(n){if(this.elevation-n==0)return;const d=a.aj(1,this.center.lat)*this.worldSize,m=this.cameraToCenterDistance/d,y=a.a1.fromLngLat(this.center,this.elevation),x=Ze(this.center,this.elevation,this.pitch,this.bearing,m);this._elevation=n;const S=this.calculateCenterFromCameraLngLatAlt(x.toLngLat(),a.aQ(x.z,y.y),this.bearing,this.pitch);this._elevation=S.elevation,this._center=S.center,this.setZoom(S.zoom)}getCameraPoint(){const n=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new a.P(n*Math.sin(this.rollInRadians),n*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){const n=a.aj(1,this.center.lat)*this.worldSize;return Ze(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/n).toLngLat()}getMercatorTileCoordinates(n){if(!n)return[0,0,1,1];const d=n.canonical.z>=0?1<<n.canonical.z:Math.pow(2,n.canonical.z);return[n.canonical.x/d,n.canonical.y/d,1/d/a.$,1/d/a.$]}}class zi{constructor(n,d){this.min=n,this.max=d,this.center=a.aR([],a.aS([],this.min,this.max),.5)}quadrant(n){const d=[n%2==0,n<2],m=a.aT(this.min),y=a.aT(this.max);for(let x=0;x<d.length;x++)m[x]=d[x]?this.min[x]:this.center[x],y[x]=d[x]?this.center[x]:this.max[x];return y[2]=this.max[2],new zi(m,y)}distanceX(n){return Math.max(Math.min(this.max[0],n[0]),this.min[0])-n[0]}distanceY(n){return Math.max(Math.min(this.max[1],n[1]),this.min[1])-n[1]}intersectsFrustum(n){let d=!0;for(let m=0;m<n.planes.length;m++){const y=this.intersectsPlane(n.planes[m]);if(y===0)return 0;y===1&&(d=!1)}return d?2:n.aabb.min[0]>this.max[0]||n.aabb.min[1]>this.max[1]||n.aabb.min[2]>this.max[2]||n.aabb.max[0]<this.min[0]||n.aabb.max[1]<this.min[1]||n.aabb.max[2]<this.min[2]?0:1}intersectsPlane(n){let d=n[3],m=n[3];for(let y=0;y<3;y++)n[y]>0?(d+=n[y]*this.min[y],m+=n[y]*this.max[y]):(m+=n[y]*this.min[y],d+=n[y]*this.max[y]);return d>=0?2:m<0?0:1}}class ln{distanceToTile2d(n,d,m,y){const x=y.distanceX([n,d]),S=y.distanceY([n,d]);return Math.hypot(x,S)}getWrap(n,d,m){return m}getTileBoundingVolume(n,d,m,y){var x,S;let I=0,B=0;if(y?.terrain){const U=new a.Z(n.z,d,n.z,n.x,n.y),W=y.terrain.getMinMaxElevation(U);I=(x=W.minElevation)!==null&&x!==void 0?x:Math.min(0,m),B=(S=W.maxElevation)!==null&&S!==void 0?S:Math.max(0,m)}const F=1<<n.z;return new zi([d+n.x/F,n.y/F,I],[d+(n.x+1)/F,(n.y+1)/F,B])}allowVariableZoom(n,d){const m=n.fov*(Math.abs(Math.cos(n.rollInRadians))*n.height+Math.abs(Math.sin(n.rollInRadians))*n.width)/n.height,y=a.ah(78.5-m/2,0,60);return!!d.terrain||n.pitch>y}allowWorldCopies(){return!0}prepareNextFrame(){}}class hi{constructor(n,d,m){this.points=n,this.planes=d,this.aabb=m}static fromInvProjectionMatrix(n,d=1,m=0,y,x){const S=x?[[6,5,4],[0,1,2],[0,3,7],[2,1,5],[3,2,6],[0,4,5]]:[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]],I=Math.pow(2,m),B=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((G=>(function(q,J,le,de){const pe=a.aw([],q,J),ge=1/pe[3]/le*de;return a.aY(pe,pe,[ge,ge,1/pe[3],ge])})(G,n,d,I)));y&&(function(G,q,J,le){const de=le?4:0,pe=le?0:4;let ge=0;const xe=[],_e=[];for(let ve=0;ve<4;ve++){const Re=a.aU([],G[ve+pe],G[ve+de]),$e=a.aZ(Re);a.aR(Re,Re,1/$e),xe.push($e),_e.push(Re)}for(let ve=0;ve<4;ve++){const Re=a.a_(G[ve+de],_e[ve],J);ge=Re!==null&&Re>=0?Math.max(ge,Re):Math.max(ge,xe[ve])}const Te=(function(ve,Re){const $e=a.aU([],ve[Re[0]],ve[Re[1]]),We=a.aU([],ve[Re[2]],ve[Re[1]]),qe=[0,0,0,0];return a.aV(qe,a.aW([],$e,We)),qe[3]=-a.aX(qe,ve[Re[0]]),qe})(G,q),Pe=(function(ve,Re){const $e=a.a$(ve),We=a.b0([],ve,1/$e),qe=a.aU([],Re,a.aR([],We,a.aX(Re,We))),Qe=a.a$(qe);if(Qe>0){const bt=Math.sqrt(1-We[3]*We[3]),Et=a.aR([],We,-We[3]),ut=a.aS([],Et,a.aR([],qe,bt/Qe));return a.b1(Re,ut)}return null})(J,Te);if(Pe!==null){const ve=Pe/a.aX(_e[0],Te);ge=Math.min(ge,ve)}for(let ve=0;ve<4;ve++){const Re=Math.min(ge,xe[ve]);G[ve+pe]=[G[ve+de][0]+_e[ve][0]*Re,G[ve+de][1]+_e[ve][1]*Re,G[ve+de][2]+_e[ve][2]*Re,1]}})(B,S[0],y,x);const F=S.map((G=>{const q=a.aU([],B[G[0]],B[G[1]]),J=a.aU([],B[G[2]],B[G[1]]),le=a.aV([],a.aW([],q,J)),de=-a.aX(le,B[G[1]]);return le.concat(de)})),U=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],W=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(const G of B)for(let q=0;q<3;q++)U[q]=Math.min(U[q],G[q]),W[q]=Math.max(W[q],G[q]);return new hi(B,F,new zi(U,W))}}class oi{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(n){this._helper.setMinZoom(n)}setMaxZoom(n){this._helper.setMaxZoom(n)}setMinPitch(n){this._helper.setMinPitch(n)}setMaxPitch(n){this._helper.setMaxPitch(n)}setRenderWorldCopies(n){this._helper.setRenderWorldCopies(n)}setBearing(n){this._helper.setBearing(n)}setPitch(n){this._helper.setPitch(n)}setRoll(n){this._helper.setRoll(n)}setFov(n){this._helper.setFov(n)}setZoom(n){this._helper.setZoom(n)}setCenter(n){this._helper.setCenter(n)}setElevation(n){this._helper.setElevation(n)}setMinElevationForCurrentTile(n){this._helper.setMinElevationForCurrentTile(n)}setPadding(n){this._helper.setPadding(n)}interpolatePadding(n,d,m){return this._helper.interpolatePadding(n,d,m)}isPaddingEqual(n){return this._helper.isPaddingEqual(n)}resize(n,d,m=!0){this._helper.resize(n,d,m)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(n){this._helper.setMaxBounds(n)}overrideNearFarZ(n,d){this._helper.overrideNearFarZ(n,d)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(n){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),n)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(n,d){}constructor(n,d,m,y,x){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this._helper=new Fi({calcMatrices:()=>{this._calcMatrices()},getConstrained:(S,I)=>this.getConstrained(S,I)},n,d,m,y,x),this._coveringTilesDetailsProvider=new ln}clone(){const n=new oi;return n.apply(this),n}apply(n,d,m){this._helper.apply(n,d,m)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(n){const d=[new a.b2(0,n)];if(this._helper._renderWorldCopies){const m=this.screenPointToMercatorCoordinate(new a.P(0,0)),y=this.screenPointToMercatorCoordinate(new a.P(this._helper._width,0)),x=this.screenPointToMercatorCoordinate(new a.P(this._helper._width,this._helper._height)),S=this.screenPointToMercatorCoordinate(new a.P(0,this._helper._height)),I=Math.floor(Math.min(m.x,y.x,x.x,S.x)),B=Math.floor(Math.max(m.x,y.x,x.x,S.x)),F=1;for(let U=I-F;U<=B+F;U++)U!==0&&d.push(new a.b2(U,n))}return d}getCameraFrustum(){return hi.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(n){const d=this.screenPointToLocation(this.centerPoint,n),m=n?n.getElevationForLngLatZoom(d,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(m)}setLocationAtPoint(n,d){const m=a.aj(this.elevation,this.center.lat),y=this.screenPointToMercatorCoordinateAtZ(d,m),x=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,m),S=a.a1.fromLngLat(n),I=new a.a1(S.x-(y.x-x.x),S.y-(y.y-x.y));this.setCenter(I?.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(n,d){return d?this.coordinatePoint(a.a1.fromLngLat(n),d.getElevationForLngLatZoom(n,this._helper._tileZoom),this._pixelMatrix3D):this.coordinatePoint(a.a1.fromLngLat(n))}screenPointToLocation(n,d){var m;return(m=this.screenPointToMercatorCoordinate(n,d))===null||m===void 0?void 0:m.toLngLat()}screenPointToMercatorCoordinate(n,d){if(d){const m=d.pointCoordinate(n);if(m!=null)return m}return this.screenPointToMercatorCoordinateAtZ(n)}screenPointToMercatorCoordinateAtZ(n,d){const m=d||0,y=[n.x,n.y,0,1],x=[n.x,n.y,1,1];a.aw(y,y,this._pixelMatrixInverse),a.aw(x,x,this._pixelMatrixInverse);const S=y[3],I=x[3],B=y[1]/S,F=x[1]/I,U=y[2]/S,W=x[2]/I,G=U===W?0:(m-U)/(W-U);return new a.a1(a.C.number(y[0]/S,x[0]/I,G)/this.worldSize,a.C.number(B,F,G)/this.worldSize,m)}coordinatePoint(n,d=0,m=this._pixelMatrix){const y=[n.x*this.worldSize,n.y*this.worldSize,d,1];return a.aw(y,y,m),new a.P(y[0]/y[3],y[1]/y[3])}getBounds(){const n=Math.max(0,this._helper._height/2-Se(this));return new qr().extend(this.screenPointToLocation(new a.P(0,n))).extend(this.screenPointToLocation(new a.P(this._helper._width,n))).extend(this.screenPointToLocation(new a.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new a.P(0,this._helper._height)))}isPointOnMapSurface(n,d){return d?d.pointCoordinate(n)!=null:n.y>this.height/2-Se(this)}calculatePosMatrix(n,d=!1,m){var y;const x=(y=n.key)!==null&&y!==void 0?y:a.b3(n.wrap,n.canonical.z,n.canonical.z,n.canonical.x,n.canonical.y),S=d?this._alignedPosMatrixCache:this._posMatrixCache;if(S.has(x)){const F=S.get(x);return m?F.f32:F.f64}const I=Oe(n,this.worldSize);a.O(I,d?this._alignedProjMatrix:this._viewProjMatrix,I);const B={f64:I,f32:new Float32Array(I)};return S.set(x,B),m?B.f32:B.f64}calculateFogMatrix(n){const d=n.key,m=this._fogMatrixCacheF32;if(m.has(d))return m.get(d);const y=Oe(n,this.worldSize);return a.O(y,this._fogMatrix,y),m.set(d,new Float32Array(y)),m.get(d)}getConstrained(n,d){d=a.ah(+d,this.minZoom,this.maxZoom);const m={center:new a.S(n.lng,n.lat),zoom:d};let y=this._helper._lngRange;if(!this._helper._renderWorldCopies&&y===null){const xe=179.9999999999;y=[-xe,xe]}const x=this.tileSize*a.af(m.zoom);let S=0,I=x,B=0,F=x,U=0,W=0;const{x:G,y:q}=this.size;if(this._helper._latRange){const xe=this._helper._latRange;S=a.U(xe[1])*x,I=a.U(xe[0])*x,I-S<q&&(U=q/(I-S))}y&&(B=a.aO(a.V(y[0])*x,0,x),F=a.aO(a.V(y[1])*x,0,x),F<B&&(F+=x),F-B<G&&(W=G/(F-B)));const{x:J,y:le}=ae(x,n);let de,pe;const ge=Math.max(W||0,U||0);if(ge){const xe=new a.P(W?(F+B)/2:J,U?(I+S)/2:le);return m.center=be(x,xe).wrap(),m.zoom+=a.ak(ge),m}if(this._helper._latRange){const xe=q/2;le-xe<S&&(pe=S+xe),le+xe>I&&(pe=I-xe)}if(y){const xe=(B+F)/2;let _e=J;this._helper._renderWorldCopies&&(_e=a.aO(J,xe-x/2,xe+x/2));const Te=G/2;_e-Te<B&&(de=B+Te),_e+Te>F&&(de=F-Te)}if(de!==void 0||pe!==void 0){const xe=new a.P(de??J,pe??le);m.center=be(x,xe).wrap()}return m}calculateCenterFromCameraLngLatAlt(n,d,m,y){return this._helper.calculateCenterFromCameraLngLatAlt(n,d,m,y)}_calculateNearFarZIfNeeded(n,d,m){if(!this._helper.autoCalculateNearFarZ)return;const y=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),x=n-y*this._helper._pixelPerMeter/Math.cos(d),S=y<0?x:n,I=Math.PI/2+this.pitchInRadians,B=a.ae(this.fov)*(Math.abs(Math.cos(a.ae(this.roll)))*this.height+Math.abs(Math.sin(a.ae(this.roll)))*this.width)/this.height*(.5+m.y/this.height),F=Math.sin(B)*S/Math.sin(a.ah(Math.PI-I-B,.01,Math.PI-.01)),U=Se(this),W=Math.atan(U/this._helper.cameraToCenterDistance),G=a.ae(.75),q=W>G?2*W*(.5+m.y/(2*U)):G,J=Math.sin(q)*S/Math.sin(a.ah(Math.PI-I-q,.01,Math.PI-.01)),le=Math.min(F,J);this._helper._farZ=1.01*(Math.cos(Math.PI/2-d)*le+S),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;const n=this.centerOffset,d=ae(this.worldSize,this.center),m=d.x,y=d.y;this._helper._pixelPerMeter=a.aj(1,this.center.lat)*this.worldSize;const x=a.ae(Math.min(this.pitch,ee)),S=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(x));let I;this._calculateNearFarZIfNeeded(S,x,n),I=new Float64Array(16),a.b4(I,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),a.aq(this._invProjMatrix,I),I[8]=2*-n.x/this._helper._width,I[9]=2*n.y/this._helper._height,this._projectionMatrix=a.b5(I),a.N(I,I,[1,-1,1]),a.M(I,I,[0,0,-this._helper.cameraToCenterDistance]),a.b6(I,I,-this.rollInRadians),a.b7(I,I,this.pitchInRadians),a.b6(I,I,-this.bearingInRadians),a.M(I,I,[-m,-y,0]),this._mercatorMatrix=a.N([],I,[this.worldSize,this.worldSize,this.worldSize]),a.N(I,I,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=a.O(new Float64Array(16),this.clipSpaceToPixelsMatrix,I),a.M(I,I,[0,0,-this.elevation]),this._viewProjMatrix=I,this._invViewProjMatrix=a.aq([],I);const B=[0,0,-1,1];a.aw(B,B,this._invViewProjMatrix),this._cameraPosition=[B[0]/B[3],B[1]/B[3],B[2]/B[3]],this._fogMatrix=new Float64Array(16),a.b4(this._fogMatrix,this.fovInRadians,this.width/this.height,S,this._helper._farZ),this._fogMatrix[8]=2*-n.x/this.width,this._fogMatrix[9]=2*n.y/this.height,a.N(this._fogMatrix,this._fogMatrix,[1,-1,1]),a.M(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),a.b6(this._fogMatrix,this._fogMatrix,-this.rollInRadians),a.b7(this._fogMatrix,this._fogMatrix,this.pitchInRadians),a.b6(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),a.M(this._fogMatrix,this._fogMatrix,[-m,-y,0]),a.N(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),a.M(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=a.O(new Float64Array(16),this.clipSpaceToPixelsMatrix,I);const F=this._helper._width%2/2,U=this._helper._height%2/2,W=Math.cos(this.bearingInRadians),G=Math.sin(-this.bearingInRadians),q=m-Math.round(m)+W*F+G*U,J=y-Math.round(y)+W*U+G*F,le=new Float64Array(I);if(a.M(le,le,[q>.5?q-1:q,J>.5?J-1:J,0]),this._alignedProjMatrix=le,I=a.aq(new Float64Array(16),this._pixelMatrix),!I)throw new Error("failed to invert matrix");this._pixelMatrixInverse=I,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;const n=this.screenPointToMercatorCoordinate(new a.P(0,0)),d=[n.x*this.worldSize,n.y*this.worldSize,0,1];return a.aw(d,d,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){const n=a.aj(1,this.center.lat)*this.worldSize;return Ze(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/n).toLngLat()}lngLatToCameraDepth(n,d){const m=a.a1.fromLngLat(n),y=[m.x*this.worldSize,m.y*this.worldSize,d,1];return a.aw(y,y,this._viewProjMatrix),y[2]/y[3]}getProjectionData(n){const{overscaledTileID:d,aligned:m,applyTerrainMatrix:y}=n,x=this._helper.getMercatorTileCoordinates(d),S=d?this.calculatePosMatrix(d,m,!0):null;let I;return I=d&&d.terrainRttPosMatrix32f&&y?d.terrainRttPosMatrix32f:S||a.b8(),{mainMatrix:I,tileMercatorCoords:x,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:I}}isLocationOccluded(n){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(n,d,m){return 1}transformLightDirection(n){return a.aT(n)}getRayDirectionFromPixel(n){throw new Error("Not implemented.")}projectTileCoordinates(n,d,m,y){const x=this.calculatePosMatrix(m);let S;y?(S=[n,d,y(n,d),1],a.aw(S,S,x)):(S=[n,d,0,1],Wa(S,S,x));const I=S[3];return{point:new a.P(S[0]/I,S[1]/I),signedDistanceFromCamera:I,isOccluded:!1}}populateCache(n){for(const d of n)this.calculatePosMatrix(d)}getMatrixForModel(n,d){const m=a.a1.fromLngLat(n,d),y=m.meterInMercatorCoordinateUnits(),x=a.b9();return a.M(x,x,[m.x,m.y,m.z]),a.b6(x,x,Math.PI),a.b7(x,x,Math.PI/2),a.N(x,x,[-y,y,y]),x}getProjectionDataForCustomLayer(n=!0){const d=new a.Z(0,0,0,0,0),m=this.getProjectionData({overscaledTileID:d,applyGlobeMatrix:n}),y=Oe(d,this.worldSize);a.O(y,this._viewProjMatrix,y),m.tileMercatorCoords=[0,0,1,1];const x=[a.$,a.$,this.worldSize/this._helper.pixelsPerMeter],S=a.ba();return a.N(S,y,x),m.fallbackMatrix=S,m.mainMatrix=S,m}getFastPathSimpleProjectionMatrix(n){return this.calculatePosMatrix(n)}}function bd(){a.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function cn(b){if(b.useSlerp)if(b.k<1){const n=a.bb(b.startEulerAngles.roll,b.startEulerAngles.pitch,b.startEulerAngles.bearing),d=a.bb(b.endEulerAngles.roll,b.endEulerAngles.pitch,b.endEulerAngles.bearing),m=new Float64Array(4);a.bc(m,n,d,b.k);const y=a.bd(m);b.tr.setRoll(y.roll),b.tr.setPitch(y.pitch),b.tr.setBearing(y.bearing)}else b.tr.setRoll(b.endEulerAngles.roll),b.tr.setPitch(b.endEulerAngles.pitch),b.tr.setBearing(b.endEulerAngles.bearing);else b.tr.setRoll(a.C.number(b.startEulerAngles.roll,b.endEulerAngles.roll,b.k)),b.tr.setPitch(a.C.number(b.startEulerAngles.pitch,b.endEulerAngles.pitch,b.k)),b.tr.setBearing(a.C.number(b.startEulerAngles.bearing,b.endEulerAngles.bearing,b.k))}function Os(b,n,d,m,y){const x=y.padding,S=ae(y.worldSize,d.getNorthWest()),I=ae(y.worldSize,d.getNorthEast()),B=ae(y.worldSize,d.getSouthEast()),F=ae(y.worldSize,d.getSouthWest()),U=a.ae(-m),W=S.rotate(U),G=I.rotate(U),q=B.rotate(U),J=F.rotate(U),le=new a.P(Math.max(W.x,G.x,J.x,q.x),Math.max(W.y,G.y,J.y,q.y)),de=new a.P(Math.min(W.x,G.x,J.x,q.x),Math.min(W.y,G.y,J.y,q.y)),pe=le.sub(de),ge=(y.width-(x.left+x.right+n.left+n.right))/pe.x,xe=(y.height-(x.top+x.bottom+n.top+n.bottom))/pe.y;if(xe<0||ge<0)return void bd();const _e=Math.min(a.ak(y.scale*Math.min(ge,xe)),b.maxZoom),Te=a.P.convert(b.offset),Pe=new a.P((n.left-n.right)/2,(n.top-n.bottom)/2).rotate(a.ae(m)),ve=Te.add(Pe).mult(y.scale/a.af(_e));return{center:be(y.worldSize,S.add(B).div(2).sub(ve)),zoom:_e,bearing:m}}class In{get useGlobeControls(){return!1}handlePanInertia(n,d){return{easingOffset:n,easingCenter:d.center}}handleMapControlsRollPitchBearingZoom(n,d){n.bearingDelta&&d.setBearing(d.bearing+n.bearingDelta),n.pitchDelta&&d.setPitch(d.pitch+n.pitchDelta),n.rollDelta&&d.setRoll(d.roll+n.rollDelta),n.zoomDelta&&d.setZoom(d.zoom+n.zoomDelta)}handleMapControlsPan(n,d,m){n.around.distSqr(d.centerPoint)<.01||d.setLocationAtPoint(m,n.around)}cameraForBoxAndBearing(n,d,m,y,x){return Os(n,d,m,y,x)}handleJumpToCenterZoom(n,d){n.zoom!==(d.zoom!==void 0?+d.zoom:n.zoom)&&n.setZoom(+d.zoom),d.center!==void 0&&n.setCenter(a.S.convert(d.center))}handleEaseTo(n,d){const m=n.zoom,y=n.padding,x={roll:n.roll,pitch:n.pitch,bearing:n.bearing},S={roll:d.roll===void 0?n.roll:d.roll,pitch:d.pitch===void 0?n.pitch:d.pitch,bearing:d.bearing===void 0?n.bearing:d.bearing},I=d.zoom!==void 0,B=!n.isPaddingEqual(d.padding);let F=!1;const U=I?+d.zoom:n.zoom;let W=n.centerPoint.add(d.offsetAsPoint);const G=n.screenPointToLocation(W),{center:q,zoom:J}=n.getConstrained(a.S.convert(d.center||G),U??m);Oi(n,q);const le=ae(n.worldSize,G),de=ae(n.worldSize,q).sub(le),pe=a.af(J-m);return F=J!==m,{easeFunc:ge=>{if(F&&n.setZoom(a.C.number(m,J,ge)),a.be(x,S)||cn({startEulerAngles:x,endEulerAngles:S,tr:n,k:ge,useSlerp:x.roll!=S.roll}),B&&(n.interpolatePadding(y,d.padding,ge),W=n.centerPoint.add(d.offsetAsPoint)),d.around)n.setLocationAtPoint(d.around,d.aroundPoint);else{const xe=a.af(n.zoom-m),_e=J>m?Math.min(2,pe):Math.max(.5,pe),Te=Math.pow(_e,1-ge),Pe=be(n.worldSize,le.add(de.mult(ge*Te)).mult(xe));n.setLocationAtPoint(n.renderWorldCopies?Pe.wrap():Pe,W)}},isZooming:F,elevationCenter:q}}handleFlyTo(n,d){const m=d.zoom!==void 0,y=n.zoom,x=n.getConstrained(a.S.convert(d.center||d.locationAtOffset),m?+d.zoom:y),S=x.center,I=x.zoom;Oi(n,S);const B=ae(n.worldSize,d.locationAtOffset),F=ae(n.worldSize,S).sub(B),U=F.mag(),W=a.af(I-y);let G;if(d.minZoom!==void 0){const q=Math.min(+d.minZoom,y,I),J=n.getConstrained(S,q).zoom;G=a.af(J-y)}return{easeFunc:(q,J,le,de)=>{n.setZoom(q===1?I:y+a.ak(J));const pe=q===1?S:be(n.worldSize,B.add(F.mult(le)).mult(J));n.setLocationAtPoint(n.renderWorldCopies?pe.wrap():pe,de)},scaleOfZoom:W,targetCenter:S,scaleOfMinZoom:G,pixelPathLength:U}}}class ii{constructor(n,d,m){this.blendFunction=n,this.blendColor=d,this.mask=m}}ii.Replace=[1,0],ii.disabled=new ii(ii.Replace,a.bf.transparent,[!1,!1,!1,!1]),ii.unblended=new ii(ii.Replace,a.bf.transparent,[!0,!0,!0,!0]),ii.alphaBlended=new ii([1,771],a.bf.transparent,[!0,!0,!0,!0]);const Ka=2305;class lr{constructor(n,d,m){this.enable=n,this.mode=d,this.frontFace=m}}lr.disabled=new lr(!1,1029,Ka),lr.backCCW=new lr(!0,1029,Ka),lr.frontCCW=new lr(!0,1028,Ka);class pr{constructor(n,d,m){this.func=n,this.mask=d,this.range=m}}pr.ReadOnly=!1,pr.ReadWrite=!0,pr.disabled=new pr(519,pr.ReadOnly,[0,1]);const Fs=7680;class Rr{constructor(n,d,m,y,x,S){this.test=n,this.ref=d,this.mask=m,this.fail=y,this.depthFail=x,this.pass=S}}Rr.disabled=new Rr({func:519,mask:0},0,0,Fs,Fs,Fs);const jn=new WeakMap;function Ho(b){var n;if(jn.has(b))return jn.get(b);{const d=(n=b.getParameter(b.VERSION))===null||n===void 0?void 0:n.startsWith("WebGL 2.0");return jn.set(b,d),d}}class Wo{get awaitingQuery(){return!!this._readbackQueue}constructor(n){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=n;const d=n.context,m=d.gl;this._texFormat=m.RGBA,this._texType=m.UNSIGNED_BYTE;const y=new a.aL;y.emplaceBack(-1,-1),y.emplaceBack(2,-1),y.emplaceBack(-1,2);const x=new a.aN;x.emplaceBack(0,1,2),this._fullscreenTriangle=new mt(d.createVertexBuffer(y,Xt.members),d.createIndexBuffer(x),a.aM.simpleSegment(0,0,y.length,x.length)),this._resultBuffer=new Uint8Array(4),d.activeTexture.set(m.TEXTURE1);const S=m.createTexture();m.bindTexture(m.TEXTURE_2D,S),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,m.CLAMP_TO_EDGE),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,m.CLAMP_TO_EDGE),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,m.NEAREST),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,m.NEAREST),m.texImage2D(m.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=d.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(S),Ho(m)&&(this._pbo=m.createBuffer(),m.bindBuffer(m.PIXEL_PACK_BUFFER,this._pbo),m.bufferData(m.PIXEL_PACK_BUFFER,4,m.STREAM_READ),m.bindBuffer(m.PIXEL_PACK_BUFFER,null))}destroy(){const n=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),n.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(n,d){const m=this._updateCount;return this._readbackQueue?m>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():m>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(n,d),this._updateCount++,this._measuredError}_bindFramebuffer(){const n=this._cachedRenderContext.context,d=n.gl;n.activeTexture.set(d.TEXTURE1),d.bindTexture(d.TEXTURE_2D,this._fbo.colorAttachment.get()),n.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(n,d){const m=this._cachedRenderContext.context,y=m.gl;if(this._bindFramebuffer(),m.viewport.set([0,0,this._texWidth,this._texHeight]),m.clear({color:a.bf.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(m,y.TRIANGLES,pr.disabled,Rr.disabled,ii.unblended,lr.disabled,((x,S)=>({u_input:x,u_output_expected:S}))(n,d),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&Ho(y)){y.bindBuffer(y.PIXEL_PACK_BUFFER,this._pbo),y.readBuffer(y.COLOR_ATTACHMENT0),y.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),y.bindBuffer(y.PIXEL_PACK_BUFFER,null);const x=y.fenceSync(y.SYNC_GPU_COMMANDS_COMPLETE,0);y.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:x}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){const n=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&Ho(n)){const d=n.clientWaitSync(this._readbackQueue.sync,0,0);if(d===n.WAIT_FAILED)return a.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(d===n.TIMEOUT_EXPIRED)return;n.bindBuffer(n.PIXEL_PACK_BUFFER,this._pbo),n.getBufferSubData(n.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),n.bindBuffer(n.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),n.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=Wo._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(n){let d=0;return d+=n[0]/256,d+=n[1]/65536,d+=n[2]/16777216,n[3]<127&&(d=-d),d/128}}const gc=a.$/128;function _c(b,n){const d=b.granularity!==void 0?Math.max(b.granularity,1):1,m=d+(b.generateBorders?2:0),y=d+(b.extendToNorthPole||b.generateBorders?1:0)+(b.extendToSouthPole||b.generateBorders?1:0),x=m+1,S=y+1,I=b.generateBorders?-1:0,B=b.generateBorders||b.extendToNorthPole?-1:0,F=d+(b.generateBorders?1:0),U=d+(b.generateBorders||b.extendToSouthPole?1:0),W=x*S,G=m*y*6,q=x*S>65536;if(q&&n==="16bit")throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");const J=q||n==="32bit",le=new Int16Array(2*W);let de=0;for(let xe=B;xe<=U;xe++)for(let _e=I;_e<=F;_e++){let Te=_e/d*a.$;_e===-1&&(Te=-gc),_e===d+1&&(Te=a.$+gc);let Pe=xe/d*a.$;xe===-1&&(Pe=b.extendToNorthPole?a.bh:-gc),xe===d+1&&(Pe=b.extendToSouthPole?a.bi:a.$+gc),le[de++]=Te,le[de++]=Pe}const pe=J?new Uint32Array(G):new Uint16Array(G);let ge=0;for(let xe=0;xe<y;xe++)for(let _e=0;_e<m;_e++){const Te=_e+1+xe*x,Pe=_e+(xe+1)*x,ve=_e+1+(xe+1)*x;pe[ge++]=_e+xe*x,pe[ge++]=Pe,pe[ge++]=Te,pe[ge++]=Te,pe[ge++]=Pe,pe[ge++]=ve}return{vertices:le.buffer.slice(0),indices:pe.buffer.slice(0),uses32bitIndices:J}}const Ya=new a.aK({fill:new a.bj(128,2),line:new a.bj(512,0),tile:new a.bj(128,32),stencil:new a.bj(128,1),circle:3});class yc{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return Ce.projectionGlobe}get vertexShaderPreludeCode(){return Ce.projectionMercator.vertexSource}get subdivisionGranularity(){return Ya}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(n){this._errorMeasurement||(this._errorMeasurement=new Wo(n));const d=a.U(this._errorQueryLatitudeDegrees),m=2*Math.atan(Math.exp(Math.PI-d*Math.PI*2))-.5*Math.PI,y=this._errorMeasurement.updateErrorLoop(d,m),x=L.now();y!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=y,this._errorMeasurementLastChangeTime=x);const S=Math.min(Math.max((x-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=a.bk(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,a.bl(S))}_getMeshKey(n){return`${n.granularity.toString(36)}_${n.generateBorders?"b":""}${n.extendToNorthPole?"n":""}${n.extendToSouthPole?"s":""}`}getMeshFromTileID(n,d,m,y,x){const S=(x==="stencil"?Ya.stencil:Ya.tile).getGranularityForZoomLevel(d.z);return this._getMesh(n,{granularity:S,generateBorders:m,extendToNorthPole:d.y===0&&y,extendToSouthPole:d.y===(1<<d.z)-1&&y})}_getMesh(n,d){const m=this._getMeshKey(d);if(m in this._tileMeshCache)return this._tileMeshCache[m];const y=(function(x,S){const I=_c(S,"16bit"),B=a.aL.deserialize({arrayBuffer:I.vertices,length:I.vertices.byteLength/2/2}),F=a.aN.deserialize({arrayBuffer:I.indices,length:I.indices.byteLength/2/3});return new mt(x.createVertexBuffer(B,Xt.members),x.createIndexBuffer(F),a.aM.simpleSegment(0,0,B.length,F.length))})(n,d);return this._tileMeshCache[m]=y,y}recalculate(n){}hasTransition(){const n=L.now();let d=!1;return d=d||(n-this._errorMeasurementLastChangeTime)/1e3<.7,d=d||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,d}setErrorQueryLatitudeDegrees(n){this._errorQueryLatitudeDegrees=n}}const So=new a.r({type:new a.D(a.v.projection.type)});class vc extends a.E{constructor(n){super(),this._transitionable=new a.t(So),this.setProjection(n),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new a.F(0)),this._mercatorProjection=new ar,this._verticalPerspectiveProjection=new yc}get transitionState(){const n=this.properties.get("type");if(typeof n=="string"&&n==="mercator")return 0;if(typeof n=="string"&&n==="vertical-perspective")return 1;if(n instanceof a.bm){if(n.from==="vertical-perspective"&&n.to==="mercator")return 1-n.transition;if(n.from==="mercator"&&n.to==="vertical-perspective")return n.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(n){this._mercatorProjection.updateGPUdependent(n),this._verticalPerspectiveProjection.updateGPUdependent(n)}getMeshFromTileID(n,d,m,y,x){return this.currentProjection.getMeshFromTileID(n,d,m,y,x)}setProjection(n){this._transitionable.setValue("type",n?.type||"mercator")}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}setErrorQueryLatitudeDegrees(n){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(n),this._mercatorProjection.setErrorQueryLatitudeDegrees(n)}}function Ml(b){const n=fa(b.worldSize,b.center.lat);return 2*Math.PI*n}function ro(b,n,d,m,y){const x=1/(1<<y),S=n/a.$*x+m*x,I=a.bo((b/a.$*x+d*x)*Math.PI*2+Math.PI,2*Math.PI),B=2*Math.atan(Math.exp(Math.PI-S*Math.PI*2))-.5*Math.PI,F=Math.cos(B),U=new Float64Array(3);return U[0]=Math.sin(I)*F,U[1]=Math.sin(B),U[2]=Math.cos(I)*F,U}function qi(b){return(function(n,d){const m=Math.cos(d),y=new Float64Array(3);return y[0]=Math.sin(n)*m,y[1]=Math.sin(d),y[2]=Math.cos(n)*m,y})(b.lng*Math.PI/180,b.lat*Math.PI/180)}function fa(b,n){return b/(2*Math.PI)/Math.cos(n*Math.PI/180)}function bc(b){const n=Math.asin(b[1])/Math.PI*180,d=Math.sqrt(b[0]*b[0]+b[2]*b[2]);if(d>1e-6){const m=b[0]/d,y=Math.acos(b[2]/d),x=(m>0?y:-y)/Math.PI*180;return new a.S(a.aO(x,-180,180),n)}return new a.S(0,n)}function un(b){return Math.cos(b*Math.PI/180)}function di(b,n){const d=un(b),m=un(n);return a.ak(m/d)}function uh(b,n){const d=b.rotate(n.bearingInRadians),m=n.zoom+di(n.center.lat,0),y=a.bk(1/un(n.center.lat),1/un(Math.min(Math.abs(n.center.lat),60)),a.bn(m,7,3,0,1)),x=360/Ml({worldSize:n.worldSize,center:{lat:n.center.lat}});return new a.S(n.center.lng-d.x*x*y,a.ah(n.center.lat+d.y*x,-a.ai,a.ai))}function ma(b){const n=.5*b,d=Math.sin(n),m=Math.cos(n);return Math.log(d+m)-Math.log(m-d)}function xd(b,n,d,m){const y=b.lat+d*m;if(Math.abs(d)>1){const x=(Math.sign(b.lat+d)!==Math.sign(b.lat)?-Math.abs(b.lat):Math.abs(b.lat))*Math.PI/180,S=Math.abs(b.lat+d)*Math.PI/180,I=ma(x+m*(S-x)),B=ma(x),F=ma(S);return new a.S(b.lng+n*((I-B)/(F-B)),y)}return new a.S(b.lng+n*m,y)}class wd{constructor(n){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._boundingVolumeFactory=n}swapBuffers(){if(!this._hadAnyChanges)return;const n=this._cachePrevious;this._cachePrevious=this._cache,this._cache=n,this._cache.clear(),this._hadAnyChanges=!1}getTileBoundingVolume(n,d,m,y){const x=`${n.z}_${n.x}_${n.y}_${y?.terrain?"t":""}`,S=this._cache.get(x);if(S)return S;const I=this._cachePrevious.get(x);if(I)return this._cache.set(x,I),I;const B=this._boundingVolumeFactory(n,d,m,y);return this._cache.set(x,B),this._hadAnyChanges=!0,B}}class Ja{constructor(n,d,m,y){this.min=m,this.max=y,this.points=n,this.planes=d}static fromAabb(n,d){const m=[];for(let y=0;y<8;y++)m.push([1&~y?n[0]:d[0],(y>>1&1)==1?d[1]:n[1],(y>>2&1)==1?d[2]:n[2]]);return new Ja(m,[[-1,0,0,d[0]],[1,0,0,-n[0]],[0,-1,0,d[1]],[0,1,0,-n[1]],[0,0,-1,d[2]],[0,0,1,-n[2]]],n,d)}static fromCenterSizeAngles(n,d,m){const y=a.br([],m[0],m[1],m[2]),x=a.bs([],[d[0],0,0],y),S=a.bs([],[0,d[1],0],y),I=a.bs([],[0,0,d[2]],y),B=[...n],F=[...n];for(let W=0;W<8;W++)for(let G=0;G<3;G++){const q=n[G]+x[G]*(1&~W?-1:1)+S[G]*((W>>1&1)==1?1:-1)+I[G]*((W>>2&1)==1?1:-1);B[G]=Math.min(B[G],q),F[G]=Math.max(F[G],q)}const U=[];for(let W=0;W<8;W++){const G=[...n];a.aS(G,G,a.aR([],x,1&~W?-1:1)),a.aS(G,G,a.aR([],S,(W>>1&1)==1?1:-1)),a.aS(G,G,a.aR([],I,(W>>2&1)==1?1:-1)),U.push(G)}return new Ja(U,[[...x,-a.aX(x,U[0])],[...S,-a.aX(S,U[0])],[...I,-a.aX(I,U[0])],[-x[0],-x[1],-x[2],-a.aX(x,U[7])],[-S[0],-S[1],-S[2],-a.aX(S,U[7])],[-I[0],-I[1],-I[2],-a.aX(I,U[7])]],B,F)}intersectsFrustum(n){let d=!0;const m=this.points.length,y=this.planes.length,x=n.planes.length,S=n.points.length;for(let I=0;I<x;I++){const B=n.planes[I];let F=0;for(let U=0;U<m;U++){const W=this.points[U];B[0]*W[0]+B[1]*W[1]+B[2]*W[2]+B[3]>=0&&F++}if(F===0)return 0;F<m&&(d=!1)}if(d)return 2;for(let I=0;I<y;I++){const B=this.planes[I];let F=0;for(let U=0;U<S;U++){const W=n.points[U];B[0]*W[0]+B[1]*W[1]+B[2]*W[2]+B[3]>=0&&F++}if(F===0)return 0}return 1}intersectsPlane(n){const d=this.points.length;let m=0;for(let y=0;y<d;y++){const x=this.points[y];n[0]*x[0]+n[1]*x[1]+n[2]*x[2]+n[3]>=0&&m++}return m===d?2:m===0?0:1}}function $i(b,n,d){const m=b-n;return m<0?-m:Math.max(0,m-d)}function Qa(b,n,d,m,y){const x=b-d;let S;return S=x<0?Math.min(-x,1+x-y):x>1?Math.min(Math.max(x-y,0),1-x):0,Math.max(S,$i(n,m,y))}class Co{constructor(){this._boundingVolumeCache=new wd(this._computeTileBoundingVolume)}prepareNextFrame(){this._boundingVolumeCache.swapBuffers()}distanceToTile2d(n,d,m,y){const x=1<<m.z,S=1/x,I=m.x/x,B=m.y/x;let F=2;return F=Math.min(F,Qa(n,d,I,B,S)),F=Math.min(F,Qa(n,d,I+.5,-B-S,S)),F=Math.min(F,Qa(n,d,I+.5,2-B-S,S)),F}getWrap(n,d,m){const y=1<<d.z,x=1/y,S=d.x/y,I=$i(n.x,S,x),B=$i(n.x,S-1,x),F=$i(n.x,S+1,x),U=Math.min(I,B,F);return U===F?1:U===B?-1:0}allowVariableZoom(n,d){return Ft(n,d)>4}allowWorldCopies(){return!1}getTileBoundingVolume(n,d,m,y){return this._boundingVolumeCache.getTileBoundingVolume(n,d,m,y)}_computeTileBoundingVolume(n,d,m,y){var x,S;let I=0,B=0;if(y?.terrain){const F=new a.Z(n.z,d,n.z,n.x,n.y),U=y.terrain.getMinMaxElevation(F);I=(x=U.minElevation)!==null&&x!==void 0?x:Math.min(0,m),B=(S=U.maxElevation)!==null&&S!==void 0?S:Math.max(0,m)}if(I/=a.bu,B/=a.bu,I+=1,B+=1,n.z<=0)return Ja.fromAabb([-B,-B,-B],[B,B,B]);if(n.z===1)return Ja.fromAabb([n.x===0?-B:0,n.y===0?0:-B,-B],[n.x===0?0:B,n.y===0?B:0,B]);{const F=[ro(0,0,n.x,n.y,n.z),ro(a.$,0,n.x,n.y,n.z),ro(a.$,a.$,n.x,n.y,n.z),ro(0,a.$,n.x,n.y,n.z)],U=[];for(const qe of F)U.push(a.aR([],qe,B));if(B!==I)for(const qe of F)U.push(a.aR([],qe,I));n.y===0&&U.push([0,1,0]),n.y===(1<<n.z)-1&&U.push([0,-1,0]);const W=[1,1,1],G=[-1,-1,-1];for(const qe of U)for(let Qe=0;Qe<3;Qe++)W[Qe]=Math.min(W[Qe],qe[Qe]),G[Qe]=Math.max(G[Qe],qe[Qe]);const q=ro(a.$/2,a.$/2,n.x,n.y,n.z),J=a.aW([],[0,1,0],q);a.aV(J,J);const le=a.aW([],q,J);a.aV(le,le);const de=a.aW([],F[2],F[1]);a.aV(de,de);const pe=a.aW([],F[0],F[3]);a.aV(pe,pe),U.push(a.aR([],q,B)),n.y>=(1<<n.z)/2&&U.push(a.aR([],ro(a.$/2,0,n.x,n.y,n.z),B)),n.y<(1<<n.z)/2&&U.push(a.aR([],ro(a.$/2,a.$,n.x,n.y,n.z),B));const ge=pu(q,U),xe=pu(le,U),_e=[-q[0],-q[1],-q[2],ge.max],Te=[q[0],q[1],q[2],-ge.min],Pe=[-le[0],-le[1],-le[2],xe.max],ve=[le[0],le[1],le[2],-xe.min],Re=[...de,0],$e=[...pe,0],We=[];return n.y===0?We.push(a.bt($e,Re,_e),a.bt($e,Re,Te)):We.push(a.bt(Pe,Re,_e),a.bt(Pe,Re,Te),a.bt(Pe,$e,_e),a.bt(Pe,$e,Te)),n.y===(1<<n.z)-1?We.push(a.bt($e,Re,_e),a.bt($e,Re,Te)):We.push(a.bt(ve,Re,_e),a.bt(ve,Re,Te),a.bt(ve,$e,_e),a.bt(ve,$e,Te)),new Ja(We,[_e,Te,Pe,ve,Re,$e],W,G)}}}function pu(b,n){let d=1/0,m=-1/0;for(const y of n){const x=a.aX(b,y);d=Math.min(d,x),m=Math.max(m,x)}return{min:d,max:m}}class fu{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(n){this._helper.setMinZoom(n)}setMaxZoom(n){this._helper.setMaxZoom(n)}setMinPitch(n){this._helper.setMinPitch(n)}setMaxPitch(n){this._helper.setMaxPitch(n)}setRenderWorldCopies(n){this._helper.setRenderWorldCopies(n)}setBearing(n){this._helper.setBearing(n)}setPitch(n){this._helper.setPitch(n)}setRoll(n){this._helper.setRoll(n)}setFov(n){this._helper.setFov(n)}setZoom(n){this._helper.setZoom(n)}setCenter(n){this._helper.setCenter(n)}setElevation(n){this._helper.setElevation(n)}setMinElevationForCurrentTile(n){this._helper.setMinElevationForCurrentTile(n)}setPadding(n){this._helper.setPadding(n)}interpolatePadding(n,d,m){return this._helper.interpolatePadding(n,d,m)}isPaddingEqual(n){return this._helper.isPaddingEqual(n)}resize(n,d){this._helper.resize(n,d)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(n){this._helper.setMaxBounds(n)}overrideNearFarZ(n,d){this._helper.overrideNearFarZ(n,d)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(n){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),n)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(n){}constructor(){this._cachedClippingPlane=a.bv(),this._projectionMatrix=a.b9(),this._globeViewProjMatrix32f=a.b8(),this._globeViewProjMatrixNoCorrection=a.b9(),this._globeViewProjMatrixNoCorrectionInverted=a.b9(),this._globeProjMatrixInverted=a.b9(),this._cameraPosition=a.bp(),this._globeLatitudeErrorCorrectionRadians=0,this._helper=new Fi({calcMatrices:()=>{this._calcMatrices()},getConstrained:(n,d)=>this.getConstrained(n,d)}),this._coveringTilesDetailsProvider=new Co}clone(){const n=new fu;return n.apply(this),n}apply(n,d){this._globeLatitudeErrorCorrectionRadians=d||0,this._helper.apply(n)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){const n=a.bp();return n[0]=this._cameraPosition[0],n[1]=this._cameraPosition[1],n[2]=this._cameraPosition[2],n}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(n){const{overscaledTileID:d,applyGlobeMatrix:m}=n,y=this._helper.getMercatorTileCoordinates(d);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:y,clippingPlane:this._cachedClippingPlane,projectionTransition:m?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(n){const d=this.pitchInRadians,m=this.cameraToCenterDistance/n,y=Math.sin(d)*m,x=Math.cos(d)*m+1,S=1/Math.sqrt(y*y+x*x)*1;let I=-y,B=x;const F=Math.sqrt(I*I+B*B);I/=F,B/=F;const U=[0,I,B];a.bw(U,U,[0,0,0],-this.bearingInRadians),a.bx(U,U,[0,0,0],-1*this.center.lat*Math.PI/180),a.by(U,U,[0,0,0],this.center.lng*Math.PI/180);const W=1/a.aZ(U);return a.aR(U,U,W),[...U,-S*W]}isLocationOccluded(n){return!this.isSurfacePointVisible(qi(n))}transformLightDirection(n){const d=this._helper._center.lng*Math.PI/180,m=this._helper._center.lat*Math.PI/180,y=Math.cos(m),x=[Math.sin(d)*y,Math.sin(m),Math.cos(d)*y],S=[x[2],0,-x[0]],I=[0,0,0];a.aW(I,S,x),a.aV(S,S),a.aV(I,I);const B=[0,0,0];return a.aV(B,[S[0]*n[0]+I[0]*n[1]+x[0]*n[2],S[1]*n[0]+I[1]*n[1]+x[1]*n[2],S[2]*n[0]+I[2]*n[1]+x[2]*n[2]]),B}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(n,d,m){const y=(function(I,B,F){const U=1/(1<<F.z);return new a.a1(I/a.$*U+F.x*U,B/a.$*U+F.y*U)})(n,d,m.canonical),x=(S=y.y,[a.bo(y.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-S*Math.PI*2))-.5*Math.PI]);var S;return this.getCircleRadiusCorrection()/Math.cos(x[1])}projectTileCoordinates(n,d,m,y){const x=m.canonical,S=ro(n,d,x.x,x.y,x.z),I=1+(y?y(n,d):0)/a.bu,B=[S[0]*I,S[1]*I,S[2]*I,1];a.aw(B,B,this._globeViewProjMatrixNoCorrection);const F=this._cachedClippingPlane,U=F[0]*S[0]+F[1]*S[1]+F[2]*S[2]+F[3]<0;return{point:new a.P(B[0]/B[3],B[1]/B[3]),signedDistanceFromCamera:B[3],isOccluded:U}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;const n=fa(this.worldSize,this.center.lat),d=a.ba(),m=a.ba();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*n),a.b4(d,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);const y=this.centerOffset;d[8]=2*-y.x/this._helper._width,d[9]=2*y.y/this._helper._height,this._projectionMatrix=a.b5(d),this._globeProjMatrixInverted=a.ba(),a.aq(this._globeProjMatrixInverted,d),a.M(d,d,[0,0,-this.cameraToCenterDistance]),a.b6(d,d,this.rollInRadians),a.b7(d,d,-this.pitchInRadians),a.b6(d,d,this.bearingInRadians),a.M(d,d,[0,0,-n]);const x=a.bp();x[0]=n,x[1]=n,x[2]=n,a.b7(m,d,this.center.lat*Math.PI/180),a.bz(m,m,-this.center.lng*Math.PI/180),a.N(m,m,x),this._globeViewProjMatrixNoCorrection=m,a.b7(d,d,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),a.bz(d,d,-this.center.lng*Math.PI/180),a.N(d,d,x),this._globeViewProjMatrix32f=new Float32Array(d),this._globeViewProjMatrixNoCorrectionInverted=a.ba(),a.aq(this._globeViewProjMatrixNoCorrectionInverted,m);const S=a.bp();this._cameraPosition=a.bp(),this._cameraPosition[2]=this.cameraToCenterDistance/n,a.bw(this._cameraPosition,this._cameraPosition,S,-this.rollInRadians),a.bx(this._cameraPosition,this._cameraPosition,S,this.pitchInRadians),a.bw(this._cameraPosition,this._cameraPosition,S,-this.bearingInRadians),a.aS(this._cameraPosition,this._cameraPosition,[0,0,1]),a.bx(this._cameraPosition,this._cameraPosition,S,-this.center.lat*Math.PI/180),a.by(this._cameraPosition,this._cameraPosition,S,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(n);const I=a.b5(this._globeViewProjMatrixNoCorrectionInverted);a.N(I,I,[1,1,-1]),this._cachedFrustum=hi.fromInvProjectionMatrix(I,1,0,this._cachedClippingPlane,!0)}calculateFogMatrix(n){a.w("calculateFogMatrix is not supported on globe projection.");const d=a.ba();return a.ag(d),d}getVisibleUnwrappedCoordinates(n){return[new a.b2(0,n)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(n){n&&a.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(n,d){if(!this._globeViewProjMatrixNoCorrection)return 1;const m=qi(n);a.aR(m,m,1+d/a.bu);const y=a.bv();return a.aw(y,[m[0],m[1],m[2],1],this._globeViewProjMatrixNoCorrection),y[2]/y[3]}populateCache(n){}getBounds(){const n=.5*this.width,d=.5*this.height,m=[new a.P(0,0),new a.P(n,0),new a.P(this.width,0),new a.P(this.width,d),new a.P(this.width,this.height),new a.P(n,this.height),new a.P(0,this.height),new a.P(0,d)],y=[];for(const W of m)y.push(this.unprojectScreenPoint(W));let x=0,S=0,I=0,B=0;const F=this.center;for(const W of y){const G=a.bA(F.lng,W.lng),q=a.bA(F.lat,W.lat);G<S&&(S=G),G>x&&(x=G),q<B&&(B=q),q>I&&(I=q)}const U=[F.lng+S,F.lat+B,F.lng+x,F.lat+I];return this.isSurfacePointOnScreen([0,1,0])&&(U[3]=90,U[0]=-180,U[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(U[1]=-90,U[0]=-180,U[2]=180),new qr(U)}getConstrained(n,d){const m=a.ah(n.lat,-a.ai,a.ai),y=a.ah(+d,this.minZoom+di(0,m),this.maxZoom);return{center:new a.S(n.lng,m),zoom:y}}calculateCenterFromCameraLngLatAlt(n,d,m,y){return this._helper.calculateCenterFromCameraLngLatAlt(n,d,m,y)}setLocationAtPoint(n,d){const m=qi(this.unprojectScreenPoint(d)),y=qi(n),x=a.bp();a.bB(x);const S=a.bp();a.by(S,m,x,-this.center.lng*Math.PI/180),a.bx(S,S,x,this.center.lat*Math.PI/180);const I=y[0]*y[0]+y[2]*y[2],B=S[0]*S[0];if(I<B)return;const F=Math.sqrt(I-B),U=-F,W=a.bC(y[0],y[2],S[0],F),G=a.bC(y[0],y[2],S[0],U),q=a.bp();a.by(q,y,x,-W);const J=a.bC(q[1],q[2],S[1],S[2]),le=a.bp();a.by(le,y,x,-G);const de=a.bC(le[1],le[2],S[1],S[2]),pe=.5*Math.PI,ge=J>=-pe&&J<=pe,xe=de>=-pe&&de<=pe;let _e,Te;if(ge&&xe){const $e=this.center.lng*Math.PI/180,We=this.center.lat*Math.PI/180;a.bD(W,$e)+a.bD(J,We)<a.bD(G,$e)+a.bD(de,We)?(_e=W,Te=J):(_e=G,Te=de)}else if(ge)_e=W,Te=J;else{if(!xe)return;_e=G,Te=de}const Pe=_e/Math.PI*180,ve=Te/Math.PI*180,Re=this.center.lat;this.setCenter(new a.S(Pe,a.ah(ve,-90,90))),this.setZoom(this.zoom+di(Re,this.center.lat))}locationToScreenPoint(n,d){const m=qi(n);if(d){const y=d.getElevationForLngLatZoom(n,this._helper._tileZoom);a.aR(m,m,1+y/a.bu)}return this._projectSurfacePointToScreen(m)}_projectSurfacePointToScreen(n){const d=a.bv();return a.aw(d,[...n,1],this._globeViewProjMatrixNoCorrection),d[0]/=d[3],d[1]/=d[3],new a.P((.5*d[0]+.5)*this.width,(.5*-d[1]+.5)*this.height)}screenPointToMercatorCoordinate(n,d){if(d){const m=d.pointCoordinate(n);if(m)return m}return a.a1.fromLngLat(this.unprojectScreenPoint(n))}screenPointToLocation(n,d){var m;return(m=this.screenPointToMercatorCoordinate(n,d))===null||m===void 0?void 0:m.toLngLat()}isPointOnMapSurface(n,d){const m=this._cameraPosition,y=this.getRayDirectionFromPixel(n);return!!this.rayPlanetIntersection(m,y)}getRayDirectionFromPixel(n){const d=a.bv();d[0]=n.x/this.width*2-1,d[1]=-1*(n.y/this.height*2-1),d[2]=1,d[3]=1,a.aw(d,d,this._globeViewProjMatrixNoCorrectionInverted),d[0]/=d[3],d[1]/=d[3],d[2]/=d[3];const m=a.bp();m[0]=d[0]-this._cameraPosition[0],m[1]=d[1]-this._cameraPosition[1],m[2]=d[2]-this._cameraPosition[2];const y=a.bp();return a.aV(y,m),y}isSurfacePointVisible(n){const d=this._cachedClippingPlane;return d[0]*n[0]+d[1]*n[1]+d[2]*n[2]+d[3]>=0}isSurfacePointOnScreen(n){if(!this.isSurfacePointVisible(n))return!1;const d=a.bv();return a.aw(d,[...n,1],this._globeViewProjMatrixNoCorrection),d[0]/=d[3],d[1]/=d[3],d[2]/=d[3],d[0]>-1&&d[0]<1&&d[1]>-1&&d[1]<1&&d[2]>-1&&d[2]<1}rayPlanetIntersection(n,d){const m=a.aX(n,d),y=a.bp(),x=a.bp();a.aR(x,d,m),a.aU(y,n,x);const S=1-a.aX(y,y);if(S<0)return null;const I=a.aX(n,n)-1,B=-m+(m<0?1:-1)*Math.sqrt(S),F=I/B,U=B;return{tMin:Math.min(F,U),tMax:Math.max(F,U)}}unprojectScreenPoint(n){const d=this._cameraPosition,m=this.getRayDirectionFromPixel(n),y=this.rayPlanetIntersection(d,m);if(y){const U=a.bp();a.aS(U,d,[m[0]*y.tMin,m[1]*y.tMin,m[2]*y.tMin]);const W=a.bp();return a.aV(W,U),bc(W)}const x=this._cachedClippingPlane,S=x[0]*m[0]+x[1]*m[1]+x[2]*m[2],I=-a.b1(x,d)/S,B=a.bp();if(I>0)a.aS(B,d,[m[0]*I,m[1]*I,m[2]*I]);else{const U=a.bp();a.aS(U,d,[2*m[0],2*m[1],2*m[2]]);const W=a.b1(this._cachedClippingPlane,U);a.aU(B,U,[this._cachedClippingPlane[0]*W,this._cachedClippingPlane[1]*W,this._cachedClippingPlane[2]*W])}const F=(function(U){const W=a.bp();return W[0]=U[0]*-U[3],W[1]=U[1]*-U[3],W[2]=U[2]*-U[3],{center:W,radius:Math.sqrt(1-U[3]*U[3])}})(x);return bc((function(U,W,G){const q=a.bp();a.aU(q,G,U);const J=a.bp();return a.bq(J,U,q,W/a.a$(q)),J})(F.center,F.radius,B))}getMatrixForModel(n,d){const m=a.S.convert(n),y=1/a.bu,x=a.b9();return a.bz(x,x,m.lng/180*Math.PI),a.b7(x,x,-m.lat/180*Math.PI),a.M(x,x,[0,0,1+d/a.bu]),a.b7(x,x,.5*Math.PI),a.N(x,x,[y,y,y]),x}getProjectionDataForCustomLayer(n=!0){const d=this.getProjectionData({overscaledTileID:new a.Z(0,0,0,0,0),applyGlobeMatrix:n});return d.tileMercatorCoords=[0,0,1,1],d}getFastPathSimpleProjectionMatrix(n){}}class mu{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(n){this._helper.setMinZoom(n)}setMaxZoom(n){this._helper.setMaxZoom(n)}setMinPitch(n){this._helper.setMinPitch(n)}setMaxPitch(n){this._helper.setMaxPitch(n)}setRenderWorldCopies(n){this._helper.setRenderWorldCopies(n)}setBearing(n){this._helper.setBearing(n)}setPitch(n){this._helper.setPitch(n)}setRoll(n){this._helper.setRoll(n)}setFov(n){this._helper.setFov(n)}setZoom(n){this._helper.setZoom(n)}setCenter(n){this._helper.setCenter(n)}setElevation(n){this._helper.setElevation(n)}setMinElevationForCurrentTile(n){this._helper.setMinElevationForCurrentTile(n)}setPadding(n){this._helper.setPadding(n)}interpolatePadding(n,d,m){return this._helper.interpolatePadding(n,d,m)}isPaddingEqual(n){return this._helper.isPaddingEqual(n)}resize(n,d,m=!0){this._helper.resize(n,d,m)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(n){this._helper.setMaxBounds(n)}overrideNearFarZ(n,d){this._helper.overrideNearFarZ(n,d)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(n){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),n)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(n,d){this._globeness=n,this._globeLatitudeErrorCorrectionRadians=d,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().prepareNextFrame(),this._mercatorTransform.getCoveringTilesDetailsProvider().prepareNextFrame()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this._helper=new Fi({calcMatrices:()=>{this._calcMatrices()},getConstrained:(n,d)=>this.getConstrained(n,d)}),this._globeness=1,this._mercatorTransform=new oi,this._verticalPerspectiveTransform=new fu}clone(){const n=new mu;return n._globeness=this._globeness,n._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,n.apply(this),n}apply(n){this._helper.apply(n),this._mercatorTransform.apply(this),this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(n){const d=this._mercatorTransform.getProjectionData(n),m=this._verticalPerspectiveTransform.getProjectionData(n);return{mainMatrix:this.isGlobeRendering?m.mainMatrix:d.mainMatrix,clippingPlane:m.clippingPlane,tileMercatorCoords:m.tileMercatorCoords,projectionTransition:n.applyGlobeMatrix?this._globeness:0,fallbackMatrix:d.fallbackMatrix}}isLocationOccluded(n){return this.currentTransform.isLocationOccluded(n)}transformLightDirection(n){return this.currentTransform.transformLightDirection(n)}getPixelScale(){return a.bk(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return a.bk(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(n,d,m){const y=this._mercatorTransform.getPitchedTextCorrection(n,d,m),x=this._verticalPerspectiveTransform.getPitchedTextCorrection(n,d,m);return a.bk(y,x,this._globeness)}projectTileCoordinates(n,d,m,y){return this.currentTransform.projectTileCoordinates(n,d,m,y)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(n){return this.currentTransform.calculateFogMatrix(n)}getVisibleUnwrappedCoordinates(n){return this.currentTransform.getVisibleUnwrappedCoordinates(n)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(n){this._mercatorTransform.recalculateZoomAndCenter(n),this._verticalPerspectiveTransform.recalculateZoomAndCenter(n)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(n,d){return this.currentTransform.lngLatToCameraDepth(n,d)}populateCache(n){this._mercatorTransform.populateCache(n),this._verticalPerspectiveTransform.populateCache(n)}getBounds(){return this.currentTransform.getBounds()}getConstrained(n,d){return this.currentTransform.getConstrained(n,d)}calculateCenterFromCameraLngLatAlt(n,d,m,y){return this._helper.calculateCenterFromCameraLngLatAlt(n,d,m,y)}setLocationAtPoint(n,d){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(n,d),void this.apply(this._mercatorTransform);this._verticalPerspectiveTransform.setLocationAtPoint(n,d),this.apply(this._verticalPerspectiveTransform)}locationToScreenPoint(n,d){return this.currentTransform.locationToScreenPoint(n,d)}screenPointToMercatorCoordinate(n,d){return this.currentTransform.screenPointToMercatorCoordinate(n,d)}screenPointToLocation(n,d){return this.currentTransform.screenPointToLocation(n,d)}isPointOnMapSurface(n,d){return this.currentTransform.isPointOnMapSurface(n,d)}getRayDirectionFromPixel(n){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(n)}getMatrixForModel(n,d){return this.currentTransform.getMatrixForModel(n,d)}getProjectionDataForCustomLayer(n=!0){const d=this._mercatorTransform.getProjectionDataForCustomLayer(n);if(!this.isGlobeRendering)return d;const m=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(n);return m.fallbackMatrix=d.mainMatrix,m}getFastPathSimpleProjectionMatrix(n){return this.currentTransform.getFastPathSimpleProjectionMatrix(n)}}class bn{get useGlobeControls(){return!0}handlePanInertia(n,d){const m=uh(n,d);return Math.abs(m.lng-d.center.lng)>180&&(m.lng=d.center.lng+179.5*Math.sign(m.lng-d.center.lng)),{easingCenter:m,easingOffset:new a.P(0,0)}}handleMapControlsRollPitchBearingZoom(n,d){const m=n.around,y=d.screenPointToLocation(m);n.bearingDelta&&d.setBearing(d.bearing+n.bearingDelta),n.pitchDelta&&d.setPitch(d.pitch+n.pitchDelta),n.rollDelta&&d.setRoll(d.roll+n.rollDelta);const x=d.zoom;n.zoomDelta&&d.setZoom(d.zoom+n.zoomDelta);const S=d.zoom-x;if(S===0)return;const I=a.bA(d.center.lng,y.lng),B=I/(Math.abs(I/180)+1),F=a.bA(d.center.lat,y.lat),U=d.getRayDirectionFromPixel(m),W=d.cameraPosition,G=-1*a.aX(W,U),q=a.bp();a.aS(q,W,[U[0]*G,U[1]*G,U[2]*G]);const J=a.aZ(q)-1,le=Math.exp(.5*-Math.max(J-.3,0)),de=fa(d.worldSize,d.center.lat)/Math.min(d.width,d.height),pe=a.bn(de,.9,.5,1,.25),ge=(1-a.af(-S))*Math.min(le,pe),xe=d.center.lat,_e=d.zoom,Te=new a.S(d.center.lng+B*ge,a.ah(d.center.lat+F*ge,-a.ai,a.ai));d.setLocationAtPoint(y,m);const Pe=d.center,ve=a.bn(Math.abs(I),45,85,0,1),Re=a.bn(de,.75,.35,0,1),$e=Math.pow(Math.max(ve,Re),.25),We=a.bA(Pe.lng,Te.lng),qe=a.bA(Pe.lat,Te.lat);d.setCenter(new a.S(Pe.lng+We*$e,Pe.lat+qe*$e).wrap()),d.setZoom(_e+di(xe,d.center.lat))}handleMapControlsPan(n,d,m){if(!n.panDelta)return;const y=d.center.lat,x=d.zoom;d.setCenter(uh(n.panDelta,d).wrap()),d.setZoom(x+di(y,d.center.lat))}cameraForBoxAndBearing(n,d,m,y,x){const S=Os(n,d,m,y,x),I=d.left/x.width*2-1,B=(x.width-d.right)/x.width*2-1,F=d.top/x.height*-2+1,U=(x.height-d.bottom)/x.height*-2+1,W=a.bA(m.getWest(),m.getEast())<0,G=W?m.getEast():m.getWest(),q=W?m.getWest():m.getEast(),J=Math.max(m.getNorth(),m.getSouth()),le=Math.min(m.getNorth(),m.getSouth()),de=G+.5*a.bA(G,q),pe=J+.5*a.bA(J,le),ge=x.clone();ge.setCenter(S.center),ge.setBearing(S.bearing),ge.setPitch(0),ge.setRoll(0),ge.setZoom(S.zoom);const xe=ge.modelViewProjectionMatrix,_e=[qi(m.getNorthWest()),qi(m.getNorthEast()),qi(m.getSouthWest()),qi(m.getSouthEast()),qi(new a.S(q,pe)),qi(new a.S(G,pe)),qi(new a.S(de,J)),qi(new a.S(de,le))],Te=qi(S.center);let Pe=Number.POSITIVE_INFINITY;for(const ve of _e)I<0&&(Pe=bn.getLesserNonNegativeNonNull(Pe,bn.solveVectorScale(ve,Te,xe,"x",I))),B>0&&(Pe=bn.getLesserNonNegativeNonNull(Pe,bn.solveVectorScale(ve,Te,xe,"x",B))),F>0&&(Pe=bn.getLesserNonNegativeNonNull(Pe,bn.solveVectorScale(ve,Te,xe,"y",F))),U<0&&(Pe=bn.getLesserNonNegativeNonNull(Pe,bn.solveVectorScale(ve,Te,xe,"y",U)));if(Number.isFinite(Pe)&&Pe!==0)return S.zoom=ge.zoom+a.ak(Pe),S;bd()}handleJumpToCenterZoom(n,d){const m=n.center.lat,y=n.getConstrained(d.center?a.S.convert(d.center):n.center,n.zoom).center;n.setCenter(y.wrap());const x=d.zoom!==void 0?+d.zoom:n.zoom+di(m,y.lat);n.zoom!==x&&n.setZoom(x)}handleEaseTo(n,d){const m=n.zoom,y=n.center,x=n.padding,S={roll:n.roll,pitch:n.pitch,bearing:n.bearing},I={roll:d.roll===void 0?n.roll:d.roll,pitch:d.pitch===void 0?n.pitch:d.pitch,bearing:d.bearing===void 0?n.bearing:d.bearing},B=d.zoom!==void 0,F=!n.isPaddingEqual(d.padding);let U=!1;const W=d.center?a.S.convert(d.center):y,G=n.getConstrained(W,m).center;Oi(n,G);const q=n.clone();q.setCenter(G),q.setZoom(B?+d.zoom:m+di(y.lat,W.lat)),q.setBearing(d.bearing);const J=new a.P(a.ah(n.centerPoint.x+d.offsetAsPoint.x,0,n.width),a.ah(n.centerPoint.y+d.offsetAsPoint.y,0,n.height));q.setLocationAtPoint(G,J);const le=(d.offset&&d.offsetAsPoint.mag())>0?q.center:G,de=B?+d.zoom:m+di(y.lat,le.lat),pe=m+di(y.lat,0),ge=de+di(le.lat,0),xe=a.bA(y.lng,le.lng),_e=a.bA(y.lat,le.lat),Te=a.af(ge-pe);return U=de!==m,{easeFunc:Pe=>{if(a.be(S,I)||cn({startEulerAngles:S,endEulerAngles:I,tr:n,k:Pe,useSlerp:S.roll!=I.roll}),F&&n.interpolatePadding(x,d.padding,Pe),d.around)a.w("Easing around a point is not supported under globe projection."),n.setLocationAtPoint(d.around,d.aroundPoint);else{const ve=ge>pe?Math.min(2,Te):Math.max(.5,Te),Re=Math.pow(ve,1-Pe),$e=xd(y,xe,_e,Pe*Re);n.setCenter($e.wrap())}if(U){const ve=a.C.number(pe,ge,Pe)+di(0,n.center.lat);n.setZoom(ve)}},isZooming:U,elevationCenter:le}}handleFlyTo(n,d){const m=d.zoom!==void 0,y=n.center,x=n.zoom,S=n.padding,I=!n.isPaddingEqual(d.padding),B=n.getConstrained(a.S.convert(d.center||d.locationAtOffset),x).center,F=m?+d.zoom:n.zoom+di(n.center.lat,B.lat),U=n.clone();U.setCenter(B),U.setZoom(F),U.setBearing(d.bearing);const W=new a.P(a.ah(n.centerPoint.x+d.offsetAsPoint.x,0,n.width),a.ah(n.centerPoint.y+d.offsetAsPoint.y,0,n.height));U.setLocationAtPoint(B,W);const G=U.center;Oi(n,G);const q=(function(_e,Te,Pe){const ve=qi(Te),Re=qi(Pe),$e=a.aX(ve,Re),We=Math.acos($e),qe=Ml(_e);return We/(2*Math.PI)*qe})(n,y,G),J=x+di(y.lat,0),le=F+di(G.lat,0),de=a.af(le-J);let pe;if(typeof d.minZoom=="number"){const _e=+d.minZoom+di(G.lat,0),Te=Math.min(_e,J,le)+di(0,G.lat),Pe=n.getConstrained(G,Te).zoom+di(G.lat,0);pe=a.af(Pe-J)}const ge=a.bA(y.lng,G.lng),xe=a.bA(y.lat,G.lat);return{easeFunc:(_e,Te,Pe,ve)=>{const Re=xd(y,ge,xe,Pe);I&&n.interpolatePadding(S,d.padding,_e);const $e=_e===1?G:Re;n.setCenter($e.wrap());const We=J+a.ak(Te);n.setZoom(_e===1?F:We+di(0,$e.lat))},scaleOfZoom:de,targetCenter:G,scaleOfMinZoom:pe,pixelPathLength:q}}static solveVectorScale(n,d,m,y,x){const S=y==="x"?[m[0],m[4],m[8],m[12]]:[m[1],m[5],m[9],m[13]],I=[m[3],m[7],m[11],m[15]],B=n[0]*S[0]+n[1]*S[1]+n[2]*S[2],F=n[0]*I[0]+n[1]*I[1]+n[2]*I[2],U=d[0]*S[0]+d[1]*S[1]+d[2]*S[2],W=d[0]*I[0]+d[1]*I[1]+d[2]*I[2];return U+x*F===B+x*W||I[3]*(B-U)+S[3]*(W-F)+B*W==U*F?null:(U+S[3]-x*W-x*I[3])/(U-B-x*W+x*F)}static getLesserNonNegativeNonNull(n,d){return d!==null&&d>=0&&d<n?d:n}}class Qp{constructor(n){this._globe=n,this._mercatorCameraHelper=new In,this._verticalPerspectiveCameraHelper=new bn}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(n,d){return this.currentHelper.handlePanInertia(n,d)}handleMapControlsRollPitchBearingZoom(n,d){return this.currentHelper.handleMapControlsRollPitchBearingZoom(n,d)}handleMapControlsPan(n,d,m){this.currentHelper.handleMapControlsPan(n,d,m)}cameraForBoxAndBearing(n,d,m,y,x){return this.currentHelper.cameraForBoxAndBearing(n,d,m,y,x)}handleJumpToCenterZoom(n,d){this.currentHelper.handleJumpToCenterZoom(n,d)}handleEaseTo(n,d){return this.currentHelper.handleEaseTo(n,d)}handleFlyTo(n,d){return this.currentHelper.handleFlyTo(n,d)}}const hh=(b,n)=>a.y(b,n&&n.filter((d=>d.identifier!=="source.canvas"))),zm=a.bE();class Ed extends a.E{constructor(n,d={}){super(),this._rtlPluginLoaded=()=>{for(const m in this.sourceCaches){const y=this.sourceCaches[m].getSource().type;y!=="vector"&&y!=="geojson"||this.sourceCaches[m].reload()}},this.map=n,this.dispatcher=new gr(Tr(),n._getMapId()),this.dispatcher.registerMessageHandler("GG",((m,y)=>this.getGlyphs(m,y))),this.dispatcher.registerMessageHandler("GI",((m,y)=>this.getImages(m,y))),this.imageManager=new it,this.imageManager.setEventedParent(this),this.glyphManager=new Nt(n._requestManager,d.localIdeographFontFamily),this.lineAtlas=new wt(256,512),this.crossTileSymbolIndex=new ie,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new a.bF,this._loaded=!1,this._availableImages=[],this._globalState={},this._resetUpdates(),this.dispatcher.broadcast("SR",a.bG()),Ds().on(Go,this._rtlPluginLoaded),this.on("data",(m=>{if(m.dataType!=="source"||m.sourceDataType!=="metadata")return;const y=this.sourceCaches[m.sourceId];if(!y)return;const x=y.getSource();if(x&&x.vectorLayerIds)for(const S in this._layers){const I=this._layers[S];I.source===x.id&&this._validateLayer(I)}}))}setGlobalStateProperty(n,d){var m,y,x;this._checkLoaded();const S=d===null?(x=(y=(m=this.stylesheet.state)===null||m===void 0?void 0:m[n])===null||y===void 0?void 0:y.default)!==null&&x!==void 0?x:null:d;if(a.bH(S,this._globalState[n]))return this;this._globalState[n]=S;const I=this._findGlobalStateAffectedSources([n]);for(const B in this.sourceCaches)I.has(B)&&(this._reloadSource(B),this._changed=!0)}getGlobalState(){return this._globalState}setGlobalState(n){this._checkLoaded();const d=[];for(const y in n)!a.bH(this._globalState[y],n[y].default)&&(d.push(y),this._globalState[y]=n[y].default);const m=this._findGlobalStateAffectedSources(d);for(const y in this.sourceCaches)m.has(y)&&(this._reloadSource(y),this._changed=!0)}_findGlobalStateAffectedSources(n){if(n.length===0)return new Set;const d=new Set;for(const m in this._layers){const y=this._layers[m],x=y.getLayoutAffectingGlobalStateRefs();for(const S of n)x.has(S)&&d.add(y.source)}return d}loadURL(n,d={},m){this.fire(new a.l("dataloading",{dataType:"style"})),d.validate=typeof d.validate!="boolean"||d.validate;const y=this.map._requestManager.transformRequest(n,"Style");this._loadStyleRequest=new AbortController;const x=this._loadStyleRequest;a.j(y,this._loadStyleRequest).then((S=>{this._loadStyleRequest=null,this._load(S.data,d,m)})).catch((S=>{this._loadStyleRequest=null,S&&!x.signal.aborted&&this.fire(new a.k(S))}))}loadJSON(n,d={},m){this.fire(new a.l("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,L.frameAsync(this._frameRequest).then((()=>{this._frameRequest=null,d.validate=d.validate!==!1,this._load(n,d,m)})).catch((()=>{}))}loadEmpty(){this.fire(new a.l("dataloading",{dataType:"style"})),this._load(zm,{validate:!1})}_load(n,d,m){var y,x,S;const I=d.transformStyle?d.transformStyle(m,n):n;if(!d.validate||!hh(this,a.z(I))){this._loaded=!0,this.stylesheet=I;for(const B in I.sources)this.addSource(B,I.sources[B],{validate:!1});I.sprite?this._loadSprite(I.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(I.glyphs),this._createLayers(),this.light=new Qt(this.stylesheet.light),this._setProjectionInternal(((y=this.stylesheet.projection)===null||y===void 0?void 0:y.type)||"mercator"),this.sky=new tt(this.stylesheet.sky),this.map.setTerrain((x=this.stylesheet.terrain)!==null&&x!==void 0?x:null),this.setGlobalState((S=this.stylesheet.state)!==null&&S!==void 0?S:null),this.fire(new a.l("data",{dataType:"style"})),this.fire(new a.l("style.load"))}}_createLayers(){const n=a.bI(this.stylesheet.layers);this.dispatcher.broadcast("SL",n),this._order=n.map((d=>d.id)),this._layers={},this._serializedLayers=null;for(const d of n){const m=a.bJ(d);m.setEventedParent(this,{layer:{id:d.id}}),this._layers[d.id]=m}}_loadSprite(n,d=!1,m=void 0){let y;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,(function(x,S,I,B){return a._(this,void 0,void 0,(function*(){const F=Fe(x),U=I>1?"@2x":"",W={},G={};for(const{id:q,url:J}of F){const le=S.transformRequest(Ke(J,U,".json"),"SpriteJSON");W[q]=a.j(le,B);const de=S.transformRequest(Ke(J,U,".png"),"SpriteImage");G[q]=we.getImage(de,B)}return yield Promise.all([...Object.values(W),...Object.values(G)]),(function(q,J){return a._(this,void 0,void 0,(function*(){const le={};for(const de in q){le[de]={};const pe=L.getImageCanvasContext((yield J[de]).data),ge=(yield q[de]).data;for(const xe in ge){const{width:_e,height:Te,x:Pe,y:ve,sdf:Re,pixelRatio:$e,stretchX:We,stretchY:qe,content:Qe,textFitWidth:bt,textFitHeight:Et}=ge[xe];le[de][xe]={data:null,pixelRatio:$e,sdf:Re,stretchX:We,stretchY:qe,content:Qe,textFitWidth:bt,textFitHeight:Et,spriteData:{width:_e,height:Te,x:Pe,y:ve,context:pe}}}}return le}))})(W,G)}))})(n,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then((x=>{if(this._spriteRequest=null,x)for(const S in x){this._spritesImagesIds[S]=[];const I=this._spritesImagesIds[S]?this._spritesImagesIds[S].filter((B=>!(B in x))):[];for(const B of I)this.imageManager.removeImage(B),this._changedImages[B]=!0;for(const B in x[S]){const F=S==="default"?B:`${S}:${B}`;this._spritesImagesIds[S].push(F),F in this.imageManager.images?this.imageManager.updateImage(F,x[S][B],!1):this.imageManager.addImage(F,x[S][B]),d&&(this._changedImages[F]=!0)}}})).catch((x=>{this._spriteRequest=null,y=x,this.fire(new a.k(y))})).finally((()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),d&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.l("data",{dataType:"style"})),m&&m(y)}))}_unloadSprite(){for(const n of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(n),this._changedImages[n]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.l("data",{dataType:"style"}))}_validateLayer(n){const d=this.sourceCaches[n.source];if(!d)return;const m=n.sourceLayer;if(!m)return;const y=d.getSource();(y.type==="geojson"||y.vectorLayerIds&&y.vectorLayerIds.indexOf(m)===-1)&&this.fire(new a.k(new Error(`Source layer "${m}" does not exist on source "${y.id}" as specified by style layer "${n.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const n in this.sourceCaches)if(!this.sourceCaches[n].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(n,d=!1){const m=this._serializedAllLayers();if(!n||n.length===0)return Object.values(d?a.bK(m):m);const y=[];for(const x of n)if(m[x]){const S=d?a.bK(m[x]):m[x];y.push(S)}return y}_serializedAllLayers(){let n=this._serializedLayers;if(n)return n;n=this._serializedLayers={};const d=Object.keys(this._layers);for(const m of d){const y=this._layers[m];y.type!=="custom"&&(n[m]=y.serialize())}return n}hasTransitions(){var n,d,m;if(!((n=this.light)===null||n===void 0)&&n.hasTransition()||!((d=this.sky)===null||d===void 0)&&d.hasTransition()||!((m=this.projection)===null||m===void 0)&&m.hasTransition())return!0;for(const y in this.sourceCaches)if(this.sourceCaches[y].hasTransition())return!0;for(const y in this._layers)if(this._layers[y].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(n){if(!this._loaded)return;const d=this._changed;if(d){const y=Object.keys(this._updatedLayers),x=Object.keys(this._removedLayers);(y.length||x.length)&&this._updateWorkerLayers(y,x);for(const S in this._updatedSources){const I=this._updatedSources[S];if(I==="reload")this._reloadSource(S);else{if(I!=="clear")throw new Error(`Invalid action ${I}`);this._clearSource(S)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const S in this._updatedPaintProps)this._layers[S].updateTransitions(n);this.light.updateTransitions(n),this.sky.updateTransitions(n),this._resetUpdates()}const m={};for(const y in this.sourceCaches){const x=this.sourceCaches[y];m[y]=x.used,x.used=!1}for(const y of this._order){const x=this._layers[y];x.recalculate(n,this._availableImages),!x.isHidden(n.zoom)&&x.source&&(this.sourceCaches[x.source].used=!0)}for(const y in m){const x=this.sourceCaches[y];!!m[y]!=!!x.used&&x.fire(new a.l("data",{sourceDataType:"visibility",dataType:"source",sourceId:y}))}this.light.recalculate(n),this.sky.recalculate(n),this.projection.recalculate(n),this.z=n.zoom,d&&this.fire(new a.l("data",{dataType:"style"}))}_updateTilesForChangedImages(){const n=Object.keys(this._changedImages);if(n.length){for(const d in this.sourceCaches)this.sourceCaches[d].reloadTilesForDependencies(["icons","patterns"],n);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const n in this.sourceCaches)this.sourceCaches[n].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(n,d){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(n,!1),removedIds:d})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(n,d={}){var m;this._checkLoaded();const y=this.serialize();if(n=d.transformStyle?d.transformStyle(y,n):n,((m=d.validate)===null||m===void 0||m)&&hh(this,a.z(n)))return!1;(n=a.bK(n)).layers=a.bI(n.layers);const x=a.bL(y,n),S=this._getOperationsToPerform(x);if(S.unimplemented.length>0)throw new Error(`Unimplemented: ${S.unimplemented.join(", ")}.`);if(S.operations.length===0)return!1;for(const I of S.operations)I();return this.stylesheet=n,this._serializedLayers=null,!0}_getOperationsToPerform(n){const d=[],m=[];for(const y of n)switch(y.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":d.push((()=>this.addLayer.apply(this,y.args)));break;case"removeLayer":d.push((()=>this.removeLayer.apply(this,y.args)));break;case"setPaintProperty":d.push((()=>this.setPaintProperty.apply(this,y.args)));break;case"setLayoutProperty":d.push((()=>this.setLayoutProperty.apply(this,y.args)));break;case"setFilter":d.push((()=>this.setFilter.apply(this,y.args)));break;case"addSource":d.push((()=>this.addSource.apply(this,y.args)));break;case"removeSource":d.push((()=>this.removeSource.apply(this,y.args)));break;case"setLayerZoomRange":d.push((()=>this.setLayerZoomRange.apply(this,y.args)));break;case"setLight":d.push((()=>this.setLight.apply(this,y.args)));break;case"setGeoJSONSourceData":d.push((()=>this.setGeoJSONSourceData.apply(this,y.args)));break;case"setGlyphs":d.push((()=>this.setGlyphs.apply(this,y.args)));break;case"setSprite":d.push((()=>this.setSprite.apply(this,y.args)));break;case"setTerrain":d.push((()=>this.map.setTerrain.apply(this,y.args)));break;case"setSky":d.push((()=>this.setSky.apply(this,y.args)));break;case"setProjection":this.setProjection.apply(this,y.args);break;case"setGlobalState":d.push((()=>this.setGlobalState.apply(this,y.args)));break;case"setTransition":d.push((()=>{}));break;default:m.push(y.command)}return{operations:d,unimplemented:m}}addImage(n,d){if(this.getImage(n))return this.fire(new a.k(new Error(`An image named "${n}" already exists.`)));this.imageManager.addImage(n,d),this._afterImageUpdated(n)}updateImage(n,d){this.imageManager.updateImage(n,d)}getImage(n){return this.imageManager.getImage(n)}removeImage(n){if(!this.getImage(n))return this.fire(new a.k(new Error(`An image named "${n}" does not exist.`)));this.imageManager.removeImage(n),this._afterImageUpdated(n)}_afterImageUpdated(n){this._availableImages=this.imageManager.listImages(),this._changedImages[n]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.l("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(n,d,m={}){if(this._checkLoaded(),this.sourceCaches[n]!==void 0)throw new Error(`Source "${n}" already exists.`);if(!d.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(d).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(d.type)>=0&&this._validate(a.z.source,`sources.${n}`,d,null,m))return;this.map&&this.map._collectResourceTiming&&(d.collectResourceTiming=!0);const y=this.sourceCaches[n]=new Sr(n,d,this.dispatcher);y.style=this,y.setEventedParent(this,(()=>({isSourceLoaded:y.loaded(),source:y.serialize(),sourceId:n}))),y.onAdd(this.map),this._changed=!0}removeSource(n){if(this._checkLoaded(),this.sourceCaches[n]===void 0)throw new Error("There is no source with this ID");for(const m in this._layers)if(this._layers[m].source===n)return this.fire(new a.k(new Error(`Source "${n}" cannot be removed while layer "${m}" is using it.`)));const d=this.sourceCaches[n];delete this.sourceCaches[n],delete this._updatedSources[n],d.fire(new a.l("data",{sourceDataType:"metadata",dataType:"source",sourceId:n})),d.setEventedParent(null),d.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(n,d){if(this._checkLoaded(),this.sourceCaches[n]===void 0)throw new Error(`There is no source with this ID=${n}`);const m=this.sourceCaches[n].getSource();if(m.type!=="geojson")throw new Error(`geojsonSource.type is ${m.type}, which is !== 'geojson`);m.setData(d),this._changed=!0}getSource(n){return this.sourceCaches[n]&&this.sourceCaches[n].getSource()}addLayer(n,d,m={}){this._checkLoaded();const y=n.id;if(this.getLayer(y))return void this.fire(new a.k(new Error(`Layer "${y}" already exists on this map.`)));let x;if(n.type==="custom"){if(hh(this,a.bM(n)))return;x=a.bJ(n)}else{if("source"in n&&typeof n.source=="object"&&(this.addSource(y,n.source),n=a.bK(n),n=a.e(n,{source:y})),this._validate(a.z.layer,`layers.${y}`,n,{arrayIndex:-1},m))return;x=a.bJ(n),this._validateLayer(x),x.setEventedParent(this,{layer:{id:y}})}const S=d?this._order.indexOf(d):this._order.length;if(d&&S===-1)this.fire(new a.k(new Error(`Cannot add layer "${y}" before non-existing layer "${d}".`)));else{if(this._order.splice(S,0,y),this._layerOrderChanged=!0,this._layers[y]=x,this._removedLayers[y]&&x.source&&x.type!=="custom"){const I=this._removedLayers[y];delete this._removedLayers[y],I.type!==x.type?this._updatedSources[x.source]="clear":(this._updatedSources[x.source]="reload",this.sourceCaches[x.source].pause())}this._updateLayer(x),x.onAdd&&x.onAdd(this.map)}}moveLayer(n,d){if(this._checkLoaded(),this._changed=!0,!this._layers[n])return void this.fire(new a.k(new Error(`The layer '${n}' does not exist in the map's style and cannot be moved.`)));if(n===d)return;const m=this._order.indexOf(n);this._order.splice(m,1);const y=d?this._order.indexOf(d):this._order.length;d&&y===-1?this.fire(new a.k(new Error(`Cannot move layer "${n}" before non-existing layer "${d}".`))):(this._order.splice(y,0,n),this._layerOrderChanged=!0)}removeLayer(n){this._checkLoaded();const d=this._layers[n];if(!d)return void this.fire(new a.k(new Error(`Cannot remove non-existing layer "${n}".`)));d.setEventedParent(null);const m=this._order.indexOf(n);this._order.splice(m,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[n]=d,delete this._layers[n],this._serializedLayers&&delete this._serializedLayers[n],delete this._updatedLayers[n],delete this._updatedPaintProps[n],d.onRemove&&d.onRemove(this.map)}getLayer(n){return this._layers[n]}getLayersOrder(){return[...this._order]}hasLayer(n){return n in this._layers}setLayerZoomRange(n,d,m){this._checkLoaded();const y=this.getLayer(n);y?y.minzoom===d&&y.maxzoom===m||(d!=null&&(y.minzoom=d),m!=null&&(y.maxzoom=m),this._updateLayer(y)):this.fire(new a.k(new Error(`Cannot set the zoom range of non-existing layer "${n}".`)))}setFilter(n,d,m={}){this._checkLoaded();const y=this.getLayer(n);if(y){if(!a.bH(y.filter,d))return d==null?(y.setFilter(void 0),void this._updateLayer(y)):void(this._validate(a.z.filter,`layers.${y.id}.filter`,d,null,m)||(y.setFilter(a.bK(d)),this._updateLayer(y)))}else this.fire(new a.k(new Error(`Cannot filter non-existing layer "${n}".`)))}getFilter(n){return a.bK(this.getLayer(n).filter)}setLayoutProperty(n,d,m,y={}){this._checkLoaded();const x=this.getLayer(n);x?a.bH(x.getLayoutProperty(d),m)||(x.setLayoutProperty(d,m,y),this._updateLayer(x)):this.fire(new a.k(new Error(`Cannot style non-existing layer "${n}".`)))}getLayoutProperty(n,d){const m=this.getLayer(n);if(m)return m.getLayoutProperty(d);this.fire(new a.k(new Error(`Cannot get style of non-existing layer "${n}".`)))}setPaintProperty(n,d,m,y={}){this._checkLoaded();const x=this.getLayer(n);x?a.bH(x.getPaintProperty(d),m)||(x.setPaintProperty(d,m,y)&&this._updateLayer(x),this._changed=!0,this._updatedPaintProps[n]=!0,this._serializedLayers=null):this.fire(new a.k(new Error(`Cannot style non-existing layer "${n}".`)))}getPaintProperty(n,d){return this.getLayer(n).getPaintProperty(d)}setFeatureState(n,d){this._checkLoaded();const m=n.source,y=n.sourceLayer,x=this.sourceCaches[m];if(x===void 0)return void this.fire(new a.k(new Error(`The source '${m}' does not exist in the map's style.`)));const S=x.getSource().type;S==="geojson"&&y?this.fire(new a.k(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):S!=="vector"||y?(n.id===void 0&&this.fire(new a.k(new Error("The feature id parameter must be provided."))),x.setFeatureState(y,n.id,d)):this.fire(new a.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(n,d){this._checkLoaded();const m=n.source,y=this.sourceCaches[m];if(y===void 0)return void this.fire(new a.k(new Error(`The source '${m}' does not exist in the map's style.`)));const x=y.getSource().type,S=x==="vector"?n.sourceLayer:void 0;x!=="vector"||S?d&&typeof n.id!="string"&&typeof n.id!="number"?this.fire(new a.k(new Error("A feature id is required to remove its specific state property."))):y.removeFeatureState(S,n.id,d):this.fire(new a.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(n){this._checkLoaded();const d=n.source,m=n.sourceLayer,y=this.sourceCaches[d];if(y!==void 0)return y.getSource().type!=="vector"||m?(n.id===void 0&&this.fire(new a.k(new Error("The feature id parameter must be provided."))),y.getFeatureState(m,n.id)):void this.fire(new a.k(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new a.k(new Error(`The source '${d}' does not exist in the map's style.`)))}getTransition(){return a.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const n=a.bN(this.sourceCaches,(x=>x.serialize())),d=this._serializeByIds(this._order,!0),m=this.map.getTerrain()||void 0,y=this.stylesheet;return a.bO({version:y.version,name:y.name,metadata:y.metadata,light:y.light,sky:y.sky,center:y.center,zoom:y.zoom,bearing:y.bearing,pitch:y.pitch,sprite:y.sprite,glyphs:y.glyphs,transition:y.transition,projection:y.projection,sources:n,layers:d,terrain:m},(x=>x!==void 0))}_updateLayer(n){this._updatedLayers[n.id]=!0,n.source&&!this._updatedSources[n.source]&&this.sourceCaches[n.source].getSource().type!=="raster"&&(this._updatedSources[n.source]="reload",this.sourceCaches[n.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(n){const d=S=>this._layers[S].type==="fill-extrusion",m={},y=[];for(let S=this._order.length-1;S>=0;S--){const I=this._order[S];if(d(I)){m[I]=S;for(const B of n){const F=B[I];if(F)for(const U of F)y.push(U)}}}y.sort(((S,I)=>I.intersectionZ-S.intersectionZ));const x=[];for(let S=this._order.length-1;S>=0;S--){const I=this._order[S];if(d(I))for(let B=y.length-1;B>=0;B--){const F=y[B].feature;if(m[F.layer.id]<S)break;x.push(F),y.pop()}else for(const B of n){const F=B[I];if(F)for(const U of F)x.push(U.feature)}}return x}queryRenderedFeatures(n,d,m){d&&d.filter&&this._validate(a.z.filter,"queryRenderedFeatures.filter",d.filter,null,d);const y={};if(d&&d.layers){if(!(Array.isArray(d.layers)||d.layers instanceof Set))return this.fire(new a.k(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(const F of d.layers){const U=this._layers[F];if(!U)return this.fire(new a.k(new Error(`The layer '${F}' does not exist in the map's style and cannot be queried for features.`))),[];y[U.source]=!0}}const x=[];d.availableImages=this._availableImages;const S=this._serializedAllLayers(),I=d.layers instanceof Set?d.layers:Array.isArray(d.layers)?new Set(d.layers):null,B=Object.assign(Object.assign({},d),{layers:I});for(const F in this.sourceCaches)d.layers&&!y[F]||x.push(er(this.sourceCaches[F],this._layers,S,n,B,m,this.map.terrain?(U,W,G)=>this.map.terrain.getElevation(U,W,G):void 0));return this.placement&&x.push((function(F,U,W,G,q,J,le){const de={},pe=J.queryRenderedSymbols(G),ge=[];for(const xe of Object.keys(pe).map(Number))ge.push(le[xe]);ge.sort(Lr);for(const xe of ge){const _e=xe.featureIndex.lookupSymbolFeatures(pe[xe.bucketInstanceId],U,xe.bucketIndex,xe.sourceLayerIndex,q.filter,q.layers,q.availableImages,F);for(const Te in _e){const Pe=de[Te]=de[Te]||[],ve=_e[Te];ve.sort(((Re,$e)=>{const We=xe.featureSortOrder;if(We){const qe=We.indexOf(Re.featureIndex);return We.indexOf($e.featureIndex)-qe}return $e.featureIndex-Re.featureIndex}));for(const Re of ve)Pe.push(Re)}}return(function(xe,_e,Te){for(const Pe in xe)for(const ve of xe[Pe])yn(ve,Te[_e[Pe].source]);return xe})(de,F,W)})(this._layers,S,this.sourceCaches,n,B,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(x)}querySourceFeatures(n,d){d&&d.filter&&this._validate(a.z.filter,"querySourceFeatures.filter",d.filter,null,d);const m=this.sourceCaches[n];return m?(function(y,x){const S=y.getRenderableIds().map((F=>y.getTileByID(F))),I=[],B={};for(let F=0;F<S.length;F++){const U=S[F],W=U.tileID.canonical.key;B[W]||(B[W]=!0,U.querySourceFeatures(I,x))}return I})(m,d):[]}getLight(){return this.light.getLight()}setLight(n,d={}){this._checkLoaded();const m=this.light.getLight();let y=!1;for(const S in n)if(!a.bH(n[S],m[S])){y=!0;break}if(!y)return;const x={now:L.now(),transition:a.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(n,d),this.light.updateTransitions(x)}getProjection(){var n;return(n=this.stylesheet)===null||n===void 0?void 0:n.projection}setProjection(n){if(this._checkLoaded(),this.projection){if(this.projection.name===n.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=n,this._setProjectionInternal(n.type)}getSky(){var n;return(n=this.stylesheet)===null||n===void 0?void 0:n.sky}setSky(n,d={}){this._checkLoaded();const m=this.getSky();let y=!1;if(!n&&!m)return;if(n&&!m)y=!0;else if(!n&&m)y=!0;else for(const S in n)if(!a.bH(n[S],m[S])){y=!0;break}if(!y)return;const x={now:L.now(),transition:a.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=n,this.sky.setSky(n,d),this.sky.updateTransitions(x)}_setProjectionInternal(n){const d=(function(m){if(Array.isArray(m)){const y=new vc({type:m});return{projection:y,transform:new mu,cameraHelper:new Qp(y)}}switch(m){case"mercator":return{projection:new ar,transform:new oi,cameraHelper:new In};case"globe":{const y=new vc({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:y,transform:new mu,cameraHelper:new Qp(y)}}case"vertical-perspective":return{projection:new yc,transform:new fu,cameraHelper:new bn};default:return a.w(`Unknown projection name: ${m}. Falling back to mercator projection.`),{projection:new ar,transform:new oi,cameraHelper:new In}}})(n);this.projection=d.projection,this.map.migrateProjection(d.transform,d.cameraHelper);for(const m in this.sourceCaches)this.sourceCaches[m].reload()}_validate(n,d,m,y,x={}){return(!x||x.validate!==!1)&&hh(this,n.call(a.z,a.e({key:d,style:this.serialize(),value:m,styleSpec:a.v},y)))}_remove(n=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),Ds().off(Go,this._rtlPluginLoaded);for(const d in this._layers)this._layers[d].setEventedParent(null);for(const d in this.sourceCaches){const m=this.sourceCaches[d];m.setEventedParent(null),m.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),n&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(n)}_clearSource(n){this.sourceCaches[n].clearTiles()}_reloadSource(n){this.sourceCaches[n].resume(),this.sourceCaches[n].reload()}_updateSources(n){for(const d in this.sourceCaches)this.sourceCaches[d].update(n,this.map.terrain)}_generateCollisionBoxes(){for(const n in this.sourceCaches)this._reloadSource(n)}_updatePlacement(n,d,m,y,x=!1){let S=!1,I=!1;const B={};for(const F of this._order){const U=this._layers[F];if(U.type!=="symbol")continue;if(!B[U.source]){const G=this.sourceCaches[U.source];B[U.source]=G.getRenderableIds(!0).map((q=>G.getTileByID(q))).sort(((q,J)=>J.tileID.overscaledZ-q.tileID.overscaledZ||(q.tileID.isLessThan(J.tileID)?-1:1)))}const W=this.crossTileSymbolIndex.addLayer(U,B[U.source],n.center.lng);S=S||W}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((x=x||this._layerOrderChanged||m===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(L.now(),n.zoom))&&(this.pauseablePlacement=new Za(n,this.map.terrain,this._order,x,d,m,y,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,B),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(L.now()),I=!0),S&&this.pauseablePlacement.placement.setStale()),I||S)for(const F of this._order){const U=this._layers[F];U.type==="symbol"&&this.placement.updateLayerOpacities(U,B[U.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(L.now())}_releaseSymbolFadeTiles(){for(const n in this.sourceCaches)this.sourceCaches[n].releaseSymbolFadeTiles()}getImages(n,d){return a._(this,void 0,void 0,(function*(){const m=yield this.imageManager.getImages(d.icons);this._updateTilesForChangedImages();const y=this.sourceCaches[d.source];return y&&y.setDependencies(d.tileID.key,d.type,d.icons),m}))}getGlyphs(n,d){return a._(this,void 0,void 0,(function*(){const m=yield this.glyphManager.getGlyphs(d.stacks),y=this.sourceCaches[d.source];return y&&y.setDependencies(d.tileID.key,d.type,[""]),m}))}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(n,d={}){this._checkLoaded(),n&&this._validate(a.z.glyphs,"glyphs",n,null,d)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=n,this.glyphManager.entries={},this.glyphManager.setURL(n))}addSprite(n,d,m={},y){this._checkLoaded();const x=[{id:n,url:d}],S=[...Fe(this.stylesheet.sprite),...x];this._validate(a.z.sprite,"sprite",S,null,m)||(this.stylesheet.sprite=S,this._loadSprite(x,!0,y))}removeSprite(n){this._checkLoaded();const d=Fe(this.stylesheet.sprite);if(d.find((m=>m.id===n))){if(this._spritesImagesIds[n])for(const m of this._spritesImagesIds[n])this.imageManager.removeImage(m),this._changedImages[m]=!0;d.splice(d.findIndex((m=>m.id===n)),1),this.stylesheet.sprite=d.length>0?d:void 0,delete this._spritesImagesIds[n],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.l("data",{dataType:"style"}))}else this.fire(new a.k(new Error(`Sprite "${n}" doesn't exists on this map.`)))}getSprite(){return Fe(this.stylesheet.sprite)}setSprite(n,d={},m){this._checkLoaded(),n&&this._validate(a.z.sprite,"sprite",n,null,d)||(this.stylesheet.sprite=n,n?this._loadSprite(n,!0,m):(this._unloadSprite(),m&&m(null)))}}var Um=a.aJ([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class ef{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(n,d,m,y,x,S,I,B,F){this.context=n;let U=this.boundPaintVertexBuffers.length!==y.length;for(let W=0;!U&&W<y.length;W++)this.boundPaintVertexBuffers[W]!==y[W]&&(U=!0);!this.vao||this.boundProgram!==d||this.boundLayoutVertexBuffer!==m||U||this.boundIndexBuffer!==x||this.boundVertexOffset!==S||this.boundDynamicVertexBuffer!==I||this.boundDynamicVertexBuffer2!==B||this.boundDynamicVertexBuffer3!==F?this.freshBind(d,m,y,x,S,I,B,F):(n.bindVertexArray.set(this.vao),I&&I.bind(),x&&x.dynamicDraw&&x.bind(),B&&B.bind(),F&&F.bind())}freshBind(n,d,m,y,x,S,I,B){const F=n.numAttributes,U=this.context,W=U.gl;this.vao&&this.destroy(),this.vao=U.createVertexArray(),U.bindVertexArray.set(this.vao),this.boundProgram=n,this.boundLayoutVertexBuffer=d,this.boundPaintVertexBuffers=m,this.boundIndexBuffer=y,this.boundVertexOffset=x,this.boundDynamicVertexBuffer=S,this.boundDynamicVertexBuffer2=I,this.boundDynamicVertexBuffer3=B,d.enableAttributes(W,n);for(const G of m)G.enableAttributes(W,n);S&&S.enableAttributes(W,n),I&&I.enableAttributes(W,n),B&&B.enableAttributes(W,n),d.bind(),d.setVertexAttribPointers(W,n,x);for(const G of m)G.bind(),G.setVertexAttribPointers(W,n,x);S&&(S.bind(),S.setVertexAttribPointers(W,n,x)),y&&y.bind(),I&&(I.bind(),I.setVertexAttribPointers(W,n,x)),B&&(B.bind(),B.setVertexAttribPointers(W,n,x)),U.currentNumAttributes=F}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const dh=(b,n,d,m,y)=>({u_texture:0,u_ele_delta:b,u_fog_matrix:n,u_fog_color:d?d.properties.get("fog-color"):a.bf.white,u_fog_ground_blend:d?d.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:y?0:d?d.calculateFogBlendOpacity(m):0,u_horizon_color:d?d.properties.get("horizon-color"):a.bf.white,u_horizon_fog_blend:d?d.properties.get("horizon-fog-blend"):1,u_is_globe_mode:y?1:0}),Ad={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function Pl(b){const n=[];for(let d=0;d<b.length;d++){if(b[d]===null)continue;const m=b[d].split(" ");n.push(m.pop())}return n}class Td{constructor(n,d,m,y,x,S,I,B,F=[]){const U=n.gl;this.program=U.createProgram();const W=Pl(d.staticAttributes),G=m?m.getBinderAttributes():[],q=W.concat(G),J=Ce.prelude.staticUniforms?Pl(Ce.prelude.staticUniforms):[],le=I.staticUniforms?Pl(I.staticUniforms):[],de=d.staticUniforms?Pl(d.staticUniforms):[],pe=m?m.getBinderUniforms():[],ge=J.concat(le).concat(de).concat(pe),xe=[];for(const We of ge)xe.indexOf(We)<0&&xe.push(We);const _e=m?m.defines():[];Ho(U)&&_e.unshift("#version 300 es"),x&&_e.push("#define OVERDRAW_INSPECTOR;"),S&&_e.push("#define TERRAIN3D;"),B&&_e.push(B),F&&_e.push(...F);let Te=_e.concat(Ce.prelude.fragmentSource,I.fragmentSource,d.fragmentSource).join(`
`),Pe=_e.concat(Ce.prelude.vertexSource,I.vertexSource,d.vertexSource).join(`
`);Ho(U)||(Te=(function(We){return We.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")})(Te),Pe=(function(We){return We.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")})(Pe));const ve=U.createShader(U.FRAGMENT_SHADER);if(U.isContextLost())return void(this.failedToCreate=!0);if(U.shaderSource(ve,Te),U.compileShader(ve),!U.getShaderParameter(ve,U.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${U.getShaderInfoLog(ve)}`);U.attachShader(this.program,ve);const Re=U.createShader(U.VERTEX_SHADER);if(U.isContextLost())return void(this.failedToCreate=!0);if(U.shaderSource(Re,Pe),U.compileShader(Re),!U.getShaderParameter(Re,U.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${U.getShaderInfoLog(Re)}`);U.attachShader(this.program,Re),this.attributes={};const $e={};this.numAttributes=q.length;for(let We=0;We<this.numAttributes;We++)q[We]&&(U.bindAttribLocation(this.program,We,q[We]),this.attributes[q[We]]=We);if(U.linkProgram(this.program),!U.getProgramParameter(this.program,U.LINK_STATUS))throw new Error(`Program failed to link: ${U.getProgramInfoLog(this.program)}`);U.deleteShader(Re),U.deleteShader(ve);for(let We=0;We<xe.length;We++){const qe=xe[We];if(qe&&!$e[qe]){const Qe=U.getUniformLocation(this.program,qe);Qe&&($e[qe]=Qe)}}this.fixedUniforms=y(n,$e),this.terrainUniforms=((We,qe)=>({u_depth:new a.bP(We,qe.u_depth),u_terrain:new a.bP(We,qe.u_terrain),u_terrain_dim:new a.bg(We,qe.u_terrain_dim),u_terrain_matrix:new a.bR(We,qe.u_terrain_matrix),u_terrain_unpack:new a.bS(We,qe.u_terrain_unpack),u_terrain_exaggeration:new a.bg(We,qe.u_terrain_exaggeration)}))(n,$e),this.projectionUniforms=((We,qe)=>({u_projection_matrix:new a.bR(We,qe.u_projection_matrix),u_projection_tile_mercator_coords:new a.bS(We,qe.u_projection_tile_mercator_coords),u_projection_clipping_plane:new a.bS(We,qe.u_projection_clipping_plane),u_projection_transition:new a.bg(We,qe.u_projection_transition),u_projection_fallback_matrix:new a.bR(We,qe.u_projection_fallback_matrix)}))(n,$e),this.binderUniforms=m?m.getUniforms(n,$e):[]}draw(n,d,m,y,x,S,I,B,F,U,W,G,q,J,le,de,pe,ge,xe){const _e=n.gl;if(this.failedToCreate)return;if(n.program.set(this.program),n.setDepthMode(m),n.setStencilMode(y),n.setColorMode(x),n.setCullFace(S),B){n.activeTexture.set(_e.TEXTURE2),_e.bindTexture(_e.TEXTURE_2D,B.depthTexture),n.activeTexture.set(_e.TEXTURE3),_e.bindTexture(_e.TEXTURE_2D,B.texture);for(const Pe in this.terrainUniforms)this.terrainUniforms[Pe].set(B[Pe])}if(F)for(const Pe in F)this.projectionUniforms[Ad[Pe]].set(F[Pe]);if(I)for(const Pe in this.fixedUniforms)this.fixedUniforms[Pe].set(I[Pe]);de&&de.setUniforms(n,this.binderUniforms,J,{zoom:le});let Te=0;switch(d){case _e.LINES:Te=2;break;case _e.TRIANGLES:Te=3;break;case _e.LINE_STRIP:Te=1}for(const Pe of q.get()){const ve=Pe.vaos||(Pe.vaos={});(ve[U]||(ve[U]=new ef)).bind(n,this,W,de?de.getPaintVertexBuffers():[],G,Pe.vertexOffset,pe,ge,xe),_e.drawElements(d,Pe.primitiveLength*Te,_e.UNSIGNED_SHORT,Pe.primitiveOffset*Te*2)}}}function xc(b,n,d){const m=1/a.aC(d,1,n.transform.tileZoom),y=Math.pow(2,d.tileID.overscaledZ),x=d.tileSize*Math.pow(2,n.transform.tileZoom)/y,S=x*(d.tileID.canonical.x+d.tileID.wrap*y),I=x*d.tileID.canonical.y;return{u_image:0,u_texsize:d.imageAtlasTexture.size,u_scale:[m,b.fromScale,b.toScale],u_fade:b.t,u_pixel_coord_upper:[S>>16,I>>16],u_pixel_coord_lower:[65535&S,65535&I]}}const Mo=(b,n,d,m)=>{const y=b.style.light,x=y.properties.get("position"),S=[x.x,x.y,x.z],I=a.bV();y.properties.get("anchor")==="viewport"&&a.bW(I,b.transform.bearingInRadians),a.bX(S,S,I);const B=b.transform.transformLightDirection(S),F=y.properties.get("color");return{u_lightpos:S,u_lightpos_globe:B,u_lightintensity:y.properties.get("intensity"),u_lightcolor:[F.r,F.g,F.b],u_vertical_gradient:+n,u_opacity:d,u_fill_translate:m}},jm=(b,n,d,m,y,x,S)=>a.e(Mo(b,n,d,m),xc(x,b,S),{u_height_factor:-Math.pow(2,y.overscaledZ)/S.tileSize/8}),ph=(b,n,d,m)=>a.e(xc(n,b,d),{u_fill_translate:m}),wc=(b,n)=>({u_world:b,u_fill_translate:n}),gu=(b,n,d,m,y)=>a.e(ph(b,n,d,y),{u_world:m}),Vm=(b,n,d,m,y)=>{const x=b.transform;let S,I,B=0;if(d.paint.get("circle-pitch-alignment")==="map"){const F=a.aC(n,1,x.zoom);S=!0,I=[F,F],B=F/(a.$*Math.pow(2,n.tileID.overscaledZ))*2*Math.PI*y}else S=!1,I=x.pixelsToGLUnits;return{u_camera_to_center_distance:x.cameraToCenterDistance,u_scale_with_map:+(d.paint.get("circle-pitch-scale")==="map"),u_pitch_with_map:+S,u_device_pixel_ratio:b.pixelRatio,u_extrude_scale:I,u_globe_extrude_scale:B,u_translate:m}},fh=b=>({u_pixel_extrude_scale:[1/b.width,1/b.height]}),Gm=b=>({u_viewport_size:[b.width,b.height]}),Rl=(b,n=1)=>({u_color:b,u_overlay:0,u_overlay_scale:n}),tf=(b,n,d,m)=>{const y=a.aC(b,1,n)/(a.$*Math.pow(2,b.tileID.overscaledZ))*2*Math.PI*m;return{u_extrude_scale:a.aC(b,1,n),u_intensity:d,u_globe_extrude_scale:y}},Sd=(b,n,d,m)=>{const y=a.L();a.bY(y,0,b.width,b.height,0,0,1);const x=b.context.gl;return{u_matrix:y,u_world:[x.drawingBufferWidth,x.drawingBufferHeight],u_image:d,u_color_ramp:m,u_opacity:n.paint.get("heatmap-opacity")}},Cd=(b,n,d)=>{const m=d.paint.get("hillshade-accent-color");let y;switch(d.paint.get("hillshade-method")){case"basic":y=4;break;case"combined":y=1;break;case"igor":y=2;break;case"multidirectional":y=3;break;default:y=0}const x=d.getIlluminationProperties();for(let S=0;S<x.directionRadians.length;S++)d.paint.get("hillshade-illumination-anchor")==="viewport"&&(x.directionRadians[S]+=b.transform.bearingInRadians);return{u_image:0,u_latrange:Md(0,n.tileID),u_exaggeration:d.paint.get("hillshade-exaggeration"),u_altitudes:x.altitudeRadians,u_azimuths:x.directionRadians,u_accent:m,u_method:y,u_highlights:x.highlightColor,u_shadows:x.shadowColor}},Ec=(b,n)=>{const d=n.stride,m=a.L();return a.bY(m,0,a.$,-a.$,0,0,1),a.M(m,m,[0,-a.$,0]),{u_matrix:m,u_image:1,u_dimension:[d,d],u_zoom:b.overscaledZ,u_unpack:n.getUnpackVector()}};function Md(b,n){const d=Math.pow(2,n.canonical.z),m=n.canonical.y;return[new a.a1(0,m/d).toLngLat().lat,new a.a1(0,(m+1)/d).toLngLat().lat]}const Pd=(b,n,d=0)=>({u_image:0,u_unpack:n.getUnpackVector(),u_dimension:[n.stride,n.stride],u_elevation_stops:1,u_color_stops:4,u_color_ramp_size:d,u_opacity:b.paint.get("color-relief-opacity")}),_u=(b,n,d,m)=>{const y=b.transform;return{u_translation:kd(b,n,d),u_ratio:m/a.aC(n,1,y.zoom),u_device_pixel_ratio:b.pixelRatio,u_units_to_pixels:[1/y.pixelsToGLUnits[0],1/y.pixelsToGLUnits[1]]}},Rd=(b,n,d,m,y)=>a.e(_u(b,n,d,m),{u_image:0,u_image_height:y}),Id=(b,n,d,m,y)=>{const x=b.transform,S=tl(n,x);return{u_translation:kd(b,n,d),u_texsize:n.imageAtlasTexture.size,u_ratio:m/a.aC(n,1,x.zoom),u_device_pixel_ratio:b.pixelRatio,u_image:0,u_scale:[S,y.fromScale,y.toScale],u_fade:y.t,u_units_to_pixels:[1/x.pixelsToGLUnits[0],1/x.pixelsToGLUnits[1]]}},el=(b,n,d,m,y,x)=>{const S=b.lineAtlas,I=tl(n,b.transform),B=d.layout.get("line-cap")==="round",F=S.getDash(y.from,B),U=S.getDash(y.to,B),W=F.width*x.fromScale,G=U.width*x.toScale;return a.e(_u(b,n,d,m),{u_patternscale_a:[I/W,-F.height/2],u_patternscale_b:[I/G,-U.height/2],u_sdfgamma:S.width/(256*Math.min(W,G)*b.pixelRatio)/2,u_image:0,u_tex_y_a:F.y,u_tex_y_b:U.y,u_mix:x.t})};function tl(b,n){return 1/a.aC(b,1,n.tileZoom)}function kd(b,n,d){return a.aD(b.transform,n,d.paint.get("line-translate"),d.paint.get("line-translate-anchor"))}const yu=(b,n,d,m,y)=>{return{u_tl_parent:b,u_scale_parent:n,u_buffer_scale:1,u_fade_t:d.mix,u_opacity:d.opacity*m.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:m.paint.get("raster-brightness-min"),u_brightness_high:m.paint.get("raster-brightness-max"),u_saturation_factor:(S=m.paint.get("raster-saturation"),S>0?1-1/(1.001-S):-S),u_contrast_factor:(x=m.paint.get("raster-contrast"),x>0?1/(1-x):1+x),u_spin_weights:Hm(m.paint.get("raster-hue-rotate")),u_coords_top:[y[0].x,y[0].y,y[1].x,y[1].y],u_coords_bottom:[y[3].x,y[3].y,y[2].x,y[2].y]};var x,S};function Hm(b){b*=Math.PI/180;const n=Math.sin(b),d=Math.cos(b);return[(2*d+1)/3,(-Math.sqrt(3)*n-d+1)/3,(Math.sqrt(3)*n-d+1)/3]}const Ac=(b,n,d,m,y,x,S,I,B,F,U,W,G)=>{const q=S.transform;return{u_is_size_zoom_constant:+(b==="constant"||b==="source"),u_is_size_feature_constant:+(b==="constant"||b==="camera"),u_size_t:n?n.uSizeT:0,u_size:n?n.uSize:0,u_camera_to_center_distance:q.cameraToCenterDistance,u_pitch:q.pitch/360*2*Math.PI,u_rotate_symbol:+d,u_aspect_ratio:q.width/q.height,u_fade_change:S.options.fadeDuration?S.symbolFadeChange:1,u_label_plane_matrix:I,u_coord_matrix:B,u_is_text:+U,u_pitch_with_map:+m,u_is_along_line:y,u_is_variable_anchor:x,u_texsize:W,u_texture:0,u_translation:F,u_pitched_scale:G}},Bd=(b,n,d,m,y,x,S,I,B,F,U,W,G,q)=>{const J=S.transform;return a.e(Ac(b,n,d,m,y,x,S,I,B,F,U,W,q),{u_gamma_scale:m?Math.cos(J.pitch*Math.PI/180)*J.cameraToCenterDistance:1,u_device_pixel_ratio:S.pixelRatio,u_is_halo:1})},vu=(b,n,d,m,y,x,S,I,B,F,U,W,G)=>a.e(Bd(b,n,d,m,y,x,S,I,B,F,!0,U,0,G),{u_texsize_icon:W,u_texture_icon:1}),Tc=(b,n)=>({u_opacity:b,u_color:n}),rf=(b,n,d,m,y)=>a.e((function(x,S,I,B){const F=I.imageManager.getPattern(x.from.toString()),U=I.imageManager.getPattern(x.to.toString()),{width:W,height:G}=I.imageManager.getPixelSize(),q=Math.pow(2,B.tileID.overscaledZ),J=B.tileSize*Math.pow(2,I.transform.tileZoom)/q,le=J*(B.tileID.canonical.x+B.tileID.wrap*q),de=J*B.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:F.tl,u_pattern_br_a:F.br,u_pattern_tl_b:U.tl,u_pattern_br_b:U.br,u_texsize:[W,G],u_mix:S.t,u_pattern_size_a:F.displaySize,u_pattern_size_b:U.displaySize,u_scale_a:S.fromScale,u_scale_b:S.toScale,u_tile_units_to_pixels:1/a.aC(B,1,I.transform.tileZoom),u_pixel_coord_upper:[le>>16,de>>16],u_pixel_coord_lower:[65535&le,65535&de]}})(d,y,n,m),{u_opacity:b}),Sc=(b,n)=>{},Ld={fillExtrusion:(b,n)=>({u_lightpos:new a.bT(b,n.u_lightpos),u_lightpos_globe:new a.bT(b,n.u_lightpos_globe),u_lightintensity:new a.bg(b,n.u_lightintensity),u_lightcolor:new a.bT(b,n.u_lightcolor),u_vertical_gradient:new a.bg(b,n.u_vertical_gradient),u_opacity:new a.bg(b,n.u_opacity),u_fill_translate:new a.bU(b,n.u_fill_translate)}),fillExtrusionPattern:(b,n)=>({u_lightpos:new a.bT(b,n.u_lightpos),u_lightpos_globe:new a.bT(b,n.u_lightpos_globe),u_lightintensity:new a.bg(b,n.u_lightintensity),u_lightcolor:new a.bT(b,n.u_lightcolor),u_vertical_gradient:new a.bg(b,n.u_vertical_gradient),u_height_factor:new a.bg(b,n.u_height_factor),u_opacity:new a.bg(b,n.u_opacity),u_fill_translate:new a.bU(b,n.u_fill_translate),u_image:new a.bP(b,n.u_image),u_texsize:new a.bU(b,n.u_texsize),u_pixel_coord_upper:new a.bU(b,n.u_pixel_coord_upper),u_pixel_coord_lower:new a.bU(b,n.u_pixel_coord_lower),u_scale:new a.bT(b,n.u_scale),u_fade:new a.bg(b,n.u_fade)}),fill:(b,n)=>({u_fill_translate:new a.bU(b,n.u_fill_translate)}),fillPattern:(b,n)=>({u_image:new a.bP(b,n.u_image),u_texsize:new a.bU(b,n.u_texsize),u_pixel_coord_upper:new a.bU(b,n.u_pixel_coord_upper),u_pixel_coord_lower:new a.bU(b,n.u_pixel_coord_lower),u_scale:new a.bT(b,n.u_scale),u_fade:new a.bg(b,n.u_fade),u_fill_translate:new a.bU(b,n.u_fill_translate)}),fillOutline:(b,n)=>({u_world:new a.bU(b,n.u_world),u_fill_translate:new a.bU(b,n.u_fill_translate)}),fillOutlinePattern:(b,n)=>({u_world:new a.bU(b,n.u_world),u_image:new a.bP(b,n.u_image),u_texsize:new a.bU(b,n.u_texsize),u_pixel_coord_upper:new a.bU(b,n.u_pixel_coord_upper),u_pixel_coord_lower:new a.bU(b,n.u_pixel_coord_lower),u_scale:new a.bT(b,n.u_scale),u_fade:new a.bg(b,n.u_fade),u_fill_translate:new a.bU(b,n.u_fill_translate)}),circle:(b,n)=>({u_camera_to_center_distance:new a.bg(b,n.u_camera_to_center_distance),u_scale_with_map:new a.bP(b,n.u_scale_with_map),u_pitch_with_map:new a.bP(b,n.u_pitch_with_map),u_extrude_scale:new a.bU(b,n.u_extrude_scale),u_device_pixel_ratio:new a.bg(b,n.u_device_pixel_ratio),u_globe_extrude_scale:new a.bg(b,n.u_globe_extrude_scale),u_translate:new a.bU(b,n.u_translate)}),collisionBox:(b,n)=>({u_pixel_extrude_scale:new a.bU(b,n.u_pixel_extrude_scale)}),collisionCircle:(b,n)=>({u_viewport_size:new a.bU(b,n.u_viewport_size)}),debug:(b,n)=>({u_color:new a.bQ(b,n.u_color),u_overlay:new a.bP(b,n.u_overlay),u_overlay_scale:new a.bg(b,n.u_overlay_scale)}),depth:Sc,clippingMask:Sc,heatmap:(b,n)=>({u_extrude_scale:new a.bg(b,n.u_extrude_scale),u_intensity:new a.bg(b,n.u_intensity),u_globe_extrude_scale:new a.bg(b,n.u_globe_extrude_scale)}),heatmapTexture:(b,n)=>({u_matrix:new a.bR(b,n.u_matrix),u_world:new a.bU(b,n.u_world),u_image:new a.bP(b,n.u_image),u_color_ramp:new a.bP(b,n.u_color_ramp),u_opacity:new a.bg(b,n.u_opacity)}),hillshade:(b,n)=>({u_image:new a.bP(b,n.u_image),u_latrange:new a.bU(b,n.u_latrange),u_exaggeration:new a.bg(b,n.u_exaggeration),u_altitudes:new a.b_(b,n.u_altitudes),u_azimuths:new a.b_(b,n.u_azimuths),u_accent:new a.bQ(b,n.u_accent),u_method:new a.bP(b,n.u_method),u_shadows:new a.bZ(b,n.u_shadows),u_highlights:new a.bZ(b,n.u_highlights)}),hillshadePrepare:(b,n)=>({u_matrix:new a.bR(b,n.u_matrix),u_image:new a.bP(b,n.u_image),u_dimension:new a.bU(b,n.u_dimension),u_zoom:new a.bg(b,n.u_zoom),u_unpack:new a.bS(b,n.u_unpack)}),colorRelief:(b,n)=>({u_image:new a.bP(b,n.u_image),u_unpack:new a.bS(b,n.u_unpack),u_dimension:new a.bU(b,n.u_dimension),u_elevation_stops:new a.bP(b,n.u_elevation_stops),u_color_stops:new a.bP(b,n.u_color_stops),u_color_ramp_size:new a.bP(b,n.u_color_ramp_size),u_opacity:new a.bg(b,n.u_opacity)}),line:(b,n)=>({u_translation:new a.bU(b,n.u_translation),u_ratio:new a.bg(b,n.u_ratio),u_device_pixel_ratio:new a.bg(b,n.u_device_pixel_ratio),u_units_to_pixels:new a.bU(b,n.u_units_to_pixels)}),lineGradient:(b,n)=>({u_translation:new a.bU(b,n.u_translation),u_ratio:new a.bg(b,n.u_ratio),u_device_pixel_ratio:new a.bg(b,n.u_device_pixel_ratio),u_units_to_pixels:new a.bU(b,n.u_units_to_pixels),u_image:new a.bP(b,n.u_image),u_image_height:new a.bg(b,n.u_image_height)}),linePattern:(b,n)=>({u_translation:new a.bU(b,n.u_translation),u_texsize:new a.bU(b,n.u_texsize),u_ratio:new a.bg(b,n.u_ratio),u_device_pixel_ratio:new a.bg(b,n.u_device_pixel_ratio),u_image:new a.bP(b,n.u_image),u_units_to_pixels:new a.bU(b,n.u_units_to_pixels),u_scale:new a.bT(b,n.u_scale),u_fade:new a.bg(b,n.u_fade)}),lineSDF:(b,n)=>({u_translation:new a.bU(b,n.u_translation),u_ratio:new a.bg(b,n.u_ratio),u_device_pixel_ratio:new a.bg(b,n.u_device_pixel_ratio),u_units_to_pixels:new a.bU(b,n.u_units_to_pixels),u_patternscale_a:new a.bU(b,n.u_patternscale_a),u_patternscale_b:new a.bU(b,n.u_patternscale_b),u_sdfgamma:new a.bg(b,n.u_sdfgamma),u_image:new a.bP(b,n.u_image),u_tex_y_a:new a.bg(b,n.u_tex_y_a),u_tex_y_b:new a.bg(b,n.u_tex_y_b),u_mix:new a.bg(b,n.u_mix)}),raster:(b,n)=>({u_tl_parent:new a.bU(b,n.u_tl_parent),u_scale_parent:new a.bg(b,n.u_scale_parent),u_buffer_scale:new a.bg(b,n.u_buffer_scale),u_fade_t:new a.bg(b,n.u_fade_t),u_opacity:new a.bg(b,n.u_opacity),u_image0:new a.bP(b,n.u_image0),u_image1:new a.bP(b,n.u_image1),u_brightness_low:new a.bg(b,n.u_brightness_low),u_brightness_high:new a.bg(b,n.u_brightness_high),u_saturation_factor:new a.bg(b,n.u_saturation_factor),u_contrast_factor:new a.bg(b,n.u_contrast_factor),u_spin_weights:new a.bT(b,n.u_spin_weights),u_coords_top:new a.bS(b,n.u_coords_top),u_coords_bottom:new a.bS(b,n.u_coords_bottom)}),symbolIcon:(b,n)=>({u_is_size_zoom_constant:new a.bP(b,n.u_is_size_zoom_constant),u_is_size_feature_constant:new a.bP(b,n.u_is_size_feature_constant),u_size_t:new a.bg(b,n.u_size_t),u_size:new a.bg(b,n.u_size),u_camera_to_center_distance:new a.bg(b,n.u_camera_to_center_distance),u_pitch:new a.bg(b,n.u_pitch),u_rotate_symbol:new a.bP(b,n.u_rotate_symbol),u_aspect_ratio:new a.bg(b,n.u_aspect_ratio),u_fade_change:new a.bg(b,n.u_fade_change),u_label_plane_matrix:new a.bR(b,n.u_label_plane_matrix),u_coord_matrix:new a.bR(b,n.u_coord_matrix),u_is_text:new a.bP(b,n.u_is_text),u_pitch_with_map:new a.bP(b,n.u_pitch_with_map),u_is_along_line:new a.bP(b,n.u_is_along_line),u_is_variable_anchor:new a.bP(b,n.u_is_variable_anchor),u_texsize:new a.bU(b,n.u_texsize),u_texture:new a.bP(b,n.u_texture),u_translation:new a.bU(b,n.u_translation),u_pitched_scale:new a.bg(b,n.u_pitched_scale)}),symbolSDF:(b,n)=>({u_is_size_zoom_constant:new a.bP(b,n.u_is_size_zoom_constant),u_is_size_feature_constant:new a.bP(b,n.u_is_size_feature_constant),u_size_t:new a.bg(b,n.u_size_t),u_size:new a.bg(b,n.u_size),u_camera_to_center_distance:new a.bg(b,n.u_camera_to_center_distance),u_pitch:new a.bg(b,n.u_pitch),u_rotate_symbol:new a.bP(b,n.u_rotate_symbol),u_aspect_ratio:new a.bg(b,n.u_aspect_ratio),u_fade_change:new a.bg(b,n.u_fade_change),u_label_plane_matrix:new a.bR(b,n.u_label_plane_matrix),u_coord_matrix:new a.bR(b,n.u_coord_matrix),u_is_text:new a.bP(b,n.u_is_text),u_pitch_with_map:new a.bP(b,n.u_pitch_with_map),u_is_along_line:new a.bP(b,n.u_is_along_line),u_is_variable_anchor:new a.bP(b,n.u_is_variable_anchor),u_texsize:new a.bU(b,n.u_texsize),u_texture:new a.bP(b,n.u_texture),u_gamma_scale:new a.bg(b,n.u_gamma_scale),u_device_pixel_ratio:new a.bg(b,n.u_device_pixel_ratio),u_is_halo:new a.bP(b,n.u_is_halo),u_translation:new a.bU(b,n.u_translation),u_pitched_scale:new a.bg(b,n.u_pitched_scale)}),symbolTextAndIcon:(b,n)=>({u_is_size_zoom_constant:new a.bP(b,n.u_is_size_zoom_constant),u_is_size_feature_constant:new a.bP(b,n.u_is_size_feature_constant),u_size_t:new a.bg(b,n.u_size_t),u_size:new a.bg(b,n.u_size),u_camera_to_center_distance:new a.bg(b,n.u_camera_to_center_distance),u_pitch:new a.bg(b,n.u_pitch),u_rotate_symbol:new a.bP(b,n.u_rotate_symbol),u_aspect_ratio:new a.bg(b,n.u_aspect_ratio),u_fade_change:new a.bg(b,n.u_fade_change),u_label_plane_matrix:new a.bR(b,n.u_label_plane_matrix),u_coord_matrix:new a.bR(b,n.u_coord_matrix),u_is_text:new a.bP(b,n.u_is_text),u_pitch_with_map:new a.bP(b,n.u_pitch_with_map),u_is_along_line:new a.bP(b,n.u_is_along_line),u_is_variable_anchor:new a.bP(b,n.u_is_variable_anchor),u_texsize:new a.bU(b,n.u_texsize),u_texsize_icon:new a.bU(b,n.u_texsize_icon),u_texture:new a.bP(b,n.u_texture),u_texture_icon:new a.bP(b,n.u_texture_icon),u_gamma_scale:new a.bg(b,n.u_gamma_scale),u_device_pixel_ratio:new a.bg(b,n.u_device_pixel_ratio),u_is_halo:new a.bP(b,n.u_is_halo),u_translation:new a.bU(b,n.u_translation),u_pitched_scale:new a.bg(b,n.u_pitched_scale)}),background:(b,n)=>({u_opacity:new a.bg(b,n.u_opacity),u_color:new a.bQ(b,n.u_color)}),backgroundPattern:(b,n)=>({u_opacity:new a.bg(b,n.u_opacity),u_image:new a.bP(b,n.u_image),u_pattern_tl_a:new a.bU(b,n.u_pattern_tl_a),u_pattern_br_a:new a.bU(b,n.u_pattern_br_a),u_pattern_tl_b:new a.bU(b,n.u_pattern_tl_b),u_pattern_br_b:new a.bU(b,n.u_pattern_br_b),u_texsize:new a.bU(b,n.u_texsize),u_mix:new a.bg(b,n.u_mix),u_pattern_size_a:new a.bU(b,n.u_pattern_size_a),u_pattern_size_b:new a.bU(b,n.u_pattern_size_b),u_scale_a:new a.bg(b,n.u_scale_a),u_scale_b:new a.bg(b,n.u_scale_b),u_pixel_coord_upper:new a.bU(b,n.u_pixel_coord_upper),u_pixel_coord_lower:new a.bU(b,n.u_pixel_coord_lower),u_tile_units_to_pixels:new a.bg(b,n.u_tile_units_to_pixels)}),terrain:(b,n)=>({u_texture:new a.bP(b,n.u_texture),u_ele_delta:new a.bg(b,n.u_ele_delta),u_fog_matrix:new a.bR(b,n.u_fog_matrix),u_fog_color:new a.bQ(b,n.u_fog_color),u_fog_ground_blend:new a.bg(b,n.u_fog_ground_blend),u_fog_ground_blend_opacity:new a.bg(b,n.u_fog_ground_blend_opacity),u_horizon_color:new a.bQ(b,n.u_horizon_color),u_horizon_fog_blend:new a.bg(b,n.u_horizon_fog_blend),u_is_globe_mode:new a.bg(b,n.u_is_globe_mode)}),terrainDepth:(b,n)=>({u_ele_delta:new a.bg(b,n.u_ele_delta)}),terrainCoords:(b,n)=>({u_texture:new a.bP(b,n.u_texture),u_terrain_coords_id:new a.bg(b,n.u_terrain_coords_id),u_ele_delta:new a.bg(b,n.u_ele_delta)}),projectionErrorMeasurement:(b,n)=>({u_input:new a.bg(b,n.u_input),u_output_expected:new a.bg(b,n.u_output_expected)}),atmosphere:(b,n)=>({u_sun_pos:new a.bT(b,n.u_sun_pos),u_atmosphere_blend:new a.bg(b,n.u_atmosphere_blend),u_globe_position:new a.bT(b,n.u_globe_position),u_globe_radius:new a.bg(b,n.u_globe_radius),u_inv_proj_matrix:new a.bR(b,n.u_inv_proj_matrix)}),sky:(b,n)=>({u_sky_color:new a.bQ(b,n.u_sky_color),u_horizon_color:new a.bQ(b,n.u_horizon_color),u_horizon:new a.bU(b,n.u_horizon),u_horizon_normal:new a.bU(b,n.u_horizon_normal),u_sky_horizon_blend:new a.bg(b,n.u_sky_horizon_blend),u_sky_blend:new a.bg(b,n.u_sky_blend)})};class Dd{constructor(n,d,m){this.context=n;const y=n.gl;this.buffer=y.createBuffer(),this.dynamicDraw=!!m,this.context.unbindVAO(),n.bindElementBuffer.set(this.buffer),y.bufferData(y.ELEMENT_ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?y.DYNAMIC_DRAW:y.STATIC_DRAW),this.dynamicDraw||delete d.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(n){const d=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),d.bufferSubData(d.ELEMENT_ARRAY_BUFFER,0,n.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Cc={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Po{constructor(n,d,m,y){this.length=d.length,this.attributes=m,this.itemSize=d.bytesPerElement,this.dynamicDraw=y,this.context=n;const x=n.gl;this.buffer=x.createBuffer(),n.bindVertexBuffer.set(this.buffer),x.bufferData(x.ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?x.DYNAMIC_DRAW:x.STATIC_DRAW),this.dynamicDraw||delete d.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(n){if(n.length!==this.length)throw new Error(`Length of new data is ${n.length}, which doesn't match current length of ${this.length}`);const d=this.context.gl;this.bind(),d.bufferSubData(d.ARRAY_BUFFER,0,n.arrayBuffer)}enableAttributes(n,d){for(let m=0;m<this.attributes.length;m++){const y=d.attributes[this.attributes[m].name];y!==void 0&&n.enableVertexAttribArray(y)}}setVertexAttribPointers(n,d,m){for(let y=0;y<this.attributes.length;y++){const x=this.attributes[y],S=d.attributes[x.name];S!==void 0&&n.vertexAttribPointer(S,x.components,n[Cc[x.type]],!1,this.itemSize,x.offset+this.itemSize*(m||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Fr{constructor(n){this.gl=n.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(n){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class mh extends Fr{getDefault(){return a.bf.transparent}set(n){const d=this.current;(n.r!==d.r||n.g!==d.g||n.b!==d.b||n.a!==d.a||this.dirty)&&(this.gl.clearColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class gh extends Fr{getDefault(){return 1}set(n){(n!==this.current||this.dirty)&&(this.gl.clearDepth(n),this.current=n,this.dirty=!1)}}class nf extends Fr{getDefault(){return 0}set(n){(n!==this.current||this.dirty)&&(this.gl.clearStencil(n),this.current=n,this.dirty=!1)}}class Nd extends Fr{getDefault(){return[!0,!0,!0,!0]}set(n){const d=this.current;(n[0]!==d[0]||n[1]!==d[1]||n[2]!==d[2]||n[3]!==d[3]||this.dirty)&&(this.gl.colorMask(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class Il extends Fr{getDefault(){return!0}set(n){(n!==this.current||this.dirty)&&(this.gl.depthMask(n),this.current=n,this.dirty=!1)}}class Od extends Fr{getDefault(){return 255}set(n){(n!==this.current||this.dirty)&&(this.gl.stencilMask(n),this.current=n,this.dirty=!1)}}class Wm extends Fr{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(n){const d=this.current;(n.func!==d.func||n.ref!==d.ref||n.mask!==d.mask||this.dirty)&&(this.gl.stencilFunc(n.func,n.ref,n.mask),this.current=n,this.dirty=!1)}}class Ro extends Fr{getDefault(){const n=this.gl;return[n.KEEP,n.KEEP,n.KEEP]}set(n){const d=this.current;(n[0]!==d[0]||n[1]!==d[1]||n[2]!==d[2]||this.dirty)&&(this.gl.stencilOp(n[0],n[1],n[2]),this.current=n,this.dirty=!1)}}class bu extends Fr{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const d=this.gl;n?d.enable(d.STENCIL_TEST):d.disable(d.STENCIL_TEST),this.current=n,this.dirty=!1}}class sf extends Fr{getDefault(){return[0,1]}set(n){const d=this.current;(n[0]!==d[0]||n[1]!==d[1]||this.dirty)&&(this.gl.depthRange(n[0],n[1]),this.current=n,this.dirty=!1)}}class Fd extends Fr{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const d=this.gl;n?d.enable(d.DEPTH_TEST):d.disable(d.DEPTH_TEST),this.current=n,this.dirty=!1}}class of extends Fr{getDefault(){return this.gl.LESS}set(n){(n!==this.current||this.dirty)&&(this.gl.depthFunc(n),this.current=n,this.dirty=!1)}}class zd extends Fr{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const d=this.gl;n?d.enable(d.BLEND):d.disable(d.BLEND),this.current=n,this.dirty=!1}}class Mc extends Fr{getDefault(){const n=this.gl;return[n.ONE,n.ZERO]}set(n){const d=this.current;(n[0]!==d[0]||n[1]!==d[1]||this.dirty)&&(this.gl.blendFunc(n[0],n[1]),this.current=n,this.dirty=!1)}}class _h extends Fr{getDefault(){return a.bf.transparent}set(n){const d=this.current;(n.r!==d.r||n.g!==d.g||n.b!==d.b||n.a!==d.a||this.dirty)&&(this.gl.blendColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class yh extends Fr{getDefault(){return this.gl.FUNC_ADD}set(n){(n!==this.current||this.dirty)&&(this.gl.blendEquation(n),this.current=n,this.dirty=!1)}}class rl extends Fr{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const d=this.gl;n?d.enable(d.CULL_FACE):d.disable(d.CULL_FACE),this.current=n,this.dirty=!1}}class ga extends Fr{getDefault(){return this.gl.BACK}set(n){(n!==this.current||this.dirty)&&(this.gl.cullFace(n),this.current=n,this.dirty=!1)}}class _a extends Fr{getDefault(){return this.gl.CCW}set(n){(n!==this.current||this.dirty)&&(this.gl.frontFace(n),this.current=n,this.dirty=!1)}}class il extends Fr{getDefault(){return null}set(n){(n!==this.current||this.dirty)&&(this.gl.useProgram(n),this.current=n,this.dirty=!1)}}class zs extends Fr{getDefault(){return this.gl.TEXTURE0}set(n){(n!==this.current||this.dirty)&&(this.gl.activeTexture(n),this.current=n,this.dirty=!1)}}class xu extends Fr{getDefault(){const n=this.gl;return[0,0,n.drawingBufferWidth,n.drawingBufferHeight]}set(n){const d=this.current;(n[0]!==d[0]||n[1]!==d[1]||n[2]!==d[2]||n[3]!==d[3]||this.dirty)&&(this.gl.viewport(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class kl extends Fr{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const d=this.gl;d.bindFramebuffer(d.FRAMEBUFFER,n),this.current=n,this.dirty=!1}}class wu extends Fr{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const d=this.gl;d.bindRenderbuffer(d.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class nl extends Fr{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const d=this.gl;d.bindTexture(d.TEXTURE_2D,n),this.current=n,this.dirty=!1}}class Bl extends Fr{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const d=this.gl;d.bindBuffer(d.ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class Eu extends Fr{getDefault(){return null}set(n){const d=this.gl;d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class Pc extends Fr{getDefault(){return null}set(n){var d;if(n===this.current&&!this.dirty)return;const m=this.gl;Ho(m)?m.bindVertexArray(n):(d=m.getExtension("OES_vertex_array_object"))===null||d===void 0||d.bindVertexArrayOES(n),this.current=n,this.dirty=!1}}class Au extends Fr{getDefault(){return 4}set(n){if(n===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_ALIGNMENT,n),this.current=n,this.dirty=!1}}class Ud extends Fr{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n),this.current=n,this.dirty=!1}}class Ll extends Fr{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,n),this.current=n,this.dirty=!1}}class ya extends Fr{constructor(n,d){super(n),this.context=n,this.parent=d}getDefault(){return null}}class va extends ya{setDirty(){this.dirty=!0}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,n,0),this.current=n,this.dirty=!1}}class Tu extends ya{set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferRenderbuffer(d.FRAMEBUFFER,d.DEPTH_ATTACHMENT,d.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class Ir extends ya{set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferRenderbuffer(d.FRAMEBUFFER,d.DEPTH_STENCIL_ATTACHMENT,d.RENDERBUFFER,n),this.current=n,this.dirty=!1}}const Su="Framebuffer is not complete";class qm{constructor(n,d,m,y,x){this.context=n,this.width=d,this.height=m;const S=n.gl,I=this.framebuffer=S.createFramebuffer();if(this.colorAttachment=new va(n,I),y)this.depthAttachment=x?new Ir(n,I):new Tu(n,I);else if(x)throw new Error("Stencil cannot be set without depth");if(S.checkFramebufferStatus(S.FRAMEBUFFER)!==S.FRAMEBUFFER_COMPLETE)throw new Error(Su)}destroy(){const n=this.context.gl,d=this.colorAttachment.get();if(d&&n.deleteTexture(d),this.depthAttachment){const m=this.depthAttachment.get();m&&n.deleteRenderbuffer(m)}n.deleteFramebuffer(this.framebuffer)}}class Rc{constructor(n){var d,m;if(this.gl=n,this.clearColor=new mh(this),this.clearDepth=new gh(this),this.clearStencil=new nf(this),this.colorMask=new Nd(this),this.depthMask=new Il(this),this.stencilMask=new Od(this),this.stencilFunc=new Wm(this),this.stencilOp=new Ro(this),this.stencilTest=new bu(this),this.depthRange=new sf(this),this.depthTest=new Fd(this),this.depthFunc=new of(this),this.blend=new zd(this),this.blendFunc=new Mc(this),this.blendColor=new _h(this),this.blendEquation=new yh(this),this.cullFace=new rl(this),this.cullFaceSide=new ga(this),this.frontFace=new _a(this),this.program=new il(this),this.activeTexture=new zs(this),this.viewport=new xu(this),this.bindFramebuffer=new kl(this),this.bindRenderbuffer=new wu(this),this.bindTexture=new nl(this),this.bindVertexBuffer=new Bl(this),this.bindElementBuffer=new Eu(this),this.bindVertexArray=new Pc(this),this.pixelStoreUnpack=new Au(this),this.pixelStoreUnpackPremultiplyAlpha=new Ud(this),this.pixelStoreUnpackFlipY=new Ll(this),this.extTextureFilterAnisotropic=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=n.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=n.getParameter(n.MAX_TEXTURE_SIZE),Ho(n)){this.HALF_FLOAT=n.HALF_FLOAT;const y=n.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(d=n.RGBA16F)!==null&&d!==void 0?d:y?.RGBA16F_EXT,this.RGB16F=(m=n.RGB16F)!==null&&m!==void 0?m:y?.RGB16F_EXT,n.getExtension("EXT_color_buffer_float")}else{n.getExtension("EXT_color_buffer_half_float"),n.getExtension("OES_texture_half_float_linear");const y=n.getExtension("OES_texture_half_float");this.HALF_FLOAT=y?.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(n,d){return new Dd(this,n,d)}createVertexBuffer(n,d,m){return new Po(this,n,d,m)}createRenderbuffer(n,d,m){const y=this.gl,x=y.createRenderbuffer();return this.bindRenderbuffer.set(x),y.renderbufferStorage(y.RENDERBUFFER,n,d,m),this.bindRenderbuffer.set(null),x}createFramebuffer(n,d,m,y){return new qm(this,n,d,m,y)}clear({color:n,depth:d,stencil:m}){const y=this.gl;let x=0;n&&(x|=y.COLOR_BUFFER_BIT,this.clearColor.set(n),this.colorMask.set([!0,!0,!0,!0])),d!==void 0&&(x|=y.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(d),this.depthMask.set(!0)),m!==void 0&&(x|=y.STENCIL_BUFFER_BIT,this.clearStencil.set(m),this.stencilMask.set(255)),y.clear(x)}setCullFace(n){n.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(n.mode),this.frontFace.set(n.frontFace))}setDepthMode(n){n.func!==this.gl.ALWAYS||n.mask?(this.depthTest.set(!0),this.depthFunc.set(n.func),this.depthMask.set(n.mask),this.depthRange.set(n.range)):this.depthTest.set(!1)}setStencilMode(n){n.test.func!==this.gl.ALWAYS||n.mask?(this.stencilTest.set(!0),this.stencilMask.set(n.mask),this.stencilOp.set([n.fail,n.depthFail,n.pass]),this.stencilFunc.set({func:n.test.func,ref:n.ref,mask:n.test.mask})):this.stencilTest.set(!1)}setColorMode(n){a.bH(n.blendFunction,ii.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(n.blendFunction),this.blendColor.set(n.blendColor)),this.colorMask.set(n.mask)}createVertexArray(){var n;return Ho(this.gl)?this.gl.createVertexArray():(n=this.gl.getExtension("OES_vertex_array_object"))===null||n===void 0?void 0:n.createVertexArrayOES()}deleteVertexArray(n){var d;return Ho(this.gl)?this.gl.deleteVertexArray(n):(d=this.gl.getExtension("OES_vertex_array_object"))===null||d===void 0?void 0:d.deleteVertexArrayOES(n)}unbindVAO(){this.bindVertexArray.set(null)}}let sl;function jd(b,n,d,m,y){const x=b.context,S=b.transform,I=x.gl,B=b.useProgram("collisionBox"),F=[];let U=0,W=0;for(let pe=0;pe<m.length;pe++){const ge=m[pe],xe=n.getTile(ge).getBucket(d);if(!xe)continue;const _e=y?xe.textCollisionBox:xe.iconCollisionBox,Te=xe.collisionCircleArray;Te.length>0&&(F.push({circleArray:Te,circleOffset:W,coord:ge}),U+=Te.length/4,W=U),_e&&B.draw(x,I.LINES,pr.disabled,Rr.disabled,b.colorModeForRenderPass(),lr.disabled,fh(b.transform),b.style.map.terrain&&b.style.map.terrain.getTerrainData(ge),S.getProjectionData({overscaledTileID:ge,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),d.id,_e.layoutVertexBuffer,_e.indexBuffer,_e.segments,null,b.transform.zoom,null,null,_e.collisionVertexBuffer)}if(!y||!F.length)return;const G=b.useProgram("collisionCircle"),q=new a.b$;q.resize(4*U),q._trim();let J=0;for(const pe of F)for(let ge=0;ge<pe.circleArray.length/4;ge++){const xe=4*ge,_e=pe.circleArray[xe+0],Te=pe.circleArray[xe+1],Pe=pe.circleArray[xe+2],ve=pe.circleArray[xe+3];q.emplace(J++,_e,Te,Pe,ve,0),q.emplace(J++,_e,Te,Pe,ve,1),q.emplace(J++,_e,Te,Pe,ve,2),q.emplace(J++,_e,Te,Pe,ve,3)}(!sl||sl.length<2*U)&&(sl=(function(pe){const ge=2*pe,xe=new a.c1;xe.resize(ge),xe._trim();for(let _e=0;_e<ge;_e++){const Te=6*_e;xe.uint16[Te+0]=4*_e+0,xe.uint16[Te+1]=4*_e+1,xe.uint16[Te+2]=4*_e+2,xe.uint16[Te+3]=4*_e+2,xe.uint16[Te+4]=4*_e+3,xe.uint16[Te+5]=4*_e+0}return xe})(U));const le=x.createIndexBuffer(sl,!0),de=x.createVertexBuffer(q,a.c0.members,!0);for(const pe of F){const ge=Gm(b.transform);G.draw(x,I.TRIANGLES,pr.disabled,Rr.disabled,b.colorModeForRenderPass(),lr.disabled,ge,b.style.map.terrain&&b.style.map.terrain.getTerrainData(pe.coord),null,d.id,de,le,a.aM.simpleSegment(0,2*pe.circleOffset,pe.circleArray.length,pe.circleArray.length/2),null,b.transform.zoom,null,null,null)}de.destroy(),le.destroy()}const af=a.ag(new Float32Array(16));function gi(b,n,d,m,y,x){const{horizontalAlign:S,verticalAlign:I}=a.aH(b);return new a.P((-(S-.5)*n/y+m[0])*x,(-(I-.5)*d/y+m[1])*x)}function Vd(b,n,d,m,y,x){const S=n.tileAnchorPoint.add(new a.P(n.translation[0],n.translation[1]));if(n.pitchWithMap){let I=m.mult(x);d||(I=I.rotate(-y));const B=S.add(I);return Ni(B.x,B.y,n.pitchedLabelPlaneMatrix,n.getElevation).point}if(d){const I=Hi(n.tileAnchorPoint.x+1,n.tileAnchorPoint.y,n).point.sub(b),B=Math.atan(I.y/I.x)+(I.x<0?Math.PI:0);return b.add(m.rotate(B))}return b.add(m)}function Ic(b,n,d,m,y,x,S,I,B,F,U,W){const G=b.text.placedSymbolArray,q=b.text.dynamicLayoutVertexArray,J=b.icon.dynamicLayoutVertexArray,le={};q.clear();for(let de=0;de<G.length;de++){const pe=G.get(de),ge=pe.hidden||!pe.crossTileID||b.allowVerticalPlacement&&!pe.placedOrientation?null:m[pe.crossTileID];if(ge){const xe=new a.P(pe.anchorX,pe.anchorY),_e={getElevation:W,width:y.width,height:y.height,pitchedLabelPlaneMatrix:x,pitchWithMap:d,transform:y,tileAnchorPoint:xe,translation:F,unwrappedTileID:U},Te=d?Un(xe.x,xe.y,_e):Hi(xe.x,xe.y,_e),Pe=_t(y.cameraToCenterDistance,Te.signedDistanceFromCamera);let ve=a.ap(b.textSizeData,I,pe)*Pe/a.aB;d&&(ve*=b.tilePixelRatio/S);const{width:Re,height:$e,anchor:We,textOffset:qe,textBoxScale:Qe}=ge,bt=gi(We,Re,$e,qe,Qe,ve),Et=y.getPitchedTextCorrection(xe.x+F[0],xe.y+F[1],U),ut=Vd(Te.point,_e,n,bt,-y.bearingInRadians,Et),Ut=b.allowVerticalPlacement&&pe.placedOrientation===a.ao.vertical?Math.PI/2:0;for(let Ar=0;Ar<pe.numGlyphs;Ar++)a.av(q,ut,Ut);B&&pe.associatedIconIndex>=0&&(le[pe.associatedIconIndex]={shiftedAnchor:ut,angle:Ut})}else to(pe.numGlyphs,q)}if(B){J.clear();const de=b.icon.placedSymbolArray;for(let pe=0;pe<de.length;pe++){const ge=de.get(pe);if(ge.hidden)to(ge.numGlyphs,J);else{const xe=le[pe];if(xe)for(let _e=0;_e<ge.numGlyphs;_e++)a.av(J,xe.shiftedAnchor,xe.angle);else to(ge.numGlyphs,J)}}b.icon.dynamicLayoutVertexBuffer.updateData(J)}b.text.dynamicLayoutVertexBuffer.updateData(q)}function ol(b,n,d){return d.iconsInText&&n?"symbolTextAndIcon":b?"symbolSDF":"symbolIcon"}function kc(b,n,d,m,y,x,S,I,B,F,U,W,G){const q=b.context,J=q.gl,le=b.transform,de=I==="map",pe=B==="map",ge=I!=="viewport"&&d.layout.get("symbol-placement")!=="point",xe=de&&!pe&&!ge,_e=!d.layout.get("symbol-sort-key").isConstant();let Te=!1;const Pe=b.getDepthModeForSublayer(0,pr.ReadOnly),ve=d._unevaluatedLayout.hasValue("text-variable-anchor")||d._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Re=[],$e=le.getCircleRadiusCorrection();for(const We of m){const qe=n.getTile(We),Qe=qe.getBucket(d);if(!Qe)continue;const bt=y?Qe.text:Qe.icon;if(!bt||!bt.segments.get().length||!bt.hasVisibleVertices)continue;const Et=bt.programConfigurations.get(d.id),ut=y||Qe.sdfIcons,Ut=y?Qe.textSizeData:Qe.iconSizeData,Ar=pe||le.pitch!==0,Ur=b.useProgram(ol(ut,y,Qe),Et),ei=a.an(Ut,le.zoom),Xr=b.style.map.terrain&&b.style.map.terrain.getTerrainData(We);let ai,wi,yr,Hr,Zi=[0,0],tn=null;if(y)wi=qe.glyphAtlasTexture,yr=J.LINEAR,ai=qe.glyphAtlasTexture.size,Qe.iconsInText&&(Zi=qe.imageAtlasTexture.size,tn=qe.imageAtlasTexture,Hr=Ar||b.options.rotating||b.options.zooming||Ut.kind==="composite"||Ut.kind==="camera"?J.LINEAR:J.NEAREST);else{const Xi=d.layout.get("icon-size").constantOr(0)!==1||Qe.iconsNeedLinear;wi=qe.imageAtlasTexture,yr=ut||b.options.rotating||b.options.zooming||Xi||Ar?J.LINEAR:J.NEAREST,ai=qe.imageAtlasTexture.size}const dn=a.aC(qe,1,b.transform.zoom),as=ui(de,b.transform,dn),oo=a.L();a.aq(oo,as);const Pa=Er(pe,de,b.transform,dn),ea=a.aD(le,qe,x,S),Vl=le.getProjectionData({overscaledTileID:We,applyGlobeMatrix:!G,applyTerrainMatrix:!0}),Gl=ve&&Qe.hasTextData(),dl=d.layout.get("icon-text-fit")!=="none"&&Gl&&Qe.hasIconData();if(ge){const Xi=b.style.map.terrain?(us,nn)=>b.style.map.terrain.getElevation(We,us,nn):null,rn=d.layout.get("text-rotation-alignment")==="map";si(Qe,b,y,as,oo,pe,F,rn,We.toUnwrapped(),le.width,le.height,ea,Xi)}const Hl=y&&ve||dl,ls=ge||Hl?af:pe?as:b.transform.clipSpaceToPixelsMatrix,Lo=ut&&d.paint.get(y?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let cs;cs=ut?Qe.iconsInText?vu(Ut.kind,ei,xe,pe,ge,Hl,b,ls,Pa,ea,ai,Zi,$e):Bd(Ut.kind,ei,xe,pe,ge,Hl,b,ls,Pa,ea,y,ai,0,$e):Ac(Ut.kind,ei,xe,pe,ge,Hl,b,ls,Pa,ea,y,ai,$e);const Ra={program:Ur,buffers:bt,uniformValues:cs,projectionData:Vl,atlasTexture:wi,atlasTextureIcon:tn,atlasInterpolation:yr,atlasInterpolationIcon:Hr,isSDF:ut,hasHalo:Lo};if(_e&&Qe.canOverlap){Te=!0;const Xi=bt.segments.get();for(const rn of Xi)Re.push({segments:new a.aM([rn]),sortKey:rn.sortKey,state:Ra,terrainData:Xr})}else Re.push({segments:bt.segments,sortKey:0,state:Ra,terrainData:Xr})}Te&&Re.sort(((We,qe)=>We.sortKey-qe.sortKey));for(const We of Re){const qe=We.state;if(q.activeTexture.set(J.TEXTURE0),qe.atlasTexture.bind(qe.atlasInterpolation,J.CLAMP_TO_EDGE),qe.atlasTextureIcon&&(q.activeTexture.set(J.TEXTURE1),qe.atlasTextureIcon&&qe.atlasTextureIcon.bind(qe.atlasInterpolationIcon,J.CLAMP_TO_EDGE)),qe.isSDF){const Qe=qe.uniformValues;qe.hasHalo&&(Qe.u_is_halo=1,Dl(qe.buffers,We.segments,d,b,qe.program,Pe,U,W,Qe,qe.projectionData,We.terrainData)),Qe.u_is_halo=0}Dl(qe.buffers,We.segments,d,b,qe.program,Pe,U,W,qe.uniformValues,qe.projectionData,We.terrainData)}}function Dl(b,n,d,m,y,x,S,I,B,F,U){const W=m.context;y.draw(W,W.gl.TRIANGLES,x,S,I,lr.backCCW,B,U,F,d.id,b.layoutVertexBuffer,b.indexBuffer,n,d.paint,m.transform.zoom,b.programConfigurations.get(d.id),b.dynamicLayoutVertexBuffer,b.opacityVertexBuffer)}function Nl(b,n,d,m,y){const x=b.context,S=x.gl,I=Rr.disabled,B=new ii([S.ONE,S.ONE],a.bf.transparent,[!0,!0,!0,!0]),F=n.getBucket(d);if(!F)return;const U=m.key;let W=d.heatmapFbos.get(U);W||(W=qo(x,n.tileSize,n.tileSize),d.heatmapFbos.set(U,W)),x.bindFramebuffer.set(W.framebuffer),x.viewport.set([0,0,n.tileSize,n.tileSize]),x.clear({color:a.bf.transparent});const G=F.programConfigurations.get(d.id),q=b.useProgram("heatmap",G,!y),J=b.transform.getProjectionData({overscaledTileID:n.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),le=b.style.map.terrain.getTerrainData(m);q.draw(x,S.TRIANGLES,pr.disabled,I,B,lr.disabled,tf(n,b.transform.zoom,d.paint.get("heatmap-intensity"),1),le,J,d.id,F.layoutVertexBuffer,F.indexBuffer,F.segments,d.paint,b.transform.zoom,G)}function Cu(b,n,d,m,y){const x=b.context,S=x.gl,I=b.transform;x.setColorMode(b.colorModeForRenderPass());const B=Bc(x,n),F=d.key,U=n.heatmapFbos.get(F);if(!U)return;x.activeTexture.set(S.TEXTURE0),S.bindTexture(S.TEXTURE_2D,U.colorAttachment.get()),x.activeTexture.set(S.TEXTURE1),B.bind(S.LINEAR,S.CLAMP_TO_EDGE);const W=I.getProjectionData({overscaledTileID:d,applyTerrainMatrix:y,applyGlobeMatrix:!m});b.useProgram("heatmapTexture").draw(x,S.TRIANGLES,pr.disabled,Rr.disabled,b.colorModeForRenderPass(),lr.disabled,Sd(b,n,0,1),null,W,n.id,b.rasterBoundsBuffer,b.quadTriangleIndexBuffer,b.rasterBoundsSegments,n.paint,I.zoom),U.destroy(),n.heatmapFbos.delete(F)}function qo(b,n,d){var m,y;const x=b.gl,S=x.createTexture();x.bindTexture(x.TEXTURE_2D,S),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_S,x.CLAMP_TO_EDGE),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_T,x.CLAMP_TO_EDGE),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MIN_FILTER,x.LINEAR),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MAG_FILTER,x.LINEAR);const I=(m=b.HALF_FLOAT)!==null&&m!==void 0?m:x.UNSIGNED_BYTE,B=(y=b.RGBA16F)!==null&&y!==void 0?y:x.RGBA;x.texImage2D(x.TEXTURE_2D,0,B,n,d,0,x.RGBA,I,null);const F=b.createFramebuffer(n,d,!1,!1);return F.colorAttachment.set(S),F}function Bc(b,n){return n.colorRampTexture||(n.colorRampTexture=new a.T(b,n.colorRamp,b.gl.RGBA)),n.colorRampTexture}function Mu(b,n,d,m,y){if(!d||!m||!m.imageAtlas)return;const x=m.imageAtlas.patternPositions;let S=x[d.to.toString()],I=x[d.from.toString()];if(!S&&I&&(S=I),!I&&S&&(I=S),!S||!I){const B=y.getPaintProperty(n);S=x[B],I=x[B]}S&&I&&b.setConstantPatternPositions(S,I)}function vh(b,n,d,m,y,x,S,I){const B=b.context.gl,F="fill-pattern",U=d.paint.get(F),W=U&&U.constantOr(1),G=d.getCrossfadeParameters();let q,J,le,de,pe;const ge=b.transform,xe=d.paint.get("fill-translate"),_e=d.paint.get("fill-translate-anchor");S?(J=W&&!d.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",q=B.LINES):(J=W?"fillPattern":"fill",q=B.TRIANGLES);const Te=U.constantOr(null);for(const Pe of m){const ve=n.getTile(Pe);if(W&&!ve.patternsLoaded())continue;const Re=ve.getBucket(d);if(!Re)continue;const $e=Re.programConfigurations.get(d.id),We=b.useProgram(J,$e),qe=b.style.map.terrain&&b.style.map.terrain.getTerrainData(Pe);W&&(b.context.activeTexture.set(B.TEXTURE0),ve.imageAtlasTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE),$e.updatePaintBuffers(G)),Mu($e,F,Te,ve,d);const Qe=ge.getProjectionData({overscaledTileID:Pe,applyGlobeMatrix:!I,applyTerrainMatrix:!0}),bt=a.aD(ge,ve,xe,_e);if(S){de=Re.indexBuffer2,pe=Re.segments2;const ut=[B.drawingBufferWidth,B.drawingBufferHeight];le=J==="fillOutlinePattern"&&W?gu(b,G,ve,ut,bt):wc(ut,bt)}else de=Re.indexBuffer,pe=Re.segments,le=W?ph(b,G,ve,bt):{u_fill_translate:bt};const Et=b.stencilModeForClipping(Pe);We.draw(b.context,q,y,Et,x,lr.backCCW,le,qe,Qe,d.id,Re.layoutVertexBuffer,de,pe,d.paint,b.transform.zoom,$e)}}function bh(b,n,d,m,y,x,S,I){const B=b.context,F=B.gl,U="fill-extrusion-pattern",W=d.paint.get(U),G=W.constantOr(1),q=d.getCrossfadeParameters(),J=d.paint.get("fill-extrusion-opacity"),le=W.constantOr(null),de=b.transform;for(const pe of m){const ge=n.getTile(pe),xe=ge.getBucket(d);if(!xe)continue;const _e=b.style.map.terrain&&b.style.map.terrain.getTerrainData(pe),Te=xe.programConfigurations.get(d.id),Pe=b.useProgram(G?"fillExtrusionPattern":"fillExtrusion",Te);G&&(b.context.activeTexture.set(F.TEXTURE0),ge.imageAtlasTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE),Te.updatePaintBuffers(q));const ve=de.getProjectionData({overscaledTileID:pe,applyGlobeMatrix:!I,applyTerrainMatrix:!0});Mu(Te,U,le,ge,d);const Re=a.aD(de,ge,d.paint.get("fill-extrusion-translate"),d.paint.get("fill-extrusion-translate-anchor")),$e=d.paint.get("fill-extrusion-vertical-gradient"),We=G?jm(b,$e,J,Re,pe,q,ge):Mo(b,$e,J,Re);Pe.draw(B,B.gl.TRIANGLES,y,x,S,lr.backCCW,We,_e,ve,d.id,xe.layoutVertexBuffer,xe.indexBuffer,xe.segments,d.paint,b.transform.zoom,Te,b.style.map.terrain&&xe.centroidVertexBuffer)}}function $o(b,n,d,m,y,x,S,I,B){var F;const U=b.style.projection,W=b.context,G=b.transform,q=W.gl,J=[`#define NUM_ILLUMINATION_SOURCES ${d.paint.get("hillshade-highlight-color").values.length}`],le=b.useProgram("hillshade",null,!1,J),de=!b.options.moving;for(const pe of m){const ge=n.getTile(pe),xe=ge.fbo;if(!xe)continue;const _e=U.getMeshFromTileID(W,pe.canonical,I,!0,"raster"),Te=(F=b.style.map.terrain)===null||F===void 0?void 0:F.getTerrainData(pe);W.activeTexture.set(q.TEXTURE0),q.bindTexture(q.TEXTURE_2D,xe.colorAttachment.get());const Pe=G.getProjectionData({overscaledTileID:pe,aligned:de,applyGlobeMatrix:!B,applyTerrainMatrix:!0});le.draw(W,q.TRIANGLES,x,y[pe.overscaledZ],S,lr.backCCW,Cd(b,ge,d),Te,Pe,d.id,_e.vertexBuffer,_e.indexBuffer,_e.segments)}}function Lc(b,n,d,m,y,x,S,I,B){var F;const U=b.style.projection,W=b.context,G=b.transform,q=W.gl,J=b.useProgram("colorRelief"),le=!b.options.moving;let de=!0,pe=0;for(const ge of m){const xe=n.getTile(ge),_e=xe.dem;if(de){const We=q.getParameter(q.MAX_TEXTURE_SIZE),{elevationTexture:qe,colorTexture:Qe}=d.getColorRampTextures(W,We,_e.getUnpackVector());W.activeTexture.set(q.TEXTURE1),qe.bind(q.NEAREST,q.CLAMP_TO_EDGE),W.activeTexture.set(q.TEXTURE4),Qe.bind(q.LINEAR,q.CLAMP_TO_EDGE),de=!1,pe=qe.size[0]}if(!_e||!_e.data)continue;const Te=_e.stride,Pe=_e.getPixels();if(W.activeTexture.set(q.TEXTURE0),W.pixelStoreUnpackPremultiplyAlpha.set(!1),xe.demTexture=xe.demTexture||b.getTileTexture(Te),xe.demTexture){const We=xe.demTexture;We.update(Pe,{premultiply:!1}),We.bind(q.LINEAR,q.CLAMP_TO_EDGE)}else xe.demTexture=new a.T(W,Pe,q.RGBA,{premultiply:!1}),xe.demTexture.bind(q.LINEAR,q.CLAMP_TO_EDGE);const ve=U.getMeshFromTileID(W,ge.canonical,I,!0,"raster"),Re=(F=b.style.map.terrain)===null||F===void 0?void 0:F.getTerrainData(ge),$e=G.getProjectionData({overscaledTileID:ge,aligned:le,applyGlobeMatrix:!B,applyTerrainMatrix:!0});J.draw(W,q.TRIANGLES,x,y[ge.overscaledZ],S,lr.backCCW,Pd(d,xe.dem,pe),Re,$e,d.id,ve.vertexBuffer,ve.indexBuffer,ve.segments)}}const Dc=[new a.P(0,0),new a.P(a.$,0),new a.P(a.$,a.$),new a.P(0,a.$)];function ba(b,n,d,m,y,x,S,I,B=!1,F=!1){const U=m[m.length-1].overscaledZ,W=b.context,G=W.gl,q=b.useProgram("raster"),J=b.transform,le=b.style.projection,de=b.colorModeForRenderPass(),pe=!b.options.moving;for(const ge of m){const xe=b.getDepthModeForSublayer(ge.overscaledZ-U,d.paint.get("raster-opacity")===1?pr.ReadWrite:pr.ReadOnly,G.LESS),_e=n.getTile(ge);_e.registerFadeDuration(d.paint.get("raster-fade-duration"));const Te=n.findLoadedParent(ge,0),Pe=n.findLoadedSibling(ge),ve=Pu(_e,Te||Pe||null,n,d,b.transform,b.style.map.terrain);let Re,$e;const We=d.paint.get("raster-resampling")==="nearest"?G.NEAREST:G.LINEAR;W.activeTexture.set(G.TEXTURE0),_e.texture.bind(We,G.CLAMP_TO_EDGE,G.LINEAR_MIPMAP_NEAREST),W.activeTexture.set(G.TEXTURE1),Te?(Te.texture.bind(We,G.CLAMP_TO_EDGE,G.LINEAR_MIPMAP_NEAREST),Re=Math.pow(2,Te.tileID.overscaledZ-_e.tileID.overscaledZ),$e=[_e.tileID.canonical.x*Re%1,_e.tileID.canonical.y*Re%1]):_e.texture.bind(We,G.CLAMP_TO_EDGE,G.LINEAR_MIPMAP_NEAREST),_e.texture.useMipmap&&W.extTextureFilterAnisotropic&&b.transform.pitch>20&&G.texParameterf(G.TEXTURE_2D,W.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,W.extTextureFilterAnisotropicMax);const qe=b.style.map.terrain&&b.style.map.terrain.getTerrainData(ge),Qe=J.getProjectionData({overscaledTileID:ge,aligned:pe,applyGlobeMatrix:!F,applyTerrainMatrix:!0}),bt=yu($e||[0,0],Re||1,ve,d,I),Et=le.getMeshFromTileID(W,ge.canonical,x,S,"raster");q.draw(W,G.TRIANGLES,xe,y?y[ge.overscaledZ]:Rr.disabled,de,B?lr.frontCCW:lr.backCCW,bt,qe,Qe,d.id,Et.vertexBuffer,Et.indexBuffer,Et.segments)}}function Pu(b,n,d,m,y,x){const S=m.paint.get("raster-fade-duration");if(!x&&S>0){const I=L.now(),B=(I-b.timeAdded)/S,F=n?(I-n.timeAdded)/S:-1,U=d.getSource(),W=Ft(y,{tileSize:U.tileSize,roundZoom:U.roundZoom}),G=!n||Math.abs(n.tileID.overscaledZ-W)>Math.abs(b.tileID.overscaledZ-W),q=G&&b.refreshedUponExpiration?1:a.ah(G?B:1-F,0,1);return b.refreshedUponExpiration&&B>=1&&(b.refreshedUponExpiration=!1),n?{opacity:1,mix:1-q}:{opacity:q,mix:0}}return{opacity:1,mix:0}}const xh=new a.bf(1,0,0,1),lf=new a.bf(0,1,0,1),Ru=new a.bf(0,0,1,1),Gd=new a.bf(1,0,1,1),$m=new a.bf(0,1,1,1);function Iu(b,n,d,m){Io(b,0,n+d/2,b.transform.width,d,m)}function Yr(b,n,d,m){Io(b,n-d/2,0,d,b.transform.height,m)}function Io(b,n,d,m,y,x){const S=b.context,I=S.gl;I.enable(I.SCISSOR_TEST),I.scissor(n*b.pixelRatio,d*b.pixelRatio,m*b.pixelRatio,y*b.pixelRatio),S.clear({color:x}),I.disable(I.SCISSOR_TEST)}function kn(b,n,d){const m=b.context,y=m.gl,x=b.useProgram("debug"),S=pr.disabled,I=Rr.disabled,B=b.colorModeForRenderPass(),F="$debug",U=b.style.map.terrain&&b.style.map.terrain.getTerrainData(d);m.activeTexture.set(y.TEXTURE0);const W=n.getTileByID(d.key).latestRawTileData,G=Math.floor((W&&W.byteLength||0)/1024),q=n.getTile(d).tileSize,J=512/Math.min(q,512)*(d.overscaledZ/b.transform.zoom)*.5;let le=d.canonical.toString();d.overscaledZ!==d.canonical.z&&(le+=` => ${d.overscaledZ}`),(function(pe,ge){pe.initDebugOverlayCanvas();const xe=pe.debugOverlayCanvas,_e=pe.context.gl,Te=pe.debugOverlayCanvas.getContext("2d");Te.clearRect(0,0,xe.width,xe.height),Te.shadowColor="white",Te.shadowBlur=2,Te.lineWidth=1.5,Te.strokeStyle="white",Te.textBaseline="top",Te.font="bold 36px Open Sans, sans-serif",Te.fillText(ge,5,5),Te.strokeText(ge,5,5),pe.debugOverlayTexture.update(xe),pe.debugOverlayTexture.bind(_e.LINEAR,_e.CLAMP_TO_EDGE)})(b,`${le} ${G}kB`);const de=b.transform.getProjectionData({overscaledTileID:d,applyGlobeMatrix:!0,applyTerrainMatrix:!0});x.draw(m,y.TRIANGLES,S,I,ii.alphaBlended,lr.disabled,Rl(a.bf.transparent,J),null,de,F,b.debugBuffer,b.quadTriangleIndexBuffer,b.debugSegments),x.draw(m,y.LINE_STRIP,S,I,B,lr.disabled,Rl(a.bf.red),U,de,F,b.debugBuffer,b.tileBorderIndexBuffer,b.debugSegments)}function Us(b,n,d,m){const{isRenderingGlobe:y}=m,x=b.context,S=x.gl,I=b.transform,B=b.colorModeForRenderPass(),F=b.getDepthModeFor3D(),U=b.useProgram("terrain");x.bindFramebuffer.set(null),x.viewport.set([0,0,b.width,b.height]);for(const W of d){const G=n.getTerrainMesh(W.tileID),q=b.renderToTexture.getTexture(W),J=n.getTerrainData(W.tileID);x.activeTexture.set(S.TEXTURE0),S.bindTexture(S.TEXTURE_2D,q.texture);const le=n.getMeshFrameDelta(I.zoom),de=I.calculateFogMatrix(W.tileID.toUnwrapped()),pe=dh(le,de,b.style.sky,I.pitch,y),ge=I.getProjectionData({overscaledTileID:W.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});U.draw(x,S.TRIANGLES,F,Rr.disabled,B,lr.backCCW,pe,J,ge,"terrain",G.vertexBuffer,G.indexBuffer,G.segments)}}function xa(b,n){if(!n.mesh){const d=new a.aL;d.emplaceBack(-1,-1),d.emplaceBack(1,-1),d.emplaceBack(1,1),d.emplaceBack(-1,1);const m=new a.aN;m.emplaceBack(0,1,2),m.emplaceBack(0,2,3),n.mesh=new mt(b.createVertexBuffer(d,Xt.members),b.createIndexBuffer(m),a.aM.simpleSegment(0,0,d.length,m.length))}return n.mesh}class Zo{constructor(n,d){this.context=new Rc(n),this.transform=d,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:a.ag(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=Sr.maxUnderzooming+Sr.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new ie}resize(n,d,m){if(this.width=Math.floor(n*m),this.height=Math.floor(d*m),this.pixelRatio=m,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const y of this.style._order)this.style._layers[y].resize()}setup(){const n=this.context,d=new a.aL;d.emplaceBack(0,0),d.emplaceBack(a.$,0),d.emplaceBack(0,a.$),d.emplaceBack(a.$,a.$),this.tileExtentBuffer=n.createVertexBuffer(d,Xt.members),this.tileExtentSegments=a.aM.simpleSegment(0,0,4,2);const m=new a.aL;m.emplaceBack(0,0),m.emplaceBack(a.$,0),m.emplaceBack(0,a.$),m.emplaceBack(a.$,a.$),this.debugBuffer=n.createVertexBuffer(m,Xt.members),this.debugSegments=a.aM.simpleSegment(0,0,4,5);const y=new a.c6;y.emplaceBack(0,0,0,0),y.emplaceBack(a.$,0,a.$,0),y.emplaceBack(0,a.$,0,a.$),y.emplaceBack(a.$,a.$,a.$,a.$),this.rasterBoundsBuffer=n.createVertexBuffer(y,Um.members),this.rasterBoundsSegments=a.aM.simpleSegment(0,0,4,2);const x=new a.aL;x.emplaceBack(0,0),x.emplaceBack(a.$,0),x.emplaceBack(0,a.$),x.emplaceBack(a.$,a.$),this.rasterBoundsBufferPosOnly=n.createVertexBuffer(x,Xt.members),this.rasterBoundsSegmentsPosOnly=a.aM.simpleSegment(0,0,4,5);const S=new a.aL;S.emplaceBack(0,0),S.emplaceBack(1,0),S.emplaceBack(0,1),S.emplaceBack(1,1),this.viewportBuffer=n.createVertexBuffer(S,Xt.members),this.viewportSegments=a.aM.simpleSegment(0,0,4,2);const I=new a.c7;I.emplaceBack(0),I.emplaceBack(1),I.emplaceBack(3),I.emplaceBack(2),I.emplaceBack(0),this.tileBorderIndexBuffer=n.createIndexBuffer(I);const B=new a.aN;B.emplaceBack(1,0,2),B.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=n.createIndexBuffer(B);const F=this.context.gl;this.stencilClearMode=new Rr({func:F.ALWAYS,mask:0},0,255,F.ZERO,F.ZERO,F.ZERO),this.tileExtentMesh=new mt(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){const n=this.context,d=n.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const m=a.L();a.bY(m,0,this.width,this.height,0,0,1),a.N(m,m,[d.drawingBufferWidth,d.drawingBufferHeight,0]);const y={mainMatrix:m,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:m};this.useProgram("clippingMask",null,!0).draw(n,d.TRIANGLES,pr.disabled,this.stencilClearMode,ii.disabled,lr.disabled,null,null,y,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(n,d,m){if(this.currentStencilSource===n.source||!n.isTileClipped()||!d||!d.length)return;this.currentStencilSource=n.source,this.nextStencilID+d.length>256&&this.clearStencil();const y=this.context;y.setColorMode(ii.disabled),y.setDepthMode(pr.disabled);const x={};for(const S of d)x[S.key]=this.nextStencilID++;this._renderTileMasks(x,d,m,!0),this._renderTileMasks(x,d,m,!1),this._tileClippingMaskIDs=x}_renderTileMasks(n,d,m,y){const x=this.context,S=x.gl,I=this.style.projection,B=this.transform,F=this.useProgram("clippingMask");for(const U of d){const W=n[U.key],G=this.style.map.terrain&&this.style.map.terrain.getTerrainData(U),q=I.getMeshFromTileID(this.context,U.canonical,y,!0,"stencil"),J=B.getProjectionData({overscaledTileID:U,applyGlobeMatrix:!m,applyTerrainMatrix:!0});F.draw(x,S.TRIANGLES,pr.disabled,new Rr({func:S.ALWAYS,mask:0},W,255,S.KEEP,S.KEEP,S.REPLACE),ii.disabled,m?lr.disabled:lr.backCCW,null,G,J,"$clipping",q.vertexBuffer,q.indexBuffer,q.segments)}}_renderTilesDepthBuffer(){const n=this.context,d=n.gl,m=this.style.projection,y=this.transform,x=this.useProgram("depth"),S=this.getDepthModeFor3D(),I=Le(y,{tileSize:y.tileSize});for(const B of I){const F=this.style.map.terrain&&this.style.map.terrain.getTerrainData(B),U=m.getMeshFromTileID(this.context,B.canonical,!0,!0,"raster"),W=y.getProjectionData({overscaledTileID:B,applyGlobeMatrix:!0,applyTerrainMatrix:!0});x.draw(n,d.TRIANGLES,S,Rr.disabled,ii.disabled,lr.backCCW,null,F,W,"$clipping",U.vertexBuffer,U.indexBuffer,U.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const n=this.nextStencilID++,d=this.context.gl;return new Rr({func:d.NOTEQUAL,mask:255},n,255,d.KEEP,d.KEEP,d.REPLACE)}stencilModeForClipping(n){const d=this.context.gl;return new Rr({func:d.EQUAL,mask:255},this._tileClippingMaskIDs[n.key],0,d.KEEP,d.KEEP,d.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(n){const d=this.context.gl,m=n.sort(((S,I)=>I.overscaledZ-S.overscaledZ)),y=m[m.length-1].overscaledZ,x=m[0].overscaledZ-y+1;if(x>1){this.currentStencilSource=void 0,this.nextStencilID+x>256&&this.clearStencil();const S={};for(let I=0;I<x;I++)S[I+y]=new Rr({func:d.GEQUAL,mask:255},I+this.nextStencilID,255,d.KEEP,d.KEEP,d.REPLACE);return this.nextStencilID+=x,[S,m]}return[{[y]:Rr.disabled},m]}stencilConfigForOverlapTwoPass(n){const d=this.context.gl,m=n.sort(((S,I)=>I.overscaledZ-S.overscaledZ)),y=m[m.length-1].overscaledZ,x=m[0].overscaledZ-y+1;if(this.clearStencil(),x>1){const S={},I={};for(let B=0;B<x;B++)S[B+y]=new Rr({func:d.GREATER,mask:255},x+1+B,255,d.KEEP,d.KEEP,d.REPLACE),I[B+y]=new Rr({func:d.GREATER,mask:255},1+B,255,d.KEEP,d.KEEP,d.REPLACE);return this.nextStencilID=2*x+1,[S,I,m]}return this.nextStencilID=3,[{[y]:new Rr({func:d.GREATER,mask:255},2,255,d.KEEP,d.KEEP,d.REPLACE)},{[y]:new Rr({func:d.GREATER,mask:255},1,255,d.KEEP,d.KEEP,d.REPLACE)},m]}colorModeForRenderPass(){const n=this.context.gl;return this._showOverdrawInspector?new ii([n.CONSTANT_COLOR,n.ONE],new a.bf(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?ii.unblended:ii.alphaBlended}getDepthModeForSublayer(n,d,m){if(!this.opaquePassEnabledForLayer())return pr.disabled;const y=1-((1+this.currentLayer)*this.numSublayers+n)*this.depthEpsilon;return new pr(m||this.context.gl.LEQUAL,d,[y,y])}getDepthModeFor3D(){return new pr(this.context.gl.LEQUAL,pr.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(n,d){var m,y;this.style=n,this.options=d,this.lineAtlas=n.lineAtlas,this.imageManager=n.imageManager,this.glyphManager=n.glyphManager,this.symbolFadeChange=n.placement.symbolFadeChange(L.now()),this.imageManager.beginFrame();const x=this.style._order,S=this.style.sourceCaches,I={},B={},F={},U={isRenderingToTexture:!1,isRenderingGlobe:((m=n.projection)===null||m===void 0?void 0:m.transitionState)>0};for(const G in S){const q=S[G];q.used&&q.prepare(this.context),I[G]=q.getVisibleCoordinates(!1),B[G]=I[G].slice().reverse(),F[G]=q.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let G=0;G<x.length;G++)if(this.style._layers[x[G]].is3D()){this.opaquePassCutoff=G;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const G of x){const q=this.style._layers[G];if(!q.hasOffscreenPass()||q.isHidden(this.transform.zoom))continue;const J=B[q.source];(q.type==="custom"||J.length)&&this.renderLayer(this,S[q.source],q,J,U)}if((y=this.style.projection)===null||y===void 0||y.updateGPUdependent({context:this.context,useProgram:G=>this.useProgram(G)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:d.showOverdrawInspector?a.bf.black:a.bf.transparent,depth:1}),this.clearStencil(),this.style.sky&&(function(G,q){const J=G.context,le=J.gl,de=((Pe,ve,Re)=>{const $e=Math.cos(ve.rollInRadians),We=Math.sin(ve.rollInRadians),qe=Se(ve),Qe=ve.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:Pe.properties.get("sky-color"),u_horizon_color:Pe.properties.get("horizon-color"),u_horizon:[(ve.width/2-qe*We)*Re,(ve.height/2+qe*$e)*Re],u_horizon_normal:[-We,$e],u_sky_horizon_blend:Pe.properties.get("sky-horizon-blend")*ve.height/2*Re,u_sky_blend:Qe}})(q,G.style.map.transform,G.pixelRatio),pe=new pr(le.LEQUAL,pr.ReadWrite,[0,1]),ge=Rr.disabled,xe=G.colorModeForRenderPass(),_e=G.useProgram("sky"),Te=xa(J,q);_e.draw(J,le.TRIANGLES,pe,ge,xe,lr.disabled,de,null,void 0,"sky",Te.vertexBuffer,Te.indexBuffer,Te.segments)})(this,this.style.sky),this._showOverdrawInspector=d.showOverdrawInspector,this.depthRangeFor3D=[0,1-(n._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=x.length-1;this.currentLayer>=0;this.currentLayer--){const G=this.style._layers[x[this.currentLayer]],q=S[G.source],J=I[G.source];this._renderTileClippingMasks(G,J,!1),this.renderLayer(this,q,G,J,U)}this.renderPass="translucent";let W=!1;for(this.currentLayer=0;this.currentLayer<x.length;this.currentLayer++){const G=this.style._layers[x[this.currentLayer]],q=S[G.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(G,U))continue;this.opaquePassEnabledForLayer()||W||(W=!0,U.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());const J=(G.type==="symbol"?F:B)[G.source];this._renderTileClippingMasks(G,I[G.source],!!this.renderToTexture),this.renderLayer(this,q,G,J,U)}if(U.isRenderingGlobe&&(function(G,q,J){const le=G.context,de=le.gl,pe=G.useProgram("atmosphere"),ge=new pr(de.LEQUAL,pr.ReadOnly,[0,1]),xe=G.transform,_e=(function(Qe,bt){const Et=Qe.properties.get("position"),ut=[-Et.x,-Et.y,-Et.z],Ut=a.ag(new Float64Array(16));return Qe.properties.get("anchor")==="map"&&(a.b6(Ut,Ut,bt.rollInRadians),a.b7(Ut,Ut,-bt.pitchInRadians),a.b6(Ut,Ut,bt.bearingInRadians),a.b7(Ut,Ut,bt.center.lat*Math.PI/180),a.bz(Ut,Ut,-bt.center.lng*Math.PI/180)),a.c5(ut,ut,Ut),ut})(J,G.transform),Te=xe.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),Pe=q.properties.get("atmosphere-blend")*Te.projectionTransition;if(Pe===0)return;const ve=fa(xe.worldSize,xe.center.lat),Re=xe.inverseProjectionMatrix,$e=new Float64Array(4);$e[3]=1,a.aw($e,$e,xe.modelViewProjectionMatrix),$e[0]/=$e[3],$e[1]/=$e[3],$e[2]/=$e[3],$e[3]=1,a.aw($e,$e,Re),$e[0]/=$e[3],$e[1]/=$e[3],$e[2]/=$e[3],$e[3]=1;const We=((Qe,bt,Et,ut,Ut)=>({u_sun_pos:Qe,u_atmosphere_blend:bt,u_globe_position:Et,u_globe_radius:ut,u_inv_proj_matrix:Ut}))(_e,Pe,[$e[0],$e[1],$e[2]],ve,Re),qe=xa(le,q);pe.draw(le,de.TRIANGLES,ge,Rr.disabled,ii.alphaBlended,lr.disabled,We,null,null,"atmosphere",qe.vertexBuffer,qe.indexBuffer,qe.segments)})(this,this.style.sky,this.style.light),this.options.showTileBoundaries){const G=(function(q,J){let le=null;const de=Object.values(q._layers).flatMap((_e=>_e.source&&!_e.isHidden(J)?[q.sourceCaches[_e.source]]:[])),pe=de.filter((_e=>_e.getSource().type==="vector")),ge=de.filter((_e=>_e.getSource().type!=="vector")),xe=_e=>{(!le||le.getSource().maxzoom<_e.getSource().maxzoom)&&(le=_e)};return pe.forEach((_e=>xe(_e))),le||ge.forEach((_e=>xe(_e))),le})(this.style,this.transform.zoom);G&&(function(q,J,le){for(let de=0;de<le.length;de++)kn(q,J,le[de])})(this,G,G.getVisibleCoordinates())}this.options.showPadding&&(function(G){const q=G.transform.padding;Iu(G,G.transform.height-(q.top||0),3,xh),Iu(G,q.bottom||0,3,lf),Yr(G,q.left||0,3,Ru),Yr(G,G.transform.width-(q.right||0),3,Gd);const J=G.transform.centerPoint;(function(le,de,pe,ge){Io(le,de-1,pe-10,2,20,ge),Io(le,de-10,pe-1,20,2,ge)})(G,J.x,G.transform.height-J.y,$m)})(this),this.context.setDefault()}maybeDrawDepthAndCoords(n){if(!this.style||!this.style.map||!this.style.map.terrain)return;const d=this.terrainFacilitator.matrix,m=this.transform.modelViewProjectionMatrix;let y=this.terrainFacilitator.dirty;y||(y=n?!a.c8(d,m):!a.c9(d,m)),y||(y=this.style.map.terrain.sourceCache.anyTilesAfterTime(this.terrainFacilitator.renderTime)),y&&(a.ca(d,m),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,(function(x,S){const I=x.context,B=I.gl,F=x.transform,U=ii.unblended,W=new pr(B.LEQUAL,pr.ReadWrite,[0,1]),G=S.sourceCache.getRenderableTiles(),q=x.useProgram("terrainDepth");I.bindFramebuffer.set(S.getFramebuffer("depth").framebuffer),I.viewport.set([0,0,x.width/devicePixelRatio,x.height/devicePixelRatio]),I.clear({color:a.bf.transparent,depth:1});for(const J of G){const le=S.getTerrainMesh(J.tileID),de=S.getTerrainData(J.tileID),pe=F.getProjectionData({overscaledTileID:J.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),ge={u_ele_delta:S.getMeshFrameDelta(F.zoom)};q.draw(I,B.TRIANGLES,W,Rr.disabled,U,lr.backCCW,ge,de,pe,"terrain",le.vertexBuffer,le.indexBuffer,le.segments)}I.bindFramebuffer.set(null),I.viewport.set([0,0,x.width,x.height])})(this,this.style.map.terrain),(function(x,S){const I=x.context,B=I.gl,F=x.transform,U=ii.unblended,W=new pr(B.LEQUAL,pr.ReadWrite,[0,1]),G=S.getCoordsTexture(),q=S.sourceCache.getRenderableTiles(),J=x.useProgram("terrainCoords");I.bindFramebuffer.set(S.getFramebuffer("coords").framebuffer),I.viewport.set([0,0,x.width/devicePixelRatio,x.height/devicePixelRatio]),I.clear({color:a.bf.transparent,depth:1}),S.coordsIndex=[];for(const le of q){const de=S.getTerrainMesh(le.tileID),pe=S.getTerrainData(le.tileID);I.activeTexture.set(B.TEXTURE0),B.bindTexture(B.TEXTURE_2D,G.texture);const ge={u_terrain_coords_id:(255-S.coordsIndex.length)/255,u_texture:0,u_ele_delta:S.getMeshFrameDelta(F.zoom)},xe=F.getProjectionData({overscaledTileID:le.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});J.draw(I,B.TRIANGLES,W,Rr.disabled,U,lr.backCCW,ge,pe,xe,"terrain",de.vertexBuffer,de.indexBuffer,de.segments),S.coordsIndex.push(le.tileID.key)}I.bindFramebuffer.set(null),I.viewport.set([0,0,x.width,x.height])})(this,this.style.map.terrain))}renderLayer(n,d,m,y,x){m.isHidden(this.transform.zoom)||(m.type==="background"||m.type==="custom"||(y||[]).length)&&(this.id=m.id,a.cb(m)?(function(S,I,B,F,U,W){if(S.renderPass!=="translucent")return;const{isRenderingToTexture:G}=W,q=Rr.disabled,J=S.colorModeForRenderPass();(B._unevaluatedLayout.hasValue("text-variable-anchor")||B._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&(function(le,de,pe,ge,xe,_e,Te,Pe,ve){const Re=de.transform,$e=de.style.map.terrain,We=xe==="map",qe=_e==="map";for(const Qe of le){const bt=ge.getTile(Qe),Et=bt.getBucket(pe);if(!Et||!Et.text||!Et.text.segments.get().length)continue;const ut=a.an(Et.textSizeData,Re.zoom),Ut=a.aC(bt,1,de.transform.zoom),Ar=ui(We,de.transform,Ut),Ur=pe.layout.get("icon-text-fit")!=="none"&&Et.hasIconData();if(ut){const ei=Math.pow(2,Re.zoom-bt.tileID.overscaledZ),Xr=$e?(ai,wi)=>$e.getElevation(Qe,ai,wi):null;Ic(Et,We,qe,ve,Re,Ar,ei,ut,Ur,a.aD(Re,bt,Te,Pe),Qe.toUnwrapped(),Xr)}}})(F,S,B,I,B.layout.get("text-rotation-alignment"),B.layout.get("text-pitch-alignment"),B.paint.get("text-translate"),B.paint.get("text-translate-anchor"),U),B.paint.get("icon-opacity").constantOr(1)!==0&&kc(S,I,B,F,!1,B.paint.get("icon-translate"),B.paint.get("icon-translate-anchor"),B.layout.get("icon-rotation-alignment"),B.layout.get("icon-pitch-alignment"),B.layout.get("icon-keep-upright"),q,J,G),B.paint.get("text-opacity").constantOr(1)!==0&&kc(S,I,B,F,!0,B.paint.get("text-translate"),B.paint.get("text-translate-anchor"),B.layout.get("text-rotation-alignment"),B.layout.get("text-pitch-alignment"),B.layout.get("text-keep-upright"),q,J,G),I.map.showCollisionBoxes&&(jd(S,I,B,F,!0),jd(S,I,B,F,!1))})(n,d,m,y,this.style.placement.variableOffsets,x):a.cc(m)?(function(S,I,B,F,U){if(S.renderPass!=="translucent")return;const{isRenderingToTexture:W}=U,G=B.paint.get("circle-opacity"),q=B.paint.get("circle-stroke-width"),J=B.paint.get("circle-stroke-opacity"),le=!B.layout.get("circle-sort-key").isConstant();if(G.constantOr(1)===0&&(q.constantOr(1)===0||J.constantOr(1)===0))return;const de=S.context,pe=de.gl,ge=S.transform,xe=S.getDepthModeForSublayer(0,pr.ReadOnly),_e=Rr.disabled,Te=S.colorModeForRenderPass(),Pe=[],ve=ge.getCircleRadiusCorrection();for(let Re=0;Re<F.length;Re++){const $e=F[Re],We=I.getTile($e),qe=We.getBucket(B);if(!qe)continue;const Qe=B.paint.get("circle-translate"),bt=B.paint.get("circle-translate-anchor"),Et=a.aD(ge,We,Qe,bt),ut=qe.programConfigurations.get(B.id),Ut=S.useProgram("circle",ut),Ar=qe.layoutVertexBuffer,Ur=qe.indexBuffer,ei=S.style.map.terrain&&S.style.map.terrain.getTerrainData($e),Xr={programConfiguration:ut,program:Ut,layoutVertexBuffer:Ar,indexBuffer:Ur,uniformValues:Vm(S,We,B,Et,ve),terrainData:ei,projectionData:ge.getProjectionData({overscaledTileID:$e,applyGlobeMatrix:!W,applyTerrainMatrix:!0})};if(le){const ai=qe.segments.get();for(const wi of ai)Pe.push({segments:new a.aM([wi]),sortKey:wi.sortKey,state:Xr})}else Pe.push({segments:qe.segments,sortKey:0,state:Xr})}le&&Pe.sort(((Re,$e)=>Re.sortKey-$e.sortKey));for(const Re of Pe){const{programConfiguration:$e,program:We,layoutVertexBuffer:qe,indexBuffer:Qe,uniformValues:bt,terrainData:Et,projectionData:ut}=Re.state;We.draw(de,pe.TRIANGLES,xe,_e,Te,lr.backCCW,bt,Et,ut,B.id,qe,Qe,Re.segments,B.paint,S.transform.zoom,$e)}})(n,d,m,y,x):a.cd(m)?(function(S,I,B,F,U){if(B.paint.get("heatmap-opacity")===0)return;const W=S.context,{isRenderingToTexture:G,isRenderingGlobe:q}=U;if(S.style.map.terrain){for(const J of F){const le=I.getTile(J);I.hasRenderableParent(J)||(S.renderPass==="offscreen"?Nl(S,le,B,J,q):S.renderPass==="translucent"&&Cu(S,B,J,G,q))}W.viewport.set([0,0,S.width,S.height])}else S.renderPass==="offscreen"?(function(J,le,de,pe){const ge=J.context,xe=ge.gl,_e=J.transform,Te=Rr.disabled,Pe=new ii([xe.ONE,xe.ONE],a.bf.transparent,[!0,!0,!0,!0]);(function(ve,Re,$e){const We=ve.gl;ve.activeTexture.set(We.TEXTURE1),ve.viewport.set([0,0,Re.width/4,Re.height/4]);let qe=$e.heatmapFbos.get(a.c2);qe?(We.bindTexture(We.TEXTURE_2D,qe.colorAttachment.get()),ve.bindFramebuffer.set(qe.framebuffer)):(qe=qo(ve,Re.width/4,Re.height/4),$e.heatmapFbos.set(a.c2,qe))})(ge,J,de),ge.clear({color:a.bf.transparent});for(let ve=0;ve<pe.length;ve++){const Re=pe[ve];if(le.hasRenderableParent(Re))continue;const $e=le.getTile(Re),We=$e.getBucket(de);if(!We)continue;const qe=We.programConfigurations.get(de.id),Qe=J.useProgram("heatmap",qe),bt=_e.getProjectionData({overscaledTileID:Re,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),Et=_e.getCircleRadiusCorrection();Qe.draw(ge,xe.TRIANGLES,pr.disabled,Te,Pe,lr.backCCW,tf($e,_e.zoom,de.paint.get("heatmap-intensity"),Et),null,bt,de.id,We.layoutVertexBuffer,We.indexBuffer,We.segments,de.paint,_e.zoom,qe)}ge.viewport.set([0,0,J.width,J.height])})(S,I,B,F):S.renderPass==="translucent"&&(function(J,le){const de=J.context,pe=de.gl;de.setColorMode(J.colorModeForRenderPass());const ge=le.heatmapFbos.get(a.c2);ge&&(de.activeTexture.set(pe.TEXTURE0),pe.bindTexture(pe.TEXTURE_2D,ge.colorAttachment.get()),de.activeTexture.set(pe.TEXTURE1),Bc(de,le).bind(pe.LINEAR,pe.CLAMP_TO_EDGE),J.useProgram("heatmapTexture").draw(de,pe.TRIANGLES,pr.disabled,Rr.disabled,J.colorModeForRenderPass(),lr.disabled,Sd(J,le,0,1),null,null,le.id,J.viewportBuffer,J.quadTriangleIndexBuffer,J.viewportSegments,le.paint,J.transform.zoom))})(S,B)})(n,d,m,y,x):a.ce(m)?(function(S,I,B,F,U){if(S.renderPass!=="translucent")return;const{isRenderingToTexture:W}=U,G=B.paint.get("line-opacity"),q=B.paint.get("line-width");if(G.constantOr(1)===0||q.constantOr(1)===0)return;const J=S.getDepthModeForSublayer(0,pr.ReadOnly),le=S.colorModeForRenderPass(),de=B.paint.get("line-dasharray"),pe=B.paint.get("line-pattern"),ge=pe.constantOr(1),xe=B.paint.get("line-gradient"),_e=B.getCrossfadeParameters(),Te=ge?"linePattern":de?"lineSDF":xe?"lineGradient":"line",Pe=S.context,ve=Pe.gl,Re=S.transform;let $e=!0;for(const We of F){const qe=I.getTile(We);if(ge&&!qe.patternsLoaded())continue;const Qe=qe.getBucket(B);if(!Qe)continue;const bt=Qe.programConfigurations.get(B.id),Et=S.context.program.get(),ut=S.useProgram(Te,bt),Ut=$e||ut.program!==Et,Ar=S.style.map.terrain&&S.style.map.terrain.getTerrainData(We),Ur=pe.constantOr(null);if(Ur&&qe.imageAtlas){const yr=qe.imageAtlas,Hr=yr.patternPositions[Ur.to.toString()],Zi=yr.patternPositions[Ur.from.toString()];Hr&&Zi&&bt.setConstantPatternPositions(Hr,Zi)}const ei=Re.getProjectionData({overscaledTileID:We,applyGlobeMatrix:!W,applyTerrainMatrix:!0}),Xr=Re.getPixelScale(),ai=ge?Id(S,qe,B,Xr,_e):de?el(S,qe,B,Xr,de,_e):xe?Rd(S,qe,B,Xr,Qe.lineClipsArray.length):_u(S,qe,B,Xr);if(ge)Pe.activeTexture.set(ve.TEXTURE0),qe.imageAtlasTexture.bind(ve.LINEAR,ve.CLAMP_TO_EDGE),bt.updatePaintBuffers(_e);else if(de&&(Ut||S.lineAtlas.dirty))Pe.activeTexture.set(ve.TEXTURE0),S.lineAtlas.bind(Pe);else if(xe){const yr=Qe.gradients[B.id];let Hr=yr.texture;if(B.gradientVersion!==yr.version){let Zi=256;if(B.stepInterpolant){const tn=I.getSource().maxzoom,dn=We.canonical.z===tn?Math.ceil(1<<S.transform.maxZoom-We.canonical.z):1;Zi=a.ah(a.c3(Qe.maxLineLength/a.$*1024*dn),256,Pe.maxTextureSize)}yr.gradient=a.c4({expression:B.gradientExpression(),evaluationKey:"lineProgress",resolution:Zi,image:yr.gradient||void 0,clips:Qe.lineClipsArray}),yr.texture?yr.texture.update(yr.gradient):yr.texture=new a.T(Pe,yr.gradient,ve.RGBA),yr.version=B.gradientVersion,Hr=yr.texture}Pe.activeTexture.set(ve.TEXTURE0),Hr.bind(B.stepInterpolant?ve.NEAREST:ve.LINEAR,ve.CLAMP_TO_EDGE)}const wi=S.stencilModeForClipping(We);ut.draw(Pe,ve.TRIANGLES,J,wi,le,lr.disabled,ai,Ar,ei,B.id,Qe.layoutVertexBuffer,Qe.indexBuffer,Qe.segments,B.paint,S.transform.zoom,bt,Qe.layoutVertexBuffer2),$e=!1}})(n,d,m,y,x):a.cf(m)?(function(S,I,B,F,U){const W=B.paint.get("fill-color"),G=B.paint.get("fill-opacity");if(G.constantOr(1)===0)return;const{isRenderingToTexture:q}=U,J=S.colorModeForRenderPass(),le=B.paint.get("fill-pattern"),de=S.opaquePassEnabledForLayer()&&!le.constantOr(1)&&W.constantOr(a.bf.transparent).a===1&&G.constantOr(0)===1?"opaque":"translucent";if(S.renderPass===de){const pe=S.getDepthModeForSublayer(1,S.renderPass==="opaque"?pr.ReadWrite:pr.ReadOnly);vh(S,I,B,F,pe,J,!1,q)}if(S.renderPass==="translucent"&&B.paint.get("fill-antialias")){const pe=S.getDepthModeForSublayer(B.getPaintProperty("fill-outline-color")?2:0,pr.ReadOnly);vh(S,I,B,F,pe,J,!0,q)}})(n,d,m,y,x):a.cg(m)?(function(S,I,B,F,U){const W=B.paint.get("fill-extrusion-opacity");if(W===0)return;const{isRenderingToTexture:G}=U;if(S.renderPass==="translucent"){const q=new pr(S.context.gl.LEQUAL,pr.ReadWrite,S.depthRangeFor3D);if(W!==1||B.paint.get("fill-extrusion-pattern").constantOr(1))bh(S,I,B,F,q,Rr.disabled,ii.disabled,G),bh(S,I,B,F,q,S.stencilModeFor3D(),S.colorModeForRenderPass(),G);else{const J=S.colorModeForRenderPass();bh(S,I,B,F,q,Rr.disabled,J,G)}}})(n,d,m,y,x):a.ch(m)?(function(S,I,B,F,U){if(S.renderPass!=="offscreen"&&S.renderPass!=="translucent")return;const{isRenderingToTexture:W}=U,G=S.context,q=S.style.projection.useSubdivision,J=S.getDepthModeForSublayer(0,pr.ReadOnly),le=S.colorModeForRenderPass();if(S.renderPass==="offscreen")(function(de,pe,ge,xe,_e,Te,Pe){const ve=de.context,Re=ve.gl;for(const $e of ge){const We=pe.getTile($e),qe=We.dem;if(!qe||!qe.data||!We.needsHillshadePrepare)continue;const Qe=qe.dim,bt=qe.stride,Et=qe.getPixels();if(ve.activeTexture.set(Re.TEXTURE1),ve.pixelStoreUnpackPremultiplyAlpha.set(!1),We.demTexture=We.demTexture||de.getTileTexture(bt),We.demTexture){const Ut=We.demTexture;Ut.update(Et,{premultiply:!1}),Ut.bind(Re.NEAREST,Re.CLAMP_TO_EDGE)}else We.demTexture=new a.T(ve,Et,Re.RGBA,{premultiply:!1}),We.demTexture.bind(Re.NEAREST,Re.CLAMP_TO_EDGE);ve.activeTexture.set(Re.TEXTURE0);let ut=We.fbo;if(!ut){const Ut=new a.T(ve,{width:Qe,height:Qe,data:null},Re.RGBA);Ut.bind(Re.LINEAR,Re.CLAMP_TO_EDGE),ut=We.fbo=ve.createFramebuffer(Qe,Qe,!0,!1),ut.colorAttachment.set(Ut.texture)}ve.bindFramebuffer.set(ut.framebuffer),ve.viewport.set([0,0,Qe,Qe]),de.useProgram("hillshadePrepare").draw(ve,Re.TRIANGLES,_e,Te,Pe,lr.disabled,Ec(We.tileID,qe),null,null,xe.id,de.rasterBoundsBuffer,de.quadTriangleIndexBuffer,de.rasterBoundsSegments),We.needsHillshadePrepare=!1}})(S,I,F,B,J,Rr.disabled,le),G.viewport.set([0,0,S.width,S.height]);else if(S.renderPass==="translucent")if(q){const[de,pe,ge]=S.stencilConfigForOverlapTwoPass(F);$o(S,I,B,ge,de,J,le,!1,W),$o(S,I,B,ge,pe,J,le,!0,W)}else{const[de,pe]=S.getStencilConfigForOverlapAndUpdateStencilID(F);$o(S,I,B,pe,de,J,le,!1,W)}})(n,d,m,y,x):a.ci(m)?(function(S,I,B,F,U){if(S.renderPass!=="translucent"||!F.length)return;const{isRenderingToTexture:W}=U,G=S.style.projection.useSubdivision,q=S.getDepthModeForSublayer(0,pr.ReadOnly),J=S.colorModeForRenderPass();if(G){const[le,de,pe]=S.stencilConfigForOverlapTwoPass(F);Lc(S,I,B,pe,le,q,J,!1,W),Lc(S,I,B,pe,de,q,J,!0,W)}else{const[le,de]=S.getStencilConfigForOverlapAndUpdateStencilID(F);Lc(S,I,B,de,le,q,J,!1,W)}})(n,d,m,y,x):a.cj(m)?(function(S,I,B,F,U){if(S.renderPass!=="translucent"||B.paint.get("raster-opacity")===0||!F.length)return;const{isRenderingToTexture:W}=U,G=I.getSource(),q=S.style.projection.useSubdivision;if(G instanceof Yn)ba(S,I,B,F,null,!1,!1,G.tileCoords,G.flippedWindingOrder,W);else if(q){const[J,le,de]=S.stencilConfigForOverlapTwoPass(F);ba(S,I,B,de,J,!1,!0,Dc,!1,W),ba(S,I,B,de,le,!0,!0,Dc,!1,W)}else{const[J,le]=S.getStencilConfigForOverlapAndUpdateStencilID(F);ba(S,I,B,le,J,!1,!0,Dc,!1,W)}})(n,d,m,y,x):a.ck(m)?(function(S,I,B,F,U){const W=B.paint.get("background-color"),G=B.paint.get("background-opacity");if(G===0)return;const{isRenderingToTexture:q}=U,J=S.context,le=J.gl,de=S.style.projection,pe=S.transform,ge=pe.tileSize,xe=B.paint.get("background-pattern");if(S.isPatternMissing(xe))return;const _e=!xe&&W.a===1&&G===1&&S.opaquePassEnabledForLayer()?"opaque":"translucent";if(S.renderPass!==_e)return;const Te=Rr.disabled,Pe=S.getDepthModeForSublayer(0,_e==="opaque"?pr.ReadWrite:pr.ReadOnly),ve=S.colorModeForRenderPass(),Re=S.useProgram(xe?"backgroundPattern":"background"),$e=F||Le(pe,{tileSize:ge,terrain:S.style.map.terrain});xe&&(J.activeTexture.set(le.TEXTURE0),S.imageManager.bind(S.context));const We=B.getCrossfadeParameters();for(const qe of $e){const Qe=pe.getProjectionData({overscaledTileID:qe,applyGlobeMatrix:!q,applyTerrainMatrix:!0}),bt=xe?rf(G,S,xe,{tileID:qe,tileSize:ge},We):Tc(G,W),Et=S.style.map.terrain&&S.style.map.terrain.getTerrainData(qe),ut=de.getMeshFromTileID(J,qe.canonical,!1,!0,"raster");Re.draw(J,le.TRIANGLES,Pe,Te,ve,lr.backCCW,bt,Et,Qe,B.id,ut.vertexBuffer,ut.indexBuffer,ut.segments)}})(n,0,m,y,x):a.cl(m)&&(function(S,I,B,F){const{isRenderingGlobe:U}=F,W=S.context,G=B.implementation,q=S.style.projection,J=S.transform,le=J.getProjectionDataForCustomLayer(U),de={farZ:J.farZ,nearZ:J.nearZ,fov:J.fov*Math.PI/180,modelViewProjectionMatrix:J.modelViewProjectionMatrix,projectionMatrix:J.projectionMatrix,shaderData:{variantName:q.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;
uniform mat4 u_projection_matrix;
${q.shaderPreludeCode.vertexSource}`,define:q.shaderDefine},defaultProjectionData:le},pe=G.renderingMode?G.renderingMode:"2d";if(S.renderPass==="offscreen"){const ge=G.prerender;ge&&(S.setCustomLayerDefaults(),W.setColorMode(S.colorModeForRenderPass()),ge.call(G,W.gl,de),W.setDirty(),S.setBaseState())}else if(S.renderPass==="translucent"){S.setCustomLayerDefaults(),W.setColorMode(S.colorModeForRenderPass()),W.setStencilMode(Rr.disabled);const ge=pe==="3d"?S.getDepthModeFor3D():S.getDepthModeForSublayer(0,pr.ReadOnly);W.setDepthMode(ge),G.render(W.gl,de),W.setDirty(),S.setBaseState(),W.bindFramebuffer.set(null)}})(n,0,m,x))}saveTileTexture(n){const d=this._tileTextures[n.size[0]];d?d.push(n):this._tileTextures[n.size[0]]=[n]}getTileTexture(n){const d=this._tileTextures[n];return d&&d.length>0?d.pop():null}isPatternMissing(n){if(!n)return!1;if(!n.from||!n.to)return!0;const d=this.imageManager.getPattern(n.from.toString()),m=this.imageManager.getPattern(n.to.toString());return!d||!m}useProgram(n,d,m=!1,y=[]){this.cache=this.cache||{};const x=!!this.style.map.terrain,S=this.style.projection,I=m?Ce.projectionMercator:S.shaderPreludeCode,B=m?xr:S.shaderDefine,F=n+(d?d.cacheKey:"")+`/${m?Gr:S.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(x?"/terrain":"")+(y?`/${y.join("/")}`:"");return this.cache[F]||(this.cache[F]=new Td(this.context,Ce[n],d,Ld[n],this._showOverdrawInspector,x,I,B,y)),this.cache[F]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const n=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(n.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new a.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:n,drawingBufferHeight:d}=this.context.gl;return this.width!==n||this.height!==d}}function wa(b,n){let d,m=!1,y=null,x=null;const S=()=>{y=null,m&&(b.apply(x,d),y=setTimeout(S,n),m=!1)};return(...I)=>(m=!0,x=this,d=I,y||S(),y)}class wh{constructor(n){this._getCurrentHash=()=>{const d=window.location.hash.replace("#","");if(this._hashName){let m;return d.split("&").map((y=>y.split("="))).forEach((y=>{y[0]===this._hashName&&(m=y)})),(m&&m[1]||"").split("/")}return d.split("/")},this._onHashChange=()=>{const d=this._getCurrentHash();if(!this._isValidHash(d))return!1;const m=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(d[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+d[2],+d[1]],zoom:+d[0],bearing:m,pitch:+(d[4]||0)}),!0},this._updateHashUnthrottled=()=>{const d=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,d)},this._removeHash=()=>{const d=this._getCurrentHash();if(d.length===0)return;const m=d.join("/");let y=m;y.split("&").length>0&&(y=y.split("&")[0]),this._hashName&&(y=`${this._hashName}=${m}`);let x=window.location.hash.replace(y,"");x.startsWith("#&")?x=x.slice(0,1)+x.slice(2):x==="#"&&(x="");let S=window.location.href.replace(/(#.+)?$/,x);S=S.replace("&&","&"),window.history.replaceState(window.history.state,null,S)},this._updateHash=wa(this._updateHashUnthrottled,300),this._hashName=n&&encodeURIComponent(n)}addTo(n){return this._map=n,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(n){const d=this._map.getCenter(),m=Math.round(100*this._map.getZoom())/100,y=Math.ceil((m*Math.LN2+Math.log(512/360/.5))/Math.LN10),x=Math.pow(10,y),S=Math.round(d.lng*x)/x,I=Math.round(d.lat*x)/x,B=this._map.getBearing(),F=this._map.getPitch();let U="";if(U+=n?`/${S}/${I}/${m}`:`${m}/${I}/${S}`,(B||F)&&(U+="/"+Math.round(10*B)/10),F&&(U+=`/${Math.round(F)}`),this._hashName){const W=this._hashName;let G=!1;const q=window.location.hash.slice(1).split("&").map((J=>{const le=J.split("=")[0];return le===W?(G=!0,`${le}=${U}`):J})).filter((J=>J));return G||q.push(`${W}=${U}`),`#${q.join("&")}`}return`#${U}`}_isValidHash(n){if(n.length<3||n.some(isNaN))return!1;try{new a.S(+n[2],+n[1])}catch{return!1}const d=+n[0],m=+(n[3]||0),y=+(n[4]||0);return d>=this._map.getMinZoom()&&d<=this._map.getMaxZoom()&&m>=-180&&m<=180&&y>=this._map.getMinPitch()&&y<=this._map.getMaxPitch()}}const Ea={linearity:.3,easing:a.cm(0,0,.3,1)},Aa=a.e({deceleration:2500,maxSpeed:1400},Ea),Nc=a.e({deceleration:20,maxSpeed:1400},Ea),Ol=a.e({deceleration:1e3,maxSpeed:360},Ea),ku=a.e({deceleration:1e3,maxSpeed:90},Ea),Eh=a.e({deceleration:1e3,maxSpeed:360},Ea);class Fl{constructor(n){this._map=n,this.clear()}clear(){this._inertiaBuffer=[]}record(n){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:L.now(),settings:n})}_drainInertiaBuffer(){const n=this._inertiaBuffer,d=L.now();for(;n.length>0&&d-n[0].time>160;)n.shift()}_onMoveEnd(n){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const d={zoom:0,bearing:0,pitch:0,roll:0,pan:new a.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:x}of this._inertiaBuffer)d.zoom+=x.zoomDelta||0,d.bearing+=x.bearingDelta||0,d.pitch+=x.pitchDelta||0,d.roll+=x.rollDelta||0,x.panDelta&&d.pan._add(x.panDelta),x.around&&(d.around=x.around),x.pinchAround&&(d.pinchAround=x.pinchAround);const m=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,y={};if(d.pan.mag()){const x=Jr(d.pan.mag(),m,a.e({},Aa,n||{})),S=d.pan.mult(x.amount/d.pan.mag()),I=this._map.cameraHelper.handlePanInertia(S,this._map.transform);y.center=I.easingCenter,y.offset=I.easingOffset,xn(y,x)}if(d.zoom){const x=Jr(d.zoom,m,Nc);y.zoom=this._map.transform.zoom+x.amount,xn(y,x)}if(d.bearing){const x=Jr(d.bearing,m,Ol);y.bearing=this._map.transform.bearing+a.ah(x.amount,-179,179),xn(y,x)}if(d.pitch){const x=Jr(d.pitch,m,ku);y.pitch=this._map.transform.pitch+x.amount,xn(y,x)}if(d.roll){const x=Jr(d.roll,m,Eh);y.roll=this._map.transform.roll+a.ah(x.amount,-179,179),xn(y,x)}if(y.zoom||y.bearing){const x=d.pinchAround===void 0?d.around:d.pinchAround;y.around=x?this._map.unproject(x):this._map.getCenter()}return this.clear(),a.e(y,{noMoveStart:!0})}}function xn(b,n){(!b.duration||b.duration<n.duration)&&(b.duration=n.duration,b.easing=n.easing)}function Jr(b,n,d){const{maxSpeed:m,linearity:y,deceleration:x}=d,S=a.ah(b*y/(n/1e3),-m,m),I=Math.abs(S)/(x*y);return{easing:d.easing,duration:1e3*I,amount:S*(I/2)}}class Br extends a.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,d,m,y={}){m=m instanceof MouseEvent?m:new MouseEvent(n,m);const x=O.mousePos(d.getCanvas(),m),S=d.unproject(x);super(n,a.e({point:x,lngLat:S,originalEvent:m},y)),this._defaultPrevented=!1,this.target=d}}class js extends a.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,d,m){const y=n==="touchend"?m.changedTouches:m.touches,x=O.touchPos(d.getCanvasContainer(),y),S=x.map((B=>d.unproject(B))),I=x.reduce(((B,F,U,W)=>B.add(F.div(W.length))),new a.P(0,0));super(n,{points:x,point:I,lngLats:S,lngLat:d.unproject(I),originalEvent:m}),this._defaultPrevented=!1}}class wn extends a.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,d,m){super(n,{originalEvent:m}),this._defaultPrevented=!1}}class rs{constructor(n,d){this._map=n,this._clickTolerance=d.clickTolerance}reset(){delete this._mousedownPos}wheel(n){return this._firePreventable(new wn(n.type,this._map,n))}mousedown(n,d){return this._mousedownPos=d,this._firePreventable(new Br(n.type,this._map,n))}mouseup(n){this._map.fire(new Br(n.type,this._map,n))}click(n,d){this._mousedownPos&&this._mousedownPos.dist(d)>=this._clickTolerance||this._map.fire(new Br(n.type,this._map,n))}dblclick(n){return this._firePreventable(new Br(n.type,this._map,n))}mouseover(n){this._map.fire(new Br(n.type,this._map,n))}mouseout(n){this._map.fire(new Br(n.type,this._map,n))}touchstart(n){return this._firePreventable(new js(n.type,this._map,n))}touchmove(n){this._map.fire(new js(n.type,this._map,n))}touchend(n){this._map.fire(new js(n.type,this._map,n))}touchcancel(n){this._map.fire(new js(n.type,this._map,n))}_firePreventable(n){if(this._map.fire(n),n.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class al{constructor(n){this._map=n}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(n){this._map.fire(new Br(n.type,this._map,n))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Br("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(n){this._delayContextMenu?this._contextMenuEvent=n:this._ignoreContextMenu||this._map.fire(new Br(n.type,this._map,n)),this._map.listens("contextmenu")&&n.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ko{constructor(n){this._map=n}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(n){return this.transform.screenPointToLocation(a.P.convert(n),this._map.terrain)}}class Vn{constructor(n,d){this._map=n,this._tr=new ko(n),this._el=n.getCanvasContainer(),this._container=n.getContainer(),this._clickTolerance=d.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(n,d){this.isEnabled()&&n.shiftKey&&n.button===0&&(O.disableDrag(),this._startPos=this._lastPos=d,this._active=!0)}mousemoveWindow(n,d){if(!this._active)return;const m=d;if(this._lastPos.equals(m)||!this._box&&m.dist(this._startPos)<this._clickTolerance)return;const y=this._startPos;this._lastPos=m,this._box||(this._box=O.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",n));const x=Math.min(y.x,m.x),S=Math.max(y.x,m.x),I=Math.min(y.y,m.y),B=Math.max(y.y,m.y);O.setTransform(this._box,`translate(${x}px,${I}px)`),this._box.style.width=S-x+"px",this._box.style.height=B-I+"px"}mouseupWindow(n,d){if(!this._active||n.button!==0)return;const m=this._startPos,y=d;if(this.reset(),O.suppressClick(),m.x!==y.x||m.y!==y.y)return this._map.fire(new a.l("boxzoomend",{originalEvent:n})),{cameraAnimation:x=>x.fitScreenCoordinates(m,y,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",n)}keydown(n){this._active&&n.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",n))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(O.remove(this._box),this._box=null),O.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(n,d){return this._map.fire(new a.l(n,{originalEvent:d}))}}function Ta(b,n){if(b.length!==n.length)throw new Error(`The number of touches and points are not equal - touches ${b.length}, points ${n.length}`);const d={};for(let m=0;m<b.length;m++)d[b[m].identifier]=n[m];return d}class Hd{constructor(n){this.reset(),this.numTouches=n.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(n,d,m){(this.centroid||m.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=n.timeStamp),m.length===this.numTouches&&(this.centroid=(function(y){const x=new a.P(0,0);for(const S of y)x._add(S);return x.div(y.length)})(d),this.touches=Ta(m,d)))}touchmove(n,d,m){if(this.aborted||!this.centroid)return;const y=Ta(m,d);for(const x in this.touches){const S=y[x];(!S||S.dist(this.touches[x])>30)&&(this.aborted=!0)}}touchend(n,d,m){if((!this.centroid||n.timeStamp-this.startTime>500)&&(this.aborted=!0),m.length===0){const y=!this.aborted&&this.centroid;if(this.reset(),y)return y}}}class is{constructor(n){this.singleTap=new Hd(n),this.numTaps=n.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(n,d,m){this.singleTap.touchstart(n,d,m)}touchmove(n,d,m){this.singleTap.touchmove(n,d,m)}touchend(n,d,m){const y=this.singleTap.touchend(n,d,m);if(y){const x=n.timeStamp-this.lastTime<500,S=!this.lastTap||this.lastTap.dist(y)<30;if(x&&S||this.reset(),this.count++,this.lastTime=n.timeStamp,this.lastTap=y,this.count===this.numTaps)return this.reset(),y}}}class Es{constructor(n){this._tr=new ko(n),this._zoomIn=new is({numTouches:1,numTaps:2}),this._zoomOut=new is({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(n,d,m){this._zoomIn.touchstart(n,d,m),this._zoomOut.touchstart(n,d,m)}touchmove(n,d,m){this._zoomIn.touchmove(n,d,m),this._zoomOut.touchmove(n,d,m)}touchend(n,d,m){const y=this._zoomIn.touchend(n,d,m),x=this._zoomOut.touchend(n,d,m),S=this._tr;return y?(this._active=!0,n.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:I=>I.easeTo({duration:300,zoom:S.zoom+1,around:S.unproject(y)},{originalEvent:n})}):x?(this._active=!0,n.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:I=>I.easeTo({duration:300,zoom:S.zoom-1,around:S.unproject(x)},{originalEvent:n})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class zl{constructor(n){this._enabled=!!n.enable,this._moveStateManager=n.moveStateManager,this._clickTolerance=n.clickTolerance||1,this._moveFunction=n.move,this._activateOnStart=!!n.activateOnStart,n.assignEvents(this),this.reset()}reset(n){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(n)}_move(...n){const d=this._moveFunction(...n);if(d.bearingDelta||d.pitchDelta||d.rollDelta||d.around||d.panDelta)return this._active=!0,d}dragStart(n,d){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(n)&&(this._moveStateManager.startMove(n),this._lastPoint=Array.isArray(d)?d[0]:d,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(n,d){if(!this.isEnabled())return;const m=this._lastPoint;if(!m)return;if(n.preventDefault(),!this._moveStateManager.isValidMoveEvent(n))return void this.reset(n);const y=Array.isArray(d)?d[0]:d;return!this._moved&&y.dist(m)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=y,this._move(m,y))}dragEnd(n){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(n)&&(this._moved&&O.suppressClick(),this.reset(n))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const hn=0,Sa=2,Wd={[hn]:1,[Sa]:2};class Oc{constructor(n){this._correctEvent=n.checkCorrectEvent}startMove(n){const d=O.mouseButton(n);this._eventButton=d}endMove(n){delete this._eventButton}isValidStartEvent(n){return this._correctEvent(n)}isValidMoveEvent(n){return!(function(d,m){const y=Wd[m];return d.buttons===void 0||(d.buttons&y)!==y})(n,this._eventButton)}isValidEndEvent(n){return O.mouseButton(n)===this._eventButton}}class Zm{constructor(){this._firstTouch=void 0}_isOneFingerTouch(n){return n.targetTouches.length===1}_isSameTouchEvent(n){return n.targetTouches[0].identifier===this._firstTouch}startMove(n){this._firstTouch=n.targetTouches[0].identifier}endMove(n){delete this._firstTouch}isValidStartEvent(n){return this._isOneFingerTouch(n)}isValidMoveEvent(n){return this._isOneFingerTouch(n)&&this._isSameTouchEvent(n)}isValidEndEvent(n){return this._isOneFingerTouch(n)&&this._isSameTouchEvent(n)}}class ll{constructor(n=new Oc({checkCorrectEvent:()=>!0}),d=new Zm){this.mouseMoveStateManager=n,this.oneFingerTouchMoveStateManager=d}_executeRelevantHandler(n,d,m){return n instanceof MouseEvent?d(n):typeof TouchEvent<"u"&&n instanceof TouchEvent?m(n):void 0}startMove(n){this._executeRelevantHandler(n,(d=>this.mouseMoveStateManager.startMove(d)),(d=>this.oneFingerTouchMoveStateManager.startMove(d)))}endMove(n){this._executeRelevantHandler(n,(d=>this.mouseMoveStateManager.endMove(d)),(d=>this.oneFingerTouchMoveStateManager.endMove(d)))}isValidStartEvent(n){return this._executeRelevantHandler(n,(d=>this.mouseMoveStateManager.isValidStartEvent(d)),(d=>this.oneFingerTouchMoveStateManager.isValidStartEvent(d)))}isValidMoveEvent(n){return this._executeRelevantHandler(n,(d=>this.mouseMoveStateManager.isValidMoveEvent(d)),(d=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(d)))}isValidEndEvent(n){return this._executeRelevantHandler(n,(d=>this.mouseMoveStateManager.isValidEndEvent(d)),(d=>this.oneFingerTouchMoveStateManager.isValidEndEvent(d)))}}const Xo=b=>{b.mousedown=b.dragStart,b.mousemoveWindow=b.dragMove,b.mouseup=b.dragEnd,b.contextmenu=n=>{n.preventDefault()}};class Ko{constructor(n,d){this._clickTolerance=n.clickTolerance||1,this._map=d,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new a.P(0,0)}_shouldBePrevented(n){return n<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(n,d,m){return this._calculateTransform(n,d,m)}touchmove(n,d,m){if(this._active){if(!this._shouldBePrevented(m.length))return n.preventDefault(),this._calculateTransform(n,d,m);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",n)}}touchend(n,d,m){this._calculateTransform(n,d,m),this._active&&this._shouldBePrevented(m.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(n,d,m){m.length>0&&(this._active=!0);const y=Ta(m,d),x=new a.P(0,0),S=new a.P(0,0);let I=0;for(const F in y){const U=y[F],W=this._touches[F];W&&(x._add(U),S._add(U.sub(W)),I++,y[F]=U)}if(this._touches=y,this._shouldBePrevented(I)||!S.mag())return;const B=S.div(I);return this._sum._add(B),this._sum.mag()<this._clickTolerance?void 0:{around:x.div(I),panDelta:B}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class As{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(n,d,m){this._firstTwoTouches||m.length<2||(this._firstTwoTouches=[m[0].identifier,m[1].identifier],this._start([d[0],d[1]]))}touchmove(n,d,m){if(!this._firstTwoTouches)return;n.preventDefault();const[y,x]=this._firstTwoTouches,S=Dt(m,d,y),I=Dt(m,d,x);if(!S||!I)return;const B=this._aroundCenter?null:S.add(I).div(2);return this._move([S,I],B,n)}touchend(n,d,m){if(!this._firstTwoTouches)return;const[y,x]=this._firstTwoTouches,S=Dt(m,d,y),I=Dt(m,d,x);S&&I||(this._active&&O.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(n){this._enabled=!0,this._aroundCenter=!!n&&n.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Dt(b,n,d){for(let m=0;m<b.length;m++)if(b[m].identifier===d)return n[m]}function Ts(b,n){return Math.log(b/n)/Math.LN2}class ns extends As{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(n){this._startDistance=this._distance=n[0].dist(n[1])}_move(n,d){const m=this._distance;if(this._distance=n[0].dist(n[1]),this._active||!(Math.abs(Ts(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Ts(this._distance,m),pinchAround:d}}}function Ca(b,n){return 180*b.angleWith(n)/Math.PI}class Ss extends As{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(n){this._startVector=this._vector=n[0].sub(n[1]),this._minDiameter=n[0].dist(n[1])}_move(n,d,m){const y=this._vector;if(this._vector=n[0].sub(n[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Ca(this._vector,y),pinchAround:d}}_isBelowThreshold(n){this._minDiameter=Math.min(this._minDiameter,n.mag());const d=25/(Math.PI*this._minDiameter)*360,m=Ca(n,this._startVector);return Math.abs(m)<d}}function ss(b){return Math.abs(b.y)>Math.abs(b.x)}class Yo extends As{constructor(n){super(),this._currentTouchCount=0,this._map=n}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(n,d,m){super.touchstart(n,d,m),this._currentTouchCount=m.length}_start(n){this._lastPoints=n,ss(n[0].sub(n[1]))&&(this._valid=!1)}_move(n,d,m){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const y=n[0].sub(this._lastPoints[0]),x=n[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(y,x,m.timeStamp),this._valid?(this._lastPoints=n,this._active=!0,{pitchDelta:(y.y+x.y)/2*-.5}):void 0}gestureBeginsVertically(n,d,m){if(this._valid!==void 0)return this._valid;const y=n.mag()>=2,x=d.mag()>=2;if(!y&&!x)return;if(!y||!x)return this._firstMove===void 0&&(this._firstMove=m),m-this._firstMove<100&&void 0;const S=n.y>0==d.y>0;return ss(n)&&ss(d)&&S}}const kr={panStep:100,bearingStep:15,pitchStep:10};class Fc{constructor(n){this._tr=new ko(n);const d=kr;this._panStep=d.panStep,this._bearingStep=d.bearingStep,this._pitchStep=d.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(n){if(n.altKey||n.ctrlKey||n.metaKey)return;let d=0,m=0,y=0,x=0,S=0;switch(n.keyCode){case 61:case 107:case 171:case 187:d=1;break;case 189:case 109:case 173:d=-1;break;case 37:n.shiftKey?m=-1:(n.preventDefault(),x=-1);break;case 39:n.shiftKey?m=1:(n.preventDefault(),x=1);break;case 38:n.shiftKey?y=1:(n.preventDefault(),S=-1);break;case 40:n.shiftKey?y=-1:(n.preventDefault(),S=1);break;default:return}return this._rotationDisabled&&(m=0,y=0),{cameraAnimation:I=>{const B=this._tr;I.easeTo({duration:300,easeId:"keyboardHandler",easing:qd,zoom:d?Math.round(B.zoom)+d*(n.shiftKey?2:1):B.zoom,bearing:B.bearing+m*this._bearingStep,pitch:B.pitch+y*this._pitchStep,offset:[-x*this._panStep,-S*this._panStep],center:B.center},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function qd(b){return b*(2-b)}const Gn=4.000244140625,Vs=1/450;class vi{constructor(n,d){this._onTimeout=m=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(m)},this._map=n,this._tr=new ko(n),this._triggerRenderFrame=d,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=Vs}setZoomRate(n){this._defaultZoomRate=n}setWheelZoomRate(n){this._wheelZoomRate=n}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(n){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!n&&n.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(n){return!!this._map.cooperativeGestures.isEnabled()&&!(n.ctrlKey||this._map.cooperativeGestures.isBypassed(n))}wheel(n){if(!this.isEnabled())return;if(this._shouldBePrevented(n))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",n);let d=n.deltaMode===WheelEvent.DOM_DELTA_LINE?40*n.deltaY:n.deltaY;const m=L.now(),y=m-(this._lastWheelEventTime||0);this._lastWheelEventTime=m,d!==0&&d%Gn==0?this._type="wheel":d!==0&&Math.abs(d)<4?this._type="trackpad":y>400?(this._type=null,this._lastValue=d,this._timeout=setTimeout(this._onTimeout,40,n)):this._type||(this._type=Math.abs(y*d)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,d+=this._lastValue)),n.shiftKey&&d&&(d/=4),this._type&&(this._lastWheelEvent=n,this._delta-=d,this._active||this._start(n)),n.preventDefault()}_start(n){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const d=O.mousePos(this._map.getCanvas(),n),m=this._tr;this._aroundPoint=this._aroundCenter?m.transform.locationToScreenPoint(a.S.convert(m.center)):d,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const n=this._tr.transform;if(typeof this._lastExpectedZoom=="number"){const I=n.zoom-this._lastExpectedZoom;typeof this._startZoom=="number"&&(this._startZoom+=I),typeof this._targetZoom=="number"&&(this._targetZoom+=I)}if(this._delta!==0){const I=this._type==="wheel"&&Math.abs(this._delta)>Gn?this._wheelZoomRate:this._defaultZoomRate;let B=2/(1+Math.exp(-Math.abs(this._delta*I)));this._delta<0&&B!==0&&(B=1/B);const F=typeof this._targetZoom!="number"?n.scale:a.af(this._targetZoom);this._targetZoom=n.getConstrained(n.getCameraLngLat(),a.ak(F*B)).zoom,this._type==="wheel"&&(this._startZoom=n.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const d=typeof this._targetZoom!="number"?n.zoom:this._targetZoom,m=this._startZoom,y=this._easing;let x,S=!1;if(this._type==="wheel"&&m&&y){const I=L.now()-this._lastWheelEventTime,B=Math.min((I+5)/200,1),F=y(B);x=a.C.number(m,d,F),B<1?this._frameId||(this._frameId=!0):S=!0}else x=d,S=!0;return this._active=!0,S&&(this._active=!1,this._finishTimeout=setTimeout((()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout}),200)),this._lastExpectedZoom=x,{noInertia:!0,needsRenderFrame:!S,zoomDelta:x-n.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(n){let d=a.co;if(this._prevEase){const m=this._prevEase,y=(L.now()-m.start)/m.duration,x=m.easing(y+.01)-m.easing(y),S=.27/Math.sqrt(x*x+1e-4)*.01,I=Math.sqrt(.0729-S*S);d=a.cm(S,I,.25,1)}return this._prevEase={start:L.now(),duration:n,easing:d},d}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Gs{constructor(n,d){this._clickZoom=n,this._tapZoom=d}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Ah{constructor(n){this._tr=new ko(n),this.reset()}reset(){this._active=!1}dblclick(n,d){return n.preventDefault(),{cameraAnimation:m=>{m.easeTo({duration:300,zoom:this._tr.zoom+(n.shiftKey?-1:1),around:this._tr.unproject(d)},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class $d{constructor(){this._tap=new is({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(n,d,m){if(!this._swipePoint)if(this._tapTime){const y=d[0],x=n.timeStamp-this._tapTime<500,S=this._tapPoint.dist(y)<30;x&&S?m.length>0&&(this._swipePoint=y,this._swipeTouch=m[0].identifier):this.reset()}else this._tap.touchstart(n,d,m)}touchmove(n,d,m){if(this._tapTime){if(this._swipePoint){if(m[0].identifier!==this._swipeTouch)return;const y=d[0],x=y.y-this._swipePoint.y;return this._swipePoint=y,n.preventDefault(),this._active=!0,{zoomDelta:x/128}}}else this._tap.touchmove(n,d,m)}touchend(n,d,m){if(this._tapTime)this._swipePoint&&m.length===0&&this.reset();else{const y=this._tap.touchend(n,d,m);y&&(this._tapTime=n.timeStamp,this._tapPoint=y)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Th{constructor(n,d,m){this._el=n,this._mousePan=d,this._touchPan=m}enable(n){this._inertiaOptions=n||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Bu{constructor(n,d,m,y){this._pitchWithRotate=n.pitchWithRotate,this._rollEnabled=n.rollEnabled,this._mouseRotate=d,this._mousePitch=m,this._mouseRoll=y}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class Zd{constructor(n,d,m,y){this._el=n,this._touchZoom=d,this._touchRotate=m,this._tapDragZoom=y,this._rotationDisabled=!1,this._enabled=!0}enable(n){this._touchZoom.enable(n),this._rotationDisabled||this._touchRotate.enable(n),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class Lu{constructor(n,d){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=n,this._options=d,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const n=this._map.getCanvasContainer();n.classList.add("maplibregl-cooperative-gestures"),this._container=O.create("div","maplibregl-cooperative-gesture-screen",n);let d=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(d=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const m=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),y=document.createElement("div");y.className="maplibregl-desktop-message",y.textContent=d,this._container.appendChild(y);const x=document.createElement("div");x.className="maplibregl-mobile-message",x.textContent=m,this._container.appendChild(x),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(O.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(n){return n[this._bypassKey]}notifyGestureBlocked(n,d){this._enabled&&(this._map.fire(new a.l("cooperativegestureprevented",{gestureType:n,originalEvent:d})),this._container.classList.add("maplibregl-show"),setTimeout((()=>{this._container.classList.remove("maplibregl-show")}),100))}}const io=b=>b.zoom||b.drag||b.roll||b.pitch||b.rotate;class Qr extends a.l{}function cl(b){return b.panDelta&&b.panDelta.mag()||b.zoomDelta||b.bearingDelta||b.pitchDelta||b.rollDelta}class Xd{constructor(n,d){this.handleWindowEvent=y=>{this.handleEvent(y,`${y.type}Window`)},this.handleEvent=(y,x)=>{if(y.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const S=y.type==="renderFrame"?void 0:y,I={needsRenderFrame:!1},B={},F={};for(const{handlerName:G,handler:q,allowed:J}of this._handlers){if(!q.isEnabled())continue;let le;if(this._blockedByActive(F,J,G))q.reset();else if(q[x||y.type]){if(a.cp(y,x||y.type)){const de=O.mousePos(this._map.getCanvas(),y);le=q[x||y.type](y,de)}else if(a.cq(y,x||y.type)){const de=this._getMapTouches(y.touches),pe=O.touchPos(this._map.getCanvas(),de);le=q[x||y.type](y,pe,de)}else a.cr(x||y.type)||(le=q[x||y.type](y));this.mergeHandlerResult(I,B,le,G,S),le&&le.needsRenderFrame&&this._triggerRenderFrame()}(le||q.isActive())&&(F[G]=q)}const U={};for(const G in this._previousActiveHandlers)F[G]||(U[G]=S);this._previousActiveHandlers=F,(Object.keys(U).length||cl(I))&&(this._changes.push([I,B,U]),this._triggerRenderFrame()),(Object.keys(F).length||cl(I))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:W}=I;W&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],W(this._map))},this._map=n,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Fl(n),this._bearingSnap=d.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(d);const m=this._el;this._listeners=[[m,"touchstart",{passive:!0}],[m,"touchmove",{passive:!1}],[m,"touchend",void 0],[m,"touchcancel",void 0],[m,"mousedown",void 0],[m,"mousemove",void 0],[m,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[m,"mouseover",void 0],[m,"mouseout",void 0],[m,"dblclick",void 0],[m,"click",void 0],[m,"keydown",{capture:!1}],[m,"keyup",void 0],[m,"wheel",{passive:!1}],[m,"contextmenu",void 0],[window,"blur",void 0]];for(const[y,x,S]of this._listeners)O.addEventListener(y,x,y===document?this.handleWindowEvent:this.handleEvent,S)}destroy(){for(const[n,d,m]of this._listeners)O.removeEventListener(n,d,n===document?this.handleWindowEvent:this.handleEvent,m)}_addDefaultHandlers(n){const d=this._map,m=d.getCanvasContainer();this._add("mapEvent",new rs(d,n));const y=d.boxZoom=new Vn(d,n);this._add("boxZoom",y),n.interactive&&n.boxZoom&&y.enable();const x=d.cooperativeGestures=new Lu(d,n.cooperativeGestures);this._add("cooperativeGestures",x),n.cooperativeGestures&&x.enable();const S=new Es(d),I=new Ah(d);d.doubleClickZoom=new Gs(I,S),this._add("tapZoom",S),this._add("clickZoom",I),n.interactive&&n.doubleClickZoom&&d.doubleClickZoom.enable();const B=new $d;this._add("tapDragZoom",B);const F=d.touchPitch=new Yo(d);this._add("touchPitch",F),n.interactive&&n.touchPitch&&d.touchPitch.enable(n.touchPitch);const U=()=>d.project(d.getCenter()),W=(function({enable:_e,clickTolerance:Te,aroundCenter:Pe=!0,minPixelCenterThreshold:ve=100,rotateDegreesPerPixelMoved:Re=.8},$e){const We=new Oc({checkCorrectEvent:qe=>O.mouseButton(qe)===0&&qe.ctrlKey||O.mouseButton(qe)===2&&!qe.ctrlKey});return new zl({clickTolerance:Te,move:(qe,Qe)=>{const bt=$e();if(Pe&&Math.abs(bt.y-qe.y)>ve)return{bearingDelta:a.cn(new a.P(qe.x,Qe.y),Qe,bt)};let Et=(Qe.x-qe.x)*Re;return Pe&&Qe.y<bt.y&&(Et=-Et),{bearingDelta:Et}},moveStateManager:We,enable:_e,assignEvents:Xo})})(n,U),G=(function({enable:_e,clickTolerance:Te,pitchDegreesPerPixelMoved:Pe=-.5}){const ve=new Oc({checkCorrectEvent:Re=>O.mouseButton(Re)===0&&Re.ctrlKey||O.mouseButton(Re)===2});return new zl({clickTolerance:Te,move:(Re,$e)=>({pitchDelta:($e.y-Re.y)*Pe}),moveStateManager:ve,enable:_e,assignEvents:Xo})})(n),q=(function({enable:_e,clickTolerance:Te,rollDegreesPerPixelMoved:Pe=.3},ve){const Re=new Oc({checkCorrectEvent:$e=>O.mouseButton($e)===2&&$e.ctrlKey});return new zl({clickTolerance:Te,move:($e,We)=>{const qe=ve();let Qe=(We.x-$e.x)*Pe;return We.y<qe.y&&(Qe=-Qe),{rollDelta:Qe}},moveStateManager:Re,enable:_e,assignEvents:Xo})})(n,U);d.dragRotate=new Bu(n,W,G,q),this._add("mouseRotate",W,["mousePitch"]),this._add("mousePitch",G,["mouseRotate","mouseRoll"]),this._add("mouseRoll",q,["mousePitch"]),n.interactive&&n.dragRotate&&d.dragRotate.enable();const J=(function({enable:_e,clickTolerance:Te}){const Pe=new Oc({checkCorrectEvent:ve=>O.mouseButton(ve)===0&&!ve.ctrlKey});return new zl({clickTolerance:Te,move:(ve,Re)=>({around:Re,panDelta:Re.sub(ve)}),activateOnStart:!0,moveStateManager:Pe,enable:_e,assignEvents:Xo})})(n),le=new Ko(n,d);d.dragPan=new Th(m,J,le),this._add("mousePan",J),this._add("touchPan",le,["touchZoom","touchRotate"]),n.interactive&&n.dragPan&&d.dragPan.enable(n.dragPan);const de=new Ss,pe=new ns;d.touchZoomRotate=new Zd(m,pe,de,B),this._add("touchRotate",de,["touchPan","touchZoom"]),this._add("touchZoom",pe,["touchPan","touchRotate"]),n.interactive&&n.touchZoomRotate&&d.touchZoomRotate.enable(n.touchZoomRotate);const ge=d.scrollZoom=new vi(d,(()=>this._triggerRenderFrame()));this._add("scrollZoom",ge,["mousePan"]),n.interactive&&n.scrollZoom&&d.scrollZoom.enable(n.scrollZoom);const xe=d.keyboard=new Fc(d);this._add("keyboard",xe),n.interactive&&n.keyboard&&d.keyboard.enable(),this._add("blockableMapEvent",new al(d))}_add(n,d,m){this._handlers.push({handlerName:n,handler:d,allowed:m}),this._handlersById[n]=d}stop(n){if(!this._updatingCamera){for(const{handler:d}of this._handlers)d.reset();this._inertia.clear(),this._fireEvents({},{},n),this._changes=[]}}isActive(){for(const{handler:n}of this._handlers)if(n.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!io(this._eventsInProgress)||this.isZooming()}_blockedByActive(n,d,m){for(const y in n)if(y!==m&&(!d||d.indexOf(y)<0))return!0;return!1}_getMapTouches(n){const d=[];for(const m of n)this._el.contains(m.target)&&d.push(m);return d}mergeHandlerResult(n,d,m,y,x){if(!m)return;a.e(n,m);const S={handlerName:y,originalEvent:m.originalEvent||x};m.zoomDelta!==void 0&&(d.zoom=S),m.panDelta!==void 0&&(d.drag=S),m.rollDelta!==void 0&&(d.roll=S),m.pitchDelta!==void 0&&(d.pitch=S),m.bearingDelta!==void 0&&(d.rotate=S)}_applyChanges(){const n={},d={},m={};for(const[y,x,S]of this._changes)y.panDelta&&(n.panDelta=(n.panDelta||new a.P(0,0))._add(y.panDelta)),y.zoomDelta&&(n.zoomDelta=(n.zoomDelta||0)+y.zoomDelta),y.bearingDelta&&(n.bearingDelta=(n.bearingDelta||0)+y.bearingDelta),y.pitchDelta&&(n.pitchDelta=(n.pitchDelta||0)+y.pitchDelta),y.rollDelta&&(n.rollDelta=(n.rollDelta||0)+y.rollDelta),y.around!==void 0&&(n.around=y.around),y.pinchAround!==void 0&&(n.pinchAround=y.pinchAround),y.noInertia&&(n.noInertia=y.noInertia),a.e(d,x),a.e(m,S);this._updateMapTransform(n,d,m),this._changes=[]}_updateMapTransform(n,d,m){const y=this._map,x=y._getTransformForUpdate(),S=y.terrain;if(!(cl(n)||S&&this._terrainMovement))return this._fireEvents(d,m,!0);y._stop(!0);let{panDelta:I,zoomDelta:B,bearingDelta:F,pitchDelta:U,rollDelta:W,around:G,pinchAround:q}=n;q!==void 0&&(G=q),G=G||y.transform.centerPoint,S&&!x.isPointOnMapSurface(G)&&(G=x.centerPoint);const J={panDelta:I,zoomDelta:B,rollDelta:W,pitchDelta:U,bearingDelta:F,around:G};this._map.cameraHelper.useGlobeControls&&!x.isPointOnMapSurface(G)&&(G=x.centerPoint);const le=G.distSqr(x.centerPoint)<.01?x.center:x.screenPointToLocation(I?G.sub(I):G);S?(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(J,x),this._terrainMovement||!d.drag&&!d.zoom?d.drag&&this._terrainMovement?x.setCenter(x.screenPointToLocation(x.centerPoint.sub(I))):this._map.cameraHelper.handleMapControlsPan(J,x,le):(this._terrainMovement=!0,this._map._elevationFreeze=!0,this._map.cameraHelper.handleMapControlsPan(J,x,le))):(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(J,x),this._map.cameraHelper.handleMapControlsPan(J,x,le)),y._applyUpdatedTransform(x),this._map._update(),n.noInertia||this._inertia.record(n),this._fireEvents(d,m,!0)}_fireEvents(n,d,m){const y=io(this._eventsInProgress),x=io(n),S={};for(const W in n){const{originalEvent:G}=n[W];this._eventsInProgress[W]||(S[`${W}start`]=G),this._eventsInProgress[W]=n[W]}!y&&x&&this._fireEvent("movestart",x.originalEvent);for(const W in S)this._fireEvent(W,S[W]);x&&this._fireEvent("move",x.originalEvent);for(const W in n){const{originalEvent:G}=n[W];this._fireEvent(W,G)}const I={};let B;for(const W in this._eventsInProgress){const{handlerName:G,originalEvent:q}=this._eventsInProgress[W];this._handlersById[G].isActive()||(delete this._eventsInProgress[W],B=d[G]||q,I[`${W}end`]=B)}for(const W in I)this._fireEvent(W,I[W]);const F=io(this._eventsInProgress),U=(y||x)&&!F;if(U&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const W=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&W.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(W)}if(m&&U){this._updatingCamera=!0;const W=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),G=q=>q!==0&&-this._bearingSnap<q&&q<this._bearingSnap;!W||!W.essential&&L.prefersReducedMotion?(this._map.fire(new a.l("moveend",{originalEvent:B})),G(this._map.getBearing())&&this._map.resetNorth()):(G(W.bearing||this._map.getBearing())&&(W.bearing=0),W.freezeElevation=!0,this._map.easeTo(W,{originalEvent:B})),this._updatingCamera=!1}}_fireEvent(n,d){this._map.fire(new a.l(n,d?{originalEvent:d}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((n=>{delete this._frameId,this.handleEvent(new Qr("renderFrame",{timeStamp:n})),this._applyChanges()}))}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class zc extends a.E{constructor(n,d,m){super(),this._renderFrameCallback=()=>{const y=Math.min((L.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(y)),y<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=n,this._bearingSnap=m.bearingSnap,this.cameraHelper=d,this.on("moveend",(()=>{delete this._requestedCameraState}))}migrateProjection(n,d){n.apply(this.transform),this.transform=n,this.cameraHelper=d}getCenter(){return new a.S(this.transform.center.lng,this.transform.center.lat)}setCenter(n,d){return this.jumpTo({center:n},d)}getCenterElevation(){return this.transform.elevation}setCenterElevation(n,d){return this.jumpTo({elevation:n},d),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(n){this._centerClampedToGround=n}panBy(n,d,m){return n=a.P.convert(n).mult(-1),this.panTo(this.transform.center,a.e({offset:n},d),m)}panTo(n,d,m){return this.easeTo(a.e({center:n},d),m)}getZoom(){return this.transform.zoom}setZoom(n,d){return this.jumpTo({zoom:n},d),this}zoomTo(n,d,m){return this.easeTo(a.e({zoom:n},d),m)}zoomIn(n,d){return this.zoomTo(this.getZoom()+1,n,d),this}zoomOut(n,d){return this.zoomTo(this.getZoom()-1,n,d),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(n,d){return n!=this.transform.fov&&(this.transform.setFov(n),this.fire(new a.l("movestart",d)).fire(new a.l("move",d)).fire(new a.l("moveend",d))),this}getBearing(){return this.transform.bearing}setBearing(n,d){return this.jumpTo({bearing:n},d),this}getPadding(){return this.transform.padding}setPadding(n,d){return this.jumpTo({padding:n},d),this}rotateTo(n,d,m){return this.easeTo(a.e({bearing:n},d),m)}resetNorth(n,d){return this.rotateTo(0,a.e({duration:1e3},n),d),this}resetNorthPitch(n,d){return this.easeTo(a.e({bearing:0,pitch:0,roll:0,duration:1e3},n),d),this}snapToNorth(n,d){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(n,d):this}getPitch(){return this.transform.pitch}setPitch(n,d){return this.jumpTo({pitch:n},d),this}getRoll(){return this.transform.roll}setRoll(n,d){return this.jumpTo({roll:n},d),this}cameraForBounds(n,d){n=qr.convert(n).adjustAntiMeridian();const m=d&&d.bearing||0;return this._cameraForBoxAndBearing(n.getNorthWest(),n.getSouthEast(),m,d)}_cameraForBoxAndBearing(n,d,m,y){const x={top:0,bottom:0,right:0,left:0};if(typeof(y=a.e({padding:x,offset:[0,0],maxZoom:this.transform.maxZoom},y)).padding=="number"){const F=y.padding;y.padding={top:F,bottom:F,right:F,left:F}}const S=a.e(x,y.padding);y.padding=S;const I=this.transform,B=new qr(n,d);return this.cameraHelper.cameraForBoxAndBearing(y,S,B,m,I)}fitBounds(n,d,m){return this._fitInternal(this.cameraForBounds(n,d),d,m)}fitScreenCoordinates(n,d,m,y,x){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(a.P.convert(n)),this.transform.screenPointToLocation(a.P.convert(d)),m,y),y,x)}_fitInternal(n,d,m){return n?(delete(d=a.e(n,d)).padding,d.linear?this.easeTo(d,m):this.flyTo(d,m)):this}jumpTo(n,d){this.stop();const m=this._getTransformForUpdate();let y=!1,x=!1,S=!1;const I=m.zoom;this.cameraHelper.handleJumpToCenterZoom(m,n);const B=m.zoom!==I;return"elevation"in n&&m.elevation!==+n.elevation&&m.setElevation(+n.elevation),"bearing"in n&&m.bearing!==+n.bearing&&(y=!0,m.setBearing(+n.bearing)),"pitch"in n&&m.pitch!==+n.pitch&&(x=!0,m.setPitch(+n.pitch)),"roll"in n&&m.roll!==+n.roll&&(S=!0,m.setRoll(+n.roll)),n.padding==null||m.isPaddingEqual(n.padding)||m.setPadding(n.padding),this._applyUpdatedTransform(m),this.fire(new a.l("movestart",d)).fire(new a.l("move",d)),B&&this.fire(new a.l("zoomstart",d)).fire(new a.l("zoom",d)).fire(new a.l("zoomend",d)),y&&this.fire(new a.l("rotatestart",d)).fire(new a.l("rotate",d)).fire(new a.l("rotateend",d)),x&&this.fire(new a.l("pitchstart",d)).fire(new a.l("pitch",d)).fire(new a.l("pitchend",d)),S&&this.fire(new a.l("rollstart",d)).fire(new a.l("roll",d)).fire(new a.l("rollend",d)),this.fire(new a.l("moveend",d))}calculateCameraOptionsFromTo(n,d,m,y=0){const x=a.a1.fromLngLat(n,d),S=a.a1.fromLngLat(m,y),I=S.x-x.x,B=S.y-x.y,F=S.z-x.z,U=Math.hypot(I,B,F);if(U===0)throw new Error("Can't calculate camera options with same From and To");const W=Math.hypot(I,B),G=a.ak(this.transform.cameraToCenterDistance/U/this.transform.tileSize),q=180*Math.atan2(I,-B)/Math.PI;let J=180*Math.acos(W/U)/Math.PI;return J=F<0?90-J:90+J,{center:S.toLngLat(),elevation:y,zoom:G,pitch:J,bearing:q}}calculateCameraOptionsFromCameraLngLatAltRotation(n,d,m,y,x){const S=this.transform.calculateCenterFromCameraLngLatAlt(n,d,m,y);return{center:S.center,elevation:S.elevation,zoom:S.zoom,bearing:m,pitch:y,roll:x}}easeTo(n,d){this._stop(!1,n.easeId),((n=a.e({offset:[0,0],duration:500,easing:a.co},n)).animate===!1||!n.essential&&L.prefersReducedMotion)&&(n.duration=0);const m=this._getTransformForUpdate(),y=this.getBearing(),x=m.pitch,S=m.roll,I="bearing"in n?this._normalizeBearing(n.bearing,y):y,B="pitch"in n?+n.pitch:x,F="roll"in n?this._normalizeBearing(n.roll,S):S,U="padding"in n?n.padding:m.padding,W=a.P.convert(n.offset);let G,q;n.around&&(G=a.S.convert(n.around),q=m.locationToScreenPoint(G));const J={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},le=this.cameraHelper.handleEaseTo(m,{bearing:I,pitch:B,roll:F,padding:U,around:G,aroundPoint:q,offsetAsPoint:W,offset:n.offset,zoom:n.zoom,center:n.center});return this._rotating=this._rotating||y!==I,this._pitching=this._pitching||B!==x,this._rolling=this._rolling||F!==S,this._padding=!m.isPaddingEqual(U),this._zooming=this._zooming||le.isZooming,this._easeId=n.easeId,this._prepareEase(d,n.noMoveStart,J),this.terrain&&this._prepareElevation(le.elevationCenter),this._ease((de=>{le.easeFunc(de),this.terrain&&!n.freezeElevation&&this._updateElevation(de),this._applyUpdatedTransform(m),this._fireMoveEvents(d)}),(de=>{this.terrain&&n.freezeElevation&&this._finalizeElevation(),this._afterEase(d,de)}),n),this}_prepareEase(n,d,m={}){this._moving=!0,d||m.moving||this.fire(new a.l("movestart",n)),this._zooming&&!m.zooming&&this.fire(new a.l("zoomstart",n)),this._rotating&&!m.rotating&&this.fire(new a.l("rotatestart",n)),this._pitching&&!m.pitching&&this.fire(new a.l("pitchstart",n)),this._rolling&&!m.rolling&&this.fire(new a.l("rollstart",n))}_prepareElevation(n){this._elevationCenter=n,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(n,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(n){this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));const d=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(n<1&&d!==this._elevationTarget){const m=this._elevationTarget-this._elevationStart;this._elevationStart+=n*(m-(d-(m*n+this._elevationStart))/(1-n)),this._elevationTarget=d}this.transform.setElevation(a.C.number(this._elevationStart,this._elevationTarget,n))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(n){if(!this.terrain&&n.elevation>=0&&n.pitch<=90)return{};const d=n.getCameraLngLat(),m=n.getCameraAltitude(),y=this.terrain?this.terrain.getElevationForLngLatZoom(d,n.zoom):0;if(m<y){const x=this.calculateCameraOptionsFromTo(d,y,n.center,n.elevation);return{pitch:x.pitch,zoom:x.zoom}}return{}}_applyUpdatedTransform(n){const d=[];if(d.push((y=>this._elevateCameraIfInsideTerrain(y))),this.transformCameraUpdate&&d.push((y=>this.transformCameraUpdate(y))),!d.length)return;const m=n.clone();for(const y of d){const x=m.clone(),{center:S,zoom:I,roll:B,pitch:F,bearing:U,elevation:W}=y(x);S&&x.setCenter(S),W!==void 0&&x.setElevation(W),I!==void 0&&x.setZoom(I),B!==void 0&&x.setRoll(B),F!==void 0&&x.setPitch(F),U!==void 0&&x.setBearing(U),m.apply(x)}this.transform.apply(m)}_fireMoveEvents(n){this.fire(new a.l("move",n)),this._zooming&&this.fire(new a.l("zoom",n)),this._rotating&&this.fire(new a.l("rotate",n)),this._pitching&&this.fire(new a.l("pitch",n)),this._rolling&&this.fire(new a.l("roll",n))}_afterEase(n,d){if(this._easeId&&d&&this._easeId===d)return;delete this._easeId;const m=this._zooming,y=this._rotating,x=this._pitching,S=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,m&&this.fire(new a.l("zoomend",n)),y&&this.fire(new a.l("rotateend",n)),x&&this.fire(new a.l("pitchend",n)),S&&this.fire(new a.l("rollend",n)),this.fire(new a.l("moveend",n))}flyTo(n,d){if(!n.essential&&L.prefersReducedMotion){const Qe=a.Q(n,["center","zoom","bearing","pitch","roll","elevation"]);return this.jumpTo(Qe,d)}this.stop(),n=a.e({offset:[0,0],speed:1.2,curve:1.42,easing:a.co},n);const m=this._getTransformForUpdate(),y=m.bearing,x=m.pitch,S=m.roll,I=m.padding,B="bearing"in n?this._normalizeBearing(n.bearing,y):y,F="pitch"in n?+n.pitch:x,U="roll"in n?this._normalizeBearing(n.roll,S):S,W="padding"in n?n.padding:m.padding,G=a.P.convert(n.offset);let q=m.centerPoint.add(G);const J=m.screenPointToLocation(q),le=this.cameraHelper.handleFlyTo(m,{bearing:B,pitch:F,roll:U,padding:W,locationAtOffset:J,offsetAsPoint:G,center:n.center,minZoom:n.minZoom,zoom:n.zoom});let de=n.curve;const pe=Math.max(m.width,m.height),ge=pe/le.scaleOfZoom,xe=le.pixelPathLength;typeof le.scaleOfMinZoom=="number"&&(de=Math.sqrt(pe/le.scaleOfMinZoom/xe*2));const _e=de*de;function Te(Qe){const bt=(ge*ge-pe*pe+(Qe?-1:1)*_e*_e*xe*xe)/(2*(Qe?ge:pe)*_e*xe);return Math.log(Math.sqrt(bt*bt+1)-bt)}function Pe(Qe){return(Math.exp(Qe)-Math.exp(-Qe))/2}function ve(Qe){return(Math.exp(Qe)+Math.exp(-Qe))/2}const Re=Te(!1);let $e=function(Qe){return ve(Re)/ve(Re+de*Qe)},We=function(Qe){return pe*((ve(Re)*(Pe(bt=Re+de*Qe)/ve(bt))-Pe(Re))/_e)/xe;var bt},qe=(Te(!0)-Re)/de;if(Math.abs(xe)<2e-6||!isFinite(qe)){if(Math.abs(pe-ge)<1e-6)return this.easeTo(n,d);const Qe=ge<pe?-1:1;qe=Math.abs(Math.log(ge/pe))/de,We=()=>0,$e=bt=>Math.exp(Qe*de*bt)}return n.duration="duration"in n?+n.duration:1e3*qe/("screenSpeed"in n?+n.screenSpeed/de:+n.speed),n.maxDuration&&n.duration>n.maxDuration&&(n.duration=0),this._zooming=!0,this._rotating=y!==B,this._pitching=F!==x,this._rolling=U!==S,this._padding=!m.isPaddingEqual(W),this._prepareEase(d,!1),this.terrain&&this._prepareElevation(le.targetCenter),this._ease((Qe=>{const bt=Qe*qe,Et=1/$e(bt),ut=We(bt);this._rotating&&m.setBearing(a.C.number(y,B,Qe)),this._pitching&&m.setPitch(a.C.number(x,F,Qe)),this._rolling&&m.setRoll(a.C.number(S,U,Qe)),this._padding&&(m.interpolatePadding(I,W,Qe),q=m.centerPoint.add(G)),le.easeFunc(Qe,Et,ut,q),this.terrain&&!n.freezeElevation&&this._updateElevation(Qe),this._applyUpdatedTransform(m),this._fireMoveEvents(d)}),(()=>{this.terrain&&n.freezeElevation&&this._finalizeElevation(),this._afterEase(d)}),n),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(n,d){var m;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const y=this._onEaseEnd;delete this._onEaseEnd,y.call(this,d)}return n||(m=this.handlers)===null||m===void 0||m.stop(!1),this}_ease(n,d,m){m.animate===!1||m.duration===0?(n(1),d()):(this._easeStart=L.now(),this._easeOptions=m,this._onEaseFrame=n,this._onEaseEnd=d,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(n,d){n=a.aO(n,-180,180);const m=Math.abs(n-d);return Math.abs(n-360-d)<m&&(n-=360),Math.abs(n+360-d)<m&&(n+=360),n}queryTerrainElevation(n){return this.terrain?this.terrain.getElevationForLngLatZoom(a.S.convert(n),this.transform.tileZoom):null}}const Uc={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class Sh{constructor(n=Uc){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=d=>{!d||d.sourceDataType!=="metadata"&&d.sourceDataType!=="visibility"&&d.dataType!=="style"&&d.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=n}getDefaultPosition(){return"bottom-right"}onAdd(n){return this._map=n,this._compact=this.options.compact,this._container=O.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=O.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=O.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){O.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(n,d){const m=this._map._getUIString(`AttributionControl.${d}`);n.title=m,n.setAttribute("aria-label",m)}_updateAttributions(){if(!this._map.style)return;let n=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?n=n.concat(this.options.customAttribution.map((y=>typeof y!="string"?"":y))):typeof this.options.customAttribution=="string"&&n.push(this.options.customAttribution)),this._map.style.stylesheet){const y=this._map.style.stylesheet;this.styleOwner=y.owner,this.styleId=y.id}const d=this._map.style.sourceCaches;for(const y in d){const x=d[y];if(x.used||x.usedForTerrain){const S=x.getSource();S.attribution&&n.indexOf(S.attribution)<0&&n.push(S.attribution)}}n=n.filter((y=>String(y).trim())),n.sort(((y,x)=>y.length-x.length)),n=n.filter(((y,x)=>{for(let S=x+1;S<n.length;S++)if(n[S].indexOf(y)>=0)return!1;return!0}));const m=n.join(" | ");m!==this._attribHTML&&(this._attribHTML=m,n.length?(this._innerContainer.innerHTML=O.sanitize(m),this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Kd{constructor(n={}){this._updateCompact=()=>{const d=this._container.children;if(d.length){const m=d[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&m.classList.add("maplibregl-compact"):m.classList.remove("maplibregl-compact")}},this.options=n}getDefaultPosition(){return"bottom-left"}onAdd(n){this._map=n,this._compact=this.options&&this.options.compact,this._container=O.create("div","maplibregl-ctrl");const d=O.create("a","maplibregl-ctrl-logo");return d.target="_blank",d.rel="noopener nofollow",d.href="https://maplibre.org/",d.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),d.setAttribute("rel","noopener nofollow"),this._container.appendChild(d),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){O.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class os{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(n){const d=++this._id;return this._queue.push({callback:n,id:d,cancelled:!1}),d}remove(n){const d=this._currentlyRunning,m=d?this._queue.concat(d):this._queue;for(const y of m)if(y.id===n)return void(y.cancelled=!0)}run(n=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const d=this._currentlyRunning=this._queue;this._queue=[];for(const m of d)if(!m.cancelled&&(m.callback(n),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var Du=a.aJ([{name:"a_pos3d",type:"Int16",components:3}]);class zt extends a.E{constructor(n){super(),this._lastTilesetChange=L.now(),this.sourceCache=n,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=n._source.tileSize*2**this.deltaZoom,n.usedForTerrain=!0,n.tileSize=this.tileSize}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(n,d){this.sourceCache.update(n,d),this._renderableTilesKeys=[];const m={};for(const y of Le(n,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:d,calculateTileZoom:this.sourceCache._source.calculateTileZoom}))m[y.key]=!0,this._renderableTilesKeys.push(y.key),this._tiles[y.key]||(y.terrainRttPosMatrix32f=new Float64Array(16),a.bY(y.terrainRttPosMatrix32f,0,a.$,a.$,0,0,1),this._tiles[y.key]=new Qs(y,this.tileSize),this._lastTilesetChange=L.now());for(const y in this._tiles)m[y]||delete this._tiles[y]}freeRtt(n){for(const d in this._tiles){const m=this._tiles[d];(!n||m.tileID.equals(n)||m.tileID.isChildOf(n)||n.isChildOf(m.tileID))&&(m.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map((n=>this.getTileByID(n)))}getTileByID(n){return this._tiles[n]}getTerrainCoords(n,d){return d?this._getTerrainCoordsForTileRanges(n,d):this._getTerrainCoordsForRegularTile(n)}_getTerrainCoordsForRegularTile(n){const d={};for(const m of this._renderableTilesKeys){const y=this._tiles[m].tileID,x=n.clone(),S=a.ba();if(y.canonical.equals(n.canonical))a.bY(S,0,a.$,a.$,0,0,1);else if(y.canonical.isChildOf(n.canonical)){const I=y.canonical.z-n.canonical.z,B=y.canonical.x-(y.canonical.x>>I<<I),F=y.canonical.y-(y.canonical.y>>I<<I),U=a.$>>I;a.bY(S,0,U,U,0,0,1),a.M(S,S,[-B*U,-F*U,0])}else{if(!n.canonical.isChildOf(y.canonical))continue;{const I=n.canonical.z-y.canonical.z,B=n.canonical.x-(n.canonical.x>>I<<I),F=n.canonical.y-(n.canonical.y>>I<<I),U=a.$>>I;a.bY(S,0,a.$,a.$,0,0,1),a.M(S,S,[B*U,F*U,0]),a.N(S,S,[1/2**I,1/2**I,0])}}x.terrainRttPosMatrix32f=new Float32Array(S),d[m]=x}return d}_getTerrainCoordsForTileRanges(n,d){const m={};for(const y of this._renderableTilesKeys){const x=this._tiles[y].tileID;if(!this._isWithinTileRanges(x,d))continue;const S=n.clone(),I=a.ba();if(x.canonical.z===n.canonical.z){const B=n.canonical.x-x.canonical.x,F=n.canonical.y-x.canonical.y;a.bY(I,0,a.$,a.$,0,0,1),a.M(I,I,[B*a.$,F*a.$,0])}else if(x.canonical.z>n.canonical.z){const B=x.canonical.z-n.canonical.z,F=x.canonical.x-(x.canonical.x>>B<<B),U=x.canonical.y-(x.canonical.y>>B<<B),W=n.canonical.x-(x.canonical.x>>B),G=n.canonical.y-(x.canonical.y>>B),q=a.$>>B;a.bY(I,0,q,q,0,0,1),a.M(I,I,[-F*q+W*a.$,-U*q+G*a.$,0])}else{const B=n.canonical.z-x.canonical.z,F=n.canonical.x-(n.canonical.x>>B<<B),U=n.canonical.y-(n.canonical.y>>B<<B),W=(n.canonical.x>>B)-x.canonical.x,G=(n.canonical.y>>B)-x.canonical.y,q=a.$<<B;a.bY(I,0,q,q,0,0,1),a.M(I,I,[F*a.$+W*q,U*a.$+G*q,0])}S.terrainRttPosMatrix32f=new Float32Array(I),m[y]=S}return m}getSourceTile(n,d){const m=this.sourceCache._source;let y=n.overscaledZ-this.deltaZoom;if(y>m.maxzoom&&(y=m.maxzoom),y<m.minzoom)return null;this._sourceTileCache[n.key]||(this._sourceTileCache[n.key]=n.scaledTo(y).key);let x=this.sourceCache.getTileByID(this._sourceTileCache[n.key]);if((!x||!x.dem)&&d)for(;y>=m.minzoom&&(!x||!x.dem);)x=this.sourceCache.getTileByID(n.scaledTo(y--).key);return x}anyTilesAfterTime(n=Date.now()){return this._lastTilesetChange>=n}_isWithinTileRanges(n,d){return d[n.canonical.z]&&n.canonical.x>=d[n.canonical.z].minTileX&&n.canonical.x<=d[n.canonical.z].maxTileX&&n.canonical.y>=d[n.canonical.z].minTileY&&n.canonical.y<=d[n.canonical.z].maxTileY}}class tr{constructor(n,d,m){this._meshCache={},this.painter=n,this.sourceCache=new zt(d),this.options=m,this.exaggeration=typeof m.exaggeration=="number"?m.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(n,d,m,y=a.$){var x;if(!(d>=0&&d<y&&m>=0&&m<y))return 0;const S=this.getTerrainData(n),I=(x=S.tile)===null||x===void 0?void 0:x.dem;if(!I)return 0;const B=a.cs([],[d/y*a.$,m/y*a.$],S.u_terrain_matrix),F=[B[0]*I.dim,B[1]*I.dim],U=Math.floor(F[0]),W=Math.floor(F[1]),G=F[0]-U,q=F[1]-W;return I.get(U,W)*(1-G)*(1-q)+I.get(U+1,W)*G*(1-q)+I.get(U,W+1)*(1-G)*q+I.get(U+1,W+1)*G*q}getElevationForLngLatZoom(n,d){if(!a.ct(d,n.wrap()))return 0;const{tileID:m,mercatorX:y,mercatorY:x}=this._getOverscaledTileIDFromLngLatZoom(n,d);return this.getElevation(m,y%a.$,x%a.$,a.$)}getElevation(n,d,m,y=a.$){return this.getDEMElevation(n,d,m,y)*this.exaggeration}getTerrainData(n){if(!this._emptyDemTexture){const y=this.painter.context,x=new a.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new a.T(y,x,y.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new a.T(y,new a.R({width:1,height:1}),y.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(y.gl.NEAREST,y.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=a.ag([])}const d=this.sourceCache.getSourceTile(n,!0);if(d&&d.dem&&(!d.demTexture||d.needsTerrainPrepare)){const y=this.painter.context;d.demTexture=this.painter.getTileTexture(d.dem.stride),d.demTexture?d.demTexture.update(d.dem.getPixels(),{premultiply:!1}):d.demTexture=new a.T(y,d.dem.getPixels(),y.gl.RGBA,{premultiply:!1}),d.demTexture.bind(y.gl.NEAREST,y.gl.CLAMP_TO_EDGE),d.needsTerrainPrepare=!1}const m=d&&d+d.tileID.key+n.key;if(m&&!this._demMatrixCache[m]){const y=this.sourceCache.sourceCache._source.maxzoom;let x=n.canonical.z-d.tileID.canonical.z;n.overscaledZ>n.canonical.z&&(n.canonical.z>=y?x=n.canonical.z-y:a.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const S=n.canonical.x-(n.canonical.x>>x<<x),I=n.canonical.y-(n.canonical.y>>x<<x),B=a.cu(new Float64Array(16),[1/(a.$<<x),1/(a.$<<x),0]);a.M(B,B,[S*a.$,I*a.$,0]),this._demMatrixCache[n.key]={matrix:B,coord:n}}return{u_depth:2,u_terrain:3,u_terrain_dim:d&&d.dem&&d.dem.dim||1,u_terrain_matrix:m?this._demMatrixCache[n.key].matrix:this._emptyDemMatrix,u_terrain_unpack:d&&d.dem&&d.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(d&&d.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:d}}getFramebuffer(n){const d=this.painter,m=d.width/devicePixelRatio,y=d.height/devicePixelRatio;return!this._fbo||this._fbo.width===m&&this._fbo.height===y||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new a.T(d.context,{width:m,height:y,data:null},d.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(d.context.gl.NEAREST,d.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new a.T(d.context,{width:m,height:y,data:null},d.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(d.context.gl.NEAREST,d.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=d.context.createFramebuffer(m,y,!0,!1),this._fbo.depthAttachment.set(d.context.createRenderbuffer(d.context.gl.DEPTH_COMPONENT16,m,y))),this._fbo.colorAttachment.set(n==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const n=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const d=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let x=0,S=0;x<this._coordsTextureSize;x++)for(let I=0;I<this._coordsTextureSize;I++,S+=4)d[S+0]=255&I,d[S+1]=255&x,d[S+2]=I>>8<<4|x>>8,d[S+3]=0;const m=new a.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(d.buffer)),y=new a.T(n,m,n.gl.RGBA,{premultiply:!1});return y.bind(n.gl.NEAREST,n.gl.CLAMP_TO_EDGE),this._coordsTexture=y,y}pointCoordinate(n){this.painter.maybeDrawDepthAndCoords(!0);const d=new Uint8Array(4),m=this.painter.context,y=m.gl,x=Math.round(n.x*this.painter.pixelRatio/devicePixelRatio),S=Math.round(n.y*this.painter.pixelRatio/devicePixelRatio),I=Math.round(this.painter.height/devicePixelRatio);m.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),y.readPixels(x,I-S-1,1,1,y.RGBA,y.UNSIGNED_BYTE,d),m.bindFramebuffer.set(null);const B=d[0]+(d[2]>>4<<8),F=d[1]+((15&d[2])<<8),U=this.coordsIndex[255-d[3]],W=U&&this.sourceCache.getTileByID(U);if(!W)return null;const G=this._coordsTextureSize,q=(1<<W.tileID.canonical.z)*G;return new a.a1((W.tileID.canonical.x*G+B)/q+W.tileID.wrap,(W.tileID.canonical.y*G+F)/q,this.getElevation(W.tileID,B,F,G))}depthAtPoint(n){const d=new Uint8Array(4),m=this.painter.context,y=m.gl;return m.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),y.readPixels(n.x,this.painter.height/devicePixelRatio-n.y-1,1,1,y.RGBA,y.UNSIGNED_BYTE,d),m.bindFramebuffer.set(null),(d[0]/16777216+d[1]/65536+d[2]/256+d[3])/256}getTerrainMesh(n){var d;const m=((d=this.painter.style.projection)===null||d===void 0?void 0:d.transitionState)>0,y=m&&n.canonical.y===0,x=m&&n.canonical.y===(1<<n.canonical.z)-1,S=`m_${y?"n":""}_${x?"s":""}`;if(this._meshCache[S])return this._meshCache[S];const I=this.painter.context,B=new a.cv,F=new a.aN,U=this.meshSize,W=a.$/U,G=U*U;for(let ve=0;ve<=U;ve++)for(let Re=0;Re<=U;Re++)B.emplaceBack(Re*W,ve*W,0);for(let ve=0;ve<G;ve+=U+1)for(let Re=0;Re<U;Re++)F.emplaceBack(Re+ve,U+Re+ve+1,U+Re+ve+2),F.emplaceBack(Re+ve,U+Re+ve+2,Re+ve+1);const q=B.length,J=q+(U+1),le=(U+1)*U,de=y?a.bh:0,pe=y?0:1,ge=x?a.bi:a.$,xe=x?0:1;for(let ve=0;ve<=U;ve++)B.emplaceBack(ve*W,de,pe);for(let ve=0;ve<=U;ve++)B.emplaceBack(ve*W,ge,xe);for(let ve=0;ve<U;ve++)F.emplaceBack(le+ve,J+ve,J+ve+1),F.emplaceBack(le+ve,J+ve+1,le+ve+1),F.emplaceBack(0+ve,q+ve+1,q+ve),F.emplaceBack(0+ve,0+ve+1,q+ve+1);const _e=B.length,Te=_e+2*(U+1);for(const ve of[0,1])for(let Re=0;Re<=U;Re++)for(const $e of[0,1])B.emplaceBack(ve*a.$,Re*W,$e);for(let ve=0;ve<2*U;ve+=2)F.emplaceBack(_e+ve,_e+ve+1,_e+ve+3),F.emplaceBack(_e+ve,_e+ve+3,_e+ve+2),F.emplaceBack(Te+ve,Te+ve+3,Te+ve+1),F.emplaceBack(Te+ve,Te+ve+2,Te+ve+3);const Pe=new mt(I.createVertexBuffer(B,Du.members),I.createIndexBuffer(F),a.aM.simpleSegment(0,0,B.length,F.length));return this._meshCache[S]=Pe,Pe}getMeshFrameDelta(n){return 2*Math.PI*a.bu/Math.pow(2,Math.max(n,0))/5}getMinTileElevationForLngLatZoom(n,d){var m;const{tileID:y}=this._getOverscaledTileIDFromLngLatZoom(n,d);return(m=this.getMinMaxElevation(y).minElevation)!==null&&m!==void 0?m:0}getMinMaxElevation(n){const d=this.getTerrainData(n).tile,m={minElevation:null,maxElevation:null};return d&&d.dem&&(m.minElevation=d.dem.min*this.exaggeration,m.maxElevation=d.dem.max*this.exaggeration),m}_getOverscaledTileIDFromLngLatZoom(n,d){const m=a.a1.fromLngLat(n.wrap()),y=(1<<d)*a.$,x=m.x*y,S=m.y*y,I=Math.floor(x/a.$),B=Math.floor(S/a.$);return{tileID:new a.Z(d,0,d,I,B),mercatorX:x,mercatorY:S}}}class Ma{constructor(n,d,m){this._context=n,this._size=d,this._tileSize=m,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const n of this._objects)n.texture.destroy(),n.fbo.destroy()}_createObject(n){const d=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),m=new a.T(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return m.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),d.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),d.colorAttachment.set(m.texture),{id:n,fbo:d,texture:m,stamp:-1,inUse:!1}}getObjectForId(n){return this._objects[n]}useObject(n){n.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter((d=>n.id!==d)),this._recentlyUsed.push(n.id)}stampObject(n){n.stamp=++this._stamp}getOrCreateFreeObject(){for(const d of this._recentlyUsed)if(!this._objects[d].inUse)return this._objects[d];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const n=this._createObject(this._objects.length);return this._objects.push(n),n}freeObject(n){n.inUse=!1}freeAllObjects(){for(const n of this._objects)this.freeObject(n)}isFull(){return!(this._objects.length<this._size)&&this._objects.some((n=>!n.inUse))===!1}}const Jo={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0,"color-relief":!0};class jc{constructor(n,d){this.painter=n,this.terrain=d,this.pool=new Ma(n.context,30,d.sourceCache.tileSize*d.qualityFactor)}destruct(){this.pool.destruct()}getTexture(n){return this.pool.getObjectForId(n.rtt[this._stacks.length-1].id).texture}prepareForRender(n,d){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=n._order.filter((m=>!n._layers[m].isHidden(d))),this._coordsAscending={};for(const m in n.sourceCaches){this._coordsAscending[m]={};const y=n.sourceCaches[m].getVisibleCoordinates(),x=n.sourceCaches[m].getSource(),S=x instanceof Yn?x.terrainTileRanges:null;for(const I of y){const B=this.terrain.sourceCache.getTerrainCoords(I,S);for(const F in B)this._coordsAscending[m][F]||(this._coordsAscending[m][F]=[]),this._coordsAscending[m][F].push(B[F])}}this._coordsAscendingStr={};for(const m of n._order){const y=n._layers[m],x=y.source;if(Jo[y.type]&&!this._coordsAscendingStr[x]){this._coordsAscendingStr[x]={};for(const S in this._coordsAscending[x])this._coordsAscendingStr[x][S]=this._coordsAscending[x][S].map((I=>I.key)).sort().join()}}for(const m of this._renderableTiles)for(const y in this._coordsAscendingStr){const x=this._coordsAscendingStr[y][m.tileID.key];x&&x!==m.rttCoords[y]&&(m.rtt=[])}}renderLayer(n,d){if(n.isHidden(this.painter.transform.zoom))return!1;const m=Object.assign(Object.assign({},d),{isRenderingToTexture:!0}),y=n.type,x=this.painter,S=this._renderableLayerIds[this._renderableLayerIds.length-1]===n.id;if(Jo[y]&&(this._prevType&&Jo[this._prevType]||this._stacks.push([]),this._prevType=y,this._stacks[this._stacks.length-1].push(n.id),!S))return!0;if(Jo[this._prevType]||Jo[y]&&S){this._prevType=y;const I=this._stacks.length-1,B=this._stacks[I]||[];for(const F of this._renderableTiles){if(this.pool.isFull()&&(Us(this.painter,this.terrain,this._rttTiles,m),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(F),F.rtt[I]){const W=this.pool.getObjectForId(F.rtt[I].id);if(W.stamp===F.rtt[I].stamp){this.pool.useObject(W);continue}}const U=this.pool.getOrCreateFreeObject();this.pool.useObject(U),this.pool.stampObject(U),F.rtt[I]={id:U.id,stamp:U.stamp},x.context.bindFramebuffer.set(U.fbo.framebuffer),x.context.clear({color:a.bf.transparent,stencil:0}),x.currentStencilSource=void 0;for(let W=0;W<B.length;W++){const G=x.style._layers[B[W]],q=G.source?this._coordsAscending[G.source][F.tileID.key]:[F.tileID];x.context.viewport.set([0,0,U.fbo.width,U.fbo.height]),x._renderTileClippingMasks(G,q,!0),x.renderLayer(x,x.style.sourceCaches[G.source],G,q,m),G.source&&(F.rttCoords[G.source]=this._coordsAscendingStr[G.source][F.tileID.key])}}return Us(this.painter,this.terrain,this._rttTiles,m),this._rttTiles=[],this.pool.freeAllObjects(),Jo[y]}return!1}}const Bn={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Ch=v,Ln={hash:!1,interactive:!0,bearingSnap:7,attributionControl:Uc,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:a.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0},no={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class Bo{constructor(n,d,m=!1){this.mousedown=x=>{this.startMove(x,O.mousePos(this.element,x)),O.addEventListener(window,"mousemove",this.mousemove),O.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=x=>{this.move(x,O.mousePos(this.element,x))},this.mouseup=x=>{this._rotatePitchHandler.dragEnd(x),this.offTemp()},this.touchstart=x=>{x.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=O.touchPos(this.element,x.targetTouches)[0],this.startMove(x,this._startPos),O.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),O.addEventListener(window,"touchend",this.touchend))},this.touchmove=x=>{x.targetTouches.length!==1?this.reset():(this._lastPos=O.touchPos(this.element,x.targetTouches)[0],this.move(x,this._lastPos))},this.touchend=x=>{x.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHandler.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=d;const y=new ll;this._rotatePitchHandler=new zl({clickTolerance:3,move:(x,S)=>{const I=d.getBoundingClientRect(),B=new a.P((I.bottom-I.top)/2,(I.right-I.left)/2);return{bearingDelta:a.cn(new a.P(x.x,S.y),S,B),pitchDelta:m?-.5*(S.y-x.y):void 0}},moveStateManager:y,enable:!0,assignEvents:()=>{}}),this.map=n,O.addEventListener(d,"mousedown",this.mousedown),O.addEventListener(d,"touchstart",this.touchstart,{passive:!1}),O.addEventListener(d,"touchcancel",this.reset)}startMove(n,d){this._rotatePitchHandler.dragStart(n,d),O.disableDrag()}move(n,d){const m=this.map,{bearingDelta:y,pitchDelta:x}=this._rotatePitchHandler.dragMove(n,d)||{};y&&m.setBearing(m.getBearing()+y),x&&m.setPitch(m.getPitch()+x)}off(){const n=this.element;O.removeEventListener(n,"mousedown",this.mousedown),O.removeEventListener(n,"touchstart",this.touchstart,{passive:!1}),O.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),O.removeEventListener(window,"touchend",this.touchend),O.removeEventListener(n,"touchcancel",this.reset),this.offTemp()}offTemp(){O.enableDrag(),O.removeEventListener(window,"mousemove",this.mousemove),O.removeEventListener(window,"mouseup",this.mouseup),O.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),O.removeEventListener(window,"touchend",this.touchend)}}let Zr;function Pi(b,n,d,m=!1){if(m||!d.getCoveringTilesDetailsProvider().allowWorldCopies())return b?.wrap();const y=new a.S(b.lng,b.lat);if(b=new a.S(b.lng,b.lat),n){const x=new a.S(b.lng-360,b.lat),S=new a.S(b.lng+360,b.lat),I=d.locationToScreenPoint(b).distSqr(n);d.locationToScreenPoint(x).distSqr(n)<I?b=x:d.locationToScreenPoint(S).distSqr(n)<I&&(b=S)}for(;Math.abs(b.lng-d.center.lng)>180;){const x=d.locationToScreenPoint(b);if(x.x>=0&&x.y>=0&&x.x<=d.width&&x.y<=d.height)break;b.lng>d.center.lng?b.lng-=360:b.lng+=360}return b.lng!==y.lng&&d.isPointOnMapSurface(d.locationToScreenPoint(b))?b:y}const so={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Hs(b,n,d){const m=b.classList;for(const y in so)m.remove(`maplibregl-${d}-anchor-${y}`);m.add(`maplibregl-${d}-anchor-${n}`)}class ul extends a.E{constructor(n){if(super(),this._onKeyPress=d=>{const m=d.code,y=d.charCode||d.keyCode;m!=="Space"&&m!=="Enter"&&y!==32&&y!==13||this.togglePopup()},this._onMapClick=d=>{const m=d.originalEvent.target,y=this._element;this._popup&&(m===y||y.contains(m))&&this.togglePopup()},this._update=d=>{if(!this._map)return;const m=this._map.loaded()&&!this._map.isMoving();(d?.type==="terrain"||d?.type==="render"&&!m)&&this._map.once("render",this._update),this._lngLat=Pi(this._lngLat,this._flatPos,this._map.transform),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let y="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?y=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(y=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let x="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?x="rotateX(0deg)":this._pitchAlignment==="map"&&(x=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||d&&d.type!=="moveend"||(this._pos=this._pos.round()),O.setTransform(this._element,`${so[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${x} ${y}`),L.frameAsync(new AbortController).then((()=>{this._updateOpacity(d&&d.type==="moveend")})).catch((()=>{}))},this._onMove=d=>{if(!this._isDragging){const m=this._clickTolerance||this._map._clickTolerance;this._isDragging=d.point.dist(this._pointerdownPos)>=m}this._isDragging&&(this._pos=d.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new a.l("dragstart"))),this.fire(new a.l("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new a.l("dragend")),this._state="inactive"},this._addDragHandler=d=>{this._element.contains(d.originalEvent.target)&&(d.preventDefault(),this._positionDelta=d.point.sub(this._pos).add(this._offset),this._pointerdownPos=d.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=n&&n.anchor||"center",this._color=n&&n.color||"#3FB1CE",this._scale=n&&n.scale||1,this._draggable=n&&n.draggable||!1,this._clickTolerance=n&&n.clickTolerance||0,this._subpixelPositioning=n&&n.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=n&&n.rotation||0,this._rotationAlignment=n&&n.rotationAlignment||"auto",this._pitchAlignment=n&&n.pitchAlignment&&n.pitchAlignment!=="auto"?n.pitchAlignment:this._rotationAlignment,this.setOpacity(n?.opacity,n?.opacityWhenCovered),n&&n.element)this._element=n.element,this._offset=a.P.convert(n&&n.offset||[0,0]);else{this._defaultMarker=!0,this._element=O.create("div");const d=O.createNS("http://www.w3.org/2000/svg","svg"),m=41,y=27;d.setAttributeNS(null,"display","block"),d.setAttributeNS(null,"height",`${m}px`),d.setAttributeNS(null,"width",`${y}px`),d.setAttributeNS(null,"viewBox",`0 0 ${y} ${m}`);const x=O.createNS("http://www.w3.org/2000/svg","g");x.setAttributeNS(null,"stroke","none"),x.setAttributeNS(null,"stroke-width","1"),x.setAttributeNS(null,"fill","none"),x.setAttributeNS(null,"fill-rule","evenodd");const S=O.createNS("http://www.w3.org/2000/svg","g");S.setAttributeNS(null,"fill-rule","nonzero");const I=O.createNS("http://www.w3.org/2000/svg","g");I.setAttributeNS(null,"transform","translate(3.0, 29.0)"),I.setAttributeNS(null,"fill","#000000");const B=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const pe of B){const ge=O.createNS("http://www.w3.org/2000/svg","ellipse");ge.setAttributeNS(null,"opacity","0.04"),ge.setAttributeNS(null,"cx","10.5"),ge.setAttributeNS(null,"cy","5.80029008"),ge.setAttributeNS(null,"rx",pe.rx),ge.setAttributeNS(null,"ry",pe.ry),I.appendChild(ge)}const F=O.createNS("http://www.w3.org/2000/svg","g");F.setAttributeNS(null,"fill",this._color);const U=O.createNS("http://www.w3.org/2000/svg","path");U.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),F.appendChild(U);const W=O.createNS("http://www.w3.org/2000/svg","g");W.setAttributeNS(null,"opacity","0.25"),W.setAttributeNS(null,"fill","#000000");const G=O.createNS("http://www.w3.org/2000/svg","path");G.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),W.appendChild(G);const q=O.createNS("http://www.w3.org/2000/svg","g");q.setAttributeNS(null,"transform","translate(6.0, 7.0)"),q.setAttributeNS(null,"fill","#FFFFFF");const J=O.createNS("http://www.w3.org/2000/svg","g");J.setAttributeNS(null,"transform","translate(8.0, 8.0)");const le=O.createNS("http://www.w3.org/2000/svg","circle");le.setAttributeNS(null,"fill","#000000"),le.setAttributeNS(null,"opacity","0.25"),le.setAttributeNS(null,"cx","5.5"),le.setAttributeNS(null,"cy","5.5"),le.setAttributeNS(null,"r","5.4999962");const de=O.createNS("http://www.w3.org/2000/svg","circle");de.setAttributeNS(null,"fill","#FFFFFF"),de.setAttributeNS(null,"cx","5.5"),de.setAttributeNS(null,"cy","5.5"),de.setAttributeNS(null,"r","5.4999962"),J.appendChild(le),J.appendChild(de),S.appendChild(I),S.appendChild(F),S.appendChild(W),S.appendChild(q),S.appendChild(J),d.appendChild(S),d.setAttributeNS(null,"height",m*this._scale+"px"),d.setAttributeNS(null,"width",y*this._scale+"px"),this._element.appendChild(d),this._offset=a.P.convert(n&&n.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",(d=>{d.preventDefault()})),this._element.addEventListener("mousedown",(d=>{d.preventDefault()})),Hs(this._element,this._anchor,"marker"),n&&n.className)for(const d of n.className.split(" "))this._element.classList.add(d);this._popup=null}addTo(n){return this.remove(),this._map=n,this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label",n._getUIString("Marker.Title")),n.getCanvasContainer().appendChild(this._element),n.on("move",this._update),n.on("moveend",this._update),n.on("terrain",this._update),n.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),O.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(n){return this._lngLat=a.S.convert(n),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(n){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),n){if(!("offset"in n.options)){const d=Math.abs(13.5)/Math.SQRT2;n.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[d,-1*(38.1-13.5+d)],"bottom-right":[-d,-1*(38.1-13.5+d)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=n,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(n){return this._subpixelPositioning=n,this}getPopup(){return this._popup}togglePopup(){const n=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:n?(n.isOpen()?n.remove():(n.setLngLat(this._lngLat),n.addTo(this._map)),this):this}_updateOpacity(n=!1){var d,m;const y=(d=this._map)===null||d===void 0?void 0:d.terrain,x=this._map.transform.isLocationOccluded(this._lngLat);if(!y||x){const q=x?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==q&&(this._element.style.opacity=q))}if(n)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout((()=>{this._opacityTimeout=null}),100)}const S=this._map,I=S.terrain.depthAtPoint(this._pos),B=S.terrain.getElevationForLngLatZoom(this._lngLat,S.transform.tileZoom);if(S.transform.lngLatToCameraDepth(this._lngLat,B)-I<.006)return void(this._element.style.opacity=this._opacity);const F=-this._offset.y/S.transform.pixelsPerMeter,U=Math.sin(S.getPitch()*Math.PI/180)*F,W=S.terrain.depthAtPoint(new a.P(this._pos.x,this._pos.y-this._offset.y)),G=S.transform.lngLatToCameraDepth(this._lngLat,B+U)-W>.006;!((m=this._popup)===null||m===void 0)&&m.isOpen()&&G&&this._popup.remove(),this._element.style.opacity=G?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(n){return this._offset=a.P.convert(n),this._update(),this}addClassName(n){this._element.classList.add(n)}removeClassName(n){this._element.classList.remove(n)}toggleClassName(n){return this._element.classList.toggle(n)}setDraggable(n){return this._draggable=!!n,this._map&&(n?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(n){return this._rotation=n||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(n){return this._rotationAlignment=n||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(n){return this._pitchAlignment=n&&n!=="auto"?n:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(n,d){return(this._opacity===void 0||n===void 0&&d===void 0)&&(this._opacity="1",this._opacityWhenCovered="0.2"),n!==void 0&&(this._opacity=n),d!==void 0&&(this._opacityWhenCovered=d),this._map&&this._updateOpacity(!0),this}}const Mh={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Cs=0,Ms=!1;const hl={maxWidth:100,unit:"metric"};function Nu(b,n,d){const m=d&&d.maxWidth||100,y=b._container.clientHeight/2,x=b._container.clientWidth/2,S=b.unproject([x-m/2,y]),I=b.unproject([x+m/2,y]),B=Math.round(b.project(I).x-b.project(S).x),F=Math.min(m,B,b._container.clientWidth),U=S.distanceTo(I);if(d&&d.unit==="imperial"){const W=3.2808*U;W>5280?Qo(n,F,W/5280,b._getUIString("ScaleControl.Miles")):Qo(n,F,W,b._getUIString("ScaleControl.Feet"))}else d&&d.unit==="nautical"?Qo(n,F,U/1852,b._getUIString("ScaleControl.NauticalMiles")):U>=1e3?Qo(n,F,U/1e3,b._getUIString("ScaleControl.Kilometers")):Qo(n,F,U,b._getUIString("ScaleControl.Meters"))}function Qo(b,n,d,m){const y=(function(x){const S=Math.pow(10,`${Math.floor(x)}`.length-1);let I=x/S;return I=I>=10?10:I>=5?5:I>=3?3:I>=2?2:I>=1?1:(function(B){const F=Math.pow(10,Math.ceil(-Math.log(B)/Math.LN10));return Math.round(B*F)/F})(I),S*I})(d);b.style.width=n*(y/d)+"px",b.innerHTML=`${y}&nbsp;${m}`}const Ph={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1,locationOccludedOpacity:void 0},Ul=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Ws(b){if(b){if(typeof b=="number"){const n=Math.round(Math.abs(b)/Math.SQRT2);return{center:new a.P(0,0),top:new a.P(0,b),"top-left":new a.P(n,n),"top-right":new a.P(-n,n),bottom:new a.P(0,-b),"bottom-left":new a.P(n,-n),"bottom-right":new a.P(-n,-n),left:new a.P(b,0),right:new a.P(-b,0)}}if(b instanceof a.P||Array.isArray(b)){const n=a.P.convert(b);return{center:n,top:n,"top-left":n,"top-right":n,bottom:n,"bottom-left":n,"bottom-right":n,left:n,right:n}}return{center:a.P.convert(b.center||[0,0]),top:a.P.convert(b.top||[0,0]),"top-left":a.P.convert(b["top-left"]||[0,0]),"top-right":a.P.convert(b["top-right"]||[0,0]),bottom:a.P.convert(b.bottom||[0,0]),"bottom-left":a.P.convert(b["bottom-left"]||[0,0]),"bottom-right":a.P.convert(b["bottom-right"]||[0,0]),left:a.P.convert(b.left||[0,0]),right:a.P.convert(b.right||[0,0])}}return Ws(new a.P(0,0))}const jl=v;h.AJAXError=a.cz,h.Event=a.l,h.Evented=a.E,h.LngLat=a.S,h.MercatorCoordinate=a.a1,h.Point=a.P,h.addProtocol=a.cA,h.config=a.a,h.removeProtocol=a.cB,h.AttributionControl=Sh,h.BoxZoomHandler=Vn,h.CanvasSource=mi,h.CooperativeGesturesHandler=Lu,h.DoubleClickZoomHandler=Gs,h.DragPanHandler=Th,h.DragRotateHandler=Bu,h.EdgeInsets=xi,h.FullscreenControl=class extends a.E{constructor(b={}){super(),this._onFullscreenChange=()=>{var n;let d=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((n=d?.shadowRoot)===null||n===void 0)&&n.fullscreenElement;)d=d.shadowRoot.fullscreenElement;d===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,b&&b.container&&(b.container instanceof HTMLElement?this._container=b.container:a.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(b){return this._map=b,this._container||(this._container=this._map.getContainer()),this._controlContainer=O.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){O.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const b=this._fullscreenButton=O.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);O.create("span","maplibregl-ctrl-icon",b).setAttribute("aria-hidden","true"),b.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const b=this._getTitle();this._fullscreenButton.setAttribute("aria-label",b),this._fullscreenButton.title=b}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new a.l("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new a.l("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},h.GeoJSONSource=bs,h.GeolocateControl=class extends a.E{constructor(b){super(),this._onSuccess=n=>{if(this._map){if(this._isOutOfMapMaxBounds(n))return this._setErrorState(),this.fire(new a.l("outofmaxbounds",n)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=n,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(n),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(n),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new a.l("geolocate",n)),this._finish()}},this._updateCamera=n=>{const d=new a.S(n.coords.longitude,n.coords.latitude),m=n.coords.accuracy,y=this._map.getBearing(),x=a.e({bearing:y},this.options.fitBoundsOptions),S=qr.fromLngLat(d,m);this._map.fitBounds(S,x,{geolocateSource:!0})},this._updateMarker=n=>{if(n){const d=new a.S(n.coords.longitude,n.coords.latitude);this._accuracyCircleMarker.setLngLat(d).addTo(this._map),this._userLocationDotMarker.setLngLat(d).addTo(this._map),this._accuracy=n.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=n=>{if(this._map){if(n.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const d=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=d,this._geolocateButton.setAttribute("aria-label",d),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(n.code===3&&Ms)return;this.options.trackUserLocation&&this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new a.l("error",n)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",(n=>n.preventDefault())),this._geolocateButton=O.create("button","maplibregl-ctrl-geolocate",this._container),O.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=n=>{if(this._map){if(n===!1){a.w("Geolocation support is not available so the GeolocateControl will be disabled.");const d=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=d,this._geolocateButton.setAttribute("aria-label",d)}else{const d=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=d,this._geolocateButton.setAttribute("aria-label",d)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=O.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new ul({element:this._dotElement}),this._circleElement=O.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new ul({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",(()=>this.trigger())),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(d=>{const m=d?.[0]instanceof ResizeObserverEntry;d.geolocateSource||this._watchState!=="ACTIVE_LOCK"||m||this._map.isZooming()||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new a.l("trackuserlocationend")),this.fire(new a.l("userlocationlostfocus")))}))}},this.options=a.e({},Mh,b)}onAdd(b){return this._map=b,this._container=O.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),(function(){return a._(this,arguments,void 0,(function*(n=!1){if(Zr!==void 0&&!n)return Zr;if(window.navigator.permissions===void 0)return Zr=!!window.navigator.geolocation,Zr;try{Zr=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{Zr=!!window.navigator.geolocation}return Zr}))})().then((n=>this._finishSetupUI(n))),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),O.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Cs=0,Ms=!1}_isOutOfMapMaxBounds(b){const n=this._map.getMaxBounds(),d=b.coords;return n&&(d.longitude<n.getWest()||d.longitude>n.getEast()||d.latitude<n.getSouth()||d.latitude>n.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const b=this._map.getBounds(),n=b.getSouthEast(),d=b.getNorthEast(),m=n.distanceTo(d),y=Math.ceil(this._accuracy/(m/this._map._container.clientHeight)*2);this._circleElement.style.width=`${y}px`,this._circleElement.style.height=`${y}px`}trigger(){if(!this._setup)return a.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new a.l("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Cs--,Ms=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new a.l("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new a.l("trackuserlocationstart")),this.fire(new a.l("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let b;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Cs++,Cs>1?(b={maximumAge:6e5,timeout:0},Ms=!0):(b=this.options.positionOptions,Ms=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,b)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},h.GlobeControl=class{constructor(){this._toggleProjection=()=>{var b;const n=(b=this._map.getProjection())===null||b===void 0?void 0:b.type;this._map.setProjection(n!=="mercator"&&n?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var b;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),((b=this._map.getProjection())===null||b===void 0?void 0:b.type)==="globe"?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(b){return this._map=b,this._container=O.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=O.create("button","maplibregl-ctrl-globe",this._container),O.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){O.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},h.Hash=wh,h.ImageSource=Yn,h.KeyboardHandler=Fc,h.LngLatBounds=qr,h.LogoControl=Kd,h.Map=class extends zc{constructor(b){var n,d;a.cw.mark(a.cx.create);const m=Object.assign(Object.assign(Object.assign({},Ln),b),{canvasContextAttributes:Object.assign(Object.assign({},Ln.canvasContextAttributes),b.canvasContextAttributes)});if(m.minZoom!=null&&m.maxZoom!=null&&m.minZoom>m.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(m.minPitch!=null&&m.maxPitch!=null&&m.minPitch>m.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(m.minPitch!=null&&m.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(m.maxPitch!=null&&m.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");const y=new oi,x=new In;if(m.minZoom!==void 0&&y.setMinZoom(m.minZoom),m.maxZoom!==void 0&&y.setMaxZoom(m.maxZoom),m.minPitch!==void 0&&y.setMinPitch(m.minPitch),m.maxPitch!==void 0&&y.setMaxPitch(m.maxPitch),m.renderWorldCopies!==void 0&&y.setRenderWorldCopies(m.renderWorldCopies),super(y,x,{bearingSnap:m.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new os,this._controls=[],this._mapId=a.a7(),this._contextLost=I=>{I.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new a.l("webglcontextlost",{originalEvent:I}))},this._contextRestored=I=>{this._setupPainter(),this.resize(),this._update(),this.fire(new a.l("webglcontextrestored",{originalEvent:I}))},this._onMapScroll=I=>{if(I.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=m.interactive,this._maxTileCacheSize=m.maxTileCacheSize,this._maxTileCacheZoomLevels=m.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},m.canvasContextAttributes),this._trackResize=m.trackResize===!0,this._bearingSnap=m.bearingSnap,this._centerClampedToGround=m.centerClampedToGround,this._refreshExpiredTiles=m.refreshExpiredTiles===!0,this._fadeDuration=m.fadeDuration,this._crossSourceCollisions=m.crossSourceCollisions===!0,this._collectResourceTiming=m.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},Bn),m.locale),this._clickTolerance=m.clickTolerance,this._overridePixelRatio=m.pixelRatio,this._maxCanvasSize=m.maxCanvasSize,this.transformCameraUpdate=m.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=m.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=we.addThrottleControl((()=>this.isMoving())),this._requestManager=new De(m.transformRequest),typeof m.container=="string"){if(this._container=document.getElementById(m.container),!this._container)throw new Error(`Container '${m.container}' not found.`)}else{if(!(m.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=m.container}if(m.maxBounds&&this.setMaxBounds(m.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),this.on("terrain",(()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)})),this.once("idle",(()=>{this._idleTriggered=!0})),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let I=!1;const B=wa((F=>{this._trackResize&&!this._removed&&(this.resize(F),this.redraw())}),50);this._resizeObserver=new ResizeObserver((F=>{I?B(F):I=!0})),this._resizeObserver.observe(this._container)}this.handlers=new Xd(this,m),this._hash=m.hash&&new wh(typeof m.hash=="string"&&m.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:m.center,elevation:m.elevation,zoom:m.zoom,bearing:m.bearing,pitch:m.pitch,roll:m.roll}),m.bounds&&(this.resize(),this.fitBounds(m.bounds,a.e({},m.fitBoundsOptions,{duration:0}))));const S=typeof m.style=="string"||((d=(n=m.style)===null||n===void 0?void 0:n.projection)===null||d===void 0?void 0:d.type)!=="globe";this.resize(null,S),this._localIdeographFontFamily=m.localIdeographFontFamily,this._validateStyle=m.validateStyle,m.style&&this.setStyle(m.style,{localIdeographFontFamily:m.localIdeographFontFamily}),m.attributionControl&&this.addControl(new Sh(typeof m.attributionControl=="boolean"?void 0:m.attributionControl)),m.maplibreLogo&&this.addControl(new Kd,m.logoPosition),this.on("style.load",(()=>{if(S||this._resizeTransform(),this.transform.unmodified){const I=a.Q(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(I)}})),this.on("data",(I=>{this._update(I.dataType==="style"),this.fire(new a.l(`${I.dataType}data`,I))})),this.on("dataloading",(I=>{this.fire(new a.l(`${I.dataType}dataloading`,I))})),this.on("dataabort",(I=>{this.fire(new a.l("sourcedataabort",I))}))}_getMapId(){return this._mapId}setGlobalStateProperty(b,n){return this.style.setGlobalStateProperty(b,n),this._update(!0)}getGlobalState(){return this.style.getGlobalState()}addControl(b,n){if(n===void 0&&(n=b.getDefaultPosition?b.getDefaultPosition():"top-right"),!b||!b.onAdd)return this.fire(new a.k(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const d=b.onAdd(this);this._controls.push(b);const m=this._controlPositions[n];return n.indexOf("bottom")!==-1?m.insertBefore(d,m.firstChild):m.appendChild(d),this}removeControl(b){if(!b||!b.onRemove)return this.fire(new a.k(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const n=this._controls.indexOf(b);return n>-1&&this._controls.splice(n,1),b.onRemove(this),this}hasControl(b){return this._controls.indexOf(b)>-1}calculateCameraOptionsFromTo(b,n,d,m){return m==null&&this.terrain&&(m=this.terrain.getElevationForLngLatZoom(d,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(b,n,d,m)}resize(b,n=!0){const[d,m]=this._containerDimensions(),y=this._getClampedPixelRatio(d,m);if(this._resizeCanvas(d,m,y),this.painter.resize(d,m,y),this.painter.overLimit()){const S=this.painter.context.gl;this._maxCanvasSize=[S.drawingBufferWidth,S.drawingBufferHeight];const I=this._getClampedPixelRatio(d,m);this._resizeCanvas(d,m,I),this.painter.resize(d,m,I)}this._resizeTransform(n);const x=!this._moving;return x&&(this.stop(),this.fire(new a.l("movestart",b)).fire(new a.l("move",b))),this.fire(new a.l("resize",b)),x&&this.fire(new a.l("moveend",b)),this}_resizeTransform(b=!0){var n;const[d,m]=this._containerDimensions();this.transform.resize(d,m,b),(n=this._requestedCameraState)===null||n===void 0||n.resize(d,m,b)}_getClampedPixelRatio(b,n){const{0:d,1:m}=this._maxCanvasSize,y=this.getPixelRatio(),x=b*y,S=n*y;return Math.min(x>d?d/x:1,S>m?m/S:1)*y}getPixelRatio(){var b;return(b=this._overridePixelRatio)!==null&&b!==void 0?b:devicePixelRatio}setPixelRatio(b){this._overridePixelRatio=b,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(b){return this.transform.setMaxBounds(qr.convert(b)),this._update()}setMinZoom(b){if((b=b??-2)>=-2&&b<=this.transform.maxZoom)return this.transform.setMinZoom(b),this._update(),this.getZoom()<b&&this.setZoom(b),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(b){if((b=b??22)>=this.transform.minZoom)return this.transform.setMaxZoom(b),this._update(),this.getZoom()>b&&this.setZoom(b),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(b){if((b=b??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(b>=0&&b<=this.transform.maxPitch)return this.transform.setMinPitch(b),this._update(),this.getPitch()<b&&this.setPitch(b),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(b){if((b=b??60)>180)throw new Error("maxPitch must be less than or equal to 180");if(b>=this.transform.minPitch)return this.transform.setMaxPitch(b),this._update(),this.getPitch()>b&&this.setPitch(b),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(b){return this.transform.setRenderWorldCopies(b),this._update()}project(b){return this.transform.locationToScreenPoint(a.S.convert(b),this.style&&this.terrain)}unproject(b){return this.transform.screenPointToLocation(a.P.convert(b),this.terrain)}isMoving(){var b;return this._moving||((b=this.handlers)===null||b===void 0?void 0:b.isMoving())}isZooming(){var b;return this._zooming||((b=this.handlers)===null||b===void 0?void 0:b.isZooming())}isRotating(){var b;return this._rotating||((b=this.handlers)===null||b===void 0?void 0:b.isRotating())}_createDelegatedListener(b,n,d){if(b==="mouseenter"||b==="mouseover"){let m=!1;return{layers:n,listener:d,delegates:{mousemove:y=>{const x=n.filter((I=>this.getLayer(I))),S=x.length!==0?this.queryRenderedFeatures(y.point,{layers:x}):[];S.length?m||(m=!0,d.call(this,new Br(b,this,y.originalEvent,{features:S}))):m=!1},mouseout:()=>{m=!1}}}}if(b==="mouseleave"||b==="mouseout"){let m=!1;return{layers:n,listener:d,delegates:{mousemove:y=>{const x=n.filter((S=>this.getLayer(S)));(x.length!==0?this.queryRenderedFeatures(y.point,{layers:x}):[]).length?m=!0:m&&(m=!1,d.call(this,new Br(b,this,y.originalEvent)))},mouseout:y=>{m&&(m=!1,d.call(this,new Br(b,this,y.originalEvent)))}}}}{const m=y=>{const x=n.filter((I=>this.getLayer(I))),S=x.length!==0?this.queryRenderedFeatures(y.point,{layers:x}):[];S.length&&(y.features=S,d.call(this,y),delete y.features)};return{layers:n,listener:d,delegates:{[b]:m}}}}_saveDelegatedListener(b,n){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[b]=this._delegatedListeners[b]||[],this._delegatedListeners[b].push(n)}_removeDelegatedListener(b,n,d){if(!this._delegatedListeners||!this._delegatedListeners[b])return;const m=this._delegatedListeners[b];for(let y=0;y<m.length;y++){const x=m[y];if(x.listener===d&&x.layers.length===n.length&&x.layers.every((S=>n.includes(S)))){for(const S in x.delegates)this.off(S,x.delegates[S]);return void m.splice(y,1)}}}on(b,n,d){if(d===void 0)return super.on(b,n);const m=typeof n=="string"?[n]:n,y=this._createDelegatedListener(b,m,d);this._saveDelegatedListener(b,y);for(const x in y.delegates)this.on(x,y.delegates[x]);return{unsubscribe:()=>{this._removeDelegatedListener(b,m,d)}}}once(b,n,d){if(d===void 0)return super.once(b,n);const m=typeof n=="string"?[n]:n,y=this._createDelegatedListener(b,m,d);for(const x in y.delegates){const S=y.delegates[x];y.delegates[x]=(...I)=>{this._removeDelegatedListener(b,m,d),S(...I)}}this._saveDelegatedListener(b,y);for(const x in y.delegates)this.once(x,y.delegates[x]);return this}off(b,n,d){return d===void 0?super.off(b,n):(this._removeDelegatedListener(b,typeof n=="string"?[n]:n,d),this)}queryRenderedFeatures(b,n){if(!this.style)return[];let d;const m=b instanceof a.P||Array.isArray(b),y=m?b:[[0,0],[this.transform.width,this.transform.height]];if(n=n||(m?{}:b)||{},y instanceof a.P||typeof y[0]=="number")d=[a.P.convert(y)];else{const x=a.P.convert(y[0]),S=a.P.convert(y[1]);d=[x,new a.P(S.x,x.y),S,new a.P(x.x,S.y),x]}return this.style.queryRenderedFeatures(d,n,this.transform)}querySourceFeatures(b,n){return this.style.querySourceFeatures(b,n)}setStyle(b,n){return(n=a.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},n)).diff!==!1&&n.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&b?(this._diffStyle(b,n),this):(this._localIdeographFontFamily=n.localIdeographFontFamily,this._updateStyle(b,n))}setTransformRequest(b){return this._requestManager.setTransformRequest(b),this}_getUIString(b){const n=this._locale[b];if(n==null)throw new Error(`Missing UI string '${b}'`);return n}_updateStyle(b,n){var d,m;if(n.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",(()=>this._updateStyle(b,n)));const y=this.style&&n.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!b)),b?(this.style=new Ed(this,n||{}),this.style.setEventedParent(this,{style:this.style}),typeof b=="string"?this.style.loadURL(b,n,y):this.style.loadJSON(b,n,y),this):((m=(d=this.style)===null||d===void 0?void 0:d.projection)===null||m===void 0||m.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Ed(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(b,n){if(typeof b=="string"){const d=this._requestManager.transformRequest(b,"Style");a.j(d,new AbortController).then((m=>{this._updateDiff(m.data,n)})).catch((m=>{m&&this.fire(new a.k(m))}))}else typeof b=="object"&&this._updateDiff(b,n)}_updateDiff(b,n){try{this.style.setState(b,n)&&this._update(!0)}catch(d){a.w(`Unable to perform style diff: ${d.message||d.error||d}.  Rebuilding the style from scratch.`),this._updateStyle(b,n)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():a.w("There is no style added to the map.")}addSource(b,n){return this._lazyInitEmptyStyle(),this.style.addSource(b,n),this._update(!0)}isSourceLoaded(b){const n=this.style&&this.style.sourceCaches[b];if(n!==void 0)return n.loaded();this.fire(new a.k(new Error(`There is no source with ID '${b}'`)))}setTerrain(b){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),b){const n=this.style.sourceCaches[b.source];if(!n)throw new Error(`cannot load terrain, because there exists no source with ID: ${b.source}`);this.terrain===null&&n.reload();for(const d in this.style._layers){const m=this.style._layers[d];m.type==="hillshade"&&m.source===b.source&&a.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality."),m.type==="color-relief"&&m.source===b.source&&a.w("You are using the same source for a color-relief layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new tr(this.painter,n,b),this.painter.renderToTexture=new jc(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=d=>{var m;d.dataType==="style"?this.terrain.sourceCache.freeRtt():d.dataType==="source"&&d.tile&&(d.sourceId!==b.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),((m=d.source)===null||m===void 0?void 0:m.type)==="image"?this.terrain.sourceCache.freeRtt():this.terrain.sourceCache.freeRtt(d.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new a.l("terrain",{terrain:b})),this}getTerrain(){var b,n;return(n=(b=this.terrain)===null||b===void 0?void 0:b.options)!==null&&n!==void 0?n:null}areTilesLoaded(){const b=this.style&&this.style.sourceCaches;for(const n in b){const d=b[n]._tiles;for(const m in d){const y=d[m];if(y.state!=="loaded"&&y.state!=="errored")return!1}}return!0}removeSource(b){return this.style.removeSource(b),this._update(!0)}getSource(b){return this.style.getSource(b)}setSourceTileLodParams(b,n,d){if(d){const m=this.getSource(d);if(!m)throw new Error(`There is no source with ID "${d}", cannot set LOD parameters`);m.calculateTileZoom=pt(Math.max(1,b),Math.max(1,n))}else for(const m in this.style.sourceCaches)this.style.sourceCaches[m].getSource().calculateTileZoom=pt(Math.max(1,b),Math.max(1,n));return this._update(!0),this}refreshTiles(b,n){const d=this.style.sourceCaches[b];if(!d)throw new Error(`There is no source cache with ID "${b}", cannot refresh tile`);n===void 0?d.reload(!0):d.refreshTiles(n.map((m=>new a.a4(m.z,m.x,m.y))))}addImage(b,n,d={}){const{pixelRatio:m=1,sdf:y=!1,stretchX:x,stretchY:S,content:I,textFitWidth:B,textFitHeight:F}=d;if(this._lazyInitEmptyStyle(),!(n instanceof HTMLImageElement||a.b(n))){if(n.width===void 0||n.height===void 0)return this.fire(new a.k(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:U,height:W,data:G}=n,q=n;return this.style.addImage(b,{data:new a.R({width:U,height:W},new Uint8Array(G)),pixelRatio:m,stretchX:x,stretchY:S,content:I,textFitWidth:B,textFitHeight:F,sdf:y,version:0,userImage:q}),q.onAdd&&q.onAdd(this,b),this}}{const{width:U,height:W,data:G}=L.getImageData(n);this.style.addImage(b,{data:new a.R({width:U,height:W},G),pixelRatio:m,stretchX:x,stretchY:S,content:I,textFitWidth:B,textFitHeight:F,sdf:y,version:0})}}updateImage(b,n){const d=this.style.getImage(b);if(!d)return this.fire(new a.k(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const m=n instanceof HTMLImageElement||a.b(n)?L.getImageData(n):n,{width:y,height:x,data:S}=m;if(y===void 0||x===void 0)return this.fire(new a.k(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(y!==d.data.width||x!==d.data.height)return this.fire(new a.k(new Error("The width and height of the updated image must be that same as the previous version of the image")));const I=!(n instanceof HTMLImageElement||a.b(n));return d.data.replace(S,I),this.style.updateImage(b,d),this}getImage(b){return this.style.getImage(b)}hasImage(b){return b?!!this.style.getImage(b):(this.fire(new a.k(new Error("Missing required image id"))),!1)}removeImage(b){this.style.removeImage(b)}loadImage(b){return we.getImage(this._requestManager.transformRequest(b,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(b,n){return this._lazyInitEmptyStyle(),this.style.addLayer(b,n),this._update(!0)}moveLayer(b,n){return this.style.moveLayer(b,n),this._update(!0)}removeLayer(b){return this.style.removeLayer(b),this._update(!0)}getLayer(b){return this.style.getLayer(b)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(b,n,d){return this.style.setLayerZoomRange(b,n,d),this._update(!0)}setFilter(b,n,d={}){return this.style.setFilter(b,n,d),this._update(!0)}getFilter(b){return this.style.getFilter(b)}setPaintProperty(b,n,d,m={}){return this.style.setPaintProperty(b,n,d,m),this._update(!0)}getPaintProperty(b,n){return this.style.getPaintProperty(b,n)}setLayoutProperty(b,n,d,m={}){return this.style.setLayoutProperty(b,n,d,m),this._update(!0)}getLayoutProperty(b,n){return this.style.getLayoutProperty(b,n)}setGlyphs(b,n={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(b,n),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(b,n,d={}){return this._lazyInitEmptyStyle(),this.style.addSprite(b,n,d,(m=>{m||this._update(!0)})),this}removeSprite(b){return this._lazyInitEmptyStyle(),this.style.removeSprite(b),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(b,n={}){return this._lazyInitEmptyStyle(),this.style.setSprite(b,n,(d=>{d||this._update(!0)})),this}setLight(b,n={}){return this._lazyInitEmptyStyle(),this.style.setLight(b,n),this._update(!0)}getLight(){return this.style.getLight()}setSky(b,n={}){return this._lazyInitEmptyStyle(),this.style.setSky(b,n),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(b,n){return this.style.setFeatureState(b,n),this._update()}removeFeatureState(b,n){return this.style.removeFeatureState(b,n),this._update()}getFeatureState(b){return this.style.getFeatureState(b)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let b=0,n=0;return this._container&&(b=this._container.clientWidth||400,n=this._container.clientHeight||300),[b,n]}_setupContainer(){const b=this._container;b.classList.add("maplibregl-map");const n=this._canvasContainer=O.create("div","maplibregl-canvas-container",b);this._interactive&&n.classList.add("maplibregl-interactive"),this._canvas=O.create("canvas","maplibregl-canvas",n),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const d=this._containerDimensions(),m=this._getClampedPixelRatio(d[0],d[1]);this._resizeCanvas(d[0],d[1],m);const y=this._controlContainer=O.create("div","maplibregl-control-container",b),x=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((S=>{x[S]=O.create("div",`maplibregl-ctrl-${S} `,y)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(b,n,d){this._canvas.width=Math.floor(d*b),this._canvas.height=Math.floor(d*n),this._canvas.style.width=`${b}px`,this._canvas.style.height=`${n}px`}_setupPainter(){const b=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0});let n=null;this._canvas.addEventListener("webglcontextcreationerror",(m=>{n={requestedAttributes:b},m&&(n.statusMessage=m.statusMessage,n.type=m.type)}),{once:!0});let d=null;if(d=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,b):this._canvas.getContext("webgl2",b)||this._canvas.getContext("webgl",b),!d){const m="Failed to initialize WebGL";throw n?(n.message=m,new Error(JSON.stringify(n))):new Error(m)}this.painter=new Zo(d,this.transform),K.testSupport(d)}migrateProjection(b,n){super.migrateProjection(b,n),this.painter.transform=b,this.fire(new a.l("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(b){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||b,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(b){return this._update(),this._renderTaskQueue.add(b)}_cancelRenderFrame(b){this._renderTaskQueue.remove(b)}_render(b){var n,d,m,y,x;const S=this._idleTriggered?this._fadeDuration:0,I=((n=this.style.projection)===null||n===void 0?void 0:n.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(b),this._removed)return;let B=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const W=this.transform.zoom,G=L.now();this.style.zoomHistory.update(W,G);const q=new a.F(W,{now:G,fadeDuration:S,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition(),globalState:this.style.getGlobalState()}),J=q.crossFadingFactor();J===1&&J===this._crossFadingFactor||(B=!0,this._crossFadingFactor=J),this.style.update(q)}const F=((d=this.style.projection)===null||d===void 0?void 0:d.transitionState)>0!==I;(m=this.style.projection)===null||m===void 0||m.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState((y=this.style.projection)===null||y===void 0?void 0:y.transitionState,(x=this.style.projection)===null||x===void 0?void 0:x.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||F)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,S,this._crossSourceCollisions,F),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:S,showPadding:this.showPadding}),this.fire(new a.l("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,a.cw.mark(a.cx.load),this.fire(new a.l("load"))),this.style&&(this.style.hasTransitions()||B)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const U=this._sourcesDirty||this._styleDirty||this._placementDirty;return U||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new a.l("idle")),!this._loaded||this._fullyLoaded||U||(this._fullyLoaded=!0,a.cw.mark(a.cx.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var b;this._hash&&this._hash.remove();for(const d of this._controls)d.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),we.removeThrottleControl(this._imageQueueHandle),(b=this._resizeObserver)===null||b===void 0||b.disconnect();const n=this.painter.context.gl.getExtension("WEBGL_lose_context");n?.loseContext&&n.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),O.remove(this._canvasContainer),O.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),a.cw.clearMetrics(),this._removed=!0,this.fire(new a.l("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,L.frame(this._frameRequest,(b=>{a.cw.frame(b),this._frameRequest=null;try{this._render(b)}catch(n){if(!a.cy(n)&&!(function(d){return d.message===Su})(n))throw n}}),(()=>{})))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(b){this._showTileBoundaries!==b&&(this._showTileBoundaries=b,this._update())}get showPadding(){return!!this._showPadding}set showPadding(b){this._showPadding!==b&&(this._showPadding=b,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(b){this._showCollisionBoxes!==b&&(this._showCollisionBoxes=b,b?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(b){this._showOverdrawInspector!==b&&(this._showOverdrawInspector=b,this._update())}get repaint(){return!!this._repaint}set repaint(b){this._repaint!==b&&(this._repaint=b,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(b){this._vertices=b,this._update()}get version(){return Ch}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(b){return this._lazyInitEmptyStyle(),this.style.setProjection(b),this._update(!0)}},h.MapMouseEvent=Br,h.MapTouchEvent=js,h.MapWheelEvent=wn,h.Marker=ul,h.NavigationControl=class{constructor(b){this._updateZoomButtons=()=>{const n=this._map.getZoom(),d=n===this._map.getMaxZoom(),m=n===this._map.getMinZoom();this._zoomInButton.disabled=d,this._zoomOutButton.disabled=m,this._zoomInButton.setAttribute("aria-disabled",d.toString()),this._zoomOutButton.setAttribute("aria-disabled",m.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(n,d)=>{const m=this._map._getUIString(`NavigationControl.${d}`);n.title=m,n.setAttribute("aria-label",m)},this.options=a.e({},no,b),this._container=O.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",(n=>n.preventDefault())),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",(n=>this._map.zoomIn({},{originalEvent:n}))),O.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",(n=>this._map.zoomOut({},{originalEvent:n}))),O.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",(n=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:n}):this._map.resetNorth({},{originalEvent:n})})),this._compassIcon=O.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(b){return this._map=b,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Bo(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){O.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(b,n){const d=O.create("button",b,this._container);return d.type="button",d.addEventListener("click",n),d}},h.Popup=class extends a.E{constructor(b){super(),this._updateOpacity=()=>{this.options.locationOccludedOpacity!==void 0&&(this._container.style.opacity=this._map.transform.isLocationOccluded(this.getLngLat())?`${this.options.locationOccludedOpacity}`:"")},this.remove=()=>(this._content&&O.remove(this._content),this._container&&(O.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new a.l("close"))),this),this._onMouseUp=n=>{this._update(n.point)},this._onMouseMove=n=>{this._update(n.point)},this._onDrag=n=>{this._update(n.point)},this._update=n=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=O.create("div","maplibregl-popup",this._map.getContainer()),this._tip=O.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const S of this.options.className.split(" "))this._container.classList.add(S);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=Pi(this._lngLat,this._flatPos,this._map.transform,this._trackPointer),this._trackPointer&&!n)return;const d=this._flatPos=this._pos=this._trackPointer&&n?n:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&n?n:this._map.transform.locationToScreenPoint(this._lngLat));let m=this.options.anchor;const y=Ws(this.options.offset);if(!m){const S=this._container.offsetWidth,I=this._container.offsetHeight;let B;B=d.y+y.bottom.y<I?["top"]:d.y>this._map.transform.height-I?["bottom"]:[],d.x<S/2?B.push("left"):d.x>this._map.transform.width-S/2&&B.push("right"),m=B.length===0?"bottom":B.join("-")}let x=d.add(y[m]);this.options.subpixelPositioning||(x=x.round()),O.setTransform(this._container,`${so[m]} translate(${x.x}px,${x.y}px)`),Hs(this._container,m,"popup"),this._updateOpacity()},this._onClose=()=>{this.remove()},this.options=a.e(Object.create(Ph),b)}addTo(b){return this._map&&this.remove(),this._map=b,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new a.l("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(b){return this._lngLat=a.S.convert(b),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(b){return this.setDOMContent(document.createTextNode(b))}setHTML(b){const n=document.createDocumentFragment(),d=document.createElement("body");let m;for(d.innerHTML=b;m=d.firstChild,m;)n.appendChild(m);return this.setDOMContent(n)}getMaxWidth(){var b;return(b=this._container)===null||b===void 0?void 0:b.style.maxWidth}setMaxWidth(b){return this.options.maxWidth=b,this._update(),this}setDOMContent(b){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=O.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(b),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(b){return this._container&&this._container.classList.add(b),this}removeClassName(b){return this._container&&this._container.classList.remove(b),this}setOffset(b){return this.options.offset=b,this._update(),this}toggleClassName(b){if(this._container)return this._container.classList.toggle(b)}setSubpixelPositioning(b){this.options.subpixelPositioning=b}_createCloseButton(){this.options.closeButton&&(this._closeButton=O.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const b=this._container.querySelector(Ul);b&&b.focus()}},h.RasterDEMTileSource=Mn,h.RasterTileSource=Li,h.ScaleControl=class{constructor(b){this._onMove=()=>{Nu(this._map,this._container,this.options)},this.setUnit=n=>{this.options.unit=n,Nu(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},hl),b)}getDefaultPosition(){return"bottom-left"}onAdd(b){return this._map=b,this._container=O.create("div","maplibregl-ctrl maplibregl-ctrl-scale",b.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){O.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},h.ScrollZoomHandler=vi,h.Style=Ed,h.TerrainControl=class{constructor(b){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=b}onAdd(b){return this._map=b,this._container=O.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=O.create("button","maplibregl-ctrl-terrain",this._container),O.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){O.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},h.TwoFingersTouchPitchHandler=Yo,h.TwoFingersTouchRotateHandler=Ss,h.TwoFingersTouchZoomHandler=ns,h.TwoFingersTouchZoomRotateHandler=Zd,h.VectorTileSource=vn,h.VideoSource=Jn,h.addSourceType=(b,n)=>a._(void 0,void 0,void 0,(function*(){if(_o(b))throw new Error(`A source type called "${b}" already exists.`);((d,m)=>{Js[d]=m})(b,n)})),h.clearPrewarmedResources=function(){const b=Gt;b&&(b.isPreloaded()&&b.numActive()===1?(b.release(Bt),Gt=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},h.createTileMesh=_c,h.getMaxParallelImageRequests=function(){return a.a.MAX_PARALLEL_IMAGE_REQUESTS},h.getRTLTextPluginStatus=function(){return Ds().getRTLTextPluginStatus()},h.getVersion=function(){return jl},h.getWorkerCount=function(){return Ue.workerCount},h.getWorkerUrl=function(){return a.a.WORKER_URL},h.importScriptInWorkers=function(b){return Ht().broadcast("IS",b)},h.prewarm=function(){Tr().acquire(Bt)},h.setMaxParallelImageRequests=function(b){a.a.MAX_PARALLEL_IMAGE_REQUESTS=b},h.setRTLTextPlugin=function(b,n){return Ds().setRTLTextPlugin(b,n)},h.setWorkerCount=function(b){Ue.workerCount=b},h.setWorkerUrl=function(b){a.a.WORKER_URL=b}}));var l=r;return l}))})(vx)),vx.exports}var Yi=L7();const D7=FI(Yi),zy=OI({__proto__:null,default:D7},[Yi]),N7="https://api.olamaps.io/tiles/vector/v1/styles/default-light-standard/style.json?key=0.4.0",O7="https://api.olamaps.io/tiles/vector/v1/3dtiles/tileset.json",F7=t=>`<svg width="108" height="18" viewBox="0 0 108 18" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M31.0629 8.9393L34.6986 15.7293H38.2743L31.0629 2.2793L23.8516 15.7293H27.4273L31.0629 8.9393Z" fill="${t}"/><path d="M19.2265 12.5798L19.2365 2.25977H16.0703V15.7298H22.163L23.851 12.5798H19.2265Z" fill="${t}"/><path d="M7.22135 1.7793C5.79466 1.77733 4.39943 2.19909 3.21222 2.99123C2.025 3.78337 1.09915 4.91029 0.551806 6.22939C0.00446369 7.5485 -0.139771 9.00051 0.137352 10.4017C0.414475 11.8029 1.1005 13.0903 2.10863 14.1011C3.11676 15.1118 4.40168 15.8004 5.80082 16.0798C7.19996 16.3592 8.65043 16.2168 9.96872 15.6707C11.287 15.1245 12.4139 14.1991 13.2067 13.0116C13.9995 11.824 14.4227 10.4277 14.4227 8.9993C14.4227 7.08617 13.6643 5.25125 12.3141 3.89753C10.9639 2.5438 9.13219 1.78195 7.22135 1.7793ZM7.22135 12.8893C6.45207 12.8933 5.69892 12.6685 5.05735 12.2435C4.41579 11.8184 3.91469 11.2123 3.61755 10.5019C3.32041 9.79141 3.24061 9.00864 3.38827 8.25274C3.53592 7.49684 3.90438 6.80184 4.44695 6.25581C4.98952 5.70978 5.68178 5.3373 6.43601 5.18558C7.19023 5.03385 7.97246 5.10971 8.68358 5.40354C9.3947 5.69737 10.0027 6.19594 10.4305 6.83607C10.8583 7.4762 11.0867 8.22908 11.0867 8.9993C11.0867 9.51015 10.9862 10.016 10.791 10.4879C10.5957 10.9599 10.3095 11.3887 9.94873 11.7499C9.58794 12.1112 9.15963 12.3977 8.68823 12.5932C8.21684 12.7887 7.71161 12.8893 7.20138 12.8893H7.22135Z" fill="${t}"/><path d="M55.5634 4.82953V4.33953L50.4296 15.7295H49.4308L44.3768 4.33953V4.82953L43.9773 15.7295H42.9785L43.438 2.26953H44.5766L49.7104 13.8095C49.8003 14.0495 49.9102 14.2895 49.9801 14.5095C50.0543 14.2675 50.1513 14.0332 50.2698 13.8095L55.3437 2.26953H56.4723L56.9318 15.7295H55.933L55.5634 4.82953Z" fill="${t}"/><path d="M60.3287 15.7495H59.25L65.2428 2.26953H66.5513L72.5441 15.7495H71.4254L69.6875 11.8395H62.0666L60.3287 15.7495ZM66.4614 4.54953C66.2216 3.96953 66.0019 3.41953 65.8621 3.01953C65.7322 3.41953 65.5125 4.01953 65.2928 4.54953L62.4462 10.9095H69.288L66.4614 4.54953Z" fill="${t}"/><path d="M79.1611 2.14062C82.6669 2.14062 84.4048 3.62063 84.4048 6.62063C84.4048 9.62063 82.6669 11.0706 79.211 11.0706H75.9949V15.5906H74.9961V2.14062H79.1611ZM79.1611 10.1406C82.0077 10.1406 83.436 8.97062 83.416 6.61062C83.396 4.25062 82.0077 3.06062 79.1411 3.06062H75.9949V10.1406H79.1611Z" fill="${t}"/><path d="M95.1406 3.9293C93.7557 3.25763 92.2346 2.91539 90.6959 2.9293C88.8481 2.9293 87.6995 4.0193 87.6995 5.2293C87.6995 6.8693 88.5984 7.3593 91.6248 8.3693C94.6511 9.3793 95.9995 10.3693 95.9995 12.3693C95.9995 14.9993 93.942 15.9293 91.6947 15.9293C89.6115 15.9429 87.5948 15.1964 86.0215 13.8293L86.5009 13.0693C87.9375 14.3316 89.7833 15.0282 91.6947 15.0293C93.902 15.0293 95.0007 14.1193 95.0007 12.4893C95.0007 10.8593 94.1617 10.2093 90.9356 9.1293C88.069 8.1793 86.7007 7.5993 86.7007 5.2793C86.7007 3.3993 88.2488 2.0293 90.6959 2.0293C92.3497 2.03153 93.9817 2.40754 95.4702 3.1293L95.1406 3.9293Z" fill="${t}"/></svg>`;async function B_(t,e,r,i){return i._parse(t,e,r,i)}function ki(t,e){if(!t)throw new Error(e||"loader assertion failed.")}const y1=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),Q3=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);Q3&&parseFloat(Q3[1]);const eT=globalThis,tT=globalThis.process||{},z7=globalThis.navigator||{};function UI(t){if(typeof window<"u"&&window.process?.type==="renderer"||typeof process<"u"&&process.versions?.electron)return!0;const e=typeof navigator<"u"&&navigator.userAgent;return!!(e&&e.indexOf("Electron")>=0)}function _d(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process?.browser)||UI()}function U7(t){return _d()?UI()?"Electron":(z7.userAgent||"").indexOf("Edge")>-1?"Edge":globalThis.chrome?"Chrome":globalThis.safari?"Safari":globalThis.mozInnerScreenX?"Firefox":"Unknown":"Node"}const jI="4.0.7";function j7(t){try{const e=window[t],r="__storage_test__";return e.setItem(r,r),e.removeItem(r),e}catch{return null}}class V7{constructor(e,r,i="sessionStorage"){this.storage=j7(i),this.id=e,this.config=r,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const r=JSON.stringify(this.config);this.storage.setItem(this.id,r)}}_loadConfiguration(){let e={};if(this.storage){const r=this.storage.getItem(this.id);e=r?JSON.parse(r):{}}return Object.assign(this.config,e),this}}function G7(t){let e;return t<10?e=`${t.toFixed(2)}ms`:t<100?e=`${t.toFixed(1)}ms`:t<1e3?e=`${t.toFixed(0)}ms`:e=`${(t/1e3).toFixed(2)}s`,e}function H7(t,e=8){const r=Math.max(e-t.length,0);return`${" ".repeat(r)}${t}`}var z0;(function(t){t[t.BLACK=30]="BLACK",t[t.RED=31]="RED",t[t.GREEN=32]="GREEN",t[t.YELLOW=33]="YELLOW",t[t.BLUE=34]="BLUE",t[t.MAGENTA=35]="MAGENTA",t[t.CYAN=36]="CYAN",t[t.WHITE=37]="WHITE",t[t.BRIGHT_BLACK=90]="BRIGHT_BLACK",t[t.BRIGHT_RED=91]="BRIGHT_RED",t[t.BRIGHT_GREEN=92]="BRIGHT_GREEN",t[t.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",t[t.BRIGHT_BLUE=94]="BRIGHT_BLUE",t[t.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",t[t.BRIGHT_CYAN=96]="BRIGHT_CYAN",t[t.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(z0||(z0={}));const W7=10;function rT(t){return typeof t!="string"?t:(t=t.toUpperCase(),z0[t]||z0.WHITE)}function q7(t,e,r){return!_d&&typeof t=="string"&&(e&&(t=`\x1B[${rT(e)}m${t}\x1B[39m`),r&&(t=`\x1B[${rT(r)+W7}m${t}\x1B[49m`)),t}function $7(t,e=["constructor"]){const r=Object.getPrototypeOf(t),i=Object.getOwnPropertyNames(r),s=t;for(const l of i){const h=s[l];typeof h=="function"&&(e.find(a=>l===a)||(s[l]=h.bind(t)))}}function d2(t,e){if(!t)throw new Error("Assertion failed")}function Df(){let t;if(_d()&&eT.performance)t=eT?.performance?.now?.();else if("hrtime"in tT){const e=tT?.hrtime?.();t=e[0]*1e3+e[1]/1e6}else t=Date.now();return t}const Nf={debug:_d()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},Z7={enabled:!0,level:0};function Of(){}const iT={},nT={once:!0};class Dm{constructor({id:e}={id:""}){this.VERSION=jI,this._startTs=Df(),this._deltaTs=Df(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new V7(`__probe-${this.id}__`,Z7),this.timeStamp(`${this.id} started`),$7(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((Df()-this._startTs).toPrecision(10))}getDelta(){return Number((Df()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(e=!0){return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,r){this._storage.setConfiguration({[e]:r})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,r){if(!e)throw new Error(r||"Assertion failed")}warn(e){return this._getLogFunction(0,e,Nf.warn,arguments,nT)}error(e){return this._getLogFunction(0,e,Nf.error,arguments)}deprecated(e,r){return this.warn(`\`${e}\` is deprecated and will be removed in a later version. Use \`${r}\` instead`)}removed(e,r){return this.error(`\`${e}\` has been removed. Use \`${r}\` instead`)}probe(e,r){return this._getLogFunction(e,r,Nf.log,arguments,{time:!0,once:!0})}log(e,r){return this._getLogFunction(e,r,Nf.debug,arguments)}info(e,r){return this._getLogFunction(e,r,console.info,arguments)}once(e,r){return this._getLogFunction(e,r,Nf.debug||Nf.info,arguments,nT)}table(e,r,i){return r?this._getLogFunction(e,r,console.table||Of,i&&[i],{tag:K7(r)}):Of}time(e,r){return this._getLogFunction(e,r,console.time?console.time:console.info)}timeEnd(e,r){return this._getLogFunction(e,r,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,r){return this._getLogFunction(e,r,console.timeStamp||Of)}group(e,r,i={collapsed:!1}){const s=sT({logLevel:e,message:r,opts:i}),{collapsed:l}=i;return s.method=(l?console.groupCollapsed:console.group)||console.info,this._getLogFunction(s)}groupCollapsed(e,r,i={}){return this.group(e,r,Object.assign({},i,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||Of)}withGroup(e,r,i){this.group(e,r)();try{i()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=VI(e)}_getLogFunction(e,r,i,s,l){if(this._shouldLog(e)){l=sT({logLevel:e,message:r,args:s,opts:l}),i=i||l.method,d2(i),l.total=this.getTotal(),l.delta=this.getDelta(),this._deltaTs=Df();const h=l.tag||l.message;if(l.once&&h)if(!iT[h])iT[h]=Df();else return Of;return r=X7(this.id,l.message,l),i.bind(console,r,...l.args)}return Of}}Dm.VERSION=jI;function VI(t){if(!t)return 0;let e;switch(typeof t){case"number":e=t;break;case"object":e=t.logLevel||t.priority||0;break;default:return 0}return d2(Number.isFinite(e)&&e>=0),e}function sT(t){const{logLevel:e,message:r}=t;t.logLevel=VI(e);const i=t.args?Array.from(t.args):[];for(;i.length&&i.shift()!==r;);switch(typeof e){case"string":case"function":r!==void 0&&i.unshift(r),t.message=e;break;case"object":Object.assign(t,e);break}typeof t.message=="function"&&(t.message=t.message());const s=typeof t.message;return d2(s==="string"||s==="object"),Object.assign(t,{args:i},t.opts)}function X7(t,e,r){if(typeof e=="string"){const i=r.time?H7(G7(r.total)):"";e=r.time?`${t}: ${i}  ${e}`:`${t}: ${e}`,e=q7(e,r.color,r.background)}return e}function K7(t){for(const e in t)for(const r in t[e])return r||"untitled";return"empty"}globalThis.probe={};const GI=new Dm({id:"@probe.gl/log"}),jv="4.3.1",Y7=jv[0]>="0"&&jv[0]<="9"?`v${jv}`:"";function J7(){const t=new Dm({id:"loaders.gl"});return globalThis.loaders=globalThis.loaders||{},globalThis.loaders.log=t,globalThis.loaders.version=Y7,globalThis.probe=globalThis.probe||{},globalThis.probe.loaders=t,t}const Q7=J7();function eU(t,e){return HI(t||{},e)}function HI(t,e,r=0){if(r>3)return e;const i={...t};for(const[s,l]of Object.entries(e))l&&typeof l=="object"&&!Array.isArray(l)?i[s]=HI(i[s]||{},e[s],r+1):i[s]=e[s];return i}function tU(t){globalThis.loaders||={},globalThis.loaders.modules||={},Object.assign(globalThis.loaders.modules,t)}function rU(t){return globalThis.loaders?.modules?.[t]||null}const iU="latest";function nU(){return globalThis._loadersgl_?.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.3.1"),globalThis._loadersgl_.version}const WI=nU();function oh(t,e){if(!t)throw new Error(e||"loaders.gl assertion failed.")}const Tl=typeof process!="object"||String(process)!=="[object process]"||process.browser,p2=typeof importScripts=="function",sU=typeof window<"u"&&typeof window.orientation<"u",oT=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);oT&&parseFloat(oT[1]);class oU{name;workerThread;isRunning=!0;result;_resolve=()=>{};_reject=()=>{};constructor(e,r){this.name=e,this.workerThread=r,this.result=new Promise((i,s)=>{this._resolve=i,this._reject=s})}postMessage(e,r){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:r})}done(e){oh(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){oh(this.isRunning),this.isRunning=!1,this._reject(e)}}class Vv{terminate(){}}const Gv=new Map;function aU(t){oh(t.source&&!t.url||!t.source&&t.url);let e=Gv.get(t.source||t.url);return e||(t.url&&(e=lU(t.url),Gv.set(t.url,e)),t.source&&(e=qI(t.source),Gv.set(t.source,e))),oh(e),e}function lU(t){if(!t.startsWith("http"))return t;const e=cU(t);return qI(e)}function qI(t){const e=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(e)}function cU(t){return`try {
  importScripts('${t}');
} catch (error) {
  console.error(error);
  throw error;
}`}function $I(t,e=!0,r){const i=r||new Set;if(t){if(aT(t))i.add(t);else if(aT(t.buffer))i.add(t.buffer);else if(!ArrayBuffer.isView(t)&&e&&typeof t=="object")for(const s in t)$I(t[s],e,i)}return r===void 0?Array.from(i):[]}function aT(t){return t?t instanceof ArrayBuffer||typeof MessagePort<"u"&&t instanceof MessagePort||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas:!1}const Hv=()=>{};class bx{name;source;url;terminated=!1;worker;onMessage;onError;_loadableURL="";static isSupported(){return typeof Worker<"u"&&Tl||typeof Vv<"u"&&!Tl}constructor(e){const{name:r,source:i,url:s}=e;oh(i||s),this.name=r,this.source=i,this.url=s,this.onMessage=Hv,this.onError=l=>console.log(l),this.worker=Tl?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=Hv,this.onError=Hv,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(e,r){r=r||$I(e),this.worker.postMessage(e,r)}_getErrorFromErrorEvent(e){let r="Failed to load ";return r+=`worker ${this.name} from ${this.url}. `,e.message&&(r+=`${e.message} in `),e.lineno&&(r+=`:${e.lineno}:${e.colno}`),new Error(r)}_createBrowserWorker(){this._loadableURL=aU({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=r=>{r.data?this.onMessage(r.data):this.onError(new Error("No data received"))},e.onerror=r=>{this.onError(this._getErrorFromErrorEvent(r)),this.terminated=!0},e.onmessageerror=r=>console.error(r),e}_createNodeWorker(){let e;if(this.url){const r=this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`;e=new Vv(r,{eval:!1})}else if(this.source)e=new Vv(this.source,{eval:!0});else throw new Error("no worker");return e.on("message",r=>{this.onMessage(r)}),e.on("error",r=>{this.onError(r)}),e.on("exit",r=>{}),e}}class uU{name="unnamed";source;url;maxConcurrency=1;maxMobileConcurrency=1;onDebug=()=>{};reuseWorkers=!0;props={};jobQueue=[];idleQueue=[];count=0;isDestroyed=!1;static isSupported(){return bx.isSupported()}constructor(e){this.source=e.source,this.url=e.url,this.setProps(e)}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}async startJob(e,r=(s,l,h)=>s.done(h),i=(s,l)=>s.error(l)){const s=new Promise(l=>(this.jobQueue.push({name:e,onMessage:r,onError:i,onStart:l}),this));return this._startQueuedJob(),await s}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const r=this.jobQueue.shift();if(r){this.onDebug({message:"Starting job",name:r.name,workerThread:e,backlog:this.jobQueue.length});const i=new oU(r.name,e);e.onMessage=s=>r.onMessage(i,s.type,s.payload),e.onError=s=>r.onError(i,s),r.onStart(i);try{await i.result}catch(s){console.error(`Worker exception: ${s}`)}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){!Tl||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new bx({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return sU?this.maxMobileConcurrency:this.maxConcurrency}}const hU={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}};class rd{props;workerPools=new Map;static _workerFarm;static isSupported(){return bx.isSupported()}static getWorkerFarm(e={}){return rd._workerFarm=rd._workerFarm||new rd({}),rd._workerFarm.setProps(e),rd._workerFarm}constructor(e){this.props={...hU},this.setProps(e),this.workerPools=new Map}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const r of this.workerPools.values())r.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:r,source:i,url:s}=e;let l=this.workerPools.get(r);return l||(l=new uU({name:r,source:i,url:s}),l.setProps(this._getWorkerPoolProps()),this.workerPools.set(r,l)),l}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}function dU(t,e={}){const r=e[t.id]||{},i=Tl?`${t.id}-worker.js`:`${t.id}-worker-node.js`;let s=r.workerUrl;if(!s&&t.id==="compression"&&(s=e.workerUrl),e._workerType==="test"&&(Tl?s=`modules/${t.module}/dist/${i}`:s=`modules/${t.module}/src/workers/${t.id}-worker-node.ts`),!s){let l=t.version;l==="latest"&&(l=iU);const h=l?`@${l}`:"";s=`https://unpkg.com/@loaders.gl/${t.module}${h}/dist/${i}`}return oh(s),s}function pU(t,e=WI){oh(t,"no worker provided");const r=t.version;return!(!e||!r)}const Wv={};async function jp(t,e=null,r={},i=null){return e&&(t=fU(t,e,r,i)),Wv[t]=Wv[t]||mU(t),await Wv[t]}function fU(t,e,r={},i=null){if(!r.useLocalLibraries&&t.startsWith("http"))return t;i=i||t;const s=r.modules||{};return s[i]?s[i]:Tl?r.CDN?(oh(r.CDN.startsWith("http")),`${r.CDN}/${e}@${WI}/dist/libs/${i}`):p2?`../src/libs/${i}`:`modules/${e}/src/libs/${i}`:`modules/${e}/dist/libs/${i}`}async function mU(t){if(t.endsWith("wasm"))return await _U(t);if(!Tl)try{const{requireFromFile:r}=globalThis.loaders||{};return await r?.(t)}catch(r){return console.error(r),null}if(p2)return importScripts(t);const e=await yU(t);return gU(e,t)}function gU(t,e){if(!Tl){const{requireFromString:i}=globalThis.loaders||{};return i?.(t,e)}if(p2)return eval.call(globalThis,t),null;const r=document.createElement("script");r.id=e;try{r.appendChild(document.createTextNode(t))}catch{r.text=t}return document.body.appendChild(r),null}async function _U(t){const{readFileAsArrayBuffer:e}=globalThis.loaders||{};return Tl||!e||t.startsWith("http")?await(await fetch(t)).arrayBuffer():await e(t)}async function yU(t){const{readFileAsText:e}=globalThis.loaders||{};return Tl||!e||t.startsWith("http")?await(await fetch(t)).text():await e(t)}function vU(t,e){return!rd.isSupported()||!Tl&&!e?._nodeWorkers?!1:t.worker&&e?.worker}async function bU(t,e,r,i,s){const l=t.id,h=dU(t,r),a=rd.getWorkerFarm(r).getWorkerPool({name:l,url:h});r=JSON.parse(JSON.stringify(r)),i=JSON.parse(JSON.stringify(i||{}));const v=await a.startJob("process-on-worker",xU.bind(null,s));return v.postMessage("process",{input:e,options:r,context:i}),await(await v.result).result}async function xU(t,e,r,i){switch(r){case"done":e.done(i);break;case"error":e.error(new Error(i.error));break;case"process":const{id:s,input:l,options:h}=i;try{const a=await t(l,h);e.postMessage("done",{id:s,result:a})}catch(a){const v=a instanceof Error?a.message:"unknown error";e.postMessage("error",{id:s,error:v})}break;default:console.warn(`parse-with-worker unknown message ${r}`)}}function wU(t,e=5){return typeof t=="string"?t.slice(0,e):ArrayBuffer.isView(t)?lT(t.buffer,t.byteOffset,e):t instanceof ArrayBuffer?lT(t,0,e):""}function lT(t,e,r){if(t.byteLength<=e+r)return"";const i=new DataView(t);let s="";for(let l=0;l<r;l++)s+=String.fromCharCode(i.getUint8(e+l));return s}function EU(t){try{return JSON.parse(t)}catch{throw new Error(`Failed to parse JSON from data starting with "${wU(t)}"`)}}function AU(t,e,r){if(r=r||t.byteLength,t.byteLength<r||e.byteLength<r)return!1;const i=new Uint8Array(t),s=new Uint8Array(e);for(let l=0;l<i.length;++l)if(i[l]!==s[l])return!1;return!0}function TU(...t){return SU(t)}function SU(t){const e=t.map(l=>l instanceof ArrayBuffer?new Uint8Array(l):l),r=e.reduce((l,h)=>l+h.byteLength,0),i=new Uint8Array(r);let s=0;for(const l of e)i.set(l,s),s+=l.byteLength;return i.buffer}function f2(t,e,r){const i=r!==void 0?new Uint8Array(t).subarray(e,e+r):new Uint8Array(t).subarray(e);return new Uint8Array(i).buffer}function L_(t,e){return ki(t>=0),ki(e>0),t+(e-1)&-4}function CU(t,e,r){let i;if(t instanceof ArrayBuffer)i=new Uint8Array(t);else{const s=t.byteOffset,l=t.byteLength;i=new Uint8Array(t.buffer||t.arrayBuffer,s,l)}return e.set(i,r),r+L_(i.byteLength,4)}async function MU(t){const e=[];for await(const r of t)e.push(r);return TU(...e)}function cT(){let t;if(typeof window<"u"&&window.performance)t=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();t=e[0]*1e3+e[1]/1e6}else t=Date.now();return t}class uT{constructor(e,r){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=r,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=cT(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(cT()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class Nm{constructor(e){this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e,r="count"){return this._getOrCreate({name:e,type:r})}get size(){return Object.keys(this.stats).length}reset(){for(const e of Object.values(this.stats))e.reset();return this}forEach(e){for(const r of Object.values(this.stats))e(r)}getTable(){const e={};return this.forEach(r=>{e[r.name]={time:r.time||0,count:r.count||0,average:r.getAverageTime()||0,hz:r.getHz()||0}}),e}_initializeStats(e=[]){e.forEach(r=>this._getOrCreate(r))}_getOrCreate(e){const{name:r,type:i}=e;let s=this.stats[r];return s||(e instanceof uT?s=e:s=new uT(r,i),this.stats[r]=s),s}}const PU="Queued Requests",RU="Active Requests",IU="Cancelled Requests",kU="Queued Requests Ever",BU="Active Requests Ever",LU={id:"request-scheduler",throttleRequests:!0,maxRequests:6,debounceTime:0};class DU{props;stats;activeRequestCount=0;requestQueue=[];requestMap=new Map;updateTimer=null;constructor(e={}){this.props={...LU,...e},this.stats=new Nm({id:this.props.id}),this.stats.get(PU),this.stats.get(RU),this.stats.get(IU),this.stats.get(kU),this.stats.get(BU)}scheduleRequest(e,r=()=>0){if(!this.props.throttleRequests)return Promise.resolve({done:()=>{}});if(this.requestMap.has(e))return this.requestMap.get(e);const i={handle:e,priority:0,getPriority:r},s=new Promise(l=>(i.resolve=l,i));return this.requestQueue.push(i),this.requestMap.set(e,s),this._issueNewRequests(),s}_issueRequest(e){const{handle:r,resolve:i}=e;let s=!1;const l=()=>{s||(s=!0,this.requestMap.delete(r),this.activeRequestCount--,this._issueNewRequests())};return this.activeRequestCount++,i?i({done:l}):Promise.resolve({done:l})}_issueNewRequests(){this.updateTimer!==null&&clearTimeout(this.updateTimer),this.updateTimer=setTimeout(()=>this._issueNewRequestsAsync(),this.props.debounceTime)}_issueNewRequestsAsync(){this.updateTimer!==null&&clearTimeout(this.updateTimer),this.updateTimer=null;const e=Math.max(this.props.maxRequests-this.activeRequestCount,0);if(e!==0){this._updateAllRequests();for(let r=0;r<e;++r){const i=this.requestQueue.shift();i&&this._issueRequest(i)}}}_updateAllRequests(){const e=this.requestQueue;for(let r=0;r<e.length;++r){const i=e[r];this._updateRequest(i)||(e.splice(r,1),this.requestMap.delete(i.handle),r--)}e.sort((r,i)=>r.priority-i.priority)}_updateRequest(e){return e.priority=e.getPriority(e.handle),e.priority<0?(e.resolve(null),!1):!0}}let NU="";const hT={};function OU(t){for(const e in hT)if(t.startsWith(e)){const r=hT[e];t=t.replace(e,r)}return!t.startsWith("http://")&&!t.startsWith("https://")&&(t=`${NU}${t}`),t}function FU(t){return t&&typeof t=="object"&&t.isBuffer}function ZI(t){if(FU(t)||t instanceof ArrayBuffer)return t;if(ArrayBuffer.isView(t))return t.byteOffset===0&&t.byteLength===t.buffer.byteLength?t.buffer:t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength);if(typeof t=="string"){const e=t;return new TextEncoder().encode(e).buffer}if(t&&typeof t=="object"&&t._toArrayBuffer)return t._toArrayBuffer();throw new Error("toArrayBuffer")}function zU(){if(typeof process<"u"&&typeof process.cwd<"u")return process.cwd();const t=window.location?.pathname;return t?.slice(0,t.lastIndexOf("/")+1)||""}function XI(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(e+1):""}function m2(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(0,e):""}function UU(...t){const e=[];for(let l=0;l<t.length;l++)e[l]=t[l];let r="",i=!1,s;for(let l=e.length-1;l>=-1&&!i;l--){let h;l>=0?h=e[l]:(s===void 0&&(s=zU()),h=s),h.length!==0&&(r=`${h}/${r}`,i=h.charCodeAt(0)===Wg)}return r=jU(r,!i),i?`/${r}`:r.length>0?r:"."}const Wg=47,qv=46;function jU(t,e){let r="",i=-1,s=0,l,h=!1;for(let a=0;a<=t.length;++a){if(a<t.length)l=t.charCodeAt(a);else{if(l===Wg)break;l=Wg}if(l===Wg){if(!(i===a-1||s===1))if(i!==a-1&&s===2){if(r.length<2||!h||r.charCodeAt(r.length-1)!==qv||r.charCodeAt(r.length-2)!==qv){if(r.length>2){const v=r.length-1;let T=v;for(;T>=0&&r.charCodeAt(T)!==Wg;--T);if(T!==v){r=T===-1?"":r.slice(0,T),i=a,s=0,h=!1;continue}}else if(r.length===2||r.length===1){r="",i=a,s=0,h=!1;continue}}e&&(r.length>0?r+="/..":r="..",h=!0)}else{const v=t.slice(i+1,a);r.length>0?r+=`/${v}`:r=v,h=!1}i=a,s=0}else l===qv&&s!==-1?++s:s=-1}return r}const VU=t=>typeof t=="boolean",i_=t=>typeof t=="function",D_=t=>t!==null&&typeof t=="object",dT=t=>D_(t)&&t.constructor==={}.constructor,GU=t=>!!t&&typeof t[Symbol.iterator]=="function",HU=t=>t&&typeof t[Symbol.asyncIterator]=="function",Xp=t=>typeof Response<"u"&&t instanceof Response||t&&t.arrayBuffer&&t.text&&t.json,Kp=t=>typeof Blob<"u"&&t instanceof Blob,WU=t=>t&&typeof t=="object"&&t.isBuffer,qU=t=>typeof ReadableStream<"u"&&t instanceof ReadableStream||D_(t)&&i_(t.tee)&&i_(t.cancel)&&i_(t.getReader),$U=t=>D_(t)&&i_(t.read)&&i_(t.pipe)&&VU(t.readable),KI=t=>qU(t)||$U(t);class ZU extends Error{constructor(e,r){super(e),this.reason=r.reason,this.url=r.url,this.response=r.response}reason;url;response}const XU=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,KU=/^([-\w.]+\/[-\w.+]+)/;function pT(t,e){return t.toLowerCase()===e.toLowerCase()}function YU(t){const e=KU.exec(t);return e?e[1]:t}function fT(t){const e=XU.exec(t);return e?e[1]:""}const YI=/\?.*/;function JU(t){const e=t.match(YI);return e&&e[0]}function g2(t){return t.replace(YI,"")}function QU(t){if(t.length<50)return t;const e=t.slice(t.length-15);return`${t.substr(0,32)}...${e}`}function v1(t){return Xp(t)?t.url:Kp(t)?t.name||"":typeof t=="string"?t:""}function _2(t){if(Xp(t)){const e=t,r=e.headers.get("content-type")||"",i=g2(e.url);return YU(r)||fT(i)}return Kp(t)?t.type||"":typeof t=="string"?fT(t):""}function ej(t){return Xp(t)?t.headers["content-length"]||-1:Kp(t)?t.size:typeof t=="string"?t.length:t instanceof ArrayBuffer||ArrayBuffer.isView(t)?t.byteLength:-1}async function JI(t){if(Xp(t))return t;const e={},r=ej(t);r>=0&&(e["content-length"]=String(r));const i=v1(t),s=_2(t);s&&(e["content-type"]=s);const l=await ij(t);l&&(e["x-first-bytes"]=l),typeof t=="string"&&(t=new TextEncoder().encode(t));const h=new Response(t,{headers:e});return Object.defineProperty(h,"url",{value:i}),h}async function tj(t){if(!t.ok)throw await rj(t)}async function rj(t){const e=QU(t.url);let r=`Failed to fetch resource (${t.status}) ${t.statusText}: ${e}`;r=r.length>100?`${r.slice(0,100)}...`:r;const i={reason:t.statusText,url:t.url,response:t};try{const s=t.headers.get("Content-Type");i.reason=!t.bodyUsed&&s?.includes("application/json")?await t.json():await t.text()}catch{}return new ZU(r,i)}async function ij(t){if(typeof t=="string")return`data:,${t.slice(0,5)}`;if(t instanceof Blob){const e=t.slice(0,5);return await new Promise(r=>{const i=new FileReader;i.onload=s=>r(s?.target?.result),i.readAsDataURL(e)})}if(t instanceof ArrayBuffer){const e=t.slice(0,5);return`data:base64,${nj(e)}`}return null}function nj(t){let e="";const r=new Uint8Array(t);for(let i=0;i<r.byteLength;i++)e+=String.fromCharCode(r[i]);return btoa(e)}function sj(t){return!oj(t)&&!aj(t)}function oj(t){return t.startsWith("http:")||t.startsWith("https:")}function aj(t){return t.startsWith("data:")}async function mT(t,e){if(typeof t=="string"){const r=OU(t);return sj(r)&&globalThis.loaders?.fetchNode?globalThis.loaders?.fetchNode(r,e):await fetch(r,e)}return await JI(t)}const gT=new Dm({id:"loaders.gl"});class lj{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class cj{console;constructor(){this.console=console}log(...e){return this.console.log.bind(this.console,...e)}info(...e){return this.console.info.bind(this.console,...e)}warn(...e){return this.console.warn.bind(this.console,...e)}error(...e){return this.console.error.bind(this.console,...e)}}const QI={fetch:null,mimeType:void 0,nothrow:!1,log:new cj,useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:y1,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},uj={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function e5(){globalThis.loaders=globalThis.loaders||{};const{loaders:t}=globalThis;return t._state||(t._state={}),t._state}function t5(){const t=e5();return t.globalOptions=t.globalOptions||{...QI},t.globalOptions}function hj(t,e,r,i){return r=r||[],r=Array.isArray(r)?r:[r],dj(t,r),fj(e,t,i)}function dj(t,e){_T(t,null,QI,uj,e);for(const r of e){const i=t&&t[r.id]||{},s=r.options&&r.options[r.id]||{},l=r.deprecatedOptions&&r.deprecatedOptions[r.id]||{};_T(i,r.id,s,l,e)}}function _T(t,e,r,i,s){const l=e||"Top level",h=e?`${e}.`:"";for(const a in t){const v=!e&&D_(t[a]),T=a==="baseUri"&&!e,C=a==="workerUrl"&&e;if(!(a in r)&&!T&&!C){if(a in i)gT.warn(`${l} loader option '${h}${a}' no longer supported, use '${i[a]}'`)();else if(!v){const k=pj(a,s);gT.warn(`${l} loader option '${h}${a}' not recognized. ${k}`)()}}}}function pj(t,e){const r=t.toLowerCase();let i="";for(const s of e)for(const l in s.options){if(t===l)return`Did you mean '${s.id}.${l}'?`;const h=l.toLowerCase();(r.startsWith(h)||h.startsWith(r))&&(i=i||`Did you mean '${s.id}.${l}'?`)}return i}function fj(t,e,r){const i={...t.options||{}};return mj(i,r),i.log===null&&(i.log=new lj),yT(i,t5()),yT(i,e),i}function yT(t,e){for(const r in e)if(r in e){const i=e[r];dT(i)&&dT(t[r])?t[r]={...t[r],...e[r]}:t[r]=e[r]}}function mj(t,e){e&&!("baseUri"in t)&&(t.baseUri=e)}function y2(t){return t?(Array.isArray(t)&&(t=t[0]),Array.isArray(t?.extensions)):!1}function v2(t){ki(t,"null loader"),ki(y2(t),"invalid loader");let e;return Array.isArray(t)&&(e=t[1],t=t[0],t={...t,options:{...t.options,...e}}),(t?.parseTextSync||t?.parseText)&&(t.text=!0),t.text||(t.binary=!0),t}const r5=()=>{const t=e5();return t.loaderRegistry=t.loaderRegistry||[],t.loaderRegistry};function gj(t){const e=r5();t=Array.isArray(t)?t:[t];for(const r of t){const i=v2(r);e.find(s=>i===s)||e.unshift(i)}}function _j(){return r5()}const yj=/\.([^.]+)$/;async function vj(t,e=[],r,i){if(!i5(t))return null;let s=vT(t,e,{...r,nothrow:!0},i);if(s)return s;if(Kp(t)&&(t=await t.slice(0,10).arrayBuffer(),s=vT(t,e,r,i)),!s&&!r?.nothrow)throw new Error(n5(t));return s}function vT(t,e=[],r,i){if(!i5(t))return null;if(e&&!Array.isArray(e))return v2(e);let s=[];e&&(s=s.concat(e)),r?.ignoreRegisteredLoaders||s.push(..._j()),xj(s);const l=bj(t,s,r,i);if(!l&&!r?.nothrow)throw new Error(n5(t));return l}function bj(t,e,r,i){const s=v1(t),l=_2(t),h=g2(s)||i?.url;let a=null,v="";return r?.mimeType&&(a=$v(e,r?.mimeType),v=`match forced by supplied MIME type ${r?.mimeType}`),a=a||wj(e,h),v=v||(a?`matched url ${h}`:""),a=a||$v(e,l),v=v||(a?`matched MIME type ${l}`:""),a=a||Aj(e,t),v=v||(a?`matched initial data ${s5(t)}`:""),r?.fallbackMimeType&&(a=a||$v(e,r?.fallbackMimeType),v=v||(a?`matched fallback MIME type ${l}`:"")),v&&Q7.log(1,`selectLoader selected ${a?.name}: ${v}.`),a}function i5(t){return!(t instanceof Response&&t.status===204)}function n5(t){const e=v1(t),r=_2(t);let i="No valid loader found (";i+=e?`${XI(e)}, `:"no url provided, ",i+=`MIME type: ${r?`"${r}"`:"not provided"}, `;const s=t?s5(t):"";return i+=s?` first bytes: "${s}"`:"first bytes: not available",i+=")",i}function xj(t){for(const e of t)v2(e)}function wj(t,e){const r=e&&yj.exec(e),i=r&&r[1];return i?Ej(t,i):null}function Ej(t,e){e=e.toLowerCase();for(const r of t)for(const i of r.extensions)if(i.toLowerCase()===e)return r;return null}function $v(t,e){for(const r of t)if(r.mimeTypes?.some(i=>pT(e,i))||pT(e,`application/x.${r.id}`))return r;return null}function Aj(t,e){if(!e)return null;for(const r of t)if(typeof e=="string"){if(Tj(e,r))return r}else if(ArrayBuffer.isView(e)){if(bT(e.buffer,e.byteOffset,r))return r}else if(e instanceof ArrayBuffer&&bT(e,0,r))return r;return null}function Tj(t,e){return e.testText?e.testText(t):(Array.isArray(e.tests)?e.tests:[e.tests]).some(r=>t.startsWith(r))}function bT(t,e,r){return(Array.isArray(r.tests)?r.tests:[r.tests]).some(i=>Sj(t,e,r,i))}function Sj(t,e,r,i){if(i instanceof ArrayBuffer)return AU(i,t,i.byteLength);switch(typeof i){case"function":return i(t);case"string":const s=xx(t,e,i.length);return i===s;default:return!1}}function s5(t,e=5){return typeof t=="string"?t.slice(0,e):ArrayBuffer.isView(t)?xx(t.buffer,t.byteOffset,e):t instanceof ArrayBuffer?xx(t,0,e):""}function xx(t,e,r){if(t.byteLength<e+r)return"";const i=new DataView(t);let s="";for(let l=0;l<r;l++)s+=String.fromCharCode(i.getUint8(e+l));return s}const Cj=256*1024;function*Mj(t,e){const r=e?.chunkSize||Cj;let i=0;const s=new TextEncoder;for(;i<t.length;){const l=Math.min(t.length-i,r),h=t.slice(i,i+l);i+=l,yield s.encode(h)}}const Pj=256*1024;function*Rj(t,e={}){const{chunkSize:r=Pj}=e;let i=0;for(;i<t.byteLength;){const s=Math.min(t.byteLength-i,r),l=new ArrayBuffer(s),h=new Uint8Array(t,i,s);new Uint8Array(l).set(h),i+=s,yield l}}const Ij=1024*1024;async function*kj(t,e){const r=e?.chunkSize||Ij;let i=0;for(;i<t.size;){const s=i+r,l=await t.slice(i,s).arrayBuffer();i=s,yield l}}function xT(t,e){return y1?Bj(t,e):Lj(t)}async function*Bj(t,e){const r=t.getReader();let i;try{for(;;){const s=i||r.read();e?._streamReadAhead&&(i=r.read());const{done:l,value:h}=await s;if(l)return;yield ZI(h)}}catch{r.releaseLock()}}async function*Lj(t,e){for await(const r of t)yield ZI(r)}function Dj(t,e){if(typeof t=="string")return Mj(t,e);if(t instanceof ArrayBuffer)return Rj(t,e);if(Kp(t))return kj(t,e);if(KI(t))return xT(t,e);if(Xp(t))return xT(t.body,e);throw new Error("makeIterator")}const o5="Cannot convert supplied data type";function Nj(t,e,r){if(e.text&&typeof t=="string")return t;if(WU(t)&&(t=t.buffer),t instanceof ArrayBuffer){const i=t;return e.text&&!e.binary?new TextDecoder("utf8").decode(i):i}if(ArrayBuffer.isView(t)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(t);let i=t.buffer;const s=t.byteLength||t.length;return(t.byteOffset!==0||s!==i.byteLength)&&(i=i.slice(t.byteOffset,t.byteOffset+s)),i}throw new Error(o5)}async function Oj(t,e,r){const i=t instanceof ArrayBuffer||ArrayBuffer.isView(t);if(typeof t=="string"||i)return Nj(t,e);if(Kp(t)&&(t=await JI(t)),Xp(t)){const s=t;return await tj(s),e.binary?await s.arrayBuffer():await s.text()}if(KI(t)&&(t=Dj(t,r)),GU(t)||HU(t))return MU(t);throw new Error(o5)}function a5(t,e){const r=t5(),i=t||r;return typeof i.fetch=="function"?i.fetch:D_(i.fetch)?s=>mT(s,i.fetch):e?.fetch?e?.fetch:mT}function Fj(t,e,r){if(r)return r;const i={fetch:a5(e,t),...t};if(i.url){const s=g2(i.url);i.baseUrl=s,i.queryString=JU(i.url),i.filename=XI(s),i.baseUrl=m2(s)}return Array.isArray(i.loaders)||(i.loaders=null),i}function zj(t,e){if(t&&!Array.isArray(t))return t;let r;if(t&&(r=Array.isArray(t)?t:[t]),e&&e.loaders){const i=Array.isArray(e.loaders)?e.loaders:[e.loaders];r=r?[...r,...i]:i}return r&&r.length?r:void 0}async function U0(t,e,r,i){e&&!Array.isArray(e)&&!y2(e)&&(i=void 0,r=e,e=void 0),t=await t,r=r||{};const s=v1(t),l=zj(e,i),h=await vj(t,l,r);return h?(r=hj(r,h,l,s),i=Fj({url:s,_parse:U0,loaders:l},r,i||null),await Uj(h,t,r,i)):null}async function Uj(t,e,r,i){if(pU(t),r=eU(t.options,r),Xp(e)){const l=e,{ok:h,redirected:a,status:v,statusText:T,type:C,url:k}=l,L=Object.fromEntries(l.headers.entries());i.response={headers:L,ok:h,redirected:a,status:v,statusText:T,type:C,url:k}}e=await Oj(e,t,r);const s=t;if(s.parseTextSync&&typeof e=="string")return s.parseTextSync(e,r,i);if(vU(t,r))return await bU(t,e,r,i,U0);if(s.parseText&&typeof e=="string")return await s.parseText(e,r,i);if(s.parse)return await s.parse(e,r,i);throw oh(!s.parseSync),new Error(`${t.id} loader - no parser found and worker is disabled`)}function jj(t){switch(t.constructor){case Int8Array:return"int8";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int16Array:return"int16";case Uint16Array:return"uint16";case Int32Array:return"int32";case Uint32Array:return"uint32";case Float32Array:return"float32";case Float64Array:return"float64";default:return"null"}}function l5(t){let e=1/0,r=1/0,i=1/0,s=-1/0,l=-1/0,h=-1/0;const a=t.POSITION?t.POSITION.value:[],v=a&&a.length;for(let T=0;T<v;T+=3){const C=a[T],k=a[T+1],L=a[T+2];e=C<e?C:e,r=k<r?k:r,i=L<i?L:i,s=C>s?C:s,l=k>l?k:l,h=L>h?L:h}return[[e,r,i],[s,l,h]]}function Vj(t,e,r){const i=jj(e.value),s=r||Gj(e);return{name:t,type:{type:"fixed-size-list",listSize:e.size,children:[{name:"value",type:i}]},nullable:!1,metadata:s}}function Gj(t){const e={};return"byteOffset"in t&&(e.byteOffset=t.byteOffset.toString(10)),"byteStride"in t&&(e.byteStride=t.byteStride.toString(10)),"normalized"in t&&(e.normalized=t.normalized.toString()),e}async function hd(t,e,r,i){let s,l;!Array.isArray(e)&&!y2(e)?(s=[],l=e):(s=e,l=r);const h=a5(l);let a=t;return typeof t=="string"&&(a=await h(t)),Kp(t)&&(a=await h(t)),Array.isArray(s)?await U0(a,s,l):await U0(a,s,l)}const Hj="4.3.1",Wj=globalThis.loaders?.parseImageNode,wx=typeof Image<"u",Ex=typeof ImageBitmap<"u",qj=!!Wj,Ax=y1?!0:qj;function $j(t){switch(t){case"auto":return Ex||wx||Ax;case"imagebitmap":return Ex;case"image":return wx;case"data":return Ax;default:throw new Error(`@loaders.gl/images: image ${t} not supported in this environment`)}}function Zj(){if(Ex)return"imagebitmap";if(wx)return"image";if(Ax)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function Xj(t){const e=Kj(t);if(!e)throw new Error("Not an image");return e}function c5(t){switch(Xj(t)){case"data":return t;case"image":case"imagebitmap":const e=document.createElement("canvas"),r=e.getContext("2d");if(!r)throw new Error("getImageData");return e.width=t.width,e.height=t.height,r.drawImage(t,0,0),r.getImageData(0,0,t.width,t.height);default:throw new Error("getImageData")}}function Kj(t){return typeof ImageBitmap<"u"&&t instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&t instanceof Image?"image":t&&typeof t=="object"&&t.data&&t.width&&t.height?"data":null}const Yj=/^data:image\/svg\+xml/,Jj=/\.svg((\?|#).*)?$/;function b2(t){return t&&(Yj.test(t)||Jj.test(t))}function Qj(t,e){if(b2(e)){let r=new TextDecoder().decode(t);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(r=unescape(encodeURIComponent(r)))}catch(i){throw new Error(i.message)}return`data:image/svg+xml;base64,${btoa(r)}`}return u5(t,e)}function u5(t,e){if(b2(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(t)])}async function h5(t,e,r){const i=Qj(t,r),s=self.URL||self.webkitURL,l=typeof i!="string"&&s.createObjectURL(i);try{return await eV(l||i,e)}finally{l&&s.revokeObjectURL(l)}}async function eV(t,e){const r=new Image;return r.src=t,e.image&&e.image.decode&&r.decode?(await r.decode(),r):await new Promise((i,s)=>{try{r.onload=()=>i(r),r.onerror=l=>{const h=l instanceof Error?l.message:"error";s(new Error(h))}}catch(l){s(l)}})}const tV={};let wT=!0;async function rV(t,e,r){let i;b2(r)?i=await h5(t,e,r):i=u5(t,r);const s=e&&e.imagebitmap;return await iV(i,s)}async function iV(t,e=null){if((nV(e)||!wT)&&(e=null),e)try{return await createImageBitmap(t,e)}catch(r){console.warn(r),wT=!1}return await createImageBitmap(t)}function nV(t){for(const e in t||tV)return!1;return!0}function sV(t){return!cV(t,"ftyp",4)||(t[8]&96)===0?null:oV(t)}function oV(t){switch(aV(t,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function aV(t,e,r){return String.fromCharCode(...t.slice(e,r))}function lV(t){return[...t].map(e=>e.charCodeAt(0))}function cV(t,e,r=0){const i=lV(e);for(let s=0;s<i.length;++s)if(i[s]!==t[s+r])return!1;return!0}const iu=!1,n_=!0;function x2(t){const e=N_(t);return hV(e)||fV(e)||dV(e)||pV(e)||uV(e)}function uV(t){const e=new Uint8Array(t instanceof DataView?t.buffer:t),r=sV(e);return r?{mimeType:r.mimeType,width:0,height:0}:null}function hV(t){const e=N_(t);return e.byteLength>=24&&e.getUint32(0,iu)===2303741511?{mimeType:"image/png",width:e.getUint32(16,iu),height:e.getUint32(20,iu)}:null}function dV(t){const e=N_(t);return e.byteLength>=10&&e.getUint32(0,iu)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,n_),height:e.getUint16(8,n_)}:null}function pV(t){const e=N_(t);return e.byteLength>=14&&e.getUint16(0,iu)===16973&&e.getUint32(2,n_)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,n_),height:e.getUint32(22,n_)}:null}function fV(t){const e=N_(t);if(!(e.byteLength>=3&&e.getUint16(0,iu)===65496&&e.getUint8(2)===255))return null;const{tableMarkers:r,sofMarkers:i}=mV();let s=2;for(;s+9<e.byteLength;){const l=e.getUint16(s,iu);if(i.has(l))return{mimeType:"image/jpeg",height:e.getUint16(s+5,iu),width:e.getUint16(s+7,iu)};if(!r.has(l))return null;s+=2,s+=e.getUint16(s,iu)}return null}function mV(){const t=new Set([65499,65476,65484,65501,65534]);for(let e=65504;e<65520;++e)t.add(e);return{tableMarkers:t,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function N_(t){if(t instanceof DataView)return t;if(ArrayBuffer.isView(t))return new DataView(t.buffer);if(t instanceof ArrayBuffer)return new DataView(t);throw new Error("toDataView")}async function gV(t,e){const{mimeType:r}=x2(t)||{},i=globalThis.loaders?.parseImageNode;return ki(i),await i(t,r)}async function _V(t,e,r){e=e||{};const i=(e.image||{}).type||"auto",{url:s}=r||{},l=yV(i);let h;switch(l){case"imagebitmap":h=await rV(t,e,s);break;case"image":h=await h5(t,e,s);break;case"data":h=await gV(t);break;default:ki(!1)}return i==="data"&&(h=c5(h)),h}function yV(t){switch(t){case"auto":case"data":return Zj();default:return $j(t),t}}const vV=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],bV=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],xV={image:{type:"auto",decode:!0}},d5={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:Hj,mimeTypes:bV,extensions:vV,parse:_V,tests:[t=>!!x2(new DataView(t))],options:xV},Zv={};function wV(t){if(Zv[t]===void 0){const e=y1?AV(t):EV(t);Zv[t]=e}return Zv[t]}function EV(t){const e=["image/png","image/jpeg","image/gif"],r=globalThis.loaders?.imageFormatsNode||e;return!!globalThis.loaders?.parseImageNode&&r.includes(t)}function AV(t){switch(t){case"image/avif":case"image/webp":return TV(t);default:return!0}}function TV(t){try{return document.createElement("canvas").toDataURL(t).indexOf(`data:${t}`)===0}catch{return!1}}const li=new Dm({id:"deck"});let Tx={};function SV(t){Tx=t}function po(t,e,r,i){li.level>0&&Tx[t]&&Tx[t].call(null,e,r,i)}function CV(t){const e=t[0],r=t[t.length-1];return e==="{"&&r==="}"||e==="["&&r==="]"}const MV={dataType:null,batchType:null,id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:CV,parseTextSync:JSON.parse};function PV(){const t="9.0.35",e=globalThis.deck&&globalThis.deck.VERSION;if(e&&e!==t)throw new Error(`deck.gl - multiple versions detected: ${e} vs ${t}`);return e||(li.log(1,`deck.gl ${t}`)(),globalThis.deck={...globalThis.deck,VERSION:t,version:t,log:li,_registerLoggers:SV},gj([MV,[d5,{imagebitmap:{premultiplyAlpha:"none"}}]])),t}const RV=PV();function Lp(t,e){if(!t)throw new Error(e||"shadertools: assertion failed.")}const Xv={number:{type:"number",validate(t,e){return Number.isFinite(t)&&typeof e=="object"&&(e.max===void 0||t<=e.max)&&(e.min===void 0||t>=e.min)}},array:{type:"array",validate(t,e){return Array.isArray(t)||ArrayBuffer.isView(t)}}};function IV(t){const e={};for(const[r,i]of Object.entries(t))e[r]=BV(i);return e}function kV(t,e,r){const i={};for(const[s,l]of Object.entries(e))t&&s in t&&!l.private?(l.validate&&Lp(l.validate(t[s],l),`${r}: invalid ${s}`),i[s]=t[s]):i[s]=l.value;return i}function BV(t){let e=ET(t);if(e!=="object")return{value:t,...Xv[e],type:e};if(typeof t=="object")return t?t.type!==void 0?{...t,...Xv[t.type],type:t.type}:t.value===void 0?{type:"object",value:t}:(e=ET(t.value),{...t,...Xv[e],type:e}):{type:"object",value:null};throw new Error("props")}function ET(t){return Array.isArray(t)||ArrayBuffer.isView(t)?"array":typeof t}const LV=`#ifdef MODULE_LOGDEPTH
logdepth_adjustPosition(gl_Position);
#endif
`,DV=`#ifdef MODULE_MATERIAL
gl_FragColor = material_filterColor(gl_FragColor);
#endif
#ifdef MODULE_LIGHTING
gl_FragColor = lighting_filterColor(gl_FragColor);
#endif
#ifdef MODULE_FOG
gl_FragColor = fog_filterColor(gl_FragColor);
#endif
#ifdef MODULE_PICKING
gl_FragColor = picking_filterHighlightColor(gl_FragColor);
gl_FragColor = picking_filterPickingColor(gl_FragColor);
#endif
#ifdef MODULE_LOGDEPTH
logdepth_setFragDepth();
#endif
`,NV={vertex:LV,fragment:DV},AT=/void\s+main\s*\([^)]*\)\s*\{\n?/,TT=/}\n?[^{}]*$/,Kv=[],w0="__LUMA_INJECT_DECLARATIONS__";function OV(t){const e={vertex:{},fragment:{}};for(const r in t){let i=t[r];const s=FV(r);typeof i=="string"&&(i={order:0,injection:i}),e[s][r]=i}return e}function FV(t){const e=t.slice(0,2);switch(e){case"vs":return"vertex";case"fs":return"fragment";default:throw new Error(e)}}function j0(t,e,r,i=!1){const s=e==="vertex";for(const l in r){const h=r[l];h.sort((v,T)=>v.order-T.order),Kv.length=h.length;for(let v=0,T=h.length;v<T;++v)Kv[v]=h[v].injection;const a=`${Kv.join(`
`)}
`;switch(l){case"vs:#decl":s&&(t=t.replace(w0,a));break;case"vs:#main-start":s&&(t=t.replace(AT,v=>v+a));break;case"vs:#main-end":s&&(t=t.replace(TT,v=>a+v));break;case"fs:#decl":s||(t=t.replace(w0,a));break;case"fs:#main-start":s||(t=t.replace(AT,v=>v+a));break;case"fs:#main-end":s||(t=t.replace(TT,v=>a+v));break;default:t=t.replace(l,v=>v+a)}}return t=t.replace(w0,""),i&&(t=t.replace(/\}\s*$/,l=>l+NV[e])),t}let zV=1;class Dp{name;vs;fs;getModuleUniforms;dependencies;deprecations;defines;injections;uniforms={};uniformTypes={};static instantiateModules(e){return e.map(r=>{if(r instanceof Dp)return r;Lp(typeof r!="string",`Shader module use by name is deprecated. Import shader module '${JSON.stringify(r)}' and use it directly.`),r.name||(console.warn("shader module has no name"),r.name=`shader-module-${zV++}`);const i=new Dp(r);return i.dependencies=Dp.instantiateModules(r.dependencies||[]),i})}constructor(e){const{name:r,vs:i,fs:s,dependencies:l=[],uniformTypes:h={},uniformPropTypes:a={},getUniforms:v,deprecations:T=[],defines:C={},inject:k={}}=e;Lp(typeof r=="string"),this.name=r,this.vs=i,this.fs=s,this.getModuleUniforms=v,this.dependencies=Dp.instantiateModules(l),this.deprecations=this._parseDeprecationDefinitions(T),this.defines=C,this.injections=OV(k),this.uniformTypes=h,a&&(this.uniforms=IV(a))}getModuleSource(e){let r;switch(e){case"vertex":r=this.vs||"";break;case"fragment":r=this.fs||"";break;default:Lp(!1)}const i=this.name.toUpperCase().replace(/[^0-9a-z]/gi,"_");return`// ----- MODULE ${this.name} ---------------

#define MODULE_${i}
${r}

`}getUniforms(e,r){return this.getModuleUniforms?this.getModuleUniforms(e,r):kV(e,this.uniforms,this.name)}getDefines(){return this.defines}checkDeprecations(e,r){this.deprecations.forEach(i=>{i.regex?.test(e)&&(i.deprecated?r.deprecated(i.old,i.new)():r.removed(i.old,i.new)())})}_parseDeprecationDefinitions(e){return e.forEach(r=>{switch(r.type){case"function":r.regex=new RegExp(`\\b${r.old}\\(`);break;default:r.regex=new RegExp(`${r.type} ${r.old};`)}}),e}_defaultGetUniforms(e={}){const r={},i=this.uniforms;for(const s in i){const l=i[s];s in e&&!l.private?(l.validate&&Lp(l.validate(e[s],l),`${this.name}: invalid ${s}`),r[s]=e[s]):r[s]=l.value}return r}}function ST(t){if(t.source&&t.platformInfo.type==="webgpu")return{...t,vs:void 0,fs:void 0};if(!t.vs)throw new Error("no vertex shader");const e=CT(t.platformInfo,t.vs);let r;return t.fs&&(r=CT(t.platformInfo,t.fs)),{...t,vs:e,fs:r}}function CT(t,e){if(typeof e=="string")return e;switch(t.type){case"webgpu":if(e?.wgsl)return e.wgsl;throw new Error("WebGPU does not support GLSL shaders");default:if(e?.glsl)return e.glsl;throw new Error("WebGL does not support WGSL shaders")}}function b1(t){const e=Dp.instantiateModules(t);return UV(e)}function UV(t){const e={},r={};return p5({modules:t,level:0,moduleMap:e,moduleDepth:r}),Object.keys(r).sort((i,s)=>r[s]-r[i]).map(i=>e[i])}function p5(t){const{modules:e,level:r,moduleMap:i,moduleDepth:s}=t;if(r>=5)throw new Error("Possible loop in shader dependency graph");for(const l of e)i[l.name]=l,(s[l.name]===void 0||s[l.name]<r)&&(s[l.name]=r);for(const l of e)l.dependencies&&p5({modules:l.dependencies,level:r+1,moduleMap:i,moduleDepth:s})}function jV(t){switch(t?.gpu.toLowerCase()){case"apple":return`#define APPLE_GPU
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"nvidia":return`#define NVIDIA_GPU
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function VV(t,e){if(Number(t.match(/^#version[ \t]+(\d+)/m)?.[1]||100)!==300)throw new Error("luma.gl v9 only supports GLSL 3.00 shader sources");switch(e){case"vertex":return t=MT(t,GV),t;case"fragment":return t=MT(t,HV),t;default:throw new Error(e)}}const f5=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],GV=[...f5,[Sx("attribute"),"in $1"],[Sx("varying"),"out $1"]],HV=[...f5,[Sx("varying"),"in $1"]];function MT(t,e){for(const[r,i]of e)t=t.replace(r,i);return t}function Sx(t){return new RegExp(`\\b${t}[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)`,"g")}function m5(t,e){let r="";for(const i in t){const s=t[i];if(r+=`void ${s.signature} {
`,s.header&&(r+=`  ${s.header}`),e[i]){const l=e[i];l.sort((h,a)=>h.order-a.order);for(const h of l)r+=`  ${h.injection}
`}s.footer&&(r+=`  ${s.footer}`),r+=`}
`}return r}function g5(t){const e={vertex:{},fragment:{}};for(const r of t){let i,s;typeof r!="string"?(i=r,s=i.hook):(i={},s=r),s=s.trim();const[l,h]=s.split(":"),a=s.replace(/\(.+/,""),v=Object.assign(i,{signature:h});switch(l){case"vs":e.vertex[a]=v;break;case"fs":e.fragment[a]=v;break;default:throw new Error(l)}}return e}function WV(t,e){return{name:qV(t,e),language:"glsl",version:$V(t)}}function qV(t,e="unnamed"){const r=/#define[^\S\r\n]*SHADER_NAME[^\S\r\n]*([A-Za-z0-9_-]+)\s*/.exec(t);return r?r[1]:e}function $V(t){let e=100;const r=t.match(/[^\s]+/g);if(r&&r.length>=2&&r[0]==="#version"){const i=parseInt(r[1],10);Number.isFinite(i)&&(e=i)}if(e!==100&&e!==300)throw new Error(`Invalid GLSL version ${e}`);return e}const _5=`

${w0}
`,ZV=`precision highp float;
`;function XV(t){const e=b1(t.modules||[]);return{source:Cx(t.platformInfo,{...t,source:t.source,stage:"vertex",modules:e}),getUniforms:w2(e)}}function KV(t){const e=b1(t.modules||[]);return{vs:Cx(t.platformInfo,{...t,source:t.vs,stage:"vertex",modules:e}),fs:Cx(t.platformInfo,{...t,source:t.fs,stage:"fragment",modules:e}),getUniforms:w2(e)}}function YV(t){const{vs:e,fs:r}=t,i=b1(t.modules||[]);return{vs:PT(t.platformInfo,{...t,source:e,stage:"vertex",modules:i}),fs:PT(t.platformInfo,{...t,source:r,stage:"fragment",modules:i}),getUniforms:w2(i)}}function Cx(t,e){const{source:r,stage:i,modules:s,hookFunctions:l=[],inject:h={},log:a}=e;Lp(typeof r=="string","shader source must be a string");const v=r;let T="";const C=g5(l),k={},L={},O={};for(const $ in h){const ne=typeof h[$]=="string"?{injection:h[$],order:0}:h[$],oe=/^(v|f)s:(#)?([\w-]+)$/.exec($);if(oe){const fe=oe[2],ue=oe[3];fe?ue==="decl"?L[$]=[ne]:O[$]=[ne]:k[$]=[ne]}else O[$]=[ne]}const K=t.type!=="webgpu"?s:[];for(const $ of K){a&&$.checkDeprecations(v,a);const ne=$.getModuleSource(i,"wgsl");T+=ne;const oe=$.injections[i];for(const fe in oe){const ue=/^(v|f)s:#([\w-]+)$/.exec(fe);if(ue){const we=ue[2]==="decl"?L:O;we[fe]=we[fe]||[],we[fe].push(oe[fe])}else k[fe]=k[fe]||[],k[fe].push(oe[fe])}}return T+=_5,T=j0(T,i,L),T+=m5(C[i],k),T+=v,T=j0(T,i,O),T}function PT(t,e){const{id:r,source:i,stage:s,language:l="glsl",modules:h,defines:a={},hookFunctions:v=[],inject:T={},prologue:C=!0,log:k}=e;Lp(typeof i=="string","shader source must be a string");const L=l==="glsl"?WV(i).version:-1,O=t.shaderLanguageVersion,K=L===100?"#version 100":"#version 300 es",$=i.split(`
`).slice(1).join(`
`),ne={};h.forEach(Fe=>{Object.assign(ne,Fe.getDefines())}),Object.assign(ne,a);let oe="";switch(l){case"wgsl":break;case"glsl":oe=C?`${K}

// ----- PROLOGUE -------------------------
${JV({id:r,source:i,stage:s})}
${`#define SHADER_TYPE_${s.toUpperCase()}`}
${jV(t)}
${s==="fragment"?ZV:""}

// ----- APPLICATION DEFINES -------------------------

${QV(ne)}

`:`${K}
`;break}const fe=g5(v),ue={},we={},De={};for(const Fe in T){const Ke=typeof T[Fe]=="string"?{injection:T[Fe],order:0}:T[Fe],ze=/^(v|f)s:(#)?([\w-]+)$/.exec(Fe);if(ze){const it=ze[2],lt=ze[3];it?lt==="decl"?we[Fe]=[Ke]:De[Fe]=[Ke]:ue[Fe]=[Ke]}else De[Fe]=[Ke]}for(const Fe of h){k&&Fe.checkDeprecations($,k);const Ke=Fe.getModuleSource(s);oe+=Ke;const ze=Fe.injections[s];for(const it in ze){const lt=/^(v|f)s:#([\w-]+)$/.exec(it);if(lt){const ht=lt[2]==="decl"?we:De;ht[it]=ht[it]||[],ht[it].push(ze[it])}else ue[it]=ue[it]||[],ue[it].push(ze[it])}}return oe+="// ----- MAIN SHADER SOURCE -------------------------",oe+=_5,oe=j0(oe,s,we),oe+=m5(fe[s],ue),oe+=$,oe=j0(oe,s,De),l==="glsl"&&L!==O&&(oe=VV(oe,s)),oe.trim()}function w2(t){return function(e){const r={};for(const i of t){const s=i.getUniforms(e,r);Object.assign(r,s)}return r}}function JV(t){const{id:e,source:r,stage:i}=t;return e&&r.indexOf("SHADER_NAME")===-1?`
#define SHADER_NAME ${e}_${i}

`:""}function QV(t={}){let e="";for(const r in t){const i=t[r];(i||Number.isFinite(i))&&(e+=`#define ${r.toUpperCase()} ${t[r]}
`)}return e}class Np{static defaultShaderAssembler;_hookFunctions=[];_defaultModules=[];static getDefaultShaderAssembler(){return Np.defaultShaderAssembler=Np.defaultShaderAssembler||new Np,Np.defaultShaderAssembler}addDefaultModule(e){this._defaultModules.find(r=>r.name===(typeof e=="string"?e:e.name))||this._defaultModules.push(e)}removeDefaultModule(e){const r=typeof e=="string"?e:e.name;this._defaultModules=this._defaultModules.filter(i=>i.name!==r)}addShaderHook(e,r){r&&(e=Object.assign(r,{hook:e})),this._hookFunctions.push(e)}assembleShader(e){const r=this._getModuleList(e.modules),i=this._hookFunctions,s=ST(e);return{...XV({platformInfo:e.platformInfo,...s,modules:r,hookFunctions:i}),modules:r}}assembleShaderPair(e){const r=ST(e),i=this._getModuleList(e.modules),s=this._hookFunctions,{platformInfo:l}=e;return{...e.platformInfo.shaderLanguage==="wgsl"?KV({platformInfo:l,...r,modules:i,hookFunctions:s}):YV({platformInfo:l,...r,modules:i,hookFunctions:s}),modules:i}}_getModuleList(e=[]){const r=new Array(this._defaultModules.length+e.length),i={};let s=0;for(let l=0,h=this._defaultModules.length;l<h;++l){const a=this._defaultModules[l],v=a.name;r[s++]=a,i[v]=!0}for(let l=0,h=e.length;l<h;++l){const a=e[l],v=a.name;i[v]||(r[s++]=a,i[v]=!0)}return r.length=s,Dp.instantiateModules(r)}}const eG=`out vec4 transform_output;
void main() {
transform_output = vec4(0);
}`,tG=`#version 300 es
${eG}`;function rG(t){const{input:e,inputChannels:r,output:i}={};if(!e)return tG;if(!r)throw new Error("inputChannels");const s=iG(r),l=nG(e,r);return`#version 300 es
in ${s} ${e};
out vec4 ${i};
void main() {
  ${i} = ${l};
}`}function iG(t){switch(t){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`invalid channels: ${t}`)}}function nG(t,e){switch(e){case 1:return`vec4(${t}, 0.0, 0.0, 1.0)`;case 2:return`vec4(${t}, 0.0, 1.0)`;case 3:return`vec4(${t}, 1.0)`;case 4:return t;default:throw new Error(`invalid channels: ${e}`)}}const Ct=new Dm({id:"luma.gl"});class sG{stats=new Map;getStats(e){return this.get(e)}get(e){return this.stats.has(e)||this.stats.set(e,new Nm({id:e})),this.stats.get(e)}}const E2=new sG;function oG(){const t="9.0.27",e="set luma.log.level=1 (or higher) to trace rendering";if(globalThis.luma&&globalThis.luma.VERSION!==t)throw new Error(`luma.gl - multiple VERSIONs detected: ${globalThis.luma.VERSION} vs ${t}`);return globalThis.luma||(_d()&&Ct.log(1,`${t} - ${e}`)(),globalThis.luma=globalThis.luma||{VERSION:t,version:t,log:Ct,stats:E2}),t}const aG=oG();function lG(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)?t:null}function g_(t){return Array.isArray(t)?t.length===0||typeof t[0]=="number"?t:null:lG(t)}const Yv={};function yd(t="id"){Yv[t]=Yv[t]||1;const e=Yv[t]++;return`${t}-${e}`}function V0(t){let e=!0;for(const r in t){e=!1;break}return e}let Ti=class{static defaultProps={id:"undefined",handle:void 0,userData:void 0};id;props;userData={};_device;destroyed=!1;allocatedBytes=0;_attachedResources=new Set;constructor(t,e,r){if(!t)throw new Error("no device");this._device=t,this.props=cG(e,r);const i=this.props.id!=="undefined"?this.props.id:yd(this[Symbol.toStringTag]);this.props.id=i,this.id=i,this.userData=this.props.userData||{},this.addStats()}destroy(){this.destroyResource()}delete(){return this.destroy(),this}toString(){return`${this[Symbol.toStringTag]||this.constructor.name}(${this.id})`}getProps(){return this.props}attachResource(t){this._attachedResources.add(t)}detachResource(t){this._attachedResources.delete(t)}destroyAttachedResource(t){this._attachedResources.delete(t)&&t.destroy()}destroyAttachedResources(){for(const t of Object.values(this._attachedResources))t.destroy();this._attachedResources=new Set}destroyResource(){this.destroyAttachedResources(),this.removeStats(),this.destroyed=!0}removeStats(){const t=this._device.statsManager.getStats("Resource Counts"),e=this[Symbol.toStringTag];t.get(`${e}s Active`).decrementCount()}trackAllocatedMemory(t,e=this[Symbol.toStringTag]){const r=this._device.statsManager.getStats("Resource Counts");r.get("GPU Memory").addCount(t),r.get(`${e} Memory`).addCount(t),this.allocatedBytes=t}trackDeallocatedMemory(t=this[Symbol.toStringTag]){const e=this._device.statsManager.getStats("Resource Counts");e.get("GPU Memory").subtractCount(this.allocatedBytes),e.get(`${t} Memory`).subtractCount(this.allocatedBytes),this.allocatedBytes=0}addStats(){const t=this._device.statsManager.getStats("Resource Counts"),e=this[Symbol.toStringTag];t.get("Resources Created").incrementCount(),t.get(`${e}s Created`).incrementCount(),t.get(`${e}s Active`).incrementCount()}};function cG(t,e){const r={...e};for(const i in t)t[i]!==void 0&&(r[i]=t[i]);return r}class Ji extends Ti{static defaultProps={...Ti.defaultProps,usage:0,byteLength:0,byteOffset:0,data:null,indexType:"uint16",mappedAtCreation:!1};static MAP_READ=1;static MAP_WRITE=2;static COPY_SRC=4;static COPY_DST=8;static INDEX=16;static VERTEX=32;static UNIFORM=64;static STORAGE=128;static INDIRECT=256;static QUERY_RESOLVE=512;get[Symbol.toStringTag](){return"Buffer"}usage;indexType;updateTimestamp;constructor(e,r){const i={...r};(r.usage||0)&Ji.INDEX&&!r.indexType&&(r.data instanceof Uint32Array?i.indexType="uint32":r.data instanceof Uint16Array&&(i.indexType="uint16")),super(e,i,Ji.defaultProps),this.usage=r.usage||0,this.indexType=i.indexType,this.updateTimestamp=e.incrementTimestamp()}readSyncWebGL(e,r){throw new Error("not implemented")}static DEBUG_DATA_MAX_LENGTH=32;debugData=new ArrayBuffer(0);_setDebugData(e,r,i){const s=ArrayBuffer.isView(e)?e.buffer:e,l=Math.min(e?e.byteLength:i,Ji.DEBUG_DATA_MAX_LENGTH);e===null?this.debugData=new ArrayBuffer(l):r===0&&i===e.byteLength?this.debugData=s.slice(0,l):this.debugData=s.slice(r,r+l)}}function y5(t){const e=RT[t],r=uG(e),i=t.includes("norm"),s=!i&&!t.startsWith("float"),l=t.startsWith("s");return{dataType:RT[t],byteLength:r,integer:s,signed:l,normalized:i}}function uG(t){return hG[t]}const RT={uint8:"uint8",sint8:"sint8",unorm8:"uint8",snorm8:"sint8",uint16:"uint16",sint16:"sint16",unorm16:"uint16",snorm16:"sint16",float16:"float16",float32:"float32",uint32:"uint32",sint32:"sint32"},hG={uint8:1,sint8:1,uint16:2,sint16:2,float16:2,float32:4,uint32:4,sint32:4},dG=["bc1","bc2","bc3","bc4","bc5","bc6","bc7","etc1","etc2","eac","atc","astc","pvrtc"],pG=/^(rg?b?a?)([0-9]*)([a-z]*)(-srgb)?(-webgl|-unsized)?$/;function fG(t){return dG.some(e=>t.startsWith(e))}function v5(t){const e=pG.exec(t);if(e){const[,r,i,s,l,h]=e;if(r){const a=`${s}${i}`,v=y5(a);return{format:r,components:r.length,srgb:l==="-srgb",unsized:h==="-unsized",webgl:h==="-webgl",...v}}}return gG(t)}const mG={"rgba4unorm-webgl":{format:"rgba",bpp:2},"rgb565unorm-webgl":{format:"rgb",bpp:2},"rgb5a1unorm-webgl":{format:"rgba",bbp:2},rgb9e5ufloat:{format:"rgb",bbp:4},rg11b10ufloat:{format:"rgb",bbp:4},rgb10a2unorm:{format:"rgba",bbp:4},"rgb10a2uint-webgl":{format:"rgba",bbp:4},stencil8:{components:1,bpp:1,a:"stencil"},depth16unorm:{components:1,bpp:2,a:"depth"},depth24plus:{components:1,bpp:3,a:"depth"},depth32float:{components:1,bpp:4,a:"depth"},"depth24plus-stencil8":{components:2,bpp:4,a:"depth-stencil"},"depth24unorm-stencil8":{components:2,bpp:4,a:"depth-stencil"},"depth32float-stencil8":{components:2,bpp:4,a:"depth-stencil"}};function gG(t){const e=mG[t];if(!e)throw new Error(`Unknown format ${t}`);return{format:e.format||"",components:e.components||e.format?.length||1,byteLength:e.bpp||1,srgb:!1,unsized:!1}}class _G{}class yG{features;disabledFeatures;constructor(e=[],r){this.features=new Set(e),this.disabledFeatures=r||{}}*[Symbol.iterator](){yield*this.features}has(e){return!this.disabledFeatures[e]&&this.features.has(e)}}class _m{static defaultProps={id:null,canvas:null,container:null,manageState:!0,width:800,height:600,requestMaxLimits:!0,debug:!!Ct.get("debug"),spector:!!(Ct.get("spector")||Ct.get("spectorjs")),break:[],initalizeFeatures:!0,disabledFeatures:{"compilation-status-async-webgl":!0},gl:null,onError:e=>Ct.error(e.message)};get[Symbol.toStringTag](){return"Device"}static VERSION=aG;constructor(e){this.props={..._m.defaultProps,...e},this.id=this.props.id||yd(this[Symbol.toStringTag].toLowerCase())}id;props;userData={};statsManager=E2;_lumaData={};isTextureFormatCompressed(e){return fG(e)}loseDevice(){return!1}getCanvasContext(){if(!this.canvasContext)throw new Error("Device has no CanvasContext");return this.canvasContext}createTexture(e){return(e instanceof Promise||typeof e=="string")&&(e={data:e}),this._createTexture(e)}createCommandEncoder(e={}){throw new Error("not implemented")}readPixelsToArrayWebGL(e,r){throw new Error("not implemented")}readPixelsToBufferWebGL(e,r){throw new Error("not implemented")}setParametersWebGL(e){throw new Error("not implemented")}getParametersWebGL(e){throw new Error("not implemented")}withParametersWebGL(e,r){throw new Error("not implemented")}clearWebGL(e){throw new Error("not implemented")}resetWebGL(){throw new Error("not implemented")}timestamp=0;incrementTimestamp(){return this.timestamp++}onError(e){this.props.onError(e)}_getBufferProps(e){(e instanceof ArrayBuffer||ArrayBuffer.isView(e))&&(e={data:e});const r={...e};return(e.usage||0)&Ji.INDEX&&!e.indexType&&(e.data instanceof Uint32Array?r.indexType="uint32":e.data instanceof Uint16Array?r.indexType="uint16":Ct.warn("indices buffer content must be of integer type")()),r}}function fi(t,e){if(!t)throw new Error(e||"luma.gl: assertion failed.")}const kg=new Map;class am{static defaultProps={..._m.defaultProps,type:"best-available",devices:void 0};static stats=E2;static log=Ct;static registerDevices(e){for(const r of e)fi(r.type&&r.isSupported&&r.create),kg.set(r.type,r)}static getAvailableDevices(){return Array.from(kg).map(e=>e.type)}static getSupportedDevices(){return Array.from(kg).filter(e=>e.isSupported()).map(e=>e.type)}static setDefaultDeviceProps(e){Object.assign(_m.defaultProps,e)}static async attachDevice(e){const r=IT(e.devices)||kg;if(e.handle instanceof WebGL2RenderingContext){const i=r.get("webgl");if(i)return await i.attach(e.handle)}if(e.handle===null){const i=r.get("unknown");if(i)return await i.attach(null)}throw new Error("Failed to attach device. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.")}static async createDevice(e={}){e={...am.defaultProps,...e},e.gl&&(e.type="webgl");const r=IT(e.devices)||kg;let i,s;switch(e.type){case"webgpu":if(i=r.get("webgpu"),i)return await i.create(e);break;case"webgl":if(s=r.get("webgl"),s)return await s.create(e);break;case"unknown":const l=r.get("unknown");if(l)return await l.create(e);break;case"best-available":if(i=r.get("webgpu"),i?.isSupported?.())return await i.create(e);if(s=r.get("webgl"),s?.isSupported?.())return await s.create(e);break}throw new Error("No matching device found. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.")}static enforceWebGL2(e=!0){const r=HTMLCanvasElement.prototype;if(!e&&r.originalGetContext){r.getContext=r.originalGetContext,r.originalGetContext=void 0;return}r.originalGetContext=r.getContext,r.getContext=function(i,s){return i==="webgl"||i==="experimental-webgl"?this.originalGetContext("webgl2",s):this.originalGetContext(i,s)}}}function IT(t){if(!t||t?.length===0)return null;const e=new Map;for(const r of t)e.set(r.type,r);return e}const vG=_d()&&typeof document<"u",x1=()=>vG&&document.readyState==="complete",bG={canvas:null,width:800,height:600,useDevicePixels:!0,autoResize:!0,container:null,visible:!0,colorSpace:"srgb",alphaMode:"opaque"};class b5{id;props;canvas;htmlCanvas;offscreenCanvas;type;width=1;height=1;resizeObserver;_canvasSizeInfo={clientWidth:0,clientHeight:0,devicePixelRatio:1};static get isPageLoaded(){return x1()}static pageLoaded=xG();constructor(e){if(this.props={...bG,...e},e=this.props,!_d()){this.id="node-canvas-context",this.type="node",this.width=this.props.width,this.height=this.props.height,this.canvas=null;return}if(e.canvas)typeof e.canvas=="string"?this.canvas=EG(e.canvas):this.canvas=e.canvas;else{const r=AG(e),i=wG(e?.container||null);i.insertBefore(r,i.firstChild),this.canvas=r,e?.visible||(this.canvas.style.visibility="hidden")}this.canvas instanceof HTMLCanvasElement?(this.id=this.canvas.id,this.type="html-canvas",this.htmlCanvas=this.canvas):(this.id="offscreen-canvas",this.type="offscreen-canvas",this.offscreenCanvas=this.canvas),this.canvas instanceof HTMLCanvasElement&&e.autoResize&&(this.resizeObserver=new ResizeObserver(r=>{for(const i of r)i.target===this.canvas&&this.update()}),this.resizeObserver.observe(this.canvas))}getDevicePixelRatio(e){return typeof OffscreenCanvas<"u"&&this.canvas instanceof OffscreenCanvas||(e=e===void 0?this.props.useDevicePixels:e,!e||e<=0)?1:e===!0?typeof window<"u"&&window.devicePixelRatio||1:e}getPixelSize(){switch(this.type){case"node":return[this.width,this.height];case"offscreen-canvas":return[this.canvas.width,this.canvas.height];case"html-canvas":const e=this.getDevicePixelRatio(),r=this.canvas;return r.parentElement?[r.clientWidth*e,r.clientHeight*e]:[this.canvas.width,this.canvas.height];default:throw new Error(this.type)}}getAspect(){const[e,r]=this.getPixelSize();return e/r}cssToDeviceRatio(){try{const[e]=this.getDrawingBufferSize(),{clientWidth:r}=this._canvasSizeInfo;return r?e/r:1}catch{return 1}}cssToDevicePixels(e,r=!0){const i=this.cssToDeviceRatio(),[s,l]=this.getDrawingBufferSize();return TG(e,i,s,l,r)}setDevicePixelRatio(e,r={}){if(!this.htmlCanvas)return;let i="width"in r?r.width:this.htmlCanvas.clientWidth,s="height"in r?r.height:this.htmlCanvas.clientHeight;(!i||!s)&&(Ct.log(1,"Canvas clientWidth/clientHeight is 0")(),e=1,i=this.htmlCanvas.width||1,s=this.htmlCanvas.height||1);const l=this._canvasSizeInfo;if(l.clientWidth!==i||l.clientHeight!==s||l.devicePixelRatio!==e){let h=e;const a=Math.floor(i*h),v=Math.floor(s*h);this.htmlCanvas.width=a,this.htmlCanvas.height=v;const[T,C]=this.getDrawingBufferSize();(T!==a||C!==v)&&(h=Math.min(T/i,C/s),this.htmlCanvas.width=Math.floor(i*h),this.htmlCanvas.height=Math.floor(s*h),Ct.warn("Device pixel ratio clamped")()),this._canvasSizeInfo.clientWidth=i,this._canvasSizeInfo.clientHeight=s,this._canvasSizeInfo.devicePixelRatio=e}}getDrawingBufferSize(){const e=this.device.gl;if(!e)throw new Error("canvas size");return[e.drawingBufferWidth,e.drawingBufferHeight]}_setAutoCreatedCanvasId(e){this.htmlCanvas?.id==="lumagl-auto-created-canvas"&&(this.htmlCanvas.id=e)}}function xG(){return x1()||typeof window>"u"?Promise.resolve():new Promise(t=>{window.addEventListener("load",()=>t())})}function wG(t){if(typeof t=="string"){const e=document.getElementById(t);if(!e&&!x1())throw new Error(`Accessing '${t}' before page was loaded`);if(!e)throw new Error(`${t} is not an HTML element`);return e}else if(t)return t;return document.body}function EG(t){const e=document.getElementById(t);if(!e&&!x1())throw new Error(`Accessing '${t}' before page was loaded`);if(!(e instanceof HTMLCanvasElement))throw new Error("Object is not a canvas element");return e}function AG(t){const{width:e,height:r}=t,i=document.createElement("canvas");return i.id="lumagl-auto-created-canvas",i.width=e||1,i.height=r||1,i.style.width=Number.isFinite(e)?`${e}px`:"100%",i.style.height=Number.isFinite(r)?`${r}px`:"100%",i}function TG(t,e,r,i,s){const l=t,h=kT(l[0],e,r);let a=BT(l[1],e,i,s),v=kT(l[0]+1,e,r);const T=v===r-1?v:v-1;v=BT(l[1]+1,e,i,s);let C;return s?(v=v===0?v:v+1,C=a,a=v):C=v===i-1?v:v-1,{x:h,y:a,width:Math.max(T-h+1,1),height:Math.max(C-a+1,1)}}function kT(t,e,r){return Math.min(Math.round(t*e),r-1)}function BT(t,e,r,i){return i?Math.max(0,r-1-Math.round(t*e)):Math.min(Math.round(t*e),r-1)}class Va extends Ti{static defaultProps={...Ti.defaultProps,data:null,dimension:"2d",format:"rgba8unorm",width:void 0,height:void 0,depth:1,mipmaps:!0,compressed:!1,usage:0,mipLevels:void 0,samples:void 0,type:void 0,sampler:{},view:void 0};static COPY_SRC=1;static COPY_DST=2;static TEXTURE_BINDING=4;static STORAGE_BINDING=8;static RENDER_ATTACHMENT=16;get[Symbol.toStringTag](){return"Texture"}dimension;format;width;height;depth;updateTimestamp;constructor(e,r,i=Va.defaultProps){super(e,r,i),this.dimension=this.props.dimension,this.format=this.props.format,this.width=this.props.width,this.height=this.props.height,this.depth=this.props.depth,this.updateTimestamp=e.incrementTimestamp()}}class w1 extends Ti{static defaultProps={...Ti.defaultProps,format:void 0,dimension:void 0,aspect:"all",baseMipLevel:0,mipLevelCount:void 0,baseArrayLayer:0,arrayLayerCount:void 0};get[Symbol.toStringTag](){return"TextureView"}constructor(e,r){super(e,r,w1.defaultProps)}}function SG(t,e,r){let i="";const s=e.split(/\r?\n/),l=t.slice().sort((h,a)=>h.lineNum-a.lineNum);switch(r?.showSourceCode||"no"){case"all":let h=0;for(let a=1;a<=s.length;a++)for(i+=x5(s[a-1],a,r);l.length>h&&l[h].lineNum===a;){const v=l[h++];i+=LT(v,s,v.lineNum,{...r,inlineSource:!1})}return i;case"issues":case"no":for(const a of t)i+=LT(a,s,a.lineNum,{inlineSource:r?.showSourceCode!=="no"});return i}}function LT(t,e,r,i){if(i?.inlineSource){const s=CG(e,r),l=t.linePos>0?`${" ".repeat(t.linePos+5)}^^^
`:"";return`
${s}${l}${t.type.toUpperCase()}: ${t.message}

`}return i?.html?`<div class='luma-compiler-log-error' style="color:red;"><b> ${t.type.toUpperCase()}: ${t.message}</b></div>`:`${t.type.toUpperCase()}: ${t.message}`}function CG(t,e,r){let i="";for(let s=e-2;s<=e;s++){const l=t[s-1];l!==void 0&&(i+=x5(l,e,r))}return i}function x5(t,e,r){const i=r?.html?PG(t):t;return`${MG(String(e),4)}: ${i}${r?.html?"<br/>":`
`}`}function MG(t,e){let r="";for(let i=t.length;i<e;++i)r+=" ";return r+t}function PG(t){return t.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}function w5(t,e){return{name:RG(t,e),language:"glsl",version:IG(t)}}function RG(t,e="unnamed"){const r=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/.exec(t);return r?r[1]:e}function IG(t){let e=100;const r=t.match(/[^\s]+/g);if(r&&r.length>=2&&r[0]==="#version"){const i=parseInt(r[1],10);Number.isFinite(i)&&(e=i)}return e}class E1 extends Ti{static defaultProps={...Ti.defaultProps,language:"auto",stage:void 0,source:"",sourceMap:null,entryPoint:"main",debug:"errors"};get[Symbol.toStringTag](){return"Shader"}stage;source;compilationStatus="pending";constructor(e,r){super(e,{id:kG(r),...r},E1.defaultProps),this.stage=this.props.stage,this.source=this.props.source}getCompilationInfoSync(){return null}getTranslatedSource(){return null}async debugShader(e=this.props.debug){switch(e){case"never":return;case"errors":if(this.compilationStatus==="success")return;break}const r=await this.getCompilationInfo();this.props.debug==="warnings"&&r?.length===0||this._displayShaderLog(r)}_displayShaderLog(e){if(typeof document>"u"||!document?.createElement)return;const r=w5(this.source).name,i=`${this.stage} ${r}`;let s=SG(e,this.source,{showSourceCode:"all",html:!0});const l=this.getTranslatedSource();l&&(s+=`<br /><br /><h1>Translated Source</h1><br /><br /><code style="user-select:text;"><pre>${l}</pre></code>`);const h=document.createElement("Button");h.innerHTML=`
<h1>Shader Compilation Error in ${i}</h1><br /><br />
<code style="user-select:text;"><pre>
${s}
</pre></code>`,h.style.top="10px",h.style.left="10px",h.style.position="absolute",h.style.zIndex="9999",h.style.width="100%",h.style.textAlign="left",document.body.appendChild(h);const a=document.getElementsByClassName("luma-compiler-log-error");a[0]?.scrollIntoView&&a[0].scrollIntoView(),h.onclick=()=>{const v=`data:text/plain,${encodeURIComponent(this.source)}`;navigator.clipboard.writeText(v)}}}function kG(t){return w5(t.source).name||t.id||yd(`unnamed ${t.stage}-shader`)}class A1 extends Ti{static defaultProps={...Ti.defaultProps,type:"color-sampler",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",addressModeW:"clamp-to-edge",magFilter:"nearest",minFilter:"nearest",mipmapFilter:"nearest",lodMinClamp:0,lodMaxClamp:32,compare:"less-equal",maxAnisotropy:1};get[Symbol.toStringTag](){return"Sampler"}constructor(e,r){super(e,r,A1.defaultProps)}}class T1 extends Ti{static defaultProps={...Ti.defaultProps,width:1,height:1,colorAttachments:[],depthStencilAttachment:null};get[Symbol.toStringTag](){return"Framebuffer"}width;height;colorAttachments=[];depthStencilAttachment=null;constructor(e,r={}){super(e,r,T1.defaultProps),this.width=this.props.width,this.height=this.props.height}resize(e){let r=!e;if(e){const[i,s]=Array.isArray(e)?e:[e.width,e.height];r=r||s!==this.height||i!==this.width,this.width=i,this.height=s}r&&(Ct.log(2,`Resizing framebuffer ${this.id} to ${this.width}x${this.height}`)(),this.resizeAttachments(this.width,this.height))}autoCreateAttachmentTextures(){if(this.props.colorAttachments.length===0&&!this.props.depthStencilAttachment)throw new Error("Framebuffer has noattachments");this.colorAttachments=this.props.colorAttachments.map(r=>{if(typeof r=="string"){const i=this.createColorTexture(r);return this.attachResource(i),i.view}return r instanceof Va?r.view:r});const e=this.props.depthStencilAttachment;if(e)if(typeof e=="string"){const r=this.createDepthStencilTexture(e);this.attachResource(r),this.depthStencilAttachment=r.view}else e instanceof Va?this.depthStencilAttachment=e.view:this.depthStencilAttachment=e}createColorTexture(e){return this.device.createTexture({id:"color-attachment",usage:Va.RENDER_ATTACHMENT,format:e,width:this.width,height:this.height})}createDepthStencilTexture(e){return this.device.createTexture({id:"depth-stencil-attachment",usage:Va.RENDER_ATTACHMENT,format:e,width:this.width,height:this.height})}resizeAttachments(e,r){for(let i=0;i<this.colorAttachments.length;++i)if(this.colorAttachments[i]){const s=this.device._createTexture({...this.colorAttachments[i].props,width:e,height:r});this.destroyAttachedResource(this.colorAttachments[i]),this.colorAttachments[i]=s.view,this.attachResource(s.view)}if(this.depthStencilAttachment){const i=this.device._createTexture({...this.depthStencilAttachment.props,width:e,height:r});this.destroyAttachedResource(this.depthStencilAttachment),this.depthStencilAttachment=i.view,this.attachResource(i)}}}class ym extends Ti{static defaultProps={...Ti.defaultProps,vs:null,vertexEntryPoint:"vertexMain",vsConstants:{},fs:null,fragmentEntryPoint:"fragmentMain",fsConstants:{},shaderLayout:null,bufferLayout:[],topology:"triangle-list",parameters:{},bindings:{},uniforms:{}};get[Symbol.toStringTag](){return"RenderPipeline"}shaderLayout;bufferLayout;linkStatus="pending";hash="";constructor(e,r){super(e,r,ym.defaultProps),this.shaderLayout=this.props.shaderLayout,this.bufferLayout=this.props.bufferLayout||[]}setUniformsWebGL(e){throw new Error("Use uniform blocks")}}class A2 extends Ti{static defaultProps={...Ti.defaultProps,framebuffer:null,parameters:void 0,clearColor:[0,0,0,0],clearDepth:1,clearStencil:0,depthReadOnly:!1,stencilReadOnly:!1,discard:!1,occlusionQuerySet:void 0,timestampQuerySet:void 0,beginTimestampIndex:void 0,endTimestampIndex:void 0};get[Symbol.toStringTag](){return"RenderPass"}constructor(e,r){super(e,r,A2.defaultProps)}}class G0 extends Ti{static defaultProps={...Ti.defaultProps,shader:void 0,entryPoint:void 0,constants:{},shaderLayout:void 0};get[Symbol.toStringTag](){return"ComputePipeline"}hash="";constructor(e,r){super(e,r,G0.defaultProps)}}class T2 extends Ti{static defaultProps={...Ti.defaultProps,measureExecutionTime:void 0};get[Symbol.toStringTag](){return"CommandEncoder"}constructor(e,r){super(e,r,T2.defaultProps)}}class S2 extends Ti{static defaultProps={...Ti.defaultProps};get[Symbol.toStringTag](){return"CommandBuffer"}constructor(e,r){super(e,r,S2.defaultProps)}}function BG(t){const[e,r]=DG[t],i=e==="i32"||e==="u32",s=e!=="u32",l=NG[e]*r,h=LG(e,r);return{dataType:e,components:r,defaultVertexFormat:h,byteLength:l,integer:i,signed:s}}function LG(t,e){let r;switch(t){case"f32":r="float32";break;case"i32":r="sint32";break;case"u32":r="uint32";break;case"f16":return e<=2?"float16x2":"float16x4"}return e===1?r:`${r}x${e}`}const DG={f32:["f32",1],"vec2<f32>":["f32",2],"vec3<f32>":["f32",3],"vec4<f32>":["f32",4],f16:["f16",1],"vec2<f16>":["f16",2],"vec3<f16>":["f16",3],"vec4<f16>":["f16",4],i32:["i32",1],"vec2<i32>":["i32",2],"vec3<i32>":["i32",3],"vec4<i32>":["i32",4],u32:["u32",1],"vec2<u32>":["u32",2],"vec3<u32>":["u32",3],"vec4<u32>":["u32",4]},NG={f32:4,f16:2,i32:4,u32:4};function E5(t){let e;t.endsWith("-webgl")&&(t.replace("-webgl",""),e=!0);const[r,i]=t.split("x"),s=r,l=i?parseInt(i):1,h=y5(s),a={type:s,components:l,byteLength:h.byteLength*l,integer:h.integer,signed:h.signed,normalized:h.normalized};return e&&(a.webglOnly=!0),a}function A5(t,e){const r={};for(const i of t.attributes)r[i.name]=FG(t,e,i.name);return r}function OG(t,e,r=16){const i=A5(t,e),s=new Array(r).fill(null);for(const l of Object.values(i))s[l.location]=l;return s}function FG(t,e,r){const i=zG(t,r),s=UG(e,r);if(!i)return null;const l=BG(i.type),h=s?.vertexFormat||l.defaultVertexFormat,a=E5(h);return{attributeName:s?.attributeName||i.name,bufferName:s?.bufferName||i.name,location:i.location,shaderType:i.type,shaderDataType:l.dataType,shaderComponents:l.components,vertexFormat:h,bufferDataType:a.type,bufferComponents:a.components,normalized:a.normalized,integer:l.integer,stepMode:s?.stepMode||i.stepMode,byteOffset:s?.byteOffset||0,byteStride:s?.byteStride||0}}function zG(t,e){const r=t.attributes.find(i=>i.name===e);return r||Ct.warn(`shader layout attribute "${e}" not present in shader`),r||null}function UG(t,e){jG(t);let r=VG(t,e);return r||(r=GG(t,e),r)?r:(Ct.warn(`layout for attribute "${e}" not present in buffer layout`),null)}function jG(t){for(const e of t)(e.attributes&&e.format||!e.attributes&&!e.format)&&Ct.warn(`BufferLayout ${name} must have either 'attributes' or 'format' field`)}function VG(t,e){for(const r of t)if(r.format&&r.name===e)return{attributeName:r.name,bufferName:e,stepMode:r.stepMode,vertexFormat:r.format,byteOffset:0,byteStride:r.byteStride||0};return null}function GG(t,e){for(const r of t){let i=r.byteStride;if(typeof r.byteStride!="number")for(const l of r.attributes||[]){const h=E5(l.format);i+=h.byteLength}const s=r.attributes?.find(l=>l.attribute===e);if(s)return{attributeName:s.attribute,bufferName:r.name,stepMode:r.stepMode,vertexFormat:s.format,byteOffset:s.byteOffset,byteStride:i}}return null}function HG(t,e){const r={...t,attributes:t.attributes.map(i=>({...i}))};for(const i of e?.attributes||[]){const s=r.attributes.find(l=>l.name===i.name);s?(s.type=i.type||s.type,s.stepMode=i.stepMode||s.stepMode):Ct.warn(`shader layout attribute ${i.name} not present in shader`)}return r}class C2 extends Ti{static defaultProps={...Ti.defaultProps,renderPipeline:null};get[Symbol.toStringTag](){return"VertexArray"}maxVertexAttributes;attributeInfos;indexBuffer=null;attributes;constructor(e,r){super(e,r,C2.defaultProps),this.maxVertexAttributes=e.limits.maxVertexAttributes,this.attributes=new Array(this.maxVertexAttributes).fill(null),this.attributeInfos=OG(r.renderPipeline.shaderLayout,r.renderPipeline.bufferLayout,this.maxVertexAttributes)}setConstantWebGL(e,r){throw new Error("constant attributes not supported")}}class M2 extends Ti{static defaultProps={...Ti.defaultProps,layout:void 0,buffers:{}};get[Symbol.toStringTag](){return"TransformFeedback"}constructor(e,r){super(e,r,M2.defaultProps)}}class P2 extends Ti{static defaultProps={...Ti.defaultProps,type:void 0,count:void 0};get[Symbol.toStringTag](){return"QuerySet"}constructor(e,r){super(e,r,P2.defaultProps)}}const WG={f32:{type:"f32",components:1},i32:{type:"i32",components:1},u32:{type:"u32",components:1},"vec2<f32>":{type:"f32",components:2},"vec3<f32>":{type:"f32",components:3},"vec4<f32>":{type:"f32",components:4},"vec2<i32>":{type:"i32",components:2},"vec3<i32>":{type:"i32",components:3},"vec4<i32>":{type:"i32",components:4},"vec2<u32>":{type:"u32",components:2},"vec3<u32>":{type:"u32",components:3},"vec4<u32>":{type:"u32",components:4},"mat2x2<f32>":{type:"f32",components:4},"mat2x3<f32>":{type:"f32",components:6},"mat2x4<f32>":{type:"f32",components:8},"mat3x2<f32>":{type:"f32",components:6},"mat3x3<f32>":{type:"f32",components:9},"mat3x4<f32>":{type:"f32",components:12},"mat4x2<f32>":{type:"f32",components:8},"mat4x3<f32>":{type:"f32",components:12},"mat4x4<f32>":{type:"f32",components:16}};function qG(t){const e=WG[t];return fi(t),e}function $G(t,e){switch(e){case 1:return t;case 2:return t+t%2;default:return t+(4-t%4)%4}}let Uy;function T5(t){return(!Uy||Uy.byteLength<t)&&(Uy=new ArrayBuffer(t)),Uy}function ZG(t,e){const r=T5(t.BYTES_PER_ELEMENT*e);return new t(r,0,e)}function XG(t){const{target:e,source:r,start:i=0,count:s=1}=t,l=r.length,h=s*l;let a=0;for(let v=i;a<l;a++)e[v++]=r[a];for(;a<h;)a<h-a?(e.copyWithin(i+a,i,i+a),a*=2):(e.copyWithin(i+a,i,i+h-a),a=h);return t.target}const DT=1024;class KG{layout={};byteLength;constructor(e){let r=0;for(const[s,l]of Object.entries(e)){const h=qG(l),{type:a,components:v}=h;r=$G(r,v);const T=r;r+=v,this.layout[s]={type:a,size:v,offset:T}}r+=(4-r%4)%4;const i=r*4;this.byteLength=Math.max(i,DT)}getData(e){const r=Math.max(this.byteLength,DT),i=T5(r),s={i32:new Int32Array(i),u32:new Uint32Array(i),f32:new Float32Array(i),f16:new Uint16Array(i)};for(const[l,h]of Object.entries(e)){const a=this.layout[l];if(!a){Ct.warn(`Supplied uniform value ${l} not present in uniform block layout`)();continue}const{type:v,size:T,offset:C}=a,k=s[v];if(T===1){if(typeof h!="number"&&typeof h!="boolean"){Ct.warn(`Supplied value for single component uniform ${l} is not a number: ${h}`)();continue}k[C]=Number(h)}else{const L=g_(h);if(!L){Ct.warn(`Supplied value for multi component / array uniform ${l} is not a numeric array: ${h}`)();continue}k.set(L,C)}}return new Uint8Array(i)}has(e){return!!this.layout[e]}get(e){return this.layout[e]}}function YG(t,e,r=16){if(t!==e)return!1;const i=g_(t);if(!i)return!1;const s=g_(e);if(s&&i.length===s.length){for(let l=0;l<i.length;++l)if(s[l]!==i[l])return!1}return!0}function JG(t){const e=g_(t);return e?e.slice():t}class QG{name;uniforms={};modifiedUniforms={};modified=!0;bindingLayout={};needsRedraw="initialized";constructor(e){if(this.name=e?.name,e?.name&&e?.shaderLayout){const r=e?.shaderLayout.bindings?.find(s=>s.type==="uniform"&&s.name===e?.name);if(!r)throw new Error(e?.name);const i=r;for(const s of i.uniforms||[])this.bindingLayout[s.name]=s}}setUniforms(e){for(const[r,i]of Object.entries(e))this._setUniform(r,i),this.needsRedraw||this.setNeedsRedraw(`${this.name}.${r}=${i}`)}setNeedsRedraw(e){this.needsRedraw=this.needsRedraw||e}getAllUniforms(){return this.modifiedUniforms={},this.needsRedraw=!1,this.uniforms||{}}_setUniform(e,r){YG(this.uniforms[e],r)||(this.uniforms[e]=JG(r),this.modifiedUniforms[e]=!0,this.modified=!0)}}class eH{uniformBlocks=new Map;uniformBufferLayouts=new Map;uniformBuffers=new Map;constructor(e){for(const[r,i]of Object.entries(e)){const s=r,l=new KG(i.uniformTypes||{});this.uniformBufferLayouts.set(s,l);const h=new QG({name:r});h.setUniforms(i.defaultUniforms||{}),this.uniformBlocks.set(s,h)}}destroy(){for(const e of this.uniformBuffers.values())e.destroy()}setUniforms(e){for(const[r,i]of Object.entries(e))this.uniformBlocks.get(r).setUniforms(i);this.updateUniformBuffers()}getUniformBufferByteLength(e){return this.uniformBufferLayouts.get(e).byteLength}getUniformBufferData(e){const r=this.uniformBlocks.get(e).getAllUniforms();return this.uniformBufferLayouts.get(e).getData(r)}createUniformBuffer(e,r,i){i&&this.setUniforms(i);const s=this.getUniformBufferByteLength(r),l=e.createBuffer({usage:Ji.UNIFORM|Ji.COPY_DST,byteLength:s}),h=this.getUniformBufferData(r);return l.write(h),l}getManagedUniformBuffer(e,r){if(!this.uniformBuffers.get(r)){const i=this.getUniformBufferByteLength(r),s=e.createBuffer({usage:Ji.UNIFORM|Ji.COPY_DST,byteLength:i});this.uniformBuffers.set(r,s)}return this.uniformBuffers.get(r)}updateUniformBuffers(){let e=!1;for(const r of this.uniformBlocks.keys()){const i=this.updateUniformBuffer(r);e||=i}return e&&Ct.log(3,`UniformStore.updateUniformBuffers(): ${e}`)(),e}updateUniformBuffer(e){const r=this.uniformBlocks.get(e),i=this.uniformBuffers.get(e);let s=!1;if(i&&r.needsRedraw){s||=r.needsRedraw;const l=this.getUniformBufferData(e);this.uniformBuffers.get(e).write(l);const h=this.uniformBlocks.get(e).getAllUniforms();Ct.log(4,`Writing to uniform buffer ${String(e)}`,l,h)()}return s}}function S5(t){const e=ArrayBuffer.isView(t)?t.constructor:t;switch(e){case Float32Array:return"float32";case Uint16Array:return"uint16";case Uint32Array:return"uint32";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int8Array:return"sint8";case Int16Array:return"sint16";case Int32Array:return"sint32";default:throw new Error(e.constructor.name)}}function C5(t){switch(t){case"float32":return Float32Array;case"uint32":return Uint32Array;case"sint32":return Int32Array;case"uint16":case"unorm16":return Uint16Array;case"sint16":case"snorm16":return Int16Array;case"uint8":case"unorm8":return Uint8Array;case"sint8":case"snorm8":return Int8Array;default:throw new Error(t)}}function tH(t,e,r){if(!e||e>4)throw new Error(`size ${e}`);const i=e;let s=S5(t);if(s==="uint8"&&r&&i===1)return"unorm8-webgl";if(s==="uint8"&&r&&i===3)return"unorm8x3-webgl";if(s==="uint8"||s==="sint8"){if(i===1||i===3)throw new Error(`size: ${e}`);return r&&(s=s.replace("int","norm")),`${s}x${i}`}if(s==="uint16"||s==="sint16"){if(i===1||i===3)throw new Error(`size: ${e}`);return r&&(s=s.replace("int","norm")),`${s}x${i}`}return i===1?s:`${s}x${i}`}function rH(t){return g_(t)!==null||typeof t=="number"||typeof t=="boolean"}function R2(t){const e={bindings:{},uniforms:{}};return Object.keys(t).forEach(r=>{const i=t[r];rH(i)?e.uniforms[r]=i:e.bindings[r]=i}),e}function iH(t,e,r){const{removedProps:i={},deprecatedProps:s={},replacedProps:l={}}=r;for(const a in i)if(a in e){const v=i[a]?`${t}.${i[a]}`:"N/A";Ct.removed(`${t}.${a}`,v)()}for(const a in s)if(a in e){const v=s[a];Ct.deprecated(`${t}.${a}`,`${t}.${v}`)()}let h=null;for(const[a,v]of Object.entries(l))a in e&&(Ct.deprecated(`${t}.${a}`,`${t}.${v}`)(),h=h||Object.assign({},e),h[v]=e[a],delete h[a]);return h||e}let nH="";async function sH(t,e){return await new Promise((r,i)=>{try{const s=new Image;s.onload=()=>r(s),s.onerror=()=>i(new Error(`Could not load image ${t}.`)),s.crossOrigin=e?.crossOrigin||"anonymous",s.src=t.startsWith("http")?t:nH+t}catch(s){i(s)}})}async function M5(t,e){const r=document.getElementsByTagName("head")[0];if(!r)throw new Error("loadScript");const i=document.createElement("script");return i.setAttribute("type","text/javascript"),i.setAttribute("src",t),new Promise((s,l)=>{i.onload=s,i.onerror=h=>l(new Error(`Unable to load script '${t}': ${h}`)),r.appendChild(i)})}function Mx(t,e,r){if(t===e)return!0;if(!r||!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let i=0;i<t.length;i++)if(!Mx(t[i],e[i],r-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const i=Object.keys(t),s=Object.keys(e);if(i.length!==s.length)return!1;for(const l of i)if(!e.hasOwnProperty(l)||!Mx(t[l],e[l],r-1))return!1;return!0}return!1}function oH(t){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(t):setTimeout(t,1e3/60)}function aH(t){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(t):clearTimeout(t)}class lH{constructor(){this.constants=new Map,this.aliases=new Map,this.structs=new Map}}class ch{constructor(){}get isAstNode(){return!0}get astNodeType(){return""}evaluate(e){throw new Error("Cannot evaluate node")}evaluateString(e){return this.evaluate(e).toString()}search(e){}searchBlock(e,r){if(e){r(H0.instance);for(const i of e)i instanceof Array?this.searchBlock(i,r):i.search(r);r(W0.instance)}}}class H0 extends ch{}H0.instance=new H0;class W0 extends ch{}W0.instance=new W0;class an extends ch{constructor(){super()}}class Px extends an{constructor(e,r,i,s,l,h){super(),this.calls=new Set,this.name=e,this.args=r,this.returnType=i,this.body=s,this.startLine=l,this.endLine=h}get astNodeType(){return"function"}search(e){this.searchBlock(this.body,e)}}class cH extends an{constructor(e){super(),this.expression=e}get astNodeType(){return"staticAssert"}search(e){this.expression.search(e)}}class uH extends an{constructor(e,r){super(),this.condition=e,this.body=r}get astNodeType(){return"while"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class hH extends an{constructor(e){super(),this.body=e}get astNodeType(){return"continuing"}search(e){this.searchBlock(this.body,e)}}class dH extends an{constructor(e,r,i,s){super(),this.init=e,this.condition=r,this.increment=i,this.body=s}get astNodeType(){return"for"}search(e){var r,i,s;(r=this.init)===null||r===void 0||r.search(e),(i=this.condition)===null||i===void 0||i.search(e),(s=this.increment)===null||s===void 0||s.search(e),this.searchBlock(this.body,e)}}class Ip extends an{constructor(e,r,i,s,l){super(),this.name=e,this.type=r,this.storage=i,this.access=s,this.value=l}get astNodeType(){return"var"}search(e){var r;e(this),(r=this.value)===null||r===void 0||r.search(e)}}class P5 extends an{constructor(e,r,i){super(),this.name=e,this.type=r,this.value=i}get astNodeType(){return"override"}search(e){var r;(r=this.value)===null||r===void 0||r.search(e)}}class Rx extends an{constructor(e,r,i,s,l){super(),this.name=e,this.type=r,this.storage=i,this.access=s,this.value=l}get astNodeType(){return"let"}search(e){var r;e(this),(r=this.value)===null||r===void 0||r.search(e)}}class NT extends an{constructor(e,r,i,s,l){super(),this.name=e,this.type=r,this.storage=i,this.access=s,this.value=l}get astNodeType(){return"const"}evaluate(e){return this.value.evaluate(e)}search(e){var r;e(this),(r=this.value)===null||r===void 0||r.search(e)}}var vm;(function(t){t.increment="++",t.decrement="--"})(vm||(vm={}));(function(t){function e(r){const i=r;if(i=="parse")throw new Error("Invalid value for IncrementOperator");return t[i]}t.parse=e})(vm||(vm={}));class pH extends an{constructor(e,r){super(),this.operator=e,this.variable=r}get astNodeType(){return"increment"}search(e){this.variable.search(e)}}var __;(function(t){t.assign="=",t.addAssign="+=",t.subtractAssin="-=",t.multiplyAssign="*=",t.divideAssign="/=",t.moduloAssign="%=",t.andAssign="&=",t.orAssign="|=",t.xorAssign="^=",t.shiftLeftAssign="<<=",t.shiftRightAssign=">>="})(__||(__={}));(function(t){function e(r){const i=r;if(i=="parse")throw new Error("Invalid value for AssignOperator");return i}t.parse=e})(__||(__={}));class fH extends an{constructor(e,r,i){super(),this.operator=e,this.variable=r,this.value=i}get astNodeType(){return"assign"}search(e){this.variable.search(e),this.value.search(e)}}class R5 extends an{constructor(e,r){super(),this.name=e,this.args=r}get astNodeType(){return"call"}search(e){for(const r of this.args)r.search(e);e(this)}}class mH extends an{constructor(e,r){super(),this.body=e,this.continuing=r}get astNodeType(){return"loop"}}class gH extends an{constructor(e,r){super(),this.condition=e,this.body=r}get astNodeType(){return"body"}}class _H extends an{constructor(e,r,i,s){super(),this.condition=e,this.body=r,this.elseif=i,this.else=s}get astNodeType(){return"if"}search(e){this.condition.search(e),this.searchBlock(this.body,e),this.searchBlock(this.elseif,e),this.searchBlock(this.else,e)}}class yH extends an{constructor(e){super(),this.value=e}get astNodeType(){return"return"}search(e){var r;(r=this.value)===null||r===void 0||r.search(e)}}class vH extends an{constructor(e){super(),this.name=e}get astNodeType(){return"enable"}}class bH extends an{constructor(e){super(),this.extensions=e}get astNodeType(){return"requires"}}class xH extends an{constructor(e,r){super(),this.severity=e,this.rule=r}get astNodeType(){return"diagnostic"}}class I5 extends an{constructor(e,r){super(),this.name=e,this.type=r}get astNodeType(){return"alias"}}class wH extends an{constructor(){super()}get astNodeType(){return"discard"}}class EH extends an{constructor(){super()}get astNodeType(){return"break"}}class AH extends an{constructor(){super()}get astNodeType(){return"continue"}}class Yp extends an{constructor(e){super(),this.name=e}get astNodeType(){return"type"}get isStruct(){return!1}get isArray(){return!1}}class Rp extends Yp{constructor(e,r,i,s){super(e),this.members=r,this.startLine=i,this.endLine=s}get astNodeType(){return"struct"}get isStruct(){return!0}getMemberIndex(e){for(let r=0;r<this.members.length;r++)if(this.members[r].name==e)return r;return-1}}class k5 extends Yp{constructor(e,r,i){super(e),this.format=r,this.access=i}get astNodeType(){return"template"}}class TH extends Yp{constructor(e,r,i,s){super(e),this.storage=r,this.type=i,this.access=s}get astNodeType(){return"pointer"}}class B5 extends Yp{constructor(e,r,i,s){super(e),this.attributes=r,this.format=i,this.count=s}get astNodeType(){return"array"}get isArray(){return!0}}class qg extends Yp{constructor(e,r,i){super(e),this.format=r,this.access=i}get astNodeType(){return"sampler"}}class uu extends ch{constructor(){super()}}class SH extends uu{constructor(e){super(),this.value=e}get astNodeType(){return"stringExpr"}toString(){return this.value}evaluateString(){return this.value}}class Yf extends uu{constructor(e,r){super(),this.type=e,this.args=r}get astNodeType(){return"createExpr"}search(e){if(e(this),this.args)for(const r of this.args)r.search(e)}evaluate(e){return this.args[0].evaluate(e)}}class L5 extends uu{constructor(e,r){super(),this.name=e,this.args=r}get astNodeType(){return"callExpr"}evaluate(e){switch(this.name){case"abs":return Math.abs(this.args[0].evaluate(e));case"acos":return Math.acos(this.args[0].evaluate(e));case"acosh":return Math.acosh(this.args[0].evaluate(e));case"asin":return Math.asin(this.args[0].evaluate(e));case"asinh":return Math.asinh(this.args[0].evaluate(e));case"atan":return Math.atan(this.args[0].evaluate(e));case"atan2":return Math.atan2(this.args[0].evaluate(e),this.args[1].evaluate(e));case"atanh":return Math.atanh(this.args[0].evaluate(e));case"ceil":return Math.ceil(this.args[0].evaluate(e));case"clamp":return Math.min(Math.max(this.args[0].evaluate(e),this.args[1].evaluate(e)),this.args[2].evaluate(e));case"cos":return Math.cos(this.args[0].evaluate(e));case"degrees":return this.args[0].evaluate(e)*180/Math.PI;case"distance":return Math.sqrt(Math.pow(this.args[0].evaluate(e)-this.args[1].evaluate(e),2));case"dot":case"exp":return Math.exp(this.args[0].evaluate(e));case"exp2":return Math.pow(2,this.args[0].evaluate(e));case"floor":return Math.floor(this.args[0].evaluate(e));case"fma":return this.args[0].evaluate(e)*this.args[1].evaluate(e)+this.args[2].evaluate(e);case"fract":return this.args[0].evaluate(e)-Math.floor(this.args[0].evaluate(e));case"inverseSqrt":return 1/Math.sqrt(this.args[0].evaluate(e));case"log":return Math.log(this.args[0].evaluate(e));case"log2":return Math.log2(this.args[0].evaluate(e));case"max":return Math.max(this.args[0].evaluate(e),this.args[1].evaluate(e));case"min":return Math.min(this.args[0].evaluate(e),this.args[1].evaluate(e));case"mix":return this.args[0].evaluate(e)*(1-this.args[2].evaluate(e))+this.args[1].evaluate(e)*this.args[2].evaluate(e);case"modf":return this.args[0].evaluate(e)-Math.floor(this.args[0].evaluate(e));case"pow":return Math.pow(this.args[0].evaluate(e),this.args[1].evaluate(e));case"radians":return this.args[0].evaluate(e)*Math.PI/180;case"round":return Math.round(this.args[0].evaluate(e));case"sign":return Math.sign(this.args[0].evaluate(e));case"sin":return Math.sin(this.args[0].evaluate(e));case"sinh":return Math.sinh(this.args[0].evaluate(e));case"saturate":return Math.min(Math.max(this.args[0].evaluate(e),0),1);case"smoothstep":return this.args[0].evaluate(e)*this.args[0].evaluate(e)*(3-2*this.args[0].evaluate(e));case"sqrt":return Math.sqrt(this.args[0].evaluate(e));case"step":return this.args[0].evaluate(e)<this.args[1].evaluate(e)?0:1;case"tan":return Math.tan(this.args[0].evaluate(e));case"tanh":return Math.tanh(this.args[0].evaluate(e));case"trunc":return Math.trunc(this.args[0].evaluate(e));default:throw new Error("Non const function: "+this.name)}}search(e){for(const r of this.args)r.search(e);e(this)}}class Ix extends uu{constructor(e){super(),this.name=e}get astNodeType(){return"varExpr"}search(e){e(this),this.postfix&&this.postfix.search(e)}evaluate(e){const r=e.constants.get(this.name);if(!r)throw new Error("Cannot evaluate node");return r.evaluate(e)}}class OT extends uu{constructor(e,r){super(),this.name=e,this.initializer=r}get astNodeType(){return"constExpr"}evaluate(e){var r,i;if(this.initializer instanceof Yf){const s=(r=this.postfix)===null||r===void 0?void 0:r.evaluateString(e),l=(i=this.initializer.type)===null||i===void 0?void 0:i.name,h=e.structs.get(l),a=h?.getMemberIndex(s);return a!==void 0&&a!=-1?this.initializer.args[a].evaluate(e):this.initializer.evaluate(e)}return this.initializer.evaluate(e)}search(e){this.initializer.search(e)}}class FT extends uu{constructor(e){super(),this.value=e}get astNodeType(){return"literalExpr"}evaluate(){return this.value}}class CH extends uu{constructor(e,r){super(),this.type=e,this.value=r}get astNodeType(){return"bitcastExpr"}search(e){this.value.search(e)}}class zT extends uu{constructor(e){super(),this.contents=e}get astNodeType(){return"groupExpr"}evaluate(e){return this.contents[0].evaluate(e)}search(e){this.searchBlock(this.contents,e)}}class MH extends uu{constructor(e){super(),this.index=e}search(e){this.index.search(e)}}class D5 extends uu{constructor(){super()}}class PH extends D5{constructor(e,r){super(),this.operator=e,this.right=r}get astNodeType(){return"unaryOp"}evaluate(e){switch(this.operator){case"+":return this.right.evaluate(e);case"-":return-this.right.evaluate(e);case"!":return this.right.evaluate(e)?0:1;case"~":return~this.right.evaluate(e);default:throw new Error("Unknown unary operator: "+this.operator)}}search(e){this.right.search(e)}}class Xc extends D5{constructor(e,r,i){super(),this.operator=e,this.left=r,this.right=i}get astNodeType(){return"binaryOp"}evaluate(e){switch(this.operator){case"+":return this.left.evaluate(e)+this.right.evaluate(e);case"-":return this.left.evaluate(e)-this.right.evaluate(e);case"*":return this.left.evaluate(e)*this.right.evaluate(e);case"/":return this.left.evaluate(e)/this.right.evaluate(e);case"%":return this.left.evaluate(e)%this.right.evaluate(e);case"==":return this.left.evaluate(e)==this.right.evaluate(e)?1:0;case"!=":return this.left.evaluate(e)!=this.right.evaluate(e)?1:0;case"<":return this.left.evaluate(e)<this.right.evaluate(e)?1:0;case">":return this.left.evaluate(e)>this.right.evaluate(e)?1:0;case"<=":return this.left.evaluate(e)<=this.right.evaluate(e)?1:0;case">=":return this.left.evaluate(e)>=this.right.evaluate(e)?1:0;case"&&":return this.left.evaluate(e)&&this.right.evaluate(e)?1:0;case"||":return this.left.evaluate(e)||this.right.evaluate(e)?1:0;default:throw new Error(`Unknown operator ${this.operator}`)}}search(e){this.left.search(e),this.right.search(e)}}class N5 extends ch{constructor(){super()}}class RH extends N5{constructor(e,r){super(),this.selector=e,this.body=r}get astNodeType(){return"case"}search(e){this.searchBlock(this.body,e)}}class IH extends N5{constructor(e){super(),this.body=e}get astNodeType(){return"default"}search(e){this.searchBlock(this.body,e)}}class kH extends ch{constructor(e,r,i){super(),this.name=e,this.type=r,this.attributes=i}get astNodeType(){return"argument"}}class BH extends ch{constructor(e,r){super(),this.condition=e,this.body=r}get astNodeType(){return"elseif"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class LH extends ch{constructor(e,r,i){super(),this.name=e,this.type=r,this.attributes=i}get astNodeType(){return"member"}}let DH=class extends ch{constructor(t,e){super(),this.name=t,this.value=e}get astNodeType(){return"attribute"}};var et,Ve;(function(t){t[t.token=0]="token",t[t.keyword=1]="keyword",t[t.reserved=2]="reserved"})(Ve||(Ve={}));class Ge{constructor(e,r,i){this.name=e,this.type=r,this.rule=i}toString(){return this.name}}class me{}et=me;me.none=new Ge("",Ve.reserved,"");me.eof=new Ge("EOF",Ve.token,"");me.reserved={asm:new Ge("asm",Ve.reserved,"asm"),bf16:new Ge("bf16",Ve.reserved,"bf16"),do:new Ge("do",Ve.reserved,"do"),enum:new Ge("enum",Ve.reserved,"enum"),f16:new Ge("f16",Ve.reserved,"f16"),f64:new Ge("f64",Ve.reserved,"f64"),handle:new Ge("handle",Ve.reserved,"handle"),i8:new Ge("i8",Ve.reserved,"i8"),i16:new Ge("i16",Ve.reserved,"i16"),i64:new Ge("i64",Ve.reserved,"i64"),mat:new Ge("mat",Ve.reserved,"mat"),premerge:new Ge("premerge",Ve.reserved,"premerge"),regardless:new Ge("regardless",Ve.reserved,"regardless"),typedef:new Ge("typedef",Ve.reserved,"typedef"),u8:new Ge("u8",Ve.reserved,"u8"),u16:new Ge("u16",Ve.reserved,"u16"),u64:new Ge("u64",Ve.reserved,"u64"),unless:new Ge("unless",Ve.reserved,"unless"),using:new Ge("using",Ve.reserved,"using"),vec:new Ge("vec",Ve.reserved,"vec"),void:new Ge("void",Ve.reserved,"void")};me.keywords={array:new Ge("array",Ve.keyword,"array"),atomic:new Ge("atomic",Ve.keyword,"atomic"),bool:new Ge("bool",Ve.keyword,"bool"),f32:new Ge("f32",Ve.keyword,"f32"),i32:new Ge("i32",Ve.keyword,"i32"),mat2x2:new Ge("mat2x2",Ve.keyword,"mat2x2"),mat2x3:new Ge("mat2x3",Ve.keyword,"mat2x3"),mat2x4:new Ge("mat2x4",Ve.keyword,"mat2x4"),mat3x2:new Ge("mat3x2",Ve.keyword,"mat3x2"),mat3x3:new Ge("mat3x3",Ve.keyword,"mat3x3"),mat3x4:new Ge("mat3x4",Ve.keyword,"mat3x4"),mat4x2:new Ge("mat4x2",Ve.keyword,"mat4x2"),mat4x3:new Ge("mat4x3",Ve.keyword,"mat4x3"),mat4x4:new Ge("mat4x4",Ve.keyword,"mat4x4"),ptr:new Ge("ptr",Ve.keyword,"ptr"),sampler:new Ge("sampler",Ve.keyword,"sampler"),sampler_comparison:new Ge("sampler_comparison",Ve.keyword,"sampler_comparison"),struct:new Ge("struct",Ve.keyword,"struct"),texture_1d:new Ge("texture_1d",Ve.keyword,"texture_1d"),texture_2d:new Ge("texture_2d",Ve.keyword,"texture_2d"),texture_2d_array:new Ge("texture_2d_array",Ve.keyword,"texture_2d_array"),texture_3d:new Ge("texture_3d",Ve.keyword,"texture_3d"),texture_cube:new Ge("texture_cube",Ve.keyword,"texture_cube"),texture_cube_array:new Ge("texture_cube_array",Ve.keyword,"texture_cube_array"),texture_multisampled_2d:new Ge("texture_multisampled_2d",Ve.keyword,"texture_multisampled_2d"),texture_storage_1d:new Ge("texture_storage_1d",Ve.keyword,"texture_storage_1d"),texture_storage_2d:new Ge("texture_storage_2d",Ve.keyword,"texture_storage_2d"),texture_storage_2d_array:new Ge("texture_storage_2d_array",Ve.keyword,"texture_storage_2d_array"),texture_storage_3d:new Ge("texture_storage_3d",Ve.keyword,"texture_storage_3d"),texture_depth_2d:new Ge("texture_depth_2d",Ve.keyword,"texture_depth_2d"),texture_depth_2d_array:new Ge("texture_depth_2d_array",Ve.keyword,"texture_depth_2d_array"),texture_depth_cube:new Ge("texture_depth_cube",Ve.keyword,"texture_depth_cube"),texture_depth_cube_array:new Ge("texture_depth_cube_array",Ve.keyword,"texture_depth_cube_array"),texture_depth_multisampled_2d:new Ge("texture_depth_multisampled_2d",Ve.keyword,"texture_depth_multisampled_2d"),texture_external:new Ge("texture_external",Ve.keyword,"texture_external"),u32:new Ge("u32",Ve.keyword,"u32"),vec2:new Ge("vec2",Ve.keyword,"vec2"),vec3:new Ge("vec3",Ve.keyword,"vec3"),vec4:new Ge("vec4",Ve.keyword,"vec4"),bitcast:new Ge("bitcast",Ve.keyword,"bitcast"),block:new Ge("block",Ve.keyword,"block"),break:new Ge("break",Ve.keyword,"break"),case:new Ge("case",Ve.keyword,"case"),continue:new Ge("continue",Ve.keyword,"continue"),continuing:new Ge("continuing",Ve.keyword,"continuing"),default:new Ge("default",Ve.keyword,"default"),diagnostic:new Ge("diagnostic",Ve.keyword,"diagnostic"),discard:new Ge("discard",Ve.keyword,"discard"),else:new Ge("else",Ve.keyword,"else"),enable:new Ge("enable",Ve.keyword,"enable"),fallthrough:new Ge("fallthrough",Ve.keyword,"fallthrough"),false:new Ge("false",Ve.keyword,"false"),fn:new Ge("fn",Ve.keyword,"fn"),for:new Ge("for",Ve.keyword,"for"),function:new Ge("function",Ve.keyword,"function"),if:new Ge("if",Ve.keyword,"if"),let:new Ge("let",Ve.keyword,"let"),const:new Ge("const",Ve.keyword,"const"),loop:new Ge("loop",Ve.keyword,"loop"),while:new Ge("while",Ve.keyword,"while"),private:new Ge("private",Ve.keyword,"private"),read:new Ge("read",Ve.keyword,"read"),read_write:new Ge("read_write",Ve.keyword,"read_write"),return:new Ge("return",Ve.keyword,"return"),requires:new Ge("requires",Ve.keyword,"requires"),storage:new Ge("storage",Ve.keyword,"storage"),switch:new Ge("switch",Ve.keyword,"switch"),true:new Ge("true",Ve.keyword,"true"),alias:new Ge("alias",Ve.keyword,"alias"),type:new Ge("type",Ve.keyword,"type"),uniform:new Ge("uniform",Ve.keyword,"uniform"),var:new Ge("var",Ve.keyword,"var"),override:new Ge("override",Ve.keyword,"override"),workgroup:new Ge("workgroup",Ve.keyword,"workgroup"),write:new Ge("write",Ve.keyword,"write"),r8unorm:new Ge("r8unorm",Ve.keyword,"r8unorm"),r8snorm:new Ge("r8snorm",Ve.keyword,"r8snorm"),r8uint:new Ge("r8uint",Ve.keyword,"r8uint"),r8sint:new Ge("r8sint",Ve.keyword,"r8sint"),r16uint:new Ge("r16uint",Ve.keyword,"r16uint"),r16sint:new Ge("r16sint",Ve.keyword,"r16sint"),r16float:new Ge("r16float",Ve.keyword,"r16float"),rg8unorm:new Ge("rg8unorm",Ve.keyword,"rg8unorm"),rg8snorm:new Ge("rg8snorm",Ve.keyword,"rg8snorm"),rg8uint:new Ge("rg8uint",Ve.keyword,"rg8uint"),rg8sint:new Ge("rg8sint",Ve.keyword,"rg8sint"),r32uint:new Ge("r32uint",Ve.keyword,"r32uint"),r32sint:new Ge("r32sint",Ve.keyword,"r32sint"),r32float:new Ge("r32float",Ve.keyword,"r32float"),rg16uint:new Ge("rg16uint",Ve.keyword,"rg16uint"),rg16sint:new Ge("rg16sint",Ve.keyword,"rg16sint"),rg16float:new Ge("rg16float",Ve.keyword,"rg16float"),rgba8unorm:new Ge("rgba8unorm",Ve.keyword,"rgba8unorm"),rgba8unorm_srgb:new Ge("rgba8unorm_srgb",Ve.keyword,"rgba8unorm_srgb"),rgba8snorm:new Ge("rgba8snorm",Ve.keyword,"rgba8snorm"),rgba8uint:new Ge("rgba8uint",Ve.keyword,"rgba8uint"),rgba8sint:new Ge("rgba8sint",Ve.keyword,"rgba8sint"),bgra8unorm:new Ge("bgra8unorm",Ve.keyword,"bgra8unorm"),bgra8unorm_srgb:new Ge("bgra8unorm_srgb",Ve.keyword,"bgra8unorm_srgb"),rgb10a2unorm:new Ge("rgb10a2unorm",Ve.keyword,"rgb10a2unorm"),rg11b10float:new Ge("rg11b10float",Ve.keyword,"rg11b10float"),rg32uint:new Ge("rg32uint",Ve.keyword,"rg32uint"),rg32sint:new Ge("rg32sint",Ve.keyword,"rg32sint"),rg32float:new Ge("rg32float",Ve.keyword,"rg32float"),rgba16uint:new Ge("rgba16uint",Ve.keyword,"rgba16uint"),rgba16sint:new Ge("rgba16sint",Ve.keyword,"rgba16sint"),rgba16float:new Ge("rgba16float",Ve.keyword,"rgba16float"),rgba32uint:new Ge("rgba32uint",Ve.keyword,"rgba32uint"),rgba32sint:new Ge("rgba32sint",Ve.keyword,"rgba32sint"),rgba32float:new Ge("rgba32float",Ve.keyword,"rgba32float"),static_assert:new Ge("static_assert",Ve.keyword,"static_assert")};me.tokens={decimal_float_literal:new Ge("decimal_float_literal",Ve.token,/((-?[0-9]*\.[0-9]+|-?[0-9]+\.[0-9]*)((e|E)(\+|-)?[0-9]+)?f?)|(-?[0-9]+(e|E)(\+|-)?[0-9]+f?)|([0-9]+f)/),hex_float_literal:new Ge("hex_float_literal",Ve.token,/-?0x((([0-9a-fA-F]*\.[0-9a-fA-F]+|[0-9a-fA-F]+\.[0-9a-fA-F]*)((p|P)(\+|-)?[0-9]+f?)?)|([0-9a-fA-F]+(p|P)(\+|-)?[0-9]+f?))/),int_literal:new Ge("int_literal",Ve.token,/-?0x[0-9a-fA-F]+|0i?|-?[1-9][0-9]*i?/),uint_literal:new Ge("uint_literal",Ve.token,/0x[0-9a-fA-F]+u|0u|[1-9][0-9]*u/),ident:new Ge("ident",Ve.token,/[_a-zA-Z][0-9a-zA-Z_]*/),and:new Ge("and",Ve.token,"&"),and_and:new Ge("and_and",Ve.token,"&&"),arrow:new Ge("arrow ",Ve.token,"->"),attr:new Ge("attr",Ve.token,"@"),forward_slash:new Ge("forward_slash",Ve.token,"/"),bang:new Ge("bang",Ve.token,"!"),bracket_left:new Ge("bracket_left",Ve.token,"["),bracket_right:new Ge("bracket_right",Ve.token,"]"),brace_left:new Ge("brace_left",Ve.token,"{"),brace_right:new Ge("brace_right",Ve.token,"}"),colon:new Ge("colon",Ve.token,":"),comma:new Ge("comma",Ve.token,","),equal:new Ge("equal",Ve.token,"="),equal_equal:new Ge("equal_equal",Ve.token,"=="),not_equal:new Ge("not_equal",Ve.token,"!="),greater_than:new Ge("greater_than",Ve.token,">"),greater_than_equal:new Ge("greater_than_equal",Ve.token,">="),shift_right:new Ge("shift_right",Ve.token,">>"),less_than:new Ge("less_than",Ve.token,"<"),less_than_equal:new Ge("less_than_equal",Ve.token,"<="),shift_left:new Ge("shift_left",Ve.token,"<<"),modulo:new Ge("modulo",Ve.token,"%"),minus:new Ge("minus",Ve.token,"-"),minus_minus:new Ge("minus_minus",Ve.token,"--"),period:new Ge("period",Ve.token,"."),plus:new Ge("plus",Ve.token,"+"),plus_plus:new Ge("plus_plus",Ve.token,"++"),or:new Ge("or",Ve.token,"|"),or_or:new Ge("or_or",Ve.token,"||"),paren_left:new Ge("paren_left",Ve.token,"("),paren_right:new Ge("paren_right",Ve.token,")"),semicolon:new Ge("semicolon",Ve.token,";"),star:new Ge("star",Ve.token,"*"),tilde:new Ge("tilde",Ve.token,"~"),underscore:new Ge("underscore",Ve.token,"_"),xor:new Ge("xor",Ve.token,"^"),plus_equal:new Ge("plus_equal",Ve.token,"+="),minus_equal:new Ge("minus_equal",Ve.token,"-="),times_equal:new Ge("times_equal",Ve.token,"*="),division_equal:new Ge("division_equal",Ve.token,"/="),modulo_equal:new Ge("modulo_equal",Ve.token,"%="),and_equal:new Ge("and_equal",Ve.token,"&="),or_equal:new Ge("or_equal",Ve.token,"|="),xor_equal:new Ge("xor_equal",Ve.token,"^="),shift_right_equal:new Ge("shift_right_equal",Ve.token,">>="),shift_left_equal:new Ge("shift_left_equal",Ve.token,"<<=")};me.simpleTokens={"@":et.tokens.attr,"{":et.tokens.brace_left,"}":et.tokens.brace_right,":":et.tokens.colon,",":et.tokens.comma,"(":et.tokens.paren_left,")":et.tokens.paren_right,";":et.tokens.semicolon};me.literalTokens={"&":et.tokens.and,"&&":et.tokens.and_and,"->":et.tokens.arrow,"/":et.tokens.forward_slash,"!":et.tokens.bang,"[":et.tokens.bracket_left,"]":et.tokens.bracket_right,"=":et.tokens.equal,"==":et.tokens.equal_equal,"!=":et.tokens.not_equal,">":et.tokens.greater_than,">=":et.tokens.greater_than_equal,">>":et.tokens.shift_right,"<":et.tokens.less_than,"<=":et.tokens.less_than_equal,"<<":et.tokens.shift_left,"%":et.tokens.modulo,"-":et.tokens.minus,"--":et.tokens.minus_minus,".":et.tokens.period,"+":et.tokens.plus,"++":et.tokens.plus_plus,"|":et.tokens.or,"||":et.tokens.or_or,"*":et.tokens.star,"~":et.tokens.tilde,_:et.tokens.underscore,"^":et.tokens.xor,"+=":et.tokens.plus_equal,"-=":et.tokens.minus_equal,"*=":et.tokens.times_equal,"/=":et.tokens.division_equal,"%=":et.tokens.modulo_equal,"&=":et.tokens.and_equal,"|=":et.tokens.or_equal,"^=":et.tokens.xor_equal,">>=":et.tokens.shift_right_equal,"<<=":et.tokens.shift_left_equal};me.regexTokens={decimal_float_literal:et.tokens.decimal_float_literal,hex_float_literal:et.tokens.hex_float_literal,int_literal:et.tokens.int_literal,uint_literal:et.tokens.uint_literal,ident:et.tokens.ident};me.storage_class=[et.keywords.function,et.keywords.private,et.keywords.workgroup,et.keywords.uniform,et.keywords.storage];me.access_mode=[et.keywords.read,et.keywords.write,et.keywords.read_write];me.sampler_type=[et.keywords.sampler,et.keywords.sampler_comparison];me.sampled_texture_type=[et.keywords.texture_1d,et.keywords.texture_2d,et.keywords.texture_2d_array,et.keywords.texture_3d,et.keywords.texture_cube,et.keywords.texture_cube_array];me.multisampled_texture_type=[et.keywords.texture_multisampled_2d];me.storage_texture_type=[et.keywords.texture_storage_1d,et.keywords.texture_storage_2d,et.keywords.texture_storage_2d_array,et.keywords.texture_storage_3d];me.depth_texture_type=[et.keywords.texture_depth_2d,et.keywords.texture_depth_2d_array,et.keywords.texture_depth_cube,et.keywords.texture_depth_cube_array,et.keywords.texture_depth_multisampled_2d];me.texture_external_type=[et.keywords.texture_external];me.any_texture_type=[...et.sampled_texture_type,...et.multisampled_texture_type,...et.storage_texture_type,...et.depth_texture_type,...et.texture_external_type];me.texel_format=[et.keywords.r8unorm,et.keywords.r8snorm,et.keywords.r8uint,et.keywords.r8sint,et.keywords.r16uint,et.keywords.r16sint,et.keywords.r16float,et.keywords.rg8unorm,et.keywords.rg8snorm,et.keywords.rg8uint,et.keywords.rg8sint,et.keywords.r32uint,et.keywords.r32sint,et.keywords.r32float,et.keywords.rg16uint,et.keywords.rg16sint,et.keywords.rg16float,et.keywords.rgba8unorm,et.keywords.rgba8unorm_srgb,et.keywords.rgba8snorm,et.keywords.rgba8uint,et.keywords.rgba8sint,et.keywords.bgra8unorm,et.keywords.bgra8unorm_srgb,et.keywords.rgb10a2unorm,et.keywords.rg11b10float,et.keywords.rg32uint,et.keywords.rg32sint,et.keywords.rg32float,et.keywords.rgba16uint,et.keywords.rgba16sint,et.keywords.rgba16float,et.keywords.rgba32uint,et.keywords.rgba32sint,et.keywords.rgba32float];me.const_literal=[et.tokens.int_literal,et.tokens.uint_literal,et.tokens.decimal_float_literal,et.tokens.hex_float_literal,et.keywords.true,et.keywords.false];me.literal_or_ident=[et.tokens.ident,et.tokens.int_literal,et.tokens.uint_literal,et.tokens.decimal_float_literal,et.tokens.hex_float_literal];me.element_count_expression=[et.tokens.int_literal,et.tokens.uint_literal,et.tokens.ident];me.template_types=[et.keywords.vec2,et.keywords.vec3,et.keywords.vec4,et.keywords.mat2x2,et.keywords.mat2x3,et.keywords.mat2x4,et.keywords.mat3x2,et.keywords.mat3x3,et.keywords.mat3x4,et.keywords.mat4x2,et.keywords.mat4x3,et.keywords.mat4x4,et.keywords.atomic,et.keywords.bitcast,...et.any_texture_type];me.attribute_name=[et.tokens.ident,et.keywords.block,et.keywords.diagnostic];me.assignment_operators=[et.tokens.equal,et.tokens.plus_equal,et.tokens.minus_equal,et.tokens.times_equal,et.tokens.division_equal,et.tokens.modulo_equal,et.tokens.and_equal,et.tokens.or_equal,et.tokens.xor_equal,et.tokens.shift_right_equal,et.tokens.shift_left_equal];me.increment_operators=[et.tokens.plus_plus,et.tokens.minus_minus];class UT{constructor(e,r,i){this.type=e,this.lexeme=r,this.line=i}toString(){return this.lexeme}isTemplateType(){return me.template_types.indexOf(this.type)!=-1}isArrayType(){return this.type==me.keywords.array}isArrayOrTemplateType(){return this.isArrayType()||this.isTemplateType()}}class NH{constructor(e){this._tokens=[],this._start=0,this._current=0,this._line=1,this._source=e??""}scanTokens(){for(;!this._isAtEnd();)if(this._start=this._current,!this.scanToken())throw`Invalid syntax at line ${this._line}`;return this._tokens.push(new UT(me.eof,"",this._line)),this._tokens}scanToken(){let e=this._advance();if(e==`
`)return this._line++,!0;if(this._isWhitespace(e))return!0;if(e=="/"){if(this._peekAhead()=="/"){for(;e!=`
`;){if(this._isAtEnd())return!0;e=this._advance()}return this._line++,!0}else if(this._peekAhead()=="*"){this._advance();let h=1;for(;h>0;){if(this._isAtEnd())return!0;if(e=this._advance(),e==`
`)this._line++;else if(e=="*"){if(this._peekAhead()=="/"&&(this._advance(),h--,h==0))return!0}else e=="/"&&this._peekAhead()=="*"&&(this._advance(),h++)}return!0}}const r=me.simpleTokens[e];if(r)return this._addToken(r),!0;let i=me.none;const s=this._isAlpha(e),l=e==="_";if(this._isAlphaNumeric(e)){let h=this._peekAhead();for(;this._isAlphaNumeric(h);)e+=this._advance(),h=this._peekAhead()}if(s){const h=me.keywords[e];if(h)return this._addToken(h),!0}if(s||l)return this._addToken(me.tokens.ident),!0;for(;;){let h=this._findType(e);const a=this._peekAhead();if(e=="-"&&this._tokens.length>0){if(a=="=")return this._current++,e+=a,this._addToken(me.tokens.minus_equal),!0;if(a=="-")return this._current++,e+=a,this._addToken(me.tokens.minus_minus),!0;const v=this._tokens.length-1;if((me.literal_or_ident.indexOf(this._tokens[v].type)!=-1||this._tokens[v].type==me.tokens.paren_right)&&a!=">")return this._addToken(h),!0}if(e==">"&&(a==">"||a=="=")){let v=!1,T=this._tokens.length-1;for(let C=0;C<5&&T>=0&&me.assignment_operators.indexOf(this._tokens[T].type)===-1;++C,--T)if(this._tokens[T].type===me.tokens.less_than){T>0&&this._tokens[T-1].isArrayOrTemplateType()&&(v=!0);break}if(v)return this._addToken(h),!0}if(h===me.none){let v=e,T=0;const C=2;for(let k=0;k<C;++k)if(v+=this._peekAhead(k),h=this._findType(v),h!==me.none){T=k;break}if(h===me.none)return i===me.none?!1:(this._current--,this._addToken(i),!0);e=v,this._current+=T+1}if(i=h,this._isAtEnd())break;e+=this._advance()}return i===me.none?!1:(this._addToken(i),!0)}_findType(e){for(const i in me.regexTokens){const s=me.regexTokens[i];if(this._match(e,s.rule))return s}return me.literalTokens[e]||me.none}_match(e,r){const i=r.exec(e);return i&&i.index==0&&i[0]==e}_isAtEnd(){return this._current>=this._source.length}_isAlpha(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"}_isAlphaNumeric(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"||e=="_"||e>="0"&&e<="9"}_isWhitespace(e){return e==" "||e=="	"||e=="\r"}_advance(e=0){let r=this._source[this._current];return e=e||0,e++,this._current+=e,r}_peekAhead(e=0){return e=e||0,this._current+e>=this._source.length?"\0":this._source[this._current+e]}_addToken(e){const r=this._source.substring(this._start,this._current);this._tokens.push(new UT(e,r,this._line))}}class OH{constructor(){this._tokens=[],this._current=0,this._currentLine=0,this._context=new lH,this._deferArrayCountEval=[]}parse(e){this._initialize(e),this._deferArrayCountEval.length=0;const r=[];for(;!this._isAtEnd();){const i=this._global_decl_or_directive();if(!i)break;r.push(i)}if(this._deferArrayCountEval.length>0){for(const i of this._deferArrayCountEval){const s=i.arrayType,l=i.countNode;if(l instanceof Ix){const h=l.name,a=this._context.constants.get(h);if(a)try{const v=a.evaluate(this._context);s.count=v}catch{}}}this._deferArrayCountEval.length=0}return r}_initialize(e){if(e)if(typeof e=="string"){const r=new NH(e);this._tokens=r.scanTokens()}else this._tokens=e;else this._tokens=[];this._current=0}_error(e,r){return{token:e,message:r,toString:function(){return`${r}`}}}_isAtEnd(){return this._current>=this._tokens.length||this._peek().type==me.eof}_match(e){if(e instanceof Ge)return this._check(e)?(this._advance(),!0):!1;for(let r=0,i=e.length;r<i;++r){const s=e[r];if(this._check(s))return this._advance(),!0}return!1}_consume(e,r){if(this._check(e))return this._advance();throw this._error(this._peek(),r)}_check(e){if(this._isAtEnd())return!1;const r=this._peek();if(e instanceof Array){const i=r.type;return e.indexOf(i)!=-1}return r.type==e}_advance(){var e,r;return this._currentLine=(r=(e=this._peek())===null||e===void 0?void 0:e.line)!==null&&r!==void 0?r:-1,this._isAtEnd()||this._current++,this._previous()}_peek(){return this._tokens[this._current]}_previous(){return this._tokens[this._current-1]}_global_decl_or_directive(){for(;this._match(me.tokens.semicolon)&&!this._isAtEnd(););if(this._match(me.keywords.alias)){const r=this._type_alias();return this._consume(me.tokens.semicolon,"Expected ';'"),r}if(this._match(me.keywords.diagnostic)){const r=this._diagnostic();return this._consume(me.tokens.semicolon,"Expected ';'"),r}if(this._match(me.keywords.requires)){const r=this._requires_directive();return this._consume(me.tokens.semicolon,"Expected ';'"),r}if(this._match(me.keywords.enable)){const r=this._enable_directive();return this._consume(me.tokens.semicolon,"Expected ';'"),r}const e=this._attribute();if(this._check(me.keywords.var)){const r=this._global_variable_decl();return r!=null&&(r.attributes=e),this._consume(me.tokens.semicolon,"Expected ';'."),r}if(this._check(me.keywords.override)){const r=this._override_variable_decl();return r!=null&&(r.attributes=e),this._consume(me.tokens.semicolon,"Expected ';'."),r}if(this._check(me.keywords.let)){const r=this._global_let_decl();return r!=null&&(r.attributes=e),this._consume(me.tokens.semicolon,"Expected ';'."),r}if(this._check(me.keywords.const)){const r=this._global_const_decl();return r!=null&&(r.attributes=e),this._consume(me.tokens.semicolon,"Expected ';'."),r}if(this._check(me.keywords.struct)){const r=this._struct_decl();return r!=null&&(r.attributes=e),r}if(this._check(me.keywords.fn)){const r=this._function_decl();return r!=null&&(r.attributes=e),r}return null}_function_decl(){if(!this._match(me.keywords.fn))return null;const e=this._currentLine,r=this._consume(me.tokens.ident,"Expected function name.").toString();this._consume(me.tokens.paren_left,"Expected '(' for function arguments.");const i=[];if(!this._check(me.tokens.paren_right))do{if(this._check(me.tokens.paren_right))break;const a=this._attribute(),v=this._consume(me.tokens.ident,"Expected argument name.").toString();this._consume(me.tokens.colon,"Expected ':' for argument type.");const T=this._attribute(),C=this._type_decl();C!=null&&(C.attributes=T,i.push(new kH(v,C,a)))}while(this._match(me.tokens.comma));this._consume(me.tokens.paren_right,"Expected ')' after function arguments.");let s=null;if(this._match(me.tokens.arrow)){const a=this._attribute();s=this._type_decl(),s!=null&&(s.attributes=a)}const l=this._compound_statement(),h=this._currentLine;return new Px(r,i,s,l,e,h)}_compound_statement(){const e=[];for(this._consume(me.tokens.brace_left,"Expected '{' for block.");!this._check(me.tokens.brace_right);){const r=this._statement();r!==null&&e.push(r)}return this._consume(me.tokens.brace_right,"Expected '}' for block."),e}_statement(){for(;this._match(me.tokens.semicolon)&&!this._isAtEnd(););if(this._check(me.tokens.attr)&&this._attribute(),this._check(me.keywords.if))return this._if_statement();if(this._check(me.keywords.switch))return this._switch_statement();if(this._check(me.keywords.loop))return this._loop_statement();if(this._check(me.keywords.for))return this._for_statement();if(this._check(me.keywords.while))return this._while_statement();if(this._check(me.keywords.continuing))return this._continuing_statement();if(this._check(me.keywords.static_assert))return this._static_assert_statement();if(this._check(me.tokens.brace_left))return this._compound_statement();let e=null;return this._check(me.keywords.return)?e=this._return_statement():this._check([me.keywords.var,me.keywords.let,me.keywords.const])?e=this._variable_statement():this._match(me.keywords.discard)?e=new wH:this._match(me.keywords.break)?e=new EH:this._match(me.keywords.continue)?e=new AH:e=this._increment_decrement_statement()||this._func_call_statement()||this._assignment_statement(),e!=null&&this._consume(me.tokens.semicolon,"Expected ';' after statement."),e}_static_assert_statement(){if(!this._match(me.keywords.static_assert))return null;const e=this._optional_paren_expression();return new cH(e)}_while_statement(){if(!this._match(me.keywords.while))return null;const e=this._optional_paren_expression();this._check(me.tokens.attr)&&this._attribute();const r=this._compound_statement();return new uH(e,r)}_continuing_statement(){if(!this._match(me.keywords.continuing))return null;const e=this._compound_statement();return new hH(e)}_for_statement(){if(!this._match(me.keywords.for))return null;this._consume(me.tokens.paren_left,"Expected '('.");const e=this._check(me.tokens.semicolon)?null:this._for_init();this._consume(me.tokens.semicolon,"Expected ';'.");const r=this._check(me.tokens.semicolon)?null:this._short_circuit_or_expression();this._consume(me.tokens.semicolon,"Expected ';'.");const i=this._check(me.tokens.paren_right)?null:this._for_increment();this._consume(me.tokens.paren_right,"Expected ')'."),this._check(me.tokens.attr)&&this._attribute();const s=this._compound_statement();return new dH(e,r,i,s)}_for_init(){return this._variable_statement()||this._func_call_statement()||this._assignment_statement()}_for_increment(){return this._func_call_statement()||this._increment_decrement_statement()||this._assignment_statement()}_variable_statement(){if(this._check(me.keywords.var)){const e=this._variable_decl();if(e===null)throw this._error(this._peek(),"Variable declaration expected.");let r=null;return this._match(me.tokens.equal)&&(r=this._short_circuit_or_expression()),new Ip(e.name,e.type,e.storage,e.access,r)}if(this._match(me.keywords.let)){const e=this._consume(me.tokens.ident,"Expected name for let.").toString();let r=null;if(this._match(me.tokens.colon)){const s=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=s)}this._consume(me.tokens.equal,"Expected '=' for let.");const i=this._short_circuit_or_expression();return new Rx(e,r,null,null,i)}if(this._match(me.keywords.const)){const e=this._consume(me.tokens.ident,"Expected name for const.").toString();let r=null;if(this._match(me.tokens.colon)){const s=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=s)}this._consume(me.tokens.equal,"Expected '=' for const.");const i=this._short_circuit_or_expression();return new NT(e,r,null,null,i)}return null}_increment_decrement_statement(){const e=this._current,r=this._unary_expression();if(r==null)return null;if(!this._check(me.increment_operators))return this._current=e,null;const i=this._consume(me.increment_operators,"Expected increment operator");return new pH(i.type===me.tokens.plus_plus?vm.increment:vm.decrement,r)}_assignment_statement(){let e=null;if(this._check(me.tokens.brace_right))return null;let r=this._match(me.tokens.underscore);if(r||(e=this._unary_expression()),!r&&e==null)return null;const i=this._consume(me.assignment_operators,"Expected assignment operator."),s=this._short_circuit_or_expression();return new fH(__.parse(i.lexeme),e,s)}_func_call_statement(){if(!this._check(me.tokens.ident))return null;const e=this._current,r=this._consume(me.tokens.ident,"Expected function name."),i=this._argument_expression_list();return i===null?(this._current=e,null):new R5(r.lexeme,i)}_loop_statement(){if(!this._match(me.keywords.loop))return null;this._check(me.tokens.attr)&&this._attribute(),this._consume(me.tokens.brace_left,"Expected '{' for loop.");const e=[];let r=this._statement();for(;r!==null;){if(Array.isArray(r))for(let s of r)e.push(s);else e.push(r);r=this._statement()}let i=null;return this._match(me.keywords.continuing)&&(i=this._compound_statement()),this._consume(me.tokens.brace_right,"Expected '}' for loop."),new mH(e,i)}_switch_statement(){if(!this._match(me.keywords.switch))return null;const e=this._optional_paren_expression();this._check(me.tokens.attr)&&this._attribute(),this._consume(me.tokens.brace_left,"Expected '{' for switch.");const r=this._switch_body();if(r==null||r.length==0)throw this._error(this._previous(),"Expected 'case' or 'default'.");return this._consume(me.tokens.brace_right,"Expected '}' for switch."),new gH(e,r)}_switch_body(){const e=[];if(this._match(me.keywords.case)){const r=this._case_selectors();this._match(me.tokens.colon),this._check(me.tokens.attr)&&this._attribute(),this._consume(me.tokens.brace_left,"Exected '{' for switch case.");const i=this._case_body();this._consume(me.tokens.brace_right,"Exected '}' for switch case."),e.push(new RH(r,i))}if(this._match(me.keywords.default)){this._match(me.tokens.colon),this._check(me.tokens.attr)&&this._attribute(),this._consume(me.tokens.brace_left,"Exected '{' for switch default.");const r=this._case_body();this._consume(me.tokens.brace_right,"Exected '}' for switch default."),e.push(new IH(r))}if(this._check([me.keywords.default,me.keywords.case])){const r=this._switch_body();e.push(r[0])}return e}_case_selectors(){const e=[this._shift_expression()];for(;this._match(me.tokens.comma);)e.push(this._shift_expression());return e}_case_body(){if(this._match(me.keywords.fallthrough))return this._consume(me.tokens.semicolon,"Expected ';'"),[];let e=this._statement();if(e==null)return[];e instanceof Array||(e=[e]);const r=this._case_body();return r.length==0?e:[...e,r[0]]}_if_statement(){if(!this._match(me.keywords.if))return null;const e=this._optional_paren_expression();this._check(me.tokens.attr)&&this._attribute();const r=this._compound_statement();let i=[];this._match_elseif()&&(this._check(me.tokens.attr)&&this._attribute(),i=this._elseif_statement(i));let s=null;return this._match(me.keywords.else)&&(this._check(me.tokens.attr)&&this._attribute(),s=this._compound_statement()),new _H(e,r,i,s)}_match_elseif(){return this._tokens[this._current].type===me.keywords.else&&this._tokens[this._current+1].type===me.keywords.if?(this._advance(),this._advance(),!0):!1}_elseif_statement(e=[]){const r=this._optional_paren_expression(),i=this._compound_statement();return e.push(new BH(r,i)),this._match_elseif()&&(this._check(me.tokens.attr)&&this._attribute(),this._elseif_statement(e)),e}_return_statement(){if(!this._match(me.keywords.return))return null;const e=this._short_circuit_or_expression();return new yH(e)}_short_circuit_or_expression(){let e=this._short_circuit_and_expr();for(;this._match(me.tokens.or_or);)e=new Xc(this._previous().toString(),e,this._short_circuit_and_expr());return e}_short_circuit_and_expr(){let e=this._inclusive_or_expression();for(;this._match(me.tokens.and_and);)e=new Xc(this._previous().toString(),e,this._inclusive_or_expression());return e}_inclusive_or_expression(){let e=this._exclusive_or_expression();for(;this._match(me.tokens.or);)e=new Xc(this._previous().toString(),e,this._exclusive_or_expression());return e}_exclusive_or_expression(){let e=this._and_expression();for(;this._match(me.tokens.xor);)e=new Xc(this._previous().toString(),e,this._and_expression());return e}_and_expression(){let e=this._equality_expression();for(;this._match(me.tokens.and);)e=new Xc(this._previous().toString(),e,this._equality_expression());return e}_equality_expression(){const e=this._relational_expression();return this._match([me.tokens.equal_equal,me.tokens.not_equal])?new Xc(this._previous().toString(),e,this._relational_expression()):e}_relational_expression(){let e=this._shift_expression();for(;this._match([me.tokens.less_than,me.tokens.greater_than,me.tokens.less_than_equal,me.tokens.greater_than_equal]);)e=new Xc(this._previous().toString(),e,this._shift_expression());return e}_shift_expression(){let e=this._additive_expression();for(;this._match([me.tokens.shift_left,me.tokens.shift_right]);)e=new Xc(this._previous().toString(),e,this._additive_expression());return e}_additive_expression(){let e=this._multiplicative_expression();for(;this._match([me.tokens.plus,me.tokens.minus]);)e=new Xc(this._previous().toString(),e,this._multiplicative_expression());return e}_multiplicative_expression(){let e=this._unary_expression();for(;this._match([me.tokens.star,me.tokens.forward_slash,me.tokens.modulo]);)e=new Xc(this._previous().toString(),e,this._unary_expression());return e}_unary_expression(){return this._match([me.tokens.minus,me.tokens.bang,me.tokens.tilde,me.tokens.star,me.tokens.and])?new PH(this._previous().toString(),this._unary_expression()):this._singular_expression()}_singular_expression(){const e=this._primary_expression(),r=this._postfix_expression();return r&&(e.postfix=r),e}_postfix_expression(){if(this._match(me.tokens.bracket_left)){const e=this._short_circuit_or_expression();this._consume(me.tokens.bracket_right,"Expected ']'.");const r=new MH(e),i=this._postfix_expression();return i&&(r.postfix=i),r}if(this._match(me.tokens.period)){const e=this._consume(me.tokens.ident,"Expected member name."),r=this._postfix_expression(),i=new SH(e.lexeme);return r&&(i.postfix=r),i}return null}_getStruct(e){return this._context.aliases.has(e)?this._context.aliases.get(e).type:this._context.structs.has(e)?this._context.structs.get(e):null}_primary_expression(){if(this._match(me.tokens.ident)){const i=this._previous().toString();if(this._check(me.tokens.paren_left)){const s=this._argument_expression_list(),l=this._getStruct(i);return l!=null?new Yf(l,s):new L5(i,s)}if(this._context.constants.has(i)){const s=this._context.constants.get(i);return new OT(i,s.value)}return new Ix(i)}if(this._match(me.const_literal))return new FT(parseFloat(this._previous().toString()));if(this._check(me.tokens.paren_left))return this._paren_expression();if(this._match(me.keywords.bitcast)){this._consume(me.tokens.less_than,"Expected '<'.");const i=this._type_decl();this._consume(me.tokens.greater_than,"Expected '>'.");const s=this._paren_expression();return new CH(i,s)}const e=this._type_decl(),r=this._argument_expression_list();return new Yf(e,r)}_argument_expression_list(){if(!this._match(me.tokens.paren_left))return null;const e=[];do{if(this._check(me.tokens.paren_right))break;const r=this._short_circuit_or_expression();e.push(r)}while(this._match(me.tokens.comma));return this._consume(me.tokens.paren_right,"Expected ')' for agument list"),e}_optional_paren_expression(){this._match(me.tokens.paren_left);const e=this._short_circuit_or_expression();return this._match(me.tokens.paren_right),new zT([e])}_paren_expression(){this._consume(me.tokens.paren_left,"Expected '('.");const e=this._short_circuit_or_expression();return this._consume(me.tokens.paren_right,"Expected ')'."),new zT([e])}_struct_decl(){if(!this._match(me.keywords.struct))return null;const e=this._currentLine,r=this._consume(me.tokens.ident,"Expected name for struct.").toString();this._consume(me.tokens.brace_left,"Expected '{' for struct body.");const i=[];for(;!this._check(me.tokens.brace_right);){const h=this._attribute(),a=this._consume(me.tokens.ident,"Expected variable name.").toString();this._consume(me.tokens.colon,"Expected ':' for struct member type.");const v=this._attribute(),T=this._type_decl();T!=null&&(T.attributes=v),this._check(me.tokens.brace_right)?this._match(me.tokens.comma):this._consume(me.tokens.comma,"Expected ',' for struct member."),i.push(new LH(a,T,h))}this._consume(me.tokens.brace_right,"Expected '}' after struct body.");const s=this._currentLine,l=new Rp(r,i,e,s);return this._context.structs.set(r,l),l}_global_variable_decl(){const e=this._variable_decl();return e&&this._match(me.tokens.equal)&&(e.value=this._const_expression()),e}_override_variable_decl(){const e=this._override_decl();return e&&this._match(me.tokens.equal)&&(e.value=this._const_expression()),e}_global_const_decl(){if(!this._match(me.keywords.const))return null;const e=this._consume(me.tokens.ident,"Expected variable name");let r=null;if(this._match(me.tokens.colon)){const l=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=l)}let i=null;if(this._match(me.tokens.equal)){const l=this._short_circuit_or_expression();if(l instanceof Yf)i=l;else if(l instanceof OT&&l.initializer instanceof Yf)i=l.initializer;else try{const h=l.evaluate(this._context);i=new FT(h)}catch{i=l}}const s=new NT(e.toString(),r,"","",i);return this._context.constants.set(s.name,s),s}_global_let_decl(){if(!this._match(me.keywords.let))return null;const e=this._consume(me.tokens.ident,"Expected variable name");let r=null;if(this._match(me.tokens.colon)){const s=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=s)}let i=null;return this._match(me.tokens.equal)&&(i=this._const_expression()),new Rx(e.toString(),r,"","",i)}_const_expression(){return this._short_circuit_or_expression()}_variable_decl(){if(!this._match(me.keywords.var))return null;let e="",r="";this._match(me.tokens.less_than)&&(e=this._consume(me.storage_class,"Expected storage_class.").toString(),this._match(me.tokens.comma)&&(r=this._consume(me.access_mode,"Expected access_mode.").toString()),this._consume(me.tokens.greater_than,"Expected '>'."));const i=this._consume(me.tokens.ident,"Expected variable name");let s=null;if(this._match(me.tokens.colon)){const l=this._attribute();s=this._type_decl(),s!=null&&(s.attributes=l)}return new Ip(i.toString(),s,e,r,null)}_override_decl(){if(!this._match(me.keywords.override))return null;const e=this._consume(me.tokens.ident,"Expected variable name");let r=null;if(this._match(me.tokens.colon)){const i=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=i)}return new P5(e.toString(),r,null)}_diagnostic(){this._consume(me.tokens.paren_left,"Expected '('");const e=this._consume(me.tokens.ident,"Expected severity control name.");this._consume(me.tokens.comma,"Expected ','");const r=this._consume(me.tokens.ident,"Expected diagnostic rule name.");return this._consume(me.tokens.paren_right,"Expected ')'"),new xH(e.toString(),r.toString())}_enable_directive(){const e=this._consume(me.tokens.ident,"identity expected.");return new vH(e.toString())}_requires_directive(){const e=[this._consume(me.tokens.ident,"identity expected.").toString()];for(;this._match(me.tokens.comma);){const r=this._consume(me.tokens.ident,"identity expected.");e.push(r.toString())}return new bH(e)}_type_alias(){const e=this._consume(me.tokens.ident,"identity expected.");this._consume(me.tokens.equal,"Expected '=' for type alias.");let r=this._type_decl();if(r===null)throw this._error(this._peek(),"Expected Type for Alias.");this._context.aliases.has(r.name)&&(r=this._context.aliases.get(r.name).type);const i=new I5(e.toString(),r);return this._context.aliases.set(i.name,i),i}_type_decl(){if(this._check([me.tokens.ident,...me.texel_format,me.keywords.bool,me.keywords.f32,me.keywords.i32,me.keywords.u32])){const i=this._advance(),s=i.toString();return this._context.structs.has(s)?this._context.structs.get(s):this._context.aliases.has(s)?this._context.aliases.get(s).type:new Yp(i.toString())}let e=this._texture_sampler_types();if(e)return e;if(this._check(me.template_types)){let i=this._advance().toString(),s=null,l=null;return this._match(me.tokens.less_than)&&(s=this._type_decl(),l=null,this._match(me.tokens.comma)&&(l=this._consume(me.access_mode,"Expected access_mode for pointer").toString()),this._consume(me.tokens.greater_than,"Expected '>' for type.")),new k5(i,s,l)}if(this._match(me.keywords.ptr)){let i=this._previous().toString();this._consume(me.tokens.less_than,"Expected '<' for pointer.");const s=this._consume(me.storage_class,"Expected storage_class for pointer");this._consume(me.tokens.comma,"Expected ',' for pointer.");const l=this._type_decl();let h=null;return this._match(me.tokens.comma)&&(h=this._consume(me.access_mode,"Expected access_mode for pointer").toString()),this._consume(me.tokens.greater_than,"Expected '>' for pointer."),new TH(i,s.toString(),l,h)}const r=this._attribute();if(this._match(me.keywords.array)){let i=null,s=-1;const l=this._previous();let h=null;if(this._match(me.tokens.less_than)){i=this._type_decl(),this._context.aliases.has(i.name)&&(i=this._context.aliases.get(i.name).type);let v="";if(this._match(me.tokens.comma)){h=this._shift_expression();try{v=h.evaluate(this._context).toString(),h=null}catch{v="1"}}this._consume(me.tokens.greater_than,"Expected '>' for array."),s=v?parseInt(v):0}const a=new B5(l.toString(),r,i,s);return h&&this._deferArrayCountEval.push({arrayType:a,countNode:h}),a}return null}_texture_sampler_types(){if(this._match(me.sampler_type))return new qg(this._previous().toString(),null,null);if(this._match(me.depth_texture_type))return new qg(this._previous().toString(),null,null);if(this._match(me.sampled_texture_type)||this._match(me.multisampled_texture_type)){const e=this._previous();this._consume(me.tokens.less_than,"Expected '<' for sampler type.");const r=this._type_decl();return this._consume(me.tokens.greater_than,"Expected '>' for sampler type."),new qg(e.toString(),r,null)}if(this._match(me.storage_texture_type)){const e=this._previous();this._consume(me.tokens.less_than,"Expected '<' for sampler type.");const r=this._consume(me.texel_format,"Invalid texel format.").toString();this._consume(me.tokens.comma,"Expected ',' after texel format.");const i=this._consume(me.access_mode,"Expected access mode for storage texture type.").toString();return this._consume(me.tokens.greater_than,"Expected '>' for sampler type."),new qg(e.toString(),r,i)}return null}_attribute(){let e=[];for(;this._match(me.tokens.attr);){const r=this._consume(me.attribute_name,"Expected attribute name"),i=new DH(r.toString(),null);if(this._match(me.tokens.paren_left)){if(i.value=this._consume(me.literal_or_ident,"Expected attribute value").toString(),this._check(me.tokens.comma)){this._advance();do{const s=this._consume(me.literal_or_ident,"Expected attribute value").toString();i.value instanceof Array||(i.value=[i.value]),i.value.push(s)}while(this._match(me.tokens.comma))}this._consume(me.tokens.paren_right,"Expected ')'")}e.push(i)}return e.length==0?null:e}}class lm{constructor(e,r){this.name=e,this.attributes=r,this.size=0}get isArray(){return!1}get isStruct(){return!1}get isTemplate(){return!1}}class jT{constructor(e,r,i){this.name=e,this.type=r,this.attributes=i,this.offset=0,this.size=0}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray?this.type.format:this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class jy extends lm{constructor(e,r){super(e,r),this.members=[],this.align=0,this.startLine=-1,this.endLine=-1,this.inUse=!1}get isStruct(){return!0}}class Jv extends lm{constructor(e,r){super(e,r),this.count=0,this.stride=0}get isArray(){return!0}}class VT extends lm{constructor(e,r,i,s){super(e,i),this.format=r,this.access=s}get isTemplate(){return!0}}var td;(function(t){t[t.Uniform=0]="Uniform",t[t.Storage=1]="Storage",t[t.Texture=2]="Texture",t[t.Sampler=3]="Sampler",t[t.StorageTexture=4]="StorageTexture"})(td||(td={}));class Vy{constructor(e,r,i,s,l,h,a){this.name=e,this.type=r,this.group=i,this.binding=s,this.attributes=l,this.resourceType=h,this.access=a}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get size(){return this.type.size}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray?this.type.format:this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class FH{constructor(e,r){this.name=e,this.type=r}}class Gy{constructor(e,r){this.align=e,this.size=r}}class zH{constructor(e,r,i,s){this.name=e,this.type=r,this.locationType=i,this.location=s,this.interpolation=null}}class GT{constructor(e,r,i,s){this.name=e,this.type=r,this.locationType=i,this.location=s}}class UH{constructor(e,r,i,s){this.name=e,this.type=r,this.attributes=i,this.id=s}}class jH{constructor(e,r){this.name=e,this.type=r}}class VH{constructor(e,r=null){this.stage=null,this.inputs=[],this.outputs=[],this.arguments=[],this.returnType=null,this.resources=[],this.overrides=[],this.startLine=-1,this.endLine=-1,this.inUse=!1,this.calls=new Set,this.name=e,this.stage=r}}class GH{constructor(){this.vertex=[],this.fragment=[],this.compute=[]}}class HH{constructor(e){this.resources=null,this.inUse=!1,this.info=null,this.node=e}}class Qu{constructor(e){this.uniforms=[],this.storage=[],this.textures=[],this.samplers=[],this.aliases=[],this.overrides=[],this.structs=[],this.entry=new GH,this.functions=[],this._types=new Map,this._functions=new Map,e&&this.update(e)}_isStorageTexture(e){return e.name=="texture_storage_1d"||e.name=="texture_storage_2d"||e.name=="texture_storage_2d_array"||e.name=="texture_storage_3d"}update(e){const r=new OH().parse(e);for(const i of r)i instanceof Px&&this._functions.set(i.name,new HH(i));for(const i of r)if(i instanceof Rp){const s=this._getTypeInfo(i,null);s instanceof jy&&this.structs.push(s)}for(const i of r){if(i instanceof I5){this.aliases.push(this._getAliasInfo(i));continue}if(i instanceof P5){const s=i,l=this._getAttributeNum(s.attributes,"id",0),h=s.type!=null?this._getTypeInfo(s.type,s.attributes):null;this.overrides.push(new UH(s.name,h,s.attributes,l));continue}if(this._isUniformVar(i)){const s=i,l=this._getAttributeNum(s.attributes,"group",0),h=this._getAttributeNum(s.attributes,"binding",0),a=this._getTypeInfo(s.type,s.attributes),v=new Vy(s.name,a,l,h,s.attributes,td.Uniform,s.access);this.uniforms.push(v);continue}if(this._isStorageVar(i)){const s=i,l=this._getAttributeNum(s.attributes,"group",0),h=this._getAttributeNum(s.attributes,"binding",0),a=this._getTypeInfo(s.type,s.attributes),v=this._isStorageTexture(a),T=new Vy(s.name,a,l,h,s.attributes,v?td.StorageTexture:td.Storage,s.access);this.storage.push(T);continue}if(this._isTextureVar(i)){const s=i,l=this._getAttributeNum(s.attributes,"group",0),h=this._getAttributeNum(s.attributes,"binding",0),a=this._getTypeInfo(s.type,s.attributes),v=this._isStorageTexture(a),T=new Vy(s.name,a,l,h,s.attributes,v?td.StorageTexture:td.Texture,s.access);v?this.storage.push(T):this.textures.push(T);continue}if(this._isSamplerVar(i)){const s=i,l=this._getAttributeNum(s.attributes,"group",0),h=this._getAttributeNum(s.attributes,"binding",0),a=this._getTypeInfo(s.type,s.attributes),v=new Vy(s.name,a,l,h,s.attributes,td.Sampler,s.access);this.samplers.push(v);continue}if(i instanceof Px){const s=this._getAttribute(i,"vertex"),l=this._getAttribute(i,"fragment"),h=this._getAttribute(i,"compute"),a=s||l||h,v=new VH(i.name,a?.name);v.startLine=i.startLine,v.endLine=i.endLine,this.functions.push(v),this._functions.get(i.name).info=v,a?(this._functions.get(i.name).inUse=!0,v.inUse=!0,v.resources=this._findResources(i,!!a),v.inputs=this._getInputs(i.args),v.outputs=this._getOutputs(i.returnType),this.entry[a.name].push(v)):(v.arguments=i.args.map(T=>new jH(T.name,this._getTypeInfo(T.type,T.attributes))),v.returnType=i.returnType?this._getTypeInfo(i.returnType,i.attributes):null);continue}}for(const i of this._functions.values())i.info&&(i.info.inUse=i.inUse,this._addCalls(i.node,i.info.calls));for(const i of this._functions.values())i.node.search(s=>{var l;if(s.astNodeType==="varExpr"){const h=s;for(const a of this.overrides)h.name==a.name&&((l=i.info)===null||l===void 0||l.overrides.push(a))}});for(const i of this.uniforms)this._markStructsInUse(i.type);for(const i of this.storage)this._markStructsInUse(i.type)}_markStructsInUse(e){if(e)if(e.isStruct){if(e.inUse=!0,e.members)for(const r of e.members)this._markStructsInUse(r.type)}else if(e.isArray)this._markStructsInUse(e.format);else if(e.isTemplate)e.format&&this._markStructsInUse(e.format);else{const r=this._getAlias(e.name);r&&this._markStructsInUse(r)}}_addCalls(e,r){var i;for(const s of e.calls){const l=(i=this._functions.get(s.name))===null||i===void 0?void 0:i.info;l&&r.add(l)}}findResource(e,r){for(const i of this.uniforms)if(i.group==e&&i.binding==r)return i;for(const i of this.storage)if(i.group==e&&i.binding==r)return i;for(const i of this.textures)if(i.group==e&&i.binding==r)return i;for(const i of this.samplers)if(i.group==e&&i.binding==r)return i;return null}_findResource(e){for(const r of this.uniforms)if(r.name==e)return r;for(const r of this.storage)if(r.name==e)return r;for(const r of this.textures)if(r.name==e)return r;for(const r of this.samplers)if(r.name==e)return r;return null}_markStructsFromAST(e){const r=this._getTypeInfo(e,null);this._markStructsInUse(r)}_findResources(e,r){const i=[],s=this,l=[];return e.search(h=>{if(h instanceof H0)l.push({});else if(h instanceof W0)l.pop();else if(h instanceof Ip){const a=h;r&&a.type!==null&&this._markStructsFromAST(a.type),l.length>0&&(l[l.length-1][a.name]=a)}else if(h instanceof Yf){const a=h;r&&a.type!==null&&this._markStructsFromAST(a.type)}else if(h instanceof Rx){const a=h;r&&a.type!==null&&this._markStructsFromAST(a.type),l.length>0&&(l[l.length-1][a.name]=a)}else if(h instanceof Ix){const a=h;if(l.length>0&&l[l.length-1][a.name])return;const v=s._findResource(a.name);v&&i.push(v)}else if(h instanceof L5){const a=h,v=s._functions.get(a.name);v&&(r&&(v.inUse=!0),e.calls.add(v.node),v.resources===null&&(v.resources=s._findResources(v.node,r)),i.push(...v.resources))}else if(h instanceof R5){const a=h,v=s._functions.get(a.name);v&&(r&&(v.inUse=!0),e.calls.add(v.node),v.resources===null&&(v.resources=s._findResources(v.node,r)),i.push(...v.resources))}}),[...new Map(i.map(h=>[h.name,h])).values()]}getBindGroups(){const e=[];function r(i,s){i>=e.length&&(e.length=i+1),e[i]===void 0&&(e[i]=[]),s>=e[i].length&&(e[i].length=s+1)}for(const i of this.uniforms){r(i.group,i.binding);const s=e[i.group];s[i.binding]=i}for(const i of this.storage){r(i.group,i.binding);const s=e[i.group];s[i.binding]=i}for(const i of this.textures){r(i.group,i.binding);const s=e[i.group];s[i.binding]=i}for(const i of this.samplers){r(i.group,i.binding);const s=e[i.group];s[i.binding]=i}return e}_getOutputs(e,r=void 0){if(r===void 0&&(r=[]),e instanceof Rp)this._getStructOutputs(e,r);else{const i=this._getOutputInfo(e);i!==null&&r.push(i)}return r}_getStructOutputs(e,r){for(const i of e.members)if(i.type instanceof Rp)this._getStructOutputs(i.type,r);else{const s=this._getAttribute(i,"location")||this._getAttribute(i,"builtin");if(s!==null){const l=this._getTypeInfo(i.type,i.type.attributes),h=this._parseInt(s.value),a=new GT(i.name,l,s.name,h);r.push(a)}}}_getOutputInfo(e){const r=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(r!==null){const i=this._getTypeInfo(e,e.attributes),s=this._parseInt(r.value);return new GT("",i,r.name,s)}return null}_getInputs(e,r=void 0){r===void 0&&(r=[]);for(const i of e)if(i.type instanceof Rp)this._getStructInputs(i.type,r);else{const s=this._getInputInfo(i);s!==null&&r.push(s)}return r}_getStructInputs(e,r){for(const i of e.members)if(i.type instanceof Rp)this._getStructInputs(i.type,r);else{const s=this._getInputInfo(i);s!==null&&r.push(s)}}_getInputInfo(e){const r=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(r!==null){const i=this._getAttribute(e,"interpolation"),s=this._getTypeInfo(e.type,e.attributes),l=this._parseInt(r.value),h=new zH(e.name,s,r.name,l);return i!==null&&(h.interpolation=this._parseString(i.value)),h}return null}_parseString(e){return e instanceof Array&&(e=e[0]),e}_parseInt(e){e instanceof Array&&(e=e[0]);const r=parseInt(e);return isNaN(r)?e:r}_getAlias(e){for(const r of this.aliases)if(r.name==e)return r.type;return null}_getAliasInfo(e){return new FH(e.name,this._getTypeInfo(e.type,null))}_getTypeInfo(e,r){if(this._types.has(e))return this._types.get(e);if(e instanceof B5){const s=e,l=s.format?this._getTypeInfo(s.format,s.attributes):null,h=new Jv(s.name,r);return h.format=l,h.count=s.count,this._types.set(e,h),this._updateTypeInfo(h),h}if(e instanceof Rp){const s=e,l=new jy(s.name,r);l.startLine=s.startLine,l.endLine=s.endLine;for(const h of s.members){const a=this._getTypeInfo(h.type,h.attributes);l.members.push(new jT(h.name,a,h.attributes))}return this._types.set(e,l),this._updateTypeInfo(l),l}if(e instanceof qg){const s=e,l=s.format instanceof Yp,h=s.format?l?this._getTypeInfo(s.format,null):new lm(s.format,null):null,a=new VT(s.name,h,r,s.access);return this._types.set(e,a),this._updateTypeInfo(a),a}if(e instanceof k5){const s=e,l=s.format?this._getTypeInfo(s.format,null):null,h=new VT(s.name,l,r,s.access);return this._types.set(e,h),this._updateTypeInfo(h),h}const i=new lm(e.name,r);return this._types.set(e,i),this._updateTypeInfo(i),i}_updateTypeInfo(e){var r,i;const s=this._getTypeSize(e);if(e.size=(r=s?.size)!==null&&r!==void 0?r:0,e instanceof Jv&&e.format){const l=this._getTypeSize(e.format);e.stride=(i=l?.size)!==null&&i!==void 0?i:0,this._updateTypeInfo(e.format)}e instanceof jy&&this._updateStructInfo(e)}_updateStructInfo(e){var r;let i=0,s=0,l=0,h=0;for(let a=0,v=e.members.length;a<v;++a){const T=e.members[a],C=this._getTypeSize(T);if(!C)continue;(r=this._getAlias(T.type.name))!==null&&r!==void 0||T.type;const k=C.align,L=C.size;i=this._roundUp(k,i+s),s=L,l=i,h=Math.max(h,k),T.offset=i,T.size=L,this._updateTypeInfo(T.type)}e.size=this._roundUp(h,l+s),e.align=h}_getTypeSize(e){var r,i;if(e==null)return null;const s=this._getAttributeNum(e.attributes,"size",0),l=this._getAttributeNum(e.attributes,"align",0);if(e instanceof jT&&(e=e.type),e instanceof lm){const h=this._getAlias(e.name);h!==null&&(e=h)}{const h=Qu._typeInfo[e.name];if(h!==void 0){const a=((r=e.format)===null||r===void 0?void 0:r.name)==="f16"?2:1;return new Gy(Math.max(l,h.align/a),Math.max(s,h.size/a))}}{const h=Qu._typeInfo[e.name.substring(0,e.name.length-1)];if(h){const a=e.name[e.name.length-1]==="h"?2:1;return new Gy(Math.max(l,h.align/a),Math.max(s,h.size/a))}}if(e instanceof Jv){let h=e,a=8,v=8;const T=this._getTypeSize(h.format);T!==null&&(v=T.size,a=T.align);const C=h.count,k=this._getAttributeNum((i=e?.attributes)!==null&&i!==void 0?i:null,"stride",this._roundUp(a,v));return v=C*k,s&&(v=s),new Gy(Math.max(l,a),Math.max(s,v))}if(e instanceof jy){let h=0,a=0,v=0,T=0,C=0;for(const k of e.members){const L=this._getTypeSize(k.type);L!==null&&(h=Math.max(L.align,h),v=this._roundUp(L.align,v+T),T=L.size,C=v)}return a=this._roundUp(h,C+T),new Gy(Math.max(l,h),Math.max(s,a))}return null}_isUniformVar(e){return e instanceof Ip&&e.storage=="uniform"}_isStorageVar(e){return e instanceof Ip&&e.storage=="storage"}_isTextureVar(e){return e instanceof Ip&&e.type!==null&&Qu._textureTypes.indexOf(e.type.name)!=-1}_isSamplerVar(e){return e instanceof Ip&&e.type!==null&&Qu._samplerTypes.indexOf(e.type.name)!=-1}_getAttribute(e,r){const i=e;if(!i||!i.attributes)return null;const s=i.attributes;for(let l of s)if(l.name==r)return l;return null}_getAttributeNum(e,r,i){if(e===null)return i;for(let s of e)if(s.name==r){let l=s!==null&&s.value!==null?s.value:i;return l instanceof Array&&(l=l[0]),typeof l=="number"?l:typeof l=="string"?parseInt(l):i}return i}_roundUp(e,r){return Math.ceil(r/e)*e}}Qu._typeInfo={f16:{align:2,size:2},i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},atomic:{align:4,size:4},vec2:{align:8,size:8},vec3:{align:16,size:12},vec4:{align:16,size:16},mat2x2:{align:8,size:16},mat3x2:{align:8,size:24},mat4x2:{align:8,size:32},mat2x3:{align:16,size:32},mat3x3:{align:16,size:48},mat4x3:{align:16,size:64},mat2x4:{align:16,size:32},mat3x4:{align:16,size:48},mat4x4:{align:16,size:64}};Qu._textureTypes=me.any_texture_type.map(t=>t.name);Qu._samplerTypes=me.sampler_type.map(t=>t.name);function WH(t){const e={attributes:[],bindings:[]};let r;try{r=qH(t)}catch(l){return Ct.error(l.message)(),e}for(const l of r.uniforms){const h=[];for(const a of l.type?.members||[])h.push({name:a.name,type:HT(a.type)});e.bindings.push({type:"uniform",name:l.name,location:l.binding,group:l.group,members:h})}const i=r.entry.vertex[0],s=i?.inputs.length||0;for(let l=0;l<s;l++){const h=i.inputs[l];if(h.locationType==="location"){const a=HT(h.type);e.attributes.push({name:h.name,location:Number(h.location),type:a})}}return e}function HT(t){return t.format?`${t.name}<${t.format.name}>`:t.name}function qH(t){try{return new Qu(t)}catch(e){if(e instanceof Error)throw e;let r="WGSL parse error";throw typeof e=="object"&&e?.message&&(r+=`: ${e.message} `),typeof e=="object"&&e?.token&&(r+=e.token.line||""),new Error(r,{cause:e})}}const $H=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;
const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;
const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;
const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01;
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03;
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04;
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06;
float sin_taylor_fp32(float a) {
float r, s, t, x;
if (a == 0.0) {
return 0.0;
}
x = -a * a;
s = a;
r = a;
r = r * x;
t = r * INVERSE_FACTORIAL_3;
s = s + t;
r = r * x;
t = r * INVERSE_FACTORIAL_5;
s = s + t;
r = r * x;
t = r * INVERSE_FACTORIAL_7;
s = s + t;
r = r * x;
t = r * INVERSE_FACTORIAL_9;
s = s + t;
return s;
}
void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
if (a == 0.0) {
sin_t = 0.0;
cos_t = 1.0;
}
sin_t = sin_taylor_fp32(a);
cos_t = sqrt(1.0 - sin_t * sin_t);
}
float tan_taylor_fp32(float a) {
float sin_a;
float cos_a;
if (a == 0.0) {
return 0.0;
}
float z = floor(a / TWO_PI);
float r = a - TWO_PI * z;
float t;
float q = floor(r / PI_2 + 0.5);
int j = int(q);
if (j < -2 || j > 2) {
return 1.0 / 0.0;
}
t = r - PI_2 * q;
q = floor(t / PI_16 + 0.5);
int k = int(q);
int abs_k = int(abs(float(k)));
if (abs_k > 4) {
return 1.0 / 0.0;
} else {
t = t - PI_16 * q;
}
float u = 0.0;
float v = 0.0;
float sin_t, cos_t;
float s, c;
sincos_taylor_fp32(t, sin_t, cos_t);
if (k == 0) {
s = sin_t;
c = cos_t;
} else {
if (abs(float(abs_k) - 1.0) < 0.5) {
u = COS_TABLE_0;
v = SIN_TABLE_0;
} else if (abs(float(abs_k) - 2.0) < 0.5) {
u = COS_TABLE_1;
v = SIN_TABLE_1;
} else if (abs(float(abs_k) - 3.0) < 0.5) {
u = COS_TABLE_2;
v = SIN_TABLE_2;
} else if (abs(float(abs_k) - 4.0) < 0.5) {
u = COS_TABLE_3;
v = SIN_TABLE_3;
}
if (k > 0) {
s = u * sin_t + v * cos_t;
c = u * cos_t - v * sin_t;
} else {
s = u * sin_t - v * cos_t;
c = u * cos_t + v * sin_t;
}
}
if (j == 0) {
sin_a = s;
cos_a = c;
} else if (j == 1) {
sin_a = c;
cos_a = -s;
} else if (j == -1) {
sin_a = -c;
cos_a = s;
} else {
sin_a = -s;
cos_a = -c;
}
return sin_a / cos_a;
}
#endif
float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
return tan_taylor_fp32(a);
#else
return tan(a);
#endif
}
`,ZH={name:"fp32",vs:$H},XH=[0,1,1,1],KH=`uniform pickingUniforms {
float isActive;
float isAttribute;
float isHighlightActive;
float useFloatColors;
vec3 highlightedObjectColor;
vec4 highlightColor;
} picking;
out vec4 picking_vRGBcolor_Avalid;
vec3 picking_normalizeColor(vec3 color) {
return picking.useFloatColors > 0.5 ? color : color / 255.0;
}
vec4 picking_normalizeColor(vec4 color) {
return picking.useFloatColors > 0.5 ? color : color / 255.0;
}
bool picking_isColorZero(vec3 color) {
return dot(color, vec3(1.0)) < 0.00001;
}
bool picking_isColorValid(vec3 color) {
return dot(color, vec3(1.0)) > 0.00001;
}
bool isVertexHighlighted(vec3 vertexColor) {
vec3 highlightedObjectColor = picking_normalizeColor(picking.highlightedObjectColor);
return
bool(picking.isHighlightActive) && picking_isColorZero(abs(vertexColor - highlightedObjectColor));
}
void picking_setPickingColor(vec3 pickingColor) {
pickingColor = picking_normalizeColor(pickingColor);
if (bool(picking.isActive)) {
picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));
if (!bool(picking.isAttribute)) {
picking_vRGBcolor_Avalid.rgb = pickingColor;
}
} else {
picking_vRGBcolor_Avalid.a = float(isVertexHighlighted(pickingColor));
}
}
void picking_setPickingAttribute(float value) {
if (bool(picking.isAttribute)) {
picking_vRGBcolor_Avalid.r = value;
}
}
void picking_setPickingAttribute(vec2 value) {
if (bool(picking.isAttribute)) {
picking_vRGBcolor_Avalid.rg = value;
}
}
void picking_setPickingAttribute(vec3 value) {
if (bool(picking.isAttribute)) {
picking_vRGBcolor_Avalid.rgb = value;
}
}
`,YH=`uniform pickingUniforms {
float isActive;
float isAttribute;
float isHighlightActive;
float useFloatColors;
vec3 highlightedObjectColor;
vec4 highlightColor;
} picking;
in vec4 picking_vRGBcolor_Avalid;
vec4 picking_filterHighlightColor(vec4 color) {
if (picking.isActive > 0.5) {
return color;
}
bool selected = bool(picking_vRGBcolor_Avalid.a);
if (selected) {
float highLightAlpha = picking.highlightColor.a;
float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
float highLightRatio = highLightAlpha / blendedAlpha;
vec3 blendedRGB = mix(color.rgb, picking.highlightColor.rgb, highLightRatio);
return vec4(blendedRGB, blendedAlpha);
} else {
return color;
}
}
vec4 picking_filterPickingColor(vec4 color) {
if (bool(picking.isActive)) {
if (picking_vRGBcolor_Avalid.a == 0.0) {
discard;
}
return picking_vRGBcolor_Avalid;
}
return color;
}
vec4 picking_filterColor(vec4 color) {
vec4 highlightColor = picking_filterHighlightColor(color);
return picking_filterPickingColor(highlightColor);
}
`,WT={name:"picking",vs:KH,fs:YH,uniformTypes:{isActive:"f32",isAttribute:"f32",isHighlightActive:"f32",useFloatColors:"f32",highlightedObjectColor:"vec3<f32>",highlightColor:"vec4<f32>"},defaultUniforms:{isActive:!1,isAttribute:!1,isHighlightActive:!1,useFloatColors:!0,highlightedObjectColor:[0,0,0],highlightColor:XH},getUniforms:JH};function JH(t={},e){const r={};if(t.highlightedObjectColor!==void 0)if(t.highlightedObjectColor===null)r.isHighlightActive=!1;else{r.isHighlightActive=!0;const i=t.highlightedObjectColor.slice(0,3);r.highlightedObjectColor=i}if(t.highlightColor){const i=Array.from(t.highlightColor,s=>s/255);Number.isFinite(i[3])||(i[3]=1),r.highlightColor=i}return t.isActive!==void 0&&(r.isActive=!!t.isActive,r.isAttribute=!!t.isAttribute),t.useFloatColors!==void 0&&(r.useFloatColors=!!t.useFloatColors),r}function O5(t,e=[],r=0){const i=Math.fround(t),s=t-i;return e[r]=i,e[r+1]=s,e}function QH(t){return t-Math.fround(t)}function eW(t){const e=new Float32Array(32);for(let r=0;r<4;++r)for(let i=0;i<4;++i){const s=r*4+i;O5(t[i*4+r],e,s*2)}return e}const tW=`uniform float ONE;
vec2 split(float a) {
const float SPLIT = 4097.0;
float t = a * SPLIT;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
float a_hi = t * ONE - (t - a);
float a_lo = a * ONE - a_hi;
#else
float a_hi = t - (t - a);
float a_lo = a - a_hi;
#endif
return vec2(a_hi, a_lo);
}
vec2 split2(vec2 a) {
vec2 b = split(a.x);
b.y += a.y;
return b;
}
vec2 quickTwoSum(float a, float b) {
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
float sum = (a + b) * ONE;
float err = b - (sum - a) * ONE;
#else
float sum = a + b;
float err = b - (sum - a);
#endif
return vec2(sum, err);
}
vec2 twoSum(float a, float b) {
float s = (a + b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
float v = (s * ONE - a) * ONE;
float err = (a - (s - v) * ONE) * ONE * ONE * ONE + (b - v);
#else
float v = s - a;
float err = (a - (s - v)) + (b - v);
#endif
return vec2(s, err);
}
vec2 twoSub(float a, float b) {
float s = (a - b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
float v = (s * ONE - a) * ONE;
float err = (a - (s - v) * ONE) * ONE * ONE * ONE - (b + v);
#else
float v = s - a;
float err = (a - (s - v)) - (b + v);
#endif
return vec2(s, err);
}
vec2 twoSqr(float a) {
float prod = a * a;
vec2 a_fp64 = split(a);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
float err = ((a_fp64.x * a_fp64.x - prod) * ONE + 2.0 * a_fp64.x *
a_fp64.y * ONE * ONE) + a_fp64.y * a_fp64.y * ONE * ONE * ONE;
#else
float err = ((a_fp64.x * a_fp64.x - prod) + 2.0 * a_fp64.x * a_fp64.y) + a_fp64.y * a_fp64.y;
#endif
return vec2(prod, err);
}
vec2 twoProd(float a, float b) {
float prod = a * b;
vec2 a_fp64 = split(a);
vec2 b_fp64 = split(b);
float err = ((a_fp64.x * b_fp64.x - prod) + a_fp64.x * b_fp64.y +
a_fp64.y * b_fp64.x) + a_fp64.y * b_fp64.y;
return vec2(prod, err);
}
vec2 sum_fp64(vec2 a, vec2 b) {
vec2 s, t;
s = twoSum(a.x, b.x);
t = twoSum(a.y, b.y);
s.y += t.x;
s = quickTwoSum(s.x, s.y);
s.y += t.y;
s = quickTwoSum(s.x, s.y);
return s;
}
vec2 sub_fp64(vec2 a, vec2 b) {
vec2 s, t;
s = twoSub(a.x, b.x);
t = twoSub(a.y, b.y);
s.y += t.x;
s = quickTwoSum(s.x, s.y);
s.y += t.y;
s = quickTwoSum(s.x, s.y);
return s;
}
vec2 mul_fp64(vec2 a, vec2 b) {
vec2 prod = twoProd(a.x, b.x);
prod.y += a.x * b.y;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
prod = split2(prod);
#endif
prod = quickTwoSum(prod.x, prod.y);
prod.y += a.y * b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
prod = split2(prod);
#endif
prod = quickTwoSum(prod.x, prod.y);
return prod;
}
vec2 div_fp64(vec2 a, vec2 b) {
float xn = 1.0 / b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
vec2 yn = mul_fp64(a, vec2(xn, 0));
#else
vec2 yn = a * xn;
#endif
float diff = (sub_fp64(a, mul_fp64(b, yn))).x;
vec2 prod = twoProd(xn, diff);
return sum_fp64(yn, prod);
}
vec2 sqrt_fp64(vec2 a) {
if (a.x == 0.0 && a.y == 0.0) return vec2(0.0, 0.0);
if (a.x < 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);
float x = 1.0 / sqrt(a.x);
float yn = a.x * x;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
vec2 yn_sqr = twoSqr(yn) * ONE;
#else
vec2 yn_sqr = twoSqr(yn);
#endif
float diff = sub_fp64(a, yn_sqr).x;
vec2 prod = twoProd(x * 0.5, diff);
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
return sum_fp64(split(yn), prod);
#else
return sum_fp64(vec2(yn, 0.0), prod);
#endif
}
`,rW={ONE:1};function iW(){return rW}const nW={name:"fp64-arithmetic",vs:tW,getUniforms:iW,fp64ify:O5,fp64LowPart:QH,fp64ifyMatrix4:eW},sW=1/Math.PI*180,oW=1/180*Math.PI,aW={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1};globalThis.mathgl=globalThis.mathgl||{config:{...aW}};const vs=globalThis.mathgl.config;function lW(t,{precision:e=vs.precision}={}){return t=dW(t),`${parseFloat(t.toPrecision(e))}`}function dd(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}function cW(t){return hW(t)}function uW(t){return tc(t)}function hW(t,e){return I2(t,r=>r*oW,e)}function tc(t,e){return I2(t,r=>r*sW,e)}function eh(t,e,r){return I2(t,i=>Math.max(e,Math.min(r,i)))}function q0(t,e,r){return dd(t)?t.map((i,s)=>q0(i,e[s],r)):r*e+(1-r)*t}function cc(t,e,r){const i=vs.EPSILON;r&&(vs.EPSILON=r);try{if(t===e)return!0;if(dd(t)&&dd(e)){if(t.length!==e.length)return!1;for(let s=0;s<t.length;++s)if(!cc(t[s],e[s]))return!1;return!0}return t&&t.equals?t.equals(e):e&&e.equals?e.equals(t):typeof t=="number"&&typeof e=="number"?Math.abs(t-e)<=vs.EPSILON*Math.max(1,Math.abs(t),Math.abs(e)):!1}finally{vs.EPSILON=i}}function dW(t){return Math.round(t/vs.EPSILON)*vs.EPSILON}function pW(t){return t.clone?t.clone():new Array(t.length)}function I2(t,e,r){if(dd(t)){const i=t;r=r||pW(i);for(let s=0;s<r.length&&s<i.length;++s){const l=typeof t=="number"?t:t[s];r[s]=e(l,s,r)}return r}return e(t)}class k2 extends Array{clone(){return new this.constructor().copy(this)}fromArray(e,r=0){for(let i=0;i<this.ELEMENTS;++i)this[i]=e[i+r];return this.check()}toArray(e=[],r=0){for(let i=0;i<this.ELEMENTS;++i)e[r+i]=this[i];return e}toObject(e){return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:dd(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(vs)}formatString(e){let r="";for(let i=0;i<this.ELEMENTS;++i)r+=(i>0?", ":"")+lW(this[i],e);return`${e.printTypes?this.constructor.name:""}[${r}]`}equals(e){if(!e||this.length!==e.length)return!1;for(let r=0;r<this.ELEMENTS;++r)if(!cc(this[r],e[r]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let r=0;r<this.ELEMENTS;++r)if(this[r]!==e[r])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,r,i){if(i===void 0)return this.lerp(this,e,r);for(let s=0;s<this.ELEMENTS;++s){const l=e[s],h=typeof r=="number"?r:r[s];this[s]=l+i*(h-l)}return this.check()}min(e){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(e[r],this[r]);return this.check()}max(e){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.max(e[r],this[r]);return this.check()}clamp(e,r){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(Math.max(this[i],e[i]),r[i]);return this.check()}add(...e){for(const r of e)for(let i=0;i<this.ELEMENTS;++i)this[i]+=r[i];return this.check()}subtract(...e){for(const r of e)for(let i=0;i<this.ELEMENTS;++i)this[i]-=r[i];return this.check()}scale(e){if(typeof e=="number")for(let r=0;r<this.ELEMENTS;++r)this[r]*=e;else for(let r=0;r<this.ELEMENTS&&r<e.length;++r)this[r]*=e[r];return this.check()}multiplyByScalar(e){for(let r=0;r<this.ELEMENTS;++r)this[r]*=e;return this.check()}check(){if(vs.debug&&!this.validate())throw new Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let e=this.length===this.ELEMENTS;for(let r=0;r<this.ELEMENTS;++r)e=e&&Number.isFinite(this[r]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let r=0;r<this.ELEMENTS;++r)this[r]=e;return this.check()}addScalar(e){for(let r=0;r<this.ELEMENTS;++r)this[r]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let r=0;r<this.ELEMENTS;++r)this[r]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,r){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(Math.max(this[i],e),r);return this.check()}get elements(){return this}}function fW(t,e){if(t.length!==e)return!1;for(let r=0;r<t.length;++r)if(!Number.isFinite(t[r]))return!1;return!0}function pi(t){if(!Number.isFinite(t))throw new Error(`Invalid number ${JSON.stringify(t)}`);return t}function s_(t,e,r=""){if(vs.debug&&!fW(t,e))throw new Error(`math.gl: ${r} some fields set to invalid numbers'`);return t}function rc(t,e){if(!t)throw new Error(`math.gl assertion ${e}`)}class B2 extends k2{get x(){return this[0]}set x(e){this[0]=pi(e)}get y(){return this[1]}set y(e){this[1]=pi(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let r=0;r<this.ELEMENTS;++r)e+=this[r]*this[r];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let r=0;for(let i=0;i<this.ELEMENTS;++i){const s=this[i]-e[i];r+=s*s}return pi(r)}dot(e){let r=0;for(let i=0;i<this.ELEMENTS;++i)r+=this[i]*e[i];return pi(r)}normalize(){const e=this.magnitude();if(e!==0)for(let r=0;r<this.ELEMENTS;++r)this[r]/=e;return this.check()}multiply(...e){for(const r of e)for(let i=0;i<this.ELEMENTS;++i)this[i]*=r[i];return this.check()}divide(...e){for(const r of e)for(let i=0;i<this.ELEMENTS;++i)this[i]/=r[i];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return rc(e>=0&&e<this.ELEMENTS,"index is out of range"),pi(this[e])}setComponent(e,r){return rc(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=r,this.check()}addVectors(e,r){return this.copy(e).add(r)}subVectors(e,r){return this.copy(e).subtract(r)}multiplyVectors(e,r){return this.copy(e).multiply(r)}addScaledVector(e,r){return this.add(new this.constructor(e).multiplyScalar(r))}}const o_=1e-6;let hc=typeof Float32Array<"u"?Float32Array:Array;function mW(){const t=new hc(2);return hc!=Float32Array&&(t[0]=0,t[1]=0),t}function qT(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t}function gW(t,e){return t[0]=-e[0],t[1]=-e[1],t}function F5(t,e,r,i){const s=e[0],l=e[1];return t[0]=s+i*(r[0]-s),t[1]=l+i*(r[1]-l),t}function _W(t,e,r){const i=e[0],s=e[1];return t[0]=r[0]*i+r[2]*s,t[1]=r[1]*i+r[3]*s,t}function yW(t,e,r){const i=e[0],s=e[1];return t[0]=r[0]*i+r[2]*s+r[4],t[1]=r[1]*i+r[3]*s+r[5],t}function z5(t,e,r){const i=e[0],s=e[1];return t[0]=r[0]*i+r[3]*s+r[6],t[1]=r[1]*i+r[4]*s+r[7],t}function U5(t,e,r){const i=e[0],s=e[1];return t[0]=r[0]*i+r[4]*s+r[12],t[1]=r[1]*i+r[5]*s+r[13],t}(function(){const t=mW();return function(e,r,i,s,l,h){let a,v;for(r||(r=2),i||(i=0),s?v=Math.min(s*r+i,e.length):v=e.length,a=i;a<v;a+=r)t[0]=e[a],t[1]=e[a+1],l(t,t,h),e[a]=t[0],e[a+1]=t[1];return e}})();function j5(t,e,r){const i=e[0],s=e[1],l=r[3]*i+r[7]*s||1;return t[0]=(r[0]*i+r[4]*s)/l,t[1]=(r[1]*i+r[5]*s)/l,t}function V5(t,e,r){const i=e[0],s=e[1],l=e[2],h=r[3]*i+r[7]*s+r[11]*l||1;return t[0]=(r[0]*i+r[4]*s+r[8]*l)/h,t[1]=(r[1]*i+r[5]*s+r[9]*l)/h,t[2]=(r[2]*i+r[6]*s+r[10]*l)/h,t}function vW(t,e,r){const i=e[0],s=e[1];return t[0]=r[0]*i+r[2]*s,t[1]=r[1]*i+r[3]*s,t[2]=e[2],t}function bW(t,e,r){const i=e[0],s=e[1];return t[0]=r[0]*i+r[2]*s,t[1]=r[1]*i+r[3]*s,t[2]=e[2],t[3]=e[3],t}function G5(t,e,r){const i=e[0],s=e[1],l=e[2];return t[0]=r[0]*i+r[3]*s+r[6]*l,t[1]=r[1]*i+r[4]*s+r[7]*l,t[2]=r[2]*i+r[5]*s+r[8]*l,t[3]=e[3],t}class L2 extends B2{constructor(e=0,r=0){super(2),dd(e)&&arguments.length===1?this.copy(e):(vs.debug&&(pi(e),pi(r)),this[0]=e,this[1]=r)}set(e,r){return this[0]=e,this[1]=r,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this.check()}fromObject(e){return vs.debug&&(pi(e.x),pi(e.y)),this[0]=e.x,this[1]=e.y,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e}get ELEMENTS(){return 2}horizontalAngle(){return Math.atan2(this.y,this.x)}verticalAngle(){return Math.atan2(this.x,this.y)}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return U5(this,this,e),this.check()}transformAsVector(e){return j5(this,this,e),this.check()}transformByMatrix3(e){return z5(this,this,e),this.check()}transformByMatrix2x3(e){return yW(this,this,e),this.check()}transformByMatrix2(e){return _W(this,this,e),this.check()}}function H5(){const t=new hc(3);return hc!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function W5(t){const e=t[0],r=t[1],i=t[2];return Math.sqrt(e*e+r*r+i*i)}function $T(t,e,r){const i=new hc(3);return i[0]=t,i[1]=e,i[2]=r,i}function xW(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t}function wW(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function EW(t,e){const r=e[0],i=e[1],s=e[2];let l=r*r+i*i+s*s;return l>0&&(l=1/Math.sqrt(l)),t[0]=e[0]*l,t[1]=e[1]*l,t[2]=e[2]*l,t}function D2(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function E0(t,e,r){const i=e[0],s=e[1],l=e[2],h=r[0],a=r[1],v=r[2];return t[0]=s*v-l*a,t[1]=l*h-i*v,t[2]=i*a-s*h,t}function N2(t,e,r){const i=e[0],s=e[1],l=e[2];let h=r[3]*i+r[7]*s+r[11]*l+r[15];return h=h||1,t[0]=(r[0]*i+r[4]*s+r[8]*l+r[12])/h,t[1]=(r[1]*i+r[5]*s+r[9]*l+r[13])/h,t[2]=(r[2]*i+r[6]*s+r[10]*l+r[14])/h,t}function q5(t,e,r){const i=e[0],s=e[1],l=e[2];return t[0]=i*r[0]+s*r[3]+l*r[6],t[1]=i*r[1]+s*r[4]+l*r[7],t[2]=i*r[2]+s*r[5]+l*r[8],t}function $5(t,e,r){const i=r[0],s=r[1],l=r[2],h=r[3],a=e[0],v=e[1],T=e[2];let C=s*T-l*v,k=l*a-i*T,L=i*v-s*a,O=s*L-l*k,K=l*C-i*L,$=i*k-s*C;const ne=h*2;return C*=ne,k*=ne,L*=ne,O*=2,K*=2,$*=2,t[0]=a+C+O,t[1]=v+k+K,t[2]=T+L+$,t}function AW(t,e,r,i){const s=[],l=[];return s[0]=e[0]-r[0],s[1]=e[1]-r[1],s[2]=e[2]-r[2],l[0]=s[0],l[1]=s[1]*Math.cos(i)-s[2]*Math.sin(i),l[2]=s[1]*Math.sin(i)+s[2]*Math.cos(i),t[0]=l[0]+r[0],t[1]=l[1]+r[1],t[2]=l[2]+r[2],t}function TW(t,e,r,i){const s=[],l=[];return s[0]=e[0]-r[0],s[1]=e[1]-r[1],s[2]=e[2]-r[2],l[0]=s[2]*Math.sin(i)+s[0]*Math.cos(i),l[1]=s[1],l[2]=s[2]*Math.cos(i)-s[0]*Math.sin(i),t[0]=l[0]+r[0],t[1]=l[1]+r[1],t[2]=l[2]+r[2],t}function SW(t,e,r,i){const s=[],l=[];return s[0]=e[0]-r[0],s[1]=e[1]-r[1],s[2]=e[2]-r[2],l[0]=s[0]*Math.cos(i)-s[1]*Math.sin(i),l[1]=s[0]*Math.sin(i)+s[1]*Math.cos(i),l[2]=s[2],t[0]=l[0]+r[0],t[1]=l[1]+r[1],t[2]=l[2]+r[2],t}function CW(t,e){const r=t[0],i=t[1],s=t[2],l=e[0],h=e[1],a=e[2],v=Math.sqrt((r*r+i*i+s*s)*(l*l+h*h+a*a)),T=v&&D2(t,e)/v;return Math.acos(Math.min(Math.max(T,-1),1))}const MW=xW,PW=W5;(function(){const t=H5();return function(e,r,i,s,l,h){let a,v;for(r||(r=3),i||(i=0),s?v=Math.min(s*r+i,e.length):v=e.length,a=i;a<v;a+=r)t[0]=e[a],t[1]=e[a+1],t[2]=e[a+2],l(t,t,h),e[a]=t[0],e[a+1]=t[1],e[a+2]=t[2];return e}})();const Qv=[0,0,0];let Hy;class Je extends B2{static get ZERO(){return Hy||(Hy=new Je(0,0,0),Object.freeze(Hy)),Hy}constructor(e=0,r=0,i=0){super(-0,-0,-0),arguments.length===1&&dd(e)?this.copy(e):(vs.debug&&(pi(e),pi(r),pi(i)),this[0]=e,this[1]=r,this[2]=i)}set(e,r,i){return this[0]=e,this[1]=r,this[2]=i,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return vs.debug&&(pi(e.x),pi(e.y),pi(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=pi(e)}angle(e){return CW(this,e)}cross(e){return E0(this,this,e),this.check()}rotateX({radians:e,origin:r=Qv}){return AW(this,this,r,e),this.check()}rotateY({radians:e,origin:r=Qv}){return TW(this,this,r,e),this.check()}rotateZ({radians:e,origin:r=Qv}){return SW(this,this,r,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return N2(this,this,e),this.check()}transformAsVector(e){return V5(this,this,e),this.check()}transformByMatrix3(e){return q5(this,this,e),this.check()}transformByMatrix2(e){return vW(this,this,e),this.check()}transformByQuaternion(e){return $5(this,this,e),this.check()}}let Wy;class O2 extends B2{static get ZERO(){return Wy||(Wy=new O2(0,0,0,0),Object.freeze(Wy)),Wy}constructor(e=0,r=0,i=0,s=0){super(-0,-0,-0,-0),dd(e)&&arguments.length===1?this.copy(e):(vs.debug&&(pi(e),pi(r),pi(i),pi(s)),this[0]=e,this[1]=r,this[2]=i,this[3]=s)}set(e,r,i,s){return this[0]=e,this[1]=r,this[2]=i,this[3]=s,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}fromObject(e){return vs.debug&&(pi(e.x),pi(e.y),pi(e.z),pi(e.w)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e.w=this[3],e}get ELEMENTS(){return 4}get z(){return this[2]}set z(e){this[2]=pi(e)}get w(){return this[3]}set w(e){this[3]=pi(e)}transform(e){return N2(this,this,e),this.check()}transformByMatrix3(e){return G5(this,this,e),this.check()}transformByMatrix2(e){return bW(this,this,e),this.check()}transformByQuaternion(e){return $5(this,this,e),this.check()}applyMatrix4(e){return e.transform(this,this),this}}class Z5 extends k2{toString(){let e="[";if(vs.printRowMajor){e+="row-major:";for(let r=0;r<this.RANK;++r)for(let i=0;i<this.RANK;++i)e+=` ${this[i*this.RANK+r]}`}else{e+="column-major:";for(let r=0;r<this.ELEMENTS;++r)e+=` ${this[r]}`}return e+="]",e}getElementIndex(e,r){return r*this.RANK+e}getElement(e,r){return this[r*this.RANK+e]}setElement(e,r,i){return this[r*this.RANK+e]=pi(i),this}getColumn(e,r=new Array(this.RANK).fill(-0)){const i=e*this.RANK;for(let s=0;s<this.RANK;++s)r[s]=this[i+s];return r}setColumn(e,r){const i=e*this.RANK;for(let s=0;s<this.RANK;++s)this[i+s]=r[s];return this}}function RW(){const t=new hc(9);return hc!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function IW(t,e){if(t===e){const r=e[1],i=e[2],s=e[5];t[1]=e[3],t[2]=e[6],t[3]=r,t[5]=e[7],t[6]=i,t[7]=s}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function kW(t,e){const r=e[0],i=e[1],s=e[2],l=e[3],h=e[4],a=e[5],v=e[6],T=e[7],C=e[8],k=C*h-a*T,L=-C*l+a*v,O=T*l-h*v;let K=r*k+i*L+s*O;return K?(K=1/K,t[0]=k*K,t[1]=(-C*i+s*T)*K,t[2]=(a*i-s*h)*K,t[3]=L*K,t[4]=(C*r-s*v)*K,t[5]=(-a*r+s*l)*K,t[6]=O*K,t[7]=(-T*r+i*v)*K,t[8]=(h*r-i*l)*K,t):null}function BW(t){const e=t[0],r=t[1],i=t[2],s=t[3],l=t[4],h=t[5],a=t[6],v=t[7],T=t[8];return e*(T*l-h*v)+r*(-T*s+h*a)+i*(v*s-l*a)}function ZT(t,e,r){const i=e[0],s=e[1],l=e[2],h=e[3],a=e[4],v=e[5],T=e[6],C=e[7],k=e[8],L=r[0],O=r[1],K=r[2],$=r[3],ne=r[4],oe=r[5],fe=r[6],ue=r[7],we=r[8];return t[0]=L*i+O*h+K*T,t[1]=L*s+O*a+K*C,t[2]=L*l+O*v+K*k,t[3]=$*i+ne*h+oe*T,t[4]=$*s+ne*a+oe*C,t[5]=$*l+ne*v+oe*k,t[6]=fe*i+ue*h+we*T,t[7]=fe*s+ue*a+we*C,t[8]=fe*l+ue*v+we*k,t}function LW(t,e,r){const i=e[0],s=e[1],l=e[2],h=e[3],a=e[4],v=e[5],T=e[6],C=e[7],k=e[8],L=r[0],O=r[1];return t[0]=i,t[1]=s,t[2]=l,t[3]=h,t[4]=a,t[5]=v,t[6]=L*i+O*h+T,t[7]=L*s+O*a+C,t[8]=L*l+O*v+k,t}function DW(t,e,r){const i=e[0],s=e[1],l=e[2],h=e[3],a=e[4],v=e[5],T=e[6],C=e[7],k=e[8],L=Math.sin(r),O=Math.cos(r);return t[0]=O*i+L*h,t[1]=O*s+L*a,t[2]=O*l+L*v,t[3]=O*h-L*i,t[4]=O*a-L*s,t[5]=O*v-L*l,t[6]=T,t[7]=C,t[8]=k,t}function XT(t,e,r){const i=r[0],s=r[1];return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=s*e[3],t[4]=s*e[4],t[5]=s*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function NW(t,e){const r=e[0],i=e[1],s=e[2],l=e[3],h=r+r,a=i+i,v=s+s,T=r*h,C=i*h,k=i*a,L=s*h,O=s*a,K=s*v,$=l*h,ne=l*a,oe=l*v;return t[0]=1-k-K,t[3]=C-oe,t[6]=L+ne,t[1]=C+oe,t[4]=1-T-K,t[7]=O-$,t[2]=L-ne,t[5]=O+$,t[8]=1-T-k,t}var kx;(function(t){t[t.COL0ROW0=0]="COL0ROW0",t[t.COL0ROW1=1]="COL0ROW1",t[t.COL0ROW2=2]="COL0ROW2",t[t.COL1ROW0=3]="COL1ROW0",t[t.COL1ROW1=4]="COL1ROW1",t[t.COL1ROW2=5]="COL1ROW2",t[t.COL2ROW0=6]="COL2ROW0",t[t.COL2ROW1=7]="COL2ROW1",t[t.COL2ROW2=8]="COL2ROW2"})(kx||(kx={}));const OW=Object.freeze([1,0,0,0,1,0,0,0,1]);class Sn extends Z5{static get IDENTITY(){return zW()}static get ZERO(){return FW()}get ELEMENTS(){return 9}get RANK(){return 3}get INDICES(){return kx}constructor(e,...r){super(-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):r.length>0?this.copy([e,...r]):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this.check()}identity(){return this.copy(OW)}fromObject(e){return this.check()}fromQuaternion(e){return NW(this,e),this.check()}set(e,r,i,s,l,h,a,v,T){return this[0]=e,this[1]=r,this[2]=i,this[3]=s,this[4]=l,this[5]=h,this[6]=a,this[7]=v,this[8]=T,this.check()}setRowMajor(e,r,i,s,l,h,a,v,T){return this[0]=e,this[1]=s,this[2]=a,this[3]=r,this[4]=l,this[5]=v,this[6]=i,this[7]=h,this[8]=T,this.check()}determinant(){return BW(this)}transpose(){return IW(this,this),this.check()}invert(){return kW(this,this),this.check()}multiplyLeft(e){return ZT(this,e,this),this.check()}multiplyRight(e){return ZT(this,this,e),this.check()}rotate(e){return DW(this,this,e),this.check()}scale(e){return Array.isArray(e)?XT(this,this,e):XT(this,this,[e,e]),this.check()}translate(e){return LW(this,this,e),this.check()}transform(e,r){let i;switch(e.length){case 2:i=z5(r||[-0,-0],e,this);break;case 3:i=q5(r||[-0,-0,-0],e,this);break;case 4:i=G5(r||[-0,-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return s_(i,e.length),i}transformVector(e,r){return this.transform(e,r)}transformVector2(e,r){return this.transform(e,r)}transformVector3(e,r){return this.transform(e,r)}}let qy,$y=null;function FW(){return qy||(qy=new Sn([0,0,0,0,0,0,0,0,0]),Object.freeze(qy)),qy}function zW(){return $y||($y=new Sn,Object.freeze($y)),$y}function UW(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function jW(t,e){if(t===e){const r=e[1],i=e[2],s=e[3],l=e[6],h=e[7],a=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=r,t[6]=e[9],t[7]=e[13],t[8]=i,t[9]=l,t[11]=e[14],t[12]=s,t[13]=h,t[14]=a}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function Bx(t,e){const r=e[0],i=e[1],s=e[2],l=e[3],h=e[4],a=e[5],v=e[6],T=e[7],C=e[8],k=e[9],L=e[10],O=e[11],K=e[12],$=e[13],ne=e[14],oe=e[15],fe=r*a-i*h,ue=r*v-s*h,we=r*T-l*h,De=i*v-s*a,Fe=i*T-l*a,Ke=s*T-l*v,ze=C*$-k*K,it=C*ne-L*K,lt=C*oe-O*K,ht=k*ne-L*$,vt=k*oe-O*$,Nt=L*oe-O*ne;let Lt=fe*Nt-ue*vt+we*ht+De*lt-Fe*it+Ke*ze;return Lt?(Lt=1/Lt,t[0]=(a*Nt-v*vt+T*ht)*Lt,t[1]=(s*vt-i*Nt-l*ht)*Lt,t[2]=($*Ke-ne*Fe+oe*De)*Lt,t[3]=(L*Fe-k*Ke-O*De)*Lt,t[4]=(v*lt-h*Nt-T*it)*Lt,t[5]=(r*Nt-s*lt+l*it)*Lt,t[6]=(ne*we-K*Ke-oe*ue)*Lt,t[7]=(C*Ke-L*we+O*ue)*Lt,t[8]=(h*vt-a*lt+T*ze)*Lt,t[9]=(i*lt-r*vt-l*ze)*Lt,t[10]=(K*Fe-$*we+oe*fe)*Lt,t[11]=(k*we-C*Fe-O*fe)*Lt,t[12]=(a*it-h*ht-v*ze)*Lt,t[13]=(r*ht-i*it+s*ze)*Lt,t[14]=($*ue-K*De-ne*fe)*Lt,t[15]=(C*De-k*ue+L*fe)*Lt,t):null}function VW(t){const e=t[0],r=t[1],i=t[2],s=t[3],l=t[4],h=t[5],a=t[6],v=t[7],T=t[8],C=t[9],k=t[10],L=t[11],O=t[12],K=t[13],$=t[14],ne=t[15],oe=e*h-r*l,fe=e*a-i*l,ue=r*a-i*h,we=T*K-C*O,De=T*$-k*O,Fe=C*$-k*K,Ke=e*Fe-r*De+i*we,ze=l*Fe-h*De+a*we,it=T*ue-C*fe+k*oe,lt=O*ue-K*fe+$*oe;return v*Ke-s*ze+ne*it-L*lt}function Vp(t,e,r){const i=e[0],s=e[1],l=e[2],h=e[3],a=e[4],v=e[5],T=e[6],C=e[7],k=e[8],L=e[9],O=e[10],K=e[11],$=e[12],ne=e[13],oe=e[14],fe=e[15];let ue=r[0],we=r[1],De=r[2],Fe=r[3];return t[0]=ue*i+we*a+De*k+Fe*$,t[1]=ue*s+we*v+De*L+Fe*ne,t[2]=ue*l+we*T+De*O+Fe*oe,t[3]=ue*h+we*C+De*K+Fe*fe,ue=r[4],we=r[5],De=r[6],Fe=r[7],t[4]=ue*i+we*a+De*k+Fe*$,t[5]=ue*s+we*v+De*L+Fe*ne,t[6]=ue*l+we*T+De*O+Fe*oe,t[7]=ue*h+we*C+De*K+Fe*fe,ue=r[8],we=r[9],De=r[10],Fe=r[11],t[8]=ue*i+we*a+De*k+Fe*$,t[9]=ue*s+we*v+De*L+Fe*ne,t[10]=ue*l+we*T+De*O+Fe*oe,t[11]=ue*h+we*C+De*K+Fe*fe,ue=r[12],we=r[13],De=r[14],Fe=r[15],t[12]=ue*i+we*a+De*k+Fe*$,t[13]=ue*s+we*v+De*L+Fe*ne,t[14]=ue*l+we*T+De*O+Fe*oe,t[15]=ue*h+we*C+De*K+Fe*fe,t}function $0(t,e,r){const i=r[0],s=r[1],l=r[2];let h,a,v,T,C,k,L,O,K,$,ne,oe;return e===t?(t[12]=e[0]*i+e[4]*s+e[8]*l+e[12],t[13]=e[1]*i+e[5]*s+e[9]*l+e[13],t[14]=e[2]*i+e[6]*s+e[10]*l+e[14],t[15]=e[3]*i+e[7]*s+e[11]*l+e[15]):(h=e[0],a=e[1],v=e[2],T=e[3],C=e[4],k=e[5],L=e[6],O=e[7],K=e[8],$=e[9],ne=e[10],oe=e[11],t[0]=h,t[1]=a,t[2]=v,t[3]=T,t[4]=C,t[5]=k,t[6]=L,t[7]=O,t[8]=K,t[9]=$,t[10]=ne,t[11]=oe,t[12]=h*i+C*s+K*l+e[12],t[13]=a*i+k*s+$*l+e[13],t[14]=v*i+L*s+ne*l+e[14],t[15]=T*i+O*s+oe*l+e[15]),t}function F2(t,e,r){const i=r[0],s=r[1],l=r[2];return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*s,t[5]=e[5]*s,t[6]=e[6]*s,t[7]=e[7]*s,t[8]=e[8]*l,t[9]=e[9]*l,t[10]=e[10]*l,t[11]=e[11]*l,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function GW(t,e,r,i){let s=i[0],l=i[1],h=i[2],a=Math.sqrt(s*s+l*l+h*h),v,T,C,k,L,O,K,$,ne,oe,fe,ue,we,De,Fe,Ke,ze,it,lt,ht,vt,Nt,Lt,qt;return a<o_?null:(a=1/a,s*=a,l*=a,h*=a,T=Math.sin(r),v=Math.cos(r),C=1-v,k=e[0],L=e[1],O=e[2],K=e[3],$=e[4],ne=e[5],oe=e[6],fe=e[7],ue=e[8],we=e[9],De=e[10],Fe=e[11],Ke=s*s*C+v,ze=l*s*C+h*T,it=h*s*C-l*T,lt=s*l*C-h*T,ht=l*l*C+v,vt=h*l*C+s*T,Nt=s*h*C+l*T,Lt=l*h*C-s*T,qt=h*h*C+v,t[0]=k*Ke+$*ze+ue*it,t[1]=L*Ke+ne*ze+we*it,t[2]=O*Ke+oe*ze+De*it,t[3]=K*Ke+fe*ze+Fe*it,t[4]=k*lt+$*ht+ue*vt,t[5]=L*lt+ne*ht+we*vt,t[6]=O*lt+oe*ht+De*vt,t[7]=K*lt+fe*ht+Fe*vt,t[8]=k*Nt+$*Lt+ue*qt,t[9]=L*Nt+ne*Lt+we*qt,t[10]=O*Nt+oe*Lt+De*qt,t[11]=K*Nt+fe*Lt+Fe*qt,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function X5(t,e,r){const i=Math.sin(r),s=Math.cos(r),l=e[4],h=e[5],a=e[6],v=e[7],T=e[8],C=e[9],k=e[10],L=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=l*s+T*i,t[5]=h*s+C*i,t[6]=a*s+k*i,t[7]=v*s+L*i,t[8]=T*s-l*i,t[9]=C*s-h*i,t[10]=k*s-a*i,t[11]=L*s-v*i,t}function HW(t,e,r){const i=Math.sin(r),s=Math.cos(r),l=e[0],h=e[1],a=e[2],v=e[3],T=e[8],C=e[9],k=e[10],L=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=l*s-T*i,t[1]=h*s-C*i,t[2]=a*s-k*i,t[3]=v*s-L*i,t[8]=l*i+T*s,t[9]=h*i+C*s,t[10]=a*i+k*s,t[11]=v*i+L*s,t}function K5(t,e,r){const i=Math.sin(r),s=Math.cos(r),l=e[0],h=e[1],a=e[2],v=e[3],T=e[4],C=e[5],k=e[6],L=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=l*s+T*i,t[1]=h*s+C*i,t[2]=a*s+k*i,t[3]=v*s+L*i,t[4]=T*s-l*i,t[5]=C*s-h*i,t[6]=k*s-a*i,t[7]=L*s-v*i,t}function WW(t,e){const r=e[0],i=e[1],s=e[2],l=e[4],h=e[5],a=e[6],v=e[8],T=e[9],C=e[10];return t[0]=Math.sqrt(r*r+i*i+s*s),t[1]=Math.sqrt(l*l+h*h+a*a),t[2]=Math.sqrt(v*v+T*T+C*C),t}function qW(t,e){const r=e[0],i=e[1],s=e[2],l=e[3],h=r+r,a=i+i,v=s+s,T=r*h,C=i*h,k=i*a,L=s*h,O=s*a,K=s*v,$=l*h,ne=l*a,oe=l*v;return t[0]=1-k-K,t[1]=C+oe,t[2]=L-ne,t[3]=0,t[4]=C-oe,t[5]=1-T-K,t[6]=O+$,t[7]=0,t[8]=L+ne,t[9]=O-$,t[10]=1-T-k,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function $W(t,e,r,i,s,l,h){const a=1/(r-e),v=1/(s-i),T=1/(l-h);return t[0]=l*2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=l*2*v,t[6]=0,t[7]=0,t[8]=(r+e)*a,t[9]=(s+i)*v,t[10]=(h+l)*T,t[11]=-1,t[12]=0,t[13]=0,t[14]=h*l*2*T,t[15]=0,t}function ZW(t,e,r,i,s){const l=1/Math.tan(e/2);if(t[0]=l/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,s!=null&&s!==1/0){const h=1/(i-s);t[10]=(s+i)*h,t[14]=2*s*i*h}else t[10]=-1,t[14]=-2*i;return t}const XW=ZW;function KW(t,e,r,i,s,l,h){const a=1/(e-r),v=1/(i-s),T=1/(l-h);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*v,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*T,t[11]=0,t[12]=(e+r)*a,t[13]=(s+i)*v,t[14]=(h+l)*T,t[15]=1,t}const YW=KW;function JW(t,e,r,i){let s,l,h,a,v,T,C,k,L,O;const K=e[0],$=e[1],ne=e[2],oe=i[0],fe=i[1],ue=i[2],we=r[0],De=r[1],Fe=r[2];return Math.abs(K-we)<o_&&Math.abs($-De)<o_&&Math.abs(ne-Fe)<o_?UW(t):(k=K-we,L=$-De,O=ne-Fe,s=1/Math.sqrt(k*k+L*L+O*O),k*=s,L*=s,O*=s,l=fe*O-ue*L,h=ue*k-oe*O,a=oe*L-fe*k,s=Math.sqrt(l*l+h*h+a*a),s?(s=1/s,l*=s,h*=s,a*=s):(l=0,h=0,a=0),v=L*a-O*h,T=O*l-k*a,C=k*h-L*l,s=Math.sqrt(v*v+T*T+C*C),s?(s=1/s,v*=s,T*=s,C*=s):(v=0,T=0,C=0),t[0]=l,t[1]=v,t[2]=k,t[3]=0,t[4]=h,t[5]=T,t[6]=L,t[7]=0,t[8]=a,t[9]=C,t[10]=O,t[11]=0,t[12]=-(l*K+h*$+a*ne),t[13]=-(v*K+T*$+C*ne),t[14]=-(k*K+L*$+O*ne),t[15]=1,t)}function QW(){const t=new hc(4);return hc!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function eq(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t}function Y5(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t}function tq(t){const e=t[0],r=t[1],i=t[2],s=t[3];return Math.sqrt(e*e+r*r+i*i+s*s)}function rq(t){const e=t[0],r=t[1],i=t[2],s=t[3];return e*e+r*r+i*i+s*s}function iq(t,e){const r=e[0],i=e[1],s=e[2],l=e[3];let h=r*r+i*i+s*s+l*l;return h>0&&(h=1/Math.sqrt(h)),t[0]=r*h,t[1]=i*h,t[2]=s*h,t[3]=l*h,t}function nq(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function sq(t,e,r,i){const s=e[0],l=e[1],h=e[2],a=e[3];return t[0]=s+i*(r[0]-s),t[1]=l+i*(r[1]-l),t[2]=h+i*(r[2]-h),t[3]=a+i*(r[3]-a),t}function O_(t,e,r){const i=e[0],s=e[1],l=e[2],h=e[3];return t[0]=r[0]*i+r[4]*s+r[8]*l+r[12]*h,t[1]=r[1]*i+r[5]*s+r[9]*l+r[13]*h,t[2]=r[2]*i+r[6]*s+r[10]*l+r[14]*h,t[3]=r[3]*i+r[7]*s+r[11]*l+r[15]*h,t}function oq(t,e,r){const i=e[0],s=e[1],l=e[2],h=r[0],a=r[1],v=r[2],T=r[3],C=T*i+a*l-v*s,k=T*s+v*i-h*l,L=T*l+h*s-a*i,O=-h*i-a*s-v*l;return t[0]=C*T+O*-h+k*-v-L*-a,t[1]=k*T+O*-a+L*-h-C*-v,t[2]=L*T+O*-v+C*-a-k*-h,t[3]=e[3],t}(function(){const t=QW();return function(e,r,i,s,l,h){let a,v;for(r||(r=4),i||(i=0),s?v=Math.min(s*r+i,e.length):v=e.length,a=i;a<v;a+=r)t[0]=e[a],t[1]=e[a+1],t[2]=e[a+2],t[3]=e[a+3],l(t,t,h),e[a]=t[0],e[a+1]=t[1],e[a+2]=t[2],e[a+3]=t[3];return e}})();var Lx;(function(t){t[t.COL0ROW0=0]="COL0ROW0",t[t.COL0ROW1=1]="COL0ROW1",t[t.COL0ROW2=2]="COL0ROW2",t[t.COL0ROW3=3]="COL0ROW3",t[t.COL1ROW0=4]="COL1ROW0",t[t.COL1ROW1=5]="COL1ROW1",t[t.COL1ROW2=6]="COL1ROW2",t[t.COL1ROW3=7]="COL1ROW3",t[t.COL2ROW0=8]="COL2ROW0",t[t.COL2ROW1=9]="COL2ROW1",t[t.COL2ROW2=10]="COL2ROW2",t[t.COL2ROW3=11]="COL2ROW3",t[t.COL3ROW0=12]="COL3ROW0",t[t.COL3ROW1=13]="COL3ROW1",t[t.COL3ROW2=14]="COL3ROW2",t[t.COL3ROW3=15]="COL3ROW3"})(Lx||(Lx={}));const aq=45*Math.PI/180,lq=1,eb=.1,tb=500,cq=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class Wr extends Z5{static get IDENTITY(){return hq()}static get ZERO(){return uq()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return Lx}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,r,i,s,l,h,a,v,T,C,k,L,O,K,$,ne){return this[0]=e,this[1]=r,this[2]=i,this[3]=s,this[4]=l,this[5]=h,this[6]=a,this[7]=v,this[8]=T,this[9]=C,this[10]=k,this[11]=L,this[12]=O,this[13]=K,this[14]=$,this[15]=ne,this.check()}setRowMajor(e,r,i,s,l,h,a,v,T,C,k,L,O,K,$,ne){return this[0]=e,this[1]=l,this[2]=T,this[3]=O,this[4]=r,this[5]=h,this[6]=C,this[7]=K,this[8]=i,this[9]=a,this[10]=k,this[11]=$,this[12]=s,this[13]=v,this[14]=L,this[15]=ne,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(cq)}fromObject(e){return this.check()}fromQuaternion(e){return qW(this,e),this.check()}frustum(e){const{left:r,right:i,bottom:s,top:l,near:h=eb,far:a=tb}=e;return a===1/0?dq(this,r,i,s,l,h):$W(this,r,i,s,l,h,a),this.check()}lookAt(e){const{eye:r,center:i=[0,0,0],up:s=[0,1,0]}=e;return JW(this,r,i,s),this.check()}ortho(e){const{left:r,right:i,bottom:s,top:l,near:h=eb,far:a=tb}=e;return YW(this,r,i,s,l,h,a),this.check()}orthographic(e){const{fovy:r=aq,aspect:i=lq,focalDistance:s=1,near:l=eb,far:h=tb}=e;KT(r);const a=r/2,v=s*Math.tan(a),T=v*i;return this.ortho({left:-T,right:T,bottom:-v,top:v,near:l,far:h})}perspective(e){const{fovy:r=45*Math.PI/180,aspect:i=1,near:s=.1,far:l=500}=e;return KT(r),XW(this,r,i,s,l),this.check()}determinant(){return VW(this)}getScale(e=[-0,-0,-0]){return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(e=[-0,-0,-0]){return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,r){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],r=r||[-0,-0,-0];const i=this.getScale(r),s=1/i[0],l=1/i[1],h=1/i[2];return e[0]=this[0]*s,e[1]=this[1]*l,e[2]=this[2]*h,e[3]=0,e[4]=this[4]*s,e[5]=this[5]*l,e[6]=this[6]*h,e[7]=0,e[8]=this[8]*s,e[9]=this[9]*l,e[10]=this[10]*h,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,r){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],r=r||[-0,-0,-0];const i=this.getScale(r),s=1/i[0],l=1/i[1],h=1/i[2];return e[0]=this[0]*s,e[1]=this[1]*l,e[2]=this[2]*h,e[3]=this[4]*s,e[4]=this[5]*l,e[5]=this[6]*h,e[6]=this[8]*s,e[7]=this[9]*l,e[8]=this[10]*h,e}transpose(){return jW(this,this),this.check()}invert(){return Bx(this,this),this.check()}multiplyLeft(e){return Vp(this,e,this),this.check()}multiplyRight(e){return Vp(this,this,e),this.check()}rotateX(e){return X5(this,this,e),this.check()}rotateY(e){return HW(this,this,e),this.check()}rotateZ(e){return K5(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,r){return GW(this,this,e,r),this.check()}scale(e){return F2(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return $0(this,this,e),this.check()}transform(e,r){return e.length===4?(r=O_(r||[-0,-0,-0,-0],e,this),s_(r,4),r):this.transformAsPoint(e,r)}transformAsPoint(e,r){const{length:i}=e;let s;switch(i){case 2:s=U5(r||[-0,-0],e,this);break;case 3:s=N2(r||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return s_(s,e.length),s}transformAsVector(e,r){let i;switch(e.length){case 2:i=j5(r||[-0,-0],e,this);break;case 3:i=V5(r||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return s_(i,e.length),i}transformPoint(e,r){return this.transformAsPoint(e,r)}transformVector(e,r){return this.transformAsPoint(e,r)}transformDirection(e,r){return this.transformAsVector(e,r)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,r,i){return this.identity().translate([e,r,i])}}let Zy,Xy;function uq(){return Zy||(Zy=new Wr([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(Zy)),Zy}function hq(){return Xy||(Xy=new Wr,Object.freeze(Xy)),Xy}function KT(t){if(t>Math.PI*2)throw Error("expected radians")}function dq(t,e,r,i,s,l){const h=2*l/(r-e),a=2*l/(s-i),v=(r+e)/(r-e),T=(s+i)/(s-i),C=-1,k=-1,L=-2*l;return t[0]=h,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=v,t[9]=T,t[10]=C,t[11]=k,t[12]=0,t[13]=0,t[14]=L,t[15]=0,t}function YT(){const t=new hc(4);return hc!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function pq(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function J5(t,e,r){r=r*.5;const i=Math.sin(r);return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=Math.cos(r),t}function JT(t,e,r){const i=e[0],s=e[1],l=e[2],h=e[3],a=r[0],v=r[1],T=r[2],C=r[3];return t[0]=i*C+h*a+s*T-l*v,t[1]=s*C+h*v+l*a-i*T,t[2]=l*C+h*T+i*v-s*a,t[3]=h*C-i*a-s*v-l*T,t}function fq(t,e,r){r*=.5;const i=e[0],s=e[1],l=e[2],h=e[3],a=Math.sin(r),v=Math.cos(r);return t[0]=i*v+h*a,t[1]=s*v+l*a,t[2]=l*v-s*a,t[3]=h*v-i*a,t}function mq(t,e,r){r*=.5;const i=e[0],s=e[1],l=e[2],h=e[3],a=Math.sin(r),v=Math.cos(r);return t[0]=i*v-l*a,t[1]=s*v+h*a,t[2]=l*v+i*a,t[3]=h*v-s*a,t}function gq(t,e,r){r*=.5;const i=e[0],s=e[1],l=e[2],h=e[3],a=Math.sin(r),v=Math.cos(r);return t[0]=i*v+s*a,t[1]=s*v-i*a,t[2]=l*v+h*a,t[3]=h*v-l*a,t}function _q(t,e){const r=e[0],i=e[1],s=e[2];return t[0]=r,t[1]=i,t[2]=s,t[3]=Math.sqrt(Math.abs(1-r*r-i*i-s*s)),t}function A0(t,e,r,i){const s=e[0],l=e[1],h=e[2],a=e[3];let v=r[0],T=r[1],C=r[2],k=r[3],L,O,K,$,ne;return L=s*v+l*T+h*C+a*k,L<0&&(L=-L,v=-v,T=-T,C=-C,k=-k),1-L>o_?(O=Math.acos(L),ne=Math.sin(O),K=Math.sin((1-i)*O)/ne,$=Math.sin(i*O)/ne):(K=1-i,$=i),t[0]=K*s+$*v,t[1]=K*l+$*T,t[2]=K*h+$*C,t[3]=K*a+$*k,t}function yq(t,e){const r=e[0],i=e[1],s=e[2],l=e[3],h=r*r+i*i+s*s+l*l,a=h?1/h:0;return t[0]=-r*a,t[1]=-i*a,t[2]=-s*a,t[3]=l*a,t}function vq(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function Q5(t,e){const r=e[0]+e[4]+e[8];let i;if(r>0)i=Math.sqrt(r+1),t[3]=.5*i,i=.5/i,t[0]=(e[5]-e[7])*i,t[1]=(e[6]-e[2])*i,t[2]=(e[1]-e[3])*i;else{let s=0;e[4]>e[0]&&(s=1),e[8]>e[s*3+s]&&(s=2);const l=(s+1)%3,h=(s+2)%3;i=Math.sqrt(e[s*3+s]-e[l*3+l]-e[h*3+h]+1),t[s]=.5*i,i=.5/i,t[3]=(e[l*3+h]-e[h*3+l])*i,t[l]=(e[l*3+s]+e[s*3+l])*i,t[h]=(e[h*3+s]+e[s*3+h])*i}return t}const bq=eq,xq=Y5,wq=nq,Eq=sq,Aq=tq,Tq=rq,e4=iq,Sq=(function(){const t=H5(),e=$T(1,0,0),r=$T(0,1,0);return function(i,s,l){const h=D2(s,l);return h<-.999999?(E0(t,e,s),PW(t)<1e-6&&E0(t,r,s),EW(t,t),J5(i,t,Math.PI),i):h>.999999?(i[0]=0,i[1]=0,i[2]=0,i[3]=1,i):(E0(t,s,l),i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=1+h,e4(i,i))}})();(function(){const t=YT(),e=YT();return function(r,i,s,l,h,a){return A0(t,i,h,a),A0(e,s,l,a),A0(r,t,e,2*a*(1-a)),r}})();(function(){const t=RW();return function(e,r,i,s){return t[0]=i[0],t[3]=i[1],t[6]=i[2],t[1]=s[0],t[4]=s[1],t[7]=s[2],t[2]=-r[0],t[5]=-r[1],t[8]=-r[2],e4(e,Q5(e,t))}})();const Cq=[0,0,0,1];class y_ extends k2{constructor(e=0,r=0,i=0,s=1){super(-0,-0,-0,-0),Array.isArray(e)&&arguments.length===1?this.copy(e):this.set(e,r,i,s)}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}set(e,r,i,s){return this[0]=e,this[1]=r,this[2]=i,this[3]=s,this.check()}fromObject(e){return this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this.check()}fromMatrix3(e){return Q5(this,e),this.check()}fromAxisRotation(e,r){return J5(this,e,r),this.check()}identity(){return pq(this),this.check()}setAxisAngle(e,r){return this.fromAxisRotation(e,r)}get ELEMENTS(){return 4}get x(){return this[0]}set x(e){this[0]=pi(e)}get y(){return this[1]}set y(e){this[1]=pi(e)}get z(){return this[2]}set z(e){this[2]=pi(e)}get w(){return this[3]}set w(e){this[3]=pi(e)}len(){return Aq(this)}lengthSquared(){return Tq(this)}dot(e){return wq(this,e)}rotationTo(e,r){return Sq(this,e,r),this.check()}add(e){return bq(this,this,e),this.check()}calculateW(){return _q(this,this),this.check()}conjugate(){return vq(this,this),this.check()}invert(){return yq(this,this),this.check()}lerp(e,r,i){return i===void 0?this.lerp(this,e,r):(Eq(this,e,r,i),this.check())}multiplyRight(e){return JT(this,this,e),this.check()}multiplyLeft(e){return JT(this,e,this),this.check()}normalize(){const e=this.len(),r=e>0?1/e:0;return this[0]=this[0]*r,this[1]=this[1]*r,this[2]=this[2]*r,this[3]=this[3]*r,e===0&&(this[3]=1),this.check()}rotateX(e){return fq(this,this,e),this.check()}rotateY(e){return mq(this,this,e),this.check()}rotateZ(e){return gq(this,this,e),this.check()}scale(e){return xq(this,this,e),this.check()}slerp(e,r,i){let s,l,h;switch(arguments.length){case 1:({start:s=Cq,target:l,ratio:h}=e);break;case 2:s=this,l=e,h=r;break;default:s=e,l=r,h=i}return A0(this,s,l,h),this.check()}transformVector4(e,r=new O2){return oq(r,e,this),s_(r,4)}lengthSq(){return this.lengthSquared()}setFromAxisAngle(e,r){return this.setAxisAngle(e,r)}premultiply(e){return this.multiplyLeft(e)}multiply(e){return this.multiplyRight(e)}}const Mq=.1,Pq=1e-12,t4=1e-15,Rq=1e-20,QT=`#if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
struct AmbientLight {
vec3 color;
};
struct PointLight {
vec3 color;
vec3 position;
vec3 attenuation;
};
struct DirectionalLight {
vec3 color;
vec3 direction;
};
uniform AmbientLight lighting_uAmbientLight;
uniform PointLight lighting_uPointLight[MAX_LIGHTS];
uniform DirectionalLight lighting_uDirectionalLight[MAX_LIGHTS];
uniform int lighting_uPointLightCount;
uniform int lighting_uDirectionalLightCount;
uniform bool lighting_uEnabled;
float getPointLightAttenuation(PointLight pointLight, float distance) {
return pointLight.attenuation.x
+ pointLight.attenuation.y * distance
+ pointLight.attenuation.z * distance * distance;
}
#endif
`,Iq={lightSources:{}};function rb(t={}){const{color:e=[0,0,0],intensity:r=1}=t;return e.map(i=>i*r/255)}function kq({ambientLight:t,pointLights:e=[],directionalLights:r=[]}){const i={};return t?i["lighting_uAmbientLight.color"]=rb(t):i["lighting_uAmbientLight.color"]=[0,0,0],e.forEach((s,l)=>{i[`lighting_uPointLight[${l}].color`]=rb(s),i[`lighting_uPointLight[${l}].position`]=s.position,i[`lighting_uPointLight[${l}].attenuation`]=s.attenuation||[1,0,0]}),i.lighting_uPointLightCount=e.length,r.forEach((s,l)=>{i[`lighting_uDirectionalLight[${l}].color`]=rb(s),i[`lighting_uDirectionalLight[${l}].direction`]=s.direction}),i.lighting_uDirectionalLightCount=r.length,i}function r4(t=Iq){if("lightSources"in t){const{ambientLight:e,pointLights:r,directionalLights:i}=t.lightSources||{};return e||r&&r.length>0||i&&i.length>0?Object.assign({},kq({ambientLight:e,pointLights:r,directionalLights:i}),{lighting_uEnabled:!0}):{lighting_uEnabled:!1}}if("lights"in t){const e={pointLights:[],directionalLights:[]};for(const r of t.lights||[])switch(r.type){case"ambient":e.ambientLight=r;break;case"directional":e.directionalLights?.push(r);break;case"point":e.pointLights?.push(r);break}return r4({lightSources:e})}return{}}const z2={name:"lights",vs:QT,fs:QT,getUniforms:r4,defines:{MAX_LIGHTS:3}},i4=`uniform float lighting_uAmbient;
uniform float lighting_uDiffuse;
uniform float lighting_uShininess;
uniform vec3  lighting_uSpecularColor;
vec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {
vec3 halfway_direction = normalize(light_direction + view_direction);
float lambertian = dot(light_direction, normal_worldspace);
float specular = 0.0;
if (lambertian > 0.0) {
float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
specular = pow(specular_angle, lighting_uShininess);
}
lambertian = max(lambertian, 0.0);
return (lambertian * lighting_uDiffuse * surfaceColor + specular * lighting_uSpecularColor) * color;
}
vec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
vec3 lightColor = surfaceColor;
if (lighting_uEnabled) {
vec3 view_direction = normalize(cameraPosition - position_worldspace);
lightColor = lighting_uAmbient * surfaceColor * lighting_uAmbientLight.color;
for (int i = 0; i < MAX_LIGHTS; i++) {
if (i >= lighting_uPointLightCount) {
break;
}
PointLight pointLight = lighting_uPointLight[i];
vec3 light_position_worldspace = pointLight.position;
vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
}
for (int i = 0; i < MAX_LIGHTS; i++) {
if (i >= lighting_uDirectionalLightCount) {
break;
}
DirectionalLight directionalLight = lighting_uDirectionalLight[i];
lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
}
}
return lightColor;
}
vec3 lighting_getSpecularLightColor(vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
vec3 lightColor = vec3(0, 0, 0);
vec3 surfaceColor = vec3(0, 0, 0);
if (lighting_uEnabled) {
vec3 view_direction = normalize(cameraPosition - position_worldspace);
for (int i = 0; i < MAX_LIGHTS; i++) {
if (i >= lighting_uPointLightCount) {
break;
}
PointLight pointLight = lighting_uPointLight[i];
vec3 light_position_worldspace = pointLight.position;
vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
}
for (int i = 0; i < MAX_LIGHTS; i++) {
if (i >= lighting_uDirectionalLightCount) {
break;
}
DirectionalLight directionalLight = lighting_uDirectionalLight[i];
lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
}
}
return lightColor;
}
`,Bq={};function Lq(t){const{ambient:e=.35,diffuse:r=.6,shininess:i=32,specularColor:s=[30,30,30]}=t;return{lighting_uAmbient:e,lighting_uDiffuse:r,lighting_uShininess:i,lighting_uSpecularColor:s.map(l=>l/255)}}function n4(t=Bq){if(!("material"in t))return{};const{material:e}=t;return e?Lq(e):{lighting_uEnabled:!1}}const Dq={name:"gouraud-lighting",dependencies:[z2],vs:i4,defines:{LIGHTING_VERTEX:1},getUniforms:n4},Nq={name:"phong-lighting",dependencies:[z2],fs:i4,defines:{LIGHTING_FRAGMENT:1},getUniforms:n4},Oq=`uniform mat4 u_MVPMatrix;
uniform mat4 u_ModelMatrix;
uniform mat4 u_NormalMatrix;
out vec3 pbr_vPosition;
out vec2 pbr_vUV;
#ifdef HAS_NORMALS
# ifdef HAS_TANGENTS
out mat3 pbr_vTBN;
# else
out vec3 pbr_vNormal;
# endif
#endif
void pbr_setPositionNormalTangentUV(vec4 position, vec4 normal, vec4 tangent, vec2 uv)
{
vec4 pos = u_ModelMatrix * position;
pbr_vPosition = vec3(pos.xyz) / pos.w;
#ifdef HAS_NORMALS
#ifdef HAS_TANGENTS
vec3 normalW = normalize(vec3(u_NormalMatrix * vec4(normal.xyz, 0.0)));
vec3 tangentW = normalize(vec3(u_ModelMatrix * vec4(tangent.xyz, 0.0)));
vec3 bitangentW = cross(normalW, tangentW) * tangent.w;
pbr_vTBN = mat3(tangentW, bitangentW, normalW);
#else
pbr_vNormal = normalize(vec3(u_ModelMatrix * vec4(normal.xyz, 0.0)));
#endif
#endif
#ifdef HAS_UV
pbr_vUV = uv;
#else
pbr_vUV = vec2(0.,0.);
#endif
}
`,Fq=`precision highp float;
uniform bool pbr_uUnlit;
#ifdef USE_IBL
uniform samplerCube u_DiffuseEnvSampler;
uniform samplerCube u_SpecularEnvSampler;
uniform sampler2D u_brdfLUT;
uniform vec2 u_ScaleIBLAmbient;
#endif
#ifdef HAS_BASECOLORMAP
uniform sampler2D u_BaseColorSampler;
#endif
#ifdef HAS_NORMALMAP
uniform sampler2D u_NormalSampler;
uniform float u_NormalScale;
#endif
#ifdef HAS_EMISSIVEMAP
uniform sampler2D u_EmissiveSampler;
uniform vec3 u_EmissiveFactor;
#endif
#ifdef HAS_METALROUGHNESSMAP
uniform sampler2D u_MetallicRoughnessSampler;
#endif
#ifdef HAS_OCCLUSIONMAP
uniform sampler2D u_OcclusionSampler;
uniform float u_OcclusionStrength;
#endif
#ifdef ALPHA_CUTOFF
uniform float u_AlphaCutoff;
#endif
uniform vec2 u_MetallicRoughnessValues;
uniform vec4 u_BaseColorFactor;
uniform vec3 u_Camera;
#ifdef PBR_DEBUG
uniform vec4 u_ScaleDiffBaseMR;
uniform vec4 u_ScaleFGDSpec;
#endif
in vec3 pbr_vPosition;
in vec2 pbr_vUV;
#ifdef HAS_NORMALS
#ifdef HAS_TANGENTS
in mat3 pbr_vTBN;
#else
in vec3 pbr_vNormal;
#endif
#endif
struct PBRInfo
{
float NdotL;
float NdotV;
float NdotH;
float LdotH;
float VdotH;
float perceptualRoughness;
float metalness;
vec3 reflectance0;
vec3 reflectance90;
float alphaRoughness;
vec3 diffuseColor;
vec3 specularColor;
vec3 n;
vec3 v;
};
const float M_PI = 3.141592653589793;
const float c_MinRoughness = 0.04;
vec4 SRGBtoLINEAR(vec4 srgbIn)
{
#ifdef MANUAL_SRGB
#ifdef SRGB_FAST_APPROXIMATION
vec3 linOut = pow(srgbIn.xyz,vec3(2.2));
#else
vec3 bLess = step(vec3(0.04045),srgbIn.xyz);
vec3 linOut = mix( srgbIn.xyz/vec3(12.92), pow((srgbIn.xyz+vec3(0.055))/vec3(1.055),vec3(2.4)), bLess );
#endif
return vec4(linOut,srgbIn.w);;
#else
return srgbIn;
#endif
}
vec3 getNormal()
{
#ifndef HAS_TANGENTS
vec3 pos_dx = dFdx(pbr_vPosition);
vec3 pos_dy = dFdy(pbr_vPosition);
vec3 tex_dx = dFdx(vec3(pbr_vUV, 0.0));
vec3 tex_dy = dFdy(vec3(pbr_vUV, 0.0));
vec3 t = (tex_dy.t * pos_dx - tex_dx.t * pos_dy) / (tex_dx.s * tex_dy.t - tex_dy.s * tex_dx.t);
#ifdef HAS_NORMALS
vec3 ng = normalize(pbr_vNormal);
#else
vec3 ng = cross(pos_dx, pos_dy);
#endif
t = normalize(t - ng * dot(ng, t));
vec3 b = normalize(cross(ng, t));
mat3 tbn = mat3(t, b, ng);
#else
mat3 tbn = pbr_vTBN;
#endif
#ifdef HAS_NORMALMAP
vec3 n = texture(u_NormalSampler, pbr_vUV).rgb;
n = normalize(tbn * ((2.0 * n - 1.0) * vec3(u_NormalScale, u_NormalScale, 1.0)));
#else
vec3 n = normalize(tbn[2].xyz);
#endif
return n;
}
#ifdef USE_IBL
vec3 getIBLContribution(PBRInfo pbrInputs, vec3 n, vec3 reflection)
{
float mipCount = 9.0;
float lod = (pbrInputs.perceptualRoughness * mipCount);
vec3 brdf = SRGBtoLINEAR(texture(u_brdfLUT,
vec2(pbrInputs.NdotV, 1.0 - pbrInputs.perceptualRoughness))).rgb;
vec3 diffuseLight = SRGBtoLINEAR(textureCube(u_DiffuseEnvSampler, n)).rgb;
#ifdef USE_TEX_LOD
vec3 specularLight = SRGBtoLINEAR(textureCubeLod(u_SpecularEnvSampler, reflection, lod)).rgb;
#else
vec3 specularLight = SRGBtoLINEAR(textureCube(u_SpecularEnvSampler, reflection)).rgb;
#endif
vec3 diffuse = diffuseLight * pbrInputs.diffuseColor;
vec3 specular = specularLight * (pbrInputs.specularColor * brdf.x + brdf.y);
diffuse *= u_ScaleIBLAmbient.x;
specular *= u_ScaleIBLAmbient.y;
return diffuse + specular;
}
#endif
vec3 diffuse(PBRInfo pbrInputs)
{
return pbrInputs.diffuseColor / M_PI;
}
vec3 specularReflection(PBRInfo pbrInputs)
{
return pbrInputs.reflectance0 +
(pbrInputs.reflectance90 - pbrInputs.reflectance0) *
pow(clamp(1.0 - pbrInputs.VdotH, 0.0, 1.0), 5.0);
}
float geometricOcclusion(PBRInfo pbrInputs)
{
float NdotL = pbrInputs.NdotL;
float NdotV = pbrInputs.NdotV;
float r = pbrInputs.alphaRoughness;
float attenuationL = 2.0 * NdotL / (NdotL + sqrt(r * r + (1.0 - r * r) * (NdotL * NdotL)));
float attenuationV = 2.0 * NdotV / (NdotV + sqrt(r * r + (1.0 - r * r) * (NdotV * NdotV)));
return attenuationL * attenuationV;
}
float microfacetDistribution(PBRInfo pbrInputs)
{
float roughnessSq = pbrInputs.alphaRoughness * pbrInputs.alphaRoughness;
float f = (pbrInputs.NdotH * roughnessSq - pbrInputs.NdotH) * pbrInputs.NdotH + 1.0;
return roughnessSq / (M_PI * f * f);
}
void PBRInfo_setAmbientLight(inout PBRInfo pbrInputs) {
pbrInputs.NdotL = 1.0;
pbrInputs.NdotH = 0.0;
pbrInputs.LdotH = 0.0;
pbrInputs.VdotH = 1.0;
}
void PBRInfo_setDirectionalLight(inout PBRInfo pbrInputs, vec3 lightDirection) {
vec3 n = pbrInputs.n;
vec3 v = pbrInputs.v;
vec3 l = normalize(lightDirection);
vec3 h = normalize(l+v);
pbrInputs.NdotL = clamp(dot(n, l), 0.001, 1.0);
pbrInputs.NdotH = clamp(dot(n, h), 0.0, 1.0);
pbrInputs.LdotH = clamp(dot(l, h), 0.0, 1.0);
pbrInputs.VdotH = clamp(dot(v, h), 0.0, 1.0);
}
void PBRInfo_setPointLight(inout PBRInfo pbrInputs, PointLight pointLight) {
vec3 light_direction = normalize(pointLight.position - pbr_vPosition);
PBRInfo_setDirectionalLight(pbrInputs, light_direction);
}
vec3 calculateFinalColor(PBRInfo pbrInputs, vec3 lightColor) {
vec3 F = specularReflection(pbrInputs);
float G = geometricOcclusion(pbrInputs);
float D = microfacetDistribution(pbrInputs);
vec3 diffuseContrib = (1.0 - F) * diffuse(pbrInputs);
vec3 specContrib = F * G * D / (4.0 * pbrInputs.NdotL * pbrInputs.NdotV);
return pbrInputs.NdotL * lightColor * (diffuseContrib + specContrib);
}
vec4 pbr_filterColor(vec4 colorUnused)
{
#ifdef HAS_BASECOLORMAP
vec4 baseColor = SRGBtoLINEAR(texture(u_BaseColorSampler, pbr_vUV)) * u_BaseColorFactor;
#else
vec4 baseColor = u_BaseColorFactor;
#endif
#ifdef ALPHA_CUTOFF
if (baseColor.a < u_AlphaCutoff) {
discard;
}
#endif
vec3 color = vec3(0, 0, 0);
if(pbr_uUnlit){
color.rgb = baseColor.rgb;
}
else{
float perceptualRoughness = u_MetallicRoughnessValues.y;
float metallic = u_MetallicRoughnessValues.x;
#ifdef HAS_METALROUGHNESSMAP
vec4 mrSample = texture(u_MetallicRoughnessSampler, pbr_vUV);
perceptualRoughness = mrSample.g * perceptualRoughness;
metallic = mrSample.b * metallic;
#endif
perceptualRoughness = clamp(perceptualRoughness, c_MinRoughness, 1.0);
metallic = clamp(metallic, 0.0, 1.0);
float alphaRoughness = perceptualRoughness * perceptualRoughness;
vec3 f0 = vec3(0.04);
vec3 diffuseColor = baseColor.rgb * (vec3(1.0) - f0);
diffuseColor *= 1.0 - metallic;
vec3 specularColor = mix(f0, baseColor.rgb, metallic);
float reflectance = max(max(specularColor.r, specularColor.g), specularColor.b);
float reflectance90 = clamp(reflectance * 25.0, 0.0, 1.0);
vec3 specularEnvironmentR0 = specularColor.rgb;
vec3 specularEnvironmentR90 = vec3(1.0, 1.0, 1.0) * reflectance90;
vec3 n = getNormal();
vec3 v = normalize(u_Camera - pbr_vPosition);
float NdotV = clamp(abs(dot(n, v)), 0.001, 1.0);
vec3 reflection = -normalize(reflect(v, n));
PBRInfo pbrInputs = PBRInfo(
0.0,
NdotV,
0.0,
0.0,
0.0,
perceptualRoughness,
metallic,
specularEnvironmentR0,
specularEnvironmentR90,
alphaRoughness,
diffuseColor,
specularColor,
n,
v
);
#ifdef USE_LIGHTS
PBRInfo_setAmbientLight(pbrInputs);
color += calculateFinalColor(pbrInputs, lighting_uAmbientLight.color);
for(int i = 0; i < lighting_uDirectionalLightCount; i++) {
if (i < lighting_uDirectionalLightCount) {
PBRInfo_setDirectionalLight(pbrInputs, lighting_uDirectionalLight[i].direction);
color += calculateFinalColor(pbrInputs, lighting_uDirectionalLight[i].color);
}
}
for(int i = 0; i < lighting_uPointLightCount; i++) {
if (i < lighting_uPointLightCount) {
PBRInfo_setPointLight(pbrInputs, lighting_uPointLight[i]);
float attenuation = getPointLightAttenuation(lighting_uPointLight[i], distance(lighting_uPointLight[i].position, pbr_vPosition));
color += calculateFinalColor(pbrInputs, lighting_uPointLight[i].color / attenuation);
}
}
#endif
#ifdef USE_IBL
color += getIBLContribution(pbrInputs, n, reflection);
#endif
#ifdef HAS_OCCLUSIONMAP
float ao = texture(u_OcclusionSampler, pbr_vUV).r;
color = mix(color, color * ao, u_OcclusionStrength);
#endif
#ifdef HAS_EMISSIVEMAP
vec3 emissive = SRGBtoLINEAR(texture(u_EmissiveSampler, pbr_vUV)).rgb * u_EmissiveFactor;
color += emissive;
#endif
#ifdef PBR_DEBUG
color = mix(color, baseColor.rgb, u_ScaleDiffBaseMR.y);
color = mix(color, vec3(metallic), u_ScaleDiffBaseMR.z);
color = mix(color, vec3(perceptualRoughness), u_ScaleDiffBaseMR.w);
#endif
}
return vec4(pow(color,vec3(1.0/2.2)), baseColor.a);
}
`,U2={name:"pbr",vs:Oq,fs:Fq,defines:{LIGHTING_FRAGMENT:1},dependencies:[z2]},s4="#define SMOOTH_EDGE_RADIUS 0.5",zq=`
${s4}

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`,Uq=`
${s4}

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,jq={name:"geometry",vs:zq,fs:Uq},Kr={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(Kr,"IDENTITY",{get:()=>(li.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const su={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},Dx={common:0,meters:1,pixels:2},Nx={click:{handler:"onClick"},panstart:{handler:"onDragStart"},panmove:{handler:"onDrag"},panend:{handler:"onDragEnd"}},Vq=Object.keys(Kr).map(t=>`const int COORDINATE_SYSTEM_${t} = ${Kr[t]};`).join(""),Gq=Object.keys(su).map(t=>`const int PROJECTION_MODE_${t} = ${su[t]};`).join(""),Hq=Object.keys(Dx).map(t=>`const int UNIT_${t.toUpperCase()} = ${Dx[t]};`).join(""),Wq=`${Vq}
${Gq}
${Hq}
uniform int project_uCoordinateSystem;
uniform int project_uProjectionMode;
uniform float project_uScale;
uniform bool project_uWrapLongitude;
uniform vec3 project_uCommonUnitsPerMeter;
uniform vec3 project_uCommonUnitsPerWorldUnit;
uniform vec3 project_uCommonUnitsPerWorldUnit2;
uniform vec4 project_uCenter;
uniform mat4 project_uModelMatrix;
uniform mat4 project_uViewProjectionMatrix;
uniform vec2 project_uViewportSize;
uniform float project_uDevicePixelRatio;
uniform float project_uFocalDistance;
uniform vec3 project_uCameraPosition;
uniform vec3 project_uCoordinateOrigin;
uniform vec3 project_uCommonOrigin;
uniform bool project_uPseudoMeters;
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
float y = clamp(lat, -89.9, 89.9);
return 1.0 / cos(radians(y));
}
float project_size() {
if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR &&
project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
project_uPseudoMeters == false) {
if (geometry.position.w == 0.0) {
return project_size_at_latitude(geometry.worldPosition.y);
}
float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
float y2 = y * y;
float y4 = y2 * y2;
float y6 = y4 * y2;
return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
}
return 1.0;
}
float project_size_at_latitude(float meters, float lat) {
return meters * project_uCommonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
return meters * project_uCommonUnitsPerMeter.z * project_size();
}
vec2 project_size(vec2 meters) {
return meters * project_uCommonUnitsPerMeter.xy * project_size();
}
vec3 project_size(vec3 meters) {
return meters * project_uCommonUnitsPerMeter * project_size();
}
vec4 project_size(vec4 meters) {
return vec4(meters.xyz * project_uCommonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
vec3 uz = normalize(up);
vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
vec3 uy = cross(uz, ux);
return mat3(ux, uy, uz);
}
bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
transform = project_get_orientation_matrix(commonPosition);
return true;
}
return false;
}
vec3 project_normal(vec3 vector) {
vec4 normal_modelspace = project_uModelMatrix * vec4(vector, 0.0);
vec3 n = normalize(normal_modelspace.xyz * project_uCommonUnitsPerMeter);
mat3 rotation;
if (project_needs_rotation(geometry.position.xyz, rotation)) {
n = rotation * n;
}
return n;
}
vec4 project_offset_(vec4 offset) {
float dy = offset.y;
vec3 commonUnitsPerWorldUnit = project_uCommonUnitsPerWorldUnit + project_uCommonUnitsPerWorldUnit2 * dy;
return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
float x = lnglat.x;
if (project_uWrapLongitude) {
x = mod(x + 180., 360.0) - 180.;
}
float y = clamp(lnglat.y, -89.9, 89.9);
return vec2(
radians(x) + PI,
PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
) * WORLD_SCALE;
}
vec3 project_globe_(vec3 lnglatz) {
float lambda = radians(lnglatz.x);
float phi = radians(lnglatz.y);
float cosPhi = cos(phi);
float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
return vec3(
sin(lambda) * cosPhi,
-cos(lambda) * cosPhi,
sin(phi)
) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
vec4 position_world = project_uModelMatrix * position;
if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR) {
if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_mercator_(position_world.xy),
project_size_at_latitude(position_world.z, position_world.y),
position_world.w
);
}
if (project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
position_world.xyz += project_uCoordinateOrigin;
}
}
if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_globe_(position_world.xyz),
position_world.w
);
}
}
if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
if (abs(position_world.y - project_uCoordinateOrigin.y) > 0.25) {
return vec4(
project_mercator_(position_world.xy) - project_uCommonOrigin.xy,
project_size(position_world.z),
position_world.w
);
}
}
}
if (project_uProjectionMode == PROJECTION_MODE_IDENTITY ||
(project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
(project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
position_world.xyz -= project_uCoordinateOrigin;
}
return project_offset_(position_world) + project_offset_(project_uModelMatrix * vec4(position64Low, 0.0));
}
vec4 project_position(vec4 position) {
return project_position(position, ZERO_64_LOW);
}
vec3 project_position(vec3 position, vec3 position64Low) {
vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
return projected_position.xyz;
}
vec3 project_position(vec3 position) {
vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
return projected_position.xyz;
}
vec2 project_position(vec2 position) {
vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
return projected_position.xy;
}
vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
return project_common_position_to_clipspace(position, project_uViewProjectionMatrix, project_uCenter);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
vec2 offset = pixels / project_uViewportSize * project_uDevicePixelRatio * 2.0;
return offset * project_uFocalDistance;
}
float project_size_to_pixel(float meters) {
return project_size(meters) * project_uScale;
}
float project_size_to_pixel(float size, int unit) {
if (unit == UNIT_METERS) return project_size_to_pixel(size);
if (unit == UNIT_COMMON) return size * project_uScale;
return size;
}
float project_pixel_size(float pixels) {
return pixels / project_uScale;
}
vec2 project_pixel_size(vec2 pixels) {
return pixels / project_uScale;
}
`;function qq(t,e){if(t===e)return!0;if(Array.isArray(t)){const r=t.length;if(!e||e.length!==r)return!1;for(let i=0;i<r;i++)if(t[i]!==e[i])return!1;return!0}return!1}function F_(t){let e={},r;return i=>{for(const s in i)if(!qq(i[s],e[s])){r=t(i),e=i;break}return r}}const eS=[0,0,0,0],$q=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],o4=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],Zq=[0,0,0],a4=[0,0,0],Xq=F_(Jq);function l4(t,e,r=a4){r.length<3&&(r=[r[0],r[1],0]);let i=r,s,l=!0;switch(e===Kr.LNGLAT_OFFSETS||e===Kr.METER_OFFSETS?s=r:s=t.isGeospatial?[Math.fround(t.longitude),Math.fround(t.latitude),0]:null,t.projectionMode){case su.WEB_MERCATOR:(e===Kr.LNGLAT||e===Kr.CARTESIAN)&&(s=[0,0,0],l=!1);break;case su.WEB_MERCATOR_AUTO_OFFSET:e===Kr.LNGLAT?i=s:e===Kr.CARTESIAN&&(i=[Math.fround(t.center[0]),Math.fround(t.center[1]),0],s=t.unprojectPosition(i),i[0]-=r[0],i[1]-=r[1],i[2]-=r[2]);break;case su.IDENTITY:i=t.position.map(Math.fround),i[2]=i[2]||0;break;case su.GLOBE:l=!1,s=null;break;default:l=!1}return{geospatialOrigin:s,shaderCoordinateOrigin:i,offsetMode:l}}function Kq(t,e,r){const{viewMatrixUncentered:i,projectionMatrix:s}=t;let{viewMatrix:l,viewProjectionMatrix:h}=t,a=eS,v=eS,T=t.cameraPosition;const{geospatialOrigin:C,shaderCoordinateOrigin:k,offsetMode:L}=l4(t,e,r);return L&&(v=t.projectPosition(C||k),T=[T[0]-v[0],T[1]-v[1],T[2]-v[2]],v[3]=1,a=O_([],v,h),l=i||l,h=Vp([],s,l),h=Vp([],h,$q)),{viewMatrix:l,viewProjectionMatrix:h,projectionCenter:a,originCommon:v,cameraPosCommon:T,shaderCoordinateOrigin:k,geospatialOrigin:C}}function Yq({viewport:t,devicePixelRatio:e=1,modelMatrix:r=null,coordinateSystem:i=Kr.DEFAULT,coordinateOrigin:s=a4,autoWrapLongitude:l=!1}){i===Kr.DEFAULT&&(i=t.isGeospatial?Kr.LNGLAT:Kr.CARTESIAN);const h=Xq({viewport:t,devicePixelRatio:e,coordinateSystem:i,coordinateOrigin:s});return h.project_uWrapLongitude=l,h.project_uModelMatrix=r||o4,h}function Jq({viewport:t,devicePixelRatio:e,coordinateSystem:r,coordinateOrigin:i}){const{projectionCenter:s,viewProjectionMatrix:l,originCommon:h,cameraPosCommon:a,shaderCoordinateOrigin:v,geospatialOrigin:T}=Kq(t,r,i),C=t.getDistanceScales(),k=[t.width*e,t.height*e],L=O_([],[0,0,-t.focalDistance,1],t.projectionMatrix)[3]||1,O={project_uCoordinateSystem:r,project_uProjectionMode:t.projectionMode,project_uCoordinateOrigin:v,project_uCommonOrigin:h.slice(0,3),project_uCenter:s,project_uPseudoMeters:!!t._pseudoMeters,project_uViewportSize:k,project_uDevicePixelRatio:e,project_uFocalDistance:L,project_uCommonUnitsPerMeter:C.unitsPerMeter,project_uCommonUnitsPerWorldUnit:C.unitsPerMeter,project_uCommonUnitsPerWorldUnit2:Zq,project_uScale:t.scale,project_uWrapLongitude:!1,project_uViewProjectionMatrix:l,project_uModelMatrix:o4,project_uCameraPosition:a};if(T){const K=t.getDistanceScales(T);switch(r){case Kr.METER_OFFSETS:O.project_uCommonUnitsPerWorldUnit=K.unitsPerMeter,O.project_uCommonUnitsPerWorldUnit2=K.unitsPerMeter2;break;case Kr.LNGLAT:case Kr.LNGLAT_OFFSETS:t._pseudoMeters||(O.project_uCommonUnitsPerMeter=K.unitsPerMeter),O.project_uCommonUnitsPerWorldUnit=K.unitsPerDegree,O.project_uCommonUnitsPerWorldUnit2=K.unitsPerDegree2;break;case Kr.CARTESIAN:O.project_uCommonUnitsPerWorldUnit=[1,1,K.unitsPerMeter[2]],O.project_uCommonUnitsPerWorldUnit2=[0,0,K.unitsPerMeter2[2]];break}}return O}const Qq={};function e$(t=Qq){return"viewport"in t?Yq(t):{}}const j2={name:"project",dependencies:[ZH,jq],vs:Wq,getUniforms:e$},t$=`
vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`,V2={name:"project32",dependencies:[j2],vs:t$};function r$(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function cm(t,e){const r=O_([],e,t);return Y5(r,r,1/r[3]),r}function tS(t,e){const r=t%e;return r<0?e+r:r}function Ox(t,e,r){return t<e?e:t>r?r:t}function i$(t){return Math.log(t)*Math.LOG2E}const G2=Math.log2||i$;function ah(t,e){if(!t)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}const nc=Math.PI,c4=nc/4,Sl=nc/180,Fx=180/nc,bm=512,Z0=4003e4,Ky=85.051129,n$=1.5;function s$(t){return G2(t)}function v_(t){const[e,r]=t;ah(Number.isFinite(e)),ah(Number.isFinite(r)&&r>=-90&&r<=90,"invalid latitude");const i=e*Sl,s=r*Sl,l=bm*(i+nc)/(2*nc),h=bm*(nc+Math.log(Math.tan(c4+s*.5)))/(2*nc);return[l,h]}function xm(t){const[e,r]=t,i=e/bm*(2*nc)-nc,s=2*(Math.atan(Math.exp(r/bm*(2*nc)-nc))-c4);return[i*Fx,s*Fx]}function o$(t){const{latitude:e}=t;ah(Number.isFinite(e));const r=Math.cos(e*Sl);return s$(Z0*r)-9}function T0(t){const e=Math.cos(t*Sl);return bm/Z0/e}function zx(t){const{latitude:e,longitude:r,highPrecision:i=!1}=t;ah(Number.isFinite(e)&&Number.isFinite(r));const s=bm,l=Math.cos(e*Sl),h=s/360,a=h/l,v=s/Z0/l,T={unitsPerMeter:[v,v,v],metersPerUnit:[1/v,1/v,1/v],unitsPerDegree:[h,a,v],degreesPerUnit:[1/h,1/a,1/v]};if(i){const C=Sl*Math.tan(e*Sl)/l,k=h*C/2,L=s/Z0*C,O=L/a*v;T.unitsPerDegree2=[0,k,L],T.unitsPerMeter2=[O,0,O]}return T}function u4(t,e){const[r,i,s]=t,[l,h,a]=e,{unitsPerMeter:v,unitsPerMeter2:T}=zx({longitude:r,latitude:i,highPrecision:!0}),C=v_(t);C[0]+=l*(v[0]+T[0]*h),C[1]+=h*(v[1]+T[1]*h);const k=xm(C),L=(s||0)+(a||0);return Number.isFinite(s)||Number.isFinite(a)?[k[0],k[1],L]:k}function a$(t){const{height:e,pitch:r,bearing:i,altitude:s,scale:l,center:h}=t,a=r$();$0(a,a,[0,0,-s]),X5(a,a,-r*Sl),K5(a,a,i*Sl);const v=l/e;return F2(a,a,[v,v,v]),h&&$0(a,a,wW([],h)),a}function l$(t){const{width:e,height:r,altitude:i,pitch:s=0,offset:l,center:h,scale:a,nearZMultiplier:v=1,farZMultiplier:T=1}=t;let{fovy:C=X0(n$)}=t;i!==void 0&&(C=X0(i));const k=C*Sl,L=s*Sl,O=h4(C);let K=O;h&&(K+=h[2]*a/Math.cos(L)/r);const $=k*(.5+(l?l[1]:0)/r),ne=Math.sin($)*K/Math.sin(Ox(Math.PI/2-L-$,.01,Math.PI-.01)),oe=Math.sin(L)*ne+K,fe=K*10,ue=Math.min(oe*T,fe);return{fov:k,aspect:e/r,focalDistance:O,near:v,far:ue}}function X0(t){return 2*Math.atan(.5/t)*Fx}function h4(t){return .5/Math.tan(.5*t*Sl)}function d4(t,e){const[r,i,s=0]=t;return ah(Number.isFinite(r)&&Number.isFinite(i)&&Number.isFinite(s)),cm(e,[r,i,s,1])}function H2(t,e,r=0){const[i,s,l]=t;if(ah(Number.isFinite(i)&&Number.isFinite(s),"invalid pixel coordinate"),Number.isFinite(l))return cm(e,[i,s,l,1]);const h=cm(e,[i,s,0,1]),a=cm(e,[i,s,1,1]),v=h[2],T=a[2],C=v===T?0:((r||0)-v)/(T-v);return F5([],h,a,C)}function c$(t){const{width:e,height:r,bounds:i,minExtent:s=0,maxZoom:l=24,offset:h=[0,0]}=t,[[a,v],[T,C]]=i,k=u$(t.padding),L=v_([a,Ox(C,-Ky,Ky)]),O=v_([T,Ox(v,-Ky,Ky)]),K=[Math.max(Math.abs(O[0]-L[0]),s),Math.max(Math.abs(O[1]-L[1]),s)],$=[e-k.left-k.right-Math.abs(h[0])*2,r-k.top-k.bottom-Math.abs(h[1])*2];ah($[0]>0&&$[1]>0);const ne=$[0]/K[0],oe=$[1]/K[1],fe=(k.right-k.left)/2/ne,ue=(k.top-k.bottom)/2/oe,we=[(O[0]+L[0])/2+fe,(O[1]+L[1])/2+ue],De=xm(we),Fe=Math.min(l,G2(Math.abs(Math.min(ne,oe))));return ah(Number.isFinite(Fe)),{longitude:De[0],latitude:De[1],zoom:Fe}}function u$(t=0){return typeof t=="number"?{top:t,bottom:t,left:t,right:t}:(ah(Number.isFinite(t.top)&&Number.isFinite(t.bottom)&&Number.isFinite(t.left)&&Number.isFinite(t.right)),t)}const rS=Math.PI/180;function h$(t,e=0){const{width:r,height:i,unproject:s}=t,l={targetZ:e},h=s([0,i],l),a=s([r,i],l);let v,T;const C=t.fovy?.5*t.fovy*rS:Math.atan(.5/t.altitude),k=(90-t.pitch)*rS;return C>k-.01?(v=iS(t,0,e),T=iS(t,r,e)):(v=s([0,0],l),T=s([r,0],l)),[h,a,T,v]}function iS(t,e,r){const{pixelUnprojectionMatrix:i}=t,s=cm(i,[e,0,1,1]),l=cm(i,[e,t.height,1,1]),h=(r*t.distanceScales.unitsPerMeter[2]-s[2])/(l[2]-s[2]),a=F5([],s,l,h),v=xm(a);return v.push(r),v}const nS=512;function d$(t){const{width:e,height:r,pitch:i=0}=t;let{longitude:s,latitude:l,zoom:h,bearing:a=0}=t;(s<-180||s>180)&&(s=tS(s+180,360)-180),(a<-180||a>180)&&(a=tS(a+180,360)-180);const v=G2(r/nS);if(h<=v)h=v,l=0;else{const T=r/2/Math.pow(2,h),C=xm([0,T])[1];if(l<C)l=C;else{const k=xm([0,nS-T])[1];l>k&&(l=k)}}return{width:e,height:r,longitude:s,latitude:l,zoom:h,pitch:i,bearing:a}}const p$=`
const int max_lights = 2;
uniform mat4 shadow_uViewProjectionMatrices[max_lights];
uniform vec4 shadow_uProjectCenters[max_lights];
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform int shadow_uLightId;
uniform float shadow_uLightCount;

out vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  if (shadow_uDrawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[shadow_uLightId], shadow_uProjectCenters[shadow_uLightId]);
  }
  if (shadow_uUseShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow_uLightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[i], shadow_uProjectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,f$=`
const int max_lights = 2;
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;
uniform vec4 shadow_uColor;
uniform float shadow_uLightCount;

in vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow_uDrawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow_uUseShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow_uLightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow_uColor.a / shadow_uLightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow_uColor.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,m$=F_(b$),g$=F_(x$),_$=[0,0,0,1],y$=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function v$(t,e){const[r,i,s]=t,l=H2([r,i,s],e);return Number.isFinite(s)?l:[l[0],l[1],0]}function b$({viewport:t,center:e}){return new Wr(t.viewProjectionMatrix).invert().transform(e)}function x$({viewport:t,shadowMatrices:e}){const r=[],i=t.pixelUnprojectionMatrix,s=t.isGeospatial?void 0:1,l=[[0,0,s],[t.width,0,s],[0,t.height,s],[t.width,t.height,s],[0,0,-1],[t.width,0,-1],[0,t.height,-1],[t.width,t.height,-1]].map(h=>v$(h,i));for(const h of e){const a=h.clone().translate(new Je(t.center).negate()),v=l.map(C=>a.transform(C)),T=new Wr().ortho({left:Math.min(...v.map(C=>C[0])),right:Math.max(...v.map(C=>C[0])),bottom:Math.min(...v.map(C=>C[1])),top:Math.max(...v.map(C=>C[1])),near:Math.min(...v.map(C=>-C[2])),far:Math.max(...v.map(C=>-C[2]))});r.push(T.multiplyRight(h))}return r}function w$(t,e){const{shadowEnabled:r=!0}=t;if(!r||!t.shadowMatrices||!t.shadowMatrices.length)return{shadow_uDrawShadowMap:!1,shadow_uUseShadowMap:!1,shadow_uShadowMap0:t.dummyShadowMap,shadow_uShadowMap1:t.dummyShadowMap};const i={shadow_uDrawShadowMap:!!t.drawToShadowMap,shadow_uUseShadowMap:t.shadowMaps?t.shadowMaps.length>0:!1,shadow_uColor:t.shadowColor||_$,shadow_uLightId:t.shadowLightId||0,shadow_uLightCount:t.shadowMatrices.length},s=m$({viewport:t.viewport,center:e.project_uCenter}),l=[],h=g$({shadowMatrices:t.shadowMatrices,viewport:t.viewport}).slice();for(let a=0;a<t.shadowMatrices.length;a++){const v=h[a],T=v.clone().translate(new Je(t.viewport.center).negate());e.project_uCoordinateSystem===Kr.LNGLAT&&e.project_uProjectionMode===su.WEB_MERCATOR?(h[a]=T,l[a]=s):(h[a]=v.clone().multiplyRight(y$),l[a]=T.transform(s))}for(let a=0;a<h.length;a++)i[`shadow_uViewProjectionMatrices[${a}]`]=h[a],i[`shadow_uProjectCenters[${a}]`]=l[a];for(let a=0;a<2;a++)i[`shadow_uShadowMap${a}`]=t.shadowMaps&&t.shadowMaps[a]||t.dummyShadowMap;return i}const sS={name:"shadow",dependencies:[j2],vs:p$,fs:f$,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:(t={},e={})=>"viewport"in t&&(t.drawToShadowMap||t.shadowMaps&&t.shadowMaps.length>0)?w$(t,e):{}},W2={...WT,defaultUniforms:{...WT.defaultUniforms,useFloatColors:!1},inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}}},E$=[j2],A$=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"];function T$(){const t=Np.getDefaultShaderAssembler();for(const e of E$)t.addDefaultModule(e);for(const e of A$)t.addShaderHook(e);return t}const S$=[255,255,255],C$=1;let M$=0;class P${constructor(e={}){this.type="ambient";const{color:r=S$}=e,{intensity:i=C$}=e;this.id=e.id||`ambient-${M$++}`,this.color=r,this.intensity=i}}const R$=[255,255,255],I$=1,k$=[0,0,-1];let B$=0;class oS{constructor(e={}){this.type="directional";const{color:r=R$}=e,{intensity:i=I$}=e,{direction:s=k$}=e,{_shadow:l=!1}=e;this.id=e.id||`directional-${B$++}`,this.color=r,this.intensity=i,this.type="directional",this.direction=new Je(s).normalize().toArray(),this.shadow=l}getProjectedLight(e){return this}}class L${constructor(e,r={id:"pass"}){const{id:i}=r;this.id=i,this.device=e,this.props={...r}}setProps(e){Object.assign(this.props,e)}render(e){}cleanup(){}}class q2 extends L${constructor(){super(...arguments),this._lastRenderIndex=-1}render(e){const[r,i]=this.device.canvasContext.getDrawingBufferSize(),s=e.clearCanvas??!0,l=e.clearColor??(s?[0,0,0,0]:!1),h=s?1:!1,a=s?0:!1,v=e.colorMask??15,T={viewport:[0,0,r,i]};e.colorMask&&(T.colorMask=v),e.scissorRect&&(T.scissorRect=e.scissorRect);const C=this.device.beginRenderPass({framebuffer:e.target,parameters:T,clearColor:l,clearDepth:h,clearStencil:a});try{return this._drawLayers(C,e)}finally{C.end()}}_drawLayers(e,r){const{target:i,moduleParameters:s,viewports:l,views:h,onViewportActive:a,clearStack:v=!0}=r;r.pass=r.pass||"unknown",v&&(this._lastRenderIndex=-1);const T=[];for(const C of l){const k=h&&h[C.id];a?.(C);const L=this._getDrawLayerParams(C,r),O=C.subViewports||[C];for(const K of O){const $=this._drawLayersInViewport(e,{target:i,moduleParameters:s,viewport:K,view:k,pass:r.pass,layers:r.layers},L);T.push($)}}return T}_getDrawLayerParams(e,{layers:r,pass:i,isPicking:s=!1,layerFilter:l,cullRect:h,effects:a,moduleParameters:v},T=!1){const C=[],k=p4(this._lastRenderIndex+1),L={layer:r[0],viewport:e,isPicking:s,renderPass:i,cullRect:h},O={};for(let K=0;K<r.length;K++){const $=r[K],ne=this._shouldDrawLayer($,L,l,O),oe={shouldDrawLayer:ne};ne&&!T&&(oe.layerRenderIndex=k($,ne),oe.moduleParameters=this._getModuleParameters($,a,i,v),oe.layerParameters={...$.context.deck?.props.parameters,...this.getLayerParameters($,K,e)}),C[K]=oe}return C}_drawLayersInViewport(e,{layers:r,moduleParameters:i,pass:s,target:l,viewport:h,view:a},v){const T=D$(this.device,{moduleParameters:i,target:l,viewport:h});if(a&&a.props.clear){const k=a.props.clear===!0?{color:!0,depth:!0}:a.props.clear;this.device.withParametersWebGL({scissorTest:!0,scissor:T},()=>this.device.clearWebGL(k))}const C={totalCount:r.length,visibleCount:0,compositeCount:0,pickableCount:0};e.setParameters({viewport:T});for(let k=0;k<r.length;k++){const L=r[k],{shouldDrawLayer:O,layerRenderIndex:K,moduleParameters:$,layerParameters:ne}=v[k];if(O&&L.props.pickable&&C.pickableCount++,L.isComposite)C.compositeCount++;else if(O){C.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,K),$.viewport=h,L.context.renderPass=e;try{L._drawLayer({renderPass:e,moduleParameters:$,uniforms:{layerIndex:K},parameters:ne})}catch(oe){L.raiseError(oe,`drawing ${L} to ${s}`)}}}return C}shouldDrawLayer(e){return!0}getModuleParameters(e,r){return null}getLayerParameters(e,r,i){return e.props.parameters}_shouldDrawLayer(e,r,i,s){if(!(e.props.visible&&this.shouldDrawLayer(e)))return!1;r.layer=e;let l=e.parent;for(;l;){if(!l.props.visible||!l.filterSubLayer(r))return!1;r.layer=l,l=l.parent}if(i){const h=r.layer.id;if(h in s||(s[h]=i(r)),!s[h])return!1}return e.activateViewport(r.viewport),!0}_getModuleParameters(e,r,i,s){const l=this.device.canvasContext.cssToDeviceRatio(),h=Object.assign(Object.create(e.internalState?.propsInTransition||e.props),{autoWrapLongitude:e.wrapLongitude,viewport:e.context.viewport,mousePosition:e.context.mousePosition,picking:{isActive:0},devicePixelRatio:l});if(r)for(const a of r)Object.assign(h,a.getModuleParameters?.(e));return Object.assign(h,this.getModuleParameters(e,r),s)}}function p4(t=0,e={}){const r={},i=(s,l)=>{const h=s.props._offset,a=s.id,v=s.parent&&s.parent.id;let T;if(v&&!(v in e)&&i(s.parent,!1),v in r){const C=r[v]=r[v]||p4(e[v],e);T=C(s,l),r[a]=C}else Number.isFinite(h)?(T=h+(e[v]||0),r[a]=null):T=t;return l&&T>=t&&(t=T+1),e[a]=T,T};return i}function D$(t,{moduleParameters:e,target:r,viewport:i}){const s=e&&e.devicePixelRatio||t.canvasContext.cssToDeviceRatio(),[,l]=t.canvasContext.getDrawingBufferSize(),h=r?r.height:l,a=i;return[a.x*s,h-(a.y+a.height)*s,a.width*s,a.height*s]}class N$ extends q2{constructor(e,r){super(e,r),this.shadowMap=e.createTexture({width:1,height:1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}}),this.depthBuffer=e.createTexture({format:"depth16unorm",width:1,height:1,mipmaps:!1,dataFormat:6402,type:5125}),this.fbo=e.createFramebuffer({id:"shadowmap",width:1,height:1,colorAttachments:[this.shadowMap],depthStencilAttachment:this.depthBuffer})}render(e){const r=this.fbo,i=this.device.canvasContext.cssToDeviceRatio(),s=e.viewports[0],l=s.width*i,h=s.height*i,a=[1,1,1,1];(l!==r.width||h!==r.height)&&r.resize({width:l,height:h}),super.render({...e,clearColor:a,target:r,pass:"shadow"})}getLayerParameters(e,r,i){return{...e.props.parameters,blend:!1,depthRange:[0,1],depthTest:!0}}shouldDrawLayer(e){return e.props.shadowEnabled!==!1}getModuleParameters(){return{drawToShadowMap:!0}}delete(){this.fbo&&(this.fbo.destroy(),this.fbo=null),this.shadowMap&&(this.shadowMap.destroy(),this.shadowMap=null),this.depthBuffer&&(this.depthBuffer.destroy(),this.depthBuffer=null)}}const O$={color:[255,255,255],intensity:1},aS=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],F$=[0,0,0,200/255];class f4{constructor(e={}){this.id="lighting-effect",this.shadowColor=F$,this.shadow=!1,this.ambientLight=null,this.directionalLights=[],this.pointLights=[],this.shadowPasses=[],this.shadowMaps=[],this.dummyShadowMap=null,this.setProps(e)}setup(e){this.context=e;const{device:r,deck:i}=e;this.shadow&&!this.dummyShadowMap&&(this._createShadowPasses(r),i._addDefaultShaderModule(sS),this.dummyShadowMap=r.createTexture({width:1,height:1}))}setProps(e){this.ambientLight=null,this.directionalLights=[],this.pointLights=[];for(const r in e){const i=e[r];switch(i.type){case"ambient":this.ambientLight=i;break;case"directional":this.directionalLights.push(i);break;case"point":this.pointLights.push(i);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(r=>r.shadow),this.context&&this.setup(this.context),this.props=e}preRender({layers:e,layerFilter:r,viewports:i,onViewportActive:s,views:l}){if(this.shadow){this.shadowMatrices=this._calculateMatrices();for(let h=0;h<this.shadowPasses.length;h++)this.shadowPasses[h].render({layers:e,layerFilter:r,viewports:i,onViewportActive:s,views:l,moduleParameters:{shadowLightId:h,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}})}}getModuleParameters(e){const r=this.shadow?{shadowMaps:this.shadowMaps,dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{};return r.lightSources={ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(i=>i.getProjectedLight({layer:e})),pointLights:this.pointLights.map(i=>i.getProjectedLight({layer:e}))},r}cleanup(e){for(const r of this.shadowPasses)r.delete();this.shadowPasses.length=0,this.shadowMaps.length=0,this.dummyShadowMap&&(this.dummyShadowMap.destroy(),this.dummyShadowMap=null,e.deck._removeDefaultShaderModule(sS))}_calculateMatrices(){const e=[];for(const r of this.directionalLights){const i=new Wr().lookAt({eye:new Je(r.direction).negate()});e.push(i)}return e}_createShadowPasses(e){for(let r=0;r<this.directionalLights.length;r++){const i=new N$(e);this.shadowPasses[r]=i,this.shadowMaps[r]=i.shadowMap}}_applyDefaultLights(){const{ambientLight:e,pointLights:r,directionalLights:i}=this;!e&&r.length===0&&i.length===0&&(this.ambientLight=new P$(O$),this.directionalLights.push(new oS(aS[0]),new oS(aS[1])))}}class z${constructor(e={}){this._pool=[],this.opts={overAlloc:2,poolSize:100},this.setOptions(e)}setOptions(e){Object.assign(this.opts,e)}allocate(e,r,{size:i=1,type:s,padding:l=0,copy:h=!1,initialize:a=!1,maxCount:v}){const T=s||e&&e.constructor||Float32Array,C=r*i+l;if(ArrayBuffer.isView(e)){if(C<=e.length)return e;if(C*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new T(e.buffer,0,C)}let k=1/0;v&&(k=v*i+l);const L=this._allocate(T,C,a,k);return e&&h?L.set(e):a||L.fill(0,0,4),this._release(e),L}release(e){this._release(e)}_allocate(e,r,i,s){let l=Math.max(Math.ceil(r*this.opts.overAlloc),1);l>s&&(l=s);const h=this._pool,a=e.BYTES_PER_ELEMENT*l,v=h.findIndex(T=>T.byteLength>=a);if(v>=0){const T=new e(h.splice(v,1)[0],0,l);return i&&T.fill(0),T}return new e(l)}_release(e){if(!ArrayBuffer.isView(e))return;const r=this._pool,{buffer:i}=e,{byteLength:s}=i,l=r.findIndex(h=>h.byteLength>=s);l<0?r.push(i):(l>0||r.length<this.opts.poolSize)&&r.splice(l,0,i),r.length>this.opts.poolSize&&r.shift()}}const b_=new z$;function $g(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function U$(t){return[t[12],t[13],t[14]]}function j$(t){return{left:Ff(t[3]+t[0],t[7]+t[4],t[11]+t[8],t[15]+t[12]),right:Ff(t[3]-t[0],t[7]-t[4],t[11]-t[8],t[15]-t[12]),bottom:Ff(t[3]+t[1],t[7]+t[5],t[11]+t[9],t[15]+t[13]),top:Ff(t[3]-t[1],t[7]-t[5],t[11]-t[9],t[15]-t[13]),near:Ff(t[3]+t[2],t[7]+t[6],t[11]+t[10],t[15]+t[14]),far:Ff(t[3]-t[2],t[7]-t[6],t[11]-t[10],t[15]-t[14])}}const lS=new Je;function Ff(t,e,r,i){lS.set(t,e,r);const s=lS.len();return{distance:i/s,normal:new Je(-t/s,-e/s,-r/s)}}function V$(t){return t-Math.fround(t)}let Bg;function ib(t,e){const{size:r=1,startIndex:i=0}=e,s=e.endIndex!==void 0?e.endIndex:t.length,l=(s-i)/r;Bg=b_.allocate(Bg,l,{type:Float32Array,size:r*2});let h=i,a=0;for(;h<s;){for(let v=0;v<r;v++){const T=t[h++];Bg[a+v]=T,Bg[a+v+r]=V$(T)}a+=r*2}return Bg.subarray(0,l*r*2)}function G$(t){let e=null,r=!1;for(const i of t)i&&(e?(r||(e=[[e[0][0],e[0][1]],[e[1][0],e[1][1]]],r=!0),e[0][0]=Math.min(e[0][0],i[0][0]),e[0][1]=Math.min(e[0][1],i[0][1]),e[1][0]=Math.max(e[1][0],i[1][0]),e[1][1]=Math.max(e[1][1],i[1][1])):e=i);return e}const H$=Math.PI/180,W$=$g(),cS=[0,0,0],q$={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function $$({width:t,height:e,orthographic:r,fovyRadians:i,focalDistance:s,padding:l,near:h,far:a}){const v=t/e,T=r?new Wr().orthographic({fovy:i,aspect:v,focalDistance:s,near:h,far:a}):new Wr().perspective({fovy:i,aspect:v,near:h,far:a});if(l){const{left:C=0,right:k=0,top:L=0,bottom:O=0}=l,K=eh((C+t-k)/2,0,t)-t/2,$=eh((L+e-O)/2,0,e)-e/2;T[8]-=K*2/t,T[9]+=$*2/e}return T}class z_{constructor(e={}){this._frustumPlanes={},this.id=e.id||this.constructor.displayName||"viewport",this.x=e.x||0,this.y=e.y||0,this.width=e.width||1,this.height=e.height||1,this.zoom=e.zoom||0,this.padding=e.padding,this.distanceScales=e.distanceScales||q$,this.focalDistance=e.focalDistance||1,this.position=e.position||cS,this.modelMatrix=e.modelMatrix||null;const{longitude:r,latitude:i}=e;this.isGeospatial=Number.isFinite(i)&&Number.isFinite(r),this._initProps(e),this._initMatrices(e),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?su.WEB_MERCATOR:su.WEB_MERCATOR_AUTO_OFFSET:su.IDENTITY}equals(e){return e instanceof z_?this===e?!0:e.width===this.width&&e.height===this.height&&e.scale===this.scale&&cc(e.projectionMatrix,this.projectionMatrix)&&cc(e.viewMatrix,this.viewMatrix):!1}project(e,{topLeft:r=!0}={}){const i=this.projectPosition(e),s=d4(i,this.pixelProjectionMatrix),[l,h]=s,a=r?h:this.height-h;return e.length===2?[l,a]:[l,a,s[2]]}unproject(e,{topLeft:r=!0,targetZ:i}={}){const[s,l,h]=e,a=r?l:this.height-l,v=i&&i*this.distanceScales.unitsPerMeter[2],T=H2([s,a,h],this.pixelUnprojectionMatrix,v),[C,k,L]=this.unprojectPosition(T);return Number.isFinite(h)?[C,k,L]:Number.isFinite(i)?[C,k,i]:[C,k]}projectPosition(e){const[r,i]=this.projectFlat(e),s=(e[2]||0)*this.distanceScales.unitsPerMeter[2];return[r,i,s]}unprojectPosition(e){const[r,i]=this.unprojectFlat(e),s=(e[2]||0)*this.distanceScales.metersPerUnit[2];return[r,i,s]}projectFlat(e){if(this.isGeospatial){const r=v_(e);return r[1]=eh(r[1],-318,830),r}return e}unprojectFlat(e){return this.isGeospatial?xm(e):e}getBounds(e={}){const r={targetZ:e.z||0},i=this.unproject([0,0],r),s=this.unproject([this.width,0],r),l=this.unproject([0,this.height],r),h=this.unproject([this.width,this.height],r);return[Math.min(i[0],s[0],l[0],h[0]),Math.min(i[1],s[1],l[1],h[1]),Math.max(i[0],s[0],l[0],h[0]),Math.max(i[1],s[1],l[1],h[1])]}getDistanceScales(e){return e?zx({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel({x:e,y:r,width:i=1,height:s=1}){return e<this.x+this.width&&this.x<e+i&&r<this.y+this.height&&this.y<r+s}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,j$(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(e,r){return null}_initProps(e){const r=e.longitude,i=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=o$({latitude:i})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||zx({latitude:i,longitude:r}));const s=Math.pow(2,this.zoom);this.scale=s;const{position:l,modelMatrix:h}=e;let a=cS;if(l&&(a=h?new Wr(h).transformAsVector(l,[]):l),this.isGeospatial){const v=this.projectPosition([r,i,0]);this.center=new Je(a).scale(this.distanceScales.unitsPerMeter).add(v)}else this.center=this.projectPosition(a)}_initMatrices(e){const{viewMatrix:r=W$,projectionMatrix:i=null,orthographic:s=!1,fovyRadians:l,fovy:h=75,near:a=.1,far:v=1e3,padding:T=null,focalDistance:C=1}=e;this.viewMatrixUncentered=r,this.viewMatrix=new Wr().multiplyRight(r).translate(new Je(this.center).negate()),this.projectionMatrix=i||$$({width:this.width,height:this.height,orthographic:s,fovyRadians:l||h*H$,focalDistance:C,padding:T,near:a,far:v});const k=$g();Vp(k,k,this.projectionMatrix),Vp(k,k,this.viewMatrix),this.viewProjectionMatrix=k,this.viewMatrixInverse=Bx([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=U$(this.viewMatrixInverse);const L=$g(),O=$g();F2(L,L,[this.width/2,-this.height/2,1]),$0(L,L,[1,-1,0]),Vp(O,L,this.viewProjectionMatrix),this.pixelProjectionMatrix=O,this.pixelUnprojectionMatrix=Bx($g(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||li.warn("Pixel project matrix not invertible")()}}z_.displayName="Viewport";class qp extends z_{constructor(e={}){const{latitude:r=0,longitude:i=0,zoom:s=0,pitch:l=0,bearing:h=0,nearZMultiplier:a=.1,farZMultiplier:v=1.01,nearZ:T,farZ:C,orthographic:k=!1,projectionMatrix:L,repeat:O=!1,worldOffset:K=0,position:$,padding:ne,legacyMeterSizes:oe=!1}=e;let{width:fe,height:ue,altitude:we=1.5}=e;const De=Math.pow(2,s);fe=fe||1,ue=ue||1;let Fe,Ke=null;if(L)we=L[5]/2,Fe=X0(we);else{e.fovy?(Fe=e.fovy,we=h4(Fe)):Fe=X0(we);let it;if(ne){const{top:lt=0,bottom:ht=0}=ne;it=[0,eh((lt+ue-ht)/2,0,ue)-ue/2]}Ke=l$({width:fe,height:ue,scale:De,center:$&&[0,0,$[2]*T0(r)],offset:it,pitch:l,fovy:Fe,nearZMultiplier:a,farZMultiplier:v}),Number.isFinite(T)&&(Ke.near=T),Number.isFinite(C)&&(Ke.far=C)}let ze=a$({height:ue,pitch:l,bearing:h,scale:De,altitude:we});K&&(ze=new Wr().translate([512*K,0,0]).multiplyLeft(ze)),super({...e,width:fe,height:ue,viewMatrix:ze,longitude:i,latitude:r,zoom:s,...Ke,fovy:Fe,focalDistance:we}),this.latitude=r,this.longitude=i,this.zoom=s,this.pitch=l,this.bearing=h,this.altitude=we,this.fovy=Fe,this.orthographic=k,this._subViewports=O?[]:null,this._pseudoMeters=oe,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const e=this.getBounds(),r=Math.floor((e[0]+180)/360),i=Math.ceil((e[2]-180)/360);for(let s=r;s<=i;s++){const l=s?new qp({...this,worldOffset:s}):this;this._subViewports.push(l)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);const[r,i]=this.projectFlat(e),s=(e[2]||0)*T0(e[1]);return[r,i,s]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);const[r,i]=this.unprojectFlat(e),s=(e[2]||0)/T0(i);return[r,i,s]}addMetersToLngLat(e,r){return u4(e,r)}panByPosition(e,r){const i=H2(r,this.pixelUnprojectionMatrix),s=this.projectFlat(e),l=qT([],s,gW([],i)),h=qT([],this.center,l),[a,v]=this.unprojectFlat(h);return{longitude:a,latitude:v}}getBounds(e={}){const r=h$(this,e.z||0);return[Math.min(r[0][0],r[1][0],r[2][0],r[3][0]),Math.min(r[0][1],r[1][1],r[2][1],r[3][1]),Math.max(r[0][0],r[1][0],r[2][0],r[3][0]),Math.max(r[0][1],r[1][1],r[2][1],r[3][1])]}fitBounds(e,r={}){const{width:i,height:s}=this,{longitude:l,latitude:h,zoom:a}=c$({width:i,height:s,bounds:e,...r});return new qp({width:i,height:s,longitude:l,latitude:h,zoom:a})}}qp.displayName="WebMercatorViewport";const uS=[0,0,0];function nb(t,e,r=!1){const i=e.projectPosition(t);if(r&&e instanceof qp){const[s,l,h=0]=t,a=e.getDistanceScales([s,l]);i[2]=h*a.unitsPerMeter[2]}return i}function Z$(t){const{viewport:e,modelMatrix:r,coordinateOrigin:i}=t;let{coordinateSystem:s,fromCoordinateSystem:l,fromCoordinateOrigin:h}=t;return s===Kr.DEFAULT&&(s=e.isGeospatial?Kr.LNGLAT:Kr.CARTESIAN),l===void 0&&(l=s),h===void 0&&(h=i),{viewport:e,coordinateSystem:s,coordinateOrigin:i,modelMatrix:r,fromCoordinateSystem:l,fromCoordinateOrigin:h}}function m4(t,{viewport:e,modelMatrix:r,coordinateSystem:i,coordinateOrigin:s,offsetMode:l}){let[h,a,v=0]=t;switch(r&&([h,a,v]=O_([],[h,a,v,1],r)),i){case Kr.LNGLAT:return nb([h,a,v],e,l);case Kr.LNGLAT_OFFSETS:return nb([h+s[0],a+s[1],v+(s[2]||0)],e,l);case Kr.METER_OFFSETS:return nb(u4(s,[h,a,v]),e,l);case Kr.CARTESIAN:default:return e.isGeospatial?[h+s[0],a+s[1],v+s[2]]:e.projectPosition([h,a,v])}}function X$(t,e){const{viewport:r,coordinateSystem:i,coordinateOrigin:s,modelMatrix:l,fromCoordinateSystem:h,fromCoordinateOrigin:a}=Z$(e),{autoOffset:v=!0}=e,{geospatialOrigin:T=uS,shaderCoordinateOrigin:C=uS,offsetMode:k=!1}=v?l4(r,i,s):{},L=m4(t,{viewport:r,modelMatrix:l,coordinateSystem:h,coordinateOrigin:a,offsetMode:k});if(k){const O=r.projectPosition(T||C);MW(L,L,O)}return L}let K$=1,Y$=1;class g4{time=0;channels=new Map;animations=new Map;playing=!1;lastEngineTime=-1;constructor(){}addChannel(e){const{delay:r=0,duration:i=Number.POSITIVE_INFINITY,rate:s=1,repeat:l=1}=e,h=K$++,a={time:0,delay:r,duration:i,rate:s,repeat:l};return this._setChannelTime(a,this.time),this.channels.set(h,a),h}removeChannel(e){this.channels.delete(e);for(const[r,i]of this.animations)i.channel===e&&this.detachAnimation(r)}isFinished(e){const r=this.channels.get(e);return r===void 0?!1:this.time>=r.delay+r.duration*r.repeat}getTime(e){if(e===void 0)return this.time;const r=this.channels.get(e);return r===void 0?-1:r.time}setTime(e){this.time=Math.max(0,e);const r=this.channels.values();for(const s of r)this._setChannelTime(s,this.time);const i=this.animations.values();for(const s of i){const{animation:l,channel:h}=s;l.setTime(this.getTime(h))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,r){const i=Y$++;return this.animations.set(i,{animation:e,channel:r}),e.setTime(this.getTime(r)),i}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,r){const i=r-e.delay,s=e.duration*e.repeat;i>=s?e.time=e.duration*e.rate:(e.time=Math.max(0,i)%e.duration,e.time*=e.rate)}}let J$=0;const Q$={device:null,onAddHTML:()=>"",onInitialize:async()=>null,onRender:()=>{},onFinalize:()=>{},onError:t=>console.error(t),stats:am.stats.get(`animation-loop-${J$++}`),useDevicePixels:!0,autoResizeViewport:!1,autoResizeDrawingBuffer:!1};class eZ{device=null;canvas=null;props;animationProps=null;timeline=null;stats;cpuTime;gpuTime;frameRate;display;needsRedraw="initialized";_initialized=!1;_running=!1;_animationFrameId=null;_nextFramePromise=null;_resolveNextFrame=null;_cpuStartTime=0;constructor(e){if(this.props={...Q$,...e},e=this.props,!e.device)throw new Error("No device provided");const{useDevicePixels:r=!0}=this.props;this.stats=e.stats||new Nm({id:"animation-loop-stats"}),this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this.setProps({autoResizeViewport:e.autoResizeViewport,autoResizeDrawingBuffer:e.autoResizeDrawingBuffer,useDevicePixels:r}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}destroy(){this.stop(),this._setDisplay(null)}delete(){this.destroy()}setNeedsRedraw(e){return this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.props.autoResizeViewport=e.autoResizeViewport||!1),"autoResizeDrawingBuffer"in e&&(this.props.autoResizeDrawingBuffer=e.autoResizeDrawingBuffer||!1),"useDevicePixels"in e&&(this.props.useDevicePixels=e.useDevicePixels||!1),this}async start(){if(this._running)return this;this._running=!0;try{let e;return this._initialized||(this._initialized=!0,await this._initDevice(),this._initialize(),await this.props.onInitialize(this._getAnimationProps())),this._running?(e!==!1&&(this._cancelAnimationFrame(),this._requestAnimationFrame()),this):null}catch(e){const r=e instanceof Error?e:new Error("Unknown error");throw this.props.onError(r),r}}stop(){return this._running&&(this.animationProps&&this.props.onFinalize(this.animationProps),this._cancelAnimationFrame(),this._nextFramePromise=null,this._resolveNextFrame=null,this._running=!1),this}redraw(){return this.device?.isLost?this:(this._beginFrameTimers(),this._setupFrame(),this._updateAnimationProps(),this._renderFrame(this._getAnimationProps()),this._clearNeedsRedraw(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endFrameTimers(),this)}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}async toDataURL(){if(this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.canvas instanceof HTMLCanvasElement)return this.canvas.toDataURL();throw new Error("OffscreenCanvas")}_initialize(){this._startEventHandling(),this._initializeAnimationProps(),this._updateAnimationProps(),this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_setDisplay(e){this.display&&(this.display.destroy(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_requestAnimationFrame(){this._running&&(this._animationFrameId=oH(this._animationFrame.bind(this)))}_cancelAnimationFrame(){this._animationFrameId!==null&&(aH(this._animationFrameId),this._animationFrameId=null)}_animationFrame(){this._running&&(this.redraw(),this._requestAnimationFrame())}_renderFrame(e){if(this.display){this.display._renderFrame(e);return}this.props.onRender(this._getAnimationProps()),this.device.submit()}_clearNeedsRedraw(){this.needsRedraw=!1}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_initializeAnimationProps(){if(!this.device)throw new Error("loop");this.animationProps={animationLoop:this,device:this.device,canvas:this.device?.canvasContext?.canvas,timeline:this.timeline,useDevicePixels:this.props.useDevicePixels,needsRedraw:!1,width:1,height:1,aspect:1,time:0,startTime:Date.now(),engineTime:0,tick:0,tock:0,_mousePosition:null}}_getAnimationProps(){if(!this.animationProps)throw new Error("animationProps");return this.animationProps}_updateAnimationProps(){if(!this.animationProps)return;const{width:e,height:r,aspect:i}=this._getSizeAndAspect();(e!==this.animationProps.width||r!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),i!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=r,this.animationProps.aspect=i,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime}async _initDevice(){if(this.device=await this.props.device,!this.device)throw new Error("No device provided");this.canvas=this.device.canvasContext?.canvas||null}_createInfoDiv(){if(this.canvas&&this.props.onAddHTML){const e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";const r=document.createElement("div");r.style.position="absolute",r.style.left="10px",r.style.bottom="10px",r.style.width="300px",r.style.background="white",this.canvas instanceof HTMLCanvasElement&&e.appendChild(this.canvas),e.appendChild(r);const i=this.props.onAddHTML(r);i&&(r.innerHTML=i)}}_getSizeAndAspect(){if(!this.device)return{width:1,height:1,aspect:1};const[e,r]=this.device?.canvasContext?.getPixelSize()||[1,1];let i=1;const s=this.device?.canvasContext?.canvas;return s&&s.clientHeight?i=s.clientWidth/s.clientHeight:e>0&&r>0&&(i=e/r),{width:e,height:r,aspect:i}}_resizeViewport(){this.props.autoResizeViewport&&this.device.gl&&this.device.gl.viewport(0,0,this.device.gl.drawingBufferWidth,this.device.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){this.props.autoResizeDrawingBuffer&&this.device?.canvasContext?.resize({useDevicePixels:this.props.useDevicePixels})}_beginFrameTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this.cpuTime.timeStart()}_endFrameTimers(){this.cpuTime.timeEnd()}_startEventHandling(){this.canvas&&(this.canvas.addEventListener("mousemove",this._onMousemove.bind(this)),this.canvas.addEventListener("mouseleave",this._onMouseleave.bind(this)))}_onMousemove(e){e instanceof MouseEvent&&(this._getAnimationProps()._mousePosition=[e.offsetX,e.offsetY])}_onMouseleave(e){this._getAnimationProps()._mousePosition=null}}class hS{id;userData={};topology;bufferLayout=[];vertexCount;indices;attributes;constructor(e){this.id=e.id||yd("geometry"),this.topology=e.topology,this.indices=e.indices||null,this.attributes=e.attributes,this.vertexCount=e.vertexCount,this.bufferLayout=e.bufferLayout||[],this.indices&&fi(this.indices.usage===Ji.INDEX)}destroy(){this.indices?.destroy();for(const e of Object.values(this.attributes))e.destroy()}getVertexCount(){return this.vertexCount}getAttributes(){return this.attributes}getIndexes(){return this.indices}_calculateVertexCount(e){return e.byteLength/12}}function tZ(t,e){if(e instanceof hS)return e;const r=rZ(t,e),{attributes:i,bufferLayout:s}=iZ(t,e);return new hS({topology:e.topology||"triangle-list",bufferLayout:s,vertexCount:e.vertexCount,indices:r,attributes:i})}function rZ(t,e){if(!e.indices)return;const r=e.indices.value;return t.createBuffer({usage:Ji.INDEX,data:r})}function iZ(t,e){const r=[],i={};for(const[l,h]of Object.entries(e.attributes)){let a=l;switch(l){case"POSITION":a="positions";break;case"NORMAL":a="normals";break;case"TEXCOORD_0":a="texCoords";break;case"COLOR_0":a="colors";break}i[a]=t.createBuffer({data:h.value,id:`${l}-buffer`});const{value:v,size:T,normalized:C}=h;r.push({name:a,format:tH(v,T,C)})}const s=e._calculateVertexCount(e.attributes,e.indices);return{attributes:i,bufferLayout:r,vertexCount:s}}class nZ{modules;moduleUniforms;moduleBindings;moduleUniformsChanged;constructor(e){const r=b1(Object.values(e).filter(i=>i.dependencies));for(const i of r)e[i.name]=i;Ct.log(1,"Creating ShaderInputs with modules",Object.keys(e))(),this.modules=e,this.moduleUniforms={},this.moduleBindings={};for(const[i,s]of Object.entries(e)){const l=i;this.moduleUniforms[l]=s.defaultUniforms||{},this.moduleBindings[l]={}}}destroy(){}setProps(e){for(const r of Object.keys(e)){const i=r,s=e[i],l=this.modules[i];if(!l){Ct.warn(`Module ${r} not found`)();continue}const h=this.moduleUniforms[i],a=this.moduleBindings[i],v=l.getUniforms?.(s,h)||s,{uniforms:T,bindings:C}=R2(v);this.moduleUniforms[i]={...h,...T},this.moduleBindings[i]={...a,...C}}}getModules(){return Object.values(this.modules)}getUniformValues(){return this.moduleUniforms}getBindings(){const e={};for(const r of Object.values(this.moduleBindings))Object.assign(e,r);return e}getDebugTable(){const e={};for(const[r,i]of Object.entries(this.moduleUniforms))for(const[s,l]of Object.entries(i))e[`${r}.${s}`]={type:this.modules[r].uniformTypes?.[s],value:String(l)};return e}}class $2{static defaultProps={...ym.defaultProps};device;_hashCounter=0;_hashes={};_renderPipelineCache={};_computePipelineCache={};static getDefaultPipelineFactory(e){return e._lumaData.defaultPipelineFactory=e._lumaData.defaultPipelineFactory||new $2(e),e._lumaData.defaultPipelineFactory}constructor(e){this.device=e}createRenderPipeline(e){const r={...ym.defaultProps,...e},i=this._hashRenderPipeline(r);if(!this._renderPipelineCache[i]){const s=this.device.createRenderPipeline({...r,id:r.id?`${r.id}-cached`:void 0});s.hash=i,this._renderPipelineCache[i]={pipeline:s,useCount:0}}return this._renderPipelineCache[i].useCount++,this._renderPipelineCache[i].pipeline}createComputePipeline(e){const r={...G0.defaultProps,...e},i=this._hashComputePipeline(r);if(!this._computePipelineCache[i]){const s=this.device.createComputePipeline({...r,id:r.id?`${r.id}-cached`:void 0});s.hash=i,this._computePipelineCache[i]={pipeline:s,useCount:0}}return this._computePipelineCache[i].useCount++,this._computePipelineCache[i].pipeline}release(e){const r=e.hash,i=e instanceof G0?this._computePipelineCache:this._renderPipelineCache;i[r].useCount--,i[r].useCount===0&&(i[r].pipeline.destroy(),delete i[r])}_hashComputePipeline(e){return`${this._getHash(e.shader.source)}`}_hashRenderPipeline(e){const r=this._getHash(e.vs.source),i=e.fs?this._getHash(e.fs.source):0,s="-",l=this._getHash(JSON.stringify(e.bufferLayout));switch(this.device.type){case"webgl":return`${r}/${i}V${s}BL${l}`;default:const h=this._getHash(JSON.stringify(e.parameters));return`${r}/${i}V${s}T${e.topology}P${h}BL${l}`}}_getHash(e){return this._hashes[e]===void 0&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}}class Z2{static defaultProps={...E1.defaultProps};device;_cache={};static getDefaultShaderFactory(e){return e._lumaData.defaultShaderFactory||=new Z2(e),e._lumaData.defaultShaderFactory}constructor(e){this.device=e}createShader(e){const r=this._hashShader(e);let i=this._cache[r];if(!i){const s=this.device.createShader({...e,id:e.id?`${e.id}-cached`:void 0});this._cache[r]=i={shader:s,useCount:0}}return i.useCount++,i.shader}release(e){const r=this._hashShader(e),i=this._cache[r];i&&(i.useCount--,i.useCount===0&&(delete this._cache[r],i.shader.destroy()))}_hashShader(e){return`${e.stage}:${e.source}`}}function sZ(t,e){const r={},i="Values";if(t.attributes.length===0&&!t.varyings?.length)return{"No attributes or varyings":{[i]:"N/A"}};for(const s of t.attributes)if(s){const l=`${s.location} ${s.name}: ${s.type}`;r[`in ${l}`]={[i]:s.stepMode||"vertex"}}for(const s of t.varyings||[]){const l=`${s.location} ${s.name}`;r[`out ${l}`]={[i]:JSON.stringify(s.accessor)}}return r}let Bs=null,sb=null;function oZ(t,{id:e,minimap:r,opaque:i,top:s="0",left:l="0",rgbaScale:h=1}){Bs||(Bs=document.createElement("canvas"),Bs.id=e,Bs.title=e,Bs.style.zIndex="100",Bs.style.position="absolute",Bs.style.top=s,Bs.style.left=l,Bs.style.border="blue 1px solid",Bs.style.transform="scaleY(-1)",document.body.appendChild(Bs),sb=Bs.getContext("2d")),(Bs.width!==t.width||Bs.height!==t.height)&&(Bs.width=t.width/2,Bs.height=t.height/2,Bs.style.width="400px",Bs.style.height="400px");const a=t.device.readPixelsToArrayWebGL(t),v=sb.createImageData(t.width,t.height),T=0;for(let C=0;C<a.length;C+=4)v.data[T+C+0]=a[C+0]*h,v.data[T+C+1]=a[C+1]*h,v.data[T+C+2]=a[C+2]*h,v.data[T+C+3]=i?255:a[C+3]*h;sb.putImageData(v,0,0)}const zf=2,aZ=1e4;class pd{static defaultProps={...ym.defaultProps,source:null,vs:null,fs:null,id:"unnamed",handle:void 0,userData:{},defines:{},modules:[],moduleSettings:void 0,geometry:null,indexBuffer:null,attributes:{},constantAttributes:{},varyings:[],isInstanced:void 0,instanceCount:0,vertexCount:0,shaderInputs:void 0,pipelineFactory:void 0,shaderFactory:void 0,transformFeedback:void 0,shaderAssembler:Np.getDefaultShaderAssembler(),debugShaders:void 0,disableWarnings:void 0};device;id;source;vs;fs;pipelineFactory;shaderFactory;userData={};parameters;topology;bufferLayout;isInstanced=void 0;instanceCount=0;vertexCount;indexBuffer=null;bufferAttributes={};constantAttributes={};bindings={};uniforms={};vertexArray;transformFeedback=null;pipeline;shaderInputs;_uniformStore;_attributeInfos={};_gpuGeometry=null;_getModuleUniforms;props;_pipelineNeedsUpdate="newly created";_needsRedraw="initializing";_destroyed=!1;_lastDrawTimestamp=-1;constructor(e,r){this.props={...pd.defaultProps,...r},r=this.props,this.id=r.id||yd("model"),this.device=e,Object.assign(this.userData,r.userData);const i=Object.fromEntries(this.props.modules?.map(h=>[h.name,h])||[]);this.setShaderInputs(r.shaderInputs||new nZ(i));const s=lZ(e),l=(this.props.modules?.length>0?this.props.modules:this.shaderInputs?.getModules())||[];if(this.device.type==="webgpu"&&this.props.source){this.props.shaderLayout||=WH(this.props.source);const{source:h,getUniforms:a}=this.props.shaderAssembler.assembleShader({platformInfo:s,...this.props,modules:l});this.source=h,this._getModuleUniforms=a}else{const{vs:h,fs:a,getUniforms:v}=this.props.shaderAssembler.assembleShaderPair({platformInfo:s,...this.props,modules:l});this.vs=h,this.fs=a,this._getModuleUniforms=v}this.vertexCount=this.props.vertexCount,this.instanceCount=this.props.instanceCount,this.topology=this.props.topology,this.bufferLayout=this.props.bufferLayout,this.parameters=this.props.parameters,r.geometry&&this.setGeometry(r.geometry),this.pipelineFactory=r.pipelineFactory||$2.getDefaultPipelineFactory(this.device),this.shaderFactory=r.shaderFactory||Z2.getDefaultShaderFactory(this.device),this.pipeline=this._updatePipeline(),this.vertexArray=e.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry),"isInstanced"in r&&(this.isInstanced=r.isInstanced),r.instanceCount&&this.setInstanceCount(r.instanceCount),r.vertexCount&&this.setVertexCount(r.vertexCount),r.indexBuffer&&this.setIndexBuffer(r.indexBuffer),r.attributes&&this.setAttributes(r.attributes),r.constantAttributes&&this.setConstantAttributes(r.constantAttributes),r.bindings&&this.setBindings(r.bindings),r.uniforms&&this.setUniforms(r.uniforms),r.moduleSettings&&this.updateModuleSettings(r.moduleSettings),r.transformFeedback&&(this.transformFeedback=r.transformFeedback),Object.seal(this)}destroy(){this._destroyed||(this.pipelineFactory.release(this.pipeline),this.shaderFactory.release(this.pipeline.vs),this.pipeline.fs&&this.shaderFactory.release(this.pipeline.fs),this._uniformStore.destroy(),this._gpuGeometry?.destroy(),this._destroyed=!0)}needsRedraw(){this._getBindingsUpdateTimestamp()>this._lastDrawTimestamp&&this.setNeedsRedraw("contents of bound textures or buffers updated");const e=this._needsRedraw;return this._needsRedraw=!1,e}setNeedsRedraw(e){this._needsRedraw||=e}predraw(){this.updateShaderInputs(),this.pipeline=this._updatePipeline()}draw(e){this.predraw();let r;try{this._logDrawCallStart(),this.pipeline=this._updatePipeline(),this.pipeline.setBindings(this.bindings,{disableWarnings:this.props.disableWarnings}),V0(this.uniforms)||this.pipeline.setUniformsWebGL(this.uniforms);const{indexBuffer:i}=this.vertexArray,s=i?i.byteLength/(i.indexType==="uint32"?4:2):void 0;r=this.pipeline.draw({renderPass:e,vertexArray:this.vertexArray,isInstanced:this.isInstanced,vertexCount:this.vertexCount,instanceCount:this.instanceCount,indexCount:s,transformFeedback:this.transformFeedback||void 0,parameters:this.parameters,topology:this.topology})}finally{this._logDrawCallEnd()}return this._logFramebuffer(e),r?(this._lastDrawTimestamp=this.device.timestamp,this._needsRedraw=!1):this._needsRedraw="waiting for resource initialization",r}setGeometry(e){this._gpuGeometry?.destroy();const r=e&&tZ(this.device,e);r&&(this.setTopology(r.topology||"triangle-list"),this.bufferLayout=dS(r.bufferLayout,this.bufferLayout),this.vertexArray&&this._setGeometryAttributes(r)),this._gpuGeometry=r}setTopology(e){e!==this.topology&&(this.topology=e,this._setPipelineNeedsUpdate("topology"))}setBufferLayout(e){this.bufferLayout=this._gpuGeometry?dS(e,this._gpuGeometry.bufferLayout):e,this._setPipelineNeedsUpdate("bufferLayout"),this.pipeline=this._updatePipeline(),this.vertexArray=this.device.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry)}setParameters(e){Mx(e,this.parameters,2)||(this.parameters=e,this._setPipelineNeedsUpdate("parameters"))}setInstanceCount(e){this.instanceCount=e,this.isInstanced===void 0&&e>0&&(this.isInstanced=!0),this.setNeedsRedraw("instanceCount")}setVertexCount(e){this.vertexCount=e,this.setNeedsRedraw("vertexCount")}setShaderInputs(e){this.shaderInputs=e,this._uniformStore=new eH(this.shaderInputs.modules);for(const r of Object.keys(this.shaderInputs.modules)){const i=this._uniformStore.getManagedUniformBuffer(this.device,r);this.bindings[`${r}Uniforms`]=i}this.setNeedsRedraw("shaderInputs")}updateShaderInputs(){this._uniformStore.setUniforms(this.shaderInputs.getUniformValues()),this.setBindings(this.shaderInputs.getBindings()),this.setNeedsRedraw("shaderInputs")}setBindings(e){Object.assign(this.bindings,e),this.setNeedsRedraw("bindings")}setTransformFeedback(e){this.transformFeedback=e,this.setNeedsRedraw("transformFeedback")}setIndexBuffer(e){this.vertexArray.setIndexBuffer(e),this.setNeedsRedraw("indexBuffer")}setAttributes(e,r){e.indices&&Ct.warn(`Model:${this.id} setAttributes() - indexBuffer should be set using setIndexBuffer()`)();for(const[i,s]of Object.entries(e)){const l=this.bufferLayout.find(v=>pS(v).includes(i));if(!l){Ct.warn(`Model(${this.id}): Missing layout for buffer "${i}".`)();continue}const h=pS(l);let a=!1;for(const v of h){const T=this._attributeInfos[v];T&&(this.vertexArray.setBuffer(T.location,s),a=!0)}!a&&!(r?.disableWarnings??this.props.disableWarnings)&&Ct.warn(`Model(${this.id}): Ignoring buffer "${s.id}" for unknown attribute "${i}"`)()}this.setNeedsRedraw("attributes")}setConstantAttributes(e,r){for(const[i,s]of Object.entries(e)){const l=this._attributeInfos[i];l?this.vertexArray.setConstantWebGL(l.location,s):(r?.disableWarnings??this.props.disableWarnings)||Ct.warn(`Model "${this.id}: Ignoring constant supplied for unknown attribute "${i}"`)()}this.setNeedsRedraw("constants")}setUniforms(e){V0(e)||(this.pipeline.setUniformsWebGL(e),Object.assign(this.uniforms,e)),this.setNeedsRedraw("uniforms")}updateModuleSettings(e){const{bindings:r,uniforms:i}=R2(this._getModuleUniforms(e));Object.assign(this.bindings,r),Object.assign(this.uniforms,i),this.setNeedsRedraw("moduleSettings")}_getBindingsUpdateTimestamp(){let e=0;for(const r of Object.values(this.bindings))r instanceof w1?e=Math.max(e,r.texture.updateTimestamp):r instanceof Ji||r instanceof Va?e=Math.max(e,r.updateTimestamp):r instanceof A1||(e=Math.max(e,r.buffer.updateTimestamp));return e}_setGeometryAttributes(e){const r={...e.attributes};for(const[i]of Object.entries(r))!this.pipeline.shaderLayout.attributes.find(s=>s.name===i)&&i!=="positions"&&delete r[i];this.vertexCount=e.vertexCount,this.setIndexBuffer(e.indices||null),this.setAttributes(e.attributes,{disableWarnings:!0}),this.setAttributes(r,{disableWarnings:this.props.disableWarnings}),this.setNeedsRedraw("geometry attributes")}_setPipelineNeedsUpdate(e){this._pipelineNeedsUpdate||=e,this.setNeedsRedraw(e)}_updatePipeline(){if(this._pipelineNeedsUpdate){let e=null,r=null;this.pipeline&&(Ct.log(1,`Model ${this.id}: Recreating pipeline because "${this._pipelineNeedsUpdate}".`)(),e=this.pipeline.vs,r=this.pipeline.fs),this._pipelineNeedsUpdate=!1;const i=this.shaderFactory.createShader({id:`${this.id}-vertex`,stage:"vertex",source:this.source||this.vs,debug:this.props.debugShaders});let s=null;this.source?s=i:this.fs&&(s=this.shaderFactory.createShader({id:`${this.id}-fragment`,stage:"fragment",source:this.source||this.fs,debug:this.props.debugShaders})),this.pipeline=this.pipelineFactory.createRenderPipeline({...this.props,bufferLayout:this.bufferLayout,topology:this.topology,parameters:this.parameters,vs:i,fs:s}),this._attributeInfos=A5(this.pipeline.shaderLayout,this.bufferLayout),e&&this.shaderFactory.release(e),r&&this.shaderFactory.release(r)}return this.pipeline}_lastLogTime=0;_logOpen=!1;_logDrawCallStart(){const e=Ct.level>3?0:aZ;Ct.level<2||Date.now()-this._lastLogTime<e||(this._lastLogTime=Date.now(),this._logOpen=!0,Ct.group(zf,`>>> DRAWING MODEL ${this.id}`,{collapsed:Ct.level<=2})())}_logDrawCallEnd(){if(this._logOpen){const e=sZ(this.pipeline.shaderLayout,this.id);Ct.table(zf,e)();const r=this.shaderInputs.getDebugTable();for(const[s,l]of Object.entries(this.uniforms))r[s]={value:l};Ct.table(zf,r)();const i=this._getAttributeDebugTable();Ct.table(zf,this._attributeInfos)(),Ct.table(zf,i)(),Ct.groupEnd(zf)(),this._logOpen=!1}}_drawCount=0;_logFramebuffer(e){const r=Ct.get("framebuffer");if(this._drawCount++,!r||this._drawCount++>3&&this._drawCount%60)return;const i=e.props.framebuffer;i&&oZ(i,{id:i.id,minimap:!0})}_getAttributeDebugTable(){const e={};for(const[r,i]of Object.entries(this._attributeInfos))e[i.location]={name:r,type:i.shaderType,values:this._getBufferOrConstantValues(this.vertexArray.attributes[i.location],i.bufferDataType)};if(this.vertexArray.indexBuffer){const{indexBuffer:r}=this.vertexArray,i=r.indexType==="uint32"?new Uint32Array(r.debugData):new Uint16Array(r.debugData);e.indices={name:"indices",type:r.indexType,values:i.toString()}}return e}_getBufferOrConstantValues(e,r){const i=C5(r);return(e instanceof Ji?new i(e.debugData):e).toString()}}function dS(t,e){const r=[...t];for(const i of e){const s=r.findIndex(l=>l.name===i.name);s<0?r.push(i):r[s]=i}return r}function lZ(t){return{type:t.type,shaderLanguage:t.info.shadingLanguage,shaderLanguageVersion:t.info.shadingLanguageVersion,gpu:t.info.gpu,features:t.features}}function pS(t){return t.attributes?t.attributes?.map(e=>e.attribute):[t.name]}class x_{device;model;transformFeedback;static isSupported(e){return e?.info?.type==="webgl"}constructor(e,r=pd.defaultProps){fi(x_.isSupported(e),"BufferTransform not yet implemented on WebGPU"),this.device=e,this.model=new pd(this.device,{id:r.id||"buffer-transform-model",fs:r.fs||rG(),topology:r.topology||"point-list",...r}),this.transformFeedback=this.device.createTransformFeedback({layout:this.model.pipeline.shaderLayout,buffers:r.feedbackBuffers}),this.model.setTransformFeedback(this.transformFeedback),Object.seal(this)}destroy(){this.model&&this.model.destroy()}delete(){this.destroy()}run(e){const r=this.device.beginRenderPass(e);this.model.draw(r),r.end()}update(...e){console.warn("TextureTransform#update() not implemented")}getBuffer(e){return this.transformFeedback.getBuffer(e)}readAsync(e){const r=this.getBuffer(e);if(r instanceof Ji)return r.readAsync();const{buffer:i,byteOffset:s=0,byteLength:l=i.byteLength}=r;return i.readAsync(s,l)}}class um{id;topology;vertexCount;indices;attributes;userData={};constructor(e){const{attributes:r={},indices:i=null,vertexCount:s=null}=e;this.id=e.id||yd("geometry"),this.topology=e.topology,i&&(this.indices=ArrayBuffer.isView(i)?{value:i,size:1}:i),this.attributes={};for(const[l,h]of Object.entries(r)){const a=ArrayBuffer.isView(h)?{value:h}:h;fi(ArrayBuffer.isView(a.value),`${this._print(l)}: must be typed array or object with value as typed array`),(l==="POSITION"||l==="positions")&&!a.size&&(a.size=3),l==="indices"?(fi(!this.indices),this.indices=a):this.attributes[l]=a}this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this.vertexCount=s||this._calculateVertexCount(this.attributes,this.indices)}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return`Geometry ${this.id} attribute ${e}`}_setAttributes(e,r){return this}_calculateVertexCount(e,r){if(r)return r.value.length;let i=1/0;for(const s of Object.values(e)){const{value:l,size:h,constant:a}=s;!a&&l&&h>=1&&(i=Math.min(i,l.length/h))}return fi(Number.isFinite(i)),i}}class K0{id;matrix=new Wr;display=!0;position=new Je;rotation=new Je;scale=new Je(1,1,1);userData={};props={};constructor(e={}){const{id:r}=e;this.id=r||yd(this.constructor.name),this._setScenegraphNodeProps(e)}getBounds(){return null}destroy(){}delete(){this.destroy()}setProps(e){return this._setScenegraphNodeProps(e),this}toString(){return`{type: ScenegraphNode, id: ${this.id})}`}setPosition(e){return fi(e.length===3,"setPosition requires vector argument"),this.position=e,this}setRotation(e){return fi(e.length===3,"setRotation requires vector argument"),this.rotation=e,this}setScale(e){return fi(e.length===3,"setScale requires vector argument"),this.scale=e,this}setMatrix(e,r=!0){r?this.matrix.copy(e):this.matrix=e}setMatrixComponents(e){const{position:r,rotation:i,scale:s,update:l=!0}=e;return r&&this.setPosition(r),i&&this.setRotation(i),s&&this.setScale(s),l&&this.updateMatrix(),this}updateMatrix(){const e=this.position,r=this.rotation,i=this.scale;return this.matrix.identity(),this.matrix.translate(e),this.matrix.rotateXYZ(r),this.matrix.scale(i),this}update(e={}){const{position:r,rotation:i,scale:s}=e;return r&&this.setPosition(r),i&&this.setRotation(i),s&&this.setScale(s),this.updateMatrix(),this}getCoordinateUniforms(e,r){fi(e),r=r||this.matrix;const i=new Wr(e).multiplyRight(r),s=i.invert(),l=s.transpose();return{viewMatrix:e,modelMatrix:r,objectMatrix:r,worldMatrix:i,worldInverseMatrix:s,worldInverseTransposeMatrix:l}}_setScenegraphNodeProps(e){"display"in e&&(this.display=e.display),"position"in e&&this.setPosition(e.position),"rotation"in e&&this.setRotation(e.rotation),"scale"in e&&this.setScale(e.scale),"matrix"in e&&this.setMatrix(e.matrix),Object.assign(this.props,e)}}class hm extends K0{children;constructor(e={}){e=Array.isArray(e)?{children:e}:e;const{children:r=[]}=e;Ct.assert(r.every(i=>i instanceof K0),"every child must an instance of ScenegraphNode"),super(e),this.children=r}getBounds(){const e=[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]];return this.traverse((r,{worldMatrix:i})=>{const s=r.getBounds();if(!s)return;const[l,h]=s,a=new Je(l).add(h).divide([2,2,2]);i.transformAsPoint(a,a);const v=new Je(h).subtract(l).divide([2,2,2]);i.transformAsVector(v,v);for(let T=0;T<8;T++){const C=new Je(T&1?-1:1,T&2?-1:1,T&4?-1:1).multiply(v).add(a);for(let k=0;k<3;k++)e[0][k]=Math.min(e[0][k],C[k]),e[1][k]=Math.max(e[1][k],C[k])}}),Number.isFinite(e[0][0])?e:null}destroy(){this.children.forEach(e=>e.destroy()),this.removeAll(),super.destroy()}add(...e){for(const r of e)Array.isArray(r)?this.add(...r):this.children.push(r);return this}remove(e){const r=this.children,i=r.indexOf(e);return i>-1&&r.splice(i,1),this}removeAll(){return this.children=[],this}traverse(e,{worldMatrix:r=new Wr}={}){const i=new Wr(r).multiplyRight(this.matrix);for(const s of this.children)s instanceof hm?s.traverse(e,{worldMatrix:i}):e(s,{worldMatrix:i})}}class Ux extends K0{model;bounds=null;managedResources;constructor(e){super(e),this.model=e.model,this.managedResources=e.managedResources||[],this.bounds=e.bounds||null,this.setProps(e)}getBounds(){return this.bounds}destroy(){this.model&&(this.model.destroy(),this.model=null),this.managedResources.forEach(e=>e.destroy()),this.managedResources=[]}draw(e){return this.model.draw(e)}}const cZ={blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"zero",blendAlphaOperation:"add",blendAlphaSrcFactor:"constant-alpha",blendAlphaDstFactor:"zero"};class _4 extends q2{constructor(){super(...arguments),this._colorEncoderState=null}render(e){return"pickingFBO"in e?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer({layers:e,layerFilter:r,views:i,viewports:s,onViewportActive:l,pickingFBO:h,deviceRect:{x:a,y:v,width:T,height:C},cullRect:k,effects:L,pass:O="picking",pickZ:K,moduleParameters:$}){this.pickZ=K;const ne=this._resetColorEncoder(K),oe=[a,v,T,C],fe=super.render({target:h,layers:e,layerFilter:r,views:i,viewports:s,onViewportActive:l,cullRect:k,effects:L?.filter(ue=>ue.useInPicking),pass:O,isPicking:!0,moduleParameters:$,clearColor:[0,0,0,0],colorMask:15,scissorRect:oe});return this._colorEncoderState=null,{decodePickingColor:ne&&hZ.bind(null,ne),stats:fe}}shouldDrawLayer(e){const{pickable:r,operation:i}=e.props;return r&&i.includes("draw")||i.includes("terrain")||i.includes("mask")}getModuleParameters(){return{picking:{isActive:1,isAttribute:this.pickZ},lightSources:{}}}getLayerParameters(e,r,i){const s={depthMask:!0,depthTest:!0,depthRange:[0,1],...e.props.parameters},{pickable:l,operation:h}=e.props;return!this._colorEncoderState||h.includes("terrain")?s.blend=!1:l&&h.includes("draw")&&(Object.assign(s,cZ),s.blend=!0,s.blendColor=uZ(this._colorEncoderState,e,i)),s}_resetColorEncoder(e){return this._colorEncoderState=e?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function uZ(t,e,r){const{byLayer:i,byAlpha:s}=t;let l,h=i.get(e);return h?(h.viewports.push(r),l=h.a):(l=i.size+1,l<=255?(h={a:l,layer:e,viewports:[r]},i.set(e,h),s[l]=h):(li.warn("Too many pickable layers, only picking the first 255")(),l=0)),[0,0,0,l/255]}function hZ(t,e){const r=t.byAlpha[e[3]];return r&&{pickedLayer:r.layer,pickedViewports:r.viewports,pickedObjectIndex:r.layer.decodePickingColor(e)}}const Hf={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},Y0=Symbol.for("component"),od=Symbol.for("propTypes"),ob=Symbol.for("deprecatedProps"),dm=Symbol.for("asyncPropDefaults"),$p=Symbol.for("asyncPropOriginal"),id=Symbol.for("asyncPropResolved");function wm(t,e=()=>!0){return Array.isArray(t)?y4(t,e,[]):e(t)?[t]:[]}function y4(t,e,r){let i=-1;for(;++i<t.length;){const s=t[i];Array.isArray(s)?y4(s,e,r):e(s)&&r.push(s)}return r}function dZ({target:t,source:e,start:r=0,count:i=1}){const s=e.length,l=i*s;let h=0;for(let a=r;h<s;h++)t[a++]=e[h];for(;h<l;)h<l-h?(t.copyWithin(r+h,r,r+h),h*=2):(t.copyWithin(r+h,r,r+l-h),h=l);return t}class pZ{constructor(e,r,i){this._loadCount=0,this._subscribers=new Set,this.id=e,this.context=i,this.setData(r)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(e,r){if(e===this._data&&!r)return;this._data=e;const i=++this._loadCount;let s=e;typeof e=="string"&&(s=hd(e)),s instanceof Promise?(this.isLoaded=!1,this._loader=s.then(l=>{this._loadCount===i&&(this.isLoaded=!0,this._error=void 0,this._content=l)}).catch(l=>{this._loadCount===i&&(this.isLoaded=!0,this._error=l||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=e);for(const l of this._subscribers)l.onChange(this.getData())}}class fZ{constructor(e){this.protocol=e.protocol||"resource://",this._context={device:e.device,gl:e.device?.gl,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return e.startsWith(this.protocol)?!0:e in this._resources}add({resourceId:e,data:r,forceUpdate:i=!1,persistent:s=!0}){let l=this._resources[e];l?l.setData(r,i):(l=new pZ(e,r,this._context),this._resources[e]=l),l.persistent=s}remove(e){const r=this._resources[e];r&&(r.delete(),delete this._resources[e])}unsubscribe({consumerId:e}){const r=this._consumers[e];if(r){for(const i in r){const s=r[i],l=this._resources[s.resourceId];l&&l.unsubscribe(s)}delete this._consumers[e],this.prune()}}subscribe({resourceId:e,onChange:r,consumerId:i,requestId:s="default"}){const{_resources:l,protocol:h}=this;e.startsWith(h)&&(e=e.replace(h,""),l[e]||this.add({resourceId:e,data:null,persistent:!1}));const a=l[e];if(this._track(i,s,a,r),a)return a.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const e in this._resources)this._resources[e].delete()}_track(e,r,i,s){const l=this._consumers,h=l[e]=l[e]||{};let a=h[r];const v=a&&a.resourceId&&this._resources[a.resourceId];v&&(v.unsubscribe(a),this.prune()),i&&(a?(a.onChange=s,a.resourceId=i.id):a={onChange:s,resourceId:i.id},h[r]=a,i.subscribe(a))}_prune(){this._pruneRequest=null;for(const e of Object.keys(this._resources)){const r=this._resources[e];!r.persistent&&!r.inUse()&&(r.delete(),delete this._resources[e])}}}const mZ="layerManager.setLayers",gZ="layerManager.activateViewport";class _Z{constructor(e,r){this._lastRenderedLayers=[],this._needsRedraw=!1,this._needsUpdate=!1,this._nextLayers=null,this._debug=!1,this._defaultShaderModulesChanged=!1,this.activateViewport=a=>{po(gZ,this,a),a&&(this.context.viewport=a)};const{deck:i,stats:s,viewport:l,timeline:h}=r||{};this.layers=[],this.resourceManager=new fZ({device:e,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,device:e,gl:e?.gl,deck:i,shaderAssembler:T$(),defaultShaderModules:[],renderPass:void 0,stats:s||new Nm({id:"deck.gl"}),viewport:l||new z_({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:h||new g4,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const e of this.layers)this._finalizeLayer(e)}needsRedraw(e={clearRedrawFlags:!1}){let r=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);for(const i of this.layers){const s=i.getNeedsRedraw(e);r=r||s}return r}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._defaultShaderModulesChanged?"shader modules changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers({layerIds:e}={}){return e?this.layers.filter(r=>e.find(i=>r.id.indexOf(i)===0)):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,r){po(mZ,this,r,e),this._lastRenderedLayers=e;const i=wm(e,Boolean);for(const s of i)s.context=this.context;this._updateLayers(this.layers,i)}updateLayers(){const e=this.needsUpdate();e&&(this.setNeedsRedraw(`updating layers: ${e}`),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}addDefaultShaderModule(e){const{defaultShaderModules:r}=this.context;r.find(i=>i.name===e.name)||(r.push(e),this._defaultShaderModulesChanged=!0)}removeDefaultShaderModule(e){const{defaultShaderModules:r}=this.context,i=r.findIndex(s=>s.name===e.name);i>=0&&(r.splice(i,1),this._defaultShaderModulesChanged=!0)}_handleError(e,r,i){i.raiseError(r,`${e} of ${i}`)}_updateLayers(e,r){const i={};for(const h of e)i[h.id]?li.warn(`Multiple old layers with same id ${h.id}`)():i[h.id]=h;if(this._defaultShaderModulesChanged){for(const h of e)h.setNeedsUpdate(),h.setChangeFlags({extensionsChanged:!0});this._defaultShaderModulesChanged=!1}const s=[];this._updateSublayersRecursively(r,i,s),this._finalizeOldLayers(i);let l=!1;for(const h of s)if(h.hasUniformTransition()){l=`Uniform transition in ${h}`;break}this._needsUpdate=l,this.layers=s}_updateSublayersRecursively(e,r,i){for(const s of e){s.context=this.context;const l=r[s.id];l===null&&li.warn(`Multiple new layers with same id ${s.id}`)(),r[s.id]=null;let h=null;try{this._debug&&l!==s&&s.validateProps(),l?(this._transferLayerState(l,s),this._updateLayer(s)):this._initializeLayer(s),i.push(s),h=s.isComposite?s.getSubLayers():null}catch(a){this._handleError("matching",a,s)}h&&this._updateSublayersRecursively(h,r,i)}}_finalizeOldLayers(e){for(const r in e){const i=e[r];i&&this._finalizeLayer(i)}}_initializeLayer(e){try{e._initialize(),e.lifecycle=Hf.INITIALIZED}catch(r){this._handleError("initialization",r,e)}}_transferLayerState(e,r){r._transferState(e),r.lifecycle=Hf.MATCHED,r!==e&&(e.lifecycle=Hf.AWAITING_GC)}_updateLayer(e){try{e._update()}catch(r){this._handleError("update",r,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||`finalized ${e}`,e.lifecycle=Hf.AWAITING_FINALIZATION;try{e._finalize(),e.lifecycle=Hf.FINALIZED}catch(r){this._handleError("finalization",r,e)}}}function sc(t,e,r){if(t===e)return!0;if(!r||!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let i=0;i<t.length;i++)if(!sc(t[i],e[i],r-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const i=Object.keys(t),s=Object.keys(e);if(i.length!==s.length)return!1;for(const l of i)if(!e.hasOwnProperty(l)||!sc(t[l],e[l],r-1))return!1;return!0}return!1}class yZ{constructor(e){this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(const e in this.controllers){const r=this.controllers[e];r&&r.finalize()}this.controllers={}}needsRedraw(e={clearRedrawFlags:!1}){const r=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),r}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(const e in this.controllers){const r=this.controllers[e];r&&r.updateTransition()}}getViewports(e){return e?this._viewports.filter(r=>r.containsPixel(e)):this._viewports}getViews(){const e={};return this.views.forEach(r=>{e[r.id]=r}),e}getView(e){return this.views.find(r=>r.id===e)}getViewState(e){const r=typeof e=="string"?this.getView(e):e,i=r&&this.viewState[r.getViewStateId()]||this.viewState;return r?r.filterViewState(i):i}getViewport(e){return this._viewportMap[e]}unproject(e,r){const i=this.getViewports(),s={x:e[0],y:e[1]};for(let l=i.length-1;l>=0;--l){const h=i[l];if(h.containsPixel(s)){const a=e.slice();return a[0]-=h.x,a[1]-=h.y,h.unproject(a,r)}}return null}setProps(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,r){(e!==this.width||r!==this.height)&&(this.width=e,this.height=r,this.setNeedsUpdate("Size changed"))}_setViews(e){e=wm(e,Boolean),this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){e?(!sc(e,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=e):li.warn("missing `viewState` or `initialViewState`")()}_createController(e,r){const i=r.type;return new i({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._eventCallbacks.onViewStateChange,onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:s=>this.getView(e.id)?.makeViewport({viewState:s,width:this.width,height:this.height})})}_updateController(e,r,i,s){const l=e.controller;if(l&&i){const h={...r,...l,id:e.id,x:i.x,y:i.y,width:i.width,height:i.height};return(!s||s.constructor!==l.type)&&(s=this._createController(e,h)),s&&s.setProps(h),s}return null}_rebuildViewports(){const{views:e}=this,r=this.controllers;this._viewports=[],this.controllers={};let i=!1;for(let s=e.length;s--;){const l=e[s],h=this.getViewState(l),a=l.makeViewport({viewState:h,width:this.width,height:this.height});let v=r[l.id];const T=!!l.controller;T&&!v&&(i=!0),(i||!T)&&v&&(v.finalize(),v=null),this.controllers[l.id]=this._updateController(l,h,a,v),a&&this._viewports.unshift(a)}for(const s in r){const l=r[s];l&&!this.controllers[s]&&l.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)})}_diffViews(e,r){return e.length!==r.length?!0:e.some((i,s)=>!e[s].equals(r[s]))}}const vZ=/([0-9]+\.?[0-9]*)(%|px)/;function qh(t){switch(typeof t){case"number":return{position:t,relative:!1};case"string":const e=vZ.exec(t);if(e&&e.length>=3){const r=e[2]==="%",i=parseFloat(e[1]);return{position:r?i/100:i,relative:r}}default:throw new Error(`Could not parse position string ${t}`)}}function $h(t,e){return t.relative?Math.round(t.position*e):t.position}class bZ{constructor(e){const{id:r,x:i=0,y:s=0,width:l="100%",height:h="100%",padding:a=null}=e;this.id=r||this.constructor.displayName||"view",this.props={...e,id:this.id},this._x=qh(i),this._y=qh(s),this._width=qh(l),this._height=qh(h),this._padding=a&&{left:qh(a.left||0),right:qh(a.right||0),top:qh(a.top||0),bottom:qh(a.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e?!0:this.ViewportType===e.ViewportType&&sc(this.props,e.props,2)}makeViewport({width:e,height:r,viewState:i}){i=this.filterViewState(i);const s=this.getDimensions({width:e,height:r});return!s.height||!s.width?null:new this.ViewportType({...i,...this.props,...s})}getViewStateId(){const{viewState:e}=this.props;return typeof e=="string"?e:e?.id||this.id}filterViewState(e){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const r={...e};for(const i in this.props.viewState)i!=="id"&&(r[i]=this.props.viewState[i]);return r}return e}getDimensions({width:e,height:r}){const i={x:$h(this._x,e),y:$h(this._y,r),width:$h(this._width,e),height:$h(this._height,r)};return this._padding&&(i.padding={left:$h(this._padding.left,e),top:$h(this._padding.top,r),right:$h(this._padding.right,e),bottom:$h(this._padding.bottom,r)}),i}get controller(){const e=this.props.controller;return e?e===!0?{type:this.ControllerType}:typeof e=="function"?{type:e}:{type:this.ControllerType,...e}:null}}class S1{constructor(e){this._inProgress=!1,this._handle=null,this.time=0,this.settings={duration:0},this._timeline=e}get inProgress(){return this._inProgress}start(e){this.cancel(),this.settings=e,this._inProgress=!0,this.settings.onStart?.(this)}end(){this._inProgress&&(this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,this.settings.onEnd?.(this))}cancel(){this._inProgress&&(this.settings.onInterrupt?.(this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1)}update(){if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:e,settings:r}=this;this._handle=e.addChannel({delay:e.getTime(),duration:r.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),this.settings.onUpdate?.(this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const fS=()=>{},jx={BREAK:1,SNAP_TO_END:2,IGNORE:3},xZ=t=>t,wZ=jx.BREAK;class EZ{constructor(e){this._onTransitionUpdate=r=>{const{time:i,settings:{interpolator:s,startProps:l,endProps:h,duration:a,easing:v}}=r,T=v(i/a),C=s.interpolateProps(l,h,T);this.propsInTransition=this.getControllerState({...this.props,...C}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})},this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new S1(e.timeline),this.onViewStateChange=e.onViewStateChange||fS,this.onStateChange=e.onStateChange||fS}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let r=!1;const i=this.props;if(this.props=e,!i||this._shouldIgnoreViewportChange(i,e))return!1;if(this._isTransitionEnabled(e)){let s=i;if(this.transition.inProgress){const{interruption:l,endProps:h}=this.transition.settings;s={...i,...l===jx.SNAP_TO_END?h:this.propsInTransition||i}}this._triggerTransition(s,e),r=!0}else this.transition.cancel();return r}updateTransition(){this.transition.update()}_isTransitionEnabled(e){const{transitionDuration:r,transitionInterpolator:i}=e;return(r>0||r==="auto")&&!!i}_isUpdateDueToCurrentTransition(e){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition):!1}_shouldIgnoreViewportChange(e,r){return this.transition.inProgress?this.transition.settings.interruption===jx.IGNORE||this._isUpdateDueToCurrentTransition(r):this._isTransitionEnabled(r)?r.transitionInterpolator.arePropsEqual(e,r):!0}_triggerTransition(e,r){const i=this.getControllerState(e),s=this.getControllerState(r).shortestPathFrom(i),l=r.transitionInterpolator,h=l.getDuration?l.getDuration(e,r):r.transitionDuration;if(h===0)return;const a=l.initializeProps(e,s);this.propsInTransition={};const v={duration:h,easing:r.transitionEasing||xZ,interpolator:l,interruption:r.transitionInterruption||wZ,startProps:a.start,endProps:a.end,onStart:r.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(r.onTransitionInterrupt),onEnd:this._onTransitionEnd(r.onTransitionEnd)};this.transition.start(v),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return r=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e?.(r)}}}function ys(t,e){if(!t)throw new Error(e||"deck.gl: assertion failed.")}class AZ{constructor(e){const{compare:r,extract:i,required:s}=e;this._propsToCompare=r,this._propsToExtract=i||r,this._requiredProps=s}arePropsEqual(e,r){for(const i of this._propsToCompare)if(!(i in e)||!(i in r)||!cc(e[i],r[i]))return!1;return!0}initializeProps(e,r){const i={},s={};for(const l of this._propsToExtract)(l in e||l in r)&&(i[l]=e[l],s[l]=r[l]);return this._checkRequiredProps(i),this._checkRequiredProps(s),{start:i,end:s}}getDuration(e,r){return r.transitionDuration}_checkRequiredProps(e){this._requiredProps&&this._requiredProps.forEach(r=>{const i=e[r];ys(Number.isFinite(i)||Array.isArray(i),`${r} is required for transition`)})}}const TZ=["longitude","latitude","zoom","bearing","pitch"],SZ=["longitude","latitude","zoom"];class v4 extends AZ{constructor(e={}){const r=Array.isArray(e)?e:e.transitionProps,i=Array.isArray(e)?{}:e;i.transitionProps=Array.isArray(r)?{compare:r,required:r}:r||{compare:TZ,required:SZ},super(i.transitionProps),this.opts=i}initializeProps(e,r){const i=super.initializeProps(e,r),{makeViewport:s,around:l}=this.opts;if(s&&l){const h=s(e),a=s(r),v=h.unproject(l);i.start.around=l,Object.assign(i.end,{around:a.project(v),aroundPosition:v,width:r.width,height:r.height})}return i}interpolateProps(e,r,i){const s={};for(const l of this._propsToExtract)s[l]=q0(e[l]||0,r[l]||0,i);if(r.aroundPosition&&this.opts.makeViewport){const l=this.opts.makeViewport({...r,...s});Object.assign(s,l.panByPosition(r.aroundPosition,q0(e.around,r.around,i)))}return s}}const Zh={transitionDuration:0},CZ=300,Yy=t=>1-(1-t)*(1-t),Uf={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],TRIPLE_PAN:["tripanstart","tripanmove","tripanend"],DOUBLE_TAP:["doubletap"],KEYBOARD:["keydown"]},Sp={};class MZ{constructor(e){this.state={},this._events={},this._interactionState={isDragging:!1},this._customEvents=[],this._eventStartBlocked=null,this._panMove=!1,this.invertPan=!1,this.dragMode="rotate",this.inertia=0,this.scrollZoom=!0,this.dragPan=!0,this.dragRotate=!0,this.doubleClickZoom=!0,this.touchZoom=!0,this.touchRotate=!1,this.keyboard=!0,this.transitionManager=new EZ({...e,getControllerState:r=>new this.ControllerState(r),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=e.eventManager,this.onViewStateChange=e.onViewStateChange||(()=>{}),this.onStateChange=e.onStateChange||(()=>{}),this.makeViewport=e.makeViewport}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}finalize(){for(const e in this._events)this._events[e]&&this.eventManager?.off(e,this.handleEvent);this.transitionManager.finalize()}handleEvent(e){this._controllerState=void 0;const r=this._eventStartBlocked;switch(e.type){case"panstart":return r?!1:this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return r?!1:this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"tripanstart":return r?!1:this._onTriplePanStart(e);case"tripanmove":return this._onTriplePan(e);case"tripanend":return this._onTriplePanEnd(e);case"doubletap":return this._onDoubleTap(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(e){const{x:r,y:i}=this.props,{offsetCenter:s}=e;return[s.x-r,s.y-i]}isPointInBounds(e,r){const{width:i,height:s}=this.props;if(r&&r.handled)return!1;const l=e[0]>=0&&e[0]<=i&&e[1]>=0&&e[1]<=s;return l&&r&&r.stopPropagation(),l}isFunctionKeyPressed(e){const{srcEvent:r}=e;return!!(r.metaKey||r.altKey||r.ctrlKey||r.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(e){const r=setTimeout(()=>{this._eventStartBlocked===r&&(this._eventStartBlocked=null)},e);this._eventStartBlocked=r}setProps(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);const{inertia:r}=e;this.inertia=Number.isFinite(r)?r:r===!0?CZ:0;const{scrollZoom:i=!0,dragPan:s=!0,dragRotate:l=!0,doubleClickZoom:h=!0,touchZoom:a=!0,touchRotate:v=!1,keyboard:T=!0}=e,C=!!this.onViewStateChange;this.toggleEvents(Uf.WHEEL,C&&i),this.toggleEvents(Uf.PAN,C),this.toggleEvents(Uf.PINCH,C&&(a||v)),this.toggleEvents(Uf.TRIPLE_PAN,C&&v),this.toggleEvents(Uf.DOUBLE_TAP,C&&h),this.toggleEvents(Uf.KEYBOARD,C&&T),this.scrollZoom=i,this.dragPan=s,this.dragRotate=l,this.doubleClickZoom=h,this.touchZoom=a,this.touchRotate=v,this.keyboard=T}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,r){this.eventManager&&e.forEach(i=>{this._events[i]!==r&&(this._events[i]=r,r?this.eventManager.on(i,this.handleEvent):this.eventManager.off(i,this.handleEvent))})}updateViewport(e,r=null,i={}){const s={...e.getViewportProps(),...r},l=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(i),l){const h=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:s,interactionState:this._interactionState,oldViewState:h,viewId:this.props.id})}}_onTransition(e){this.onViewStateChange({...e,interactionState:this._interactionState,viewId:this.props.id})}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}_onPanStart(e){const r=this.getCenter(e);if(!this.isPointInBounds(r,e))return!1;let i=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(i=!i);const s=this.controllerState[i?"panStart":"rotateStart"]({pos:r});return this._panMove=i,this.updateViewport(s,Zh,{isDragging:!0}),!0}_onPan(e){return this.isDragging()?this._panMove?this._onPanMove(e):this._onPanRotate(e):!1}_onPanEnd(e){return this.isDragging()?this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e):!1}_onPanMove(e){if(!this.dragPan)return!1;const r=this.getCenter(e),i=this.controllerState.pan({pos:r});return this.updateViewport(i,Zh,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){const{inertia:r}=this;if(this.dragPan&&r&&e.velocity){const i=this.getCenter(e),s=[i[0]+e.velocityX*r/2,i[1]+e.velocityY*r/2],l=this.controllerState.pan({pos:s}).panEnd();this.updateViewport(l,{...this._getTransitionProps(),transitionDuration:r,transitionEasing:Yy},{isDragging:!1,isPanning:!0})}else{const i=this.controllerState.panEnd();this.updateViewport(i,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;const r=this.getCenter(e),i=this.controllerState.rotate({pos:r});return this.updateViewport(i,Zh,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){const{inertia:r}=this;if(this.dragRotate&&r&&e.velocity){const i=this.getCenter(e),s=[i[0]+e.velocityX*r/2,i[1]+e.velocityY*r/2],l=this.controllerState.rotate({pos:s}).rotateEnd();this.updateViewport(l,{...this._getTransitionProps(),transitionDuration:r,transitionEasing:Yy},{isDragging:!1,isRotating:!0})}else{const i=this.controllerState.rotateEnd();this.updateViewport(i,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;const r=this.getCenter(e);if(!this.isPointInBounds(r,e))return!1;e.srcEvent.preventDefault();const{speed:i=.01,smooth:s=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:l}=e;let h=2/(1+Math.exp(-Math.abs(l*i)));l<0&&h!==0&&(h=1/h);const a=this.controllerState.zoom({pos:r,scale:h});return this.updateViewport(a,{...this._getTransitionProps({around:r}),transitionDuration:s?250:1},{isZooming:!0,isPanning:!0}),!0}_onTriplePanStart(e){const r=this.getCenter(e);if(!this.isPointInBounds(r,e))return!1;const i=this.controllerState.rotateStart({pos:r});return this.updateViewport(i,Zh,{isDragging:!0}),!0}_onTriplePan(e){if(!this.touchRotate||!this.isDragging())return!1;const r=this.getCenter(e);r[0]-=e.deltaX;const i=this.controllerState.rotate({pos:r});return this.updateViewport(i,Zh,{isDragging:!0,isRotating:!0}),!0}_onTriplePanEnd(e){if(!this.isDragging())return!1;const{inertia:r}=this;if(this.touchRotate&&r&&e.velocityY){const i=this.getCenter(e),s=[i[0],i[1]+=e.velocityY*r/2],l=this.controllerState.rotate({pos:s});this.updateViewport(l,{...this._getTransitionProps(),transitionDuration:r,transitionEasing:Yy},{isDragging:!1,isRotating:!0}),this.blockEvents(r)}else{const i=this.controllerState.rotateEnd();this.updateViewport(i,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){const r=this.getCenter(e);if(!this.isPointInBounds(r,e))return!1;const i=this.controllerState.zoomStart({pos:r}).rotateStart({pos:r});return Sp._startPinchRotation=e.rotation,Sp._lastPinchEvent=e,this.updateViewport(i,Zh,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let r=this.controllerState;if(this.touchZoom){const{scale:i}=e,s=this.getCenter(e);r=r.zoom({pos:s,scale:i})}if(this.touchRotate){const{rotation:i}=e;r=r.rotate({deltaAngleX:Sp._startPinchRotation-i})}return this.updateViewport(r,Zh,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),Sp._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;const{inertia:r}=this,{_lastPinchEvent:i}=Sp;if(this.touchZoom&&r&&i&&e.scale!==i.scale){const s=this.getCenter(e);let l=this.controllerState.rotateEnd();const h=Math.log2(e.scale),a=(h-Math.log2(i.scale))/(e.deltaTime-i.deltaTime),v=Math.pow(2,h+a*r/2);l=l.zoom({pos:s,scale:v}).zoomEnd(),this.updateViewport(l,{...this._getTransitionProps({around:s}),transitionDuration:r,transitionEasing:Yy},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(r)}else{const s=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(s,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return Sp._startPinchRotation=null,Sp._lastPinchEvent=null,!0}_onDoubleTap(e){if(!this.doubleClickZoom)return!1;const r=this.getCenter(e);if(!this.isPointInBounds(r,e))return!1;const i=this.isFunctionKeyPressed(e),s=this.controllerState.zoom({pos:r,scale:i?.5:2});return this.updateViewport(s,this._getTransitionProps({around:r}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){if(!this.keyboard)return!1;const r=this.isFunctionKeyPressed(e),{zoomSpeed:i,moveSpeed:s,rotateSpeedX:l,rotateSpeedY:h}=this.keyboard===!0?{}:this.keyboard,{controllerState:a}=this;let v;const T={};switch(e.srcEvent.code){case"Minus":v=r?a.zoomOut(i).zoomOut(i):a.zoomOut(i),T.isZooming=!0;break;case"Equal":v=r?a.zoomIn(i).zoomIn(i):a.zoomIn(i),T.isZooming=!0;break;case"ArrowLeft":r?(v=a.rotateLeft(l),T.isRotating=!0):(v=a.moveLeft(s),T.isPanning=!0);break;case"ArrowRight":r?(v=a.rotateRight(l),T.isRotating=!0):(v=a.moveRight(s),T.isPanning=!0);break;case"ArrowUp":r?(v=a.rotateUp(h),T.isRotating=!0):(v=a.moveUp(s),T.isPanning=!0);break;case"ArrowDown":r?(v=a.rotateDown(h),T.isRotating=!0):(v=a.moveDown(s),T.isPanning=!0);break;default:return!1}return this.updateViewport(v,this._getTransitionProps(),T),!0}_getTransitionProps(e){const{transition:r}=this;return!r||!r.transitionInterpolator?Zh:e?{...r,transitionInterpolator:new v4({...e,...r.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:r}}class PZ{constructor(e,r){this._viewportProps=this.applyConstraints(e),this._state=r}getViewportProps(){return this._viewportProps}getState(){return this._state}}const mS=5,RZ=1.2;class IZ extends PZ{constructor(e){const{width:r,height:i,latitude:s,longitude:l,zoom:h,bearing:a=0,pitch:v=0,altitude:T=1.5,position:C=[0,0,0],maxZoom:k=20,minZoom:L=0,maxPitch:O=60,minPitch:K=0,startPanLngLat:$,startZoomLngLat:ne,startRotatePos:oe,startBearing:fe,startPitch:ue,startZoom:we,normalize:De=!0}=e;ys(Number.isFinite(l)),ys(Number.isFinite(s)),ys(Number.isFinite(h)),super({width:r,height:i,latitude:s,longitude:l,zoom:h,bearing:a,pitch:v,altitude:T,maxZoom:k,minZoom:L,maxPitch:O,minPitch:K,normalize:De,position:C},{startPanLngLat:$,startZoomLngLat:ne,startRotatePos:oe,startBearing:fe,startPitch:ue,startZoom:we}),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan({pos:e,startPos:r}){const i=this.getState().startPanLngLat||this._unproject(r);if(!i)return this;const s=this.makeViewport(this.getViewportProps()).panByPosition(i,e);return this._getUpdatedState(s)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:e,deltaAngleX:r=0,deltaAngleY:i=0}){const{startRotatePos:s,startBearing:l,startPitch:h}=this.getState();if(!s||l===void 0||h===void 0)return this;let a;return e?a=this._getNewRotation(e,s,h,l):a={bearing:l+r,pitch:h+i},this._getUpdatedState(a)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:e}){return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:r,scale:i}){let{startZoom:s,startZoomLngLat:l}=this.getState();if(l||(s=this.getViewportProps().zoom,l=this._unproject(r)||this._unproject(e)),!l)return this;const{maxZoom:h,minZoom:a}=this.getViewportProps();let v=s+Math.log2(i);v=eh(v,a,h);const T=this.makeViewport({...this.getViewportProps(),zoom:v});return this._getUpdatedState({zoom:v,...T.panByPosition(l,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(e=2){return this._zoomFromCenter(e)}zoomOut(e=2){return this._zoomFromCenter(1/e)}moveLeft(e=100){return this._panFromCenter([e,0])}moveRight(e=100){return this._panFromCenter([-e,0])}moveUp(e=100){return this._panFromCenter([0,e])}moveDown(e=100){return this._panFromCenter([0,-e])}rotateLeft(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){const r=e.getViewportProps(),i={...this.getViewportProps()},{bearing:s,longitude:l}=i;return Math.abs(s-r.bearing)>180&&(i.bearing=s<0?s+360:s-360),Math.abs(l-r.longitude)>180&&(i.longitude=l<0?l+360:l-360),i}applyConstraints(e){const{maxZoom:r,minZoom:i,zoom:s}=e;e.zoom=eh(s,i,r);const{maxPitch:l,minPitch:h,pitch:a}=e;e.pitch=eh(a,h,l);const{normalize:v=!0}=e;return v&&Object.assign(e,d$(e)),e}_zoomFromCenter(e){const{width:r,height:i}=this.getViewportProps();return this.zoom({pos:[r/2,i/2],scale:e})}_panFromCenter(e){const{width:r,height:i}=this.getViewportProps();return this.pan({startPos:[r/2,i/2],pos:[r/2+e[0],i/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}_unproject(e){const r=this.makeViewport(this.getViewportProps());return e&&r.unproject(e)}_getNewRotation(e,r,i,s){const l=e[0]-r[0],h=e[1]-r[1],a=e[1],v=r[1],{width:T,height:C}=this.getViewportProps(),k=l/T;let L=0;h>0?Math.abs(C-v)>mS&&(L=h/(v-C)*RZ):h<0&&v>mS&&(L=1-a/v),L=eh(L,-1,1);const{minPitch:O,maxPitch:K}=this.getViewportProps(),$=s+180*k;let ne=i;return L>0?ne=i+L*(K-i):L<0&&(ne=i-L*(O-i)),{pitch:ne,bearing:$}}}class kZ extends MZ{constructor(){super(...arguments),this.ControllerState=IZ,this.transition={transitionDuration:300,transitionInterpolator:new v4({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})},this.dragMode="pan"}setProps(e){e.position=e.position||[0,0,0];const r=this.props;super.setProps(e),(!r||r.height!==e.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...e,...this.state}))}}class X2 extends bZ{constructor(e={}){super(e)}get ViewportType(){return qp}get ControllerType(){return kZ}}X2.displayName="MapView";const BZ=new f4;function LZ(t,e){const r=t.order??1/0,i=e.order??1/0;return r-i}class DZ{constructor(e){this._resolvedEffects=[],this._defaultEffects=[],this.effects=[],this._context=e,this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(e){const r=this._defaultEffects;if(!r.find(i=>i.id===e.id)){const i=r.findIndex(s=>LZ(s,e)>0);i<0?r.push(e):r.splice(i,0,e),e.setup(this._context),this._setEffects(this.effects)}}setProps(e){"effects"in e&&(sc(e.effects,this.effects,1)||this._setEffects(e.effects))}needsRedraw(e={clearRedrawFlags:!1}){const r=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),r}getEffects(){return this._resolvedEffects}_setEffects(e){const r={};for(const s of this.effects)r[s.id]=s;const i=[];for(const s of e){const l=r[s.id];let h=s;l&&l!==s?l.setProps?(l.setProps(s.props),h=l):l.cleanup(this._context):l||s.setup(this._context),i.push(h),delete r[s.id]}for(const s in r)r[s].cleanup(this._context);this.effects=i,this._resolvedEffects=i.concat(this._defaultEffects),e.some(s=>s instanceof f4)||this._resolvedEffects.push(BZ),this._needsRedraw="effects changed"}finalize(){for(const e of this._resolvedEffects)e.cleanup(this._context);this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class NZ extends q2{shouldDrawLayer(e){const{operation:r}=e.props;return r.includes("draw")||r.includes("terrain")}}const OZ="deckRenderer.renderLayers";class FZ{constructor(e){this.device=e,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new NZ(e),this.pickLayersPass=new _4(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){if(!e.viewports.length)return;const r=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,i={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...e};i.effects&&this._preRender(i.effects,i);const s=this.lastPostProcessEffect?this.renderBuffers[0]:i.target;this.lastPostProcessEffect&&(i.clearColor=[0,0,0,0],i.clearCanvas=!0);const l=r.render({...i,target:s});i.effects&&this._postRender(i.effects,i),this.renderCount++,po(OZ,this,l,e)}needsRedraw(e={clearRedrawFlags:!1}){const r=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),r}finalize(){const{renderBuffers:e}=this;for(const r of e)r.delete();e.length=0}_preRender(e,r){this.lastPostProcessEffect=null,r.preRenderStats=r.preRenderStats||{};for(const i of e)r.preRenderStats[i.id]=i.preRender(r),i.postRender&&(this.lastPostProcessEffect=i.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:e}=this,r=this.device.canvasContext.getDrawingBufferSize();e.length===0&&[0,1].map(i=>{const s=this.device.createTexture({sampler:{minFilter:"linear",magFilter:"linear"}});e.push(this.device.createFramebuffer({id:`deck-renderbuffer-${i}`,colorAttachments:[s]}))});for(const i of e)i.resize(r)}_postRender(e,r){const{renderBuffers:i}=this,s={...r,inputBuffer:i[0],swapBuffer:i[1]};for(const l of e)if(l.postRender){s.target=l.id===this.lastPostProcessEffect?r.target:void 0;const h=l.postRender(s);s.inputBuffer=h,s.swapBuffer=h===i[0]?i[1]:i[0]}}}const zZ={pickedColor:null,pickedObjectIndex:-1};function UZ({pickedColors:t,decodePickingColor:e,deviceX:r,deviceY:i,deviceRadius:s,deviceRect:l}){const{x:h,y:a,width:v,height:T}=l;let C=s*s,k=-1,L=0;for(let O=0;O<T;O++){const K=O+a-i,$=K*K;if($>C)L+=4*v;else for(let ne=0;ne<v;ne++){if(t[L+3]-1>=0){const oe=ne+h-r,fe=oe*oe+$;fe<=C&&(C=fe,k=L)}L+=4}}if(k>=0){const O=t.slice(k,k+4),K=e(O);if(K){const $=Math.floor(k/4/v),ne=k/4-$*v;return{...K,pickedColor:O,pickedX:h+ne,pickedY:a+$}}li.error("Picked non-existent layer. Is picking buffer corrupt?")()}return zZ}function jZ({pickedColors:t,decodePickingColor:e}){const r=new Map;if(t){for(let i=0;i<t.length;i+=4)if(t[i+3]-1>=0){const s=t.slice(i,i+4),l=s.join(",");if(!r.has(l)){const h=e(s);h?r.set(l,{...h,color:s}):li.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(r.values())}function b4({pickInfo:t,viewports:e,pixelRatio:r,x:i,y:s,z:l}){let h=e[0];e.length>1&&(h=GZ(t?.pickedViewports||e,{x:i,y:s}));let a;if(h){const v=[i-h.x,s-h.y];l!==void 0&&(v[2]=l),a=h.unproject(v)}return{color:null,layer:null,viewport:h,index:-1,picked:!1,x:i,y:s,pixel:[i,s],coordinate:a,devicePixel:t&&"pickedX"in t?[t.pickedX,t.pickedY]:void 0,pixelRatio:r}}function VZ(t){const{pickInfo:e,lastPickedInfo:r,mode:i,layers:s}=t,{pickedColor:l,pickedLayer:h,pickedObjectIndex:a}=e,v=h?[h]:[];if(i==="hover"){const k=r.index,L=r.layerId,O=h?h.props.id:null;if(O!==L||a!==k){if(O!==L){const K=s.find($=>$.props.id===L);K&&v.unshift(K)}r.layerId=O,r.index=a,r.info=null}}const T=b4(t),C=new Map;return C.set(null,T),v.forEach(k=>{let L={...T};k===h&&(L.color=l,L.index=a,L.picked=!0),L=x4({layer:k,info:L,mode:i});const O=L.layer;k===h&&i==="hover"&&(r.info=L),C.set(O.id,L),i==="hover"&&O.updateAutoHighlight(L)}),C}function x4({layer:t,info:e,mode:r}){for(;t&&e;){const i=e.layer||null;e.sourceLayer=i,e.layer=t,e=t.getPickingInfo({info:e,mode:r,sourceLayer:i}),t=t.parent}return e}function GZ(t,e){for(let r=t.length-1;r>=0;r--){const i=t[r];if(i.containsPixel(e))return i}return t[0]}class HZ{constructor(e){this._pickable=!0,this.device=e,this.pickLayersPass=new _4(e),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.destroy(),this.depthFBO&&this.depthFBO.destroy()}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject({x:e,y:r,layers:i,viewports:s},l=this.lastPickedInfo.info){const h=l&&l.layer&&l.layer.id,a=l&&l.viewport&&l.viewport.id,v=h?i.find(k=>k.id===h):null,T=a&&s.find(k=>k.id===a)||s[0],C=T&&T.unproject([e-T.x,r-T.y]);return{...l,x:e,y:r,viewport:T,coordinate:C,layer:v}}_resizeBuffer(){if(!this.pickingFBO&&(this.pickingFBO=this.device.createFramebuffer({colorAttachments:["rgba8unorm"],depthStencilAttachment:"depth16unorm"}),this.device.isTextureFormatRenderable("rgba32float"))){const r=this.device.createFramebuffer({colorAttachments:["rgba32float"],depthStencilAttachment:"depth16unorm"});this.depthFBO=r}const{canvas:e}=this.device.getCanvasContext();this.pickingFBO?.resize({width:e.width,height:e.height}),this.depthFBO?.resize({width:e.width,height:e.height})}_getPickable(e){if(this._pickable===!1)return null;const r=e.filter(i=>this.pickLayersPass.shouldDrawLayer(i)&&!i.isComposite);return r.length?r:null}_pickClosestObject({layers:e,views:r,viewports:i,x:s,y:l,radius:h=0,depth:a=1,mode:v="query",unproject3D:T,onViewportActive:C,effects:k}){const L=this.device.canvasContext.cssToDeviceRatio(),O=this._getPickable(e);if(!O||i.length===0)return{result:[],emptyInfo:b4({viewports:i,x:s,y:l,pixelRatio:L})};this._resizeBuffer();const K=this.device.canvasContext.cssToDevicePixels([s,l],!0),$=[K.x+Math.floor(K.width/2),K.y+Math.floor(K.height/2)],ne=Math.round(h*L),{width:oe,height:fe}=this.pickingFBO,ue=this._getPickingRect({deviceX:$[0],deviceY:$[1],deviceRadius:ne,deviceWidth:oe,deviceHeight:fe}),we={x:s-h,y:l-h,width:h*2+1,height:h*2+1};let De;const Fe=[],Ke=new Set;for(let ze=0;ze<a;ze++){let it;if(ue){const ht=this._drawAndSample({layers:O,views:r,viewports:i,onViewportActive:C,deviceRect:ue,cullRect:we,effects:k,pass:`picking:${v}`});it=UZ({...ht,deviceX:$[0],deviceY:$[1],deviceRadius:ne,deviceRect:ue})}else it={pickedColor:null,pickedObjectIndex:-1};let lt;if(it.pickedLayer&&T&&this.depthFBO){const{pickedColors:ht}=this._drawAndSample({layers:[it.pickedLayer],views:r,viewports:i,onViewportActive:C,deviceRect:{x:it.pickedX,y:it.pickedY,width:1,height:1},cullRect:we,effects:k,pass:`picking:${v}:z`},!0);ht[3]&&(lt=ht[0])}it.pickedLayer&&ze+1<a&&(Ke.add(it.pickedLayer),it.pickedLayer.disablePickingIndex(it.pickedObjectIndex)),De=VZ({pickInfo:it,lastPickedInfo:this.lastPickedInfo,mode:v,layers:O,viewports:i,x:s,y:l,z:lt,pixelRatio:L});for(const ht of De.values())ht.layer&&Fe.push(ht);if(!it.pickedColor)break}for(const ze of Ke)ze.restorePickingColors();return{result:Fe,emptyInfo:De.get(null)}}_pickVisibleObjects({layers:e,views:r,viewports:i,x:s,y:l,width:h=1,height:a=1,mode:v="query",maxObjects:T=null,onViewportActive:C,effects:k}){const L=this._getPickable(e);if(!L||i.length===0)return[];this._resizeBuffer();const O=this.device.canvasContext.cssToDeviceRatio(),K=this.device.canvasContext.cssToDevicePixels([s,l],!0),$=K.x,ne=K.y+K.height,oe=this.device.canvasContext.cssToDevicePixels([s+h,l+a],!0),fe=oe.x+oe.width,ue=oe.y,we={x:$,y:ue,width:fe-$,height:ne-ue},De=this._drawAndSample({layers:L,views:r,viewports:i,onViewportActive:C,deviceRect:we,cullRect:{x:s,y:l,width:h,height:a},effects:k,pass:`picking:${v}`}),Fe=jZ(De),Ke=new Map,ze=[],it=Number.isFinite(T);for(let lt=0;lt<Fe.length&&!(it&&ze.length>=T);lt++){const ht=Fe[lt];let vt={color:ht.pickedColor,layer:null,index:ht.pickedObjectIndex,picked:!0,x:s,y:l,pixelRatio:O};vt=x4({layer:ht.pickedLayer,info:vt,mode:v});const Nt=vt.layer.id;Ke.has(Nt)||Ke.set(Nt,new Set);const Lt=Ke.get(Nt),qt=vt.object??vt.index;Lt.has(qt)||(Lt.add(qt),ze.push(vt))}return ze}_drawAndSample({layers:e,views:r,viewports:i,onViewportActive:s,deviceRect:l,cullRect:h,effects:a,pass:v},T=!1){const C=T?this.depthFBO:this.pickingFBO,k={layers:e,layerFilter:this.layerFilter,views:r,viewports:i,onViewportActive:s,pickingFBO:C,deviceRect:l,cullRect:h,effects:a,pass:v,pickZ:T,preRenderStats:{}};for(const fe of a)fe.useInPicking&&(k.preRenderStats[fe.id]=fe.preRender(k));const{decodePickingColor:L}=this.pickLayersPass.render(k),{x:O,y:K,width:$,height:ne}=l,oe=new(T?Float32Array:Uint8Array)($*ne*4);return this.device.readPixelsToArrayWebGL(C,{sourceX:O,sourceY:K,sourceWidth:$,sourceHeight:ne,target:oe}),{pickedColors:oe,decodePickingColor:L}}_getPickingRect({deviceX:e,deviceY:r,deviceRadius:i,deviceWidth:s,deviceHeight:l}){const h=Math.max(0,e-i),a=Math.max(0,r-i),v=Math.min(s,e+i+1)-h,T=Math.min(l,r+i+1)-a;return v<=0||T<=0?null:{x:h,y:a,width:v,height:T}}}const WZ={"top-left":{top:0,left:0},"top-right":{top:0,right:0},"bottom-left":{bottom:0,left:0},"bottom-right":{bottom:0,right:0},fill:{top:0,left:0,bottom:0,right:0}},qZ="top-left",gS="__root";class $Z{constructor({deck:e,parentElement:r}){this.defaultWidgets=[],this.widgets=[],this.resolvedWidgets=[],this.containers={},this.lastViewports={},this.deck=e,this.parentElement=r}getWidgets(){return this.resolvedWidgets}setProps(e){e.widgets&&!sc(e.widgets,this.widgets,1)&&this._setWidgets(e.widgets)}finalize(){for(const e of this.getWidgets())this._remove(e);this.defaultWidgets.length=0,this.resolvedWidgets.length=0;for(const e in this.containers)this.containers[e].remove()}addDefault(e){this.defaultWidgets.find(r=>r.id===e.id)||(this._add(e),this.defaultWidgets.push(e),this._setWidgets(this.widgets))}_setWidgets(e){const r={};for(const i of this.resolvedWidgets)r[i.id]=i;this.resolvedWidgets.length=0;for(const i of this.defaultWidgets)r[i.id]=null,this.resolvedWidgets.push(i);for(let i of e){const s=r[i.id];s?s.viewId!==i.viewId||s.placement!==i.placement?(this._remove(s),this._add(i)):i!==s&&(s.setProps(i.props),i=s):this._add(i),r[i.id]=null,this.resolvedWidgets.push(i)}for(const i in r){const s=r[i];s&&this._remove(s)}this.widgets=e}_add(e){const{viewId:r=null,placement:i=qZ}=e,s=e.onAdd({deck:this.deck,viewId:r});s&&this._getContainer(r,i).append(s),e._element=s}_remove(e){e.onRemove(),e._element&&e._element.remove(),e._element=void 0}_getContainer(e,r){const i=e||gS;let s=this.containers[i];s||(s=document.createElement("div"),s.style.pointerEvents="none",s.style.position="absolute",s.style.overflow="hidden",this.parentElement?.append(s),this.containers[i]=s);let l=s.querySelector(`.${r}`);return l||(l=document.createElement("div"),l.className=r,l.style.position="absolute",l.style.zIndex="2",Object.assign(l.style,WZ[r]),s.append(l)),l}_updateContainers(){const e=this.deck.width,r=this.deck.height;for(const i in this.containers){const s=this.lastViewports[i]||null,l=i===gS||s,h=this.containers[i];l?(h.style.display="block",h.style.left=`${s?s.x:0}px`,h.style.top=`${s?s.y:0}px`,h.style.width=`${s?s.width:e}px`,h.style.height=`${s?s.height:r}px`):h.style.display="none"}}onRedraw({viewports:e,layers:r}){const i=e.reduce((l,h)=>(l[h.id]=h,l),{}),{lastViewports:s}=this;for(const l of this.getWidgets()){const{viewId:h}=l;if(h){const a=i[h];a&&(l.onViewportChange&&!a.equals(s[h])&&l.onViewportChange(a),l.onRedraw?.({viewports:[a],layers:r}))}else{if(l.onViewportChange)for(const a of e)a.equals(s[a.id])||l.onViewportChange(a);l.onRedraw?.({viewports:e,layers:r})}}this.lastViewports=i,this._updateContainers()}onHover(e,r){for(const i of this.getWidgets()){const{viewId:s}=i;(!s||s===e.viewport?.id)&&i.onHover?.(e,r)}}onEvent(e,r){const i=Nx[r.type];if(i)for(const s of this.getWidgets()){const{viewId:l}=s;(!l||l===e.viewport?.id)&&s[i.handler]?.(e,r)}}}const ZZ={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class XZ{constructor(){this.id="default-tooltip",this.placement="fill",this.props={},this.isVisible=!1}onAdd({deck:e}){const r=document.createElement("div");return r.className="deck-tooltip",Object.assign(r.style,ZZ),this.deck=e,this.element=r,r}onRemove(){this.deck=void 0,this.element=void 0}setProps(){}onViewportChange(e){this.isVisible&&e.id===this.lastViewport?.id&&e!==this.lastViewport&&this.setTooltip(null)}onHover(e){const{deck:r}=this,i=r&&r.props.getTooltip;if(!i)return;const s=i(e);this.lastViewport=e.viewport,this.setTooltip(s,e.x,e.y)}setTooltip(e,r,i){const s=this.element;if(s){if(typeof e=="string")s.innerText=e;else if(e)e.text&&(s.innerText=e.text),e.html&&(s.innerHTML=e.html),e.className&&(s.className=e.className);else{this.isVisible=!1,s.style.display="none";return}this.isVisible=!0,s.style.display="block",s.style.transform=`translate(${r}px, ${i}px)`,e&&typeof e=="object"&&"style"in e&&Object.assign(s.style,e.style)}}}var Jf;(function(t){t[t.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",t[t.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",t[t.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN",t[t.ZERO=0]="ZERO",t[t.ONE=1]="ONE",t[t.SRC_COLOR=768]="SRC_COLOR",t[t.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",t[t.SRC_ALPHA=770]="SRC_ALPHA",t[t.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",t[t.DST_ALPHA=772]="DST_ALPHA",t[t.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",t[t.DST_COLOR=774]="DST_COLOR",t[t.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",t[t.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",t[t.CONSTANT_COLOR=32769]="CONSTANT_COLOR",t[t.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",t[t.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",t[t.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",t[t.FUNC_ADD=32774]="FUNC_ADD",t[t.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",t[t.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",t[t.BLEND_EQUATION=32777]="BLEND_EQUATION",t[t.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",t[t.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",t[t.BLEND_DST_RGB=32968]="BLEND_DST_RGB",t[t.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",t[t.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",t[t.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",t[t.BLEND_COLOR=32773]="BLEND_COLOR",t[t.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",t[t.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",t[t.LINE_WIDTH=2849]="LINE_WIDTH",t[t.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",t[t.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",t[t.CULL_FACE_MODE=2885]="CULL_FACE_MODE",t[t.FRONT_FACE=2886]="FRONT_FACE",t[t.DEPTH_RANGE=2928]="DEPTH_RANGE",t[t.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",t[t.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",t[t.DEPTH_FUNC=2932]="DEPTH_FUNC",t[t.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",t[t.STENCIL_FUNC=2962]="STENCIL_FUNC",t[t.STENCIL_FAIL=2964]="STENCIL_FAIL",t[t.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",t[t.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",t[t.STENCIL_REF=2967]="STENCIL_REF",t[t.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",t[t.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",t[t.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",t[t.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",t[t.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",t[t.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",t[t.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",t[t.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",t[t.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",t[t.VIEWPORT=2978]="VIEWPORT",t[t.SCISSOR_BOX=3088]="SCISSOR_BOX",t[t.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",t[t.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",t[t.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",t[t.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",t[t.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",t[t.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",t[t.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",t[t.RED_BITS=3410]="RED_BITS",t[t.GREEN_BITS=3411]="GREEN_BITS",t[t.BLUE_BITS=3412]="BLUE_BITS",t[t.ALPHA_BITS=3413]="ALPHA_BITS",t[t.DEPTH_BITS=3414]="DEPTH_BITS",t[t.STENCIL_BITS=3415]="STENCIL_BITS",t[t.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",t[t.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",t[t.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",t[t.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",t[t.SAMPLES=32937]="SAMPLES",t[t.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",t[t.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",t[t.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",t[t.VENDOR=7936]="VENDOR",t[t.RENDERER=7937]="RENDERER",t[t.VERSION=7938]="VERSION",t[t.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",t[t.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",t[t.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",t[t.STATIC_DRAW=35044]="STATIC_DRAW",t[t.STREAM_DRAW=35040]="STREAM_DRAW",t[t.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.BUFFER_SIZE=34660]="BUFFER_SIZE",t[t.BUFFER_USAGE=34661]="BUFFER_USAGE",t[t.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",t[t.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",t[t.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",t[t.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",t[t.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",t[t.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",t[t.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",t[t.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",t[t.CULL_FACE=2884]="CULL_FACE",t[t.FRONT=1028]="FRONT",t[t.BACK=1029]="BACK",t[t.FRONT_AND_BACK=1032]="FRONT_AND_BACK",t[t.BLEND=3042]="BLEND",t[t.DEPTH_TEST=2929]="DEPTH_TEST",t[t.DITHER=3024]="DITHER",t[t.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",t[t.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",t[t.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",t[t.SCISSOR_TEST=3089]="SCISSOR_TEST",t[t.STENCIL_TEST=2960]="STENCIL_TEST",t[t.NO_ERROR=0]="NO_ERROR",t[t.INVALID_ENUM=1280]="INVALID_ENUM",t[t.INVALID_VALUE=1281]="INVALID_VALUE",t[t.INVALID_OPERATION=1282]="INVALID_OPERATION",t[t.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",t[t.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",t[t.CW=2304]="CW",t[t.CCW=2305]="CCW",t[t.DONT_CARE=4352]="DONT_CARE",t[t.FASTEST=4353]="FASTEST",t[t.NICEST=4354]="NICEST",t[t.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.INT=5124]="INT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.FLOAT=5126]="FLOAT",t[t.DOUBLE=5130]="DOUBLE",t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.ALPHA=6406]="ALPHA",t[t.RGB=6407]="RGB",t[t.RGBA=6408]="RGBA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",t[t.VERTEX_SHADER=35633]="VERTEX_SHADER",t[t.COMPILE_STATUS=35713]="COMPILE_STATUS",t[t.DELETE_STATUS=35712]="DELETE_STATUS",t[t.LINK_STATUS=35714]="LINK_STATUS",t[t.VALIDATE_STATUS=35715]="VALIDATE_STATUS",t[t.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",t[t.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",t[t.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",t[t.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",t[t.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",t[t.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",t[t.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",t[t.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",t[t.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",t[t.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",t[t.SHADER_TYPE=35663]="SHADER_TYPE",t[t.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",t[t.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",t[t.NEVER=512]="NEVER",t[t.LESS=513]="LESS",t[t.EQUAL=514]="EQUAL",t[t.LEQUAL=515]="LEQUAL",t[t.GREATER=516]="GREATER",t[t.NOTEQUAL=517]="NOTEQUAL",t[t.GEQUAL=518]="GEQUAL",t[t.ALWAYS=519]="ALWAYS",t[t.KEEP=7680]="KEEP",t[t.REPLACE=7681]="REPLACE",t[t.INCR=7682]="INCR",t[t.DECR=7683]="DECR",t[t.INVERT=5386]="INVERT",t[t.INCR_WRAP=34055]="INCR_WRAP",t[t.DECR_WRAP=34056]="DECR_WRAP",t[t.NEAREST=9728]="NEAREST",t[t.LINEAR=9729]="LINEAR",t[t.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",t[t.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",t[t.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",t[t.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",t[t.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",t[t.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",t[t.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",t[t.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE=5890]="TEXTURE",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",t[t.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",t[t.TEXTURE0=33984]="TEXTURE0",t[t.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",t[t.REPEAT=10497]="REPEAT",t[t.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",t[t.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",t[t.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",t[t.FLOAT_VEC2=35664]="FLOAT_VEC2",t[t.FLOAT_VEC3=35665]="FLOAT_VEC3",t[t.FLOAT_VEC4=35666]="FLOAT_VEC4",t[t.INT_VEC2=35667]="INT_VEC2",t[t.INT_VEC3=35668]="INT_VEC3",t[t.INT_VEC4=35669]="INT_VEC4",t[t.BOOL=35670]="BOOL",t[t.BOOL_VEC2=35671]="BOOL_VEC2",t[t.BOOL_VEC3=35672]="BOOL_VEC3",t[t.BOOL_VEC4=35673]="BOOL_VEC4",t[t.FLOAT_MAT2=35674]="FLOAT_MAT2",t[t.FLOAT_MAT3=35675]="FLOAT_MAT3",t[t.FLOAT_MAT4=35676]="FLOAT_MAT4",t[t.SAMPLER_2D=35678]="SAMPLER_2D",t[t.SAMPLER_CUBE=35680]="SAMPLER_CUBE",t[t.LOW_FLOAT=36336]="LOW_FLOAT",t[t.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",t[t.HIGH_FLOAT=36338]="HIGH_FLOAT",t[t.LOW_INT=36339]="LOW_INT",t[t.MEDIUM_INT=36340]="MEDIUM_INT",t[t.HIGH_INT=36341]="HIGH_INT",t[t.FRAMEBUFFER=36160]="FRAMEBUFFER",t[t.RENDERBUFFER=36161]="RENDERBUFFER",t[t.RGBA4=32854]="RGBA4",t[t.RGB5_A1=32855]="RGB5_A1",t[t.RGB565=36194]="RGB565",t[t.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",t[t.STENCIL_INDEX=6401]="STENCIL_INDEX",t[t.STENCIL_INDEX8=36168]="STENCIL_INDEX8",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t[t.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",t[t.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",t[t.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",t[t.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",t[t.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",t[t.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",t[t.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",t[t.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",t[t.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",t[t.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",t[t.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",t[t.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",t[t.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",t[t.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",t[t.NONE=0]="NONE",t[t.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",t[t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",t[t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",t[t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",t[t.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",t[t.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",t[t.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",t[t.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",t[t.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",t[t.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",t[t.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",t[t.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",t[t.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",t[t.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",t[t.READ_BUFFER=3074]="READ_BUFFER",t[t.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",t[t.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",t[t.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",t[t.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",t[t.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",t[t.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",t[t.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",t[t.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",t[t.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",t[t.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",t[t.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",t[t.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",t[t.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",t[t.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",t[t.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",t[t.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",t[t.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",t[t.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",t[t.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",t[t.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",t[t.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",t[t.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",t[t.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",t[t.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",t[t.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",t[t.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",t[t.RED=6403]="RED",t[t.RGB8=32849]="RGB8",t[t.RGBA8=32856]="RGBA8",t[t.RGB10_A2=32857]="RGB10_A2",t[t.TEXTURE_3D=32879]="TEXTURE_3D",t[t.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",t[t.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",t[t.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",t[t.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",t[t.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",t[t.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",t[t.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",t[t.SRGB=35904]="SRGB",t[t.SRGB8=35905]="SRGB8",t[t.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",t[t.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",t[t.RGBA32F=34836]="RGBA32F",t[t.RGB32F=34837]="RGB32F",t[t.RGBA16F=34842]="RGBA16F",t[t.RGB16F=34843]="RGB16F",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",t[t.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",t[t.R11F_G11F_B10F=35898]="R11F_G11F_B10F",t[t.RGB9_E5=35901]="RGB9_E5",t[t.RGBA32UI=36208]="RGBA32UI",t[t.RGB32UI=36209]="RGB32UI",t[t.RGBA16UI=36214]="RGBA16UI",t[t.RGB16UI=36215]="RGB16UI",t[t.RGBA8UI=36220]="RGBA8UI",t[t.RGB8UI=36221]="RGB8UI",t[t.RGBA32I=36226]="RGBA32I",t[t.RGB32I=36227]="RGB32I",t[t.RGBA16I=36232]="RGBA16I",t[t.RGB16I=36233]="RGB16I",t[t.RGBA8I=36238]="RGBA8I",t[t.RGB8I=36239]="RGB8I",t[t.RED_INTEGER=36244]="RED_INTEGER",t[t.RGB_INTEGER=36248]="RGB_INTEGER",t[t.RGBA_INTEGER=36249]="RGBA_INTEGER",t[t.R8=33321]="R8",t[t.RG8=33323]="RG8",t[t.R16F=33325]="R16F",t[t.R32F=33326]="R32F",t[t.RG16F=33327]="RG16F",t[t.RG32F=33328]="RG32F",t[t.R8I=33329]="R8I",t[t.R8UI=33330]="R8UI",t[t.R16I=33331]="R16I",t[t.R16UI=33332]="R16UI",t[t.R32I=33333]="R32I",t[t.R32UI=33334]="R32UI",t[t.RG8I=33335]="RG8I",t[t.RG8UI=33336]="RG8UI",t[t.RG16I=33337]="RG16I",t[t.RG16UI=33338]="RG16UI",t[t.RG32I=33339]="RG32I",t[t.RG32UI=33340]="RG32UI",t[t.R8_SNORM=36756]="R8_SNORM",t[t.RG8_SNORM=36757]="RG8_SNORM",t[t.RGB8_SNORM=36758]="RGB8_SNORM",t[t.RGBA8_SNORM=36759]="RGBA8_SNORM",t[t.RGB10_A2UI=36975]="RGB10_A2UI",t[t.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",t[t.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",t[t.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",t[t.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",t[t.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",t[t.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",t[t.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",t[t.HALF_FLOAT=5131]="HALF_FLOAT",t[t.RG=33319]="RG",t[t.RG_INTEGER=33320]="RG_INTEGER",t[t.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",t[t.CURRENT_QUERY=34917]="CURRENT_QUERY",t[t.QUERY_RESULT=34918]="QUERY_RESULT",t[t.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",t[t.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",t[t.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",t[t.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",t[t.DRAW_BUFFER0=34853]="DRAW_BUFFER0",t[t.DRAW_BUFFER1=34854]="DRAW_BUFFER1",t[t.DRAW_BUFFER2=34855]="DRAW_BUFFER2",t[t.DRAW_BUFFER3=34856]="DRAW_BUFFER3",t[t.DRAW_BUFFER4=34857]="DRAW_BUFFER4",t[t.DRAW_BUFFER5=34858]="DRAW_BUFFER5",t[t.DRAW_BUFFER6=34859]="DRAW_BUFFER6",t[t.DRAW_BUFFER7=34860]="DRAW_BUFFER7",t[t.DRAW_BUFFER8=34861]="DRAW_BUFFER8",t[t.DRAW_BUFFER9=34862]="DRAW_BUFFER9",t[t.DRAW_BUFFER10=34863]="DRAW_BUFFER10",t[t.DRAW_BUFFER11=34864]="DRAW_BUFFER11",t[t.DRAW_BUFFER12=34865]="DRAW_BUFFER12",t[t.DRAW_BUFFER13=34866]="DRAW_BUFFER13",t[t.DRAW_BUFFER14=34867]="DRAW_BUFFER14",t[t.DRAW_BUFFER15=34868]="DRAW_BUFFER15",t[t.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",t[t.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",t[t.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",t[t.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",t[t.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",t[t.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",t[t.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",t[t.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",t[t.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",t[t.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",t[t.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",t[t.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",t[t.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",t[t.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",t[t.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",t[t.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",t[t.SAMPLER_3D=35679]="SAMPLER_3D",t[t.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",t[t.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",t[t.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",t[t.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",t[t.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",t[t.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",t[t.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",t[t.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",t[t.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",t[t.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",t[t.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",t[t.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",t[t.MAX_SAMPLES=36183]="MAX_SAMPLES",t[t.SAMPLER_BINDING=35097]="SAMPLER_BINDING",t[t.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",t[t.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",t[t.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",t[t.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",t[t.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",t[t.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",t[t.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",t[t.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",t[t.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",t[t.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",t[t.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",t[t.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",t[t.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",t[t.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",t[t.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",t[t.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",t[t.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",t[t.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",t[t.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",t[t.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",t[t.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",t[t.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",t[t.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",t[t.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",t[t.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",t[t.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",t[t.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",t[t.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",t[t.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",t[t.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",t[t.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",t[t.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",t[t.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",t[t.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",t[t.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",t[t.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",t[t.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",t[t.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",t[t.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",t[t.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",t[t.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",t[t.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",t[t.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",t[t.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",t[t.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",t[t.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",t[t.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",t[t.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",t[t.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",t[t.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",t[t.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",t[t.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",t[t.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",t[t.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",t[t.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",t[t.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",t[t.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",t[t.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",t[t.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",t[t.UNIFORM_TYPE=35383]="UNIFORM_TYPE",t[t.UNIFORM_SIZE=35384]="UNIFORM_SIZE",t[t.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",t[t.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",t[t.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",t[t.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",t[t.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",t[t.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",t[t.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",t[t.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",t[t.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",t[t.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",t[t.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",t[t.OBJECT_TYPE=37138]="OBJECT_TYPE",t[t.SYNC_CONDITION=37139]="SYNC_CONDITION",t[t.SYNC_STATUS=37140]="SYNC_STATUS",t[t.SYNC_FLAGS=37141]="SYNC_FLAGS",t[t.SYNC_FENCE=37142]="SYNC_FENCE",t[t.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",t[t.UNSIGNALED=37144]="UNSIGNALED",t[t.SIGNALED=37145]="SIGNALED",t[t.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",t[t.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",t[t.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",t[t.WAIT_FAILED=37149]="WAIT_FAILED",t[t.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",t[t.COLOR=6144]="COLOR",t[t.DEPTH=6145]="DEPTH",t[t.STENCIL=6146]="STENCIL",t[t.MIN=32775]="MIN",t[t.MAX=32776]="MAX",t[t.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",t[t.STREAM_READ=35041]="STREAM_READ",t[t.STREAM_COPY=35042]="STREAM_COPY",t[t.STATIC_READ=35045]="STATIC_READ",t[t.STATIC_COPY=35046]="STATIC_COPY",t[t.DYNAMIC_READ=35049]="DYNAMIC_READ",t[t.DYNAMIC_COPY=35050]="DYNAMIC_COPY",t[t.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",t[t.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",t[t.INVALID_INDEX=4294967295]="INVALID_INDEX",t[t.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",t[t.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",t[t.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",t[t.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",t[t.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",t[t.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",t[t.R16_EXT=33322]="R16_EXT",t[t.RG16_EXT=33324]="RG16_EXT",t[t.RGB16_EXT=32852]="RGB16_EXT",t[t.RGBA16_EXT=32859]="RGBA16_EXT",t[t.R16_SNORM_EXT=36760]="R16_SNORM_EXT",t[t.RG16_SNORM_EXT=36761]="RG16_SNORM_EXT",t[t.RGB16_SNORM_EXT=36762]="RGB16_SNORM_EXT",t[t.RGBA16_SNORM_EXT=36763]="RGBA16_SNORM_EXT",t[t.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",t[t.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",t[t.COMPRESSED_RED_RGTC1_EXT=36283]="COMPRESSED_RED_RGTC1_EXT",t[t.COMPRESSED_SIGNED_RED_RGTC1_EXT=36284]="COMPRESSED_SIGNED_RED_RGTC1_EXT",t[t.COMPRESSED_RED_GREEN_RGTC2_EXT=36285]="COMPRESSED_RED_GREEN_RGTC2_EXT",t[t.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT=36286]="COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT",t[t.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",t[t.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",t[t.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",t[t.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",t[t.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",t[t.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",t[t.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",t[t.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",t[t.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",t[t.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",t[t.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",t[t.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",t[t.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",t[t.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",t[t.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",t[t.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",t[t.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",t[t.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",t[t.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",t[t.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",t[t.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",t[t.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",t[t.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",t[t.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",t[t.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",t[t.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",t[t.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",t[t.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37848]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=37851]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR",t[t.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",t[t.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",t[t.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",t[t.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",t[t.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",t[t.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",t[t.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT",t[t.COMPLETION_STATUS_KHR=37297]="COMPLETION_STATUS_KHR",t[t.DEPTH_CLAMP_EXT=34383]="DEPTH_CLAMP_EXT",t[t.FIRST_VERTEX_CONVENTION_WEBGL=36429]="FIRST_VERTEX_CONVENTION_WEBGL",t[t.LAST_VERTEX_CONVENTION_WEBGL=36430]="LAST_VERTEX_CONVENTION_WEBGL",t[t.PROVOKING_VERTEX_WEBL=36431]="PROVOKING_VERTEX_WEBL",t[t.POLYGON_MODE_WEBGL=2880]="POLYGON_MODE_WEBGL",t[t.POLYGON_OFFSET_LINE_WEBGL=10754]="POLYGON_OFFSET_LINE_WEBGL",t[t.LINE_WEBGL=6913]="LINE_WEBGL",t[t.FILL_WEBGL=6914]="FILL_WEBGL",t[t.MAX_CLIP_DISTANCES_WEBGL=3378]="MAX_CLIP_DISTANCES_WEBGL",t[t.MAX_CULL_DISTANCES_WEBGL=33529]="MAX_CULL_DISTANCES_WEBGL",t[t.MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL=33530]="MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL",t[t.CLIP_DISTANCE0_WEBGL=12288]="CLIP_DISTANCE0_WEBGL",t[t.CLIP_DISTANCE1_WEBGL=12289]="CLIP_DISTANCE1_WEBGL",t[t.CLIP_DISTANCE2_WEBGL=12290]="CLIP_DISTANCE2_WEBGL",t[t.CLIP_DISTANCE3_WEBGL=12291]="CLIP_DISTANCE3_WEBGL",t[t.CLIP_DISTANCE4_WEBGL=12292]="CLIP_DISTANCE4_WEBGL",t[t.CLIP_DISTANCE5_WEBGL=12293]="CLIP_DISTANCE5_WEBGL",t[t.CLIP_DISTANCE6_WEBGL=12294]="CLIP_DISTANCE6_WEBGL",t[t.CLIP_DISTANCE7_WEBGL=12295]="CLIP_DISTANCE7_WEBGL",t[t.POLYGON_OFFSET_CLAMP_EXT=36379]="POLYGON_OFFSET_CLAMP_EXT",t[t.LOWER_LEFT_EXT=36001]="LOWER_LEFT_EXT",t[t.UPPER_LEFT_EXT=36002]="UPPER_LEFT_EXT",t[t.NEGATIVE_ONE_TO_ONE_EXT=37726]="NEGATIVE_ONE_TO_ONE_EXT",t[t.ZERO_TO_ONE_EXT=37727]="ZERO_TO_ONE_EXT",t[t.CLIP_ORIGIN_EXT=37724]="CLIP_ORIGIN_EXT",t[t.CLIP_DEPTH_MODE_EXT=37725]="CLIP_DEPTH_MODE_EXT",t[t.SRC1_COLOR_WEBGL=35065]="SRC1_COLOR_WEBGL",t[t.SRC1_ALPHA_WEBGL=34185]="SRC1_ALPHA_WEBGL",t[t.ONE_MINUS_SRC1_COLOR_WEBGL=35066]="ONE_MINUS_SRC1_COLOR_WEBGL",t[t.ONE_MINUS_SRC1_ALPHA_WEBGL=35067]="ONE_MINUS_SRC1_ALPHA_WEBGL",t[t.MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL=35068]="MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL",t[t.MIRROR_CLAMP_TO_EDGE_EXT=34627]="MIRROR_CLAMP_TO_EDGE_EXT"})(Jf||(Jf={}));const K2={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,35725:null,36006:null,36007:null,34229:null,34964:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32926:!1,32928:!1,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],36389:null,36662:null,36663:null,35053:null,35055:null,35723:4352,36010:null,35977:!1,3333:4,3317:4,37440:!1,37441:!1,37443:37444,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},Zn=(t,e,r)=>e?t.enable(r):t.disable(r),_S=(t,e,r)=>t.hint(r,e),Fa=(t,e,r)=>t.pixelStorei(r,e),yS=(t,e,r)=>{const i=r===36006?36009:36008;return t.bindFramebuffer(i,e)},Lg=(t,e,r)=>{const i={34964:34962,36662:36662,36663:36663,35053:35051,35055:35052}[r];t.bindBuffer(i,e)};function ab(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}const KZ={3042:Zn,32773:(t,e)=>t.blendColor(...e),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(t,e)=>t.clearColor(...e),3107:(t,e)=>t.colorMask(...e),2884:Zn,2885:(t,e)=>t.cullFace(e),2929:Zn,2931:(t,e)=>t.clearDepth(e),2932:(t,e)=>t.depthFunc(e),2928:(t,e)=>t.depthRange(...e),2930:(t,e)=>t.depthMask(e),3024:Zn,35723:_S,35725:(t,e)=>t.useProgram(e),36007:(t,e)=>t.bindRenderbuffer(36161,e),36389:(t,e)=>t.bindTransformFeedback?.(36386,e),34229:(t,e)=>t.bindVertexArray(e),36006:yS,36010:yS,34964:Lg,36662:Lg,36663:Lg,35053:Lg,35055:Lg,2886:(t,e)=>t.frontFace(e),33170:_S,2849:(t,e)=>t.lineWidth(e),32823:Zn,32824:"polygonOffset",10752:"polygonOffset",35977:Zn,32926:Zn,32928:Zn,32938:"sampleCoverage",32939:"sampleCoverage",3089:Zn,3088:(t,e)=>t.scissor(...e),2960:Zn,2961:(t,e)=>t.clearStencil(e),2968:(t,e)=>t.stencilMaskSeparate(1028,e),36005:(t,e)=>t.stencilMaskSeparate(1029,e),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(t,e)=>t.viewport(...e),34383:Zn,10754:Zn,12288:Zn,12289:Zn,12290:Zn,12291:Zn,12292:Zn,12293:Zn,12294:Zn,12295:Zn,3333:Fa,3317:Fa,37440:Fa,37441:Fa,37443:Fa,3330:Fa,3332:Fa,3331:Fa,3314:Fa,32878:Fa,3316:Fa,3315:Fa,32877:Fa,framebuffer:(t,e)=>{const r=e&&"handle"in e?e.handle:e;return t.bindFramebuffer(36160,r)},blend:(t,e)=>e?t.enable(3042):t.disable(3042),blendColor:(t,e)=>t.blendColor(...e),blendEquation:(t,e)=>{const r=typeof e=="number"?[e,e]:e;t.blendEquationSeparate(...r)},blendFunc:(t,e)=>{const r=e?.length===2?[...e,...e]:e;t.blendFuncSeparate(...r)},clearColor:(t,e)=>t.clearColor(...e),clearDepth:(t,e)=>t.clearDepth(e),clearStencil:(t,e)=>t.clearStencil(e),colorMask:(t,e)=>t.colorMask(...e),cull:(t,e)=>e?t.enable(2884):t.disable(2884),cullFace:(t,e)=>t.cullFace(e),depthTest:(t,e)=>e?t.enable(2929):t.disable(2929),depthFunc:(t,e)=>t.depthFunc(e),depthMask:(t,e)=>t.depthMask(e),depthRange:(t,e)=>t.depthRange(...e),dither:(t,e)=>e?t.enable(3024):t.disable(3024),derivativeHint:(t,e)=>{t.hint(35723,e)},frontFace:(t,e)=>t.frontFace(e),mipmapHint:(t,e)=>t.hint(33170,e),lineWidth:(t,e)=>t.lineWidth(e),polygonOffsetFill:(t,e)=>e?t.enable(32823):t.disable(32823),polygonOffset:(t,e)=>t.polygonOffset(...e),sampleCoverage:(t,e)=>t.sampleCoverage(...e),scissorTest:(t,e)=>e?t.enable(3089):t.disable(3089),scissor:(t,e)=>t.scissor(...e),stencilTest:(t,e)=>e?t.enable(2960):t.disable(2960),stencilMask:(t,e)=>{e=ab(e)?e:[e,e];const[r,i]=e;t.stencilMaskSeparate(1028,r),t.stencilMaskSeparate(1029,i)},stencilFunc:(t,e)=>{e=ab(e)&&e.length===3?[...e,...e]:e;const[r,i,s,l,h,a]=e;t.stencilFuncSeparate(1028,r,i,s),t.stencilFuncSeparate(1029,l,h,a)},stencilOp:(t,e)=>{e=ab(e)&&e.length===3?[...e,...e]:e;const[r,i,s,l,h,a]=e;t.stencilOpSeparate(1028,r,i,s),t.stencilOpSeparate(1029,l,h,a)},viewport:(t,e)=>t.viewport(...e)};function An(t,e,r){return e[t]!==void 0?e[t]:r[t]}const YZ={blendEquation:(t,e,r)=>t.blendEquationSeparate(An(32777,e,r),An(34877,e,r)),blendFunc:(t,e,r)=>t.blendFuncSeparate(An(32969,e,r),An(32968,e,r),An(32971,e,r),An(32970,e,r)),polygonOffset:(t,e,r)=>t.polygonOffset(An(32824,e,r),An(10752,e,r)),sampleCoverage:(t,e,r)=>t.sampleCoverage(An(32938,e,r),An(32939,e,r)),stencilFuncFront:(t,e,r)=>t.stencilFuncSeparate(1028,An(2962,e,r),An(2967,e,r),An(2963,e,r)),stencilFuncBack:(t,e,r)=>t.stencilFuncSeparate(1029,An(34816,e,r),An(36003,e,r),An(36004,e,r)),stencilOpFront:(t,e,r)=>t.stencilOpSeparate(1028,An(2964,e,r),An(2965,e,r),An(2966,e,r)),stencilOpBack:(t,e,r)=>t.stencilOpSeparate(1029,An(34817,e,r),An(34818,e,r),An(34819,e,r))},vS={enable:(t,e)=>t({[e]:!0}),disable:(t,e)=>t({[e]:!1}),pixelStorei:(t,e,r)=>t({[e]:r}),hint:(t,e,r)=>t({[e]:r}),useProgram:(t,e)=>t({35725:e}),bindRenderbuffer:(t,e,r)=>t({36007:r}),bindTransformFeedback:(t,e,r)=>t({36389:r}),bindVertexArray:(t,e)=>t({34229:e}),bindFramebuffer:(t,e,r)=>{switch(e){case 36160:return t({36006:r,36010:r});case 36009:return t({36006:r});case 36008:return t({36010:r});default:return null}},bindBuffer:(t,e,r)=>{const i={34962:[34964],36662:[36662],36663:[36663],35051:[35053],35052:[35055]}[e];return i?t({[i]:r}):{valueChanged:!0}},blendColor:(t,e,r,i,s)=>t({32773:new Float32Array([e,r,i,s])}),blendEquation:(t,e)=>t({32777:e,34877:e}),blendEquationSeparate:(t,e,r)=>t({32777:e,34877:r}),blendFunc:(t,e,r)=>t({32969:e,32968:r,32971:e,32970:r}),blendFuncSeparate:(t,e,r,i,s)=>t({32969:e,32968:r,32971:i,32970:s}),clearColor:(t,e,r,i,s)=>t({3106:new Float32Array([e,r,i,s])}),clearDepth:(t,e)=>t({2931:e}),clearStencil:(t,e)=>t({2961:e}),colorMask:(t,e,r,i,s)=>t({3107:[e,r,i,s]}),cullFace:(t,e)=>t({2885:e}),depthFunc:(t,e)=>t({2932:e}),depthRange:(t,e,r)=>t({2928:new Float32Array([e,r])}),depthMask:(t,e)=>t({2930:e}),frontFace:(t,e)=>t({2886:e}),lineWidth:(t,e)=>t({2849:e}),polygonOffset:(t,e,r)=>t({32824:e,10752:r}),sampleCoverage:(t,e,r)=>t({32938:e,32939:r}),scissor:(t,e,r,i,s)=>t({3088:new Int32Array([e,r,i,s])}),stencilMask:(t,e)=>t({2968:e,36005:e}),stencilMaskSeparate:(t,e,r)=>t({[e===1028?2968:36005]:r}),stencilFunc:(t,e,r,i)=>t({2962:e,2967:r,2963:i,34816:e,36003:r,36004:i}),stencilFuncSeparate:(t,e,r,i,s)=>t({[e===1028?2962:34816]:r,[e===1028?2967:36003]:i,[e===1028?2963:36004]:s}),stencilOp:(t,e,r,i)=>t({2964:e,2965:r,2966:i,34817:e,34818:r,34819:i}),stencilOpSeparate:(t,e,r,i,s)=>t({[e===1028?2964:34817]:r,[e===1028?2965:34818]:i,[e===1028?2966:34819]:s}),viewport:(t,e,r,i,s)=>t({2978:[e,r,i,s]})},Kc=(t,e)=>t.isEnabled(e),bS={3042:Kc,2884:Kc,2929:Kc,3024:Kc,32823:Kc,32926:Kc,32928:Kc,3089:Kc,2960:Kc,35977:Kc},JZ=new Set([34016,36388,36387,35983,35368,34965,35739,35738,3074,34853,34854,34855,34856,34857,34858,34859,34860,34861,34862,34863,34864,34865,34866,34867,34868,35097,32873,35869,32874,34068]);function Om(t,e){if(eX(e))return;const r={};for(const s in e){const l=Number(s),h=KZ[s];h&&(typeof h=="string"?r[h]=!0:h(t,e[s],l))}const i=t.state&&t.state.cache;if(i)for(const s in r){const l=YZ[s];l(t,e,i)}}function w4(t,e=K2){if(typeof e=="number"){const s=e,l=bS[s];return l?l(t,s):t.getParameter(s)}const r=Array.isArray(e)?e:Object.keys(e),i={};for(const s of r){const l=bS[s];i[s]=l?l(t,Number(s)):t.getParameter(Number(s))}return i}function QZ(t){Om(t,K2)}function eX(t){for(const e in t)return!1;return!0}function tX(t,e){if(t===e)return!0;const r=Array.isArray(t)||ArrayBuffer.isView(t),i=Array.isArray(e)||ArrayBuffer.isView(e);if(r&&i&&t.length===e.length){for(let s=0;s<t.length;++s)if(t[s]!==e[s])return!1;return!0}return!1}class rX{gl;program=null;stateStack=[];enable=!0;cache;log;constructor(e,{copyState:r=!1,log:i=()=>{}}={}){this.gl=e,this.cache=r?w4(e):Object.assign({},K2),this.log=i,this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(e={}){this.stateStack.push({})}pop(){fi(this.stateStack.length>0);const e=this.stateStack[this.stateStack.length-1];Om(this.gl,e),this.stateStack.pop()}_updateCache(e){let r=!1,i;const s=this.stateStack.length>0?this.stateStack[this.stateStack.length-1]:null;for(const l in e){fi(l!==void 0);const h=e[l],a=this.cache[l];tX(h,a)||(r=!0,i=a,s&&!(l in s)&&(s[l]=a),this.cache[l]=h)}return{valueChanged:r,oldValue:i}}}function Zp(t){return t.state}function E4(t,e){const{enable:r=!0,copyState:i}=e;if(fi(i!==void 0),!t.state){t.state=new rX(t,{copyState:i}),nX(t);for(const l in vS){const h=vS[l];iX(t,l,h)}xS(t,"getParameter"),xS(t,"isEnabled")}const s=Zp(t);return s.enable=r,t}function C1(t){let e=Zp(t);e||(E4(t,{copyState:!1}),e=Zp(t)),e.push()}function w_(t){const e=Zp(t);fi(e),e.pop()}function xS(t,e){const r=t[e].bind(t);t[e]=function(i){if(i===void 0||JZ.has(i))return r(i);const s=Zp(t);return i in s.cache||(s.cache[i]=r(i)),s.enable?s.cache[i]:r(i)},Object.defineProperty(t[e],"name",{value:`${e}-from-cache`,configurable:!1})}function iX(t,e,r){if(!t[e])return;const i=t[e].bind(t);t[e]=function(...s){const l=Zp(t),{valueChanged:h,oldValue:a}=r(l._updateCache,...s);return h&&i(...s),a},Object.defineProperty(t[e],"name",{value:`${e}-to-cache`,configurable:!1})}function nX(t){const e=t.useProgram.bind(t);t.useProgram=function(r){const i=Zp(t);i.program!==r&&(e(r),i.program=r)}}const sX={powerPreference:"high-performance",onContextLost:()=>console.error("WebGL context lost"),onContextRestored:()=>console.info("WebGL context restored")};function oX(t,e){e={...sX,...e};let r=null;const i=l=>r=l.statusMessage||r;t.addEventListener("webglcontextcreationerror",i,!1);let s=null;if(s||=t.getContext("webgl2",e),t.removeEventListener("webglcontextcreationerror",i,!1),!s)throw new Error(`Failed to create WebGL context: ${r||"Unknown error"}`);if(e.onContextLost){const{onContextLost:l}=e;t.addEventListener("webglcontextlost",h=>l(h),!1)}if(e.onContextRestored){const{onContextRestored:l}=e;t.addEventListener("webglcontextrestored",h=>l(h),!1)}return s}function fd(t,e,r){return r[e]===void 0&&(r[e]=t.getExtension(e)||null),r[e]}function aX(t,e){const r=t.getParameter(7936),i=t.getParameter(7937);fd(t,"WEBGL_debug_renderer_info",e);const s=e.WEBGL_debug_renderer_info,l=t.getParameter(s?s.UNMASKED_VENDOR_WEBGL:7936),h=t.getParameter(s?s.UNMASKED_RENDERER_WEBGL:7937),a=l||r,v=h||i,T=t.getParameter(7938),C=A4(a,v),k=lX(a,v),L=cX(a,v);return{type:"webgl",gpu:C,gpuType:L,gpuBackend:k,vendor:a,renderer:v,version:T,shadingLanguage:"glsl",shadingLanguageVersion:300}}function A4(t,e){return/NVIDIA/i.exec(t)||/NVIDIA/i.exec(e)?"nvidia":/INTEL/i.exec(t)||/INTEL/i.exec(e)?"intel":/Apple/i.exec(t)||/Apple/i.exec(e)?"apple":/AMD/i.exec(t)||/AMD/i.exec(e)||/ATI/i.exec(t)||/ATI/i.exec(e)?"amd":/SwiftShader/i.exec(t)||/SwiftShader/i.exec(e)?"software":"unknown"}function lX(t,e){return/Metal/i.exec(t)||/Metal/i.exec(e)?"metal":/ANGLE/i.exec(t)||/ANGLE/i.exec(e)?"opengl":"unknown"}function cX(t,e){if(/SwiftShader/i.exec(t)||/SwiftShader/i.exec(e))return"cpu";switch(A4(t,e)){case"intel":return"integrated";case"software":return"cpu";case"unknown":return"unknown";default:return"discrete"}}function T4(t){switch(t){case"uint8":return 5121;case"sint8":return 5120;case"unorm8":return 5121;case"snorm8":return 5120;case"uint16":return 5123;case"sint16":return 5122;case"unorm16":return 5123;case"snorm16":return 5122;case"uint32":return 5125;case"sint32":return 5124;case"float16":return 5131;case"float32":return 5126}throw new Error(String(t))}const ho="texture-compression-bc",Ai="texture-compression-astc",Yc="texture-compression-etc2",uX="texture-compression-etc1-webgl",Jy="texture-compression-pvrtc-webgl",lb="texture-compression-atc-webgl",Dg="float32-renderable-webgl",cb="float16-renderable-webgl",hX="rgb9e5ufloat_renderable-webgl",ub="snorm8-renderable-webgl",Ng="norm16-renderable-webgl",hb="snorm16-renderable-webgl",Qy="float32-filterable",wS="float16-filterable-webgl",Zg="WEBGL_compressed_texture_s3tc",Xg="WEBGL_compressed_texture_s3tc_srgb",Qf="EXT_texture_compression_rgtc",em="EXT_texture_compression_bptc",dX="WEBGL_compressed_texture_etc",pX="WEBGL_compressed_texture_astc",fX="WEBGL_compressed_texture_etc1",mX="WEBGL_compressed_texture_pvrtc",gX="WEBGL_compressed_texture_atc",ES="EXT_texture_norm16",AS="EXT_render_snorm",_X="EXT_color_buffer_float",Y2={"float32-renderable-webgl":["EXT_color_buffer_float"],"float16-renderable-webgl":["EXT_color_buffer_half_float"],"rgb9e5ufloat_renderable-webgl":["WEBGL_render_shared_exponent"],"snorm8-renderable-webgl":[AS],"norm16-renderable-webgl":[ES],"snorm16-renderable-webgl":[ES,AS],"float32-filterable":["OES_texture_float_linear"],"float16-filterable-webgl":["OES_texture_half_float_linear"],"texture-filterable-anisotropic-webgl":["EXT_texture_filter_anisotropic"],"texture-blend-float-webgl":["EXT_float_blend"],"texture-compression-bc":[Zg,Xg,Qf,em],"texture-compression-bc5-webgl":[Qf],"texture-compression-bc7-webgl":[em],"texture-compression-etc2":[dX],"texture-compression-astc":[pX],"texture-compression-etc1-webgl":[fX],"texture-compression-pvrtc-webgl":[mX],"texture-compression-atc-webgl":[gX]};function yX(t){return t in Y2}function vX(t,e,r){return(Y2[e]||[]).every(i=>fd(t,i,r))}const M1={"rgb8unorm-unsized":{gl:6407,b:4,c:2,bpp:4,dataFormat:6407,types:[5121,33635]},"rgba8unorm-unsized":{gl:6408,b:4,c:2,bpp:4,dataFormat:6408,types:[5121,32819,32820]},r8unorm:{gl:33321,b:1,c:1,rb:!0},r8snorm:{gl:36756,b:1,c:1,render:ub},r8uint:{gl:33330,b:1,c:1,rb:!0},r8sint:{gl:33329,b:1,c:1,rb:!0},rg8unorm:{gl:33323,b:2,c:2,rb:!0},rg8snorm:{gl:36757,b:2,c:2,render:ub},rg8uint:{gl:33336,b:2,c:2,rb:!0},rg8sint:{gl:33335,b:2,c:2,rb:!0},r16uint:{gl:33332,b:2,c:1,rb:!0},r16sint:{gl:33331,b:2,c:1,rb:!0},r16float:{gl:33325,b:2,c:1,render:cb,filter:"float16-filterable-webgl",rb:!0},"r16unorm-webgl":{gl:33322,b:2,c:1,f:Ng,rb:!0},"r16snorm-webgl":{gl:36760,b:2,c:1,f:hb},"rgba4unorm-webgl":{gl:32854,b:2,c:4,wgpu:!1,rb:!0},"rgb565unorm-webgl":{gl:36194,b:2,c:4,wgpu:!1,rb:!0},"rgb5a1unorm-webgl":{gl:32855,b:2,c:4,wgpu:!1,rb:!0},"rgb8unorm-webgl":{gl:32849,b:3,c:3,wgpu:!1},"rgb8snorm-webgl":{gl:36758,b:3,c:3,wgpu:!1},rgba8unorm:{gl:32856,b:4,c:2,bpp:4},"rgba8unorm-srgb":{gl:35907,b:4,c:4,bpp:4},rgba8snorm:{gl:36759,b:4,c:4,render:ub},rgba8uint:{gl:36220,b:4,c:4,bpp:4},rgba8sint:{gl:36238,b:4,c:4,bpp:4},bgra8unorm:{b:4,c:4},"bgra8unorm-srgb":{b:4,c:4},rg16uint:{gl:33338,b:4,c:1,bpp:4},rg16sint:{gl:33337,b:4,c:2,bpp:4},rg16float:{gl:33327,bpp:4,b:4,c:2,render:cb,filter:wS,rb:!0},"rg16unorm-webgl":{gl:33324,b:2,c:2,render:Ng},"rg16snorm-webgl":{gl:36761,b:2,c:2,render:hb},r32uint:{gl:33334,b:4,c:1,bpp:4,rb:!0},r32sint:{gl:33333,b:4,c:1,bpp:4,rb:!0},r32float:{gl:33326,bpp:4,b:4,c:1,render:Dg,filter:Qy},rgb9e5ufloat:{gl:35901,b:4,c:3,p:1,render:hX},rg11b10ufloat:{gl:35898,b:4,c:3,p:1,render:Dg,rb:!0},rgb10a2unorm:{gl:32857,b:4,c:4,p:1,rb:!0},"rgb10a2uint-webgl":{b:4,c:4,gl:36975,p:1,wgpu:!1,bpp:4,rb:!0},"rgb16unorm-webgl":{gl:32852,b:2,c:3,f:Ng},"rgb16snorm-webgl":{gl:36762,b:2,c:3,f:Ng},rg32uint:{gl:33340,b:8,c:2,rb:!0},rg32sint:{gl:33339,b:8,c:2,rb:!0},rg32float:{gl:33328,b:8,c:2,render:Dg,filter:Qy,rb:!0},rgba16uint:{gl:36214,b:8,c:4,rb:!0},rgba16sint:{gl:36232,b:8,c:4,rb:!0},rgba16float:{gl:34842,b:8,c:4,render:cb,filter:wS},"rgba16unorm-webgl":{gl:32859,b:2,c:4,render:Ng,rb:!0},"rgba16snorm-webgl":{gl:36763,b:2,c:4,render:hb},"rgb32float-webgl":{gl:34837,render:Dg,filter:Qy,gl2ext:_X,dataFormat:6407,types:[5126]},rgba32uint:{gl:36208,b:16,c:4,rb:!0},rgba32sint:{gl:36226,b:16,c:4,rb:!0},rgba32float:{gl:34836,b:16,c:4,render:Dg,filter:Qy,rb:!0},stencil8:{gl:36168,b:1,c:1,attachment:36128,rb:!0},depth16unorm:{gl:33189,b:2,c:1,attachment:36096,dataFormat:6402,types:[5123],rb:!0},depth24plus:{gl:33190,b:3,c:1,attachment:36096,dataFormat:6402,types:[5125]},depth32float:{gl:36012,b:4,c:1,attachment:36096,dataFormat:6402,types:[5126],rb:!0},"depth24plus-stencil8":{gl:35056,b:4,c:2,p:1,attachment:33306,rb:!0,depthTexture:!0,dataFormat:34041,types:[34042]},"depth24unorm-stencil8":{gl:35056,b:4,c:2,p:1,attachment:33306,dataFormat:34041,types:[34042],rb:!0},"depth32float-stencil8":{gl:36013,b:5,c:2,p:1,attachment:33306,dataFormat:34041,types:[36269],rb:!0},"bc1-rgb-unorm-webgl":{gl:33776,x:Zg,f:ho},"bc1-rgb-unorm-srgb-webgl":{gl:35916,x:Xg,f:ho},"bc1-rgba-unorm":{gl:33777,x:Zg,f:ho},"bc1-rgba-unorm-srgb":{gl:35916,x:Xg,f:ho},"bc2-rgba-unorm":{gl:33778,x:Zg,f:ho},"bc2-rgba-unorm-srgb":{gl:35918,x:Xg,f:ho},"bc3-rgba-unorm":{gl:33779,x:Zg,f:ho},"bc3-rgba-unorm-srgb":{gl:35919,x:Xg,f:ho},"bc4-r-unorm":{gl:36283,x:Qf,f:ho},"bc4-r-snorm":{gl:36284,x:Qf,f:ho},"bc5-rg-unorm":{gl:36285,x:Qf,f:ho},"bc5-rg-snorm":{gl:36286,x:Qf,f:ho},"bc6h-rgb-ufloat":{gl:36495,x:em,f:ho},"bc6h-rgb-float":{gl:36494,x:em,f:ho},"bc7-rgba-unorm":{gl:36492,x:em,f:ho},"bc7-rgba-unorm-srgb":{gl:36493,x:em,f:ho},"etc2-rgb8unorm":{gl:37492,f:Yc},"etc2-rgb8unorm-srgb":{gl:37494,f:Yc},"etc2-rgb8a1unorm":{gl:37496,f:Yc},"etc2-rgb8a1unorm-srgb":{gl:37497,f:Yc},"etc2-rgba8unorm":{gl:37493,f:Yc},"etc2-rgba8unorm-srgb":{gl:37495,f:Yc},"eac-r11unorm":{gl:37488,f:Yc},"eac-r11snorm":{gl:37489,f:Yc},"eac-rg11unorm":{gl:37490,f:Yc},"eac-rg11snorm":{gl:37491,f:Yc},"astc-4x4-unorm":{gl:37808,f:Ai},"astc-4x4-unorm-srgb":{gl:37840,f:Ai},"astc-5x4-unorm":{gl:37809,f:Ai},"astc-5x4-unorm-srgb":{gl:37841,f:Ai},"astc-5x5-unorm":{gl:37810,f:Ai},"astc-5x5-unorm-srgb":{gl:37842,f:Ai},"astc-6x5-unorm":{gl:37811,f:Ai},"astc-6x5-unorm-srgb":{gl:37843,f:Ai},"astc-6x6-unorm":{gl:37812,f:Ai},"astc-6x6-unorm-srgb":{gl:37844,f:Ai},"astc-8x5-unorm":{gl:37813,f:Ai},"astc-8x5-unorm-srgb":{gl:37845,f:Ai},"astc-8x6-unorm":{gl:37814,f:Ai},"astc-8x6-unorm-srgb":{gl:37846,f:Ai},"astc-8x8-unorm":{gl:37815,f:Ai},"astc-8x8-unorm-srgb":{gl:37847,f:Ai},"astc-10x5-unorm":{gl:37819,f:Ai},"astc-10x5-unorm-srgb":{gl:37851,f:Ai},"astc-10x6-unorm":{gl:37817,f:Ai},"astc-10x6-unorm-srgb":{gl:37849,f:Ai},"astc-10x8-unorm":{gl:37818,f:Ai},"astc-10x8-unorm-srgb":{gl:37850,f:Ai},"astc-10x10-unorm":{gl:37819,f:Ai},"astc-10x10-unorm-srgb":{gl:37851,f:Ai},"astc-12x10-unorm":{gl:37820,f:Ai},"astc-12x10-unorm-srgb":{gl:37852,f:Ai},"astc-12x12-unorm":{gl:37821,f:Ai},"astc-12x12-unorm-srgb":{gl:37853,f:Ai},"pvrtc-rgb4unorm-webgl":{gl:35840,f:Jy},"pvrtc-rgba4unorm-webgl":{gl:35842,f:Jy},"pvrtc-rbg2unorm-webgl":{gl:35841,f:Jy},"pvrtc-rgba2unorm-webgl":{gl:35843,f:Jy},"etc1-rbg-unorm-webgl":{gl:36196,f:uX},"atc-rgb-unorm-webgl":{gl:35986,f:lb},"atc-rgba-unorm-webgl":{gl:35986,f:lb},"atc-rgbai-unorm-webgl":{gl:34798,f:lb}},bX={6403:1,36244:1,33319:2,33320:2,6407:3,36248:3,6408:4,36249:4,6402:1,34041:1,6406:1,6409:1,6410:2},xX={5126:4,5125:4,5124:4,5123:2,5122:2,5131:2,5120:1,5121:1};function J2(t,e,r){const i=M1[e];if(!i||i.gl===void 0)return!1;const s=i.x||i.gl2ext;return s?!!fd(t,s,r):!0}function S4(t){const e=M1[t]?.gl;if(e===void 0)throw new Error(`Unsupported texture format ${t}`);return e}function wX(t,e,r){if(!J2(t,e,r)||e.startsWith("depth")||e.startsWith("stencil"))return!1;try{if(v5(e).signed)return!1}catch{return!1}return e.endsWith("32float")?!!fd(t,"OES_texture_float_linear, extensions",r):e.endsWith("16float")?!!fd(t,"OES_texture_half_float_linear, extensions",r):!0}function EX(t,e,r){return!(!J2(t,e,r)||typeof e=="number")}function J0(t){const e=M1[t],r=S4(t),i=v5(t);return{format:r,dataFormat:e?.dataFormat||TX(i.format,i.integer,i.normalized,r),type:i.dataType?T4(i.dataType):e?.types?.[0]||5121,compressed:i.compressed}}function AX(t){const e=M1[t];if(!e?.attachment)throw new Error(`${t} is not a depth stencil format`);return e.attachment}function TS(t){const e=J0(t),r=bX[e.dataFormat]||4,i=xX[e.type]||1;return r*i}function TX(t,e,r,i){if(i===6408||i===6407)return i;switch(t){case"r":return e&&!r?36244:6403;case"rg":return e&&!r?33320:33319;case"rgb":return e&&!r?36248:6407;case"rgba":return e&&!r?36249:6408;default:return 6408}}const SS={"depth-clip-control":"EXT_depth_clamp","timer-query-webgl":"EXT_disjoint_timer_query_webgl2","compilation-status-async-webgl":"KHR_parallel_shader_compile","polygon-mode-webgl":"WEBGL_polygon_mode","provoking-vertex-webgl":"WEBGL_provoking_vertex","shader-clip-cull-distance-webgl":"WEBGL_clip_cull_distance","shader-noperspective-interpolation-webgl":"NV_shader_noperspective_interpolation","shader-conservative-depth-webgl":"EXT_conservative_depth"};class SX extends yG{gl;extensions;testedFeatures=new Set;constructor(e,r,i){super([],i),this.gl=e,this.extensions=r,fd(e,"EXT_color_buffer_float",r)}*[Symbol.iterator](){const e=this.getFeatures();for(const r of e)this.has(r)&&(yield r);return[]}has(e){return this.disabledFeatures[e]?!1:(this.testedFeatures.has(e)||(this.testedFeatures.add(e),yX(e)&&vX(this.gl,e,this.extensions)&&this.features.add(e),this.getWebGLFeature(e)&&this.features.add(e)),this.features.has(e))}initializeFeatures(){const e=this.getFeatures().filter(r=>r!=="polygon-mode-webgl");for(const r of e)this.has(r)}getFeatures(){return[...Object.keys(SS),...Object.keys(Y2)]}getWebGLFeature(e){const r=SS[e];return typeof r=="string"?!!fd(this.gl,r,this.extensions):!!r}}class CX extends _G{get maxTextureDimension1D(){return 0}get maxTextureDimension2D(){return this.getParameter(3379)}get maxTextureDimension3D(){return this.getParameter(32883)}get maxTextureArrayLayers(){return this.getParameter(35071)}get maxBindGroups(){return 0}get maxDynamicUniformBuffersPerPipelineLayout(){return 0}get maxDynamicStorageBuffersPerPipelineLayout(){return 0}get maxSampledTexturesPerShaderStage(){return this.getParameter(35660)}get maxSamplersPerShaderStage(){return this.getParameter(35661)}get maxStorageBuffersPerShaderStage(){return 0}get maxStorageTexturesPerShaderStage(){return 0}get maxUniformBuffersPerShaderStage(){return this.getParameter(35375)}get maxUniformBufferBindingSize(){return this.getParameter(35376)}get maxStorageBufferBindingSize(){return 0}get minUniformBufferOffsetAlignment(){return this.getParameter(35380)}get minStorageBufferOffsetAlignment(){return 0}get maxVertexBuffers(){return 16}get maxVertexAttributes(){return this.getParameter(34921)}get maxVertexBufferArrayStride(){return 2048}get maxInterStageShaderComponents(){return this.getParameter(35659)}get maxComputeWorkgroupStorageSize(){return 0}get maxComputeInvocationsPerWorkgroup(){return 0}get maxComputeWorkgroupSizeX(){return 0}get maxComputeWorkgroupSizeY(){return 0}get maxComputeWorkgroupSizeZ(){return 0}get maxComputeWorkgroupsPerDimension(){return 0}gl;limits={};constructor(e){super(),this.gl=e}getParameter(e){return this.limits[e]===void 0&&(this.limits[e]=this.gl.getParameter(e)),this.limits[e]}}function nd(t,e,r){if(MX(e))return r(t);const{nocatch:i=!0}=e;C1(t),Om(t,e);let s;if(i)s=r(t),w_(t);else try{s=r(t)}finally{w_(t)}return s}function MX(t){for(const e in t)return!1;return!0}function PX(t,e,r,i){if(V0(e))return i(t);const s=t;C1(s.gl);try{return RX(t,e),Om(s.gl,r),i(t)}finally{w_(s.gl)}}function RX(t,e){const r=t,{gl:i}=r;if(e.cullMode)switch(e.cullMode){case"none":i.disable(2884);break;case"front":i.enable(2884),i.cullFace(1028);break;case"back":i.enable(2884),i.cullFace(1029);break}if(e.frontFace&&i.frontFace(Gp("frontFace",e.frontFace,{ccw:2305,cw:2304})),e.unclippedDepth&&t.features.has("depth-clip-control")&&i.enable(34383),e.depthBias!==void 0&&(i.enable(32823),i.polygonOffset(e.depthBias,e.depthBiasSlopeScale||0)),e.provokingVertex&&t.features.has("provoking-vertex-webgl")){const s=r.getExtension("WEBGL_provoking_vertex").WEBGL_provoking_vertex,l=Gp("provokingVertex",e.provokingVertex,{first:36429,last:36430});s?.provokingVertexWEBGL(l)}if((e.polygonMode||e.polygonOffsetLine)&&t.features.has("polygon-mode-webgl")){if(e.polygonMode){const s=r.getExtension("WEBGL_polygon_mode").WEBGL_polygon_mode,l=Gp("polygonMode",e.polygonMode,{fill:6914,line:6913});s?.polygonModeWEBGL(1028,l),s?.polygonModeWEBGL(1029,l)}e.polygonOffsetLine&&i.enable(10754)}if(t.features.has("shader-clip-cull-distance-webgl")&&(e.clipDistance0&&i.enable(12288),e.clipDistance1&&i.enable(12289),e.clipDistance2&&i.enable(12290),e.clipDistance3&&i.enable(12291),e.clipDistance4&&i.enable(12292),e.clipDistance5&&i.enable(12293),e.clipDistance6&&i.enable(12294),e.clipDistance7&&i.enable(12295)),e.depthWriteEnabled!==void 0&&i.depthMask(kX("depthWriteEnabled",e.depthWriteEnabled)),e.depthCompare&&(e.depthCompare!=="always"?i.enable(2929):i.disable(2929),i.depthFunc(Vx("depthCompare",e.depthCompare))),e.stencilWriteMask){const s=e.stencilWriteMask;i.stencilMaskSeparate(1028,s),i.stencilMaskSeparate(1029,s)}if(e.stencilReadMask&&Ct.warn("stencilReadMask not supported under WebGL"),e.stencilCompare){const s=e.stencilReadMask||4294967295,l=Vx("depthCompare",e.stencilCompare);e.stencilCompare!=="always"?i.enable(2960):i.disable(2960),i.stencilFuncSeparate(1028,l,0,s),i.stencilFuncSeparate(1029,l,0,s)}if(e.stencilPassOperation&&e.stencilFailOperation&&e.stencilDepthFailOperation){const s=db("stencilPassOperation",e.stencilPassOperation),l=db("stencilFailOperation",e.stencilFailOperation),h=db("stencilDepthFailOperation",e.stencilDepthFailOperation);i.stencilOpSeparate(1028,l,h,s),i.stencilOpSeparate(1029,l,h,s)}if(e.blendColorOperation||e.blendAlphaOperation){i.enable(3042);const s=CS("blendColorOperation",e.blendColorOperation||"add"),l=CS("blendAlphaOperation",e.blendAlphaOperation||"add");i.blendEquationSeparate(s,l);const h=e0("blendColorSrcFactor",e.blendColorSrcFactor||"one"),a=e0("blendColorDstFactor",e.blendColorDstFactor||"zero"),v=e0("blendAlphaSrcFactor",e.blendAlphaSrcFactor||"one"),T=e0("blendAlphaDstFactor",e.blendAlphaDstFactor||"zero");i.blendFuncSeparate(h,a,v,T)}}function Vx(t,e){return Gp(t,e,{never:512,less:513,equal:514,"less-equal":515,greater:516,"not-equal":517,"greater-equal":518,always:519})}function db(t,e){return Gp(t,e,{keep:7680,zero:0,replace:7681,invert:5386,"increment-clamp":7682,"decrement-clamp":7683,"increment-wrap":34055,"decrement-wrap":34056})}function CS(t,e){return Gp(t,e,{add:32774,subtract:32778,"reverse-subtract":32779,min:32775,max:32776})}function e0(t,e){return Gp(t,e,{one:1,zero:0,"src-color":768,"one-minus-src-color":769,"dst-color":774,"one-minus-dst-color":775,"src-alpha":770,"one-minus-src-alpha":771,"dst-alpha":772,"one-minus-dst-alpha":773,"src-alpha-saturated":776,"constant-color":32769,"one-minus-constant-color":32770,"constant-alpha":32771,"one-minus-constant-alpha":32772})}function IX(t,e){return`Illegal parameter ${e} for ${t}`}function Gp(t,e,r){if(!(e in r))throw new Error(IX(t,e));return r[e]}function kX(t,e){return e}function C4(t){const e={};return t.addressModeU&&(e[10242]=pb(t.addressModeU)),t.addressModeV&&(e[10243]=pb(t.addressModeV)),t.addressModeW&&(e[32882]=pb(t.addressModeW)),t.magFilter&&(e[10240]=M4(t.magFilter)),(t.minFilter||t.mipmapFilter)&&(e[10241]=BX(t.minFilter||"linear",t.mipmapFilter)),t.lodMinClamp!==void 0&&(e[33082]=t.lodMinClamp),t.lodMaxClamp!==void 0&&(e[33083]=t.lodMaxClamp),t.type==="comparison-sampler"&&(e[34892]=34894),t.compare&&(e[34893]=Vx("compare",t.compare)),t.maxAnisotropy&&(e[34046]=t.maxAnisotropy),e}function pb(t){switch(t){case"clamp-to-edge":return 33071;case"repeat":return 10497;case"mirror-repeat":return 33648}}function M4(t){switch(t){case"nearest":return 9728;case"linear":return 9729}}function BX(t,e){if(!e)return M4(t);switch(t){case"nearest":return e==="nearest"?9984:9986;case"linear":return e==="nearest"?9985:9987}}class ad extends Ji{device;gl;handle;glTarget;glUsage;glIndexType=5123;byteLength;bytesUsed;constructor(e,r={}){super(e,r),this.device=e,this.gl=this.device.gl;const i=typeof r=="object"?r.handle:void 0;this.handle=i||this.gl.createBuffer(),e.setSpectorMetadata(this.handle,{...this.props,data:typeof this.props.data}),this.glTarget=LX(this.props.usage),this.glUsage=DX(this.props.usage),this.glIndexType=this.props.indexType==="uint32"?5125:5123,r.data?this._initWithData(r.data,r.byteOffset,r.byteLength):this._initWithByteLength(r.byteLength||0)}_initWithData(e,r=0,i=e.byteLength+r){const s=this.glTarget;this.gl.bindBuffer(s,this.handle),this.gl.bufferData(s,i,this.glUsage),this.gl.bufferSubData(s,r,e),this.gl.bindBuffer(s,null),this.bytesUsed=i,this.byteLength=i,this._setDebugData(e,r,i),this.trackAllocatedMemory(i)}_initWithByteLength(e){fi(e>=0);let r=e;e===0&&(r=new Float32Array(0));const i=this.glTarget;return this.gl.bindBuffer(i,this.handle),this.gl.bufferData(i,r,this.glUsage),this.gl.bindBuffer(i,null),this.bytesUsed=e,this.byteLength=e,this._setDebugData(null,0,e),this.trackAllocatedMemory(e),this}destroy(){!this.destroyed&&this.handle&&(this.removeStats(),this.trackDeallocatedMemory(),this.gl.deleteBuffer(this.handle),this.destroyed=!0,this.handle=null)}write(e,r=0){this.gl.bindBuffer(36663,this.handle),this.gl.bufferSubData(36663,r,e),this.gl.bindBuffer(36663,null),this._setDebugData(e,r,e.byteLength)}async readAsync(e=0,r){return this.readSyncWebGL(e,r)}readSyncWebGL(e=0,r){r=r??this.byteLength-e;const i=new Uint8Array(r);return this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,e,i,0,r),this.gl.bindBuffer(36662,null),this._setDebugData(i,e,r),i}}function LX(t){return t&Ji.INDEX?34963:t&Ji.VERTEX?34962:t&Ji.UNIFORM?35345:34962}function DX(t){return t&Ji.INDEX||t&Ji.VERTEX?35044:t&Ji.UNIFORM?35048:35044}class Gx extends A1{device;handle;parameters;constructor(e,r){super(e,r),this.device=e,this.parameters=C4(r),this.handle=this.handle||this.device.gl.createSampler(),this._setSamplerParameters(this.parameters)}destroy(){this.handle&&(this.device.gl.deleteSampler(this.handle),this.handle=void 0)}toString(){return`Sampler(${this.id},${JSON.stringify(this.props)})`}_setSamplerParameters(e){for(const[r,i]of Object.entries(e)){const s=Number(r);switch(s){case 33082:case 33083:this.device.gl.samplerParameterf(this.handle,s,i);break;default:this.device.gl.samplerParameteri(this.handle,s,i);break}}}}class tm extends w1{device;gl;handle;texture;constructor(e,r){super(e,{...Va.defaultProps,...r}),this.device=e,this.gl=this.device.gl,this.handle=null,this.texture=r.texture}}const NX={parameters:{},pixelStore:{},pixels:null,border:0,dataFormat:void 0,textureUnit:void 0,target:void 0};class oc extends Va{static FACES=[34069,34070,34071,34072,34073,34074];MAX_ATTRIBUTES;device;gl;handle;sampler=void 0;view=void 0;glFormat=void 0;type=void 0;dataFormat=void 0;mipmaps=void 0;target;textureUnit=void 0;loaded=!1;_video;constructor(e,r){super(e,{...NX,format:"rgba8unorm",...r}),this.device=e,this.gl=this.device.gl,this.handle=this.props.handle||this.gl.createTexture(),this.device.setSpectorMetadata(this.handle,{...this.props,data:typeof this.props.data}),this.glFormat=6408,this.target=OX(this.props),this.loaded=!1,typeof this.props?.data=="string"&&Object.assign(this.props,{data:sH(this.props.data)}),this.initialize(this.props),Object.seal(this)}destroy(){this.handle&&(this.gl.deleteTexture(this.handle),this.removeStats(),this.trackDeallocatedMemory("Texture"),this.destroyed=!0)}toString(){return`Texture(${this.id},${this.width}x${this.height})`}createView(e){return new tm(this.device,{...e,texture:this})}initialize(e={}){if(this.props.dimension==="cube")return this.initializeCube(e);let r=e.data;if(r instanceof Promise)return r.then(ne=>this.initialize(Object.assign({},e,{pixels:ne,data:ne}))),this;const i=typeof HTMLVideoElement<"u"&&r instanceof HTMLVideoElement;if(i&&r.readyState<HTMLVideoElement.HAVE_METADATA)return this._video=null,r.addEventListener("loadeddata",()=>this.initialize(e)),this;const{parameters:s={}}=e,{pixels:l=null,pixelStore:h={},textureUnit:a=void 0,mipmaps:v=!0}=e;r||(r=l);let{width:T,height:C,dataFormat:k,type:L,compressed:O=!1}=e;const{depth:K=0}=e,$=S4(e.format);return{width:T,height:C,compressed:O,dataFormat:k,type:L}=this._deduceParameters({format:e.format,type:L,dataFormat:k,compressed:O,data:r,width:T,height:C}),this.width=T,this.height=C,this.glFormat=$,this.type=L,this.dataFormat=k,this.textureUnit=a,Number.isFinite(this.textureUnit)&&(this.gl.activeTexture(33984+this.textureUnit),this.gl.bindTexture(this.target,this.handle)),this.mipmaps=v,this.setImageData({data:r,width:T,height:C,depth:K,format:e.format,type:L,dataFormat:k,parameters:h,compressed:O}),this.setSampler(e.sampler),this._setSamplerParameters(s),this.view=this.createView({...this.props,mipLevelCount:1,arrayLayerCount:1}),v&&this.device.isTextureFormatFilterable(e.format)&&this.generateMipmap(),i&&(this._video={video:r,parameters:s,lastTime:r.readyState>=HTMLVideoElement.HAVE_CURRENT_DATA?r.currentTime:-1}),this}initializeCube(e){const{mipmaps:r=!0,parameters:i={}}=e;return this.setCubeMapImageData(e).then(()=>{this.loaded=!0,r&&this.generateMipmap(e),this.setSampler(e.sampler),this._setSamplerParameters(i)}),this}setSampler(e={}){let r;e instanceof Gx?(this.sampler=e,r=e.props):(this.sampler=new Gx(this.device,e),r=e);const i=C4(r);return this._setSamplerParameters(i),this}resize(e){const{height:r,width:i,mipmaps:s=!1}=e;return i!==this.width||r!==this.height?this.initialize({width:i,height:r,format:this.format,type:this.type,dataFormat:this.dataFormat,mipmaps:s}):this}update(){if(this._video){const{video:e,parameters:r,lastTime:i}=this._video;if(i===e.currentTime||e.readyState<HTMLVideoElement.HAVE_CURRENT_DATA)return;this.setSubImageData({data:e,parameters:r}),this.mipmaps&&this.generateMipmap(),this._video.lastTime=e.currentTime}}generateMipmap(e={}){return this.mipmaps=!0,this.gl.bindTexture(this.target,this.handle),nd(this.gl,e,()=>{this.gl.generateMipmap(this.target)}),this.gl.bindTexture(this.target,null),this}setImageData(e){if(this.props.dimension==="3d"||this.props.dimension==="2d-array")return this.setImageData3D(e);this.trackDeallocatedMemory("Texture");const{target:r=this.target,pixels:i=null,level:s=0,glFormat:l=this.glFormat,offset:h=0,parameters:a={}}=e;let{data:v=null,type:T=this.type,width:C=this.width,height:k=this.height,dataFormat:L=this.dataFormat,compressed:O=!1}=e;v||(v=i),{type:T,dataFormat:L,compressed:O,width:C,height:k}=this._deduceParameters({format:this.props.format,type:T,dataFormat:L,compressed:O,data:v,width:C,height:k});const{gl:K}=this;K.bindTexture(this.target,this.handle);let $=null;if({data:v,dataType:$}=this._getDataType({data:v,compressed:O}),nd(this.gl,a,()=>{switch($){case"null":K.texImage2D(r,s,l,C,k,0,L,T,v);break;case"typed-array":K.texImage2D(r,s,l,C,k,0,L,T,v,h);break;case"buffer":this.device.gl.bindBuffer(35052,v.handle||v),this.device.gl.texImage2D(r,s,l,C,k,0,L,T,h),this.device.gl.bindBuffer(35052,null);break;case"browser-object":K.texImage2D(r,s,l,C,k,0,L,T,v);break;case"compressed":for(const[ne,oe]of v.entries())K.compressedTexImage2D(r,ne,oe.format,oe.width,oe.height,0,oe.data);break;default:fi(!1,"Unknown image data type")}}),v&&v.byteLength)this.trackAllocatedMemory(v.byteLength,"Texture");else{const ne=TS(this.props.format);this.trackAllocatedMemory(this.width*this.height*ne,"Texture")}return this.loaded=!0,this}setSubImageData({target:e=this.target,pixels:r=null,data:i=null,x:s=0,y:l=0,width:h=this.width,height:a=this.height,level:v=0,glFormat:T=this.glFormat,type:C=this.type,dataFormat:k=this.dataFormat,compressed:L=!1,offset:O=0,parameters:K={}}){if({type:C,dataFormat:k,compressed:L,width:h,height:a}=this._deduceParameters({format:this.props.format,type:C,dataFormat:k,compressed:L,data:i,width:h,height:a}),fi(this.depth===1,"texSubImage not supported for 3D textures"),i||(i=r),i&&i.data){const $=i;i=$.data,h=$.shape[0],a=$.shape[1]}i instanceof ad&&(i=i.handle),this.gl.bindTexture(this.target,this.handle),nd(this.gl,K,()=>{L?this.gl.compressedTexSubImage2D(e,v,s,l,h,a,T,i):i===null?this.gl.texSubImage2D(e,v,s,l,h,a,k,C,null):ArrayBuffer.isView(i)?this.gl.texSubImage2D(e,v,s,l,h,a,k,C,i,O):typeof WebGLBuffer<"u"&&i instanceof WebGLBuffer?(this.device.gl.bindBuffer(35052,i),this.device.gl.texSubImage2D(e,v,s,l,h,a,k,C,O),this.device.gl.bindBuffer(35052,null)):this.device.gl.texSubImage2D(e,v,s,l,h,a,k,C,i)}),this.gl.bindTexture(this.target,null)}copyFramebuffer(e={}){return Ct.error("Texture.copyFramebuffer({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(e=this.textureUnit){const{gl:r}=this;return e!==void 0&&(this.textureUnit=e,r.activeTexture(33984+e)),r.bindTexture(this.target,this.handle),e}unbind(e=this.textureUnit){const{gl:r}=this;return e!==void 0&&(this.textureUnit=e,r.activeTexture(33984+e)),r.bindTexture(this.target,null),e}_getDataType({data:e,compressed:r=!1}){return r?{data:e,dataType:"compressed"}:e===null?{data:e,dataType:"null"}:ArrayBuffer.isView(e)?{data:e,dataType:"typed-array"}:e instanceof ad?{data:e.handle,dataType:"buffer"}:typeof WebGLBuffer<"u"&&e instanceof WebGLBuffer?{data:e,dataType:"buffer"}:{data:e,dataType:"browser-object"}}_deduceParameters(e){const{format:r,data:i}=e;let{width:s,height:l,dataFormat:h,type:a,compressed:v}=e;const T=J0(r);return h=h||T.dataFormat,a=a||T.type,v=v||T.compressed,{width:s,height:l}=this._deduceImageSize(i,s,l),{dataFormat:h,type:a,compressed:v,width:s,height:l,format:r,data:i}}_deduceImageSize(e,r,i){let s;return typeof ImageData<"u"&&e instanceof ImageData?s={width:e.width,height:e.height}:typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement?s={width:e.naturalWidth,height:e.naturalHeight}:typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement?s={width:e.width,height:e.height}:typeof ImageBitmap<"u"&&e instanceof ImageBitmap?s={width:e.width,height:e.height}:typeof HTMLVideoElement<"u"&&e instanceof HTMLVideoElement?s={width:e.videoWidth,height:e.videoHeight}:e?s={width:r,height:i}:s={width:r>=0?r:1,height:i>=0?i:1},fi(s,"Could not deduced texture size"),fi(r===void 0||s.width===r,"Deduced texture width does not match supplied width"),fi(i===void 0||s.height===i,"Deduced texture height does not match supplied height"),s}async setCubeMapImageData(e){const{gl:r}=this,{width:i,height:s,pixels:l,data:h,format:a=6408,type:v=5121}=e,T=l||h,C=await Promise.all(oc.FACES.map(k=>{const L=T[k];return Promise.all(Array.isArray(L)?L:[L])}));this.bind(),oc.FACES.forEach((k,L)=>{C[L].length>1&&this.props.mipmaps!==!1&&Ct.warn(`${this.id} has mipmap and multiple LODs.`)(),C[L].forEach((O,K)=>{i&&s?r.texImage2D(k,K,a,i,s,0,a,v,O):r.texImage2D(k,K,a,a,v,O)})}),this.unbind()}setImageDataForFace(e){const{face:r,width:i,height:s,pixels:l,data:h,format:a=6408,type:v=5121}=e,{gl:T}=this,C=l||h;return this.bind(),C instanceof Promise?C.then(k=>this.setImageDataForFace(Object.assign({},e,{face:r,data:k,pixels:k}))):this.width||this.height?T.texImage2D(r,0,a,i,s,0,a,v,C):T.texImage2D(r,0,a,a,v,C),this}setImageData3D(e){const{level:r=0,dataFormat:i,format:s,type:l,width:h,height:a,depth:v=1,offset:T=0,data:C,parameters:k={}}=e;this.trackDeallocatedMemory("Texture"),this.gl.bindTexture(this.target,this.handle);const L=J0(s);if(nd(this.gl,k,()=>{ArrayBuffer.isView(C)&&this.gl.texImage3D(this.target,r,L.format,h,a,v,0,L.dataFormat,L.type,C),C instanceof ad&&(this.gl.bindBuffer(35052,C.handle),this.gl.texImage3D(this.target,r,i,h,a,v,0,s,l,T))}),C&&C.byteLength)this.trackAllocatedMemory(C.byteLength,"Texture");else{const O=TS(this.props.format);this.trackAllocatedMemory(this.width*this.height*this.depth*O,"Texture")}return this.loaded=!0,this}_setSamplerParameters(e){if(!V0(e)){FX(e),this.gl.bindTexture(this.target,this.handle);for(const[r,i]of Object.entries(e)){const s=Number(r),l=i;switch(s){case 33082:case 33083:this.gl.texParameterf(this.target,s,l);break;default:this.gl.texParameteri(this.target,s,l);break}}this.gl.bindTexture(this.target,null)}}}function OX(t){switch(t.dimension){case"2d":return 3553;case"cube":return 34067;case"2d-array":return 35866;case"3d":return 32879;case"1d":case"cube-array":default:throw new Error(t.dimension)}}function FX(t){Ct.log(1,"texture sampler parameters",t)()}class a_ extends T1{device;gl;handle;get texture(){return this.colorAttachments[0]}constructor(e,r){super(e,r);const i=r.handle===null;if(this.device=e,this.gl=e.gl,this.handle=this.props.handle||i?this.props.handle:this.gl.createFramebuffer(),!i){e.setSpectorMetadata(this.handle,{id:this.props.id,props:this.props}),this.autoCreateAttachmentTextures();const s=this.gl.bindFramebuffer(36160,this.handle);for(let l=0;l<this.colorAttachments.length;++l){const h=this.colorAttachments[l],a=36064+l;h&&this._attachOne(a,h)}if(this.depthStencilAttachment&&this._attachOne(AX(this.depthStencilAttachment.props.format),this.depthStencilAttachment),r.check!==!1){const l=this.gl.checkFramebufferStatus(36160);if(l!==36053)throw new Error(`Framebuffer ${UX(l)}`)}this.gl.bindFramebuffer(36160,s)}}destroy(){super.destroy(),!this.destroyed&&this.handle!==null&&this.gl.deleteFramebuffer(this.handle)}createDepthStencilTexture(e){return new oc(this.device,{id:`${this.id}-depth-stencil`,format:e,width:this.width,height:this.height,mipmaps:!1})}resizeAttachments(e,r){if(this.handle===null)return this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this;e===void 0&&(e=this.gl.drawingBufferWidth),r===void 0&&(r=this.gl.drawingBufferHeight);for(const i of this.colorAttachments)i.texture.resize({width:e,height:r});return this.depthStencilAttachment&&this.depthStencilAttachment.texture.resize({width:e,height:r}),this}_attachOne(e,r){if(Array.isArray(r)){const[i,s=0,l=0]=r;return this._attachTexture(e,i,s,l),i}if(r instanceof oc)return this._attachTexture(e,r,0,0),r;if(r instanceof tm){const i=r;return this._attachTexture(e,i.texture,i.props.baseMipLevel,i.props.baseArrayLayer),r.texture}throw new Error("attach")}_attachTexture(e,r,i,s){const{gl:l}=this.device;switch(l.bindTexture(r.target,r.handle),r.target){case 35866:case 32879:l.framebufferTextureLayer(36160,e,r.target,s,i);break;case 34067:const h=zX(i);l.framebufferTexture2D(36160,e,h,r.handle,s);break;case 3553:l.framebufferTexture2D(36160,e,3553,r.handle,s);break;default:fi(!1,"Illegal texture type")}l.bindTexture(r.target,null)}}function zX(t){return t<34069?t+34069:t}function UX(t){switch(t){case 36053:return"success";case 36054:return"Mismatched attachments";case 36055:return"No attachments";case 36057:return"Height/width mismatch";case 36061:return"Unsupported or split attachments";case 36182:return"Samples mismatch";default:return`${t}`}}class jX extends b5{device;presentationSize;_framebuffer=null;constructor(e,r){super(r),this.device=e,this.presentationSize=[-1,-1],this._setAutoCreatedCanvasId(`${this.device.id}-canvas`),this.update()}getCurrentFramebuffer(){return this.update(),this._framebuffer=this._framebuffer||new a_(this.device,{handle:null}),this._framebuffer}update(){const e=this.getPixelSize();(e[0]!==this.presentationSize[0]||e[1]!==this.presentationSize[1])&&(this.presentationSize=e,this.resize())}resize(e){if(this.device.gl&&this.canvas){const r=this.getDevicePixelRatio(e?.useDevicePixels);this.setDevicePixelRatio(r,e);return}}commit(){}}const VX={spector:Ct.get("spector")||Ct.get("spectorjs")},GX="https://cdn.jsdelivr.net/npm/spectorjs@0.9.30/dist/spector.bundle.js",HX=1;let na=null,MS=!1;async function WX(t){if(!globalThis.SPECTOR)try{await M5(GX)}catch(e){Ct.warn(String(e))}}function qX(t){if(t={...VX,...t},!t?.spector||(!na&&globalThis.SPECTOR&&(Ct.probe(HX,"SPECTOR found and initialized")(),na=new globalThis.SPECTOR.Spector,globalThis.luma&&(globalThis.luma.spector=na)),!na))return null;if(MS||(MS=!0,na.spyCanvases(),na?.onCaptureStarted.add(e=>Ct.info("Spector capture started:",e)()),na?.onCapture.add(e=>{Ct.info("Spector capture complete:",e)(),na?.getResultUI(),na?.resultView.display(),na?.resultView.addCapture(e)})),t?.canvas){if(typeof t.spector=="string"&&t.spector!==t.canvas.id)return na;na?.startCapture(t?.canvas,500),new Promise(e=>setTimeout(e,2e3)).then(e=>{Ct.info("Spector capture stopped after 2 seconds")(),na?.stopCapture()})}return na}const $X="https://unpkg.com/webgl-debug@2.0.1/index.js";function P4(t){return t.luma=t.luma||{},t.luma}async function ZX(){_d()&&!globalThis.WebGLDebugUtils&&(globalThis.global=globalThis.global||globalThis,globalThis.global.module={},await M5($X))}function XX(t,e={}){return t?e.debug?YX(t,e):KX(t):null}function KX(t){const e=P4(t);return e.realContext?e.realContext:t}function YX(t,e){if(!globalThis.WebGLDebugUtils)return Ct.warn("webgl-debug not loaded")(),t;const r=P4(t);if(r.debugContext)return r.debugContext;globalThis.WebGLDebugUtils.init({...Jf,...t});const i=globalThis.WebGLDebugUtils.makeDebugContext(t,JX.bind(null,e),QX.bind(null,e));for(const h in Jf)!(h in i)&&typeof Jf[h]=="number"&&(i[h]=Jf[h]);class s{}Object.setPrototypeOf(i,Object.getPrototypeOf(t)),Object.setPrototypeOf(s,i);const l=Object.create(s);return r.realContext=t,r.debugContext=l,l.debug=!0,l}function fb(t,e){e=Array.from(e).map(i=>i===void 0?"undefined":i);let r=globalThis.WebGLDebugUtils.glFunctionArgsToString(t,e);return r=`${r.slice(0,100)}${r.length>100?"...":""}`,`gl.${t}(${r})`}function JX(t,e,r,i){i=Array.from(i).map(a=>a===void 0?"undefined":a);const s=globalThis.WebGLDebugUtils.glEnumToString(e),l=globalThis.WebGLDebugUtils.glFunctionArgsToString(r,i),h=`${s} in gl.${r}(${l})`;Ct.error(h)();debugger;if(t.throwOnError)throw new Error(h)}function QX(t,e,r){let i="";if(Ct.level>=1&&(i=fb(e,r),Ct.log(1,i)()),t.break&&t.break.length>0&&(i=i||fb(e,r),t.break.every(s=>i.indexOf(s)!==-1)))debugger;for(const s of r)if(s===void 0){if(i=i||fb(e,r),t.throwOnError)throw new Error(`Undefined argument: ${i}`);Ct.error(`Undefined argument: ${i}`)();debugger}}function eK(t){const e=t.split(/\r?\n/),r=[];for(const i of e){if(i.length<=1)continue;const s=i.split(":");if(s.length===2){const[k,L]=s;r.push({message:L.trim(),type:PS(k),lineNum:0,linePos:0});continue}const[l,h,a,...v]=s;let T=parseInt(a,10);isNaN(T)&&(T=0);let C=parseInt(h,10);isNaN(C)&&(C=0),r.push({message:v.join(":").trim(),type:PS(l),lineNum:T,linePos:C})}return r}function PS(t){const e=["warning","error","info"],r=t.toLowerCase();return e.includes(r)?r:"info"}class tK extends E1{device;handle;constructor(e,r){switch(super(e,r),this.device=e,this.props.stage){case"vertex":this.handle=this.props.handle||this.device.gl.createShader(35633);break;case"fragment":this.handle=this.props.handle||this.device.gl.createShader(35632);break;default:throw new Error(this.props.stage)}this._compile(this.source)}destroy(){this.handle&&(this.removeStats(),this.device.gl.deleteShader(this.handle),this.destroyed=!0)}async getCompilationInfo(){return await this._waitForCompilationComplete(),this.getCompilationInfoSync()}getCompilationInfoSync(){const e=this.device.gl.getShaderInfoLog(this.handle);return eK(e)}getTranslatedSource(){return this.device.getExtension("WEBGL_debug_shaders").WEBGL_debug_shaders?.getTranslatedShaderSource(this.handle)}async _compile(e){e=(i=>i.startsWith("#version ")?i:`#version 100
${i}`)(e);const{gl:r}=this.device;if(r.shaderSource(this.handle,e),r.compileShader(this.handle),Ct.level===0){this.compilationStatus="pending";return}if(!this.device.features.has("compilation-status-async-webgl")){if(this._getCompilationStatus(),this.debugShader(),this.compilationStatus==="error")throw new Error(`GLSL compilation errors in ${this.props.stage} shader ${this.props.id}`);return}Ct.once(1,"Shader compilation is asynchronous")(),await this._waitForCompilationComplete(),Ct.info(2,`Shader ${this.id} - async compilation complete: ${this.compilationStatus}`)(),this._getCompilationStatus(),this.debugShader()}async _waitForCompilationComplete(){const e=async i=>await new Promise(s=>setTimeout(s,i));if(!this.device.features.has("compilation-status-async-webgl")){await e(10);return}const{gl:r}=this.device;for(;;){if(r.getShaderParameter(this.handle,37297))return;await e(10)}}_getCompilationStatus(){this.compilationStatus=this.device.gl.getShaderParameter(this.handle,35713)?"success":"error"}}const rK=256,iK=1024,nK=16384,mb=6144,sK=[1,2,4,8];class oK extends A2{device;glParameters;constructor(e,r){super(e,r),this.device=e,C1(this.device.gl),this.setParameters(this.props.parameters),this.clear()}end(){w_(this.device.gl)}pushDebugGroup(e){}popDebugGroup(){}insertDebugMarker(e){}setParameters(e={}){const r={...this.glParameters};this.props.framebuffer&&(r.framebuffer=this.props.framebuffer),this.props.depthReadOnly&&(r.depthMask=!this.props.depthReadOnly),r.stencilMask=this.props.stencilReadOnly?0:1,r[35977]=this.props.discard,e.viewport&&(e.viewport.length>=6?(r.viewport=e.viewport.slice(0,4),r.depthRange=[e.viewport[4],e.viewport[5]]):r.viewport=e.viewport),e.scissorRect&&(r.scissorTest=!0,r.scissor=e.scissorRect),e.blendConstant&&(r.blendColor=e.blendConstant),e.stencilReference&&(console.warn("RenderPassParameters.stencilReference not yet implemented in WebGL"),e[2967]=e.stencilReference),e.colorMask&&(r.colorMask=sK.map(i=>!!(i&e.colorMask))),this.glParameters=r,Om(this.device.gl,r)}beginOcclusionQuery(e){this.props.occlusionQuerySet?.beginOcclusionQuery()}endOcclusionQuery(){this.props.occlusionQuerySet?.endOcclusionQuery()}clear(){const e={...this.glParameters};let r=0;this.props.clearColor!==!1&&(r|=nK,e.clearColor=this.props.clearColor),this.props.clearDepth!==!1&&(r|=rK,e.clearDepth=this.props.clearDepth),this.props.clearStencil!==!1&&(r|=iK,e.clearStencil=this.props.clearStencil),r!==0&&nd(this.device.gl,e,()=>{this.device.gl.clear(r)})}clearColorBuffer(e=0,r=[0,0,0,0]){nd(this.device.gl,{framebuffer:this.props.framebuffer},()=>{switch(r.constructor){case Int32Array:this.device.gl.clearBufferiv(mb,e,r);break;case Uint32Array:this.device.gl.clearBufferuiv(mb,e,r);break;case Float32Array:default:this.device.gl.clearBufferfv(mb,e,r);break}})}}const aK="Failed to deduce GL constant from typed array";function lK(t){switch(ArrayBuffer.isView(t)?t.constructor:t){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(aK)}}function Hx(t,e){const{clamped:r=!0}=e||{};switch(t){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return r?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}const cK={offset:0,stride:0,type:5126,size:1,divisor:0,normalized:!1,integer:!1},uK={deprecatedProps:{instanced:"divisor",isInstanced:"divisor"}};class l_{offset;stride;type;size;divisor;normalized;integer;buffer;index;static getBytesPerElement(e){return Hx(e.type||5126).BYTES_PER_ELEMENT}static getBytesPerVertex(e){return fi(e.size),Hx(e.type||5126).BYTES_PER_ELEMENT*e.size}static resolve(...e){return new l_(cK,...e)}constructor(...e){e.forEach(r=>this._assign(r)),Object.freeze(this)}toString(){return JSON.stringify(this)}get BYTES_PER_ELEMENT(){return l_.getBytesPerElement(this)}get BYTES_PER_VERTEX(){return l_.getBytesPerVertex(this)}_assign(e={}){return e=iH("Accessor",e,uK),e.type!==void 0&&(this.type=e.type,(e.type===5124||e.type===5125)&&(this.integer=!0)),e.size!==void 0&&(this.size=e.size),e.offset!==void 0&&(this.offset=e.offset),e.stride!==void 0&&(this.stride=e.stride),e.normalize!==void 0&&(this.normalized=e.normalize),e.normalized!==void 0&&(this.normalized=e.normalized),e.integer!==void 0&&(this.integer=e.integer),e.divisor!==void 0&&(this.divisor=e.divisor),e.buffer!==void 0&&(this.buffer=e.buffer),e.index!==void 0&&(typeof e.index=="boolean"?this.index=e.index?1:0:this.index=e.index),e.instanced!==void 0&&(this.divisor=e.instanced?1:0),e.isInstanced!==void 0&&(this.divisor=e.isInstanced?1:0),this.offset===void 0&&delete this.offset,this.stride===void 0&&delete this.stride,this.type===void 0&&delete this.type,this.size===void 0&&delete this.size,this.divisor===void 0&&delete this.divisor,this.normalized===void 0&&delete this.normalized,this.integer===void 0&&delete this.integer,this.buffer===void 0&&delete this.buffer,this.index===void 0&&delete this.index,this}}function hK(t){return dK.includes(t)}const dK=[35678,35680,35679,35682,36289,36292,36293,36298,36299,36300,36303,36306,36307,36308,36311],R4={5126:[5126,1,"float","f32","float32"],35664:[5126,2,"vec2","vec2<f32>","float32x2"],35665:[5126,3,"vec3","vec3<f32>","float32x3"],35666:[5126,4,"vec4","vec4<f32>","float32x4"],5124:[5124,1,"int","i32","sint32"],35667:[5124,2,"ivec2","vec2<i32>","sint32x2"],35668:[5124,3,"ivec3","vec3<i32>","sint32x3"],35669:[5124,4,"ivec4","vec4<i32>","sint32x4"],5125:[5125,1,"uint","u32","uint32"],36294:[5125,2,"uvec2","vec2<u32>","uint32x2"],36295:[5125,3,"uvec3","vec3<u32>","uint32x3"],36296:[5125,4,"uvec4","vec4<u32>","uint32x4"],35670:[5126,1,"bool","f32","float32"],35671:[5126,2,"bvec2","vec2<f32>","float32x2"],35672:[5126,3,"bvec3","vec3<f32>","float32x3"],35673:[5126,4,"bvec4","vec4<f32>","float32x4"],35674:[5126,8,"mat2","mat2x2<f32>"],35685:[5126,8,"mat2x3","mat2x3<f32>"],35686:[5126,8,"mat2x4","mat2x4<f32>"],35687:[5126,12,"mat3x2","mat3x2<f32>"],35675:[5126,12,"mat3","mat3x3<f32>"],35688:[5126,12,"mat3x4","mat3x4<f32>"],35689:[5126,16,"mat4x2","mat4x2<f32>"],35690:[5126,16,"mat4x3","mat4x3<f32>"],35676:[5126,16,"mat4","mat4x4<f32>"]};function I4(t){const e=R4[t];if(!e)throw new Error("uniform");const[r,i,,s]=e;return{format:s,components:i,glType:r}}function pK(t){const e=R4[t];if(!e)throw new Error("attribute");const[,r,,i,s]=e;return{attributeType:i,vertexFormat:s,components:r}}function fK(t,e){const r={attributes:[],bindings:[]};r.attributes=mK(t,e);const i=yK(t,e);for(const a of i){const v=a.uniforms.map(T=>({name:T.name,format:T.format,byteOffset:T.byteOffset,byteStride:T.byteStride,arrayLength:T.arrayLength}));r.bindings.push({type:"uniform",name:a.name,location:a.location,visibility:(a.vertex?1:0)&(a.fragment?2:0),minBindingSize:a.byteLength,uniforms:v})}const s=_K(t,e);let l=0;for(const a of s)if(hK(a.type)){const{viewDimension:v,sampleType:T}=bK(a.type);r.bindings.push({type:"texture",name:a.name,location:l,viewDimension:v,sampleType:T}),a.textureUnit=l,l+=1}s.length&&(r.uniforms=s);const h=gK(t,e);return h?.length&&(r.varyings=h),r}function mK(t,e){const r=[],i=t.getProgramParameter(e,35721);for(let s=0;s<i;s++){const l=t.getActiveAttrib(e,s);if(!l)throw new Error("activeInfo");const{name:h,type:a}=l,v=t.getAttribLocation(e,h);if(v>=0){const{attributeType:T}=pK(a),C=/instance/i.test(h)?"instance":"vertex";r.push({name:h,location:v,stepMode:C,type:T})}}return r.sort((s,l)=>s.location-l.location),r}function gK(t,e){const r=[],i=t.getProgramParameter(e,35971);for(let s=0;s<i;s++){const l=t.getTransformFeedbackVarying(e,s);if(!l)throw new Error("activeInfo");const{name:h,type:a,size:v}=l,{glType:T,components:C}=I4(a),k=new l_({type:T,size:v*C}),L={location:s,name:h,accessor:k};r.push(L)}return r.sort((s,l)=>s.location-l.location),r}function _K(t,e){const r=[],i=t.getProgramParameter(e,35718);for(let s=0;s<i;s++){const l=t.getActiveUniform(e,s);if(!l)throw new Error("activeInfo");const{name:h,size:a,type:v}=l,{name:T,isArray:C}=xK(h);let k=t.getUniformLocation(e,T);const L={location:k,name:T,size:a,type:v,isArray:C};if(r.push(L),L.size>1)for(let O=0;O<L.size;O++){const K=`${T}[${O}]`;k=t.getUniformLocation(e,K);const $={...L,name:K,location:k};r.push($)}}return r}function yK(t,e){const r=(l,h)=>t.getActiveUniformBlockParameter(e,l,h),i=[],s=t.getProgramParameter(e,35382);for(let l=0;l<s;l++){const h={name:t.getActiveUniformBlockName(e,l)||"",location:r(l,35391),byteLength:r(l,35392),vertex:r(l,35396),fragment:r(l,35398),uniformCount:r(l,35394),uniforms:[]},a=r(l,35395)||[],v=t.getActiveUniforms(e,a,35383),T=t.getActiveUniforms(e,a,35384),C=t.getActiveUniforms(e,a,35387),k=t.getActiveUniforms(e,a,35388);for(let L=0;L<h.uniformCount;++L){const O=t.getActiveUniform(e,a[L]);if(!O)throw new Error("activeInfo");h.uniforms.push({name:O.name,format:I4(v[L]).format,type:v[L],arrayLength:T[L],byteOffset:C[L],byteStride:k[L]})}i.push(h)}return i.sort((l,h)=>l.location-h.location),i}const vK={35678:["2d","float"],35680:["cube","float"],35679:["3d","float"],35682:["3d","depth"],36289:["2d-array","float"],36292:["2d-array","depth"],36293:["cube","float"],36298:["2d","sint"],36299:["3d","sint"],36300:["cube","sint"],36303:["2d-array","uint"],36306:["2d","uint"],36307:["3d","uint"],36308:["cube","uint"],36311:["2d-array","uint"]};function bK(t){const e=vK[t];if(!e)throw new Error("sampler");const[r,i]=e;return{viewDimension:r,sampleType:i}}function xK(t){if(t[t.length-1]!=="]")return{name:t,length:1,isArray:!1};const e=/([^[]*)(\[[0-9]+\])?/.exec(t);if(!e||e.length<2)throw new Error(`Failed to parse GLSL uniform name ${t}`);return{name:e[1],length:e[2]?1:0,isArray:!!e[2]}}function wK(t,e,r,i){const s=t;let l=i;l===!0&&(l=1),l===!1&&(l=0);const h=typeof l=="number"?[l]:l;switch(r){case 35678:case 35680:case 35679:case 35682:case 36289:case 36292:case 36293:case 36298:case 36299:case 36300:case 36303:case 36306:case 36307:case 36308:case 36311:if(typeof i!="number")throw new Error("samplers must be set to integers");return t.uniform1i(e,i);case 5126:return t.uniform1fv(e,h);case 35664:return t.uniform2fv(e,h);case 35665:return t.uniform3fv(e,h);case 35666:return t.uniform4fv(e,h);case 5124:return t.uniform1iv(e,h);case 35667:return t.uniform2iv(e,h);case 35668:return t.uniform3iv(e,h);case 35669:return t.uniform4iv(e,h);case 35670:return t.uniform1iv(e,h);case 35671:return t.uniform2iv(e,h);case 35672:return t.uniform3iv(e,h);case 35673:return t.uniform4iv(e,h);case 5125:return s.uniform1uiv(e,h,1);case 36294:return s.uniform2uiv(e,h,2);case 36295:return s.uniform3uiv(e,h,3);case 36296:return s.uniform4uiv(e,h,4);case 35674:return t.uniformMatrix2fv(e,!1,h);case 35675:return t.uniformMatrix3fv(e,!1,h);case 35676:return t.uniformMatrix4fv(e,!1,h);case 35685:return s.uniformMatrix2x3fv(e,!1,h);case 35686:return s.uniformMatrix2x4fv(e,!1,h);case 35687:return s.uniformMatrix3x2fv(e,!1,h);case 35688:return s.uniformMatrix3x4fv(e,!1,h);case 35689:return s.uniformMatrix4x2fv(e,!1,h);case 35690:return s.uniformMatrix4x3fv(e,!1,h)}throw new Error("Illegal uniform")}function EK(t){switch(t){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 3;case"line-loop-webgl":return 2;case"triangle-list":return 4;case"triangle-strip":return 5;case"triangle-fan-webgl":return 6;default:throw new Error(t)}}function AK(t){switch(t){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 1;case"line-loop-webgl":return 1;case"triangle-list":return 4;case"triangle-strip":return 4;case"triangle-fan-webgl":return 4;default:throw new Error(t)}}const RS=4;class TK extends ym{device;handle;vs;fs;introspectedLayout;uniforms={};bindings={};varyings=null;_uniformCount=0;_uniformSetters={};constructor(e,r){super(e,r),this.device=e,this.handle=this.props.handle||this.device.gl.createProgram(),this.device.setSpectorMetadata(this.handle,{id:this.props.id}),this.vs=r.vs,this.fs=r.fs;const{varyings:i,bufferMode:s=35981}=r;switch(i&&i.length>0&&(this.varyings=i,this.device.gl.transformFeedbackVaryings(this.handle,i,s)),this._linkShaders(),Ct.time(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.introspectedLayout=fK(this.device.gl,this.handle),Ct.timeEnd(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.shaderLayout=HG(this.introspectedLayout,r.shaderLayout),this.props.topology){case"triangle-fan-webgl":case"line-loop-webgl":Ct.warn(`Primitive topology ${this.props.topology} is deprecated and will be removed in v9.1`);break}}destroy(){this.handle&&(this.device.gl.deleteProgram(this.handle),this.destroyed=!0)}setBindings(e,r){for(const[i,s]of Object.entries(e)){const l=this.shaderLayout.bindings.find(h=>h.name===i)||this.shaderLayout.bindings.find(h=>h.name===`${i}Uniforms`);if(!l){const h=this.shaderLayout.bindings.map(a=>`"${a.name}"`).join(", ");r?.disableWarnings||Ct.warn(`Unknown binding "${i}" in render pipeline "${this.id}", expected one of ${h}`)();continue}switch(s||Ct.warn(`Unsetting binding "${i}" in render pipeline "${this.id}"`)(),l.type){case"uniform":if(!(s instanceof ad)&&!(s.buffer instanceof ad))throw new Error("buffer value");break;case"texture":if(!(s instanceof tm||s instanceof oc||s instanceof a_))throw new Error("texture value");break;case"sampler":Ct.warn(`Ignoring sampler ${i}`)();break;default:throw new Error(l.type)}this.bindings[i]=s}}draw(e){const{renderPass:r,parameters:i=this.props.parameters,topology:s=this.props.topology,vertexArray:l,vertexCount:h,instanceCount:a,isInstanced:v=!1,firstVertex:T=0,transformFeedback:C}=e,k=EK(s),L=!!l.indexBuffer,O=l.indexBuffer?.glIndexType;if(this.linkStatus!=="success")return Ct.info(2,`RenderPipeline:${this.id}.draw() aborted - waiting for shader linking`)(),!1;if(!this._areTexturesRenderable()||h===0)return Ct.info(2,`RenderPipeline:${this.id}.draw() aborted - textures not yet loaded`)(),!1;if(h===0)return Ct.info(2,`RenderPipeline:${this.id}.draw() aborted - no vertices to draw`)(),!0;this.device.gl.useProgram(this.handle),l.bindBeforeRender(r),C&&C.begin(this.props.topology),this._applyBindings(),this._applyUniforms();const K=r;return PX(this.device,i,K.glParameters,()=>{L&&v?this.device.gl.drawElementsInstanced(k,h||0,O,T,a||0):L?this.device.gl.drawElements(k,h||0,O,T):v?this.device.gl.drawArraysInstanced(k,T,h||0,a||0):this.device.gl.drawArrays(k,T,h||0),C&&C.end()}),l.unbindAfterRender(r),!0}setUniformsWebGL(e){const{bindings:r}=R2(e);Object.keys(r).forEach(i=>{Ct.warn(`Unsupported value "${JSON.stringify(r[i])}" used in setUniforms() for key ${i}. Use setBindings() instead?`)()}),Object.assign(this.uniforms,e)}async _linkShaders(){const{gl:e}=this.device;if(e.attachShader(this.handle,this.vs.handle),e.attachShader(this.handle,this.fs.handle),Ct.time(RS,`linkProgram for ${this.id}`)(),e.linkProgram(this.handle),Ct.timeEnd(RS,`linkProgram for ${this.id}`)(),Ct.level,!this.device.features.has("compilation-status-async-webgl")){const i=this._getLinkStatus();this._reportLinkStatus(i);return}Ct.once(1,"RenderPipeline linking is asynchronous")(),await this._waitForLinkComplete(),Ct.info(2,`RenderPipeline ${this.id} - async linking complete: ${this.linkStatus}`)();const r=this._getLinkStatus();this._reportLinkStatus(r)}_reportLinkStatus(e){switch(e){case"success":return;default:throw this.vs.compilationStatus==="error"?(this.vs.debugShader(),new Error(`Error during compilation of shader ${this.vs.id}`)):this.fs?.compilationStatus==="error"?(this.fs.debugShader(),new Error(`Error during compilation of shader ${this.fs.id}`)):new Error(`Error during ${e}: ${this.device.gl.getProgramInfoLog(this.handle)}`)}}_getLinkStatus(){const{gl:e}=this.device;return e.getProgramParameter(this.handle,35714)?(e.validateProgram(this.handle),e.getProgramParameter(this.handle,35715)?(this.linkStatus="success","success"):(this.linkStatus="error","validation")):(this.linkStatus="error","linking")}async _waitForLinkComplete(){const e=async i=>await new Promise(s=>setTimeout(s,i));if(!this.device.features.has("compilation-status-async-webgl")){await e(10);return}const{gl:r}=this.device;for(;;){if(r.getProgramParameter(this.handle,37297))return;await e(10)}}_areTexturesRenderable(){let e=!0;for(const[,r]of Object.entries(this.bindings))r instanceof oc&&(r.update(),e=e&&r.loaded);return e}_applyBindings(){if(this.linkStatus!=="success")return;const{gl:e}=this.device;e.useProgram(this.handle);let r=0,i=0;for(const s of this.shaderLayout.bindings){const l=this.bindings[s.name]||this.bindings[s.name.replace(/Uniforms$/,"")];if(!l)throw new Error(`No value for binding ${s.name} in ${this.id}`);switch(s.type){case"uniform":const{name:h}=s,a=e.getUniformBlockIndex(this.handle,h);if(a===4294967295)throw new Error(`Invalid uniform block name ${h}`);e.uniformBlockBinding(this.handle,i,a),l instanceof ad?e.bindBufferBase(35345,i,l.handle):e.bindBufferRange(35345,i,l.buffer.handle,l.offset||0,l.size||l.buffer.byteLength-l.offset),i+=1;break;case"texture":if(!(l instanceof tm||l instanceof oc||l instanceof a_))throw new Error("texture");let v;if(l instanceof tm)v=l.texture;else if(l instanceof oc)v=l;else if(l instanceof a_&&l.colorAttachments[0]instanceof tm)Ct.warn("Passing framebuffer in texture binding may be deprecated. Use fbo.colorAttachments[0] instead")(),v=l.colorAttachments[0].texture;else throw new Error("No texture");e.activeTexture(33984+r),e.bindTexture(v.target,v.handle),r+=1;break;case"sampler":break;case"storage":case"read-only-storage":throw new Error(`binding type '${s.type}' not supported in WebGL`)}}}_applyUniforms(){for(const e of this.shaderLayout.uniforms||[]){const{name:r,location:i,type:s,textureUnit:l}=e,h=this.uniforms[r]??l;h!==void 0&&wK(this.device.gl,i,s,h)}}}class SK extends S2{device;commands=[];constructor(e){super(e,{}),this.device=e}submitCommands(e=this.commands){for(const r of e)switch(r.name){case"copy-buffer-to-buffer":CK(this.device,r.options);break;case"copy-buffer-to-texture":MK(this.device,r.options);break;case"copy-texture-to-buffer":PK(this.device,r.options);break;case"copy-texture-to-texture":RK(this.device,r.options);break}}}function CK(t,e){const r=e.source,i=e.destination;t.gl.bindBuffer(36662,r.handle),t.gl.bindBuffer(36663,i.handle),t.gl.copyBufferSubData(36662,36663,e.sourceOffset??0,e.destinationOffset??0,e.size),t.gl.bindBuffer(36662,null),t.gl.bindBuffer(36663,null)}function MK(t,e){throw new Error("Not implemented")}function PK(t,e){const{source:r,mipLevel:i=0,aspect:s="all",width:l=e.source.width,height:h=e.source.height,depthOrArrayLayers:a=0,origin:v=[0,0],destination:T,byteOffset:C=0,bytesPerRow:k,rowsPerImage:L}=e;if(s!=="all")throw new Error("not supported");if(i!==0||a!==0||k||L)throw new Error("not implemented");const{framebuffer:O,destroyFramebuffer:K}=k4(r);let $;try{const ne=T,oe=l||O.width,fe=h||O.height,ue=J0(O.texture.props.format),we=ue.dataFormat,De=ue.type;t.gl.bindBuffer(35051,ne.handle),$=t.gl.bindFramebuffer(36160,O.handle),t.gl.readPixels(v[0],v[1],oe,fe,we,De,C)}finally{t.gl.bindBuffer(35051,null),$!==void 0&&t.gl.bindFramebuffer(36160,$),K&&O.destroy()}}function RK(t,e){const{source:r,destinationMipLevel:i=0,origin:s=[0,0],destinationOrigin:l=[0,0],destination:h}=e;let{width:a=e.destination.width,height:v=e.destination.height}=e;const{framebuffer:T,destroyFramebuffer:C}=k4(r),[k,L]=s,[O,K,$]=l,ne=t.gl.bindFramebuffer(36160,T.handle);let oe=null,fe;if(h instanceof oc)oe=h,a=Number.isFinite(a)?a:oe.width,v=Number.isFinite(v)?v:oe.height,oe.bind(0),fe=oe.target;else throw new Error("invalid destination");switch(fe){case 3553:case 34067:t.gl.copyTexSubImage2D(fe,i,O,K,k,L,a,v);break;case 35866:case 32879:t.gl.copyTexSubImage3D(fe,i,O,K,$,k,L,a,v);break}oe&&oe.unbind(),t.gl.bindFramebuffer(36160,ne),C&&T.destroy()}function k4(t){if(t instanceof Va){const{width:e,height:r,id:i}=t;return{framebuffer:t.device.createFramebuffer({id:`framebuffer-for-${i}`,width:e,height:r,colorAttachments:[t]}),destroyFramebuffer:!0}}return{framebuffer:t,destroyFramebuffer:!1}}class IK extends T2{device;commandBuffer;constructor(e,r){super(e,r),this.device=e,this.commandBuffer=new SK(e)}destroy(){}finish(){this.commandBuffer.submitCommands()}copyBufferToBuffer(e){this.commandBuffer.commands.push({name:"copy-buffer-to-buffer",options:e})}copyBufferToTexture(e){this.commandBuffer.commands.push({name:"copy-buffer-to-texture",options:e})}copyTextureToBuffer(e){this.commandBuffer.commands.push({name:"copy-texture-to-buffer",options:e})}copyTextureToTexture(e){this.commandBuffer.commands.push({name:"copy-texture-to-texture",options:e})}pushDebugGroup(e){}popDebugGroup(){}insertDebugMarker(e){}resolveQuerySet(e,r,i){}}class Q2 extends C2{get[Symbol.toStringTag](){return"VertexArray"}device;handle;buffer=null;bufferValue=null;static isConstantAttributeZeroSupported(e){return U7()==="Chrome"}constructor(e,r){super(e,r),this.device=e,this.handle=this.device.gl.createVertexArray()}destroy(){super.destroy(),this.buffer&&this.buffer?.destroy(),this.handle&&(this.device.gl.deleteVertexArray(this.handle),this.handle=void 0)}setIndexBuffer(e){const r=e;if(r&&r.glTarget!==34963)throw new Error("Use .setBuffer()");this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34963,r?r.handle:null),this.indexBuffer=r,this.device.gl.bindVertexArray(null)}setBuffer(e,r){const i=r;if(i.glTarget===34963)throw new Error("Use .setIndexBuffer()");const{size:s,type:l,stride:h,offset:a,normalized:v,integer:T,divisor:C}=this._getAccessor(e);this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34962,i.handle),T?this.device.gl.vertexAttribIPointer(e,s,l,h,a):this.device.gl.vertexAttribPointer(e,s,l,v,h,a),this.device.gl.bindBuffer(34962,null),this.device.gl.enableVertexAttribArray(e),this.device.gl.vertexAttribDivisor(e,C||0),this.attributes[e]=i,this.device.gl.bindVertexArray(null)}setConstantWebGL(e,r){this._enable(e,!1),this.attributes[e]=r}bindBeforeRender(){this.device.gl.bindVertexArray(this.handle),this._applyConstantAttributes()}unbindAfterRender(){this.device.gl.bindVertexArray(null)}_applyConstantAttributes(){for(let e=0;e<this.maxVertexAttributes;++e){const r=this.attributes[e];ArrayBuffer.isView(r)&&this.device.setConstantAttributeWebGL(e,r)}}_getAccessor(e){const r=this.attributeInfos[e];if(!r)throw new Error(`Unknown attribute location ${e}`);const i=T4(r.bufferDataType);return{size:r.bufferComponents,type:i,stride:r.byteStride,offset:r.byteOffset,normalized:r.normalized,integer:r.integer,divisor:r.stepMode==="instance"?1:0}}_enable(e,r=!0){const i=Q2.isConstantAttributeZeroSupported(this.device)||e!==0;(r||i)&&(e=Number(e),this.device.gl.bindVertexArray(this.handle),r?this.device.gl.enableVertexAttribArray(e):this.device.gl.disableVertexAttribArray(e),this.device.gl.bindVertexArray(null))}getConstantBuffer(e,r){const i=kK(r),s=i.byteLength*e,l=i.length*e;if(this.buffer&&s!==this.buffer.byteLength)throw new Error(`Buffer size is immutable, byte length ${s} !== ${this.buffer.byteLength}.`);let h=!this.buffer;if(this.buffer=this.buffer||this.device.createBuffer({byteLength:s}),h=h||!BK(i,this.bufferValue),h){const a=ZG(r.constructor,l);XG({target:a,source:i,start:0,count:l}),this.buffer.write(a),this.bufferValue=r}return this.buffer}}function kK(t){return Array.isArray(t)?new Float32Array(t):t}function BK(t,e){if(!t||!e||t.length!==e.length||t.constructor!==e.constructor)return!1;for(let r=0;r<t.length;++r)if(t[r]!==e[r])return!1;return!0}class LK extends M2{device;gl;handle;layout;buffers={};unusedBuffers={};bindOnUse=!0;_bound=!1;constructor(e,r){super(e,r),this.device=e,this.gl=e.gl,this.handle=this.props.handle||this.gl.createTransformFeedback(),this.layout=this.props.layout,r.buffers&&this.setBuffers(r.buffers),Object.seal(this)}destroy(){this.gl.deleteTransformFeedback(this.handle),super.destroy()}begin(e="point-list"){this.gl.bindTransformFeedback(36386,this.handle),this.bindOnUse&&this._bindBuffers(),this.gl.beginTransformFeedback(AK(e))}end(){this.gl.endTransformFeedback(),this.bindOnUse&&this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null)}setBuffers(e){this.buffers={},this.unusedBuffers={},this.bind(()=>{for(const r in e)this.setBuffer(r,e[r])})}setBuffer(e,r){const i=this._getVaryingIndex(e),{buffer:s,byteLength:l,byteOffset:h}=this._getBufferRange(r);if(i<0){this.unusedBuffers[e]=s,Ct.warn(`${this.id} unusedBuffers varying buffer ${e}`)();return}this.buffers[i]={buffer:s,byteLength:l,byteOffset:h},this.bindOnUse||this._bindBuffer(i,s,h,l)}getBuffer(e){if(IS(e))return this.buffers[e]||null;const r=this._getVaryingIndex(e);return r>=0?this.buffers[r]:null}bind(e=this.handle){if(typeof e!="function")return this.gl.bindTransformFeedback(36386,e),this;let r;return this._bound?r=e():(this.gl.bindTransformFeedback(36386,this.handle),this._bound=!0,r=e(),this._bound=!1,this.gl.bindTransformFeedback(36386,null)),r}unbind(){this.bind(null)}_getBufferRange(e){if(e instanceof ad)return{buffer:e,byteOffset:0,byteLength:e.byteLength};const{buffer:r,byteOffset:i=0,byteLength:s=e.buffer.byteLength}=e;return{buffer:r,byteOffset:i,byteLength:s}}_getVaryingIndex(e){if(IS(e))return Number(e);for(const r of this.layout.varyings)if(e===r.name)return r.location;return-1}_bindBuffers(){for(const e in this.buffers){const{buffer:r,byteLength:i,byteOffset:s}=this._getBufferRange(this.buffers[e]);this._bindBuffer(Number(e),r,s,i)}}_unbindBuffers(){for(const e in this.buffers)this.gl.bindBufferBase(35982,Number(e),null)}_bindBuffer(e,r,i=0,s){const l=r&&r.handle;!l||s===void 0?this.gl.bindBufferBase(35982,e,l):this.gl.bindBufferRange(35982,e,l,i,s)}}function IS(t){return typeof t=="number"?Number.isInteger(t):/^\d+$/.test(t)}class DK extends P2{device;handle;target=null;_queryPending=!1;_pollingPromise=null;get[Symbol.toStringTag](){return"Query"}constructor(e,r){if(super(e,r),this.device=e,r.count>1)throw new Error("WebGL QuerySet can only have one value");this.handle=this.device.gl.createQuery(),Object.seal(this)}destroy(){this.device.gl.deleteQuery(this.handle)}beginTimestampQuery(){return this._begin(35007)}endTimestampQuery(){this._end()}beginOcclusionQuery(e){return this._begin(e?.conservative?36202:35887)}endOcclusionQuery(){this._end()}beginTransformFeedbackQuery(){return this._begin(35976)}endTransformFeedbackQuery(){this._end()}async resolveQuery(){return[await this.pollQuery()]}_begin(e){this._queryPending||(this.target=e,this.device.gl.beginQuery(this.target,this.handle))}_end(){this._queryPending||this.target&&(this.device.gl.endQuery(this.target),this.target=null,this._queryPending=!0)}isResultAvailable(){if(!this._queryPending)return!1;const e=this.device.gl.getQueryParameter(this.handle,34919);return e&&(this._queryPending=!1),e}isTimerDisjoint(){return this.device.gl.getParameter(36795)}getResult(){return this.device.gl.getQueryParameter(this.handle,34918)}getTimerMilliseconds(){return this.getResult()/1e6}pollQuery(e=Number.POSITIVE_INFINITY){if(this._pollingPromise)return this._pollingPromise;let r=0;return this._pollingPromise=new Promise((i,s)=>{const l=()=>{this.isResultAvailable()?(i(this.getResult()),this._pollingPromise=null):r++>e?(s("Timed out"),this._pollingPromise=null):requestAnimationFrame(l)};requestAnimationFrame(l)}),this._pollingPromise}}function B4(t){switch(t){case 6406:case 33326:case 6403:return 1;case 33328:case 33319:return 2;case 6407:case 34837:return 3;case 6408:case 34836:return 4;default:return fi(!1),0}}function NK(t){switch(t){case 5121:return 1;case 33635:case 32819:case 32820:return 2;case 5126:return 4;default:return fi(!1),0}}function OK(t,e){const{sourceX:r=0,sourceY:i=0,sourceFormat:s=6408,sourceAttachment:l=36064}=e||{};let{target:h=null,sourceWidth:a,sourceHeight:v,sourceType:T}=e||{};const{framebuffer:C,deleteFramebuffer:k}=L4(t);fi(C);const{gl:L,handle:O}=C;a=a||C.width,v=v||C.height;const K=l-36064;T=T||C.colorAttachments[K]?.texture?.type||5121,h=UK(h,T,s,a,v),T=T||lK(h);const $=L.bindFramebuffer(36160,O);return L.readPixels(r,i,a,v,s,T,h),L.bindFramebuffer(36160,$||null),k&&C.destroy(),h}function FK(t,e){const{target:r,sourceX:i=0,sourceY:s=0,sourceFormat:l=6408,targetByteOffset:h=0}=e||{};let{sourceWidth:a,sourceHeight:v,sourceType:T}=e||{};const{framebuffer:C,deleteFramebuffer:k}=L4(t);fi(C),a=a||C.width,v=v||C.height;const L=C;T=T||5121;let O=r;if(!O){const $=B4(l),ne=NK(T),oe=h+a*v*$*ne;O=L.device.createBuffer({byteLength:oe})}const K=t.device.createCommandEncoder();return K.copyTextureToBuffer({source:t,width:a,height:v,origin:[i,s],destination:O,byteOffset:h}),K.destroy(),k&&C.destroy(),O}function L4(t){return t instanceof T1?{framebuffer:t,deleteFramebuffer:!1}:{framebuffer:zK(t),deleteFramebuffer:!0}}function zK(t,e){const{device:r,width:i,height:s,id:l}=t;return r.createFramebuffer({...e,id:`framebuffer-for-${l}`,width:i,height:s,colorAttachments:[t]})}function UK(t,e,r,i,s){if(t)return t;e=e||5121;const l=Hx(e,{clamped:!1}),h=B4(r);return new l(i*s*h)}const jK=256,VK=1024,GK=16384,HK="clear: bad arguments";function WK(t,e){const{framebuffer:r=null,color:i=null,depth:s=null,stencil:l=null}=e||{},h={};r&&(h.framebuffer=r);let a=0;i&&(a|=GK,i!==!0&&(h.clearColor=i)),s&&(a|=jK,s!==!0&&(h.clearDepth=s)),l&&(a|=VK,s!==!0&&(h.clearStencil=s)),fi(a!==0,HK);const v=t.gl;nd(v,h,()=>{v.clear(a)})}const Og=1;class sd extends _m{static type="webgl";type="webgl";handle;features;limits;info;canvasContext;lost;_resolveContextLost;static isSupported(){return typeof WebGL2RenderingContext<"u"}static attach(e){if(e instanceof sd)return e;if(e?.device instanceof _m)return e.device;if(!qK(e))throw new Error("Invalid WebGL2RenderingContext");return new sd({gl:e})}static async create(e={}){Ct.groupCollapsed(Og,"WebGLDevice created")();const r=[];e.debug&&r.push(ZX()),e.spector&&r.push(WX()),typeof e.canvas=="string"&&r.push(b5.pageLoaded);const i=await Promise.allSettled(r);for(const h of i)h.status==="rejected"&&Ct.error(`Failed to initialize debug libraries ${h.reason}`)();if(Ct.probe(Og+1,"DOM is loaded")(),e.gl?.device)return Ct.warn("reattaching existing device")(),sd.attach(e.gl);const s=new sd(e),l=`Created ${s.type}${s.debug?" debug":""} context: ${s.info.vendor}, ${s.info.renderer} for canvas: ${s.canvasContext.id}`;return Ct.probe(Og,l)(),Ct.table(Og,s.info)(),Ct.groupEnd(Og)(),s}constructor(e){super({...e,id:e.id||yd("webgl-device")});const r=e.gl?.device;if(r)throw new Error(`WebGL context already attached to device ${r.id}`);const i=e.gl?.canvas||e.canvas;this.canvasContext=new jX(this,{...e,canvas:i}),this.lost=new Promise(a=>{this._resolveContextLost=a});let s=e.gl||null;if(s||=oX(this.canvasContext.canvas,{...e,onContextLost:a=>this._resolveContextLost?.({reason:"destroyed",message:"Entered sleep mode, or too many apps or browser tabs are using the GPU."})}),!s)throw new Error("WebGL context creation failed");this.handle=s,this.gl=s,this.gl.device=this,this.gl._version=2,e.spector&&(this.spectorJS=qX({...this.props,canvas:this.handle.canvas})),this.info=aX(this.gl,this._extensions),this.limits=new CX(this.gl),this.features=new SX(this.gl,this._extensions,this.props.disabledFeatures),this.props.initalizeFeatures&&this.features.initializeFeatures(),this.canvasContext.resize();const{enable:l=!0,copyState:h=!1}=e;E4(this.gl,{enable:l,copyState:h}),e.debug&&(this.gl=XX(this.gl,{...e,throwOnError:!0}),this.debug=!0,Ct.level=Math.max(Ct.level,1),Ct.warn("WebGL debug mode activated. Performance reduced.")())}destroy(){}get isLost(){return this.gl.isContextLost()}getSize(){return[this.gl.drawingBufferWidth,this.gl.drawingBufferHeight]}isTextureFormatSupported(e){return J2(this.gl,e,this._extensions)}isTextureFormatFilterable(e){return wX(this.gl,e,this._extensions)}isTextureFormatRenderable(e){return EX(this.gl,e,this._extensions)}createCanvasContext(e){throw new Error("WebGL only supports a single canvas")}createBuffer(e){const r=this._getBufferProps(e);return new ad(this,r)}_createTexture(e){return new oc(this,e)}createExternalTexture(e){throw new Error("createExternalTexture() not implemented")}createSampler(e){return new Gx(this,e)}createShader(e){return new tK(this,e)}createFramebuffer(e){return new a_(this,e)}createVertexArray(e){return new Q2(this,e)}createTransformFeedback(e){return new LK(this,e)}createQuerySet(e){return new DK(this,e)}createRenderPipeline(e){return new TK(this,e)}beginRenderPass(e){return new oK(this,e)}createComputePipeline(e){throw new Error("ComputePipeline not supported in WebGL")}beginComputePass(e){throw new Error("ComputePass not supported in WebGL")}renderPass=null;createCommandEncoder(e){return new IK(this,e)}submit(){this.renderPass?.end(),this.renderPass=null}readPixelsToArrayWebGL(e,r){return OK(e,r)}readPixelsToBufferWebGL(e,r){return FK(e,r)}setParametersWebGL(e){Om(this.gl,e)}getParametersWebGL(e){return w4(this.gl,e)}withParametersWebGL(e,r){return nd(this.gl,e,r)}clearWebGL(e){WK(this,e)}resetWebGL(){Ct.warn("WebGLDevice.resetWebGL is deprecated, use only for debugging")(),QZ(this.gl)}gl;debug=!1;_canvasSizeInfo={clientWidth:0,clientHeight:0,devicePixelRatio:1};_extensions={};_polyfilled=!1;spectorJS;loseDevice(){let e=!1;const r=this.getExtension("WEBGL_lose_context").WEBGL_lose_context;return r&&(e=!0,r.loseContext()),this._resolveContextLost?.({reason:"destroyed",message:"Application triggered context loss"}),e}pushState(){C1(this.gl)}popState(){w_(this.gl)}setSpectorMetadata(e,r){e.__SPECTOR_Metadata=r}getGLKey(e,r){r=r||this.gl2||this.gl;const i=Number(e);for(const s in r)if(r[s]===i)return`GL.${s}`;return String(e)}_constants;setConstantAttributeWebGL(e,r){const i=this.limits.maxVertexAttributes;this._constants=this._constants||new Array(i).fill(null);const s=this._constants[e];switch(s&&KK(s,r)&&Ct.info(1,`setConstantAttributeWebGL(${e}) could have been skipped, value unchanged`)(),this._constants[e]=r,r.constructor){case Float32Array:$K(this,e,r);break;case Int32Array:ZK(this,e,r);break;case Uint32Array:XK(this,e,r);break;default:fi(!1)}}getExtension(e){return fd(this.gl,e,this._extensions),this._extensions}}function qK(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:!!(t&&Number.isFinite(t._version))}function $K(t,e,r){switch(r.length){case 1:t.gl.vertexAttrib1fv(e,r);break;case 2:t.gl.vertexAttrib2fv(e,r);break;case 3:t.gl.vertexAttrib3fv(e,r);break;case 4:t.gl.vertexAttrib4fv(e,r);break;default:fi(!1)}}function ZK(t,e,r){t.gl.vertexAttribI4iv(e,r)}function XK(t,e,r){t.gl.vertexAttribI4uiv(e,r)}function KK(t,e){if(!t||!e||t.length!==e.length||t.constructor!==e.constructor)return!1;for(let r=0;r<t.length;++r)if(t[r]!==e[r])return!1;return!0}var kS={exports:{}};/*! Hammer.JS - v2.0.7 - 2016-04-22
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */var BS;function YK(){return BS||(BS=1,(function(t){(function(e,r,i,s){var l=["","webkit","Moz","MS","ms","o"],h=r.createElement("div"),a="function",v=Math.round,T=Math.abs,C=Date.now;function k(ie,ce,Ce){return setTimeout(ue(ie,Ce),ce)}function L(ie,ce,Ce){return Array.isArray(ie)?(O(ie,Ce[ce],Ce),!0):!1}function O(ie,ce,Ce){var He;if(ie)if(ie.forEach)ie.forEach(ce,Ce);else if(ie.length!==s)for(He=0;He<ie.length;)ce.call(Ce,ie[He],He,ie),He++;else for(He in ie)ie.hasOwnProperty(He)&&ce.call(Ce,ie[He],He,ie)}function K(ie,ce,Ce){var He="DEPRECATED METHOD: "+ce+`
`+Ce+` AT 
`;return function(){var mt=new Error("get-stack-trace"),Xt=mt&&mt.stack?mt.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",xr=e.console&&(e.console.warn||e.console.log);return xr&&xr.call(e.console,He,Xt),ie.apply(this,arguments)}}var $;typeof Object.assign!="function"?$=function(ie){if(ie===s||ie===null)throw new TypeError("Cannot convert undefined or null to object");for(var ce=Object(ie),Ce=1;Ce<arguments.length;Ce++){var He=arguments[Ce];if(He!==s&&He!==null)for(var mt in He)He.hasOwnProperty(mt)&&(ce[mt]=He[mt])}return ce}:$=Object.assign;var ne=K(function(ie,ce,Ce){for(var He=Object.keys(ce),mt=0;mt<He.length;)(!Ce||Ce&&ie[He[mt]]===s)&&(ie[He[mt]]=ce[He[mt]]),mt++;return ie},"extend","Use `assign`."),oe=K(function(ie,ce){return ne(ie,ce,!0)},"merge","Use `assign`.");function fe(ie,ce,Ce){var He=ce.prototype,mt;mt=ie.prototype=Object.create(He),mt.constructor=ie,mt._super=He,Ce&&$(mt,Ce)}function ue(ie,ce){return function(){return ie.apply(ce,arguments)}}function we(ie,ce){return typeof ie==a?ie.apply(ce&&ce[0]||s,ce):ie}function De(ie,ce){return ie===s?ce:ie}function Fe(ie,ce,Ce){O(lt(ce),function(He){ie.addEventListener(He,Ce,!1)})}function Ke(ie,ce,Ce){O(lt(ce),function(He){ie.removeEventListener(He,Ce,!1)})}function ze(ie,ce){for(;ie;){if(ie==ce)return!0;ie=ie.parentNode}return!1}function it(ie,ce){return ie.indexOf(ce)>-1}function lt(ie){return ie.trim().split(/\s+/g)}function ht(ie,ce,Ce){if(ie.indexOf&&!Ce)return ie.indexOf(ce);for(var He=0;He<ie.length;){if(Ce&&ie[He][Ce]==ce||!Ce&&ie[He]===ce)return He;He++}return-1}function vt(ie){return Array.prototype.slice.call(ie,0)}function Nt(ie,ce,Ce){for(var He=[],mt=[],Xt=0;Xt<ie.length;){var xr=ie[Xt][ce];ht(mt,xr)<0&&He.push(ie[Xt]),mt[Xt]=xr,Xt++}return He=He.sort(function(Gr,ar){return Gr[ce]>ar[ce]}),He}function Lt(ie,ce){for(var Ce,He,mt=ce[0].toUpperCase()+ce.slice(1),Xt=0;Xt<l.length;){if(Ce=l[Xt],He=Ce?Ce+mt:ce,He in ie)return He;Xt++}return s}var qt=1;function Qt(){return qt++}function Ot(ie){var ce=ie.ownerDocument||ie;return ce.defaultView||ce.parentWindow||e}var tt=/mobile|tablet|ip(ad|hone|od)|android/i,wt="ontouchstart"in e,Bt=Lt(e,"PointerEvent")!==s,Ue=wt&&tt.test(navigator.userAgent),dt="touch",Gt="pen",Jt="mouse",Tr="kinect",gr=25,Ht=1,dr=2,er=4,Lr=8,yn=1,yi=2,qr=4,ri=8,vn=16,Li=yi|qr,Mn=ri|vn,bs=Li|Mn,Yn=["x","y"],Jn=["clientX","clientY"];function mi(ie,ce){var Ce=this;this.manager=ie,this.callback=ce,this.element=ie.element,this.target=ie.options.inputTarget,this.domHandler=function(He){we(ie.options.enable,[ie])&&Ce.handler(He)},this.init()}mi.prototype={handler:function(){},init:function(){this.evEl&&Fe(this.element,this.evEl,this.domHandler),this.evTarget&&Fe(this.target,this.evTarget,this.domHandler),this.evWin&&Fe(Ot(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&Ke(this.element,this.evEl,this.domHandler),this.evTarget&&Ke(this.target,this.evTarget,this.domHandler),this.evWin&&Ke(Ot(this.element),this.evWin,this.domHandler)}};function Js(ie){var ce,Ce=ie.options.inputClass;return Ce?ce=Ce:Bt?ce=or:Ue?ce=Er:wt?ce=Ci:ce=nt,new ce(ie,_o)}function _o(ie,ce,Ce){var He=Ce.pointers.length,mt=Ce.changedPointers.length,Xt=ce&Ht&&He-mt===0,xr=ce&(er|Lr)&&He-mt===0;Ce.isFirst=!!Xt,Ce.isFinal=!!xr,Xt&&(ie.session={}),Ce.eventType=ce,Go(ie,Ce),ie.emit("hammer.input",Ce),ie.recognize(Ce),ie.session.prevInput=Ce}function Go(ie,ce){var Ce=ie.session,He=ce.pointers,mt=He.length;Ce.firstInput||(Ce.firstInput=Ds(ce)),mt>1&&!Ce.firstMultiple?Ce.firstMultiple=Ds(ce):mt===1&&(Ce.firstMultiple=!1);var Xt=Ce.firstInput,xr=Ce.firstMultiple,Gr=xr?xr.center:Xt.center,ar=ce.center=Qs(He);ce.timeStamp=C(),ce.deltaTime=ce.timeStamp-Xt.timeStamp,ce.angle=ae(Gr,ar),ce.distance=ee(Gr,ar),yo(Ce,ce),ce.offsetDirection=Q(ce.deltaX,ce.deltaY);var xi=ke(ce.deltaTime,ce.deltaX,ce.deltaY);ce.overallVelocityX=xi.x,ce.overallVelocityY=xi.y,ce.overallVelocity=T(xi.x)>T(xi.y)?xi.x:xi.y,ce.scale=xr?Se(xr.pointers,He):1,ce.rotation=xr?be(xr.pointers,He):0,ce.maxPointers=Ce.prevInput?ce.pointers.length>Ce.prevInput.maxPointers?ce.pointers.length:Ce.prevInput.maxPointers:ce.pointers.length,vo(Ce,ce);var Oi=ie.element;ze(ce.srcEvent.target,Oi)&&(Oi=ce.srcEvent.target),ce.target=Oi}function yo(ie,ce){var Ce=ce.center,He=ie.offsetDelta||{},mt=ie.prevDelta||{},Xt=ie.prevInput||{};(ce.eventType===Ht||Xt.eventType===er)&&(mt=ie.prevDelta={x:Xt.deltaX||0,y:Xt.deltaY||0},He=ie.offsetDelta={x:Ce.x,y:Ce.y}),ce.deltaX=mt.x+(Ce.x-He.x),ce.deltaY=mt.y+(Ce.y-He.y)}function vo(ie,ce){var Ce=ie.lastInterval||ce,He=ce.timeStamp-Ce.timeStamp,mt,Xt,xr,Gr;if(ce.eventType!=Lr&&(He>gr||Ce.velocity===s)){var ar=ce.deltaX-Ce.deltaX,xi=ce.deltaY-Ce.deltaY,Oi=ke(He,ar,xi);Xt=Oi.x,xr=Oi.y,mt=T(Oi.x)>T(Oi.y)?Oi.x:Oi.y,Gr=Q(ar,xi),ie.lastInterval=ce}else mt=Ce.velocity,Xt=Ce.velocityX,xr=Ce.velocityY,Gr=Ce.direction;ce.velocity=mt,ce.velocityX=Xt,ce.velocityY=xr,ce.direction=Gr}function Ds(ie){for(var ce=[],Ce=0;Ce<ie.pointers.length;)ce[Ce]={clientX:v(ie.pointers[Ce].clientX),clientY:v(ie.pointers[Ce].clientY)},Ce++;return{timeStamp:C(),pointers:ce,center:Qs(ce),deltaX:ie.deltaX,deltaY:ie.deltaY}}function Qs(ie){var ce=ie.length;if(ce===1)return{x:v(ie[0].clientX),y:v(ie[0].clientY)};for(var Ce=0,He=0,mt=0;mt<ce;)Ce+=ie[mt].clientX,He+=ie[mt].clientY,mt++;return{x:v(Ce/ce),y:v(He/ce)}}function ke(ie,ce,Ce){return{x:ce/ie||0,y:Ce/ie||0}}function Q(ie,ce){return ie===ce?yn:T(ie)>=T(ce)?ie<0?yi:qr:ce<0?ri:vn}function ee(ie,ce,Ce){Ce||(Ce=Yn);var He=ce[Ce[0]]-ie[Ce[0]],mt=ce[Ce[1]]-ie[Ce[1]];return Math.sqrt(He*He+mt*mt)}function ae(ie,ce,Ce){Ce||(Ce=Yn);var He=ce[Ce[0]]-ie[Ce[0]],mt=ce[Ce[1]]-ie[Ce[1]];return Math.atan2(mt,He)*180/Math.PI}function be(ie,ce){return ae(ce[1],ce[0],Jn)+ae(ie[1],ie[0],Jn)}function Se(ie,ce){return ee(ce[0],ce[1],Jn)/ee(ie[0],ie[1],Jn)}var Oe={mousedown:Ht,mousemove:dr,mouseup:er},Ze="mousedown",Be="mousemove mouseup";function nt(){this.evEl=Ze,this.evWin=Be,this.pressed=!1,mi.apply(this,arguments)}fe(nt,mi,{handler:function(ie){var ce=Oe[ie.type];ce&Ht&&ie.button===0&&(this.pressed=!0),ce&dr&&ie.which!==1&&(ce=er),this.pressed&&(ce&er&&(this.pressed=!1),this.callback(this.manager,ce,{pointers:[ie],changedPointers:[ie],pointerType:Jt,srcEvent:ie}))}});var pt={pointerdown:Ht,pointermove:dr,pointerup:er,pointercancel:Lr,pointerout:Lr},at={2:dt,3:Gt,4:Jt,5:Tr},Ft="pointerdown",Le="pointermove pointerup pointercancel";e.MSPointerEvent&&!e.PointerEvent&&(Ft="MSPointerDown",Le="MSPointerMove MSPointerUp MSPointerCancel");function or(){this.evEl=Ft,this.evWin=Le,mi.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}fe(or,mi,{handler:function(ie){var ce=this.store,Ce=!1,He=ie.type.toLowerCase().replace("ms",""),mt=pt[He],Xt=at[ie.pointerType]||ie.pointerType,xr=Xt==dt,Gr=ht(ce,ie.pointerId,"pointerId");mt&Ht&&(ie.button===0||xr)?Gr<0&&(ce.push(ie),Gr=ce.length-1):mt&(er|Lr)&&(Ce=!0),!(Gr<0)&&(ce[Gr]=ie,this.callback(this.manager,mt,{pointers:ce,changedPointers:[ie],pointerType:Xt,srcEvent:ie}),Ce&&ce.splice(Gr,1))}});var Sr={touchstart:Ht,touchmove:dr,touchend:er,touchcancel:Lr},Wt="touchstart",_r="touchstart touchmove touchend touchcancel";function $r(){this.evTarget=Wt,this.evWin=_r,this.started=!1,mi.apply(this,arguments)}fe($r,mi,{handler:function(ie){var ce=Sr[ie.type];if(ce===Ht&&(this.started=!0),!!this.started){var Ce=Si.call(this,ie,ce);ce&(er|Lr)&&Ce[0].length-Ce[1].length===0&&(this.started=!1),this.callback(this.manager,ce,{pointers:Ce[0],changedPointers:Ce[1],pointerType:dt,srcEvent:ie})}}});function Si(ie,ce){var Ce=vt(ie.touches),He=vt(ie.changedTouches);return ce&(er|Lr)&&(Ce=Nt(Ce.concat(He),"identifier")),[Ce,He]}var Di={touchstart:Ht,touchmove:dr,touchend:er,touchcancel:Lr},ui="touchstart touchmove touchend touchcancel";function Er(){this.evTarget=ui,this.targetIds={},mi.apply(this,arguments)}fe(Er,mi,{handler:function(ie){var ce=Di[ie.type],Ce=Pr.call(this,ie,ce);Ce&&this.callback(this.manager,ce,{pointers:Ce[0],changedPointers:Ce[1],pointerType:dt,srcEvent:ie})}});function Pr(ie,ce){var Ce=vt(ie.touches),He=this.targetIds;if(ce&(Ht|dr)&&Ce.length===1)return He[Ce[0].identifier]=!0,[Ce,Ce];var mt,Xt,xr=vt(ie.changedTouches),Gr=[],ar=this.target;if(Xt=Ce.filter(function(xi){return ze(xi.target,ar)}),ce===Ht)for(mt=0;mt<Xt.length;)He[Xt[mt].identifier]=!0,mt++;for(mt=0;mt<xr.length;)He[xr[mt].identifier]&&Gr.push(xr[mt]),ce&(er|Lr)&&delete He[xr[mt].identifier],mt++;if(Gr.length)return[Nt(Xt.concat(Gr),"identifier"),Gr]}var Ni=2500,_t=25;function Ci(){mi.apply(this,arguments);var ie=ue(this.handler,this);this.touch=new Er(this.manager,ie),this.mouse=new nt(this.manager,ie),this.primaryTouch=null,this.lastTouches=[]}fe(Ci,mi,{handler:function(ie,ce,Ce){var He=Ce.pointerType==dt,mt=Ce.pointerType==Jt;if(!(mt&&Ce.sourceCapabilities&&Ce.sourceCapabilities.firesTouchEvents)){if(He)si.call(this,ce,Ce);else if(mt&&Ha.call(this,Ce))return;this.callback(ie,ce,Ce)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function si(ie,ce){ie&Ht?(this.primaryTouch=ce.changedPointers[0].identifier,Ns.call(this,ce)):ie&(er|Lr)&&Ns.call(this,ce)}function Ns(ie){var ce=ie.changedPointers[0];if(ce.identifier===this.primaryTouch){var Ce={x:ce.clientX,y:ce.clientY};this.lastTouches.push(Ce);var He=this.lastTouches,mt=function(){var Xt=He.indexOf(Ce);Xt>-1&&He.splice(Xt,1)};setTimeout(mt,Ni)}}function Ha(ie){for(var ce=ie.srcEvent.clientX,Ce=ie.srcEvent.clientY,He=0;He<this.lastTouches.length;He++){var mt=this.lastTouches[He],Xt=Math.abs(ce-mt.x),xr=Math.abs(Ce-mt.y);if(Xt<=_t&&xr<=_t)return!0}return!1}var Tt=Lt(h.style,"touchAction"),Cr=Tt!==s,cr="compute",Hi="auto",eo="manipulation",Un="none",hr="pan-x",bo="pan-y",xs=Wa();function ha(ie,ce){this.manager=ie,this.set(ce)}ha.prototype={set:function(ie){ie==cr&&(ie=this.compute()),Cr&&this.manager.element.style&&xs[ie]&&(this.manager.element.style[Tt]=ie),this.actions=ie.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var ie=[];return O(this.manager.recognizers,function(ce){we(ce.options.enable,[ce])&&(ie=ie.concat(ce.getTouchAction()))}),to(ie.join(" "))},preventDefaults:function(ie){var ce=ie.srcEvent,Ce=ie.offsetDirection;if(this.manager.session.prevented){ce.preventDefault();return}var He=this.actions,mt=it(He,Un)&&!xs[Un],Xt=it(He,bo)&&!xs[bo],xr=it(He,hr)&&!xs[hr];if(mt){var Gr=ie.pointers.length===1,ar=ie.distance<2,xi=ie.deltaTime<250;if(Gr&&ar&&xi)return}if(!(xr&&Xt)&&(mt||Xt&&Ce&Li||xr&&Ce&Mn))return this.preventSrc(ce)},preventSrc:function(ie){this.manager.session.prevented=!0,ie.preventDefault()}};function to(ie){if(it(ie,Un))return Un;var ce=it(ie,hr),Ce=it(ie,bo);return ce&&Ce?Un:ce||Ce?ce?hr:bo:it(ie,eo)?eo:Hi}function Wa(){if(!Cr)return!1;var ie={},ce=e.CSS&&e.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(Ce){ie[Ce]=ce?e.CSS.supports("touch-action",Ce):!0}),ie}var br=1,Pn=2,Mi=4,Dr=8,Qn=Dr,xo=16,es=32;function Wi(ie){this.options=$({},this.defaults,ie||{}),this.id=Qt(),this.manager=null,this.options.enable=De(this.options.enable,!0),this.state=br,this.simultaneous={},this.requireFail=[]}Wi.prototype={defaults:{},set:function(ie){return $(this.options,ie),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(ie){if(L(ie,"recognizeWith",this))return this;var ce=this.simultaneous;return ie=Rn(ie,this),ce[ie.id]||(ce[ie.id]=ie,ie.recognizeWith(this)),this},dropRecognizeWith:function(ie){return L(ie,"dropRecognizeWith",this)?this:(ie=Rn(ie,this),delete this.simultaneous[ie.id],this)},requireFailure:function(ie){if(L(ie,"requireFailure",this))return this;var ce=this.requireFail;return ie=Rn(ie,this),ht(ce,ie)===-1&&(ce.push(ie),ie.requireFailure(this)),this},dropRequireFailure:function(ie){if(L(ie,"dropRequireFailure",this))return this;ie=Rn(ie,this);var ce=ht(this.requireFail,ie);return ce>-1&&this.requireFail.splice(ce,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(ie){return!!this.simultaneous[ie.id]},emit:function(ie){var ce=this,Ce=this.state;function He(mt){ce.manager.emit(mt,ie)}Ce<Dr&&He(ce.options.event+en(Ce)),He(ce.options.event),ie.additionalEvent&&He(ie.additionalEvent),Ce>=Dr&&He(ce.options.event+en(Ce))},tryEmit:function(ie){if(this.canEmit())return this.emit(ie);this.state=es},canEmit:function(){for(var ie=0;ie<this.requireFail.length;){if(!(this.requireFail[ie].state&(es|br)))return!1;ie++}return!0},recognize:function(ie){var ce=$({},ie);if(!we(this.options.enable,[this,ce])){this.reset(),this.state=es;return}this.state&(Qn|xo|es)&&(this.state=br),this.state=this.process(ce),this.state&(Pn|Mi|Dr|xo)&&this.tryEmit(ce)},process:function(ie){},getTouchAction:function(){},reset:function(){}};function en(ie){return ie&xo?"cancel":ie&Dr?"end":ie&Mi?"move":ie&Pn?"start":""}function fc(ie){return ie==vn?"down":ie==ri?"up":ie==yi?"left":ie==qr?"right":""}function Rn(ie,ce){var Ce=ce.manager;return Ce?Ce.get(ie):ie}function ws(){Wi.apply(this,arguments)}fe(ws,Wi,{defaults:{pointers:1},attrTest:function(ie){var ce=this.options.pointers;return ce===0||ie.pointers.length===ce},process:function(ie){var ce=this.state,Ce=ie.eventType,He=ce&(Pn|Mi),mt=this.attrTest(ie);return He&&(Ce&Lr||!mt)?ce|xo:He||mt?Ce&er?ce|Dr:ce&Pn?ce|Mi:Pn:es}});function wo(){ws.apply(this,arguments),this.pX=null,this.pY=null}fe(wo,ws,{defaults:{event:"pan",threshold:10,pointers:1,direction:bs},getTouchAction:function(){var ie=this.options.direction,ce=[];return ie&Li&&ce.push(bo),ie&Mn&&ce.push(hr),ce},directionTest:function(ie){var ce=this.options,Ce=!0,He=ie.distance,mt=ie.direction,Xt=ie.deltaX,xr=ie.deltaY;return mt&ce.direction||(ce.direction&Li?(mt=Xt===0?yn:Xt<0?yi:qr,Ce=Xt!=this.pX,He=Math.abs(ie.deltaX)):(mt=xr===0?yn:xr<0?ri:vn,Ce=xr!=this.pY,He=Math.abs(ie.deltaY))),ie.direction=mt,Ce&&He>ce.threshold&&mt&ce.direction},attrTest:function(ie){return ws.prototype.attrTest.call(this,ie)&&(this.state&Pn||!(this.state&Pn)&&this.directionTest(ie))},emit:function(ie){this.pX=ie.deltaX,this.pY=ie.deltaY;var ce=fc(ie.direction);ce&&(ie.additionalEvent=this.options.event+ce),this._super.emit.call(this,ie)}});function mc(){ws.apply(this,arguments)}fe(mc,ws,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[Un]},attrTest:function(ie){return this._super.attrTest.call(this,ie)&&(Math.abs(ie.scale-1)>this.options.threshold||this.state&Pn)},emit:function(ie){if(ie.scale!==1){var ce=ie.scale<1?"in":"out";ie.additionalEvent=this.options.event+ce}this._super.emit.call(this,ie)}});function qa(){Wi.apply(this,arguments),this._timer=null,this._input=null}fe(qa,Wi,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[Hi]},process:function(ie){var ce=this.options,Ce=ie.pointers.length===ce.pointers,He=ie.distance<ce.threshold,mt=ie.deltaTime>ce.time;if(this._input=ie,!He||!Ce||ie.eventType&(er|Lr)&&!mt)this.reset();else if(ie.eventType&Ht)this.reset(),this._timer=k(function(){this.state=Qn,this.tryEmit()},ce.time,this);else if(ie.eventType&er)return Qn;return es},reset:function(){clearTimeout(this._timer)},emit:function(ie){this.state===Qn&&(ie&&ie.eventType&er?this.manager.emit(this.options.event+"up",ie):(this._input.timeStamp=C(),this.manager.emit(this.options.event,this._input)))}});function $a(){ws.apply(this,arguments)}fe($a,ws,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[Un]},attrTest:function(ie){return this._super.attrTest.call(this,ie)&&(Math.abs(ie.rotation)>this.options.threshold||this.state&Pn)}});function da(){ws.apply(this,arguments)}fe(da,ws,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:Li|Mn,pointers:1},getTouchAction:function(){return wo.prototype.getTouchAction.call(this)},attrTest:function(ie){var ce=this.options.direction,Ce;return ce&(Li|Mn)?Ce=ie.overallVelocity:ce&Li?Ce=ie.overallVelocityX:ce&Mn&&(Ce=ie.overallVelocityY),this._super.attrTest.call(this,ie)&&ce&ie.offsetDirection&&ie.distance>this.options.threshold&&ie.maxPointers==this.options.pointers&&T(Ce)>this.options.velocity&&ie.eventType&er},emit:function(ie){var ce=fc(ie.offsetDirection);ce&&this.manager.emit(this.options.event+ce,ie),this.manager.emit(this.options.event,ie)}});function Eo(){Wi.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}fe(Eo,Wi,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[eo]},process:function(ie){var ce=this.options,Ce=ie.pointers.length===ce.pointers,He=ie.distance<ce.threshold,mt=ie.deltaTime<ce.time;if(this.reset(),ie.eventType&Ht&&this.count===0)return this.failTimeout();if(He&&mt&&Ce){if(ie.eventType!=er)return this.failTimeout();var Xt=this.pTime?ie.timeStamp-this.pTime<ce.interval:!0,xr=!this.pCenter||ee(this.pCenter,ie.center)<ce.posThreshold;this.pTime=ie.timeStamp,this.pCenter=ie.center,!xr||!Xt?this.count=1:this.count+=1,this._input=ie;var Gr=this.count%ce.taps;if(Gr===0)return this.hasRequireFailures()?(this._timer=k(function(){this.state=Qn,this.tryEmit()},ce.interval,this),Pn):Qn}return es},failTimeout:function(){return this._timer=k(function(){this.state=es},this.options.interval,this),es},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==Qn&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function ts(ie,ce){return ce=ce||{},ce.recognizers=De(ce.recognizers,ts.defaults.preset),new Ao(ie,ce)}ts.VERSION="2.0.7",ts.defaults={domEvents:!1,touchAction:cr,enable:!0,inputTarget:null,inputClass:null,preset:[[$a,{enable:!1}],[mc,{enable:!1},["rotate"]],[da,{direction:Li}],[wo,{direction:Li},["swipe"]],[Eo],[Eo,{event:"doubletap",taps:2},["tap"]],[qa]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var du=1,Za=2;function Ao(ie,ce){this.options=$({},ts.defaults,ce||{}),this.options.inputTarget=this.options.inputTarget||ie,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=ie,this.input=Js(this),this.touchAction=new ha(this,this.options.touchAction),Xa(this,!0),O(this.options.recognizers,function(Ce){var He=this.add(new Ce[0](Ce[1]));Ce[2]&&He.recognizeWith(Ce[2]),Ce[3]&&He.requireFailure(Ce[3])},this)}Ao.prototype={set:function(ie){return $(this.options,ie),ie.touchAction&&this.touchAction.update(),ie.inputTarget&&(this.input.destroy(),this.input.target=ie.inputTarget,this.input.init()),this},stop:function(ie){this.session.stopped=ie?Za:du},recognize:function(ie){var ce=this.session;if(!ce.stopped){this.touchAction.preventDefaults(ie);var Ce,He=this.recognizers,mt=ce.curRecognizer;(!mt||mt&&mt.state&Qn)&&(mt=ce.curRecognizer=null);for(var Xt=0;Xt<He.length;)Ce=He[Xt],ce.stopped!==Za&&(!mt||Ce==mt||Ce.canRecognizeWith(mt))?Ce.recognize(ie):Ce.reset(),!mt&&Ce.state&(Pn|Mi|Dr)&&(mt=ce.curRecognizer=Ce),Xt++}},get:function(ie){if(ie instanceof Wi)return ie;for(var ce=this.recognizers,Ce=0;Ce<ce.length;Ce++)if(ce[Ce].options.event==ie)return ce[Ce];return null},add:function(ie){if(L(ie,"add",this))return this;var ce=this.get(ie.options.event);return ce&&this.remove(ce),this.recognizers.push(ie),ie.manager=this,this.touchAction.update(),ie},remove:function(ie){if(L(ie,"remove",this))return this;if(ie=this.get(ie),ie){var ce=this.recognizers,Ce=ht(ce,ie);Ce!==-1&&(ce.splice(Ce,1),this.touchAction.update())}return this},on:function(ie,ce){if(ie!==s&&ce!==s){var Ce=this.handlers;return O(lt(ie),function(He){Ce[He]=Ce[He]||[],Ce[He].push(ce)}),this}},off:function(ie,ce){if(ie!==s){var Ce=this.handlers;return O(lt(ie),function(He){ce?Ce[He]&&Ce[He].splice(ht(Ce[He],ce),1):delete Ce[He]}),this}},emit:function(ie,ce){this.options.domEvents&&pa(ie,ce);var Ce=this.handlers[ie]&&this.handlers[ie].slice();if(!(!Ce||!Ce.length)){ce.type=ie,ce.preventDefault=function(){ce.srcEvent.preventDefault()};for(var He=0;He<Ce.length;)Ce[He](ce),He++}},destroy:function(){this.element&&Xa(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function Xa(ie,ce){var Ce=ie.element;if(Ce.style){var He;O(ie.options.cssProps,function(mt,Xt){He=Lt(Ce.style,Xt),ce?(ie.oldCssProps[He]=Ce.style[He],Ce.style[He]=mt):Ce.style[He]=ie.oldCssProps[He]||""}),ce||(ie.oldCssProps={})}}function pa(ie,ce){var Ce=r.createEvent("Event");Ce.initEvent(ie,!0,!0),Ce.gesture=ce,ce.target.dispatchEvent(Ce)}$(ts,{INPUT_START:Ht,INPUT_MOVE:dr,INPUT_END:er,INPUT_CANCEL:Lr,STATE_POSSIBLE:br,STATE_BEGAN:Pn,STATE_CHANGED:Mi,STATE_ENDED:Dr,STATE_RECOGNIZED:Qn,STATE_CANCELLED:xo,STATE_FAILED:es,DIRECTION_NONE:yn,DIRECTION_LEFT:yi,DIRECTION_RIGHT:qr,DIRECTION_UP:ri,DIRECTION_DOWN:vn,DIRECTION_HORIZONTAL:Li,DIRECTION_VERTICAL:Mn,DIRECTION_ALL:bs,Manager:Ao,Input:mi,TouchAction:ha,TouchInput:Er,MouseInput:nt,PointerEventInput:or,TouchMouseInput:Ci,SingleTouchInput:$r,Recognizer:Wi,AttrRecognizer:ws,Tap:Eo,Pan:wo,Swipe:da,Pinch:mc,Rotate:$a,Press:qa,on:Fe,off:Ke,each:O,merge:oe,extend:ne,assign:$,inherit:fe,bindFn:ue,prefixed:Lt});var vd=typeof e<"u"?e:typeof self<"u"?self:{};vd.Hammer=ts,t.exports?t.exports=ts:e[i]=ts})(window,document,"Hammer")})(kS)),kS.exports}var U_=YK();const JK=FI(U_),Jc=OI({__proto__:null,default:JK},[U_]),D4=1,N4=2,Wx=4,QK={mousedown:D4,mousemove:N4,mouseup:Wx};function eY(t,e){for(let r=0;r<t.length;r++)if(e(t[r]))return!0;return!1}function tY(t){const e=t.prototype.handler;t.prototype.handler=function(r){const i=this.store;r.button>0&&r.type==="pointerdown"&&(eY(i,s=>s.pointerId===r.pointerId)||i.push(r)),e.call(this,r)}}function rY(t){t.prototype.handler=function(e){let r=QK[e.type];r&D4&&e.button>=0&&(this.pressed=!0),r&N4&&e.buttons===0&&(r=Wx),this.pressed&&(r&Wx&&(this.pressed=!1),this.callback(this.manager,r,{pointers:[e],changedPointers:[e],pointerType:"mouse",srcEvent:e}))}}tY(U_.PointerEventInput);rY(U_.MouseInput);const iY=U_.Manager;class P1{constructor(e,r,i){this.element=e,this.callback=r,this.options={enable:!0,...i}}}const nY=Jc?[[Jc.Pan,{event:"tripan",pointers:3,threshold:0,enable:!1}],[Jc.Rotate,{enable:!1}],[Jc.Pinch,{enable:!1}],[Jc.Swipe,{enable:!1}],[Jc.Pan,{threshold:0,enable:!1}],[Jc.Press,{enable:!1}],[Jc.Tap,{event:"doubletap",taps:2,enable:!1}],[Jc.Tap,{event:"anytap",enable:!1}],[Jc.Tap,{enable:!1}]]:null,LS={tripan:["rotate","pinch","pan"],rotate:["pinch"],pinch:["pan"],pan:["press","doubletap","anytap","tap"],doubletap:["anytap"],anytap:["tap"]},sY={doubletap:["tap"]},oY={pointerdown:"pointerdown",pointermove:"pointermove",pointerup:"pointerup",touchstart:"pointerdown",touchmove:"pointermove",touchend:"pointerup",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup"},eE={KEY_EVENTS:["keydown","keyup"],MOUSE_EVENTS:["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"],WHEEL_EVENTS:["wheel","mousewheel"]},aY={tap:"tap",anytap:"anytap",doubletap:"doubletap",press:"press",pinch:"pinch",pinchin:"pinch",pinchout:"pinch",pinchstart:"pinch",pinchmove:"pinch",pinchend:"pinch",pinchcancel:"pinch",rotate:"rotate",rotatestart:"rotate",rotatemove:"rotate",rotateend:"rotate",rotatecancel:"rotate",tripan:"tripan",tripanstart:"tripan",tripanmove:"tripan",tripanup:"tripan",tripandown:"tripan",tripanleft:"tripan",tripanright:"tripan",tripanend:"tripan",tripancancel:"tripan",pan:"pan",panstart:"pan",panmove:"pan",panup:"pan",pandown:"pan",panleft:"pan",panright:"pan",panend:"pan",pancancel:"pan",swipe:"swipe",swipeleft:"swipe",swiperight:"swipe",swipeup:"swipe",swipedown:"swipe"},DS={click:"tap",anyclick:"anytap",dblclick:"doubletap",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup",mouseover:"pointerover",mouseout:"pointerout",mouseleave:"pointerleave"},lY=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",rm=typeof window<"u"?window:global;let qx=!1;try{const t={get passive(){return qx=!0,!0}};rm.addEventListener("test",null,t),rm.removeEventListener("test",null)}catch{qx=!1}const cY=lY.indexOf("firefox")!==-1,{WHEEL_EVENTS:uY}=eE,NS="wheel",OS=4.000244140625,hY=40,dY=.25;class pY extends P1{constructor(e,r,i){super(e,r,i),this.handleEvent=s=>{if(!this.options.enable)return;let l=s.deltaY;rm.WheelEvent&&(cY&&s.deltaMode===rm.WheelEvent.DOM_DELTA_PIXEL&&(l/=rm.devicePixelRatio),s.deltaMode===rm.WheelEvent.DOM_DELTA_LINE&&(l*=hY)),l!==0&&l%OS===0&&(l=Math.floor(l/OS)),s.shiftKey&&l&&(l=l*dY),this.callback({type:NS,center:{x:s.clientX,y:s.clientY},delta:-l,srcEvent:s,pointerType:"mouse",target:s.target})},this.events=(this.options.events||[]).concat(uY),this.events.forEach(s=>e.addEventListener(s,this.handleEvent,qx?{passive:!1}:!1))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,r){e===NS&&(this.options.enable=r)}}const{MOUSE_EVENTS:fY}=eE,FS="pointermove",zS="pointerover",US="pointerout",jS="pointerenter",VS="pointerleave";class mY extends P1{constructor(e,r,i){super(e,r,i),this.handleEvent=l=>{this.handleOverEvent(l),this.handleOutEvent(l),this.handleEnterEvent(l),this.handleLeaveEvent(l),this.handleMoveEvent(l)},this.pressed=!1;const{enable:s}=this.options;this.enableMoveEvent=s,this.enableLeaveEvent=s,this.enableEnterEvent=s,this.enableOutEvent=s,this.enableOverEvent=s,this.events=(this.options.events||[]).concat(fY),this.events.forEach(l=>e.addEventListener(l,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,r){e===FS&&(this.enableMoveEvent=r),e===zS&&(this.enableOverEvent=r),e===US&&(this.enableOutEvent=r),e===jS&&(this.enableEnterEvent=r),e===VS&&(this.enableLeaveEvent=r)}handleOverEvent(e){this.enableOverEvent&&e.type==="mouseover"&&this._emit(zS,e)}handleOutEvent(e){this.enableOutEvent&&e.type==="mouseout"&&this._emit(US,e)}handleEnterEvent(e){this.enableEnterEvent&&e.type==="mouseenter"&&this._emit(jS,e)}handleLeaveEvent(e){this.enableLeaveEvent&&e.type==="mouseleave"&&this._emit(VS,e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":e.buttons===0&&(this.pressed=!1),this.pressed||this._emit(FS,e);break;case"mouseup":this.pressed=!1;break}}_emit(e,r){this.callback({type:e,center:{x:r.clientX,y:r.clientY},srcEvent:r,pointerType:"mouse",target:r.target})}}const{KEY_EVENTS:gY}=eE,GS="keydown",HS="keyup";class _Y extends P1{constructor(e,r,i){super(e,r,i),this.handleEvent=s=>{const l=s.target||s.srcElement;l.tagName==="INPUT"&&l.type==="text"||l.tagName==="TEXTAREA"||(this.enableDownEvent&&s.type==="keydown"&&this.callback({type:GS,srcEvent:s,key:s.key,target:s.target}),this.enableUpEvent&&s.type==="keyup"&&this.callback({type:HS,srcEvent:s,key:s.key,target:s.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,this.events=(this.options.events||[]).concat(gY),e.tabIndex=this.options.tabIndex||0,e.style.outline="none",this.events.forEach(s=>e.addEventListener(s,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,r){e===GS&&(this.enableDownEvent=r),e===HS&&(this.enableUpEvent=r)}}const WS="contextmenu";class yY extends P1{constructor(e,r,i){super(e,r,i),this.handleEvent=s=>{this.options.enable&&this.callback({type:WS,center:{x:s.clientX,y:s.clientY},srcEvent:s,pointerType:"mouse",target:s.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,r){e===WS&&(this.options.enable=r)}}const qS=1,$x=2,$S=4,vY={pointerdown:qS,pointermove:$x,pointerup:$S,mousedown:qS,mousemove:$x,mouseup:$S},bY=0,xY=1,wY=2,EY=1,AY=2,TY=4;function SY(t){const e=vY[t.srcEvent.type];if(!e)return null;const{buttons:r,button:i}=t.srcEvent;let s=!1,l=!1,h=!1;return e===$x?(s=!!(r&EY),l=!!(r&TY),h=!!(r&AY)):(s=i===bY,l=i===xY,h=i===wY),{leftButton:s,middleButton:l,rightButton:h}}function CY(t,e){const r=t.center;if(!r)return null;const i=e.getBoundingClientRect(),s=i.width/e.offsetWidth||1,l=i.height/e.offsetHeight||1,h={x:(r.x-i.left-e.clientLeft)/s,y:(r.y-i.top-e.clientTop)/l};return{center:r,offsetCenter:h}}const gb={srcElement:"root",priority:0};class MY{constructor(e){this.handleEvent=r=>{if(this.isEmpty())return;const i=this._normalizeEvent(r);let s=r.srcEvent.target;for(;s&&s!==i.rootElement;){if(this._emit(i,s),i.handled)return;s=s.parentNode}this._emit(i,"root")},this.eventManager=e,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,r,i,s=!1,l=!1){const{handlers:h,handlersByElement:a}=this;let v=gb;typeof i=="string"||i&&i.addEventListener?v={...gb,srcElement:i}:i&&(v={...gb,...i});let T=a.get(v.srcElement);T||(T=[],a.set(v.srcElement,T));const C={type:e,handler:r,srcElement:v.srcElement,priority:v.priority};s&&(C.once=!0),l&&(C.passive=!0),h.push(C),this._active=this._active||!C.passive;let k=T.length-1;for(;k>=0&&!(T[k].priority>=C.priority);)k--;T.splice(k+1,0,C)}remove(e,r){const{handlers:i,handlersByElement:s}=this;for(let l=i.length-1;l>=0;l--){const h=i[l];if(h.type===e&&h.handler===r){i.splice(l,1);const a=s.get(h.srcElement);a.splice(a.indexOf(h),1),a.length===0&&s.delete(h.srcElement)}}this._active=i.some(l=>!l.passive)}_emit(e,r){const i=this.handlersByElement.get(r);if(i){let s=!1;const l=()=>{e.handled=!0},h=()=>{e.handled=!0,s=!0},a=[];for(let v=0;v<i.length;v++){const{type:T,handler:C,once:k}=i[v];if(C({...e,type:T,stopPropagation:l,stopImmediatePropagation:h}),k&&a.push(i[v]),s)break}for(let v=0;v<a.length;v++){const{type:T,handler:C}=a[v];this.remove(T,C)}}}_normalizeEvent(e){const r=this.eventManager.getElement();return{...e,...SY(e),...CY(e,r),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:r}}}const PY={events:null,recognizers:null,recognizerOptions:{},Manager:iY,touchAction:"none",tabIndex:0};class RY{constructor(e=null,r){this._onBasicInput=s=>{const{srcEvent:l}=s,h=oY[l.type];h&&this.manager.emit(h,s)},this._onOtherEvent=s=>{this.manager.emit(s.type,s)},this.options={...PY,...r},this.events=new Map,this.setElement(e);const{events:i}=this.options;i&&this.on(i)}getElement(){return this.element}setElement(e){if(this.element&&this.destroy(),this.element=e,!e)return;const{options:r}=this,i=r.Manager;this.manager=new i(e,{touchAction:r.touchAction,recognizers:r.recognizers||nY}).on("hammer.input",this._onBasicInput),r.recognizers||Object.keys(LS).forEach(s=>{const l=this.manager.get(s);l&&LS[s].forEach(h=>{l.recognizeWith(h)})});for(const s in r.recognizerOptions){const l=this.manager.get(s);if(l){const h=r.recognizerOptions[s];delete h.enable,l.set(h)}}this.wheelInput=new pY(e,this._onOtherEvent,{enable:!1}),this.moveInput=new mY(e,this._onOtherEvent,{enable:!1}),this.keyInput=new _Y(e,this._onOtherEvent,{enable:!1,tabIndex:r.tabIndex}),this.contextmenuInput=new yY(e,this._onOtherEvent,{enable:!1});for(const[s,l]of this.events)l.isEmpty()||(this._toggleRecognizer(l.recognizerName,!0),this.manager.on(s,l.handleEvent))}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy(),this.wheelInput=null,this.moveInput=null,this.keyInput=null,this.contextmenuInput=null,this.manager=null,this.element=null)}on(e,r,i){this._addEventHandler(e,r,i,!1)}once(e,r,i){this._addEventHandler(e,r,i,!0)}watch(e,r,i){this._addEventHandler(e,r,i,!1,!0)}off(e,r){this._removeEventHandler(e,r)}_toggleRecognizer(e,r){const{manager:i}=this;if(!i)return;const s=i.get(e);if(s&&s.options.enable!==r){s.set({enable:r});const l=sY[e];l&&!this.options.recognizers&&l.forEach(h=>{const a=i.get(h);r?(a.requireFailure(e),s.dropRequireFailure(h)):a.dropRequireFailure(e)})}this.wheelInput.enableEventType(e,r),this.moveInput.enableEventType(e,r),this.keyInput.enableEventType(e,r),this.contextmenuInput.enableEventType(e,r)}_addEventHandler(e,r,i,s,l){if(typeof e!="string"){i=r;for(const C in e)this._addEventHandler(C,e[C],i,s,l);return}const{manager:h,events:a}=this,v=DS[e]||e;let T=a.get(v);T||(T=new MY(this),a.set(v,T),T.recognizerName=aY[v]||v,h&&h.on(v,T.handleEvent)),T.add(e,r,i,s,l),T.isEmpty()||this._toggleRecognizer(T.recognizerName,!0)}_removeEventHandler(e,r){if(typeof e!="string"){for(const h in e)this._removeEventHandler(h,e[h]);return}const{events:i}=this,s=DS[e]||e,l=i.get(s);if(l&&(l.remove(e,r),l.isEmpty())){const{recognizerName:h}=l;let a=!1;for(const v of i.values())if(v.recognizerName===h&&!v.isEmpty()){a=!0;break}a||this._toggleRecognizer(h,!1)}}}function Xh(){}const IY=({isDragging:t})=>t?"grabbing":"grab",O4={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,parameters:{},parent:null,device:null,deviceProps:{type:"webgl"},gl:null,glOptions:{},canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,widgets:[],onDeviceInitialized:Xh,onWebGLInitialized:Xh,onResize:Xh,onViewStateChange:Xh,onInteractionStateChange:Xh,onBeforeRender:Xh,onAfterRender:Xh,onLoad:Xh,onError:t=>li.error(t.message,t.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:IY,getTooltip:null,debug:!1,drawPickingColors:!1};class E_{constructor(e){this.width=0,this.height=0,this.userData={},this.device=null,this.canvas=null,this.viewManager=null,this.layerManager=null,this.effectManager=null,this.deckRenderer=null,this.deckPicker=null,this.eventManager=null,this.widgetManager=null,this.tooltip=null,this.animationLoop=null,this.cursorState={isHovering:!1,isDragging:!1},this.stats=new Nm({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this._lastPointerDownInfo=null,this._onPointerMove=i=>{const{_pickRequest:s}=this;if(i.type==="pointerleave")s.x=-1,s.y=-1,s.radius=0;else{if(i.leftButton||i.rightButton)return;{const l=i.offsetCenter;if(!l)return;s.x=l.x,s.y=l.y,s.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:s.x,y:s.y}),s.event=i},this._onEvent=i=>{const s=Nx[i.type],l=i.offsetCenter;if(!s||!l||!this.layerManager)return;const h=this.layerManager.getLayers(),a=this.deckPicker.getLastPickedObject({x:l.x,y:l.y,layers:h,viewports:this.getViewports(l)},this._lastPointerDownInfo),{layer:v}=a,T=v&&(v[s.handler]||v.props[s.handler]),C=this.props[s.handler];let k=!1;T&&(k=T.call(v,a,i)),k||(C?.(a,i),this.widgetManager.onEvent(a,i))},this._onPointerDown=i=>{const s=i.offsetCenter,l=this._pick("pickObject","pickObject Time",{x:s.x,y:s.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=l.result[0]||l.emptyInfo},this.props={...O4,...e},e=this.props,e.viewState&&e.initialViewState&&li.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),this.viewState=this.props.initialViewState,e.device?this.device=e.device:e.gl&&(e.gl instanceof WebGLRenderingContext&&li.error("WebGL1 context not supported.")(),this.device=sd.attach(e.gl));let r=this.device;r||(am.registerDevices([sd]),r=am.createDevice({...e.deviceProps,canvas:this._createCanvas(e)})),this.animationLoop=this._createAnimationLoop(r,e),this.setProps(e),e._typedArrayManagerProps&&b_.setOptions(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){this.animationLoop?.stop(),this.animationLoop?.destroy(),this.animationLoop=null,this._lastPointerDownInfo=null,this.layerManager?.finalize(),this.layerManager=null,this.viewManager?.finalize(),this.viewManager=null,this.effectManager?.finalize(),this.effectManager=null,this.deckRenderer?.finalize(),this.deckRenderer=null,this.deckPicker?.finalize(),this.deckPicker=null,this.eventManager?.destroy(),this.eventManager=null,this.widgetManager?.finalize(),this.widgetManager=null,!this.props.canvas&&!this.props.device&&!this.props.gl&&this.canvas&&(this.canvas.parentElement?.removeChild(this.canvas),this.canvas=null)}setProps(e){this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&li.removed("onLayerHover","onHover")(),"onLayerClick"in e&&li.removed("onLayerClick","onClick")(),e.initialViewState&&!sc(this.props.initialViewState,e.initialViewState,3)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);const r=Object.create(this.props);Object.assign(r,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),this.animationLoop?.setProps(r),this.layerManager&&(this.viewManager.setProps(r),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(r),this.effectManager.setProps(r),this.deckRenderer.setProps(r),this.deckPicker.setProps(r),this.widgetManager.setProps(r)),this.stats.get("setProps Time").timeEnd()}needsRedraw(e={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let r=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);const i=this.viewManager.needsRedraw(e),s=this.layerManager.needsRedraw(e),l=this.effectManager.needsRedraw(e),h=this.deckRenderer.needsRedraw(e);return r=r||i||s||l||h,r}redraw(e){if(!this.layerManager)return;let r=this.needsRedraw({clearRedrawFlags:!0});r=e||r,r&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(r):this._drawLayers(r))}get isInitialized(){return this.viewManager!==null}getViews(){return ys(this.viewManager),this.viewManager.views}getViewports(e){return ys(this.viewManager),this.viewManager.getViewports(e)}getCanvas(){return this.canvas}pickObject(e){const r=this._pick("pickObject","pickObject Time",e).result;return r.length?r[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e,r=!1){for(const i in e)this.layerManager.resourceManager.add({resourceId:i,data:e[i],forceUpdate:r})}_removeResources(e){for(const r of e)this.layerManager.resourceManager.remove(r)}_addDefaultEffect(e){this.effectManager.addDefaultEffect(e)}_addDefaultShaderModule(e){this.layerManager.addDefaultShaderModule(e)}_removeDefaultShaderModule(e){this.layerManager?.removeDefaultShaderModule(e)}_pick(e,r,i){ys(this.deckPicker);const{stats:s}=this;s.get("Pick Count").incrementCount(),s.get(r).timeStart();const l=this.deckPicker[e]({layers:this.layerManager.getLayers(i),views:this.viewManager.getViews(),viewports:this.getViewports(i),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...i});return s.get(r).timeEnd(),l}_createCanvas(e){let r=e.canvas;return typeof r=="string"&&(r=document.getElementById(r),ys(r)),r||(r=document.createElement("canvas"),r.id=e.id||"deckgl-overlay",(e.parent||document.body).appendChild(r)),Object.assign(r.style,e.style),r}_setCanvasSize(e){if(!this.canvas)return;const{width:r,height:i}=e;if(r||r===0){const s=Number.isFinite(r)?`${r}px`:r;this.canvas.style.width=s}if(i||i===0){const s=Number.isFinite(i)?`${i}px`:i;this.canvas.style.position=e.style?.position||"absolute",this.canvas.style.height=s}}_updateCanvasSize(){const{canvas:e}=this;if(!e)return;const r=e.clientWidth??e.width,i=e.clientHeight??e.height;(r!==this.width||i!==this.height)&&(this.width=r,this.height=i,this.viewManager?.setProps({width:r,height:i}),this.layerManager?.activateViewport(this.getViewports()[0]),this.props.onResize({width:r,height:i}))}_createAnimationLoop(e,r){const{gl:i,onError:s,useDevicePixels:l}=r;return new eZ({device:e,useDevicePixels:l,autoResizeDrawingBuffer:!i,autoResizeViewport:!1,onInitialize:h=>this._setDevice(h.device),onRender:this._onRenderFrame.bind(this),onError:s})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){const{views:e}=this.props,r=Array.isArray(e)?e:e?[e]:[new X2({id:"default-view"})];return r.length&&this.props.controller&&(r[0].props.controller=this.props.controller),r}_onContextLost(){const{onError:e}=this.props;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}_pickAndCallback(){const{_pickRequest:e}=this;if(e.event){const{result:r,emptyInfo:i}=this._pick("pickObject","pickObject Time",e);this.cursorState.isHovering=r.length>0;let s=i,l=!1;for(const h of r)s=h,l=h.layer?.onHover(h,e.event)||l;l||(this.props.onHover?.(s,e.event),this.widgetManager.onHover(s,e.event)),e.event=null}}_updateCursor(){const e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}_setDevice(e){if(this.device=e,!this.animationLoop)return;this.canvas||(this.canvas=this.device.canvasContext?.canvas),this.device.setParametersWebGL({blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onDeviceInitialized(this.device),this.device instanceof sd&&this.props.onWebGLInitialized(this.device.gl);const r=new g4;r.play(),this.animationLoop.attachTimeline(r),this.eventManager=new RY(this.props.parent||this.canvas,{touchAction:this.props.touchAction,recognizerOptions:this.props.eventRecognizerOptions,events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const s in Nx)this.eventManager.on(s,this._onEvent);this.viewManager=new yZ({timeline:r,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const i=this.viewManager.getViewports()[0];this.layerManager=new _Z(this.device,{deck:this,stats:this.stats,viewport:i,timeline:r}),this.effectManager=new DZ({deck:this,device:this.device}),this.deckRenderer=new FZ(this.device),this.deckPicker=new HZ(this.device),this.widgetManager=new $Z({deck:this,parentElement:this.canvas?.parentElement}),this.widgetManager.addDefault(new XZ),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,r){const{device:i,gl:s}=this.layerManager.context;this.props.onBeforeRender({device:i,gl:s});const l={target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...r};this.deckRenderer?.renderLayers(l),l.pass==="screen"&&this.widgetManager.onRedraw({viewports:l.viewports,layers:l.layers}),this.props.onAfterRender({device:i,gl:s})}_onRenderFrame(){this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),li.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.layerManager.updateLayers(),this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){const r=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:r},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}_getFrameStats(){const{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();const r=this.animationLoop.stats;e.get("GPU Time").addTime(r.get("GPU Time").lastTiming),e.get("CPU Time").addTime(r.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:e,stats:r}=this;e.fps=r.get("frameRate").getHz(),e.setPropsTime=r.get("setProps Time").time,e.updateAttributesTime=r.get("Update Attributes").time,e.framesRedrawn=r.get("Redraw Count").count,e.pickTime=r.get("pickObject Time").time+r.get("pickMultipleObjects Time").time+r.get("pickObjects Time").time,e.pickCount=r.get("Pick Count").count,e.gpuTime=r.get("GPU Time").time,e.cpuTime=r.get("CPU Time").time,e.gpuTimePerFrame=r.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=r.get("CPU Time").getAverageTime();const i=am.stats.get("Memory Usage");e.bufferMemory=i.get("Buffer Memory").count,e.textureMemory=i.get("Texture Memory").count,e.renderbufferMemory=i.get("Renderbuffer Memory").count,e.gpuMemory=i.get("GPU Memory").count}}E_.defaultProps=O4;E_.VERSION=RV;function kY(t){switch(t){case"float64":return Float64Array;case"uint8":case"unorm8":return Uint8ClampedArray;default:return C5(t)}}const BY=S5;function t0(t,e){return{attribute:t,format:e.size>1?`${e.type}x${e.size}`:e.type,byteOffset:e.offset||0}}function Op(t){return t.stride||t.size*t.bytesPerElement}function LY(t,e){return t.type===e.type&&t.size===e.size&&Op(t)===Op(e)&&(t.offset||0)===(e.offset||0)}function Zx(t,e){e.offset&&li.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const r=Op(t),i=e.vertexOffset!==void 0?e.vertexOffset:t.vertexOffset||0,s=e.elementOffset||0,l=i*r+s*t.bytesPerElement+(t.offset||0);return{...e,offset:l,stride:r}}function DY(t,e){const r=Zx(t,e);return{high:r,low:{...r,offset:r.offset+t.size*4}}}class NY{constructor(e,r,i){this._buffer=null,this.device=e,this.id=r.id||"",this.size=r.size||1;const s=r.logicalType||r.type,l=s==="float64";let{defaultValue:h}=r;h=Number.isFinite(h)?[h]:h||new Array(this.size).fill(0);let a;l?a="float32":!s&&r.isIndexed?a="uint32":a=s||"float32";let v=kY(s||a);this.doublePrecision=l,l&&r.fp64===!1&&(v=Float32Array),this.value=null,this.settings={...r,defaultType:v,defaultValue:h,logicalType:s,type:a,normalized:a.includes("norm"),size:this.size,bytesPerElement:v.BYTES_PER_ELEMENT},this.state={...i,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1}}get isConstant(){return this.state.constant}get buffer(){return this._buffer}get byteOffset(){const e=this.getAccessor();return e.vertexOffset?e.vertexOffset*Op(e):0}get numInstances(){return this.state.numInstances}set numInstances(e){this.state.numInstances=e}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),b_.release(this.state.allocatedValue)}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(e=this.id,r=null){const i={};if(this.state.constant){const s=this.value;if(r){const l=Zx(this.getAccessor(),r),h=l.offset/s.BYTES_PER_ELEMENT,a=l.size||this.size;i[e]=s.subarray(h,h+a)}else i[e]=s}else i[e]=this.getBuffer();return this.doublePrecision&&(this.value instanceof Float64Array?i[`${e}64Low`]=i[e]:i[`${e}64Low`]=new Float32Array(this.size)),i}_getBufferLayout(e=this.id,r=null){const i=this.getAccessor(),s=[],l={name:this.id,byteStride:Op(i),attributes:s};if(this.doublePrecision){const h=DY(i,r||{});s.push(t0(e,{...i,...h.high}),t0(`${e}64Low`,{...i,...h.low}))}else if(r){const h=Zx(i,r);s.push(t0(e,{...i,...h}))}else s.push(t0(e,i));return l}setAccessor(e){this.state.bufferAccessor=e}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let e=null;if(this.state.constant&&this.value){const r=Array.from(this.value);e=[r,r]}else{const{value:r,numInstances:i,size:s}=this,l=i*s;if(r&&l&&r.length>=l){const h=new Array(s).fill(1/0),a=new Array(s).fill(-1/0);for(let v=0;v<l;)for(let T=0;T<s;T++){const C=r[v++];C<h[T]&&(h[T]=C),C>a[T]&&(a[T]=C)}e=[h,a]}}return this.state.bounds=e,e}setData(e){const{state:r}=this;let i;ArrayBuffer.isView(e)?i={value:e}:e instanceof Ji?i={buffer:e}:i=e;const s={...this.settings,...i};if(ArrayBuffer.isView(i.value)){if(!i.type)if(this.doublePrecision&&i.value instanceof Float64Array)s.type="float32";else{const l=BY(i.value);s.type=s.normalized?l.replace("int","norm"):l}s.bytesPerElement=i.value.BYTES_PER_ELEMENT,s.stride=Op(s)}if(r.bounds=null,i.constant){let l=i.value;if(l=this._normalizeValue(l,[],0),this.settings.normalized&&(l=this.normalizeConstant(l)),!(!r.constant||!this._areValuesEqual(l,this.value)))return!1;r.externalBuffer=null,r.constant=!0,this.value=ArrayBuffer.isView(l)?l:new Float32Array(l)}else if(i.buffer){const l=i.buffer;r.externalBuffer=l,r.constant=!1,this.value=i.value||null}else if(i.value){this._checkExternalBuffer(i);let l=i.value;r.externalBuffer=null,r.constant=!1,this.value=l;let{buffer:h}=this;const a=Op(s),v=(s.vertexOffset||0)*a;if(this.doublePrecision&&l instanceof Float64Array&&(l=ib(l,s)),this.settings.isIndexed){const C=this.settings.defaultType;l.constructor!==C&&(l=new C(l))}const T=l.byteLength+v+a*2;(!h||h.byteLength<T)&&(h=this._createBuffer(T)),h.write(l,v)}return this.setAccessor(s),!0}updateSubBuffer(e={}){this.state.bounds=null;const r=this.value,{startOffset:i=0,endOffset:s}=e;this.buffer.write(this.doublePrecision&&r instanceof Float64Array?ib(r,{size:this.size,startIndex:i,endIndex:s}):r.subarray(i,s),i*r.BYTES_PER_ELEMENT+this.byteOffset)}allocate(e,r=!1){const{state:i}=this,s=i.allocatedValue,l=b_.allocate(s,e+1,{size:this.size,type:this.settings.defaultType,copy:r});this.value=l;const{byteOffset:h}=this;let{buffer:a}=this;return(!a||a.byteLength<l.byteLength+h)&&(a=this._createBuffer(l.byteLength+h),r&&s&&a.write(s instanceof Float64Array?ib(s,this):s,h)),i.allocatedValue=l,i.constant=!1,i.externalBuffer=null,this.setAccessor(this.settings),!0}_checkExternalBuffer(e){const{value:r}=e;if(!ArrayBuffer.isView(r))throw new Error(`Attribute ${this.id} value is not TypedArray`);const i=this.settings.defaultType;let s=!1;if(this.doublePrecision&&(s=r.BYTES_PER_ELEMENT<4),s)throw new Error(`Attribute ${this.id} does not support ${r.constructor.name}`);!(r instanceof i)&&this.settings.normalized&&!("normalized"in e)&&li.warn(`Attribute ${this.id} is normalized`)()}normalizeConstant(e){switch(this.settings.type){case"snorm8":return new Float32Array(e).map(r=>(r+128)/255*2-1);case"snorm16":return new Float32Array(e).map(r=>(r+32768)/65535*2-1);case"unorm8":return new Float32Array(e).map(r=>r/255);case"unorm16":return new Float32Array(e).map(r=>r/65535);default:return e}}_normalizeValue(e,r,i){const{defaultValue:s,size:l}=this.settings;if(Number.isFinite(e))return r[i]=e,r;if(!e){let h=l;for(;--h>=0;)r[i+h]=s[h];return r}switch(l){case 4:r[i+3]=Number.isFinite(e[3])?e[3]:s[3];case 3:r[i+2]=Number.isFinite(e[2])?e[2]:s[2];case 2:r[i+1]=Number.isFinite(e[1])?e[1]:s[1];case 1:r[i+0]=Number.isFinite(e[0])?e[0]:s[0];break;default:let h=l;for(;--h>=0;)r[i+h]=Number.isFinite(e[h])?e[h]:s[h]}return r}_areValuesEqual(e,r){if(!e||!r)return!1;const{size:i}=this;for(let s=0;s<i;s++)if(e[s]!==r[s])return!1;return!0}_createBuffer(e){this._buffer&&this._buffer.destroy();const{isIndexed:r,type:i}=this.settings;return this._buffer=this.device.createBuffer({...this._buffer?.props,id:this.id,usage:r?Ji.INDEX:Ji.VERTEX,indexType:r?i:void 0,byteLength:e}),this._buffer}}const ZS=[],XS=[];function F4(t,e=0,r=1/0){let i=ZS;const s={index:-1,data:t,target:[]};return t?typeof t[Symbol.iterator]=="function"?i=t:t.length>0&&(XS.length=t.length,i=XS):i=ZS,(e>0||Number.isFinite(r))&&(i=(Array.isArray(i)?i:Array.from(i)).slice(e,r),s.index=e-1),{iterable:i,objectInfo:s}}function z4(t){return t&&t[Symbol.asyncIterator]}function OY(t,e){const{size:r,stride:i,offset:s,startIndices:l,nested:h}=e,a=t.BYTES_PER_ELEMENT,v=i?i/a:r,T=s?s/a:0,C=Math.floor((t.length-T)/v);return(k,{index:L,target:O})=>{if(!l){const oe=L*v+T;for(let fe=0;fe<r;fe++)O[fe]=t[oe+fe];return O}const K=l[L],$=l[L+1]||C;let ne;if(h){ne=new Array($-K);for(let oe=K;oe<$;oe++){const fe=oe*v+T;O=new Array(r);for(let ue=0;ue<r;ue++)O[ue]=t[fe+ue];ne[oe-K]=O}}else if(v===r)ne=t.subarray(K*r+T,$*r+T);else{ne=new t.constructor(($-K)*r);let oe=0;for(let fe=K;fe<$;fe++){const ue=fe*v+T;for(let we=0;we<r;we++)ne[oe++]=t[ue+we]}}return ne}}const FY=[],S0=[[0,1/0]];function zY(t,e){if(t===S0||(e[0]<0&&(e[0]=0),e[0]>=e[1]))return t;const r=[],i=t.length;let s=0;for(let l=0;l<i;l++){const h=t[l];h[1]<e[0]?(r.push(h),s=l+1):h[0]>e[1]?r.push(h):e=[Math.min(h[0],e[0]),Math.max(h[1],e[1])]}return r.splice(s,0,e),r}const UY={interpolation:{duration:0,easing:t=>t},spring:{stiffness:.05,damping:.5}};function U4(t,e){if(!t)return null;Number.isFinite(t)&&(t={type:"interpolation",duration:t});const r=t.type||"interpolation";return{...UY[r],...e,...t,type:r}}class j4 extends NY{constructor(e,r){super(e,r,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,layoutChanged:!1,updateRanges:S0}),this.constant=!1,this.settings.update=r.update||(r.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:e=!1}={}){const r=this.state.needsRedraw;return this.state.needsRedraw=r&&!e,r}layoutChanged(){return this.state.layoutChanged}setAccessor(e){var r;(r=this.state).layoutChanged||(r.layoutChanged=!LY(e,this.getAccessor())),super.setAccessor(e)}getUpdateTriggers(){const{accessor:e}=this.settings;return[this.id].concat(typeof e!="function"&&e||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;const{accessor:r}=this.settings,i=this.settings.transition,s=Array.isArray(r)?e[r.find(l=>e[l])]:e[r];return U4(s,i)}setNeedsUpdate(e=this.id,r){if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),r){const{startRow:i=0,endRow:s=1/0}=r;this.state.updateRanges=zY(this.state.updateRanges,[i,s])}else this.state.updateRanges=S0}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=FY}setNeedsRedraw(e=this.id){this.state.needsRedraw=this.state.needsRedraw||e}allocate(e){const{state:r,settings:i}=this;return i.noAlloc?!1:i.update?(super.allocate(e,r.updateRanges!==S0),!0):!1}updateBuffer({numInstances:e,data:r,props:i,context:s}){if(!this.needsUpdate())return!1;const{state:{updateRanges:l},settings:{update:h,noAlloc:a}}=this;let v=!0;if(h){for(const[T,C]of l)h.call(s,this,{data:r,startRow:T,endRow:C,props:i,numInstances:e});if(this.value)if(this.constant||!this.buffer||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[T,C]of l){const k=Number.isFinite(T)?this.getVertexOffset(T):0,L=Number.isFinite(C)?this.getVertexOffset(C):a||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:k,endOffset:L})}this._checkAttributeArray()}else v=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),v}setConstantValue(e){return e===void 0||typeof e=="function"?!1:(this.setData({constant:!0,value:e})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(e){const{state:r}=this;return e?(this.clearNeedsUpdate(),r.lastExternalBuffer===e||(r.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(r.lastExternalBuffer=null,!1)}setBinaryValue(e,r=null){const{state:i,settings:s}=this;if(!e)return i.binaryValue=null,i.binaryAccessor=null,!1;if(s.noAlloc)return!1;if(i.binaryValue===e)return this.clearNeedsUpdate(),!0;if(i.binaryValue=e,this.setNeedsRedraw(),s.transform||r!==this.startIndices){ArrayBuffer.isView(e)&&(e={value:e});const l=e;ys(ArrayBuffer.isView(l.value),`invalid ${s.accessor}`);const h=!!l.size&&l.size!==this.size;return i.binaryAccessor=OY(l.value,{size:l.size||this.size,stride:l.stride,offset:l.offset,startIndices:r,nested:h}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){const{startIndices:r}=this;return(r?e<r.length?r[e]:this.numInstances:e)*this.size}getValue(){const e=this.settings.shaderAttributes,r=super.getValue();if(!e)return r;for(const i in e)Object.assign(r,super.getValue(i,e[i]));return r}getBufferLayout(e){this.state.layoutChanged=!1;const r=this.settings.shaderAttributes,i=super._getBufferLayout(),{stepMode:s}=this.settings;if(s==="dynamic"?i.stepMode=e?e.isInstanced?"instance":"vertex":"instance":i.stepMode=s??"vertex",!r)return i;for(const l in r){const h=super._getBufferLayout(l,r[l]);i.attributes.push(...h.attributes)}return i}_autoUpdater(e,{data:r,startRow:i,endRow:s,props:l,numInstances:h}){if(e.constant)return;const{settings:a,state:v,value:T,size:C,startIndices:k}=e,{accessor:L,transform:O}=a,K=v.binaryAccessor||(typeof L=="function"?L:l[L]);ys(typeof K=="function",`accessor "${L}" is not a function`);let $=e.getVertexOffset(i);const{iterable:ne,objectInfo:oe}=F4(r,i,s);for(const fe of ne){oe.index++;let ue=K(fe,oe);if(O&&(ue=O.call(this,ue)),k){const we=(oe.index<k.length-1?k[oe.index+1]:h)-k[oe.index];if(ue&&Array.isArray(ue[0])){let De=$;for(const Fe of ue)e._normalizeValue(Fe,T,De),De+=C}else ue&&ue.length>C?T.set(ue,$):(e._normalizeValue(ue,oe.target,0),dZ({target:T,source:oe.target,start:$,count:we}));$+=we*C}else e._normalizeValue(ue,T,$),$+=C}}_validateAttributeUpdaters(){const{settings:e}=this;if(!(e.noAlloc||typeof e.update=="function"))throw new Error(`Attribute ${this.id} missing update or accessor`)}_checkAttributeArray(){const{value:e}=this,r=Math.min(4,this.size);if(e&&e.length>=r){let i=!0;switch(r){case 4:i=i&&Number.isFinite(e[3]);case 3:i=i&&Number.isFinite(e[2]);case 2:i=i&&Number.isFinite(e[1]);case 1:i=i&&Number.isFinite(e[0]);break;default:i=!1}if(!i)throw new Error(`Illegal attribute generated for ${this.id}`)}}}function _b(t){const{source:e,target:r,start:i=0,size:s,getData:l}=t,h=t.end||r.length,a=e.length,v=h-i;if(a>v){r.set(e.subarray(0,v),i);return}if(r.set(e,i),!l)return;let T=a;for(;T<v;){const C=l(T,e);for(let k=0;k<s;k++)r[i+T]=C[k]||0,T++}}function jY({source:t,target:e,size:r,getData:i,sourceStartIndices:s,targetStartIndices:l}){if(!s||!l)return _b({source:t,target:e,size:r,getData:i}),e;let h=0,a=0;const v=i&&((C,k)=>i(C+a,k)),T=Math.min(s.length,l.length);for(let C=1;C<T;C++){const k=s[C]*r,L=l[C]*r;_b({source:t.subarray(h,k),target:e,start:a,end:L,size:r,getData:v}),h=k,a=L}return a<e.length&&_b({source:[],target:e,start:a,size:r,getData:v}),e}function VY(t){const{device:e,settings:r,value:i}=t,s=new j4(e,r);return s.setData({value:i instanceof Float64Array?new Float64Array(0):new Float32Array(0),normalized:r.normalized}),s}function V4(t){switch(t){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`No defined attribute type for size "${t}"`)}}function G4(t){switch(t){case 1:return"float32";case 2:return"float32x2";case 3:return"float32x3";case 4:return"float32x4";default:throw new Error("invalid type size")}}function H4(t){t.push(t.shift())}function GY(t,e){const{doublePrecision:r,settings:i,value:s,size:l}=t,h=r&&s instanceof Float64Array?2:1;let a=0;const{shaderAttributes:v}=t.settings;if(v)for(const T of Object.values(v))a=Math.max(a,T.vertexOffset??0);return(i.noAlloc?s.length:(e+a)*l)*h}function W4({device:t,source:e,target:r}){return(!r||r.byteLength<e.byteLength)&&(r?.destroy(),r=t.createBuffer({byteLength:e.byteLength,usage:e.usage})),r}function q4({device:t,buffer:e,attribute:r,fromLength:i,toLength:s,fromStartIndices:l,getData:h=a=>a}){const a=r.doublePrecision&&r.value instanceof Float64Array?2:1,v=r.size*a,T=r.byteOffset,C=r.settings.bytesPerElement<4?T/r.settings.bytesPerElement*4:T,k=r.startIndices,L=l&&k,O=r.isConstant;if(!L&&e&&i>=s)return e;const K=r.value instanceof Float64Array?Float32Array:r.value.constructor,$=O?r.value:new K(r.getBuffer().readSyncWebGL(T,s*K.BYTES_PER_ELEMENT).buffer);if(r.settings.normalized&&!O){const ue=h;h=(we,De)=>r.normalizeConstant(ue(we,De))}const ne=O?(ue,we)=>h($,we):(ue,we)=>h($.subarray(ue+T,ue+T+v),we),oe=e?new Float32Array(e.readSyncWebGL(C,i*4).buffer):new Float32Array(0),fe=new Float32Array(s);return jY({source:oe,target:fe,sourceStartIndices:l,targetStartIndices:k,size:v,getData:ne}),(!e||e.byteLength<fe.byteLength+C)&&(e?.destroy(),e=t.createBuffer({byteLength:fe.byteLength+C,usage:35050})),e.write(fe,C),e}class $4{constructor({device:e,attribute:r,timeline:i}){this.buffers=[],this.currentLength=0,this.device=e,this.transition=new S1(i),this.attribute=r,this.attributeInTransition=VY(r),this.currentStartIndices=r.startIndices}get inProgress(){return this.transition.inProgress}start(e,r,i=1/0){this.settings=e,this.currentStartIndices=this.attribute.startIndices,this.currentLength=GY(this.attribute,r),this.transition.start({...e,duration:i})}update(){const e=this.transition.update();return e&&this.onUpdate(),e}setBuffer(e){this.attributeInTransition.setData({buffer:e,normalized:this.attribute.settings.normalized,value:this.attributeInTransition.value})}cancel(){this.transition.cancel()}delete(){this.cancel();for(const e of this.buffers)e.destroy();this.buffers.length=0}}class HY extends $4{constructor({device:e,attribute:r,timeline:i}){super({device:e,attribute:r,timeline:i}),this.type="interpolation",this.transform=$Y(e,r)}start(e,r){const i=this.currentLength,s=this.currentStartIndices;if(super.start(e,r,e.duration),e.duration<=0){this.transition.cancel();return}const{buffers:l,attribute:h}=this;H4(l),l[0]=q4({device:this.device,buffer:l[0],attribute:h,fromLength:i,toLength:this.currentLength,fromStartIndices:s,getData:e.enter}),l[1]=W4({device:this.device,source:l[0],target:l[1]}),this.setBuffer(l[1]);const{transform:a}=this,v=a.model;let T=Math.floor(this.currentLength/h.size);Z4(h)&&(T/=2),v.setVertexCount(T),h.isConstant?(v.setAttributes({aFrom:l[0]}),v.setConstantAttributes({aTo:h.value})):v.setAttributes({aFrom:l[0],aTo:h.getBuffer()}),a.transformFeedback.setBuffers({vCurrent:l[1]})}onUpdate(){const{duration:e,easing:r}=this.settings,{time:i}=this.transition;let s=i/e;r&&(s=r(s));const{model:l}=this.transform;l.setUniforms({time:s}),this.transform.run({discard:!0})}delete(){super.delete(),this.transform.destroy()}}const WY=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

uniform float time;
in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, time);
  gl_Position = vec4(0.0);
}
`,qY=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

uniform float time;
in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aFrom64Low;
in ATTRIBUTE_TYPE aTo;
in ATTRIBUTE_TYPE aTo64Low;
out ATTRIBUTE_TYPE vCurrent;
out ATTRIBUTE_TYPE vCurrent64Low;

vec2 mix_fp64(vec2 a, vec2 b, float x) {
  vec2 range = sub_fp64(b, a);
  return sum_fp64(a, mul_fp64(range, vec2(x, 0.0)));
}

void main(void) {
  for (int i=0; i<ATTRIBUTE_SIZE; i++) {
    vec2 value = mix_fp64(vec2(aFrom[i], aFrom64Low[i]), vec2(aTo[i], aTo64Low[i]), time);
    vCurrent[i] = value.x;
    vCurrent64Low[i] = value.y;
  }
  gl_Position = vec4(0.0);
}
`;function Z4(t){return t.doublePrecision&&t.value instanceof Float64Array}function $Y(t,e){const r=e.size,i=V4(r),s=G4(r),l=e.getBufferLayout();return Z4(e)?new x_(t,{vs:qY,bufferLayout:[{name:"aFrom",byteStride:8*r,attributes:[{attribute:"aFrom",format:s,byteOffset:0},{attribute:"aFrom64Low",format:s,byteOffset:4*r}]},{name:"aTo",byteStride:8*r,attributes:[{attribute:"aTo",format:s,byteOffset:0},{attribute:"aTo64Low",format:s,byteOffset:4*r}]}],modules:[nW],defines:{ATTRIBUTE_TYPE:i,ATTRIBUTE_SIZE:r},moduleSettings:{},varyings:["vCurrent","vCurrent64Low"],bufferMode:35980,disableWarnings:!0}):new x_(t,{vs:WY,bufferLayout:[{name:"aFrom",format:s},{name:"aTo",format:l.attributes[0].format}],defines:{ATTRIBUTE_TYPE:i},varyings:["vCurrent"],disableWarnings:!0})}class ZY extends $4{constructor({device:e,attribute:r,timeline:i}){super({device:e,attribute:r,timeline:i}),this.type="spring",this.texture=JY(e),this.framebuffer=QY(e,this.texture),this.transform=YY(e,r)}start(e,r){const i=this.currentLength,s=this.currentStartIndices;super.start(e,r);const{buffers:l,attribute:h}=this;for(let v=0;v<2;v++)l[v]=q4({device:this.device,buffer:l[v],attribute:h,fromLength:i,toLength:this.currentLength,fromStartIndices:s,getData:e.enter});l[2]=W4({device:this.device,source:l[0],target:l[2]}),this.setBuffer(l[1]);const{model:a}=this.transform;a.setVertexCount(Math.floor(this.currentLength/h.size)),h.isConstant?a.setConstantAttributes({aTo:h.value}):a.setAttributes({aTo:h.getBuffer()})}onUpdate(){const{buffers:e,transform:r,framebuffer:i,transition:s}=this,l=this.settings;r.model.setAttributes({aPrev:e[0],aCur:e[1]}),r.transformFeedback.setBuffers({vNext:e[2]}),r.model.setUniforms({stiffness:l.stiffness,damping:l.damping}),r.run({framebuffer:i,discard:!1,parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]}),H4(e),this.setBuffer(e[1]),this.device.readPixelsToArrayWebGL(i)[0]>0||s.end()}delete(){super.delete(),this.transform.destroy(),this.texture.destroy(),this.framebuffer.destroy()}}const XY=`#version 300 es
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

uniform float stiffness;
uniform float damping;
in ATTRIBUTE_TYPE aPrev;
in ATTRIBUTE_TYPE aCur;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vNext;
out float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE spring = delta * stiffness;
  ATTRIBUTE_TYPE damper = velocity * -1.0 * damping;
  return spring + damper + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,KY=`#version 300 es
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

in float vIsTransitioningFlag;

out vec4 fragColor;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  fragColor = vec4(1.0);
}`;function YY(t,e){const r=V4(e.size),i=G4(e.size);return new x_(t,{vs:XY,fs:KY,bufferLayout:[{name:"aPrev",format:i},{name:"aCur",format:i},{name:"aTo",format:e.getBufferLayout().attributes[0].format}],varyings:["vNext"],defines:{ATTRIBUTE_TYPE:r},parameters:{depthCompare:"always",blendColorOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}})}function JY(t){return t.createTexture({data:new Uint8Array(4),format:"rgba8unorm",mipmaps:!1,width:1,height:1})}function QY(t,e){return t.createFramebuffer({id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,colorAttachments:[e]})}const eJ={interpolation:HY,spring:ZY};class tJ{constructor(e,{id:r,timeline:i}){if(!e)throw new Error("AttributeTransitionManager is constructed without device");this.id=r,this.device=e,this.timeline=i,this.transitions={},this.needsRedraw=!1,this.numInstances=1}finalize(){for(const e in this.transitions)this._removeTransition(e)}update({attributes:e,transitions:r,numInstances:i}){this.numInstances=i||1;for(const s in e){const l=e[s],h=l.getTransitionSetting(r);h&&this._updateAttribute(s,l,h)}for(const s in this.transitions){const l=e[s];(!l||!l.getTransitionSetting(r))&&this._removeTransition(s)}}hasAttribute(e){const r=this.transitions[e];return r&&r.inProgress}getAttributes(){const e={};for(const r in this.transitions){const i=this.transitions[r];i.inProgress&&(e[r]=i.attributeInTransition)}return e}run(){if(this.numInstances===0)return!1;for(const r in this.transitions)this.transitions[r].update()&&(this.needsRedraw=!0);const e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].delete(),delete this.transitions[e]}_updateAttribute(e,r,i){const s=this.transitions[e];let l=!s||s.type!==i.type;if(l){s&&this._removeTransition(e);const h=eJ[i.type];h?this.transitions[e]=new h({attribute:r,timeline:this.timeline,device:this.device}):(li.error(`unsupported transition type '${i.type}'`)(),l=!1)}(l||r.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(i,this.numInstances))}}const KS="attributeManager.invalidate",rJ="attributeManager.updateStart",iJ="attributeManager.updateEnd",nJ="attribute.updateStart",sJ="attribute.allocate",oJ="attribute.updateEnd";class aJ{constructor(e,{id:r="attribute-manager",stats:i,timeline:s}={}){this.mergeBoundsMemoized=F_(G$),this.id=r,this.device=e,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=i,this.attributeTransitionManager=new tJ(e,{id:`${r}-transitions`,timeline:s}),Object.seal(this)}finalize(){for(const e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(e={clearRedrawFlags:!1}){const r=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,r&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(e){this._add(e)}addInstanced(e){this._add(e,{stepMode:"instance"})}remove(e){for(const r of e)this.attributes[r]!==void 0&&(this.attributes[r].delete(),delete this.attributes[r])}invalidate(e,r){const i=this._invalidateTrigger(e,r);po(KS,this,e,i)}invalidateAll(e){for(const r in this.attributes)this.attributes[r].setNeedsUpdate(r,e);po(KS,this,"all")}update({data:e,numInstances:r,startIndices:i=null,transitions:s,props:l={},buffers:h={},context:a={}}){let v=!1;po(rJ,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const T in this.attributes){const C=this.attributes[T],k=C.settings.accessor;C.startIndices=i,C.numInstances=r,l[T]&&li.removed(`props.${T}`,`data.attributes.${T}`)(),C.setExternalBuffer(h[T])||C.setBinaryValue(typeof k=="string"?h[k]:void 0,e.startIndices)||typeof k=="string"&&!h[k]&&C.setConstantValue(l[k])||C.needsUpdate()&&(v=!0,this._updateAttribute({attribute:C,numInstances:r,data:e,props:l,context:a})),this.needsRedraw=this.needsRedraw||C.needsRedraw()}v&&po(iJ,this,r),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:r,transitions:s})}updateTransition(){const{attributeTransitionManager:e}=this,r=e.run();return this.needsRedraw=this.needsRedraw||r,r}getAttributes(){return{...this.attributes,...this.attributeTransitionManager.getAttributes()}}getBounds(e){const r=e.map(i=>this.attributes[i]?.getBounds());return this.mergeBoundsMemoized(r)}getChangedAttributes(e={clearChangedFlags:!1}){const{attributes:r,attributeTransitionManager:i}=this,s={...i.getAttributes()};for(const l in r){const h=r[l];h.needsRedraw(e)&&!i.hasAttribute(l)&&(s[l]=h)}return s}getBufferLayouts(e){return Object.values(this.getAttributes()).map(r=>r.getBufferLayout(e))}_add(e,r){for(const i in e){const s=e[i],l={...s,id:i,size:s.isIndexed&&1||s.size||1,...r};this.attributes[i]=new j4(this.device,l)}this._mapUpdateTriggersToAttributes()}_mapUpdateTriggersToAttributes(){const e={};for(const r in this.attributes)this.attributes[r].getUpdateTriggers().forEach(i=>{e[i]||(e[i]=[]),e[i].push(r)});this.updateTriggers=e}_invalidateTrigger(e,r){const{attributes:i,updateTriggers:s}=this,l=s[e];return l&&l.forEach(h=>{const a=i[h];a&&a.setNeedsUpdate(a.id,r)}),l}_updateAttribute(e){const{attribute:r,numInstances:i}=e;if(po(nJ,r),r.constant){r.setConstantValue(r.value);return}r.allocate(i)&&po(sJ,r,i),r.updateBuffer(e)&&(this.needsRedraw=!0,po(oJ,r,i))}}class lJ extends S1{get value(){return this._value}_onUpdate(){const{time:e,settings:{fromValue:r,toValue:i,duration:s,easing:l}}=this,h=l(e/s);this._value=q0(r,i,h)}}const YS=1e-5;function JS(t,e,r,i,s){const l=e-t,h=(r-e)*s,a=-l*i;return h+a+l+e}function cJ(t,e,r,i,s){if(Array.isArray(r)){const l=[];for(let h=0;h<r.length;h++)l[h]=JS(t[h],e[h],r[h],i,s);return l}return JS(t,e,r,i,s)}function QS(t,e){if(Array.isArray(t)){let r=0;for(let i=0;i<t.length;i++){const s=t[i]-e[i];r+=s*s}return Math.sqrt(r)}return Math.abs(t-e)}class uJ extends S1{get value(){return this._currValue}_onUpdate(){const{fromValue:e,toValue:r,damping:i,stiffness:s}=this.settings,{_prevValue:l=e,_currValue:h=e}=this;let a=cJ(l,h,r,i,s);const v=QS(a,r),T=QS(a,h);v<YS&&T<YS&&(a=r,this.end()),this._prevValue=h,this._currValue=a}}const hJ={interpolation:lJ,spring:uJ};class dJ{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,r,i,s){const{transitions:l}=this;if(l.has(e)){const v=l.get(e),{value:T=v.settings.fromValue}=v;r=T,this.remove(e)}if(s=U4(s),!s)return;const h=hJ[s.type];if(!h){li.error(`unsupported transition type '${s.type}'`)();return}const a=new h(this.timeline);a.start({...s,fromValue:r,toValue:i}),l.set(e,a)}remove(e){const{transitions:r}=this;r.has(e)&&(r.get(e).cancel(),r.delete(e))}update(){const e={};for(const[r,i]of this.transitions)i.update(),e[r]=i.value,i.inProgress||this.remove(r);return e}clear(){for(const e of this.transitions.keys())this.remove(e)}}function pJ(t){const e=t[od];for(const r in e){const i=e[r],{validate:s}=i;if(s&&!s(t[r],i))throw new Error(`Invalid prop ${r}: ${t[r]}`)}}function fJ(t,e){const r=X4({newProps:t,oldProps:e,propTypes:t[od],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),i=gJ(t,e);let s=!1;return i||(s=_J(t,e)),{dataChanged:i,propsChanged:r,updateTriggersChanged:s,extensionsChanged:yJ(t,e),transitionsChanged:mJ(t,e)}}function mJ(t,e){if(!t.transitions)return!1;const r={},i=t[od];let s=!1;for(const l in t.transitions){const h=i[l],a=h&&h.type;(a==="number"||a==="color"||a==="array")&&Xx(t[l],e[l],h)&&(r[l]=!0,s=!0)}return s?r:!1}function X4({newProps:t,oldProps:e,ignoreProps:r={},propTypes:i={},triggerName:s="props"}){if(e===t)return!1;if(typeof t!="object"||t===null)return`${s} changed shallowly`;if(typeof e!="object"||e===null)return`${s} changed shallowly`;for(const l of Object.keys(t))if(!(l in r)){if(!(l in e))return`${s}.${l} added`;const h=Xx(t[l],e[l],i[l]);if(h)return`${s}.${l} ${h}`}for(const l of Object.keys(e))if(!(l in r)){if(!(l in t))return`${s}.${l} dropped`;if(!Object.hasOwnProperty.call(t,l)){const h=Xx(t[l],e[l],i[l]);if(h)return`${s}.${l} ${h}`}}return!1}function Xx(t,e,r){let i=r&&r.equal;return i&&!i(t,e,r)||!i&&(i=t&&e&&t.equals,i&&!i.call(t,e))?"changed deeply":!i&&e!==t?"changed shallowly":null}function gJ(t,e){if(e===null)return"oldProps is null, initial diff";let r=!1;const{dataComparator:i,_dataDiff:s}=t;return i?i(t.data,e.data)||(r="Data comparator detected a change"):t.data!==e.data&&(r="A new data container was supplied"),r&&s&&(r=s(t.data,e.data)||r),r}function _J(t,e){if(e===null)return{all:!0};if("all"in t.updateTriggers&&eC(t,e,"all"))return{all:!0};const r={};let i=!1;for(const s in t.updateTriggers)s!=="all"&&eC(t,e,s)&&(r[s]=!0,i=!0);return i?r:!1}function yJ(t,e){if(e===null)return!0;const r=e.extensions,{extensions:i}=t;if(i===r)return!1;if(!r||!i||i.length!==r.length)return!0;for(let s=0;s<i.length;s++)if(!i[s].equals(r[s]))return!0;return!1}function eC(t,e,r){let i=t.updateTriggers[r];i=i??{};let s=e.updateTriggers[r];return s=s??{},X4({oldProps:s,newProps:i,triggerName:r})}const vJ="count(): argument not an object",bJ="count(): argument not a container";function xJ(t){if(!EJ(t))throw new Error(vJ);if(typeof t.count=="function")return t.count();if(Number.isFinite(t.size))return t.size;if(Number.isFinite(t.length))return t.length;if(wJ(t))return Object.keys(t).length;throw new Error(bJ)}function wJ(t){return t!==null&&typeof t=="object"&&t.constructor===Object}function EJ(t){return t!==null&&typeof t=="object"}function tC(t,e){if(!e)return t;const r={...t,...e};if("defines"in e&&(r.defines={...t.defines,...e.defines}),"modules"in e&&(r.modules=(t.modules||[]).concat(e.modules),e.modules.some(i=>i.name==="project64"))){const i=r.modules.findIndex(s=>s.name==="project32");i>=0&&r.modules.splice(i,1)}if("inject"in e)if(!t.inject)r.inject=e.inject;else{const i={...t.inject};for(const s in e.inject)i[s]=(i[s]||"")+e.inject[s];r.inject=i}return r}const AJ={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},Kx={};function TJ(t,e,r,i){if(r instanceof Va)return r;r.constructor&&r.constructor.name!=="Object"&&(r={data:r});let s=null;r.compressed&&(s={minFilter:"linear",mipmapFilter:r.data.length>1?"nearest":"linear"});const l=e.createTexture({...r,sampler:{...AJ,...s,...i}});return Kx[l.id]=t,l}function SJ(t,e){!e||!(e instanceof Va)||Kx[e.id]===t&&(e.delete(),delete Kx[e.id])}const CJ={boolean:{validate(t,e){return!0},equal(t,e,r){return!!t==!!e}},number:{validate(t,e){return Number.isFinite(t)&&(!("max"in e)||t<=e.max)&&(!("min"in e)||t>=e.min)}},color:{validate(t,e){return e.optional&&!t||Yx(t)&&(t.length===3||t.length===4)},equal(t,e,r){return sc(t,e,1)}},accessor:{validate(t,e){const r=Q0(t);return r==="function"||r===Q0(e.value)},equal(t,e,r){return typeof e=="function"?!0:sc(t,e,1)}},array:{validate(t,e){return e.optional&&!t||Yx(t)},equal(t,e,r){const{compare:i}=r,s=Number.isInteger(i)?i:i?1:0;return i?sc(t,e,s):t===e}},object:{equal(t,e,r){if(r.ignore)return!0;const{compare:i}=r,s=Number.isInteger(i)?i:i?1:0;return i?sc(t,e,s):t===e}},function:{validate(t,e){return e.optional&&!t||typeof t=="function"},equal(t,e,r){return!r.compare&&r.ignore!==!1||t===e}},data:{transform:(t,e,r)=>{if(!t)return t;const{dataTransform:i}=r.props;return i?i(t):typeof t.shape=="string"&&t.shape.endsWith("-table")&&Array.isArray(t.data)?t.data:t}},image:{transform:(t,e,r)=>{const i=r.context;return!i||!i.device?null:TJ(r.id,i.device,t,{...e.parameters,...r.props.textureParameters})},release:(t,e,r)=>{SJ(r.id,t)}}};function MJ(t){const e={},r={},i={};for(const[s,l]of Object.entries(t)){const h=l?.deprecatedFor;if(h)i[s]=Array.isArray(h)?h:[h];else{const a=PJ(s,l);e[s]=a,r[s]=a.value}}return{propTypes:e,defaultProps:r,deprecatedProps:i}}function PJ(t,e){switch(Q0(e)){case"object":return Fg(t,e);case"array":return Fg(t,{type:"array",value:e,compare:!1});case"boolean":return Fg(t,{type:"boolean",value:e});case"number":return Fg(t,{type:"number",value:e});case"function":return Fg(t,{type:"function",value:e,compare:!0});default:return{name:t,type:"unknown",value:e}}}function Fg(t,e){return"type"in e?{name:t,...CJ[e.type],...e}:"value"in e?{name:t,type:Q0(e.value),...e}:{name:t,type:"object",value:e}}function Yx(t){return Array.isArray(t)||ArrayBuffer.isView(t)}function Q0(t){return Yx(t)?"array":t===null?"null":typeof t}function RJ(t,e){let r;for(let l=e.length-1;l>=0;l--){const h=e[l];"extensions"in h&&(r=h.extensions)}const i=Jx(t.constructor,r),s=Object.create(i);s[Y0]=t,s[$p]={},s[id]={};for(let l=0;l<e.length;++l){const h=e[l];for(const a in h)s[a]=h[a]}return Object.freeze(s),s}const IJ="_mergedDefaultProps";function Jx(t,e){if(!(t instanceof R1.constructor))return{};let r=IJ;if(e)for(const s of e){const l=s.constructor;l&&(r+=`:${l.extensionName||l.name}`)}return K4(t,r)||(t[r]=kJ(t,e||[]))}function kJ(t,e){if(!t.prototype)return null;const r=Object.getPrototypeOf(t),i=Jx(r),s=K4(t,"defaultProps")||{},l=MJ(s),h=Object.assign(Object.create(null),i,l.defaultProps),a=Object.assign(Object.create(null),i?.[od],l.propTypes),v=Object.assign(Object.create(null),i?.[ob],l.deprecatedProps);for(const T of e){const C=Jx(T.constructor);C&&(Object.assign(h,C),Object.assign(a,C[od]),Object.assign(v,C[ob]))}return BJ(h,t),DJ(h,a),LJ(h,v),h[od]=a,h[ob]=v,e.length===0&&!tE(t,"_propTypes")&&(t._propTypes=a),h}function BJ(t,e){const r=OJ(e);Object.defineProperties(t,{id:{writable:!0,value:r}})}function LJ(t,e){for(const r in e)Object.defineProperty(t,r,{enumerable:!1,set(i){const s=`${this.id}: ${r}`;for(const l of e[r])tE(this,l)||(this[l]=i);li.deprecated(s,e[r].join("/"))()}})}function DJ(t,e){const r={},i={};for(const s in e){const l=e[s],{name:h,value:a}=l;l.async&&(r[h]=a,i[h]=NJ(h))}t[dm]=r,t[$p]={},Object.defineProperties(t,i)}function NJ(t){return{enumerable:!0,set(e){typeof e=="string"||e instanceof Promise||z4(e)?this[$p][t]=e:this[id][t]=e},get(){if(this[id]){if(t in this[id])return this[id][t]||this[dm][t];if(t in this[$p]){const e=this[Y0]&&this[Y0].internalState;if(e&&e.hasAsyncProp(t))return e.getAsyncProp(t)||this[dm][t]}}return this[dm][t]}}}function tE(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function K4(t,e){return tE(t,e)&&t[e]}function OJ(t){const e=t.componentName;return e||li.warn(`${t.name}.componentName not specified`)(),e||t.name}let FJ=0;class R1{constructor(...e){this.props=RJ(this,e),this.id=this.props.id,this.count=FJ++}clone(e){const{props:r}=this,i={};for(const s in r[dm])s in r[id]?i[s]=r[id][s]:s in r[$p]&&(i[s]=r[$p][s]);return new this.constructor({...r,...i,...e})}}R1.componentName="Component";R1.defaultProps={};const zJ=Object.freeze({});class UJ{constructor(e){this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const e in this.asyncProps){const r=this.asyncProps[e];r&&r.type&&r.type.release&&r.type.release(r.resolvedValue,r.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||zJ}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){const r=this.asyncProps[e];return r&&r.resolvedValue}isAsyncPropLoading(e){if(e){const r=this.asyncProps[e];return!!(r&&r.pendingLoadCount>0&&r.pendingLoadCount!==r.resolvedLoadCount)}for(const r in this.asyncProps)if(this.isAsyncPropLoading(r))return!0;return!1}reloadAsyncProp(e,r){this._watchPromise(e,Promise.resolve(r))}setAsyncProps(e){this.component=e[Y0]||this.component;const r=e[id]||{},i=e[$p]||e,s=e[dm]||{};for(const l in r){const h=r[l];this._createAsyncPropData(l,s[l]),this._updateAsyncProp(l,h),r[l]=this.getAsyncProp(l)}for(const l in i){const h=i[l];this._createAsyncPropData(l,s[l]),this._updateAsyncProp(l,h)}}_fetch(e,r){return null}_onResolve(e,r){}_onError(e,r){}_updateAsyncProp(e,r){if(this._didAsyncInputValueChange(e,r)){if(typeof r=="string"&&(r=this._fetch(e,r)),r instanceof Promise){this._watchPromise(e,r);return}if(z4(r)){this._resolveAsyncIterable(e,r);return}this._setPropValue(e,r)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}_didAsyncInputValueChange(e,r){const i=this.asyncProps[e];return r===i.resolvedValue||r===i.lastValue?!1:(i.lastValue=r,!0)}_setPropValue(e,r){this._freezeAsyncOldProps();const i=this.asyncProps[e];i&&(r=this._postProcessValue(i,r),i.resolvedValue=r,i.pendingLoadCount++,i.resolvedLoadCount=i.pendingLoadCount)}_setAsyncPropValue(e,r,i){const s=this.asyncProps[e];s&&i>=s.resolvedLoadCount&&r!==void 0&&(this._freezeAsyncOldProps(),s.resolvedValue=r,s.resolvedLoadCount=i,this.onAsyncPropUpdated(e,r))}_watchPromise(e,r){const i=this.asyncProps[e];if(i){i.pendingLoadCount++;const s=i.pendingLoadCount;r.then(l=>{this.component&&(l=this._postProcessValue(i,l),this._setAsyncPropValue(e,l,s),this._onResolve(e,l))}).catch(l=>{this._onError(e,l)})}}async _resolveAsyncIterable(e,r){if(e!=="data"){this._setPropValue(e,r);return}const i=this.asyncProps[e];if(!i)return;i.pendingLoadCount++;const s=i.pendingLoadCount;let l=[],h=0;for await(const a of r){if(!this.component)return;const{dataTransform:v}=this.component.props;v?l=v(a,l):l=l.concat(a),Object.defineProperty(l,"__diff",{enumerable:!1,value:[{startRow:h,endRow:l.length}]}),h=l.length,this._setAsyncPropValue(e,l,s)}this._onResolve(e,l)}_postProcessValue(e,r){const i=e.type;return i&&this.component&&(i.release&&i.release(e.resolvedValue,i,this.component),i.transform)?i.transform(r,i,this.component):r}_createAsyncPropData(e,r){if(!this.asyncProps[e]){const i=this.component&&this.component.props[od];this.asyncProps[e]={type:i&&i[e],lastValue:null,resolvedValue:r,pendingLoadCount:0,resolvedLoadCount:0}}}}class jJ extends UJ{constructor({attributeManager:e,layer:r}){super(r),this.attributeManager=e,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(e,r){const i=this.layer,s=i?.props.fetch;return s?s(r,{propName:e,layer:i}):super._fetch(e,r)}_onResolve(e,r){const i=this.layer;if(i){const s=i.props.onDataLoad;e==="data"&&s&&s(r,{propName:e,layer:i})}}_onError(e,r){const i=this.layer;i&&i.raiseError(r,`loading ${e} of ${this.layer}`)}}const VJ="layer.changeFlag",GJ="layer.initialize",HJ="layer.update",WJ="layer.finalize",qJ="layer.matched",rC=2**24-1,$J=Object.freeze([]),ZJ=F_(({oldViewport:t,viewport:e})=>t.equals(e));let Qc=new Uint8ClampedArray(0);const XJ={data:{type:"data",value:$J,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:t=>t&&t.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(t,{propName:e,layer:r,loaders:i,loadOptions:s,signal:l})=>{const{resourceManager:h}=r.context;s=s||r.getLoadOptions(),i=i||r.props.loaders,l&&(s={...s,fetch:{...s?.fetch,signal:l}});let a=h.contains(t);return!a&&!s&&(h.add({resourceId:t,data:hd(t,i),persistent:!1}),a=!0),a?h.subscribe({resourceId:t,onChange:v=>r.internalState?.reloadAsyncProp(e,v),consumerId:r.id,requestId:e}):hd(t,i,s)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:Kr.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:({layerIndex:t})=>[0,-t*100]},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class Fm extends R1{constructor(){super(...arguments),this.internalState=null,this.lifecycle=Hf.NO_STATE,this.parent=null}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let e=this;for(;e.parent;)e=e.parent;return e}toString(){return`${this.constructor.layerName||this.constructor.name}({id: '${this.props.id}'})`}project(e){ys(this.internalState);const r=this.internalState.viewport||this.context.viewport,i=m4(e,{viewport:r,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[s,l,h]=d4(i,r.pixelProjectionMatrix);return e.length===2?[s,l]:[s,l,h]}unproject(e){return ys(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(e)}projectPosition(e,r){ys(this.internalState);const i=this.internalState.viewport||this.context.viewport;return X$(e,{viewport:i,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...r})}get isComposite(){return!1}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){const e=this.state;return e&&(e.models||e.model&&[e.model])||[]}setModuleParameters(e){for(const r of this.getModels())r.updateModuleSettings(e)}setShaderModuleProps(...e){for(const r of this.getModels())r.shaderInputs.setProps(...e)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:e}=this.props;return e===Kr.DEFAULT||e===Kr.LNGLAT||e===Kr.CARTESIAN}onHover(e,r){return this.props.onHover&&this.props.onHover(e,r)||!1}onClick(e,r){return this.props.onClick&&this.props.onClick(e,r)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(e,r=[]){return r[0]=e+1&255,r[1]=e+1>>8&255,r[2]=e+1>>8>>8&255,r}decodePickingColor(e){ys(e instanceof Uint8Array);const[r,i,s]=e;return r+i*256+s*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:xJ(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){return this.getAttributeManager()?.getBounds(["positions","instancePositions"])}getShaders(e){e=tC(e,{disableWarnings:!0,modules:this.context.defaultShaderModules});for(const r of this.props.extensions)e=tC(e,r.getShaders.call(this,r));return e}shouldUpdateState(e){return e.changeFlags.propsOrDataChanged}updateState(e){const r=this.getAttributeManager(),{dataChanged:i}=e.changeFlags;if(i&&r)if(Array.isArray(i))for(const s of i)r.invalidateAll(s);else r.invalidateAll();if(r){const{props:s}=e,l=this.internalState.hasPickingBuffer,h=Number.isInteger(s.highlightedObjectIndex)||s.pickable||s.extensions.some(a=>a.getNeedsPickingBuffer.call(this,a));if(l!==h){this.internalState.hasPickingBuffer=h;const{pickingColors:a,instancePickingColors:v}=r.attributes,T=a||v;T&&(h&&T.constant&&(T.constant=!1,r.invalidate(T.id)),!T.value&&!h&&(T.constant=!0,T.value=[0,0,0]))}}}finalizeState(e){for(const i of this.getModels())i.destroy();const r=this.getAttributeManager();r&&r.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(e){for(const r of this.getModels())r.draw(e)}getPickingInfo({info:e,mode:r,sourceLayer:i}){const{index:s}=e;return s>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[s]),e}raiseError(e,r){r&&(e=new Error(`${r}: ${e.message}`,{cause:e})),this.props.onError?.(e)||this.context?.onError?.(e,this)}getNeedsRedraw(e={clearRedrawFlags:!1}){return this._getNeedsRedraw(e)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){return this.internalState?.uniformTransitions.active||!1}activateViewport(e){if(!this.internalState)return;const r=this.internalState.viewport;this.internalState.viewport=e,(!r||!ZJ({oldViewport:r,viewport:e}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(e="all"){const r=this.getAttributeManager();r&&(e==="all"?r.invalidateAll():r.invalidate(e))}updateAttributes(e){let r=!1;for(const i in e)e[i].layoutChanged()&&(r=!0);for(const i of this.getModels())this._setModelAttributes(i,e,r)}_updateAttributes(){const e=this.getAttributeManager();if(!e)return;const r=this.props,i=this.getNumInstances(),s=this.getStartIndices();e.update({data:r.data,numInstances:i,startIndices:s,props:r,transitions:r.transitions,buffers:r.data.attributes,context:this});const l=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(l)}_updateAttributeTransition(){const e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){const{uniformTransitions:e}=this.internalState;if(e.active){const r=e.update(),i=Object.create(this.props);for(const s in r)Object.defineProperty(i,s,{value:r[s]});return i}return this.props}calculateInstancePickingColors(e,{numInstances:r}){if(e.constant)return;const i=Math.floor(Qc.length/4);if(this.internalState.usesPickingColorCache=!0,i<r){r>rC&&li.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),Qc=b_.allocate(Qc,r,{size:4,copy:!0,maxCount:Math.max(r,rC)});const s=Math.floor(Qc.length/4),l=[];for(let h=i;h<s;h++)this.encodePickingColor(h,l),Qc[h*4+0]=l[0],Qc[h*4+1]=l[1],Qc[h*4+2]=l[2]}e.value=Qc.subarray(0,r*4)}_setModelAttributes(e,r,i=!1){if(!Object.keys(r).length)return;if(i){const a=this.getAttributeManager();e.setBufferLayout(a.getBufferLayouts(e)),r=a.getAttributes()}const s=e.userData?.excludeAttributes||{},l={},h={};for(const a in r){if(s[a])continue;const v=r[a].getValue();for(const T in v){const C=v[T];C instanceof Ji?r[a].settings.isIndexed?e.setIndexBuffer(C):l[T]=C:C&&(h[T]=C)}}e.setAttributes(l),e.setConstantAttributes(h)}disablePickingIndex(e){const r=this.props.data;if(!("attributes"in r)){this._disablePickingIndex(e);return}const{pickingColors:i,instancePickingColors:s}=this.getAttributeManager().attributes,l=i||s,h=l&&r.attributes&&r.attributes[l.id];if(h&&h.value){const a=h.value,v=this.encodePickingColor(e);for(let T=0;T<r.length;T++){const C=l.getVertexOffset(T);a[C]===v[0]&&a[C+1]===v[1]&&a[C+2]===v[2]&&this._disablePickingIndex(T)}}else this._disablePickingIndex(e)}_disablePickingIndex(e){const{pickingColors:r,instancePickingColors:i}=this.getAttributeManager().attributes,s=r||i;if(!s)return;const l=s.getVertexOffset(e),h=s.getVertexOffset(e+1);s.buffer.write(new Uint8Array(h-l),l)}restorePickingColors(){const{pickingColors:e,instancePickingColors:r}=this.getAttributeManager().attributes,i=e||r;i&&(this.internalState.usesPickingColorCache&&i.value.buffer!==Qc.buffer&&(i.value=Qc.subarray(0,i.value.length)),i.updateSubBuffer({startOffset:0}))}_initialize(){ys(!this.internalState),ys(Number.isFinite(this.props.coordinateSystem)),po(GJ,this);const e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:"uint8",size:4,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new jJ({attributeManager:e,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(li.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),e)}),this.internalState.uniformTransitions=new dJ(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const r of this.props.extensions)r.initializeState.call(this,this.context,r);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(e){po(qJ,this,this===e);const{state:r,internalState:i}=e;this!==e&&(this.internalState=i,this.state=r,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const e=this.needsUpdate();if(po(HJ,this,e),!e)return;const r=this.props,i=this.context,s=this.internalState,l=i.viewport,h=this._updateUniformTransition();s.propsInTransition=h,i.viewport=s.viewport||l,this.props=h;try{const a=this._getUpdateParams(),v=this.getModels();if(i.device)this.updateState(a);else try{this.updateState(a)}catch{}for(const C of this.props.extensions)C.updateState.call(this,a,C);const T=this.getModels()[0]!==v[0];this._postUpdate(a,T)}finally{i.viewport=l,this.props=r,this._clearChangeFlags(),s.needsUpdate=!1,s.resetOldProps()}}_finalize(){po(WJ,this),this.finalizeState(this.context);for(const e of this.props.extensions)e.finalizeState.call(this,this.context,e)}_drawLayer({renderPass:e,moduleParameters:r=null,uniforms:i={},parameters:s={}}){this._updateAttributeTransition();const l=this.props,h=this.context;this.props=this.internalState.propsInTransition||l;const a=this.props.opacity;i.opacity=Math.pow(a,1/2.2);try{if(r){const{isActive:C,isAttribute:k}=r.picking;this.setModuleParameters(r),this.setShaderModuleProps({picking:{isActive:C,isAttribute:k}})}const{getPolygonOffset:v}=this.props,T=v&&v(i)||[0,0];h.device.setParametersWebGL({polygonOffset:T});for(const C of this.getModels())C.setParameters(s);h.device.withParametersWebGL(s,()=>{const C={renderPass:e,moduleParameters:r,uniforms:i,parameters:s,context:h};for(const k of this.props.extensions)k.draw.call(this,C,k);this.draw(C)})}finally{this.props=l}}getChangeFlags(){return this.internalState?.changeFlags}setChangeFlags(e){if(!this.internalState)return;const{changeFlags:r}=this.internalState;for(const s in e)if(e[s]){let l=!1;switch(s){case"dataChanged":const h=e[s],a=r[s];h&&Array.isArray(a)&&(r.dataChanged=Array.isArray(h)?a.concat(h):h,l=!0);default:r[s]||(r[s]=e[s],l=!0)}l&&po(VJ,this,s,e)}const i=!!(r.dataChanged||r.updateTriggersChanged||r.propsChanged||r.extensionsChanged);r.propsOrDataChanged=i,r.somethingChanged=i||r.viewportChanged||r.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(e,r){const i=fJ(e,r);if(i.updateTriggersChanged)for(const s in i.updateTriggersChanged)i.updateTriggersChanged[s]&&this.invalidateAttribute(s);if(i.transitionsChanged)for(const s in i.transitionsChanged)this.internalState.uniformTransitions.add(s,r[s],e[s],e.transitions?.[s]);return this.setChangeFlags(i)}validateProps(){pJ(this.props)}updateAutoHighlight(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){const r={highlightedObjectColor:e.picked?e.color:null},{highlightColor:i}=this.props;e.picked&&typeof i=="function"&&(r.highlightColor=i(e)),this.setShaderModuleProps({picking:r}),this.setNeedsRedraw()}_getAttributeManager(){const e=this.context;return new aJ(e.device,{id:this.props.id,stats:e.stats,timeline:e.timeline})}_postUpdate(e,r){const{props:i,oldProps:s}=e;this.setNeedsRedraw(),this._updateAttributes();const l=this.state.model;l?.isInstanced&&l.setInstanceCount(this.getNumInstances());const{autoHighlight:h,highlightedObjectIndex:a,highlightColor:v}=i;if(r||s.autoHighlight!==h||s.highlightedObjectIndex!==a||s.highlightColor!==v){const T={};Array.isArray(v)&&(T.highlightColor=v),(r||s.autoHighlight!==h||a!==s.highlightedObjectIndex)&&(T.highlightedObjectColor=Number.isFinite(a)&&a>=0?this.encodePickingColor(a):null),this.setShaderModuleProps({picking:T})}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let r=!1;r=r||this.internalState.needsRedraw&&this.id;const i=this.getAttributeManager(),s=i?i.getNeedsRedraw(e):!1;if(r=r||s,r)for(const l of this.props.extensions)l.onNeedsRedraw.call(this,l);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags,r}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}Fm.defaultProps=XJ;Fm.layerName="Layer";const KJ="compositeLayer.renderLayers";class Y4 extends Fm{get isComposite(){return!0}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(e=>e.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(e){}setState(e){super.setState(e),this.setNeedsUpdate()}getPickingInfo({info:e}){const{object:r}=e;return r&&r.__source&&r.__source.parent&&r.__source.parent.id===this.id&&(e.object=r.__source.object,e.index=r.__source.index),e}filterSubLayer(e){return!0}shouldRenderSubLayer(e,r){return r&&r.length}getSubLayerClass(e,r){const{_subLayerProps:i}=this.props;return i&&i[e]&&i[e].type||r}getSubLayerRow(e,r,i){return e.__source={parent:this,object:r,index:i},e}getSubLayerAccessor(e){if(typeof e=="function"){const r={index:-1,data:this.props.data,target:[]};return(i,s)=>i&&i.__source?(r.index=i.__source.index,e(i.__source.object,r)):e(i,s)}return e}getSubLayerProps(e={}){const{opacity:r,pickable:i,visible:s,parameters:l,getPolygonOffset:h,highlightedObjectIndex:a,autoHighlight:v,highlightColor:T,coordinateSystem:C,coordinateOrigin:k,wrapLongitude:L,positionFormat:O,modelMatrix:K,extensions:$,fetch:ne,operation:oe,_subLayerProps:fe}=this.props,ue={id:"",updateTriggers:{},opacity:r,pickable:i,visible:s,parameters:l,getPolygonOffset:h,highlightedObjectIndex:a,autoHighlight:v,highlightColor:T,coordinateSystem:C,coordinateOrigin:k,wrapLongitude:L,positionFormat:O,modelMatrix:K,extensions:$,fetch:ne,operation:oe},we=fe&&e.id&&fe[e.id],De=we&&we.updateTriggers,Fe=e.id||"sublayer";if(we){const Ke=this.props[od],ze=e.type?e.type._propTypes:{};for(const it in we){const lt=ze[it]||Ke[it];lt&&lt.type==="accessor"&&(we[it]=this.getSubLayerAccessor(we[it]))}}Object.assign(ue,e,we),ue.id=`${this.props.id}-${Fe}`,ue.updateTriggers={all:this.props.updateTriggers?.all,...e.updateTriggers,...De};for(const Ke of $){const ze=Ke.getSubLayerProps.call(this,Ke);ze&&Object.assign(ue,ze,{updateTriggers:Object.assign(ue.updateTriggers,ze.updateTriggers)})}return ue}_updateAutoHighlight(e){for(const r of this.getSubLayers())r.updateAutoHighlight(e)}_getAttributeManager(){return null}_postUpdate(e,r){let i=this.internalState.subLayers;const s=!i||this.needsUpdate();if(s){const l=this.renderLayers();i=wm(l,Boolean),this.internalState.subLayers=i}po(KJ,this,s,i);for(const l of i)l.parent=this}}Y4.layerName="CompositeLayer";const YJ=`#version 300 es
#define SHADER_NAME point-cloud-layer-vertex-shader
in vec3 positions;
in vec3 instanceNormals;
in vec4 instanceColors;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec3 instancePickingColors;
uniform float opacity;
uniform float radiusPixels;
uniform int sizeUnits;
out vec4 vColor;
out vec2 unitPosition;
void main(void) {
geometry.worldPosition = instancePositions;
geometry.normal = project_normal(instanceNormals);
unitPosition = positions.xy;
geometry.uv = unitPosition;
geometry.pickingColor = instancePickingColors;
vec3 offset = vec3(positions.xy * project_size_to_pixel(radiusPixels, sizeUnits), 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
vec3 lightColor = lighting_getLightColor(instanceColors.rgb, project_uCameraPosition, geometry.position.xyz, geometry.normal);
vColor = vec4(lightColor, instanceColors.a * opacity);
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,JJ=`#version 300 es
#define SHADER_NAME point-cloud-layer-fragment-shader
precision highp float;
in vec4 vColor;
in vec2 unitPosition;
out vec4 fragColor;
void main(void) {
geometry.uv = unitPosition;
float distToCenter = length(unitPosition);
if (distToCenter > 1.0) {
discard;
}
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,J4=[0,0,0,255],Q4=[0,0,1],QJ={sizeUnits:"pixels",pointSize:{type:"number",min:0,value:10},getPosition:{type:"accessor",value:t=>t.position},getNormal:{type:"accessor",value:Q4},getColor:{type:"accessor",value:J4},material:!0,radiusPixels:{deprecatedFor:"pointSize"}};function eQ(t){const{header:e,attributes:r}=t;if(!(!e||!r)&&(t.length=e.vertexCount,r.POSITION&&(r.instancePositions=r.POSITION),r.NORMAL&&(r.instanceNormals=r.NORMAL),r.COLOR_0)){const{size:i,value:s}=r.COLOR_0;r.instanceColors={size:i,type:"unorm8",value:s}}}class rE extends Fm{getShaders(){return super.getShaders({vs:YJ,fs:JJ,modules:[V2,Dq,W2]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceNormals:{size:3,transition:!0,accessor:"getNormal",defaultValue:Q4},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:J4}})}updateState(e){const{changeFlags:r,props:i}=e;super.updateState(e),r.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll()),r.dataChanged&&eQ(i.data)}draw({uniforms:e}){const{pointSize:r,sizeUnits:i}=this.props,s=this.state.model;s.setUniforms(e),s.setUniforms({sizeUnits:Dx[i],radiusPixels:r}),s.draw(this.context.renderPass)}_getModel(){const e=[];for(let r=0;r<3;r++){const i=r/3*Math.PI*2;e.push(Math.cos(i)*2,Math.sin(i)*2,0)}return new pd(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new um({topology:"triangle-list",attributes:{positions:new Float32Array(e)}}),isInstanced:!0})}}rE.layerName="PointCloudLayer";rE.defaultProps=QJ;const ja={OUTSIDE:-1,INTERSECTING:0,INSIDE:1};new Je;new Je;const zg=new Je,iC=new Je;class j_{constructor(e=[0,0,0],r=0){this.radius=-0,this.center=new Je,this.fromCenterRadius(e,r)}fromCenterRadius(e,r){return this.center.from(e),this.radius=r,this}fromCornerPoints(e,r){return r=zg.from(r),this.center=new Je().from(e).add(r).scale(.5),this.radius=this.center.distance(r),this}equals(e){return this===e||!!e&&this.center.equals(e.center)&&this.radius===e.radius}clone(){return new j_(this.center,this.radius)}union(e){const r=this.center,i=this.radius,s=e.center,l=e.radius,h=zg.copy(s).subtract(r),a=h.magnitude();if(i>=a+l)return this.clone();if(l>=a+i)return e.clone();const v=(i+a+l)*.5;return iC.copy(h).scale((-i+v)/a).add(r),this.center.copy(iC),this.radius=v,this}expand(e){const r=zg.from(e).subtract(this.center).magnitude();return r>this.radius&&(this.radius=r),this}transform(e){this.center.transform(e);const r=WW(zg,e);return this.radius=Math.max(r[0],Math.max(r[1],r[2]))*this.radius,this}distanceSquaredTo(e){const r=this.distanceTo(e);return r*r}distanceTo(e){const r=zg.from(e).subtract(this.center);return Math.max(0,r.len()-this.radius)}intersectPlane(e){const r=this.center,i=this.radius,s=e.normal.dot(r)+e.distance;return s<-i?ja.OUTSIDE:s<i?ja.INTERSECTING:ja.INSIDE}}const tQ=new Je,rQ=new Je,r0=new Je,i0=new Je,n0=new Je,iQ=new Je,nQ=new Je,Yu={COLUMN0ROW0:0,COLUMN0ROW1:1,COLUMN0ROW2:2,COLUMN1ROW0:3,COLUMN1ROW1:4,COLUMN1ROW2:5,COLUMN2ROW0:6,COLUMN2ROW1:7,COLUMN2ROW2:8};class V_{constructor(e=[0,0,0],r=[0,0,0,0,0,0,0,0,0]){this.center=new Je().from(e),this.halfAxes=new Sn(r)}get halfSize(){const e=this.halfAxes.getColumn(0),r=this.halfAxes.getColumn(1),i=this.halfAxes.getColumn(2);return[new Je(e).len(),new Je(r).len(),new Je(i).len()]}get quaternion(){const e=this.halfAxes.getColumn(0),r=this.halfAxes.getColumn(1),i=this.halfAxes.getColumn(2),s=new Je(e).normalize(),l=new Je(r).normalize(),h=new Je(i).normalize();return new y_().fromMatrix3(new Sn([...s,...l,...h]))}fromCenterHalfSizeQuaternion(e,r,i){const s=new y_(i),l=new Sn().fromQuaternion(s);return l[0]=l[0]*r[0],l[1]=l[1]*r[0],l[2]=l[2]*r[0],l[3]=l[3]*r[1],l[4]=l[4]*r[1],l[5]=l[5]*r[1],l[6]=l[6]*r[2],l[7]=l[7]*r[2],l[8]=l[8]*r[2],this.center=new Je().from(e),this.halfAxes=l,this}clone(){return new V_(this.center,this.halfAxes)}equals(e){return this===e||!!e&&this.center.equals(e.center)&&this.halfAxes.equals(e.halfAxes)}getBoundingSphere(e=new j_){const r=this.halfAxes,i=r.getColumn(0,r0),s=r.getColumn(1,i0),l=r.getColumn(2,n0),h=tQ.copy(i).add(s).add(l);return e.center.copy(this.center),e.radius=h.magnitude(),e}intersectPlane(e){const r=this.center,i=e.normal,s=this.halfAxes,l=i.x,h=i.y,a=i.z,v=Math.abs(l*s[Yu.COLUMN0ROW0]+h*s[Yu.COLUMN0ROW1]+a*s[Yu.COLUMN0ROW2])+Math.abs(l*s[Yu.COLUMN1ROW0]+h*s[Yu.COLUMN1ROW1]+a*s[Yu.COLUMN1ROW2])+Math.abs(l*s[Yu.COLUMN2ROW0]+h*s[Yu.COLUMN2ROW1]+a*s[Yu.COLUMN2ROW2]),T=i.dot(r)+e.distance;return T<=-v?ja.OUTSIDE:T>=v?ja.INSIDE:ja.INTERSECTING}distanceTo(e){return Math.sqrt(this.distanceSquaredTo(e))}distanceSquaredTo(e){const r=rQ.from(e).subtract(this.center),i=this.halfAxes,s=i.getColumn(0,r0),l=i.getColumn(1,i0),h=i.getColumn(2,n0),a=s.magnitude(),v=l.magnitude(),T=h.magnitude();s.normalize(),l.normalize(),h.normalize();let C=0,k;return k=Math.abs(r.dot(s))-a,k>0&&(C+=k*k),k=Math.abs(r.dot(l))-v,k>0&&(C+=k*k),k=Math.abs(r.dot(h))-T,k>0&&(C+=k*k),C}computePlaneDistances(e,r,i=[-0,-0]){let s=Number.POSITIVE_INFINITY,l=Number.NEGATIVE_INFINITY;const h=this.center,a=this.halfAxes,v=a.getColumn(0,r0),T=a.getColumn(1,i0),C=a.getColumn(2,n0),k=iQ.copy(v).add(T).add(C).add(h),L=nQ.copy(k).subtract(e);let O=r.dot(L);return s=Math.min(O,s),l=Math.max(O,l),k.copy(h).add(v).add(T).subtract(C),L.copy(k).subtract(e),O=r.dot(L),s=Math.min(O,s),l=Math.max(O,l),k.copy(h).add(v).subtract(T).add(C),L.copy(k).subtract(e),O=r.dot(L),s=Math.min(O,s),l=Math.max(O,l),k.copy(h).add(v).subtract(T).subtract(C),L.copy(k).subtract(e),O=r.dot(L),s=Math.min(O,s),l=Math.max(O,l),h.copy(k).subtract(v).add(T).add(C),L.copy(k).subtract(e),O=r.dot(L),s=Math.min(O,s),l=Math.max(O,l),h.copy(k).subtract(v).add(T).subtract(C),L.copy(k).subtract(e),O=r.dot(L),s=Math.min(O,s),l=Math.max(O,l),h.copy(k).subtract(v).subtract(T).add(C),L.copy(k).subtract(e),O=r.dot(L),s=Math.min(O,s),l=Math.max(O,l),h.copy(k).subtract(v).subtract(T).subtract(C),L.copy(k).subtract(e),O=r.dot(L),s=Math.min(O,s),l=Math.max(O,l),i[0]=s,i[1]=l,i}transform(e){this.center.transformAsPoint(e);const r=this.halfAxes.getColumn(0,r0);r.transformAsPoint(e);const i=this.halfAxes.getColumn(1,i0);i.transformAsPoint(e);const s=this.halfAxes.getColumn(2,n0);return s.transformAsPoint(e),this.halfAxes=new Sn([...r,...i,...s]),this}getTransform(){throw new Error("not implemented")}}const nC=new Je,sC=new Je;class tu{constructor(e=[0,0,1],r=0){this.normal=new Je,this.distance=-0,this.fromNormalDistance(e,r)}fromNormalDistance(e,r){return rc(Number.isFinite(r)),this.normal.from(e).normalize(),this.distance=r,this}fromPointNormal(e,r){e=nC.from(e),this.normal.from(r).normalize();const i=-this.normal.dot(e);return this.distance=i,this}fromCoefficients(e,r,i,s){return this.normal.set(e,r,i),rc(cc(this.normal.len(),1)),this.distance=s,this}clone(){return new tu(this.normal,this.distance)}equals(e){return cc(this.distance,e.distance)&&cc(this.normal,e.normal)}getPointDistance(e){return this.normal.dot(e)+this.distance}transform(e){const r=sC.copy(this.normal).transformAsVector(e).normalize(),i=this.normal.scale(-this.distance).transform(e);return this.fromPointNormal(i,r)}projectPointOntoPlane(e,r=[0,0,0]){const i=nC.from(e),s=this.getPointDistance(i),l=sC.copy(this.normal).scale(s);return i.subtract(l).to(r)}}const oC=[new Je([1,0,0]),new Je([0,1,0]),new Je([0,0,1])],aC=new Je,sQ=new Je;class xl{constructor(e=[]){this.planes=e}fromBoundingSphere(e){this.planes.length=2*oC.length;const r=e.center,i=e.radius;let s=0;for(const l of oC){let h=this.planes[s],a=this.planes[s+1];h||(h=this.planes[s]=new tu),a||(a=this.planes[s+1]=new tu);const v=aC.copy(l).scale(-i).add(r);h.fromPointNormal(v,l);const T=aC.copy(l).scale(i).add(r),C=sQ.copy(l).negate();a.fromPointNormal(T,C),s+=2}return this}computeVisibility(e){let r=ja.INSIDE;for(const i of this.planes)switch(e.intersectPlane(i)){case ja.OUTSIDE:return ja.OUTSIDE;case ja.INTERSECTING:r=ja.INTERSECTING;break}return r}computeVisibilityWithPlaneMask(e,r){if(rc(Number.isFinite(r),"parentPlaneMask is required."),r===xl.MASK_OUTSIDE||r===xl.MASK_INSIDE)return r;let i=xl.MASK_INSIDE;const s=this.planes;for(let l=0;l<this.planes.length;++l){const h=l<31?1<<l:0;if(l<31&&(r&h)===0)continue;const a=s[l],v=e.intersectPlane(a);if(v===ja.OUTSIDE)return xl.MASK_OUTSIDE;v===ja.INTERSECTING&&(i|=h)}return i}}xl.MASK_OUTSIDE=4294967295;xl.MASK_INSIDE=0;xl.MASK_INDETERMINATE=2147483647;new Je;new Je;new Je;new Je;new Je;new Je;new Je;new Je;new Je;new Je;new Je;new Je;new Je;new Je;new Je;new Je;new Je;const eu=new Sn,oQ=new Sn,aQ=new Sn,s0=new Sn,lC=new Sn;function lQ(t,e={}){const r=Rq,i=10;let s=0,l=0;const h=oQ,a=aQ;h.identity(),a.copy(t);const v=r*cQ(a);for(;l<i&&uQ(a)>v;)hQ(a,s0),lC.copy(s0).transpose(),a.multiplyRight(s0),a.multiplyLeft(lC),h.multiplyRight(s0),++s>2&&(++l,s=0);return e.unitary=h.toTarget(e.unitary),e.diagonal=a.toTarget(e.diagonal),e}function cQ(t){let e=0;for(let r=0;r<9;++r){const i=t[r];e+=i*i}return Math.sqrt(e)}const Qx=[1,0,0],ew=[2,2,1];function uQ(t){let e=0;for(let r=0;r<3;++r){const i=t[eu.getElementIndex(ew[r],Qx[r])];e+=2*i*i}return Math.sqrt(e)}function hQ(t,e){const r=t4;let i=0,s=1;for(let T=0;T<3;++T){const C=Math.abs(t[eu.getElementIndex(ew[T],Qx[T])]);C>i&&(s=T,i=C)}const l=Qx[s],h=ew[s];let a=1,v=0;if(Math.abs(t[eu.getElementIndex(h,l)])>r){const T=t[eu.getElementIndex(h,h)],C=t[eu.getElementIndex(l,l)],k=t[eu.getElementIndex(h,l)],L=(T-C)/2/k;let O;L<0?O=-1/(-L+Math.sqrt(1+L*L)):O=1/(L+Math.sqrt(1+L*L)),a=1/Math.sqrt(1+O*O),v=O*a}return Sn.IDENTITY.to(e),e[eu.getElementIndex(l,l)]=e[eu.getElementIndex(h,h)]=a,e[eu.getElementIndex(h,l)]=v,e[eu.getElementIndex(l,h)]=-v,e}const Kh=new Je,dQ=new Je,pQ=new Je,fQ=new Je,mQ=new Je,gQ=new Sn,_Q={diagonal:new Sn,unitary:new Sn};function yQ(t,e=new V_){if(!t||t.length===0)return e.halfAxes=new Sn([0,0,0,0,0,0,0,0,0]),e.center=new Je,e;const r=t.length,i=new Je(0,0,0);for(const it of t)i.add(it);const s=1/r;i.multiplyByScalar(s);let l=0,h=0,a=0,v=0,T=0,C=0;for(const it of t){const lt=Kh.copy(it).subtract(i);l+=lt.x*lt.x,h+=lt.x*lt.y,a+=lt.x*lt.z,v+=lt.y*lt.y,T+=lt.y*lt.z,C+=lt.z*lt.z}l*=s,h*=s,a*=s,v*=s,T*=s,C*=s;const k=gQ;k[0]=l,k[1]=h,k[2]=a,k[3]=h,k[4]=v,k[5]=T,k[6]=a,k[7]=T,k[8]=C;const{unitary:L}=lQ(k,_Q),O=e.halfAxes.copy(L);let K=O.getColumn(0,pQ),$=O.getColumn(1,fQ),ne=O.getColumn(2,mQ),oe=-Number.MAX_VALUE,fe=-Number.MAX_VALUE,ue=-Number.MAX_VALUE,we=Number.MAX_VALUE,De=Number.MAX_VALUE,Fe=Number.MAX_VALUE;for(const it of t)Kh.copy(it),oe=Math.max(Kh.dot(K),oe),fe=Math.max(Kh.dot($),fe),ue=Math.max(Kh.dot(ne),ue),we=Math.min(Kh.dot(K),we),De=Math.min(Kh.dot($),De),Fe=Math.min(Kh.dot(ne),Fe);K=K.multiplyByScalar(.5*(we+oe)),$=$.multiplyByScalar(.5*(De+fe)),ne=ne.multiplyByScalar(.5*(Fe+ue)),e.center.copy(K).add($).add(ne);const Ke=dQ.set(oe-we,fe-De,ue-Fe).multiplyByScalar(.5),ze=new Sn([Ke[0],0,0,0,Ke[1],0,0,0,Ke[2]]);return e.halfAxes.multiplyRight(ze),e}const yb=Math.PI/180,o0=new Float32Array(16),cC=new Float32Array(12);function uC(t,e,r){const i=e[0]*yb,s=e[1]*yb,l=e[2]*yb,h=Math.sin(l),a=Math.sin(i),v=Math.sin(s),T=Math.cos(l),C=Math.cos(i),k=Math.cos(s),L=r[0],O=r[1],K=r[2];t[0]=L*k*C,t[1]=L*v*C,t[2]=L*-a,t[3]=O*(-v*T+k*a*h),t[4]=O*(k*T+v*a*h),t[5]=O*C*h,t[6]=K*(v*h+k*a*T),t[7]=K*(-k*h+v*a*T),t[8]=K*C*T}function hC(t){return t[0]=t[0],t[1]=t[1],t[2]=t[2],t[3]=t[4],t[4]=t[5],t[5]=t[6],t[6]=t[8],t[7]=t[9],t[8]=t[10],t[9]=t[12],t[10]=t[13],t[11]=t[14],t.subarray(0,12)}const ek={size:12,accessor:["getOrientation","getScale","getTranslation","getTransformMatrix"],shaderAttributes:{instanceModelMatrixCol0:{size:3,elementOffset:0},instanceModelMatrixCol1:{size:3,elementOffset:3},instanceModelMatrixCol2:{size:3,elementOffset:6},instanceTranslation:{size:3,elementOffset:9}},update(t,{startRow:e,endRow:r}){const{data:i,getOrientation:s,getScale:l,getTranslation:h,getTransformMatrix:a}=this.props,v=Array.isArray(a),T=v&&a.length===16,C=Array.isArray(l),k=Array.isArray(s),L=Array.isArray(h),O=T||!v&&!!a(i[0]);O?t.constant=T:t.constant=k&&C&&L;const K=t.value;if(t.constant){let $;O?(o0.set(a),$=hC(o0)):($=cC,uC($,s,l),$.set(h,9)),t.value=new Float32Array($)}else{let $=e*t.size;const{iterable:ne,objectInfo:oe}=F4(i,e,r);for(const fe of ne){oe.index++;let ue;if(O)o0.set(T?a:a(fe,oe)),ue=hC(o0);else{ue=cC;const we=k?s:s(fe,oe),De=C?l:l(fe,oe);uC(ue,we,De),ue.set(L?h:h(fe,oe),9)}K[$++]=ue[0],K[$++]=ue[1],K[$++]=ue[2],K[$++]=ue[3],K[$++]=ue[4],K[$++]=ue[5],K[$++]=ue[6],K[$++]=ue[7],K[$++]=ue[8],K[$++]=ue[9],K[$++]=ue[10],K[$++]=ue[11]}}}};function tk(t,e){return e===Kr.CARTESIAN||e===Kr.METER_OFFSETS||e===Kr.DEFAULT&&!t.isGeospatial}const vQ=`#version 300 es
#define SHADER_NAME simple-mesh-layer-vs
uniform float sizeScale;
uniform bool composeModelMatrix;
in vec3 positions;
in vec3 normals;
in vec3 colors;
in vec2 texCoords;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec3 instanceModelMatrixCol0;
in vec3 instanceModelMatrixCol1;
in vec3 instanceModelMatrixCol2;
in vec3 instanceTranslation;
out vec2 vTexCoord;
out vec3 cameraPosition;
out vec3 normals_commonspace;
out vec4 position_commonspace;
out vec4 vColor;
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = texCoords;
geometry.pickingColor = instancePickingColors;
vTexCoord = texCoords;
cameraPosition = project_uCameraPosition;
vColor = vec4(colors * instanceColors.rgb, instanceColors.a);
mat3 instanceModelMatrix = mat3(instanceModelMatrixCol0, instanceModelMatrixCol1, instanceModelMatrixCol2);
vec3 pos = (instanceModelMatrix * positions) * sizeScale + instanceTranslation;
if (composeModelMatrix) {
DECKGL_FILTER_SIZE(pos, geometry);
normals_commonspace = project_normal(instanceModelMatrix * normals);
geometry.worldPosition += pos;
gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), position_commonspace);
geometry.position = position_commonspace;
}
else {
pos = project_size(pos);
DECKGL_FILTER_SIZE(pos, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, position_commonspace);
geometry.position = position_commonspace;
normals_commonspace = project_normal(instanceModelMatrix * normals);
}
geometry.normal = normals_commonspace;
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,bQ=`#version 300 es
#define SHADER_NAME simple-mesh-layer-fs
precision highp float;
uniform bool hasTexture;
uniform sampler2D sampler;
uniform bool flatShading;
uniform float opacity;
in vec2 vTexCoord;
in vec3 cameraPosition;
in vec3 normals_commonspace;
in vec4 position_commonspace;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
geometry.uv = vTexCoord;
vec3 normal;
if (flatShading) {
normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
} else {
normal = normals_commonspace;
}
vec4 color = hasTexture ? texture(sampler, vTexCoord) : vColor;
DECKGL_FILTER_COLOR(color, geometry);
vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);
fragColor = vec4(lightColor, color.a * opacity);
}
`;function vb(t){const e=t.positions||t.POSITION;li.assert(e,'no "postions" or "POSITION" attribute in mesh');const r=e.value.length/e.size;let i=t.COLOR_0||t.colors;i||(i={size:3,value:new Float32Array(r*3).fill(1)});let s=t.NORMAL||t.normals;s||(s={size:3,value:new Float32Array(r*3).fill(0)});let l=t.TEXCOORD_0||t.texCoords;return l||(l={size:2,value:new Float32Array(r*2).fill(0)}),{positions:e,colors:i,normals:s,texCoords:l}}function dC(t){return t instanceof um?(t.attributes=vb(t.attributes),t):t.attributes?new um({...t,topology:"triangle-list",attributes:vb(t.attributes)}):new um({topology:"triangle-list",attributes:vb(t)})}const xQ=[0,0,0,255],wQ={mesh:{type:"object",value:null,async:!0},texture:{type:"image",value:null,async:!0},sizeScale:{type:"number",value:1,min:0},_instanced:!0,wireframe:!1,material:!0,getPosition:{type:"accessor",value:t=>t.position},getColor:{type:"accessor",value:xQ},getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},textureParameters:{type:"object",ignore:!0,value:null}};class iE extends Fm{getShaders(){return super.getShaders({vs:vQ,fs:bQ,modules:[V2,Nq,W2]})}getBounds(){if(this.props._instanced)return super.getBounds();let e=this.state.positionBounds;if(e)return e;const{mesh:r}=this.props;if(!r)return null;if(e=r.header?.boundingBox,!e){const{attributes:i}=dC(r);i.POSITION=i.POSITION||i.positions,e=l5(i)}return this.state.positionBounds=e,e}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{transition:!0,type:"float64",fp64:this.use64bitPositions(),size:3,accessor:"getPosition"},instanceColors:{type:"unorm8",transition:!0,size:this.props.colorFormat.length,accessor:"getColor",defaultValue:[0,0,0,255]},instanceModelMatrix:ek}),this.setState({emptyTexture:this.context.device.createTexture({data:new Uint8Array(4),width:1,height:1})})}updateState(e){super.updateState(e);const{props:r,oldProps:i,changeFlags:s}=e;if(r.mesh!==i.mesh||s.extensionsChanged){if(this.state.positionBounds=null,this.state.model?.destroy(),r.mesh){this.state.model=this.getModel(r.mesh);const l=r.mesh.attributes||r.mesh;this.setState({hasNormals:!!(l.NORMAL||l.normals)})}this.getAttributeManager().invalidateAll()}r.texture!==i.texture&&r.texture instanceof Va&&this.setTexture(r.texture),this.state.model&&this.state.model.setTopology(this.props.wireframe?"line-strip":"triangle-list")}finalizeState(e){super.finalizeState(e),this.state.emptyTexture.delete()}draw({uniforms:e}){const{model:r}=this.state;if(!r)return;const{viewport:i,renderPass:s}=this.context,{sizeScale:l,coordinateSystem:h,_instanced:a}=this.props;r.setUniforms(e),r.setUniforms({sizeScale:l,composeModelMatrix:!a||tk(i,h),flatShading:!this.state.hasNormals}),r.draw(s)}get isLoaded(){return!!(this.state?.model&&super.isLoaded)}getModel(e){const r=new pd(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:dC(e),isInstanced:!0}),{texture:i}=this.props,{emptyTexture:s}=this.state;return r.setBindings({sampler:i||s}),r.setUniforms({hasTexture:!!i}),r}setTexture(e){const{emptyTexture:r,model:i}=this.state;i&&(i.setBindings({sampler:e||r}),i.setUniforms({hasTexture:!!e}))}}iE.defaultProps=wQ;iE.layerName="SimpleMeshLayer";var ic;(function(t){t[t.FUNC_ADD=32774]="FUNC_ADD",t[t.ONE=1]="ONE",t[t.SRC_ALPHA=770]="SRC_ALPHA",t[t.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",t[t.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",t[t.LINEAR=9729]="LINEAR",t[t.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",t[t.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL"})(ic||(ic={}));function rk(t,e,r,i){const s={defines:{MANUAL_SRGB:1,SRGB_FAST_APPROXIMATION:1},bindings:{},uniforms:{u_Camera:[0,0,0],u_MetallicRoughnessValues:[1,1]},parameters:{},glParameters:{},generatedTextures:[]};s.defines.USE_TEX_LOD=1;const{imageBasedLightingEnvironment:l}=i;return l&&(s.bindings.u_DiffuseEnvSampler=l.diffuseEnvSampler,s.bindings.u_SpecularEnvSampler=l.specularEnvSampler,s.bindings.u_brdfLUT=l.brdfLutTexture,s.uniforms.u_ScaleIBLAmbient=[1,1]),i?.pbrDebug&&(s.defines.PBR_DEBUG=1,s.uniforms.u_ScaleDiffBaseMR=[0,0,0,0],s.uniforms.u_ScaleFGDSpec=[0,0,0,0]),r.NORMAL&&(s.defines.HAS_NORMALS=1),r.TANGENT&&i?.useTangents&&(s.defines.HAS_TANGENTS=1),r.TEXCOORD_0&&(s.defines.HAS_UV=1),i?.imageBasedLightingEnvironment&&(s.defines.USE_IBL=1),i?.lights&&(s.defines.USE_LIGHTS=1),e&&EQ(t,e,s),s}function EQ(t,e,r){if(r.uniforms.pbr_uUnlit=!!e.unlit,e.pbrMetallicRoughness&&AQ(t,e.pbrMetallicRoughness,r),e.normalTexture){c_(t,e.normalTexture,"u_NormalSampler","HAS_NORMALMAP",r);const{scale:i=1}=e.normalTexture;r.uniforms.u_NormalScale=i}if(e.occlusionTexture){c_(t,e.occlusionTexture,"u_OcclusionSampler","HAS_OCCLUSIONMAP",r);const{strength:i=1}=e.occlusionTexture;r.uniforms.u_OcclusionStrength=i}switch(e.emissiveTexture&&(c_(t,e.emissiveTexture,"u_EmissiveSampler","HAS_EMISSIVEMAP",r),r.uniforms.u_EmissiveFactor=e.emissiveFactor||[0,0,0]),e.alphaMode){case"MASK":const{alphaCutoff:i=.5}=e;r.defines.ALPHA_CUTOFF=1,r.uniforms.u_AlphaCutoff=i;break;case"BLEND":Ct.warn("glTF BLEND alphaMode might not work well because it requires mesh sorting")(),r.parameters.blendColorOperation="add",r.parameters.blendColorSrcFactor="src-alpha",r.parameters.blendColorDstFactor="one-minus-src-alpha",r.parameters.blendAlphaOperation="add",r.parameters.blendAlphaSrcFactor="one",r.parameters.blendAlphaDstFactor="one-minus-src-alpha",r.glParameters.blend=!0,r.glParameters.blendEquation=ic.FUNC_ADD,r.glParameters.blendFunc=[ic.SRC_ALPHA,ic.ONE_MINUS_SRC_ALPHA,ic.ONE,ic.ONE_MINUS_SRC_ALPHA];break}}function AQ(t,e,r){e.baseColorTexture&&c_(t,e.baseColorTexture,"u_BaseColorSampler","HAS_BASECOLORMAP",r),r.uniforms.u_BaseColorFactor=e.baseColorFactor||[1,1,1,1],e.metallicRoughnessTexture&&c_(t,e.metallicRoughnessTexture,"u_MetallicRoughnessSampler","HAS_METALROUGHNESSMAP",r);const{metallicFactor:i=1,roughnessFactor:s=1}=e;r.uniforms.u_MetallicRoughnessValues=[i,s]}function c_(t,e,r,i=null,s){const l=e?.texture?.sampler?.parameters||{},h=e.texture.source.image;let a,v={};h.compressed?(a=h,v={[ic.TEXTURE_MIN_FILTER]:h.data.length>1?ic.LINEAR_MIPMAP_NEAREST:ic.LINEAR}):a={data:h};const T=t.createTexture({id:e.uniformName||e.id,parameters:{...l,...v},pixelStore:{[ic.UNPACK_FLIP_Y_WEBGL]:!1},...a});s.bindings[r]=T,i&&(s.defines[i]=1),s.generatedTextures.push(T)}const TQ="4.3.1",e1={TRANSCODER:"basis_transcoder.js",TRANSCODER_WASM:"basis_transcoder.wasm",ENCODER:"basis_encoder.js",ENCODER_WASM:"basis_encoder.wasm"};let pC;async function fC(t){return tU(t.modules),rU("basis")||(pC||=SQ(t),await pC)}async function SQ(t){let e=null,r=null;return[e,r]=await Promise.all([await jp(e1.TRANSCODER,"textures",t),await jp(e1.TRANSCODER_WASM,"textures",t)]),e=e||globalThis.BASIS,await CQ(e,r)}function CQ(t,e){const r={};return e&&(r.wasmBinary=e),new Promise(i=>{t(r).then(s=>{const{BasisFile:l,initializeBasis:h}=s;h(),i({BasisFile:l})})})}let bb;async function mC(t){const e=t.modules||{};return e.basisEncoder?e.basisEncoder:(bb=bb||MQ(t),await bb)}async function MQ(t){let e=null,r=null;return[e,r]=await Promise.all([await jp(e1.ENCODER,"textures",t),await jp(e1.ENCODER_WASM,"textures",t)]),e=e||globalThis.BASIS,await PQ(e,r)}function PQ(t,e){const r={};return e&&(r.wasmBinary=e),new Promise(i=>{t(r).then(s=>{const{BasisFile:l,KTX2File:h,initializeBasis:a,BasisEncoder:v}=s;a(),i({BasisFile:l,KTX2File:h,BasisEncoder:v})})})}const jf={COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGB_ETC1_WEBGL:36196,COMPRESSED_RGBA_ASTC_4X4_KHR:37808},RQ=["","WEBKIT_","MOZ_"],gC={WEBGL_compressed_texture_s3tc:"dxt",WEBGL_compressed_texture_s3tc_srgb:"dxt-srgb",WEBGL_compressed_texture_etc1:"etc1",WEBGL_compressed_texture_etc:"etc2",WEBGL_compressed_texture_pvrtc:"pvrtc",WEBGL_compressed_texture_atc:"atc",WEBGL_compressed_texture_astc:"astc",EXT_texture_compression_rgtc:"rgtc"};let a0=null;function IQ(t){if(!a0){t=t||kQ()||void 0,a0=new Set;for(const e of RQ)for(const r in gC)if(t&&t.getExtension(`${e}${r}`)){const i=gC[r];a0.add(i)}}return a0}function kQ(){try{return document.createElement("canvas").getContext("webgl")}catch{return null}}const za=[171,75,84,88,32,50,48,187,13,10,26,10];function BQ(t){const e=new Uint8Array(t);return!(e.byteLength<za.length||e[0]!==za[0]||e[1]!==za[1]||e[2]!==za[2]||e[3]!==za[3]||e[4]!==za[4]||e[5]!==za[5]||e[6]!==za[6]||e[7]!==za[7]||e[8]!==za[8]||e[9]!==za[9]||e[10]!==za[10]||e[11]!==za[11])}const LQ={etc1:{basisFormat:0,compressed:!0,format:jf.COMPRESSED_RGB_ETC1_WEBGL},etc2:{basisFormat:1,compressed:!0},bc1:{basisFormat:2,compressed:!0,format:jf.COMPRESSED_RGB_S3TC_DXT1_EXT},bc3:{basisFormat:3,compressed:!0,format:jf.COMPRESSED_RGBA_S3TC_DXT5_EXT},bc4:{basisFormat:4,compressed:!0},bc5:{basisFormat:5,compressed:!0},"bc7-m6-opaque-only":{basisFormat:6,compressed:!0},"bc7-m5":{basisFormat:7,compressed:!0},"pvrtc1-4-rgb":{basisFormat:8,compressed:!0,format:jf.COMPRESSED_RGB_PVRTC_4BPPV1_IMG},"pvrtc1-4-rgba":{basisFormat:9,compressed:!0,format:jf.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG},"astc-4x4":{basisFormat:10,compressed:!0,format:jf.COMPRESSED_RGBA_ASTC_4X4_KHR},"atc-rgb":{basisFormat:11,compressed:!0},"atc-rgba-interpolated-alpha":{basisFormat:12,compressed:!0},rgba32:{basisFormat:13,compressed:!1},rgb565:{basisFormat:14,compressed:!1},bgr565:{basisFormat:15,compressed:!1},rgba4444:{basisFormat:16,compressed:!1}};async function DQ(t,e){if(e.basis.containerFormat==="auto"){if(BQ(t)){const i=await mC(e);return _C(i.KTX2File,t,e)}const{BasisFile:r}=await fC(e);return xb(r,t,e)}switch(e.basis.module){case"encoder":const r=await mC(e);switch(e.basis.containerFormat){case"ktx2":return _C(r.KTX2File,t,e);case"basis":default:return xb(r.BasisFile,t,e)}case"transcoder":default:const{BasisFile:i}=await fC(e);return xb(i,t,e)}}function xb(t,e,r){const i=new t(new Uint8Array(e));try{if(!i.startTranscoding())throw new Error("Failed to start basis transcoding");const s=i.getNumImages(),l=[];for(let h=0;h<s;h++){const a=i.getNumLevels(h),v=[];for(let T=0;T<a;T++)v.push(NQ(i,h,T,r));l.push(v)}return l}finally{i.close(),i.delete()}}function NQ(t,e,r,i){const s=t.getImageWidth(e,r),l=t.getImageHeight(e,r),h=t.getHasAlpha(),{compressed:a,format:v,basisFormat:T}=ik(i,h),C=t.getImageTranscodedSizeInBytes(e,r,T),k=new Uint8Array(C);if(!t.transcodeImage(k,e,r,T,0,0))throw new Error("failed to start Basis transcoding");return{width:s,height:l,data:k,compressed:a,format:v,hasAlpha:h}}function _C(t,e,r){const i=new t(new Uint8Array(e));try{if(!i.startTranscoding())throw new Error("failed to start KTX2 transcoding");const s=i.getLevels(),l=[];for(let h=0;h<s;h++)l.push(OQ(i,h,r));return[l]}finally{i.close(),i.delete()}}function OQ(t,e,r){const{alphaFlag:i,height:s,width:l}=t.getImageLevelInfo(e,0,0),{compressed:h,format:a,basisFormat:v}=ik(r,i),T=t.getImageTranscodedSizeInBytes(e,0,0,v),C=new Uint8Array(T);if(!t.transcodeImage(C,e,0,0,v,0,-1,-1))throw new Error("Failed to transcode KTX2 image");return{width:l,height:s,data:C,compressed:h,levelSize:T,hasAlpha:i,format:a}}function ik(t,e){let r=t&&t.basis&&t.basis.format;return r==="auto"&&(r=nk()),typeof r=="object"&&(r=e?r.alpha:r.noAlpha),r=r.toLowerCase(),LQ[r]}function nk(){const t=IQ();return t.has("astc")?"astc-4x4":t.has("dxt")?{alpha:"bc3",noAlpha:"bc1"}:t.has("pvrtc")?{alpha:"pvrtc1-4-rgba",noAlpha:"pvrtc1-4-rgb"}:t.has("etc1")?"etc1":t.has("etc2")?"etc2":"rgb565"}const FQ={dataType:null,batchType:null,name:"Basis",id:"basis",module:"textures",version:TQ,worker:!0,extensions:["basis","ktx2"],mimeTypes:["application/octet-stream","image/ktx2"],tests:["sB"],binary:!0,options:{basis:{format:"auto",libraryPath:"libs/",containerFormat:"auto",module:"transcoder"}}},zQ={...FQ,parse:DQ},UQ={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},jQ={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};class VQ{name;startTime=0;playing=!0;speed=1;channels=[];constructor(e){Object.assign(this,e)}animate(e){if(!this.playing)return;const r=(e/1e3-this.startTime)*this.speed;this.channels.forEach(({sampler:i,target:s,path:l})=>{XQ(r,i,s,l),WQ(s,s._node)})}}class GQ{animations;constructor(e){this.animations=e.animations.map((r,i)=>{const s=r.name||`Animation-${i}`,l=r.samplers.map(({input:a,interpolation:v="LINEAR",output:T})=>({input:yC(e.accessors[a]),interpolation:v,output:yC(e.accessors[T])})),h=r.channels.map(({sampler:a,target:v})=>({sampler:l[a],target:e.nodes[v.node],path:v.path}));return new VQ({name:s,channels:h})})}animate(e){this.setTime(e)}setTime(e){this.animations.forEach(r=>r.animate(e))}getAnimations(){return this.animations}}function yC(t){if(!t._animation){const e=jQ[t.componentType],r=UQ[t.type],i=r*t.count,{buffer:s,byteOffset:l}=t.bufferView.data,h=new e(s,l+(t.byteOffset||0),i);if(r===1)t._animation=Array.from(h);else{const a=[];for(let v=0;v<h.length;v+=r)a.push(Array.from(h.slice(v,v+r)));t._animation=a}}return t._animation}const HQ=new Wr;function WQ(t,e){if(e.matrix.identity(),t.translation&&e.matrix.translate(t.translation),t.rotation){const r=HQ.fromQuaternion(t.rotation);e.matrix.multiplyRight(r)}t.scale&&e.matrix.scale(t.scale)}const wb=new y_;function qQ(t,e,r,i,s){if(e==="rotation"){wb.slerp({start:r,target:i,ratio:s});for(let l=0;l<wb.length;l++)t[e][l]=wb[l]}else for(let l=0;l<r.length;l++)t[e][l]=s*i[l]+(1-s)*r[l]}function $Q(t,e,{p0:r,outTangent0:i,inTangent1:s,p1:l,tDiff:h,ratio:a}){for(let v=0;v<t[e].length;v++){const T=i[v]*h,C=s[v]*h;t[e][v]=(2*Math.pow(a,3)-3*Math.pow(a,2)+1)*r[v]+(Math.pow(a,3)-2*Math.pow(a,2)+a)*T+(-2*Math.pow(a,3)+3*Math.pow(a,2))*l[v]+(Math.pow(a,3)-Math.pow(a,2))*C}}function ZQ(t,e,r){for(let i=0;i<r.length;i++)t[e][i]=r[i]}function XQ(t,{input:e,interpolation:r,output:i},s,l){const h=e[e.length-1],a=t%h,v=e.findIndex(L=>L>=a),T=Math.max(0,v-1);if(!Array.isArray(s[l]))switch(l){case"translation":s[l]=[0,0,0];break;case"rotation":s[l]=[0,0,0,1];break;case"scale":s[l]=[1,1,1];break;default:Ct.warn(`Bad animation path ${l}`)()}fi(s[l].length===i[T].length);const C=e[T],k=e[v];switch(r){case"STEP":ZQ(s,l,i[T]);break;case"LINEAR":if(k>C){const L=(a-C)/(k-C);qQ(s,l,i[T],i[v],L)}break;case"CUBICSPLINE":if(k>C){const L=(a-C)/(k-C),O=k-C,K=i[3*T+1],$=i[3*T+2],ne=i[3*v+0],oe=i[3*v+1];$Q(s,l,{p0:K,outTangent0:$,inTangent1:ne,p1:oe,tDiff:O,ratio:L})}break;default:Ct.warn(`Interpolation ${r} not supported`)();break}}const KQ=`
#pragma vscode_glsllint_stage: vert
#if (__VERSION__ < 300)
  #define _attr attribute
#else
  #define _attr in
#endif

  // _attr vec4 POSITION;
  _attr vec4 positions;

  #ifdef HAS_NORMALS
    // _attr vec4 NORMAL;
    _attr vec4 normals;
  #endif

  #ifdef HAS_TANGENTS
    _attr vec4 TANGENT;
  #endif

  #ifdef HAS_UV
    // _attr vec2 TEXCOORD_0;
    _attr vec2 texCoords;
  #endif

  void main(void) {
    vec4 _NORMAL = vec4(0.);
    vec4 _TANGENT = vec4(0.);
    vec2 _TEXCOORD_0 = vec2(0.);

    #ifdef HAS_NORMALS
      _NORMAL = normals;
    #endif

    #ifdef HAS_TANGENTS
      _TANGENT = TANGENT;
    #endif

    #ifdef HAS_UV
      _TEXCOORD_0 = texCoords;
    #endif

    pbr_setPositionNormalTangentUV(positions, _NORMAL, _TANGENT, _TEXCOORD_0);
    gl_Position = u_MVPMatrix * positions;
  }
`,YQ=`
#pragma vscode_glsllint_stage: frag
#if (__VERSION__ < 300)
  #define fragmentColor gl_FragColor
#else
  out vec4 fragmentColor;
#endif

  void main(void) {
    vec3 pos = pbr_vPosition;
    fragmentColor = pbr_filterColor(vec4(1.0));
  }
`;function JQ(t,e){const{id:r,geometry:i,material:s,vertexCount:l,materialOptions:h,modelOptions:a}=e,v=rk(t,s,i.attributes,h);Ct.info(4,"createGLTFModel defines: ",v.defines)();const T=[],C={depthWriteEnabled:!0,depthCompare:"less",depthFormat:"depth24plus",cullMode:"back"},k={id:r,geometry:i,topology:i.topology,vertexCount:l,modules:[U2],vs:vC(t,KQ),fs:vC(t,YQ),...a,bindings:{...v.bindings,...a.bindings},defines:{...v.defines,...a.defines},parameters:{...C,...v.parameters,...a.parameters},uniforms:{...v.uniforms,...a.uniforms}},L=new pd(t,k);return new Ux({managedResources:T,model:L})}function vC(t,e){return`#version 300 es
${e}`}const QQ={modelOptions:{},pbrDebug:!1,imageBasedLightingEnvironment:null,lights:!0,useTangents:!1};class eee{device;options;gltf;constructor(e,r={}){this.device=e,this.options={...QQ,...r}}instantiate(e){return this.gltf=e,(e.scenes||[]).map(r=>this.createScene(r))}createAnimator(){return Array.isArray(this.gltf.animations)?new GQ(this.gltf):null}createScene(e){const r=(e.nodes||[]).map(i=>this.createNode(i));return new hm({id:e.name||e.id,children:r})}createNode(e){if(!e._node){const r=(e.children||[]).map(s=>this.createNode(s));e.mesh&&r.push(this.createMesh(e.mesh));const i=new hm({id:e.name||e.id,children:r});if(e.matrix)i.setMatrix(e.matrix);else{if(i.matrix.identity(),e.translation&&i.matrix.translate(e.translation),e.rotation){const s=new Wr().fromQuaternion(e.rotation);i.matrix.multiplyRight(s)}e.scale&&i.matrix.scale(e.scale)}e._node=i}return e._node}createMesh(e){if(!e._mesh){const r=(e.primitives||[]).map((s,l)=>this.createPrimitive(s,l,e)),i=new hm({id:e.name||e.id,children:r});e._mesh=i}return e._mesh}createPrimitive(e,r,i){const s=e.name||`${i.name||i.id}-primitive-${r}`,l=tee(e.mode||4),h=e.indices?e.indices.count:this.getVertexCount(e.attributes),a=JQ(this.device,{id:s,geometry:this.createGeometry(s,e,l),material:e.material,materialOptions:this.options,modelOptions:this.options.modelOptions,vertexCount:h});return a.bounds=[e.attributes.POSITION.min,e.attributes.POSITION.max],a}getVertexCount(e){throw new Error("getVertexCount not implemented")}createGeometry(e,r,i){const s={};for(const[l,h]of Object.entries(r.attributes)){const{components:a,size:v,value:T}=h;s[l]={size:v??a,value:T}}return new um({id:e,topology:i,indices:r.indices.value,attributes:s})}createBuffer(e,r){e.bufferView||(e.bufferView={});const{bufferView:i}=e;return i.lumaBuffers||(i.lumaBuffers={}),i.lumaBuffers[r]||(i.lumaBuffers[r]=this.device.createBuffer({id:`from-${i.id}`,data:i.data||e.value})),i.lumaBuffers[r]}createSampler(e){return e}needsPOT(){return!1}}var Ju;(function(t){t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN"})(Ju||(Ju={}));function tee(t){switch(t){case Ju.POINTS:return"point-list";case Ju.LINES:return"line-list";case Ju.LINE_STRIP:return"line-strip";case Ju.LINE_LOOP:return"line-loop-webgl";case Ju.TRIANGLES:return"triangle-list";case Ju.TRIANGLE_STRIP:return"triangle-strip";case Ju.TRIANGLE_FAN:return"triangle-fan-webgl";default:throw new Error(t)}}function ree(t,e,r){const i=new eee(t,r),s=i.instantiate(e),l=i.createAnimator();return{scenes:s,animator:l}}function Ga(t,e){if(!t)throw new Error(e||"assert failed: gltf")}const sk={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},ok={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},iee=1.33,bC=["SCALAR","VEC2","VEC3","VEC4"],nee=[[Int8Array,5120],[Uint8Array,5121],[Int16Array,5122],[Uint16Array,5123],[Uint32Array,5125],[Float32Array,5126],[Float64Array,5130]],see=new Map(nee),oee={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},aee={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},lee={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function ak(t){return bC[t-1]||bC[0]}function I1(t){const e=see.get(t.constructor);if(!e)throw new Error("Illegal typed array");return e}function nE(t,e){const r=lee[t.componentType],i=oee[t.type],s=aee[t.componentType],l=t.count*i,h=t.count*i*s;Ga(h>=0&&h<=e.byteLength);const a=ok[t.componentType],v=sk[t.type];return{ArrayType:r,length:l,byteLength:h,componentByteSize:a,numberOfComponentsInElement:v}}function lk(t){let{images:e,bufferViews:r}=t;e=e||[],r=r||[];const i=e.map(h=>h.bufferView);r=r.filter(h=>!i.includes(h));const s=r.reduce((h,a)=>h+a.byteLength,0),l=e.reduce((h,a)=>{const{width:v,height:T}=a.image;return h+v*T},0);return s+Math.ceil(4*l*iee)}function cee(t,e,r){const i=t.bufferViews[r];Ga(i);const s=i.buffer,l=e[s];Ga(l);const h=(i.byteOffset||0)+l.byteOffset;return new Uint8Array(l.arrayBuffer,h,i.byteLength)}function uee(t,e,r){const i=typeof r=="number"?t.accessors?.[r]:r;if(!i)throw new Error(`No gltf accessor ${JSON.stringify(r)}`);const s=t.bufferViews?.[i.bufferView||0];if(!s)throw new Error(`No gltf buffer view for accessor ${s}`);const{arrayBuffer:l,byteOffset:h}=e[s.buffer],a=(h||0)+(i.byteOffset||0)+(s.byteOffset||0),{ArrayType:v,length:T,componentByteSize:C,numberOfComponentsInElement:k}=nE(i,s),L=C*k,O=s.byteStride||L;if(typeof s.byteStride>"u"||s.byteStride===L)return new v(l,a,T);const K=new v(T);for(let $=0;$<i.count;$++){const ne=new v(l,a+$*O,k);K.set(ne,$*k)}return K}function hee(){return{asset:{version:"2.0",generator:"loaders.gl"},buffers:[],extensions:{},extensionsRequired:[],extensionsUsed:[]}}class Ls{gltf;sourceBuffers;byteLength;constructor(e){this.gltf={json:e?.json||hee(),buffers:e?.buffers||[],images:e?.images||[]},this.sourceBuffers=[],this.byteLength=0,this.gltf.buffers&&this.gltf.buffers[0]&&(this.byteLength=this.gltf.buffers[0].byteLength,this.sourceBuffers=[this.gltf.buffers[0]])}get json(){return this.gltf.json}getApplicationData(e){return this.json[e]}getExtraData(e){return(this.json.extras||{})[e]}hasExtension(e){const r=this.getUsedExtensions().find(s=>s===e),i=this.getRequiredExtensions().find(s=>s===e);return typeof r=="string"||typeof i=="string"}getExtension(e){const r=this.getUsedExtensions().find(s=>s===e),i=this.json.extensions||{};return r?i[e]:null}getRequiredExtension(e){return this.getRequiredExtensions().find(r=>r===e)?this.getExtension(e):null}getRequiredExtensions(){return this.json.extensionsRequired||[]}getUsedExtensions(){return this.json.extensionsUsed||[]}getRemovedExtensions(){return this.json.extensionsRemoved||[]}getObjectExtension(e,r){return(e.extensions||{})[r]}getScene(e){return this.getObject("scenes",e)}getNode(e){return this.getObject("nodes",e)}getSkin(e){return this.getObject("skins",e)}getMesh(e){return this.getObject("meshes",e)}getMaterial(e){return this.getObject("materials",e)}getAccessor(e){return this.getObject("accessors",e)}getTexture(e){return this.getObject("textures",e)}getSampler(e){return this.getObject("samplers",e)}getImage(e){return this.getObject("images",e)}getBufferView(e){return this.getObject("bufferViews",e)}getBuffer(e){return this.getObject("buffers",e)}getObject(e,r){if(typeof r=="object")return r;const i=this.json[e]&&this.json[e][r];if(!i)throw new Error(`glTF file error: Could not find ${e}[${r}]`);return i}getTypedArrayForBufferView(e){e=this.getBufferView(e);const r=e.buffer,i=this.gltf.buffers[r];Ga(i);const s=(e.byteOffset||0)+i.byteOffset;return new Uint8Array(i.arrayBuffer,s,e.byteLength)}getTypedArrayForAccessor(e){const r=this.getAccessor(e);return uee(this.gltf.json,this.gltf.buffers,r)}getTypedArrayForImageData(e){e=this.getAccessor(e);const r=this.getBufferView(e.bufferView),i=this.getBuffer(r.buffer).data,s=r.byteOffset||0;return new Uint8Array(i,s,r.byteLength)}addApplicationData(e,r){return this.json[e]=r,this}addExtraData(e,r){return this.json.extras=this.json.extras||{},this.json.extras[e]=r,this}addObjectExtension(e,r,i){return e.extensions=e.extensions||{},e.extensions[r]=i,this.registerUsedExtension(r),this}setObjectExtension(e,r,i){const s=e.extensions||{};s[r]=i}removeObjectExtension(e,r){const i=e?.extensions||{};if(i[r]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];const s=this.json.extensionsRemoved;s.includes(r)||s.push(r)}delete i[r]}addExtension(e,r={}){return Ga(r),this.json.extensions=this.json.extensions||{},this.json.extensions[e]=r,this.registerUsedExtension(e),r}addRequiredExtension(e,r={}){return Ga(r),this.addExtension(e,r),this.registerRequiredExtension(e),r}registerUsedExtension(e){this.json.extensionsUsed=this.json.extensionsUsed||[],this.json.extensionsUsed.find(r=>r===e)||this.json.extensionsUsed.push(e)}registerRequiredExtension(e){this.registerUsedExtension(e),this.json.extensionsRequired=this.json.extensionsRequired||[],this.json.extensionsRequired.find(r=>r===e)||this.json.extensionsRequired.push(e)}removeExtension(e){if(this.json.extensions?.[e]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];const r=this.json.extensionsRemoved;r.includes(e)||r.push(e)}this.json.extensions&&delete this.json.extensions[e],this.json.extensionsRequired&&this._removeStringFromArray(this.json.extensionsRequired,e),this.json.extensionsUsed&&this._removeStringFromArray(this.json.extensionsUsed,e)}setDefaultScene(e){this.json.scene=e}addScene(e){const{nodeIndices:r}=e;return this.json.scenes=this.json.scenes||[],this.json.scenes.push({nodes:r}),this.json.scenes.length-1}addNode(e){const{meshIndex:r,matrix:i}=e;this.json.nodes=this.json.nodes||[];const s={mesh:r};return i&&(s.matrix=i),this.json.nodes.push(s),this.json.nodes.length-1}addMesh(e){const{attributes:r,indices:i,material:s,mode:l=4}=e,h={primitives:[{attributes:this._addAttributes(r),mode:l}]};if(i){const a=this._addIndices(i);h.primitives[0].indices=a}return Number.isFinite(s)&&(h.primitives[0].material=s),this.json.meshes=this.json.meshes||[],this.json.meshes.push(h),this.json.meshes.length-1}addPointCloud(e){const r={primitives:[{attributes:this._addAttributes(e),mode:0}]};return this.json.meshes=this.json.meshes||[],this.json.meshes.push(r),this.json.meshes.length-1}addImage(e,r){const i=x2(e),s=r||i?.mimeType,l={bufferView:this.addBufferView(e),mimeType:s};return this.json.images=this.json.images||[],this.json.images.push(l),this.json.images.length-1}addBufferView(e,r=0,i=this.byteLength){const s=e.byteLength;Ga(Number.isFinite(s)),this.sourceBuffers=this.sourceBuffers||[],this.sourceBuffers.push(e);const l={buffer:r,byteOffset:i,byteLength:s};return this.byteLength+=L_(s,4),this.json.bufferViews=this.json.bufferViews||[],this.json.bufferViews.push(l),this.json.bufferViews.length-1}addAccessor(e,r){const i={bufferView:e,type:ak(r.size),componentType:r.componentType,count:r.count,max:r.max,min:r.min};return this.json.accessors=this.json.accessors||[],this.json.accessors.push(i),this.json.accessors.length-1}addBinaryBuffer(e,r={size:3}){const i=this.addBufferView(e);let s={min:r.min,max:r.max};(!s.min||!s.max)&&(s=this._getAccessorMinMax(e,r.size));const l={size:r.size,componentType:I1(e),count:Math.round(e.length/r.size),min:s.min,max:s.max};return this.addAccessor(i,Object.assign(l,r))}addTexture(e){const{imageIndex:r}=e,i={source:r};return this.json.textures=this.json.textures||[],this.json.textures.push(i),this.json.textures.length-1}addMaterial(e){return this.json.materials=this.json.materials||[],this.json.materials.push(e),this.json.materials.length-1}createBinaryChunk(){const e=this.byteLength,r=new ArrayBuffer(e),i=new Uint8Array(r);let s=0;for(const l of this.sourceBuffers||[])s=CU(l,i,s);this.json?.buffers?.[0]?this.json.buffers[0].byteLength=e:this.json.buffers=[{byteLength:e}],this.gltf.binary=r,this.sourceBuffers=[r],this.gltf.buffers=[{arrayBuffer:r,byteOffset:0,byteLength:r.byteLength}]}_removeStringFromArray(e,r){let i=!0;for(;i;){const s=e.indexOf(r);s>-1?e.splice(s,1):i=!1}}_addAttributes(e={}){const r={};for(const i in e){const s=e[i],l=this._getGltfAttributeName(i),h=this.addBinaryBuffer(s.value,s);r[l]=h}return r}_addIndices(e){return this.addBinaryBuffer(e,{size:1})}_getGltfAttributeName(e){switch(e.toLowerCase()){case"position":case"positions":case"vertices":return"POSITION";case"normal":case"normals":return"NORMAL";case"color":case"colors":return"COLOR_0";case"texcoord":case"texcoords":return"TEXCOORD_0";default:return e}}_getAccessorMinMax(e,r){const i={min:null,max:null};if(e.length<r)return i;i.min=[],i.max=[];const s=e.subarray(0,r);for(const l of s)i.min.push(l),i.max.push(l);for(let l=r;l<e.length;l+=r)for(let h=0;h<r;h++)i.min[0+h]=Math.min(i.min[0+h],e[l+h]),i.max[0+h]=Math.max(i.max[0+h],e[l+h]);return i}}function xC(t){return(t%1+1)%1}const ck={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16,BOOLEAN:1,STRING:1,ENUM:1},dee={INT8:Int8Array,UINT8:Uint8Array,INT16:Int16Array,UINT16:Uint16Array,INT32:Int32Array,UINT32:Uint32Array,INT64:BigInt64Array,UINT64:BigUint64Array,FLOAT32:Float32Array,FLOAT64:Float64Array},uk={INT8:1,UINT8:1,INT16:2,UINT16:2,INT32:4,UINT32:4,INT64:8,UINT64:8,FLOAT32:4,FLOAT64:8};function sE(t,e){return uk[e]*ck[t]}function k1(t,e,r,i){if(r!=="UINT8"&&r!=="UINT16"&&r!=="UINT32"&&r!=="UINT64")return null;const s=t.getTypedArrayForBufferView(e),l=B1(s,"SCALAR",r,i+1);return l instanceof BigInt64Array||l instanceof BigUint64Array?null:l}function B1(t,e,r,i=1){const s=ck[e],l=dee[r],h=uk[r],a=i*s,v=a*h;let T=t.buffer,C=t.byteOffset;return C%h!==0&&(T=new Uint8Array(T).slice(C,C+v).buffer,C=0),new l(T,C,a)}function oE(t,e,r){const i=`TEXCOORD_${e.texCoord||0}`,s=r.attributes[i],l=t.getTypedArrayForAccessor(s),h=t.gltf.json,a=e.index,v=h.textures?.[a]?.source;if(typeof v<"u"){const T=h.images?.[v]?.mimeType,C=t.gltf.images?.[v];if(C&&typeof C.width<"u"){const k=[];for(let L=0;L<l.length;L+=2){const O=pee(C,T,l,L,e.channels);k.push(O)}return k}}return[]}function hk(t,e,r,i,s){if(!r?.length)return;const l=[];for(const C of r){let k=i.findIndex(L=>L===C);k===-1&&(k=i.push(C)-1),l.push(k)}const h=new Uint32Array(l),a=t.gltf.buffers.push({arrayBuffer:h.buffer,byteOffset:h.byteOffset,byteLength:h.byteLength})-1,v=t.addBufferView(h,a,0),T=t.addAccessor(v,{size:1,componentType:I1(h),count:h.length});s.attributes[e]=T}function pee(t,e,r,i,s=[0]){const l={r:{offset:0,shift:0},g:{offset:1,shift:8},b:{offset:2,shift:16},a:{offset:3,shift:24}},h=r[i],a=r[i+1];let v=1;e&&(e.indexOf("image/jpeg")!==-1||e.indexOf("image/png")!==-1)&&(v=4);const T=fee(h,a,t,v);let C=0;for(const k of s){const L=typeof k=="number"?Object.values(l)[k]:l[k],O=T+L.offset,K=c5(t);if(K.data.length<=O)throw new Error(`${K.data.length} <= ${O}`);const $=K.data[O];C|=$<<L.shift}return C}function fee(t,e,r,i=1){const s=r.width,l=xC(t)*(s-1),h=Math.round(l),a=r.height,v=xC(e)*(a-1),T=Math.round(v),C=r.components?r.components:i;return(T*s+h)*C}function dk(t,e,r,i,s){const l=[];for(let h=0;h<e;h++){const a=r[h],v=r[h+1]-r[h];if(v+a>i)break;const T=a/s,C=v/s;l.push(t.slice(T,T+C))}return l}function pk(t,e,r){const i=[];for(let s=0;s<e;s++){const l=s*r;i.push(t.slice(l,l+r))}return i}function fk(t,e,r,i){if(r)throw new Error("Not implemented - arrayOffsets for strings is specified");if(i){const s=[],l=new TextDecoder("utf8");let h=0;for(let a=0;a<t;a++){const v=i[a+1]-i[a];if(v+h<=e.length){const T=e.subarray(h,v+h),C=l.decode(T);s.push(C),h+=v}}return s}return[]}const pm="EXT_mesh_features",mee=pm;async function gee(t,e){const r=new Ls(t);yee(r,e)}function _ee(t,e){const r=new Ls(t);return bee(r),r.createBinaryChunk(),r.gltf}function yee(t,e){const r=t.gltf.json;if(r.meshes)for(const i of r.meshes)for(const s of i.primitives)vee(t,s,e)}function vee(t,e,r){if(!r?.gltf?.loadBuffers)return;const i=e.extensions?.[pm]?.featureIds;if(i)for(const s of i){let l;if(typeof s.attribute<"u"){const h=`_FEATURE_ID_${s.attribute}`,a=e.attributes[h];l=t.getTypedArrayForAccessor(a)}else typeof s.texture<"u"&&r?.gltf?.loadImages?l=oE(t,s.texture,e):l=[];s.data=l}}function bee(t,e){const r=t.gltf.json.meshes;if(r)for(const i of r)for(const s of i.primitives)wee(t,s)}function xee(t,e,r,i){e.extensions||(e.extensions={});let s=e.extensions[pm];s||(s={featureIds:[]},e.extensions[pm]=s);const{featureIds:l}=s,h={featureCount:r.length,propertyTable:i,data:r};l.push(h),t.addObjectExtension(e,pm,s)}function wee(t,e){const r=e.extensions?.[pm];if(!r)return;const i=r.featureIds;i.forEach((s,l)=>{if(s.data){const{accessorKey:h,index:a}=Eee(e.attributes),v=new Uint32Array(s.data);i[l]={featureCount:v.length,propertyTable:s.propertyTable,attribute:a},t.gltf.buffers.push({arrayBuffer:v.buffer,byteOffset:v.byteOffset,byteLength:v.byteLength});const T=t.addBufferView(v),C=t.addAccessor(T,{size:1,componentType:I1(v),count:v.length});e.attributes[h]=C}})}function Eee(t){const e="_FEATURE_ID_",r=Object.keys(t).filter(s=>s.indexOf(e)===0);let i=-1;for(const s of r){const l=Number(s.substring(e.length));l>i&&(i=l)}return i++,{accessorKey:`${e}${i}`,index:i}}const Aee=Object.freeze(Object.defineProperty({__proto__:null,createExtMeshFeatures:xee,decode:gee,encode:_ee,name:mee},Symbol.toStringTag,{value:"Module"})),Em="EXT_structural_metadata",Tee=Em;async function See(t,e){const r=new Ls(t);Mee(r,e)}function Cee(t,e){const r=new Ls(t);return Hee(r),r.createBinaryChunk(),r.gltf}function Mee(t,e){if(!e.gltf?.loadBuffers)return;const r=t.getExtension(Em);r&&(e.gltf?.loadImages&&Pee(t,r),Ree(t,r))}function Pee(t,e){const r=e.propertyTextures,i=t.gltf.json;if(r&&i.meshes)for(const s of i.meshes)for(const l of s.primitives)kee(t,r,l,e)}function Ree(t,e){const r=e.schema;if(!r)return;const i=r.classes,s=e.propertyTables;if(i&&s)for(const l in i){const h=Iee(s,l);h&&Lee(t,r,h)}}function Iee(t,e){for(const r of t)if(r.class===e)return r;return null}function kee(t,e,r,i){if(!e)return;const s=r.extensions?.[Em]?.propertyTextures;if(s)for(const l of s){const h=e[l];Bee(t,h,r,i)}}function Bee(t,e,r,i){if(!e.properties)return;i.dataAttributeNames||(i.dataAttributeNames=[]);const s=e.class;for(const l in e.properties){const h=`${s}_${l}`,a=e.properties?.[l];if(!a)continue;a.data||(a.data=[]);const v=a.data,T=oE(t,a,r);T!==null&&(hk(t,h,T,v,r),a.data=v,i.dataAttributeNames.push(h))}}function Lee(t,e,r){const i=e.classes?.[r.class];if(!i)throw new Error(`Incorrect data in the EXT_structural_metadata extension: no schema class with name ${r.class}`);const s=r.count;for(const l in i.properties){const h=i.properties[l],a=r.properties?.[l];if(a){const v=Dee(t,e,h,s,a);a.data=v}}}function Dee(t,e,r,i,s){let l=[];const h=s.values,a=t.getTypedArrayForBufferView(h),v=Nee(t,r,s,i),T=Oee(t,s,i);switch(r.type){case"SCALAR":case"VEC2":case"VEC3":case"VEC4":case"MAT2":case"MAT3":case"MAT4":{l=Fee(r,i,a,v);break}case"BOOLEAN":throw new Error(`Not implemented - classProperty.type=${r.type}`);case"STRING":{l=fk(i,a,v,T);break}case"ENUM":{l=zee(e,r,i,a,v);break}default:throw new Error(`Unknown classProperty type ${r.type}`)}return l}function Nee(t,e,r,i){return e.array&&typeof e.count>"u"&&typeof r.arrayOffsets<"u"?k1(t,r.arrayOffsets,r.arrayOffsetType||"UINT32",i):null}function Oee(t,e,r){return typeof e.stringOffsets<"u"?k1(t,e.stringOffsets,e.stringOffsetType||"UINT32",r):null}function Fee(t,e,r,i){const s=t.array,l=t.count,h=sE(t.type,t.componentType),a=r.byteLength/h;let v;return t.componentType?v=B1(r,t.type,t.componentType,a):v=r,s?i?dk(v,e,i,r.length,h):l?pk(v,e,l):[]:v}function zee(t,e,r,i,s){const l=e.enumType;if(!l)throw new Error("Incorrect data in the EXT_structural_metadata extension: classProperty.enumType is not set for type ENUM");const h=t.enums?.[l];if(!h)throw new Error(`Incorrect data in the EXT_structural_metadata extension: schema.enums does't contain ${l}`);const a=h.valueType||"UINT16",v=sE(e.type,a),T=i.byteLength/v;let C=B1(i,e.type,a,T);if(C||(C=i),e.array){if(s)return Uee({valuesData:C,numberOfElements:r,arrayOffsets:s,valuesDataBytesLength:i.length,elementSize:v,enumEntry:h});const k=e.count;return k?jee(C,r,k,h):[]}return aE(C,0,r,h)}function Uee(t){const{valuesData:e,numberOfElements:r,arrayOffsets:i,valuesDataBytesLength:s,elementSize:l,enumEntry:h}=t,a=[];for(let v=0;v<r;v++){const T=i[v],C=i[v+1]-i[v];if(C+T>s)break;const k=T/l,L=C/l,O=aE(e,k,L,h);a.push(O)}return a}function jee(t,e,r,i){const s=[];for(let l=0;l<e;l++){const h=r*l,a=aE(t,h,r,i);s.push(a)}return s}function aE(t,e,r,i){const s=[];for(let l=0;l<r;l++)if(t instanceof BigInt64Array||t instanceof BigUint64Array)s.push("");else{const h=t[e+l],a=Vee(i,h);a?s.push(a.name):s.push("")}return s}function Vee(t,e){for(const r of t.values)if(r.value===e)return r;return null}const Gee="schemaClassId";function Hee(t,e){const r=t.getExtension(Em);if(r&&r.propertyTables)for(const i of r.propertyTables){const s=i.class,l=r.schema?.classes?.[s];i.properties&&l&&Wee(i,l,t)}}function Wee(t,e,r){for(const i in t.properties){const s=t.properties[i].data;if(s){const l=e.properties[i];if(l){const h=Xee(s,l,r);t.properties[i]=h}}}}function qee(t,e,r=Gee){let i=t.getExtension(Em);i||(i=t.addExtension(Em)),i.schema=$ee(e,r,i.schema);const s=Zee(e,r,i.schema);return i.propertyTables||(i.propertyTables=[]),i.propertyTables.push(s)-1}function $ee(t,e,r){const i=r??{id:"schema_id"},s={properties:{}};for(const l of t){const h={type:l.elementType,componentType:l.componentType};s.properties[l.name]=h}return i.classes={},i.classes[e]=s,i}function Zee(t,e,r){const i={class:e,count:0};let s=0;const l=r.classes?.[e];for(const h of t){if(s===0&&(s=h.values.length),s!==h.values.length&&h.values.length)throw new Error("Illegal values in attributes");l?.properties[h.name]&&(i.properties||(i.properties={}),i.properties[h.name]={values:0,data:h.values})}return i.count=s,i}function Xee(t,e,r){const i={values:0};if(e.type==="STRING"){const{stringData:s,stringOffsets:l}=Jee(t);i.stringOffsets=Eb(l,r),i.values=Eb(s,r)}else if(e.type==="SCALAR"&&e.componentType){const s=Yee(t,e.componentType);i.values=Eb(s,r)}return i}const Kee={INT8:Int8Array,UINT8:Uint8Array,INT16:Int16Array,UINT16:Uint16Array,INT32:Int32Array,UINT32:Uint32Array,INT64:Int32Array,UINT64:Uint32Array,FLOAT32:Float32Array,FLOAT64:Float64Array};function Yee(t,e){const r=[];for(const s of t)r.push(Number(s));const i=Kee[e];if(!i)throw new Error("Illegal component type");return new i(r)}function Jee(t){const e=new TextEncoder,r=[];let i=0;for(const v of t){const T=e.encode(v);i+=T.length,r.push(T)}const s=new Uint8Array(i),l=[];let h=0;for(const v of r)s.set(v,h),l.push(h),h+=v.length;l.push(h);const a=new Uint32Array(l);return{stringData:s,stringOffsets:a}}function Eb(t,e){return e.gltf.buffers.push({arrayBuffer:t.buffer,byteOffset:t.byteOffset,byteLength:t.byteLength}),e.addBufferView(t)}const Qee=Object.freeze(Object.defineProperty({__proto__:null,createExtStructuralMetadata:qee,decode:See,encode:Cee,name:Tee},Symbol.toStringTag,{value:"Module"})),mk="EXT_feature_metadata",ete=mk;async function tte(t,e){const r=new Ls(t);rte(r,e)}function rte(t,e){if(!e.gltf?.loadBuffers)return;const r=t.getExtension(mk);r&&(e.gltf?.loadImages&&ite(t,r),nte(t,r))}function ite(t,e){const r=e.schema;if(!r)return;const i=r.classes,{featureTextures:s}=e;if(i&&s)for(const l in i){const h=i[l],a=ote(s,l);a&&lte(t,a,h)}}function nte(t,e){const r=e.schema;if(!r)return;const i=r.classes,s=e.featureTables;if(i&&s)for(const l in i){const h=ste(s,l);h&&ate(t,r,h)}}function ste(t,e){for(const r in t){const i=t[r];if(i.class===e)return i}return null}function ote(t,e){for(const r in t){const i=t[r];if(i.class===e)return i}return null}function ate(t,e,r){if(!r.class)return;const i=e.classes?.[r.class];if(!i)throw new Error(`Incorrect data in the EXT_structural_metadata extension: no schema class with name ${r.class}`);const s=r.count;for(const l in i.properties){const h=i.properties[l],a=r.properties?.[l];if(a){const v=cte(t,e,h,s,a);a.data=v}}}function lte(t,e,r){const i=e.class;for(const s in r.properties){const l=e?.properties?.[s];if(l){const h=fte(t,l,i);l.data=h}}}function cte(t,e,r,i,s){let l=[];const h=s.bufferView,a=t.getTypedArrayForBufferView(h),v=ute(t,r,s,i),T=hte(t,r,s,i);return r.type==="STRING"||r.componentType==="STRING"?l=fk(i,a,v,T):dte(r)&&(l=pte(r,i,a,v)),l}function ute(t,e,r,i){return e.type==="ARRAY"&&typeof e.componentCount>"u"&&typeof r.arrayOffsetBufferView<"u"?k1(t,r.arrayOffsetBufferView,r.offsetType||"UINT32",i):null}function hte(t,e,r,i){return typeof r.stringOffsetBufferView<"u"?k1(t,r.stringOffsetBufferView,r.offsetType||"UINT32",i):null}function dte(t){const e=["UINT8","INT16","UINT16","INT32","UINT32","INT64","UINT64","FLOAT32","FLOAT64"];return e.includes(t.type)||typeof t.componentType<"u"&&e.includes(t.componentType)}function pte(t,e,r,i){const s=t.type==="ARRAY",l=t.componentCount,h="SCALAR",a=t.componentType||t.type,v=sE(h,a),T=r.byteLength/v,C=B1(r,h,a,T);return s?i?dk(C,e,i,r.length,v):l?pk(C,e,l):[]:C}function fte(t,e,r){const i=t.gltf.json;if(!i.meshes)return[];const s=[];for(const l of i.meshes)for(const h of l.primitives)mte(t,r,e,s,h);return s}function mte(t,e,r,i,s){const l={channels:r.channels,...r.texture},h=oE(t,l,s);h&&hk(t,e,h,i,s)}const gte=Object.freeze(Object.defineProperty({__proto__:null,decode:tte,name:ete},Symbol.toStringTag,{value:"Module"})),_te="4.3.1",Am=!0,wC=1735152710,lE=12,t1=8,yte=1313821514,vte=5130562,bte=0,xte=0,wte=1;function Ete(t,e=0){return`${String.fromCharCode(t.getUint8(e+0))}${String.fromCharCode(t.getUint8(e+1))}${String.fromCharCode(t.getUint8(e+2))}${String.fromCharCode(t.getUint8(e+3))}`}function Ate(t,e=0,r={}){const i=new DataView(t),{magic:s=wC}=r,l=i.getUint32(e,!1);return l===s||l===wC}function Tte(t,e,r=0,i={}){const s=new DataView(e),l=Ete(s,r+0),h=s.getUint32(r+4,Am),a=s.getUint32(r+8,Am);switch(Object.assign(t,{header:{byteOffset:r,byteLength:a,hasBinChunk:!1},type:l,version:h,json:{},binChunks:[]}),r+=lE,t.version){case 1:return Ste(t,s,r);case 2:return Cte(t,s,r,i={});default:throw new Error(`Invalid GLB version ${t.version}. Only supports version 1 and 2.`)}}function Ste(t,e,r){ki(t.header.byteLength>lE+t1);const i=e.getUint32(r+0,Am),s=e.getUint32(r+4,Am);return r+=t1,ki(s===bte),tw(t,e,r,i),r+=i,r+=rw(t,e,r,t.header.byteLength),r}function Cte(t,e,r,i){return ki(t.header.byteLength>lE+t1),Mte(t,e,r,i),r+t.header.byteLength}function Mte(t,e,r,i){for(;r+8<=t.header.byteLength;){const s=e.getUint32(r+0,Am),l=e.getUint32(r+4,Am);switch(r+=t1,l){case yte:tw(t,e,r,s);break;case vte:rw(t,e,r,s);break;case xte:i.strict||tw(t,e,r,s);break;case wte:i.strict||rw(t,e,r,s);break}r+=L_(s,4)}return r}function tw(t,e,r,i){const s=new Uint8Array(e.buffer,r,i),l=new TextDecoder("utf8").decode(s);return t.json=JSON.parse(l),L_(i,4)}function rw(t,e,r,i){return t.header.hasBinChunk=!0,t.binChunks.push({byteOffset:r,byteLength:i,arrayBuffer:e.buffer}),L_(i,4)}function gk(t,e){if(t.startsWith("data:")||t.startsWith("http:")||t.startsWith("https:"))return t;const r=e.baseUri||e.uri;if(!r)throw new Error(`'baseUri' must be provided to resolve relative url ${t}`);return r.substr(0,r.lastIndexOf("/")+1)+t}const Pte="B9h9z9tFBBBF8fL9gBB9gLaaaaaFa9gEaaaB9gFaFa9gEaaaFaEMcBFFFGGGEIIILF9wFFFLEFBFKNFaFCx/IFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBF8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBGy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBEn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBIi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBKI9z9iqlBOc+x8ycGBM/qQFTa8jUUUUBCU/EBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAGTkUUUBRNCUoBAG9uC/wgBZHKCUGAKCUG9JyRVAECFJRICBRcGXEXAcAF9PQFAVAFAclAcAVJAF9JyRMGXGXAG9FQBAMCbJHKC9wZRSAKCIrCEJCGrRQANCUGJRfCBRbAIRTEXGXAOATlAQ9PQBCBRISEMATAQJRIGXAS9FQBCBRtCBREEXGXAOAIlCi9PQBCBRISLMANCU/CBJAEJRKGXGXGXGXGXATAECKrJ2BBAtCKZrCEZfIBFGEBMAKhB83EBAKCNJhB83EBSEMAKAI2BIAI2BBHmCKrHYAYCE6HYy86BBAKCFJAICIJAYJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCGJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCEJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCIJAYAmJHY2BBAI2BFHmCKrHPAPCE6HPy86BBAKCLJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCKJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCOJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCNJAYAmJHY2BBAI2BGHmCKrHPAPCE6HPy86BBAKCVJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCcJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCMJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCSJAYAmJHm2BBAI2BEHICKrHYAYCE6HYy86BBAKCQJAmAYJHm2BBAICIrCEZHYAYCE6HYy86BBAKCfJAmAYJHm2BBAICGrCEZHYAYCE6HYy86BBAKCbJAmAYJHK2BBAICEZHIAICE6HIy86BBAKAIJRISGMAKAI2BNAI2BBHmCIrHYAYCb6HYy86BBAKCFJAICNJAYJHY2BBAmCbZHmAmCb6Hmy86BBAKCGJAYAmJHm2BBAI2BFHYCIrHPAPCb6HPy86BBAKCEJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCIJAmAYJHm2BBAI2BGHYCIrHPAPCb6HPy86BBAKCLJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCKJAmAYJHm2BBAI2BEHYCIrHPAPCb6HPy86BBAKCOJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCNJAmAYJHm2BBAI2BIHYCIrHPAPCb6HPy86BBAKCVJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCcJAmAYJHm2BBAI2BLHYCIrHPAPCb6HPy86BBAKCMJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCSJAmAYJHm2BBAI2BKHYCIrHPAPCb6HPy86BBAKCQJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCfJAmAYJHm2BBAI2BOHICIrHYAYCb6HYy86BBAKCbJAmAYJHK2BBAICbZHIAICb6HIy86BBAKAIJRISFMAKAI8pBB83BBAKCNJAICNJ8pBB83BBAICTJRIMAtCGJRtAECTJHEAS9JQBMMGXAIQBCBRISEMGXAM9FQBANAbJ2BBRtCBRKAfREEXAEANCU/CBJAKJ2BBHTCFrCBATCFZl9zAtJHt86BBAEAGJREAKCFJHKAM9HQBMMAfCFJRfAIRTAbCFJHbAG9HQBMMABAcAG9sJANCUGJAMAG9sTkUUUBpANANCUGJAMCaJAG9sJAGTkUUUBpMAMCBAIyAcJRcAIQBMC9+RKSFMCBC99AOAIlAGCAAGCA9Ly6yRKMALCU/EBJ8kUUUUBAKM+OmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUFT+JUUUBpALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM+lLKFaF99GaG99FaG99GXGXAGCI9HQBAF9FQFEXGXGX9DBBB8/9DBBB+/ABCGJHG1BB+yAB1BBHE+yHI+L+TABCFJHL1BBHK+yHO+L+THN9DBBBB9gHVyAN9DBB/+hANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE86BBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG86BBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG86BBABCIJRBAFCaJHFQBSGMMAF9FQBEXGXGX9DBBB8/9DBBB+/ABCIJHG8uFB+yAB8uFBHE+yHI+L+TABCGJHL8uFBHK+yHO+L+THN9DBBBB9gHVyAN9DB/+g6ANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE87FBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG87FBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG87FBABCNJRBAFCaJHFQBMMM/SEIEaE99EaF99GXAF9FQBCBREABRIEXGXGX9D/zI818/AICKJ8uFBHLCEq+y+VHKAI8uFB+y+UHO9DB/+g6+U9DBBB8/9DBBB+/AO9DBBBB9gy+SHN+L9DBBB9P9d9FQBAN+oRVSFMCUUUU94RVMAICIJ8uFBRcAICGJ8uFBRMABALCFJCEZAEqCFWJAV87FBGXGXAKAM+y+UHN9DB/+g6+U9DBBB8/9DBBB+/AN9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRMSFMCUUUU94RMMABALCGJCEZAEqCFWJAM87FBGXGXAKAc+y+UHK9DB/+g6+U9DBBB8/9DBBB+/AK9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRcSFMCUUUU94RcMABALCaJCEZAEqCFWJAc87FBGXGX9DBBU8/AOAO+U+TANAN+U+TAKAK+U+THO9DBBBBAO9DBBBB9gy+R9DB/+g6+U9DBBB8/+SHO+L9DBBB9P9d9FQBAO+oRcSFMCUUUU94RcMABALCEZAEqCFWJAc87FBAICNJRIAECIJREAFCaJHFQBMMM9JBGXAGCGrAF9sHF9FQBEXABAB8oGBHGCNWCN91+yAGCi91CnWCUUU/8EJ+++U84GBABCIJRBAFCaJHFQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEM/lFFFaGXGXAFABqCEZ9FQBABRESFMGXGXAGCT9PQBABRESFMABREEXAEAF8oGBjGBAECIJAFCIJ8oGBjGBAECNJAFCNJ8oGBjGBAECSJAFCSJ8oGBjGBAECTJREAFCTJRFAGC9wJHGCb9LQBMMAGCI9JQBEXAEAF8oGBjGBAFCIJRFAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF2BB86BBAECFJREAFCFJRFAGCaJHGQBMMABMoFFGaGXGXABCEZ9FQBABRESFMAFCgFZC+BwsN9sRIGXGXAGCT9PQBABRESFMABREEXAEAIjGBAECSJAIjGBAECNJAIjGBAECIJAIjGBAECTJREAGC9wJHGCb9LQBMMAGCI9JQBEXAEAIjGBAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF86BBAECFJREAGCaJHGQBMMABMMMFBCUNMIT9kBB",Rte="B9h9z9tFBBBF8dL9gBB9gLaaaaaFa9gEaaaB9gGaaB9gFaFaEQSBBFBFFGEGEGIILF9wFFFLEFBFKNFaFCx/aFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBG8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBIy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBKi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBNn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBcI9z9iqlBMc/j9JSIBTEM9+FLa8jUUUUBCTlRBCBRFEXCBRGCBREEXABCNJAGJAECUaAFAGrCFZHIy86BBAEAIJREAGCFJHGCN9HQBMAFCx+YUUBJAE86BBAFCEWCxkUUBJAB8pEN83EBAFCFJHFCUG9HQBMMkRIbaG97FaK978jUUUUBCU/KBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAG/8cBBCUoBAG9uC/wgBZHKCUGAKCUG9JyRNAECFJRKCBRVGXEXAVAF9PQFANAFAVlAVANJAF9JyRcGXGXAG9FQBAcCbJHIC9wZHMCE9sRSAMCFWRQAICIrCEJCGrRfCBRbEXAKRTCBRtGXEXGXAOATlAf9PQBCBRKSLMALCU/CBJAtAM9sJRmATAfJRKCBREGXAMCoB9JQBAOAKlC/gB9JQBCBRIEXAmAIJREGXGXGXGXGXATAICKrJ2BBHYCEZfIBFGEBMAECBDtDMIBSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIBAKCTJRKMGXGXGXGXGXAYCGrCEZfIBFGEBMAECBDtDMITSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMITAKCTJRKMGXGXGXGXGXAYCIrCEZfIBFGEBMAECBDtDMIASEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIAAKCTJRKMGXGXGXGXGXAYCKrfIBFGEBMAECBDtDMI8wSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCIJAnDeBJAYCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCNJAnDeBJAYCx+YUUBJ2BBJRKSFMAEAKDBBBDMI8wAKCTJRKMAICoBJREAICUFJAM9LQFAERIAOAKlC/fB9LQBMMGXAEAM9PQBAECErRIEXGXAOAKlCi9PQBCBRKSOMAmAEJRYGXGXGXGXGXATAECKrJ2BBAICKZrCEZfIBFGEBMAYCBDtDMIBSEMAYAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAYAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAYAKDBBBDMIBAKCTJRKMAICGJRIAECTJHEAM9JQBMMGXAK9FQBAKRTAtCFJHtCI6QGSFMMCBRKSEMGXAM9FQBALCUGJAbJREALAbJDBGBRnCBRYEXAEALCU/CBJAYJHIDBIBHdCFD9tAdCFDbHPD9OD9hD9RHdAIAMJDBIBHiCFD9tAiAPD9OD9hD9RHiDQBTFtGmEYIPLdKeOnH8ZAIAQJDBIBHpCFD9tApAPD9OD9hD9RHpAIASJDBIBHyCFD9tAyAPD9OD9hD9RHyDQBTFtGmEYIPLdKeOnH8cDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGEAnD9uHnDyBjGBAEAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnA8ZA8cDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNiV8ZcpMyS8cQ8df8eb8fHdApAyDQNiV8ZcpMyS8cQ8df8eb8fHiDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJREAYCTJHYAM9JQBMMAbCIJHbAG9JQBMMABAVAG9sJALCUGJAcAG9s/8cBBALALCUGJAcCaJAG9sJAG/8cBBMAcCBAKyAVJRVAKQBMC9+RKSFMCBC99AOAKlAGCAAGCA9Ly6yRKMALCU/KBJ8kUUUUBAKMNBT+BUUUBM+KmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUF/8MBALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM/xLGEaK978jUUUUBCAlHE8kUUUUBGXGXAGCI9HQBGXAFC98ZHI9FQBABRGCBRLEXAGAGDBBBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMBBAGCTJRGALCIJHLAI9JQBMMAIAF9PQFAEAFCEZHLCGWHGqCBCTAGl/8MBAEABAICGWJHIAG/8cBBGXAL9FQBAEAEDBIBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMIBMAIAEAG/8cBBSFMABAFC98ZHGT+HUUUBAGAF9PQBAEAFCEZHICEWHLJCBCAALl/8MBAEABAGCEWJHGAL/8cBBAEAIT+HUUUBAGAEAL/8cBBMAECAJ8kUUUUBM+yEGGaO97GXAF9FQBCBRGEXABCTJHEAEDBBBHICBDtHLCUU98D8cFCUU98D8cEHKD9OABDBBBHOAIDQILKOSQfbPden8c8d8e8fCggFDtD9OD/6FAOAIDQBFGENVcMTtmYi8ZpyHICTD+sFD/6FHND/gFAICTD+rFCTD+sFD/6FHVD/gFD/kFD/lFHI9DB/+g6DYAVAIALD+2FHLAVCUUUU94DtHcD9OD9RD/kFHVAVD/mFAIAID/mFANALANAcD9OD9RD/kFHIAID/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHLD/kFCTD+rFAVAND/mFALD/kFCggEDtD9OD9QHVAIAND/mFALD/kFCaDbCBDnGCBDnECBDnKCBDnOCBDncCBDnMCBDnfCBDnbD9OHIDQNVi8ZcMpySQ8c8dfb8e8fD9QDMBBABAOAKD9OAVAIDQBFTtGEmYILPdKOenD9QDMBBABCAJRBAGCIJHGAF9JQBMMM94FEa8jUUUUBCAlHE8kUUUUBABAFC98ZHIT+JUUUBGXAIAF9PQBAEAFCEZHLCEWHFJCBCAAFl/8MBAEABAICEWJHBAF/8cBBAEALT+JUUUBABAEAF/8cBBMAECAJ8kUUUUBM/hEIGaF97FaL978jUUUUBCTlRGGXAF9FQBCBREEXAGABDBBBHIABCTJHLDBBBHKDQILKOSQfbPden8c8d8e8fHOCTD+sFHNCID+rFDMIBAB9DBBU8/DY9D/zI818/DYANCEDtD9QD/6FD/nFHNAIAKDQBFGENVcMTtmYi8ZpyHICTD+rFCTD+sFD/6FD/mFHKAKD/mFANAICTD+sFD/6FD/mFHVAVD/mFANAOCTD+rFCTD+sFD/6FD/mFHOAOD/mFD/kFD/kFD/lFCBDtD+4FD/jF9DB/+g6DYHND/mF9DBBX9LDYHID/kFCggEDtHcD9OAVAND/mFAID/kFCTD+rFD9QHVAOAND/mFAID/kFCTD+rFAKAND/mFAID/kFAcD9OD9QHNDQBFTtGEmYILPdKOenHID8dBAGDBIBDyB+t+J83EBABCNJAID8dFAGDBIBDyF+t+J83EBALAVANDQNVi8ZcMpySQ8c8dfb8e8fHND8dBAGDBIBDyG+t+J83EBABCiJAND8dFAGDBIBDyE+t+J83EBABCAJRBAECIJHEAF9JQBMMM/3FGEaF978jUUUUBCoBlREGXAGCGrAF9sHIC98ZHL9FQBCBRGABRFEXAFAFDBBBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMBBAFCTJRFAGCIJHGAL9JQBMMGXALAI9PQBAEAICEZHGCGWHFqCBCoBAFl/8MBAEABALCGWJHLAF/8cBBGXAG9FQBAEAEDBIBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMIBMALAEAF/8cBBMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEMMMFBCUNMIT9tBB",Ite=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),kte=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]),Bte={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},Lte={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};async function Dte(t,e,r,i,s,l="NONE"){const h=await Nte();zte(h,h.exports[Lte[s]],t,e,r,i,h.exports[Bte[l||"NONE"]])}let Ab;async function Nte(){return Ab||(Ab=Ote()),Ab}async function Ote(){let t=Pte;WebAssembly.validate(Ite)&&(t=Rte,console.log("Warning: meshopt_decoder is using experimental SIMD support"));const e=await WebAssembly.instantiate(Fte(t),{});return await e.instance.exports.__wasm_call_ctors(),e.instance}function Fte(t){const e=new Uint8Array(t.length);for(let i=0;i<t.length;++i){const s=t.charCodeAt(i);e[i]=s>96?s-71:s>64?s-65:s>47?s+4:s>46?63:62}let r=0;for(let i=0;i<t.length;++i)e[r++]=e[i]<60?kte[e[i]]:(e[i]-60)*64+e[++i];return e.buffer.slice(0,r)}function zte(t,e,r,i,s,l,h){const a=t.exports.sbrk,v=i+3&-4,T=a(v*s),C=a(l.length),k=new Uint8Array(t.exports.memory.buffer);k.set(l,C);const L=e(T,i,s,C,l.length);if(L===0&&h&&h(T,v,s),r.set(k.subarray(T,T+i*s)),a(T-a(0)),L!==0)throw new Error(`Malformed buffer data: ${L}`)}const r1="EXT_meshopt_compression",Ute=r1;async function jte(t,e){const r=new Ls(t);if(!e?.gltf?.decompressMeshes||!e.gltf?.loadBuffers)return;const i=[];for(const s of t.json.bufferViews||[])i.push(Vte(r,s));await Promise.all(i),r.removeExtension(r1)}async function Vte(t,e){const r=t.getObjectExtension(e,r1);if(r){const{byteOffset:i=0,byteLength:s=0,byteStride:l,count:h,mode:a,filter:v="NONE",buffer:T}=r,C=t.gltf.buffers[T],k=new Uint8Array(C.arrayBuffer,C.byteOffset+i,s),L=new Uint8Array(t.gltf.buffers[e.buffer].arrayBuffer,e.byteOffset,e.byteLength);await Dte(L,h,l,k,a,v),t.removeObjectExtension(e,r1)}}const Gte=Object.freeze(Object.defineProperty({__proto__:null,decode:jte,name:Ute},Symbol.toStringTag,{value:"Module"})),Wf="EXT_texture_webp",Hte=Wf;function Wte(t,e){const r=new Ls(t);if(!wV("image/webp")){if(r.getRequiredExtensions().includes(Wf))throw new Error(`gltf: Required extension ${Wf} not supported by browser`);return}const{json:i}=r;for(const s of i.textures||[]){const l=r.getObjectExtension(s,Wf);l&&(s.source=l.source),r.removeObjectExtension(s,Wf)}r.removeExtension(Wf)}const qte=Object.freeze(Object.defineProperty({__proto__:null,name:Hte,preprocess:Wte},Symbol.toStringTag,{value:"Module"})),C0="KHR_texture_basisu",$te=C0;function Zte(t,e){const r=new Ls(t),{json:i}=r;for(const s of i.textures||[]){const l=r.getObjectExtension(s,C0);l&&(s.source=l.source,r.removeObjectExtension(s,C0))}r.removeExtension(C0)}const Xte=Object.freeze(Object.defineProperty({__proto__:null,name:$te,preprocess:Zte},Symbol.toStringTag,{value:"Module"})),Kte="4.3.1",Yte={dataType:null,batchType:null,name:"Draco",id:"draco",module:"draco",version:Kte,worker:!0,extensions:["drc"],mimeTypes:["application/octet-stream"],binary:!0,tests:["DRACO"],options:{draco:{decoderType:typeof WebAssembly=="object"?"wasm":"js",libraryPath:"libs/",extraAttributes:{},attributeNameEntry:void 0}}};function Jte(t,e,r){const i=_k(e.metadata),s=[],l=Qte(e.attributes);for(const h in t){const a=t[h],v=EC(h,a,l[h]);s.push(v)}if(r){const h=EC("indices",r);s.push(h)}return{fields:s,metadata:i}}function Qte(t){const e={};for(const r in t){const i=t[r];e[i.name||"undefined"]=i}return e}function EC(t,e,r){const i=r?_k(r.metadata):void 0;return Vj(t,e,i)}function _k(t){Object.entries(t);const e={};for(const r in t)e[`${r}.string`]=JSON.stringify(t[r]);return e}const AC={POSITION:"POSITION",NORMAL:"NORMAL",COLOR:"COLOR_0",TEX_COORD:"TEXCOORD_0"},ere={1:Int8Array,2:Uint8Array,3:Int16Array,4:Uint16Array,5:Int32Array,6:Uint32Array,9:Float32Array},tre=4;class rre{draco;decoder;metadataQuerier;constructor(e){this.draco=e,this.decoder=new this.draco.Decoder,this.metadataQuerier=new this.draco.MetadataQuerier}destroy(){this.draco.destroy(this.decoder),this.draco.destroy(this.metadataQuerier)}parseSync(e,r={}){const i=new this.draco.DecoderBuffer;i.Init(new Int8Array(e),e.byteLength),this._disableAttributeTransforms(r);const s=this.decoder.GetEncodedGeometryType(i),l=s===this.draco.TRIANGULAR_MESH?new this.draco.Mesh:new this.draco.PointCloud;try{let h;switch(s){case this.draco.TRIANGULAR_MESH:h=this.decoder.DecodeBufferToMesh(i,l);break;case this.draco.POINT_CLOUD:h=this.decoder.DecodeBufferToPointCloud(i,l);break;default:throw new Error("DRACO: Unknown geometry type.")}if(!h.ok()||!l.ptr){const k=`DRACO decompression failed: ${h.error_msg()}`;throw new Error(k)}const a=this._getDracoLoaderData(l,s,r),v=this._getMeshData(l,a,r),T=l5(v.attributes),C=Jte(v.attributes,a,v.indices);return{loader:"draco",loaderData:a,header:{vertexCount:l.num_points(),boundingBox:T},...v,schema:C}}finally{this.draco.destroy(i),l&&this.draco.destroy(l)}}_getDracoLoaderData(e,r,i){const s=this._getTopLevelMetadata(e),l=this._getDracoAttributes(e,i);return{geometry_type:r,num_attributes:e.num_attributes(),num_points:e.num_points(),num_faces:e instanceof this.draco.Mesh?e.num_faces():0,metadata:s,attributes:l}}_getDracoAttributes(e,r){const i={};for(let s=0;s<e.num_attributes();s++){const l=this.decoder.GetAttribute(e,s),h=this._getAttributeMetadata(e,s);i[l.unique_id()]={unique_id:l.unique_id(),attribute_type:l.attribute_type(),data_type:l.data_type(),num_components:l.num_components(),byte_offset:l.byte_offset(),byte_stride:l.byte_stride(),normalized:l.normalized(),attribute_index:s,metadata:h};const a=this._getQuantizationTransform(l,r);a&&(i[l.unique_id()].quantization_transform=a);const v=this._getOctahedronTransform(l,r);v&&(i[l.unique_id()].octahedron_transform=v)}return i}_getMeshData(e,r,i){const s=this._getMeshAttributes(r,e,i);if(!s.POSITION)throw new Error("DRACO: No position attribute found.");if(e instanceof this.draco.Mesh)switch(i.topology){case"triangle-strip":return{topology:"triangle-strip",mode:4,attributes:s,indices:{value:this._getTriangleStripIndices(e),size:1}};case"triangle-list":default:return{topology:"triangle-list",mode:5,attributes:s,indices:{value:this._getTriangleListIndices(e),size:1}}}return{topology:"point-list",mode:0,attributes:s}}_getMeshAttributes(e,r,i){const s={};for(const l of Object.values(e.attributes)){const h=this._deduceAttributeName(l,i);l.name=h;const a=this._getAttributeValues(r,l);if(a){const{value:v,size:T}=a;s[h]={value:v,size:T,byteOffset:l.byte_offset,byteStride:l.byte_stride,normalized:l.normalized}}}return s}_getTriangleListIndices(e){const r=e.num_faces()*3,i=r*tre,s=this.draco._malloc(i);try{return this.decoder.GetTrianglesUInt32Array(e,i,s),new Uint32Array(this.draco.HEAPF32.buffer,s,r).slice()}finally{this.draco._free(s)}}_getTriangleStripIndices(e){const r=new this.draco.DracoInt32Array;try{return this.decoder.GetTriangleStripsFromMesh(e,r),sre(r)}finally{this.draco.destroy(r)}}_getAttributeValues(e,r){const i=ere[r.data_type];if(!i)return console.warn(`DRACO: Unsupported attribute type ${r.data_type}`),null;const s=r.num_components,l=e.num_points()*s,h=l*i.BYTES_PER_ELEMENT,a=ire(this.draco,i);let v;const T=this.draco._malloc(h);try{const C=this.decoder.GetAttribute(e,r.attribute_index);this.decoder.GetAttributeDataArrayForAllPoints(e,C,a,h,T),v=new i(this.draco.HEAPF32.buffer,T,l).slice()}finally{this.draco._free(T)}return{value:v,size:s}}_deduceAttributeName(e,r){const i=e.unique_id;for(const[h,a]of Object.entries(r.extraAttributes||{}))if(a===i)return h;const s=e.attribute_type;for(const h in AC)if(this.draco[h]===s)return AC[h];const l=r.attributeNameEntry||"name";return e.metadata[l]?e.metadata[l].string:`CUSTOM_ATTRIBUTE_${i}`}_getTopLevelMetadata(e){const r=this.decoder.GetMetadata(e);return this._getDracoMetadata(r)}_getAttributeMetadata(e,r){const i=this.decoder.GetAttributeMetadata(e,r);return this._getDracoMetadata(i)}_getDracoMetadata(e){if(!e||!e.ptr)return{};const r={},i=this.metadataQuerier.NumEntries(e);for(let s=0;s<i;s++){const l=this.metadataQuerier.GetEntryName(e,s);r[l]=this._getDracoMetadataField(e,l)}return r}_getDracoMetadataField(e,r){const i=new this.draco.DracoInt32Array;try{this.metadataQuerier.GetIntEntryArray(e,r,i);const s=nre(i);return{int:this.metadataQuerier.GetIntEntry(e,r),string:this.metadataQuerier.GetStringEntry(e,r),double:this.metadataQuerier.GetDoubleEntry(e,r),intArray:s}}finally{this.draco.destroy(i)}}_disableAttributeTransforms(e){const{quantizedAttributes:r=[],octahedronAttributes:i=[]}=e,s=[...r,...i];for(const l of s)this.decoder.SkipAttributeTransform(this.draco[l])}_getQuantizationTransform(e,r){const{quantizedAttributes:i=[]}=r,s=e.attribute_type();if(i.map(l=>this.decoder[l]).includes(s)){const l=new this.draco.AttributeQuantizationTransform;try{if(l.InitFromAttribute(e))return{quantization_bits:l.quantization_bits(),range:l.range(),min_values:new Float32Array([1,2,3]).map(h=>l.min_value(h))}}finally{this.draco.destroy(l)}}return null}_getOctahedronTransform(e,r){const{octahedronAttributes:i=[]}=r,s=e.attribute_type();if(i.map(l=>this.decoder[l]).includes(s)){const l=new this.draco.AttributeQuantizationTransform;try{if(l.InitFromAttribute(e))return{quantization_bits:l.quantization_bits()}}finally{this.draco.destroy(l)}}return null}}function ire(t,e){switch(e){case Float32Array:return t.DT_FLOAT32;case Int8Array:return t.DT_INT8;case Int16Array:return t.DT_INT16;case Int32Array:return t.DT_INT32;case Uint8Array:return t.DT_UINT8;case Uint16Array:return t.DT_UINT16;case Uint32Array:return t.DT_UINT32;default:return t.DT_INVALID}}function nre(t){const e=t.size(),r=new Int32Array(e);for(let i=0;i<e;i++)r[i]=t.GetValue(i);return r}function sre(t){const e=t.size(),r=new Int32Array(e);for(let i=0;i<e;i++)r[i]=t.GetValue(i);return r}const ore="1.5.6",are="1.4.1",Tb=`https://www.gstatic.com/draco/versioned/decoders/${ore}`,aa={DECODER:"draco_wasm_wrapper.js",DECODER_WASM:"draco_decoder.wasm",FALLBACK_DECODER:"draco_decoder.js",ENCODER:"draco_encoder.js"},Sb={[aa.DECODER]:`${Tb}/${aa.DECODER}`,[aa.DECODER_WASM]:`${Tb}/${aa.DECODER_WASM}`,[aa.FALLBACK_DECODER]:`${Tb}/${aa.FALLBACK_DECODER}`,[aa.ENCODER]:`https://raw.githubusercontent.com/google/draco/${are}/javascript/${aa.ENCODER}`};let Cb;async function lre(t){const e=t.modules||{};return e.draco3d?Cb||=e.draco3d.createDecoderModule({}).then(r=>({draco:r})):Cb||=cre(t),await Cb}async function cre(t){let e,r;switch(t.draco&&t.draco.decoderType){case"js":e=await jp(Sb[aa.FALLBACK_DECODER],"draco",t,aa.FALLBACK_DECODER);break;case"wasm":default:[e,r]=await Promise.all([await jp(Sb[aa.DECODER],"draco",t,aa.DECODER),await jp(Sb[aa.DECODER_WASM],"draco",t,aa.DECODER_WASM)])}return e=e||globalThis.DracoDecoderModule,await ure(e,r)}function ure(t,e){const r={};return e&&(r.wasmBinary=e),new Promise(i=>{t({...r,onModuleLoaded:s=>i({draco:s})})})}const yk={...Yte,parse:hre};async function hre(t,e){const{draco:r}=await lre(e),i=new rre(r);try{return i.parseSync(t,e?.draco)}finally{i.destroy()}}function dre(t){const e={};for(const r in t){const i=t[r];if(r!=="indices"){const s=vk(i);e[r]=s}}return e}function vk(t){const{buffer:e,size:r,count:i}=pre(t);return{value:e,size:r,byteOffset:0,count:i,type:ak(r),componentType:I1(e)}}function pre(t){let e=t,r=1,i=0;return t&&t.value&&(e=t.value,r=t.size||1),e&&(ArrayBuffer.isView(e)||(e=fre(e,Float32Array)),i=e.length/r),{buffer:e,size:r,count:i}}function fre(t,e,r=!1){return t?Array.isArray(t)?new e(t):r&&!(t instanceof e)?new e(t):t:null}const md="KHR_draco_mesh_compression",mre=md;function gre(t,e,r){const i=new Ls(t);for(const s of bk(i))i.getObjectExtension(s,md)}async function _re(t,e,r){if(!e?.gltf?.decompressMeshes)return;const i=new Ls(t),s=[];for(const l of bk(i))i.getObjectExtension(l,md)&&s.push(vre(i,l,e,r));await Promise.all(s),i.removeExtension(md)}function yre(t,e={}){const r=new Ls(t);for(const i of r.json.meshes||[])bre(i),r.addRequiredExtension(md)}async function vre(t,e,r,i){const s=t.getObjectExtension(e,md);if(!s)return;const l=t.getTypedArrayForBufferView(s.bufferView),h=f2(l.buffer,l.byteOffset),a={...r};delete a["3d-tiles"];const v=await B_(h,yk,a,i),T=dre(v.attributes);for(const[C,k]of Object.entries(T))if(C in e.attributes){const L=e.attributes[C],O=t.getAccessor(L);O?.min&&O?.max&&(k.min=O.min,k.max=O.max)}e.attributes=T,v.indices&&(e.indices=vk(v.indices)),t.removeObjectExtension(e,md),xre(e)}function bre(t,e,r=4,i,s){if(!i.DracoWriter)throw new Error("options.gltf.DracoWriter not provided");const l=i.DracoWriter.encodeSync({attributes:t}),h=s?.parseSync?.({attributes:t}),a=i._addFauxAttributes(h.attributes),v=i.addBufferView(l);return{primitives:[{attributes:a,mode:r,extensions:{[md]:{bufferView:v,attributes:a}}}]}}function xre(t){if(!t.attributes&&Object.keys(t.attributes).length>0)throw new Error("glTF: Empty primitive detected: Draco decompression failure?")}function*bk(t){for(const e of t.json.meshes||[])for(const r of e.primitives)yield r}const wre=Object.freeze(Object.defineProperty({__proto__:null,decode:_re,encode:yre,name:mre,preprocess:gre},Symbol.toStringTag,{value:"Module"})),L1="KHR_texture_transform",Ere=L1,l0=new Je,Are=new Sn,Tre=new Sn;async function Sre(t,e){if(!new Ls(t).hasExtension(L1)||!e.gltf?.loadBuffers)return;const r=t.json.materials||[];for(let i=0;i<r.length;i++)Cre(i,t)}function Cre(t,e){const r=e.json.materials?.[t],i=[r?.pbrMetallicRoughness?.baseColorTexture,r?.emissiveTexture,r?.normalTexture,r?.occlusionTexture,r?.pbrMetallicRoughness?.metallicRoughnessTexture],s=[];for(const l of i)l&&l?.extensions?.[L1]&&Mre(e,t,l,s)}function Mre(t,e,r,i){const s=Pre(r,i);if(!s)return;const l=t.json.meshes||[];for(const h of l)for(const a of h.primitives){const v=a.material;Number.isFinite(v)&&e===v&&Rre(t,a,s)}}function Pre(t,e){const r=t.extensions?.[L1],{texCoord:i=0}=t,{texCoord:s=i}=r;if(e.findIndex(([l,h])=>l===i&&h===s)===-1){const l=Bre(r);return i!==s&&(t.texCoord=s),e.push([i,s]),{originalTexCoord:i,texCoord:s,matrix:l}}return null}function Rre(t,e,r){const{originalTexCoord:i,texCoord:s,matrix:l}=r,h=e.attributes[`TEXCOORD_${i}`];if(Number.isFinite(h)){const a=t.json.accessors?.[h];if(a&&a.bufferView){const v=t.json.bufferViews?.[a.bufferView];if(v){const{arrayBuffer:T,byteOffset:C}=t.buffers[v.buffer],k=(C||0)+(a.byteOffset||0)+(v.byteOffset||0),{ArrayType:L,length:O}=nE(a,v),K=ok[a.componentType],$=sk[a.type],ne=v.byteStride||K*$,oe=new Float32Array(O);for(let fe=0;fe<a.count;fe++){const ue=new L(T,k+fe*ne,2);l0.set(ue[0],ue[1],1),l0.transformByMatrix3(l),oe.set([l0[0],l0[1]],fe*$)}i===s?Ire(a,v,t.buffers,oe):kre(s,a,e,t,oe)}}}}function Ire(t,e,r,i){t.componentType=5126,r.push({arrayBuffer:i.buffer,byteOffset:0,byteLength:i.buffer.byteLength}),e.buffer=r.length-1,e.byteLength=i.buffer.byteLength,e.byteOffset=0,delete e.byteStride}function kre(t,e,r,i,s){i.buffers.push({arrayBuffer:s.buffer,byteOffset:0,byteLength:s.buffer.byteLength});const l=i.json.bufferViews;if(!l)return;l.push({buffer:i.buffers.length-1,byteLength:s.buffer.byteLength,byteOffset:0});const h=i.json.accessors;h&&(h.push({bufferView:l?.length-1,byteOffset:0,componentType:5126,count:e.count,type:"VEC2"}),r.attributes[`TEXCOORD_${t}`]=h.length-1)}function Bre(t){const{offset:e=[0,0],rotation:r=0,scale:i=[1,1]}=t,s=new Sn().set(1,0,0,0,1,0,e[0],e[1],1),l=Are.set(Math.cos(r),Math.sin(r),0,-Math.sin(r),Math.cos(r),0,0,0,1),h=Tre.set(i[0],0,0,0,i[1],0,0,0,1);return s.multiplyRight(l).multiplyRight(h)}const Lre=Object.freeze(Object.defineProperty({__proto__:null,decode:Sre,name:Ere},Symbol.toStringTag,{value:"Module"})),Fp="KHR_lights_punctual",Dre=Fp;async function Nre(t){const e=new Ls(t),{json:r}=e,i=e.getExtension(Fp);i&&(e.json.lights=i.lights,e.removeExtension(Fp));for(const s of r.nodes||[]){const l=e.getObjectExtension(s,Fp);l&&(s.light=l.light),e.removeObjectExtension(s,Fp)}}async function Ore(t){const e=new Ls(t),{json:r}=e;if(r.lights){const i=e.addExtension(Fp);Ga(!i.lights),i.lights=r.lights,delete r.lights}if(e.json.lights){for(const i of e.json.lights){const s=i.node;e.addObjectExtension(s,Fp,i)}delete e.json.lights}}const Fre=Object.freeze(Object.defineProperty({__proto__:null,decode:Nre,encode:Ore,name:Dre},Symbol.toStringTag,{value:"Module"})),A_="KHR_materials_unlit",zre=A_;async function Ure(t){const e=new Ls(t),{json:r}=e;for(const i of r.materials||[])i.extensions&&i.extensions.KHR_materials_unlit&&(i.unlit=!0),e.removeObjectExtension(i,A_);e.removeExtension(A_)}function jre(t){const e=new Ls(t),{json:r}=e;if(e.materials)for(const i of r.materials||[])i.unlit&&(delete i.unlit,e.addObjectExtension(i,A_,{}),e.addExtension(A_))}const Vre=Object.freeze(Object.defineProperty({__proto__:null,decode:Ure,encode:jre,name:zre},Symbol.toStringTag,{value:"Module"})),Kg="KHR_techniques_webgl",Gre=Kg;async function Hre(t){const e=new Ls(t),{json:r}=e,i=e.getExtension(Kg);if(i){const s=qre(i,e);for(const l of r.materials||[]){const h=e.getObjectExtension(l,Kg);h&&(l.technique=Object.assign({},h,s[h.technique]),l.technique.values=$re(l.technique,e)),e.removeObjectExtension(l,Kg)}e.removeExtension(Kg)}}async function Wre(t,e){}function qre(t,e){const{programs:r=[],shaders:i=[],techniques:s=[]}=t,l=new TextDecoder;return i.forEach(h=>{if(Number.isFinite(h.bufferView))h.code=l.decode(e.getTypedArrayForBufferView(h.bufferView));else throw new Error("KHR_techniques_webgl: no shader code")}),r.forEach(h=>{h.fragmentShader=i[h.fragmentShader],h.vertexShader=i[h.vertexShader]}),s.forEach(h=>{h.program=r[h.program]}),s}function $re(t,e){const r=Object.assign({},t.values);return Object.keys(t.uniforms||{}).forEach(i=>{t.uniforms[i].value&&!(i in r)&&(r[i]=t.uniforms[i].value)}),Object.keys(r).forEach(i=>{typeof r[i]=="object"&&r[i].index!==void 0&&(r[i].texture=e.getTexture(r[i].index))}),r}const Zre=Object.freeze(Object.defineProperty({__proto__:null,decode:Hre,encode:Wre,name:Gre},Symbol.toStringTag,{value:"Module"})),xk=[Qee,Aee,Gte,qte,Xte,wre,Fre,Vre,Zre,Lre,gte];function Xre(t,e={},r){const i=xk.filter(s=>wk(s.name,e));for(const s of i)s.preprocess?.(t,e,r)}async function Kre(t,e={},r){const i=xk.filter(s=>wk(s.name,e));for(const s of i)await s.decode?.(t,e,r)}function wk(t,e){const r=e?.gltf?.excludeExtensions||{};return!(t in r&&!r[t])}const Mb="KHR_binary_glTF";function Yre(t){const e=new Ls(t),{json:r}=e;for(const i of r.images||[]){const s=e.getObjectExtension(i,Mb);s&&Object.assign(i,s),e.removeObjectExtension(i,Mb)}r.buffers&&r.buffers[0]&&delete r.buffers[0].uri,e.removeExtension(Mb)}const TC={accessors:"accessor",animations:"animation",buffers:"buffer",bufferViews:"bufferView",images:"image",materials:"material",meshes:"mesh",nodes:"node",samplers:"sampler",scenes:"scene",skins:"skin",textures:"texture"},Jre={accessor:"accessors",animations:"animation",buffer:"buffers",bufferView:"bufferViews",image:"images",material:"materials",mesh:"meshes",node:"nodes",sampler:"samplers",scene:"scenes",skin:"skins",texture:"textures"};class Qre{idToIndexMap={animations:{},accessors:{},buffers:{},bufferViews:{},images:{},materials:{},meshes:{},nodes:{},samplers:{},scenes:{},skins:{},textures:{}};json;normalize(e,r){this.json=e.json;const i=e.json;switch(i.asset&&i.asset.version){case"2.0":return;case void 0:case"1.0":break;default:console.warn(`glTF: Unknown version ${i.asset.version}`);return}if(!r.normalize)throw new Error("glTF v1 is not supported.");console.warn("Converting glTF v1 to glTF v2 format. This is experimental and may fail."),this._addAsset(i),this._convertTopLevelObjectsToArrays(i),Yre(e),this._convertObjectIdsToArrayIndices(i),this._updateObjects(i),this._updateMaterial(i)}_addAsset(e){e.asset=e.asset||{},e.asset.version="2.0",e.asset.generator=e.asset.generator||"Normalized to glTF 2.0 by loaders.gl"}_convertTopLevelObjectsToArrays(e){for(const r in TC)this._convertTopLevelObjectToArray(e,r)}_convertTopLevelObjectToArray(e,r){const i=e[r];if(!(!i||Array.isArray(i))){e[r]=[];for(const s in i){const l=i[s];l.id=l.id||s;const h=e[r].length;e[r].push(l),this.idToIndexMap[r][s]=h}}}_convertObjectIdsToArrayIndices(e){for(const r in TC)this._convertIdsToIndices(e,r);"scene"in e&&(e.scene=this._convertIdToIndex(e.scene,"scene"));for(const r of e.textures)this._convertTextureIds(r);for(const r of e.meshes)this._convertMeshIds(r);for(const r of e.nodes)this._convertNodeIds(r);for(const r of e.scenes)this._convertSceneIds(r)}_convertTextureIds(e){e.source&&(e.source=this._convertIdToIndex(e.source,"image"))}_convertMeshIds(e){for(const r of e.primitives){const{attributes:i,indices:s,material:l}=r;for(const h in i)i[h]=this._convertIdToIndex(i[h],"accessor");s&&(r.indices=this._convertIdToIndex(s,"accessor")),l&&(r.material=this._convertIdToIndex(l,"material"))}}_convertNodeIds(e){e.children&&(e.children=e.children.map(r=>this._convertIdToIndex(r,"node"))),e.meshes&&(e.meshes=e.meshes.map(r=>this._convertIdToIndex(r,"mesh")))}_convertSceneIds(e){e.nodes&&(e.nodes=e.nodes.map(r=>this._convertIdToIndex(r,"node")))}_convertIdsToIndices(e,r){e[r]||(console.warn(`gltf v1: json doesn't contain attribute ${r}`),e[r]=[]);for(const i of e[r])for(const s in i){const l=i[s],h=this._convertIdToIndex(l,s);i[s]=h}}_convertIdToIndex(e,r){const i=Jre[r];if(i in this.idToIndexMap){const s=this.idToIndexMap[i][e];if(!Number.isFinite(s))throw new Error(`gltf v1: failed to resolve ${r} with id ${e}`);return s}return e}_updateObjects(e){for(const r of this.json.buffers)delete r.type}_updateMaterial(e){for(const r of e.materials){r.pbrMetallicRoughness={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1};const i=r.values?.tex||r.values?.texture2d_0||r.values?.diffuseTex,s=e.textures.findIndex(l=>l.id===i);s!==-1&&(r.pbrMetallicRoughness.baseColorTexture={index:s})}}}function eie(t,e={}){return new Qre().normalize(t,e)}async function tie(t,e,r=0,i,s){return rie(t,e,r,i),eie(t,{normalize:i?.gltf?.normalize}),Xre(t,i,s),i?.gltf?.loadBuffers&&t.json.buffers&&await iie(t,i,s),i?.gltf?.loadImages&&await nie(t,i,s),await Kre(t,i,s),t}function rie(t,e,r,i){if(i.uri&&(t.baseUri=i.uri),e instanceof ArrayBuffer&&!Ate(e,r,i)&&(e=new TextDecoder().decode(e)),typeof e=="string")t.json=EU(e);else if(e instanceof ArrayBuffer){const h={};r=Tte(h,e,r,i.glb),Ga(h.type==="glTF",`Invalid GLB magic string ${h.type}`),t._glb=h,t.json=h.json}else Ga(!1,"GLTF: must be ArrayBuffer or string");const s=t.json.buffers||[];if(t.buffers=new Array(s.length).fill(null),t._glb&&t._glb.header.hasBinChunk){const{binChunks:h}=t._glb;t.buffers[0]={arrayBuffer:h[0].arrayBuffer,byteOffset:h[0].byteOffset,byteLength:h[0].byteLength}}const l=t.json.images||[];t.images=new Array(l.length).fill({})}async function iie(t,e,r){const i=t.json.buffers||[];for(let s=0;s<i.length;++s){const l=i[s];if(l.uri){const{fetch:h}=r;Ga(h);const a=gk(l.uri,e),v=await(await r?.fetch?.(a))?.arrayBuffer?.();t.buffers[s]={arrayBuffer:v,byteOffset:0,byteLength:v.byteLength},delete l.uri}else t.buffers[s]===null&&(t.buffers[s]={arrayBuffer:new ArrayBuffer(l.byteLength),byteOffset:0,byteLength:l.byteLength})}}async function nie(t,e,r){const i=sie(t),s=t.json.images||[],l=[];for(const h of i)l.push(oie(t,s[h],h,e,r));return await Promise.all(l)}function sie(t){const e=new Set,r=t.json.textures||[];for(const i of r)i.source!==void 0&&e.add(i.source);return Array.from(e).sort()}async function oie(t,e,r,i,s){let l;if(e.uri&&!e.hasOwnProperty("bufferView")){const a=gk(e.uri,i),{fetch:v}=s;l=await(await v(a)).arrayBuffer(),e.bufferView={data:l}}if(Number.isFinite(e.bufferView)){const a=cee(t.json,t.buffers,e.bufferView);l=f2(a.buffer,a.byteOffset,a.byteLength)}Ga(l,"glTF image has no data");let h=await B_(l,[d5,zQ],{...i,mimeType:e.mimeType,basis:i.basis||{format:nk()}},s);h&&h[0]&&(h={compressed:!0,mipmaps:!1,width:h[0].width,height:h[0].height,data:h[0]}),t.images=t.images||[],t.images[r]=h}const T_={dataType:null,batchType:null,name:"glTF",id:"gltf",module:"gltf",version:_te,extensions:["gltf","glb"],mimeTypes:["model/gltf+json","model/gltf-binary"],text:!0,binary:!0,tests:["glTF"],parse:aie,options:{gltf:{normalize:!0,loadBuffers:!0,loadImages:!0,decompressMeshes:!0},log:console}};async function aie(t,e={},r){e={...T_.options,...e},e.gltf={...T_.options.gltf,...e.gltf};const{byteOffset:i=0}=e;return await tie({},t,i,e,r)}const lie={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},cie={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},vl={TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,REPEAT:10497,LINEAR:9729,NEAREST_MIPMAP_LINEAR:9986},uie={magFilter:vl.TEXTURE_MAG_FILTER,minFilter:vl.TEXTURE_MIN_FILTER,wrapS:vl.TEXTURE_WRAP_S,wrapT:vl.TEXTURE_WRAP_T},hie={[vl.TEXTURE_MAG_FILTER]:vl.LINEAR,[vl.TEXTURE_MIN_FILTER]:vl.NEAREST_MIPMAP_LINEAR,[vl.TEXTURE_WRAP_S]:vl.REPEAT,[vl.TEXTURE_WRAP_T]:vl.REPEAT};function die(){return{id:"default-sampler",parameters:hie}}function pie(t){return cie[t]}function fie(t){return lie[t]}class mie{baseUri="";jsonUnprocessed;json;buffers=[];images=[];postProcess(e,r={}){const{json:i,buffers:s=[],images:l=[]}=e,{baseUri:h=""}=e;return Ga(i),this.baseUri=h,this.buffers=s,this.images=l,this.jsonUnprocessed=i,this.json=this._resolveTree(e.json,r),this.json}_resolveTree(e,r={}){const i={...e};return this.json=i,e.bufferViews&&(i.bufferViews=e.bufferViews.map((s,l)=>this._resolveBufferView(s,l))),e.images&&(i.images=e.images.map((s,l)=>this._resolveImage(s,l))),e.samplers&&(i.samplers=e.samplers.map((s,l)=>this._resolveSampler(s,l))),e.textures&&(i.textures=e.textures.map((s,l)=>this._resolveTexture(s,l))),e.accessors&&(i.accessors=e.accessors.map((s,l)=>this._resolveAccessor(s,l))),e.materials&&(i.materials=e.materials.map((s,l)=>this._resolveMaterial(s,l))),e.meshes&&(i.meshes=e.meshes.map((s,l)=>this._resolveMesh(s,l))),e.nodes&&(i.nodes=e.nodes.map((s,l)=>this._resolveNode(s,l)),i.nodes=i.nodes.map((s,l)=>this._resolveNodeChildren(s))),e.skins&&(i.skins=e.skins.map((s,l)=>this._resolveSkin(s,l))),e.scenes&&(i.scenes=e.scenes.map((s,l)=>this._resolveScene(s,l))),typeof this.json.scene=="number"&&i.scenes&&(i.scene=i.scenes[this.json.scene]),i}getScene(e){return this._get(this.json.scenes,e)}getNode(e){return this._get(this.json.nodes,e)}getSkin(e){return this._get(this.json.skins,e)}getMesh(e){return this._get(this.json.meshes,e)}getMaterial(e){return this._get(this.json.materials,e)}getAccessor(e){return this._get(this.json.accessors,e)}getCamera(e){return this._get(this.json.cameras,e)}getTexture(e){return this._get(this.json.textures,e)}getSampler(e){return this._get(this.json.samplers,e)}getImage(e){return this._get(this.json.images,e)}getBufferView(e){return this._get(this.json.bufferViews,e)}getBuffer(e){return this._get(this.json.buffers,e)}_get(e,r){if(typeof r=="object")return r;const i=e&&e[r];return i||console.warn(`glTF file error: Could not find ${e}[${r}]`),i}_resolveScene(e,r){return{...e,id:e.id||`scene-${r}`,nodes:(e.nodes||[]).map(i=>this.getNode(i))}}_resolveNode(e,r){const i={...e,id:e?.id||`node-${r}`};return e.mesh!==void 0&&(i.mesh=this.getMesh(e.mesh)),e.camera!==void 0&&(i.camera=this.getCamera(e.camera)),e.skin!==void 0&&(i.skin=this.getSkin(e.skin)),e.meshes!==void 0&&e.meshes.length&&(i.mesh=e.meshes.reduce((s,l)=>{const h=this.getMesh(l);return s.id=h.id,s.primitives=s.primitives.concat(h.primitives),s},{primitives:[]})),i}_resolveNodeChildren(e){return e.children&&(e.children=e.children.map(r=>this.getNode(r))),e}_resolveSkin(e,r){const i=typeof e.inverseBindMatrices=="number"?this.getAccessor(e.inverseBindMatrices):void 0;return{...e,id:e.id||`skin-${r}`,inverseBindMatrices:i}}_resolveMesh(e,r){const i={...e,id:e.id||`mesh-${r}`,primitives:[]};return e.primitives&&(i.primitives=e.primitives.map(s=>{const l={...s,attributes:{},indices:void 0,material:void 0},h=s.attributes;for(const a in h)l.attributes[a]=this.getAccessor(h[a]);return s.indices!==void 0&&(l.indices=this.getAccessor(s.indices)),s.material!==void 0&&(l.material=this.getMaterial(s.material)),l})),i}_resolveMaterial(e,r){const i={...e,id:e.id||`material-${r}`};if(i.normalTexture&&(i.normalTexture={...i.normalTexture},i.normalTexture.texture=this.getTexture(i.normalTexture.index)),i.occlusionTexture&&(i.occlusionTexture={...i.occlusionTexture},i.occlusionTexture.texture=this.getTexture(i.occlusionTexture.index)),i.emissiveTexture&&(i.emissiveTexture={...i.emissiveTexture},i.emissiveTexture.texture=this.getTexture(i.emissiveTexture.index)),i.emissiveFactor||(i.emissiveFactor=i.emissiveTexture?[1,1,1]:[0,0,0]),i.pbrMetallicRoughness){i.pbrMetallicRoughness={...i.pbrMetallicRoughness};const s=i.pbrMetallicRoughness;s.baseColorTexture&&(s.baseColorTexture={...s.baseColorTexture},s.baseColorTexture.texture=this.getTexture(s.baseColorTexture.index)),s.metallicRoughnessTexture&&(s.metallicRoughnessTexture={...s.metallicRoughnessTexture},s.metallicRoughnessTexture.texture=this.getTexture(s.metallicRoughnessTexture.index))}return i}_resolveAccessor(e,r){const i=pie(e.componentType),s=fie(e.type),l=i*s,h={...e,id:e.id||`accessor-${r}`,bytesPerComponent:i,components:s,bytesPerElement:l,value:void 0,bufferView:void 0,sparse:void 0};if(e.bufferView!==void 0&&(h.bufferView=this.getBufferView(e.bufferView)),h.bufferView){const a=h.bufferView.buffer,{ArrayType:v,byteLength:T}=nE(h,h.bufferView),C=(h.bufferView.byteOffset||0)+(h.byteOffset||0)+a.byteOffset;let k=a.arrayBuffer.slice(C,C+T);h.bufferView.byteStride&&(k=this._getValueFromInterleavedBuffer(a,C,h.bufferView.byteStride,h.bytesPerElement,h.count)),h.value=new v(k)}return h}_getValueFromInterleavedBuffer(e,r,i,s,l){const h=new Uint8Array(l*s);for(let a=0;a<l;a++){const v=r+a*i;h.set(new Uint8Array(e.arrayBuffer.slice(v,v+s)),a*s)}return h.buffer}_resolveTexture(e,r){return{...e,id:e.id||`texture-${r}`,sampler:typeof e.sampler=="number"?this.getSampler(e.sampler):die(),source:typeof e.source=="number"?this.getImage(e.source):void 0}}_resolveSampler(e,r){const i={id:e.id||`sampler-${r}`,...e,parameters:{}};for(const s in i){const l=this._enumSamplerParameter(s);l!==void 0&&(i.parameters[l]=i[s])}return i}_enumSamplerParameter(e){return uie[e]}_resolveImage(e,r){const i={...e,id:e.id||`image-${r}`,image:null,bufferView:e.bufferView!==void 0?this.getBufferView(e.bufferView):void 0},s=this.images[r];return s&&(i.image=s),i}_resolveBufferView(e,r){const i=e.buffer,s=this.buffers[i].arrayBuffer;let l=this.buffers[i].byteOffset||0;return e.byteOffset&&(l+=e.byteOffset),{id:`bufferView-${r}`,...e,buffer:this.buffers[i],data:new Uint8Array(s,l,e.byteLength)}}_resolveCamera(e,r){const i={...e,id:e.id||`camera-${r}`};return i.perspective,i.orthographic,i}}function cE(t,e){return new mie().postProcess(t,e)}async function gie(t){const e=[];return t.scenes.forEach(r=>{r.traverse(i=>{Object.values(i.model.uniforms).forEach(s=>{s.loaded===!1&&e.push(s)})})}),await _ie(()=>e.some(r=>!r.loaded))}async function _ie(t){for(;t();)await new Promise(e=>requestAnimationFrame(e))}const yie=`#version 300 es
#define SHADER_NAME scenegraph-layer-vertex-shader
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec3 instanceModelMatrixCol0;
in vec3 instanceModelMatrixCol1;
in vec3 instanceModelMatrixCol2;
in vec3 instanceTranslation;
uniform float sizeScale;
uniform float sizeMinPixels;
uniform float sizeMaxPixels;
uniform mat4 sceneModelMatrix;
uniform bool composeModelMatrix;
in vec3 positions;
#ifdef HAS_UV
in vec2 texCoords;
#endif
#ifdef MODULE_PBR
#ifdef HAS_NORMALS
in vec3 normals;
#endif
#endif
out vec4 vColor;
#ifndef MODULE_PBR
#ifdef HAS_UV
out vec2 vTEXCOORD_0;
#endif
#endif
void main(void) {
#if defined(HAS_UV) && !defined(MODULE_PBR)
vTEXCOORD_0 = texCoords;
geometry.uv = texCoords;
#endif
geometry.worldPosition = instancePositions;
geometry.pickingColor = instancePickingColors;
mat3 instanceModelMatrix = mat3(instanceModelMatrixCol0, instanceModelMatrixCol1, instanceModelMatrixCol2);
vec3 normal = vec3(0.0, 0.0, 1.0);
#ifdef MODULE_PBR
#ifdef HAS_NORMALS
normal = instanceModelMatrix * (sceneModelMatrix * vec4(normals, 0.0)).xyz;
#endif
#endif
float originalSize = project_size_to_pixel(sizeScale);
float clampedSize = clamp(originalSize, sizeMinPixels, sizeMaxPixels);
vec3 pos = (instanceModelMatrix * (sceneModelMatrix * vec4(positions, 1.0)).xyz) * sizeScale * (clampedSize / originalSize) + instanceTranslation;
if(composeModelMatrix) {
DECKGL_FILTER_SIZE(pos, geometry);
geometry.normal = project_normal(normal);
geometry.worldPosition += pos;
gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
}
else {
pos = project_size(pos);
DECKGL_FILTER_SIZE(pos, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, geometry.position);
geometry.normal = project_normal(normal);
}
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
#ifdef MODULE_PBR
pbr_vPosition = geometry.position.xyz;
#ifdef HAS_NORMALS
pbr_vNormal = geometry.normal;
#endif
#ifdef HAS_UV
pbr_vUV = texCoords;
#else
pbr_vUV = vec2(0., 0.);
#endif
geometry.uv = pbr_vUV;
#endif
vColor = instanceColors;
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,vie=`#version 300 es
#define SHADER_NAME scenegraph-layer-fragment-shader
uniform float opacity;
in vec4 vColor;
out vec4 fragColor;
#ifndef MODULE_PBR
#if defined(HAS_UV) && defined(HAS_BASECOLORMAP)
in vec2 vTEXCOORD_0;
uniform sampler2D u_BaseColorSampler;
#endif
#endif
void main(void) {
#ifdef MODULE_PBR
fragColor = vColor * pbr_filterColor(vec4(0));
geometry.uv = pbr_vUV;
#else
#if defined(HAS_UV) && defined(HAS_BASECOLORMAP)
fragColor = vColor * texture(u_BaseColorSampler, vTEXCOORD_0);
geometry.uv = vTEXCOORD_0;
#else
fragColor = vColor;
#endif
#endif
fragColor.a *= opacity;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,Ek=[255,255,255,255],bie={scenegraph:{type:"object",value:null,async:!0},getScene:t=>t&&t.scenes?typeof t.scene=="object"?t.scene:t.scenes[t.scene||0]:t,getAnimator:t=>t&&t.animator,_animations:null,sizeScale:{type:"number",value:1,min:0},sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},getPosition:{type:"accessor",value:t=>t.position},getColor:{type:"accessor",value:Ek},_lighting:"flat",_imageBasedLightingEnvironment:void 0,getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},loaders:[T_]};class uE extends Fm{getShaders(){const e=[V2,W2];return this.props._lighting==="pbr"&&e.push(U2),super.getShaders({vs:yie,fs:vie,modules:e})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),accessor:"getPosition",transition:!0},instanceColors:{type:"unorm8",size:this.props.colorFormat.length,accessor:"getColor",defaultValue:Ek,transition:!0},instanceModelMatrix:ek})}updateState(e){super.updateState(e);const{props:r,oldProps:i}=e;r.scenegraph!==i.scenegraph?this._updateScenegraph():r._animations!==i._animations&&this._applyAnimationsProp(this.state.animator,r._animations)}finalizeState(e){super.finalizeState(e),this.state.scenegraph?.destroy()}get isLoaded(){return!!(this.state?.scenegraph&&super.isLoaded)}_updateScenegraph(){const e=this.props,{device:r}=this.context;let i=null;if(e.scenegraph instanceof K0)i={scenes:[e.scenegraph]};else if(e.scenegraph&&typeof e.scenegraph=="object"){const a=e.scenegraph,v=a.json?cE(a):a,T=ree(r,v,this._getModelOptions());i={gltf:v,...T},gie(T).then(()=>{this.setNeedsRedraw()}).catch(C=>{this.raiseError(C,"loading glTF")})}const s={layer:this,device:this.context.device},l=e.getScene(i,s),h=e.getAnimator(i,s);if(l instanceof hm){this.state.scenegraph?.destroy(),this._applyAnimationsProp(h,e._animations);const a=[];l.traverse(v=>{v instanceof Ux&&a.push(v.model)}),this.setState({scenegraph:l,animator:h,models:a}),this.getAttributeManager().invalidateAll()}else l!==null&&li.warn("invalid scenegraph:",l)()}_applyAnimationsProp(e,r){if(!e||!r)return;const i=e.getAnimations();Object.keys(r).sort().forEach(s=>{const l=r[s];if(s==="*")i.forEach(h=>{Object.assign(h,l)});else if(Number.isFinite(Number(s))){const h=Number(s);h>=0&&h<i.length?Object.assign(i[h],l):li.warn(`animation ${s} not found`)()}else{const h=i.find(({name:a})=>a===s);h?Object.assign(h,l):li.warn(`animation ${s} not found`)()}})}_getModelOptions(){const{_imageBasedLightingEnvironment:e}=this.props;let r;return e&&(typeof e=="function"?r=e({gl:this.context.gl,layer:this}):r=e),{imageBasedLightingEnvironment:r,modelOptions:{id:this.props.id,isInstanced:!0,bufferLayout:this.getAttributeManager().getBufferLayouts(),...this.getShaders()},useTangents:!1}}draw({context:e}){if(!this.state.scenegraph)return;this.props._animations&&this.state.animator&&(this.state.animator.animate(e.timeline.getTime()),this.setNeedsRedraw());const{viewport:r,renderPass:i}=this.context,{sizeScale:s,sizeMinPixels:l,sizeMaxPixels:h,opacity:a,coordinateSystem:v}=this.props,T=this.getNumInstances();this.state.scenegraph.traverse((C,{worldMatrix:k})=>{if(C instanceof Ux){const{model:L}=C;L.setInstanceCount(T),L.setUniforms({sizeScale:s,opacity:a,sizeMinPixels:l,sizeMaxPixels:h,composeModelMatrix:tk(r,v),sceneModelMatrix:k,u_Camera:L.uniforms.project_uCameraPosition}),L.draw(i)}})}}uE.defaultProps=bie;uE.layerName="ScenegraphLayer";const xie=`#version 300 es
#define SHADER_NAME simple-mesh-layer-vs
uniform float sizeScale;
uniform bool composeModelMatrix;
uniform bool pickFeatureIds;
in vec3 positions;
in vec3 normals;
in vec3 colors;
in vec2 texCoords;
in vec4 uvRegions;
in vec3 featureIdsPickingColors;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec3 instanceModelMatrixCol0;
in vec3 instanceModelMatrixCol1;
in vec3 instanceModelMatrixCol2;
out vec2 vTexCoord;
out vec3 cameraPosition;
out vec3 normals_commonspace;
out vec4 position_commonspace;
out vec4 vColor;
vec2 applyUVRegion(vec2 uv) {
#ifdef HAS_UV_REGIONS
return fract(uv) * (uvRegions.zw - uvRegions.xy) + uvRegions.xy;
#else
return uv;
#endif
}
void main(void) {
vec2 uv = applyUVRegion(texCoords);
geometry.uv = uv;
if (pickFeatureIds) {
geometry.pickingColor = featureIdsPickingColors;
} else {
geometry.pickingColor = instancePickingColors;
}
mat3 instanceModelMatrix = mat3(instanceModelMatrixCol0, instanceModelMatrixCol1, instanceModelMatrixCol2);
vTexCoord = uv;
cameraPosition = project_uCameraPosition;
vColor = vec4(colors * instanceColors.rgb, instanceColors.a);
vec3 pos = (instanceModelMatrix * positions) * sizeScale;
vec3 projectedPosition = project_position(positions);
position_commonspace = vec4(projectedPosition, 1.0);
gl_Position = project_common_position_to_clipspace(position_commonspace);
geometry.position = position_commonspace;
normals_commonspace = project_normal(instanceModelMatrix * normals);
geometry.normal = normals_commonspace;
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
#ifdef MODULE_PBR
pbr_vPosition = geometry.position.xyz;
#ifdef HAS_NORMALS
pbr_vNormal = geometry.normal;
#endif
#ifdef HAS_UV
pbr_vUV = uv;
#else
pbr_vUV = vec2(0., 0.);
#endif
geometry.uv = pbr_vUV;
#endif
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,wie=`#version 300 es
#define SHADER_NAME simple-mesh-layer-fs
precision highp float;
uniform bool hasTexture;
uniform sampler2D sampler;
uniform bool flatShading;
uniform float opacity;
in vec2 vTexCoord;
in vec3 cameraPosition;
in vec3 normals_commonspace;
in vec4 position_commonspace;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
#ifdef MODULE_PBR
fragColor = vColor * pbr_filterColor(vec4(0));
geometry.uv = pbr_vUV;
fragColor.a *= opacity;
#else
geometry.uv = vTexCoord;
vec3 normal;
if (flatShading) {
normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
} else {
normal = normals_commonspace;
}
vec4 color = hasTexture ? texture(sampler, vTexCoord) : vColor;
vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);
fragColor = vec4(lightColor, color.a * opacity);
#endif
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;function Eie(t){const e=t.positions||t.POSITION,r=e.value.length/e.size;t.COLOR_0||t.colors||(t.colors={size:4,value:new Uint8Array(r*4).fill(255),normalized:!0})}const Aie={pbrMaterial:{type:"object",value:null},featureIds:{type:"array",value:null,optional:!0}};class hE extends iE{getShaders(){const e=super.getShaders();return e.modules.push(U2),{...e,vs:xie,fs:wie}}initializeState(){const{featureIds:e}=this.props;super.initializeState();const r=this.getAttributeManager();e&&r.add({featureIdsPickingColors:{type:"uint8",size:3,noAlloc:!0,update:this.calculateFeatureIdsPickingColors}})}updateState(e){super.updateState(e);const{props:r,oldProps:i}=e;r.pbrMaterial!==i.pbrMaterial&&this.updatePbrMaterialUniforms(r.pbrMaterial)}draw(e){const{featureIds:r}=this.props;this.state.model&&(this.state.model.setUniforms({u_Camera:this.state.model.uniforms.project_uCameraPosition,pickFeatureIds:!!r}),super.draw(e))}getModel(e){const{id:r,pbrMaterial:i}=this.props,s=this.parseMaterial(i,e);this.setState({parsedPBRMaterial:s});const l=this.getShaders();return Eie(e.attributes),new pd(this.context.device,{...this.getShaders(),id:r,geometry:e,bufferLayout:this.getAttributeManager().getBufferLayouts(),defines:{...l.defines,...s?.defines,HAS_UV_REGIONS:e.attributes.uvRegions?1:0},parameters:s?.parameters,isInstanced:!0})}updatePbrMaterialUniforms(e){const{model:r}=this.state;if(r){const{mesh:i}=this.props,s=this.parseMaterial(e,i);this.setState({parsedPBRMaterial:s}),r.setBindings(s.bindings),r.setUniforms(s.uniforms)}}parseMaterial(e,r){const i=!!(e.pbrMetallicRoughness&&e.pbrMetallicRoughness.baseColorTexture);return rk(this.context.device,{unlit:i,...e},{NORMAL:r.attributes.normals,TEXCOORD_0:r.attributes.texCoords},{pbrDebug:!1,lights:!0,useTangents:!1})}calculateFeatureIdsPickingColors(e){const r=this.props.featureIds,i=new Uint8ClampedArray(r.length*e.size),s=[];for(let l=0;l<r.length;l++)this.encodePickingColor(r[l],s),i[l*3]=s[0],i[l*3+1]=s[1],i[l*3+2]=s[2];e.value=i}finalizeState(e){super.finalizeState(e),this.state.parsedPBRMaterial?.generatedTextures.forEach(r=>r.destroy()),this.setState({parsedPBRMaterial:null})}}hE.layerName="MeshLayer";hE.defaultProps=Aie;const Tie=6378137,Sie=6378137,Cie=6356752314245179e-9;function D1(t){return t}new Je;function Mie(t,e=[],r=D1){return"longitude"in t?(e[0]=r(t.longitude),e[1]=r(t.latitude),e[2]=t.height):"x"in t?(e[0]=r(t.x),e[1]=r(t.y),e[2]=t.z):(e[0]=r(t[0]),e[1]=r(t[1]),e[2]=t[2]),e}function Pie(t,e=[]){return Mie(t,e,vs._cartographicRadians?D1:cW)}function Rie(t,e,r=D1){return"longitude"in e?(e.longitude=r(t[0]),e.latitude=r(t[1]),e.height=t[2]):"x"in e?(e.x=r(t[0]),e.y=r(t[1]),e.z=t[2]):(e[0]=r(t[0]),e[1]=r(t[1]),e[2]=t[2]),e}function Iie(t,e){return Rie(t,e,vs._cartographicRadians?D1:uW)}const SC=1e-14,kie=new Je,CC={up:{south:"east",north:"west",west:"south",east:"north"},down:{south:"west",north:"east",west:"north",east:"south"},south:{up:"west",down:"east",west:"down",east:"up"},north:{up:"east",down:"west",west:"up",east:"down"},west:{up:"north",down:"south",north:"down",south:"up"},east:{up:"south",down:"north",north:"up",south:"down"}},Pb={north:[-1,0,0],east:[0,1,0],up:[0,0,1],south:[1,0,0],west:[0,-1,0],down:[0,0,-1]},Ug={east:new Je,north:new Je,up:new Je,west:new Je,south:new Je,down:new Je},Bie=new Je,Lie=new Je,Die=new Je;function MC(t,e,r,i,s,l){const h=CC[e]&&CC[e][r];rc(h&&(!i||i===h));let a,v,T;const C=kie.copy(s);if(cc(C.x,0,SC)&&cc(C.y,0,SC)){const k=Math.sign(C.z);a=Bie.fromArray(Pb[e]),e!=="east"&&e!=="west"&&a.scale(k),v=Lie.fromArray(Pb[r]),r!=="east"&&r!=="west"&&v.scale(k),T=Die.fromArray(Pb[i]),i!=="east"&&i!=="west"&&T.scale(k)}else{const{up:k,east:L,north:O}=Ug;L.set(-C.y,C.x,0).normalize(),t.geodeticSurfaceNormal(C,k),O.copy(k).cross(L);const{down:K,west:$,south:ne}=Ug;K.copy(k).scale(-1),$.copy(L).scale(-1),ne.copy(O).scale(-1),a=Ug[e],v=Ug[r],T=Ug[i]}return l[0]=a.x,l[1]=a.y,l[2]=a.z,l[3]=0,l[4]=v.x,l[5]=v.y,l[6]=v.z,l[7]=0,l[8]=T.x,l[9]=T.y,l[10]=T.z,l[11]=0,l[12]=C.x,l[13]=C.y,l[14]=C.z,l[15]=1,l}const Vf=new Je,Nie=new Je,Oie=new Je;function Fie(t,e,r=[]){const{oneOverRadii:i,oneOverRadiiSquared:s,centerToleranceSquared:l}=e;Vf.from(t);const h=Vf.x,a=Vf.y,v=Vf.z,T=i.x,C=i.y,k=i.z,L=h*h*T*T,O=a*a*C*C,K=v*v*k*k,$=L+O+K,ne=Math.sqrt(1/$);if(!Number.isFinite(ne))return;const oe=Nie;if(oe.copy(t).scale(ne),$<l)return oe.to(r);const fe=s.x,ue=s.y,we=s.z,De=Oie;De.set(oe.x*fe*2,oe.y*ue*2,oe.z*we*2);let Fe=(1-ne)*Vf.len()/(.5*De.len()),Ke=0,ze,it,lt,ht;do{Fe-=Ke,ze=1/(1+Fe*fe),it=1/(1+Fe*ue),lt=1/(1+Fe*we);const vt=ze*ze,Nt=it*it,Lt=lt*lt,qt=vt*ze,Qt=Nt*it,Ot=Lt*lt;ht=L*vt+O*Nt+K*Lt-1;const tt=-2*(L*qt*fe+O*Qt*ue+K*Ot*we);Ke=ht/tt}while(Math.abs(ht)>Pq);return Vf.scale([ze,it,lt]).to(r)}const c0=new Je,PC=new Je,zie=new Je,Ql=new Je,Uie=new Je,u0=new Je;class Bi{constructor(e=0,r=0,i=0){this.centerToleranceSquared=Mq,rc(e>=0),rc(r>=0),rc(i>=0),this.radii=new Je(e,r,i),this.radiiSquared=new Je(e*e,r*r,i*i),this.radiiToTheFourth=new Je(e*e*e*e,r*r*r*r,i*i*i*i),this.oneOverRadii=new Je(e===0?0:1/e,r===0?0:1/r,i===0?0:1/i),this.oneOverRadiiSquared=new Je(e===0?0:1/(e*e),r===0?0:1/(r*r),i===0?0:1/(i*i)),this.minimumRadius=Math.min(e,r,i),this.maximumRadius=Math.max(e,r,i),this.radiiSquared.z!==0&&(this.squaredXOverSquaredZ=this.radiiSquared.x/this.radiiSquared.z),Object.freeze(this)}equals(e){return this===e||!!(e&&this.radii.equals(e.radii))}toString(){return this.radii.toString()}cartographicToCartesian(e,r=[0,0,0]){const i=PC,s=zie,[,,l]=e;this.geodeticSurfaceNormalCartographic(e,i),s.copy(this.radiiSquared).scale(i);const h=Math.sqrt(i.dot(s));return s.scale(1/h),i.scale(l),s.add(i),s.to(r)}cartesianToCartographic(e,r=[0,0,0]){u0.from(e);const i=this.scaleToGeodeticSurface(u0,Ql);if(!i)return;const s=this.geodeticSurfaceNormal(i,PC),l=Uie;l.copy(u0).subtract(i);const h=Math.atan2(s.y,s.x),a=Math.asin(s.z),v=Math.sign(D2(l,u0))*W5(l);return Iie([h,a,v],r)}eastNorthUpToFixedFrame(e,r=new Wr){return MC(this,"east","north","up",e,r)}localFrameToFixedFrame(e,r,i,s,l=new Wr){return MC(this,e,r,i,s,l)}geocentricSurfaceNormal(e,r=[0,0,0]){return c0.from(e).normalize().to(r)}geodeticSurfaceNormalCartographic(e,r=[0,0,0]){const i=Pie(e),s=i[0],l=i[1],h=Math.cos(l);return c0.set(h*Math.cos(s),h*Math.sin(s),Math.sin(l)).normalize(),c0.to(r)}geodeticSurfaceNormal(e,r=[0,0,0]){return c0.from(e).scale(this.oneOverRadiiSquared).normalize().to(r)}scaleToGeodeticSurface(e,r){return Fie(e,this,r)}scaleToGeocentricSurface(e,r=[0,0,0]){Ql.from(e);const i=Ql.x,s=Ql.y,l=Ql.z,h=this.oneOverRadiiSquared,a=1/Math.sqrt(i*i*h.x+s*s*h.y+l*l*h.z);return Ql.multiplyScalar(a).to(r)}transformPositionToScaledSpace(e,r=[0,0,0]){return Ql.from(e).scale(this.oneOverRadii).to(r)}transformPositionFromScaledSpace(e,r=[0,0,0]){return Ql.from(e).scale(this.radii).to(r)}getSurfaceNormalIntersectionWithZAxis(e,r=0,i=[0,0,0]){rc(cc(this.radii.x,this.radii.y,t4)),rc(this.radii.z>0),Ql.from(e);const s=Ql.z*(1-this.squaredXOverSquaredZ);if(!(Math.abs(s)>=this.radii.z-r))return Ql.set(0,0,s).to(i)}}Bi.WGS84=new Bi(Tie,Sie,Cie);class jie{item;previous;next;constructor(e,r,i){this.item=e,this.previous=r,this.next=i}}class Vie{head=null;tail=null;_length=0;get length(){return this._length}add(e){const r=new jie(e,this.tail,null);return this.tail?(this.tail.next=r,this.tail=r):(this.head=r,this.tail=r),++this._length,r}remove(e){e&&(e.previous&&e.next?(e.previous.next=e.next,e.next.previous=e.previous):e.previous?(e.previous.next=null,this.tail=e.previous):e.next?(e.next.previous=null,this.head=e.next):(this.head=null,this.tail=null),e.next=null,e.previous=null,--this._length)}splice(e,r){e!==r&&(this.remove(r),this._insert(e,r))}_insert(e,r){const i=e.next;e.next=r,this.tail===e?this.tail=r:i.previous=r,r.next=i,r.previous=e,++this._length}}class Gie{_list;_sentinel;_trimTiles;constructor(){this._list=new Vie,this._sentinel=this._list.add("sentinel"),this._trimTiles=!1}reset(){this._list.splice(this._list.tail,this._sentinel)}touch(e){const r=e._cacheNode;r&&this._list.splice(this._sentinel,r)}add(e,r,i){r._cacheNode||(r._cacheNode=this._list.add(r),i&&i(e,r))}unloadTile(e,r,i){const s=r._cacheNode;s&&(this._list.remove(s),r._cacheNode=null,i&&i(e,r))}unloadTiles(e,r){const i=this._trimTiles;this._trimTiles=!1;const s=this._list,l=e.maximumMemoryUsage*1024*1024,h=this._sentinel;let a=s.head;for(;a!==h&&(e.gpuMemoryUsageInBytes>l||i);){const v=a.item;a=a.next,this.unloadTile(e,v,r)}}trim(){this._trimTiles=!0}}function Hie(t,e){ki(t),ki(e);const{rtcCenter:r,gltfUpAxis:i}=e,{computedTransform:s,boundingVolume:{center:l}}=t;let h=new Wr(s);switch(r&&h.translate(r),i){case"Z":break;case"Y":const C=new Wr().rotateX(Math.PI/2);h=h.multiplyRight(C);break;case"X":const k=new Wr().rotateY(-Math.PI/2);h=h.multiplyRight(k);break}e.isQuantized&&h.translate(e.quantizedVolumeOffset).scale(e.quantizedVolumeScale);const a=new Je(l);e.cartesianModelMatrix=h,e.cartesianOrigin=a;const v=Bi.WGS84.cartesianToCartographic(a,new Je),T=Bi.WGS84.eastNorthUpToFixedFrame(a).invert();e.cartographicModelMatrix=T.multiplyRight(h),e.cartographicOrigin=v,e.coordinateSystem||(e.modelMatrix=e.cartographicModelMatrix)}const RC=new Je,Rb=new Je,iw=new xl([new tu,new tu,new tu,new tu,new tu,new tu]);function Wie(t,e){const{cameraDirection:r,cameraUp:i,height:s}=t,{metersPerUnit:l}=t.distanceScales,h=M0(t,t.center),a=Bi.WGS84.eastNorthUpToFixedFrame(h),v=t.unprojectPosition(t.cameraPosition),T=Bi.WGS84.cartographicToCartesian(v,new Je),C=new Je(a.transformAsVector(new Je(r).scale(l))).normalize(),k=new Je(a.transformAsVector(new Je(i).scale(l))).normalize();$ie(t);const L=t.constructor,{longitude:O,latitude:K,width:$,bearing:ne,zoom:oe}=t,fe=new L({longitude:O,latitude:K,height:s,width:$,bearing:ne,zoom:oe,pitch:0});return{camera:{position:T,direction:C,up:k},viewport:t,topDownViewport:fe,height:s,cullingVolume:iw,frameNumber:e,sseDenominator:1.15}}function qie(t,e,r){if(r===0||t.length<=r)return[t,[]];const i=[],{longitude:s,latitude:l}=e.viewport;for(const[T,C]of t.entries()){const[k,L]=C.header.mbs,O=Math.abs(s-k),K=Math.abs(l-L),$=Math.sqrt(K*K+O*O);i.push([T,$])}const h=i.sort((T,C)=>T[1]-C[1]),a=[];for(let T=0;T<r;T++)a.push(t[h[T][0]]);const v=[];for(let T=r;T<h.length;T++)v.push(t[h[T][0]]);return[a,v]}function $ie(t){const e=t.getFrustumPlanes(),r=IC(e.near,t.cameraPosition),i=M0(t,r),s=M0(t,t.cameraPosition,Rb);let l=0;iw.planes[l++].fromPointNormal(i,RC.copy(i).subtract(s));for(const h in e){if(h==="near")continue;const a=e[h],v=IC(a,r,Rb),T=M0(t,v,Rb);iw.planes[l++].fromPointNormal(T,RC.copy(i).subtract(T))}}function IC(t,e,r=new Je){const i=t.normal.dot(e);return r.copy(t.normal).scale(t.distance-i).add(e),r}function M0(t,e,r=new Je){const i=t.unprojectPosition(e);return Bi.WGS84.cartographicToCartesian(i,r)}const Zie=6378137,Xie=6378137,nw=6356752314245179e-9,im=new Je;function Kie(t,e){if(t instanceof V_){const{halfAxes:r}=t,i=Jie(r);return Math.log2(nw/(i+e[2]))}else if(t instanceof j_){const{radius:r}=t;return Math.log2(nw/(r+e[2]))}else if(t.width&&t.height){const{width:r,height:i}=t,s=Math.log2(Zie/r),l=Math.log2(Xie/i);return(s+l)/2}return 1}function Ak(t,e,r){Bi.WGS84.cartographicToCartesian([t.xmax,t.ymax,t.zmax],im);const i=Math.sqrt(Math.pow(im[0]-r[0],2)+Math.pow(im[1]-r[1],2)+Math.pow(im[2]-r[2],2));return Math.log2(nw/(i+e[2]))}function Yie(t,e,r){const[i,s,l,h]=t;return Ak({xmax:l,ymax:h,zmax:0},e,r)}function Jie(t){t.getColumn(0,im);const e=t.getColumn(1),r=t.getColumn(2);return im.add(e).add(r).len()}const Ua={UNLOADED:0,LOADING:1,PROCESSING:2,READY:3,EXPIRED:4,FAILED:5};var uc;(function(t){t[t.ADD=1]="ADD",t[t.REPLACE=2]="REPLACE"})(uc||(uc={}));var th;(function(t){t.EMPTY="empty",t.SCENEGRAPH="scenegraph",t.POINTCLOUD="pointcloud",t.MESH="mesh"})(th||(th={}));var oa;(function(t){t.I3S="I3S",t.TILES3D="TILES3D"})(oa||(oa={}));var Tm;(function(t){t.GEOMETRIC_ERROR="geometricError",t.MAX_SCREEN_THRESHOLD="maxScreenThreshold"})(Tm||(Tm={}));const Qie={USE_OPTIMIZATION:1};function Tk(t){return t!=null}const fo=new Je,P0=new Je,ene=new Je,tne=new Je,Cp=new Je,kC=new Je,BC=new Je,LC=new Je;function Ib(t,e,r){if(ki(t,"3D Tile: boundingVolume must be defined"),t.box)return Sk(t.box,e,r);if(t.region)return nne(t.region);if(t.sphere)return ine(t.sphere,e,r);throw new Error("3D Tile: boundingVolume must contain a sphere, region, or box")}function rne(t,e){if(t.box)return sne(e);if(t.region){const[r,i,s,l,h,a]=t.region;return[[tc(r),tc(i),h],[tc(s),tc(l),a]]}if(t.sphere)return one(e);throw new Error("Unkown boundingVolume type")}function Sk(t,e,r){const i=new Je(t[0],t[1],t[2]);e.transform(i,i);let s=[];if(t.length===10){const T=t.slice(3,6),C=new y_;C.fromArray(t,6);const k=new Je([1,0,0]),L=new Je([0,1,0]),O=new Je([0,0,1]);k.transformByQuaternion(C),k.scale(T[0]),L.transformByQuaternion(C),L.scale(T[1]),O.transformByQuaternion(C),O.scale(T[2]),s=[...k.toArray(),...L.toArray(),...O.toArray()]}else s=[...t.slice(3,6),...t.slice(6,9),...t.slice(9,12)];const l=e.transformAsVector(s.slice(0,3)),h=e.transformAsVector(s.slice(3,6)),a=e.transformAsVector(s.slice(6,9)),v=new Sn([l[0],l[1],l[2],h[0],h[1],h[2],a[0],a[1],a[2]]);return Tk(r)?(r.center=i,r.halfAxes=v,r):new V_(i,v)}function ine(t,e,r){const i=new Je(t[0],t[1],t[2]);e.transform(i,i);const s=e.getScale(P0),l=Math.max(Math.max(s[0],s[1]),s[2]),h=t[3]*l;return Tk(r)?(r.center=i,r.radius=h,r):new j_(i,h)}function nne(t){const[e,r,i,s,l,h]=t,a=Bi.WGS84.cartographicToCartesian([tc(e),tc(s),l],ene),v=Bi.WGS84.cartographicToCartesian([tc(i),tc(r),h],tne),T=new Je().addVectors(a,v).multiplyByScalar(.5);return Bi.WGS84.cartesianToCartographic(T,Cp),Bi.WGS84.cartographicToCartesian([tc(i),Cp[1],Cp[2]],kC),Bi.WGS84.cartographicToCartesian([Cp[0],tc(s),Cp[2]],BC),Bi.WGS84.cartographicToCartesian([Cp[0],Cp[1],h],LC),Sk([...T,...kC.subtract(T),...BC.subtract(T),...LC.subtract(T)],new Wr)}function sne(t){const e=Ck(),{halfAxes:r}=t,i=new Je(r.getColumn(0)),s=new Je(r.getColumn(1)),l=new Je(r.getColumn(2));for(let h=0;h<2;h++){for(let a=0;a<2;a++){for(let v=0;v<2;v++)fo.copy(t.center),fo.add(i),fo.add(s),fo.add(l),Mk(e,fo),l.negate();s.negate()}i.negate()}return e}function one(t){const e=Ck(),{center:r,radius:i}=t,s=Bi.WGS84.scaleToGeodeticSurface(r,fo);let l;s?l=Bi.WGS84.geodeticSurfaceNormal(s):l=new Je(0,0,1);let h=new Je(l[2],-l[1],0);h.len()>0?h.normalize():h=new Je(0,1,0);const a=h.clone().cross(l);for(const v of[h,a,l]){P0.copy(v).scale(i);for(let T=0;T<2;T++)fo.copy(r),fo.add(P0),Mk(e,fo),P0.negate()}return e}function Ck(){return[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]]}function Mk(t,e){Bi.WGS84.cartesianToCartographic(e,fo),t[0][0]=Math.min(t[0][0],fo[0]),t[0][1]=Math.min(t[0][1],fo[1]),t[0][2]=Math.min(t[0][2],fo[2]),t[1][0]=Math.max(t[1][0],fo[0]),t[1][1]=Math.max(t[1][1],fo[1]),t[1][2]=Math.max(t[1][2],fo[2])}new Je;new Je;new Wr;new Je;new Je;new Je;function ane(t,e){const r=t*e;return 1-Math.exp(-(r*r))}function lne(t,e){if(t.dynamicScreenSpaceError&&t.dynamicScreenSpaceErrorComputedDensity){const r=t.dynamicScreenSpaceErrorComputedDensity,i=t.dynamicScreenSpaceErrorFactor;return ane(e,r)*i}return 0}function cne(t,e,r){const i=t.tileset,s=t.parent&&t.parent.lodMetricValue||t.lodMetricValue,l=r?s:t.lodMetricValue;if(l===0)return 0;const h=Math.max(t._distanceToCamera,1e-7),{height:a,sseDenominator:v}=e,{viewDistanceScale:T}=i.options;let C=l*a*(T||1)/(h*v);return C-=lne(i,h),C}const kb=new Je,DC=new Je,Yh=new Je,NC=new Je,une=new Je,Bb=new Wr,OC=new Wr;function hne(t,e){if(t.lodMetricValue===0||isNaN(t.lodMetricValue))return"DIG";const r=2*Pk(t,e);return r<2?"OUT":!t.header.children||r<=t.lodMetricValue?"DRAW":t.header.children?"DIG":"OUT"}function Pk(t,e){const{topDownViewport:r}=e,i=t.header.mbs[1],s=t.header.mbs[0],l=t.header.mbs[2],h=t.header.mbs[3],a=[...t.boundingVolume.center],v=r.unprojectPosition(r.cameraPosition);Bi.WGS84.cartographicToCartesian(v,kb),DC.copy(kb).subtract(a).normalize(),Bi.WGS84.eastNorthUpToFixedFrame(a,Bb),OC.copy(Bb).invert(),Yh.copy(kb).transform(OC);const T=Math.sqrt(Yh[0]*Yh[0]+Yh[1]*Yh[1]),C=T*T/Yh[2];NC.copy([Yh[0],Yh[1],C]);const k=NC.transform(Bb).subtract(a).normalize(),L=DC.cross(k).normalize().scale(h).add(a),O=Bi.WGS84.cartesianToCartographic(L),K=r.project([s,i,l]),$=r.project(O);return une.copy(K).subtract($).magnitude()}function dne(t){return{assetGltfUpAxis:t.asset&&t.asset.gltfUpAxis||"Y"}}class FC{_map=new Map;_array;_length;constructor(e=0){this._array=new Array(e),this._length=e}get length(){return this._length}set length(e){this._length=e,e>this._array.length&&(this._array.length=e)}get values(){return this._array}get(e){return ki(e<this._array.length),this._array[e]}set(e,r){ki(e>=0),e>=this.length&&(this.length=e+1),this._map.has(this._array[e])&&this._map.delete(this._array[e]),this._array[e]=r,this._map.set(r,e)}delete(e){const r=this._map.get(e);r>=0&&(this._array.splice(r,1),this._map.delete(e),this.length--)}peek(){return this._array[this._length-1]}push(e){if(!this._map.has(e)){const r=this.length++;this._array[r]=e,this._map.set(e,r)}}pop(){const e=this._array[--this.length];return this._map.delete(e),e}reserve(e){ki(e>=0),e>this._array.length&&(this._array.length=e)}resize(e){ki(e>=0),this.length=e}trim(e){e==null&&(e=this.length),this._array.length=e}reset(){this._array=[],this._map=new Map,this._length=0}find(e){return this._map.has(e)}}const pne={loadSiblings:!1,skipLevelOfDetail:!1,updateTransforms:!0,onTraversalEnd:()=>{},viewportTraversersMap:{},basePath:""};class N1{options;root=null;selectedTiles={};requestedTiles={};emptyTiles={};lastUpdate=new Date().getTime();updateDebounceTime=1e3;_traversalStack=new FC;_emptyTraversalStack=new FC;_frameNumber=null;traversalFinished(e){return!0}constructor(e){this.options={...pne,...e}}traverse(e,r,i){this.root=e,this.options={...this.options,...i},this.reset(),this.updateTile(e,r),this._frameNumber=r.frameNumber,this.executeTraversal(e,r)}reset(){this.requestedTiles={},this.selectedTiles={},this.emptyTiles={},this._traversalStack.reset(),this._emptyTraversalStack.reset()}executeTraversal(e,r){const i=this._traversalStack;for(e._selectionDepth=1,i.push(e);i.length>0;){const l=i.pop();let h=!1;this.canTraverse(l,r)&&(this.updateChildTiles(l,r),h=this.updateAndPushChildren(l,r,i,l.hasRenderContent?l._selectionDepth+1:l._selectionDepth));const a=l.parent,v=!!(!a||a._shouldRefine),T=!h;l.hasRenderContent?l.refine===uc.ADD?(this.loadTile(l,r),this.selectTile(l,r)):l.refine===uc.REPLACE&&(this.loadTile(l,r),T&&this.selectTile(l,r)):(this.emptyTiles[l.id]=l,this.loadTile(l,r),T&&this.selectTile(l,r)),this.touchTile(l,r),l._shouldRefine=h&&v}const s=new Date().getTime();(this.traversalFinished(r)||s-this.lastUpdate>this.updateDebounceTime)&&(this.lastUpdate=s,this.options.onTraversalEnd(r))}updateChildTiles(e,r){const i=e.children;for(const s of i)this.updateTile(s,r)}updateAndPushChildren(e,r,i,s){const{loadSiblings:l,skipLevelOfDetail:h}=this.options,a=e.children;a.sort(this.compareDistanceToCamera.bind(this));const v=e.refine===uc.REPLACE&&e.hasRenderContent&&!h;let T=!1,C=!0;for(const k of a)if(k._selectionDepth=s,k.isVisibleAndInRequestVolume?(i.find(k)&&i.delete(k),i.push(k),T=!0):(v||l)&&(this.loadTile(k,r),this.touchTile(k,r)),v){let L;if(k._inRequestVolume?k.hasRenderContent?L=k.contentAvailable:L=this.executeEmptyTraversal(k,r):L=!1,C=C&&L,!C)return!1}return T||(C=!1),C}updateTile(e,r){this.updateTileVisibility(e,r)}selectTile(e,r){this.shouldSelectTile(e)&&(e._selectedFrame=r.frameNumber,this.selectedTiles[e.id]=e)}loadTile(e,r){this.shouldLoadTile(e)&&(e._requestedFrame=r.frameNumber,e._priority=e._getPriority(),this.requestedTiles[e.id]=e)}touchTile(e,r){e.tileset._cache.touch(e),e._touchedFrame=r.frameNumber}canTraverse(e,r){return e.hasChildren?e.hasTilesetContent?!e.contentExpired:this.shouldRefine(e,r):!1}shouldLoadTile(e){return e.hasUnloadedContent||e.contentExpired}shouldSelectTile(e){return e.contentAvailable&&!this.options.skipLevelOfDetail}shouldRefine(e,r,i=!1){let s=e._screenSpaceError;return i&&(s=e.getScreenSpaceError(r,!0)),s>e.tileset.memoryAdjustedScreenSpaceError}updateTileVisibility(e,r){const i=[];if(this.options.viewportTraversersMap)for(const s in this.options.viewportTraversersMap)this.options.viewportTraversersMap[s]===r.viewport.id&&i.push(s);else i.push(r.viewport.id);e.updateVisibility(r,i)}compareDistanceToCamera(e,r){return e._distanceToCamera-r._distanceToCamera}anyChildrenVisible(e,r){let i=!1;for(const s of e.children)s.updateVisibility(r),i=i||s.isVisibleAndInRequestVolume;return i}executeEmptyTraversal(e,r){let i=!0;const s=this._emptyTraversalStack;for(s.push(e);s.length>0;){const l=s.pop(),h=!l.hasRenderContent&&this.canTraverse(l,r),a=!l.hasRenderContent&&l.children.length===0;if(!h&&!l.contentAvailable&&!a&&(i=!1),this.updateTile(l,r),l.isVisibleAndInRequestVolume||(this.loadTile(l,r),this.touchTile(l,r)),h){const v=l.children;for(const T of v)s.push(T)}}return i}}const zC=new Je;function fne(t){return t!=null}class sw{tileset;header;id;url;parent;refine;type;contentUrl;lodMetricType="geometricError";lodMetricValue=0;boundingVolume=null;content=null;contentState=Ua.UNLOADED;gpuMemoryUsageInBytes=0;children=[];depth=0;viewportIds=[];transform=new Wr;extensions=null;implicitTiling=null;userData={};computedTransform;hasEmptyContent=!1;hasTilesetContent=!1;traverser=new N1({});_cacheNode=null;_frameNumber=null;_expireDate=null;_expiredContent=null;_boundingBox=void 0;_distanceToCamera=0;_screenSpaceError=0;_visibilityPlaneMask;_visible=void 0;_contentBoundingVolume;_viewerRequestVolume;_initialTransform=new Wr;_priority=0;_selectedFrame=0;_requestedFrame=0;_selectionDepth=0;_touchedFrame=0;_centerZDepth=0;_shouldRefine=!1;_stackLength=0;_visitedFrame=0;_inRequestVolume=!1;_lodJudge=null;constructor(e,r,i,s=""){this.header=r,this.tileset=e,this.id=s||r.id,this.url=r.url,this.parent=i,this.refine=this._getRefine(r.refine),this.type=r.type,this.contentUrl=r.contentUrl,this._initializeLodMetric(r),this._initializeTransforms(r),this._initializeBoundingVolumes(r),this._initializeContent(r),this._initializeRenderingState(r),Object.seal(this)}destroy(){this.header=null}isDestroyed(){return this.header===null}get selected(){return this._selectedFrame===this.tileset._frameNumber}get isVisible(){return this._visible}get isVisibleAndInRequestVolume(){return this._visible&&this._inRequestVolume}get hasRenderContent(){return!this.hasEmptyContent&&!this.hasTilesetContent}get hasChildren(){return this.children.length>0||this.header.children&&this.header.children.length>0}get contentReady(){return this.contentState===Ua.READY||this.hasEmptyContent}get contentAvailable(){return!!(this.contentReady&&this.hasRenderContent||this._expiredContent&&!this.contentFailed)}get hasUnloadedContent(){return this.hasRenderContent&&this.contentUnloaded}get contentUnloaded(){return this.contentState===Ua.UNLOADED}get contentExpired(){return this.contentState===Ua.EXPIRED}get contentFailed(){return this.contentState===Ua.FAILED}get distanceToCamera(){return this._distanceToCamera}get screenSpaceError(){return this._screenSpaceError}get boundingBox(){return this._boundingBox||(this._boundingBox=rne(this.header.boundingVolume,this.boundingVolume)),this._boundingBox}getScreenSpaceError(e,r){switch(this.tileset.type){case oa.I3S:return Pk(this,e);case oa.TILES3D:return cne(this,e,r);default:throw new Error("Unsupported tileset type")}}unselect(){this._selectedFrame=0}_getGpuMemoryUsageInBytes(){return this.content.gpuMemoryUsageInBytes||this.content.byteLength||0}_getPriority(){const e=this.tileset._traverser,{skipLevelOfDetail:r}=e.options,i=this.refine===uc.ADD||r;if(i&&!this.isVisible&&this._visible!==void 0||this.tileset._frameNumber-this._touchedFrame>=1||this.contentState===Ua.UNLOADED)return-1;const s=this.parent,l=s&&(!i||this._screenSpaceError===0||s.hasTilesetContent)?s._screenSpaceError:this._screenSpaceError,h=e.root?e.root._screenSpaceError:0;return Math.max(h-l,0)}async loadContent(){if(this.hasEmptyContent)return!1;if(this.content)return!0;this.contentExpired&&(this._expireDate=null),this.contentState=Ua.LOADING;const e=await this.tileset._requestScheduler.scheduleRequest(this.id,this._getPriority.bind(this));if(!e)return this.contentState=Ua.UNLOADED,!1;try{const r=this.tileset.getTileUrl(this.contentUrl),i=this.tileset.loader,s={...this.tileset.loadOptions,[i.id]:{...this.tileset.loadOptions[i.id],isTileset:this.type==="json",...this._getLoaderSpecificOptions(i.id)}};return this.content=await hd(r,i,s),this.tileset.options.contentLoader&&await this.tileset.options.contentLoader(this),this._isTileset()&&this.tileset._initializeTileHeaders(this.content,this),this.contentState=Ua.READY,this._onContentLoaded(),!0}catch(r){throw this.contentState=Ua.FAILED,r}finally{e.done()}}unloadContent(){return this.content&&this.content.destroy&&this.content.destroy(),this.content=null,this.header.content&&this.header.content.destroy&&this.header.content.destroy(),this.header.content=null,this.contentState=Ua.UNLOADED,!0}updateVisibility(e,r){if(this._frameNumber===e.frameNumber)return;const i=this.parent,s=i?i._visibilityPlaneMask:xl.MASK_INDETERMINATE;if(this.tileset._traverser.options.updateTransforms){const l=i?i.computedTransform:this.tileset.modelMatrix;this._updateTransform(l)}this._distanceToCamera=this.distanceToTile(e),this._screenSpaceError=this.getScreenSpaceError(e,!1),this._visibilityPlaneMask=this.visibility(e,s),this._visible=this._visibilityPlaneMask!==xl.MASK_OUTSIDE,this._inRequestVolume=this.insideViewerRequestVolume(e),this._frameNumber=e.frameNumber,this.viewportIds=r}visibility(e,r){const{cullingVolume:i}=e,{boundingVolume:s}=this;return i.computeVisibilityWithPlaneMask(s,r)}contentVisibility(){return!0}distanceToTile(e){const r=this.boundingVolume;return Math.sqrt(Math.max(r.distanceSquaredTo(e.camera.position),0))}cameraSpaceZDepth({camera:e}){const r=this.boundingVolume;return zC.subVectors(r.center,e.position),e.direction.dot(zC)}insideViewerRequestVolume(e){const r=this._viewerRequestVolume;return!r||r.distanceSquaredTo(e.camera.position)<=0}updateExpiration(){if(fne(this._expireDate)&&this.contentReady&&!this.hasEmptyContent){const e=Date.now();Date.lessThan(this._expireDate,e)&&(this.contentState=Ua.EXPIRED,this._expiredContent=this.content)}}get extras(){return this.header.extras}_initializeLodMetric(e){"lodMetricType"in e?this.lodMetricType=e.lodMetricType:(this.lodMetricType=this.parent&&this.parent.lodMetricType||this.tileset.lodMetricType,console.warn("3D Tile: Required prop lodMetricType is undefined. Using parent lodMetricType")),"lodMetricValue"in e?this.lodMetricValue=e.lodMetricValue:(this.lodMetricValue=this.parent&&this.parent.lodMetricValue||this.tileset.lodMetricValue,console.warn("3D Tile: Required prop lodMetricValue is undefined. Using parent lodMetricValue"))}_initializeTransforms(e){this.transform=e.transform?new Wr(e.transform):new Wr;const r=this.parent,i=this.tileset,s=r&&r.computedTransform?r.computedTransform.clone():i.modelMatrix.clone();this.computedTransform=new Wr(s).multiplyRight(this.transform);const l=r&&r._initialTransform?r._initialTransform.clone():new Wr;this._initialTransform=new Wr(l).multiplyRight(this.transform)}_initializeBoundingVolumes(e){this._contentBoundingVolume=null,this._viewerRequestVolume=null,this._updateBoundingVolume(e)}_initializeContent(e){this.content={_tileset:this.tileset,_tile:this},this.hasEmptyContent=!0,this.contentState=Ua.UNLOADED,this.hasTilesetContent=!1,e.contentUrl&&(this.content=null,this.hasEmptyContent=!1)}_initializeRenderingState(e){this.depth=e.level||(this.parent?this.parent.depth+1:0),this._shouldRefine=!1,this._distanceToCamera=0,this._centerZDepth=0,this._screenSpaceError=0,this._visibilityPlaneMask=xl.MASK_INDETERMINATE,this._visible=void 0,this._inRequestVolume=!1,this._stackLength=0,this._selectionDepth=0,this._frameNumber=0,this._touchedFrame=0,this._visitedFrame=0,this._selectedFrame=0,this._requestedFrame=0,this._priority=0}_getRefine(e){return e||this.parent&&this.parent.refine||uc.REPLACE}_isTileset(){return this.contentUrl.indexOf(".json")!==-1}_onContentLoaded(){switch(this.content&&this.content.type){case"vctr":case"geom":this.tileset._traverser.disableSkipLevelOfDetail=!0;break}this._isTileset()?this.hasTilesetContent=!0:this.gpuMemoryUsageInBytes=this._getGpuMemoryUsageInBytes()}_updateBoundingVolume(e){this.boundingVolume=Ib(e.boundingVolume,this.computedTransform,this.boundingVolume);const r=e.content;r&&(r.boundingVolume&&(this._contentBoundingVolume=Ib(r.boundingVolume,this.computedTransform,this._contentBoundingVolume)),e.viewerRequestVolume&&(this._viewerRequestVolume=Ib(e.viewerRequestVolume,this.computedTransform,this._viewerRequestVolume)))}_updateTransform(e=new Wr){const r=e.clone().multiplyRight(this.transform);r.equals(this.computedTransform)||(this.computedTransform=r,this._updateBoundingVolume(this.header))}_getLoaderSpecificOptions(e){switch(e){case"i3s":return{...this.tileset.options.i3s,_tileOptions:{attributeUrls:this.header.attributeUrls,textureUrl:this.header.textureUrl,textureFormat:this.header.textureFormat,textureLoaderOptions:this.header.textureLoaderOptions,materialDefinition:this.header.materialDefinition,isDracoGeometry:this.header.isDracoGeometry,mbs:this.header.mbs},_tilesetOptions:{store:this.tileset.tileset.store,attributeStorageInfo:this.tileset.tileset.attributeStorageInfo,fields:this.tileset.tileset.fields},isTileHeader:!1};case"3d-tiles":case"cesium-ion":default:return dne(this.tileset.tileset)}}}class mne extends N1{compareDistanceToCamera(e,r){return r._distanceToCamera===0&&e._distanceToCamera===0?r._centerZDepth-e._centerZDepth:r._distanceToCamera-e._distanceToCamera}updateTileVisibility(e,r){if(super.updateTileVisibility(e,r),!e.isVisibleAndInRequestVolume)return;const i=e.children.length>0;if(e.hasTilesetContent&&i){const h=e.children[0];this.updateTileVisibility(h,r),e._visible=h._visible;return}if(this.meetsScreenSpaceErrorEarly(e,r)){e._visible=!1;return}const s=e.refine===uc.REPLACE,l=e._optimChildrenWithinParent===Qie.USE_OPTIMIZATION;if(s&&l&&i&&!this.anyChildrenVisible(e,r)){e._visible=!1;return}}meetsScreenSpaceErrorEarly(e,r){const{parent:i}=e;return!i||i.hasTilesetContent||i.refine!==uc.ADD?!1:!this.shouldRefine(e,r,!0)}}class gne{frameNumberMap=new Map;register(e,r){const i=this.frameNumberMap.get(e)||new Map,s=i.get(r)||0;i.set(r,s+1),this.frameNumberMap.set(e,i)}deregister(e,r){const i=this.frameNumberMap.get(e);if(!i)return;const s=i.get(r)||1;i.set(r,s-1)}isZero(e,r){return(this.frameNumberMap.get(e)?.get(r)||0)===0}}const Lb={REQUESTED:"REQUESTED",COMPLETED:"COMPLETED",ERROR:"ERROR"};class _ne{_statusMap;pendingTilesRegister=new gne;constructor(){this._statusMap={}}add(e,r,i,s){if(!this._statusMap[r]){const{frameNumber:l,viewport:{id:h}}=s;this._statusMap[r]={request:e,callback:i,key:r,frameState:s,status:Lb.REQUESTED},this.pendingTilesRegister.register(h,l),e().then(a=>{this._statusMap[r].status=Lb.COMPLETED;const{frameNumber:v,viewport:{id:T}}=this._statusMap[r].frameState;this.pendingTilesRegister.deregister(T,v),this._statusMap[r].callback(a,s)}).catch(a=>{this._statusMap[r].status=Lb.ERROR;const{frameNumber:v,viewport:{id:T}}=this._statusMap[r].frameState;this.pendingTilesRegister.deregister(T,v),i(a)})}}update(e,r){if(this._statusMap[e]){const{frameNumber:i,viewport:{id:s}}=this._statusMap[e].frameState;this.pendingTilesRegister.deregister(s,i);const{frameNumber:l,viewport:{id:h}}=r;this.pendingTilesRegister.register(h,l),this._statusMap[e].frameState=r}}find(e){return this._statusMap[e]}hasPendingTiles(e,r){return!this.pendingTilesRegister.isZero(e,r)}}class yne extends N1{_tileManager;constructor(e){super(e),this._tileManager=new _ne}traversalFinished(e){return!this._tileManager.hasPendingTiles(e.viewport.id,this._frameNumber||0)}shouldRefine(e,r){return e._lodJudge=hne(e,r),e._lodJudge==="DIG"}updateChildTiles(e,r){const i=e.header.children||[],s=e.children,l=e.tileset;for(const h of i){const a=`${h.id}-${r.viewport.id}`,v=s&&s.find(T=>T.id===a);if(v)v&&this.updateTile(v,r);else{let T=()=>this._loadTile(h.id,l);this._tileManager.find(a)?this._tileManager.update(a,r):(l.tileset.nodePages&&(T=()=>l.tileset.nodePagesTile.formTileFromNodePages(h.id)),this._tileManager.add(T,a,C=>this._onTileLoad(C,e,a),r))}}return!1}async _loadTile(e,r){const{loader:i}=r,s=r.getTileUrl(`${r.url}/nodes/${e}`),l={...r.loadOptions,i3s:{...r.loadOptions.i3s,isTileHeader:!0}};return await hd(s,i,l)}_onTileLoad(e,r,i){const s=new sw(r.tileset,e,r,i);r.children.push(s);const l=this._tileManager.find(s.id).frameState;this.updateTile(s,l),this._frameNumber===l.frameNumber&&(this.traversalFinished(l)||new Date().getTime()-this.lastUpdate>this.updateDebounceTime)&&this.executeTraversal(s,l)}}const vne={description:"",ellipsoid:Bi.WGS84,modelMatrix:new Wr,throttleRequests:!0,maxRequests:64,maximumMemoryUsage:32,memoryCacheOverflow:1,maximumTilesSelected:0,debounceTime:0,onTileLoad:()=>{},onTileUnload:()=>{},onTileError:()=>{},onTraversalComplete:t=>t,contentLoader:void 0,viewDistanceScale:1,maximumScreenSpaceError:8,memoryAdjustedScreenSpaceError:!1,loadTiles:!0,updateTransforms:!0,viewportTraversersMap:null,loadOptions:{fetch:{}},attributions:[],basePath:"",i3s:{}},h0="Tiles In Tileset(s)",Db="Tiles In Memory",UC="Tiles In View",jC="Tiles To Render",VC="Tiles Loaded",Nb="Tiles Loading",GC="Tiles Unloaded",HC="Failed Tile Loads",WC="Points/Vertices",Ob="Tile Memory Use",qC="Maximum Screen Space Error";class bne{options;loadOptions;type;tileset;loader;url;basePath;modelMatrix;ellipsoid;lodMetricType;lodMetricValue;refine;root=null;roots={};asset={};description="";properties;extras=null;attributions={};credits={};stats;contentFormats={draco:!1,meshopt:!1,dds:!1,ktx2:!1};cartographicCenter=null;cartesianCenter=null;zoom=1;boundingVolume=null;dynamicScreenSpaceErrorComputedDensity=0;maximumMemoryUsage=32;gpuMemoryUsageInBytes=0;memoryAdjustedScreenSpaceError=0;_cacheBytes=0;_cacheOverflowBytes=0;_frameNumber=0;_queryParams={};_extensionsUsed=[];_tiles={};_pendingCount=0;selectedTiles=[];traverseCounter=0;geometricError=0;lastUpdatedVieports=null;_requestedTiles=[];_emptyTiles=[];frameStateData={};_traverser;_cache=new Gie;_requestScheduler;updatePromise=null;tilesetInitializationPromise;constructor(e,r){this.options={...vne,...r},this.tileset=e,this.loader=e.loader,this.type=e.type,this.url=e.url,this.basePath=e.basePath||m2(this.url),this.modelMatrix=this.options.modelMatrix,this.ellipsoid=this.options.ellipsoid,this.lodMetricType=e.lodMetricType,this.lodMetricValue=e.lodMetricValue,this.refine=e.root.refine,this.loadOptions=this.options.loadOptions||{},this._traverser=this._initializeTraverser(),this._requestScheduler=new DU({throttleRequests:this.options.throttleRequests,maxRequests:this.options.maxRequests}),this.memoryAdjustedScreenSpaceError=this.options.maximumScreenSpaceError,this._cacheBytes=this.options.maximumMemoryUsage*1024*1024,this._cacheOverflowBytes=this.options.memoryCacheOverflow*1024*1024,this.stats=new Nm({id:this.url}),this._initializeStats(),this.tilesetInitializationPromise=this._initializeTileSet(e)}destroy(){this._destroy()}isLoaded(){return this._pendingCount===0&&this._frameNumber!==0&&this._requestedTiles.length===0}get tiles(){return Object.values(this._tiles)}get frameNumber(){return this._frameNumber}get queryParams(){return new URLSearchParams(this._queryParams).toString()}setProps(e){this.options={...this.options,...e}}getTileUrl(e){if(e.startsWith("data:"))return e;let r=e;return this.queryParams.length&&(r=`${e}${e.includes("?")?"&":"?"}${this.queryParams}`),r}hasExtension(e){return this._extensionsUsed.indexOf(e)>-1}update(e=null){this.tilesetInitializationPromise.then(()=>{!e&&this.lastUpdatedVieports?e=this.lastUpdatedVieports:this.lastUpdatedVieports=e,e&&this.doUpdate(e)})}async selectTiles(e=null){return await this.tilesetInitializationPromise,e&&(this.lastUpdatedVieports=e),this.updatePromise||(this.updatePromise=new Promise(r=>{setTimeout(()=>{this.lastUpdatedVieports&&this.doUpdate(this.lastUpdatedVieports),r(this._frameNumber),this.updatePromise=null},this.options.debounceTime)})),this.updatePromise}adjustScreenSpaceError(){this.gpuMemoryUsageInBytes<this._cacheBytes?this.memoryAdjustedScreenSpaceError=Math.max(this.memoryAdjustedScreenSpaceError/1.02,this.options.maximumScreenSpaceError):this.gpuMemoryUsageInBytes>this._cacheBytes+this._cacheOverflowBytes&&(this.memoryAdjustedScreenSpaceError*=1.02)}doUpdate(e){if("loadTiles"in this.options&&!this.options.loadTiles||this.traverseCounter>0)return;const r=e instanceof Array?e:[e];this._cache.reset(),this._frameNumber++,this.traverseCounter=r.length;const i=[];for(const s of r){const l=s.id;this._needTraverse(l)?i.push(l):this.traverseCounter--}for(const s of r){const l=s.id;if(this.roots[l]||(this.roots[l]=this._initializeTileHeaders(this.tileset,null)),!i.includes(l))continue;const h=Wie(s,this._frameNumber);this._traverser.traverse(this.roots[l],h,this.options)}}_needTraverse(e){let r=e;return this.options.viewportTraversersMap&&(r=this.options.viewportTraversersMap[e]),r===e}_onTraversalEnd(e){const r=e.viewport.id;this.frameStateData[r]||(this.frameStateData[r]={selectedTiles:[],_requestedTiles:[],_emptyTiles:[]});const i=this.frameStateData[r],s=Object.values(this._traverser.selectedTiles),[l,h]=qie(s,e,this.options.maximumTilesSelected);i.selectedTiles=l;for(const a of h)a.unselect();i._requestedTiles=Object.values(this._traverser.requestedTiles),i._emptyTiles=Object.values(this._traverser.emptyTiles),this.traverseCounter--,!(this.traverseCounter>0)&&this._updateTiles()}_updateTiles(){this.selectedTiles=[],this._requestedTiles=[],this._emptyTiles=[];for(const e in this.frameStateData){const r=this.frameStateData[e];this.selectedTiles=this.selectedTiles.concat(r.selectedTiles),this._requestedTiles=this._requestedTiles.concat(r._requestedTiles),this._emptyTiles=this._emptyTiles.concat(r._emptyTiles)}this.selectedTiles=this.options.onTraversalComplete(this.selectedTiles);for(const e of this.selectedTiles)this._tiles[e.id]=e;this._loadTiles(),this._unloadTiles(),this._updateStats()}_tilesChanged(e,r){if(e.length!==r.length)return!0;const i=new Set(e.map(h=>h.id)),s=new Set(r.map(h=>h.id));let l=e.filter(h=>!s.has(h.id)).length>0;return l=l||r.filter(h=>!i.has(h.id)).length>0,l}_loadTiles(){for(const e of this._requestedTiles)e.contentUnloaded&&this._loadTile(e)}_unloadTiles(){this._cache.unloadTiles(this,(e,r)=>e._unloadTile(r))}_updateStats(){let e=0,r=0;for(const i of this.selectedTiles)i.contentAvailable&&i.content&&(e++,i.content.pointCount?r+=i.content.pointCount:r+=i.content.vertexCount);this.stats.get(UC).count=this.selectedTiles.length,this.stats.get(jC).count=e,this.stats.get(WC).count=r,this.stats.get(qC).count=this.memoryAdjustedScreenSpaceError}async _initializeTileSet(e){this.type===oa.I3S&&(this.calculateViewPropsI3S(),e.root=await e.root),this.root=this._initializeTileHeaders(e,null),this.type===oa.TILES3D&&(this._initializeTiles3DTileset(e),this.calculateViewPropsTiles3D()),this.type===oa.I3S&&this._initializeI3STileset()}calculateViewPropsI3S(){const e=this.tileset.fullExtent;if(e){const{xmin:i,xmax:s,ymin:l,ymax:h,zmin:a,zmax:v}=e;this.cartographicCenter=new Je(i+(s-i)/2,l+(h-l)/2,a+(v-a)/2),this.cartesianCenter=new Je,Bi.WGS84.cartographicToCartesian(this.cartographicCenter,this.cartesianCenter),this.zoom=Ak(e,this.cartographicCenter,this.cartesianCenter);return}const r=this.tileset.store?.extent;if(r){const[i,s,l,h]=r;this.cartographicCenter=new Je(i+(l-i)/2,s+(h-s)/2,0),this.cartesianCenter=new Je,Bi.WGS84.cartographicToCartesian(this.cartographicCenter,this.cartesianCenter),this.zoom=Yie(r,this.cartographicCenter,this.cartesianCenter);return}console.warn("Extent is not defined in the tileset header"),this.cartographicCenter=new Je,this.zoom=1}calculateViewPropsTiles3D(){const e=this.root,{center:r}=e.boundingVolume;if(!r){console.warn("center was not pre-calculated for the root tile"),this.cartographicCenter=new Je,this.zoom=1;return}r[0]!==0||r[1]!==0||r[2]!==0?(this.cartographicCenter=new Je,Bi.WGS84.cartesianToCartographic(r,this.cartographicCenter)):this.cartographicCenter=new Je(0,0,-Bi.WGS84.radii[0]),this.cartesianCenter=r,this.zoom=Kie(e.boundingVolume,this.cartographicCenter)}_initializeStats(){this.stats.get(h0),this.stats.get(Nb),this.stats.get(Db),this.stats.get(UC),this.stats.get(jC),this.stats.get(VC),this.stats.get(GC),this.stats.get(HC),this.stats.get(WC),this.stats.get(Ob,"memory"),this.stats.get(qC)}_initializeTileHeaders(e,r){const i=new sw(this,e.root,r);if(r&&(r.children.push(i),i.depth=r.depth+1),this.type===oa.TILES3D){const s=[];for(s.push(i);s.length>0;){const l=s.pop();this.stats.get(h0).incrementCount();const h=l.header.children||[];for(const a of h){const v=new sw(this,a,l);if(v.contentUrl?.includes("?session=")){const T=new URL(v.contentUrl).searchParams.get("session");T&&(this._queryParams.session=T)}l.children.push(v),v.depth=l.depth+1,s.push(v)}}}return i}_initializeTraverser(){let e;switch(this.type){case oa.TILES3D:e=mne;break;case oa.I3S:e=yne;break;default:e=N1}return new e({basePath:this.basePath,onTraversalEnd:this._onTraversalEnd.bind(this)})}_destroyTileHeaders(e){this._destroySubtree(e)}async _loadTile(e){let r;try{this._onStartTileLoading(),r=await e.loadContent()}catch(i){this._onTileLoadError(e,i instanceof Error?i:new Error("load failed"))}finally{this._onEndTileLoading(),this._onTileLoad(e,r)}}_onTileLoadError(e,r){this.stats.get(HC).incrementCount();const i=r.message||r.toString(),s=e.url;console.error(`A 3D tile failed to load: ${e.url} ${i}`),this.options.onTileError(e,i,s)}_onTileLoad(e,r){if(r){if(this.type===oa.I3S){const i=this.tileset?.nodePagesTile?.nodesInNodePages||0;this.stats.get(h0).reset(),this.stats.get(h0).addCount(i)}e&&e.content&&Hie(e,e.content),this.updateContentTypes(e),this._addTileToCache(e),this.options.onTileLoad(e)}}updateContentTypes(e){if(this.type===oa.I3S)switch(e.header.isDracoGeometry&&(this.contentFormats.draco=!0),e.header.textureFormat){case"dds":this.contentFormats.dds=!0;break;case"ktx2":this.contentFormats.ktx2=!0;break}else if(this.type===oa.TILES3D){const{extensionsRemoved:r=[]}=e.content?.gltf||{};r.includes("KHR_draco_mesh_compression")&&(this.contentFormats.draco=!0),r.includes("EXT_meshopt_compression")&&(this.contentFormats.meshopt=!0),r.includes("KHR_texture_basisu")&&(this.contentFormats.ktx2=!0)}}_onStartTileLoading(){this._pendingCount++,this.stats.get(Nb).incrementCount()}_onEndTileLoading(){this._pendingCount--,this.stats.get(Nb).decrementCount()}_addTileToCache(e){this._cache.add(this,e,r=>r._updateCacheStats(e))}_updateCacheStats(e){this.stats.get(VC).incrementCount(),this.stats.get(Db).incrementCount(),this.gpuMemoryUsageInBytes+=e.gpuMemoryUsageInBytes||0,this.stats.get(Ob).count=this.gpuMemoryUsageInBytes,this.options.memoryAdjustedScreenSpaceError&&this.adjustScreenSpaceError()}_unloadTile(e){this.gpuMemoryUsageInBytes-=e.gpuMemoryUsageInBytes||0,this.stats.get(Db).decrementCount(),this.stats.get(GC).incrementCount(),this.stats.get(Ob).count=this.gpuMemoryUsageInBytes,this.options.onTileUnload(e),e.unloadContent()}_destroy(){const e=[];for(this.root&&e.push(this.root);e.length>0;){const r=e.pop();for(const i of r.children)e.push(i);this._destroyTile(r)}this.root=null}_destroySubtree(e){const r=e,i=[];for(i.push(r);i.length>0;){e=i.pop();for(const s of e.children)i.push(s);e!==r&&this._destroyTile(e)}r.children=[]}_destroyTile(e){this._cache.unloadTile(this,e),this._unloadTile(e),e.destroy()}_initializeTiles3DTileset(e){if(e.queryString){const r=new URLSearchParams(e.queryString),i=Object.fromEntries(r.entries());this._queryParams={...this._queryParams,...i}}if(this.asset=e.asset,!this.asset)throw new Error("Tileset must have an asset property.");if(this.asset.version!=="0.0"&&this.asset.version!=="1.0"&&this.asset.version!=="1.1")throw new Error("The tileset must be 3D Tiles version either 0.0 or 1.0 or 1.1.");"tilesetVersion"in this.asset&&(this._queryParams.v=this.asset.tilesetVersion),this.credits={attributions:this.options.attributions||[]},this.description=this.options.description||"",this.properties=e.properties,this.geometricError=e.geometricError,this._extensionsUsed=e.extensionsUsed||[],this.extras=e.extras}_initializeI3STileset(){this.loadOptions.i3s&&"token"in this.loadOptions.i3s&&(this._queryParams.token=this.loadOptions.i3s.token)}}const Rk="4.3.1",jg={COMPOSITE:"cmpt",POINT_CLOUD:"pnts",BATCHED_3D_MODEL:"b3dm",INSTANCED_3D_MODEL:"i3dm",GLTF:"glTF"};function Ik(t,e,r){ki(t instanceof ArrayBuffer);const i=new TextDecoder("utf8"),s=new Uint8Array(t,e,r);return i.decode(s)}function xne(t,e=0){const r=new DataView(t);return`${String.fromCharCode(r.getUint8(e+0))}${String.fromCharCode(r.getUint8(e+1))}${String.fromCharCode(r.getUint8(e+2))}${String.fromCharCode(r.getUint8(e+3))}`}const wne={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},Kn={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DOUBLE:5130},ni={...wne,...Kn},Fb={[Kn.DOUBLE]:Float64Array,[Kn.FLOAT]:Float32Array,[Kn.UNSIGNED_SHORT]:Uint16Array,[Kn.UNSIGNED_INT]:Uint32Array,[Kn.UNSIGNED_BYTE]:Uint8Array,[Kn.BYTE]:Int8Array,[Kn.SHORT]:Int16Array,[Kn.INT]:Int32Array},Ene={DOUBLE:Kn.DOUBLE,FLOAT:Kn.FLOAT,UNSIGNED_SHORT:Kn.UNSIGNED_SHORT,UNSIGNED_INT:Kn.UNSIGNED_INT,UNSIGNED_BYTE:Kn.UNSIGNED_BYTE,BYTE:Kn.BYTE,SHORT:Kn.SHORT,INT:Kn.INT},zb="Failed to convert GL type";class ou{static fromTypedArray(e){e=ArrayBuffer.isView(e)?e.constructor:e;for(const r in Fb)if(Fb[r]===e)return r;throw new Error(zb)}static fromName(e){const r=Ene[e];if(!r)throw new Error(zb);return r}static getArrayType(e){switch(e){case Kn.UNSIGNED_SHORT_5_6_5:case Kn.UNSIGNED_SHORT_4_4_4_4:case Kn.UNSIGNED_SHORT_5_5_5_1:return Uint16Array;default:const r=Fb[e];if(!r)throw new Error(zb);return r}}static getByteSize(e){return ou.getArrayType(e).BYTES_PER_ELEMENT}static validate(e){return!!ou.getArrayType(e)}static createTypedArray(e,r,i=0,s){s===void 0&&(s=(r.byteLength-i)/ou.getByteSize(e));const l=ou.getArrayType(e);return new l(r,i,s)}}function Ane(t,e){if(!t)throw new Error(`math.gl assertion failed. ${e}`)}function Tne(t,e=[0,0,0]){const r=t>>11&31,i=t>>5&63,s=t&31;return e[0]=r<<3,e[1]=i<<2,e[2]=s<<3,e}new L2;new Je;new L2;new L2;function $C(t,e=255){return eh(t,0,e)/e*2-1}function ZC(t){return t<0?-1:1}function Sne(t,e,r,i){if(Ane(i),t<0||t>r||e<0||e>r)throw new Error(`x and y must be unsigned normalized integers between 0 and ${r}`);if(i.x=$C(t,r),i.y=$C(e,r),i.z=1-(Math.abs(i.x)+Math.abs(i.y)),i.z<0){const s=i.x;i.x=(1-Math.abs(i.y))*ZC(s),i.y=(1-Math.abs(s))*ZC(i.y)}return i.normalize()}function Cne(t,e,r){return Sne(t,e,255,r)}class dE{json;buffer;featuresLength=0;_cachedTypedArrays={};constructor(e,r){this.json=e,this.buffer=r}getExtension(e){return this.json.extensions&&this.json.extensions[e]}hasProperty(e){return!!this.json[e]}getGlobalProperty(e,r=ni.UNSIGNED_INT,i=1){const s=this.json[e];return s&&Number.isFinite(s.byteOffset)?this._getTypedArrayFromBinary(e,r,i,1,s.byteOffset):s}getPropertyArray(e,r,i){const s=this.json[e];return s&&Number.isFinite(s.byteOffset)?("componentType"in s&&(r=ou.fromName(s.componentType)),this._getTypedArrayFromBinary(e,r,i,this.featuresLength,s.byteOffset)):this._getTypedArrayFromArray(e,r,s)}getProperty(e,r,i,s,l){const h=this.json[e];if(!h)return h;const a=this.getPropertyArray(e,r,i);if(i===1)return a[s];for(let v=0;v<i;++v)l[v]=a[i*s+v];return l}_getTypedArrayFromBinary(e,r,i,s,l){const h=this._cachedTypedArrays;let a=h[e];return a||(a=ou.createTypedArray(r,this.buffer.buffer,this.buffer.byteOffset+l,s*i),h[e]=a),a}_getTypedArrayFromArray(e,r,i){const s=this._cachedTypedArrays;let l=s[e];return l||(l=ou.createTypedArray(r,i),s[e]=l),l}}const Mne={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Pne={SCALAR:(t,e)=>t[e],VEC2:(t,e)=>[t[2*e+0],t[2*e+1]],VEC3:(t,e)=>[t[3*e+0],t[3*e+1],t[3*e+2]],VEC4:(t,e)=>[t[4*e+0],t[4*e+1],t[4*e+2],t[4*e+3]],MAT2:(t,e)=>[t[4*e+0],t[4*e+1],t[4*e+2],t[4*e+3]],MAT3:(t,e)=>[t[9*e+0],t[9*e+1],t[9*e+2],t[9*e+3],t[9*e+4],t[9*e+5],t[9*e+6],t[9*e+7],t[9*e+8]],MAT4:(t,e)=>[t[16*e+0],t[16*e+1],t[16*e+2],t[16*e+3],t[16*e+4],t[16*e+5],t[16*e+6],t[16*e+7],t[16*e+8],t[16*e+9],t[16*e+10],t[16*e+11],t[16*e+12],t[16*e+13],t[16*e+14],t[16*e+15]]},Rne={SCALAR:(t,e,r)=>{e[r]=t},VEC2:(t,e,r)=>{e[2*r+0]=t[0],e[2*r+1]=t[1]},VEC3:(t,e,r)=>{e[3*r+0]=t[0],e[3*r+1]=t[1],e[3*r+2]=t[2]},VEC4:(t,e,r)=>{e[4*r+0]=t[0],e[4*r+1]=t[1],e[4*r+2]=t[2],e[4*r+3]=t[3]},MAT2:(t,e,r)=>{e[4*r+0]=t[0],e[4*r+1]=t[1],e[4*r+2]=t[2],e[4*r+3]=t[3]},MAT3:(t,e,r)=>{e[9*r+0]=t[0],e[9*r+1]=t[1],e[9*r+2]=t[2],e[9*r+3]=t[3],e[9*r+4]=t[4],e[9*r+5]=t[5],e[9*r+6]=t[6],e[9*r+7]=t[7],e[9*r+8]=t[8],e[9*r+9]=t[9]},MAT4:(t,e,r)=>{e[16*r+0]=t[0],e[16*r+1]=t[1],e[16*r+2]=t[2],e[16*r+3]=t[3],e[16*r+4]=t[4],e[16*r+5]=t[5],e[16*r+6]=t[6],e[16*r+7]=t[7],e[16*r+8]=t[8],e[16*r+9]=t[9],e[16*r+10]=t[10],e[16*r+11]=t[11],e[16*r+12]=t[12],e[16*r+13]=t[13],e[16*r+14]=t[14],e[16*r+15]=t[15]}};function Ine(t,e,r,i){const{componentType:s}=t;ki(t.componentType);const l=typeof s=="string"?ou.fromName(s):s,h=Mne[t.type],a=Pne[t.type],v=Rne[t.type];return r+=t.byteOffset,{values:ou.createTypedArray(l,e,r,h*i),type:l,size:h,unpacker:a,packer:v}}const nu=t=>t!==void 0;function kne(t,e,r){if(!e)return null;let i=t.getExtension("3DTILES_batch_table_hierarchy");const s=e.HIERARCHY;return s&&(console.warn("3D Tile Parser: HIERARCHY is deprecated. Use 3DTILES_batch_table_hierarchy."),e.extensions=e.extensions||{},e.extensions["3DTILES_batch_table_hierarchy"]=s,i=s),i?Bne(i,r):null}function Bne(t,e){let r,i,s;const l=t.instancesLength,h=t.classes;let a=t.classIds,v=t.parentCounts,T=t.parentIds,C=l;nu(a.byteOffset)&&(a.componentType=defaultValue(a.componentType,GL.UNSIGNED_SHORT),a.type=AttributeType.SCALAR,s=getBinaryAccessor(a),a=s.createArrayBufferView(e.buffer,e.byteOffset+a.byteOffset,l));let k;if(nu(v))for(nu(v.byteOffset)&&(v.componentType=defaultValue(v.componentType,GL.UNSIGNED_SHORT),v.type=AttributeType.SCALAR,s=getBinaryAccessor(v),v=s.createArrayBufferView(e.buffer,e.byteOffset+v.byteOffset,l)),k=new Uint16Array(l),C=0,r=0;r<l;++r)k[r]=C,C+=v[r];nu(T)&&nu(T.byteOffset)&&(T.componentType=defaultValue(T.componentType,GL.UNSIGNED_SHORT),T.type=AttributeType.SCALAR,s=getBinaryAccessor(T),T=s.createArrayBufferView(e.buffer,e.byteOffset+T.byteOffset,C));const L=h.length;for(r=0;r<L;++r){const ne=h[r].length,oe=h[r].instances,fe=getBinaryProperties(ne,oe,e);h[r].instances=combine(fe,oe)}const O=new Array(L).fill(0),K=new Uint16Array(l);for(r=0;r<l;++r)i=a[r],K[r]=O[i],++O[i];const $={classes:h,classIds:a,classIndexes:K,parentCounts:v,parentIndexes:k,parentIds:T};return Nne($),$}function Vg(t,e,r){if(!t)return;const i=t.parentCounts;return t.parentIds?r(t,e):i>0?Lne(t,e,r):Dne(t,e,r)}function Lne(t,e,r){const i=t.classIds,s=t.parentCounts,l=t.parentIds,h=t.parentIndexes,a=i.length,v=scratchVisited;v.length=Math.max(v.length,a);const T=++marker,C=scratchStack;for(C.length=0,C.push(e);C.length>0;){if(e=C.pop(),v[e]===T)continue;v[e]=T;const k=r(t,e);if(nu(k))return k;const L=s[e],O=h[e];for(let K=0;K<L;++K){const $=l[O+K];$!==e&&C.push($)}}return null}function Dne(t,e,r){let i=!0;for(;i;){const s=r(t,e);if(nu(s))return s;const l=t.parentIds[e];i=l!==e,e=l}throw new Error("traverseHierarchySingleParent")}function Nne(t){const e=t.classIds.length;for(let r=0;r<e;++r)kk(t,r,stack)}function kk(t,e,r){const i=t.parentCounts,s=t.parentIds,l=t.parentIndexes,h=t.classIds.length;if(!nu(s))return;assert(e<h,`Parent index ${e} exceeds the total number of instances: ${h}`),assert(r.indexOf(e)===-1,"Circular dependency detected in the batch table hierarchy."),r.push(e);const a=nu(i)?i[e]:1,v=nu(i)?l[e]:e;for(let T=0;T<a;++T){const C=s[v+T];C!==e&&kk(t,C,r)}r.pop(e)}function sa(t){return t!=null}const d0=(t,e)=>t,One={HIERARCHY:!0,extensions:!0,extras:!0};class Bk{json;binary;featureCount;_extensions;_properties;_binaryProperties;_hierarchy;constructor(e,r,i,s={}){ki(i>=0),this.json=e||{},this.binary=r,this.featureCount=i,this._extensions=this.json?.extensions||{},this._properties={};for(const l in this.json)One[l]||(this._properties[l]=this.json[l]);this._binaryProperties=this._initializeBinaryProperties(),s["3DTILES_batch_table_hierarchy"]&&(this._hierarchy=kne(this,this.json,this.binary))}getExtension(e){return this.json&&this.json.extensions&&this.json.extensions[e]}memorySizeInBytes(){return 0}isClass(e,r){if(this._checkBatchId(e),ki(typeof r=="string",r),this._hierarchy){const i=Vg(this._hierarchy,e,(s,l)=>{const h=s.classIds[l];return s.classes[h].name===r});return sa(i)}return!1}isExactClass(e,r){return ki(typeof r=="string",r),this.getExactClassName(e)===r}getExactClassName(e){if(this._checkBatchId(e),this._hierarchy){const r=this._hierarchy.classIds[e];return this._hierarchy.classes[r].name}}hasProperty(e,r){return this._checkBatchId(e),ki(typeof r=="string",r),sa(this._properties[r])||this._hasPropertyInHierarchy(e,r)}getPropertyNames(e,r){this._checkBatchId(e),r=sa(r)?r:[],r.length=0;const i=Object.keys(this._properties);return r.push(...i),this._hierarchy&&this._getPropertyNamesInHierarchy(e,r),r}getProperty(e,r){if(this._checkBatchId(e),ki(typeof r=="string",r),this._binaryProperties){const s=this._binaryProperties[r];if(sa(s))return this._getBinaryProperty(s,e)}const i=this._properties[r];if(sa(i))return d0(i[e]);if(this._hierarchy){const s=this._getHierarchyProperty(e,r);if(sa(s))return s}}setProperty(e,r,i){const s=this.featureCount;if(this._checkBatchId(e),ki(typeof r=="string",r),this._binaryProperties){const h=this._binaryProperties[r];if(h){this._setBinaryProperty(h,e,i);return}}if(this._hierarchy&&this._setHierarchyProperty(this,e,r,i))return;let l=this._properties[r];sa(l)||(this._properties[r]=new Array(s),l=this._properties[r]),l[e]=d0(i)}_checkBatchId(e){if(!(e>=0&&e<this.featureCount))throw new Error("batchId not in range [0, featureCount - 1].")}_getBinaryProperty(e,r){return e.unpack(e.typedArray,r)}_setBinaryProperty(e,r,i){e.pack(i,e.typedArray,r)}_initializeBinaryProperties(){let e=null;for(const r in this._properties){const i=this._properties[r],s=this._initializeBinaryProperty(r,i);s&&(e=e||{},e[r]=s)}return e}_initializeBinaryProperty(e,r){if("byteOffset"in r){const i=r;ki(this.binary,`Property ${e} requires a batch table binary.`),ki(i.type,`Property ${e} requires a type.`);const s=Ine(i,this.binary.buffer,this.binary.byteOffset|0,this.featureCount);return{typedArray:s.values,componentCount:s.size,unpack:s.unpacker,pack:s.packer}}return null}_hasPropertyInHierarchy(e,r){if(!this._hierarchy)return!1;const i=Vg(this._hierarchy,e,(s,l)=>{const h=s.classIds[l],a=s.classes[h].instances;return sa(a[r])});return sa(i)}_getPropertyNamesInHierarchy(e,r){Vg(this._hierarchy,e,(i,s)=>{const l=i.classIds[s],h=i.classes[l].instances;for(const a in h)h.hasOwnProperty(a)&&r.indexOf(a)===-1&&r.push(a)})}_getHierarchyProperty(e,r){return Vg(this._hierarchy,e,(i,s)=>{const l=i.classIds[s],h=i.classes[l],a=i.classIndexes[s],v=h.instances[r];return sa(v)?sa(v.typedArray)?this._getBinaryProperty(v,a):d0(v[a]):null})}_setHierarchyProperty(e,r,i,s){const l=Vg(this._hierarchy,r,(h,a)=>{const v=h.classIds[a],T=h.classes[v],C=h.classIndexes[a],k=T.instances[i];return sa(k)?(ki(a===r,`Inherited property "${i}" is read-only.`),sa(k.typedArray)?this._setBinaryProperty(k,C,s):k[C]=d0(s),!0):!1});return sa(l)}}const Ub=4;function O1(t,e,r=0){const i=new DataView(e);if(t.magic=i.getUint32(r,!0),r+=Ub,t.version=i.getUint32(r,!0),r+=Ub,t.byteLength=i.getUint32(r,!0),r+=Ub,t.version!==1)throw new Error(`3D Tile Version ${t.version} not supported`);return r}const Gf=4,XC="b3dm tile in legacy format.";function pE(t,e,r){const i=new DataView(e);let s;t.header=t.header||{};let l=i.getUint32(r,!0);r+=Gf;let h=i.getUint32(r,!0);r+=Gf;let a=i.getUint32(r,!0);r+=Gf;let v=i.getUint32(r,!0);return r+=Gf,a>=570425344?(r-=Gf*2,s=l,a=h,v=0,l=0,h=0,console.warn(XC)):v>=570425344&&(r-=Gf,s=a,a=l,v=h,l=0,h=0,console.warn(XC)),t.header.featureTableJsonByteLength=l,t.header.featureTableBinaryByteLength=h,t.header.batchTableJsonByteLength=a,t.header.batchTableBinaryByteLength=v,t.header.batchLength=s,r}function fE(t,e,r,i){return r=Fne(t,e,r),r=zne(t,e,r),r}function Fne(t,e,r,i){const{featureTableJsonByteLength:s,featureTableBinaryByteLength:l,batchLength:h}=t.header||{};if(t.featureTableJson={BATCH_LENGTH:h||0},s&&s>0){const a=Ik(e,r,s);t.featureTableJson=JSON.parse(a)}return r+=s||0,t.featureTableBinary=new Uint8Array(e,r,l),r+=l||0,r}function zne(t,e,r,i){const{batchTableJsonByteLength:s,batchTableBinaryByteLength:l}=t.header||{};if(s&&s>0){const h=Ik(e,r,s);t.batchTableJson=JSON.parse(h),r+=s,l&&l>0&&(t.batchTableBinary=new Uint8Array(e,r,l),t.batchTableBinary=new Uint8Array(t.batchTableBinary),r+=l)}return r}function Lk(t,e,r){if(!e&&(!t||!t.batchIds||!r))return null;const{batchIds:i,isRGB565:s,pointCount:l=0}=t;if(i&&r){const h=new Uint8ClampedArray(l*3);for(let a=0;a<l;a++){const v=i[a],T=r.getProperty(v,"dimensions").map(C=>C*255);h[a*3]=T[0],h[a*3+1]=T[1],h[a*3+2]=T[2]}return{type:ni.UNSIGNED_BYTE,value:h,size:3,normalized:!0}}if(e&&s){const h=new Uint8ClampedArray(l*3);for(let a=0;a<l;a++){const v=Tne(e[a]);h[a*3]=v[0],h[a*3+1]=v[1],h[a*3+2]=v[2]}return{type:ni.UNSIGNED_BYTE,value:h,size:3,normalized:!0}}return e&&e.length===l*3?{type:ni.UNSIGNED_BYTE,value:e,size:3,normalized:!0}:{type:ni.UNSIGNED_BYTE,value:e||new Uint8ClampedArray,size:4,normalized:!0}}const KC=new Je;function Une(t,e){if(!e)return null;if(t.isOctEncoded16P){const r=new Float32Array((t.pointsLength||0)*3);for(let i=0;i<(t.pointsLength||0);i++)Cne(e[i*2],e[i*2+1],KC),KC.toArray(r,i*3);return{type:ni.FLOAT,size:2,value:r}}return{type:ni.FLOAT,size:2,value:e}}function jne(t,e,r){return t.isQuantized?r["3d-tiles"]&&r["3d-tiles"].decodeQuantizedPositions?(t.isQuantized=!1,Vne(t,e)):{type:ni.UNSIGNED_SHORT,value:e,size:3,normalized:!0}:e}function Vne(t,e){const r=new Je,i=new Float32Array(t.pointCount*3);for(let s=0;s<t.pointCount;s++)r.set(e[s*3],e[s*3+1],e[s*3+2]).scale(1/t.quantizedRange).multiply(t.quantizedVolumeScale).add(t.quantizedVolumeOffset).toArray(i,s*3);return i}async function Gne(t,e,r,i,s){r=O1(t,e,r),r=pE(t,e,r),r=fE(t,e,r),Hne(t);const{featureTable:l,batchTable:h}=Wne(t);return await Kne(t,l,h,i,s),qne(t,l,i),$ne(t,l,h),Zne(t,l),r}function Hne(t){t.attributes={positions:null,colors:null,normals:null,batchIds:null},t.isQuantized=!1,t.isTranslucent=!1,t.isRGB565=!1,t.isOctEncoded16P=!1}function Wne(t){const e=new dE(t.featureTableJson,t.featureTableBinary),r=e.getGlobalProperty("POINTS_LENGTH");if(!Number.isFinite(r))throw new Error("POINTS_LENGTH must be defined");e.featuresLength=r,t.featuresLength=r,t.pointsLength=r,t.pointCount=r,t.rtcCenter=e.getGlobalProperty("RTC_CENTER",ni.FLOAT,3);const i=Xne(t,e);return{featureTable:e,batchTable:i}}function qne(t,e,r){if(t.attributes=t.attributes||{positions:null,colors:null,normals:null,batchIds:null},!t.attributes.positions){if(e.hasProperty("POSITION"))t.attributes.positions=e.getPropertyArray("POSITION",ni.FLOAT,3);else if(e.hasProperty("POSITION_QUANTIZED")){const i=e.getPropertyArray("POSITION_QUANTIZED",ni.UNSIGNED_SHORT,3);if(t.isQuantized=!0,t.quantizedRange=65535,t.quantizedVolumeScale=e.getGlobalProperty("QUANTIZED_VOLUME_SCALE",ni.FLOAT,3),!t.quantizedVolumeScale)throw new Error("QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");if(t.quantizedVolumeOffset=e.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",ni.FLOAT,3),!t.quantizedVolumeOffset)throw new Error("QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");t.attributes.positions=jne(t,i,r)}}if(!t.attributes.positions)throw new Error("Either POSITION or POSITION_QUANTIZED must be defined.")}function $ne(t,e,r){if(t.attributes=t.attributes||{positions:null,colors:null,normals:null,batchIds:null},!t.attributes.colors){let i=null;e.hasProperty("RGBA")?(i=e.getPropertyArray("RGBA",ni.UNSIGNED_BYTE,4),t.isTranslucent=!0):e.hasProperty("RGB")?i=e.getPropertyArray("RGB",ni.UNSIGNED_BYTE,3):e.hasProperty("RGB565")&&(i=e.getPropertyArray("RGB565",ni.UNSIGNED_SHORT,1),t.isRGB565=!0),t.attributes.colors=Lk(t,i,r)}e.hasProperty("CONSTANT_RGBA")&&(t.constantRGBA=e.getGlobalProperty("CONSTANT_RGBA",ni.UNSIGNED_BYTE,4))}function Zne(t,e){if(t.attributes=t.attributes||{positions:null,colors:null,normals:null,batchIds:null},!t.attributes.normals){let r=null;e.hasProperty("NORMAL")?r=e.getPropertyArray("NORMAL",ni.FLOAT,3):e.hasProperty("NORMAL_OCT16P")&&(r=e.getPropertyArray("NORMAL_OCT16P",ni.UNSIGNED_BYTE,2),t.isOctEncoded16P=!0),t.attributes.normals=Une(t,r)}}function Xne(t,e){let r=null;if(!t.batchIds&&e.hasProperty("BATCH_ID")&&(t.batchIds=e.getPropertyArray("BATCH_ID",ni.UNSIGNED_SHORT,1),t.batchIds)){const i=e.getGlobalProperty("BATCH_LENGTH");if(!i)throw new Error("Global property: BATCH_LENGTH must be defined when BATCH_ID is defined.");const{batchTableJson:s,batchTableBinary:l}=t;r=new Bk(s,l,i)}return r}async function Kne(t,e,r,i,s){let l,h,a;const v=t.batchTableJson&&t.batchTableJson.extensions&&t.batchTableJson.extensions["3DTILES_draco_point_compression"];v&&(a=v.properties);const T=e.getExtension("3DTILES_draco_point_compression");if(T){h=T.properties;const k=T.byteOffset,L=T.byteLength;if(!h||!Number.isFinite(k)||!L)throw new Error("Draco properties, byteOffset, and byteLength must be defined");l=(t.featureTableBinary||[]).slice(k,k+L),t.hasPositions=Number.isFinite(h.POSITION),t.hasColors=Number.isFinite(h.RGB)||Number.isFinite(h.RGBA),t.hasNormals=Number.isFinite(h.NORMAL),t.hasBatchIds=Number.isFinite(h.BATCH_ID),t.isTranslucent=Number.isFinite(h.RGBA)}if(!l)return!0;const C={buffer:l,properties:{...h,...a},batchTableProperties:a};return await Yne(t,C,i,s)}async function Yne(t,e,r,i){if(!i)return;const s={...r,draco:{...r?.draco,extraAttributes:e.batchTableProperties||{}}};delete s["3d-tiles"];const l=await B_(e.buffer,yk,s,i),h=l.attributes.POSITION&&l.attributes.POSITION.value,a=l.attributes.COLOR_0&&l.attributes.COLOR_0.value,v=l.attributes.NORMAL&&l.attributes.NORMAL.value,T=l.attributes.BATCH_ID&&l.attributes.BATCH_ID.value,C=h&&l.attributes.POSITION.value.quantization,k=v&&l.attributes.NORMAL.value.quantization;if(C){const O=l.POSITION.data.quantization,K=O.range;t.quantizedVolumeScale=new Je(K,K,K),t.quantizedVolumeOffset=new Je(O.minValues),t.quantizedRange=(1<<O.quantizationBits)-1,t.isQuantizedDraco=!0}k&&(t.octEncodedRange=(1<<l.NORMAL.data.quantization.quantizationBits)-1,t.isOctEncodedDraco=!0);const L={};if(e.batchTableProperties)for(const O of Object.keys(e.batchTableProperties))l.attributes[O]&&l.attributes[O].value&&(L[O.toLowerCase()]=l.attributes[O].value);t.attributes={positions:h,colors:Lk(t,a,void 0),normals:v,batchIds:T,...L}}const ow={URI:0,EMBEDDED:1};function Dk(t,e,r,i){t.rotateYtoZ=!0;const s=(t.byteOffset||0)+(t.byteLength||0)-r;if(s===0)throw new Error("glTF byte length must be greater than 0.");return t.gltfUpAxis=i?.["3d-tiles"]&&i["3d-tiles"].assetGltfUpAxis?i["3d-tiles"].assetGltfUpAxis:"Y",t.gltfArrayBuffer=f2(e,r,s),t.gltfByteOffset=0,t.gltfByteLength=s,r%4===0||console.warn(`${t.type}: embedded glb is not aligned to a 4-byte boundary.`),(t.byteOffset||0)+(t.byteLength||0)}async function Nk(t,e,r,i){const s=r?.["3d-tiles"]||{};if(Jne(t,e),s.loadGLTF){if(!i)return;if(t.gltfUrl){const{fetch:l}=i,h=await l(t.gltfUrl,r);t.gltfArrayBuffer=await h.arrayBuffer(),t.gltfByteOffset=0}if(t.gltfArrayBuffer){const l=await B_(t.gltfArrayBuffer,T_,r,i);t.gltf=cE(l),t.gpuMemoryUsageInBytes=lk(t.gltf),delete t.gltfArrayBuffer,delete t.gltfByteOffset,delete t.gltfByteLength}}}function Jne(t,e,r){switch(e){case ow.URI:if(t.gltfArrayBuffer){const i=new Uint8Array(t.gltfArrayBuffer,t.gltfByteOffset),s=new TextDecoder().decode(i);t.gltfUrl=s.replace(/[\s\0]+$/,"")}delete t.gltfArrayBuffer,delete t.gltfByteOffset,delete t.gltfByteLength;break;case ow.EMBEDDED:break;default:throw new Error("b3dm: Illegal glTF format field")}}async function Qne(t,e,r,i,s){r=ese(t,e,r,i),await Nk(t,ow.EMBEDDED,i,s);const l=t?.gltf?.extensions;return l&&l.CESIUM_RTC&&(t.rtcCenter=l.CESIUM_RTC.center),r}function ese(t,e,r,i,s){r=O1(t,e,r),r=pE(t,e,r),r=fE(t,e,r),r=Dk(t,e,r,i);const l=new dE(t.featureTableJson,t.featureTableBinary);return t.rtcCenter=l.getGlobalProperty("RTC_CENTER",ni.FLOAT,3),r}async function tse(t,e,r,i,s){return r=rse(t,e,r,i),await Nk(t,t.gltfFormat||0,i,s),r}function rse(t,e,r,i,s){if(r=O1(t,e,r),t.version!==1)throw new Error(`Instanced 3D Model version ${t.version} is not supported`);r=pE(t,e,r);const l=new DataView(e);if(t.gltfFormat=l.getUint32(r,!0),r+=4,r=fE(t,e,r),r=Dk(t,e,r,i),!t?.header?.featureTableJsonByteLength||t.header.featureTableJsonByteLength===0)throw new Error("i3dm parser: featureTableJsonByteLength is zero.");const h=new dE(t.featureTableJson,t.featureTableBinary),a=h.getGlobalProperty("INSTANCES_LENGTH");if(h.featuresLength=a,!Number.isFinite(a))throw new Error("i3dm parser: INSTANCES_LENGTH must be defined");t.eastNorthUp=h.getGlobalProperty("EAST_NORTH_UP"),t.rtcCenter=h.getGlobalProperty("RTC_CENTER",ni.FLOAT,3);const v=new Bk(t.batchTableJson,t.batchTableBinary,a);return ise(t,h,v,a),r}function ise(t,e,r,i){const s=new Array(i),l=new Je;new Je,new Je,new Je;const h=new Sn,a=new y_,v=new Je,T={},C=new Wr,k=[],L=[],O=[],K=[];for(let $=0;$<i;$++){let ne;if(e.hasProperty("POSITION"))ne=e.getProperty("POSITION",ni.FLOAT,3,$,l);else if(e.hasProperty("POSITION_QUANTIZED")){ne=e.getProperty("POSITION_QUANTIZED",ni.UNSIGNED_SHORT,3,$,l);const Fe=e.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",ni.FLOAT,3);if(!Fe)throw new Error("i3dm parser: QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");const Ke=e.getGlobalProperty("QUANTIZED_VOLUME_SCALE",ni.FLOAT,3);if(!Ke)throw new Error("i3dm parser: QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");const ze=65535;for(let it=0;it<3;it++)ne[it]=ne[it]/ze*Ke[it]+Fe[it]}if(!ne)throw new Error("i3dm: POSITION or POSITION_QUANTIZED must be defined for each instance.");if(l.copy(ne),T.translation=l,t.normalUp=e.getProperty("NORMAL_UP",ni.FLOAT,3,$,k),t.normalRight=e.getProperty("NORMAL_RIGHT",ni.FLOAT,3,$,L),t.normalUp){if(!t.normalRight)throw new Error("i3dm: Custom orientation requires both NORMAL_UP and NORMAL_RIGHT.");t.hasCustomOrientation=!0}else{if(t.octNormalUp=e.getProperty("NORMAL_UP_OCT32P",ni.UNSIGNED_SHORT,2,$,k),t.octNormalRight=e.getProperty("NORMAL_RIGHT_OCT32P",ni.UNSIGNED_SHORT,2,$,L),t.octNormalUp)throw t.octNormalRight?new Error("i3dm: oct-encoded orientation not implemented"):new Error("i3dm: oct-encoded orientation requires NORMAL_UP_OCT32P and NORMAL_RIGHT_OCT32P");t.eastNorthUp?(Bi.WGS84.eastNorthUpToFixedFrame(l,C),C.getRotationMatrix3(h)):h.identity()}a.fromMatrix3(h),T.rotation=a,v.set(1,1,1);const oe=e.getProperty("SCALE",ni.FLOAT,1,$,O);Number.isFinite(oe)&&v.multiplyByScalar(oe);const fe=e.getProperty("SCALE_NON_UNIFORM",ni.FLOAT,3,$,k);fe&&v.scale(fe),T.scale=v;let ue=e.getProperty("BATCH_ID",ni.UNSIGNED_SHORT,1,$,K);ue===void 0&&(ue=$);const we=new Wr().fromQuaternion(T.rotation);C.identity(),C.translate(T.translation),C.multiplyRight(we),C.scale(T.scale);const De=C.clone();s[$]={modelMatrix:De,batchId:ue}}t.instances=s}async function nse(t,e,r,i,s,l){r=O1(t,e,r);const h=new DataView(e);for(t.tilesLength=h.getUint32(r,!0),r+=4,t.tiles=[];t.tiles.length<t.tilesLength&&(t.byteLength||0)-r>12;){const a={shape:"tile3d"};t.tiles.push(a),r=await l(e,r,i,s,a)}return r}async function sse(t,e,r,i){if(t.rotateYtoZ=!0,t.gltfUpAxis=r?.["3d-tiles"]?.assetGltfUpAxis?r["3d-tiles"].assetGltfUpAxis:"Y",r?.["3d-tiles"]?.loadGLTF){if(!i)return e.byteLength;const s=await B_(e,T_,r,i);t.gltf=cE(s),t.gpuMemoryUsageInBytes=lk(t.gltf)}else t.gltfArrayBuffer=e;return e.byteLength}async function Ok(t,e=0,r,i,s={shape:"tile3d"}){switch(s.byteOffset=e,s.type=xne(t,e),s.type){case jg.COMPOSITE:return await nse(s,t,e,r,i,Ok);case jg.BATCHED_3D_MODEL:return await Qne(s,t,e,r,i);case jg.GLTF:return await sse(s,t,r,i);case jg.INSTANCED_3D_MODEL:return await tse(s,t,e,r,i);case jg.POINT_CLOUD:return await Gne(s,t,e,r,i);default:throw new Error(`3DTileLoader: unknown type ${s.type}`)}}const ose=1952609651,ase=1;async function lse(t,e,r){if(new Uint32Array(t.slice(0,4))[0]!==ose)throw new Error("Wrong subtree file magic number");if(new Uint32Array(t.slice(4,8))[0]!==ase)throw new Error("Wrong subtree file verson, must be 1");const i=YC(t.slice(8,16)),s=new Uint8Array(t,24,i),l=new TextDecoder("utf8").decode(s),h=JSON.parse(l),a=YC(t.slice(16,24));let v=new ArrayBuffer(0);if(a&&(v=t.slice(24+i)),await p0(h,h.tileAvailability,v,r),Array.isArray(h.contentAvailability))for(const T of h.contentAvailability)await p0(h,T,v,r);else await p0(h,h.contentAvailability,v,r);return await p0(h,h.childSubtreeAvailability,v,r),h}async function p0(t,e,r,i){const s=Number.isFinite(e.bitstream)?e.bitstream:e.bufferView;if(typeof s!="number")return;const l=t.bufferViews[s],h=t.buffers[l.buffer];if(!i?.baseUrl)throw new Error("Url is not provided");if(!i.fetch)throw new Error("fetch is not provided");if(h.uri){const v=`${i?.baseUrl||""}/${h.uri}`,T=await(await i.fetch(v)).arrayBuffer();e.explicitBitstream=new Uint8Array(T,l.byteOffset,l.byteLength);return}const a=t.buffers.slice(0,l.buffer).reduce((v,T)=>v+T.byteLength,0);e.explicitBitstream=new Uint8Array(r.slice(a,a+h.byteLength),l.byteOffset,l.byteLength)}function YC(t){const e=new DataView(t),r=e.getUint32(0,!0),i=e.getUint32(4,!0);return r+2**32*i}const Fk={dataType:null,batchType:null,id:"3d-tiles-subtree",name:"3D Tiles Subtree",module:"3d-tiles",version:Rk,extensions:["subtree"],mimeTypes:["application/octet-stream"],tests:["subtree"],parse:lse,options:{}};/**
 * @license
 * Copyright 2009 The Closure Library Authors
 * Copyright 2020 Daniel Wirtz / The long.js Authors.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * SPDX-License-Identifier: Apache-2.0
 */var wl=null;try{wl=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function bi(t,e,r){this.low=t|0,this.high=e|0,this.unsigned=!!r}bi.prototype.__isLong__;Object.defineProperty(bi.prototype,"__isLong__",{value:!0});function go(t){return(t&&t.__isLong__)===!0}function JC(t){var e=Math.clz32(t&-t);return t?31-e:e}bi.isLong=go;var QC={},eM={};function Jp(t,e){var r,i,s;return e?(t>>>=0,(s=0<=t&&t<256)&&(i=eM[t],i)?i:(r=ci(t,0,!0),s&&(eM[t]=r),r)):(t|=0,(s=-128<=t&&t<128)&&(i=QC[t],i)?i:(r=ci(t,t<0?-1:0,!1),s&&(QC[t]=r),r))}bi.fromInt=Jp;function El(t,e){if(isNaN(t))return e?rh:ac;if(e){if(t<0)return rh;if(t>=zk)return Vk}else{if(t<=-rM)return ua;if(t+1>=rM)return jk}return t<0?El(-t,e).neg():ci(t%Sm|0,t/Sm|0,e)}bi.fromNumber=El;function ci(t,e,r){return new bi(t,e,r)}bi.fromBits=ci;var i1=Math.pow;function mE(t,e,r){if(t.length===0)throw Error("empty string");if(typeof e=="number"?(r=e,e=!1):e=!!e,t==="NaN"||t==="Infinity"||t==="+Infinity"||t==="-Infinity")return e?rh:ac;if(r=r||10,r<2||36<r)throw RangeError("radix");var i;if((i=t.indexOf("-"))>0)throw Error("interior hyphen");if(i===0)return mE(t.substring(1),e,r).neg();for(var s=El(i1(r,8)),l=ac,h=0;h<t.length;h+=8){var a=Math.min(8,t.length-h),v=parseInt(t.substring(h,h+a),r);if(a<8){var T=El(i1(r,a));l=l.mul(T).add(El(v))}else l=l.mul(s),l=l.add(El(v))}return l.unsigned=e,l}bi.fromString=mE;function pc(t,e){return typeof t=="number"?El(t,e):typeof t=="string"?mE(t,e):ci(t.low,t.high,typeof e=="boolean"?e:t.unsigned)}bi.fromValue=pc;var tM=65536,cse=1<<24,Sm=tM*tM,zk=Sm*Sm,rM=zk/2,iM=Jp(cse),ac=Jp(0);bi.ZERO=ac;var rh=Jp(0,!0);bi.UZERO=rh;var nm=Jp(1);bi.ONE=nm;var Uk=Jp(1,!0);bi.UONE=Uk;var aw=Jp(-1);bi.NEG_ONE=aw;var jk=ci(-1,2147483647,!1);bi.MAX_VALUE=jk;var Vk=ci(-1,-1,!0);bi.MAX_UNSIGNED_VALUE=Vk;var ua=ci(0,-2147483648,!1);bi.MIN_VALUE=ua;var kt=bi.prototype;kt.toInt=function(){return this.unsigned?this.low>>>0:this.low};kt.toNumber=function(){return this.unsigned?(this.high>>>0)*Sm+(this.low>>>0):this.high*Sm+(this.low>>>0)};kt.toString=function(t){if(t=t||10,t<2||36<t)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(ua)){var e=El(t),r=this.div(e),i=r.mul(e).sub(this);return r.toString(t)+i.toInt().toString(t)}else return"-"+this.neg().toString(t);for(var s=El(i1(t,6),this.unsigned),l=this,h="";;){var a=l.div(s),v=l.sub(a.mul(s)).toInt()>>>0,T=v.toString(t);if(l=a,l.isZero())return T+h;for(;T.length<6;)T="0"+T;h=""+T+h}};kt.getHighBits=function(){return this.high};kt.getHighBitsUnsigned=function(){return this.high>>>0};kt.getLowBits=function(){return this.low};kt.getLowBitsUnsigned=function(){return this.low>>>0};kt.getNumBitsAbs=function(){if(this.isNegative())return this.eq(ua)?64:this.neg().getNumBitsAbs();for(var t=this.high!=0?this.high:this.low,e=31;e>0&&(t&1<<e)==0;e--);return this.high!=0?e+33:e+1};kt.isZero=function(){return this.high===0&&this.low===0};kt.eqz=kt.isZero;kt.isNegative=function(){return!this.unsigned&&this.high<0};kt.isPositive=function(){return this.unsigned||this.high>=0};kt.isOdd=function(){return(this.low&1)===1};kt.isEven=function(){return(this.low&1)===0};kt.equals=function(t){return go(t)||(t=pc(t)),this.unsigned!==t.unsigned&&this.high>>>31===1&&t.high>>>31===1?!1:this.high===t.high&&this.low===t.low};kt.eq=kt.equals;kt.notEquals=function(t){return!this.eq(t)};kt.neq=kt.notEquals;kt.ne=kt.notEquals;kt.lessThan=function(t){return this.comp(t)<0};kt.lt=kt.lessThan;kt.lessThanOrEqual=function(t){return this.comp(t)<=0};kt.lte=kt.lessThanOrEqual;kt.le=kt.lessThanOrEqual;kt.greaterThan=function(t){return this.comp(t)>0};kt.gt=kt.greaterThan;kt.greaterThanOrEqual=function(t){return this.comp(t)>=0};kt.gte=kt.greaterThanOrEqual;kt.ge=kt.greaterThanOrEqual;kt.compare=function(t){if(go(t)||(t=pc(t)),this.eq(t))return 0;var e=this.isNegative(),r=t.isNegative();return e&&!r?-1:!e&&r?1:this.unsigned?t.high>>>0>this.high>>>0||t.high===this.high&&t.low>>>0>this.low>>>0?-1:1:this.sub(t).isNegative()?-1:1};kt.comp=kt.compare;kt.negate=function(){return!this.unsigned&&this.eq(ua)?ua:this.not().add(nm)};kt.neg=kt.negate;kt.add=function(t){go(t)||(t=pc(t));var e=this.high>>>16,r=this.high&65535,i=this.low>>>16,s=this.low&65535,l=t.high>>>16,h=t.high&65535,a=t.low>>>16,v=t.low&65535,T=0,C=0,k=0,L=0;return L+=s+v,k+=L>>>16,L&=65535,k+=i+a,C+=k>>>16,k&=65535,C+=r+h,T+=C>>>16,C&=65535,T+=e+l,T&=65535,ci(k<<16|L,T<<16|C,this.unsigned)};kt.subtract=function(t){return go(t)||(t=pc(t)),this.add(t.neg())};kt.sub=kt.subtract;kt.multiply=function(t){if(this.isZero())return this;if(go(t)||(t=pc(t)),wl){var e=wl.mul(this.low,this.high,t.low,t.high);return ci(e,wl.get_high(),this.unsigned)}if(t.isZero())return this.unsigned?rh:ac;if(this.eq(ua))return t.isOdd()?ua:ac;if(t.eq(ua))return this.isOdd()?ua:ac;if(this.isNegative())return t.isNegative()?this.neg().mul(t.neg()):this.neg().mul(t).neg();if(t.isNegative())return this.mul(t.neg()).neg();if(this.lt(iM)&&t.lt(iM))return El(this.toNumber()*t.toNumber(),this.unsigned);var r=this.high>>>16,i=this.high&65535,s=this.low>>>16,l=this.low&65535,h=t.high>>>16,a=t.high&65535,v=t.low>>>16,T=t.low&65535,C=0,k=0,L=0,O=0;return O+=l*T,L+=O>>>16,O&=65535,L+=s*T,k+=L>>>16,L&=65535,L+=l*v,k+=L>>>16,L&=65535,k+=i*T,C+=k>>>16,k&=65535,k+=s*v,C+=k>>>16,k&=65535,k+=l*a,C+=k>>>16,k&=65535,C+=r*T+i*v+s*a+l*h,C&=65535,ci(L<<16|O,C<<16|k,this.unsigned)};kt.mul=kt.multiply;kt.divide=function(t){if(go(t)||(t=pc(t)),t.isZero())throw Error("division by zero");if(wl){if(!this.unsigned&&this.high===-2147483648&&t.low===-1&&t.high===-1)return this;var e=(this.unsigned?wl.div_u:wl.div_s)(this.low,this.high,t.low,t.high);return ci(e,wl.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?rh:ac;var r,i,s;if(this.unsigned){if(t.unsigned||(t=t.toUnsigned()),t.gt(this))return rh;if(t.gt(this.shru(1)))return Uk;s=rh}else{if(this.eq(ua)){if(t.eq(nm)||t.eq(aw))return ua;if(t.eq(ua))return nm;var l=this.shr(1);return r=l.div(t).shl(1),r.eq(ac)?t.isNegative()?nm:aw:(i=this.sub(t.mul(r)),s=r.add(i.div(t)),s)}else if(t.eq(ua))return this.unsigned?rh:ac;if(this.isNegative())return t.isNegative()?this.neg().div(t.neg()):this.neg().div(t).neg();if(t.isNegative())return this.div(t.neg()).neg();s=ac}for(i=this;i.gte(t);){r=Math.max(1,Math.floor(i.toNumber()/t.toNumber()));for(var h=Math.ceil(Math.log(r)/Math.LN2),a=h<=48?1:i1(2,h-48),v=El(r),T=v.mul(t);T.isNegative()||T.gt(i);)r-=a,v=El(r,this.unsigned),T=v.mul(t);v.isZero()&&(v=nm),s=s.add(v),i=i.sub(T)}return s};kt.div=kt.divide;kt.modulo=function(t){if(go(t)||(t=pc(t)),wl){var e=(this.unsigned?wl.rem_u:wl.rem_s)(this.low,this.high,t.low,t.high);return ci(e,wl.get_high(),this.unsigned)}return this.sub(this.div(t).mul(t))};kt.mod=kt.modulo;kt.rem=kt.modulo;kt.not=function(){return ci(~this.low,~this.high,this.unsigned)};kt.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32};kt.clz=kt.countLeadingZeros;kt.countTrailingZeros=function(){return this.low?JC(this.low):JC(this.high)+32};kt.ctz=kt.countTrailingZeros;kt.and=function(t){return go(t)||(t=pc(t)),ci(this.low&t.low,this.high&t.high,this.unsigned)};kt.or=function(t){return go(t)||(t=pc(t)),ci(this.low|t.low,this.high|t.high,this.unsigned)};kt.xor=function(t){return go(t)||(t=pc(t)),ci(this.low^t.low,this.high^t.high,this.unsigned)};kt.shiftLeft=function(t){return go(t)&&(t=t.toInt()),(t&=63)===0?this:t<32?ci(this.low<<t,this.high<<t|this.low>>>32-t,this.unsigned):ci(0,this.low<<t-32,this.unsigned)};kt.shl=kt.shiftLeft;kt.shiftRight=function(t){return go(t)&&(t=t.toInt()),(t&=63)===0?this:t<32?ci(this.low>>>t|this.high<<32-t,this.high>>t,this.unsigned):ci(this.high>>t-32,this.high>=0?0:-1,this.unsigned)};kt.shr=kt.shiftRight;kt.shiftRightUnsigned=function(t){return go(t)&&(t=t.toInt()),(t&=63)===0?this:t<32?ci(this.low>>>t|this.high<<32-t,this.high>>>t,this.unsigned):t===32?ci(this.high,0,this.unsigned):ci(this.high>>>t-32,0,this.unsigned)};kt.shru=kt.shiftRightUnsigned;kt.shr_u=kt.shiftRightUnsigned;kt.rotateLeft=function(t){var e;return go(t)&&(t=t.toInt()),(t&=63)===0?this:t===32?ci(this.high,this.low,this.unsigned):t<32?(e=32-t,ci(this.low<<t|this.high>>>e,this.high<<t|this.low>>>e,this.unsigned)):(t-=32,e=32-t,ci(this.high<<t|this.low>>>e,this.low<<t|this.high>>>e,this.unsigned))};kt.rotl=kt.rotateLeft;kt.rotateRight=function(t){var e;return go(t)&&(t=t.toInt()),(t&=63)===0?this:t===32?ci(this.high,this.low,this.unsigned):t<32?(e=32-t,ci(this.high<<e|this.low>>>t,this.low<<e|this.high>>>t,this.unsigned)):(t-=32,e=32-t,ci(this.low<<e|this.high>>>t,this.high<<e|this.low>>>t,this.unsigned))};kt.rotr=kt.rotateRight;kt.toSigned=function(){return this.unsigned?ci(this.low,this.high,!1):this};kt.toUnsigned=function(){return this.unsigned?this:ci(this.low,this.high,!0)};kt.toBytes=function(t){return t?this.toBytesLE():this.toBytesBE()};kt.toBytesLE=function(){var t=this.high,e=this.low;return[e&255,e>>>8&255,e>>>16&255,e>>>24,t&255,t>>>8&255,t>>>16&255,t>>>24]};kt.toBytesBE=function(){var t=this.high,e=this.low;return[t>>>24,t>>>16&255,t>>>8&255,t&255,e>>>24,e>>>16&255,e>>>8&255,e&255]};bi.fromBytes=function(t,e,r){return r?bi.fromBytesLE(t,e):bi.fromBytesBE(t,e)};bi.fromBytesLE=function(t,e){return new bi(t[0]|t[1]<<8|t[2]<<16|t[3]<<24,t[4]|t[5]<<8|t[6]<<16|t[7]<<24,e)};bi.fromBytesBE=function(t,e){return new bi(t[4]<<24|t[5]<<16|t[6]<<8|t[7],t[0]<<24|t[1]<<16|t[2]<<8|t[3],e)};const use=16;function Gk(t){t==="X"&&(t="");const e=t.padEnd(use,"0");return bi.fromString(e,!0,16)}function hse(t){if(t.isZero())return"X";let e=t.countTrailingZeros();const r=e%4;e=(e-r)/4;const i=e;e*=4;const s=t.shiftRightUnsigned(e).toString(16).replace(/0+$/,"");return Array(17-i-s.length).join("0")+s}function dse(t,e){const r=pse(t).shiftRightUnsigned(2);return t.add(bi.fromNumber(2*e+1-4).multiply(r))}function pse(t){return t.and(t.not().add(1))}const fse=3,mse=30,gse=2*mse+1,nM=180/Math.PI;function _se(t){if(t.length===0)throw new Error(`Invalid Hilbert quad key ${t}`);const e=t.split("/"),r=parseInt(e[0],10),i=e[1],s=i.length;let l=0;const h=[0,0];for(let a=s-1;a>=0;a--){l=s-a;const v=i[a];let T=0,C=0;v==="1"?C=1:v==="2"?(T=1,C=1):v==="3"&&(T=1);const k=Math.pow(2,l-1);vse(k,h,T,C),h[0]+=k*T,h[1]+=k*C}if(r%2===1){const a=h[0];h[0]=h[1],h[1]=a}return{face:r,ij:h,level:l}}function yse(t){if(t.isZero())return"";let e=t.toString(2);for(;e.length<fse+gse;)e="0"+e;const r=e.lastIndexOf("1"),i=e.substring(0,3),s=e.substring(3,r),l=s.length/2,h=bi.fromString(i,!0,2).toString(10);let a="";if(l!==0)for(a=bi.fromString(s,!0,2).toString(4);a.length<l;)a="0"+a;return`${h}/${a}`}function Hk(t,e,r){const i=1<<e;return[(t[0]+r[0])/i,(t[1]+r[1])/i]}function sM(t){return t>=.5?1/3*(4*t*t-1):1/3*(1-4*(1-t)*(1-t))}function Wk(t){return[sM(t[0]),sM(t[1])]}function qk(t,[e,r]){switch(t){case 0:return[1,e,r];case 1:return[-e,1,r];case 2:return[-e,-r,1];case 3:return[-1,-r,-e];case 4:return[r,-1,-e];case 5:return[r,e,-1];default:throw new Error("Invalid face")}}function $k([t,e,r]){const i=Math.atan2(r,Math.sqrt(t*t+e*e));return[Math.atan2(e,t)*nM,i*nM]}function vse(t,e,r,i){if(i===0){r===1&&(e[0]=t-1-e[0],e[1]=t-1-e[1]);const s=e[0];e[0]=e[1],e[1]=s}}function bse(t){const e=Hk(t.ij,t.level,[.5,.5]),r=Wk(e),i=qk(t.face,r);return $k(i)}const xse=100;function oM(t){const{face:e,ij:r,level:i}=t,s=[[0,0],[0,1],[1,1],[1,0],[0,0]],l=Math.max(1,Math.ceil(xse*Math.pow(2,-i))),h=new Float64Array(4*l*2+2);let a=0,v=0;for(let T=0;T<4;T++){const C=s[T].slice(0),k=s[T+1],L=(k[0]-C[0])/l,O=(k[1]-C[1])/l;for(let K=0;K<l;K++){C[0]+=L,C[1]+=O;const $=Hk(r,i,C),ne=Wk($),oe=qk(e,ne),fe=$k(oe);Math.abs(fe[1])>89.999&&(fe[0]=v);const ue=fe[0]-v;fe[0]+=ue>180?-360:ue<-180?360:0,h[a++]=fe[0],h[a++]=fe[1],v=fe[0]}}return h[a++]=h[0],h[a++]=h[1],h}function gE(t){const e=wse(t);return _se(e)}function wse(t){if(t.indexOf("/")>0)return t;const e=Gk(t);return yse(e)}function Ese(t){const e=gE(t);return bse(e)}function Ase(t){let e;if(t.face===2||t.face===5){let r=null,i=0;for(let s=0;s<4;s++){const l=`${t.face}/${s}`,h=gE(l),a=oM(h);(typeof r>"u"||r===null)&&(r=new Float64Array(4*a.length)),r.set(a,i),i+=a.length}e=aM(r)}else{const r=oM(t);e=aM(r)}return e}function aM(t){if(t.length%2!==0)throw new Error("Invalid corners");const e=[],r=[];for(let i=0;i<t.length;i+=2)e.push(t[i]),r.push(t[i+1]);return e.sort((i,s)=>i-s),r.sort((i,s)=>i-s),{west:e[0],east:e[e.length-1],north:r[r.length-1],south:r[0]}}function Tse(t,e){const r=e?.minimumHeight||0,i=e?.maximumHeight||0,s=gE(t),l=Ase(s),h=l.west,a=l.south,v=l.east,T=l.north,C=[];return C.push(new Je(h,T,r)),C.push(new Je(v,T,r)),C.push(new Je(v,a,r)),C.push(new Je(h,a,r)),C.push(new Je(h,T,i)),C.push(new Je(v,T,i)),C.push(new Je(v,a,i)),C.push(new Je(h,a,i)),C}function Zk(t){const e=t.token,r={minimumHeight:t.minimumHeight,maximumHeight:t.maximumHeight},i=Tse(e,r),s=Ese(e),l=s[0],h=s[1],a=Bi.WGS84.cartographicToCartesian([l,h,r.maximumHeight]),v=new Je(a[0],a[1],a[2]);i.push(v);const T=yQ(i);return[...T.center,...T.halfAxes]}const Sse=4,Cse=8,Mse={QUADTREE:Sse,OCTREE:Cse};function Pse(t,e,r){if(t?.box){const i=Gk(t.s2VolumeInfo.token),s=dse(i,e),l=hse(s),h={...t.s2VolumeInfo};switch(h.token=l,r){case"OCTREE":const a=t.s2VolumeInfo,v=a.maximumHeight-a.minimumHeight,T=v/2,C=a.minimumHeight+v/2;a.minimumHeight=C-T,a.maximumHeight=C+T;break}return{box:Zk(h),s2VolumeInfo:h}}}async function Xk(t){const{subtree:e,subtreeData:r={level:0,x:0,y:0,z:0},parentData:i={mortonIndex:0,localLevel:-1,localX:0,localY:0,localZ:0},childIndex:s=0,implicitOptions:l,loaderOptions:h,s2VolumeBox:a}=t,{subdivisionScheme:v,subtreeLevels:T,maximumLevel:C,contentUrlTemplate:k,subtreesUriTemplate:L,basePath:O}=l,K={children:[],lodMetricValue:0,contentUrl:""};if(!C)return GI.once(`Missing 'maximumLevel' or 'availableLevels' property. The subtree ${k} won't be loaded...`),K;const $=i.localLevel+1,ne=r.level+$;if(ne>C)return K;const oe=Mse[v],fe=Math.log2(oe),ue=s&1,we=s>>1&1,De=s>>2&1,Fe=Mp(i.localX,ue,1),Ke=Mp(i.localY,we,1),ze=Mp(i.localZ,De,1),it=Mp(r.x,Fe,$),lt=Mp(r.y,Ke,$),ht=Mp(r.z,ze,$),vt=Mp(i.mortonIndex,s,fe),Nt=$===T&&jb(e.childSubtreeAvailability,vt);let Lt,qt,Qt,Ot;if(Nt){const tt=`${O}/${L}`,wt=lw(tt,ne,it,lt,ht);Lt=await hd(wt,Fk,h),Ot=0,qt={level:ne,x:it,y:lt,z:ht},Qt={mortonIndex:0,localLevel:0,localX:0,localY:0,localZ:0}}else Lt=e,Ot=(oe**$-1)/(oe-1)+vt,qt=r,Qt={mortonIndex:vt,localLevel:$,localX:Fe,localY:Ke,localZ:ze};if(!jb(Lt.tileAvailability,Ot))return K;jb(Lt.contentAvailability,Ot)&&(K.contentUrl=lw(k,ne,it,lt,ht));for(let tt=0;tt<oe;tt++){const wt=Pse(a,tt,v),Bt=await Xk({subtree:Lt,subtreeData:qt,parentData:Qt,childIndex:tt,implicitOptions:l,loaderOptions:h,s2VolumeBox:wt});(Bt.contentUrl||Bt.children.length)&&K.children.push(Bt)}return K.contentUrl||K.children.length?Rse(K,{level:ne,x:it,y:lt,z:ht},l,a):K}function jb(t,e){let r;return Array.isArray(t)?(r=t[0],t.length>1&&GI.once('Not supported extension "3DTILES_multiple_contents" has been detected')):r=t,"constant"in r?!!r.constant:r.explicitBitstream?Bse(e,r.explicitBitstream):!1}function Rse(t,e,r,i){const{basePath:s,refine:l,getRefine:h,lodMetricType:a,getTileType:v,rootLodMetricValue:T,rootBoundingVolume:C}=r,k=t.contentUrl&&t.contentUrl.replace(`${s}/`,""),L=T/2**e.level,O=i?.box?{box:i.box}:C,K=Ise(O,e,r.subdivisionScheme);return{children:t.children,contentUrl:t.contentUrl,content:{uri:k},id:t.contentUrl,refine:h(l),type:v(t),lodMetricType:a,lodMetricValue:L,geometricError:L,transform:t.transform,boundingVolume:K}}function Ise(t,e,r){if(t.region){const{level:i,x:s,y:l,z:h}=e,[a,v,T,C,k,L]=t.region,O=2**i,K=(T-a)/O,[$,ne]=[a+K*s,a+K*(s+1)],oe=(C-v)/O,[fe,ue]=[v+oe*l,v+oe*(l+1)];let we,De;if(r==="OCTREE"){const Fe=(L-k)/O;[we,De]=[k+Fe*h,k+Fe*(h+1)]}else[we,De]=[k,L];return{region:[$,fe,ne,ue,we,De]}}if(t.box)return t;throw new Error(`Unsupported bounding volume type ${JSON.stringify(t)}`)}function Mp(t,e,r){return(t<<r)+e}function lw(t,e,r,i,s){const l=kse({level:e,x:r,y:i,z:s});return t.replace(/{level}|{x}|{y}|{z}/gi,h=>l[h])}function kse(t){const e={};for(const r in t)e[`{${r}}`]=t[r];return e}function Bse(t,e){const r=Math.floor(t/8),i=t%8;return(e[r]>>i&1)===1}function _E(t,e=""){if(!e)return th.EMPTY;const r=e.split("?")[0].split(".").pop();switch(r){case"pnts":return th.POINTCLOUD;case"i3dm":case"b3dm":case"glb":case"gltf":return th.SCENEGRAPH;default:return r||th.EMPTY}}function yE(t){switch(t){case"REPLACE":case"replace":return uc.REPLACE;case"ADD":case"add":return uc.ADD;default:return t}}function cw(t,e){if(/^[a-z][0-9a-z+.-]*:/i.test(e)){const r=new URL(t,`${e}/`);return decodeURI(r.toString())}else if(t.startsWith("/"))return t;return UU(e,t)}function lM(t,e){if(!t)return null;let r;if(t.content){const i=t.content.uri||t.content?.url;typeof i<"u"&&(r=cw(i,e))}return{...t,id:r,contentUrl:r,lodMetricType:Tm.GEOMETRIC_ERROR,lodMetricValue:t.geometricError,transformMatrix:t.transform,type:_E(t,r),refine:yE(t.refine)}}async function Lse(t,e,r){let i=null;const s=uM(t.root);s&&t.root?i=await cM(t.root,t,e,s,r):i=lM(t.root,e);const l=[];for(l.push(i);l.length>0;){const h=l.pop()||{},a=h.children||[],v=[];for(const T of a){const C=uM(T);let k;C?k=await cM(T,t,e,C,r):k=lM(T,e),k&&(v.push(k),l.push(k))}h.children=v}return i}async function cM(t,e,r,i,s){const{subdivisionScheme:l,maximumLevel:h,availableLevels:a,subtreeLevels:v,subtrees:{uri:T}}=i,C=lw(T,0,0,0,0),k=cw(C,r),L=await hd(k,Fk,s),O=t.content?.uri,K=O?cw(O,r):"",$=e?.root?.refine,ne=t.geometricError,oe=t.boundingVolume.extensions?.["3DTILES_bounding_volume_S2"];if(oe){const we={box:Zk(oe),s2VolumeInfo:oe};t.boundingVolume=we}const fe=t.boundingVolume,ue={contentUrlTemplate:K,subtreesUriTemplate:T,subdivisionScheme:l,subtreeLevels:v,maximumLevel:Number.isFinite(a)?a-1:h,refine:$,basePath:r,lodMetricType:Tm.GEOMETRIC_ERROR,rootLodMetricValue:ne,rootBoundingVolume:fe,getTileType:_E,getRefine:yE};return await Dse(t,r,L,ue,s)}async function Dse(t,e,r,i,s){if(!t)return null;const{children:l,contentUrl:h}=await Xk({subtree:r,implicitOptions:i,loaderOptions:s});let a,v=null;return h&&(a=h,v={uri:h.replace(`${e}/`,"")}),{...t,id:a,contentUrl:a,lodMetricType:Tm.GEOMETRIC_ERROR,lodMetricValue:t.geometricError,transformMatrix:t.transform,type:_E(t,a),refine:yE(t.refine),content:v||t.content,children:l}}function uM(t){return t?.extensions?.["3DTILES_implicit_tiling"]||t?.implicitTiling}const Kk={dataType:null,batchType:null,id:"3d-tiles",name:"3D Tiles",module:"3d-tiles",version:Rk,extensions:["cmpt","pnts","b3dm","i3dm"],mimeTypes:["application/octet-stream"],tests:["cmpt","pnts","b3dm","i3dm"],parse:Nse,options:{"3d-tiles":{loadGLTF:!0,decodeQuantizedPositions:!1,isTileset:"auto",assetGltfUpAxis:null}}};async function Nse(t,e={},r){const i=e["3d-tiles"]||{};let s;return i.isTileset==="auto"?s=r?.url&&r.url.indexOf(".json")!==-1:s=i.isTileset,s?Ose(t,e,r):Fse(t,e,r)}async function Ose(t,e,r){const i=JSON.parse(new TextDecoder().decode(t)),s=r?.url||"",l=zse(s),h=await Lse(i,l,e||{});return{...i,shape:"tileset3d",loader:Kk,url:s,queryString:r?.queryString||"",basePath:l,root:h||i.root,type:oa.TILES3D,lodMetricType:Tm.GEOMETRIC_ERROR,lodMetricValue:i.root?.geometricError||0}}async function Fse(t,e,r){const i={content:{shape:"tile3d",featureIds:null}};return await Ok(t,0,e,r,i.content),i.content}function zse(t){return m2(t)}const hM=[0],Use={getPointColor:{type:"accessor",value:[0,0,0,255]},pointSize:1,data:"",loader:Kk,onTilesetLoad:{type:"function",value:t=>{}},onTileLoad:{type:"function",value:t=>{}},onTileUnload:{type:"function",value:t=>{}},onTileError:{type:"function",value:(t,e,r)=>{}},_getMeshColor:{type:"function",value:t=>[255,255,255]}};class vE extends Y4{initializeState(){"onTileLoadFail"in this.props&&li.removed("onTileLoadFail","onTileError")(),this.state={layerMap:{},tileset3d:null,activeViewports:{},lastUpdatedViewports:null}}get isLoaded(){return!!(this.state?.tileset3d?.isLoaded()&&super.isLoaded)}shouldUpdateState({changeFlags:e}){return e.somethingChanged}updateState({props:e,oldProps:r,changeFlags:i}){if(e.data&&e.data!==r.data&&this._loadTileset(e.data),i.viewportChanged){const{activeViewports:s}=this.state;Object.keys(s).length&&(this._updateTileset(s),this.state.lastUpdatedViewports=s,this.state.activeViewports={})}if(i.propsChanged){const{layerMap:s}=this.state;for(const l in s)s[l].needsUpdate=!0}}activateViewport(e){const{activeViewports:r,lastUpdatedViewports:i}=this.state;this.internalState.viewport=e,r[e.id]=e;const s=i?.[e.id];(!s||!e.equals(s))&&(this.setChangeFlags({viewportChanged:!0}),this.setNeedsUpdate())}getPickingInfo({info:e,sourceLayer:r}){const i=r&&r.props.tile;return e.picked&&(e.object=i),e.sourceTile=i,e}filterSubLayer({layer:e,viewport:r}){const{tile:i}=e.props,{id:s}=r;return i.selected&&i.viewportIds.includes(s)}_updateAutoHighlight(e){const r=e.sourceTile,i=this.state.layerMap[r?.id];i&&i.layer&&i.layer.updateAutoHighlight(e)}async _loadTileset(e){const{loadOptions:r={}}=this.props,i=this.props.loader||this.props.loaders,s=Array.isArray(i)?i[0]:i,l={loadOptions:{...r}};let h=e;if(s.preload){const T=await s.preload(e,r);T.url&&(h=T.url),T.headers&&(l.loadOptions.fetch={...l.loadOptions.fetch,headers:T.headers}),Object.assign(l,T)}const a=await hd(h,s,l.loadOptions),v=new bne(a,{onTileLoad:this._onTileLoad.bind(this),onTileUnload:this._onTileUnload.bind(this),onTileError:this.props.onTileError,...l});this.setState({tileset3d:v,layerMap:{}}),this._updateTileset(this.state.activeViewports),this.props.onTilesetLoad(v)}_onTileLoad(e){const{lastUpdatedViewports:r}=this.state;this.props.onTileLoad(e),this._updateTileset(r),this.setNeedsUpdate()}_onTileUnload(e){delete this.state.layerMap[e.id],this.props.onTileUnload(e)}_updateTileset(e){if(!e)return;const{tileset3d:r}=this.state,{timeline:i}=this.context,s=Object.keys(e).length;!i||!s||!r||r.selectTiles(Object.values(e)).then(l=>{this.state.frameNumber!==l&&this.setState({frameNumber:l})})}_getSubLayer(e,r){if(!e.content)return null;switch(e.type){case th.POINTCLOUD:return this._makePointCloudLayer(e,r);case th.SCENEGRAPH:return this._make3DModelLayer(e);case th.MESH:return this._makeSimpleMeshLayer(e,r);default:throw new Error(`Tile3DLayer: Failed to render layer of type ${e.content.type}`)}}_makePointCloudLayer(e,r){const{attributes:i,pointCount:s,constantRGBA:l,cartographicOrigin:h,modelMatrix:a}=e.content,{positions:v,normals:T,colors:C}=i;if(!v)return null;const k=r&&r.props.data||{header:{vertexCount:s},attributes:{POSITION:v,NORMAL:T,COLOR_0:C}},{pointSize:L,getPointColor:O}=this.props,K=this.getSubLayerClass("pointcloud",rE);return new K({pointSize:L},this.getSubLayerProps({id:"pointcloud"}),{id:`${this.id}-pointcloud-${e.id}`,tile:e,data:k,coordinateSystem:Kr.METER_OFFSETS,coordinateOrigin:h,modelMatrix:a,getColor:l||O,_offset:0})}_make3DModelLayer(e){const{gltf:r,instances:i,cartographicOrigin:s,modelMatrix:l}=e.content,h=this.getSubLayerClass("scenegraph",uE);return new h({_lighting:"pbr"},this.getSubLayerProps({id:"scenegraph"}),{id:`${this.id}-scenegraph-${e.id}`,tile:e,data:i||hM,scenegraph:r,coordinateSystem:Kr.METER_OFFSETS,coordinateOrigin:s,modelMatrix:l,getTransformMatrix:a=>a.modelMatrix,getPosition:[0,0,0],_offset:0})}_makeSimpleMeshLayer(e,r){const i=e.content,{attributes:s,indices:l,modelMatrix:h,cartographicOrigin:a,coordinateSystem:v=Kr.METER_OFFSETS,material:T,featureIds:C}=i,{_getMeshColor:k}=this.props,L=r&&r.props.mesh||new um({topology:"triangle-list",attributes:jse(s),indices:l}),O=this.getSubLayerClass("mesh",hE);return new O(this.getSubLayerProps({id:"mesh"}),{id:`${this.id}-mesh-${e.id}`,tile:e,mesh:L,data:hM,getColor:k(e),pbrMaterial:T,modelMatrix:h,coordinateOrigin:a,coordinateSystem:v,featureIds:C,_offset:0})}renderLayers(){const{tileset3d:e,layerMap:r}=this.state;return e?e.tiles.map(i=>{const s=r[i.id]=r[i.id]||{tile:i};let{layer:l}=s;return i.selected&&(l?s.needsUpdate&&(l=this._getSubLayer(i,l),s.needsUpdate=!1):l=this._getSubLayer(i)),s.layer=l,l}).filter(Boolean):null}}vE.defaultProps=Use;vE.layerName="Tile3DLayer";function jse(t){const e={};return e.positions={...t.positions,value:new Float32Array(t.positions.value)},t.normals&&(e.normals=t.normals),t.texCoords&&(e.texCoords=t.texCoords),t.colors&&(e.colors=t.colors),t.uvRegions&&(e.uvRegions=t.uvRegions),e}const Vb=512,Vse=Math.PI/180;function Yk({map:t,gl:e,deck:r}){if(t.__deck)return t.__deck;const i=r?.props._customRender,s=r?.props.onLoad,l=Qk({...r?.props,_customRender:()=>{t.triggerRepaint(),i?.("")}});let h;return(!r||r.props.gl===e)&&(Object.assign(l,{gl:e,width:null,height:null,touchAction:"unset",viewState:S_(t)}),r?.isInitialized?dM(r,t):l.onLoad=()=>{s?.(),dM(h,t)}),r?(h=r,r.setProps(l),r.userData.isExternal=!0):(h=new E_(l),t.on("remove",()=>{Jk(t)})),h.userData.mapboxLayers=new Set,t.__deck=h,t.on("render",()=>{h.isInitialized&&Zse(h,t)}),h}function dM(t,e){const r=()=>{t.isInitialized?Xse(t,e):e.off("move",r)};e.on("move",r)}function Jk(t){t.__deck?.finalize(),t.__deck=null}function Qk(t){return{...t,parameters:{depthMask:!0,depthTest:!0,blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthFunc:515,blendEquation:32774,...t.parameters},views:t.views||[new X2({id:"mapbox"})]}}function Gse(t,e){t.userData.mapboxLayers.add(e),bE(t)}function Hse(t,e){t.userData.mapboxLayers.delete(e),bE(t)}function Wse(t,e){bE(t)}function qse(t,e,r){let{currentViewport:i}=t.userData,s=!1;i||(i=eB(t,e,!0),t.userData.currentViewport=i,s=!0),t.isInitialized&&t._drawLayers("mapbox-repaint",{viewports:[i],layerFilter:({layer:l})=>r.id===l.id||l.props.operation.includes("terrain"),clearStack:s,clearCanvas:!1})}function S_(t){const{lng:e,lat:r}=t.getCenter(),i={longitude:(e+540)%360-180,latitude:r,zoom:t.getZoom(),bearing:t.getBearing(),pitch:t.getPitch(),padding:t.getPadding(),repeat:t.getRenderWorldCopies()};return t.getTerrain?.()&&$se(t,i),i}function $se(t,e){if(t.getFreeCameraOptions){const{position:r}=t.getFreeCameraOptions();if(!r||r.z===void 0)return;const i=t.transform.height,{longitude:s,latitude:l,pitch:h}=e,a=r.x*Vb,v=(1-r.y)*Vb,T=r.z*Vb,C=v_([s,l]),k=a-C[0],L=v-C[1],O=Math.sqrt(k*k+L*L),K=h*Vse,$=1.5*i,ne=K<.001?$*Math.cos(K)/T:$*Math.sin(K)/O;e.zoom=Math.log2(ne);const oe=$*Math.cos(K)/ne,fe=T-oe;e.position=[0,0,fe/T0(l)]}else typeof t.transform.elevation=="number"&&(e.position=[0,0,t.transform.elevation])}function eB(t,e,r=!0){return new qp({id:"mapbox",x:0,y:0,width:t.width,height:t.height,...S_(e),nearZMultiplier:r?.02:.1,nearZ:e.transform._nearZ/e.transform.height,farZ:e.transform._farZ/e.transform.height})}function Zse(t,e){const{mapboxLayers:r,isExternal:i}=t.userData;if(i){const s=Array.from(r,T=>T.id),l=wm(t.props.layers,Boolean).some(T=>T&&!s.includes(T.id));let h=t.getViewports();const a=h.findIndex(T=>T.id==="mapbox"),v=h.length>1||a<0;(l||v)&&(a>=0&&(h=h.slice(),h[a]=eB(t,e,!1)),t._drawLayers("mapbox-repaint",{viewports:h,layerFilter:T=>(!t.props.layerFilter||t.props.layerFilter(T))&&(T.viewport.id!=="mapbox"||!s.includes(T.layer.id)),clearCanvas:!1}))}t.userData.currentViewport=null}function Xse(t,e){t.setProps({viewState:S_(e)}),t.needsRedraw({clearRedrawFlags:!0})}function bE(t){if(t.userData.isExternal)return;const e=[];t.userData.mapboxLayers.forEach(r=>{const i=r.props.type,s=new i(r.props);e.push(s)}),t.setProps({layers:e})}class Kse{constructor(e){if(!e.id)throw new Error("Layer must have an unique id");this.id=e.id,this.type="custom",this.renderingMode=e.renderingMode||"3d",this.map=null,this.deck=null,this.props=e}onAdd(e,r){this.map=e,this.deck=Yk({map:e,gl:r,deck:this.props.deck}),Gse(this.deck,this)}onRemove(){this.deck&&Hse(this.deck,this)}setProps(e){Object.assign(this.props,e,{id:this.id}),this.deck&&Wse(this.deck)}render(){qse(this.deck,this.map,this)}}const Gb="__UNDEFINED__";function f0(t,e,r,i){if(!t||!e||!t.style||!t.style._loaded)return;const s=wm(i,Boolean);if(r!==i){const a=wm(r,Boolean),v=new Set(a.map(T=>T.id));for(const T of s)v.delete(T.id);for(const T of v)t.getLayer(T)&&t.removeLayer(T)}for(const a of s){const v=t.getLayer(a.id);v?(v.implementation||v).setProps(a.props):t.addLayer(new Kse({id:a.id,deck:e}),a.props.beforeId)}const l=t.style._order,h={};for(const a of s){let{beforeId:v}=a.props;(!v||!l.includes(v))&&(v=Gb),h[v]=h[v]||[],h[v].push(a.id)}for(const a in h){const v=h[a];let T=a===Gb?l.length:l.indexOf(a),C=a===Gb?void 0:a;for(let k=v.length-1;k>=0;k--){const L=v[k],O=l.indexOf(L);O!==T-1&&(t.moveLayer(L,C),O>T&&T++),T--,C=L}}}class Yse{constructor(e){this._handleStyleChange=()=>{f0(this._map,this._deck,this._props.layers,this._props.layers)},this._updateContainerSize=()=>{if(this._map&&this._container){const{clientWidth:s,clientHeight:l}=this._map.getContainer();Object.assign(this._container.style,{width:`${s}px`,height:`${l}px`})}},this._updateViewState=()=>{const s=this._deck;s&&(s.setProps({viewState:S_(this._map)}),s.isInitialized&&s.redraw())},this._handleMouseEvent=s=>{const l=this._deck;if(!l||!l.isInitialized)return;const h={type:s.type,offsetCenter:s.point,srcEvent:s},a=this._lastMouseDownPoint;switch(!s.point&&a&&(h.deltaX=s.originalEvent.clientX-a.clientX,h.deltaY=s.originalEvent.clientY-a.clientY,h.offsetCenter={x:a.x+h.deltaX,y:a.y+h.deltaY}),h.type){case"mousedown":l._onPointerDown(h),this._lastMouseDownPoint={...s.point,clientX:s.originalEvent.clientX,clientY:s.originalEvent.clientY};break;case"dragstart":h.type="panstart",l._onEvent(h);break;case"drag":h.type="panmove",l._onEvent(h);break;case"dragend":h.type="panend",l._onEvent(h);break;case"click":h.tapCount=1,l._onEvent(h);break;case"dblclick":h.type="click",h.tapCount=2,l._onEvent(h);break;case"mousemove":h.type="pointermove",l._onPointerMove(h);break;case"mouseout":h.type="pointerleave",l._onPointerMove(h);break;default:return}};const{interleaved:r=!1,...i}=e;this._interleaved=r,this._props=i}setProps(e){this._interleaved&&e.layers&&f0(this._map,this._deck,this._props.layers,e.layers),Object.assign(this._props,e),this._deck&&this._deck.setProps(this._interleaved?Qk(this._props):this._props)}onAdd(e){return this._map=e,this._interleaved?this._onAddInterleaved(e):this._onAddOverlaid(e)}_onAddOverlaid(e){const r=document.createElement("div");return Object.assign(r.style,{position:"absolute",left:0,top:0,textAlign:"initial",pointerEvents:"none"}),this._container=r,this._deck=new E_({...this._props,parent:r,viewState:S_(e)}),e.on("resize",this._updateContainerSize),e.on("render",this._updateViewState),e.on("mousedown",this._handleMouseEvent),e.on("dragstart",this._handleMouseEvent),e.on("drag",this._handleMouseEvent),e.on("dragend",this._handleMouseEvent),e.on("mousemove",this._handleMouseEvent),e.on("mouseout",this._handleMouseEvent),e.on("click",this._handleMouseEvent),e.on("dblclick",this._handleMouseEvent),this._updateContainerSize(),r}_onAddInterleaved(e){const r=e.painter.context.gl;return r instanceof WebGLRenderingContext&&li.warn("Incompatible basemap library. See: https://deck.gl/docs/api-reference/mapbox/overview#compatibility")(),this._deck=Yk({map:e,gl:r,deck:new E_({...this._props,gl:r})}),e.on("styledata",this._handleStyleChange),f0(e,this._deck,[],this._props.layers),document.createElement("div")}onRemove(){const e=this._map;e&&(this._interleaved?this._onRemoveInterleaved(e):this._onRemoveOverlaid(e)),this._deck=void 0,this._map=void 0,this._container=void 0}_onRemoveOverlaid(e){e.off("resize",this._updateContainerSize),e.off("render",this._updateViewState),e.off("mousedown",this._handleMouseEvent),e.off("dragstart",this._handleMouseEvent),e.off("drag",this._handleMouseEvent),e.off("dragend",this._handleMouseEvent),e.off("mousemove",this._handleMouseEvent),e.off("mouseout",this._handleMouseEvent),e.off("click",this._handleMouseEvent),e.off("dblclick",this._handleMouseEvent),this._deck?.finalize()}_onRemoveInterleaved(e){e.off("styledata",this._handleStyleChange),f0(e,this._deck,this._props.layers,[]),Jk(e)}getDefaultPosition(){return"top-left"}pickObject(e){return ys(this._deck),this._deck.pickObject(e)}pickMultipleObjects(e){return ys(this._deck),this._deck.pickMultipleObjects(e)}pickObjects(e){return ys(this._deck),this._deck.pickObjects(e)}finalize(){this._map&&this._map.removeControl(this)}getCanvas(){return this._map?this._interleaved?this._map.getCanvas():this._deck.getCanvas():null}}class tB{olaMaps;apiKey;accessToken;mode;threedTileset;static Marker=Yi.Marker;static Popup=Yi.Popup;static NavigationControl=Yi.NavigationControl;static GeolocateControl=Yi.GeolocateControl;static ScaleControl=Yi.ScaleControl;static FullscreenControl=Yi.FullscreenControl;static AttributionControl=Yi.AttributionControl;static TerrainControl=Yi.TerrainControl;static LngLat=Yi.LngLat;static LngLatBounds=Yi.LngLatBounds;static Point=Yi.Point;static MercatorCoordinate=Yi.MercatorCoordinate;static MapMouseEvent=Yi.MapMouseEvent;static MapTouchEvent=Yi.MapTouchEvent;static MapWheelEvent=Yi.MapWheelEvent;static AJAXError=Yi.AJAXError;constructor({apiKey:e,accessToken:r="",mode:i="2d",threedTileset:s=O7}){this.apiKey=e,this.mode=i,this.threedTileset=s,this.accessToken=r}addOlaLogo(e){if(typeof window>"u")return;const r=document.getElementsByClassName("maplibregl-ctrl-bottom-left");let i="#000";e.style?.includes("dark")&&(i="#FFF");for(let s=0;s<r.length;s++){const l=document.createElement("div");l.style.position="absolute",l.style.bottom="4px",l.style.left="10px",l.style.zIndex="1000",l.innerHTML=F7(i),r[s].appendChild(l)}}addAttribution(){document.querySelectorAll(".maplibregl-ctrl-bottom-right .maplibregl-ctrl-attrib-inner")?.forEach(e=>{const r=e.querySelector("a");r&&(r.style.display="none");const i="ola-maps-link";if(!e.querySelector(`#${i}`)){const l=document.createElement("a");l.id=i,l.href="https://maps.olakrutrim.com/",l.target="_blank",l.textContent="Ola Maps ",e.appendChild(l)}const s="osm-link";if(!e.querySelector(`#${s}`)){const l=document.createElement("a");l.id=s,l.href="https://www.openstreetmap.org/copyright",l.target="_blank",l.textContent="|  OpenStreetMap contributors",e.appendChild(l)}})}fetchStaticMap(e){try{return fetch(e).then(r=>r.blob())}catch(r){console.log(r)}}async add3dLayer(){if(!this.threedTileset)throw new Error("3d Tileset is not initialized");const e=new vE({id:"tile-3d-layer",data:`${this.threedTileset}?api_key=${this.apiKey}`,beforeId:"poi_railway"}),r=new Yse({interleaved:!0,layers:[e]});r&&this.olaMaps.on("style.load",()=>{this.olaMaps.setFilter("building-3d",["all",["!has","hide_3d"],["!=","render_as_3d",!0]]),this.olaMaps.addControl(r)})}init(e){this.olaMaps=new Yi.Map({container:e?.container||"map",center:e?.center||[0,0],zoom:e?.zoom||9,hash:e?.hash||!1,style:e?.style||N7,transformRequest:(i,s)=>{if(this.accessToken)return{url:i,headers:{Authorization:`Bearer ${this.accessToken}`}};{const l=new URL(i);return s!=="Image"&&l.searchParams.append("api_key",this.apiKey),{url:l.toString()}}},...e}),this.mode==="3d"&&this.add3dLayer(),this.addOlaLogo(e),this.addAttribution();const r={};return Object.getOwnPropertyNames(Yi.Map.prototype).forEach(i=>{typeof this.olaMaps[i]=="function"&&(r[i]=this.olaMaps[i].bind(this.olaMaps))}),Object.keys(zy).forEach(i=>{typeof zy[i]=="function"?r[i]=(...s)=>new zy[i](...s):r[i]=zy[i]}),Object.getOwnPropertyNames(this.olaMaps).forEach(i=>{i in r||(r[i]=this.olaMaps[i])}),Object.assign(this.olaMaps,r)}addNavigationControls(e){return new Yi.NavigationControl(e)}addGeolocateControls(e){return new Yi.GeolocateControl(e)}getMercatorCoordinate(){return Yi.MercatorCoordinate}addMarker(e){return new Yi.Marker(e)}addPopup(e){return new Yi.Popup(e)}getStaticMap(e,r){this.fetchStaticMap(e)?.then(i=>{const s=URL.createObjectURL(i),l=document.createElement("img");l.src=s;const h=document.getElementById(r);h&&!h.querySelector("img")?h?.appendChild(l):console.log("An image already exists in the element.")}).catch(i=>console.error(i))}}typeof window<"u"&&(window.OlaMaps=tB);const Hb="HbWpPdq2B7StVwNqsUEitrJZCXXdMWfHjoX0yutE",Jse=()=>{const t=te.useRef(null),e=te.useRef(null),r=te.useRef(null),i=te.useRef([]),s=te.useRef(null),[l,h]=te.useState(""),[a,v]=te.useState([]),[T,C]=te.useState(!1),[k,L]=te.useState(null),[O,K]=te.useState(null),[$,ne]=te.useState(!1),[oe,fe]=te.useState(!1),[ue,we]=te.useState(5),[De,Fe]=te.useState(null),Ke=te.useRef();te.useEffect(()=>!t.current||e.current?void 0:((()=>{try{r.current=new tB({apiKey:Hb});const vt=r.current.init({style:"https://api.olamaps.io/tiles/vector/v1/styles/default-dark-standard/style.json",container:t.current,center:[77.209,28.6139],zoom:12});e.current=vt,vt.addControl(new r.current.NavigationControl,"bottom-right"),vt.on("load",()=>{ze()})}catch(vt){console.error("Error initializing Ola Maps:",vt)}})(),()=>{e.current&&(e.current.remove(),e.current=null)}),[]),te.useEffect(()=>{navigator.geolocation&&navigator.geolocation.getCurrentPosition(ht=>{const{latitude:vt,longitude:Nt}=ht.coords;if(L({lat:vt,lng:Nt}),e.current&&r.current){if(s.current)s.current.setLngLat([Nt,vt]);else{const Lt=document.createElement("div");Lt.className="user-location-marker",Lt.style.width="20px",Lt.style.height="20px",Lt.style.backgroundColor="#3b82f6",Lt.style.borderRadius="50%",Lt.style.border="3px solid white",Lt.style.boxShadow="0 0 10px rgba(59, 130, 246, 0.5)",s.current=r.current.addMarker({element:Lt}).setLngLat([Nt,vt]).addTo(e.current)}e.current.flyTo({center:[Nt,vt],zoom:14})}},ht=>{console.error("Error getting location:",ht)})},[]);const ze=()=>{if(!e.current||!r.current)return;i.current.forEach(vt=>vt.remove()),i.current=[],O0.filter(vt=>{if(De&&vt.mood!==De)return!1;if(oe&&k){const Lt=(vt.location.lat-k.lat)*Math.PI/180,qt=(vt.location.lng-k.lng)*Math.PI/180,Qt=Math.sin(Lt/2)*Math.sin(Lt/2)+Math.cos(k.lat*Math.PI/180)*Math.cos(vt.location.lat*Math.PI/180)*Math.sin(qt/2)*Math.sin(qt/2);if(6371*(2*Math.atan2(Math.sqrt(Qt),Math.sqrt(1-Qt)))>ue)return!1}return!0}).forEach(vt=>{const Nt=document.createElement("div");if(Nt.className="event-marker",Nt.style.backgroundImage=`url(${vt.imageUrl})`,Nt.style.width="40px",Nt.style.height="40px",Nt.style.backgroundSize="cover",Nt.style.borderRadius="50%",Nt.style.border="2px solid white",Nt.style.cursor="pointer",Nt.style.boxShadow="0 4px 6px rgba(0,0,0,0.3)",vt.attendees>50){const qt=document.createElement("div");qt.className="absolute -inset-2 rounded-full bg-primary/30 animate-ping -z-10",Nt.appendChild(qt)}Nt.addEventListener("click",()=>{K(vt),ne(!0)});const Lt=r.current.addMarker({element:Nt}).setLngLat([vt.location.lng,vt.location.lat]).addTo(e.current);i.current.push(Lt)})};te.useEffect(()=>{ze()},[De,oe,ue,k]),te.useEffect(()=>{if(Ke.current&&clearTimeout(Ke.current),l.trim().length<3){v([]);return}return C(!0),Ke.current=setTimeout(async()=>{try{const vt=await(await fetch(`https://api.olamaps.io/places/v1/autocomplete?input=${encodeURIComponent(l)}&api_key=${Hb}`)).json();vt.predictions&&Array.isArray(vt.predictions)?v(vt.predictions.slice(0,5)):v([])}catch(ht){console.error("Ola Maps search error:",ht),v([])}finally{C(!1)}},500),()=>{Ke.current&&clearTimeout(Ke.current)}},[l]);const it=async ht=>{try{const Nt=await(await fetch(`https://api.olamaps.io/places/v1/details?place_id=${ht.place_id}&api_key=${Hb}`)).json();console.log("Place Details Response:",Nt);const qt=(Nt.result?.geometry||Nt.geometry)?.location;if(qt&&e.current){const Qt=typeof qt.lat=="function"?qt.lat():parseFloat(qt.lat),Ot=typeof qt.lng=="function"?qt.lng():parseFloat(qt.lng);!isNaN(Qt)&&!isNaN(Ot)?(console.log("Flying to:",{lat:Qt,lng:Ot}),e.current.flyTo({center:[Ot,Qt],zoom:15,duration:2e3}),r.current.addMarker({}).setLngLat([Ot,Qt]).addTo(e.current)):console.error("Invalid coordinates:",qt)}else console.error("Could not find location in response:",Nt)}catch(vt){console.error("Error fetching place details:",vt)}h(""),v([])},lt=()=>{k&&e.current&&e.current.flyTo({center:[k.lng,k.lat],zoom:15})};return H.jsxs("div",{className:"relative w-full h-full bg-background",children:[H.jsx("div",{ref:t,className:"w-full h-full",style:{minHeight:"100vh"}}),H.jsxs("div",{className:"absolute top-4 left-4 right-4 z-[400]",children:[H.jsxs("div",{className:"relative",children:[H.jsx(k6,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground pointer-events-none"}),H.jsx(v0,{type:"text",placeholder:"Search for a location in India...",value:l,onChange:ht=>h(ht.target.value),className:"pl-9 pr-9 bg-background/80 backdrop-blur-md border-white/20 shadow-lg"}),l&&H.jsx("button",{onClick:()=>{h(""),v([])},className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-muted-foreground hover:text-foreground",children:H.jsx(pw,{className:"h-4 w-4"})})]}),(T||a.length>0)&&H.jsx("div",{className:"absolute top-full left-0 right-0 mt-2 bg-background/90 backdrop-blur-md rounded-lg border border-white/10 shadow-xl overflow-hidden max-h-60 overflow-y-auto",children:T?H.jsxs("div",{className:"p-4 text-center text-sm text-muted-foreground flex items-center justify-center gap-2",children:[H.jsx(_6,{className:"h-4 w-4 animate-spin"}),"Searching with Ola Maps..."]}):a.map(ht=>H.jsx("button",{className:"w-full text-left px-4 py-3 hover:bg-white/10 transition-colors border-b border-white/5 last:border-0",onClick:()=>it(ht),children:H.jsxs("div",{className:"flex items-start gap-2",children:[H.jsx(Hp,{className:"h-4 w-4 text-primary shrink-0 mt-0.5"}),H.jsxs("div",{children:[H.jsx("div",{className:"text-sm font-medium text-foreground",children:ht.description}),ht.structured_formatting?.secondary_text&&H.jsx("div",{className:"text-xs text-muted-foreground line-clamp-1",children:ht.structured_formatting.secondary_text})]})]})},ht.place_id))})]}),H.jsxs("div",{className:"absolute top-20 left-0 right-0 z-[400] flex flex-col gap-4 pointer-events-none px-4",children:[H.jsxs("div",{className:"flex items-center justify-between pointer-events-auto",children:[H.jsx(N9,{selectedMood:De,onSelectMood:Fe}),H.jsx(lc,{variant:"outline",size:"icon",className:"bg-background/80 backdrop-blur-md border-white/20 shadow-lg shrink-0 ml-2",onClick:lt,children:H.jsx(S6,{className:`h-4 w-4 ${k?"text-primary":"text-muted-foreground"}`})})]}),H.jsx("div",{className:"pointer-events-auto",children:H.jsx(B9,{isActive:oe,onToggle:()=>fe(!oe),radius:ue,onRadiusChange:we})})]}),H.jsx("div",{className:"absolute bottom-24 left-4 right-4 z-[400] pointer-events-none",children:H.jsxs("div",{className:"bg-background/80 backdrop-blur-md rounded-full px-4 py-2 border border-white/10 shadow-lg inline-flex items-center gap-3",children:[H.jsxs("div",{className:"flex items-center gap-1.5",children:[H.jsx(Hp,{className:"h-3.5 w-3.5 text-primary"}),H.jsxs("span",{className:"text-xs font-medium",children:[O0.length," events"]})]}),H.jsx("div",{className:"w-px h-3 bg-border"}),H.jsx("div",{className:"text-[10px] text-muted-foreground",children:"Powered by Ola Maps "})]})}),H.jsx("div",{className:"absolute bottom-24 right-4 z-[400]",children:H.jsx(k7,{})}),H.jsx(nI,{event:O,open:$,onClose:()=>ne(!1)})]})};function Qse(t,e){return te.useReducer((r,i)=>e[r][i]??r,t)}var xE="ScrollArea",[rB]=Im(xE),[eoe,Cl]=rB(xE),iB=te.forwardRef((t,e)=>{const{__scopeScrollArea:r,type:i="hover",dir:s,scrollHideDelay:l=600,...h}=t,[a,v]=te.useState(null),[T,C]=te.useState(null),[k,L]=te.useState(null),[O,K]=te.useState(null),[$,ne]=te.useState(null),[oe,fe]=te.useState(0),[ue,we]=te.useState(0),[De,Fe]=te.useState(!1),[Ke,ze]=te.useState(!1),it=Cn(e,ht=>v(ht)),lt=p1(s);return H.jsx(eoe,{scope:r,type:i,dir:lt,scrollHideDelay:l,scrollArea:a,viewport:T,onViewportChange:C,content:k,onContentChange:L,scrollbarX:O,onScrollbarXChange:K,scrollbarXEnabled:De,onScrollbarXEnabledChange:Fe,scrollbarY:$,onScrollbarYChange:ne,scrollbarYEnabled:Ke,onScrollbarYEnabledChange:ze,onCornerWidthChange:fe,onCornerHeightChange:we,children:H.jsx(Qi.div,{dir:lt,...h,ref:it,style:{position:"relative","--radix-scroll-area-corner-width":oe+"px","--radix-scroll-area-corner-height":ue+"px",...t.style}})})});iB.displayName=xE;var nB="ScrollAreaViewport",sB=te.forwardRef((t,e)=>{const{__scopeScrollArea:r,children:i,nonce:s,...l}=t,h=Cl(nB,r),a=te.useRef(null),v=Cn(e,a,h.onViewportChange);return H.jsxs(H.Fragment,{children:[H.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}"},nonce:s}),H.jsx(Qi.div,{"data-radix-scroll-area-viewport":"",...l,ref:v,style:{overflowX:h.scrollbarXEnabled?"scroll":"hidden",overflowY:h.scrollbarYEnabled?"scroll":"hidden",...t.style},children:H.jsx("div",{ref:h.onContentChange,style:{minWidth:"100%",display:"table"},children:i})})]})});sB.displayName=nB;var hu="ScrollAreaScrollbar",oB=te.forwardRef((t,e)=>{const{forceMount:r,...i}=t,s=Cl(hu,t.__scopeScrollArea),{onScrollbarXEnabledChange:l,onScrollbarYEnabledChange:h}=s,a=t.orientation==="horizontal";return te.useEffect(()=>(a?l(!0):h(!0),()=>{a?l(!1):h(!1)}),[a,l,h]),s.type==="hover"?H.jsx(toe,{...i,ref:e,forceMount:r}):s.type==="scroll"?H.jsx(roe,{...i,ref:e,forceMount:r}):s.type==="auto"?H.jsx(aB,{...i,ref:e,forceMount:r}):s.type==="always"?H.jsx(wE,{...i,ref:e}):null});oB.displayName=hu;var toe=te.forwardRef((t,e)=>{const{forceMount:r,...i}=t,s=Cl(hu,t.__scopeScrollArea),[l,h]=te.useState(!1);return te.useEffect(()=>{const a=s.scrollArea;let v=0;if(a){const T=()=>{window.clearTimeout(v),h(!0)},C=()=>{v=window.setTimeout(()=>h(!1),s.scrollHideDelay)};return a.addEventListener("pointerenter",T),a.addEventListener("pointerleave",C),()=>{window.clearTimeout(v),a.removeEventListener("pointerenter",T),a.removeEventListener("pointerleave",C)}}},[s.scrollArea,s.scrollHideDelay]),H.jsx(lh,{present:r||l,children:H.jsx(aB,{"data-state":l?"visible":"hidden",...i,ref:e})})}),roe=te.forwardRef((t,e)=>{const{forceMount:r,...i}=t,s=Cl(hu,t.__scopeScrollArea),l=t.orientation==="horizontal",h=z1(()=>v("SCROLL_END"),100),[a,v]=Qse("hidden",{hidden:{SCROLL:"scrolling"},scrolling:{SCROLL_END:"idle",POINTER_ENTER:"interacting"},interacting:{SCROLL:"interacting",POINTER_LEAVE:"idle"},idle:{HIDE:"hidden",SCROLL:"scrolling",POINTER_ENTER:"interacting"}});return te.useEffect(()=>{if(a==="idle"){const T=window.setTimeout(()=>v("HIDE"),s.scrollHideDelay);return()=>window.clearTimeout(T)}},[a,s.scrollHideDelay,v]),te.useEffect(()=>{const T=s.viewport,C=l?"scrollLeft":"scrollTop";if(T){let k=T[C];const L=()=>{const O=T[C];k!==O&&(v("SCROLL"),h()),k=O};return T.addEventListener("scroll",L),()=>T.removeEventListener("scroll",L)}},[s.viewport,l,v,h]),H.jsx(lh,{present:r||a!=="hidden",children:H.jsx(wE,{"data-state":a==="hidden"?"hidden":"visible",...i,ref:e,onPointerEnter:_i(t.onPointerEnter,()=>v("POINTER_ENTER")),onPointerLeave:_i(t.onPointerLeave,()=>v("POINTER_LEAVE"))})})}),aB=te.forwardRef((t,e)=>{const r=Cl(hu,t.__scopeScrollArea),{forceMount:i,...s}=t,[l,h]=te.useState(!1),a=t.orientation==="horizontal",v=z1(()=>{if(r.viewport){const T=r.viewport.offsetWidth<r.viewport.scrollWidth,C=r.viewport.offsetHeight<r.viewport.scrollHeight;h(a?T:C)}},10);return Cm(r.viewport,v),Cm(r.content,v),H.jsx(lh,{present:i||l,children:H.jsx(wE,{"data-state":l?"visible":"hidden",...s,ref:e})})}),wE=te.forwardRef((t,e)=>{const{orientation:r="vertical",...i}=t,s=Cl(hu,t.__scopeScrollArea),l=te.useRef(null),h=te.useRef(0),[a,v]=te.useState({content:0,viewport:0,scrollbar:{size:0,paddingStart:0,paddingEnd:0}}),T=dB(a.viewport,a.content),C={...i,sizes:a,onSizesChange:v,hasThumb:T>0&&T<1,onThumbChange:L=>l.current=L,onThumbPointerUp:()=>h.current=0,onThumbPointerDown:L=>h.current=L};function k(L,O){return loe(L,h.current,a,O)}return r==="horizontal"?H.jsx(ioe,{...C,ref:e,onThumbPositionChange:()=>{if(s.viewport&&l.current){const L=s.viewport.scrollLeft,O=pM(L,a,s.dir);l.current.style.transform=`translate3d(${O}px, 0, 0)`}},onWheelScroll:L=>{s.viewport&&(s.viewport.scrollLeft=L)},onDragScroll:L=>{s.viewport&&(s.viewport.scrollLeft=k(L,s.dir))}}):r==="vertical"?H.jsx(noe,{...C,ref:e,onThumbPositionChange:()=>{if(s.viewport&&l.current){const L=s.viewport.scrollTop,O=pM(L,a);l.current.style.transform=`translate3d(0, ${O}px, 0)`}},onWheelScroll:L=>{s.viewport&&(s.viewport.scrollTop=L)},onDragScroll:L=>{s.viewport&&(s.viewport.scrollTop=k(L))}}):null}),ioe=te.forwardRef((t,e)=>{const{sizes:r,onSizesChange:i,...s}=t,l=Cl(hu,t.__scopeScrollArea),[h,a]=te.useState(),v=te.useRef(null),T=Cn(e,v,l.onScrollbarXChange);return te.useEffect(()=>{v.current&&a(getComputedStyle(v.current))},[v]),H.jsx(cB,{"data-orientation":"horizontal",...s,ref:T,sizes:r,style:{bottom:0,left:l.dir==="rtl"?"var(--radix-scroll-area-corner-width)":0,right:l.dir==="ltr"?"var(--radix-scroll-area-corner-width)":0,"--radix-scroll-area-thumb-width":F1(r)+"px",...t.style},onThumbPointerDown:C=>t.onThumbPointerDown(C.x),onDragScroll:C=>t.onDragScroll(C.x),onWheelScroll:(C,k)=>{if(l.viewport){const L=l.viewport.scrollLeft+C.deltaX;t.onWheelScroll(L),fB(L,k)&&C.preventDefault()}},onResize:()=>{v.current&&l.viewport&&h&&i({content:l.viewport.scrollWidth,viewport:l.viewport.offsetWidth,scrollbar:{size:v.current.clientWidth,paddingStart:s1(h.paddingLeft),paddingEnd:s1(h.paddingRight)}})}})}),noe=te.forwardRef((t,e)=>{const{sizes:r,onSizesChange:i,...s}=t,l=Cl(hu,t.__scopeScrollArea),[h,a]=te.useState(),v=te.useRef(null),T=Cn(e,v,l.onScrollbarYChange);return te.useEffect(()=>{v.current&&a(getComputedStyle(v.current))},[v]),H.jsx(cB,{"data-orientation":"vertical",...s,ref:T,sizes:r,style:{top:0,right:l.dir==="ltr"?0:void 0,left:l.dir==="rtl"?0:void 0,bottom:"var(--radix-scroll-area-corner-height)","--radix-scroll-area-thumb-height":F1(r)+"px",...t.style},onThumbPointerDown:C=>t.onThumbPointerDown(C.y),onDragScroll:C=>t.onDragScroll(C.y),onWheelScroll:(C,k)=>{if(l.viewport){const L=l.viewport.scrollTop+C.deltaY;t.onWheelScroll(L),fB(L,k)&&C.preventDefault()}},onResize:()=>{v.current&&l.viewport&&h&&i({content:l.viewport.scrollHeight,viewport:l.viewport.offsetHeight,scrollbar:{size:v.current.clientHeight,paddingStart:s1(h.paddingTop),paddingEnd:s1(h.paddingBottom)}})}})}),[soe,lB]=rB(hu),cB=te.forwardRef((t,e)=>{const{__scopeScrollArea:r,sizes:i,hasThumb:s,onThumbChange:l,onThumbPointerUp:h,onThumbPointerDown:a,onThumbPositionChange:v,onDragScroll:T,onWheelScroll:C,onResize:k,...L}=t,O=Cl(hu,r),[K,$]=te.useState(null),ne=Cn(e,it=>$(it)),oe=te.useRef(null),fe=te.useRef(""),ue=O.viewport,we=i.content-i.viewport,De=la(C),Fe=la(v),Ke=z1(k,10);function ze(it){if(oe.current){const lt=it.clientX-oe.current.left,ht=it.clientY-oe.current.top;T({x:lt,y:ht})}}return te.useEffect(()=>{const it=lt=>{const ht=lt.target;K?.contains(ht)&&De(lt,we)};return document.addEventListener("wheel",it,{passive:!1}),()=>document.removeEventListener("wheel",it,{passive:!1})},[ue,K,we,De]),te.useEffect(Fe,[i,Fe]),Cm(K,Ke),Cm(O.content,Ke),H.jsx(soe,{scope:r,scrollbar:K,hasThumb:s,onThumbChange:la(l),onThumbPointerUp:la(h),onThumbPositionChange:Fe,onThumbPointerDown:la(a),children:H.jsx(Qi.div,{...L,ref:ne,style:{position:"absolute",...L.style},onPointerDown:_i(t.onPointerDown,it=>{it.button===0&&(it.target.setPointerCapture(it.pointerId),oe.current=K.getBoundingClientRect(),fe.current=document.body.style.webkitUserSelect,document.body.style.webkitUserSelect="none",O.viewport&&(O.viewport.style.scrollBehavior="auto"),ze(it))}),onPointerMove:_i(t.onPointerMove,ze),onPointerUp:_i(t.onPointerUp,it=>{const lt=it.target;lt.hasPointerCapture(it.pointerId)&&lt.releasePointerCapture(it.pointerId),document.body.style.webkitUserSelect=fe.current,O.viewport&&(O.viewport.style.scrollBehavior=""),oe.current=null})})})}),n1="ScrollAreaThumb",uB=te.forwardRef((t,e)=>{const{forceMount:r,...i}=t,s=lB(n1,t.__scopeScrollArea);return H.jsx(lh,{present:r||s.hasThumb,children:H.jsx(ooe,{ref:e,...i})})}),ooe=te.forwardRef((t,e)=>{const{__scopeScrollArea:r,style:i,...s}=t,l=Cl(n1,r),h=lB(n1,r),{onThumbPositionChange:a}=h,v=Cn(e,k=>h.onThumbChange(k)),T=te.useRef(void 0),C=z1(()=>{T.current&&(T.current(),T.current=void 0)},100);return te.useEffect(()=>{const k=l.viewport;if(k){const L=()=>{if(C(),!T.current){const O=coe(k,a);T.current=O,a()}};return a(),k.addEventListener("scroll",L),()=>k.removeEventListener("scroll",L)}},[l.viewport,C,a]),H.jsx(Qi.div,{"data-state":h.hasThumb?"visible":"hidden",...s,ref:v,style:{width:"var(--radix-scroll-area-thumb-width)",height:"var(--radix-scroll-area-thumb-height)",...i},onPointerDownCapture:_i(t.onPointerDownCapture,k=>{const O=k.target.getBoundingClientRect(),K=k.clientX-O.left,$=k.clientY-O.top;h.onThumbPointerDown({x:K,y:$})}),onPointerUp:_i(t.onPointerUp,h.onThumbPointerUp)})});uB.displayName=n1;var EE="ScrollAreaCorner",hB=te.forwardRef((t,e)=>{const r=Cl(EE,t.__scopeScrollArea),i=!!(r.scrollbarX&&r.scrollbarY);return r.type!=="scroll"&&i?H.jsx(aoe,{...t,ref:e}):null});hB.displayName=EE;var aoe=te.forwardRef((t,e)=>{const{__scopeScrollArea:r,...i}=t,s=Cl(EE,r),[l,h]=te.useState(0),[a,v]=te.useState(0),T=!!(l&&a);return Cm(s.scrollbarX,()=>{const C=s.scrollbarX?.offsetHeight||0;s.onCornerHeightChange(C),v(C)}),Cm(s.scrollbarY,()=>{const C=s.scrollbarY?.offsetWidth||0;s.onCornerWidthChange(C),h(C)}),T?H.jsx(Qi.div,{...i,ref:e,style:{width:l,height:a,position:"absolute",right:s.dir==="ltr"?0:void 0,left:s.dir==="rtl"?0:void 0,bottom:0,...t.style}}):null});function s1(t){return t?parseInt(t,10):0}function dB(t,e){const r=t/e;return isNaN(r)?0:r}function F1(t){const e=dB(t.viewport,t.content),r=t.scrollbar.paddingStart+t.scrollbar.paddingEnd,i=(t.scrollbar.size-r)*e;return Math.max(i,18)}function loe(t,e,r,i="ltr"){const s=F1(r),l=s/2,h=e||l,a=s-h,v=r.scrollbar.paddingStart+h,T=r.scrollbar.size-r.scrollbar.paddingEnd-a,C=r.content-r.viewport,k=i==="ltr"?[0,C]:[C*-1,0];return pB([v,T],k)(t)}function pM(t,e,r="ltr"){const i=F1(e),s=e.scrollbar.paddingStart+e.scrollbar.paddingEnd,l=e.scrollbar.size-s,h=e.content-e.viewport,a=l-i,v=r==="ltr"?[0,h]:[h*-1,0],T=Yw(t,v);return pB([0,h],[0,a])(T)}function pB(t,e){return r=>{if(t[0]===t[1]||e[0]===e[1])return e[0];const i=(e[1]-e[0])/(t[1]-t[0]);return e[0]+i*(r-t[0])}}function fB(t,e){return t>0&&t<e}var coe=(t,e=()=>{})=>{let r={left:t.scrollLeft,top:t.scrollTop},i=0;return(function s(){const l={left:t.scrollLeft,top:t.scrollTop},h=r.left!==l.left,a=r.top!==l.top;(h||a)&&e(),r=l,i=window.requestAnimationFrame(s)})(),()=>window.cancelAnimationFrame(i)};function z1(t,e){const r=la(t),i=te.useRef(0);return te.useEffect(()=>()=>window.clearTimeout(i.current),[]),te.useCallback(()=>{window.clearTimeout(i.current),i.current=window.setTimeout(r,e)},[r,e])}function Cm(t,e){const r=la(e);cu(()=>{let i=0;if(t){const s=new ResizeObserver(()=>{cancelAnimationFrame(i),i=window.requestAnimationFrame(r)});return s.observe(t),()=>{window.cancelAnimationFrame(i),s.unobserve(t)}}},[t,r])}var uoe=iB,hoe=sB,doe=hB;function U1({className:t,children:e,...r}){return H.jsxs(uoe,{"data-slot":"scroll-area",className:Vi("relative",t),...r,children:[H.jsx(hoe,{"data-slot":"scroll-area-viewport",className:"focus-visible:ring-ring/50 size-full rounded-[inherit] transition-[color,box-shadow] outline-none focus-visible:ring-[3px] focus-visible:outline-1",children:e}),H.jsx(poe,{}),H.jsx(doe,{})]})}function poe({className:t,orientation:e="vertical",...r}){return H.jsx(oB,{"data-slot":"scroll-area-scrollbar",orientation:e,className:Vi("flex touch-none p-px transition-colors select-none",e==="vertical"&&"h-full w-2.5 border-l border-l-transparent",e==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent",t),...r,children:H.jsx(uB,{"data-slot":"scroll-area-thumb",className:"bg-border relative flex-1 rounded-full"})})}function foe({events:t,onEventSelect:e}){return H.jsx("div",{className:"h-full bg-background",children:H.jsxs("div",{className:"relative h-full flex flex-col",children:[H.jsx("div",{className:"sticky top-0 z-10 bg-card/80 backdrop-blur-xl border-b border-border p-4",children:H.jsxs("div",{className:"flex items-center gap-3",children:[H.jsxs("div",{className:"relative",children:[H.jsx(fm,{className:"h-7 w-7 text-primary"}),H.jsx(hw,{className:"h-3 w-3 text-primary absolute -top-1 -right-1"})]}),H.jsxs("div",{children:[H.jsx("h1",{className:"text-2xl text-foreground",children:"Social Feed"}),H.jsx("p",{className:"text-muted-foreground text-xs",children:"See what your friends are up to"})]})]})}),H.jsx(U1,{className:"flex-1",children:H.jsx("div",{className:"p-4 space-y-5",children:t.map(r=>H.jsxs("div",{onClick:()=>e(r),className:"group cursor-pointer",children:[H.jsxs("div",{className:"flex items-center gap-2 mb-3 px-1",children:[H.jsxs(t2,{className:"h-8 w-8 border-2 border-primary/30",children:[H.jsx(r2,{src:r.host.avatar,alt:r.host.name}),H.jsx(i2,{children:r.host.name[0]})]}),H.jsxs("div",{className:"text-sm",children:[H.jsx("span",{className:"text-foreground",children:r.host.name}),H.jsx("span",{className:"text-muted-foreground",children:" is hosting"})]})]}),H.jsxs("div",{className:"relative bg-card rounded-2xl overflow-hidden border border-border group-hover:border-primary/50 transition-all duration-300 group-hover:shadow-lg group-hover:shadow-primary/10",children:[H.jsxs("div",{className:"relative h-56 overflow-hidden",children:[H.jsx(ud,{src:r.imageUrl,alt:r.title,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-500"}),H.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/80 via-black/20 to-transparent"}),H.jsx(sh,{className:"absolute top-3 right-3 bg-primary text-primary-foreground border-0",children:r.mood}),H.jsxs("div",{className:"absolute bottom-0 left-0 right-0 p-4",children:[H.jsx("h3",{className:"text-white text-xl mb-1",children:r.title}),H.jsxs("div",{className:"flex items-center justify-between text-sm",children:[H.jsx("span",{className:"text-primary",children:r.startTime}),H.jsx("span",{className:"text-gray-300",children:r.location.name})]})]})]}),H.jsxs("div",{className:"p-4 flex items-center justify-between border-t border-border",children:[H.jsxs("div",{className:"flex items-center gap-4 text-muted-foreground text-sm",children:[H.jsxs("button",{className:"flex items-center gap-1.5 hover:text-primary transition-colors",children:[H.jsx(p6,{className:"h-4 w-4"}),H.jsx("span",{children:Math.floor(Math.random()*50)+10})]}),H.jsxs("button",{className:"flex items-center gap-1.5 hover:text-primary transition-colors",children:[H.jsx(w6,{className:"h-4 w-4"}),H.jsx("span",{children:Math.floor(Math.random()*20)+5})]}),H.jsxs("div",{className:"flex items-center gap-1.5",children:[H.jsx(fm,{className:"h-4 w-4"}),H.jsxs("span",{children:[r.attendees," going"]})]})]}),H.jsx("div",{className:"text-primary text-sm group-hover:text-primary/80 transition-colors",children:"View Details "})]})]})]},r.id))})})]})})}function moe({events:t}){const[e,r]=te.useState("hosted"),i=t.slice(0,3),s=t.slice(3);return H.jsx("div",{className:"h-full bg-background",children:H.jsx(U1,{className:"h-full relative",children:H.jsxs("div",{className:"pb-20",children:[H.jsxs("div",{className:"p-4 border-b border-border bg-card/80 backdrop-blur-sm",children:[H.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[H.jsxs(t2,{className:"h-20 w-20 border-2 border-primary/30",children:[H.jsx(r2,{src:"https://images.unsplash.com/photo-1667382136327-5f78dc5cf835?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxpbmRpYW4lMjBtYW4lMjBwb3J0cmFpdHxlbnwxfHx8fDE3NjMzNzA5NzN8MA&ixlib=rb-4.1.0&q=80&w=1080",alt:"Profile"}),H.jsx(i2,{children:"AM"})]}),H.jsxs("div",{className:"flex-1 grid grid-cols-3 gap-2 text-center",children:[H.jsxs("div",{children:[H.jsx("div",{className:"text-foreground",children:i.length}),H.jsx("div",{className:"text-muted-foreground text-xs",children:"Hosted"})]}),H.jsxs("div",{children:[H.jsx("div",{className:"text-foreground",children:s.length}),H.jsx("div",{className:"text-muted-foreground text-xs",children:"Attended"})]}),H.jsxs("div",{children:[H.jsx("div",{className:"text-foreground",children:"156"}),H.jsx("div",{className:"text-muted-foreground text-xs",children:"Friends"})]})]})]}),H.jsxs("div",{className:"mb-3",children:[H.jsx("h1",{className:"text-foreground",children:"Arjun Malhotra"}),H.jsx("p",{className:"text-muted-foreground text-sm",children:"Event Curator  Delhi"}),H.jsxs("p",{className:"text-foreground text-sm mt-2",children:[" Creating unforgettable experiences in Delhi",H.jsx("br",{})," Hauz Khas | CP | Khan Market"]})]}),H.jsxs("div",{className:"flex gap-2",children:[H.jsxs(lc,{className:"flex-1 bg-primary hover:bg-primary/90 text-primary-foreground border-0",children:[H.jsx(M6,{className:"h-4 w-4 mr-2"}),"Edit Profile"]}),H.jsx(lc,{variant:"outline",className:"bg-card border-border text-foreground hover:bg-muted",children:H.jsx(wM,{className:"h-4 w-4"})})]})]}),H.jsxs("div",{className:"sticky top-0 z-10 bg-card/90 backdrop-blur-md border-b border-border grid grid-cols-2",children:[H.jsxs("button",{onClick:()=>r("hosted"),className:`flex items-center justify-center gap-2 py-3 transition-colors relative ${e==="hosted"?"text-foreground":"text-muted-foreground"}`,children:[H.jsx(h6,{className:"h-4 w-4"}),H.jsx("span",{className:"text-sm",children:"Hosted"}),e==="hosted"&&H.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-primary"})]}),H.jsxs("button",{onClick:()=>r("attended"),className:`flex items-center justify-center gap-2 py-3 transition-colors relative ${e==="attended"?"text-foreground":"text-muted-foreground"}`,children:[H.jsx(a1,{className:"h-4 w-4"}),H.jsx("span",{className:"text-sm",children:"Attended"}),e==="attended"&&H.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-primary"})]})]}),H.jsxs("div",{className:"p-1",children:[e==="hosted"&&H.jsx("div",{className:"grid grid-cols-3 gap-1",children:i.map(l=>H.jsxs("div",{className:"aspect-square relative group cursor-pointer overflow-hidden",children:[H.jsx(ud,{src:l.imageUrl,alt:l.title,className:"w-full h-full object-cover"}),H.jsx("div",{className:"absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center p-2",children:H.jsxs("div",{className:"text-white text-center",children:[H.jsx("div",{className:"text-xs mb-1",children:l.title}),H.jsxs("div",{className:"text-[10px] text-gray-300",children:[l.attendees," attendees"]})]})}),H.jsx("div",{className:"absolute top-2 right-2 w-2 h-2 rounded-full bg-primary"})]},l.id))}),e==="attended"&&H.jsx("div",{className:"grid grid-cols-3 gap-1",children:s.map(l=>H.jsxs("div",{className:"aspect-square relative group cursor-pointer overflow-hidden",children:[H.jsx(ud,{src:l.imageUrl,alt:l.title,className:"w-full h-full object-cover"}),H.jsx("div",{className:"absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center p-2",children:H.jsxs("div",{className:"text-white text-center",children:[H.jsx("div",{className:"text-xs mb-1",children:l.title}),H.jsxs("div",{className:"text-[10px] text-gray-300",children:["by ",l.host.name]})]})}),H.jsx("div",{className:"absolute top-2 right-2 w-2 h-2 rounded-full bg-primary"})]},l.id))})]})]})})})}function goe({ticket:t,open:e,onClose:r}){const[i,s]=te.useState(!1);if(!t)return null;const l=()=>{s(!0),setTimeout(()=>{s(!1),r()},2e3)};return H.jsx(a2,{open:e,onOpenChange:r,children:H.jsx(l2,{className:"bg-card border-border text-foreground max-w-md",children:i?H.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[H.jsx(vM,{className:"h-20 w-20 text-primary mb-4"}),H.jsx("h3",{className:"text-2xl mb-2 text-foreground",children:"Booking Confirmed!"}),H.jsxs("p",{className:"text-muted-foreground text-center",children:["Your ticket has been booked successfully.",H.jsx("br",{}),"Check your email for details."]})]}):H.jsxs(H.Fragment,{children:[H.jsxs(c2,{children:[H.jsx(u2,{className:"text-2xl text-foreground",children:t.title}),H.jsx(h2,{className:"text-muted-foreground",children:"Book your ticket for this event"})]}),H.jsxs("div",{className:"space-y-4 mt-4",children:[H.jsxs("div",{className:"relative h-40 rounded-lg overflow-hidden",children:[H.jsx(ud,{src:t.imageUrl,alt:t.title,className:"w-full h-full object-cover"}),H.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/60 to-transparent"}),H.jsx("div",{className:"absolute bottom-3 left-3 text-white",children:H.jsx("div",{className:"text-sm text-gray-300",children:t.artist})})]}),H.jsxs("div",{className:"space-y-3 text-sm",children:[H.jsxs("div",{className:"flex items-center gap-3 text-muted-foreground",children:[H.jsx(a1,{className:"h-4 w-4 text-primary"}),H.jsx("span",{children:t.date})]}),H.jsxs("div",{className:"flex items-center gap-3 text-muted-foreground",children:[H.jsx(bM,{className:"h-4 w-4 text-primary"}),H.jsx("span",{children:t.time})]}),H.jsxs("div",{className:"flex items-center gap-3 text-muted-foreground",children:[H.jsx(Hp,{className:"h-4 w-4 text-primary"}),H.jsx("span",{children:t.venue})]}),H.jsxs("div",{className:"flex items-center gap-3 text-muted-foreground",children:[H.jsx(dw,{className:"h-4 w-4 text-primary"}),H.jsxs("span",{children:[t.availableSeats," seats available"]})]})]}),H.jsx("div",{className:"bg-primary/10 border border-primary/30 rounded-lg p-4",children:H.jsxs("div",{className:"flex justify-between items-center",children:[H.jsx("span",{className:"text-muted-foreground",children:"Ticket Price"}),H.jsxs("span",{className:"text-2xl text-foreground",children:["",t.price]})]})}),H.jsxs(lc,{onClick:l,className:"w-full bg-primary hover:bg-primary/90 text-primary-foreground py-6",children:[H.jsx(a6,{className:"h-5 w-5 mr-2"}),"Book Ticket Now"]})]})]})})})}function _oe({tickets:t}){const[e,r]=te.useState("All"),[i,s]=te.useState(null),[l,h]=te.useState(!1),a=["All","Concert","Comedy","DJ Night","Festival"],v=e==="All"?t:t.filter(C=>C.category===e),T=C=>{s(C),h(!0)};return H.jsxs("div",{className:"h-full bg-background",children:[H.jsxs("div",{className:"relative h-full flex flex-col",children:[H.jsxs("div",{className:"sticky top-0 z-10 bg-card/80 backdrop-blur-xl border-b border-border p-4",children:[H.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[H.jsxs("div",{className:"relative",children:[H.jsx(dw,{className:"h-7 w-7 text-primary"}),H.jsx(hw,{className:"h-3 w-3 text-primary absolute -top-1 -right-1"})]}),H.jsx("h1",{className:"text-3xl text-foreground",children:"Live Events"})]}),H.jsx("div",{className:"flex gap-2 overflow-x-auto scrollbar-hide pb-1",children:a.map(C=>H.jsx(sh,{variant:"outline",className:`cursor-pointer px-4 py-2 whitespace-nowrap transition-all duration-300 ${e===C?"bg-primary text-primary-foreground border-primary":"bg-card text-muted-foreground border-border hover:bg-muted"}`,onClick:()=>r(C),children:C},C))})]}),H.jsx(U1,{className:"flex-1",children:H.jsx("div",{className:"p-4 grid grid-cols-1 gap-5",children:v.map(C=>H.jsxs("div",{onClick:()=>T(C),className:"group relative bg-card border border-border rounded-2xl overflow-hidden cursor-pointer hover:scale-[1.02] transition-all duration-300 hover:shadow-xl hover:shadow-primary/10 hover:border-primary/50",children:[H.jsxs("div",{className:"relative h-52 overflow-hidden",children:[H.jsx(ud,{src:C.imageUrl,alt:C.title,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-500"}),H.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black via-black/50 to-transparent opacity-80"}),H.jsx("div",{className:"absolute top-4 right-4 bg-primary px-3 py-1.5 rounded-full text-primary-foreground text-xs backdrop-blur-sm shadow-lg",children:C.category}),H.jsxs("div",{className:"absolute bottom-0 left-0 right-0 p-4",children:[H.jsx("h3",{className:"text-white text-xl mb-1",children:C.title}),H.jsx("p",{className:"text-primary text-sm",children:C.artist})]})]}),H.jsxs("div",{className:"p-4 space-y-3",children:[H.jsxs("div",{className:"flex items-center justify-between text-sm",children:[H.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[H.jsx(a1,{className:"h-4 w-4 text-primary"}),H.jsx("span",{children:C.date})]}),H.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[H.jsx(Hp,{className:"h-4 w-4 text-primary"}),H.jsx("span",{className:"text-xs truncate max-w-[120px]",children:C.venue})]})]}),H.jsxs("div",{className:"bg-primary/10 border border-primary/30 rounded-xl p-3 flex items-center justify-between",children:[H.jsxs("div",{children:[H.jsx("div",{className:"text-muted-foreground text-xs",children:"From"}),H.jsxs("div",{className:"text-foreground text-2xl",children:["",C.price]})]}),H.jsxs("div",{className:"text-right",children:[H.jsxs("div",{className:"text-primary text-xs",children:[C.availableSeats," left"]}),H.jsx("div",{className:"text-foreground text-sm",children:"Book Now "})]})]})]})]},C.id))})})]}),H.jsx(goe,{ticket:i,open:l,onClose:()=>h(!1)})]})}function yoe({venue:t,open:e,onClose:r}){const[i,s]=te.useState(!1);if(!t)return null;const l=()=>{s(!0),setTimeout(()=>{s(!1),r()},2e3)};return H.jsx(a2,{open:e,onOpenChange:r,children:H.jsx(l2,{className:"bg-card border-border text-foreground max-w-md max-h-[90vh] overflow-y-auto",children:i?H.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[H.jsx(vM,{className:"h-20 w-20 text-primary mb-4"}),H.jsx("h3",{className:"text-2xl mb-2 text-foreground",children:"Request Submitted!"}),H.jsxs("p",{className:"text-muted-foreground text-center",children:["Your booking request has been sent.",H.jsx("br",{}),"We'll contact you within 24 hours."]})]}):H.jsxs(H.Fragment,{children:[H.jsxs(c2,{children:[H.jsx(u2,{className:"text-2xl text-foreground",children:t.name}),H.jsx(h2,{className:"text-muted-foreground",children:"Request a booking for this venue"})]}),H.jsxs("div",{className:"space-y-4 mt-4",children:[H.jsxs("div",{className:"relative h-48 rounded-lg overflow-hidden",children:[H.jsx(ud,{src:t.imageUrl,alt:t.name,className:"w-full h-full object-cover"}),H.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/60 to-transparent"}),H.jsxs(sh,{className:"absolute top-3 right-3 bg-black/70 backdrop-blur-sm text-white border-primary/50",children:[H.jsx(EM,{className:"h-3 w-3 fill-primary text-primary mr-1"}),t.rating]}),H.jsx("div",{className:"absolute bottom-3 left-3 text-white",children:H.jsx("div",{className:"text-sm text-gray-300",children:t.category})})]}),H.jsxs("div",{className:"space-y-3",children:[H.jsxs("div",{className:"flex items-center gap-3 text-muted-foreground text-sm",children:[H.jsx(Hp,{className:"h-4 w-4 text-primary"}),H.jsx("span",{children:t.location})]}),H.jsxs("div",{className:"flex items-center gap-3 text-muted-foreground text-sm",children:[H.jsx(fm,{className:"h-4 w-4 text-primary"}),H.jsxs("span",{children:["Capacity: ",t.capacity," guests"]})]})]}),H.jsxs("div",{children:[H.jsx("h4",{className:"text-sm text-muted-foreground mb-2",children:"Amenities"}),H.jsx("div",{className:"flex flex-wrap gap-2",children:t.amenities.map((h,a)=>H.jsx(sh,{variant:"outline",className:"bg-primary/10 text-primary border-primary/30",children:h},a))})]}),H.jsx("div",{className:"bg-primary/10 border border-primary/30 rounded-lg p-4",children:H.jsxs("div",{className:"flex justify-between items-center",children:[H.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[H.jsx(xM,{className:"h-4 w-4 text-primary"}),H.jsx("span",{className:"text-sm",children:"Per Hour"})]}),H.jsxs("span",{className:"text-2xl text-foreground",children:["",t.pricePerHour.toLocaleString()]})]})}),H.jsxs(lc,{onClick:l,className:"w-full bg-primary hover:bg-primary/90 text-primary-foreground py-6",children:[H.jsx(a1,{className:"h-5 w-5 mr-2"}),"Request Booking"]}),H.jsx("p",{className:"text-xs text-muted-foreground text-center",children:"Our team will contact you to confirm availability"})]})]})})})}const fM={"Banquet Hall":"",Rooftop:"",Restaurant:"",Garden:"","Conference Room":""};function voe({venues:t}){const[e,r]=te.useState("All"),[i,s]=te.useState(null),[l,h]=te.useState(!1),a=["All","Banquet Hall","Rooftop","Restaurant","Garden","Conference Room"],v=e==="All"?t:t.filter(C=>C.category===e),T=C=>{s(C),h(!0)};return H.jsxs("div",{className:"h-full bg-background",children:[H.jsxs("div",{className:"relative h-full flex flex-col",children:[H.jsxs("div",{className:"sticky top-0 z-10 bg-card/80 backdrop-blur-xl border-b border-border p-4",children:[H.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[H.jsxs("div",{className:"relative",children:[H.jsx(yM,{className:"h-7 w-7 text-primary"}),H.jsx(hw,{className:"h-3 w-3 text-primary absolute -top-1 -right-1"})]}),H.jsx("h1",{className:"text-3xl text-foreground",children:"Premium Venues"})]}),H.jsx("div",{className:"flex gap-2 overflow-x-auto scrollbar-hide pb-1",children:a.map(C=>H.jsxs(sh,{variant:"outline",className:`cursor-pointer px-3 py-2 whitespace-nowrap transition-all duration-300 ${e===C?"bg-primary text-primary-foreground border-primary":"bg-card text-muted-foreground border-border hover:bg-muted"}`,onClick:()=>r(C),children:[C!=="All"&&H.jsx("span",{className:"mr-1",children:fM[C]}),C]},C))})]}),H.jsx(U1,{className:"flex-1",children:H.jsx("div",{className:"p-4 grid grid-cols-1 gap-5",children:v.map(C=>H.jsxs("div",{onClick:()=>T(C),className:"group relative bg-card border border-border rounded-2xl overflow-hidden cursor-pointer hover:scale-[1.02] transition-all duration-300 hover:shadow-xl hover:shadow-primary/10 hover:border-primary/50",children:[H.jsxs("div",{className:"relative h-48 overflow-hidden",children:[H.jsx(ud,{src:C.imageUrl,alt:C.name,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-500"}),H.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black via-black/40 to-transparent"}),H.jsx("div",{className:"absolute top-4 right-4 bg-black/60 backdrop-blur-md px-3 py-1.5 rounded-full border border-primary/50 shadow-lg",children:H.jsxs("div",{className:"flex items-center gap-1",children:[H.jsx(EM,{className:"h-4 w-4 fill-primary text-primary"}),H.jsx("span",{className:"text-white",children:C.rating})]})}),H.jsxs("div",{className:"absolute top-4 left-4 bg-primary px-3 py-1.5 rounded-full text-primary-foreground text-xs shadow-lg",children:[fM[C.category]," ",C.category]}),H.jsxs("div",{className:"absolute bottom-0 left-0 right-0 p-4",children:[H.jsx("h3",{className:"text-white text-xl",children:C.name}),H.jsxs("div",{className:"flex items-center gap-1.5 text-primary text-sm mt-1",children:[H.jsx(Hp,{className:"h-3.5 w-3.5"}),H.jsx("span",{children:C.location})]})]})]}),H.jsxs("div",{className:"p-4 space-y-3",children:[H.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[H.jsxs("div",{className:"bg-primary/10 border border-primary/20 rounded-lg p-3",children:[H.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[H.jsx(fm,{className:"h-4 w-4 text-primary"}),H.jsx("span",{className:"text-muted-foreground text-xs",children:"Capacity"})]}),H.jsx("div",{className:"text-foreground",children:C.capacity})]}),H.jsxs("div",{className:"bg-primary/10 border border-primary/20 rounded-lg p-3",children:[H.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[H.jsx(xM,{className:"h-4 w-4 text-primary"}),H.jsx("span",{className:"text-muted-foreground text-xs",children:"Per Hour"})]}),H.jsxs("div",{className:"text-foreground",children:["",C.pricePerHour.toLocaleString()]})]})]}),H.jsx("div",{className:"flex flex-wrap gap-1.5",children:C.amenities.map((k,L)=>H.jsx(sh,{className:"bg-primary/10 text-primary border-primary/30 text-xs",children:k},L))}),H.jsx("div",{className:"bg-primary/10 border border-primary/30 rounded-lg p-3 text-center group-hover:bg-primary/20 transition-all",children:H.jsx("div",{className:"text-foreground",children:"View Details & Book "})})]})]},C.id))})})]}),H.jsx(yoe,{venue:i,open:l,onClose:()=>h(!1)})]})}const Gg=({children:t,className:e=""})=>H.jsx(rR.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3,ease:[.23,1,.32,1]},className:e,children:t}),mB=te.createContext(void 0);function boe({children:t}){const[e,r]=te.useState("dark");te.useEffect(()=>{const s=window.document.documentElement;s.classList.remove("light","dark"),s.classList.add(e)},[e]);const i=()=>{r(s=>s==="dark"?"light":"dark")};return H.jsx(mB.Provider,{value:{theme:e,toggleTheme:i},children:t})}function xoe(){const t=te.useContext(mB);if(t===void 0)throw new Error("useTheme must be used within a ThemeProvider");return t}const woe=[{id:"t1",title:"Neon Nights Festival",artist:"DJ Nucleya",date:"Nov 25, 2025",time:"8:00 PM",venue:"Jawaharlal Nehru Stadium",imageUrl:"https://images.unsplash.com/photo-1611939341783-a44f2cbd3bbd?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxjb25jZXJ0JTIwc3RhZ2UlMjBsaWdodHMlMjBwdXJwbGV8ZW58MXx8fHwxNzYzNDYzNjg5fDA&ixlib=rb-4.1.0&q=80&w=1080",price:1999,category:"Concert",availableSeats:450},{id:"t2",title:"Laugh Riot Comedy Night",artist:"Zakir Khan",date:"Nov 22, 2025",time:"7:30 PM",venue:"Kamani Auditorium",imageUrl:"https://images.unsplash.com/photo-1702351002798-6ccc7598494a?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxzdGFuZHVwJTIwY29tZWR5JTIwbWljcm9waG9uZXxlbnwxfHx8fDE3NjM0NjM2ODl8MA&ixlib=rb-4.1.0&q=80&w=1080",price:799,category:"Comedy",availableSeats:120},{id:"t3",title:"Bass Drop Night",artist:"KSHMR",date:"Nov 28, 2025",time:"9:00 PM",venue:"Warehouse Club, Aerocity",imageUrl:"https://images.unsplash.com/photo-1676969609758-b3bdfe8e0b53?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxkaiUyMHBhcnR5JTIwY2x1YiUyMG5lb258ZW58MXx8fHwxNzYzNDYzNjkwfDA&ixlib=rb-4.1.0&q=80&w=1080",price:1499,category:"DJ Night",availableSeats:300},{id:"t4",title:"Indie Music Fest",artist:"Various Artists",date:"Dec 01, 2025",time:"4:00 PM",venue:"Garden of Five Senses",imageUrl:"https://images.unsplash.com/photo-1524368535928-5b5e00ddc76b?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxtdXNpYyUyMGZlc3RpdmFsJTIwY3Jvd2R8ZW58MXx8fHwxNzYzMzU0OTg0fDA&ixlib=rb-4.1.0&q=80&w=1080",price:2499,category:"Festival",availableSeats:800},{id:"t5",title:"Stand Up Special",artist:"Biswa Kalyan Rath",date:"Nov 24, 2025",time:"8:00 PM",venue:"NCPA, CP",imageUrl:"https://images.unsplash.com/photo-1702351002798-6ccc7598494a?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxzdGFuZHVwJTIwY29tZWR5JTIwbWljcm9waG9uZXxlbnwxfHx8fDE3NjM0NjM2ODl8MA&ixlib=rb-4.1.0&q=80&w=1080",price:899,category:"Comedy",availableSeats:200},{id:"t6",title:"Electronic Sunset",artist:"Lost Stories",date:"Nov 30, 2025",time:"6:00 PM",venue:"Habitat Centre",imageUrl:"https://images.unsplash.com/photo-1611939341783-a44f2cbd3bbd?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxjb25jZXJ0JTIwc3RhZ2UlMjBsaWdodHMlMjBwdXJwbGV8ZW58MXx8fHwxNzYzNDYzNjg5fDA&ixlib=rb-4.1.0&q=80&w=1080",price:1299,category:"Concert",availableSeats:350}],Eoe=[{id:"v1",name:"The Grand Ballroom",location:"Vasant Kunj",rating:4.8,imageUrl:"https://images.unsplash.com/photo-1761110787206-2cc164e4913c?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxldmVudCUyMHZlbnVlJTIwbHV4dXJ5JTIwaGFsbHxlbnwxfHx8fDE3NjM0NjM2OTF8MA&ixlib=rb-4.1.0&q=80&w=1080",capacity:"300-500",pricePerHour:15e3,amenities:["AC","Catering","Parking","AV Equipment"],category:"Banquet Hall"},{id:"v2",name:"Crystal Palace",location:"Chattarpur",rating:4.9,imageUrl:"https://images.unsplash.com/photo-1625619080917-7d6ff39e0675?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHx3ZWRkaW5nJTIwdmVudWUlMjBiYWxscm9vbXxlbnwxfHx8fDE3NjMzODkwMDZ8MA&ixlib=rb-4.1.0&q=80&w=1080",capacity:"400-600",pricePerHour:2e4,amenities:["Decor","Catering","Valet","DJ Setup"],category:"Banquet Hall"},{id:"v3",name:"Sky Lounge",location:"Aerocity",rating:4.7,imageUrl:"https://images.unsplash.com/photo-1738774801506-40bc473bda41?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxyb29mdG9wJTIwdmVudWUlMjB0ZXJyYWNlfGVufDF8fHx8MTc2MzQ2MzY5MXww&ixlib=rb-4.1.0&q=80&w=1080",capacity:"100-200",pricePerHour:12e3,amenities:["Open Air","Bar","City View","Music System"],category:"Rooftop"},{id:"v4",name:"Heritage Restaurant",location:"Hauz Khas",rating:4.6,imageUrl:"https://images.unsplash.com/photo-1759769583908-7cd4e3310ce6?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxyZXN0YXVyYW50JTIwdmVudWUlMjBkaW5pbmd8ZW58MXx8fHwxNzYzNDYzNjkyfDA&ixlib=rb-4.1.0&q=80&w=1080",capacity:"50-100",pricePerHour:8e3,amenities:["Private Dining","Chef","Wine Selection","Parking"],category:"Restaurant"},{id:"v5",name:"Garden Vista",location:"South Delhi",rating:4.8,imageUrl:"https://images.unsplash.com/photo-1761110787206-2cc164e4913c?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxldmVudCUyMHZlbnVlJTIwbHV4dXJ5JTIwaGFsbHxlbnwxfHx8fDE3NjM0NjM2OTF8MA&ixlib=rb-4.1.0&q=80&w=1080",capacity:"200-300",pricePerHour:1e4,amenities:["Garden","Lawn","Gazebo","Lighting"],category:"Garden"},{id:"v6",name:"Business Hub",location:"Connaught Place",rating:4.5,imageUrl:"https://images.unsplash.com/photo-1625619080917-7d6ff39e0675?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHx3ZWRkaW5nJTIwdmVudWUlMjBiYWxscm9vbXxlbnwxfHx8fDE3NjMzODkwMDZ8MA&ixlib=rb-4.1.0&q=80&w=1080",capacity:"30-50",pricePerHour:5e3,amenities:["Projector","WiFi","Coffee","Whiteboard"],category:"Conference Room"}];function Aoe(){const[t,e]=te.useState(null),[r,i]=te.useState(!1),{theme:s,toggleTheme:l}=xoe(),h=v=>{e(v),i(!0)},a=()=>{i(!1),setTimeout(()=>e(null),300)};return H.jsxs("div",{className:"h-screen w-full max-w-lg mx-auto bg-background flex flex-col overflow-hidden",children:[H.jsx("div",{className:"absolute top-4 right-4 z-50",children:H.jsx(lc,{size:"icon",variant:"outline",onClick:l,className:"bg-card border-border hover:bg-accent",children:s==="dark"?H.jsx(N6,{className:"h-5 w-5 text-primary"}):H.jsx(A6,{className:"h-5 w-5 text-primary"})})}),H.jsxs(t9,{defaultValue:"map",className:"flex-1 flex flex-col h-full",children:[H.jsx("div",{className:"flex-1 overflow-hidden relative",children:H.jsxs(WD,{mode:"wait",children:[H.jsx(Ig,{value:"social",className:"absolute inset-0 m-0",children:H.jsx(Gg,{className:"h-full",children:H.jsx(foe,{events:O0,onEventSelect:h})})}),H.jsx(Ig,{value:"map",className:"absolute inset-0 m-0",children:H.jsx(Gg,{className:"h-full",children:H.jsx(Jse,{})})}),H.jsx(Ig,{value:"tickets",className:"absolute inset-0 m-0",children:H.jsx(Gg,{className:"h-full",children:H.jsx(_oe,{tickets:woe})})}),H.jsx(Ig,{value:"venues",className:"absolute inset-0 m-0",children:H.jsx(Gg,{className:"h-full",children:H.jsx(voe,{venues:Eoe})})}),H.jsx(Ig,{value:"profile",className:"absolute inset-0 m-0",children:H.jsx(Gg,{className:"h-full",children:H.jsx(moe,{events:O0})})})]})}),H.jsxs(r9,{className:"w-full h-20 bg-background/60 backdrop-blur-2xl border-t border-white/10 grid grid-cols-5 rounded-none p-2 shrink-0 shadow-[0_-4px_24px_rgba(0,0,0,0.3)]",children:[H.jsxs(Rg,{value:"social",className:"flex-col gap-1 text-muted-foreground rounded-xl data-[state=active]:bg-primary data-[state=active]:text-primary-foreground data-[state=active]:shadow-[0_0_20px_rgba(120,119,198,0.5)] transition-all duration-300",children:[H.jsx(fm,{className:"h-5 w-5"}),H.jsx("span",{className:"text-[10px] font-medium",children:"Social"})]}),H.jsxs(Rg,{value:"map",className:"flex-col gap-1 text-muted-foreground rounded-xl data-[state=active]:bg-primary data-[state=active]:text-primary-foreground data-[state=active]:shadow-[0_0_20px_rgba(120,119,198,0.5)] transition-all duration-300",children:[H.jsx(b6,{className:"h-5 w-5"}),H.jsx("span",{className:"text-[10px] font-medium",children:"Map"})]}),H.jsxs(Rg,{value:"tickets",className:"flex-col gap-1 text-muted-foreground rounded-xl data-[state=active]:bg-primary data-[state=active]:text-primary-foreground data-[state=active]:shadow-[0_0_20px_rgba(120,119,198,0.5)] transition-all duration-300",children:[H.jsx(dw,{className:"h-5 w-5"}),H.jsx("span",{className:"text-[10px] font-medium",children:"Tickets"})]}),H.jsxs(Rg,{value:"venues",className:"flex-col gap-1 text-muted-foreground rounded-xl data-[state=active]:bg-primary data-[state=active]:text-primary-foreground data-[state=active]:shadow-[0_0_20px_rgba(120,119,198,0.5)] transition-all duration-300",children:[H.jsx(yM,{className:"h-5 w-5"}),H.jsx("span",{className:"text-[10px] font-medium",children:"Venues"})]}),H.jsxs(Rg,{value:"profile",className:"flex-col gap-1 text-muted-foreground rounded-xl data-[state=active]:bg-primary data-[state=active]:text-primary-foreground data-[state=active]:shadow-[0_0_20px_rgba(120,119,198,0.5)] transition-all duration-300",children:[H.jsx(z6,{className:"h-5 w-5"}),H.jsx("span",{className:"text-[10px] font-medium",children:"Profile"})]})]})]}),H.jsx(nI,{event:t,open:r,onClose:a})]})}function Toe(){return H.jsx(boe,{children:H.jsx(Aoe,{})})}YB.createRoot(document.getElementById("root")).render(H.jsx(Toe,{}));
